From fabricecolin at mail.berlios.de  Thu Oct  5 16:36:22 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Thu, 5 Oct 2006 16:36:22 +0200
Subject: [Pinot-svn] r501 - trunk
Message-ID: <200610051436.k95EaMhe005101@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-05 16:36:22 +0200 (Thu, 05 Oct 2006)
New Revision: 501

Modified:
   trunk/TODO
Log:
Rearranged/removed tasks somewhat.


Modified: trunk/TODO
===================================================================
--- trunk/TODO	2006-09-30 04:47:17 UTC (rev 500)
+++ trunk/TODO	2006-10-05 14:36:22 UTC (rev 501)
@@ -3,6 +3,9 @@
 - Get rid of dead code/classes/methods...
 - Advertise service via Rendezvous
 - MIMEScanner should also return parent types so that we don't filter out types unnecessarily
+- Update to gtk+'s xdgmime as it seems to be the reference now
+- Build a -devel package for those who want to write their own tokenizers
+- Allow building without the DBus daemon
 
 Tokenize
 - Allow to cache documents that had to be converted ? eg PDF, MS Word
@@ -23,21 +26,18 @@
 - Support for HTML frames
 
 Search
-- Write a parser for extracting results from web pages
-- Allow to use "extended" INTERPRET tags selectively 
 - With engines that provide a redirection URL for results (eg Acoona), it looks like
   the query hitory is not saved/checked correctly
 - Add http://www.patentcommons.org/commons/patentsearch.php
 - Replace Accona with Baidu ?
 - Implement AutoDiscovery of OpenSearch Description files (http://opensearch.a9.com/spec/1.1/description/)
 - Make sure Description files' SyndicationRight is not private or closed
+- Support for Google Buttons
 - Export search results as OpenSearch Response
-- Support for Google Buttons
 
 Index
 - Get hold of stopwords lists for the languages supported by Xapian's stemmers and don't index stop words
 - Allow to import and use omindex-produced indexes  so that they can be used like pinot's internal indexes
-- Write a pseudo-filesystem for indexes with FUSE (http://fuse.sourceforge.net/) or gnome-vfs ?
 - Xapian lock files can be deleted at startup if no other instance is running
 - Play around with the XAPIAN_FLUSH_THRESHOLD env var
 - Hash document data to determine on updates whether documents have changed
@@ -47,18 +47,19 @@
 - Reopen connection to remote indexes when necessary; does Xapian throw a RemoteError ?
 - Allow to access remote Xapian indexes tunneled through ssh, using Xapian::Remote::open()
   defined in /usr/include/xapian/dbfactory.h
-- Use Xapian's QueryParser
+- Use Xapian's QueryParser so that queries like "(type: pdf) and (dir: /reference/rfc) and (tcp near ip)"
+  become possible
 
 Mail
 - Find out what kind of locking scheme Mozilla uses (POSIX lock ?) and use that
 - Index Evolution email (Camel, might be useful for other types actually)
-- Keep track of attachments and avoid indexing the same file twice
 - Append sender to title or use as host name ?
 - Decypher and use Mozilla's mailbox scheme, eg
   mailbox://mbox_file_name?number=2164959&part=1.2&type=text/plain&filename=portability.txt
 - When parsing email's Date field, take the timezone offset into account, eg in
     Date: Thu, 25 Aug 2005 11:04:49 +0800
   +0800 is basically same as SGT. At the moment the date is assumed to be GMT !
+- Keep track of attachments and avoid indexing the same file twice
 - Mail messages with attachements are not indexed
 
 UI



From fabricecolin at mail.berlios.de  Fri Oct  6 16:45:05 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Fri, 6 Oct 2006 16:45:05 +0200
Subject: [Pinot-svn] r502 - trunk/Utils
Message-ID: <200610061445.k96Ej5eG021736@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-06 16:45:04 +0200 (Fri, 06 Oct 2006)
New Revision: 502

Modified:
   trunk/Utils/MboxParser.cpp
   trunk/Utils/MboxParser.h
Log:
Go through all of a message's parts. Don't skip parts based on their MIME type.


Modified: trunk/Utils/MboxParser.cpp
===================================================================
--- trunk/Utils/MboxParser.cpp	2006-10-05 14:36:22 UTC (rev 501)
+++ trunk/Utils/MboxParser.cpp	2006-10-06 14:45:04 UTC (rev 502)
@@ -32,30 +32,37 @@
 using std::cout;
 using std::endl;
 
-MboxParser::MboxParser(const string &fileName, off_t mboxOffset)
+MboxParser::MboxParser(const string &fileName, off_t mboxOffset) :
+	m_fileName(fileName),
+	m_fd(-1),
+	m_pMboxStream(NULL),
+	m_pParser(NULL),
+	m_pMimeMessage(NULL),
+	m_partsCount(-1),
+	m_partNum(-1),
+	m_messageStart(mboxOffset),
+	m_pCurrentDocument(NULL),
+	m_messageDate(0)
 {
-	m_fileName = fileName;
-	m_fd = -1;
-	m_pMboxStream = NULL;
-	m_pParser = NULL;
-	m_partsCount = m_partNum = -1;
-	m_messageStart = mboxOffset;
-	m_pCurrentMessage = NULL;
-	m_messageDate = 0;
-
 	if (initialize() == true)
 	{
+		DocumentInfo docInfo;
+
 		// Extract the first message
-		extractMessage();
+		extractMessage("");
 	}
 }
 
 MboxParser::~MboxParser()
 {
-	if (m_pCurrentMessage != NULL)
+	if (m_pMimeMessage != NULL)
 	{
-		delete m_pCurrentMessage;
+		g_mime_object_unref(GMIME_OBJECT(m_pMimeMessage));
 	}
+	if (m_pCurrentDocument != NULL)
+	{
+		delete m_pCurrentDocument;
+	}
 
 	finalize();
 }
@@ -178,7 +185,7 @@
 			if (pPart != NULL)
 			{
 				m_partNum = ++partNum;
-				return NULL;
+				return pPart;
 			}
 		}
 
@@ -197,181 +204,180 @@
 
 	// Check the content type
 	const GMimeContentType *mimeType = g_mime_part_get_content_type(mimePart);
-	if (g_mime_content_type_is_type(mimeType, "text", "*") == TRUE)
+	// Set this for caller
+	char *partType = g_mime_content_type_to_string(mimeType);
+	if (partType != NULL)
 	{
-		// Set this for caller
-		char *partType = g_mime_content_type_to_string(mimeType);
-		if (partType != NULL)
-		{
-			contentType = partType;
-			g_free(partType);
-		}
-
-		GMimePartEncodingType encodingType = g_mime_part_get_encoding(mimePart);
 #ifdef DEBUG
-		cout << "MboxParser::extractPart: encoding is " << encodingType << endl;
+		cout << "MboxParser::extractPart: type is " << partType << endl;
 #endif
+		contentType = partType;
+		g_free(partType);
+	}
 
-		// Write the part to memory
-		g_mime_part_set_encoding(mimePart, GMIME_PART_ENCODING_QUOTEDPRINTABLE);
-		GMimeStream *memStream = g_mime_stream_mem_new();
-		GMimeDataWrapper *dataWrapper = g_mime_part_get_content_object(mimePart);
-		if (dataWrapper != NULL)
-		{
-			ssize_t writeLen = g_mime_data_wrapper_write_to_stream(dataWrapper, memStream);
+	GMimePartEncodingType encodingType = g_mime_part_get_encoding(mimePart);
 #ifdef DEBUG
-			cout << "MboxParser::extractPart: wrote " << writeLen << " bytes" << endl;
+	cout << "MboxParser::extractPart: encoding is " << encodingType << endl;
 #endif
-			g_object_unref(dataWrapper);
-		}
-		g_mime_stream_flush(memStream);
-		partLen = g_mime_stream_length(memStream);
-#ifdef DEBUG
-		cout << "MboxParser::extractPart: part is " << partLen << " bytes long" << endl;
-#endif
 
-		pBuffer = (char*)malloc(partLen + 1);
-		pBuffer[partLen] = '\0';
-		g_mime_stream_reset(memStream);
-		ssize_t readLen = g_mime_stream_read(memStream, pBuffer, partLen);
+	// Write the part to memory
+	g_mime_part_set_encoding(mimePart, GMIME_PART_ENCODING_QUOTEDPRINTABLE);
+	GMimeStream *memStream = g_mime_stream_mem_new();
+	GMimeDataWrapper *dataWrapper = g_mime_part_get_content_object(mimePart);
+	if (dataWrapper != NULL)
+	{
+		ssize_t writeLen = g_mime_data_wrapper_write_to_stream(dataWrapper, memStream);
 #ifdef DEBUG
-		cout << "MboxParser::extractPart: read " << readLen << " bytes" << endl;
+		cout << "MboxParser::extractPart: wrote " << writeLen << " bytes" << endl;
 #endif
-		g_mime_stream_unref(memStream);
+		g_object_unref(dataWrapper);
 	}
+	g_mime_stream_flush(memStream);
+	partLen = g_mime_stream_length(memStream);
 #ifdef DEBUG
-	else	cout << "MboxParser::extractPart: part is not text" << endl;
+	cout << "MboxParser::extractPart: part is " << partLen << " bytes long" << endl;
 #endif
 
+	pBuffer = (char*)malloc(partLen + 1);
+	pBuffer[partLen] = '\0';
+	g_mime_stream_reset(memStream);
+	ssize_t readLen = g_mime_stream_read(memStream, pBuffer, partLen);
+#ifdef DEBUG
+	cout << "MboxParser::extractPart: read " << readLen << " bytes" << endl;
+#endif
+	g_mime_stream_unref(memStream);
+
 	return pBuffer;
 }
 
-bool MboxParser::extractMessage(void)
+bool MboxParser::extractMessage(const string &subject)
 {
-	string fromLine, contentType;
+	string fromLine, msgSubject(subject), contentType;
+	char *pPart = NULL;
+	ssize_t partLength = 0;
 
 	while (g_mime_stream_eos(m_pMboxStream) == FALSE)
 	{
-		if (m_partsCount != -1)
+		// Does the previous message have parts left to parse ?
+		if (m_partsCount == -1)
 		{
-			// FIXME: the previous message has parts left to parse
-			// The parser doesn't allow to poke at the stream
-			// See g_mime_parser_init_with_stream() here :
-			// http://spruce.sourceforge.net/gmime/doc/gmime-gmime-parser.html
-#ifdef DEBUG
-			cout << "MboxParser::extractMessage: skipping parts..." << endl;
-#endif
-			m_partsCount = m_partNum = -1;
-		}
-		// Get the next message
-		GMimeMessage *mimeMessage = g_mime_parser_construct_message(m_pParser);
+			// No, it doesn't
+			if (m_pMimeMessage != NULL)
+			{
+				g_mime_object_unref(GMIME_OBJECT(m_pMimeMessage));
+				m_pMimeMessage = NULL;
+			}
 
-		m_messageStart = g_mime_parser_get_from_offset(m_pParser);
-		off_t messageEnd = g_mime_parser_tell(m_pParser);
+			// Get the next message
+			m_pMimeMessage = g_mime_parser_construct_message(m_pParser);
 
+			m_messageStart = g_mime_parser_get_from_offset(m_pParser);
+			off_t messageEnd = g_mime_parser_tell(m_pParser);
 #ifdef DEBUG
-		cout << "MboxParser::extractMessage: message between offsets " << m_messageStart
-			<< " and " << messageEnd << endl;
+			cout << "MboxParser::extractMessage: message between offsets " << m_messageStart
+				<< " and " << messageEnd << endl;
 #endif
-		if (messageEnd > m_messageStart)
-		{
-			char *msgFromLine = g_mime_parser_get_from(m_pParser);
-			if (msgFromLine != NULL)
+			if (messageEnd > m_messageStart)
 			{
-				fromLine = msgFromLine;
-				g_free(msgFromLine);
-			}
+				char *pFromLine = g_mime_parser_get_from(m_pParser);
+				if (pFromLine != NULL)
+				{
+					fromLine = pFromLine;
+					g_free(pFromLine);
+				}
 
-			// FIXME: this only applies to Mozilla
-			const char *msgMozStatus = g_mime_message_get_header(mimeMessage, "X-Mozilla-Status");
-			if (msgMozStatus != NULL)
-			{
-				long int mozStatus = strtol(msgMozStatus, NULL, 16);
-				// Watch out for Mozilla specific flags :
-				// MSG_FLAG_EXPUNGED, MSG_FLAG_EXPIRED
-				// They are defined in mailnews/MailNewsTypes.h and msgbase/nsMsgMessageFlags.h
-				if ((mozStatus & 0x0008) ||
-					(mozStatus & 0x0040))
+				// FIXME: this only applies to Mozilla
+				const char *pMozStatus = g_mime_message_get_header(m_pMimeMessage, "X-Mozilla-Status");
+				if (pMozStatus != NULL)
 				{
+					long int mozStatus = strtol(pMozStatus, NULL, 16);
+					// Watch out for Mozilla specific flags :
+					// MSG_FLAG_EXPUNGED, MSG_FLAG_EXPIRED
+					// They are defined in mailnews/MailNewsTypes.h and msgbase/nsMsgMessageFlags.h
+					if ((mozStatus & 0x0008) ||
+						(mozStatus & 0x0040))
+					{
 #ifdef DEBUG
-					cout << "MboxParser::extractMessage: flagged by Mozilla" << endl;
+						cout << "MboxParser::extractMessage: flagged by Mozilla" << endl;
 #endif
-					g_mime_object_unref(GMIME_OBJECT(mimeMessage));
-					continue;
+						continue;
+					}
 				}
-			}
 
-			// How old is this message ?
-			const char *msgDate = g_mime_message_get_header(mimeMessage, "Date");
-			if (msgDate != NULL)
-			{
-				m_messageDate = TimeConverter::fromTimestamp(msgDate);
+				// How old is this message ?
+				const char *pDate = g_mime_message_get_header(m_pMimeMessage, "Date");
+				if (pDate != NULL)
+				{
+					m_messageDate = TimeConverter::fromTimestamp(pDate);
+				}
+				else
+				{
+					m_messageDate = 0;
+				}
+#ifdef DEBUG
+				cout << "MboxParser::extractMessage: message date is " << m_messageDate << endl;
+#endif
+
+				// Extract the subject
+				const char *pSubject = g_mime_message_get_header(m_pMimeMessage, "Subject");
+				if (pSubject != NULL)
+				{
+					msgSubject = pSubject;
+				}
 			}
-			else
-			{
-				m_messageDate = 0;
-			}
+		}
 #ifdef DEBUG
-			cout << "MboxParser::extractMessage: message date is " << m_messageDate << endl;
+		cout << "MboxParser::extractMessage: message subject is " << msgSubject << endl;
 #endif
 
-			// Extract the subject and source address
-			const char *msgSubject = g_mime_message_get_header(mimeMessage, "Subject");
-			const char *msgFrom = g_mime_message_get_header(mimeMessage, "From");
-
+		if (m_pMimeMessage != NULL)
+		{
 			// Get the top-level MIME part in the message
-			GMimeObject *mimePart = g_mime_message_get_mime_part(mimeMessage);
-
-			// Extract the part's text
-			ssize_t partLength = 0;
-			char *pPart = extractPart(mimePart, contentType, partLength);
-			if (pPart != NULL)
+			GMimeObject *pMimePart = g_mime_message_get_mime_part(m_pMimeMessage);
+			if (pMimePart != NULL)
 			{
-				string location, subject;
-				char posStr[64];
+				// Extract the part's text
+				pPart = extractPart(pMimePart, contentType, partLength);
+				if (pPart != NULL)
+				{
+					string location;
+					char posStr[64];
 
-				// New location
-				// FIXME: use the same scheme as Mozilla
-				location = "mailbox://";
-				location += m_fileName;
-				location += "?o=";
-				snprintf(posStr, 64, "%d", m_messageStart);
-				location += posStr;
-				location += "&p=";
-				snprintf(posStr, 64, "%d", max(m_partNum, 0));
-				location += posStr;
-				location += "&h=";
-				location += StringManip::hashString(fromLine);
+					// New location
+					// FIXME: use the same scheme as Mozilla
+					location = "mailbox://";
+					location += m_fileName;
+					location += "?o=";
+					snprintf(posStr, 64, "%d", m_messageStart);
+					location += posStr;
+					location += "&p=";
+					snprintf(posStr, 64, "%d", max(m_partNum, 0));
+					location += posStr;
+					location += "&h=";
+					location += StringManip::hashString(fromLine);
 #ifdef DEBUG
-				cout << "MboxParser::extractMessage: message location is " << location << endl;
+					cout << "MboxParser::extractMessage: message location is " << location << endl;
 #endif
 
-				if (msgSubject != NULL)
-				{
-					subject = msgSubject;
-#ifdef DEBUG
-					cout << "MboxParser::extractMessage: message subject is " << subject << endl;
-#endif
-				}
-#ifdef DEBUG
-				else cout << "MboxParser::extractMessage: message has no subject" << endl;
-#endif
+					// New document
+					m_pCurrentDocument = new Document(msgSubject, location, contentType, "");
+					m_pCurrentDocument->setData(pPart, (unsigned int)partLength);
 
-				// New message
-				m_pCurrentMessage = new Document(subject, location, contentType, "");
-				m_pCurrentMessage->setData(pPart, (unsigned int)partLength);
+					free(pPart);
+					g_mime_object_unref(pMimePart);
 
-				free(pPart);
-				g_mime_object_unref(mimePart);
-				g_mime_object_unref(GMIME_OBJECT(mimeMessage));
+					return true;
+				}
 
-				return true;
+				g_mime_object_unref(pMimePart);
 			}
 
-			g_mime_object_unref(mimePart);
+			g_mime_object_unref(GMIME_OBJECT(m_pMimeMessage));
+			m_pMimeMessage = NULL;
 		}
 
-		g_mime_object_unref(GMIME_OBJECT(mimeMessage));
+		// If we get there, no suitable parts were found
+		m_partsCount = m_partNum = -1;
 	}
 
 	return false;
@@ -386,10 +392,17 @@
 /// Jumps to the next message.
 bool MboxParser::nextMessage(void)
 {
-	delete m_pCurrentMessage;
-	m_pCurrentMessage = NULL;
-	// Get the next message from the original document
-	return extractMessage();
+	string subject;
+
+	if (m_pCurrentDocument != NULL)
+	{
+		subject = m_pCurrentDocument->getTitle();
+
+		delete m_pCurrentDocument;
+		m_pCurrentDocument = NULL;
+	}
+
+	return extractMessage(subject);
 }
 
 /// Returns a pointer to the current message's document.
@@ -397,5 +410,5 @@
 {
 	// FIXME: this object can be invalidated by nextMessage() at any time;
 	// use auto_ptr all the way ?
-	return m_pCurrentMessage;
+	return m_pCurrentDocument;
 }

Modified: trunk/Utils/MboxParser.h
===================================================================
--- trunk/Utils/MboxParser.h	2006-10-05 14:36:22 UTC (rev 501)
+++ trunk/Utils/MboxParser.h	2006-10-06 14:45:04 UTC (rev 502)
@@ -58,17 +58,18 @@
 		int m_fd;
 		GMimeStream *m_pMboxStream;
 		GMimeParser *m_pParser;
+		GMimeMessage *m_pMimeMessage;
 		int m_partsCount;
 		int m_partNum;
 		off_t m_messageStart;
-		Document *m_pCurrentMessage;
+		Document *m_pCurrentDocument;
 		time_t m_messageDate;
 
 		bool initialize(void);
 
 		void finalize(void);
 
-		bool extractMessage(void);
+		bool extractMessage(const string &subject);
 
 		char *extractPart(GMimeObject *mimeObject, string &contentType, ssize_t &partLen);
 



From fabricecolin at mail.berlios.de  Fri Oct  6 18:38:24 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Fri, 6 Oct 2006 18:38:24 +0200
Subject: [Pinot-svn] r503 - in trunk: Collect Utils
Message-ID: <200610061638.k96GcOnF024020@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-06 18:38:23 +0200 (Fri, 06 Oct 2006)
New Revision: 503

Modified:
   trunk/Collect/MboxCollector.cpp
   trunk/Utils/MboxParser.cpp
   trunk/Utils/MboxParser.h
Log:
MboxCollector can access any part of a message.
Removed hash ("h=...") from URL scheme.


Modified: trunk/Collect/MboxCollector.cpp
===================================================================
--- trunk/Collect/MboxCollector.cpp	2006-10-06 14:45:04 UTC (rev 502)
+++ trunk/Collect/MboxCollector.cpp	2006-10-06 16:38:23 UTC (rev 503)
@@ -42,6 +42,8 @@
 {
 	Url thisUrl(docInfo.getLocation());
 	string protocol = thisUrl.getProtocol();
+	off_t messageOffset = 0;
+	int partNum = 0;
 
 	if (protocol != "mailbox")
 	{
@@ -55,7 +57,13 @@
 	{
 		return NULL;
 	}
-	off_t messageOffset = (off_t)atol(offset.c_str());
+	messageOffset = (off_t)atol(offset.c_str());
+	// ...and the part number
+	string number = StringManip::extractField(thisUrl.getParameters(), "p=", "");
+	if (number.empty() == false)
+	{
+		partNum = atoi(number.c_str());
+	}
 
 	string directoryName = thisUrl.getLocation();
 	string fileName = thisUrl.getFile();
@@ -64,7 +72,7 @@
 	fileLocation += fileName;
 
 	// Get a parser
-	MboxParser boxParser(fileLocation, messageOffset);
+	MboxParser boxParser(fileLocation, messageOffset, partNum);
 	// The first document should be the message we are interested in
 	// FIXME: don't ignore the part number (p=...)
 	const Document *pMessage = boxParser.getDocument();

Modified: trunk/Utils/MboxParser.cpp
===================================================================
--- trunk/Utils/MboxParser.cpp	2006-10-06 14:45:04 UTC (rev 502)
+++ trunk/Utils/MboxParser.cpp	2006-10-06 16:38:23 UTC (rev 503)
@@ -24,7 +24,6 @@
 
 #include <gmime/gmime.h>
 
-#include "StringManip.h"
 #include "TimeConverter.h"
 #include "Url.h"
 #include "MboxParser.h"
@@ -32,14 +31,14 @@
 using std::cout;
 using std::endl;
 
-MboxParser::MboxParser(const string &fileName, off_t mboxOffset) :
+MboxParser::MboxParser(const string &fileName, off_t mboxOffset, int partNum) :
 	m_fileName(fileName),
 	m_fd(-1),
 	m_pMboxStream(NULL),
 	m_pParser(NULL),
 	m_pMimeMessage(NULL),
 	m_partsCount(-1),
-	m_partNum(-1),
+	m_partNum(partNum),
 	m_messageStart(mboxOffset),
 	m_pCurrentDocument(NULL),
 	m_messageDate(0)
@@ -252,7 +251,7 @@
 
 bool MboxParser::extractMessage(const string &subject)
 {
-	string fromLine, msgSubject(subject), contentType;
+	string msgSubject(subject), contentType;
 	char *pPart = NULL;
 	ssize_t partLength = 0;
 
@@ -279,13 +278,6 @@
 #endif
 			if (messageEnd > m_messageStart)
 			{
-				char *pFromLine = g_mime_parser_get_from(m_pParser);
-				if (pFromLine != NULL)
-				{
-					fromLine = pFromLine;
-					g_free(pFromLine);
-				}
-
 				// FIXME: this only applies to Mozilla
 				const char *pMozStatus = g_mime_message_get_header(m_pMimeMessage, "X-Mozilla-Status");
 				if (pMozStatus != NULL)
@@ -353,8 +345,6 @@
 					location += "&p=";
 					snprintf(posStr, 64, "%d", max(m_partNum, 0));
 					location += posStr;
-					location += "&h=";
-					location += StringManip::hashString(fromLine);
 #ifdef DEBUG
 					cout << "MboxParser::extractMessage: message location is " << location << endl;
 #endif

Modified: trunk/Utils/MboxParser.h
===================================================================
--- trunk/Utils/MboxParser.h	2006-10-06 14:45:04 UTC (rev 502)
+++ trunk/Utils/MboxParser.h	2006-10-06 16:38:23 UTC (rev 503)
@@ -41,7 +41,7 @@
 class MboxParser
 {
 	public:
-		MboxParser(const string &fileName, off_t mboxOffset = 0);
+		MboxParser(const string &fileName, off_t mboxOffset = 0, int partNum = -1);
 		virtual ~MboxParser();
 
 		/// Gets the current message's date.



From fabricecolin at mail.berlios.de  Thu Oct 12 16:53:28 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Thu, 12 Oct 2006 16:53:28 +0200
Subject: [Pinot-svn] r504 - in trunk/UI/GTK2: . src
Message-ID: <200610121453.k9CErSdY030090@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-12 16:53:26 +0200 (Thu, 12 Oct 2006)
New Revision: 504

Modified:
   trunk/UI/GTK2/metase-gtk2.glade
   trunk/UI/GTK2/src/prefsDialog_glade.cc
   trunk/UI/GTK2/src/prefsDialog_glade.hh
Log:
Move My Documents and My Email under one tab labelled "Indexing".


Modified: trunk/UI/GTK2/metase-gtk2.glade
===================================================================
--- trunk/UI/GTK2/metase-gtk2.glade	2006-10-06 16:38:23 UTC (rev 503)
+++ trunk/UI/GTK2/metase-gtk2.glade	2006-10-12 14:53:26 UTC (rev 504)
@@ -1693,42 +1693,7 @@
 		  <property name="fill">True</property>
 		</packing>
 	      </child>
-	    </widget>
-	    <packing>
-	      <property name="tab_expand">False</property>
-	      <property name="tab_fill">True</property>
-	    </packing>
-	  </child>
 
-	  <child>
-	    <widget class="GtkLabel" id="docsLabel">
-	      <property name="visible">True</property>
-	      <property name="label" translatable="yes">My Documents</property>
-	      <property name="use_underline">False</property>
-	      <property name="use_markup">False</property>
-	      <property name="justify">GTK_JUSTIFY_LEFT</property>
-	      <property name="wrap">False</property>
-	      <property name="selectable">False</property>
-	      <property name="xalign">0.5</property>
-	      <property name="yalign">0.5</property>
-	      <property name="xpad">0</property>
-	      <property name="ypad">0</property>
-	      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-	      <property name="width_chars">-1</property>
-	      <property name="single_line_mode">False</property>
-	      <property name="angle">0</property>
-	    </widget>
-	    <packing>
-	      <property name="type">tab</property>
-	    </packing>
-	  </child>
-
-	  <child>
-	    <widget class="GtkVBox" id="mailVbox">
-	      <property name="visible">True</property>
-	      <property name="homogeneous">False</property>
-	      <property name="spacing">0</property>
-
 	      <child>
 		<widget class="GtkLabel" id="mailAccountsLabel">
 		  <property name="visible">True</property>
@@ -1927,9 +1892,9 @@
 	  </child>
 
 	  <child>
-	    <widget class="GtkLabel" id="mailLabel">
+	    <widget class="GtkLabel" id="indexingLabel">
 	      <property name="visible">True</property>
-	      <property name="label" translatable="yes">My Email</property>
+	      <property name="label" translatable="yes">Indexing</property>
 	      <property name="use_underline">False</property>
 	      <property name="use_markup">False</property>
 	      <property name="justify">GTK_JUSTIFY_LEFT</property>
@@ -2100,351 +2065,15 @@
 	  </child>
 
 	  <child>
-	    <widget class="GtkNotebook" id="queryNotebook">
-	      <property agent="glademm" name="cxx_visibility">protected</property>
+	    <widget class="GtkHBox" id="queryHbox">
 	      <property name="visible">True</property>
-	      <property name="can_focus">True</property>
-	      <property name="show_tabs">True</property>
-	      <property name="show_border">True</property>
-	      <property name="tab_pos">GTK_POS_TOP</property>
-	      <property name="scrollable">False</property>
-	      <property name="enable_popup">False</property>
+	      <property name="homogeneous">False</property>
+	      <property name="spacing">0</property>
 
 	      <child>
-		<widget class="GtkVBox" id="termsVbox">
+		<widget class="GtkLabel" id="filterLabel">
 		  <property name="visible">True</property>
-		  <property name="homogeneous">False</property>
-		  <property name="spacing">0</property>
-
-		  <child>
-		    <widget class="GtkTable" id="tersmTable">
-		      <property name="visible">True</property>
-		      <property name="n_rows">6</property>
-		      <property name="n_columns">2</property>
-		      <property name="homogeneous">False</property>
-		      <property name="row_spacing">0</property>
-		      <property name="column_spacing">0</property>
-
-		      <child>
-			<widget class="GtkEntry" id="anyEntry">
-			  <property agent="glademm" name="cxx_visibility">protected</property>
-			  <property name="visible">True</property>
-			  <property name="can_focus">True</property>
-			  <property name="editable">True</property>
-			  <property name="visibility">True</property>
-			  <property name="max_length">0</property>
-			  <property name="text" translatable="yes"></property>
-			  <property name="has_frame">True</property>
-			  <property name="invisible_char">*</property>
-			  <property name="activates_default">False</property>
-			</widget>
-			<packing>
-			  <property name="left_attach">1</property>
-			  <property name="right_attach">2</property>
-			  <property name="top_attach">0</property>
-			  <property name="bottom_attach">1</property>
-			  <property name="x_padding">4</property>
-			  <property name="y_padding">4</property>
-			  <property name="y_options">fill</property>
-			</packing>
-		      </child>
-
-		      <child>
-			<widget class="GtkEntry" id="hostNameEntry">
-			  <property agent="glademm" name="cxx_visibility">protected</property>
-			  <property name="visible">True</property>
-			  <property name="can_focus">True</property>
-			  <property name="editable">True</property>
-			  <property name="visibility">True</property>
-			  <property name="max_length">0</property>
-			  <property name="text" translatable="yes"></property>
-			  <property name="has_frame">True</property>
-			  <property name="invisible_char">*</property>
-			  <property name="activates_default">False</property>
-			</widget>
-			<packing>
-			  <property name="left_attach">1</property>
-			  <property name="right_attach">2</property>
-			  <property name="top_attach">2</property>
-			  <property name="bottom_attach">3</property>
-			  <property name="x_padding">4</property>
-			  <property name="y_padding">4</property>
-			  <property name="y_options">fill</property>
-			</packing>
-		      </child>
-
-		      <child>
-			<widget class="GtkEntry" id="fileNameEntry">
-			  <property agent="glademm" name="cxx_visibility">protected</property>
-			  <property name="visible">True</property>
-			  <property name="can_focus">True</property>
-			  <property name="editable">True</property>
-			  <property name="visibility">True</property>
-			  <property name="max_length">0</property>
-			  <property name="text" translatable="yes"></property>
-			  <property name="has_frame">True</property>
-			  <property name="invisible_char">*</property>
-			  <property name="activates_default">False</property>
-			</widget>
-			<packing>
-			  <property name="left_attach">1</property>
-			  <property name="right_attach">2</property>
-			  <property name="top_attach">3</property>
-			  <property name="bottom_attach">4</property>
-			  <property name="x_padding">4</property>
-			  <property name="y_padding">4</property>
-			  <property name="y_options">fill</property>
-			</packing>
-		      </child>
-
-		      <child>
-			<widget class="GtkSpinButton" id="resultsCountSpinbutton">
-			  <property agent="glademm" name="cxx_visibility">protected</property>
-			  <property name="visible">True</property>
-			  <property name="can_focus">True</property>
-			  <property name="climb_rate">1</property>
-			  <property name="digits">0</property>
-			  <property name="numeric">False</property>
-			  <property name="update_policy">GTK_UPDATE_ALWAYS</property>
-			  <property name="snap_to_ticks">False</property>
-			  <property name="wrap">False</property>
-			  <property name="adjustment">10 10 100 10 20 20</property>
-			</widget>
-			<packing>
-			  <property name="left_attach">1</property>
-			  <property name="right_attach">2</property>
-			  <property name="top_attach">4</property>
-			  <property name="bottom_attach">5</property>
-			  <property name="x_padding">4</property>
-			  <property name="y_padding">4</property>
-			  <property name="y_options">fill</property>
-			</packing>
-		      </child>
-
-		      <child>
-			<widget class="GtkCheckButton" id="indexCheckbutton">
-			  <property agent="glademm" name="cxx_visibility">protected</property>
-			  <property name="visible">True</property>
-			  <property name="can_focus">True</property>
-			  <property name="label" translatable="yes">Index all results with label</property>
-			  <property name="use_underline">True</property>
-			  <property name="relief">GTK_RELIEF_NORMAL</property>
-			  <property name="focus_on_click">True</property>
-			  <property name="active">False</property>
-			  <property name="inconsistent">False</property>
-			  <property name="draw_indicator">True</property>
-			</widget>
-			<packing>
-			  <property name="left_attach">0</property>
-			  <property name="right_attach">1</property>
-			  <property name="top_attach">5</property>
-			  <property name="bottom_attach">6</property>
-			  <property name="x_padding">4</property>
-			  <property name="y_padding">4</property>
-			  <property name="x_options">fill</property>
-			  <property name="y_options">fill</property>
-			</packing>
-		      </child>
-
-		      <child>
-			<widget class="GtkLabel" id="anyLabel">
-			  <property name="visible">True</property>
-			  <property name="label" translatable="yes">Any of the words:</property>
-			  <property name="use_underline">False</property>
-			  <property name="use_markup">False</property>
-			  <property name="justify">GTK_JUSTIFY_LEFT</property>
-			  <property name="wrap">False</property>
-			  <property name="selectable">False</property>
-			  <property name="xalign">0</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">4</property>
-			  <property name="ypad">4</property>
-			  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-			  <property name="width_chars">-1</property>
-			  <property name="single_line_mode">False</property>
-			  <property name="angle">0</property>
-			</widget>
-			<packing>
-			  <property name="left_attach">0</property>
-			  <property name="right_attach">1</property>
-			  <property name="top_attach">0</property>
-			  <property name="bottom_attach">1</property>
-			  <property name="x_options">fill</property>
-			  <property name="y_options">fill</property>
-			</packing>
-		      </child>
-
-		      <child>
-			<widget class="GtkLabel" id="fileNameLabel">
-			  <property name="visible">True</property>
-			  <property name="label" translatable="yes">File name:</property>
-			  <property name="use_underline">False</property>
-			  <property name="use_markup">False</property>
-			  <property name="justify">GTK_JUSTIFY_LEFT</property>
-			  <property name="wrap">False</property>
-			  <property name="selectable">False</property>
-			  <property name="xalign">0</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">4</property>
-			  <property name="ypad">4</property>
-			  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-			  <property name="width_chars">-1</property>
-			  <property name="single_line_mode">False</property>
-			  <property name="angle">0</property>
-			</widget>
-			<packing>
-			  <property name="left_attach">0</property>
-			  <property name="right_attach">1</property>
-			  <property name="top_attach">3</property>
-			  <property name="bottom_attach">4</property>
-			  <property name="x_options">fill</property>
-			  <property name="y_options">fill</property>
-			</packing>
-		      </child>
-
-		      <child>
-			<widget class="GtkLabel" id="resultsCountLabel">
-			  <property name="visible">True</property>
-			  <property name="label" translatable="yes">Number of results:</property>
-			  <property name="use_underline">False</property>
-			  <property name="use_markup">False</property>
-			  <property name="justify">GTK_JUSTIFY_LEFT</property>
-			  <property name="wrap">False</property>
-			  <property name="selectable">False</property>
-			  <property name="xalign">0</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">4</property>
-			  <property name="ypad">4</property>
-			  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-			  <property name="width_chars">-1</property>
-			  <property name="single_line_mode">False</property>
-			  <property name="angle">0</property>
-			</widget>
-			<packing>
-			  <property name="left_attach">0</property>
-			  <property name="right_attach">1</property>
-			  <property name="top_attach">4</property>
-			  <property name="bottom_attach">5</property>
-			  <property name="x_options">fill</property>
-			  <property name="y_options">fill</property>
-			</packing>
-		      </child>
-
-		      <child>
-			<widget class="GtkComboBox" id="labelNameCombobox">
-			  <property agent="glademm" name="cxx_visibility">protected</property>
-			  <property name="visible">True</property>
-			  <property name="add_tearoffs">False</property>
-			  <property name="focus_on_click">True</property>
-			</widget>
-			<packing>
-			  <property name="left_attach">1</property>
-			  <property name="right_attach">2</property>
-			  <property name="top_attach">5</property>
-			  <property name="bottom_attach">6</property>
-			  <property name="x_padding">4</property>
-			  <property name="y_padding">4</property>
-			  <property name="y_options">fill</property>
-			</packing>
-		      </child>
-
-		      <child>
-			<widget class="GtkLabel" id="hostLabel">
-			  <property name="visible">True</property>
-			  <property name="label" translatable="yes">Host name:</property>
-			  <property name="use_underline">False</property>
-			  <property name="use_markup">False</property>
-			  <property name="justify">GTK_JUSTIFY_LEFT</property>
-			  <property name="wrap">False</property>
-			  <property name="selectable">False</property>
-			  <property name="xalign">0</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">4</property>
-			  <property name="ypad">4</property>
-			  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-			  <property name="width_chars">-1</property>
-			  <property name="single_line_mode">False</property>
-			  <property name="angle">0</property>
-			</widget>
-			<packing>
-			  <property name="left_attach">0</property>
-			  <property name="right_attach">1</property>
-			  <property name="top_attach">2</property>
-			  <property name="bottom_attach">3</property>
-			  <property name="x_options">fill</property>
-			  <property name="y_options">fill</property>
-			</packing>
-		      </child>
-
-		      <child>
-			<widget class="GtkLabel" id="notLabel">
-			  <property name="visible">True</property>
-			  <property name="label" translatable="yes">None of the words:</property>
-			  <property name="use_underline">False</property>
-			  <property name="use_markup">False</property>
-			  <property name="justify">GTK_JUSTIFY_LEFT</property>
-			  <property name="wrap">False</property>
-			  <property name="selectable">False</property>
-			  <property name="xalign">0</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">4</property>
-			  <property name="ypad">4</property>
-			  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-			  <property name="width_chars">-1</property>
-			  <property name="single_line_mode">False</property>
-			  <property name="angle">0</property>
-			</widget>
-			<packing>
-			  <property name="left_attach">0</property>
-			  <property name="right_attach">1</property>
-			  <property name="top_attach">1</property>
-			  <property name="bottom_attach">2</property>
-			  <property name="x_options">fill</property>
-			  <property name="y_options">fill</property>
-			</packing>
-		      </child>
-
-		      <child>
-			<widget class="GtkEntry" id="notEntry">
-			  <property agent="glademm" name="cxx_visibility">protected</property>
-			  <property name="visible">True</property>
-			  <property name="can_focus">True</property>
-			  <property name="editable">True</property>
-			  <property name="visibility">True</property>
-			  <property name="max_length">0</property>
-			  <property name="text" translatable="yes"></property>
-			  <property name="has_frame">True</property>
-			  <property name="invisible_char">*</property>
-			  <property name="activates_default">False</property>
-			</widget>
-			<packing>
-			  <property name="left_attach">1</property>
-			  <property name="right_attach">2</property>
-			  <property name="top_attach">1</property>
-			  <property name="bottom_attach">2</property>
-			  <property name="x_padding">4</property>
-			  <property name="y_padding">4</property>
-			  <property name="y_options">fill</property>
-			</packing>
-		      </child>
-		    </widget>
-		    <packing>
-		      <property name="padding">4</property>
-		      <property name="expand">False</property>
-		      <property name="fill">False</property>
-		    </packing>
-		  </child>
-		</widget>
-		<packing>
-		  <property name="tab_expand">False</property>
-		  <property name="tab_fill">True</property>
-		</packing>
-	      </child>
-
-	      <child>
-		<widget class="GtkLabel" id="commonLabel">
-		  <property name="visible">True</property>
-		  <property name="label" translatable="yes">All engines</property>
+		  <property name="label" translatable="yes">Filter:</property>
 		  <property name="use_underline">False</property>
 		  <property name="use_markup">False</property>
 		  <property name="justify">GTK_JUSTIFY_LEFT</property>
@@ -2452,273 +2081,121 @@
 		  <property name="selectable">False</property>
 		  <property name="xalign">0.5</property>
 		  <property name="yalign">0.5</property>
-		  <property name="xpad">0</property>
-		  <property name="ypad">0</property>
+		  <property name="xpad">4</property>
+		  <property name="ypad">4</property>
 		  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
 		  <property name="width_chars">-1</property>
 		  <property name="single_line_mode">False</property>
 		  <property name="angle">0</property>
 		</widget>
 		<packing>
-		  <property name="type">tab</property>
+		  <property name="padding">0</property>
+		  <property name="expand">False</property>
+		  <property name="fill">True</property>
 		</packing>
 	      </child>
 
 	      <child>
-		<widget class="GtkVBox" id="advancedVbox">
+		<widget class="GtkComboBox" id="filterCombobox">
+		  <property agent="glademm" name="cxx_visibility">protected</property>
 		  <property name="visible">True</property>
-		  <property name="homogeneous">False</property>
-		  <property name="spacing">0</property>
+		  <property name="items" translatable="yes">Language
+MIME Type
+Host Name
+Directory
+File Name
+Label</property>
+		  <property name="add_tearoffs">False</property>
+		  <property name="focus_on_click">True</property>
+		</widget>
+		<packing>
+		  <property name="padding">4</property>
+		  <property name="expand">True</property>
+		  <property name="fill">True</property>
+		</packing>
+	      </child>
 
-		  <child>
-		    <widget class="GtkLabel" id="filtersLabel">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">Limit to documents that match</property>
-		      <property name="use_underline">False</property>
-		      <property name="use_markup">False</property>
-		      <property name="justify">GTK_JUSTIFY_LEFT</property>
-		      <property name="wrap">False</property>
-		      <property name="selectable">False</property>
-		      <property name="xalign">0</property>
-		      <property name="yalign">0.5</property>
-		      <property name="xpad">4</property>
-		      <property name="ypad">4</property>
-		      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-		      <property name="width_chars">-1</property>
-		      <property name="single_line_mode">False</property>
-		      <property name="angle">0</property>
-		    </widget>
-		    <packing>
-		      <property name="padding">4</property>
-		      <property name="expand">False</property>
-		      <property name="fill">False</property>
-		    </packing>
-		  </child>
+	      <child>
+		<widget class="GtkButton" id="addFilterButton">
+		  <property name="visible">True</property>
+		  <property name="can_focus">True</property>
+		  <property name="label">gtk-add</property>
+		  <property name="use_stock">True</property>
+		  <property name="relief">GTK_RELIEF_NORMAL</property>
+		  <property name="focus_on_click">True</property>
+		</widget>
+		<packing>
+		  <property name="padding">4</property>
+		  <property name="expand">False</property>
+		  <property name="fill">True</property>
+		</packing>
+	      </child>
+	    </widget>
+	    <packing>
+	      <property name="padding">0</property>
+	      <property name="expand">True</property>
+	      <property name="fill">True</property>
+	    </packing>
+	  </child>
 
+	  <child>
+	    <widget class="GtkFrame" id="queryFrame">
+	      <property name="visible">True</property>
+	      <property name="label_xalign">0</property>
+	      <property name="label_yalign">0.5</property>
+	      <property name="shadow_type">GTK_SHADOW_NONE</property>
+
+	      <child>
+		<widget class="GtkAlignment" id="queryFrameAlignment">
+		  <property name="visible">True</property>
+		  <property name="xalign">0.5</property>
+		  <property name="yalign">0.5</property>
+		  <property name="xscale">1</property>
+		  <property name="yscale">1</property>
+		  <property name="top_padding">0</property>
+		  <property name="bottom_padding">0</property>
+		  <property name="left_padding">12</property>
+		  <property name="right_padding">0</property>
+
 		  <child>
-		    <widget class="GtkTable" id="advancedTable">
+		    <widget class="GtkScrolledWindow" id="queryScrolledwindow">
 		      <property name="visible">True</property>
-		      <property name="n_rows">4</property>
-		      <property name="n_columns">2</property>
-		      <property name="homogeneous">False</property>
-		      <property name="row_spacing">0</property>
-		      <property name="column_spacing">0</property>
+		      <property name="can_focus">True</property>
+		      <property name="hscrollbar_policy">GTK_POLICY_AUTOMATIC</property>
+		      <property name="vscrollbar_policy">GTK_POLICY_AUTOMATIC</property>
+		      <property name="shadow_type">GTK_SHADOW_IN</property>
+		      <property name="window_placement">GTK_CORNER_TOP_LEFT</property>
 
 		      <child>
-			<widget class="GtkEntry" id="phraseEntry">
-			  <property agent="glademm" name="cxx_visibility">protected</property>
+			<widget class="GtkTextView" id="queryTextview">
 			  <property name="visible">True</property>
 			  <property name="can_focus">True</property>
 			  <property name="editable">True</property>
-			  <property name="visibility">True</property>
-			  <property name="max_length">0</property>
+			  <property name="overwrite">False</property>
+			  <property name="accepts_tab">True</property>
+			  <property name="justification">GTK_JUSTIFY_LEFT</property>
+			  <property name="wrap_mode">GTK_WRAP_NONE</property>
+			  <property name="cursor_visible">True</property>
+			  <property name="pixels_above_lines">0</property>
+			  <property name="pixels_below_lines">0</property>
+			  <property name="pixels_inside_wrap">0</property>
+			  <property name="left_margin">0</property>
+			  <property name="right_margin">0</property>
+			  <property name="indent">0</property>
 			  <property name="text" translatable="yes"></property>
-			  <property name="has_frame">True</property>
-			  <property name="invisible_char">*</property>
-			  <property name="activates_default">False</property>
 			</widget>
-			<packing>
-			  <property name="left_attach">1</property>
-			  <property name="right_attach">2</property>
-			  <property name="top_attach">1</property>
-			  <property name="bottom_attach">2</property>
-			  <property name="x_padding">4</property>
-			  <property name="y_padding">4</property>
-			  <property name="y_options">fill</property>
-			</packing>
 		      </child>
-
-		      <child>
-			<widget class="GtkLabel" id="phraseLabel">
-			  <property name="visible">True</property>
-			  <property name="label" translatable="yes">the exact phrase:</property>
-			  <property name="use_underline">False</property>
-			  <property name="use_markup">False</property>
-			  <property name="justify">GTK_JUSTIFY_LEFT</property>
-			  <property name="wrap">False</property>
-			  <property name="selectable">False</property>
-			  <property name="xalign">0</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">4</property>
-			  <property name="ypad">4</property>
-			  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-			  <property name="width_chars">-1</property>
-			  <property name="single_line_mode">False</property>
-			  <property name="angle">0</property>
-			</widget>
-			<packing>
-			  <property name="left_attach">0</property>
-			  <property name="right_attach">1</property>
-			  <property name="top_attach">1</property>
-			  <property name="bottom_attach">2</property>
-			  <property name="x_options">fill</property>
-			  <property name="y_options">fill</property>
-			</packing>
-		      </child>
-
-		      <child>
-			<widget class="GtkLabel" id="languageLabel">
-			  <property name="visible">True</property>
-			  <property name="label" translatable="yes">the language:</property>
-			  <property name="use_underline">False</property>
-			  <property name="use_markup">False</property>
-			  <property name="justify">GTK_JUSTIFY_LEFT</property>
-			  <property name="wrap">False</property>
-			  <property name="selectable">False</property>
-			  <property name="xalign">0</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">4</property>
-			  <property name="ypad">4</property>
-			  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-			  <property name="width_chars">-1</property>
-			  <property name="single_line_mode">False</property>
-			  <property name="angle">0</property>
-			</widget>
-			<packing>
-			  <property name="left_attach">0</property>
-			  <property name="right_attach">1</property>
-			  <property name="top_attach">2</property>
-			  <property name="bottom_attach">3</property>
-			  <property name="x_options">fill</property>
-			  <property name="y_options">fill</property>
-			</packing>
-		      </child>
-
-		      <child>
-			<widget class="GtkComboBox" id="languageCombobox">
-			  <property agent="glademm" name="cxx_visibility">protected</property>
-			  <property name="visible">True</property>
-			  <property name="add_tearoffs">False</property>
-			  <property name="focus_on_click">True</property>
-			</widget>
-			<packing>
-			  <property name="left_attach">1</property>
-			  <property name="right_attach">2</property>
-			  <property name="top_attach">2</property>
-			  <property name="bottom_attach">3</property>
-			  <property name="x_padding">4</property>
-			  <property name="y_padding">4</property>
-			  <property name="y_options">fill</property>
-			</packing>
-		      </child>
-
-		      <child>
-			<widget class="GtkEntry" id="andEntry">
-			  <property agent="glademm" name="cxx_visibility">protected</property>
-			  <property name="visible">True</property>
-			  <property name="can_focus">True</property>
-			  <property name="editable">True</property>
-			  <property name="visibility">True</property>
-			  <property name="max_length">0</property>
-			  <property name="text" translatable="yes"></property>
-			  <property name="has_frame">True</property>
-			  <property name="invisible_char">*</property>
-			  <property name="activates_default">False</property>
-			</widget>
-			<packing>
-			  <property name="left_attach">1</property>
-			  <property name="right_attach">2</property>
-			  <property name="top_attach">0</property>
-			  <property name="bottom_attach">1</property>
-			  <property name="x_padding">4</property>
-			  <property name="y_padding">4</property>
-			  <property name="y_options">fill</property>
-			</packing>
-		      </child>
-
-		      <child>
-			<widget class="GtkLabel" id="andLabel">
-			  <property name="visible">True</property>
-			  <property name="label" translatable="yes">all the words:</property>
-			  <property name="use_underline">False</property>
-			  <property name="use_markup">False</property>
-			  <property name="justify">GTK_JUSTIFY_LEFT</property>
-			  <property name="wrap">False</property>
-			  <property name="selectable">False</property>
-			  <property name="xalign">0</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">4</property>
-			  <property name="ypad">4</property>
-			  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-			  <property name="width_chars">-1</property>
-			  <property name="single_line_mode">False</property>
-			  <property name="angle">0</property>
-			</widget>
-			<packing>
-			  <property name="left_attach">0</property>
-			  <property name="right_attach">1</property>
-			  <property name="top_attach">0</property>
-			  <property name="bottom_attach">1</property>
-			  <property name="x_options">fill</property>
-			  <property name="y_options">fill</property>
-			</packing>
-		      </child>
-
-		      <child>
-			<widget class="GtkLabel" id="labelLabel">
-			  <property name="visible">True</property>
-			  <property name="label" translatable="yes">the label:</property>
-			  <property name="use_underline">False</property>
-			  <property name="use_markup">False</property>
-			  <property name="justify">GTK_JUSTIFY_LEFT</property>
-			  <property name="wrap">False</property>
-			  <property name="selectable">False</property>
-			  <property name="xalign">0</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">4</property>
-			  <property name="ypad">4</property>
-			  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-			  <property name="width_chars">-1</property>
-			  <property name="single_line_mode">False</property>
-			  <property name="angle">0</property>
-			</widget>
-			<packing>
-			  <property name="left_attach">0</property>
-			  <property name="right_attach">1</property>
-			  <property name="top_attach">3</property>
-			  <property name="bottom_attach">4</property>
-			  <property name="x_options">fill</property>
-			  <property name="y_options">fill</property>
-			</packing>
-		      </child>
-
-		      <child>
-			<widget class="GtkComboBox" id="labelFilterCombobox">
-			  <property agent="glademm" name="cxx_visibility">protected</property>
-			  <property name="visible">True</property>
-			  <property name="add_tearoffs">False</property>
-			  <property name="focus_on_click">True</property>
-			</widget>
-			<packing>
-			  <property name="left_attach">1</property>
-			  <property name="right_attach">2</property>
-			  <property name="top_attach">3</property>
-			  <property name="bottom_attach">4</property>
-			  <property name="x_padding">4</property>
-			  <property name="y_padding">4</property>
-			  <property name="y_options">fill</property>
-			</packing>
-		      </child>
 		    </widget>
-		    <packing>
-		      <property name="padding">0</property>
-		      <property name="expand">False</property>
-		      <property name="fill">True</property>
-		    </packing>
 		  </child>
 		</widget>
-		<packing>
-		  <property name="tab_expand">False</property>
-		  <property name="tab_fill">True</property>
-		</packing>
 	      </child>
 
 	      <child>
-		<widget class="GtkLabel" id="advancedLabel">
+		<widget class="GtkLabel" id="queryFrameLabel">
 		  <property name="visible">True</property>
-		  <property name="label" translatable="yes">Indexes only</property>
+		  <property name="label" translatable="yes">Query Text</property>
 		  <property name="use_underline">False</property>
-		  <property name="use_markup">False</property>
+		  <property name="use_markup">True</property>
 		  <property name="justify">GTK_JUSTIFY_LEFT</property>
 		  <property name="wrap">False</property>
 		  <property name="selectable">False</property>
@@ -2732,11 +2209,70 @@
 		  <property name="angle">0</property>
 		</widget>
 		<packing>
-		  <property name="type">tab</property>
+		  <property name="type">label_item</property>
 		</packing>
 	      </child>
 	    </widget>
 	    <packing>
+	      <property name="padding">4</property>
+	      <property name="expand">True</property>
+	      <property name="fill">True</property>
+	    </packing>
+	  </child>
+
+	  <child>
+	    <widget class="GtkTable" id="tersmTable">
+	      <property name="visible">True</property>
+	      <property name="n_rows">1</property>
+	      <property name="n_columns">2</property>
+	      <property name="homogeneous">False</property>
+	      <property name="row_spacing">0</property>
+	      <property name="column_spacing">0</property>
+
+	      <child>
+		<widget class="GtkCheckButton" id="indexCheckbutton">
+		  <property agent="glademm" name="cxx_visibility">protected</property>
+		  <property name="visible">True</property>
+		  <property name="can_focus">True</property>
+		  <property name="label" translatable="yes">Index all results with label</property>
+		  <property name="use_underline">True</property>
+		  <property name="relief">GTK_RELIEF_NORMAL</property>
+		  <property name="focus_on_click">True</property>
+		  <property name="active">False</property>
+		  <property name="inconsistent">False</property>
+		  <property name="draw_indicator">True</property>
+		</widget>
+		<packing>
+		  <property name="left_attach">0</property>
+		  <property name="right_attach">1</property>
+		  <property name="top_attach">0</property>
+		  <property name="bottom_attach">1</property>
+		  <property name="x_padding">4</property>
+		  <property name="y_padding">4</property>
+		  <property name="x_options">fill</property>
+		  <property name="y_options">fill</property>
+		</packing>
+	      </child>
+
+	      <child>
+		<widget class="GtkComboBox" id="labelNameCombobox">
+		  <property agent="glademm" name="cxx_visibility">protected</property>
+		  <property name="visible">True</property>
+		  <property name="add_tearoffs">False</property>
+		  <property name="focus_on_click">True</property>
+		</widget>
+		<packing>
+		  <property name="left_attach">1</property>
+		  <property name="right_attach">2</property>
+		  <property name="top_attach">0</property>
+		  <property name="bottom_attach">1</property>
+		  <property name="x_padding">4</property>
+		  <property name="y_padding">4</property>
+		  <property name="y_options">fill</property>
+		</packing>
+	      </child>
+	    </widget>
+	    <packing>
 	      <property name="padding">0</property>
 	      <property name="expand">True</property>
 	      <property name="fill">True</property>

Modified: trunk/UI/GTK2/src/prefsDialog_glade.cc
===================================================================
--- trunk/UI/GTK2/src/prefsDialog_glade.cc	2006-10-06 16:38:23 UTC (rev 503)
+++ trunk/UI/GTK2/src/prefsDialog_glade.cc	2006-10-12 14:53:26 UTC (rev 504)
@@ -1,4 +1,4 @@
-// generated 2006/8/20 15:34:17 SGT by fabrice at amra.dyndns.org.(none)
+// generated 2006/10/12 22:44:57 SGT by fabrice at amra.dyndns.org.(none)
 // using glademm V2.12.1
 //
 // DO NOT EDIT THIS FILE ! It was created using
@@ -108,8 +108,6 @@
    
    Gtk::VButtonBox *directoriesVbuttonbox = Gtk::manage(new class Gtk::VButtonBox(Gtk::BUTTONBOX_START, 0));
    Gtk::HBox *directoriesHbox = Gtk::manage(new class Gtk::HBox(false, 0));
-   Gtk::VBox *directoriesVbox = Gtk::manage(new class Gtk::VBox(false, 0));
-   Gtk::Label *docsLabel = Gtk::manage(new class Gtk::Label(_("My Documents")));
    Gtk::Label *mailAccountsLabel = Gtk::manage(new class Gtk::Label(_("Mail boxes of type mbox can be monitored and indexed:")));
    mailTreeview = Gtk::manage(new class Gtk::TreeView());
    
@@ -124,8 +122,8 @@
    
    Gtk::VButtonBox *mailVbuttonbox = Gtk::manage(new class Gtk::VButtonBox(Gtk::BUTTONBOX_START, 0));
    Gtk::HBox *mailHbox = Gtk::manage(new class Gtk::HBox(false, 0));
-   Gtk::VBox *mailVbox = Gtk::manage(new class Gtk::VBox(false, 0));
-   Gtk::Label *mailLabel = Gtk::manage(new class Gtk::Label(_("My Email")));
+   Gtk::VBox *directoriesVbox = Gtk::manage(new class Gtk::VBox(false, 0));
+   Gtk::Label *indexingLabel = Gtk::manage(new class Gtk::Label(_("Indexing")));
    prefsNotebook = Gtk::manage(new class Gtk::Notebook());
    prefsCancelbutton->set_flags(Gtk::CAN_FOCUS);
    prefsCancelbutton->set_flags(Gtk::CAN_DEFAULT);
@@ -296,14 +294,6 @@
    directoriesVbuttonbox->pack_start(*removeDirectoryButton);
    directoriesHbox->pack_start(*directoriesScrolledwindow);
    directoriesHbox->pack_start(*directoriesVbuttonbox, Gtk::PACK_SHRINK, 0);
-   directoriesVbox->pack_start(*directoriesLabel, Gtk::PACK_SHRINK, 4);
-   directoriesVbox->pack_start(*directoriesHbox, Gtk::PACK_EXPAND_WIDGET, 4);
-   docsLabel->set_alignment(0.5,0.5);
-   docsLabel->set_padding(0,0);
-   docsLabel->set_justify(Gtk::JUSTIFY_LEFT);
-   docsLabel->set_line_wrap(false);
-   docsLabel->set_use_markup(false);
-   docsLabel->set_selectable(false);
    mailAccountsLabel->set_alignment(0,0.5);
    mailAccountsLabel->set_padding(4,4);
    mailAccountsLabel->set_justify(Gtk::JUSTIFY_LEFT);
@@ -350,14 +340,16 @@
    mailVbuttonbox->pack_start(*removeAccountButton);
    mailHbox->pack_start(*mailScrolledwindow);
    mailHbox->pack_start(*mailVbuttonbox, Gtk::PACK_SHRINK, 0);
-   mailVbox->pack_start(*mailAccountsLabel, Gtk::PACK_SHRINK, 4);
-   mailVbox->pack_start(*mailHbox, Gtk::PACK_EXPAND_WIDGET, 4);
-   mailLabel->set_alignment(0.5,0.5);
-   mailLabel->set_padding(0,0);
-   mailLabel->set_justify(Gtk::JUSTIFY_LEFT);
-   mailLabel->set_line_wrap(false);
-   mailLabel->set_use_markup(false);
-   mailLabel->set_selectable(false);
+   directoriesVbox->pack_start(*directoriesLabel, Gtk::PACK_SHRINK, 4);
+   directoriesVbox->pack_start(*directoriesHbox, Gtk::PACK_EXPAND_WIDGET, 4);
+   directoriesVbox->pack_start(*mailAccountsLabel, Gtk::PACK_SHRINK, 4);
+   directoriesVbox->pack_start(*mailHbox, Gtk::PACK_EXPAND_WIDGET, 4);
+   indexingLabel->set_alignment(0.5,0.5);
+   indexingLabel->set_padding(0,0);
+   indexingLabel->set_justify(Gtk::JUSTIFY_LEFT);
+   indexingLabel->set_line_wrap(false);
+   indexingLabel->set_use_markup(false);
+   indexingLabel->set_selectable(false);
    prefsNotebook->set_flags(Gtk::CAN_FOCUS);
    prefsNotebook->set_show_tabs(true);
    prefsNotebook->set_show_border(true);
@@ -367,10 +359,8 @@
    prefsNotebook->pages().back().set_tab_label_packing(false, true, Gtk::PACK_START);
    prefsNotebook->append_page(*labelsVbox, *labelsLabel);
    prefsNotebook->pages().back().set_tab_label_packing(false, true, Gtk::PACK_START);
-   prefsNotebook->append_page(*directoriesVbox, *docsLabel);
+   prefsNotebook->append_page(*directoriesVbox, *indexingLabel);
    prefsNotebook->pages().back().set_tab_label_packing(false, true, Gtk::PACK_START);
-   prefsNotebook->append_page(*mailVbox, *mailLabel);
-   prefsNotebook->pages().back().set_tab_label_packing(false, true, Gtk::PACK_START);
    prefsDialog->get_vbox()->set_homogeneous(false);
    prefsDialog->get_vbox()->set_spacing(0);
    prefsDialog->get_vbox()->pack_start(*prefsNotebook);
@@ -423,8 +413,6 @@
    removeDirectoryButton->show();
    directoriesVbuttonbox->show();
    directoriesHbox->show();
-   directoriesVbox->show();
-   docsLabel->show();
    mailAccountsLabel->show();
    mailTreeview->show();
    mailScrolledwindow->show();
@@ -437,8 +425,8 @@
    removeAccountButton->show();
    mailVbuttonbox->show();
    mailHbox->show();
-   mailVbox->show();
-   mailLabel->show();
+   directoriesVbox->show();
+   indexingLabel->show();
    prefsNotebook->show();
    prefsDialog->show();
    prefsOkbutton->signal_clicked().connect(SigC::slot(*this, &prefsDialog_glade::on_prefsOkbutton_clicked), false);

Modified: trunk/UI/GTK2/src/prefsDialog_glade.hh
===================================================================
--- trunk/UI/GTK2/src/prefsDialog_glade.hh	2006-10-06 16:38:23 UTC (rev 503)
+++ trunk/UI/GTK2/src/prefsDialog_glade.hh	2006-10-12 14:53:26 UTC (rev 504)
@@ -1,4 +1,4 @@
-// generated 2006/8/20 15:34:17 SGT by fabrice at amra.dyndns.org.(none)
+// generated 2006/10/12 22:44:57 SGT by fabrice at amra.dyndns.org.(none)
 // using glademm V2.12.1
 //
 // DO NOT EDIT THIS FILE ! It was created using



From fabricecolin at mail.berlios.de  Thu Oct 12 16:57:08 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Thu, 12 Oct 2006 16:57:08 +0200
Subject: [Pinot-svn] r505 - trunk
Message-ID: <200610121457.k9CEv8p2030402@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-12 16:57:08 +0200 (Thu, 12 Oct 2006)
New Revision: 505

Modified:
   trunk/pinot.spec.in
Log:
Better SuSE support, suggested by Marcus Rueckert <darix at web dot de>.


Modified: trunk/pinot.spec.in
===================================================================
--- trunk/pinot.spec.in	2006-10-12 14:53:26 UTC (rev 504)
+++ trunk/pinot.spec.in	2006-10-12 14:57:08 UTC (rev 505)
@@ -1,9 +1,15 @@
 # @configure_input@
-%if "%{_vendor}" == "suse"
+%if 0%{?suse_version}
+# SuSE
 %define pftotext_pkg xpdf-tools
 %define dbus_pkg dbus-1-glib
+%if 0%{?suse_version} > 1010
+%define dbus_dev_pkg dbus-1-glib-devel
+%else
 %define dbus_dev_pkg dbus-1-devel
+%endif
 %else
+# Fedora and anything else
 %define pftotext_pkg poppler-utils
 %define dbus_pkg dbus-glib
 %define dbus_dev_pkg dbus-devel
@@ -23,6 +29,7 @@
 BuildRequires: xapian-core-devel >= 0.9.4, libtextcat-devel >= 2.2, sqlite-devel >= 3.1.2, curl-devel >= 7.13, gmime-devel >= 2.1, boost-devel >= 1.32
 BuildRequires: gtkmm24-devel >= 2.6, libxml++-devel >= 2.12, %{dbus_dev_pkg} >= 0.60, gettext-devel, desktop-file-utils
 BuildRequires: taglib-devel >= 1.4
+BuildRequires: gcc-c++
 %if 0%{?_with_soap:1}
 BuildRequires: gsoap
 %endif
@@ -74,7 +81,7 @@
 %setup -q
 
 %build
-%configure %{?_with_soap:--with-soap=yes} %{?_with_debug:CXXFLAGS="-g -DDEBUG"}
+%configure %{?_with_soap:--with-soap=yes} %{?_with_debug:CXXFLAGS="%{optflags} -g -DDEBUG"}
 make
 
 %install



From fabricecolin at mail.berlios.de  Fri Oct 13 15:09:40 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Fri, 13 Oct 2006 15:09:40 +0200
Subject: [Pinot-svn] r506 - in trunk/UI/GTK2: . src
Message-ID: <200610131309.k9DD9eOM010637@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-13 15:09:39 +0200 (Fri, 13 Oct 2006)
New Revision: 506

Modified:
   trunk/UI/GTK2/metase-gtk2.glade
   trunk/UI/GTK2/src/prefsDialog.cc
   trunk/UI/GTK2/src/prefsDialog.hh
   trunk/UI/GTK2/src/prefsDialog_glade.cc
   trunk/UI/GTK2/src/prefsDialog_glade.hh
Log:
Removed Edit buttons from prefsDialog Indexing tab.


Modified: trunk/UI/GTK2/metase-gtk2.glade
===================================================================
--- trunk/UI/GTK2/metase-gtk2.glade	2006-10-12 14:57:08 UTC (rev 505)
+++ trunk/UI/GTK2/metase-gtk2.glade	2006-10-13 13:09:39 UTC (rev 506)
@@ -1556,7 +1556,6 @@
 			  <property name="fixed_height_mode">True</property>
 			  <property name="hover_selection">False</property>
 			  <property name="hover_expand">False</property>
-			  <signal name="button_press_event" handler="on_mailTreeview_button_press_event" last_modification_time="Sat, 19 Mar 2005 10:05:34 GMT"/>
 			</widget>
 		      </child>
 		    </widget>
@@ -1651,21 +1650,6 @@
 		      </child>
 
 		      <child>
-			<widget class="GtkButton" id="editDirectoryButton">
-			  <property name="border_width">4</property>
-			  <property agent="glademm" name="cxx_visibility">protected</property>
-			  <property name="visible">True</property>
-			  <property name="can_default">True</property>
-			  <property name="can_focus">True</property>
-			  <property name="label">gtk-edit</property>
-			  <property name="use_stock">True</property>
-			  <property name="relief">GTK_RELIEF_NORMAL</property>
-			  <property name="focus_on_click">True</property>
-			  <signal name="clicked" handler="on_editDirectoryButton_clicked" last_modification_time="Sun, 20 Aug 2006 07:34:03 GMT"/>
-			</widget>
-		      </child>
-
-		      <child>
 			<widget class="GtkButton" id="removeDirectoryButton">
 			  <property name="border_width">4</property>
 			  <property agent="glademm" name="cxx_visibility">protected</property>
@@ -1747,7 +1731,6 @@
 			  <property name="fixed_height_mode">True</property>
 			  <property name="hover_selection">False</property>
 			  <property name="hover_expand">False</property>
-			  <signal name="button_press_event" handler="on_mailTreeview_button_press_event" last_modification_time="Sat, 19 Mar 2005 10:05:34 GMT"/>
 			</widget>
 		      </child>
 		    </widget>
@@ -1842,21 +1825,6 @@
 		      </child>
 
 		      <child>
-			<widget class="GtkButton" id="editAccountButton">
-			  <property name="border_width">4</property>
-			  <property agent="glademm" name="cxx_visibility">protected</property>
-			  <property name="visible">True</property>
-			  <property name="can_default">True</property>
-			  <property name="can_focus">True</property>
-			  <property name="label">gtk-edit</property>
-			  <property name="use_stock">True</property>
-			  <property name="relief">GTK_RELIEF_NORMAL</property>
-			  <property name="focus_on_click">True</property>
-			  <signal name="clicked" handler="on_editAccountButton_clicked" last_modification_time="Fri, 02 Sep 2005 21:58:38 GMT"/>
-			</widget>
-		      </child>
-
-		      <child>
 			<widget class="GtkButton" id="removeAccountButton">
 			  <property name="border_width">4</property>
 			  <property agent="glademm" name="cxx_visibility">protected</property>

Modified: trunk/UI/GTK2/src/prefsDialog.cc
===================================================================
--- trunk/UI/GTK2/src/prefsDialog.cc	2006-10-12 14:57:08 UTC (rev 505)
+++ trunk/UI/GTK2/src/prefsDialog.cc	2006-10-13 13:09:39 UTC (rev 506)
@@ -114,7 +114,7 @@
 	const set<string> &labels = m_settings.getLabels();
 	if (labels.empty() == true)
 	{
-		// These buttons will stay disabled until labels are added to the list
+		// This button will stay disabled until labels are added to the list
 		removeLabelButton->set_sensitive(false);
 		return;
 	}
@@ -183,8 +183,7 @@
 
 	if (m_settings.m_indexableLocations.empty() == true)
 	{
-		// These buttons will stay disabled until directories are added to the list
-		editDirectoryButton->set_sensitive(false);
+		// This button will stay disabled until directories are added to the list
 		removeDirectoryButton->set_sensitive(false);
 		return;
 	}
@@ -201,7 +200,6 @@
 		row[m_directoriesColumns.m_location] = dirIter->m_name;
 	}
 
-	editDirectoryButton->set_sensitive(true);
 	removeDirectoryButton->set_sensitive(true);
 }
 
@@ -254,8 +252,7 @@
 
 	if (m_settings.m_mailAccounts.empty() == true)
 	{
-		// These buttons will stay disabled until mail is added to the list
-		editAccountButton->set_sensitive(false);
+		// This button will stay disabled until mail is added to the list
 		removeAccountButton->set_sensitive(false);
 		return;
 	}
@@ -273,7 +270,6 @@
 		row[m_mailColumns.m_mTime] = mailIter->m_modTime;
 	}
 
-	editAccountButton->set_sensitive(true);
 	removeAccountButton->set_sensitive(true);
 }
 
@@ -360,7 +356,7 @@
 	// This marks the label as new
 	row[m_labelsColumns.m_enabled] = false;
 
-	// Enable these buttons
+	// Enable this button
 	removeLabelButton->set_sensitive(true);
 }
 
@@ -384,23 +380,12 @@
 		TreeModel::Children children = m_refLabelsTree->children();
 		if (children.empty() == true)
 		{
-			// Disable these buttons
+			// Disable this button
 			removeLabelButton->set_sensitive(false);
 		}
 	}
 }
 
-bool prefsDialog::on_mailTreeview_button_press_event(GdkEventButton *ev)
-{
-	// Check for double clicks
-	if (ev->type == GDK_2BUTTON_PRESS)
-	{
-		on_editAccountButton_clicked();
-	}
-
-	return false;
-}
-
 void prefsDialog::on_addDirectoryButton_clicked()
 {
 	ustring dirName;
@@ -423,29 +408,12 @@
 
 		if (wasEmpty == true)
 		{
-			// Enable these buttons
-			editDirectoryButton->set_sensitive(true);
+			// Enable this button
 			removeDirectoryButton->set_sensitive(true);
 		}
 	}
 }
 
-void prefsDialog::on_editDirectoryButton_clicked()
-{
-	// Get the selected directory in the list
-	TreeModel::iterator iter = directoriesTreeview->get_selection()->get_selected();
-	if (iter)
-	{
-		TreeModel::Row row = *iter;
-		ustring dirName = row[m_directoriesColumns.m_location];
-		// Let the user edit the location
-		if (select_file_name(*this, _("Directory to index"), dirName, true, true) == true)
-		{
-			row[m_directoriesColumns.m_location] = dirName;
-		}
-	}
-}
-
 void prefsDialog::on_removeDirectoryButton_clicked()
 {
 	// Get the selected directory in the list
@@ -470,8 +438,7 @@
 		TreeModel::Children children = m_refDirectoriesTree->children();
 		if (children.empty() == true)
 		{
-			// Disable these buttons
-			editDirectoryButton->set_sensitive(false);
+			// Disable this button
 			removeDirectoryButton->set_sensitive(false);
 		}
 	}
@@ -503,29 +470,12 @@
 
 		if (wasEmpty == true)
 		{
-			// Enable these buttons
-			editAccountButton->set_sensitive(true);
+			// Enable this button
 			removeAccountButton->set_sensitive(true);
 		}
 	}
 }
 
-void prefsDialog::on_editAccountButton_clicked()
-{
-	// Get the selected mail account in the list
-	TreeModel::iterator iter = mailTreeview->get_selection()->get_selected();
-	if (iter)
-	{
-		TreeModel::Row row = *iter;
-		ustring fileName = row[m_mailColumns.m_location];
-		// Let the user edit the location
-		if (select_file_name(*this, _("Mbox File Location"), fileName, true) == true)
-		{
-			row[m_mailColumns.m_location] = fileName;
-		}
-	}
-}
-
 void prefsDialog::on_removeAccountButton_clicked()
 {
 	// Get the selected mail account in the list
@@ -550,8 +500,7 @@
 		TreeModel::Children children = m_refMailTree->children();
 		if (children.empty() == true)
 		{
-			// Disable these buttons
-			editAccountButton->set_sensitive(false);
+			// Disable this button
 			removeAccountButton->set_sensitive(false);
 		}
 	}

Modified: trunk/UI/GTK2/src/prefsDialog.hh
===================================================================
--- trunk/UI/GTK2/src/prefsDialog.hh	2006-10-12 14:57:08 UTC (rev 505)
+++ trunk/UI/GTK2/src/prefsDialog.hh	2006-10-13 13:09:39 UTC (rev 506)
@@ -42,12 +42,9 @@
 	virtual void on_prefsOkbutton_clicked();
 	virtual void on_addLabelButton_clicked();
 	virtual void on_removeLabelButton_clicked();
-	virtual bool on_mailTreeview_button_press_event(GdkEventButton *ev);
 	virtual void on_addDirectoryButton_clicked();
-	virtual void on_editDirectoryButton_clicked();
 	virtual void on_removeDirectoryButton_clicked();
 	virtual void on_addAccountButton_clicked();
-	virtual void on_editAccountButton_clicked();
 	virtual void on_removeAccountButton_clicked();
 
 	void populate_labelsTreeview();

Modified: trunk/UI/GTK2/src/prefsDialog_glade.cc
===================================================================
--- trunk/UI/GTK2/src/prefsDialog_glade.cc	2006-10-12 14:57:08 UTC (rev 505)
+++ trunk/UI/GTK2/src/prefsDialog_glade.cc	2006-10-13 13:09:39 UTC (rev 506)
@@ -1,4 +1,4 @@
-// generated 2006/10/12 22:44:57 SGT by fabrice at amra.dyndns.org.(none)
+// generated 2006/10/13 21:02:13 SGT by fabrice at amra.dyndns.org.(none)
 // using glademm V2.12.1
 //
 // DO NOT EDIT THIS FILE ! It was created using
@@ -103,7 +103,6 @@
    Gtk::HBox *hbox54 = Gtk::manage(new class Gtk::HBox(false, 2));
    Gtk::Alignment *alignment35 = Gtk::manage(new class Gtk::Alignment(0.5, 0.5, 0, 0));
    addDirectoryButton = Gtk::manage(new class Gtk::Button());
-   editDirectoryButton = Gtk::manage(new class Gtk::Button(Gtk::StockID("gtk-edit")));
    removeDirectoryButton = Gtk::manage(new class Gtk::Button(Gtk::StockID("gtk-remove")));
    
    Gtk::VButtonBox *directoriesVbuttonbox = Gtk::manage(new class Gtk::VButtonBox(Gtk::BUTTONBOX_START, 0));
@@ -117,7 +116,6 @@
    Gtk::HBox *hbox42 = Gtk::manage(new class Gtk::HBox(false, 2));
    Gtk::Alignment *alignment28 = Gtk::manage(new class Gtk::Alignment(0.5, 0.5, 0, 0));
    addAccountButton = Gtk::manage(new class Gtk::Button());
-   editAccountButton = Gtk::manage(new class Gtk::Button(Gtk::StockID("gtk-edit")));
    removeAccountButton = Gtk::manage(new class Gtk::Button(Gtk::StockID("gtk-remove")));
    
    Gtk::VButtonBox *mailVbuttonbox = Gtk::manage(new class Gtk::VButtonBox(Gtk::BUTTONBOX_START, 0));
@@ -281,16 +279,11 @@
    addDirectoryButton->set_border_width(4);
    addDirectoryButton->set_relief(Gtk::RELIEF_NORMAL);
    addDirectoryButton->add(*alignment35);
-   editDirectoryButton->set_flags(Gtk::CAN_FOCUS);
-   editDirectoryButton->set_flags(Gtk::CAN_DEFAULT);
-   editDirectoryButton->set_border_width(4);
-   editDirectoryButton->set_relief(Gtk::RELIEF_NORMAL);
    removeDirectoryButton->set_flags(Gtk::CAN_FOCUS);
    removeDirectoryButton->set_flags(Gtk::CAN_DEFAULT);
    removeDirectoryButton->set_border_width(4);
    removeDirectoryButton->set_relief(Gtk::RELIEF_NORMAL);
    directoriesVbuttonbox->pack_start(*addDirectoryButton);
-   directoriesVbuttonbox->pack_start(*editDirectoryButton);
    directoriesVbuttonbox->pack_start(*removeDirectoryButton);
    directoriesHbox->pack_start(*directoriesScrolledwindow);
    directoriesHbox->pack_start(*directoriesVbuttonbox, Gtk::PACK_SHRINK, 0);
@@ -327,16 +320,11 @@
    addAccountButton->set_border_width(4);
    addAccountButton->set_relief(Gtk::RELIEF_NORMAL);
    addAccountButton->add(*alignment28);
-   editAccountButton->set_flags(Gtk::CAN_FOCUS);
-   editAccountButton->set_flags(Gtk::CAN_DEFAULT);
-   editAccountButton->set_border_width(4);
-   editAccountButton->set_relief(Gtk::RELIEF_NORMAL);
    removeAccountButton->set_flags(Gtk::CAN_FOCUS);
    removeAccountButton->set_flags(Gtk::CAN_DEFAULT);
    removeAccountButton->set_border_width(4);
    removeAccountButton->set_relief(Gtk::RELIEF_NORMAL);
    mailVbuttonbox->pack_start(*addAccountButton);
-   mailVbuttonbox->pack_start(*editAccountButton);
    mailVbuttonbox->pack_start(*removeAccountButton);
    mailHbox->pack_start(*mailScrolledwindow);
    mailHbox->pack_start(*mailVbuttonbox, Gtk::PACK_SHRINK, 0);
@@ -409,7 +397,6 @@
    hbox54->show();
    alignment35->show();
    addDirectoryButton->show();
-   editDirectoryButton->show();
    removeDirectoryButton->show();
    directoriesVbuttonbox->show();
    directoriesHbox->show();
@@ -421,7 +408,6 @@
    hbox42->show();
    alignment28->show();
    addAccountButton->show();
-   editAccountButton->show();
    removeAccountButton->show();
    mailVbuttonbox->show();
    mailHbox->show();
@@ -432,13 +418,9 @@
    prefsOkbutton->signal_clicked().connect(SigC::slot(*this, &prefsDialog_glade::on_prefsOkbutton_clicked), false);
    addLabelButton->signal_clicked().connect(SigC::slot(*this, &prefsDialog_glade::on_addLabelButton_clicked), false);
    removeLabelButton->signal_clicked().connect(SigC::slot(*this, &prefsDialog_glade::on_removeLabelButton_clicked), false);
-   directoriesTreeview->signal_button_press_event().connect(SigC::slot(*this, &prefsDialog_glade::on_mailTreeview_button_press_event), false);
    addDirectoryButton->signal_clicked().connect(SigC::slot(*this, &prefsDialog_glade::on_addDirectoryButton_clicked), false);
-   editDirectoryButton->signal_clicked().connect(SigC::slot(*this, &prefsDialog_glade::on_editDirectoryButton_clicked), false);
    removeDirectoryButton->signal_clicked().connect(SigC::slot(*this, &prefsDialog_glade::on_removeDirectoryButton_clicked), false);
-   mailTreeview->signal_button_press_event().connect(SigC::slot(*this, &prefsDialog_glade::on_mailTreeview_button_press_event), false);
    addAccountButton->signal_clicked().connect(SigC::slot(*this, &prefsDialog_glade::on_addAccountButton_clicked), false);
-   editAccountButton->signal_clicked().connect(SigC::slot(*this, &prefsDialog_glade::on_editAccountButton_clicked), false);
    removeAccountButton->signal_clicked().connect(SigC::slot(*this, &prefsDialog_glade::on_removeAccountButton_clicked), false);
 }
 

Modified: trunk/UI/GTK2/src/prefsDialog_glade.hh
===================================================================
--- trunk/UI/GTK2/src/prefsDialog_glade.hh	2006-10-12 14:57:08 UTC (rev 505)
+++ trunk/UI/GTK2/src/prefsDialog_glade.hh	2006-10-13 13:09:39 UTC (rev 506)
@@ -1,4 +1,4 @@
-// generated 2006/10/12 22:44:57 SGT by fabrice at amra.dyndns.org.(none)
+// generated 2006/10/13 21:02:13 SGT by fabrice at amra.dyndns.org.(none)
 // using glademm V2.12.1
 //
 // DO NOT EDIT THIS FILE ! It was created using
@@ -59,11 +59,9 @@
         class Gtk::Button * removeLabelButton;
         class Gtk::TreeView * directoriesTreeview;
         class Gtk::Button * addDirectoryButton;
-        class Gtk::Button * editDirectoryButton;
         class Gtk::Button * removeDirectoryButton;
         class Gtk::TreeView * mailTreeview;
         class Gtk::Button * addAccountButton;
-        class Gtk::Button * editAccountButton;
         class Gtk::Button * removeAccountButton;
         class Gtk::Notebook * prefsNotebook;
         
@@ -74,12 +72,9 @@
         virtual void on_prefsOkbutton_clicked() = 0;
         virtual void on_addLabelButton_clicked() = 0;
         virtual void on_removeLabelButton_clicked() = 0;
-        virtual bool on_mailTreeview_button_press_event(GdkEventButton *ev) = 0;
         virtual void on_addDirectoryButton_clicked() = 0;
-        virtual void on_editDirectoryButton_clicked() = 0;
         virtual void on_removeDirectoryButton_clicked() = 0;
         virtual void on_addAccountButton_clicked() = 0;
-        virtual void on_editAccountButton_clicked() = 0;
         virtual void on_removeAccountButton_clicked() = 0;
 };
 #endif



From fabricecolin at mail.berlios.de  Fri Oct 13 15:12:12 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Fri, 13 Oct 2006 15:12:12 +0200
Subject: [Pinot-svn] r507 - trunk/UI/GTK2/src
Message-ID: <200610131312.k9DDCCNV010955@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-13 15:12:12 +0200 (Fri, 13 Oct 2006)
New Revision: 507

Modified:
   trunk/UI/GTK2/src/mainWindow.cc
   trunk/UI/GTK2/src/mainWindow.hh
Log:
Fixed warnings.


Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2006-10-13 13:09:39 UTC (rev 506)
+++ trunk/UI/GTK2/src/mainWindow.cc	2006-10-13 13:12:12 UTC (rev 507)
@@ -80,7 +80,8 @@
 // Constructor
 //
 mainWindow::mainWindow() :
-	m_settings(PinotSettings::getInstance()), mainWindow_glade(),
+	mainWindow_glade(),
+	m_settings(PinotSettings::getInstance()),
 	m_pEnginesTree(NULL),
 	m_pNotebook(NULL),
 	m_pIndexMenu(NULL),
@@ -768,7 +769,7 @@
 		show_global_menuitems(showResultsMenuitems);
 		show_selectionbased_menuitems(false);
 	}
-	m_state.m_currentPage = (int)p1;
+	m_state.m_currentPage = p1;
 }
 
 //
@@ -886,9 +887,6 @@
 	else if (type == "QueryingThread")
 	{
 		std::map<string, TreeModel::iterator> updatedGroups;
-		unsigned int count = 0;
-		ResultsModelColumns::ResultType rootType;
-		bool mergeDuplicates = false;
 		int pageNum = -1;
 
 		QueryingThread *pQueryThread = dynamic_cast<QueryingThread *>(pThread);
@@ -1614,8 +1612,6 @@
 //
 void mainWindow::on_groupresults_activate()
 {
-	ResultsModelColumns::ResultType currentType, newType;
-
 	// What's the new grouping criteria ?
 	NotebookPageBox *pNotebookPage = get_current_page();
 	if (pNotebookPage != NULL)

Modified: trunk/UI/GTK2/src/mainWindow.hh
===================================================================
--- trunk/UI/GTK2/src/mainWindow.hh	2006-10-13 13:09:39 UTC (rev 506)
+++ trunk/UI/GTK2/src/mainWindow.hh	2006-10-13 13:12:12 UTC (rev 507)
@@ -170,7 +170,7 @@
 			// Query
 			unsigned int m_liveQueryLength;
 			// Notebook pages
-			int m_currentPage;
+			unsigned int m_currentPage;
 			// Current actions
 			bool m_browsingIndex;
 



From fabricecolin at mail.berlios.de  Sat Oct 14 06:23:26 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 14 Oct 2006 06:23:26 +0200
Subject: [Pinot-svn] r508 - trunk/Utils
Message-ID: <200610140423.k9E4NQQX011619@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-14 06:23:26 +0200 (Sat, 14 Oct 2006)
New Revision: 508

Modified:
   trunk/Utils/StringManip.cpp
   trunk/Utils/StringManip.h
Log:
Modified extractField() method a bit.


Modified: trunk/Utils/StringManip.cpp
===================================================================
--- trunk/Utils/StringManip.cpp	2006-10-13 13:12:12 UTC (rev 507)
+++ trunk/Utils/StringManip.cpp	2006-10-14 04:23:26 UTC (rev 508)
@@ -63,15 +63,15 @@
 }
 
 /// Extracts the sub-string between start and end.
-string StringManip::extractField(const string &str, const string &start, const string &end)
+string StringManip::extractField(const string &str, const string &start, const string &end, bool anyCharacterOfEnd)
 {
 	string::size_type endPos = 0;
 
-	return extractField(str, start, end, endPos);
+	return extractField(str, start, end, endPos, anyCharacterOfEnd);
 }
 
 /// Extracts the sub-string between start and end.
-string StringManip::extractField(const string &str, const string &start, const string &end, string::size_type &endPos)
+string StringManip::extractField(const string &str, const string &start, const string &end, string::size_type &endPos, bool anyCharacterOfEnd)
 {
 	string fieldValue;
 	string::size_type startPos = string::npos;
@@ -95,7 +95,14 @@
 		}
 		else
 		{
-			endPos = str.find(end, startPos);
+			if (anyCharacterOfEnd == false)
+			{
+				endPos = str.find(end, startPos);
+			}
+			else
+			{
+				endPos = str.find_first_of(end, startPos);
+			}
 			if (endPos != string::npos)
 			{
 				fieldValue = str.substr(startPos, endPos - startPos);

Modified: trunk/Utils/StringManip.h
===================================================================
--- trunk/Utils/StringManip.h	2006-10-13 13:12:12 UTC (rev 507)
+++ trunk/Utils/StringManip.h	2006-10-14 04:23:26 UTC (rev 508)
@@ -27,11 +27,11 @@
 
 		/// Extracts the sub-string between start and end.
 		static std::string extractField(const std::string &str, const std::string &start,
-			const std::string &end);
+			const std::string &end, bool anyCharacterOfEnd = false);
 
 		/// Extracts the sub-string between start and end.
 		static std::string extractField(const std::string &str, const std::string &start,
-			const std::string &end, std::string::size_type &endPos);
+			const std::string &end, std::string::size_type &endPos, bool anyCharacterOfEnd = false);
 
 		/// Replaces entities.
 		static std::string replaceEntities(const std::string &str);



From fabricecolin at mail.berlios.de  Sat Oct 14 06:41:32 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 14 Oct 2006 06:41:32 +0200
Subject: [Pinot-svn] r510 - in trunk: Collect Index Search UI/GTK2/src
Message-ID: <200610140441.k9E4fW4O010915@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-14 06:41:32 +0200 (Sat, 14 Oct 2006)
New Revision: 510

Modified:
   trunk/Collect/pinot-collect.1
   trunk/Index/pinot-index.1
   trunk/Search/pinot-search.1
   trunk/Search/pinot-search.cpp
   trunk/UI/GTK2/src/pinot-dbus-daemon.1
   trunk/UI/GTK2/src/pinot.1
Log:
Previous check-in should have included pinot-search.cpp.
Updated man pages.


Modified: trunk/Collect/pinot-collect.1
===================================================================
--- trunk/Collect/pinot-collect.1	2006-10-14 04:40:11 UTC (rev 509)
+++ trunk/Collect/pinot-collect.1	2006-10-14 04:41:32 UTC (rev 510)
@@ -1,5 +1,5 @@
 .\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.36.
-.TH PINOT-COLLECT "1" "September 2006" "pinot-collect - pinot 0.60" "User Commands"
+.TH PINOT-COLLECT "1" "October 2006" "pinot-collect - pinot 0.60" "User Commands"
 .SH NAME
 pinot-collect \- Download an URL from the command-line
 .SH SYNOPSIS

Modified: trunk/Index/pinot-index.1
===================================================================
--- trunk/Index/pinot-index.1	2006-10-14 04:40:11 UTC (rev 509)
+++ trunk/Index/pinot-index.1	2006-10-14 04:41:32 UTC (rev 510)
@@ -1,5 +1,5 @@
 .\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.36.
-.TH PINOT-INDEX "1" "September 2006" "pinot-index - pinot 0.60" "User Commands"
+.TH PINOT-INDEX "1" "October 2006" "pinot-index - pinot 0.60" "User Commands"
 .SH NAME
 pinot-index \- Index documents from the command-line
 .SH SYNOPSIS

Modified: trunk/Search/pinot-search.1
===================================================================
--- trunk/Search/pinot-search.1	2006-10-14 04:40:11 UTC (rev 509)
+++ trunk/Search/pinot-search.1	2006-10-14 04:41:32 UTC (rev 510)
@@ -1,5 +1,5 @@
 .\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.36.
-.TH PINOT-SEARCH "1" "September 2006" "pinot-search - pinot 0.60" "User Commands"
+.TH PINOT-SEARCH "1" "October 2006" "pinot-search - pinot 0.60" "User Commands"
 .SH NAME
 pinot-search \- Query search engines from the command-line
 .SH SYNOPSIS

Modified: trunk/Search/pinot-search.cpp
===================================================================
--- trunk/Search/pinot-search.cpp	2006-10-14 04:40:11 UTC (rev 509)
+++ trunk/Search/pinot-search.cpp	2006-10-14 04:41:32 UTC (rev 510)
@@ -71,7 +71,7 @@
 					<< "pinot-search opensearch " << PREFIX << "/share/pinot/engines/KrustyDescription.xml \"clowns\" 10\n\n"
 					<< "pinot-search sherlock " << PREFIX << "/share/pinot/engines/Bozo.src \"clowns\" 10\n\n"
 					<< "pinot-search xapian ~/.pinot/index \"clowns\" 10\n\n"
-					<< "pinot-search xapian somehostname:12345 \"clowns\" 10\n\n\n"
+					<< "pinot-search xapian somehostname:12345 \"clowns\" 10\n\n"
 					<< "Report bugs to " << PACKAGE_BUGREPORT << endl;
 				return EXIT_SUCCESS;
 			case 'v':
@@ -117,7 +117,7 @@
 	unsigned int count = atoi(argv[4]);
 	pEngine->setMaxResultsCount(count);
 
-	QueryProperties queryProps("senginetest", argv[3], "", "", "");
+	QueryProperties queryProps("senginetest", argv[3]);
 	if (pEngine->runQuery(queryProps) == true)
 	{
 		string resultsPage;

Modified: trunk/UI/GTK2/src/pinot-dbus-daemon.1
===================================================================
--- trunk/UI/GTK2/src/pinot-dbus-daemon.1	2006-10-14 04:40:11 UTC (rev 509)
+++ trunk/UI/GTK2/src/pinot-dbus-daemon.1	2006-10-14 04:41:32 UTC (rev 510)
@@ -1,5 +1,5 @@
 .\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.36.
-.TH PINOT-DBUS-DAEMON "1" "September 2006" "pinot-dbus-daemon - pinot 0.60" "User Commands"
+.TH PINOT-DBUS-DAEMON "1" "October 2006" "pinot-dbus-daemon - pinot 0.60" "User Commands"
 .SH NAME
 pinot-dbus-daemon \- D-Bus search and index daemon
 .SH SYNOPSIS

Modified: trunk/UI/GTK2/src/pinot.1
===================================================================
--- trunk/UI/GTK2/src/pinot.1	2006-10-14 04:40:11 UTC (rev 509)
+++ trunk/UI/GTK2/src/pinot.1	2006-10-14 04:41:32 UTC (rev 510)
@@ -1,5 +1,5 @@
 .\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.36.
-.TH PINOT "1" "September 2006" "pinot - pinot 0.60" "User Commands"
+.TH PINOT "1" "October 2006" "pinot - pinot 0.60" "User Commands"
 .SH NAME
 pinot \- A metasearch tool for the Free Desktop
 .SH SYNOPSIS



From fabricecolin at mail.berlios.de  Sat Oct 14 06:40:13 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 14 Oct 2006 06:40:13 +0200
Subject: [Pinot-svn] r509 - in trunk: Search Search/Google UI/GTK2
	UI/GTK2/src
Message-ID: <200610140440.k9E4eDmb008441@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-14 06:40:11 +0200 (Sat, 14 Oct 2006)
New Revision: 509

Modified:
   trunk/Search/Google/GoogleAPIEngine.cpp
   trunk/Search/PluginWebEngine.cpp
   trunk/Search/QueryProperties.cpp
   trunk/Search/QueryProperties.h
   trunk/Search/XapianEngine.cpp
   trunk/Search/XapianEngine.h
   trunk/UI/GTK2/metase-gtk2.glade
   trunk/UI/GTK2/src/PinotSettings.cpp
   trunk/UI/GTK2/src/mainWindow.cc
   trunk/UI/GTK2/src/pinot-dbus-daemon.cc
   trunk/UI/GTK2/src/queryDialog.cc
   trunk/UI/GTK2/src/queryDialog.hh
   trunk/UI/GTK2/src/queryDialog_glade.cc
   trunk/UI/GTK2/src/queryDialog_glade.hh
Log:
Extensive modifications to enable using Xapian::QueryParser and get rid of the
straight-jacket of AND/OR/NOT/Phrase.
The live and stored queries in the UI as well as SimpleSearch's searchText can
be free queries mixing search terms and any number of filters, eg :
"type:text/html and lang:en and (tcp near ip)"
The downsides are that the host and file filters no longer apply to plugins
or the Google SOAP API engine, and that generated abstracts are pretty much
useless.
Revamped the query dialog for easy adding of filters.


Modified: trunk/Search/Google/GoogleAPIEngine.cpp
===================================================================
--- trunk/Search/Google/GoogleAPIEngine.cpp	2006-10-14 04:23:26 UTC (rev 508)
+++ trunk/Search/Google/GoogleAPIEngine.cpp	2006-10-14 04:40:11 UTC (rev 509)
@@ -85,8 +85,7 @@
 /// Runs a query; true if success.
 bool GoogleAPIEngine::runQuery(QueryProperties& queryProps)
 {
-	string queryString = queryProps.toString(false);
-
+	string queryString(queryProps.getFreeQuery());
 	setHostNameFilter(queryProps.getHostFilter());
 	setFileNameFilter(queryProps.getFileFilter());
 

Modified: trunk/Search/PluginWebEngine.cpp
===================================================================
--- trunk/Search/PluginWebEngine.cpp	2006-10-14 04:23:26 UTC (rev 508)
+++ trunk/Search/PluginWebEngine.cpp	2006-10-14 04:40:11 UTC (rev 509)
@@ -214,7 +214,7 @@
 /// Runs a query; true if success.
 bool PluginWebEngine::runQuery(QueryProperties& queryProps)
 {
-	string queryString = queryProps.toString(false);
+	string queryString(queryProps.getFreeQuery());
 	char countStr[64];
 	unsigned int currentIncrement = 0, count = 0;
 

Modified: trunk/Search/QueryProperties.cpp
===================================================================
--- trunk/Search/QueryProperties.cpp	2006-10-14 04:23:26 UTC (rev 508)
+++ trunk/Search/QueryProperties.cpp	2006-10-14 04:40:11 UTC (rev 509)
@@ -19,40 +19,36 @@
 
 #include "Document.h"
 #include "Languages.h"
+#include "StringManip.h"
 #include "Tokenizer.h"
 #include "QueryProperties.h"
 
-QueryProperties::QueryProperties()
+QueryProperties::QueryProperties() :
+	m_resultsCount(10),
+	m_indexResults(false)
 {
-	m_resultsCount = 10;
-	m_indexResults = false;
 }
 
-QueryProperties::QueryProperties(string name, string andWords, string phrase, string anyWords, string notWords)
+QueryProperties::QueryProperties(const string &name, const string &freeQuery) :
+	m_name(name),
+	m_freeQuery(freeQuery),
+	m_resultsCount(10),
+	m_indexResults(false)
 {
-	m_name = name;
-	m_andWords = andWords;
-	m_phrase = phrase;
-	m_anyWords = anyWords;
-	m_notWords = notWords;
-	m_resultsCount = 10;
-	m_indexResults = false;
+	extractFilters();
 }
 
 QueryProperties::QueryProperties(const QueryProperties &other) :
 	m_name(other.m_name),
-	m_andWords(other.m_andWords),
-	m_phrase(other.m_phrase),
-	m_anyWords(other.m_anyWords),
-	m_notWords(other.m_notWords),
+	m_freeQuery(other.m_freeQuery),
 	m_language(other.m_language),
 	m_hostFilter(other.m_hostFilter),
 	m_fileFilter(other.m_fileFilter),
-	m_labelFilter(other.m_labelFilter),
 	m_resultsCount(other.m_resultsCount),
 	m_indexResults(other.m_indexResults),
 	m_labelName(other.m_labelName)
 {
+	extractFilters();
 }
 
 QueryProperties::~QueryProperties()
@@ -64,17 +60,14 @@
 	if (this != &other)
 	{
 		m_name = other.m_name;
-		m_andWords = other.m_andWords;
-		m_phrase = other.m_phrase;
-		m_anyWords = other.m_anyWords;
-		m_notWords = other.m_notWords;
+		m_freeQuery = other.m_freeQuery;
 		m_language = other.m_language;
 		m_hostFilter = other.m_hostFilter;
 		m_fileFilter = other.m_fileFilter;
-		m_labelFilter = other.m_labelFilter;
 		m_resultsCount = other.m_resultsCount;
 		m_indexResults = other.m_indexResults;
 		m_labelName = other.m_labelName;
+		extractFilters();
 	}
 
 	return *this;
@@ -100,6 +93,26 @@
 	return false;
 }
 
+void QueryProperties::extractFilters(void)
+{
+	if (m_freeQuery.empty() == true)
+	{
+		m_language.clear();
+		m_hostFilter.clear();
+		m_fileFilter.clear();
+		return;
+	}
+
+	string freeQuery = StringManip::replaceSubString(m_freeQuery, "\n", " ");
+
+	m_language = StringManip::extractField(freeQuery, "language:", " )", true);
+	if (m_language.empty() == true)
+	{
+		m_language = StringManip::extractField(freeQuery, "language:", "");
+	}
+	// FIXME: do the same for host and file at the very least
+}
+
 /// Sets the name.
 void QueryProperties::setName(const string &name)
 {
@@ -112,102 +125,36 @@
 	return m_name;
 }
 
-/// Sets AND words.
-void QueryProperties::setAndWords(const string &words)
+/// Sets the query string.
+void QueryProperties::setFreeQuery(const string &freeQuery)
 {
-	m_andWords = words;
+	m_freeQuery = freeQuery;
 }
 
-/// Gets AND words.
-string QueryProperties::getAndWords(void) const
+/// Gets the query string.
+string QueryProperties::getFreeQuery(void) const
 {
-	return m_andWords;
+	return m_freeQuery;
 }
 
-/// Sets phrase query.
-void QueryProperties::setPhrase(const string &phrase)
-{
-	m_phrase = phrase;
-}
-
-/// Gets phrase query.
-string QueryProperties::getPhrase(void) const
-{
-	return m_phrase;
-}
-
-/// Sets ANY words.
-void QueryProperties::setAnyWords(const string &words)
-{
-	m_anyWords = words;
-}
-
-/// Gets ANY words.
-string QueryProperties::getAnyWords(void) const
-{
-	return m_anyWords;
-}
-
-/// Sets NOT words.
-void QueryProperties::setNotWords(const string &words)
-{
-	m_notWords = words;
-}
-
-/// Gets NOT words.
-string QueryProperties::getNotWords(void) const
-{
-	return m_notWords;
-}
-
-/// Sets the query's language.
-void QueryProperties::setLanguage(const string &language)
-{
-	m_language = language;
-}
-
 /// Gets the query's language.
 string QueryProperties::getLanguage(void) const
 {
 	return m_language;
 }
 
-/// Sets host filter.
-void QueryProperties::setHostFilter(const string &filter)
-{
-	m_hostFilter = filter;
-}
-
-/// Gets host filter.
+/// Gets the query's host filter.
 string QueryProperties::getHostFilter(void) const
 {
-	return 	m_hostFilter;
+	return m_hostFilter;
 }
 
-/// Sets file filter.
-void QueryProperties::setFileFilter(const string &filter)
-{
-	m_fileFilter = filter;
-}
-
-/// Gets file filter.
+/// Gets the query's file filter.
 string QueryProperties::getFileFilter(void) const
 {
 	return m_fileFilter;
 }
 
-/// Sets label filter.
-void QueryProperties::setLabelFilter(const string &filter)
-{
-	m_labelFilter = filter;
-}
-
-/// Gets label filter.
-string QueryProperties::getLabelFilter(void) const
-{
-	return m_labelFilter;
-}
-
 /// Sets the maximum number of results.
 void QueryProperties::setMaximumResultsCount(unsigned int count)
 {
@@ -248,9 +195,8 @@
 void QueryProperties::getTerms(set<string> &terms) const
 {
 	Document doc;
-	string termsString(m_andWords + m_phrase + m_anyWords + m_notWords);
 
-	doc.setData(termsString.c_str(), termsString.length());
+	doc.setData(m_freeQuery.c_str(), m_freeQuery.length());
 	Tokenizer tokens(&doc);
 
 	terms.clear();
@@ -261,85 +207,3 @@
 		terms.insert(token);
 	}
 }
-
-/// Returns a displayable representation of this query's properties.
-string QueryProperties::toString(bool forPresentation) const
-{
-	string queryString;
-	if (m_andWords.empty() == false)
-	{
-		string tmp = m_andWords;
-		replace(tmp.begin(), tmp.end(), ' ', '+');
-		queryString += tmp;
-	}
-	if (m_anyWords.empty() == false)
-	{
-		if (forPresentation == true)
-		{
-			string tmp = m_anyWords;
-			replace(tmp.begin(), tmp.end(), ' ', '|');
-			queryString += " +(";
-			queryString += tmp;
-			queryString += ")";
-		}
-		else
-		{
-			string tmp = m_anyWords;
-			// FIXME: is this good enough ?
-			replace(tmp.begin(), tmp.end(), ' ', '+');
-			if (queryString.empty() == false)
-			{
-				queryString += "+";
-			}
-			queryString += tmp;
-		}
-	}
-	if (m_notWords.empty() == false)
-	{
-		string tmp = m_notWords;
-		replace(tmp.begin(), tmp.end(), ' ', '-');
-		if (queryString.empty() == false)
-		{
-			queryString += " -";
-		}
-		queryString += tmp;
-		queryString += " ";
-	}
-	if (m_phrase.empty() == false)
-	{
-		string tmp = m_phrase;
-		replace(tmp.begin(), tmp.end(), ' ', '+');
-		if (queryString.empty() == false)
-		{
-			queryString += "+";
-		}
-		queryString += "\"";
-		queryString += tmp;
-		queryString += "\"";
-	}
-	if (forPresentation == true)
-	{
-		if (m_language.empty() == false)
-		{
-			queryString += " +L";
-			queryString += Languages::toCode(Languages::toEnglish(m_language));
-		}
-		if (m_hostFilter.empty() == false)
-		{
-			queryString += " +H";
-			queryString += m_hostFilter;
-		}
-		if (m_fileFilter.empty() == false)
-		{
-			queryString += " +P";
-			queryString += m_fileFilter;
-		}
-		if (m_labelFilter.empty() == false)
-		{
-			queryString += " +XLABEL:";
-			queryString += m_labelFilter;
-		}
-	}
-
-	return queryString;
-}

Modified: trunk/Search/QueryProperties.h
===================================================================
--- trunk/Search/QueryProperties.h	2006-10-14 04:23:26 UTC (rev 508)
+++ trunk/Search/QueryProperties.h	2006-10-14 04:40:11 UTC (rev 509)
@@ -28,7 +28,8 @@
 {
 	public:
 		QueryProperties();
-		QueryProperties(string name, string andWords, string phrase, string anyWords, string notWords);
+		QueryProperties(const string &name, const string &freeQuery);
+		QueryProperties(const string &name, const string &andWords, const string &phrase, const string &anyWords, const string &notWords);
 		QueryProperties(const QueryProperties &other);
 		~QueryProperties();
 
@@ -41,46 +42,20 @@
 		/// Gets the name.
 		string getName(void) const;
 
-		/// Sets AND words.
-		void setAndWords(const string &words);
-		/// Gets AND words.
-		string getAndWords(void) const;
+		/// Sets the query string.
+		void setFreeQuery(const string &freeQuery);
+		/// Gets the query string.
+		string getFreeQuery(void) const;
 
-		/// Sets phrase query.
-		void setPhrase(const string &phrase);
-		/// Gets phrase query.
-		string getPhrase(void) const;
-
-		/// Sets ANY words.
-		void setAnyWords(const string &words);
-		/// Gets ANY words.
-		string getAnyWords(void) const;
-
-		/// Sets NOT words.
-		void setNotWords(const string &words);
-		/// Gets NOT words.
-		string getNotWords(void) const;
-
-		/// Sets the query's language.
-		void setLanguage(const string &language);
 		/// Gets the query's language.
 		string getLanguage(void) const;
 
-		/// Sets host filter.
-		void setHostFilter(const string &filter);
-		/// Gets host filter.
+		/// Gets the query's host filter.
 		string getHostFilter(void) const;
 
-		/// Sets file filter.
-		void setFileFilter(const string &filter);
-		/// Gets file filter.
+		/// Gets the query's file filter.
 		string getFileFilter(void) const;
 
-		/// Sets label filter.
-		void setLabelFilter(const string &filter);
-		/// Gets label filter.
-		string getLabelFilter(void) const;
-
 		/// Sets the maximum number of results.
 		void setMaximumResultsCount(unsigned int count);
 		/// Gets the maximum number of results.
@@ -99,23 +74,18 @@
 		/// Returns the query's terms.
 		void getTerms(std::set<std::string> &terms) const;
 
-		/// Returns a string representation of this query's properties.
-		string toString(bool forPresentation = true) const;
-
 	protected:
 		string m_name;
-		string m_andWords;
-		string m_phrase;
-		string m_anyWords;
-		string m_notWords;
+		string m_freeQuery;
 		string m_language;
 		string m_hostFilter;
 		string m_fileFilter;
-		string m_labelFilter;
 		unsigned int m_resultsCount;
 		bool m_indexResults;
 		string m_labelName;
 
+		void extractFilters(void);
+
 };
 
 #endif // _QUERY_PROPERTIES_H

Modified: trunk/Search/XapianEngine.cpp
===================================================================
--- trunk/Search/XapianEngine.cpp	2006-10-14 04:23:26 UTC (rev 508)
+++ trunk/Search/XapianEngine.cpp	2006-10-14 04:40:11 UTC (rev 509)
@@ -107,19 +107,10 @@
 	m_resultsList.clear();
 }
 
-bool XapianEngine::queryDatabase(Xapian::Query &query)
+bool XapianEngine::queryDatabase(Xapian::Database *pIndex, Xapian::Query &query)
 {
 	bool bStatus = false;
 
-	XapianDatabase *pDatabase = XapianDatabaseFactory::getDatabase(m_databaseName, true);
-	if (pDatabase == NULL)
-	{
-		return false;
-	}
-
-	// Get the latest revision...
-	pDatabase->reopen();
-	Xapian::Database *pIndex = pDatabase->readLock();
 	if (pIndex != NULL)
 	{
 		try
@@ -244,183 +235,52 @@
 			cerr << "XapianEngine::queryDatabase: " << error.get_type() << ": " << error.get_msg() << endl;
 		}
 	}
-	pDatabase->unlock();
 
 	return bStatus;
 }
 
-void XapianEngine::stackQuery(const QueryProperties &queryProps,
-	stack<Xapian::Query> &queryStack, const string &stemLanguage, bool followOperators)
+Xapian::Query XapianEngine::parseQuery(Xapian::Database *pIndex, const QueryProperties &queryProps,
+	const string &stemLanguage, bool followOperators)
 {
-	Xapian::Query::op queryOp = Xapian::Query::OP_OR;
-	string term;
+	string freeQuery(StringManip::replaceSubString(queryProps.getFreeQuery(), "\n", " "));
+	Xapian::QueryParser parser;
+	Xapian::Stem stemmer;
 
-	// Get the terms to AND together
-	if (queryProps.getAndWords().empty() == false)
+	if (stemLanguage.empty() == false)
 	{
-		vector<string> andTerms;
-
-		if (extractWords(queryProps.getAndWords(), stemLanguage, andTerms) == true)
-		{
-#ifdef DEBUG
-			cout << "XapianEngine::stackQuery: OP_AND " << andTerms.size() << endl;
-#endif
-			if (followOperators == true)
-			{
-				queryOp = Xapian::Query::OP_AND;
-			}
-			queryStack.push(Xapian::Query(queryOp, andTerms.begin(), andTerms.end()));
-		}
+		stemmer = Xapian::Stem(StringManip::toLowerCase(stemLanguage));
 	}
 
-	// Get the terms of the phrase
-	if (queryProps.getPhrase().empty() == false)
+	// Set things up
+	parser.set_stemmer(stemmer);
+	if (followOperators == true)
 	{
-		vector<string> phraseTerms;
-
-		if (extractWords(queryProps.getPhrase(), stemLanguage, phraseTerms) == true)
-		{
-#ifdef DEBUG
-			cout << "XapianEngine::stackQuery: OP_PHRASE " << phraseTerms.size() << endl;
-#endif
-			if (followOperators == true)
-			{
-				queryOp = Xapian::Query::OP_PHRASE;
-			}
-			queryStack.push(Xapian::Query(queryOp, phraseTerms.begin(), phraseTerms.end()));
-		}
+		parser.set_default_op(Xapian::Query::OP_AND);
 	}
-
-	// Get the terms to OR together
-	if (queryProps.getAnyWords().empty() == false)
+	else
 	{
-		vector<string> orTerms;
-
-		if (extractWords(queryProps.getAnyWords(), stemLanguage, orTerms) == true)
-		{
-#ifdef DEBUG
-			cout << "XapianEngine::stackQuery: OP_OR " << orTerms.size() << endl;
-#endif
-			if (followOperators == true)
-			{
-				queryOp = Xapian::Query::OP_OR;
-			}
-			queryStack.push(Xapian::Query(queryOp, orTerms.begin(), orTerms.end()));
-		}
+		parser.set_default_op(Xapian::Query::OP_OR);
 	}
-
-	// Get the terms to NOT together
-	if (queryProps.getNotWords().empty() == false)
+	if (pIndex != NULL)
 	{
-		vector<string> notTerms;
-
-		if (extractWords(queryProps.getNotWords(), stemLanguage, notTerms) == true)
-		{
-#ifdef DEBUG
-			cout << "XapianEngine::stackQuery: OP_AND_NOT " << notTerms.size() << endl;
-#endif
-			// We need something to AND_NOT these terms against
-			// Not following the operator would make us return documents
-			// that have terms the user isn't interested in
-			Xapian::Query notQuery(Xapian::Query::OP_AND, notTerms.begin(), notTerms.end());
-			if (queryStack.empty() == false)
-			{
-				Xapian::Query topQuery = queryStack.top();
-				queryStack.pop();
-
-				queryStack.push(Xapian::Query(Xapian::Query::OP_AND_NOT, topQuery, notQuery));
-			}
-		}
+		// The database is required for wildcards
+		parser.set_database(*pIndex);
 	}
+	// ...including prefixes
+	parser.add_boolean_prefix("site", "H");
+	parser.add_boolean_prefix("file", "P");
+	parser.add_boolean_prefix("title", "S");
+	parser.add_boolean_prefix("url", "U");
+	parser.add_boolean_prefix("dir", "XDIR");
+	parser.add_boolean_prefix("lang", "L");
+	parser.add_boolean_prefix("type", "T");
+	parser.add_boolean_prefix("label", "XLABEL");
 
-	// Get the host name filter
-	if (queryProps.getHostFilter().empty() == false)
-	{
-		vector<string> hostTerms;
-
-		term = "H";
-		term += StringManip::toLowerCase(queryProps.getHostFilter());
-		hostTerms.push_back(term);
-		if (followOperators == true)
-		{
-			queryOp = Xapian::Query::OP_AND;
-		}
-		queryStack.push(Xapian::Query(queryOp, hostTerms.begin(), hostTerms.end()));
-	}
-
-	// Get the file name filter
-	if (queryProps.getFileFilter().empty() == false)
-	{
-		vector<string> fileTerms;
-
-		term = "P";
-		term += StringManip::toLowerCase(queryProps.getFileFilter());
-		fileTerms.push_back(term);
-		if (followOperators == true)
-		{
-			queryOp = Xapian::Query::OP_AND;
-		}
-		queryStack.push(Xapian::Query(queryOp, fileTerms.begin(), fileTerms.end()));
-	}
-
-	// Get the label name filter
-	if (queryProps.getLabelFilter().empty() == false)
-	{
-		vector<string> labelTerms;
-
-		term = "XLABEL:";
-		term += queryProps.getLabelFilter();
-		labelTerms.push_back(term);
-		if (followOperators == true)
-		{
-			queryOp = Xapian::Query::OP_AND;
-		}
-		queryStack.push(Xapian::Query(queryOp, labelTerms.begin(), labelTerms.end()));
-	}
-
-	// Get the language filter
-	string language = queryProps.getLanguage();
-	if (language.empty() == false)
-	{
-		vector<string> languageTerms;
-
-		term = "L";
-		term += Languages::toCode(Languages::toEnglish(language));
-#ifdef DEBUG
-		cout << "XapianEngine::stackQuery: filter " << term << endl;
-#endif
-		languageTerms.push_back(term);
-		if (followOperators == true)
-		{
-			queryOp = Xapian::Query::OP_AND;
-		}
-		queryStack.push(Xapian::Query(queryOp, languageTerms.begin(), languageTerms.end()));
-	}
+	// Activate all options and parse
+	return parser.parse_query(freeQuery,
+		Xapian::QueryParser::FLAG_BOOLEAN|Xapian::QueryParser::FLAG_PHRASE|Xapian::QueryParser::FLAG_LOVEHATE|Xapian::QueryParser::FLAG_BOOLEAN_ANY_CASE|Xapian::QueryParser::FLAG_WILDCARD);
 }
 
-/// Runs a boolean query; true if success.
-bool XapianEngine::runQuery(const string &keyword)
-{
-	// Clear the results list
-	m_resultsList.clear();
-
-	try
-	{
-		vector<string> keywordTerms;
-		keywordTerms.push_back(keyword);
-		Xapian::Query keywordQuery(Xapian::Query::OP_AND, keywordTerms.begin(), keywordTerms.end());
-
-		// Query the database with the full query
-		return queryDatabase(keywordQuery);
-	}
-	catch (const Xapian::Error &error)
-	{
-		cerr << "XapianEngine::runQuery: " << error.get_type() << ": " << error.get_msg() << endl;
-	}
-
-	return false;
-}
-
 //
 // Implementation of SearchEngineInterface
 //
@@ -440,6 +300,15 @@
 	// Clear the results list
 	m_resultsList.clear();
 
+	XapianDatabase *pDatabase = XapianDatabaseFactory::getDatabase(m_databaseName, true);
+	if (pDatabase == NULL)
+	{
+		return false;
+	}
+
+	// Get the latest revision...
+	pDatabase->reopen();
+	Xapian::Database *pIndex = pDatabase->readLock();
 	try
 	{
 		stack<Xapian::Query> queryStack;
@@ -453,26 +322,11 @@
 		// 3. if no results, don't follow operators and don't stem terms
 		// 4. if no results, don't follow operators and stem terms
 		// Steps 2 and 4 depend on a language being defined for the query
-		stackQuery(queryProps, queryStack, "", followOperators);
-		while (queryStack.empty() == false)
+		Xapian::Query freeQuery = parseQuery(pIndex, queryProps, "", followOperators);
+		while (freeQuery.empty() == false)
 		{
-			while (queryStack.size() > 1)
-			{
-				Xapian::Query topQuery = queryStack.top();
-				queryStack.pop();
-#ifdef DEBUG
-				cout << "XapianEngine::runQuery: popped query, left " << queryStack.size() << endl;
-#endif
-				Xapian::Query query = Xapian::Query(Xapian::Query::OP_AND, queryStack.top(), topQuery);
-				queryStack.pop();
-#ifdef DEBUG
-				cout << "XapianEngine::runQuery: popped query, left " << queryStack.size() << endl;
-#endif
-				queryStack.push(query);
-			}
-
 			// Query the database
-			if (queryDatabase(queryStack.top()) == false)
+			if (queryDatabase(pIndex, freeQuery) == false)
 			{
 				break;
 			}
@@ -504,22 +358,19 @@
 						}
 						++searchStep;
 					default:
+						pDatabase->unlock();
 						return true;
 				}
 
-				// Empty the stack
-				while (queryStack.empty() == false)
-				{
-					queryStack.pop();
-				}
 #ifdef DEBUG
 				cout << "XapianEngine::runQuery: trying step " << searchStep << endl;
 #endif
-				stackQuery(queryProps, queryStack,
+				freeQuery = parseQuery(pIndex, queryProps,
 					Languages::toEnglish(stemLanguage), followOperators);
 				continue;
 			}
 
+			pDatabase->unlock();
 			return true;
 		}
 	}
@@ -527,6 +378,7 @@
 	{
 		cerr << "XapianEngine::runQuery: " << error.get_type() << ": " << error.get_msg() << endl;
 	}
+	pDatabase->unlock();
 
 	return false;
 }

Modified: trunk/Search/XapianEngine.h
===================================================================
--- trunk/Search/XapianEngine.h	2006-10-14 04:23:26 UTC (rev 508)
+++ trunk/Search/XapianEngine.h	2006-10-14 04:40:11 UTC (rev 509)
@@ -36,9 +36,6 @@
 		/// Sets whether the query should be expanded.
 		bool setQueryExpansion(std::set<unsigned int> &relevantDocuments);
 
-		/// Runs a boolean query; true if success.
-		virtual bool runQuery(const std::string &keyword);
-
 		/// Runs a query; true if success.
 		virtual bool runQuery(QueryProperties& queryProps);
 
@@ -49,11 +46,10 @@
 		std::string m_databaseName;
 		std::set<unsigned int> m_relevantDocuments;
 
-		bool queryDatabase(Xapian::Query &query);
+		bool queryDatabase(Xapian::Database *pIndex, Xapian::Query &query);
 
-		void stackQuery(const QueryProperties &queryProps,
-			std::stack<Xapian::Query> &queryStack, const string &stemLanguage,
-			bool followOperators);
+		Xapian::Query parseQuery(Xapian::Database *pIndex, const QueryProperties &queryProps,
+			const string &stemLanguage, bool followOperators);
 
 	private:
 		XapianEngine(const XapianEngine &other);

Modified: trunk/UI/GTK2/metase-gtk2.glade
===================================================================
--- trunk/UI/GTK2/metase-gtk2.glade	2006-10-14 04:23:26 UTC (rev 508)
+++ trunk/UI/GTK2/metase-gtk2.glade	2006-10-14 04:40:11 UTC (rev 509)
@@ -2041,7 +2041,7 @@
 	      <child>
 		<widget class="GtkLabel" id="filterLabel">
 		  <property name="visible">True</property>
-		  <property name="label" translatable="yes">Filter:</property>
+		  <property name="label" translatable="yes">New filter:</property>
 		  <property name="use_underline">False</property>
 		  <property name="use_markup">False</property>
 		  <property name="justify">GTK_JUSTIFY_LEFT</property>
@@ -2067,12 +2067,7 @@
 		<widget class="GtkComboBox" id="filterCombobox">
 		  <property agent="glademm" name="cxx_visibility">protected</property>
 		  <property name="visible">True</property>
-		  <property name="items" translatable="yes">Language
-MIME Type
-Host Name
-Directory
-File Name
-Label</property>
+		  <property name="items" translatable="yes"></property>
 		  <property name="add_tearoffs">False</property>
 		  <property name="focus_on_click">True</property>
 		</widget>
@@ -2091,6 +2086,7 @@
 		  <property name="use_stock">True</property>
 		  <property name="relief">GTK_RELIEF_NORMAL</property>
 		  <property name="focus_on_click">True</property>
+		  <signal name="clicked" handler="on_addFilterButton_clicked" last_modification_time="Sat, 14 Oct 2006 01:28:04 GMT"/>
 		</widget>
 		<packing>
 		  <property name="padding">4</property>
@@ -2136,13 +2132,14 @@
 
 		      <child>
 			<widget class="GtkTextView" id="queryTextview">
+			  <property agent="glademm" name="cxx_visibility">protected</property>
 			  <property name="visible">True</property>
 			  <property name="can_focus">True</property>
 			  <property name="editable">True</property>
 			  <property name="overwrite">False</property>
-			  <property name="accepts_tab">True</property>
+			  <property name="accepts_tab">False</property>
 			  <property name="justification">GTK_JUSTIFY_LEFT</property>
-			  <property name="wrap_mode">GTK_WRAP_NONE</property>
+			  <property name="wrap_mode">GTK_WRAP_WORD</property>
 			  <property name="cursor_visible">True</property>
 			  <property name="pixels_above_lines">0</property>
 			  <property name="pixels_below_lines">0</property>
@@ -2191,7 +2188,7 @@
 	  <child>
 	    <widget class="GtkTable" id="tersmTable">
 	      <property name="visible">True</property>
-	      <property name="n_rows">1</property>
+	      <property name="n_rows">2</property>
 	      <property name="n_columns">2</property>
 	      <property name="homogeneous">False</property>
 	      <property name="row_spacing">0</property>
@@ -2213,8 +2210,8 @@
 		<packing>
 		  <property name="left_attach">0</property>
 		  <property name="right_attach">1</property>
-		  <property name="top_attach">0</property>
-		  <property name="bottom_attach">1</property>
+		  <property name="top_attach">1</property>
+		  <property name="bottom_attach">2</property>
 		  <property name="x_padding">4</property>
 		  <property name="y_padding">4</property>
 		  <property name="x_options">fill</property>
@@ -2232,13 +2229,67 @@
 		<packing>
 		  <property name="left_attach">1</property>
 		  <property name="right_attach">2</property>
+		  <property name="top_attach">1</property>
+		  <property name="bottom_attach">2</property>
+		  <property name="x_padding">4</property>
+		  <property name="y_padding">4</property>
+		  <property name="y_options">fill</property>
+		</packing>
+	      </child>
+
+	      <child>
+		<widget class="GtkLabel" id="resultsCountLabel">
+		  <property name="visible">True</property>
+		  <property name="label" translatable="yes">Number of results:</property>
+		  <property name="use_underline">False</property>
+		  <property name="use_markup">False</property>
+		  <property name="justify">GTK_JUSTIFY_LEFT</property>
+		  <property name="wrap">False</property>
+		  <property name="selectable">False</property>
+		  <property name="xalign">0</property>
+		  <property name="yalign">0.5</property>
+		  <property name="xpad">0</property>
+		  <property name="ypad">0</property>
+		  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+		  <property name="width_chars">-1</property>
+		  <property name="single_line_mode">False</property>
+		  <property name="angle">0</property>
+		</widget>
+		<packing>
+		  <property name="left_attach">0</property>
+		  <property name="right_attach">1</property>
 		  <property name="top_attach">0</property>
 		  <property name="bottom_attach">1</property>
 		  <property name="x_padding">4</property>
 		  <property name="y_padding">4</property>
+		  <property name="x_options">fill</property>
 		  <property name="y_options">fill</property>
 		</packing>
 	      </child>
+
+	      <child>
+		<widget class="GtkSpinButton" id="resultsCountSpinbutton">
+		  <property agent="glademm" name="cxx_visibility">protected</property>
+		  <property name="visible">True</property>
+		  <property name="can_focus">True</property>
+		  <property name="climb_rate">1</property>
+		  <property name="digits">0</property>
+		  <property name="numeric">False</property>
+		  <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+		  <property name="snap_to_ticks">False</property>
+		  <property name="wrap">False</property>
+		  <property name="adjustment">10 10 100 10 20 20</property>
+		</widget>
+		<packing>
+		  <property name="left_attach">1</property>
+		  <property name="right_attach">2</property>
+		  <property name="top_attach">0</property>
+		  <property name="bottom_attach">1</property>
+		  <property name="x_padding">4</property>
+		  <property name="y_padding">4</property>
+		  <property name="y_options">fill</property>
+		</packing>
+	      </child>
 	    </widget>
 	    <packing>
 	      <property name="padding">0</property>

Modified: trunk/UI/GTK2/src/PinotSettings.cpp
===================================================================
--- trunk/UI/GTK2/src/PinotSettings.cpp	2006-10-14 04:23:26 UTC (rev 508)
+++ trunk/UI/GTK2/src/PinotSettings.cpp	2006-10-14 04:40:11 UTC (rev 509)
@@ -543,6 +543,7 @@
 	}
 
 	QueryProperties queryProps;
+	string backCompatString;
 
 	// Load the query's properties
 	for (Node::NodeList::iterator iter = childNodes.begin(); iter != childNodes.end(); ++iter)
@@ -560,38 +561,91 @@
 		{
 			queryProps.setName(nodeContent);
 		}
-		else if (nodeName == "and")
+		else if (nodeName == "text")
 		{
-			queryProps.setAndWords(nodeContent);
+			queryProps.setFreeQuery(nodeContent);
 		}
-		else if (nodeName == "phrase")
+		else if ((nodeName == "and") &&
+			(nodeContent.empty() == false))
 		{
-			queryProps.setPhrase(nodeContent);
+			if (backCompatString.empty() == false)
+			{
+				backCompatString += " ";
+			}
+			backCompatString += nodeContent;
 		}
-		else if (nodeName == "any")
+		else if ((nodeName == "phrase") &&
+			(nodeContent.empty() == false))
 		{
-			queryProps.setAnyWords(nodeContent);
+			if (backCompatString.empty() == false)
+			{
+				backCompatString += " ";
+			}
+			backCompatString += "\"";
+			backCompatString += nodeContent;
+			backCompatString += "\"";
 		}
-		else if (nodeName == "not")
+		else if ((nodeName == "any") &&
+			(nodeContent.empty() == false))
 		{
-			queryProps.setNotWords(nodeContent);
+			// FIXME: don't be lazy and add those correctly
+			if (backCompatString.empty() == false)
+			{
+				backCompatString += " ";
+			}
+			backCompatString += nodeContent;
 		}
-		else if (nodeName == "language")
+		else if ((nodeName == "not") &&
+			(nodeContent.empty() == false))
 		{
-			queryProps.setLanguage(Languages::toLocale(nodeContent));
+			if (backCompatString.empty() == false)
+			{
+				backCompatString += " ";
+			}
+			backCompatString += "-(";
+			backCompatString += nodeContent;
+			backCompatString += ")";
 		}
-		else if (nodeName == "hostfilter")
+		else if ((nodeName == "language") &&
+			(nodeContent.empty() == false))
 		{
-			queryProps.setHostFilter(nodeContent);
+			if (backCompatString.empty() == false)
+			{
+				backCompatString += " ";
+			}
+			backCompatString += "language:";
+			backCompatString += nodeContent;
 		}
-		else if (nodeName == "filefilter")
+		else if ((nodeName == "hostfilter") &&
+			(nodeContent.empty() == false))
 		{
-			queryProps.setFileFilter(nodeContent);
+			if (backCompatString.empty() == false)
+			{
+				backCompatString += " ";
+			}
+			backCompatString += "site:";
+			backCompatString += nodeContent;
 		}
-		else if (nodeName == "labelfilter")
+		else if ((nodeName == "filefilter") &&
+			(nodeContent.empty() == false))
 		{
-			queryProps.setLabelFilter(nodeContent);
+			if (backCompatString.empty() == false)
+			{
+				backCompatString += " ";
+			}
+			backCompatString += "file:";
+			backCompatString += nodeContent;
 		}
+		else if ((nodeName == "labelfilter") &&
+			(nodeContent.empty() == false))
+		{
+			if (backCompatString.empty() == false)
+			{
+				backCompatString += " ";
+			}
+			backCompatString += "label:";
+			backCompatString += nodeContent;
+		}
 		else if (nodeName == "maxresults")
 		{
 			int count = atoi(nodeContent.c_str());
@@ -617,6 +671,10 @@
 	// We need at least a name
 	if (queryProps.getName().empty() == false)
 	{
+		if (backCompatString.empty() == false)
+		{
+			queryProps.setFreeQuery(backCompatString);
+		}
 		m_queries[queryProps.getName()] = queryProps;
 	}
 
@@ -1000,14 +1058,7 @@
 			return false;
 		}
 		addChildElement(pElem, "name", queryIter->first);
-		addChildElement(pElem, "and", queryIter->second.getAndWords());
-		addChildElement(pElem, "phrase", queryIter->second.getPhrase());
-		addChildElement(pElem, "any", queryIter->second.getAnyWords());
-		addChildElement(pElem, "not", queryIter->second.getNotWords());
-		addChildElement(pElem, "hostfilter", queryIter->second.getHostFilter());
-		addChildElement(pElem, "filefilter", queryIter->second.getFileFilter());
-		addChildElement(pElem, "labelfilter", queryIter->second.getLabelFilter());
-		addChildElement(pElem, "language", Languages::toEnglish(queryIter->second.getLanguage()));
+		addChildElement(pElem, "text", queryIter->second.getFreeQuery());
 		sprintf(numStr, "%u", queryIter->second.getMaximumResultsCount());
 		addChildElement(pElem, "maxresults", numStr);
 		addChildElement(pElem, "index", (queryIter->second.getIndexResults() ? "ALL" : "NONE"));

Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2006-10-14 04:23:26 UTC (rev 508)
+++ trunk/UI/GTK2/src/mainWindow.cc	2006-10-14 04:40:11 UTC (rev 509)
@@ -35,6 +35,7 @@
 #include "CommandLine.h"
 #include "HtmlTokenizer.h"
 #include "IndexedDocument.h"
+#include "StringManip.h"
 #include "TimeConverter.h"
 #include "MIMEScanner.h"
 #include "Url.h"
@@ -228,7 +229,7 @@
 			lastRun = _("N/A");
 		}
 		row[m_queryColumns.m_lastRun] = to_utf8(lastRun);
-		string summary = queryIter->second.toString();
+		string summary(StringManip::replaceSubString(queryIter->second.getFreeQuery(), "\n", " "));
 		if (summary.empty() == false)
 		{
 			row[m_queryColumns.m_summary] = to_utf8(summary);
@@ -1013,7 +1014,7 @@
 		}
 		queryProps.setName(queryName);
 
-		if (queryProps.getAnyWords().empty() == false)
+		if (queryProps.getFreeQuery().empty() == false)
 		{
 			moreLike = " ";
 		}
@@ -1042,7 +1043,7 @@
 		}
 
 		// Add these terms
-		queryProps.setAnyWords(queryProps.getAnyWords() + moreLike);
+		queryProps.setFreeQuery(queryProps.getFreeQuery() + moreLike);
 
 		// Update everything
 		if (m_settings.addQuery(queryProps) == true)
@@ -1522,8 +1523,7 @@
 #endif
 		// Use whatever text is in the clipboard as query name
 		// FIXME: look for \n as query fields separators ?
-		QueryProperties queryProps = QueryProperties(from_utf8(clipText),
-			"", "", "", "");
+		QueryProperties queryProps = QueryProperties(from_utf8(clipText), from_utf8(clipText));
 		edit_query(queryProps, true);
 	}
 	else
@@ -1685,7 +1685,7 @@
 	if (queryName == _("Live query"))
 	{
 		queryProps.setName(queryName);
-		queryProps.setAndWords(from_utf8(liveQueryEntry->get_text()));
+		queryProps.setFreeQuery(from_utf8(liveQueryEntry->get_text()));
 	}
 	else
 	{
@@ -2332,14 +2332,8 @@
 //
 void mainWindow::on_findButton_clicked()
 {
-	QueryProperties queryProps;
+	QueryProperties queryProps(_("Live query"), from_utf8(liveQueryEntry->get_text()));
 
-	queryProps.setName(_("Live query"));
-	// FIXME: parse the query string !
-	// Since we perform multi-step searches on the index, we might as well start with ANDing terms
-	// For search plugins, this won't make a difference
-	queryProps.setAndWords(from_utf8(liveQueryEntry->get_text()));
-
 	run_search(queryProps);
 }
 
@@ -2350,7 +2344,7 @@
 {
 	// Even though live queries terms are now ANDed together,
 	// use them as OR terms when creating a new stored query
-	QueryProperties queryProps = QueryProperties("", "", "", from_utf8(liveQueryEntry->get_text()), "");
+	QueryProperties queryProps = QueryProperties("", from_utf8(liveQueryEntry->get_text()));
 
 	edit_query(queryProps, true);
 }
@@ -2733,8 +2727,7 @@
 //
 void mainWindow::run_search(const QueryProperties &queryProps)
 {
-	string querySummary = queryProps.toString();
-	if (querySummary.empty() == true)
+	if (queryProps.getFreeQuery().empty() == true)
 	{
 		set_status(_("Query is not set"));
 		return;

Modified: trunk/UI/GTK2/src/pinot-dbus-daemon.cc
===================================================================
--- trunk/UI/GTK2/src/pinot-dbus-daemon.cc	2006-10-14 04:23:26 UTC (rev 508)
+++ trunk/UI/GTK2/src/pinot-dbus-daemon.cc	2006-10-14 04:40:11 UTC (rev 509)
@@ -440,7 +440,6 @@
 			DBUS_TYPE_INVALID) == TRUE)
 		{
 			XapianEngine engine(PinotSettings::getInstance().m_daemonIndexLocation);
-			QueryProperties queryProps;
 			bool replyWithError = true;
 
 #ifdef DEBUG
@@ -448,7 +447,7 @@
 #endif
 			if (pSearchText != NULL)
 			{
-				queryProps.setAndWords(pSearchText);
+				QueryProperties queryProps("DBUS", pSearchText);
 
 				// Run the query
 				engine.setMaxResultsCount(maxHits);

Modified: trunk/UI/GTK2/src/queryDialog.cc
===================================================================
--- trunk/UI/GTK2/src/queryDialog.cc	2006-10-14 04:23:26 UTC (rev 508)
+++ trunk/UI/GTK2/src/queryDialog.cc	2006-10-14 04:40:11 UTC (rev 509)
@@ -36,24 +36,8 @@
 	m_labels(PinotSettings::getInstance().getLabels()),
 	m_badName(true)
 {
-	string name = m_properties.getName();
-
-	// Associate the columns model to the index label combo
-	m_refLabelNameTree = ListStore::create(m_labelNameColumns);
-	labelNameCombobox->set_model(m_refLabelNameTree);
-	labelNameCombobox->pack_start(m_labelNameColumns.m_name);
-	// ...and the label filter combo
-	m_refLabelFilterTree = ListStore::create(m_labelFilterColumns);
-	labelFilterCombobox->set_model(m_refLabelFilterTree);
-	labelFilterCombobox->pack_start(m_labelFilterColumns.m_name);
-	// Associate the columns model to the language combo
-	m_refLanguageTree = ListStore::create(m_languageColumns);
-	languageCombobox->set_model(m_refLanguageTree);
-	languageCombobox->pack_start(m_languageColumns.m_name);
-	// Populate
-	populate_comboboxes();
-
 	// Name
+	string name(m_properties.getName());
 	if (name.empty() == true)
 	{
 		queryOkbutton->set_sensitive(false);
@@ -62,20 +46,24 @@
 	{
 		nameEntry->set_text(to_utf8(name));
 	}
-	// Query terms
-	andEntry->set_text(to_utf8(m_properties.getAndWords()));
-	phraseEntry->set_text(to_utf8(m_properties.getPhrase()));
-	anyEntry->set_text(to_utf8(m_properties.getAnyWords()));
-	notEntry->set_text(to_utf8(m_properties.getNotWords()));
-
-	// Host name
-	hostNameEntry->set_text(to_utf8(m_properties.getHostFilter()));
-	// File name
-	fileNameEntry->set_text(to_utf8(m_properties.getFileFilter()));
+	// Query text
+	RefPtr<TextBuffer> refBuffer = queryTextview->get_buffer();
+	refBuffer->set_text(to_utf8(m_properties.getFreeQuery()));
 	// Maximum number of results
 	resultsCountSpinbutton->set_value((double)m_properties.getMaximumResultsCount());
 	// Index all results
 	indexCheckbutton->set_active(m_properties.getIndexResults());
+
+	// Associate the columns model to the index label combo
+	m_refLabelNameTree = ListStore::create(m_labelNameColumns);
+	labelNameCombobox->set_model(m_refLabelNameTree);
+	labelNameCombobox->pack_start(m_labelNameColumns.m_name);
+	// ...and the filter combo
+	m_refFilterTree = ListStore::create(m_filterColumns);
+	filterCombobox->set_model(m_refFilterTree);
+	filterCombobox->pack_start(m_filterColumns.m_name);
+	// Populate
+	populate_comboboxes();
 }
 
 queryDialog::~queryDialog()
@@ -91,12 +79,7 @@
 	row[m_labelNameColumns.m_name] = _("None");
 	labelNameCombobox->set_active(0);
 
-	iter = m_refLabelFilterTree->append();
-	row = *iter;
-	row[m_labelFilterColumns.m_name] = _("Any");
-	labelFilterCombobox->set_active(0);
-
-	// Add all labels to both label combos and select the one defined for the query
+	// Add all labels to the label combo and select the one defined for the query
 	for (set<string>::const_iterator labelIter = m_labels.begin(); labelIter != m_labels.end(); ++labelIter)
 	{
 		string labelName(*labelIter);
@@ -109,35 +92,35 @@
 			labelNameCombobox->set_active(labelNum);
 		}
 
-		iter = m_refLabelFilterTree->append();
-		row = *iter;
-		row[m_labelFilterColumns.m_name] = to_utf8(labelName);
-		if (labelName == m_properties.getLabelFilter())
-		{
-			labelFilterCombobox->set_active(labelNum);
-		}
-
 		++labelNum;
 	}
 
-	iter = m_refLanguageTree->append();
+	// All supported filters
+	iter = m_refFilterTree->append();
 	row = *iter;
-	row[m_languageColumns.m_name] = _("Any");
-	languageCombobox->set_active(0);
-
-	// Add all supported languages and select the one defined for the query
-	for (unsigned int languageNum = 0; languageNum < Languages::m_count; ++languageNum)
-	{
-		string languageName = Languages::getIntlName(languageNum);
-		iter = m_refLanguageTree->append();
-		row = *iter;
-		row[m_languageColumns.m_name] = to_utf8(languageName);
-
-		if (languageName == m_properties.getLanguage())
-		{
-			languageCombobox->set_active(languageNum + 1);
-		}
-	}
+	row[m_filterColumns.m_name] = _("Host name");
+	iter = m_refFilterTree->append();
+	row = *iter;
+	row[m_filterColumns.m_name] = _("File name");
+	iter = m_refFilterTree->append();
+	row = *iter;
+	row[m_filterColumns.m_name] = _("Title");
+	iter = m_refFilterTree->append();
+	row = *iter;
+	row[m_filterColumns.m_name] = _("URL");
+	iter = m_refFilterTree->append();
+	row = *iter;
+	row[m_filterColumns.m_name] = _("Directory");
+	iter = m_refFilterTree->append();
+	row = *iter;
+	row[m_filterColumns.m_name] = _("Language code");
+	iter = m_refFilterTree->append();
+	row = *iter;
+	row[m_filterColumns.m_name] = _("MIME type");
+	iter = m_refFilterTree->append();
+	row = *iter;
+	row[m_filterColumns.m_name] = _("Label");
+	filterCombobox->set_active(0);
 }
 
 bool queryDialog::badName(void) const
@@ -167,22 +150,9 @@
 		}
 	}
 
-	// Query terms
-	m_properties.setAndWords(from_utf8(andEntry->get_text()));
-	m_properties.setPhrase(from_utf8(phraseEntry->get_text()));
-	m_properties.setAnyWords(from_utf8(anyEntry->get_text()));
-	m_properties.setNotWords(from_utf8(notEntry->get_text()));
-	// Language
-	m_properties.setLanguage("");
-	int chosenLanguage = languageCombobox->get_active_row_number();
-	if (chosenLanguage > 0)
-	{
-		TreeModel::iterator iter = languageCombobox->get_active();
-		TreeModel::Row row = *iter;
-		string languageName = from_utf8(row[m_languageColumns.m_name]);
-
-		m_properties.setLanguage(languageName);
-	}
+	// Query text
+	RefPtr<TextBuffer> refBuffer = queryTextview->get_buffer();
+	m_properties.setFreeQuery(from_utf8(refBuffer->get_text()));
 	// Maximum number of results
 	m_properties.setMaximumResultsCount((unsigned int)resultsCountSpinbutton->get_value());
 	// Index all results
@@ -198,32 +168,6 @@
 
 		m_properties.setLabelName(labelName);
 	}
-	// Filters
-	m_properties.setHostFilter(from_utf8(hostNameEntry->get_text()));
-	m_properties.setFileFilter(from_utf8(fileNameEntry->get_text()));
-	// Label filter
-	m_properties.setLabelFilter("");
-	chosenLabel = labelFilterCombobox->get_active_row_number();
-	if (chosenLabel > 0)
-	{
-		TreeModel::iterator iter = labelFilterCombobox->get_active();
-		TreeModel::Row row = *iter;
-		string labelName = from_utf8(row[m_labelFilterColumns.m_name]);
-
-		m_properties.setLabelFilter(labelName);
-	}
-
-	// Workaround for bizarre bug that would cause a crash when creating a query
-	// that indexes and labels results based on a language filter
-	if (queryNotebook->get_current_page() == 0)
-	{
-		queryNotebook->next_page();
-	}
-	else
-	{
-		queryNotebook->prev_page();
-		queryNotebook->next_page();
-	}
 }
 
 void queryDialog::on_nameEntry_changed()
@@ -238,3 +182,49 @@
 		queryOkbutton->set_sensitive(false);
 	}
 }
+
+void queryDialog::on_addFilterButton_clicked()
+{
+	ustring filter;
+
+	// What's the corresponding filter ?
+	int chosenFilter = filterCombobox->get_active_row_number();
+	// FIXME: should the filters be localized ?
+	switch (chosenFilter)
+	{
+		case 0:
+			filter = "site";
+			break;
+		case 1:
+			filter = "file";
+			break;
+		case 2:
+			filter = "title";
+			break;
+		case 3:
+			filter = "url";
+			break;
+		case 4:
+			filter = "dir";
+			break;
+		case 5:
+			filter = "lang";
+			break;
+		case 6:
+			filter = "type";
+			break;
+		case 7:
+			filter = "label";
+			break;
+		default:
+			break;
+	}
+
+	RefPtr<TextBuffer> refBuffer = queryTextview->get_buffer();
+	ustring queryText = refBuffer->get_text();
+	queryText += " ";
+	queryText += filter;
+	queryText += ":xxx";
+	refBuffer->set_text(queryText);
+}
+

Modified: trunk/UI/GTK2/src/queryDialog.hh
===================================================================
--- trunk/UI/GTK2/src/queryDialog.hh	2006-10-14 04:23:26 UTC (rev 508)
+++ trunk/UI/GTK2/src/queryDialog.hh	2006-10-14 04:40:11 UTC (rev 509)
@@ -40,16 +40,15 @@
 	const std::set<std::string> &m_labels;
 	ComboModelColumns m_labelNameColumns;
 	Glib::RefPtr<Gtk::ListStore> m_refLabelNameTree;
-	ComboModelColumns m_languageColumns;
-	Glib::RefPtr<Gtk::ListStore> m_refLanguageTree;
-	ComboModelColumns m_labelFilterColumns;
-	Glib::RefPtr<Gtk::ListStore> m_refLabelFilterTree;
+	ComboModelColumns m_filterColumns;
+	Glib::RefPtr<Gtk::ListStore> m_refFilterTree;
 	bool m_badName;
 
 	void populate_comboboxes();
 
 	virtual void on_queryOkbutton_clicked();
 	virtual void on_nameEntry_changed();
+	virtual void on_addFilterButton_clicked();
 
 };
 #endif

Modified: trunk/UI/GTK2/src/queryDialog_glade.cc
===================================================================
--- trunk/UI/GTK2/src/queryDialog_glade.cc	2006-10-14 04:23:26 UTC (rev 508)
+++ trunk/UI/GTK2/src/queryDialog_glade.cc	2006-10-14 04:40:11 UTC (rev 509)
@@ -1,9 +1,9 @@
-// generated 2006/6/27 12:45:50 SGT by fabrice at fabrix.asgent-tech.com.(none)
+// generated 2006/10/14 10:43:04 SGT by fabrice at amra.dyndns.org.(none)
 // using glademm V2.12.1
 //
 // DO NOT EDIT THIS FILE ! It was created using
-// glade-- /home/fabrice/pinot-0.49/UI/GTK2/metase-gtk2.glade
-// for gtk 2.8.19 and gtkmm 2.8.3
+// glade-- /home/fabrice/Projects/MetaSE/pinot/UI/GTK2/metase-gtk2.glade
+// for gtk 2.8.20 and gtkmm 2.8.8
 //
 // Please modify the corresponding derived classes in ./src/queryDialog.cc
 
@@ -41,8 +41,11 @@
 #include <gtkmm/buttonbox.h>
 #include <gtkmm/label.h>
 #include <gtkmm/table.h>
-#include <gtkmm/adjustment.h>
 #include <gtkmm/box.h>
+#include <gtkmm/scrolledwindow.h>
+#include <gtkmm/alignment.h>
+#include <gtkmm/frame.h>
+#include <gtkmm/adjustment.h>
 #ifndef ENABLE_NLS
 #  define textdomain(String) (String)
 #  define gettext(String) (String)
@@ -66,43 +69,25 @@
    nameEntry = Gtk::manage(new class Gtk::Entry());
    
    Gtk::Table *table1 = Gtk::manage(new class Gtk::Table(2, 2, false));
-   anyEntry = Gtk::manage(new class Gtk::Entry());
-   hostNameEntry = Gtk::manage(new class Gtk::Entry());
-   fileNameEntry = Gtk::manage(new class Gtk::Entry());
+   Gtk::Label *filterLabel = Gtk::manage(new class Gtk::Label(_("New filter:")));
+   filterCombobox = Gtk::manage(new class Gtk::ComboBox());
    
-   Gtk::Adjustment *resultsCountSpinbutton_adj = Gtk::manage(new class Gtk::Adjustment(10, 10, 100, 10, 20, 20));
-   resultsCountSpinbutton = Gtk::manage(new class Gtk::SpinButton(*resultsCountSpinbutton_adj, 1, 0));
+   Gtk::Button *addFilterButton = Gtk::manage(new class Gtk::Button(Gtk::StockID("gtk-add")));
+   Gtk::HBox *queryHbox = Gtk::manage(new class Gtk::HBox(false, 0));
+   queryTextview = Gtk::manage(new class Gtk::TextView());
+   
+   Gtk::ScrolledWindow *queryScrolledwindow = Gtk::manage(new class Gtk::ScrolledWindow());
+   Gtk::Alignment *queryFrameAlignment = Gtk::manage(new class Gtk::Alignment(0.5, 0.5, 1, 1));
+   Gtk::Label *queryFrameLabel = Gtk::manage(new class Gtk::Label(_("Query Text")));
+   Gtk::Frame *queryFrame = Gtk::manage(new class Gtk::Frame());
    indexCheckbutton = Gtk::manage(new class Gtk::CheckButton(_("Index all results with label")));
+   labelNameCombobox = Gtk::manage(new class Gtk::ComboBox());
    
-   Gtk::Label *anyLabel = Gtk::manage(new class Gtk::Label(_("Any of the words:")));
-   Gtk::Label *fileNameLabel = Gtk::manage(new class Gtk::Label(_("File name:")));
    Gtk::Label *resultsCountLabel = Gtk::manage(new class Gtk::Label(_("Number of results:")));
-   labelNameCombobox = Gtk::manage(new class Gtk::ComboBox());
+   Gtk::Adjustment *resultsCountSpinbutton_adj = Gtk::manage(new class Gtk::Adjustment(10, 10, 100, 10, 20, 20));
+   resultsCountSpinbutton = Gtk::manage(new class Gtk::SpinButton(*resultsCountSpinbutton_adj, 1, 0));
    
-   Gtk::Label *hostLabel = Gtk::manage(new class Gtk::Label(_("Host name:")));
-   Gtk::Label *notLabel = Gtk::manage(new class Gtk::Label(_("None of the words:")));
-   notEntry = Gtk::manage(new class Gtk::Entry());
-   
    Gtk::Table *tersmTable = Gtk::manage(new class Gtk::Table(2, 2, false));
-   Gtk::VBox *termsVbox = Gtk::manage(new class Gtk::VBox(false, 0));
-   Gtk::Label *commonLabel = Gtk::manage(new class Gtk::Label(_("All engines")));
-   Gtk::Label *filtersLabel = Gtk::manage(new class Gtk::Label(_("Limit to documents that match")));
-   phraseEntry = Gtk::manage(new class Gtk::Entry());
-   
-   Gtk::Label *phraseLabel = Gtk::manage(new class Gtk::Label(_("the exact phrase:")));
-   Gtk::Label *languageLabel = Gtk::manage(new class Gtk::Label(_("the language:")));
-   languageCombobox = Gtk::manage(new class Gtk::ComboBox());
-   andEntry = Gtk::manage(new class Gtk::Entry());
-   
-   Gtk::Label *andLabel = Gtk::manage(new class Gtk::Label(_("all the words:")));
-   Gtk::Label *labelLabel = Gtk::manage(new class Gtk::Label(_("the label:")));
-   labelFilterCombobox = Gtk::manage(new class Gtk::ComboBox());
-   
-   Gtk::Table *advancedTable = Gtk::manage(new class Gtk::Table(2, 2, false));
-   Gtk::VBox *advancedVbox = Gtk::manage(new class Gtk::VBox(false, 0));
-   Gtk::Label *advancedLabel = Gtk::manage(new class Gtk::Label(_("Indexes only")));
-   queryNotebook = Gtk::manage(new class Gtk::Notebook());
-   
    Gtk::VBox *queryVbox = Gtk::manage(new class Gtk::VBox(false, 0));
    queryCancelbutton->set_flags(Gtk::CAN_FOCUS);
    queryCancelbutton->set_flags(Gtk::CAN_DEFAULT);
@@ -127,161 +112,70 @@
    table1->set_col_spacings(0);
    table1->attach(*nameLabel, 0, 1, 0, 1, Gtk::FILL, Gtk::AttachOptions(), 0, 0);
    table1->attach(*nameEntry, 1, 2, 0, 1, Gtk::EXPAND|Gtk::FILL, Gtk::AttachOptions(), 4, 4);
-   anyEntry->set_flags(Gtk::CAN_FOCUS);
-   anyEntry->set_visibility(true);
-   anyEntry->set_editable(true);
-   anyEntry->set_max_length(0);
-   anyEntry->set_has_frame(true);
-   anyEntry->set_activates_default(false);
-   hostNameEntry->set_flags(Gtk::CAN_FOCUS);
-   hostNameEntry->set_visibility(true);
-   hostNameEntry->set_editable(true);
-   hostNameEntry->set_max_length(0);
-   hostNameEntry->set_has_frame(true);
-   hostNameEntry->set_activates_default(false);
-   fileNameEntry->set_flags(Gtk::CAN_FOCUS);
-   fileNameEntry->set_visibility(true);
-   fileNameEntry->set_editable(true);
-   fileNameEntry->set_max_length(0);
-   fileNameEntry->set_has_frame(true);
-   fileNameEntry->set_activates_default(false);
-   resultsCountSpinbutton->set_flags(Gtk::CAN_FOCUS);
-   resultsCountSpinbutton->set_update_policy(Gtk::UPDATE_ALWAYS);
-   resultsCountSpinbutton->set_numeric(false);
-   resultsCountSpinbutton->set_digits(0);
-   resultsCountSpinbutton->set_wrap(false);
+   filterLabel->set_alignment(0.5,0.5);
+   filterLabel->set_padding(4,4);
+   filterLabel->set_justify(Gtk::JUSTIFY_LEFT);
+   filterLabel->set_line_wrap(false);
+   filterLabel->set_use_markup(false);
+   filterLabel->set_selectable(false);
+   addFilterButton->set_flags(Gtk::CAN_FOCUS);
+   addFilterButton->set_relief(Gtk::RELIEF_NORMAL);
+   queryHbox->pack_start(*filterLabel, Gtk::PACK_SHRINK, 0);
+   queryHbox->pack_start(*filterCombobox, Gtk::PACK_EXPAND_WIDGET, 4);
+   queryHbox->pack_start(*addFilterButton, Gtk::PACK_SHRINK, 4);
+   queryTextview->set_flags(Gtk::CAN_FOCUS);
+   queryTextview->set_editable(true);
+   queryTextview->set_cursor_visible(true);
+   queryTextview->set_pixels_above_lines(0);
+   queryTextview->set_pixels_below_lines(0);
+   queryTextview->set_pixels_inside_wrap(0);
+   queryTextview->set_left_margin(0);
+   queryTextview->set_right_margin(0);
+   queryTextview->set_indent(0);
+   queryTextview->set_wrap_mode(Gtk::WRAP_WORD);
+   queryTextview->set_justification(Gtk::JUSTIFY_LEFT);
+   queryTextview->set_accepts_tab(false);
+   queryScrolledwindow->set_flags(Gtk::CAN_FOCUS);
+   queryScrolledwindow->set_shadow_type(Gtk::SHADOW_IN);
+   queryScrolledwindow->set_policy(Gtk::POLICY_AUTOMATIC, Gtk::POLICY_AUTOMATIC);
+   queryScrolledwindow->property_window_placement().set_value(Gtk::CORNER_TOP_LEFT);
+   queryScrolledwindow->add(*queryTextview);
+   queryFrameAlignment->add(*queryScrolledwindow);
+   queryFrameLabel->set_alignment(0.5,0.5);
+   queryFrameLabel->set_padding(0,0);
+   queryFrameLabel->set_justify(Gtk::JUSTIFY_LEFT);
+   queryFrameLabel->set_line_wrap(false);
+   queryFrameLabel->set_use_markup(true);
+   queryFrameLabel->set_selectable(false);
+   queryFrame->set_shadow_type(Gtk::SHADOW_NONE);
+   queryFrame->set_label_align(0,0.5);
+   queryFrame->add(*queryFrameAlignment);
+   queryFrame->set_label_widget(*queryFrameLabel);
    indexCheckbutton->set_flags(Gtk::CAN_FOCUS);
    indexCheckbutton->set_relief(Gtk::RELIEF_NORMAL);
    indexCheckbutton->set_mode(true);
    indexCheckbutton->set_active(false);
-   anyLabel->set_alignment(0,0.5);
-   anyLabel->set_padding(4,4);
-   anyLabel->set_justify(Gtk::JUSTIFY_LEFT);
-   anyLabel->set_line_wrap(false);
-   anyLabel->set_use_markup(false);
-   anyLabel->set_selectable(false);
-   fileNameLabel->set_alignment(0,0.5);
-   fileNameLabel->set_padding(4,4);
-   fileNameLabel->set_justify(Gtk::JUSTIFY_LEFT);
-   fileNameLabel->set_line_wrap(false);
-   fileNameLabel->set_use_markup(false);
-   fileNameLabel->set_selectable(false);
    resultsCountLabel->set_alignment(0,0.5);
-   resultsCountLabel->set_padding(4,4);
+   resultsCountLabel->set_padding(0,0);
    resultsCountLabel->set_justify(Gtk::JUSTIFY_LEFT);
    resultsCountLabel->set_line_wrap(false);
    resultsCountLabel->set_use_markup(false);
    resultsCountLabel->set_selectable(false);
-   hostLabel->set_alignment(0,0.5);
-   hostLabel->set_padding(4,4);
-   hostLabel->set_justify(Gtk::JUSTIFY_LEFT);
-   hostLabel->set_line_wrap(false);
-   hostLabel->set_use_markup(false);
-   hostLabel->set_selectable(false);
-   notLabel->set_alignment(0,0.5);
-   notLabel->set_padding(4,4);
-   notLabel->set_justify(Gtk::JUSTIFY_LEFT);
-   notLabel->set_line_wrap(false);
-   notLabel->set_use_markup(false);
-   notLabel->set_selectable(false);
-   notEntry->set_flags(Gtk::CAN_FOCUS);
-   notEntry->set_visibility(true);
-   notEntry->set_editable(true);
-   notEntry->set_max_length(0);
-   notEntry->set_has_frame(true);
-   notEntry->set_activates_default(false);
+   resultsCountSpinbutton->set_flags(Gtk::CAN_FOCUS);
+   resultsCountSpinbutton->set_update_policy(Gtk::UPDATE_ALWAYS);
+   resultsCountSpinbutton->set_numeric(false);
+   resultsCountSpinbutton->set_digits(0);
+   resultsCountSpinbutton->set_wrap(false);
    tersmTable->set_row_spacings(0);
    tersmTable->set_col_spacings(0);
-   tersmTable->attach(*anyEntry, 1, 2, 0, 1, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
-   tersmTable->attach(*hostNameEntry, 1, 2, 2, 3, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
-   tersmTable->attach(*fileNameEntry, 1, 2, 3, 4, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
-   tersmTable->attach(*resultsCountSpinbutton, 1, 2, 4, 5, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
-   tersmTable->attach(*indexCheckbutton, 0, 1, 5, 6, Gtk::FILL, Gtk::FILL, 4, 4);
-   tersmTable->attach(*anyLabel, 0, 1, 0, 1, Gtk::FILL, Gtk::FILL, 0, 0);
-   tersmTable->attach(*fileNameLabel, 0, 1, 3, 4, Gtk::FILL, Gtk::FILL, 0, 0);
-   tersmTable->attach(*resultsCountLabel, 0, 1, 4, 5, Gtk::FILL, Gtk::FILL, 0, 0);
-   tersmTable->attach(*labelNameCombobox, 1, 2, 5, 6, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
-   tersmTable->attach(*hostLabel, 0, 1, 2, 3, Gtk::FILL, Gtk::FILL, 0, 0);
-   tersmTable->attach(*notLabel, 0, 1, 1, 2, Gtk::FILL, Gtk::FILL, 0, 0);
-   tersmTable->attach(*notEntry, 1, 2, 1, 2, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
-   termsVbox->pack_start(*tersmTable, Gtk::PACK_SHRINK, 4);
-   commonLabel->set_alignment(0.5,0.5);
-   commonLabel->set_padding(0,0);
-   commonLabel->set_justify(Gtk::JUSTIFY_LEFT);
-   commonLabel->set_line_wrap(false);
-   commonLabel->set_use_markup(false);
-   commonLabel->set_selectable(false);
-   filtersLabel->set_alignment(0,0.5);
-   filtersLabel->set_padding(4,4);
-   filtersLabel->set_justify(Gtk::JUSTIFY_LEFT);
-   filtersLabel->set_line_wrap(false);
-   filtersLabel->set_use_markup(false);
-   filtersLabel->set_selectable(false);
-   phraseEntry->set_flags(Gtk::CAN_FOCUS);
-   phraseEntry->set_visibility(true);
-   phraseEntry->set_editable(true);
-   phraseEntry->set_max_length(0);
-   phraseEntry->set_has_frame(true);
-   phraseEntry->set_activates_default(false);
-   phraseLabel->set_alignment(0,0.5);
-   phraseLabel->set_padding(4,4);
-   phraseLabel->set_justify(Gtk::JUSTIFY_LEFT);
-   phraseLabel->set_line_wrap(false);
-   phraseLabel->set_use_markup(false);
-   phraseLabel->set_selectable(false);
-   languageLabel->set_alignment(0,0.5);
-   languageLabel->set_padding(4,4);
-   languageLabel->set_justify(Gtk::JUSTIFY_LEFT);
-   languageLabel->set_line_wrap(false);
-   languageLabel->set_use_markup(false);
-   languageLabel->set_selectable(false);
-   andEntry->set_flags(Gtk::CAN_FOCUS);
-   andEntry->set_visibility(true);
-   andEntry->set_editable(true);
-   andEntry->set_max_length(0);
-   andEntry->set_has_frame(true);
-   andEntry->set_activates_default(false);
-   andLabel->set_alignment(0,0.5);
-   andLabel->set_padding(4,4);
-   andLabel->set_justify(Gtk::JUSTIFY_LEFT);
-   andLabel->set_line_wrap(false);
-   andLabel->set_use_markup(false);
-   andLabel->set_selectable(false);
-   labelLabel->set_alignment(0,0.5);
-   labelLabel->set_padding(4,4);
-   labelLabel->set_justify(Gtk::JUSTIFY_LEFT);
-   labelLabel->set_line_wrap(false);
-   labelLabel->set_use_markup(false);
-   labelLabel->set_selectable(false);
-   advancedTable->set_row_spacings(0);
-   advancedTable->set_col_spacings(0);
-   advancedTable->attach(*phraseEntry, 1, 2, 1, 2, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
-   advancedTable->attach(*phraseLabel, 0, 1, 1, 2, Gtk::FILL, Gtk::FILL, 0, 0);
-   advancedTable->attach(*languageLabel, 0, 1, 2, 3, Gtk::FILL, Gtk::FILL, 0, 0);
-   advancedTable->attach(*languageCombobox, 1, 2, 2, 3, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
-   advancedTable->attach(*andEntry, 1, 2, 0, 1, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
-   advancedTable->attach(*andLabel, 0, 1, 0, 1, Gtk::FILL, Gtk::FILL, 0, 0);
-   advancedTable->attach(*labelLabel, 0, 1, 3, 4, Gtk::FILL, Gtk::FILL, 0, 0);
-   advancedTable->attach(*labelFilterCombobox, 1, 2, 3, 4, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
-   advancedVbox->pack_start(*filtersLabel, Gtk::PACK_SHRINK, 4);
-   advancedVbox->pack_start(*advancedTable, Gtk::PACK_SHRINK, 0);
-   advancedLabel->set_alignment(0.5,0.5);
-   advancedLabel->set_padding(0,0);
-   advancedLabel->set_justify(Gtk::JUSTIFY_LEFT);
-   advancedLabel->set_line_wrap(false);
-   advancedLabel->set_use_markup(false);
-   advancedLabel->set_selectable(false);
-   queryNotebook->set_flags(Gtk::CAN_FOCUS);
-   queryNotebook->set_show_tabs(true);
-   queryNotebook->set_show_border(true);
-   queryNotebook->set_tab_pos(Gtk::POS_TOP);
-   queryNotebook->set_scrollable(false);
-   queryNotebook->append_page(*termsVbox, *commonLabel);
-   queryNotebook->pages().back().set_tab_label_packing(false, true, Gtk::PACK_START);
-   queryNotebook->append_page(*advancedVbox, *advancedLabel);
-   queryNotebook->pages().back().set_tab_label_packing(false, true, Gtk::PACK_START);
+   tersmTable->attach(*indexCheckbutton, 0, 1, 1, 2, Gtk::FILL, Gtk::FILL, 4, 4);
+   tersmTable->attach(*labelNameCombobox, 1, 2, 1, 2, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
+   tersmTable->attach(*resultsCountLabel, 0, 1, 0, 1, Gtk::FILL, Gtk::FILL, 4, 4);
+   tersmTable->attach(*resultsCountSpinbutton, 1, 2, 0, 1, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
    queryVbox->pack_start(*table1, Gtk::PACK_SHRINK, 0);
-   queryVbox->pack_start(*queryNotebook);
+   queryVbox->pack_start(*queryHbox);
+   queryVbox->pack_start(*queryFrame, Gtk::PACK_EXPAND_WIDGET, 4);
+   queryVbox->pack_start(*tersmTable);
    queryDialog->get_vbox()->set_homogeneous(false);
    queryDialog->get_vbox()->set_spacing(0);
    queryDialog->get_vbox()->pack_start(*queryVbox);
@@ -298,38 +192,25 @@
    nameLabel->show();
    nameEntry->show();
    table1->show();
-   anyEntry->show();
-   hostNameEntry->show();
-   fileNameEntry->show();
-   resultsCountSpinbutton->show();
+   filterLabel->show();
+   filterCombobox->show();
+   addFilterButton->show();
+   queryHbox->show();
+   queryTextview->show();
+   queryScrolledwindow->show();
+   queryFrameAlignment->show();
+   queryFrameLabel->show();
+   queryFrame->show();
    indexCheckbutton->show();
-   anyLabel->show();
-   fileNameLabel->show();
-   resultsCountLabel->show();
    labelNameCombobox->show();
-   hostLabel->show();
-   notLabel->show();
-   notEntry->show();
+   resultsCountLabel->show();
+   resultsCountSpinbutton->show();
    tersmTable->show();
-   termsVbox->show();
-   commonLabel->show();
-   filtersLabel->show();
-   phraseEntry->show();
-   phraseLabel->show();
-   languageLabel->show();
-   languageCombobox->show();
-   andEntry->show();
-   andLabel->show();
-   labelLabel->show();
-   labelFilterCombobox->show();
-   advancedTable->show();
-   advancedVbox->show();
-   advancedLabel->show();
-   queryNotebook->show();
    queryVbox->show();
    queryDialog->show();
    queryOkbutton->signal_clicked().connect(SigC::slot(*this, &queryDialog_glade::on_queryOkbutton_clicked), false);
    nameEntry->signal_changed().connect(SigC::slot(*this, &queryDialog_glade::on_nameEntry_changed), false);
+   addFilterButton->signal_clicked().connect(SigC::slot(*this, &queryDialog_glade::on_addFilterButton_clicked), false);
 }
 
 queryDialog_glade::~queryDialog_glade()

Modified: trunk/UI/GTK2/src/queryDialog_glade.hh
===================================================================
--- trunk/UI/GTK2/src/queryDialog_glade.hh	2006-10-14 04:23:26 UTC (rev 508)
+++ trunk/UI/GTK2/src/queryDialog_glade.hh	2006-10-14 04:40:11 UTC (rev 509)
@@ -1,9 +1,9 @@
-// generated 2006/6/27 12:45:50 SGT by fabrice at fabrix.asgent-tech.com.(none)
+// generated 2006/10/14 9:28:11 SGT by fabrice at amra.dyndns.org.(none)
 // using glademm V2.12.1
 //
 // DO NOT EDIT THIS FILE ! It was created using
-// glade-- /home/fabrice/pinot-0.49/UI/GTK2/metase-gtk2.glade
-// for gtk 2.8.19 and gtkmm 2.8.3
+// glade-- /home/fabrice/Projects/MetaSE/pinot/UI/GTK2/metase-gtk2.glade
+// for gtk 2.8.20 and gtkmm 2.8.8
 //
 // Please modify the corresponding derived classes in ./src/queryDialog.hh and./src/queryDialog.cc
 
@@ -34,10 +34,10 @@
 #include <gtkmm/dialog.h>
 #include <gtkmm/button.h>
 #include <gtkmm/entry.h>
-#include <gtkmm/spinbutton.h>
-#include <gtkmm/checkbutton.h>
 #include <gtkmm/combobox.h>
-#include <gtkmm/notebook.h>
+#include <gtkmm/textview.h>
+#include <gtkmm/checkbutton.h>
+#include <gtkmm/spinbutton.h>
 
 class queryDialog_glade : public Gtk::Dialog
 {  
@@ -48,18 +48,11 @@
 protected:
         class Gtk::Button * queryOkbutton;
         class Gtk::Entry * nameEntry;
-        class Gtk::Entry * anyEntry;
-        class Gtk::Entry * hostNameEntry;
-        class Gtk::Entry * fileNameEntry;
-        class Gtk::SpinButton * resultsCountSpinbutton;
+        class Gtk::ComboBox * filterCombobox;
+        class Gtk::TextView * queryTextview;
         class Gtk::CheckButton * indexCheckbutton;
         class Gtk::ComboBox * labelNameCombobox;
-        class Gtk::Entry * notEntry;
-        class Gtk::Entry * phraseEntry;
-        class Gtk::ComboBox * languageCombobox;
-        class Gtk::Entry * andEntry;
-        class Gtk::ComboBox * labelFilterCombobox;
-        class Gtk::Notebook * queryNotebook;
+        class Gtk::SpinButton * resultsCountSpinbutton;
         
         queryDialog_glade();
         
@@ -67,5 +60,6 @@
 private:
         virtual void on_queryOkbutton_clicked() = 0;
         virtual void on_nameEntry_changed() = 0;
+        virtual void on_addFilterButton_clicked() = 0;
 };
 #endif



From fabricecolin at mail.berlios.de  Sat Oct 14 07:22:46 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 14 Oct 2006 07:22:46 +0200
Subject: [Pinot-svn] r511 - in trunk/UI/GTK2: . src
Message-ID: <200610140522.k9E5MkfZ021846@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-14 07:22:45 +0200 (Sat, 14 Oct 2006)
New Revision: 511

Modified:
   trunk/UI/GTK2/metase-gtk2.glade
   trunk/UI/GTK2/src/PinotSettings.cpp
   trunk/UI/GTK2/src/PinotSettings.h
   trunk/UI/GTK2/src/mainWindow.cc
   trunk/UI/GTK2/src/mainWindow.hh
   trunk/UI/GTK2/src/mainWindow_glade.cc
   trunk/UI/GTK2/src/mainWindow_glade.hh
Log:
Simplified the UI to make it less scary to people used to Beagle :-)
By default, My Web Pages is not shown and the queries and engines lists are
hidden. The latter is shown/hidden by using the toggle button on the left
of the query field.
This and the previous changes to the Preferences box were suggested by
Manuel Breitfeld <manu_foren at gmx dot net>.


Modified: trunk/UI/GTK2/metase-gtk2.glade
===================================================================
--- trunk/UI/GTK2/metase-gtk2.glade	2006-10-14 04:41:32 UTC (rev 510)
+++ trunk/UI/GTK2/metase-gtk2.glade	2006-10-14 05:22:45 UTC (rev 511)
@@ -437,7 +437,7 @@
 
 	  <child>
 	    <widget class="GtkVBox" id="leftVbox">
-	      <property name="visible">True</property>
+	      <property agent="glademm" name="cxx_visibility">protected</property>
 	      <property name="homogeneous">False</property>
 	      <property name="spacing">0</property>
 
@@ -550,6 +550,36 @@
 		  <property name="spacing">0</property>
 
 		  <child>
+		    <widget class="GtkToggleButton" id="enginesTogglebutton">
+		      <property agent="glademm" name="cxx_visibility">protected</property>
+		      <property name="visible">True</property>
+		      <property name="can_focus">True</property>
+		      <property name="relief">GTK_RELIEF_NORMAL</property>
+		      <property name="focus_on_click">True</property>
+		      <property name="active">False</property>
+		      <property name="inconsistent">False</property>
+		      <signal name="toggled" handler="on_enginesTogglebutton_toggled" last_modification_time="Sat, 14 Oct 2006 05:02:18 GMT"/>
+
+		      <child>
+			<widget class="GtkImage" id="image616">
+			  <property name="visible">True</property>
+			  <property name="stock">gtk-justify-left</property>
+			  <property name="icon_size">4</property>
+			  <property name="xalign">0.5</property>
+			  <property name="yalign">0.5</property>
+			  <property name="xpad">0</property>
+			  <property name="ypad">0</property>
+			</widget>
+		      </child>
+		    </widget>
+		    <packing>
+		      <property name="padding">4</property>
+		      <property name="expand">False</property>
+		      <property name="fill">False</property>
+		    </packing>
+		  </child>
+
+		  <child>
 		    <widget class="GtkLabel" id="liveQueryLabel">
 		      <property name="visible">True</property>
 		      <property name="label" translatable="yes">Query:</property>
@@ -579,6 +609,7 @@
 		      <property agent="glademm" name="cxx_visibility">protected</property>
 		      <property name="visible">True</property>
 		      <property name="can_focus">True</property>
+		      <property name="has_focus">True</property>
 		      <property name="editable">True</property>
 		      <property name="visibility">True</property>
 		      <property name="max_length">0</property>
@@ -635,7 +666,7 @@
 		  <property agent="glademm" name="cxx_visibility">protected</property>
 		  <property name="visible">True</property>
 		  <property name="can_focus">True</property>
-		  <property name="expanded">True</property>
+		  <property name="expanded">False</property>
 		  <property name="spacing">0</property>
 
 		  <child>

Modified: trunk/UI/GTK2/src/PinotSettings.cpp
===================================================================
--- trunk/UI/GTK2/src/PinotSettings.cpp	2006-10-14 04:41:32 UTC (rev 510)
+++ trunk/UI/GTK2/src/PinotSettings.cpp	2006-10-14 05:22:45 UTC (rev 511)
@@ -90,7 +90,8 @@
 	m_width(0),
 	m_height(0),
 	m_panePos(-1),
-	m_expandQueries(true),
+	m_showEngines(false),
+	m_expandQueries(false),
 	m_ignoreRobotsDirectives(false),
 	m_suggestQueryTerms(true),
 	m_newResultsColourRed(65535),
@@ -441,6 +442,17 @@
 				m_expandQueries = false;
 			}
 		}
+		else if (nodeName == "showengines")
+		{
+			if (nodeContent == "YES")
+			{
+				m_showEngines = true;
+			}
+			else
+			{
+				m_showEngines = false;
+			}
+		}
 	}
 
 	return true;
@@ -1015,6 +1027,7 @@
 	sprintf(numStr, "%d", m_panePos);
 	addChildElement(pElem, "panepos", numStr);
 	addChildElement(pElem, "expandqueries", (m_expandQueries ? "YES" : "NO"));
+	addChildElement(pElem, "showengines", (m_showEngines ? "YES" : "NO"));
 	// User-defined indexes
 	for (map<string, string>::iterator indexIter = m_indexNames.begin(); indexIter != m_indexNames.end(); ++indexIter)
 	{

Modified: trunk/UI/GTK2/src/PinotSettings.h
===================================================================
--- trunk/UI/GTK2/src/PinotSettings.h	2006-10-14 04:41:32 UTC (rev 510)
+++ trunk/UI/GTK2/src/PinotSettings.h	2006-10-14 05:22:45 UTC (rev 511)
@@ -188,6 +188,7 @@
 		int m_width;
 		int m_height;
 		int m_panePos;
+		bool m_showEngines;
 		bool m_expandQueries;
 		bool m_ignoreRobotsDirectives;
 		bool m_suggestQueryTerms;

Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2006-10-14 04:41:32 UTC (rev 510)
+++ trunk/UI/GTK2/src/mainWindow.cc	2006-10-14 05:22:45 UTC (rev 511)
@@ -106,6 +106,11 @@
 		mainHpaned->set_position(m_settings.m_panePos);
 	}
 	queryExpander->set_expanded(m_settings.m_expandQueries);
+	enginesTogglebutton->set_active(m_settings.m_showEngines);
+	if (m_settings.m_showEngines == true)
+	{
+		leftVbox->show();
+	}
 
 	// Position the engine tree
 	m_pEnginesTree = manage(new EnginesTree(enginesVbox, m_settings));
@@ -173,6 +178,7 @@
 	removeIndexButton->set_sensitive(false);
 
 	// Set tooltips
+	m_tooltips.set_tip(*enginesTogglebutton, _("Show all search engines"));
 	m_tooltips.set_tip(*addIndexButton, _("Add index"));
 	m_tooltips.set_tip(*removeIndexButton, _("Remove index"));
 
@@ -183,9 +189,6 @@
 	set_status(_("Ready"));
 	m_pNotebook->show();
 	show();
-
-	// Browse the index
-	on_index_changed(_("My Web Pages"));
 }
 
 //
@@ -2254,6 +2257,21 @@
 }
 
 //
+// Show or hide the engines list
+//
+void mainWindow::on_enginesTogglebutton_toggled()
+{
+	if (enginesTogglebutton->get_active() == true)
+	{
+		leftVbox->show();
+	}
+	else
+	{
+		leftVbox->hide();
+	}
+}
+
+//
 // Live query entry change
 //
 void mainWindow::on_liveQueryEntry_changed()
@@ -2511,6 +2529,7 @@
 	get_size(m_settings.m_width, m_settings.m_height);
 	m_settings.m_panePos = mainHpaned->get_position();
 	m_settings.m_expandQueries = queryExpander->get_expanded();
+	m_settings.m_showEngines = enginesTogglebutton->get_active();
 #ifdef DEBUG
 	cout << "mainWindow::on_mainWindow_delete_event: quitting" << endl;
 #endif

Modified: trunk/UI/GTK2/src/mainWindow.hh
===================================================================
--- trunk/UI/GTK2/src/mainWindow.hh	2006-10-14 04:41:32 UTC (rev 510)
+++ trunk/UI/GTK2/src/mainWindow.hh	2006-10-14 05:22:45 UTC (rev 511)
@@ -102,6 +102,8 @@
 	virtual void on_addIndexButton_clicked();
 	virtual void on_removeIndexButton_clicked();
 
+	virtual void on_enginesTogglebutton_toggled();
+
 	virtual void on_liveQueryEntry_changed();
 	virtual void on_liveQueryEntry_activate();
 	virtual void on_findButton_clicked();

Modified: trunk/UI/GTK2/src/mainWindow_glade.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow_glade.cc	2006-10-14 04:41:32 UTC (rev 510)
+++ trunk/UI/GTK2/src/mainWindow_glade.cc	2006-10-14 05:22:45 UTC (rev 511)
@@ -1,9 +1,9 @@
-// generated 2006/6/22 14:44:31 SGT by fabrice at fabrix.asgent-tech.com.(none)
+// generated 2006/10/14 13:10:37 SGT by fabrice at amra.dyndns.org.(none)
 // using glademm V2.12.1
 //
 // DO NOT EDIT THIS FILE ! It was created using
-// glade-- /home/fabrice/Desktop/pinot-0.49/UI/GTK2/metase-gtk2.glade
-// for gtk 2.8.19 and gtkmm 2.8.3
+// glade-- /home/fabrice/Projects/MetaSE/pinot/UI/GTK2/metase-gtk2.glade
+// for gtk 2.8.20 and gtkmm 2.8.8
 //
 // Please modify the corresponding derived classes in ./src/mainWindow.cc
 
@@ -80,27 +80,26 @@
    hostnamegroup1 = NULL;
    Gtk::Menu *groupresults1_menu = Gtk::manage(new class Gtk::Menu());
    groupresults1 = NULL;
-   Gtk::Image *image608 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-clear"), Gtk::IconSize(1)));
+   Gtk::Image *image610 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-clear"), Gtk::IconSize(1)));
    clearresults1 = NULL;
-   Gtk::MenuItem *separator4 = NULL;
-   Gtk::Image *image609 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-find"), Gtk::IconSize(1)));
-   morelikethis1 = NULL;
    Gtk::MenuItem *separator1 = NULL;
    viewresults1 = NULL;
    viewcache1 = NULL;
+   Gtk::Image *image611 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-find"), Gtk::IconSize(1)));
+   morelikethis1 = NULL;
    indexresults1 = NULL;
    Gtk::Menu *resultsMenuitem_menu = Gtk::manage(new class Gtk::Menu());
    resultsMenuitem = NULL;
    list1 = NULL;
-   Gtk::Image *image610 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-open"), Gtk::IconSize(1)));
+   Gtk::Image *image612 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-open"), Gtk::IconSize(1)));
    import1 = NULL;
    Gtk::MenuItem *separator3 = NULL;
    viewfromindex1 = NULL;
-   Gtk::Image *image611 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-refresh"), Gtk::IconSize(1)));
+   Gtk::Image *image613 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-refresh"), Gtk::IconSize(1)));
    refreshindex1 = NULL;
-   Gtk::Image *image612 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-delete"), Gtk::IconSize(1)));
+   Gtk::Image *image614 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-delete"), Gtk::IconSize(1)));
    unindex1 = NULL;
-   Gtk::Image *image613 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-properties"), Gtk::IconSize(1)));
+   Gtk::Image *image615 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-properties"), Gtk::IconSize(1)));
    showfromindex1 = NULL;
    Gtk::Menu *indexMenuitem_menu = Gtk::manage(new class Gtk::Menu());
    indexMenuitem = NULL;
@@ -117,7 +116,11 @@
    removeIndexButton = Gtk::manage(new class Gtk::Button());
    
    Gtk::HBox *indexHbox = Gtk::manage(new class Gtk::HBox(true, 4));
-   Gtk::VBox *leftVbox = Gtk::manage(new class Gtk::VBox(false, 0));
+   leftVbox = Gtk::manage(new class Gtk::VBox(false, 0));
+   
+   Gtk::Image *image616 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-justify-left"), Gtk::IconSize(4)));
+   enginesTogglebutton = Gtk::manage(new class Gtk::ToggleButton());
+   
    Gtk::Label *liveQueryLabel = Gtk::manage(new class Gtk::Label(_("Query:")));
    liveQueryEntry = Gtk::manage(new class Gtk::Entry());
    findButton = Gtk::manage(new class Gtk::Button(Gtk::StockID("gtk-find")));
@@ -186,16 +189,10 @@
    resultsMenuitem_menu->items().push_back(Gtk::Menu_Helpers::MenuElem(_("Group By"), *groupresults1_menu));
    groupresults1 = (Gtk::MenuItem *)&resultsMenuitem_menu->items().back();
    
-   resultsMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("Clear List"), *image608));
+   resultsMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("Clear List"), *image610));
    clearresults1 = (Gtk::ImageMenuItem *)&resultsMenuitem_menu->items().back();
    
    resultsMenuitem_menu->items().push_back(Gtk::Menu_Helpers::SeparatorElem());
-   separator4 = (Gtk::MenuItem *)&resultsMenuitem_menu->items().back();
-   
-   resultsMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("More Like This"), *image609));
-   morelikethis1 = (Gtk::ImageMenuItem *)&resultsMenuitem_menu->items().back();
-   
-   resultsMenuitem_menu->items().push_back(Gtk::Menu_Helpers::SeparatorElem());
    separator1 = (Gtk::MenuItem *)&resultsMenuitem_menu->items().back();
    
    resultsMenuitem_menu->items().push_back(Gtk::Menu_Helpers::MenuElem(_("Vie_w")));
@@ -204,13 +201,16 @@
    resultsMenuitem_menu->items().push_back(Gtk::Menu_Helpers::MenuElem(_("View Cache")));
    viewcache1 = (Gtk::MenuItem *)&resultsMenuitem_menu->items().back();
    
+   resultsMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("More Like This"), *image611));
+   morelikethis1 = (Gtk::ImageMenuItem *)&resultsMenuitem_menu->items().back();
+   
    resultsMenuitem_menu->items().push_back(Gtk::Menu_Helpers::MenuElem(_("_Index")));
    indexresults1 = (Gtk::MenuItem *)&resultsMenuitem_menu->items().back();
    
    indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::MenuElem(_("List Contents Of")));
    list1 = (Gtk::MenuItem *)&indexMenuitem_menu->items().back();
    
-   indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("Import URL"), *image610));
+   indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("Import URL"), *image612));
    import1 = (Gtk::ImageMenuItem *)&indexMenuitem_menu->items().back();
    
    indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::SeparatorElem());
@@ -219,13 +219,13 @@
    indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::MenuElem(_("View")));
    viewfromindex1 = (Gtk::MenuItem *)&indexMenuitem_menu->items().back();
    
-   indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("Update"), *image611));
+   indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("Update"), *image613));
    refreshindex1 = (Gtk::ImageMenuItem *)&indexMenuitem_menu->items().back();
    
-   indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("Unindex"), *image612));
+   indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("Unindex"), *image614));
    unindex1 = (Gtk::ImageMenuItem *)&indexMenuitem_menu->items().back();
    
-   indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("Properties"), *image613));
+   indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("Properties"), *image615));
    showfromindex1 = (Gtk::ImageMenuItem *)&indexMenuitem_menu->items().back();
    
    helpMenuitem_menu->items().push_back(Gtk::Menu_Helpers::MenuElem(_("_About")));
@@ -247,11 +247,7 @@
    helpMenuitem = (Gtk::MenuItem *)&mainMenubar->items().back();
    showextract1->set_active(true);
    searchenginegroup1->set_active(true);
-   hostnamegroup1->set_active(false);
-   image608->set_alignment(0.5,0.5);
-   image608->set_padding(0,0);
-   image609->set_alignment(0.5,0.5);
-   image609->set_padding(0,0);
+   hostnamegroup1->set_active(true);
    image610->set_alignment(0.5,0.5);
    image610->set_padding(0,0);
    image611->set_alignment(0.5,0.5);
@@ -260,6 +256,10 @@
    image612->set_padding(0,0);
    image613->set_alignment(0.5,0.5);
    image613->set_padding(0,0);
+   image614->set_alignment(0.5,0.5);
+   image614->set_padding(0,0);
+   image615->set_alignment(0.5,0.5);
+   image615->set_padding(0,0);
    image439->set_alignment(0.5,0.5);
    image439->set_padding(0,0);
    addIndexButton->set_flags(Gtk::CAN_FOCUS);
@@ -276,6 +276,12 @@
    indexHbox->pack_start(*removeIndexButton);
    leftVbox->pack_start(*enginesVbox);
    leftVbox->pack_start(*indexHbox, Gtk::PACK_SHRINK, 0);
+   image616->set_alignment(0.5,0.5);
+   image616->set_padding(0,0);
+   enginesTogglebutton->set_flags(Gtk::CAN_FOCUS);
+   enginesTogglebutton->set_relief(Gtk::RELIEF_NORMAL);
+   enginesTogglebutton->set_active(false);
+   enginesTogglebutton->add(*image616);
    liveQueryLabel->set_alignment(0.5,0.5);
    liveQueryLabel->set_padding(0,0);
    liveQueryLabel->set_justify(Gtk::JUSTIFY_LEFT);
@@ -283,6 +289,7 @@
    liveQueryLabel->set_use_markup(false);
    liveQueryLabel->set_selectable(false);
    liveQueryEntry->set_flags(Gtk::CAN_FOCUS);
+   liveQueryEntry->grab_focus();
    liveQueryEntry->set_visibility(true);
    liveQueryEntry->set_editable(true);
    liveQueryEntry->set_max_length(0);
@@ -292,6 +299,7 @@
    findButton->set_flags(Gtk::CAN_DEFAULT);
    findButton->set_relief(Gtk::RELIEF_NORMAL);
    findVbuttonbox->pack_start(*findButton);
+   liveQueryHbox->pack_start(*enginesTogglebutton, Gtk::PACK_SHRINK, 4);
    liveQueryHbox->pack_start(*liveQueryLabel, Gtk::PACK_SHRINK, 4);
    liveQueryHbox->pack_start(*liveQueryEntry, Gtk::PACK_EXPAND_WIDGET, 4);
    liveQueryHbox->pack_start(*findVbuttonbox, Gtk::PACK_SHRINK, 4);
@@ -353,7 +361,7 @@
    queryLabel->set_selectable(false);
    queryExpander->set_flags(Gtk::CAN_FOCUS);
 #if GTKMM_MAJOR_VERSION==2 && GTKMM_MINOR_VERSION>=3
-   queryExpander->set_expanded(true);
+   queryExpander->set_expanded(false);
    queryExpander->set_spacing(0);
 #endif //
    queryExpander->add(*queryHbox);
@@ -392,26 +400,25 @@
    searchenginegroup1->show();
    hostnamegroup1->show();
    groupresults1->show();
-   image608->show();
+   image610->show();
    clearresults1->show();
-   separator4->show();
-   image609->show();
-   morelikethis1->show();
    separator1->show();
    viewresults1->show();
    viewcache1->show();
+   image611->show();
+   morelikethis1->show();
    indexresults1->show();
    resultsMenuitem->show();
    list1->show();
-   image610->show();
+   image612->show();
    import1->show();
    separator3->show();
    viewfromindex1->show();
-   image611->show();
+   image613->show();
    refreshindex1->show();
-   image612->show();
+   image614->show();
    unindex1->show();
-   image613->show();
+   image615->show();
    showfromindex1->show();
    indexMenuitem->show();
    about1->show();
@@ -423,7 +430,8 @@
    image438->show();
    removeIndexButton->show();
    indexHbox->show();
-   leftVbox->show();
+   image616->show();
+   enginesTogglebutton->show();
    liveQueryLabel->show();
    liveQueryEntry->show();
    findButton->show();
@@ -458,8 +466,8 @@
    showextract1->signal_activate().connect(SigC::slot(*this, &mainWindow_glade::on_showextract_activate), false);
    searchenginegroup1->signal_activate().connect(SigC::slot(*this, &mainWindow_glade::on_groupresults_activate), false);
    clearresults1->signal_activate().connect(SigC::slot(*this, &mainWindow_glade::on_clearresults_activate), false);
+   viewresults1->signal_activate().connect(SigC::slot(*this, &mainWindow_glade::on_viewresults_activate), false);
    morelikethis1->signal_activate().connect(SigC::slot(*this, &mainWindow_glade::on_morelikethis_activate), false);
-   viewresults1->signal_activate().connect(SigC::slot(*this, &mainWindow_glade::on_viewresults_activate), false);
    indexresults1->signal_activate().connect(SigC::slot(*this, &mainWindow_glade::on_indexresults_activate), false);
    import1->signal_activate().connect(SigC::slot(*this, &mainWindow_glade::on_import_activate), false);
    viewfromindex1->signal_activate().connect(SigC::slot(*this, &mainWindow_glade::on_viewfromindex_activate), false);
@@ -469,6 +477,7 @@
    about1->signal_activate().connect(SigC::slot(*this, &mainWindow_glade::on_about_activate), false);
    addIndexButton->signal_clicked().connect(SigC::slot(*this, &mainWindow_glade::on_addIndexButton_clicked), false);
    removeIndexButton->signal_clicked().connect(SigC::slot(*this, &mainWindow_glade::on_removeIndexButton_clicked), false);
+   enginesTogglebutton->signal_toggled().connect(SigC::slot(*this, &mainWindow_glade::on_enginesTogglebutton_toggled), false);
    liveQueryEntry->signal_changed().connect(SigC::slot(*this, &mainWindow_glade::on_liveQueryEntry_changed), false);
    liveQueryEntry->signal_activate().connect(SigC::slot(*this, &mainWindow_glade::on_liveQueryEntry_activate), false);
    findButton->signal_clicked().connect(SigC::slot(*this, &mainWindow_glade::on_findButton_clicked), false);

Modified: trunk/UI/GTK2/src/mainWindow_glade.hh
===================================================================
--- trunk/UI/GTK2/src/mainWindow_glade.hh	2006-10-14 04:41:32 UTC (rev 510)
+++ trunk/UI/GTK2/src/mainWindow_glade.hh	2006-10-14 05:22:45 UTC (rev 511)
@@ -1,9 +1,9 @@
-// generated 2006/6/22 14:44:31 SGT by fabrice at fabrix.asgent-tech.com.(none)
+// generated 2006/10/14 13:07:15 SGT by fabrice at amra.dyndns.org.(none)
 // using glademm V2.12.1
 //
 // DO NOT EDIT THIS FILE ! It was created using
-// glade-- /home/fabrice/Desktop/pinot-0.49/UI/GTK2/metase-gtk2.glade
-// for gtk 2.8.19 and gtkmm 2.8.3
+// glade-- /home/fabrice/Projects/MetaSE/pinot/UI/GTK2/metase-gtk2.glade
+// for gtk 2.8.20 and gtkmm 2.8.8
 //
 // Please modify the corresponding derived classes in ./src/mainWindow.hh and./src/mainWindow.cc
 
@@ -38,6 +38,7 @@
 #include <gtkmm/radiomenuitem.h>
 #include <gtkmm/box.h>
 #include <gtkmm/button.h>
+#include <gtkmm/togglebutton.h>
 #include <gtkmm/entry.h>
 #include <gtkmm/treeview.h>
 #include <gtkmm/handlebox.h>
@@ -70,9 +71,9 @@
         class Gtk::RadioMenuItem * hostnamegroup1;
         class Gtk::MenuItem * groupresults1;
         class Gtk::ImageMenuItem * clearresults1;
-        class Gtk::ImageMenuItem * morelikethis1;
         class Gtk::MenuItem * viewresults1;
         class Gtk::MenuItem * viewcache1;
+        class Gtk::ImageMenuItem * morelikethis1;
         class Gtk::MenuItem * indexresults1;
         class Gtk::MenuItem * resultsMenuitem;
         class Gtk::MenuItem * list1;
@@ -87,6 +88,8 @@
         class Gtk::VBox * enginesVbox;
         class Gtk::Button * addIndexButton;
         class Gtk::Button * removeIndexButton;
+        class Gtk::VBox * leftVbox;
+        class Gtk::ToggleButton * enginesTogglebutton;
         class Gtk::Entry * liveQueryEntry;
         class Gtk::Button * findButton;
         class Gtk::TreeView * queryTreeview;
@@ -117,8 +120,8 @@
         virtual void on_showextract_activate() = 0;
         virtual void on_groupresults_activate() = 0;
         virtual void on_clearresults_activate() = 0;
+        virtual void on_viewresults_activate() = 0;
         virtual void on_morelikethis_activate() = 0;
-        virtual void on_viewresults_activate() = 0;
         virtual void on_indexresults_activate() = 0;
         virtual void on_import_activate() = 0;
         virtual void on_viewfromindex_activate() = 0;
@@ -128,6 +131,7 @@
         virtual void on_about_activate() = 0;
         virtual void on_addIndexButton_clicked() = 0;
         virtual void on_removeIndexButton_clicked() = 0;
+        virtual void on_enginesTogglebutton_toggled() = 0;
         virtual void on_liveQueryEntry_changed() = 0;
         virtual void on_liveQueryEntry_activate() = 0;
         virtual void on_findButton_clicked() = 0;



From fabricecolin at mail.berlios.de  Sat Oct 14 07:41:06 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 14 Oct 2006 07:41:06 +0200
Subject: [Pinot-svn] r512 - trunk/UI/GTK2/src
Message-ID: <200610140541.k9E5f6v0023123@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-14 07:41:06 +0200 (Sat, 14 Oct 2006)
New Revision: 512

Modified:
   trunk/UI/GTK2/src/mainWindow_glade.cc
Log:
Widget hostnamegroup1 was active.


Modified: trunk/UI/GTK2/src/mainWindow_glade.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow_glade.cc	2006-10-14 05:22:45 UTC (rev 511)
+++ trunk/UI/GTK2/src/mainWindow_glade.cc	2006-10-14 05:41:06 UTC (rev 512)
@@ -1,4 +1,4 @@
-// generated 2006/10/14 13:10:37 SGT by fabrice at amra.dyndns.org.(none)
+// generated 2006/10/14 13:40:30 SGT by fabrice at amra.dyndns.org.(none)
 // using glademm V2.12.1
 //
 // DO NOT EDIT THIS FILE ! It was created using
@@ -80,26 +80,26 @@
    hostnamegroup1 = NULL;
    Gtk::Menu *groupresults1_menu = Gtk::manage(new class Gtk::Menu());
    groupresults1 = NULL;
-   Gtk::Image *image610 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-clear"), Gtk::IconSize(1)));
+   Gtk::Image *image617 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-clear"), Gtk::IconSize(1)));
    clearresults1 = NULL;
    Gtk::MenuItem *separator1 = NULL;
    viewresults1 = NULL;
    viewcache1 = NULL;
-   Gtk::Image *image611 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-find"), Gtk::IconSize(1)));
+   Gtk::Image *image618 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-find"), Gtk::IconSize(1)));
    morelikethis1 = NULL;
    indexresults1 = NULL;
    Gtk::Menu *resultsMenuitem_menu = Gtk::manage(new class Gtk::Menu());
    resultsMenuitem = NULL;
    list1 = NULL;
-   Gtk::Image *image612 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-open"), Gtk::IconSize(1)));
+   Gtk::Image *image619 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-open"), Gtk::IconSize(1)));
    import1 = NULL;
    Gtk::MenuItem *separator3 = NULL;
    viewfromindex1 = NULL;
-   Gtk::Image *image613 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-refresh"), Gtk::IconSize(1)));
+   Gtk::Image *image620 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-refresh"), Gtk::IconSize(1)));
    refreshindex1 = NULL;
-   Gtk::Image *image614 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-delete"), Gtk::IconSize(1)));
+   Gtk::Image *image621 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-delete"), Gtk::IconSize(1)));
    unindex1 = NULL;
-   Gtk::Image *image615 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-properties"), Gtk::IconSize(1)));
+   Gtk::Image *image622 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-properties"), Gtk::IconSize(1)));
    showfromindex1 = NULL;
    Gtk::Menu *indexMenuitem_menu = Gtk::manage(new class Gtk::Menu());
    indexMenuitem = NULL;
@@ -189,7 +189,7 @@
    resultsMenuitem_menu->items().push_back(Gtk::Menu_Helpers::MenuElem(_("Group By"), *groupresults1_menu));
    groupresults1 = (Gtk::MenuItem *)&resultsMenuitem_menu->items().back();
    
-   resultsMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("Clear List"), *image610));
+   resultsMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("Clear List"), *image617));
    clearresults1 = (Gtk::ImageMenuItem *)&resultsMenuitem_menu->items().back();
    
    resultsMenuitem_menu->items().push_back(Gtk::Menu_Helpers::SeparatorElem());
@@ -201,7 +201,7 @@
    resultsMenuitem_menu->items().push_back(Gtk::Menu_Helpers::MenuElem(_("View Cache")));
    viewcache1 = (Gtk::MenuItem *)&resultsMenuitem_menu->items().back();
    
-   resultsMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("More Like This"), *image611));
+   resultsMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("More Like This"), *image618));
    morelikethis1 = (Gtk::ImageMenuItem *)&resultsMenuitem_menu->items().back();
    
    resultsMenuitem_menu->items().push_back(Gtk::Menu_Helpers::MenuElem(_("_Index")));
@@ -210,7 +210,7 @@
    indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::MenuElem(_("List Contents Of")));
    list1 = (Gtk::MenuItem *)&indexMenuitem_menu->items().back();
    
-   indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("Import URL"), *image612));
+   indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("Import URL"), *image619));
    import1 = (Gtk::ImageMenuItem *)&indexMenuitem_menu->items().back();
    
    indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::SeparatorElem());
@@ -219,13 +219,13 @@
    indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::MenuElem(_("View")));
    viewfromindex1 = (Gtk::MenuItem *)&indexMenuitem_menu->items().back();
    
-   indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("Update"), *image613));
+   indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("Update"), *image620));
    refreshindex1 = (Gtk::ImageMenuItem *)&indexMenuitem_menu->items().back();
    
-   indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("Unindex"), *image614));
+   indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("Unindex"), *image621));
    unindex1 = (Gtk::ImageMenuItem *)&indexMenuitem_menu->items().back();
    
-   indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("Properties"), *image615));
+   indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("Properties"), *image622));
    showfromindex1 = (Gtk::ImageMenuItem *)&indexMenuitem_menu->items().back();
    
    helpMenuitem_menu->items().push_back(Gtk::Menu_Helpers::MenuElem(_("_About")));
@@ -247,19 +247,19 @@
    helpMenuitem = (Gtk::MenuItem *)&mainMenubar->items().back();
    showextract1->set_active(true);
    searchenginegroup1->set_active(true);
-   hostnamegroup1->set_active(true);
-   image610->set_alignment(0.5,0.5);
-   image610->set_padding(0,0);
-   image611->set_alignment(0.5,0.5);
-   image611->set_padding(0,0);
-   image612->set_alignment(0.5,0.5);
-   image612->set_padding(0,0);
-   image613->set_alignment(0.5,0.5);
-   image613->set_padding(0,0);
-   image614->set_alignment(0.5,0.5);
-   image614->set_padding(0,0);
-   image615->set_alignment(0.5,0.5);
-   image615->set_padding(0,0);
+   hostnamegroup1->set_active(false);
+   image617->set_alignment(0.5,0.5);
+   image617->set_padding(0,0);
+   image618->set_alignment(0.5,0.5);
+   image618->set_padding(0,0);
+   image619->set_alignment(0.5,0.5);
+   image619->set_padding(0,0);
+   image620->set_alignment(0.5,0.5);
+   image620->set_padding(0,0);
+   image621->set_alignment(0.5,0.5);
+   image621->set_padding(0,0);
+   image622->set_alignment(0.5,0.5);
+   image622->set_padding(0,0);
    image439->set_alignment(0.5,0.5);
    image439->set_padding(0,0);
    addIndexButton->set_flags(Gtk::CAN_FOCUS);
@@ -400,25 +400,25 @@
    searchenginegroup1->show();
    hostnamegroup1->show();
    groupresults1->show();
-   image610->show();
+   image617->show();
    clearresults1->show();
    separator1->show();
    viewresults1->show();
    viewcache1->show();
-   image611->show();
+   image618->show();
    morelikethis1->show();
    indexresults1->show();
    resultsMenuitem->show();
    list1->show();
-   image612->show();
+   image619->show();
    import1->show();
    separator3->show();
    viewfromindex1->show();
-   image613->show();
+   image620->show();
    refreshindex1->show();
-   image614->show();
+   image621->show();
    unindex1->show();
-   image615->show();
+   image622->show();
    showfromindex1->show();
    indexMenuitem->show();
    about1->show();



From fabricecolin at mail.berlios.de  Sat Oct 14 07:50:02 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 14 Oct 2006 07:50:02 +0200
Subject: [Pinot-svn] r513 - trunk
Message-ID: <200610140550.k9E5o27x023615@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-14 07:50:02 +0200 (Sat, 14 Oct 2006)
New Revision: 513

Modified:
   trunk/AUTHORS
   trunk/NEWS
   trunk/TODO
Log:
Updated NEWS and AUTHORS, removed completed items from TODO (and added one new
item).


Modified: trunk/AUTHORS
===================================================================
--- trunk/AUTHORS	2006-10-14 05:41:06 UTC (rev 512)
+++ trunk/AUTHORS	2006-10-14 05:50:02 UTC (rev 513)
@@ -5,6 +5,8 @@
 Patches, bug reports and helpful comments :
 
 	Building with CygWin - Reini Urban <rurban at x-ray dot at>
+	SuSE-friendly spec file - Marcus Rueckert <darix at web dot de>
+	Simplified UI - Manuel Breitfeld <manu_foren at gmx dot net>
 
 The file Monitor/linux-inotify-syscalls.h is originally from libinotify
 (Copyright ? 2005 Ryan Lortie <desrt at desrt dot ca>).

Modified: trunk/NEWS
===================================================================
--- trunk/NEWS	2006-10-14 05:41:06 UTC (rev 512)
+++ trunk/NEWS	2006-10-14 05:50:02 UTC (rev 513)
@@ -1,3 +1,15 @@
+??? version_0_6_1
+Index :
+ - can now run queries like "type:text/html and lang:en and (tcp near ip)"
+UI :
+ - revamped the stored queries editor to allow any number of terms and filters
+ - preferences relative to My Documents and My Web Pages gathered under the
+  same tab
+ - hide the stored queries and engines lists by default to avoid scaring
+  people used to Beagle too much ;-)
+Daemon :
+ - index attachements in mbox files
+
 2006/09/25 version_0_6_0
 Build :
  - modifications for building on Cygwin, contributed by Reini Urban

Modified: trunk/TODO
===================================================================
--- trunk/TODO	2006-10-14 05:41:06 UTC (rev 512)
+++ trunk/TODO	2006-10-14 05:50:02 UTC (rev 513)
@@ -34,6 +34,7 @@
 - Make sure Description files' SyndicationRight is not private or closed
 - Support for Google Buttons
 - Export search results as OpenSearch Response
+- Use pango_break() to tokenize abstracts
 
 Index
 - Get hold of stopwords lists for the languages supported by Xapian's stemmers and don't index stop words
@@ -47,8 +48,6 @@
 - Reopen connection to remote indexes when necessary; does Xapian throw a RemoteError ?
 - Allow to access remote Xapian indexes tunneled through ssh, using Xapian::Remote::open()
   defined in /usr/include/xapian/dbfactory.h
-- Use Xapian's QueryParser so that queries like "(type: pdf) and (dir: /reference/rfc) and (tcp near ip)"
-  become possible
 
 Mail
 - Find out what kind of locking scheme Mozilla uses (POSIX lock ?) and use that
@@ -60,7 +59,6 @@
     Date: Thu, 25 Aug 2005 11:04:49 +0800
   +0800 is basically same as SGT. At the moment the date is assumed to be GMT !
 - Keep track of attachments and avoid indexing the same file twice
-- Mail messages with attachements are not indexed
 
 UI
 - Switching back and forth between grouping modes messes up results rankings : check scores



From fabricecolin at mail.berlios.de  Sat Oct 14 07:50:56 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 14 Oct 2006 07:50:56 +0200
Subject: [Pinot-svn] r514 - trunk
Message-ID: <200610140550.k9E5ouog023756@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-14 07:50:56 +0200 (Sat, 14 Oct 2006)
New Revision: 514

Modified:
   trunk/README
Log:
Updated section about Preferences.


Modified: trunk/README
===================================================================
--- trunk/README	2006-10-14 05:50:02 UTC (rev 513)
+++ trunk/README	2006-10-14 05:50:56 UTC (rev 514)
@@ -67,8 +67,8 @@
   Pinot can automatically index :
     * directories and their contents. Monitoring for changes is optional.
     * mbox mail accounts. Monitoring is always enabled.
-  The former is configured with the My Documents tab in the Preferences box; the latter
-  with the My EMail tab. Both are handled by the D-Bus service.
+  Both are configured with the Indexing tab in the Preferences box and are
+  handled by the D-Bus service.
   See section "10. D-Bus service".
 
 


Property changes on: trunk/README
___________________________________________________________________
Name: svn:executable
   - 



From fabricecolin at mail.berlios.de  Sat Oct 14 13:11:09 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 14 Oct 2006 13:11:09 +0200
Subject: [Pinot-svn] r515 - trunk/UI/GTK2/src
Message-ID: <200610141111.k9EBB9Fp015316@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-14 13:11:08 +0200 (Sat, 14 Oct 2006)
New Revision: 515

Modified:
   trunk/UI/GTK2/src/prefsDialog.cc
Log:
Mail accounts were saved only if there were no directories configured !


Modified: trunk/UI/GTK2/src/prefsDialog.cc
===================================================================
--- trunk/UI/GTK2/src/prefsDialog.cc	2006-10-14 05:50:56 UTC (rev 514)
+++ trunk/UI/GTK2/src/prefsDialog.cc	2006-10-14 11:11:08 UTC (rev 515)
@@ -330,8 +330,10 @@
 
 	// Validate the current lists
 	save_labelsTreeview();
-	if ((save_directoriesTreeview() == true) ||
-		(save_mailTreeview() == true))
+	bool startForDirectories = save_directoriesTreeview();
+	bool startForMail = save_mailTreeview();
+	if ((startForDirectories == true) ||
+		(startForMail == true))
 	{
 		unsigned int crawledCount = 0, docsCount = 0;
 



From fabricecolin at mail.berlios.de  Sun Oct 15 02:14:55 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sun, 15 Oct 2006 02:14:55 +0200
Subject: [Pinot-svn] r516 - trunk/UI/GTK2/src
Message-ID: <200610150014.k9F0EtEs007247@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-15 02:14:47 +0200 (Sun, 15 Oct 2006)
New Revision: 516

Modified:
   trunk/UI/GTK2/src/DaemonState.cpp
Log:
Documents deleted since last crawl were not removed from the index if the
corresponding location wasn't monitored.


Modified: trunk/UI/GTK2/src/DaemonState.cpp
===================================================================
--- trunk/UI/GTK2/src/DaemonState.cpp	2006-10-14 11:11:08 UTC (rev 515)
+++ trunk/UI/GTK2/src/DaemonState.cpp	2006-10-15 00:14:47 UTC (rev 516)
@@ -78,9 +78,10 @@
 
 	if (doMonitoring == false)
 	{
-		// Monitoring is not necessary
+		// Monitoring is not necessary, but we still have to pass the handler
+		// so that we can act on documents that have been deleted
 		pScannerThread = new DirectoryScannerThread(locationToCrawl, isSource,
-			0, true, NULL, NULL);
+			0, true, NULL, m_pDiskHandler);
 	}
 	else
 	{



From fabricecolin at mail.berlios.de  Sun Oct 15 02:15:27 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sun, 15 Oct 2006 02:15:27 +0200
Subject: [Pinot-svn] r517 - trunk/Index
Message-ID: <200610150015.k9F0FRMJ007545@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-15 02:15:26 +0200 (Sun, 15 Oct 2006)
New Revision: 517

Modified:
   trunk/Index/XapianIndex.cpp
Log:
Less verbose DEBUG output.


Modified: trunk/Index/XapianIndex.cpp
===================================================================
--- trunk/Index/XapianIndex.cpp	2006-10-15 00:14:47 UTC (rev 516)
+++ trunk/Index/XapianIndex.cpp	2006-10-15 00:15:26 UTC (rev 517)
@@ -1445,9 +1445,6 @@
 
 	try
 	{
-#ifdef DEBUG
-		cout << "XapianIndex::flush: called" << endl;
-#endif
 		Xapian::WritableDatabase *pIndex = pDatabase->writeLock();
 		if (pIndex != NULL)
 		{



From fabricecolin at mail.berlios.de  Sun Oct 15 02:16:15 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sun, 15 Oct 2006 02:16:15 +0200
Subject: [Pinot-svn] r518 - trunk/Search/Plugins
Message-ID: <200610150016.k9F0GFIk007840@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-15 02:16:13 +0200 (Sun, 15 Oct 2006)
New Revision: 518

Added:
   trunk/Search/Plugins/GoogleCodeSearch.src
Log:
Plugin for the new Google code search service.


Added: trunk/Search/Plugins/GoogleCodeSearch.src
===================================================================
--- trunk/Search/Plugins/GoogleCodeSearch.src	2006-10-15 00:15:26 UTC (rev 517)
+++ trunk/Search/Plugins/GoogleCodeSearch.src	2006-10-15 00:16:13 UTC (rev 518)
@@ -0,0 +1,28 @@
+# Google Code Search plugin
+
+<search 
+   name="Google Code Search"
+   description="Google Code Search"
+   method="GET"
+   action="http://www.google.com/codesearch"
+   queryEncoding="utf-8"
+   queryCharset="utf-8"
+   routeType="Source Code"
+>
+
+<input name="q" user>
+<input name="btnG" value="Search+Codesourceid">
+<inputnext name="start" factor="10">
+<inputprev name="start" factor="10">
+<input name="ie" value="utf-8">
+<input name="oe" value="utf-8">
+
+<interpret 
+    browserResultType="result"
+    charset="UTF-8"
+    resultListStart=""
+    resultListEnd=""
+    resultItemStart="<div class=h>"
+    resultItemEnd="</span></div>"
+>
+</search>



From fabricecolin at mail.berlios.de  Sun Oct 15 02:17:58 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sun, 15 Oct 2006 02:17:58 +0200
Subject: [Pinot-svn] r519 - trunk/UI/GTK2
Message-ID: <200610150017.k9F0Hw8d008293@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-15 02:17:57 +0200 (Sun, 15 Oct 2006)
New Revision: 519

Modified:
   trunk/UI/GTK2/metase-gtk2.glade
Log:
Should have committed this in revision 512.


Modified: trunk/UI/GTK2/metase-gtk2.glade
===================================================================
--- trunk/UI/GTK2/metase-gtk2.glade	2006-10-15 00:16:13 UTC (rev 518)
+++ trunk/UI/GTK2/metase-gtk2.glade	2006-10-15 00:17:57 UTC (rev 519)
@@ -178,7 +178,7 @@
 			      <property name="visible">True</property>
 			      <property name="label" translatable="yes">Host Name</property>
 			      <property name="use_underline">True</property>
-			      <property name="active">True</property>
+			      <property name="active">False</property>
 			      <property name="group">searchenginegroup1</property>
 			    </widget>
 			  </child>
@@ -196,7 +196,7 @@
 		      <signal name="activate" handler="on_clearresults_activate" last_modification_time="Wed, 03 Mar 2004 19:51:48 GMT"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image610">
+			<widget class="GtkImage" id="image617">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-clear</property>
 			  <property name="icon_size">1</property>
@@ -243,7 +243,7 @@
 		      <signal name="activate" handler="on_morelikethis_activate" last_modification_time="Sun, 18 Jun 2006 10:50:56 GMT"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image611">
+			<widget class="GtkImage" id="image618">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-find</property>
 			  <property name="icon_size">1</property>
@@ -298,7 +298,7 @@
 		      <signal name="activate" handler="on_import_activate" last_modification_time="Tue, 02 Mar 2004 22:13:44 GMT"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image612">
+			<widget class="GtkImage" id="image619">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-open</property>
 			  <property name="icon_size">1</property>
@@ -336,7 +336,7 @@
 		      <signal name="activate" handler="on_refreshindex_activate" last_modification_time="Fri, 20 Feb 2004 18:57:09 GMT"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image613">
+			<widget class="GtkImage" id="image620">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-refresh</property>
 			  <property name="icon_size">1</property>
@@ -358,7 +358,7 @@
 		      <signal name="activate" handler="on_unindex_activate" last_modification_time="Thu, 28 Jul 2005 12:42:23 GMT"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image614">
+			<widget class="GtkImage" id="image621">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-delete</property>
 			  <property name="icon_size">1</property>
@@ -380,7 +380,7 @@
 		      <signal name="activate" handler="on_showfromindex_activate" last_modification_time="Sun, 06 Nov 2005 08:43:05 GMT"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image615">
+			<widget class="GtkImage" id="image622">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-properties</property>
 			  <property name="icon_size">1</property>



From fabricecolin at mail.berlios.de  Sun Oct 15 02:40:45 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sun, 15 Oct 2006 02:40:45 +0200
Subject: [Pinot-svn] r520 - in trunk/UI/GTK2: . src
Message-ID: <200610150040.k9F0ejeq010666@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-15 02:40:43 +0200 (Sun, 15 Oct 2006)
New Revision: 520

Modified:
   trunk/UI/GTK2/metase-gtk2.glade
   trunk/UI/GTK2/src/mainWindow_glade.cc
Log:
Use more appropriate icon for the "Show all search engines" button.


Modified: trunk/UI/GTK2/metase-gtk2.glade
===================================================================
--- trunk/UI/GTK2/metase-gtk2.glade	2006-10-15 00:17:57 UTC (rev 519)
+++ trunk/UI/GTK2/metase-gtk2.glade	2006-10-15 00:40:43 UTC (rev 520)
@@ -561,9 +561,9 @@
 		      <signal name="toggled" handler="on_enginesTogglebutton_toggled" last_modification_time="Sat, 14 Oct 2006 05:02:18 GMT"/>
 
 		      <child>
-			<widget class="GtkImage" id="image616">
+			<widget class="GtkImage" id="image623">
 			  <property name="visible">True</property>
-			  <property name="stock">gtk-justify-left</property>
+			  <property name="stock">gtk-network</property>
 			  <property name="icon_size">4</property>
 			  <property name="xalign">0.5</property>
 			  <property name="yalign">0.5</property>

Modified: trunk/UI/GTK2/src/mainWindow_glade.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow_glade.cc	2006-10-15 00:17:57 UTC (rev 519)
+++ trunk/UI/GTK2/src/mainWindow_glade.cc	2006-10-15 00:40:43 UTC (rev 520)
@@ -118,7 +118,7 @@
    Gtk::HBox *indexHbox = Gtk::manage(new class Gtk::HBox(true, 4));
    leftVbox = Gtk::manage(new class Gtk::VBox(false, 0));
    
-   Gtk::Image *image616 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-justify-left"), Gtk::IconSize(4)));
+   Gtk::Image *image616 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-network"), Gtk::IconSize(4)));
    enginesTogglebutton = Gtk::manage(new class Gtk::ToggleButton());
    
    Gtk::Label *liveQueryLabel = Gtk::manage(new class Gtk::Label(_("Query:")));



From fabricecolin at mail.berlios.de  Sun Oct 15 05:10:24 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sun, 15 Oct 2006 05:10:24 +0200
Subject: [Pinot-svn] r521 - in trunk/Search: . Google
Message-ID: <200610150310.k9F3AOYF028797@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-15 05:10:24 +0200 (Sun, 15 Oct 2006)
New Revision: 521

Modified:
   trunk/Search/Google/GoogleAPIEngine.cpp
   trunk/Search/PluginWebEngine.cpp
   trunk/Search/QueryProperties.cpp
   trunk/Search/QueryProperties.h
   trunk/Search/XapianEngine.cpp
   trunk/Search/XapianEngine.h
Log:
Run queries through the QueryParser, remove filters and only keep non-prefixed
terms when querying a Web engine, or generating an abstract.


Modified: trunk/Search/Google/GoogleAPIEngine.cpp
===================================================================
--- trunk/Search/Google/GoogleAPIEngine.cpp	2006-10-15 00:40:43 UTC (rev 520)
+++ trunk/Search/Google/GoogleAPIEngine.cpp	2006-10-15 03:10:24 UTC (rev 521)
@@ -85,7 +85,7 @@
 /// Runs a query; true if success.
 bool GoogleAPIEngine::runQuery(QueryProperties& queryProps)
 {
-	string queryString(queryProps.getFreeQuery());
+	string queryString(queryProps.getFreeQuery(true));
 	setHostNameFilter(queryProps.getHostFilter());
 	setFileNameFilter(queryProps.getFileFilter());
 

Modified: trunk/Search/PluginWebEngine.cpp
===================================================================
--- trunk/Search/PluginWebEngine.cpp	2006-10-15 00:40:43 UTC (rev 520)
+++ trunk/Search/PluginWebEngine.cpp	2006-10-15 03:10:24 UTC (rev 521)
@@ -214,7 +214,7 @@
 /// Runs a query; true if success.
 bool PluginWebEngine::runQuery(QueryProperties& queryProps)
 {
-	string queryString(queryProps.getFreeQuery());
+	string queryString(queryProps.getFreeQuery(true));
 	char countStr[64];
 	unsigned int currentIncrement = 0, count = 0;
 

Modified: trunk/Search/QueryProperties.cpp
===================================================================
--- trunk/Search/QueryProperties.cpp	2006-10-15 00:40:43 UTC (rev 520)
+++ trunk/Search/QueryProperties.cpp	2006-10-15 03:10:24 UTC (rev 521)
@@ -14,13 +14,13 @@
  *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
  */
 
+#include <ctype.h>
+#include <set>
 #include <iostream>
 #include <algorithm>
 
-#include "Document.h"
-#include "Languages.h"
-#include "StringManip.h"
 #include "Tokenizer.h"
+#include "XapianEngine.h"
 #include "QueryProperties.h"
 
 QueryProperties::QueryProperties() :
@@ -35,12 +35,13 @@
 	m_resultsCount(10),
 	m_indexResults(false)
 {
-	extractFilters();
+	removeFilters();
 }
 
 QueryProperties::QueryProperties(const QueryProperties &other) :
 	m_name(other.m_name),
 	m_freeQuery(other.m_freeQuery),
+	m_freeQueryWithoutFilters(other.m_freeQueryWithoutFilters),
 	m_language(other.m_language),
 	m_hostFilter(other.m_hostFilter),
 	m_fileFilter(other.m_fileFilter),
@@ -48,7 +49,6 @@
 	m_indexResults(other.m_indexResults),
 	m_labelName(other.m_labelName)
 {
-	extractFilters();
 }
 
 QueryProperties::~QueryProperties()
@@ -61,13 +61,13 @@
 	{
 		m_name = other.m_name;
 		m_freeQuery = other.m_freeQuery;
+		m_freeQueryWithoutFilters = other.m_freeQueryWithoutFilters;
 		m_language = other.m_language;
 		m_hostFilter = other.m_hostFilter;
 		m_fileFilter = other.m_fileFilter;
 		m_resultsCount = other.m_resultsCount;
 		m_indexResults = other.m_indexResults;
 		m_labelName = other.m_labelName;
-		extractFilters();
 	}
 
 	return *this;
@@ -93,24 +93,61 @@
 	return false;
 }
 
-void QueryProperties::extractFilters(void)
+void QueryProperties::removeFilters(void)
 {
+	m_freeQueryWithoutFilters.clear();
+	m_language.clear();
+	m_hostFilter.clear();
+	m_fileFilter.clear();
+
 	if (m_freeQuery.empty() == true)
 	{
-		m_language.clear();
-		m_hostFilter.clear();
-		m_fileFilter.clear();
 		return;
 	}
 
-	string freeQuery = StringManip::replaceSubString(m_freeQuery, "\n", " ");
+	set<string> terms;
+	if (XapianEngine::validateQuery(*this, true, terms) == true)
+	{
+		for (set<string>::const_iterator termIter = terms.begin();
+			termIter != terms.end(); ++termIter)
+		{
+			string term(*termIter);
 
-	m_language = StringManip::extractField(freeQuery, "language:", " )", true);
-	if (m_language.empty() == true)
-	{
-		m_language = StringManip::extractField(freeQuery, "language:", "");
+			if (term.empty() == true)
+			{
+				continue;
+			}
+
+			// is this a prefixed term ?
+			// The query shouldn't have the same filter twice
+			if (isupper((int)((*termIter)[0])) == 0)
+			{
+				// FIXME: operators have been lost !
+				if (m_freeQueryWithoutFilters.empty() == false)
+				{
+					m_freeQueryWithoutFilters += " ";
+				}
+				m_freeQueryWithoutFilters += term;
+			}
+			else
+			{
+				switch (term[0])
+				{
+					case 'L':
+						m_language = term.substr(1);
+						break;
+					case 'H':
+						m_hostFilter = term.substr(1);
+						break;
+					case 'P':
+						m_fileFilter = term.substr(1);
+						break;
+					default:
+						break;
+				}
+			}
+		}
 	}
-	// FIXME: do the same for host and file at the very least
 }
 
 /// Sets the name.
@@ -129,12 +166,21 @@
 void QueryProperties::setFreeQuery(const string &freeQuery)
 {
 	m_freeQuery = freeQuery;
+	removeFilters();
 }
 
 /// Gets the query string.
-string QueryProperties::getFreeQuery(void) const
+string QueryProperties::getFreeQuery(bool withoutFilters) const
 {
-	return m_freeQuery;
+	if (withoutFilters == false)
+	{
+		return m_freeQuery;
+	}
+
+#ifdef DEBUG
+	cout << "QueryProperties::getFreeQuery: " << m_freeQueryWithoutFilters << endl;
+#endif
+	return m_freeQueryWithoutFilters;
 }
 
 /// Gets the query's language.
@@ -196,7 +242,7 @@
 {
 	Document doc;
 
-	doc.setData(m_freeQuery.c_str(), m_freeQuery.length());
+	doc.setData(m_freeQueryWithoutFilters.c_str(), m_freeQueryWithoutFilters.length());
 	Tokenizer tokens(&doc);
 
 	terms.clear();
@@ -207,3 +253,4 @@
 		terms.insert(token);
 	}
 }
+

Modified: trunk/Search/QueryProperties.h
===================================================================
--- trunk/Search/QueryProperties.h	2006-10-15 00:40:43 UTC (rev 520)
+++ trunk/Search/QueryProperties.h	2006-10-15 03:10:24 UTC (rev 521)
@@ -45,7 +45,7 @@
 		/// Sets the query string.
 		void setFreeQuery(const string &freeQuery);
 		/// Gets the query string.
-		string getFreeQuery(void) const;
+		string getFreeQuery(bool withoutFilters = false) const;
 
 		/// Gets the query's language.
 		string getLanguage(void) const;
@@ -72,11 +72,12 @@
 		string getLabelName(void) const;
 
 		/// Returns the query's terms.
-		void getTerms(std::set<std::string> &terms) const;
+		void getTerms(set<string> &terms) const;
 
 	protected:
 		string m_name;
 		string m_freeQuery;
+		string m_freeQueryWithoutFilters;
 		string m_language;
 		string m_hostFilter;
 		string m_fileFilter;
@@ -84,7 +85,7 @@
 		bool m_indexResults;
 		string m_labelName;
 
-		void extractFilters(void);
+		void removeFilters(void);
 
 };
 

Modified: trunk/Search/XapianEngine.cpp
===================================================================
--- trunk/Search/XapianEngine.cpp	2006-10-15 00:40:43 UTC (rev 520)
+++ trunk/Search/XapianEngine.cpp	2006-10-15 03:10:24 UTC (rev 521)
@@ -33,7 +33,6 @@
 using std::string;
 using std::multimap;
 using std::vector;
-using std::stack;
 using std::cout;
 using std::cerr;
 using std::endl;
@@ -107,6 +106,81 @@
 	m_resultsList.clear();
 }
 
+Xapian::Query XapianEngine::parseQuery(Xapian::Database *pIndex, const QueryProperties &queryProps,
+	const string &stemLanguage, bool followOperators)
+{
+	string freeQuery(StringManip::replaceSubString(queryProps.getFreeQuery(), "\n", " "));
+	Xapian::QueryParser parser;
+	Xapian::Stem stemmer;
+
+	if (stemLanguage.empty() == false)
+	{
+		stemmer = Xapian::Stem(StringManip::toLowerCase(stemLanguage));
+	}
+
+	// Set things up
+	parser.set_stemmer(stemmer);
+	if (followOperators == true)
+	{
+		parser.set_default_op(Xapian::Query::OP_AND);
+	}
+	else
+	{
+		parser.set_default_op(Xapian::Query::OP_OR);
+	}
+	if (pIndex != NULL)
+	{
+		// The database is required for wildcards
+		parser.set_database(*pIndex);
+	}
+	// ...including prefixes
+	parser.add_boolean_prefix("site", "H");
+	parser.add_boolean_prefix("file", "P");
+	parser.add_boolean_prefix("title", "S");
+	parser.add_boolean_prefix("url", "U");
+	parser.add_boolean_prefix("dir", "XDIR");
+	parser.add_boolean_prefix("lang", "L");
+	parser.add_boolean_prefix("type", "T");
+	parser.add_boolean_prefix("label", "XLABEL");
+
+	// Activate all options and parse
+	return parser.parse_query(freeQuery,
+		Xapian::QueryParser::FLAG_BOOLEAN|Xapian::QueryParser::FLAG_PHRASE|Xapian::QueryParser::FLAG_LOVEHATE|Xapian::QueryParser::FLAG_BOOLEAN_ANY_CASE|Xapian::QueryParser::FLAG_WILDCARD);
+}
+
+/// Validates a query and extracts its terms.
+bool XapianEngine::validateQuery(QueryProperties& queryProps, bool includePrefixed,
+	set<string> &terms)
+{
+	bool goodQuery = false;
+
+	try
+	{
+		Xapian::Query freeQuery = parseQuery(NULL, queryProps, "", true);
+		if (freeQuery.empty() == false)
+		{
+			for (Xapian::TermIterator termIter = freeQuery.get_terms_begin();
+				termIter != freeQuery.get_terms_end(); ++termIter)
+			{
+				// Skip prefixed terms unless instructed otherwise
+				if ((includePrefixed == true) ||
+					(isupper((int)((*termIter)[0])) == 0))
+				{
+					terms.insert(*termIter);
+				}
+			}
+
+			goodQuery = true;
+		}
+	}
+	catch (const Xapian::Error &error)
+	{
+		cerr << "XapianEngine::validateQuery: " << error.get_type() << ": " << error.get_msg() << endl;
+	}
+
+	return goodQuery;
+}
+
 bool XapianEngine::queryDatabase(Xapian::Database *pIndex, Xapian::Query &query)
 {
 	bool bStatus = false;
@@ -239,48 +313,6 @@
 	return bStatus;
 }
 
-Xapian::Query XapianEngine::parseQuery(Xapian::Database *pIndex, const QueryProperties &queryProps,
-	const string &stemLanguage, bool followOperators)
-{
-	string freeQuery(StringManip::replaceSubString(queryProps.getFreeQuery(), "\n", " "));
-	Xapian::QueryParser parser;
-	Xapian::Stem stemmer;
-
-	if (stemLanguage.empty() == false)
-	{
-		stemmer = Xapian::Stem(StringManip::toLowerCase(stemLanguage));
-	}
-
-	// Set things up
-	parser.set_stemmer(stemmer);
-	if (followOperators == true)
-	{
-		parser.set_default_op(Xapian::Query::OP_AND);
-	}
-	else
-	{
-		parser.set_default_op(Xapian::Query::OP_OR);
-	}
-	if (pIndex != NULL)
-	{
-		// The database is required for wildcards
-		parser.set_database(*pIndex);
-	}
-	// ...including prefixes
-	parser.add_boolean_prefix("site", "H");
-	parser.add_boolean_prefix("file", "P");
-	parser.add_boolean_prefix("title", "S");
-	parser.add_boolean_prefix("url", "U");
-	parser.add_boolean_prefix("dir", "XDIR");
-	parser.add_boolean_prefix("lang", "L");
-	parser.add_boolean_prefix("type", "T");
-	parser.add_boolean_prefix("label", "XLABEL");
-
-	// Activate all options and parse
-	return parser.parse_query(freeQuery,
-		Xapian::QueryParser::FLAG_BOOLEAN|Xapian::QueryParser::FLAG_PHRASE|Xapian::QueryParser::FLAG_LOVEHATE|Xapian::QueryParser::FLAG_BOOLEAN_ANY_CASE|Xapian::QueryParser::FLAG_WILDCARD);
-}
-
 //
 // Implementation of SearchEngineInterface
 //
@@ -311,7 +343,6 @@
 	Xapian::Database *pIndex = pDatabase->readLock();
 	try
 	{
-		stack<Xapian::Query> queryStack;
 		string stemLanguage;
 		unsigned int searchStep = 1;
 		bool followOperators = true;
@@ -325,6 +356,14 @@
 		Xapian::Query freeQuery = parseQuery(pIndex, queryProps, "", followOperators);
 		while (freeQuery.empty() == false)
 		{
+#ifdef DEBUG
+			cout << "XapianEngine::runQuery: query terms are " << endl;
+			for (Xapian::TermIterator termIter = freeQuery.get_terms_begin();
+				termIter != freeQuery.get_terms_end(); ++termIter)
+			{
+				cout << " " << *termIter << endl;
+			}
+#endif
 			// Query the database
 			if (queryDatabase(pIndex, freeQuery) == false)
 			{
@@ -388,3 +427,4 @@
 {
 	return m_resultsList;
 }
+

Modified: trunk/Search/XapianEngine.h
===================================================================
--- trunk/Search/XapianEngine.h	2006-10-15 00:40:43 UTC (rev 520)
+++ trunk/Search/XapianEngine.h	2006-10-15 03:10:24 UTC (rev 521)
@@ -20,7 +20,6 @@
 #include <string>
 #include <set>
 #include <vector>
-#include <stack>
 
 #include <xapian.h>
 
@@ -33,6 +32,10 @@
 		XapianEngine(const std::string &database);
 		virtual ~XapianEngine();
 
+		/// Validates a query and extracts its terms.
+		static bool validateQuery(QueryProperties& queryProps, bool includePrefixed,
+			std::set<std::string> &terms);
+
 		/// Sets whether the query should be expanded.
 		bool setQueryExpansion(std::set<unsigned int> &relevantDocuments);
 
@@ -48,7 +51,7 @@
 
 		bool queryDatabase(Xapian::Database *pIndex, Xapian::Query &query);
 
-		Xapian::Query parseQuery(Xapian::Database *pIndex, const QueryProperties &queryProps,
+		static Xapian::Query parseQuery(Xapian::Database *pIndex, const QueryProperties &queryProps,
 			const string &stemLanguage, bool followOperators);
 
 	private:



From fabricecolin at mail.berlios.de  Sun Oct 15 13:29:35 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sun, 15 Oct 2006 13:29:35 +0200
Subject: [Pinot-svn] r522 - trunk
Message-ID: <200610151129.k9FBTZAj025014@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-15 13:29:35 +0200 (Sun, 15 Oct 2006)
New Revision: 522

Modified:
   trunk/pinot.spec.in
Log:
Require 0.9.7. There's no new API we make use of, but the changes to the
QueryParser are worth forcing an upgrade.


Modified: trunk/pinot.spec.in
===================================================================
--- trunk/pinot.spec.in	2006-10-15 03:10:24 UTC (rev 521)
+++ trunk/pinot.spec.in	2006-10-15 11:29:35 UTC (rev 522)
@@ -24,9 +24,9 @@
 Source: %{name}-%{version}.tar.gz
 URL: http://pinot.berlios.de/
 BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
-Requires: xapian-core-libs >= 0.9.4, libtextcat >= 2.2, sqlite >= 3.1.2, curl >= 7.13, gmime >= 2.1
+Requires: xapian-core-libs >= 0.9.7, libtextcat >= 2.2, sqlite >= 3.1.2, curl >= 7.13, gmime >= 2.1
 Requires: gtkmm24 >= 2.6, libxml++ >= 2.12, %{dbus_pkg} >= 0.60, shared-mime-info
-BuildRequires: xapian-core-devel >= 0.9.4, libtextcat-devel >= 2.2, sqlite-devel >= 3.1.2, curl-devel >= 7.13, gmime-devel >= 2.1, boost-devel >= 1.32
+BuildRequires: xapian-core-devel >= 0.9.7, libtextcat-devel >= 2.2, sqlite-devel >= 3.1.2, curl-devel >= 7.13, gmime-devel >= 2.1, boost-devel >= 1.32
 BuildRequires: gtkmm24-devel >= 2.6, libxml++-devel >= 2.12, %{dbus_dev_pkg} >= 0.60, gettext-devel, desktop-file-utils
 BuildRequires: taglib-devel >= 1.4
 BuildRequires: gcc-c++
@@ -120,6 +120,7 @@
 %config(noreplace) %{_datadir}/pinot/engines/Exalead.src
 %config(noreplace) %{_datadir}/pinot/engines/Freshmeat.src
 %config(noreplace) %{_datadir}/pinot/engines/Google.src
+%config(noreplace) %{_datadir}/pinot/engines/GoogleCodeSearch.src
 %config(noreplace) %{_datadir}/pinot/engines/MozDexDescription.xml
 %config(noreplace) %{_datadir}/pinot/engines/MSN.src
 %config(noreplace) %{_datadir}/pinot/engines/RollYOTopNews.src



From fabricecolin at mail.berlios.de  Mon Oct 16 15:59:29 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Mon, 16 Oct 2006 15:59:29 +0200
Subject: [Pinot-svn] r523 - trunk/UI/GTK2/src
Message-ID: <200610161359.k9GDxT6N017424@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-16 15:59:29 +0200 (Mon, 16 Oct 2006)
New Revision: 523

Modified:
   trunk/UI/GTK2/src/mainWindow.cc
Log:
If the document to open is a sub-type of text/plain and doesn't have a defined
application, use that of text/plain. Useful for types like text/x-authors.


Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2006-10-15 11:29:35 UTC (rev 522)
+++ trunk/UI/GTK2/src/mainWindow.cc	2006-10-16 13:59:29 UTC (rev 523)
@@ -3003,9 +3003,20 @@
 					type = "text/html";
 					foundAction = MIMEScanner::getDefaultAction(type, action);
 #ifdef DEBUG
-					cout << "mainWindow::view_documents: defaulting to test/html" << endl;
+					cout << "mainWindow::view_documents: defaulting to text/html" << endl;
 #endif
 				}
+				else if ((type.length() > 5) &&
+					(type.substr(0, 5) == "text/"))
+				{
+					// It's a subtype of text
+					// FIXME: MIMEScanner should return parent types !
+					type = "text/plain";
+					foundAction = MIMEScanner::getDefaultAction(type, action);
+#ifdef DEBUG
+					cout << "mainWindow::view_documents: defaulting to text/plain" << endl;
+#endif
+				}
 
 				if (foundAction == false)
 				{



From fabricecolin at mail.berlios.de  Tue Oct 17 15:34:04 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 17 Oct 2006 15:34:04 +0200
Subject: [Pinot-svn] r524 - in trunk: Index Search UI/GTK2/src
Message-ID: <200610171334.k9HDY46m009992@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-17 15:34:03 +0200 (Tue, 17 Oct 2006)
New Revision: 524

Modified:
   trunk/Index/XapianIndex.cpp
   trunk/Search/XapianEngine.cpp
   trunk/UI/GTK2/src/WorkerThreads.cpp
Log:
Finally woke up to the fact that :
- abstracts were most of the time bogus because term position wasn't incremented
 correctly at indexing time.
- updates didn't happen correctly, most of the time ? It seems to be due to the
 call to setDocumentLabels right after updateDocument. It was extraneous anyway
 since updateDocument preserves labels.
Doh !
Abstracts are generated for all documents, even if they have a sample field, as
produced by omindex. Some tweaks to the QueryParser setup.


Modified: trunk/Index/XapianIndex.cpp
===================================================================
--- trunk/Index/XapianIndex.cpp	2006-10-16 13:59:29 UTC (rev 523)
+++ trunk/Index/XapianIndex.cpp	2006-10-17 13:34:03 UTC (rev 524)
@@ -234,13 +234,13 @@
 		if ((mode == STORE_UNSTEM) ||
 			(pStemmer == NULL))
 		{
-			doc.add_posting(limitTermLength(prefix + term), termPos++);
+			doc.add_posting(limitTermLength(prefix + term), termPos);
 		}
 		else if (mode == STORE_STEM)
 		{
 			string stemmedTerm = pStemmer->stem_word(term);
 
-			doc.add_posting(limitTermLength(prefix + stemmedTerm), termPos++);
+			doc.add_posting(limitTermLength(prefix + stemmedTerm), termPos);
 		}
 		else if (mode == STORE_BOTH)
 		{
@@ -251,9 +251,11 @@
 			if (stemmedTerm != term)
 			{
 				// No point adding the same term twice
-				doc.add_posting(limitTermLength(prefix + stemmedTerm), termPos++);
+				doc.add_posting(limitTermLength(prefix + stemmedTerm), termPos);
 			}
 		}
+
+		++termPos;
 	}
 #ifdef DEBUG
 	cout << "XapianIndex::addPostingsToDocument: added " << termPos << " terms" << endl;
@@ -524,6 +526,9 @@
 	char timeStr[64];
 	time_t timeT = TimeConverter::fromTimestamp(timestamp);
 
+	// Add this value to allow sorting by date
+	doc.add_value(0, StringManip::integerToBinaryString((uint32_t)timeT));
+
 	// Set the document data omindex-style
 	string record = "url=";
 	record += info.getLocation();
@@ -557,9 +562,6 @@
 	cout << "XapianIndex::setDocumentData: document data is " << record << endl;
 #endif
 	doc.set_data(record);
-
-	// Add this value to allow sorting by date
-	doc.add_value(0, StringManip::integerToBinaryString((uint32_t)timeT));
 }
 
 //

Modified: trunk/Search/XapianEngine.cpp
===================================================================
--- trunk/Search/XapianEngine.cpp	2006-10-16 13:59:29 UTC (rev 523)
+++ trunk/Search/XapianEngine.cpp	2006-10-17 13:34:03 UTC (rev 524)
@@ -113,12 +113,16 @@
 	Xapian::QueryParser parser;
 	Xapian::Stem stemmer;
 
+	// Set things up
 	if (stemLanguage.empty() == false)
 	{
 		stemmer = Xapian::Stem(StringManip::toLowerCase(stemLanguage));
+		parser.set_stemming_strategy(Xapian::QueryParser::STEM_NONE);
 	}
-
-	// Set things up
+	else
+	{
+		parser.set_stemming_strategy(Xapian::QueryParser::STEM_ALL);
+	}
 	parser.set_stemmer(stemmer);
 	if (followOperators == true)
 	{
@@ -231,6 +235,7 @@
 				{
 					Xapian::docid docId = *mIter;
 					Xapian::Document doc(mIter.get_document());
+					AbstractGenerator abstractGen(pIndex, 50);
 					string record = doc.get_data();
 
 					// Get the title
@@ -259,16 +264,9 @@
 					// ...and the language, if available
 					string language = StringManip::extractField(record, "language=", "\n");
 
-					// Finally, get a summary
-					string summary = StringManip::extractField(record, "sample=", "\n");
-					if (summary.empty() == true)
-					{
-						AbstractGenerator abstractGen(pIndex, 50);
+					// Generate an abstract based on the query's terms
+					string summary = abstractGen.generateAbstract(seedTerms, docId);
 
-						// Generate an abstract based on the query's terms
-						summary = abstractGen.generateAbstract(seedTerms, docId);
-					}
-
 					// Add this result
 					Result thisResult(url, title, summary, language, (float)mIter.get_percent());
 					m_resultsList.push_back(thisResult);

Modified: trunk/UI/GTK2/src/WorkerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.cpp	2006-10-16 13:59:29 UTC (rev 523)
+++ trunk/UI/GTK2/src/WorkerThreads.cpp	2006-10-17 13:34:03 UTC (rev 524)
@@ -1186,8 +1186,6 @@
 
 		if (m_done == false)
 		{
-			const set<string> &labels = m_docInfo.getLabels();
-
 			pIndex->setStemmingMode(IndexInterface::STORE_BOTH);
 
 			// Update an existing document or add to the index ?
@@ -1198,12 +1196,10 @@
 				{
 					success = true;
 				}
-
-				// Set the document's labels
-				pIndex->setDocumentLabels(m_docId, labels, false);
 			}
 			else
 			{
+				const set<string> &labels = m_docInfo.getLabels();
 				unsigned int docId = 0;
 
 				// Index the document



From fabricecolin at mail.berlios.de  Tue Oct 17 15:37:06 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 17 Oct 2006 15:37:06 +0200
Subject: [Pinot-svn] r525 - trunk/Utils/xdgmime
Message-ID: <200610171337.k9HDb6fB010704@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-17 15:37:06 +0200 (Tue, 17 Oct 2006)
New Revision: 525

Modified:
   trunk/Utils/xdgmime/xdgmime.c
   trunk/Utils/xdgmime/xdgmime.h
   trunk/Utils/xdgmime/xdgmimealias.c
   trunk/Utils/xdgmime/xdgmimecache.c
   trunk/Utils/xdgmime/xdgmimeglob.c
   trunk/Utils/xdgmime/xdgmimemagic.c
Log:
Imported GTK+'s version of xdgmime.


Modified: trunk/Utils/xdgmime/xdgmime.c
===================================================================
--- trunk/Utils/xdgmime/xdgmime.c	2006-10-17 13:34:03 UTC (rev 524)
+++ trunk/Utils/xdgmime/xdgmime.c	2006-10-17 13:37:06 UTC (rev 525)
@@ -60,7 +60,7 @@
 XdgMimeCache **_caches = NULL;
 static int n_caches = 0;
 
-const char *xdg_mime_type_unknown = "application/octet-stream";
+const char xdg_mime_type_unknown[] = "application/octet-stream";
 
 
 enum
@@ -281,7 +281,8 @@
  * FIXME: This doesn't protect against permission changes.
  */
 static int
-xdg_check_file (const char *file_path)
+xdg_check_file (const char *file_path,
+                int        *exists)
 {
   struct stat st;
 
@@ -290,6 +291,9 @@
     {
       XdgDirTimeList *list;
 
+      if (exists)
+        *exists = TRUE;
+
       for (list = dir_time_list; list; list = list->next)
 	{
 	  if (! strcmp (list->directory_name, file_path) &&
@@ -306,6 +310,9 @@
       return TRUE;
     }
 
+  if (exists)
+    *exists = FALSE;
+
   return FALSE;
 }
 
@@ -313,26 +320,30 @@
 xdg_check_dir (const char *directory,
 	       int        *invalid_dir_list)
 {
-  int invalid;
+  int invalid, exists;
   char *file_name;
 
   assert (directory != NULL);
 
-  /* Check the globs file */
-  file_name = malloc (strlen (directory) + strlen ("/mime/globs") + 1);
-  strcpy (file_name, directory); strcat (file_name, "/mime/globs");
-  invalid = xdg_check_file (file_name);
+  /* Check the mime.cache file */
+  file_name = malloc (strlen (directory) + strlen ("/mime/mime.cache") + 1);
+  strcpy (file_name, directory); strcat (file_name, "/mime/mime.cache");
+  invalid = xdg_check_file (file_name, &exists);
   free (file_name);
   if (invalid)
     {
       *invalid_dir_list = TRUE;
       return TRUE;
     }
+  else if (exists)
+    {
+      return FALSE;
+    }
 
-  /* Check the magic file */
-  file_name = malloc (strlen (directory) + strlen ("/mime/magic") + 1);
-  strcpy (file_name, directory); strcat (file_name, "/mime/magic");
-  invalid = xdg_check_file (file_name);
+  /* Check the globs file */
+  file_name = malloc (strlen (directory) + strlen ("/mime/globs") + 1);
+  strcpy (file_name, directory); strcat (file_name, "/mime/globs");
+  invalid = xdg_check_file (file_name, NULL);
   free (file_name);
   if (invalid)
     {
@@ -340,10 +351,10 @@
       return TRUE;
     }
 
-  /* Check the mime.cache file */
-  file_name = malloc (strlen (directory) + strlen ("/mime/mime.cache") + 1);
-  strcpy (file_name, directory); strcat (file_name, "/mime/mime.cache");
-  invalid = xdg_check_file (file_name);
+  /* Check the magic file */
+  file_name = malloc (strlen (directory) + strlen ("/mime/magic") + 1);
+  strcpy (file_name, directory); strcat (file_name, "/mime/magic");
+  invalid = xdg_check_file (file_name, NULL);
   free (file_name);
   if (invalid)
     {
@@ -528,15 +539,15 @@
 const char *
 xdg_mime_get_mime_type_from_file_name (const char *file_name)
 {
-  const char *mime_types[2];
+  const char *mime_type;
 
   xdg_mime_init ();
 
   if (_caches)
     return _xdg_mime_cache_get_mime_type_from_file_name (file_name);
 
-  if (_xdg_glob_hash_lookup_file_name (global_hash, file_name, mime_types, 2) == 1)
-    return mime_types[0];
+  if (_xdg_glob_hash_lookup_file_name (global_hash, file_name, &mime_type, 1))
+    return mime_type;
   else
     return XDG_MIME_TYPE_UNKNOWN;
 }
@@ -584,6 +595,17 @@
       parent_list = NULL;
     }
   
+  if (_caches)
+    {
+      int i;
+
+      for (i = 0; i < n_caches; i++)
+        _xdg_mime_cache_unref (_caches[i]);
+      free (_caches);
+      _caches = NULL;
+      n_caches = 0;
+    }
+
   for (list = callback_list; list; list = list->next)
     (list->callback) (list->data);
 
@@ -602,12 +624,10 @@
 }
 
 const char *
-xdg_mime_unalias_mime_type (const char *mime_type)
+_xdg_mime_unalias_mime_type (const char *mime_type)
 {
   const char *lookup;
 
-  xdg_mime_init ();
-
   if (_caches)
     return _xdg_mime_cache_unalias_mime_type (mime_type);
 
@@ -617,17 +637,23 @@
   return mime_type;
 }
 
+const char *
+xdg_mime_unalias_mime_type (const char *mime_type)
+{
+  xdg_mime_init ();
+
+  return _xdg_mime_unalias_mime_type (mime_type);
+}
+
 int
-xdg_mime_mime_type_equal (const char *mime_a,
-			  const char *mime_b)
+_xdg_mime_mime_type_equal (const char *mime_a,
+			   const char *mime_b)
 {
   const char *unalias_a, *unalias_b;
 
-  xdg_mime_init ();
+  unalias_a = _xdg_mime_unalias_mime_type (mime_a);
+  unalias_b = _xdg_mime_unalias_mime_type (mime_b);
 
-  unalias_a = xdg_mime_unalias_mime_type (mime_a);
-  unalias_b = xdg_mime_unalias_mime_type (mime_b);
-
   if (strcmp (unalias_a, unalias_b) == 0)
     return 1;
 
@@ -635,6 +661,15 @@
 }
 
 int
+xdg_mime_mime_type_equal (const char *mime_a,
+			  const char *mime_b)
+{
+  xdg_mime_init ();
+
+  return _xdg_mime_mime_type_equal (mime_a, mime_b);
+}
+
+int
 xdg_mime_media_type_equal (const char *mime_a,
 			   const char *mime_b)
 {
@@ -650,7 +685,7 @@
   return 0;
 }
 
-#if 0
+#if 1
 static int
 xdg_mime_is_super_type (const char *mime)
 {
@@ -668,24 +703,22 @@
 #endif
 
 int
-xdg_mime_mime_type_subclass (const char *mime,
-			     const char *base)
+_xdg_mime_mime_type_subclass (const char *mime,
+			      const char *base)
 {
   const char *umime, *ubase;
   const char **parents;
 
-  xdg_mime_init ();
-
   if (_caches)
     return _xdg_mime_cache_mime_type_subclass (mime, base);
 
-  umime = xdg_mime_unalias_mime_type (mime);
-  ubase = xdg_mime_unalias_mime_type (base);
+  umime = _xdg_mime_unalias_mime_type (mime);
+  ubase = _xdg_mime_unalias_mime_type (base);
 
   if (strcmp (umime, ubase) == 0)
     return 1;
 
-#if 0  
+#if 1  
   /* Handle supertypes */
   if (xdg_mime_is_super_type (ubase) &&
       xdg_mime_media_type_equal (umime, ubase))
@@ -703,13 +736,22 @@
   parents = _xdg_mime_parent_list_lookup (parent_list, umime);
   for (; parents && *parents; parents++)
     {
-      if (xdg_mime_mime_type_subclass (*parents, ubase))
+      if (_xdg_mime_mime_type_subclass (*parents, ubase))
 	return 1;
     }
 
   return 0;
 }
 
+int
+xdg_mime_mime_type_subclass (const char *mime,
+			     const char *base)
+{
+  xdg_mime_init ();
+
+  return _xdg_mime_mime_type_subclass (mime, base);
+}
+
 char **
 xdg_mime_list_mime_parents (const char *mime)
 {
@@ -741,7 +783,7 @@
 
   xdg_mime_init ();
 
-  umime = xdg_mime_unalias_mime_type (mime);
+  umime = _xdg_mime_unalias_mime_type (mime);
 
   return _xdg_mime_parent_list_lookup (parent_list, umime);
 }

Modified: trunk/Utils/xdgmime/xdgmime.h
===================================================================
--- trunk/Utils/xdgmime/xdgmime.h	2006-10-17 13:34:03 UTC (rev 524)
+++ trunk/Utils/xdgmime/xdgmime.h	2006-10-17 13:37:06 UTC (rev 525)
@@ -59,12 +59,13 @@
 #define xdg_mime_unalias_mime_type            XDG_ENTRY(unalias_mime_type)
 #define xdg_mime_get_max_buffer_extents       XDG_ENTRY(get_max_buffer_extents)
 #define xdg_mime_shutdown                     XDG_ENTRY(shutdown)
+#define xdg_mime_dump                         XDG_ENTRY(dump)
 #define xdg_mime_register_reload_callback     XDG_ENTRY(register_reload_callback)
 #define xdg_mime_remove_callback              XDG_ENTRY(remove_callback)
 #define xdg_mime_type_unknown                 XDG_ENTRY(type_unknown)
 #endif
 
-extern const char *xdg_mime_type_unknown;
+extern const char xdg_mime_type_unknown[];
 #define XDG_MIME_TYPE_UNKNOWN xdg_mime_type_unknown
 
 const char  *xdg_mime_get_mime_type_for_data       (const void *data,
@@ -95,8 +96,16 @@
 						    XdgMimeDestroy   destroy);
 void         xdg_mime_remove_callback              (int              callback_id);
 
+   /* Private versions of functions that don't call xdg_mime_init () */
+int          _xdg_mime_mime_type_equal             (const char *mime_a,
+						    const char *mime_b);
+int          _xdg_mime_media_type_equal            (const char *mime_a,
+						    const char *mime_b);
+int          _xdg_mime_mime_type_subclass          (const char *mime,
+						    const char *base);
+
+
 #ifdef __cplusplus
 }
 #endif /* __cplusplus */
-
 #endif /* __XDG_MIME_H__ */

Modified: trunk/Utils/xdgmime/xdgmimealias.c
===================================================================
--- trunk/Utils/xdgmime/xdgmimealias.c	2006-10-17 13:34:03 UTC (rev 524)
+++ trunk/Utils/xdgmime/xdgmimealias.c	2006-10-17 13:37:06 UTC (rev 525)
@@ -105,7 +105,7 @@
   if (list->n_aliases > 0)
     {
       key.alias = (char *)alias;
-      key.mime_type = 0;
+      key.mime_type = NULL;
 
       entry = bsearch (&key, list->aliases, list->n_aliases,
 		       sizeof (XdgAlias), alias_entry_cmp);

Modified: trunk/Utils/xdgmime/xdgmimecache.c
===================================================================
--- trunk/Utils/xdgmime/xdgmimecache.c	2006-10-17 13:34:03 UTC (rev 524)
+++ trunk/Utils/xdgmime/xdgmimecache.c	2006-10-17 13:37:06 UTC (rev 525)
@@ -737,10 +737,10 @@
 const char *
 _xdg_mime_cache_get_mime_type_from_file_name (const char *file_name)
 {
-  const char *mime_types[2];
+  const char *mime_type;
 
-  if (cache_glob_lookup_file_name (file_name, mime_types, 2) == 1)
-    return mime_types[0];
+  if (cache_glob_lookup_file_name (file_name, &mime_type, 1))
+    return mime_type;
   else
     return XDG_MIME_TYPE_UNKNOWN;
 }

Modified: trunk/Utils/xdgmime/xdgmimeglob.c
===================================================================
--- trunk/Utils/xdgmime/xdgmimeglob.c	2006-10-17 13:34:03 UTC (rev 524)
+++ trunk/Utils/xdgmime/xdgmimeglob.c	2006-10-17 13:37:06 UTC (rev 525)
@@ -263,7 +263,7 @@
 		{
 		  child = _xdg_glob_hash_node_new ();
 		  child->character = '\000';
-		  child->mime_type = strdup (mime_type);
+		  child->mime_type = mime_type;
 		  child->child = NULL;
 		  child->next = node->child;
 		  node->child = child;
@@ -272,7 +272,7 @@
 	}
       else
 	{
-	  node->mime_type = strdup (mime_type);
+	  node->mime_type = mime_type;
 	}
     }
   else
@@ -308,11 +308,13 @@
 	  if (*file_name == '\000')
 	    {
 	      n = 0;
-	      mime_types[n++] = node->mime_type;
+              if (node->mime_type)
+	        mime_types[n++] = node->mime_type;
 	      node = node->child;
 	      while (n < n_mime_types && node && node->character == 0)
 		{
-		  mime_types[n++] = node->mime_type;
+                  if (node->mime_type)
+		    mime_types[n++] = node->mime_type;
 		  node = node->next;
 		}
 	    }
@@ -475,7 +477,7 @@
       glob_hash->literal_list = _xdg_glob_list_append (glob_hash->literal_list, strdup (glob), strdup (mime_type));
       break;
     case XDG_GLOB_SIMPLE:
-      glob_hash->simple_node = _xdg_glob_hash_insert_text (glob_hash->simple_node, glob + 1, mime_type);
+      glob_hash->simple_node = _xdg_glob_hash_insert_text (glob_hash->simple_node, glob + 1, strdup (mime_type));
       break;
     case XDG_GLOB_FULL:
       glob_hash->full_list = _xdg_glob_list_append (glob_hash->full_list, strdup (glob), strdup (mime_type));

Modified: trunk/Utils/xdgmime/xdgmimemagic.c
===================================================================
--- trunk/Utils/xdgmime/xdgmimemagic.c	2006-10-17 13:34:03 UTC (rev 524)
+++ trunk/Utils/xdgmime/xdgmimemagic.c	2006-10-17 13:37:06 UTC (rev 525)
@@ -47,8 +47,6 @@
 #define	TRUE	(!FALSE)
 #endif
 
-extern int errno;
-
 typedef struct XdgMimeMagicMatch XdgMimeMagicMatch;
 typedef struct XdgMimeMagicMatchlet XdgMimeMagicMatchlet;
 
@@ -474,9 +472,7 @@
       /* We clean up the matchlet, byte swapping if needed */
       if (matchlet->word_size > 1)
 	{
-#if LITTLE_ENDIAN
 	  int i;
-#endif
 	  if (matchlet->value_length % matchlet->word_size != 0)
 	    {
 	      _xdg_mime_magic_matchlet_free (matchlet);
@@ -662,35 +658,22 @@
   XdgMimeMagicMatch *match;
   const char *mime_type;
   int n;
-  int priority;
-  int had_match;
 
   mime_type = NULL;
-  priority = 0;
-  had_match = 0;
   for (match = mime_magic->match_list; match; match = match->next)
     {
       if (_xdg_mime_magic_match_compare_to_data (match, data, len))
 	{
-	  if (!had_match || match->priority > priority ||
-	      (mime_type != NULL && xdg_mime_mime_type_subclass (match->mime_type, mime_type)))
-	    {
-	      mime_type = match->mime_type;
-	      priority = match->priority;
-	    }
-	  else if (had_match && match->priority == priority)
-	    /* multiple unrelated patterns with the same priority matched,
-	     * so we can't tell what type this is. */
-	    mime_type = NULL;
-
-	  had_match = 1;
+	  if ((mime_type == NULL) || (_xdg_mime_mime_type_subclass (match->mime_type, mime_type))) {
+	    mime_type = match->mime_type;
+	  }
 	}
       else 
 	{
 	  for (n = 0; n < n_mime_types; n++)
 	    {
 	      if (mime_types[n] && 
-		  xdg_mime_mime_type_equal (mime_types[n], match->mime_type))
+		  _xdg_mime_mime_type_equal (mime_types[n], match->mime_type))
 		mime_types[n] = NULL;
 	    }
 	}



From fabricecolin at mail.berlios.de  Wed Oct 18 14:36:34 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Wed, 18 Oct 2006 14:36:34 +0200
Subject: [Pinot-svn] r526 - trunk/po
Message-ID: <200610181236.k9ICaYZn004980@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-18 14:36:32 +0200 (Wed, 18 Oct 2006)
New Revision: 526

Modified:
   trunk/po/es.po
   trunk/po/fr.po
Log:
Updated translations.


Modified: trunk/po/es.po
===================================================================
--- trunk/po/es.po	2006-10-17 13:37:06 UTC (rev 525)
+++ trunk/po/es.po	2006-10-18 12:36:32 UTC (rev 526)
@@ -8,8 +8,8 @@
 msgstr ""
 "Project-Id-Version: pinot 0.49\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2006-09-23 15:56+0800\n"
-"PO-Revision-Date: 2006-09-25 20:23+0800\n"
+"POT-Creation-Date: 2006-10-17 21:42+0800\n"
+"PO-Revision-Date: 2006-10-18 20:38+0800\n"
 "Last-Translator: Jes?s Tramullas <jesus at tramullas.com>\n"
 "Language-Team: es <jesus at tramullas.com>\n"
 "MIME-Version: 1.0\n"
@@ -24,24 +24,22 @@
 msgid "Current User"
 msgstr "Usuario"
 
-#: UI/GTK2/src/EnginesTree.cpp:339 UI/GTK2/src/mainWindow.cc:186
-#: UI/GTK2/src/mainWindow.cc:304 UI/GTK2/src/mainWindow.cc:307
-#: UI/GTK2/src/mainWindow.cc:533 UI/GTK2/src/mainWindow.cc:1139
-#: UI/GTK2/src/mainWindow.cc:1181 UI/GTK2/src/mainWindow.cc:1201
-#: UI/GTK2/src/mainWindow.cc:1232 UI/GTK2/src/mainWindow.cc:1807
-#: UI/GTK2/src/PinotSettings.cpp:230 UI/GTK2/src/PinotSettings.cpp:1081
-#: UI/GTK2/src/PinotSettings.cpp:1137
+#: UI/GTK2/src/EnginesTree.cpp:339 UI/GTK2/src/mainWindow.cc:309
+#: UI/GTK2/src/mainWindow.cc:312 UI/GTK2/src/mainWindow.cc:538
+#: UI/GTK2/src/mainWindow.cc:1141 UI/GTK2/src/mainWindow.cc:1183
+#: UI/GTK2/src/mainWindow.cc:1203 UI/GTK2/src/mainWindow.cc:1234
+#: UI/GTK2/src/mainWindow.cc:1806 UI/GTK2/src/PinotSettings.cpp:231
+#: UI/GTK2/src/PinotSettings.cpp:1145 UI/GTK2/src/PinotSettings.cpp:1201
 msgid "My Web Pages"
 msgstr "Mis Paginas Web"
 
-#: UI/GTK2/src/EnginesTree.cpp:340 UI/GTK2/src/mainWindow.cc:298
-#: UI/GTK2/src/mainWindow.cc:301 UI/GTK2/src/PinotSettings.cpp:231
-#: UI/GTK2/src/PinotSettings.cpp:1082 UI/GTK2/src/PinotSettings.cpp:1138
-#: UI/GTK2/src/prefsDialog_glade.cc:112
+#: UI/GTK2/src/EnginesTree.cpp:340 UI/GTK2/src/mainWindow.cc:303
+#: UI/GTK2/src/mainWindow.cc:306 UI/GTK2/src/PinotSettings.cpp:232
+#: UI/GTK2/src/PinotSettings.cpp:1146 UI/GTK2/src/PinotSettings.cpp:1202
 msgid "My Documents"
 msgstr "Mis documentos"
 
-#: UI/GTK2/src/importDialog.cc:81 UI/GTK2/src/queryDialog.cc:91
+#: UI/GTK2/src/importDialog.cc:81 UI/GTK2/src/queryDialog.cc:79
 msgid "None"
 msgstr "Ninguno"
 
@@ -70,7 +68,7 @@
 msgid "Index location"
 msgstr "Localizaci?n del ?ndice"
 
-#: UI/GTK2/src/indexDialog_glade.cc:62 UI/GTK2/src/queryDialog_glade.cc:65
+#: UI/GTK2/src/indexDialog_glade.cc:62 UI/GTK2/src/queryDialog_glade.cc:68
 msgid "Name:"
 msgstr "Nombre:"
 
@@ -90,11 +88,13 @@
 msgid "External index"
 msgstr "?ndice externo"
 
-#: UI/GTK2/src/IndexTree.cpp:63 UI/GTK2/src/ResultsTree.cpp:131
+#: UI/GTK2/src/IndexTree.cpp:63 UI/GTK2/src/queryDialog.cc:107
+#: UI/GTK2/src/ResultsTree.cpp:131
 msgid "Title"
 msgstr "T?tulo"
 
-#: UI/GTK2/src/IndexTree.cpp:68 UI/GTK2/src/ResultsTree.cpp:141
+#: UI/GTK2/src/IndexTree.cpp:68 UI/GTK2/src/queryDialog.cc:110
+#: UI/GTK2/src/ResultsTree.cpp:141
 msgid "URL"
 msgstr "URL"
 
@@ -114,253 +114,257 @@
 msgid "All labels"
 msgstr "Todas las etiquetas"
 
-#: UI/GTK2/src/mainWindow.cc:131
+#: UI/GTK2/src/mainWindow.cc:138
 msgid "Query Name"
 msgstr "Nombre de la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:136
+#: UI/GTK2/src/mainWindow.cc:143
 msgid "Last Run"
 msgstr "?ltima ejecuci?n"
 
-#: UI/GTK2/src/mainWindow.cc:141
+#: UI/GTK2/src/mainWindow.cc:148
 msgid "Summary"
 msgstr "Sumario"
 
-#: UI/GTK2/src/mainWindow.cc:174
+#: UI/GTK2/src/mainWindow.cc:181
+msgid "Show all search engines"
+msgstr "Mostrar todos los motores de b?squeda"
+
+#: UI/GTK2/src/mainWindow.cc:182
 msgid "Add index"
 msgstr "A?adir ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:175
+#: UI/GTK2/src/mainWindow.cc:183
 msgid "Remove index"
 msgstr "Borrar ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:181
+#: UI/GTK2/src/mainWindow.cc:189
 msgid "Ready"
 msgstr "Listo"
 
-#: UI/GTK2/src/mainWindow.cc:227
+#: UI/GTK2/src/mainWindow.cc:232
 msgid "N/A"
 msgstr "Desconocido"
 
-#: UI/GTK2/src/mainWindow.cc:237
+#: UI/GTK2/src/mainWindow.cc:242
 msgid "<undefined>"
 msgstr "<indefinido>"
 
-#: UI/GTK2/src/mainWindow.cc:456
+#: UI/GTK2/src/mainWindow.cc:461
 msgid "Result location is"
 msgstr "La localizaci?n del resultado es"
 
-#: UI/GTK2/src/mainWindow.cc:543
+#: UI/GTK2/src/mainWindow.cc:548
 msgid "Document location is"
 msgstr "La localizaci?n del documento es"
 
-#: UI/GTK2/src/mainWindow.cc:861
+#: UI/GTK2/src/mainWindow.cc:866
 msgid "Showing"
 msgstr "Mostrando"
 
-#: UI/GTK2/src/mainWindow.cc:866
+#: UI/GTK2/src/mainWindow.cc:871
 msgid "of"
 msgstr "documentos"
 
-#: UI/GTK2/src/mainWindow.cc:871
+#: UI/GTK2/src/mainWindow.cc:876
 msgid "documents, starting at"
 msgstr "documentos comenzando en"
 
-#: UI/GTK2/src/mainWindow.cc:907
+#: UI/GTK2/src/mainWindow.cc:909
 msgid "Query"
 msgstr "B?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:911 UI/GTK2/src/mainWindow.cc:2849
+#: UI/GTK2/src/mainWindow.cc:913 UI/GTK2/src/mainWindow.cc:2857
 msgid "on"
 msgstr "en"
 
-#: UI/GTK2/src/mainWindow.cc:915
+#: UI/GTK2/src/mainWindow.cc:917
 msgid "ended"
 msgstr "finalizado"
 
-#: UI/GTK2/src/mainWindow.cc:1004
+#: UI/GTK2/src/mainWindow.cc:1006
 msgid "More Like"
 msgstr "M?s como"
 
-#: UI/GTK2/src/mainWindow.cc:1065
+#: UI/GTK2/src/mainWindow.cc:1067
 msgid "Updated label(s)"
 msgstr "Etiqueta(s) actualizada(s)"
 
-#: UI/GTK2/src/mainWindow.cc:1149
+#: UI/GTK2/src/mainWindow.cc:1151
 msgid "Updated document"
 msgstr "Documento actualizado"
 
-#: UI/GTK2/src/mainWindow.cc:1162
+#: UI/GTK2/src/mainWindow.cc:1164
 msgid "Indexed"
 msgstr "Indizado"
 
-#: UI/GTK2/src/mainWindow.cc:1202
+#: UI/GTK2/src/mainWindow.cc:1204
 msgid "Unindexed document(s)"
 msgstr "Documento(s) no indizado(s)"
 
-#: UI/GTK2/src/mainWindow.cc:1243
+#: UI/GTK2/src/mainWindow.cc:1245
 msgid "Updated document properties"
 msgstr "Propiedades del documento actualizadas"
 
-#: UI/GTK2/src/mainWindow.cc:1290
+#: UI/GTK2/src/mainWindow.cc:1292
 msgid "Couldn't rename index, name"
 msgstr "No se pudo renombrar ?ndice, nombre"
 
-#: UI/GTK2/src/mainWindow.cc:1294 UI/GTK2/src/mainWindow.cc:2184
-#: UI/GTK2/src/mainWindow.cc:2683
+#: UI/GTK2/src/mainWindow.cc:1296 UI/GTK2/src/mainWindow.cc:2183
+#: UI/GTK2/src/mainWindow.cc:2692
 msgid "is already in use"
 msgstr "ya est? en uso"
 
-#: UI/GTK2/src/mainWindow.cc:1307
+#: UI/GTK2/src/mainWindow.cc:1309
 msgid "Couldn't rename index"
 msgstr "No se pudo renombrar el ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:1320
+#: UI/GTK2/src/mainWindow.cc:1322
 msgid "Edited index"
 msgstr "?ndice editado"
 
-#: UI/GTK2/src/mainWindow.cc:1689 UI/GTK2/src/mainWindow.cc:2341
+#: UI/GTK2/src/mainWindow.cc:1688 UI/GTK2/src/mainWindow.cc:2353
 msgid "Live query"
 msgstr "B?squeda activa"
 
-#: UI/GTK2/src/mainWindow.cc:1715
+#: UI/GTK2/src/mainWindow.cc:1714
 msgid "Couldn't find query"
 msgstr "No se pudo a?adir la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:1759 UI/GTK2/src/mainWindow.cc:1851
+#: UI/GTK2/src/mainWindow.cc:1758 UI/GTK2/src/mainWindow.cc:1850
 msgid "Please set a location for the index first"
 msgstr "Por favor, primero fije una localizaci?n para el ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:1924 UI/GTK2/src/WorkerThreads.cpp:620
-#: UI/GTK2/src/WorkerThreads.cpp:1400
+#: UI/GTK2/src/mainWindow.cc:1923 UI/GTK2/src/WorkerThreads.cpp:620
+#: UI/GTK2/src/WorkerThreads.cpp:1396
 msgid "Index"
 msgstr "?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:1928 UI/GTK2/src/WorkerThreads.cpp:624
-#: UI/GTK2/src/WorkerThreads.cpp:1404
+#: UI/GTK2/src/mainWindow.cc:1927 UI/GTK2/src/WorkerThreads.cpp:624
+#: UI/GTK2/src/WorkerThreads.cpp:1400
 msgid "doesn't exist"
 msgstr "no existe"
 
-#: UI/GTK2/src/mainWindow.cc:2072
+#: UI/GTK2/src/mainWindow.cc:2071
 msgid "Remove this document from the index ?"
 msgstr "?Borrar este documento del ?ndice?"
 
-#: UI/GTK2/src/mainWindow.cc:2091
+#: UI/GTK2/src/mainWindow.cc:2090
 msgid "Remove these documents from the index ?"
 msgstr "?Borrar este documento del ?ndice?"
 
-#: UI/GTK2/src/mainWindow.cc:2135
+#: UI/GTK2/src/mainWindow.cc:2134
 msgid "A metasearch tool for the Free Desktop"
 msgstr "Una herramienta metabuscador para el escritorio libre"
 
-#: UI/GTK2/src/mainWindow.cc:2136
+#: UI/GTK2/src/mainWindow.cc:2135
 msgid "(C) 2005-2006 Fabrice Colin"
 msgstr "(C) 2005-2006 Fabrice Colin"
 
-#: UI/GTK2/src/mainWindow.cc:2180
+#: UI/GTK2/src/mainWindow.cc:2179
 msgid "Index name"
 msgstr "Nombre del ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2195
+#: UI/GTK2/src/mainWindow.cc:2194
 msgid "Couldn't add index"
 msgstr "No se pudo a?adir el ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2209
+#: UI/GTK2/src/mainWindow.cc:2208
 msgid "Added new index"
 msgstr "A?adido un nuevo ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2244
+#: UI/GTK2/src/mainWindow.cc:2243
 msgid "Couldn't remove index"
 msgstr "No se pudo borrar el ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2498
+#: UI/GTK2/src/mainWindow.cc:2506
 msgid "At least one task hasn't completed yet. Quit now ?"
 msgstr "Al menos una tarea no ha finalizado. ?Parar ahora?"
 
-#: UI/GTK2/src/mainWindow.cc:2679
+#: UI/GTK2/src/mainWindow.cc:2688
 msgid "Query name"
 msgstr "Nombre la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:2706
+#: UI/GTK2/src/mainWindow.cc:2715
 msgid "Couldn't update query"
 msgstr "No se pudo actualizar la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:2714
+#: UI/GTK2/src/mainWindow.cc:2723
 msgid "Edited query"
 msgstr "B?squeda editada"
 
-#: UI/GTK2/src/mainWindow.cc:2721
+#: UI/GTK2/src/mainWindow.cc:2730
 msgid "Couldn't add query"
 msgstr "No se pudo a?adir la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:2729
+#: UI/GTK2/src/mainWindow.cc:2738
 msgid "Added new query"
 msgstr "A?adida una nueva b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:2743
+#: UI/GTK2/src/mainWindow.cc:2751
 msgid "Query is not set"
 msgstr "B?squeda no definida"
 
-#: UI/GTK2/src/mainWindow.cc:2754
+#: UI/GTK2/src/mainWindow.cc:2762
 msgid "No search engine selected"
 msgstr "Motor de b?squeda no seleccionado"
 
-#: UI/GTK2/src/mainWindow.cc:2836
+#: UI/GTK2/src/mainWindow.cc:2844
 msgid "Please set the Google API key first"
 msgstr "Por favor, primero configure el API de Google"
 
-#: UI/GTK2/src/mainWindow.cc:2845
+#: UI/GTK2/src/mainWindow.cc:2853
 msgid "Running query"
 msgstr "Ejecutando la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:3004
+#: UI/GTK2/src/mainWindow.cc:3023
 msgid "No default application defined for type"
 msgstr "No hay aplicaci?n predefinida para el tipo"
 
-#: UI/GTK2/src/mainWindow_glade.cc:121
+#: UI/GTK2/src/mainWindow_glade.cc:124
 msgid "Query:"
 msgstr "B?squeda:"
 
-#: UI/GTK2/src/mainWindow_glade.cc:133
+#: UI/GTK2/src/mainWindow_glade.cc:136
 msgid "Edit"
 msgstr "Editar"
 
-#: UI/GTK2/src/mainWindow_glade.cc:142
+#: UI/GTK2/src/mainWindow_glade.cc:145
 msgid "Stored queries"
 msgstr "B?squedas guardadas"
 
-#: UI/GTK2/src/mainWindow_glade.cc:177
+#: UI/GTK2/src/mainWindow_glade.cc:180
 msgid "Search Engine"
 msgstr "Motor de b?squeda"
 
-#: UI/GTK2/src/mainWindow_glade.cc:180
+#: UI/GTK2/src/mainWindow_glade.cc:183
 msgid "Host Name"
 msgstr "Nombre del servidor"
 
-#: UI/GTK2/src/mainWindow_glade.cc:183
+#: UI/GTK2/src/mainWindow_glade.cc:186
 msgid "Show Extract"
 msgstr "Mostrar extra?dos"
 
-#: UI/GTK2/src/mainWindow_glade.cc:186
+#: UI/GTK2/src/mainWindow_glade.cc:189
 msgid "Group By"
 msgstr "Agrupar por"
 
-#: UI/GTK2/src/mainWindow_glade.cc:189
+#: UI/GTK2/src/mainWindow_glade.cc:192
 msgid "Clear List"
 msgstr "Limpiar la lista"
 
-#: UI/GTK2/src/mainWindow_glade.cc:195
-msgid "More Like This"
-msgstr "Documentos similares"
-
-#: UI/GTK2/src/mainWindow_glade.cc:201
+#: UI/GTK2/src/mainWindow_glade.cc:198
 msgid "Vie_w"
 msgstr "Ver"
 
-#: UI/GTK2/src/mainWindow_glade.cc:204
+#: UI/GTK2/src/mainWindow_glade.cc:201
 msgid "View Cache"
 msgstr "Ver la cache"
 
+#: UI/GTK2/src/mainWindow_glade.cc:204
+msgid "More Like This"
+msgstr "Documentos similares"
+
 #: UI/GTK2/src/mainWindow_glade.cc:207 UI/GTK2/src/mainWindow_glade.cc:243
 msgid "_Index"
 msgstr "?ndice"
@@ -406,75 +410,75 @@
 msgid "_Help"
 msgstr "Ayuda"
 
-#: UI/GTK2/src/mainWindow_glade.cc:375
+#: UI/GTK2/src/mainWindow_glade.cc:383
 msgid "Pinot"
 msgstr "Pinot"
 
-#: UI/GTK2/src/pinot.cc:164 UI/GTK2/src/pinot-dbus-daemon.cc:681
+#: UI/GTK2/src/pinot.cc:164 UI/GTK2/src/pinot-dbus-daemon.cc:680
 msgid "Unknown"
 msgstr "Desconocido"
 
-#: UI/GTK2/src/pinot.cc:165 UI/GTK2/src/pinot-dbus-daemon.cc:682
+#: UI/GTK2/src/pinot.cc:165 UI/GTK2/src/pinot-dbus-daemon.cc:681
 msgid "Danish"
 msgstr "Dan?s"
 
-#: UI/GTK2/src/pinot.cc:166 UI/GTK2/src/pinot-dbus-daemon.cc:683
+#: UI/GTK2/src/pinot.cc:166 UI/GTK2/src/pinot-dbus-daemon.cc:682
 msgid "Dutch"
 msgstr "Holand?s"
 
-#: UI/GTK2/src/pinot.cc:167 UI/GTK2/src/pinot-dbus-daemon.cc:684
+#: UI/GTK2/src/pinot.cc:167 UI/GTK2/src/pinot-dbus-daemon.cc:683
 msgid "English"
 msgstr "Ingl?s"
 
-#: UI/GTK2/src/pinot.cc:168 UI/GTK2/src/pinot-dbus-daemon.cc:685
+#: UI/GTK2/src/pinot.cc:168 UI/GTK2/src/pinot-dbus-daemon.cc:684
 msgid "Finnish"
 msgstr "Finland?s"
 
-#: UI/GTK2/src/pinot.cc:169 UI/GTK2/src/pinot-dbus-daemon.cc:686
+#: UI/GTK2/src/pinot.cc:169 UI/GTK2/src/pinot-dbus-daemon.cc:685
 msgid "French"
 msgstr "Franc?s"
 
-#: UI/GTK2/src/pinot.cc:170 UI/GTK2/src/pinot-dbus-daemon.cc:687
+#: UI/GTK2/src/pinot.cc:170 UI/GTK2/src/pinot-dbus-daemon.cc:686
 msgid "German"
 msgstr "Alem?n"
 
-#: UI/GTK2/src/pinot.cc:171 UI/GTK2/src/pinot-dbus-daemon.cc:688
+#: UI/GTK2/src/pinot.cc:171 UI/GTK2/src/pinot-dbus-daemon.cc:687
 msgid "Italian"
 msgstr "Italiano"
 
-#: UI/GTK2/src/pinot.cc:172 UI/GTK2/src/pinot-dbus-daemon.cc:689
+#: UI/GTK2/src/pinot.cc:172 UI/GTK2/src/pinot-dbus-daemon.cc:688
 msgid "Norwegian"
 msgstr "Noruego"
 
-#: UI/GTK2/src/pinot.cc:173 UI/GTK2/src/pinot-dbus-daemon.cc:690
+#: UI/GTK2/src/pinot.cc:173 UI/GTK2/src/pinot-dbus-daemon.cc:689
 msgid "Portuguese"
 msgstr "Portugu?s"
 
-#: UI/GTK2/src/pinot.cc:174 UI/GTK2/src/pinot-dbus-daemon.cc:691
+#: UI/GTK2/src/pinot.cc:174 UI/GTK2/src/pinot-dbus-daemon.cc:690
 msgid "Russian"
 msgstr "Ruso"
 
-#: UI/GTK2/src/pinot.cc:175 UI/GTK2/src/pinot-dbus-daemon.cc:692
+#: UI/GTK2/src/pinot.cc:175 UI/GTK2/src/pinot-dbus-daemon.cc:691
 msgid "Spanish"
 msgstr "Espa?ol"
 
-#: UI/GTK2/src/pinot.cc:176 UI/GTK2/src/pinot-dbus-daemon.cc:693
+#: UI/GTK2/src/pinot.cc:176 UI/GTK2/src/pinot-dbus-daemon.cc:692
 msgid "Swedish"
 msgstr "Sueco"
 
-#: UI/GTK2/src/PinotSettings.cpp:236
+#: UI/GTK2/src/PinotSettings.cpp:237
 msgid "Important"
 msgstr "Importante"
 
-#: UI/GTK2/src/PinotSettings.cpp:237
+#: UI/GTK2/src/PinotSettings.cpp:238
 msgid "New"
 msgstr "Nuevo"
 
-#: UI/GTK2/src/PinotSettings.cpp:238
+#: UI/GTK2/src/PinotSettings.cpp:239
 msgid "Personal"
 msgstr "Personal"
 
-#: UI/GTK2/src/PinotSettings.cpp:911
+#: UI/GTK2/src/PinotSettings.cpp:981
 msgid "Unclassified"
 msgstr "No clasificado"
 
@@ -490,15 +494,15 @@
 msgid "Location"
 msgstr "Localizaci?n"
 
-#: UI/GTK2/src/prefsDialog.cc:359
+#: UI/GTK2/src/prefsDialog.cc:357
 msgid "New Label"
 msgstr "Nueva etiqueta"
 
-#: UI/GTK2/src/prefsDialog.cc:411 UI/GTK2/src/prefsDialog.cc:442
+#: UI/GTK2/src/prefsDialog.cc:398
 msgid "Directory to index"
 msgstr "Carpeta a indexar"
 
-#: UI/GTK2/src/prefsDialog.cc:487 UI/GTK2/src/prefsDialog.cc:522
+#: UI/GTK2/src/prefsDialog.cc:456
 msgid "Mbox File Location"
 msgstr "Localizaci?n del fichero mbox"
 
@@ -535,7 +539,7 @@
 msgstr "Las etiquetas se usan para clasificar los documentos indizados:"
 
 #: UI/GTK2/src/prefsDialog_glade.cc:82 UI/GTK2/src/prefsDialog_glade.cc:102
-#: UI/GTK2/src/prefsDialog_glade.cc:118
+#: UI/GTK2/src/prefsDialog_glade.cc:115
 msgid "Add"
 msgstr "A?adir"
 
@@ -551,19 +555,19 @@
 msgid "These directories will be indexed and optionally monitored for changes:"
 msgstr "Estas carpetas van a estar indexar autom?ticamente"
 
-#: UI/GTK2/src/prefsDialog_glade.cc:113
+#: UI/GTK2/src/prefsDialog_glade.cc:110
 msgid "Mail boxes of type mbox can be monitored and indexed:"
 msgstr "Los buzones de correo de tipo mbox pueden ser controlados e indizados"
 
-#: UI/GTK2/src/prefsDialog_glade.cc:128
-msgid "My Email"
-msgstr "Mi email"
+#: UI/GTK2/src/prefsDialog_glade.cc:124
+msgid "Indexing"
+msgstr "?ndices"
 
-#: UI/GTK2/src/prefsDialog_glade.cc:377
+#: UI/GTK2/src/prefsDialog_glade.cc:355
 msgid "Preferences"
 msgstr "Preferencias"
 
-#: UI/GTK2/src/propertiesDialog.cc:49
+#: UI/GTK2/src/propertiesDialog.cc:49 UI/GTK2/src/queryDialog.cc:122
 msgid "Label"
 msgstr "Etiqueta"
 
@@ -579,63 +583,43 @@
 msgid "MIME type:"
 msgstr "Tipo MIME:"
 
-#: UI/GTK2/src/queryDialog.cc:96 UI/GTK2/src/queryDialog.cc:125
-msgid "Any"
-msgstr "Cualquiera"
+#: UI/GTK2/src/queryDialog.cc:101
+msgid "Host name"
+msgstr "Nombre de servidor"
 
-#: UI/GTK2/src/queryDialog_glade.cc:75
-msgid "Index all results with label"
-msgstr "Indizar todos los resultados con la etiqueta"
+#: UI/GTK2/src/queryDialog.cc:104
+msgid "File name"
+msgstr "Nombre de fichero"
 
-#: UI/GTK2/src/queryDialog_glade.cc:77
-msgid "Any of the words:"
-msgstr "Cualquiera de las palabras:"
+#: UI/GTK2/src/queryDialog.cc:113
+msgid "Directory"
+msgstr "Carpeta"
 
-#: UI/GTK2/src/queryDialog_glade.cc:78
-msgid "File name:"
-msgstr "Nombre de fichero:"
+#: UI/GTK2/src/queryDialog.cc:116
+msgid "Language code"
+msgstr "Codigo de idioma"
 
-#: UI/GTK2/src/queryDialog_glade.cc:79
-msgid "Number of results:"
-msgstr "N?mero de resultados:"
+#: UI/GTK2/src/queryDialog.cc:119
+msgid "MIME type"
+msgstr "Tipo MIME"
 
-#: UI/GTK2/src/queryDialog_glade.cc:82
-msgid "Host name:"
-msgstr "Nombre del servidor:"
+#: UI/GTK2/src/queryDialog_glade.cc:72
+msgid "New filter:"
+msgstr "Nuevo filtro:"
 
+#: UI/GTK2/src/queryDialog_glade.cc:81
+msgid "Query Text"
+msgstr "B?squeda"
+
 #: UI/GTK2/src/queryDialog_glade.cc:83
-msgid "None of the words:"
-msgstr "Ninguna de las palabras:"
+msgid "Index all results with label"
+msgstr "Indizar todos los resultados con la etiqueta"
 
-#: UI/GTK2/src/queryDialog_glade.cc:88
-msgid "All engines"
-msgstr "Todos los motores"
+#: UI/GTK2/src/queryDialog_glade.cc:86
+msgid "Number of results:"
+msgstr "N?mero de resultados:"
 
-#: UI/GTK2/src/queryDialog_glade.cc:89
-msgid "Limit to documents that match"
-msgstr "Limitar a los documentos que coincidan"
-
-#: UI/GTK2/src/queryDialog_glade.cc:92
-msgid "the exact phrase:"
-msgstr "la frase exacta"
-
-#: UI/GTK2/src/queryDialog_glade.cc:93
-msgid "the language:"
-msgstr "el idioma"
-
-#: UI/GTK2/src/queryDialog_glade.cc:97
-msgid "all the words:"
-msgstr "todas las palabras:"
-
-#: UI/GTK2/src/queryDialog_glade.cc:98
-msgid "the label:"
-msgstr "la etiqueta"
-
-#: UI/GTK2/src/queryDialog_glade.cc:103
-msgid "Indexes only"
-msgstr "S?lo ?ndices"
-
-#: UI/GTK2/src/queryDialog_glade.cc:288
+#: UI/GTK2/src/queryDialog_glade.cc:182
 msgid "Query parameters"
 msgstr "Par?metros de b?squeda"
 
@@ -645,7 +629,7 @@
 
 #: UI/GTK2/src/WorkerThreads.cpp:633 UI/GTK2/src/WorkerThreads.cpp:909
 #: UI/GTK2/src/WorkerThreads.cpp:918 UI/GTK2/src/WorkerThreads.cpp:1084
-#: UI/GTK2/src/WorkerThreads.cpp:1289 UI/GTK2/src/WorkerThreads.cpp:1413
+#: UI/GTK2/src/WorkerThreads.cpp:1285 UI/GTK2/src/WorkerThreads.cpp:1409
 msgid "Index error on"
 msgstr "Error en el ?ndice"
 
@@ -685,26 +669,26 @@
 msgid "Robots META tag forbids indexing"
 msgstr "La etiqueta META Robots proh?be la indizaci?n"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1219
+#: UI/GTK2/src/WorkerThreads.cpp:1215
 msgid "Couldn't index"
 msgstr "No se pudo indizar"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1300
+#: UI/GTK2/src/WorkerThreads.cpp:1296
 msgid "Couldn't unindex document(s)"
 msgstr "No se pudo des-indizar lo(s) documento(s)"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1425
+#: UI/GTK2/src/WorkerThreads.cpp:1421
 msgid "Couldn't update document"
 msgstr "No se pudo actualizar el documento"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1582
+#: UI/GTK2/src/WorkerThreads.cpp:1578
 msgid "No monitoring handler"
 msgstr "No hay monitorizaci?n"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1624
+#: UI/GTK2/src/WorkerThreads.cpp:1620
 msgid "Couldn't initialize file monitor"
 msgstr "No se puede inicializar el monitor de archivo"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1900
+#: UI/GTK2/src/WorkerThreads.cpp:1896
 msgid "Couldn't open directory"
 msgstr "No se pudo abrir el directorio"

Modified: trunk/po/fr.po
===================================================================
--- trunk/po/fr.po	2006-10-17 13:37:06 UTC (rev 525)
+++ trunk/po/fr.po	2006-10-18 12:36:32 UTC (rev 526)
@@ -8,8 +8,8 @@
 msgstr ""
 "Project-Id-Version: pinot 0.49\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2006-09-23 15:56+0800\n"
-"PO-Revision-Date: 2006-09-25 20:23+0800\n"
+"POT-Creation-Date: 2006-10-17 21:42+0800\n"
+"PO-Revision-Date: 2006-10-18 20:38+0800\n"
 "Last-Translator: Fabrice Colin <colinf at chez.com>\n"
 "Language-Team: fr <colinf at chez.com>\n"
 "MIME-Version: 1.0\n"
@@ -24,24 +24,22 @@
 msgid "Current User"
 msgstr "Utilisateur"
 
-#: UI/GTK2/src/EnginesTree.cpp:339 UI/GTK2/src/mainWindow.cc:186
-#: UI/GTK2/src/mainWindow.cc:304 UI/GTK2/src/mainWindow.cc:307
-#: UI/GTK2/src/mainWindow.cc:533 UI/GTK2/src/mainWindow.cc:1139
-#: UI/GTK2/src/mainWindow.cc:1181 UI/GTK2/src/mainWindow.cc:1201
-#: UI/GTK2/src/mainWindow.cc:1232 UI/GTK2/src/mainWindow.cc:1807
-#: UI/GTK2/src/PinotSettings.cpp:230 UI/GTK2/src/PinotSettings.cpp:1081
-#: UI/GTK2/src/PinotSettings.cpp:1137
+#: UI/GTK2/src/EnginesTree.cpp:339 UI/GTK2/src/mainWindow.cc:309
+#: UI/GTK2/src/mainWindow.cc:312 UI/GTK2/src/mainWindow.cc:538
+#: UI/GTK2/src/mainWindow.cc:1141 UI/GTK2/src/mainWindow.cc:1183
+#: UI/GTK2/src/mainWindow.cc:1203 UI/GTK2/src/mainWindow.cc:1234
+#: UI/GTK2/src/mainWindow.cc:1806 UI/GTK2/src/PinotSettings.cpp:231
+#: UI/GTK2/src/PinotSettings.cpp:1145 UI/GTK2/src/PinotSettings.cpp:1201
 msgid "My Web Pages"
 msgstr "Mes Pages Web"
 
-#: UI/GTK2/src/EnginesTree.cpp:340 UI/GTK2/src/mainWindow.cc:298
-#: UI/GTK2/src/mainWindow.cc:301 UI/GTK2/src/PinotSettings.cpp:231
-#: UI/GTK2/src/PinotSettings.cpp:1082 UI/GTK2/src/PinotSettings.cpp:1138
-#: UI/GTK2/src/prefsDialog_glade.cc:112
+#: UI/GTK2/src/EnginesTree.cpp:340 UI/GTK2/src/mainWindow.cc:303
+#: UI/GTK2/src/mainWindow.cc:306 UI/GTK2/src/PinotSettings.cpp:232
+#: UI/GTK2/src/PinotSettings.cpp:1146 UI/GTK2/src/PinotSettings.cpp:1202
 msgid "My Documents"
 msgstr "Mes Documents"
 
-#: UI/GTK2/src/importDialog.cc:81 UI/GTK2/src/queryDialog.cc:91
+#: UI/GTK2/src/importDialog.cc:81 UI/GTK2/src/queryDialog.cc:79
 msgid "None"
 msgstr "Aucune"
 
@@ -70,7 +68,7 @@
 msgid "Index location"
 msgstr "Chemin de l'index"
 
-#: UI/GTK2/src/indexDialog_glade.cc:62 UI/GTK2/src/queryDialog_glade.cc:65
+#: UI/GTK2/src/indexDialog_glade.cc:62 UI/GTK2/src/queryDialog_glade.cc:68
 msgid "Name:"
 msgstr "Nom:"
 
@@ -90,11 +88,13 @@
 msgid "External index"
 msgstr "Index externe"
 
-#: UI/GTK2/src/IndexTree.cpp:63 UI/GTK2/src/ResultsTree.cpp:131
+#: UI/GTK2/src/IndexTree.cpp:63 UI/GTK2/src/queryDialog.cc:107
+#: UI/GTK2/src/ResultsTree.cpp:131
 msgid "Title"
 msgstr "Titre"
 
-#: UI/GTK2/src/IndexTree.cpp:68 UI/GTK2/src/ResultsTree.cpp:141
+#: UI/GTK2/src/IndexTree.cpp:68 UI/GTK2/src/queryDialog.cc:110
+#: UI/GTK2/src/ResultsTree.cpp:141
 msgid "URL"
 msgstr "URL"
 
@@ -114,253 +114,257 @@
 msgid "All labels"
 msgstr "Toutes les etiquettes"
 
-#: UI/GTK2/src/mainWindow.cc:131
+#: UI/GTK2/src/mainWindow.cc:138
 msgid "Query Name"
 msgstr "Nom de la Recherche"
 
-#: UI/GTK2/src/mainWindow.cc:136
+#: UI/GTK2/src/mainWindow.cc:143
 msgid "Last Run"
 msgstr "Derniere Utilisation"
 
-#: UI/GTK2/src/mainWindow.cc:141
+#: UI/GTK2/src/mainWindow.cc:148
 msgid "Summary"
 msgstr "Sommaire"
 
-#: UI/GTK2/src/mainWindow.cc:174
+#: UI/GTK2/src/mainWindow.cc:181
+msgid "Show all search engines"
+msgstr "Montrer tous les moteurs"
+
+#: UI/GTK2/src/mainWindow.cc:182
 msgid "Add index"
 msgstr "Ajouter un index"
 
-#: UI/GTK2/src/mainWindow.cc:175
+#: UI/GTK2/src/mainWindow.cc:183
 msgid "Remove index"
 msgstr "Enlever un index"
 
-#: UI/GTK2/src/mainWindow.cc:181
+#: UI/GTK2/src/mainWindow.cc:189
 msgid "Ready"
 msgstr "Pret"
 
-#: UI/GTK2/src/mainWindow.cc:227
+#: UI/GTK2/src/mainWindow.cc:232
 msgid "N/A"
 msgstr "Inconnue"
 
-#: UI/GTK2/src/mainWindow.cc:237
+#: UI/GTK2/src/mainWindow.cc:242
 msgid "<undefined>"
 msgstr "<inconnu>"
 
-#: UI/GTK2/src/mainWindow.cc:456
+#: UI/GTK2/src/mainWindow.cc:461
 msgid "Result location is"
 msgstr "Le chemin du resultat est"
 
-#: UI/GTK2/src/mainWindow.cc:543
+#: UI/GTK2/src/mainWindow.cc:548
 msgid "Document location is"
 msgstr "Le chemin du document is"
 
-#: UI/GTK2/src/mainWindow.cc:861
+#: UI/GTK2/src/mainWindow.cc:866
 msgid "Showing"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:866
+#: UI/GTK2/src/mainWindow.cc:871
 msgid "of"
 msgstr "documents,"
 
-#: UI/GTK2/src/mainWindow.cc:871
+#: UI/GTK2/src/mainWindow.cc:876
 msgid "documents, starting at"
 msgstr "au total, a partir de"
 
-#: UI/GTK2/src/mainWindow.cc:907
+#: UI/GTK2/src/mainWindow.cc:909
 msgid "Query"
 msgstr "La recherche"
 
-#: UI/GTK2/src/mainWindow.cc:911 UI/GTK2/src/mainWindow.cc:2849
+#: UI/GTK2/src/mainWindow.cc:913 UI/GTK2/src/mainWindow.cc:2857
 msgid "on"
 msgstr "sur"
 
-#: UI/GTK2/src/mainWindow.cc:915
+#: UI/GTK2/src/mainWindow.cc:917
 msgid "ended"
 msgstr "est terminee"
 
-#: UI/GTK2/src/mainWindow.cc:1004
+#: UI/GTK2/src/mainWindow.cc:1006
 msgid "More Like"
 msgstr "Similaire a"
 
-#: UI/GTK2/src/mainWindow.cc:1065
+#: UI/GTK2/src/mainWindow.cc:1067
 msgid "Updated label(s)"
 msgstr "Mis a jour l(es) etiquette(s)"
 
-#: UI/GTK2/src/mainWindow.cc:1149
+#: UI/GTK2/src/mainWindow.cc:1151
 msgid "Updated document"
 msgstr "Mis a jour le document"
 
-#: UI/GTK2/src/mainWindow.cc:1162
+#: UI/GTK2/src/mainWindow.cc:1164
 msgid "Indexed"
 msgstr "Indexe"
 
-#: UI/GTK2/src/mainWindow.cc:1202
+#: UI/GTK2/src/mainWindow.cc:1204
 msgid "Unindexed document(s)"
 msgstr "Desindexe le(s) document(s)"
 
-#: UI/GTK2/src/mainWindow.cc:1243
+#: UI/GTK2/src/mainWindow.cc:1245
 msgid "Updated document properties"
 msgstr "Mis a jour les proprietes du document"
 
-#: UI/GTK2/src/mainWindow.cc:1290
+#: UI/GTK2/src/mainWindow.cc:1292
 msgid "Couldn't rename index, name"
 msgstr "N'a pas pu renommer l'index, le nom"
 
-#: UI/GTK2/src/mainWindow.cc:1294 UI/GTK2/src/mainWindow.cc:2184
-#: UI/GTK2/src/mainWindow.cc:2683
+#: UI/GTK2/src/mainWindow.cc:1296 UI/GTK2/src/mainWindow.cc:2183
+#: UI/GTK2/src/mainWindow.cc:2692
 msgid "is already in use"
 msgstr "est deja utilise"
 
-#: UI/GTK2/src/mainWindow.cc:1307
+#: UI/GTK2/src/mainWindow.cc:1309
 msgid "Couldn't rename index"
 msgstr "N'a pas pu renommer l'index"
 
-#: UI/GTK2/src/mainWindow.cc:1320
+#: UI/GTK2/src/mainWindow.cc:1322
 msgid "Edited index"
 msgstr "Edite l'index"
 
-#: UI/GTK2/src/mainWindow.cc:1689 UI/GTK2/src/mainWindow.cc:2341
+#: UI/GTK2/src/mainWindow.cc:1688 UI/GTK2/src/mainWindow.cc:2353
 msgid "Live query"
 msgstr "Recherche"
 
-#: UI/GTK2/src/mainWindow.cc:1715
+#: UI/GTK2/src/mainWindow.cc:1714
 msgid "Couldn't find query"
 msgstr "N'a pas pu trouver"
 
-#: UI/GTK2/src/mainWindow.cc:1759 UI/GTK2/src/mainWindow.cc:1851
+#: UI/GTK2/src/mainWindow.cc:1758 UI/GTK2/src/mainWindow.cc:1850
 msgid "Please set a location for the index first"
 msgstr "Donnez un chemin a l'index"
 
-#: UI/GTK2/src/mainWindow.cc:1924 UI/GTK2/src/WorkerThreads.cpp:620
-#: UI/GTK2/src/WorkerThreads.cpp:1400
+#: UI/GTK2/src/mainWindow.cc:1923 UI/GTK2/src/WorkerThreads.cpp:620
+#: UI/GTK2/src/WorkerThreads.cpp:1396
 msgid "Index"
 msgstr "L'index"
 
-#: UI/GTK2/src/mainWindow.cc:1928 UI/GTK2/src/WorkerThreads.cpp:624
-#: UI/GTK2/src/WorkerThreads.cpp:1404
+#: UI/GTK2/src/mainWindow.cc:1927 UI/GTK2/src/WorkerThreads.cpp:624
+#: UI/GTK2/src/WorkerThreads.cpp:1400
 msgid "doesn't exist"
 msgstr "n'existe pas"
 
-#: UI/GTK2/src/mainWindow.cc:2072
+#: UI/GTK2/src/mainWindow.cc:2071
 msgid "Remove this document from the index ?"
 msgstr "Enlever ce document de l'index ?"
 
-#: UI/GTK2/src/mainWindow.cc:2091
+#: UI/GTK2/src/mainWindow.cc:2090
 msgid "Remove these documents from the index ?"
 msgstr "Enlever ces documents de l'index ?"
 
-#: UI/GTK2/src/mainWindow.cc:2135
+#: UI/GTK2/src/mainWindow.cc:2134
 msgid "A metasearch tool for the Free Desktop"
 msgstr "Un outil de recherche pour le Bureau Libre"
 
-#: UI/GTK2/src/mainWindow.cc:2136
+#: UI/GTK2/src/mainWindow.cc:2135
 msgid "(C) 2005-2006 Fabrice Colin"
 msgstr "(C) 2005-2006 Fabrice Colin"
 
-#: UI/GTK2/src/mainWindow.cc:2180
+#: UI/GTK2/src/mainWindow.cc:2179
 msgid "Index name"
 msgstr "Nom de l'index"
 
-#: UI/GTK2/src/mainWindow.cc:2195
+#: UI/GTK2/src/mainWindow.cc:2194
 msgid "Couldn't add index"
 msgstr "N'a pas pu ajouter l'index"
 
-#: UI/GTK2/src/mainWindow.cc:2209
+#: UI/GTK2/src/mainWindow.cc:2208
 msgid "Added new index"
 msgstr "Ajoute un nouvel index"
 
-#: UI/GTK2/src/mainWindow.cc:2244
+#: UI/GTK2/src/mainWindow.cc:2243
 msgid "Couldn't remove index"
 msgstr "N'a pas pu enlever l'index"
 
-#: UI/GTK2/src/mainWindow.cc:2498
+#: UI/GTK2/src/mainWindow.cc:2506
 msgid "At least one task hasn't completed yet. Quit now ?"
 msgstr "Au moins une tache n'est pas terminee. Quitter maintenant ?"
 
-#: UI/GTK2/src/mainWindow.cc:2679
+#: UI/GTK2/src/mainWindow.cc:2688
 msgid "Query name"
 msgstr "Nom de la recherche"
 
-#: UI/GTK2/src/mainWindow.cc:2706
+#: UI/GTK2/src/mainWindow.cc:2715
 msgid "Couldn't update query"
 msgstr "N'a pas pu mettre a jour la recherche"
 
-#: UI/GTK2/src/mainWindow.cc:2714
+#: UI/GTK2/src/mainWindow.cc:2723
 msgid "Edited query"
 msgstr "Edite la recherche"
 
-#: UI/GTK2/src/mainWindow.cc:2721
+#: UI/GTK2/src/mainWindow.cc:2730
 msgid "Couldn't add query"
 msgstr "N'a pas pu ajouter la recherche"
 
-#: UI/GTK2/src/mainWindow.cc:2729
+#: UI/GTK2/src/mainWindow.cc:2738
 msgid "Added new query"
 msgstr "Ajoute une nouvelle recherche"
 
-#: UI/GTK2/src/mainWindow.cc:2743
+#: UI/GTK2/src/mainWindow.cc:2751
 msgid "Query is not set"
 msgstr "Recherche indefinie"
 
-#: UI/GTK2/src/mainWindow.cc:2754
+#: UI/GTK2/src/mainWindow.cc:2762
 msgid "No search engine selected"
 msgstr "Pas de moteur selectionne"
 
-#: UI/GTK2/src/mainWindow.cc:2836
+#: UI/GTK2/src/mainWindow.cc:2844
 msgid "Please set the Google API key first"
 msgstr "Configurez la clef de l'API Google "
 
-#: UI/GTK2/src/mainWindow.cc:2845
+#: UI/GTK2/src/mainWindow.cc:2853
 msgid "Running query"
 msgstr "Recherche en cours"
 
-#: UI/GTK2/src/mainWindow.cc:3004
+#: UI/GTK2/src/mainWindow.cc:3023
 msgid "No default application defined for type"
 msgstr "Pas d'application definie pour le type"
 
-#: UI/GTK2/src/mainWindow_glade.cc:121
+#: UI/GTK2/src/mainWindow_glade.cc:124
 msgid "Query:"
 msgstr "Recherche:"
 
-#: UI/GTK2/src/mainWindow_glade.cc:133
+#: UI/GTK2/src/mainWindow_glade.cc:136
 msgid "Edit"
 msgstr "Editer"
 
-#: UI/GTK2/src/mainWindow_glade.cc:142
+#: UI/GTK2/src/mainWindow_glade.cc:145
 msgid "Stored queries"
 msgstr "Recherches sauvegardees"
 
-#: UI/GTK2/src/mainWindow_glade.cc:177
+#: UI/GTK2/src/mainWindow_glade.cc:180
 msgid "Search Engine"
 msgstr "Moteur"
 
-#: UI/GTK2/src/mainWindow_glade.cc:180
+#: UI/GTK2/src/mainWindow_glade.cc:183
 msgid "Host Name"
 msgstr "Nom de machine"
 
-#: UI/GTK2/src/mainWindow_glade.cc:183
+#: UI/GTK2/src/mainWindow_glade.cc:186
 msgid "Show Extract"
 msgstr "Montrer l'Extrait"
 
-#: UI/GTK2/src/mainWindow_glade.cc:186
+#: UI/GTK2/src/mainWindow_glade.cc:189
 msgid "Group By"
 msgstr "Grouper Par"
 
-#: UI/GTK2/src/mainWindow_glade.cc:189
+#: UI/GTK2/src/mainWindow_glade.cc:192
 msgid "Clear List"
 msgstr "Nettoyer la Liste"
 
-#: UI/GTK2/src/mainWindow_glade.cc:195
-msgid "More Like This"
-msgstr "Documents similaires"
-
-#: UI/GTK2/src/mainWindow_glade.cc:201
+#: UI/GTK2/src/mainWindow_glade.cc:198
 msgid "Vie_w"
 msgstr "Voir"
 
-#: UI/GTK2/src/mainWindow_glade.cc:204
+#: UI/GTK2/src/mainWindow_glade.cc:201
 msgid "View Cache"
 msgstr "Voir le Cache"
 
+#: UI/GTK2/src/mainWindow_glade.cc:204
+msgid "More Like This"
+msgstr "Documents similaires"
+
 #: UI/GTK2/src/mainWindow_glade.cc:207 UI/GTK2/src/mainWindow_glade.cc:243
 msgid "_Index"
 msgstr "Index"
@@ -406,75 +410,75 @@
 msgid "_Help"
 msgstr "Aide"
 
-#: UI/GTK2/src/mainWindow_glade.cc:375
+#: UI/GTK2/src/mainWindow_glade.cc:383
 msgid "Pinot"
 msgstr "Pinot"
 
-#: UI/GTK2/src/pinot.cc:164 UI/GTK2/src/pinot-dbus-daemon.cc:681
+#: UI/GTK2/src/pinot.cc:164 UI/GTK2/src/pinot-dbus-daemon.cc:680
 msgid "Unknown"
 msgstr "Inconnu"
 
-#: UI/GTK2/src/pinot.cc:165 UI/GTK2/src/pinot-dbus-daemon.cc:682
+#: UI/GTK2/src/pinot.cc:165 UI/GTK2/src/pinot-dbus-daemon.cc:681
 msgid "Danish"
 msgstr "Danois"
 
-#: UI/GTK2/src/pinot.cc:166 UI/GTK2/src/pinot-dbus-daemon.cc:683
+#: UI/GTK2/src/pinot.cc:166 UI/GTK2/src/pinot-dbus-daemon.cc:682
 msgid "Dutch"
 msgstr "Hollandais"
 
-#: UI/GTK2/src/pinot.cc:167 UI/GTK2/src/pinot-dbus-daemon.cc:684
+#: UI/GTK2/src/pinot.cc:167 UI/GTK2/src/pinot-dbus-daemon.cc:683
 msgid "English"
 msgstr "Anglais"
 
-#: UI/GTK2/src/pinot.cc:168 UI/GTK2/src/pinot-dbus-daemon.cc:685
+#: UI/GTK2/src/pinot.cc:168 UI/GTK2/src/pinot-dbus-daemon.cc:684
 msgid "Finnish"
 msgstr "Finlandais"
 
-#: UI/GTK2/src/pinot.cc:169 UI/GTK2/src/pinot-dbus-daemon.cc:686
+#: UI/GTK2/src/pinot.cc:169 UI/GTK2/src/pinot-dbus-daemon.cc:685
 msgid "French"
 msgstr "Francais"
 
-#: UI/GTK2/src/pinot.cc:170 UI/GTK2/src/pinot-dbus-daemon.cc:687
+#: UI/GTK2/src/pinot.cc:170 UI/GTK2/src/pinot-dbus-daemon.cc:686
 msgid "German"
 msgstr "Allemand"
 
-#: UI/GTK2/src/pinot.cc:171 UI/GTK2/src/pinot-dbus-daemon.cc:688
+#: UI/GTK2/src/pinot.cc:171 UI/GTK2/src/pinot-dbus-daemon.cc:687
 msgid "Italian"
 msgstr "Italien"
 
-#: UI/GTK2/src/pinot.cc:172 UI/GTK2/src/pinot-dbus-daemon.cc:689
+#: UI/GTK2/src/pinot.cc:172 UI/GTK2/src/pinot-dbus-daemon.cc:688
 msgid "Norwegian"
 msgstr "Norvegien"
 
-#: UI/GTK2/src/pinot.cc:173 UI/GTK2/src/pinot-dbus-daemon.cc:690
+#: UI/GTK2/src/pinot.cc:173 UI/GTK2/src/pinot-dbus-daemon.cc:689
 msgid "Portuguese"
 msgstr "Portugais"
 
-#: UI/GTK2/src/pinot.cc:174 UI/GTK2/src/pinot-dbus-daemon.cc:691
+#: UI/GTK2/src/pinot.cc:174 UI/GTK2/src/pinot-dbus-daemon.cc:690
 msgid "Russian"
 msgstr "Russe"
 
-#: UI/GTK2/src/pinot.cc:175 UI/GTK2/src/pinot-dbus-daemon.cc:692
+#: UI/GTK2/src/pinot.cc:175 UI/GTK2/src/pinot-dbus-daemon.cc:691
 msgid "Spanish"
 msgstr "Espagnol"
 
-#: UI/GTK2/src/pinot.cc:176 UI/GTK2/src/pinot-dbus-daemon.cc:693
+#: UI/GTK2/src/pinot.cc:176 UI/GTK2/src/pinot-dbus-daemon.cc:692
 msgid "Swedish"
 msgstr "Suedois"
 
-#: UI/GTK2/src/PinotSettings.cpp:236
+#: UI/GTK2/src/PinotSettings.cpp:237
 msgid "Important"
 msgstr "Important"
 
-#: UI/GTK2/src/PinotSettings.cpp:237
+#: UI/GTK2/src/PinotSettings.cpp:238
 msgid "New"
 msgstr "Nouveau"
 
-#: UI/GTK2/src/PinotSettings.cpp:238
+#: UI/GTK2/src/PinotSettings.cpp:239
 msgid "Personal"
 msgstr "Personnel"
 
-#: UI/GTK2/src/PinotSettings.cpp:911
+#: UI/GTK2/src/PinotSettings.cpp:981
 msgid "Unclassified"
 msgstr "Sans classification"
 
@@ -490,15 +494,15 @@
 msgid "Location"
 msgstr "Chemin"
 
-#: UI/GTK2/src/prefsDialog.cc:359
+#: UI/GTK2/src/prefsDialog.cc:357
 msgid "New Label"
 msgstr "Nouvelle Etiquette"
 
-#: UI/GTK2/src/prefsDialog.cc:411 UI/GTK2/src/prefsDialog.cc:442
+#: UI/GTK2/src/prefsDialog.cc:398
 msgid "Directory to index"
 msgstr "Repertoire a indexer"
 
-#: UI/GTK2/src/prefsDialog.cc:487 UI/GTK2/src/prefsDialog.cc:522
+#: UI/GTK2/src/prefsDialog.cc:456
 msgid "Mbox File Location"
 msgstr "Chemin du Fichier mbox"
 
@@ -535,7 +539,7 @@
 msgstr "Les etiquettes servent a classer les documents:"
 
 #: UI/GTK2/src/prefsDialog_glade.cc:82 UI/GTK2/src/prefsDialog_glade.cc:102
-#: UI/GTK2/src/prefsDialog_glade.cc:118
+#: UI/GTK2/src/prefsDialog_glade.cc:115
 msgid "Add"
 msgstr "Ajouter"
 
@@ -551,19 +555,19 @@
 msgid "These directories will be indexed and optionally monitored for changes:"
 msgstr "Ces repertoires seront indexes automatiquement:"
 
-#: UI/GTK2/src/prefsDialog_glade.cc:113
+#: UI/GTK2/src/prefsDialog_glade.cc:110
 msgid "Mail boxes of type mbox can be monitored and indexed:"
 msgstr "Les boites de type mbox peuvent etre indexees"
 
-#: UI/GTK2/src/prefsDialog_glade.cc:128
-msgid "My Email"
-msgstr "Mon Courrier"
+#: UI/GTK2/src/prefsDialog_glade.cc:124
+msgid "Indexing"
+msgstr "Indexes"
 
-#: UI/GTK2/src/prefsDialog_glade.cc:377
+#: UI/GTK2/src/prefsDialog_glade.cc:355
 msgid "Preferences"
 msgstr "Preferences"
 
-#: UI/GTK2/src/propertiesDialog.cc:49
+#: UI/GTK2/src/propertiesDialog.cc:49 UI/GTK2/src/queryDialog.cc:122
 msgid "Label"
 msgstr "L'etiquette"
 
@@ -579,63 +583,43 @@
 msgid "MIME type:"
 msgstr "Type MIME:"
 
-#: UI/GTK2/src/queryDialog.cc:96 UI/GTK2/src/queryDialog.cc:125
-msgid "Any"
-msgstr "N'importe"
+#: UI/GTK2/src/queryDialog.cc:101
+msgid "Host name"
+msgstr "Nom de machine"
 
-#: UI/GTK2/src/queryDialog_glade.cc:75
-msgid "Index all results with label"
-msgstr "Indexer tous les resultats avec l'etiquette"
+#: UI/GTK2/src/queryDialog.cc:104
+msgid "File name"
+msgstr "Nom de ficher"
 
-#: UI/GTK2/src/queryDialog_glade.cc:77
-msgid "Any of the words:"
-msgstr "N'importe lequel des mots:"
+#: UI/GTK2/src/queryDialog.cc:113
+msgid "Directory"
+msgstr "Repertoire"
 
-#: UI/GTK2/src/queryDialog_glade.cc:78
-msgid "File name:"
-msgstr "Nom de ficher:"
+#: UI/GTK2/src/queryDialog.cc:116
+msgid "Language code"
+msgstr "Code langue"
 
-#: UI/GTK2/src/queryDialog_glade.cc:79
-msgid "Number of results:"
-msgstr "Nombre de resultats:"
+#: UI/GTK2/src/queryDialog.cc:119
+msgid "MIME type"
+msgstr "Type MIME"
 
-#: UI/GTK2/src/queryDialog_glade.cc:82
-msgid "Host name:"
-msgstr "Nom de machine:"
+#: UI/GTK2/src/queryDialog_glade.cc:72
+msgid "New filter:"
+msgstr "Nouveau filtre:"
 
+#: UI/GTK2/src/queryDialog_glade.cc:81
+msgid "Query Text"
+msgstr "Recherche"
+
 #: UI/GTK2/src/queryDialog_glade.cc:83
-msgid "None of the words:"
-msgstr "Aucun des mots:"
+msgid "Index all results with label"
+msgstr "Indexer tous les resultats avec l'etiquette"
 
-#: UI/GTK2/src/queryDialog_glade.cc:88
-msgid "All engines"
-msgstr "Tous les moteurs"
+#: UI/GTK2/src/queryDialog_glade.cc:86
+msgid "Number of results:"
+msgstr "Nombre de resultats:"
 
-#: UI/GTK2/src/queryDialog_glade.cc:89
-msgid "Limit to documents that match"
-msgstr "Limiter aux documents qui ont"
-
-#: UI/GTK2/src/queryDialog_glade.cc:92
-msgid "the exact phrase:"
-msgstr "la phrase"
-
-#: UI/GTK2/src/queryDialog_glade.cc:93
-msgid "the language:"
-msgstr "la langue"
-
-#: UI/GTK2/src/queryDialog_glade.cc:97
-msgid "all the words:"
-msgstr "tous les mots"
-
-#: UI/GTK2/src/queryDialog_glade.cc:98
-msgid "the label:"
-msgstr "l'etiquette"
-
-#: UI/GTK2/src/queryDialog_glade.cc:103
-msgid "Indexes only"
-msgstr "Indexes"
-
-#: UI/GTK2/src/queryDialog_glade.cc:288
+#: UI/GTK2/src/queryDialog_glade.cc:182
 msgid "Query parameters"
 msgstr "Parametres de la recherche"
 
@@ -645,7 +629,7 @@
 
 #: UI/GTK2/src/WorkerThreads.cpp:633 UI/GTK2/src/WorkerThreads.cpp:909
 #: UI/GTK2/src/WorkerThreads.cpp:918 UI/GTK2/src/WorkerThreads.cpp:1084
-#: UI/GTK2/src/WorkerThreads.cpp:1289 UI/GTK2/src/WorkerThreads.cpp:1413
+#: UI/GTK2/src/WorkerThreads.cpp:1285 UI/GTK2/src/WorkerThreads.cpp:1409
 msgid "Index error on"
 msgstr "Erreur sur l'index"
 
@@ -685,26 +669,26 @@
 msgid "Robots META tag forbids indexing"
 msgstr "Le META tag Robots interdit d'indexer"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1219
+#: UI/GTK2/src/WorkerThreads.cpp:1215
 msgid "Couldn't index"
 msgstr "N'a pas pu indexer"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1300
+#: UI/GTK2/src/WorkerThreads.cpp:1296
 msgid "Couldn't unindex document(s)"
 msgstr "N'a pas pu desindexer le(s) document(s)"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1425
+#: UI/GTK2/src/WorkerThreads.cpp:1421
 msgid "Couldn't update document"
 msgstr "N'a pas pu mettre a jour le document"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1582
+#: UI/GTK2/src/WorkerThreads.cpp:1578
 msgid "No monitoring handler"
 msgstr "Pas de moniteur"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1624
+#: UI/GTK2/src/WorkerThreads.cpp:1620
 msgid "Couldn't initialize file monitor"
 msgstr "N'a pas pu initializer le moniteur de fichiers"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1900
+#: UI/GTK2/src/WorkerThreads.cpp:1896
 msgid "Couldn't open directory"
 msgstr "N'a pas pu ouvrir le repertoire"



From fabricecolin at mail.berlios.de  Wed Oct 18 14:59:51 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Wed, 18 Oct 2006 14:59:51 +0200
Subject: [Pinot-svn] r527 - trunk
Message-ID: <200610181259.k9ICxppt008546@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-18 14:59:50 +0200 (Wed, 18 Oct 2006)
New Revision: 527

Modified:
   trunk/NEWS
   trunk/README
   trunk/TODO
   trunk/configure.in
Log:
Updated README and NEWS with latest changes, added to TODO list.
Releasing 0.61.


Modified: trunk/NEWS
===================================================================
--- trunk/NEWS	2006-10-18 12:36:32 UTC (rev 526)
+++ trunk/NEWS	2006-10-18 12:59:50 UTC (rev 527)
@@ -1,14 +1,26 @@
-??? version_0_6_1
+2006/10/18 version_0_6_1
+General :
+ - switched to gtk+'s version of xdgmime
 Index :
- - can now run queries like "type:text/html and lang:en and (tcp near ip)"
+ - can now run queries like "type:text/html and lang:en and (tcp near ip)".
+  See README for more information about the syntax and a list of filters.
+Search :
+ - don't reject MozSearch plugins
+ - added plugin for Google code search service
+ - filters 'site' and 'file' (host name, file name) apply to Web engines
+ - fixed abstract generation
 UI :
  - revamped the stored queries editor to allow any number of terms and filters
  - preferences relative to My Documents and My Web Pages gathered under the
   same tab
  - hide the stored queries and engines lists by default to avoid scaring
   people used to Beagle too much ;-)
+ - mail accounts configuration wasn't always saved correctly
+ - updating a document from the My Web Pages index messed the abstract
 Daemon :
  - index attachements in mbox files
+ - documents deleted since last crawl were not removed from the index if the
+  corresponding location wasn't monitored
 
 2006/09/25 version_0_6_0
 Build :

Modified: trunk/README
===================================================================
--- trunk/README	2006-10-18 12:36:32 UTC (rev 526)
+++ trunk/README	2006-10-18 12:59:50 UTC (rev 527)
@@ -89,11 +89,27 @@
       don't follow operators and stem terms
   Stemming is available only to Stored Queries for which a language is defined
   (Query parameters box, Indexes only tab).
-  While Stored Queries allow to define how terms should be used, live queries
-  are run with all terms AND'ed together when querying an index. Future
-  versions of Pinot will allow more flexibility in that respect.
 
+  Queries can be expressed in a very natural way, using a combination of operators
+  and filters. For instance "type:text/html and lang:en and (tcp near ip)" looks
+  for HTML files in English that mention TCP/IP. 
 
+  Supported filters are :
+	"site" for host name, eg "site:pinot.berlios.de"
+	"file" for file name, eg "file:index.html"
+	"title" for title, eg "title:Session"
+	"url" for URL, eg "url:http://pinot.berlios.de/"
+	"dir" for directory, eg "dir:/home/fabrice/test.txt"
+	"lang" for ISO language code, eg "lang:en"
+	"type" for MIME type, eg "type:text/html"
+	"label" for label, eg "label:Important"
+  Languages detected by this version are "da", "nl", "en", "fi", "fr", "de", "it",
+  "nn", "pt", "ru", "es" and "sv".
+
+  For more information about the query syntax, you may want to have a look at the
+  documentation for Xapian's QueryParser at http://www.xapian.org/docs/queryparser.html
+
+
 6. Viewing cached results
 
 
@@ -155,6 +171,7 @@
   words that are used as keywords to identify and categorize this search
   content".
 
+
 8. File formats
 
 

Modified: trunk/TODO
===================================================================
--- trunk/TODO	2006-10-18 12:36:32 UTC (rev 526)
+++ trunk/TODO	2006-10-18 12:59:50 UTC (rev 527)
@@ -5,7 +5,7 @@
 - MIMEScanner should also return parent types so that we don't filter out types unnecessarily
 - Update to gtk+'s xdgmime as it seems to be the reference now
 - Build a -devel package for those who want to write their own tokenizers
-- Allow building without the DBus daemon
+- Allow building without inotify/the DBus daemon
 
 Tokenize
 - Allow to cache documents that had to be converted ? eg PDF, MS Word
@@ -35,6 +35,7 @@
 - Support for Google Buttons
 - Export search results as OpenSearch Response
 - Use pango_break() to tokenize abstracts
+- Use g_get_language_names() to get the locale's languages
 
 Index
 - Get hold of stopwords lists for the languages supported by Xapian's stemmers and don't index stop words

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2006-10-18 12:36:32 UTC (rev 526)
+++ trunk/configure.in	2006-10-18 12:59:50 UTC (rev 527)
@@ -2,7 +2,7 @@
 # using glademm V2.6.0
 
 AC_PREREQ(2.50)
-AC_INIT(pinot, 0.60,[fabricecolin at users.berlios.de])
+AC_INIT(pinot, 0.61,[fabricecolin at users.berlios.de])
 AM_INIT_AUTOMAKE
 AC_CONFIG_HEADERS(config.h)
 



From fabricecolin at mail.berlios.de  Wed Oct 18 15:08:33 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Wed, 18 Oct 2006 15:08:33 +0200
Subject: [Pinot-svn] r528 - in trunk: Collect Index Search UI/GTK2/src
Message-ID: <200610181308.k9ID8XYg009364@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-18 15:08:33 +0200 (Wed, 18 Oct 2006)
New Revision: 528

Modified:
   trunk/Collect/pinot-collect.1
   trunk/Index/pinot-index.1
   trunk/Search/pinot-search.1
   trunk/UI/GTK2/src/pinot-dbus-daemon.1
   trunk/UI/GTK2/src/pinot.1
Log:
Same man pages with new version number.


Modified: trunk/Collect/pinot-collect.1
===================================================================
--- trunk/Collect/pinot-collect.1	2006-10-18 12:59:50 UTC (rev 527)
+++ trunk/Collect/pinot-collect.1	2006-10-18 13:08:33 UTC (rev 528)
@@ -1,5 +1,5 @@
 .\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.36.
-.TH PINOT-COLLECT "1" "October 2006" "pinot-collect - pinot 0.60" "User Commands"
+.TH PINOT-COLLECT "1" "October 2006" "pinot-collect - pinot 0.61" "User Commands"
 .SH NAME
 pinot-collect \- Download an URL from the command-line
 .SH SYNOPSIS

Modified: trunk/Index/pinot-index.1
===================================================================
--- trunk/Index/pinot-index.1	2006-10-18 12:59:50 UTC (rev 527)
+++ trunk/Index/pinot-index.1	2006-10-18 13:08:33 UTC (rev 528)
@@ -1,5 +1,5 @@
 .\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.36.
-.TH PINOT-INDEX "1" "October 2006" "pinot-index - pinot 0.60" "User Commands"
+.TH PINOT-INDEX "1" "October 2006" "pinot-index - pinot 0.61" "User Commands"
 .SH NAME
 pinot-index \- Index documents from the command-line
 .SH SYNOPSIS

Modified: trunk/Search/pinot-search.1
===================================================================
--- trunk/Search/pinot-search.1	2006-10-18 12:59:50 UTC (rev 527)
+++ trunk/Search/pinot-search.1	2006-10-18 13:08:33 UTC (rev 528)
@@ -1,5 +1,5 @@
 .\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.36.
-.TH PINOT-SEARCH "1" "October 2006" "pinot-search - pinot 0.60" "User Commands"
+.TH PINOT-SEARCH "1" "October 2006" "pinot-search - pinot 0.61" "User Commands"
 .SH NAME
 pinot-search \- Query search engines from the command-line
 .SH SYNOPSIS

Modified: trunk/UI/GTK2/src/pinot-dbus-daemon.1
===================================================================
--- trunk/UI/GTK2/src/pinot-dbus-daemon.1	2006-10-18 12:59:50 UTC (rev 527)
+++ trunk/UI/GTK2/src/pinot-dbus-daemon.1	2006-10-18 13:08:33 UTC (rev 528)
@@ -1,5 +1,5 @@
 .\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.36.
-.TH PINOT-DBUS-DAEMON "1" "October 2006" "pinot-dbus-daemon - pinot 0.60" "User Commands"
+.TH PINOT-DBUS-DAEMON "1" "October 2006" "pinot-dbus-daemon - pinot 0.61" "User Commands"
 .SH NAME
 pinot-dbus-daemon \- D-Bus search and index daemon
 .SH SYNOPSIS

Modified: trunk/UI/GTK2/src/pinot.1
===================================================================
--- trunk/UI/GTK2/src/pinot.1	2006-10-18 12:59:50 UTC (rev 527)
+++ trunk/UI/GTK2/src/pinot.1	2006-10-18 13:08:33 UTC (rev 528)
@@ -1,5 +1,5 @@
 .\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.36.
-.TH PINOT "1" "October 2006" "pinot - pinot 0.60" "User Commands"
+.TH PINOT "1" "October 2006" "pinot - pinot 0.61" "User Commands"
 .SH NAME
 pinot \- A metasearch tool for the Free Desktop
 .SH SYNOPSIS



From fabricecolin at mail.berlios.de  Wed Oct 18 17:24:47 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Wed, 18 Oct 2006 17:24:47 +0200
Subject: [Pinot-svn] r529 - tags
Message-ID: <200610181524.k9IFOlhZ029246@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-18 17:24:46 +0200 (Wed, 18 Oct 2006)
New Revision: 529

Added:
   tags/version_0_6_1/
Log:
Releasing 0.61.


Copied: tags/version_0_6_1 (from rev 528, trunk)



From fabricecolin at mail.berlios.de  Sat Oct 21 07:19:22 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 21 Oct 2006 07:19:22 +0200
Subject: [Pinot-svn] r530 - in trunk: . Index Monitor Search Search/Google
	UI/GTK2/src Utils
Message-ID: <200610210519.k9L5JM2R001157@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-21 07:19:22 +0200 (Sat, 21 Oct 2006)
New Revision: 530

Added:
   trunk/Index/XapianDatabase.cpp
   trunk/Index/XapianDatabase.h
   trunk/Index/XapianDatabaseFactory.cpp
   trunk/Index/XapianDatabaseFactory.h
Removed:
   trunk/Utils/XapianDatabase.cpp
   trunk/Utils/XapianDatabase.h
   trunk/Utils/XapianDatabaseFactory.cpp
   trunk/Utils/XapianDatabaseFactory.h
Modified:
   trunk/Index/Makefile.am
   trunk/Makefile.am
   trunk/Monitor/Makefile.am
   trunk/Search/Google/Makefile.am
   trunk/Search/Makefile.am
   trunk/UI/GTK2/src/Makefile.am
   trunk/Utils/Makefile.am
Log:
Moved XapianDatabase classes to Index, on which Search now depends.


Modified: trunk/Index/Makefile.am
===================================================================
--- trunk/Index/Makefile.am	2006-10-18 15:24:46 UTC (rev 529)
+++ trunk/Index/Makefile.am	2006-10-21 05:19:22 UTC (rev 530)
@@ -5,6 +5,8 @@
 	IndexFactory.h \
 	IndexInterface.h \
 	LanguageDetector.h \
+	XapianDatabase.h \
+	XapianDatabaseFactory.h \
 	XapianIndex.h
 
 noinst_LTLIBRARIES = libIndex.la
@@ -15,6 +17,8 @@
 	DBusXapianIndex.cpp \
 	IndexFactory.cpp \
 	LanguageDetector.cpp \
+	XapianDatabase.cpp \
+	XapianDatabaseFactory.cpp \
 	XapianIndex.cpp
 
 pinot_index_SOURCES = \

Copied: trunk/Index/XapianDatabase.cpp (from rev 528, trunk/Utils/XapianDatabase.cpp)

Copied: trunk/Index/XapianDatabase.h (from rev 528, trunk/Utils/XapianDatabase.h)

Copied: trunk/Index/XapianDatabaseFactory.cpp (from rev 528, trunk/Utils/XapianDatabaseFactory.cpp)

Copied: trunk/Index/XapianDatabaseFactory.h (from rev 528, trunk/Utils/XapianDatabaseFactory.h)

Modified: trunk/Makefile.am
===================================================================
--- trunk/Makefile.am	2006-10-18 15:24:46 UTC (rev 529)
+++ trunk/Makefile.am	2006-10-21 05:19:22 UTC (rev 530)
@@ -1,8 +1,8 @@
 # generated 2005/12/14 20:48:47 SGT by fabrice at amra.dyndns.org.(none)
 # using glademm V2.6.0
 
-SUBDIRS = po Utils Tokenize SQL Collect @SOAP_SUBDIRS@ Search \
-	Index Monitor UI/GTK2/src
+SUBDIRS = po Utils Tokenize SQL Collect @SOAP_SUBDIRS@ Index \
+	Search Monitor UI/GTK2/src
 
 EXTRA_DIST = ChangeLog NEWS README TODO mkinstalldirs pinot.desktop \
 	pinot.spec textcat_conf.txt globalconfig.xml \

Modified: trunk/Monitor/Makefile.am
===================================================================
--- trunk/Monitor/Makefile.am	2006-10-18 15:24:46 UTC (rev 529)
+++ trunk/Monitor/Makefile.am	2006-10-21 05:19:22 UTC (rev 530)
@@ -19,7 +19,7 @@
 endif
 
 AM_CXXFLAGS = -I$(srcdir)/../Utils -I$(srcdir)/../Tokenize -I$(srcdir)/../SQL \
-	-I$(srcdir)/../Collect -I$(srcdir)/../Search -I$(srcdir)/../Index \
+	-I$(srcdir)/../Collect -I$(srcdir)/../Index -I$(srcdir)/../Search \
 	@HTTP_CFLAGS@ @XML_CFLAGS@ @INDEX_CFLAGS@ @SOAP_CFLAGS@ @MIME_CFLAGS@ @SIGCPP_CFLAGS@
 if HAVE_LINUX_INOTIFY
 AM_CXXFLAGS += -DHAVE_LINUX_INOTIFY

Modified: trunk/Search/Google/Makefile.am
===================================================================
--- trunk/Search/Google/Makefile.am	2006-10-18 15:24:46 UTC (rev 529)
+++ trunk/Search/Google/Makefile.am	2006-10-21 05:19:22 UTC (rev 530)
@@ -22,6 +22,6 @@
 GAPIClientLib.cpp : GoogleSearch.h
 	soapcpp2 -n -pGAPI -I /usr/include/gsoap/import GoogleSearch.h
 
-AM_CXXFLAGS = -I../../Utils -I../../Tokenize -I../../Collect -I.. \
+AM_CXXFLAGS = -I../../Utils -I../../Tokenize -I../../Collect -I../../Index -I.. \
 	@HTTP_CFLAGS@ @XML_CFLAGS@ @SOAP_CFLAGS@ @INDEX_CFLAGS@ @MIME_CFLAGS@
 

Modified: trunk/Search/Makefile.am
===================================================================
--- trunk/Search/Makefile.am	2006-10-18 15:24:46 UTC (rev 529)
+++ trunk/Search/Makefile.am	2006-10-21 05:19:22 UTC (rev 530)
@@ -43,14 +43,14 @@
 pinot_search_SOURCES = \
 	pinot-search.cpp
 
-pinot_search_LDADD = -L../Utils -L../Tokenize -L../Collect -LGoogle \
-	@SEARCH_LIBS@ -lCollect -lTokenize -lUtils -lBasicUtils \
+pinot_search_LDADD = -L../Utils -L../Tokenize -L../Collect -L../Index -LGoogle \
+	@SEARCH_LIBS@ -lIndex -lCollect -lTokenize -lUtils -lBasicUtils \
 	@GLIBMM_LIBS@ @INDEX_LIBS@ @SOAP_LIBS@ @XML_LIBS@ @MIME_LIBS@ @HTTP_LIBS@ @MISC_LIBS@
 
 SOAPEnvC.cpp : SOAPEnv.h
 	soapcpp2 -pSOAPEnv SOAPEnv.h
 
-AM_CXXFLAGS = -I$(srcdir)/../Utils -I$(srcdir)/../Tokenize -I$(srcdir)/../Collect -IGoogle \
+AM_CXXFLAGS = -I$(srcdir)/../Utils -I$(srcdir)/../Tokenize -I$(srcdir)/../Collect -I$(srcdir)/../Index -IGoogle \
 	@HTTP_CFLAGS@ @XML_CFLAGS@ @INDEX_CFLAGS@ @SOAP_CFLAGS@ @MIME_CFLAGS@ @GLIBMM_CFLAGS@
 if HAVE_BOOST_SPIRIT
 AM_CXXFLAGS += -DHAVE_BOOST_SPIRIT

Modified: trunk/UI/GTK2/src/Makefile.am
===================================================================
--- trunk/UI/GTK2/src/Makefile.am	2006-10-18 15:24:46 UTC (rev 529)
+++ trunk/UI/GTK2/src/Makefile.am	2006-10-21 05:19:22 UTC (rev 530)
@@ -62,17 +62,17 @@
 bin_PROGRAMS = pinot pinot-dbus-daemon
 
 AM_CXXFLAGS = -I$(top_srcdir)/Utils -I$(top_srcdir)/Tokenize -I$(top_srcdir)/SQL \
-	-I$(top_srcdir)/Monitor -I$(top_srcdir)/Collect -I$(top_srcdir)/Search \
-	-I$(top_srcdir)/Search/Google -I$(top_srcdir)/Index \
+	-I$(top_srcdir)/Monitor -I$(top_srcdir)/Collect -I$(top_srcdir)/Index \
+	-I$(top_srcdir)/Search -I$(top_srcdir)/Search/Google \
 	@SQL_CFLAGS@ @HTTP_CFLAGS@ @MIME_CFLAGS@ @XML_CFLAGS@ @SOAP_CFLAGS@ @DBUS_CFLAGS@ @INDEX_CFLAGS@ @UI_CFLAGS@
 
 pinot_LDADD = -L$(top_srcdir)/Utils -L$(top_srcdir)/Tokenize -L$(top_srcdir)/SQL -L$(top_srcdir)/Monitor \
-	-L$(top_srcdir)/Collect -L$(top_srcdir)/Search -L$(top_srcdir)/Search/Google \
-	-L$(top_srcdir)/Index -lIndex @SEARCH_LIBS@ -lMonitor -lCollect -lSQL -lTokenize -lUtils -lBasicUtils \
+	-L$(top_srcdir)/Collect -L$(top_srcdir)/Index -L$(top_srcdir)/Search -L$(top_srcdir)/Search/Google \
+	@SEARCH_LIBS@ -lIndex -lMonitor -lCollect -lSQL -lTokenize -lUtils -lBasicUtils \
 	@LIBS@ @UI_LIBS@ @INDEX_LIBS@ @DBUS_LIBS@ @SOAP_LIBS@ @XML_LIBS@ @MIME_LIBS@ @HTTP_LIBS@ @SQL_LIBS@ @MISC_LIBS@
 
 pinot_dbus_daemon_LDADD = -L$(top_srcdir)/Utils -L$(top_srcdir)/Tokenize -L$(top_srcdir)/SQL -L$(top_srcdir)/Monitor \
-	-L$(top_srcdir)/Collect -L$(top_srcdir)/Search -L$(top_srcdir)/Search/Google \
-	-L$(top_srcdir)/Index -lIndex @SEARCH_LIBS@ -lMonitor -lCollect -lSQL -lTokenize -lUtils -lBasicUtils \
+	-L$(top_srcdir)/Collect -L$(top_srcdir)/Index -L$(top_srcdir)/Search -L$(top_srcdir)/Search/Google \
+	@SEARCH_LIBS@ -lIndex -lMonitor -lCollect -lSQL -lTokenize -lUtils -lBasicUtils \
 	@LIBS@ @GLIBMM_LIBS@ @INDEX_LIBS@ @DBUS_LIBS@ @SOAP_LIBS@ @XML_LIBS@ @MIME_LIBS@ @HTTP_LIBS@ @SQL_LIBS@ @MISC_LIBS@
 

Modified: trunk/Utils/Makefile.am
===================================================================
--- trunk/Utils/Makefile.am	2006-10-18 15:24:46 UTC (rev 529)
+++ trunk/Utils/Makefile.am	2006-10-21 05:19:22 UTC (rev 530)
@@ -3,19 +3,17 @@
 noinst_HEADERS = \
 	CommandLine.h \
 	Document.h \
-	Languages.h \
-	MIMEScanner.h \
-	NLS.h \
-	StringManip.h \
-	Timer.h \
-	XapianDatabase.h \
 	DocumentInfo.h \
 	IndexedDocument.h \
+	Languages.h \
 	MboxParser.h \
+	MIMEScanner.h \
+	NLS.h \
 	Result.h \
+	StringManip.h \
 	TimeConverter.h \
+	Timer.h \
 	Url.h \
-	XapianDatabaseFactory.h \
 	xdgmime/xdgmimealias.h \
 	xdgmime/xdgmimecache.h \
 	xdgmime/xdgmimeglob.h \
@@ -37,12 +35,10 @@
 libUtils_la_SOURCES = \
 	IndexedDocument.cpp \
 	Languages.cpp \
-	MIMEScanner.cpp \
 	MboxParser.cpp \
+	MIMEScanner.cpp \
 	Result.cpp \
 	Timer.cpp \
-	XapianDatabase.cpp \
-	XapianDatabaseFactory.cpp \
 	xdgmime/xdgmimealias.c \
 	xdgmime/xdgmime.c \
 	xdgmime/xdgmimecache.c \

Deleted: trunk/Utils/XapianDatabase.cpp
===================================================================
--- trunk/Utils/XapianDatabase.cpp	2006-10-18 15:24:46 UTC (rev 529)
+++ trunk/Utils/XapianDatabase.cpp	2006-10-21 05:19:22 UTC (rev 530)
@@ -1,353 +0,0 @@
-/*
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU Library General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
- */
-
-#include <sys/types.h>
-#include <sys/stat.h>
-#include <fcntl.h>
-#include <unistd.h>
-#include <stdio.h>
-#include <iostream>
-
-#include "XapianDatabase.h"
-
-using std::cout;
-using std::cerr;
-using std::endl;
-using std::string;
-
-XapianDatabase::XapianDatabase(const string &databaseName, bool readOnly) :
-	m_databaseName(databaseName),
-	m_readOnly(readOnly),
-	m_pDatabase(NULL),
-	m_isOpen(false),
-	m_merge(false),
-	m_pFirst(NULL),
-	m_pSecond(NULL)
-{
-	pthread_rwlock_init(&m_rwLock, NULL);
-	openDatabase();
-}
-
-XapianDatabase::XapianDatabase(const string &databaseName, 
-	XapianDatabase *pFirst, XapianDatabase *pSecond) :
-	m_databaseName(databaseName),
-	m_readOnly(true),
-	m_pDatabase(NULL),
-	m_isOpen(pFirst->m_isOpen),
-	m_merge(true),
-	m_pFirst(pFirst),
-	m_pSecond(pSecond)
-{
-	pthread_rwlock_init(&m_rwLock, NULL);
-}
-
-XapianDatabase::XapianDatabase(const XapianDatabase &other) :
-	m_databaseName(other.m_databaseName),
-	m_readOnly(other.m_readOnly),
-	m_pDatabase(NULL),
-	m_isOpen(other.m_isOpen),
-	m_merge(other.m_merge),
-	m_pFirst(other.m_pFirst),
-	m_pSecond(other.m_pSecond)
-{
-	pthread_rwlock_init(&m_rwLock, NULL);
-	if (other.m_pDatabase != NULL)
-	{
-		m_pDatabase = new Xapian::Database(*other.m_pDatabase);
-	}
-}
-
-XapianDatabase::~XapianDatabase()
-{
-	if (m_pDatabase != NULL)
-	{
-		delete m_pDatabase;
-	}
-	pthread_rwlock_destroy(&m_rwLock);
-}
-
-XapianDatabase &XapianDatabase::operator=(const XapianDatabase &other)
-{
-	if (this != &other)
-	{
-		m_databaseName = other.m_databaseName;
-		m_readOnly = other.m_readOnly;
-		if (m_pDatabase != NULL)
-		{
-			delete m_pDatabase;
-			m_pDatabase = NULL;
-		}
-		if (other.m_pDatabase != NULL)
-		{
-			m_pDatabase = new Xapian::Database(*other.m_pDatabase);
-		}
-		m_isOpen = other.m_isOpen;
-		m_merge = other.m_merge;
-		m_pFirst = other.m_pFirst;
-		m_pSecond = other.m_pSecond;
-	}
-
-	return *this;
-}
-
-void XapianDatabase::openDatabase(void)
-{
-	struct stat dbStat;
-	bool createDatabase = false;
-
-	if (m_databaseName.empty() == true)
-	{
-		return;
-	}
-
-	// Assume things will fail
-	m_isOpen = false;
-
-	if (m_pDatabase != NULL)
-	{
-		delete m_pDatabase;
-		m_pDatabase = NULL;
-	}
-
-	// Is it a remote database ?
-	string::size_type slashPos = m_databaseName.find("/");
-	string::size_type colonPos = m_databaseName.find(":");
-	if ((slashPos == string::npos) &&
-		(colonPos != string::npos))
-	{
-		string hostName = m_databaseName.substr(0, colonPos);
-		unsigned int port = (unsigned int)atoi(m_databaseName.substr(colonPos + 1).c_str());
-
-		if (m_readOnly == false)
-		{
-			cerr << "XapianDatabase::openDatabase: remote databases are read-only" << endl;
-			return;
-		}
-
-		try
-		{
-#ifdef DEBUG
-			cout << "XapianDatabase::openDatabase: remote database at "
-				<< hostName << ":" << port << endl;
-#endif
-			Xapian::Database remoteDatabase = Xapian::Remote::open(hostName, port);
-			m_pDatabase = new Xapian::Database(remoteDatabase);
-			m_isOpen = true;
-
-			return;
-		}
-		catch (const Xapian::Error &error)
-		{
-			cerr << "XapianDatabase::openDatabase: couldn't open remote database: "
-				<< error.get_msg() << endl;
-		}
-
-		return;		
-	}
-
-	// It's a local database : the specified path must be a directory
-	if (stat(m_databaseName.c_str(), &dbStat) == -1)
-	{
-#ifdef DEBUG
-		cout << "XapianDatabase::openDatabase: database " << m_databaseName
-			<< " doesn't exist" << endl;
-#endif
-
-		// Database directory doesn't exist, create it (mode 755)
-		if (mkdir(m_databaseName.c_str(), (mode_t)S_IRUSR|S_IWUSR|S_IXUSR|S_IRGRP|S_IXGRP|S_IROTH|S_IXOTH) != 0)
-		{
-			cerr << "XapianDatabase::openDatabase: couldn't create database directory "
-				<< m_databaseName << endl;
-			return;
-		}
-		createDatabase = true;
-	}
-	else if (!S_ISDIR(dbStat.st_mode))
-	{
-		cerr << "XapianDatabase::openDatabase: " << m_databaseName
-			<< " is not a directory" << endl;
-		return;
-	}
-
-	// Try opening it now, creating if if necessary
-	try
-	{
-		if (m_readOnly == true)
-		{
-			if (createDatabase == true)
-			{
-				// We have to create the whole thing in read-write mode first
-				Xapian::WritableDatabase *pTmpDatabase = new Xapian::WritableDatabase(m_databaseName, Xapian::DB_CREATE_OR_OPEN);
-				// ...then close and open again in read-only mode
-				delete pTmpDatabase;
-			}
-
-			m_pDatabase = new Xapian::Database(m_databaseName);
-		}
-		else
-		{
-			m_pDatabase = new Xapian::WritableDatabase(m_databaseName, Xapian::DB_CREATE_OR_OPEN);
-		}
-#ifdef DEBUG
-		cout << "XapianDatabase::openDatabase: opened " << m_databaseName << endl;
-#endif
-		m_isOpen = true;
-
-		return;
-	}
-	catch (const Xapian::Error &error)
-	{
-		cerr << "XapianDatabase::openDatabase: couldn't open database: "
-			<< error.get_msg() << endl;
-	}
-
-	return;
-}
-
-/// Returns false if the database couldn't be opened.
-bool XapianDatabase::isOpen(void) const
-{
-	return m_isOpen;
-}
-
-/// Reopens the database.
-void XapianDatabase::reopen(void)
-{
-	// This is provided by Xapian::Database
-	// FIXME: get the write lock to make sure read operations are not in progress ?
-	if (pthread_rwlock_rdlock(&m_rwLock) == 0)
-	{
-		if (m_pDatabase != NULL)
-		{
-			m_pDatabase->reopen();
-		}
-
-		pthread_rwlock_unlock(&m_rwLock);
-	}
-}
-
-/// Attempts to lock and retrieve the database.
-Xapian::Database *XapianDatabase::readLock(void)
-{
-	if (m_merge == false)
-	{
-		if (pthread_rwlock_rdlock(&m_rwLock) == 0)
-		{
-			if (m_pDatabase == NULL)
-			{
-				// Try again
-				openDatabase();
-			}
-			return m_pDatabase;
-		}
-	}
-	else
-	{
-		if ((m_pFirst == NULL) ||
-			(m_pFirst->isOpen() == false) ||
-			(m_pSecond == NULL) ||
-			(m_pSecond->isOpen() == false))
-		{
-			return NULL;
-		}
-
-		if (pthread_rwlock_rdlock(&m_rwLock) == 0)
-		{
-			// Reopen the second index
-			m_pSecond->reopen();
-
-			// Lock both indexes
-			Xapian::Database *pFirstDatabase = m_pFirst->readLock();
-			Xapian::Database *pSecondDatabase = m_pSecond->readLock();
-			// Copy the first one
-			m_pDatabase = new Xapian::Database(*pFirstDatabase);
-			// Add the second index to it
-			if (pSecondDatabase != NULL)
-			{
-				m_pDatabase->add_database(*pSecondDatabase);
-			}
-			// Until unlock() is called, both indexes are read locked
-
-			return m_pDatabase;
-		}
-	}
-
-	return NULL;
-}
-
-/// Attempts to lock and retrieve the database.
-Xapian::WritableDatabase *XapianDatabase::writeLock(void)
-{
-	if ((m_readOnly == true) ||
-		(m_merge == true))
-	{
-		cerr << "Couldn't open read-only database " << m_databaseName
-			<< " for writing" << endl;
-		return NULL;
-	}
-
-	if (pthread_rwlock_wrlock(&m_rwLock) == 0)
-	{
-		if (m_pDatabase == NULL)
-		{
-			// Try again
-			openDatabase();
-		}
-		return dynamic_cast<Xapian::WritableDatabase *>(m_pDatabase);
-	}
-
-	return NULL;
-}
-
-/// Unlocks the database.
-void XapianDatabase::unlock(void)
-{
-	pthread_rwlock_unlock(&m_rwLock);
-
-	if (m_merge == true)
-	{
-		// Unlock the original indexes
-		if (m_pFirst != NULL)
-		{
-			m_pFirst->unlock();
-		}
-		if (m_pSecond != NULL)
-		{
-			m_pSecond->unlock();
-		}
-
-		// Delete merge
-		if (m_pDatabase != NULL)
-		{
-			delete m_pDatabase;
-			m_pDatabase = NULL;
-		}
-	}
-}
-
-/// Returns the URL for the given document in the given index.
-string XapianDatabase::buildUrl(const string &database, unsigned int docId)
-{
-	// Make up a pseudo URL
-	char docIdStr[64];
-	sprintf(docIdStr, "%u", docId);
-	string url = "xapian://localhost/";
-	url += database;
-	url += "/";
-	url += docIdStr;
-
-	return url;
-}

Deleted: trunk/Utils/XapianDatabase.h
===================================================================
--- trunk/Utils/XapianDatabase.h	2006-10-18 15:24:46 UTC (rev 529)
+++ trunk/Utils/XapianDatabase.h	2006-10-21 05:19:22 UTC (rev 530)
@@ -1,69 +0,0 @@
-/*
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU Library General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
- */
-
-#ifndef _XAPIAN_DATABASE_H
-#define _XAPIAN_DATABASE_H
-
-#include <string>
-#include <set>
-#include <pthread.h>
-
-#include <xapian.h>
-
-class XapianDatabase
-{
-	public:
-		XapianDatabase(const std::string &databaseName, bool readOnly = true);
-		XapianDatabase(const std::string &databaseName,
-			XapianDatabase *pFirst, XapianDatabase *pSecond);
-		XapianDatabase(const XapianDatabase &other);
-		virtual ~XapianDatabase();
-
-		XapianDatabase &operator=(const XapianDatabase &other);
-
-		/// Returns false if the database couldn't be opened.
-		bool isOpen(void) const;
-
-		/// Reopens the database.
-		void reopen(void);
-
-		/// Attempts to lock and retrieve the database.
-		Xapian::Database *readLock(void);
-
-		/// Attempts to lock and retrieve the database.
-		Xapian::WritableDatabase *writeLock(void);
-
-		/// Unlocks the database.
-		void unlock(void);
-
-		/// Returns the URL for the given document in the given index.
-		static std::string buildUrl(const std::string &database, unsigned int docId);
-
-	protected:
-		std::string m_databaseName;
-		bool m_readOnly;
-		pthread_rwlock_t m_rwLock;
-		Xapian::Database *m_pDatabase;
-		bool m_isOpen;
-		bool m_merge;
-		XapianDatabase *m_pFirst;
-		XapianDatabase *m_pSecond;
-
-		void openDatabase(void);
-
-};
-
-#endif // _XAPIAN_DATABASE_H

Deleted: trunk/Utils/XapianDatabaseFactory.cpp
===================================================================
--- trunk/Utils/XapianDatabaseFactory.cpp	2006-10-18 15:24:46 UTC (rev 529)
+++ trunk/Utils/XapianDatabaseFactory.cpp	2006-10-21 05:19:22 UTC (rev 530)
@@ -1,137 +0,0 @@
-/*
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU Library General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
- */
-
-#include <iostream>
-
-#include "XapianDatabaseFactory.h"
-
-using std::cout;
-using std::endl;
-using std::string;
-using std::map;
-using std::pair;
-
-pthread_mutex_t XapianDatabaseFactory::m_mutex = PTHREAD_MUTEX_INITIALIZER;
-map<string, XapianDatabase *> XapianDatabaseFactory::m_databases;
-
-XapianDatabaseFactory::XapianDatabaseFactory()
-{
-}
-
-XapianDatabaseFactory::~XapianDatabaseFactory()
-{
-}
-
-/// Merges two databases together and add the result to the list.
-bool XapianDatabaseFactory::mergeDatabases(const string &name,
-	XapianDatabase *pFirst, XapianDatabase *pSecond)
-{
-	map<string, XapianDatabase *>::iterator dbIter = m_databases.find(name);
-	if (dbIter != m_databases.end())
-	{
-		return false;
-	}
-
-	// Create the new database
-	XapianDatabase *pDb = new XapianDatabase(name, pFirst, pSecond);
-
-	// Insert it into the map
-	pair<map<string, XapianDatabase *>::iterator, bool> insertPair = m_databases.insert(pair<string, XapianDatabase *>(name, pDb));
-	// Was it inserted ?
-	if (insertPair.second == false)
-	{
-		// No, it wasn't : delete the object
-		delete pDb;
-
-		return false;
-	}
-
-	return true;
-}
-
-/// Returns a XapianDatabase pointer; NULL if unavailable.
-XapianDatabase *XapianDatabaseFactory::getDatabase(const string &location, bool readOnly)
-{
-	XapianDatabase *pDb = NULL;
-
-	if (location.empty() == true)
-	{
-		return NULL;
-	}
-
-	// Lock the map
-	if (pthread_mutex_lock(&m_mutex) != 0)
-	{
-		return NULL;
-	}
-
-	map<string, XapianDatabase *>::iterator dbIter = m_databases.find(location);
-	if (dbIter != m_databases.end())
-	{
-		pDb = dbIter->second;
-	}
-	else
-	{
-		// Create a new instance
-		pDb = new XapianDatabase(location, readOnly);
-		// Insert it into the map
-		pair<map<string, XapianDatabase *>::iterator, bool> insertPair = m_databases.insert(pair<string, XapianDatabase *>(location, pDb));
-		// Was it inserted ?
-		if (insertPair.second == false)
-		{
-			// No, it wasn't : delete the object
-			delete pDb;
-			pDb = NULL;
-		}
-	}
-
-	// Unlock the map
-	pthread_mutex_unlock(&m_mutex);
-
-	return pDb;
-}
-
-/// Closes all databases.
-void XapianDatabaseFactory::closeAll(void)
-{
-	if (m_databases.empty() == true)
-	{
-		return;
-	}
-
-	// Lock the map
-	if (pthread_mutex_lock(&m_mutex) != 0)
-	{
-		return;
-	}
-
-	std::map<std::string, XapianDatabase *>::iterator dbIter = m_databases.begin();
-	while (dbIter != m_databases.end())
-	{
-		XapianDatabase *pDb = dbIter->second;
-		dbIter->second = NULL;
-#ifdef DEBUG
-		cout << "XapianDatabaseFactory::closeAll: closing " << dbIter->first << endl;
-#endif
-		m_databases.erase(dbIter);
-		delete pDb;
-
-		dbIter = m_databases.begin();
-	}
-
-	// Unlock the map
-	pthread_mutex_unlock(&m_mutex);
-}

Deleted: trunk/Utils/XapianDatabaseFactory.h
===================================================================
--- trunk/Utils/XapianDatabaseFactory.h	2006-10-18 15:24:46 UTC (rev 529)
+++ trunk/Utils/XapianDatabaseFactory.h	2006-10-21 05:19:22 UTC (rev 530)
@@ -1,53 +0,0 @@
-/*
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU Library General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
- */
-
-#ifndef _XAPIAN_DATABASE_FACTORY_H
-#define _XAPIAN_DATABASE_FACTORY_H
-
-#include <string>
-#include <map>
-#include <pthread.h>
-
-#include "XapianDatabase.h"
-
-class XapianDatabaseFactory
-{
-	public:
-		virtual ~XapianDatabaseFactory();
-
-		/// Merges two databases together and add the result to the list.
-		static bool mergeDatabases(const std::string &name,
-			XapianDatabase *pFirst, XapianDatabase *pSecond);
-
-		/// Returns a XapianDatabase pointer; NULL if unavailable.
-		static XapianDatabase *getDatabase(const std::string &location, bool readOnly = true);
-
-		/// Closes all databases.
-		static void closeAll(void);
-
-	protected:
-		static pthread_mutex_t m_mutex;
-		static std::map<std::string, XapianDatabase *> m_databases;
-
-		XapianDatabaseFactory();
-
-	private:
-		XapianDatabaseFactory(const XapianDatabaseFactory &other);
-		XapianDatabaseFactory &operator=(const XapianDatabaseFactory &other);
-
-};
-
-#endif // _XAPIAN_DATABASE_FACTORY_H



From fabricecolin at mail.berlios.de  Tue Oct 24 07:43:05 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 24 Oct 2006 07:43:05 +0200
Subject: [Pinot-svn] r531 - trunk/Utils
Message-ID: <200610240543.k9O5h5o1026824@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-24 07:43:03 +0200 (Tue, 24 Oct 2006)
New Revision: 531

Modified:
   trunk/Utils/CommandLine.cpp
   trunk/Utils/CommandLine.h
   trunk/Utils/Document.cpp
   trunk/Utils/Document.h
   trunk/Utils/DocumentInfo.cpp
   trunk/Utils/DocumentInfo.h
   trunk/Utils/IndexedDocument.cpp
   trunk/Utils/IndexedDocument.h
   trunk/Utils/Languages.cpp
   trunk/Utils/Languages.h
   trunk/Utils/MIMEScanner.cpp
   trunk/Utils/MIMEScanner.h
   trunk/Utils/MboxParser.cpp
   trunk/Utils/MboxParser.h
   trunk/Utils/NLS.h
   trunk/Utils/Result.cpp
   trunk/Utils/Result.h
   trunk/Utils/StringManip.cpp
   trunk/Utils/StringManip.h
   trunk/Utils/TimeConverter.cpp
   trunk/Utils/TimeConverter.h
   trunk/Utils/Timer.cpp
   trunk/Utils/Timer.h
   trunk/Utils/Url.cpp
   trunk/Utils/Url.h
Log:
Added missing copyright notice.


Modified: trunk/Utils/CommandLine.cpp
===================================================================
--- trunk/Utils/CommandLine.cpp	2006-10-21 05:19:22 UTC (rev 530)
+++ trunk/Utils/CommandLine.cpp	2006-10-24 05:43:03 UTC (rev 531)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Utils/CommandLine.h
===================================================================
--- trunk/Utils/CommandLine.h	2006-10-21 05:19:22 UTC (rev 530)
+++ trunk/Utils/CommandLine.h	2006-10-24 05:43:03 UTC (rev 531)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Utils/Document.cpp
===================================================================
--- trunk/Utils/Document.cpp	2006-10-21 05:19:22 UTC (rev 530)
+++ trunk/Utils/Document.cpp	2006-10-24 05:43:03 UTC (rev 531)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Utils/Document.h
===================================================================
--- trunk/Utils/Document.h	2006-10-21 05:19:22 UTC (rev 530)
+++ trunk/Utils/Document.h	2006-10-24 05:43:03 UTC (rev 531)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Utils/DocumentInfo.cpp
===================================================================
--- trunk/Utils/DocumentInfo.cpp	2006-10-21 05:19:22 UTC (rev 530)
+++ trunk/Utils/DocumentInfo.cpp	2006-10-24 05:43:03 UTC (rev 531)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Utils/DocumentInfo.h
===================================================================
--- trunk/Utils/DocumentInfo.h	2006-10-21 05:19:22 UTC (rev 530)
+++ trunk/Utils/DocumentInfo.h	2006-10-24 05:43:03 UTC (rev 531)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Utils/IndexedDocument.cpp
===================================================================
--- trunk/Utils/IndexedDocument.cpp	2006-10-21 05:19:22 UTC (rev 530)
+++ trunk/Utils/IndexedDocument.cpp	2006-10-24 05:43:03 UTC (rev 531)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Utils/IndexedDocument.h
===================================================================
--- trunk/Utils/IndexedDocument.h	2006-10-21 05:19:22 UTC (rev 530)
+++ trunk/Utils/IndexedDocument.h	2006-10-24 05:43:03 UTC (rev 531)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Utils/Languages.cpp
===================================================================
--- trunk/Utils/Languages.cpp	2006-10-21 05:19:22 UTC (rev 530)
+++ trunk/Utils/Languages.cpp	2006-10-24 05:43:03 UTC (rev 531)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Utils/Languages.h
===================================================================
--- trunk/Utils/Languages.h	2006-10-21 05:19:22 UTC (rev 530)
+++ trunk/Utils/Languages.h	2006-10-24 05:43:03 UTC (rev 531)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Utils/MIMEScanner.cpp
===================================================================
--- trunk/Utils/MIMEScanner.cpp	2006-10-21 05:19:22 UTC (rev 530)
+++ trunk/Utils/MIMEScanner.cpp	2006-10-24 05:43:03 UTC (rev 531)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Utils/MIMEScanner.h
===================================================================
--- trunk/Utils/MIMEScanner.h	2006-10-21 05:19:22 UTC (rev 530)
+++ trunk/Utils/MIMEScanner.h	2006-10-24 05:43:03 UTC (rev 531)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Utils/MboxParser.cpp
===================================================================
--- trunk/Utils/MboxParser.cpp	2006-10-21 05:19:22 UTC (rev 530)
+++ trunk/Utils/MboxParser.cpp	2006-10-24 05:43:03 UTC (rev 531)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Utils/MboxParser.h
===================================================================
--- trunk/Utils/MboxParser.h	2006-10-21 05:19:22 UTC (rev 530)
+++ trunk/Utils/MboxParser.h	2006-10-24 05:43:03 UTC (rev 531)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Utils/NLS.h
===================================================================
--- trunk/Utils/NLS.h	2006-10-21 05:19:22 UTC (rev 530)
+++ trunk/Utils/NLS.h	2006-10-24 05:43:03 UTC (rev 531)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Utils/Result.cpp
===================================================================
--- trunk/Utils/Result.cpp	2006-10-21 05:19:22 UTC (rev 530)
+++ trunk/Utils/Result.cpp	2006-10-24 05:43:03 UTC (rev 531)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Utils/Result.h
===================================================================
--- trunk/Utils/Result.h	2006-10-21 05:19:22 UTC (rev 530)
+++ trunk/Utils/Result.h	2006-10-24 05:43:03 UTC (rev 531)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Utils/StringManip.cpp
===================================================================
--- trunk/Utils/StringManip.cpp	2006-10-21 05:19:22 UTC (rev 530)
+++ trunk/Utils/StringManip.cpp	2006-10-24 05:43:03 UTC (rev 531)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Utils/StringManip.h
===================================================================
--- trunk/Utils/StringManip.h	2006-10-21 05:19:22 UTC (rev 530)
+++ trunk/Utils/StringManip.h	2006-10-24 05:43:03 UTC (rev 531)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Utils/TimeConverter.cpp
===================================================================
--- trunk/Utils/TimeConverter.cpp	2006-10-21 05:19:22 UTC (rev 530)
+++ trunk/Utils/TimeConverter.cpp	2006-10-24 05:43:03 UTC (rev 531)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Utils/TimeConverter.h
===================================================================
--- trunk/Utils/TimeConverter.h	2006-10-21 05:19:22 UTC (rev 530)
+++ trunk/Utils/TimeConverter.h	2006-10-24 05:43:03 UTC (rev 531)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Utils/Timer.cpp
===================================================================
--- trunk/Utils/Timer.cpp	2006-10-21 05:19:22 UTC (rev 530)
+++ trunk/Utils/Timer.cpp	2006-10-24 05:43:03 UTC (rev 531)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Utils/Timer.h
===================================================================
--- trunk/Utils/Timer.h	2006-10-21 05:19:22 UTC (rev 530)
+++ trunk/Utils/Timer.h	2006-10-24 05:43:03 UTC (rev 531)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Utils/Url.cpp
===================================================================
--- trunk/Utils/Url.cpp	2006-10-21 05:19:22 UTC (rev 530)
+++ trunk/Utils/Url.cpp	2006-10-24 05:43:03 UTC (rev 531)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Utils/Url.h
===================================================================
--- trunk/Utils/Url.h	2006-10-21 05:19:22 UTC (rev 530)
+++ trunk/Utils/Url.h	2006-10-24 05:43:03 UTC (rev 531)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2006,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or



From fabricecolin at mail.berlios.de  Tue Oct 24 07:43:55 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 24 Oct 2006 07:43:55 +0200
Subject: [Pinot-svn] r532 - trunk/Search/Plugins
Message-ID: <200610240543.k9O5htwg026928@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-24 07:43:55 +0200 (Tue, 24 Oct 2006)
New Revision: 532

Modified:
   trunk/Search/Plugins/A9.src
Log:
A9's output changed.


Modified: trunk/Search/Plugins/A9.src
===================================================================
--- trunk/Search/Plugins/A9.src	2006-10-24 05:43:03 UTC (rev 531)
+++ trunk/Search/Plugins/A9.src	2006-10-24 05:43:55 UTC (rev 532)
@@ -17,8 +17,8 @@
 <INTERPRET
 resultListStart=""
 resultListEnd=""
-resultItemStart='style="margin-bottom:'
-resultItemEnd='</div>'
+resultItemStart='<div class="resBlock">'
+resultItemEnd='class="site-info">'
 >
 
 </SEARCH>



From fabricecolin at mail.berlios.de  Tue Oct 24 07:46:56 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 24 Oct 2006 07:46:56 +0200
Subject: [Pinot-svn] r533 - trunk/Tokenize
Message-ID: <200610240546.k9O5kuY1027098@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-24 07:46:56 +0200 (Tue, 24 Oct 2006)
New Revision: 533

Modified:
   trunk/Tokenize/HtmlTokenizer.cpp
   trunk/Tokenize/HtmlTokenizer.h
   trunk/Tokenize/OpenDocumentTokenizer.cpp
   trunk/Tokenize/OpenDocumentTokenizer.h
   trunk/Tokenize/PdfTokenizer.cpp
   trunk/Tokenize/PdfTokenizer.h
   trunk/Tokenize/RtfTokenizer.cpp
   trunk/Tokenize/RtfTokenizer.h
   trunk/Tokenize/TagLibTokenizer.cpp
   trunk/Tokenize/TagLibTokenizer.h
   trunk/Tokenize/Tokenizer.cpp
   trunk/Tokenize/Tokenizer.h
   trunk/Tokenize/TokenizerFactory.cpp
   trunk/Tokenize/TokenizerFactory.h
   trunk/Tokenize/UnknownTypeTokenizer.cpp
   trunk/Tokenize/UnknownTypeTokenizer.h
   trunk/Tokenize/WordTokenizer.cpp
   trunk/Tokenize/WordTokenizer.h
   trunk/Tokenize/XmlTokenizer.cpp
   trunk/Tokenize/XmlTokenizer.h
   trunk/Tokenize/tokenizertest.cpp
Log:
Added missing copyright notice.


Modified: trunk/Tokenize/HtmlTokenizer.cpp
===================================================================
--- trunk/Tokenize/HtmlTokenizer.cpp	2006-10-24 05:43:55 UTC (rev 532)
+++ trunk/Tokenize/HtmlTokenizer.cpp	2006-10-24 05:46:56 UTC (rev 533)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2006,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Tokenize/HtmlTokenizer.h
===================================================================
--- trunk/Tokenize/HtmlTokenizer.h	2006-10-24 05:43:55 UTC (rev 532)
+++ trunk/Tokenize/HtmlTokenizer.h	2006-10-24 05:46:56 UTC (rev 533)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2006,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Tokenize/OpenDocumentTokenizer.cpp
===================================================================
--- trunk/Tokenize/OpenDocumentTokenizer.cpp	2006-10-24 05:43:55 UTC (rev 532)
+++ trunk/Tokenize/OpenDocumentTokenizer.cpp	2006-10-24 05:46:56 UTC (rev 533)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2006,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Tokenize/OpenDocumentTokenizer.h
===================================================================
--- trunk/Tokenize/OpenDocumentTokenizer.h	2006-10-24 05:43:55 UTC (rev 532)
+++ trunk/Tokenize/OpenDocumentTokenizer.h	2006-10-24 05:46:56 UTC (rev 533)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2006,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Tokenize/PdfTokenizer.cpp
===================================================================
--- trunk/Tokenize/PdfTokenizer.cpp	2006-10-24 05:43:55 UTC (rev 532)
+++ trunk/Tokenize/PdfTokenizer.cpp	2006-10-24 05:46:56 UTC (rev 533)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2006,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Tokenize/PdfTokenizer.h
===================================================================
--- trunk/Tokenize/PdfTokenizer.h	2006-10-24 05:43:55 UTC (rev 532)
+++ trunk/Tokenize/PdfTokenizer.h	2006-10-24 05:46:56 UTC (rev 533)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2006,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Tokenize/RtfTokenizer.cpp
===================================================================
--- trunk/Tokenize/RtfTokenizer.cpp	2006-10-24 05:43:55 UTC (rev 532)
+++ trunk/Tokenize/RtfTokenizer.cpp	2006-10-24 05:46:56 UTC (rev 533)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2006,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Tokenize/RtfTokenizer.h
===================================================================
--- trunk/Tokenize/RtfTokenizer.h	2006-10-24 05:43:55 UTC (rev 532)
+++ trunk/Tokenize/RtfTokenizer.h	2006-10-24 05:46:56 UTC (rev 533)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2006,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Tokenize/TagLibTokenizer.cpp
===================================================================
--- trunk/Tokenize/TagLibTokenizer.cpp	2006-10-24 05:43:55 UTC (rev 532)
+++ trunk/Tokenize/TagLibTokenizer.cpp	2006-10-24 05:46:56 UTC (rev 533)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2006,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Tokenize/TagLibTokenizer.h
===================================================================
--- trunk/Tokenize/TagLibTokenizer.h	2006-10-24 05:43:55 UTC (rev 532)
+++ trunk/Tokenize/TagLibTokenizer.h	2006-10-24 05:46:56 UTC (rev 533)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2006,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Tokenize/Tokenizer.cpp
===================================================================
--- trunk/Tokenize/Tokenizer.cpp	2006-10-24 05:43:55 UTC (rev 532)
+++ trunk/Tokenize/Tokenizer.cpp	2006-10-24 05:46:56 UTC (rev 533)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2006,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Tokenize/Tokenizer.h
===================================================================
--- trunk/Tokenize/Tokenizer.h	2006-10-24 05:43:55 UTC (rev 532)
+++ trunk/Tokenize/Tokenizer.h	2006-10-24 05:46:56 UTC (rev 533)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2006,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Tokenize/TokenizerFactory.cpp
===================================================================
--- trunk/Tokenize/TokenizerFactory.cpp	2006-10-24 05:43:55 UTC (rev 532)
+++ trunk/Tokenize/TokenizerFactory.cpp	2006-10-24 05:46:56 UTC (rev 533)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2006,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Tokenize/TokenizerFactory.h
===================================================================
--- trunk/Tokenize/TokenizerFactory.h	2006-10-24 05:43:55 UTC (rev 532)
+++ trunk/Tokenize/TokenizerFactory.h	2006-10-24 05:46:56 UTC (rev 533)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2006,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Tokenize/UnknownTypeTokenizer.cpp
===================================================================
--- trunk/Tokenize/UnknownTypeTokenizer.cpp	2006-10-24 05:43:55 UTC (rev 532)
+++ trunk/Tokenize/UnknownTypeTokenizer.cpp	2006-10-24 05:46:56 UTC (rev 533)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2006,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Tokenize/UnknownTypeTokenizer.h
===================================================================
--- trunk/Tokenize/UnknownTypeTokenizer.h	2006-10-24 05:43:55 UTC (rev 532)
+++ trunk/Tokenize/UnknownTypeTokenizer.h	2006-10-24 05:46:56 UTC (rev 533)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2006,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Tokenize/WordTokenizer.cpp
===================================================================
--- trunk/Tokenize/WordTokenizer.cpp	2006-10-24 05:43:55 UTC (rev 532)
+++ trunk/Tokenize/WordTokenizer.cpp	2006-10-24 05:46:56 UTC (rev 533)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2006,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Tokenize/WordTokenizer.h
===================================================================
--- trunk/Tokenize/WordTokenizer.h	2006-10-24 05:43:55 UTC (rev 532)
+++ trunk/Tokenize/WordTokenizer.h	2006-10-24 05:46:56 UTC (rev 533)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2006,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Tokenize/XmlTokenizer.cpp
===================================================================
--- trunk/Tokenize/XmlTokenizer.cpp	2006-10-24 05:43:55 UTC (rev 532)
+++ trunk/Tokenize/XmlTokenizer.cpp	2006-10-24 05:46:56 UTC (rev 533)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2006,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Tokenize/XmlTokenizer.h
===================================================================
--- trunk/Tokenize/XmlTokenizer.h	2006-10-24 05:43:55 UTC (rev 532)
+++ trunk/Tokenize/XmlTokenizer.h	2006-10-24 05:46:56 UTC (rev 533)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2006,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Tokenize/tokenizertest.cpp
===================================================================
--- trunk/Tokenize/tokenizertest.cpp	2006-10-24 05:43:55 UTC (rev 532)
+++ trunk/Tokenize/tokenizertest.cpp	2006-10-24 05:46:56 UTC (rev 533)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2006,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or



From fabricecolin at mail.berlios.de  Tue Oct 24 07:48:19 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 24 Oct 2006 07:48:19 +0200
Subject: [Pinot-svn] r534 - trunk/SQL
Message-ID: <200610240548.k9O5mJcf027255@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-24 07:48:19 +0200 (Tue, 24 Oct 2006)
New Revision: 534

Modified:
   trunk/SQL/CrawlHistory.cpp
   trunk/SQL/CrawlHistory.h
   trunk/SQL/QueryHistory.cpp
   trunk/SQL/QueryHistory.h
   trunk/SQL/SQLiteBase.cpp
   trunk/SQL/SQLiteBase.h
   trunk/SQL/ViewHistory.cpp
   trunk/SQL/ViewHistory.h
   trunk/SQL/historytest.cpp
Log:
Added missing copyright notice.


Modified: trunk/SQL/CrawlHistory.cpp
===================================================================
--- trunk/SQL/CrawlHistory.cpp	2006-10-24 05:46:56 UTC (rev 533)
+++ trunk/SQL/CrawlHistory.cpp	2006-10-24 05:48:19 UTC (rev 534)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2006,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/SQL/CrawlHistory.h
===================================================================
--- trunk/SQL/CrawlHistory.h	2006-10-24 05:46:56 UTC (rev 533)
+++ trunk/SQL/CrawlHistory.h	2006-10-24 05:48:19 UTC (rev 534)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2006,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/SQL/QueryHistory.cpp
===================================================================
--- trunk/SQL/QueryHistory.cpp	2006-10-24 05:46:56 UTC (rev 533)
+++ trunk/SQL/QueryHistory.cpp	2006-10-24 05:48:19 UTC (rev 534)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2006,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/SQL/QueryHistory.h
===================================================================
--- trunk/SQL/QueryHistory.h	2006-10-24 05:46:56 UTC (rev 533)
+++ trunk/SQL/QueryHistory.h	2006-10-24 05:48:19 UTC (rev 534)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2006,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/SQL/SQLiteBase.cpp
===================================================================
--- trunk/SQL/SQLiteBase.cpp	2006-10-24 05:46:56 UTC (rev 533)
+++ trunk/SQL/SQLiteBase.cpp	2006-10-24 05:48:19 UTC (rev 534)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2006,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/SQL/SQLiteBase.h
===================================================================
--- trunk/SQL/SQLiteBase.h	2006-10-24 05:46:56 UTC (rev 533)
+++ trunk/SQL/SQLiteBase.h	2006-10-24 05:48:19 UTC (rev 534)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2006,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/SQL/ViewHistory.cpp
===================================================================
--- trunk/SQL/ViewHistory.cpp	2006-10-24 05:46:56 UTC (rev 533)
+++ trunk/SQL/ViewHistory.cpp	2006-10-24 05:48:19 UTC (rev 534)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2006,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/SQL/ViewHistory.h
===================================================================
--- trunk/SQL/ViewHistory.h	2006-10-24 05:46:56 UTC (rev 533)
+++ trunk/SQL/ViewHistory.h	2006-10-24 05:48:19 UTC (rev 534)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2006,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/SQL/historytest.cpp
===================================================================
--- trunk/SQL/historytest.cpp	2006-10-24 05:46:56 UTC (rev 533)
+++ trunk/SQL/historytest.cpp	2006-10-24 05:48:19 UTC (rev 534)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2006,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or



From fabricecolin at mail.berlios.de  Tue Oct 24 12:12:19 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 24 Oct 2006 12:12:19 +0200
Subject: [Pinot-svn] r535 - in trunk: SQL Tokenize Utils
Message-ID: <200610241012.k9OACJqV028973@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-24 12:12:18 +0200 (Tue, 24 Oct 2006)
New Revision: 535

Modified:
   trunk/SQL/CrawlHistory.cpp
   trunk/SQL/CrawlHistory.h
   trunk/SQL/QueryHistory.cpp
   trunk/SQL/QueryHistory.h
   trunk/SQL/SQLiteBase.cpp
   trunk/SQL/SQLiteBase.h
   trunk/SQL/ViewHistory.cpp
   trunk/SQL/ViewHistory.h
   trunk/SQL/historytest.cpp
   trunk/Tokenize/HtmlTokenizer.cpp
   trunk/Tokenize/HtmlTokenizer.h
   trunk/Tokenize/OpenDocumentTokenizer.cpp
   trunk/Tokenize/OpenDocumentTokenizer.h
   trunk/Tokenize/PdfTokenizer.cpp
   trunk/Tokenize/PdfTokenizer.h
   trunk/Tokenize/RtfTokenizer.cpp
   trunk/Tokenize/RtfTokenizer.h
   trunk/Tokenize/TagLibTokenizer.cpp
   trunk/Tokenize/TagLibTokenizer.h
   trunk/Tokenize/Tokenizer.cpp
   trunk/Tokenize/Tokenizer.h
   trunk/Tokenize/TokenizerFactory.cpp
   trunk/Tokenize/TokenizerFactory.h
   trunk/Tokenize/UnknownTypeTokenizer.cpp
   trunk/Tokenize/UnknownTypeTokenizer.h
   trunk/Tokenize/WordTokenizer.cpp
   trunk/Tokenize/WordTokenizer.h
   trunk/Tokenize/XmlTokenizer.cpp
   trunk/Tokenize/XmlTokenizer.h
   trunk/Tokenize/tokenizertest.cpp
   trunk/Utils/Url.h
Log:
Do it properly !!!


Modified: trunk/SQL/CrawlHistory.cpp
===================================================================
--- trunk/SQL/CrawlHistory.cpp	2006-10-24 05:48:19 UTC (rev 534)
+++ trunk/SQL/CrawlHistory.cpp	2006-10-24 10:12:18 UTC (rev 535)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2006,2006 Fabrice Colin
+ *  Copyright 2005,2006 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by

Modified: trunk/SQL/CrawlHistory.h
===================================================================
--- trunk/SQL/CrawlHistory.h	2006-10-24 05:48:19 UTC (rev 534)
+++ trunk/SQL/CrawlHistory.h	2006-10-24 10:12:18 UTC (rev 535)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2006,2006 Fabrice Colin
+ *  Copyright 2005,2006 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by

Modified: trunk/SQL/QueryHistory.cpp
===================================================================
--- trunk/SQL/QueryHistory.cpp	2006-10-24 05:48:19 UTC (rev 534)
+++ trunk/SQL/QueryHistory.cpp	2006-10-24 10:12:18 UTC (rev 535)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2006,2006 Fabrice Colin
+ *  Copyright 2005,2006 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by

Modified: trunk/SQL/QueryHistory.h
===================================================================
--- trunk/SQL/QueryHistory.h	2006-10-24 05:48:19 UTC (rev 534)
+++ trunk/SQL/QueryHistory.h	2006-10-24 10:12:18 UTC (rev 535)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2006,2006 Fabrice Colin
+ *  Copyright 2005,2006 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by

Modified: trunk/SQL/SQLiteBase.cpp
===================================================================
--- trunk/SQL/SQLiteBase.cpp	2006-10-24 05:48:19 UTC (rev 534)
+++ trunk/SQL/SQLiteBase.cpp	2006-10-24 10:12:18 UTC (rev 535)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2006,2006 Fabrice Colin
+ *  Copyright 2005,2006 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by

Modified: trunk/SQL/SQLiteBase.h
===================================================================
--- trunk/SQL/SQLiteBase.h	2006-10-24 05:48:19 UTC (rev 534)
+++ trunk/SQL/SQLiteBase.h	2006-10-24 10:12:18 UTC (rev 535)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2006,2006 Fabrice Colin
+ *  Copyright 2005,2006 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by

Modified: trunk/SQL/ViewHistory.cpp
===================================================================
--- trunk/SQL/ViewHistory.cpp	2006-10-24 05:48:19 UTC (rev 534)
+++ trunk/SQL/ViewHistory.cpp	2006-10-24 10:12:18 UTC (rev 535)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2006,2006 Fabrice Colin
+ *  Copyright 2005,2006 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by

Modified: trunk/SQL/ViewHistory.h
===================================================================
--- trunk/SQL/ViewHistory.h	2006-10-24 05:48:19 UTC (rev 534)
+++ trunk/SQL/ViewHistory.h	2006-10-24 10:12:18 UTC (rev 535)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2006,2006 Fabrice Colin
+ *  Copyright 2005,2006 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by

Modified: trunk/SQL/historytest.cpp
===================================================================
--- trunk/SQL/historytest.cpp	2006-10-24 05:48:19 UTC (rev 534)
+++ trunk/SQL/historytest.cpp	2006-10-24 10:12:18 UTC (rev 535)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2006,2006 Fabrice Colin
+ *  Copyright 2005,2006 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by

Modified: trunk/Tokenize/HtmlTokenizer.cpp
===================================================================
--- trunk/Tokenize/HtmlTokenizer.cpp	2006-10-24 05:48:19 UTC (rev 534)
+++ trunk/Tokenize/HtmlTokenizer.cpp	2006-10-24 10:12:18 UTC (rev 535)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2006,2006 Fabrice Colin
+ *  Copyright 2005,2006 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by

Modified: trunk/Tokenize/HtmlTokenizer.h
===================================================================
--- trunk/Tokenize/HtmlTokenizer.h	2006-10-24 05:48:19 UTC (rev 534)
+++ trunk/Tokenize/HtmlTokenizer.h	2006-10-24 10:12:18 UTC (rev 535)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2006,2006 Fabrice Colin
+ *  Copyright 2005,2006 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by

Modified: trunk/Tokenize/OpenDocumentTokenizer.cpp
===================================================================
--- trunk/Tokenize/OpenDocumentTokenizer.cpp	2006-10-24 05:48:19 UTC (rev 534)
+++ trunk/Tokenize/OpenDocumentTokenizer.cpp	2006-10-24 10:12:18 UTC (rev 535)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2006,2006 Fabrice Colin
+ *  Copyright 2005,2006 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by

Modified: trunk/Tokenize/OpenDocumentTokenizer.h
===================================================================
--- trunk/Tokenize/OpenDocumentTokenizer.h	2006-10-24 05:48:19 UTC (rev 534)
+++ trunk/Tokenize/OpenDocumentTokenizer.h	2006-10-24 10:12:18 UTC (rev 535)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2006,2006 Fabrice Colin
+ *  Copyright 2005,2006 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by

Modified: trunk/Tokenize/PdfTokenizer.cpp
===================================================================
--- trunk/Tokenize/PdfTokenizer.cpp	2006-10-24 05:48:19 UTC (rev 534)
+++ trunk/Tokenize/PdfTokenizer.cpp	2006-10-24 10:12:18 UTC (rev 535)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2006,2006 Fabrice Colin
+ *  Copyright 2005,2006 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by

Modified: trunk/Tokenize/PdfTokenizer.h
===================================================================
--- trunk/Tokenize/PdfTokenizer.h	2006-10-24 05:48:19 UTC (rev 534)
+++ trunk/Tokenize/PdfTokenizer.h	2006-10-24 10:12:18 UTC (rev 535)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2006,2006 Fabrice Colin
+ *  Copyright 2005,2006 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by

Modified: trunk/Tokenize/RtfTokenizer.cpp
===================================================================
--- trunk/Tokenize/RtfTokenizer.cpp	2006-10-24 05:48:19 UTC (rev 534)
+++ trunk/Tokenize/RtfTokenizer.cpp	2006-10-24 10:12:18 UTC (rev 535)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2006,2006 Fabrice Colin
+ *  Copyright 2005,2006 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by

Modified: trunk/Tokenize/RtfTokenizer.h
===================================================================
--- trunk/Tokenize/RtfTokenizer.h	2006-10-24 05:48:19 UTC (rev 534)
+++ trunk/Tokenize/RtfTokenizer.h	2006-10-24 10:12:18 UTC (rev 535)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2006,2006 Fabrice Colin
+ *  Copyright 2005,2006 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by

Modified: trunk/Tokenize/TagLibTokenizer.cpp
===================================================================
--- trunk/Tokenize/TagLibTokenizer.cpp	2006-10-24 05:48:19 UTC (rev 534)
+++ trunk/Tokenize/TagLibTokenizer.cpp	2006-10-24 10:12:18 UTC (rev 535)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2006,2006 Fabrice Colin
+ *  Copyright 2005,2006 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by

Modified: trunk/Tokenize/TagLibTokenizer.h
===================================================================
--- trunk/Tokenize/TagLibTokenizer.h	2006-10-24 05:48:19 UTC (rev 534)
+++ trunk/Tokenize/TagLibTokenizer.h	2006-10-24 10:12:18 UTC (rev 535)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2006,2006 Fabrice Colin
+ *  Copyright 2005,2006 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by

Modified: trunk/Tokenize/Tokenizer.cpp
===================================================================
--- trunk/Tokenize/Tokenizer.cpp	2006-10-24 05:48:19 UTC (rev 534)
+++ trunk/Tokenize/Tokenizer.cpp	2006-10-24 10:12:18 UTC (rev 535)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2006,2006 Fabrice Colin
+ *  Copyright 2005,2006 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by

Modified: trunk/Tokenize/Tokenizer.h
===================================================================
--- trunk/Tokenize/Tokenizer.h	2006-10-24 05:48:19 UTC (rev 534)
+++ trunk/Tokenize/Tokenizer.h	2006-10-24 10:12:18 UTC (rev 535)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2006,2006 Fabrice Colin
+ *  Copyright 2005,2006 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by

Modified: trunk/Tokenize/TokenizerFactory.cpp
===================================================================
--- trunk/Tokenize/TokenizerFactory.cpp	2006-10-24 05:48:19 UTC (rev 534)
+++ trunk/Tokenize/TokenizerFactory.cpp	2006-10-24 10:12:18 UTC (rev 535)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2006,2006 Fabrice Colin
+ *  Copyright 2005,2006 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by

Modified: trunk/Tokenize/TokenizerFactory.h
===================================================================
--- trunk/Tokenize/TokenizerFactory.h	2006-10-24 05:48:19 UTC (rev 534)
+++ trunk/Tokenize/TokenizerFactory.h	2006-10-24 10:12:18 UTC (rev 535)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2006,2006 Fabrice Colin
+ *  Copyright 2005,2006 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by

Modified: trunk/Tokenize/UnknownTypeTokenizer.cpp
===================================================================
--- trunk/Tokenize/UnknownTypeTokenizer.cpp	2006-10-24 05:48:19 UTC (rev 534)
+++ trunk/Tokenize/UnknownTypeTokenizer.cpp	2006-10-24 10:12:18 UTC (rev 535)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2006,2006 Fabrice Colin
+ *  Copyright 2005,2006 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by

Modified: trunk/Tokenize/UnknownTypeTokenizer.h
===================================================================
--- trunk/Tokenize/UnknownTypeTokenizer.h	2006-10-24 05:48:19 UTC (rev 534)
+++ trunk/Tokenize/UnknownTypeTokenizer.h	2006-10-24 10:12:18 UTC (rev 535)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2006,2006 Fabrice Colin
+ *  Copyright 2005,2006 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by

Modified: trunk/Tokenize/WordTokenizer.cpp
===================================================================
--- trunk/Tokenize/WordTokenizer.cpp	2006-10-24 05:48:19 UTC (rev 534)
+++ trunk/Tokenize/WordTokenizer.cpp	2006-10-24 10:12:18 UTC (rev 535)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2006,2006 Fabrice Colin
+ *  Copyright 2005,2006 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by

Modified: trunk/Tokenize/WordTokenizer.h
===================================================================
--- trunk/Tokenize/WordTokenizer.h	2006-10-24 05:48:19 UTC (rev 534)
+++ trunk/Tokenize/WordTokenizer.h	2006-10-24 10:12:18 UTC (rev 535)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2006,2006 Fabrice Colin
+ *  Copyright 2005,2006 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by

Modified: trunk/Tokenize/XmlTokenizer.cpp
===================================================================
--- trunk/Tokenize/XmlTokenizer.cpp	2006-10-24 05:48:19 UTC (rev 534)
+++ trunk/Tokenize/XmlTokenizer.cpp	2006-10-24 10:12:18 UTC (rev 535)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2006,2006 Fabrice Colin
+ *  Copyright 2005,2006 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by

Modified: trunk/Tokenize/XmlTokenizer.h
===================================================================
--- trunk/Tokenize/XmlTokenizer.h	2006-10-24 05:48:19 UTC (rev 534)
+++ trunk/Tokenize/XmlTokenizer.h	2006-10-24 10:12:18 UTC (rev 535)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2006,2006 Fabrice Colin
+ *  Copyright 2005,2006 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by

Modified: trunk/Tokenize/tokenizertest.cpp
===================================================================
--- trunk/Tokenize/tokenizertest.cpp	2006-10-24 05:48:19 UTC (rev 534)
+++ trunk/Tokenize/tokenizertest.cpp	2006-10-24 10:12:18 UTC (rev 535)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2006,2006 Fabrice Colin
+ *  Copyright 2005,2006 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by

Modified: trunk/Utils/Url.h
===================================================================
--- trunk/Utils/Url.h	2006-10-24 05:48:19 UTC (rev 534)
+++ trunk/Utils/Url.h	2006-10-24 10:12:18 UTC (rev 535)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2006,2006 Fabrice Colin
+ *  Copyright 2005,2006 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by



From fabricecolin at mail.berlios.de  Tue Oct 24 12:26:19 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 24 Oct 2006 12:26:19 +0200
Subject: [Pinot-svn] r536 - in trunk: Collect Search
Message-ID: <200610241026.k9OAQJ0V032400@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-24 12:26:18 +0200 (Tue, 24 Oct 2006)
New Revision: 536

Modified:
   trunk/Collect/CurlDownloader.cpp
   trunk/Collect/CurlDownloader.h
   trunk/Collect/DownloaderFactory.cpp
   trunk/Collect/DownloaderFactory.h
   trunk/Collect/DownloaderInterface.cpp
   trunk/Collect/DownloaderInterface.h
   trunk/Collect/FileCollector.cpp
   trunk/Collect/FileCollector.h
   trunk/Collect/MboxCollector.cpp
   trunk/Collect/MboxCollector.h
   trunk/Collect/NeonDownloader.cpp
   trunk/Collect/NeonDownloader.h
   trunk/Collect/XapianCollector.cpp
   trunk/Collect/XapianCollector.h
   trunk/Collect/pinot-collect.cpp
   trunk/Search/AbstractGenerator.cpp
   trunk/Search/AbstractGenerator.h
   trunk/Search/OpenSearchParser.cpp
   trunk/Search/OpenSearchParser.h
   trunk/Search/PluginParsers.h
   trunk/Search/PluginWebEngine.cpp
   trunk/Search/PluginWebEngine.h
   trunk/Search/QueryProperties.cpp
   trunk/Search/QueryProperties.h
   trunk/Search/SearchEngineFactory.cpp
   trunk/Search/SearchEngineFactory.h
   trunk/Search/SearchEngineInterface.cpp
   trunk/Search/SearchEngineInterface.h
   trunk/Search/SearchPluginProperties.cpp
   trunk/Search/SearchPluginProperties.h
   trunk/Search/SherlockParser.cpp
   trunk/Search/SherlockParser.h
   trunk/Search/WebEngine.cpp
   trunk/Search/WebEngine.h
   trunk/Search/XapianEngine.cpp
   trunk/Search/XapianEngine.h
   trunk/Search/pinot-search.cpp
   trunk/Search/plugintest.cpp
Log:
Adeed missing copyright notice.


Modified: trunk/Collect/CurlDownloader.cpp
===================================================================
--- trunk/Collect/CurlDownloader.cpp	2006-10-24 10:12:18 UTC (rev 535)
+++ trunk/Collect/CurlDownloader.cpp	2006-10-24 10:26:18 UTC (rev 536)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Collect/CurlDownloader.h
===================================================================
--- trunk/Collect/CurlDownloader.h	2006-10-24 10:12:18 UTC (rev 535)
+++ trunk/Collect/CurlDownloader.h	2006-10-24 10:26:18 UTC (rev 536)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Collect/DownloaderFactory.cpp
===================================================================
--- trunk/Collect/DownloaderFactory.cpp	2006-10-24 10:12:18 UTC (rev 535)
+++ trunk/Collect/DownloaderFactory.cpp	2006-10-24 10:26:18 UTC (rev 536)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Collect/DownloaderFactory.h
===================================================================
--- trunk/Collect/DownloaderFactory.h	2006-10-24 10:12:18 UTC (rev 535)
+++ trunk/Collect/DownloaderFactory.h	2006-10-24 10:26:18 UTC (rev 536)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Collect/DownloaderInterface.cpp
===================================================================
--- trunk/Collect/DownloaderInterface.cpp	2006-10-24 10:12:18 UTC (rev 535)
+++ trunk/Collect/DownloaderInterface.cpp	2006-10-24 10:26:18 UTC (rev 536)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Collect/DownloaderInterface.h
===================================================================
--- trunk/Collect/DownloaderInterface.h	2006-10-24 10:12:18 UTC (rev 535)
+++ trunk/Collect/DownloaderInterface.h	2006-10-24 10:26:18 UTC (rev 536)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Collect/FileCollector.cpp
===================================================================
--- trunk/Collect/FileCollector.cpp	2006-10-24 10:12:18 UTC (rev 535)
+++ trunk/Collect/FileCollector.cpp	2006-10-24 10:26:18 UTC (rev 536)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Collect/FileCollector.h
===================================================================
--- trunk/Collect/FileCollector.h	2006-10-24 10:12:18 UTC (rev 535)
+++ trunk/Collect/FileCollector.h	2006-10-24 10:26:18 UTC (rev 536)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Collect/MboxCollector.cpp
===================================================================
--- trunk/Collect/MboxCollector.cpp	2006-10-24 10:12:18 UTC (rev 535)
+++ trunk/Collect/MboxCollector.cpp	2006-10-24 10:26:18 UTC (rev 536)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Collect/MboxCollector.h
===================================================================
--- trunk/Collect/MboxCollector.h	2006-10-24 10:12:18 UTC (rev 535)
+++ trunk/Collect/MboxCollector.h	2006-10-24 10:26:18 UTC (rev 536)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Collect/NeonDownloader.cpp
===================================================================
--- trunk/Collect/NeonDownloader.cpp	2006-10-24 10:12:18 UTC (rev 535)
+++ trunk/Collect/NeonDownloader.cpp	2006-10-24 10:26:18 UTC (rev 536)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Collect/NeonDownloader.h
===================================================================
--- trunk/Collect/NeonDownloader.h	2006-10-24 10:12:18 UTC (rev 535)
+++ trunk/Collect/NeonDownloader.h	2006-10-24 10:26:18 UTC (rev 536)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Collect/XapianCollector.cpp
===================================================================
--- trunk/Collect/XapianCollector.cpp	2006-10-24 10:12:18 UTC (rev 535)
+++ trunk/Collect/XapianCollector.cpp	2006-10-24 10:26:18 UTC (rev 536)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Collect/XapianCollector.h
===================================================================
--- trunk/Collect/XapianCollector.h	2006-10-24 10:12:18 UTC (rev 535)
+++ trunk/Collect/XapianCollector.h	2006-10-24 10:26:18 UTC (rev 536)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Collect/pinot-collect.cpp
===================================================================
--- trunk/Collect/pinot-collect.cpp	2006-10-24 10:12:18 UTC (rev 535)
+++ trunk/Collect/pinot-collect.cpp	2006-10-24 10:26:18 UTC (rev 536)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Search/AbstractGenerator.cpp
===================================================================
--- trunk/Search/AbstractGenerator.cpp	2006-10-24 10:12:18 UTC (rev 535)
+++ trunk/Search/AbstractGenerator.cpp	2006-10-24 10:26:18 UTC (rev 536)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Search/AbstractGenerator.h
===================================================================
--- trunk/Search/AbstractGenerator.h	2006-10-24 10:12:18 UTC (rev 535)
+++ trunk/Search/AbstractGenerator.h	2006-10-24 10:26:18 UTC (rev 536)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Search/OpenSearchParser.cpp
===================================================================
--- trunk/Search/OpenSearchParser.cpp	2006-10-24 10:12:18 UTC (rev 535)
+++ trunk/Search/OpenSearchParser.cpp	2006-10-24 10:26:18 UTC (rev 536)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Search/OpenSearchParser.h
===================================================================
--- trunk/Search/OpenSearchParser.h	2006-10-24 10:12:18 UTC (rev 535)
+++ trunk/Search/OpenSearchParser.h	2006-10-24 10:26:18 UTC (rev 536)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Search/PluginParsers.h
===================================================================
--- trunk/Search/PluginParsers.h	2006-10-24 10:12:18 UTC (rev 535)
+++ trunk/Search/PluginParsers.h	2006-10-24 10:26:18 UTC (rev 536)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Search/PluginWebEngine.cpp
===================================================================
--- trunk/Search/PluginWebEngine.cpp	2006-10-24 10:12:18 UTC (rev 535)
+++ trunk/Search/PluginWebEngine.cpp	2006-10-24 10:26:18 UTC (rev 536)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Search/PluginWebEngine.h
===================================================================
--- trunk/Search/PluginWebEngine.h	2006-10-24 10:12:18 UTC (rev 535)
+++ trunk/Search/PluginWebEngine.h	2006-10-24 10:26:18 UTC (rev 536)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Search/QueryProperties.cpp
===================================================================
--- trunk/Search/QueryProperties.cpp	2006-10-24 10:12:18 UTC (rev 535)
+++ trunk/Search/QueryProperties.cpp	2006-10-24 10:26:18 UTC (rev 536)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Search/QueryProperties.h
===================================================================
--- trunk/Search/QueryProperties.h	2006-10-24 10:12:18 UTC (rev 535)
+++ trunk/Search/QueryProperties.h	2006-10-24 10:26:18 UTC (rev 536)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Search/SearchEngineFactory.cpp
===================================================================
--- trunk/Search/SearchEngineFactory.cpp	2006-10-24 10:12:18 UTC (rev 535)
+++ trunk/Search/SearchEngineFactory.cpp	2006-10-24 10:26:18 UTC (rev 536)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Search/SearchEngineFactory.h
===================================================================
--- trunk/Search/SearchEngineFactory.h	2006-10-24 10:12:18 UTC (rev 535)
+++ trunk/Search/SearchEngineFactory.h	2006-10-24 10:26:18 UTC (rev 536)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Search/SearchEngineInterface.cpp
===================================================================
--- trunk/Search/SearchEngineInterface.cpp	2006-10-24 10:12:18 UTC (rev 535)
+++ trunk/Search/SearchEngineInterface.cpp	2006-10-24 10:26:18 UTC (rev 536)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Search/SearchEngineInterface.h
===================================================================
--- trunk/Search/SearchEngineInterface.h	2006-10-24 10:12:18 UTC (rev 535)
+++ trunk/Search/SearchEngineInterface.h	2006-10-24 10:26:18 UTC (rev 536)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Search/SearchPluginProperties.cpp
===================================================================
--- trunk/Search/SearchPluginProperties.cpp	2006-10-24 10:12:18 UTC (rev 535)
+++ trunk/Search/SearchPluginProperties.cpp	2006-10-24 10:26:18 UTC (rev 536)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Search/SearchPluginProperties.h
===================================================================
--- trunk/Search/SearchPluginProperties.h	2006-10-24 10:12:18 UTC (rev 535)
+++ trunk/Search/SearchPluginProperties.h	2006-10-24 10:26:18 UTC (rev 536)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Search/SherlockParser.cpp
===================================================================
--- trunk/Search/SherlockParser.cpp	2006-10-24 10:12:18 UTC (rev 535)
+++ trunk/Search/SherlockParser.cpp	2006-10-24 10:26:18 UTC (rev 536)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Search/SherlockParser.h
===================================================================
--- trunk/Search/SherlockParser.h	2006-10-24 10:12:18 UTC (rev 535)
+++ trunk/Search/SherlockParser.h	2006-10-24 10:26:18 UTC (rev 536)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Search/WebEngine.cpp
===================================================================
--- trunk/Search/WebEngine.cpp	2006-10-24 10:12:18 UTC (rev 535)
+++ trunk/Search/WebEngine.cpp	2006-10-24 10:26:18 UTC (rev 536)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Search/WebEngine.h
===================================================================
--- trunk/Search/WebEngine.h	2006-10-24 10:12:18 UTC (rev 535)
+++ trunk/Search/WebEngine.h	2006-10-24 10:26:18 UTC (rev 536)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Search/XapianEngine.cpp
===================================================================
--- trunk/Search/XapianEngine.cpp	2006-10-24 10:12:18 UTC (rev 535)
+++ trunk/Search/XapianEngine.cpp	2006-10-24 10:26:18 UTC (rev 536)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Search/XapianEngine.h
===================================================================
--- trunk/Search/XapianEngine.h	2006-10-24 10:12:18 UTC (rev 535)
+++ trunk/Search/XapianEngine.h	2006-10-24 10:26:18 UTC (rev 536)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Search/pinot-search.cpp
===================================================================
--- trunk/Search/pinot-search.cpp	2006-10-24 10:12:18 UTC (rev 535)
+++ trunk/Search/pinot-search.cpp	2006-10-24 10:26:18 UTC (rev 536)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Search/plugintest.cpp
===================================================================
--- trunk/Search/plugintest.cpp	2006-10-24 10:12:18 UTC (rev 535)
+++ trunk/Search/plugintest.cpp	2006-10-24 10:26:18 UTC (rev 536)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or



From fabricecolin at mail.berlios.de  Tue Oct 24 12:46:18 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 24 Oct 2006 12:46:18 +0200
Subject: [Pinot-svn] r537 - in trunk: Index Monitor Search/Google
Message-ID: <200610241046.k9OAkIUR003394@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-24 12:46:15 +0200 (Tue, 24 Oct 2006)
New Revision: 537

Modified:
   trunk/Index/DBusXapianIndex.cpp
   trunk/Index/DBusXapianIndex.h
   trunk/Index/IndexFactory.cpp
   trunk/Index/IndexFactory.h
   trunk/Index/IndexInterface.h
   trunk/Index/LanguageDetector.cpp
   trunk/Index/LanguageDetector.h
   trunk/Index/XapianDatabase.cpp
   trunk/Index/XapianDatabase.h
   trunk/Index/XapianDatabaseFactory.cpp
   trunk/Index/XapianDatabaseFactory.h
   trunk/Index/XapianIndex.cpp
   trunk/Index/XapianIndex.h
   trunk/Index/pinot-index.cpp
   trunk/Monitor/INotifyMonitor.cpp
   trunk/Monitor/INotifyMonitor.h
   trunk/Monitor/MonitorEvent.cpp
   trunk/Monitor/MonitorEvent.h
   trunk/Monitor/MonitorFactory.cpp
   trunk/Monitor/MonitorFactory.h
   trunk/Monitor/MonitorHandler.cpp
   trunk/Monitor/MonitorHandler.h
   trunk/Monitor/MonitorInterface.h
   trunk/Search/Google/GoogleAPIEngine.cpp
   trunk/Search/Google/GoogleAPIEngine.h
Log:
Added missing copyright notice.


Modified: trunk/Index/DBusXapianIndex.cpp
===================================================================
--- trunk/Index/DBusXapianIndex.cpp	2006-10-24 10:26:18 UTC (rev 536)
+++ trunk/Index/DBusXapianIndex.cpp	2006-10-24 10:46:15 UTC (rev 537)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Index/DBusXapianIndex.h
===================================================================
--- trunk/Index/DBusXapianIndex.h	2006-10-24 10:26:18 UTC (rev 536)
+++ trunk/Index/DBusXapianIndex.h	2006-10-24 10:46:15 UTC (rev 537)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Index/IndexFactory.cpp
===================================================================
--- trunk/Index/IndexFactory.cpp	2006-10-24 10:26:18 UTC (rev 536)
+++ trunk/Index/IndexFactory.cpp	2006-10-24 10:46:15 UTC (rev 537)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Index/IndexFactory.h
===================================================================
--- trunk/Index/IndexFactory.h	2006-10-24 10:26:18 UTC (rev 536)
+++ trunk/Index/IndexFactory.h	2006-10-24 10:46:15 UTC (rev 537)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Index/IndexInterface.h
===================================================================
--- trunk/Index/IndexInterface.h	2006-10-24 10:26:18 UTC (rev 536)
+++ trunk/Index/IndexInterface.h	2006-10-24 10:46:15 UTC (rev 537)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Index/LanguageDetector.cpp
===================================================================
--- trunk/Index/LanguageDetector.cpp	2006-10-24 10:26:18 UTC (rev 536)
+++ trunk/Index/LanguageDetector.cpp	2006-10-24 10:46:15 UTC (rev 537)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Index/LanguageDetector.h
===================================================================
--- trunk/Index/LanguageDetector.h	2006-10-24 10:26:18 UTC (rev 536)
+++ trunk/Index/LanguageDetector.h	2006-10-24 10:46:15 UTC (rev 537)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Index/XapianDatabase.cpp
===================================================================
--- trunk/Index/XapianDatabase.cpp	2006-10-24 10:26:18 UTC (rev 536)
+++ trunk/Index/XapianDatabase.cpp	2006-10-24 10:46:15 UTC (rev 537)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Index/XapianDatabase.h
===================================================================
--- trunk/Index/XapianDatabase.h	2006-10-24 10:26:18 UTC (rev 536)
+++ trunk/Index/XapianDatabase.h	2006-10-24 10:46:15 UTC (rev 537)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Index/XapianDatabaseFactory.cpp
===================================================================
--- trunk/Index/XapianDatabaseFactory.cpp	2006-10-24 10:26:18 UTC (rev 536)
+++ trunk/Index/XapianDatabaseFactory.cpp	2006-10-24 10:46:15 UTC (rev 537)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Index/XapianDatabaseFactory.h
===================================================================
--- trunk/Index/XapianDatabaseFactory.h	2006-10-24 10:26:18 UTC (rev 536)
+++ trunk/Index/XapianDatabaseFactory.h	2006-10-24 10:46:15 UTC (rev 537)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Index/XapianIndex.cpp
===================================================================
--- trunk/Index/XapianIndex.cpp	2006-10-24 10:26:18 UTC (rev 536)
+++ trunk/Index/XapianIndex.cpp	2006-10-24 10:46:15 UTC (rev 537)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Index/XapianIndex.h
===================================================================
--- trunk/Index/XapianIndex.h	2006-10-24 10:26:18 UTC (rev 536)
+++ trunk/Index/XapianIndex.h	2006-10-24 10:46:15 UTC (rev 537)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Index/pinot-index.cpp
===================================================================
--- trunk/Index/pinot-index.cpp	2006-10-24 10:26:18 UTC (rev 536)
+++ trunk/Index/pinot-index.cpp	2006-10-24 10:46:15 UTC (rev 537)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Monitor/INotifyMonitor.cpp
===================================================================
--- trunk/Monitor/INotifyMonitor.cpp	2006-10-24 10:26:18 UTC (rev 536)
+++ trunk/Monitor/INotifyMonitor.cpp	2006-10-24 10:46:15 UTC (rev 537)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Monitor/INotifyMonitor.h
===================================================================
--- trunk/Monitor/INotifyMonitor.h	2006-10-24 10:26:18 UTC (rev 536)
+++ trunk/Monitor/INotifyMonitor.h	2006-10-24 10:46:15 UTC (rev 537)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Monitor/MonitorEvent.cpp
===================================================================
--- trunk/Monitor/MonitorEvent.cpp	2006-10-24 10:26:18 UTC (rev 536)
+++ trunk/Monitor/MonitorEvent.cpp	2006-10-24 10:46:15 UTC (rev 537)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Monitor/MonitorEvent.h
===================================================================
--- trunk/Monitor/MonitorEvent.h	2006-10-24 10:26:18 UTC (rev 536)
+++ trunk/Monitor/MonitorEvent.h	2006-10-24 10:46:15 UTC (rev 537)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Monitor/MonitorFactory.cpp
===================================================================
--- trunk/Monitor/MonitorFactory.cpp	2006-10-24 10:26:18 UTC (rev 536)
+++ trunk/Monitor/MonitorFactory.cpp	2006-10-24 10:46:15 UTC (rev 537)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Monitor/MonitorFactory.h
===================================================================
--- trunk/Monitor/MonitorFactory.h	2006-10-24 10:26:18 UTC (rev 536)
+++ trunk/Monitor/MonitorFactory.h	2006-10-24 10:46:15 UTC (rev 537)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Monitor/MonitorHandler.cpp
===================================================================
--- trunk/Monitor/MonitorHandler.cpp	2006-10-24 10:26:18 UTC (rev 536)
+++ trunk/Monitor/MonitorHandler.cpp	2006-10-24 10:46:15 UTC (rev 537)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Monitor/MonitorHandler.h
===================================================================
--- trunk/Monitor/MonitorHandler.h	2006-10-24 10:26:18 UTC (rev 536)
+++ trunk/Monitor/MonitorHandler.h	2006-10-24 10:46:15 UTC (rev 537)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Monitor/MonitorInterface.h
===================================================================
--- trunk/Monitor/MonitorInterface.h	2006-10-24 10:26:18 UTC (rev 536)
+++ trunk/Monitor/MonitorInterface.h	2006-10-24 10:46:15 UTC (rev 537)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Search/Google/GoogleAPIEngine.cpp
===================================================================
--- trunk/Search/Google/GoogleAPIEngine.cpp	2006-10-24 10:26:18 UTC (rev 536)
+++ trunk/Search/Google/GoogleAPIEngine.cpp	2006-10-24 10:46:15 UTC (rev 537)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/Search/Google/GoogleAPIEngine.h
===================================================================
--- trunk/Search/Google/GoogleAPIEngine.h	2006-10-24 10:26:18 UTC (rev 536)
+++ trunk/Search/Google/GoogleAPIEngine.h	2006-10-24 10:46:15 UTC (rev 537)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or



From fabricecolin at mail.berlios.de  Tue Oct 24 14:41:20 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 24 Oct 2006 14:41:20 +0200
Subject: [Pinot-svn] r538 - trunk/UI/GTK2/src
Message-ID: <200610241241.k9OCfKjO023999@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-24 14:41:18 +0200 (Tue, 24 Oct 2006)
New Revision: 538

Modified:
   trunk/UI/GTK2/src/DaemonState.cpp
   trunk/UI/GTK2/src/DaemonState.h
   trunk/UI/GTK2/src/EnginesTree.cpp
   trunk/UI/GTK2/src/EnginesTree.h
   trunk/UI/GTK2/src/IndexPage.cpp
   trunk/UI/GTK2/src/IndexPage.h
   trunk/UI/GTK2/src/IndexTree.cpp
   trunk/UI/GTK2/src/IndexTree.h
   trunk/UI/GTK2/src/MboxHandler.cpp
   trunk/UI/GTK2/src/MboxHandler.h
   trunk/UI/GTK2/src/ModelColumns.cpp
   trunk/UI/GTK2/src/ModelColumns.h
   trunk/UI/GTK2/src/Notebook.cpp
   trunk/UI/GTK2/src/Notebook.h
   trunk/UI/GTK2/src/OnDiskHandler.cpp
   trunk/UI/GTK2/src/OnDiskHandler.h
   trunk/UI/GTK2/src/PinotSettings.cpp
   trunk/UI/GTK2/src/PinotSettings.h
   trunk/UI/GTK2/src/PinotUtils.cpp
   trunk/UI/GTK2/src/PinotUtils.h
   trunk/UI/GTK2/src/ResultsTree.cpp
   trunk/UI/GTK2/src/ResultsTree.h
   trunk/UI/GTK2/src/WorkerThreads.cpp
   trunk/UI/GTK2/src/WorkerThreads.h
   trunk/UI/GTK2/src/importDialog.cc
   trunk/UI/GTK2/src/importDialog.hh
   trunk/UI/GTK2/src/indexDialog.cc
   trunk/UI/GTK2/src/indexDialog.hh
   trunk/UI/GTK2/src/mainWindow.cc
   trunk/UI/GTK2/src/mainWindow.hh
   trunk/UI/GTK2/src/pinot-dbus-daemon.cc
   trunk/UI/GTK2/src/pinot.cc
   trunk/UI/GTK2/src/prefsDialog.cc
   trunk/UI/GTK2/src/prefsDialog.hh
   trunk/UI/GTK2/src/propertiesDialog.cc
   trunk/UI/GTK2/src/propertiesDialog.hh
   trunk/UI/GTK2/src/queryDialog.cc
   trunk/UI/GTK2/src/queryDialog.hh
Log:
Added missing copyright notice.


Modified: trunk/UI/GTK2/src/DaemonState.cpp
===================================================================
--- trunk/UI/GTK2/src/DaemonState.cpp	2006-10-24 10:46:15 UTC (rev 537)
+++ trunk/UI/GTK2/src/DaemonState.cpp	2006-10-24 12:41:18 UTC (rev 538)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/UI/GTK2/src/DaemonState.h
===================================================================
--- trunk/UI/GTK2/src/DaemonState.h	2006-10-24 10:46:15 UTC (rev 537)
+++ trunk/UI/GTK2/src/DaemonState.h	2006-10-24 12:41:18 UTC (rev 538)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/UI/GTK2/src/EnginesTree.cpp
===================================================================
--- trunk/UI/GTK2/src/EnginesTree.cpp	2006-10-24 10:46:15 UTC (rev 537)
+++ trunk/UI/GTK2/src/EnginesTree.cpp	2006-10-24 12:41:18 UTC (rev 538)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/UI/GTK2/src/EnginesTree.h
===================================================================
--- trunk/UI/GTK2/src/EnginesTree.h	2006-10-24 10:46:15 UTC (rev 537)
+++ trunk/UI/GTK2/src/EnginesTree.h	2006-10-24 12:41:18 UTC (rev 538)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/UI/GTK2/src/IndexPage.cpp
===================================================================
--- trunk/UI/GTK2/src/IndexPage.cpp	2006-10-24 10:46:15 UTC (rev 537)
+++ trunk/UI/GTK2/src/IndexPage.cpp	2006-10-24 12:41:18 UTC (rev 538)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/UI/GTK2/src/IndexPage.h
===================================================================
--- trunk/UI/GTK2/src/IndexPage.h	2006-10-24 10:46:15 UTC (rev 537)
+++ trunk/UI/GTK2/src/IndexPage.h	2006-10-24 12:41:18 UTC (rev 538)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/UI/GTK2/src/IndexTree.cpp
===================================================================
--- trunk/UI/GTK2/src/IndexTree.cpp	2006-10-24 10:46:15 UTC (rev 537)
+++ trunk/UI/GTK2/src/IndexTree.cpp	2006-10-24 12:41:18 UTC (rev 538)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/UI/GTK2/src/IndexTree.h
===================================================================
--- trunk/UI/GTK2/src/IndexTree.h	2006-10-24 10:46:15 UTC (rev 537)
+++ trunk/UI/GTK2/src/IndexTree.h	2006-10-24 12:41:18 UTC (rev 538)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/UI/GTK2/src/MboxHandler.cpp
===================================================================
--- trunk/UI/GTK2/src/MboxHandler.cpp	2006-10-24 10:46:15 UTC (rev 537)
+++ trunk/UI/GTK2/src/MboxHandler.cpp	2006-10-24 12:41:18 UTC (rev 538)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/UI/GTK2/src/MboxHandler.h
===================================================================
--- trunk/UI/GTK2/src/MboxHandler.h	2006-10-24 10:46:15 UTC (rev 537)
+++ trunk/UI/GTK2/src/MboxHandler.h	2006-10-24 12:41:18 UTC (rev 538)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/UI/GTK2/src/ModelColumns.cpp
===================================================================
--- trunk/UI/GTK2/src/ModelColumns.cpp	2006-10-24 10:46:15 UTC (rev 537)
+++ trunk/UI/GTK2/src/ModelColumns.cpp	2006-10-24 12:41:18 UTC (rev 538)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/UI/GTK2/src/ModelColumns.h
===================================================================
--- trunk/UI/GTK2/src/ModelColumns.h	2006-10-24 10:46:15 UTC (rev 537)
+++ trunk/UI/GTK2/src/ModelColumns.h	2006-10-24 12:41:18 UTC (rev 538)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/UI/GTK2/src/Notebook.cpp
===================================================================
--- trunk/UI/GTK2/src/Notebook.cpp	2006-10-24 10:46:15 UTC (rev 537)
+++ trunk/UI/GTK2/src/Notebook.cpp	2006-10-24 12:41:18 UTC (rev 538)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/UI/GTK2/src/Notebook.h
===================================================================
--- trunk/UI/GTK2/src/Notebook.h	2006-10-24 10:46:15 UTC (rev 537)
+++ trunk/UI/GTK2/src/Notebook.h	2006-10-24 12:41:18 UTC (rev 538)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/UI/GTK2/src/OnDiskHandler.cpp
===================================================================
--- trunk/UI/GTK2/src/OnDiskHandler.cpp	2006-10-24 10:46:15 UTC (rev 537)
+++ trunk/UI/GTK2/src/OnDiskHandler.cpp	2006-10-24 12:41:18 UTC (rev 538)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/UI/GTK2/src/OnDiskHandler.h
===================================================================
--- trunk/UI/GTK2/src/OnDiskHandler.h	2006-10-24 10:46:15 UTC (rev 537)
+++ trunk/UI/GTK2/src/OnDiskHandler.h	2006-10-24 12:41:18 UTC (rev 538)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/UI/GTK2/src/PinotSettings.cpp
===================================================================
--- trunk/UI/GTK2/src/PinotSettings.cpp	2006-10-24 10:46:15 UTC (rev 537)
+++ trunk/UI/GTK2/src/PinotSettings.cpp	2006-10-24 12:41:18 UTC (rev 538)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/UI/GTK2/src/PinotSettings.h
===================================================================
--- trunk/UI/GTK2/src/PinotSettings.h	2006-10-24 10:46:15 UTC (rev 537)
+++ trunk/UI/GTK2/src/PinotSettings.h	2006-10-24 12:41:18 UTC (rev 538)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/UI/GTK2/src/PinotUtils.cpp
===================================================================
--- trunk/UI/GTK2/src/PinotUtils.cpp	2006-10-24 10:46:15 UTC (rev 537)
+++ trunk/UI/GTK2/src/PinotUtils.cpp	2006-10-24 12:41:18 UTC (rev 538)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/UI/GTK2/src/PinotUtils.h
===================================================================
--- trunk/UI/GTK2/src/PinotUtils.h	2006-10-24 10:46:15 UTC (rev 537)
+++ trunk/UI/GTK2/src/PinotUtils.h	2006-10-24 12:41:18 UTC (rev 538)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/UI/GTK2/src/ResultsTree.cpp
===================================================================
--- trunk/UI/GTK2/src/ResultsTree.cpp	2006-10-24 10:46:15 UTC (rev 537)
+++ trunk/UI/GTK2/src/ResultsTree.cpp	2006-10-24 12:41:18 UTC (rev 538)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/UI/GTK2/src/ResultsTree.h
===================================================================
--- trunk/UI/GTK2/src/ResultsTree.h	2006-10-24 10:46:15 UTC (rev 537)
+++ trunk/UI/GTK2/src/ResultsTree.h	2006-10-24 12:41:18 UTC (rev 538)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/UI/GTK2/src/WorkerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.cpp	2006-10-24 10:46:15 UTC (rev 537)
+++ trunk/UI/GTK2/src/WorkerThreads.cpp	2006-10-24 12:41:18 UTC (rev 538)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/UI/GTK2/src/WorkerThreads.h
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.h	2006-10-24 10:46:15 UTC (rev 537)
+++ trunk/UI/GTK2/src/WorkerThreads.h	2006-10-24 12:41:18 UTC (rev 538)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/UI/GTK2/src/importDialog.cc
===================================================================
--- trunk/UI/GTK2/src/importDialog.cc	2006-10-24 10:46:15 UTC (rev 537)
+++ trunk/UI/GTK2/src/importDialog.cc	2006-10-24 12:41:18 UTC (rev 538)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/UI/GTK2/src/importDialog.hh
===================================================================
--- trunk/UI/GTK2/src/importDialog.hh	2006-10-24 10:46:15 UTC (rev 537)
+++ trunk/UI/GTK2/src/importDialog.hh	2006-10-24 12:41:18 UTC (rev 538)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/UI/GTK2/src/indexDialog.cc
===================================================================
--- trunk/UI/GTK2/src/indexDialog.cc	2006-10-24 10:46:15 UTC (rev 537)
+++ trunk/UI/GTK2/src/indexDialog.cc	2006-10-24 12:41:18 UTC (rev 538)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/UI/GTK2/src/indexDialog.hh
===================================================================
--- trunk/UI/GTK2/src/indexDialog.hh	2006-10-24 10:46:15 UTC (rev 537)
+++ trunk/UI/GTK2/src/indexDialog.hh	2006-10-24 12:41:18 UTC (rev 538)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2006-10-24 10:46:15 UTC (rev 537)
+++ trunk/UI/GTK2/src/mainWindow.cc	2006-10-24 12:41:18 UTC (rev 538)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/UI/GTK2/src/mainWindow.hh
===================================================================
--- trunk/UI/GTK2/src/mainWindow.hh	2006-10-24 10:46:15 UTC (rev 537)
+++ trunk/UI/GTK2/src/mainWindow.hh	2006-10-24 12:41:18 UTC (rev 538)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/UI/GTK2/src/pinot-dbus-daemon.cc
===================================================================
--- trunk/UI/GTK2/src/pinot-dbus-daemon.cc	2006-10-24 10:46:15 UTC (rev 537)
+++ trunk/UI/GTK2/src/pinot-dbus-daemon.cc	2006-10-24 12:41:18 UTC (rev 538)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/UI/GTK2/src/pinot.cc
===================================================================
--- trunk/UI/GTK2/src/pinot.cc	2006-10-24 10:46:15 UTC (rev 537)
+++ trunk/UI/GTK2/src/pinot.cc	2006-10-24 12:41:18 UTC (rev 538)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/UI/GTK2/src/prefsDialog.cc
===================================================================
--- trunk/UI/GTK2/src/prefsDialog.cc	2006-10-24 10:46:15 UTC (rev 537)
+++ trunk/UI/GTK2/src/prefsDialog.cc	2006-10-24 12:41:18 UTC (rev 538)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/UI/GTK2/src/prefsDialog.hh
===================================================================
--- trunk/UI/GTK2/src/prefsDialog.hh	2006-10-24 10:46:15 UTC (rev 537)
+++ trunk/UI/GTK2/src/prefsDialog.hh	2006-10-24 12:41:18 UTC (rev 538)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/UI/GTK2/src/propertiesDialog.cc
===================================================================
--- trunk/UI/GTK2/src/propertiesDialog.cc	2006-10-24 10:46:15 UTC (rev 537)
+++ trunk/UI/GTK2/src/propertiesDialog.cc	2006-10-24 12:41:18 UTC (rev 538)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/UI/GTK2/src/propertiesDialog.hh
===================================================================
--- trunk/UI/GTK2/src/propertiesDialog.hh	2006-10-24 10:46:15 UTC (rev 537)
+++ trunk/UI/GTK2/src/propertiesDialog.hh	2006-10-24 12:41:18 UTC (rev 538)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/UI/GTK2/src/queryDialog.cc
===================================================================
--- trunk/UI/GTK2/src/queryDialog.cc	2006-10-24 10:46:15 UTC (rev 537)
+++ trunk/UI/GTK2/src/queryDialog.cc	2006-10-24 12:41:18 UTC (rev 538)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or

Modified: trunk/UI/GTK2/src/queryDialog.hh
===================================================================
--- trunk/UI/GTK2/src/queryDialog.hh	2006-10-24 10:46:15 UTC (rev 537)
+++ trunk/UI/GTK2/src/queryDialog.hh	2006-10-24 12:41:18 UTC (rev 538)
@@ -1,4 +1,6 @@
 /*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
  *  the Free Software Foundation; either version 2 of the License, or



From fabricecolin at mail.berlios.de  Fri Oct 27 17:39:17 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Fri, 27 Oct 2006 17:39:17 +0200
Subject: [Pinot-svn] r539 - trunk
Message-ID: <200610271539.k9RFdHxJ024853@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-27 17:39:17 +0200 (Fri, 27 Oct 2006)
New Revision: 539

Added:
   trunk/textcat3_conf.txt
Log:
A configuration file for language models included in the upcoming libtextcat 3.0.


Added: trunk/textcat3_conf.txt
===================================================================
--- trunk/textcat3_conf.txt	2006-10-24 12:41:18 UTC (rev 538)
+++ trunk/textcat3_conf.txt	2006-10-27 15:39:17 UTC (rev 539)
@@ -0,0 +1,66 @@
+#
+# libtextcat 3.0 config file
+# The following languages are supported by Xapian::Stem
+# Languages names MUST be in English
+#
+/usr/share/libtextcat/LM/danish-cp1252.lm		danish-cp1252
+/usr/share/libtextcat/LM/danish-ibm850.lm		danish-ibm850
+/usr/share/libtextcat/LM/danish-iso8859_15.lm		danish-iso8859_15
+/usr/share/libtextcat/LM/danish-utf16.lm		danish-utf16
+/usr/share/libtextcat/LM/danish-utf8.lm			danish-utf8
+/usr/share/libtextcat/LM/dutch_cp1252.lm		dutch-cp1252
+/usr/share/libtextcat/LM/dutch_ibm850.lm		dutch-ibm850
+/usr/share/libtextcat/LM/dutch_iso8859_15.lm		dutch-iso8859_15
+/usr/share/libtextcat/LM/dutch_utf16.lm			dutch-utf16
+/usr/share/libtextcat/LM/dutch_utf8.lm			dutch-utf8
+/usr/share/libtextcat/LM/english-cp1252.lm		english-cp1252
+/usr/share/libtextcat/LM/english-ibm850.lm		english-ibm850
+/usr/share/libtextcat/LM/english-iso8859_15.lm		english-iso8859_15
+/usr/share/libtextcat/LM/english-utf16.lm		english-utf16
+/usr/share/libtextcat/LM/english-utf8.lm		english-utf8
+/usr/share/libtextcat/LM/finnish-cp1252.lm		finnish-cp1252
+/usr/share/libtextcat/LM/finnish-ibm850.lm		finnish-ibm850
+/usr/share/libtextcat/LM/finnish-iso8859_1.lm		finnish-iso8859_1
+/usr/share/libtextcat/LM/finnish-utf16.lm		finnish-utf16
+/usr/share/libtextcat/LM/finnish-utf8.lm		finnish-utf8
+/usr/share/libtextcat/LM/french-cp1252.lm		french-cp1252
+/usr/share/libtextcat/LM/french-ibm850.lm		french-ibm850
+/usr/share/libtextcat/LM/french-iso8859_15.lm		french-iso8859_15
+/usr/share/libtextcat/LM/french-utf16.lm		french-utf16
+/usr/share/libtextcat/LM/french-utf8.lm			french-utf8
+/usr/share/libtextcat/LM/german-cp1252.lm		german-cp1252
+/usr/share/libtextcat/LM/german-ibm850.lm		german-ibm850
+/usr/share/libtextcat/LM/german-iso8859_15.lm		german-iso8859_15
+/usr/share/libtextcat/LM/german-utf16.lm		german-utf16
+/usr/share/libtextcat/LM/german-utf8.lm			german-utf8
+/usr/share/libtextcat/LM/italian-cp1252.lm		italian-cp1252
+/usr/share/libtextcat/LM/italian-ibm850.lm		italian-ibm850
+/usr/share/libtextcat/LM/italian-iso8859_15.lm		italian-iso8859_15
+/usr/share/libtextcat/LM/italian-utf16.lm		italian-utf16
+/usr/share/libtextcat/LM/italian-utf8.lm		italian-utf8
+/usr/share/libtextcat/LM/norwegian-cp1252.lm		norwegian-cp1252
+/usr/share/libtextcat/LM/norwegian-ibm850.lm		norwegian-ibm850
+/usr/share/libtextcat/LM/norwegian-iso8859_1.lm		norwegian-iso8859_1
+/usr/share/libtextcat/LM/norwegian-utf16.lm		norwegian-utf16
+/usr/share/libtextcat/LM/norwegian-utf8.lm		norwegian-utf8
+/usr/share/libtextcat/LM/portuguese-cp1252.lm		portuguese-cp1252
+/usr/share/libtextcat/LM/portuguese-ibm850.lm		portuguese-ibm850
+/usr/share/libtextcat/LM/portuguese-iso8859_1.lm	portuguese-iso8859_1
+/usr/share/libtextcat/LM/portuguese-utf16.lm		portuguese-utf16
+/usr/share/libtextcat/LM/portuguese-utf8.lm		portuguese-utf8
+/usr/share/libtextcat/LM/russian-cp1251.lm		russian-cp1251
+/usr/share/libtextcat/LM/russian-ibm866.lm		russian-ibm866
+/usr/share/libtextcat/LM/russian-iso8859_5.lm		russian-iso8859_5
+/usr/share/libtextcat/LM/russian-koi8_r.lm		russian-koi8_r
+/usr/share/libtextcat/LM/russian-utf16.lm		russian-utf16
+/usr/share/libtextcat/LM/russian-utf8.lm		russian-utf8
+/usr/share/libtextcat/LM/spanish-cp1252.lm		spanish-cp1252
+/usr/share/libtextcat/LM/spanish-ibm850.lm		spanish-ibm850
+/usr/share/libtextcat/LM/spanish-iso8859_15.lm		spanish-iso8859_15
+/usr/share/libtextcat/LM/spanish-utf16.lm		spanish-utf16
+/usr/share/libtextcat/LM/spanish-utf8.lm		spanish-utf8
+/usr/share/libtextcat/LM/swedish-cp1252.lm		swedish-cp1252
+/usr/share/libtextcat/LM/swedish-ibm850.lm		swedish-ibm850
+/usr/share/libtextcat/LM/swedish-iso8859_1.lm		swedish-iso8859_1
+/usr/share/libtextcat/LM/swedish-utf16.lm		swedish-utf16
+/usr/share/libtextcat/LM/swedish-utf8.lm		swedish-utf8



From fabricecolin at mail.berlios.de  Sun Oct 29 09:26:24 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sun, 29 Oct 2006 09:26:24 +0100
Subject: [Pinot-svn] r540 - in trunk: . Utils
Message-ID: <200610290826.k9T8QOwX003606@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-29 09:26:23 +0100 (Sun, 29 Oct 2006)
New Revision: 540

Modified:
   trunk/Utils/MIMEScanner.cpp
   trunk/configure.in
Log:
Get the shared-mime-info prefix and use that instead of PREFIX to determine
where MIME files are to be found.


Modified: trunk/Utils/MIMEScanner.cpp
===================================================================
--- trunk/Utils/MIMEScanner.cpp	2006-10-27 15:39:17 UTC (rev 539)
+++ trunk/Utils/MIMEScanner.cpp	2006-10-29 08:26:23 UTC (rev 540)
@@ -175,7 +175,7 @@
 		return;
 	}
 
-	string desktopFilesDirectory(PREFIX);
+	string desktopFilesDirectory(SHARED_MIME_INFO_PREFIX);
 	desktopFilesDirectory += "/share/applications/";
 
 	string defaultsFile(desktopFilesDirectory);

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2006-10-27 15:39:17 UTC (rev 539)
+++ trunk/configure.in	2006-10-29 08:26:23 UTC (rev 540)
@@ -158,6 +158,10 @@
 AC_SUBST(MISC_LIBS)
 AC_CHECK_HEADERS([textcat.h netinet/in.h arpa/inet.h])
 PKG_CHECK_MODULES(MIMEINFO, shared-mime-info )
+SHARED_MIME_INFO_PREFIX=`pkg-config --variable=prefix shared-mime-info`
+AC_SUBST(SHARED_MIME_INFO_PREFIX)
+AC_DEFINE_UNQUOTED(SHARED_MIME_INFO_PREFIX,"$SHARED_MIME_INFO_PREFIX",
+    [the shared-mime-info prefix])
 PKG_CHECK_MODULES(TAGLIB, taglib >= 1.4 )
 AC_SUBST(TAGLIB_CFLAGS)
 AC_SUBST(TAGLIB_LIBS)



From fabricecolin at mail.berlios.de  Sun Oct 29 10:05:52 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sun, 29 Oct 2006 10:05:52 +0100
Subject: [Pinot-svn] r541 - in trunk: . Index
Message-ID: <200610290905.k9T95qv7006966@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-29 10:05:51 +0100 (Sun, 29 Oct 2006)
New Revision: 541

Modified:
   trunk/Index/LanguageDetector.cpp
   trunk/Index/Makefile.am
   trunk/Makefile.am
   trunk/configure.in
Log:
If libtextcat has textcat_Cat(), set HAVE_TEXTCAT_CAT to use this function
instead of textcat_Classify(). Install textcat3_conf.txt, so that if
textcat_Version() returns version 3 we can initialize the library with it.


Modified: trunk/Index/LanguageDetector.cpp
===================================================================
--- trunk/Index/LanguageDetector.cpp	2006-10-29 08:26:23 UTC (rev 540)
+++ trunk/Index/LanguageDetector.cpp	2006-10-29 09:05:51 UTC (rev 541)
@@ -16,6 +16,7 @@
  *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
  */
 
+#include <strings.h>
 #include <sys/time.h>
 #include <iostream>
 #include <utility>
@@ -61,7 +62,22 @@
 
 	candidates.clear();
 
-	confFile += "/share/pinot/textcat_conf.txt";
+	// What configuration file should we use ?
+	confFile += "/share/pinot/";
+	if (strncasecmp(textcat_Version(), "TextCat 3", 9) == 0)
+	{
+#ifdef DEBUG
+		cout << "LanguageDetector::guessLanguage: detected libtextcat 3" << endl;
+#endif
+		// Version 3
+		confFile += "textcat3_conf.txt";
+	}
+	else
+	{
+		confFile += "textcat_conf.txt";
+	}
+
+	// Initialize
 	void *td = textcat_Init(confFile.c_str());
 	if (td == NULL)
 	{
@@ -148,8 +164,8 @@
 	}
 #endif
 #ifdef DEBUG
-	cout << "LanguageDetector::guessLanguage: language guessing with "
-		<< textcat_Version() << " took " << timer.stop()/1000 << " ms" << endl;
+	cout << "LanguageDetector::guessLanguage: language guessing took "
+		<< timer.stop()/1000 << " ms" << endl;
 #endif
 
 	// Close the descriptor

Modified: trunk/Index/Makefile.am
===================================================================
--- trunk/Index/Makefile.am	2006-10-29 08:26:23 UTC (rev 540)
+++ trunk/Index/Makefile.am	2006-10-29 09:05:51 UTC (rev 541)
@@ -30,4 +30,7 @@
 
 AM_CXXFLAGS = -I$(srcdir)/../Utils -I$(srcdir)/../Tokenize -I$(srcdir)/../Collect \
 	@HTTP_CFLAGS@ @MIME_CFLAGS@ @XML_CFLAGS@ @DBUS_CFLAGS@ @INDEX_CFLAGS@
+if HAVE_TEXTCAT_CAT
+AM_CXXFLAGS += -DHAVE_TEXTCAT_CAT
+endif
 

Modified: trunk/Makefile.am
===================================================================
--- trunk/Makefile.am	2006-10-29 08:26:23 UTC (rev 540)
+++ trunk/Makefile.am	2006-10-29 09:05:51 UTC (rev 541)
@@ -1,11 +1,11 @@
 # generated 2005/12/14 20:48:47 SGT by fabrice at amra.dyndns.org.(none)
 # using glademm V2.6.0
 
-SUBDIRS = po Utils Tokenize SQL Collect @SOAP_SUBDIRS@ Index \
+SUBDIRS = po Utils Tokenize SQL Collect Index @SOAP_SUBDIRS@ \
 	Search Monitor UI/GTK2/src
 
 EXTRA_DIST = ChangeLog NEWS README TODO mkinstalldirs pinot.desktop \
-	pinot.spec textcat_conf.txt globalconfig.xml \
+	pinot.spec textcat_conf.txt textcat3_conf.txt globalconfig.xml \
 	Search/Plugins/*src Search/Plugins/*.xml \
 	Collect/pinot-collect.1 Index/pinot-index.1 Search/pinot-search.1 \
 	UI/GTK2/src/pinot.1 UI/GTK2/src/pinot-dbus-daemon.1 \
@@ -26,6 +26,7 @@
 	$(INSTALL_DATA) UI/GTK2/src/pinot-dbus-daemon.xml $(DESTDIR)$(datadir)/pinot/pinot-dbus-daemon.xml
 	$(INSTALL_DATA) UI/GTK2/src/de.berlios.Pinot.service $(DESTDIR)$(datadir)/dbus-1/services/de.berlios.Pinot.service
 	$(INSTALL_DATA) textcat_conf.txt $(DESTDIR)$(datadir)/pinot/textcat_conf.txt
+	$(INSTALL_DATA) textcat3_conf.txt $(DESTDIR)$(datadir)/pinot/textcat3_conf.txt
 	$(mkinstalldirs) $(DESTDIR)$(datadir)/pinot/engines
 	$(INSTALL_DATA) Search/Plugins/*.src $(DESTDIR)$(datadir)/pinot/engines/
 	@mv $(DESTDIR)$(datadir)/pinot/engines/AmazonAPI.src $(DESTDIR)$(datadir)/pinot/

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2006-10-29 08:26:23 UTC (rev 540)
+++ trunk/configure.in	2006-10-29 09:05:51 UTC (rev 541)
@@ -153,10 +153,17 @@
     [AM_CONDITIONAL(HAVE_BOOST_SPIRIT, true)
     ])
 
+dnl TextCat
+AC_CHECK_HEADERS([textcat.h])
+AC_CHECK_LIB(textcat, textcat_Cat,
+    [AM_CONDITIONAL(HAVE_TEXTCAT_CAT, true)],
+    [AM_CONDITIONAL(HAVE_TEXTCAT_CAT, false)]
+    )
+
 dnl Other libraries
 MISC_LIBS="-lcrypt"
 AC_SUBST(MISC_LIBS)
-AC_CHECK_HEADERS([textcat.h netinet/in.h arpa/inet.h])
+AC_CHECK_HEADERS([netinet/in.h arpa/inet.h])
 PKG_CHECK_MODULES(MIMEINFO, shared-mime-info )
 SHARED_MIME_INFO_PREFIX=`pkg-config --variable=prefix shared-mime-info`
 AC_SUBST(SHARED_MIME_INFO_PREFIX)



From fabricecolin at mail.berlios.de  Sun Oct 29 10:42:05 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sun, 29 Oct 2006 10:42:05 +0100
Subject: [Pinot-svn] r542 - trunk/UI/GTK2/src
Message-ID: <200610290942.k9T9g5Xo010947@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-29 10:42:04 +0100 (Sun, 29 Oct 2006)
New Revision: 542

Modified:
   trunk/UI/GTK2/src/pinot-dbus-daemon.cc
   trunk/UI/GTK2/src/pinot.cc
Log:
Fixed warnings.


Modified: trunk/UI/GTK2/src/pinot-dbus-daemon.cc
===================================================================
--- trunk/UI/GTK2/src/pinot-dbus-daemon.cc	2006-10-29 09:05:51 UTC (rev 541)
+++ trunk/UI/GTK2/src/pinot-dbus-daemon.cc	2006-10-29 09:42:04 UTC (rev 542)
@@ -264,7 +264,6 @@
 #endif
 			if (index.getDocumentLabels(docId, labels) == true)
 			{
-				dbus_uint32_t labelsCount = labels.size();
 				GPtrArray *pLabels = g_ptr_array_new();
 
 				for (set<string>::const_iterator labelIter = labels.begin();
@@ -309,7 +308,6 @@
 		CrawlHistory history(PinotSettings::getInstance().m_historyDatabase);
 		unsigned int crawledFilesCount = history.getItemsCount();
 		unsigned int docsCount = index.getDocumentsCount();
-		unsigned int docId = 0;
 
 #ifdef DEBUG
 		cout << "messageHandler: received GetStatistics" << endl;
@@ -434,7 +432,6 @@
 	{
 		char *pSearchText = NULL;
 		dbus_uint32_t maxHits = 0;
-		unsigned int docId = 0;
 
 		if (dbus_message_get_args(pMessage, &error,
 			DBUS_TYPE_STRING, &pSearchText,
@@ -667,17 +664,18 @@
 	settings.enableDBus(false);
 
 	string confDirectory = PinotSettings::getConfigurationDirectory();
-	chdir(confDirectory.c_str());
+	if (chdir(confDirectory.c_str()) == 0)
+	{
+		// Redirect cout and cerr to a file
+		string logFileName = confDirectory;
+		logFileName += "/pinot-dbus-daemon.log";
+		g_outputFile.open(logFileName.c_str());
+		g_coutBuf = cout.rdbuf();
+		g_cerrBuf = cerr.rdbuf();
+		cout.rdbuf(g_outputFile.rdbuf());
+		cerr.rdbuf(g_outputFile.rdbuf());
+	}
 
-	// Redirect cout and cerr to a file
-	string logFileName = confDirectory;
-	logFileName += "/pinot-dbus-daemon.log";
-	g_outputFile.open(logFileName.c_str());
-	g_coutBuf = cout.rdbuf();
-	g_cerrBuf = cerr.rdbuf();
-	cout.rdbuf(g_outputFile.rdbuf());
-	cerr.rdbuf(g_outputFile.rdbuf());
-
 	// Localize language names
 	Languages::setIntlName(0, _("Unknown"));
 	Languages::setIntlName(1, _("Danish"));

Modified: trunk/UI/GTK2/src/pinot.cc
===================================================================
--- trunk/UI/GTK2/src/pinot.cc	2006-10-29 09:05:51 UTC (rev 541)
+++ trunk/UI/GTK2/src/pinot.cc	2006-10-29 09:42:04 UTC (rev 542)
@@ -151,17 +151,18 @@
 	settings.enableDBus(true);
 
 	string confDirectory = PinotSettings::getConfigurationDirectory();
-	chdir(confDirectory.c_str());
+	if (chdir(confDirectory.c_str()) == 0)
+	{
+		// Redirect cout and cerr to a file
+		string logFileName = confDirectory;
+		logFileName += "/pinot.log";
+		g_outputFile.open(logFileName.c_str());
+		g_coutBuf = cout.rdbuf();
+		g_cerrBuf = cerr.rdbuf();
+		cout.rdbuf(g_outputFile.rdbuf());
+		cerr.rdbuf(g_outputFile.rdbuf());
+	}
 
-	// Redirect cout and cerr to a file
-	string logFileName = confDirectory;
-	logFileName += "/pinot.log";
-	g_outputFile.open(logFileName.c_str());
-	g_coutBuf = cout.rdbuf();
-	g_cerrBuf = cerr.rdbuf();
-	cout.rdbuf(g_outputFile.rdbuf());
-	cerr.rdbuf(g_outputFile.rdbuf());
-
 	// Localize language names
 	Languages::setIntlName(0, _("Unknown"));
 	Languages::setIntlName(1, _("Danish"));



From fabricecolin at mail.berlios.de  Mon Oct 30 15:55:10 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Mon, 30 Oct 2006 15:55:10 +0100
Subject: [Pinot-svn] r543 - trunk/UI/GTK2/src
Message-ID: <200610301455.k9UEtA6d023918@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-30 15:55:10 +0100 (Mon, 30 Oct 2006)
New Revision: 543

Modified:
   trunk/UI/GTK2/src/IndexPage.cpp
   trunk/UI/GTK2/src/mainWindow.cc
   trunk/UI/GTK2/src/mainWindow.hh
Log:
Refresh index lists when labels have changed and the combo is reset.


Modified: trunk/UI/GTK2/src/IndexPage.cpp
===================================================================
--- trunk/UI/GTK2/src/IndexPage.cpp	2006-10-29 09:42:04 UTC (rev 542)
+++ trunk/UI/GTK2/src/IndexPage.cpp	2006-10-30 14:55:10 UTC (rev 543)
@@ -216,6 +216,7 @@
 	}
 
 	m_pLabelCombobox->set_active(0);
+	m_labelName.clear();
 }
 
 //

Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2006-10-29 09:42:04 UTC (rev 542)
+++ trunk/UI/GTK2/src/mainWindow.cc	2006-10-30 14:55:10 UTC (rev 543)
@@ -1379,6 +1379,13 @@
 				{
 					// Synchronize the labels list with the new settings
 					pIndexPage->populateLabelCombobox();
+
+					NotebookPageBox *pNotebookPage = dynamic_cast<NotebookPageBox*>(pPage);
+					if (pNotebookPage != NULL)
+					{
+						// The current label may have changed, refresh the list
+						browse_index(pNotebookPage->getTitle(), pIndexPage->getLabelName(), 0, false);
+					}
 				}
 			}
 		}
@@ -2870,8 +2877,8 @@
 //
 // Browse an index
 //
-void mainWindow::browse_index(const ustring &indexName,
-	const ustring &labelName, unsigned int startDoc)
+void mainWindow::browse_index(const ustring &indexName, const ustring &labelName,
+	unsigned int startDoc, bool changePage)
 {
 	// Rudimentary lock
 	if (m_state.m_browsingIndex == true)
@@ -2891,8 +2898,11 @@
 		}
 		pIndexPage->setFirstDocument(startDoc);
 
-		// Switch to that index page
-		m_pNotebook->set_current_page(get_page_number(indexName, NotebookPageBox::INDEX_PAGE));
+		if (changePage == true)
+		{
+			// Switch to that index page
+			m_pNotebook->set_current_page(get_page_number(indexName, NotebookPageBox::INDEX_PAGE));
+		}
 	}
 
 	// Spawn a new thread to browse the index

Modified: trunk/UI/GTK2/src/mainWindow.hh
===================================================================
--- trunk/UI/GTK2/src/mainWindow.hh	2006-10-29 09:42:04 UTC (rev 542)
+++ trunk/UI/GTK2/src/mainWindow.hh	2006-10-30 14:55:10 UTC (rev 543)
@@ -130,8 +130,8 @@
 		NotebookPageBox::PageType type);
 	void edit_query(QueryProperties &queryProps, bool newQuery);
 	void run_search(const QueryProperties &queryProps);
-	void browse_index(const Glib::ustring &indexName,
-		const Glib::ustring &labelName, unsigned int startDoc);
+	void browse_index(const Glib::ustring &indexName, const Glib::ustring &labelName,
+		unsigned int startDoc, bool changePage = true);
 	void view_documents(std::vector<DocumentInfo> &documentsList);
 	bool append_document(IndexPage *pIndexPage, const Glib::ustring &indexName,
 		const IndexedDocument &docInfo);



From fabricecolin at mail.berlios.de  Tue Oct 31 15:19:55 2006
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 31 Oct 2006 15:19:55 +0100
Subject: [Pinot-svn] r544 - trunk/UI/GTK2/src
Message-ID: <200610311419.k9VEJtKo005337@sheep.berlios.de>

Author: fabricecolin
Date: 2006-10-31 15:19:54 +0100 (Tue, 31 Oct 2006)
New Revision: 544

Modified:
   trunk/UI/GTK2/src/IndexTree.cpp
   trunk/UI/GTK2/src/ModelColumns.cpp
   trunk/UI/GTK2/src/ModelColumns.h
   trunk/UI/GTK2/src/PinotUtils.cpp
   trunk/UI/GTK2/src/PinotUtils.h
   trunk/UI/GTK2/src/ResultsTree.cpp
   trunk/UI/GTK2/src/mainWindow.cc
Log:
Queries' Last Run column and index lists' Timestamp column were sorted
alphabetically !


Modified: trunk/UI/GTK2/src/IndexTree.cpp
===================================================================
--- trunk/UI/GTK2/src/IndexTree.cpp	2006-10-30 14:55:10 UTC (rev 543)
+++ trunk/UI/GTK2/src/IndexTree.cpp	2006-10-31 14:19:54 UTC (rev 544)
@@ -20,10 +20,11 @@
 #include <gtkmm/stock.h>
 #include <gtkmm/textbuffer.h>
 
+#include "config.h"
+#include "NLS.h"
+#include "TimeConverter.h"
 #include "QueryHistory.h"
 #include "ViewHistory.h"
-#include "config.h"
-#include "NLS.h"
 #include "PinotSettings.h"
 #include "PinotUtils.h"
 #include "IndexTree.h"
@@ -62,17 +63,17 @@
 	set_model(m_refStore);
 
 	// The score column is used for status icons
-	TreeViewColumn *pColumn = create_column(_("Title"), m_indexColumns.m_text, true, true);
+	TreeViewColumn *pColumn = create_column(_("Title"), m_indexColumns.m_text, true, true, m_indexColumns.m_text);
 	if (pColumn != NULL)
 	{
 		append_column(*manage(pColumn));
 	}
-	pColumn = create_column(_("URL"), m_indexColumns.m_liveUrl, true, true);
+	pColumn = create_column(_("URL"), m_indexColumns.m_liveUrl, true, true, m_indexColumns.m_liveUrl);
 	if (pColumn != NULL)
 	{
 		append_column(*manage(pColumn));
 	}
-	pColumn = create_column(_("Timestamp"), m_indexColumns.m_timestamp, false, true);
+	pColumn = create_column(_("Timestamp"), m_indexColumns.m_timestamp, false, true, m_indexColumns.m_timestampTime);
 	if (pColumn != NULL)
 	{
 		append_column(*manage(pColumn));
@@ -175,7 +176,9 @@
 	childRow[m_indexColumns.m_liveUrl] = to_utf8(docInfo.getOriginalLocation());
 	childRow[m_indexColumns.m_type] = to_utf8(docInfo.getType());
 	childRow[m_indexColumns.m_language] = to_utf8(docInfo.getLanguage());
-	childRow[m_indexColumns.m_timestamp] = to_utf8(docInfo.getTimestamp());
+	string timestamp(docInfo.getTimestamp());
+	childRow[m_indexColumns.m_timestamp] = to_utf8(timestamp);
+	childRow[m_indexColumns.m_timestampTime] = TimeConverter::fromTimestamp(timestamp);
 	childRow[m_indexColumns.m_id] = docInfo.getID();
 
 	// If the tree was empty, it is no longer
@@ -337,7 +340,9 @@
 			row[m_indexColumns.m_text] = to_utf8(docInfo.getTitle());
 			row[m_indexColumns.m_type] = to_utf8(docInfo.getType());
 			row[m_indexColumns.m_language] = to_utf8(docInfo.getLanguage());
-			row[m_indexColumns.m_timestamp] = to_utf8(docInfo.getTimestamp());
+			string timestamp(docInfo.getTimestamp());
+			row[m_indexColumns.m_timestamp] = to_utf8(timestamp);
+			row[m_indexColumns.m_timestampTime] = TimeConverter::fromTimestamp(timestamp);
 #ifdef DEBUG
 			cout << "IndexTree::updateDocumentInfo: language now " << docInfo.getLanguage() << endl;
 #endif

Modified: trunk/UI/GTK2/src/ModelColumns.cpp
===================================================================
--- trunk/UI/GTK2/src/ModelColumns.cpp	2006-10-30 14:55:10 UTC (rev 543)
+++ trunk/UI/GTK2/src/ModelColumns.cpp	2006-10-31 14:19:54 UTC (rev 544)
@@ -45,6 +45,7 @@
 {
 	add(m_name);
 	add(m_lastRun);
+	add(m_lastRunTime);
 	add(m_summary);
 	add(m_properties);
 }
@@ -80,6 +81,7 @@
 	add(m_language);
 	add(m_id);
 	add(m_timestamp);
+	add(m_timestampTime);
 }
 
 IndexModelColumns::~IndexModelColumns()

Modified: trunk/UI/GTK2/src/ModelColumns.h
===================================================================
--- trunk/UI/GTK2/src/ModelColumns.h	2006-10-30 14:55:10 UTC (rev 543)
+++ trunk/UI/GTK2/src/ModelColumns.h	2006-10-31 14:19:54 UTC (rev 544)
@@ -65,6 +65,7 @@
 
 	Gtk::TreeModelColumn<Glib::ustring> m_name;
 	Gtk::TreeModelColumn<Glib::ustring> m_lastRun;
+	Gtk::TreeModelColumn<time_t> m_lastRunTime;
 	Gtk::TreeModelColumn<Glib::ustring> m_summary;
 	Gtk::TreeModelColumn<QueryProperties> m_properties;
 
@@ -105,6 +106,7 @@
 	Gtk::TreeModelColumn<Glib::ustring> m_language;
 	Gtk::TreeModelColumn<unsigned int> m_id;
 	Gtk::TreeModelColumn<Glib::ustring> m_timestamp;
+	Gtk::TreeModelColumn<time_t> m_timestampTime;
 
 };
 

Modified: trunk/UI/GTK2/src/PinotUtils.cpp
===================================================================
--- trunk/UI/GTK2/src/PinotUtils.cpp	2006-10-30 14:55:10 UTC (rev 543)
+++ trunk/UI/GTK2/src/PinotUtils.cpp	2006-10-31 14:19:54 UTC (rev 544)
@@ -160,7 +160,7 @@
 
 /// Create a text column.
 TreeViewColumn *create_column(const ustring &title, const TreeModelColumnBase& modelColumn,
-	bool isResizable, bool isSortable)
+	bool isResizable, bool isSortable, const TreeModelColumnBase &sortColumn)
 {
 	TreeViewColumn *pColumn = new TreeViewColumn(title);
 
@@ -170,7 +170,7 @@
 	pColumn->set_resizable(isResizable);
 	if (isSortable == true)
 	{
-		pColumn->set_sort_column(modelColumn);
+		pColumn->set_sort_column(sortColumn);
 	}
 
 	return pColumn;
@@ -179,7 +179,7 @@
 /// Create an icon and text column, rendered by renderTextAndIconCell.
 TreeViewColumn *create_column_with_icon(const ustring &title, const TreeModelColumnBase& modelColumn,
 	const TreeViewColumn::SlotCellData &renderTextAndIconCell,
-	bool isResizable, bool isSortable)
+	bool isResizable, bool isSortable, const TreeModelColumnBase &sortColumn)
 {
 	TreeViewColumn *pColumn = new TreeViewColumn(title);
 
@@ -196,7 +196,7 @@
 	pColumn->set_resizable(isResizable);
 	if (isSortable == true)
 	{
-		pColumn->set_sort_column(modelColumn);
+		pColumn->set_sort_column(sortColumn);
 	}
 
 	return pColumn;

Modified: trunk/UI/GTK2/src/PinotUtils.h
===================================================================
--- trunk/UI/GTK2/src/PinotUtils.h	2006-10-30 14:55:10 UTC (rev 543)
+++ trunk/UI/GTK2/src/PinotUtils.h	2006-10-31 14:19:54 UTC (rev 544)
@@ -43,13 +43,13 @@
 /// Create a text column.
 Gtk::TreeViewColumn *create_column(const Glib::ustring &title,
 	const Gtk::TreeModelColumnBase& modelColumn,
-	bool isResizable, bool isSortable);
+	bool isResizable, bool isSortable, const Gtk::TreeModelColumnBase &sortColumn);
 
 /// Create an icon and text column, rendered by renderTextAndIconCell.
 Gtk::TreeViewColumn *create_column_with_icon(const Glib::ustring &title,
 	const Gtk::TreeModelColumnBase& modelColumn,
 	const Gtk::TreeViewColumn::SlotCellData &renderTextAndIconCell,
-	bool isResizable, bool isSortable);
+	bool isResizable, bool isSortable, const Gtk::TreeModelColumnBase &sortColumn);
 
 /// Converts to UTF-8.
 Glib::ustring to_utf8(const std::string &text);

Modified: trunk/UI/GTK2/src/ResultsTree.cpp
===================================================================
--- trunk/UI/GTK2/src/ResultsTree.cpp	2006-10-30 14:55:10 UTC (rev 543)
+++ trunk/UI/GTK2/src/ResultsTree.cpp	2006-10-31 14:19:54 UTC (rev 544)
@@ -140,7 +140,7 @@
 	append_column(*manage(pColumn));
 
 	// The last column is for the URL
-	pColumn = create_column(_("URL"), m_resultsColumns.m_url, false, true);
+	pColumn = create_column(_("URL"), m_resultsColumns.m_url, false, true, m_resultsColumns.m_url);
 	if (pColumn != NULL)
 	{
 		append_column(*manage(pColumn));

Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2006-10-30 14:55:10 UTC (rev 543)
+++ trunk/UI/GTK2/src/mainWindow.cc	2006-10-31 14:19:54 UTC (rev 544)
@@ -137,12 +137,12 @@
 	// Associate the columns model to the query tree
 	m_refQueryTree = ListStore::create(m_queryColumns);
 	queryTreeview->set_model(m_refQueryTree);
-	TreeViewColumn *pColumn = create_column(_("Query Name"), m_queryColumns.m_name, true, true);
+	TreeViewColumn *pColumn = create_column(_("Query Name"), m_queryColumns.m_name, true, true, m_queryColumns.m_name);
 	if (pColumn != NULL)
 	{
 		queryTreeview->append_column(*manage(pColumn));
 	}
-	pColumn = create_column(_("Last Run"), m_queryColumns.m_lastRun, true, true);
+	pColumn = create_column(_("Last Run"), m_queryColumns.m_lastRun, true, true, m_queryColumns.m_lastRunTime);
 	if (pColumn != NULL)
 	{
 		queryTreeview->append_column(*manage(pColumn));
@@ -226,14 +226,20 @@
 		TreeModel::iterator iter = m_refQueryTree->append();
 		TreeModel::Row row = *iter;
 		string queryName = queryIter->first;
+		string lastRun = history.getLastRun(queryName);
+		time_t lastRunTime = time(NULL);
 
 		row[m_queryColumns.m_name] = to_utf8(queryName);
-		string lastRun = history.getLastRun(queryName);
 		if (lastRun.empty() == true)
 		{
 			lastRun = _("N/A");
 		}
+		else
+		{
+			lastRunTime = TimeConverter::fromTimestamp(lastRun);
+		}
 		row[m_queryColumns.m_lastRun] = to_utf8(lastRun);
+		row[m_queryColumns.m_lastRunTime] = lastRunTime;
 		string summary(StringManip::replaceSubString(queryIter->second.getFreeQuery(), "\n", " "));
 		if (summary.empty() == false)
 		{
@@ -2437,12 +2443,14 @@
 	if (queryIter)
 	{
 		TreeModel::Row queryRow = *queryIter;
+		time_t lastRunTime = time(NULL);
 
 		QueryProperties queryProps = queryRow[m_queryColumns.m_properties];
 		run_search(queryProps);
 
 		// Update the Last Run column
-		queryRow[m_queryColumns.m_lastRun] = to_utf8(TimeConverter::toTimestamp(time(NULL)));
+		queryRow[m_queryColumns.m_lastRun] = to_utf8(TimeConverter::toTimestamp(lastRunTime));
+		queryRow[m_queryColumns.m_lastRunTime] = lastRunTime;
 	}
 }
 



