From fabricecolin at mail.berlios.de  Mon Oct  1 14:43:31 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Mon, 1 Oct 2007 14:43:31 +0200
Subject: [Pinot-svn] r1000 - in trunk: Index Search
Message-ID: <200710011243.l91ChVS1032210@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-01 14:43:31 +0200 (Mon, 01 Oct 2007)
New Revision: 1000

Modified:
   trunk/Index/XapianIndex.cpp
   trunk/Index/XapianIndex.h
   trunk/Search/XapianEngine.cpp
   trunk/Search/XapianEngine.h
Log:
Forgot to include config.h. Other minor mods.


Modified: trunk/Index/XapianIndex.cpp
===================================================================
--- trunk/Index/XapianIndex.cpp	2007-09-30 09:54:25 UTC (rev 999)
+++ trunk/Index/XapianIndex.cpp	2007-10-01 12:43:31 UTC (rev 1000)
@@ -682,7 +682,7 @@
 /// Gets the version number.
 string XapianIndex::getVersion(void) const
 {
-	string version;
+	string version("0.00");
 
 #if ENABLE_XAPIAN_DB_METADATA>0
 	XapianDatabase *pDatabase = XapianDatabaseFactory::getDatabase(m_databaseName);

Modified: trunk/Index/XapianIndex.h
===================================================================
--- trunk/Index/XapianIndex.h	2007-09-30 09:54:25 UTC (rev 999)
+++ trunk/Index/XapianIndex.h	2007-10-01 12:43:31 UTC (rev 1000)
@@ -22,6 +22,7 @@
 #include <string>
 #include <set>
 
+#include "config.h"
 #include "XapianDatabase.h"
 #include "IndexInterface.h"
 

Modified: trunk/Search/XapianEngine.cpp
===================================================================
--- trunk/Search/XapianEngine.cpp	2007-09-30 09:54:25 UTC (rev 999)
+++ trunk/Search/XapianEngine.cpp	2007-10-01 12:43:31 UTC (rev 1000)
@@ -324,16 +324,12 @@
 	parser.add_valuerangeprocessor(&dateProcessor);
 
 	// Size with a "b" suffix, ie 1024..10240b
-#if XAPIAN_MAJOR_VERSION>1
+#if XAPIAN_NUM_VERSION >= 1001000
 	Xapian::NumberValueRangeProcessor sizeProcessor(2, "b", false);
 	parser.add_valuerangeprocessor(&sizeProcessor);
-#elif XAPIAN_MAJOR_VERSION==1
-#if XAPIAN_MINOR_VERSION>0
-	Xapian::NumberValueRangeProcessor sizeProcessor(2, "b", false);
-#else
+#elif XAPIAN_NUM_VERSION >= 1000002
 	// Xapian 1.02 is the bare minimum
 	Xapian::v102::NumberValueRangeProcessor sizeProcessor(2, "b", false);
-#endif
 	parser.add_valuerangeprocessor(&sizeProcessor);
 #endif
 

Modified: trunk/Search/XapianEngine.h
===================================================================
--- trunk/Search/XapianEngine.h	2007-09-30 09:54:25 UTC (rev 999)
+++ trunk/Search/XapianEngine.h	2007-10-01 12:43:31 UTC (rev 1000)
@@ -25,6 +25,7 @@
 
 #include <xapian.h>
 
+#include "config.h"
 #include "SearchEngineInterface.h"
 #include "DownloaderFactory.h"
 



From fabricecolin at mail.berlios.de  Tue Oct  2 16:25:05 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 2 Oct 2007 16:25:05 +0200
Subject: [Pinot-svn] r1001 - trunk/Index
Message-ID: <200710021425.l92EP5LJ008435@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-02 16:25:04 +0200 (Tue, 02 Oct 2007)
New Revision: 1001

Modified:
   trunk/Index/DBusXapianIndex.cpp
   trunk/Index/DBusXapianIndex.h
   trunk/Index/IndexInterface.h
   trunk/Index/XapianIndex.cpp
   trunk/Index/XapianIndex.h
Log:
Actually, a new addLabel() method, together with the existing rename and
deleteLabel() methods, is more suitable to label management over D-Bus.
Removed the D-Bus'ified setLabels() and overloaded getLabels() for clients
that want to get the list directly from the daemon.


Modified: trunk/Index/DBusXapianIndex.cpp
===================================================================
--- trunk/Index/DBusXapianIndex.cpp	2007-10-01 12:43:31 UTC (rev 1000)
+++ trunk/Index/DBusXapianIndex.cpp	2007-10-02 14:25:04 UTC (rev 1001)
@@ -355,8 +355,29 @@
 /// Sets the list of known labels.
 bool DBusXapianIndex::setLabels(const set<string> &labels)
 {
-	gboolean updatedLabels = FALSE;
+	// Not allowed here
+	return false;
+}
 
+/// Gets the list of known labels.
+bool DBusXapianIndex::getLabels(set<string> &labels) const
+{
+	reopen();
+
+	return XapianIndex::getLabels(labels);
+}
+
+/// Gets the list of known labels.
+bool DBusXapianIndex::getLabels(set<string> &labels, bool forceDBus) const
+{
+	bool gotLabels = false;
+
+	if (forceDBus == false)
+	{
+		// Call overload
+		return getLabels(labels);
+	}
+
 	DBusGConnection *pBus = getBusConnection();
 	if (pBus == NULL)
 	{
@@ -366,58 +387,176 @@
 	DBusGProxy *pBusProxy = getBusProxy(pBus);
 	if (pBusProxy == NULL)
 	{
-		cerr << "DBusXapianIndex::setLabels: couldn't get bus proxy" << endl;
+		cerr << "DBusXapianIndex::getLabels: couldn't get bus proxy" << endl;
 		return false;
 	}
 
 	GError *pError = NULL;
-	dbus_uint32_t labelsCount = labels.size();
 	char **pLabels;
-	unsigned int labelIndex = 0;
 
-	pLabels = g_new(char *, labelsCount + 1);
-	for (set<string>::const_iterator labelIter = labels.begin();
-		labelIter != labels.end(); ++labelIter)
+	// G_TYPE_STRV is the GLib equivalent of DBUS_TYPE_ARRAY, DBUS_TYPE_STRING
+	if (dbus_g_proxy_call(pBusProxy, "GetLabels", &pError,
+		G_TYPE_INVALID,
+		G_TYPE_STRV, &pLabels,
+		G_TYPE_INVALID) == TRUE)
 	{
-		pLabels[labelIndex] = g_strdup(labelIter->c_str());
-		++labelIndex;
+		for (char **pLabel = pLabels; (*pLabel) != NULL; ++pLabel)
+		{
+			labels.insert(*pLabel);
+		}
+
+		// Free the array
+		g_strfreev(pLabels);
+
+		gotLabels = true;
 	}
-	pLabels[labelIndex] = NULL;
+	else
+	{
+		if (pError != NULL)
+		{
+			cerr << "DBusXapianIndex::getLabels: " << pError->message << endl;
+			g_error_free(pError);
+		}
+	}
 
-	// G_TYPE_STRV is the GLib equivalent of DBUS_TYPE_ARRAY, DBUS_TYPE_STRING
-	if (dbus_g_proxy_call(pBusProxy, "SetLabels", &pError,
-		G_TYPE_STRV, pLabels,
+	g_object_unref(pBusProxy);
+	// FIXME: don't we have to call dbus_g_connection_unref(pBus); ?
+
+	return gotLabels;
+}
+
+/// Adds a label.
+bool DBusXapianIndex::addLabel(const string &name)
+{
+	bool addedLabel = false;
+
+	DBusGConnection *pBus = getBusConnection();
+	if (pBus == NULL)
+	{
+		return false;
+	}
+
+	DBusGProxy *pBusProxy = getBusProxy(pBus);
+	if (pBusProxy == NULL)
+	{
+		cerr << "DBusXapianIndex::addLabel: couldn't get bus proxy" << endl;
+		return false;
+	}
+
+	GError *pError = NULL;
+	const char *pLabel = name.c_str();
+
+	if (dbus_g_proxy_call(pBusProxy, "AddLabel", &pError,
+		G_TYPE_STRING, pLabel,
 		G_TYPE_INVALID,
-		G_TYPE_BOOLEAN, &updatedLabels,
-		G_TYPE_INVALID) == FALSE)
+		G_TYPE_STRING, &pLabel,
+		G_TYPE_INVALID) == TRUE)
 	{
+		addedLabel = true;
+	}
+	else
+	{
 		if (pError != NULL)
 		{
-			cerr << "DBusXapianIndex::setDocumentLabels: " << pError->message << endl;
+			cerr << "DBusXapianIndex::addLabel: " << pError->message << endl;
 			g_error_free(pError);
 		}
 	}
 
-	// Free the array
-	g_strfreev(pLabels);
-
 	g_object_unref(pBusProxy);
 	// FIXME: don't we have to call dbus_g_connection_unref(pBus); ?
 
-	if (updatedLabels == TRUE)
+	return addedLabel;
+}
+
+/// Renames a label.
+bool DBusXapianIndex::renameLabel(const string &name, const string &newName)
+{
+	bool renamedLabel = false;
+
+	DBusGConnection *pBus = getBusConnection();
+	if (pBus == NULL)
 	{
-		return true;
+		return false;
 	}
 
-	return false;
+	DBusGProxy *pBusProxy = getBusProxy(pBus);
+	if (pBusProxy == NULL)
+	{
+		cerr << "DBusXapianIndex::renameLabel: couldn't get bus proxy" << endl;
+		return false;
+	}
+
+	GError *pError = NULL;
+	const char *pOldLabel = name.c_str();
+	const char *pNewLabel = newName.c_str();
+
+	if (dbus_g_proxy_call(pBusProxy, "RenameLabel", &pError,
+		G_TYPE_STRING, pOldLabel,
+		G_TYPE_STRING, pNewLabel,
+		G_TYPE_INVALID,
+		G_TYPE_STRING, &pNewLabel,
+		G_TYPE_INVALID) == TRUE)
+	{
+		renamedLabel = true;
+	}
+	else
+	{
+		if (pError != NULL)
+		{
+			cerr << "DBusXapianIndex::renameLabel: " << pError->message << endl;
+			g_error_free(pError);
+		}
+	}
+
+	g_object_unref(pBusProxy);
+	// FIXME: don't we have to call dbus_g_connection_unref(pBus); ?
+
+	return renamedLabel;
 }
 
-/// Gets the list of known labels.
-bool DBusXapianIndex::getLabels(set<string> &labels) const
+/// Deletes all references to a label.
+bool DBusXapianIndex::deleteLabel(const string &name)
 {
-	reopen();
+	bool deletedLabel = false;
 
-	return XapianIndex::getLabels(labels);
+	DBusGConnection *pBus = getBusConnection();
+	if (pBus == NULL)
+	{
+		return false;
+	}
+
+	DBusGProxy *pBusProxy = getBusProxy(pBus);
+	if (pBusProxy == NULL)
+	{
+		cerr << "DBusXapianIndex::deleteLabel: couldn't get bus proxy" << endl;
+		return false;
+	}
+
+	GError *pError = NULL;
+	const char *pLabel = name.c_str();
+
+	if (dbus_g_proxy_call(pBusProxy, "DeleteLabel", &pError,
+		G_TYPE_STRING, pLabel,
+		G_TYPE_INVALID,
+		G_TYPE_STRING, &pLabel,
+		G_TYPE_INVALID) == TRUE)
+	{
+		deletedLabel = true;
+	}
+	else
+	{
+		if (pError != NULL)
+		{
+			cerr << "DBusXapianIndex::deleteLabel: " << pError->message << endl;
+			g_error_free(pError);
+		}
+	}
+
+	g_object_unref(pBusProxy);
+	// FIXME: don't we have to call dbus_g_connection_unref(pBus); ?
+
+	return deletedLabel;
 }
 
 /// Determines whether a document has a label.
@@ -758,96 +897,6 @@
 	return false;
 }
 
-/// Renames a label.
-bool DBusXapianIndex::renameLabel(const string &name, const string &newName)
-{
-	bool renamedLabel = false;
-
-	DBusGConnection *pBus = getBusConnection();
-	if (pBus == NULL)
-	{
-		return false;
-	}
-
-	DBusGProxy *pBusProxy = getBusProxy(pBus);
-	if (pBusProxy == NULL)
-	{
-		cerr << "DBusXapianIndex::renameLabel: couldn't get bus proxy" << endl;
-		return false;
-	}
-
-	GError *pError = NULL;
-	const char *pOldLabel = name.c_str();
-	const char *pNewLabel = newName.c_str();
-
-	if (dbus_g_proxy_call(pBusProxy, "RenameLabel", &pError,
-		G_TYPE_STRING, pOldLabel,
-		G_TYPE_STRING, pNewLabel,
-		G_TYPE_INVALID,
-		G_TYPE_STRING, &pNewLabel,
-		G_TYPE_INVALID) == TRUE)
-	{
-		renamedLabel = true;
-	}
-	else
-	{
-		if (pError != NULL)
-		{
-			cerr << "DBusXapianIndex::renameLabel: " << pError->message << endl;
-			g_error_free(pError);
-		}
-	}
-
-	g_object_unref(pBusProxy);
-	// FIXME: don't we have to call dbus_g_connection_unref(pBus); ?
-
-	return renamedLabel;
-}
-
-/// Deletes all references to a label.
-bool DBusXapianIndex::deleteLabel(const string &name)
-{
-	bool deletedLabel = false;
-
-	DBusGConnection *pBus = getBusConnection();
-	if (pBus == NULL)
-	{
-		return false;
-	}
-
-	DBusGProxy *pBusProxy = getBusProxy(pBus);
-	if (pBusProxy == NULL)
-	{
-		cerr << "DBusXapianIndex::deleteLabel: couldn't get bus proxy" << endl;
-		return false;
-	}
-
-	GError *pError = NULL;
-	const char *pLabel = name.c_str();
-
-	if (dbus_g_proxy_call(pBusProxy, "DeleteLabel", &pError,
-		G_TYPE_STRING, pLabel,
-		G_TYPE_INVALID,
-		G_TYPE_STRING, &pLabel,
-		G_TYPE_INVALID) == TRUE)
-	{
-		deletedLabel = true;
-	}
-	else
-	{
-		if (pError != NULL)
-		{
-			cerr << "DBusXapianIndex::deleteLabel: " << pError->message << endl;
-			g_error_free(pError);
-		}
-	}
-
-	g_object_unref(pBusProxy);
-	// FIXME: don't we have to call dbus_g_connection_unref(pBus); ?
-
-	return deletedLabel;
-}
-
 /// Flushes recent changes to the disk.
 bool DBusXapianIndex::flush(void)
 {

Modified: trunk/Index/DBusXapianIndex.h
===================================================================
--- trunk/Index/DBusXapianIndex.h	2007-10-01 12:43:31 UTC (rev 1000)
+++ trunk/Index/DBusXapianIndex.h	2007-10-02 14:25:04 UTC (rev 1001)
@@ -67,6 +67,18 @@
 		/// Gets the list of known labels.
 		virtual bool getLabels(std::set<std::string> &labels) const;
 
+		/// Gets the list of known labels.
+		bool getLabels(std::set<std::string> &labels, bool forceDBus) const;
+
+		/// Adds a label.
+		virtual bool addLabel(const std::string &name);
+
+		/// Renames a label.
+		virtual bool renameLabel(const std::string &name, const std::string &newName);
+
+		/// Deletes all references to a label.
+		virtual bool deleteLabel(const std::string &name);
+
 		/// Determines whether a document has a label.
 		virtual bool hasLabel(unsigned int docId, const std::string &name) const;
 
@@ -120,12 +132,6 @@
 		/// Unindexes all documents.
 		virtual bool unindexAllDocuments(void);
 
-		/// Renames a label.
-		virtual bool renameLabel(const std::string &name, const std::string &newName);
-
-		/// Deletes all references to a label.
-		virtual bool deleteLabel(const std::string &name);
-
 		/// Flushes recent changes to the disk.
 		virtual bool flush(void);
 

Modified: trunk/Index/IndexInterface.h
===================================================================
--- trunk/Index/IndexInterface.h	2007-10-01 12:43:31 UTC (rev 1000)
+++ trunk/Index/IndexInterface.h	2007-10-02 14:25:04 UTC (rev 1001)
@@ -57,6 +57,15 @@
 		/// Gets the list of known labels.
 		virtual bool getLabels(std::set<std::string> &labels) const = 0;
 
+		/// Adds a label.
+		virtual bool addLabel(const std::string &name) = 0;
+
+		/// Renames a label.
+		virtual bool renameLabel(const std::string &name, const std::string &newName) = 0;
+
+		/// Deletes all references to a label.
+		virtual bool deleteLabel(const std::string &name) = 0;
+
 		/// Determines whether a document has a label.
 		virtual bool hasLabel(unsigned int docId, const std::string &name) const = 0;
 
@@ -65,11 +74,11 @@
 
 		/// Sets a document's labels.
 		virtual bool setDocumentLabels(unsigned int docId, const std::set<std::string> &labels,
-			bool resetLabels = true) = 0;
+			bool readdLabel = true) = 0;
 
 		/// Sets documents' labels.
 		virtual bool setDocumentsLabels(const std::set<unsigned int> &docIds,
-			const std::set<std::string> &labels, bool resetLabels = true) = 0;
+			const std::set<std::string> &labels, bool readdLabel = true) = 0;
 
 		/// Checks whether the given URL is in the index.
 		virtual unsigned int hasDocument(const std::string &url) const = 0;
@@ -113,12 +122,6 @@
 		/// Unindexes all documents.
 		virtual bool unindexAllDocuments(void) = 0;
 
-		/// Renames a label.
-		virtual bool renameLabel(const std::string &name, const std::string &newName) = 0;
-
-		/// Deletes all references to a label.
-		virtual bool deleteLabel(const std::string &name) = 0;
-
 		/// Flushes recent changes to the disk.
 		virtual bool flush(void) = 0;
 

Modified: trunk/Index/XapianIndex.cpp
===================================================================
--- trunk/Index/XapianIndex.cpp	2007-10-01 12:43:31 UTC (rev 1000)
+++ trunk/Index/XapianIndex.cpp	2007-10-02 14:25:04 UTC (rev 1001)
@@ -1000,6 +1000,114 @@
 	return false;
 }
 
+/// Adds a label.
+bool XapianIndex::addLabel(const string &name)
+{
+	// Nothing to do here
+	return false;
+}
+
+/// Renames a label.
+bool XapianIndex::renameLabel(const string &name, const string &newName)
+{
+	bool renamedLabel = false;
+
+	XapianDatabase *pDatabase = XapianDatabaseFactory::getDatabase(m_databaseName, false);
+	if (pDatabase == NULL)
+	{
+		cerr << "Bad index " << m_databaseName << endl;
+		return false;
+	}
+
+	try
+	{
+		Xapian::WritableDatabase *pIndex = pDatabase->writeLock();
+		if (pIndex != NULL)
+		{
+			string term("XLABEL:");
+
+			// Get documents that have this label
+			term += XapianDatabase::limitTermLength(Url::escapeUrl(name));
+			for (Xapian::PostingIterator postingIter = pIndex->postlist_begin(term);
+				postingIter != pIndex->postlist_end(term); ++postingIter)
+			{
+				Xapian::docid docId = *postingIter;
+
+				// Get the document
+				Xapian::Document doc = pIndex->get_document(docId);
+				// Remove the term
+				doc.remove_term(term);
+				// ...add the new one
+				doc.add_term(string("XLABEL:") + XapianDatabase::limitTermLength(Url::escapeUrl(newName)));
+				// ...and update the document
+				pIndex->replace_document(docId, doc);
+			}
+
+			renamedLabel = true;
+		}
+	}
+	catch (const Xapian::Error &error)
+	{
+		cerr << "Couldn't delete label: " << error.get_type() << ": " << error.get_msg() << endl;
+	}
+	catch (...)
+	{
+		cerr << "Couldn't delete label, unknown exception occured" << endl;
+	}
+	pDatabase->unlock();
+
+	return renamedLabel;
+}
+
+/// Deletes all references to a label.
+bool XapianIndex::deleteLabel(const string &name)
+{
+	bool deletedLabel = false;
+
+	XapianDatabase *pDatabase = XapianDatabaseFactory::getDatabase(m_databaseName, false);
+	if (pDatabase == NULL)
+	{
+		cerr << "Bad index " << m_databaseName << endl;
+		return false;
+	}
+
+	try
+	{
+		Xapian::WritableDatabase *pIndex = pDatabase->writeLock();
+		if (pIndex != NULL)
+		{
+			string term("XLABEL:");
+
+			// Get documents that have this label
+			term += XapianDatabase::limitTermLength(Url::escapeUrl(name));
+			for (Xapian::PostingIterator postingIter = pIndex->postlist_begin(term);
+				postingIter != pIndex->postlist_end(term); ++postingIter)
+			{
+				Xapian::docid docId = *postingIter;
+
+				// Get the document
+				Xapian::Document doc = pIndex->get_document(docId);
+				// Remove the term
+				doc.remove_term(term);
+				// ...and update the document
+				pIndex->replace_document(docId, doc);
+			}
+			deletedLabel = true;
+		}
+	}
+	catch (const Xapian::Error &error)
+	{
+		cerr << "Couldn't delete label: " << error.get_type() << ": " << error.get_msg() << endl;
+	}
+	catch (...)
+	{
+		cerr << "Couldn't delete label, unknown exception occured" << endl;
+	}
+	pDatabase->unlock();
+
+	return deletedLabel;
+}
+
 /// Determines whether a document has a label.
 bool XapianIndex::hasLabel(unsigned int docId, const string &name) const
 {
@@ -1680,107 +1788,6 @@
 	return deleteDocuments(MAGIC_TERM);
 }
 
-/// Renames a label.
-bool XapianIndex::renameLabel(const string &name, const string &newName)
-{
-	bool renamedLabel = false;
-
-	XapianDatabase *pDatabase = XapianDatabaseFactory::getDatabase(m_databaseName, false);
-	if (pDatabase == NULL)
-	{
-		cerr << "Bad index " << m_databaseName << endl;
-		return false;
-	}
-
-	try
-	{
-		Xapian::WritableDatabase *pIndex = pDatabase->writeLock();
-		if (pIndex != NULL)
-		{
-			string term("XLABEL:");
-
-			// Get documents that have this label
-			term += XapianDatabase::limitTermLength(Url::escapeUrl(name));
-			for (Xapian::PostingIterator postingIter = pIndex->postlist_begin(term);
-				postingIter != pIndex->postlist_end(term); ++postingIter)
-			{
-				Xapian::docid docId = *postingIter;
-
-				// Get the document
-				Xapian::Document doc = pIndex->get_document(docId);
-				// Remove the term
-				doc.remove_term(term);
-				// ...add the new one
-				doc.add_term(string("XLABEL:") + XapianDatabase::limitTermLength(Url::escapeUrl(newName)));
-				// ...and update the document
-				pIndex->replace_document(docId, doc);
-			}
-
-			renamedLabel = true;
-		}
-	}
-	catch (const Xapian::Error &error)
-	{
-		cerr << "Couldn't delete label: " << error.get_type() << ": " << error.get_msg() << endl;
-	}
-	catch (...)
-	{
-		cerr << "Couldn't delete label, unknown exception occured" << endl;
-	}
-	pDatabase->unlock();
-
-	return renamedLabel;
-}
-
-/// Deletes all references to a label.
-bool XapianIndex::deleteLabel(const string &name)
-{
-	bool deletedLabel = false;
-
-	XapianDatabase *pDatabase = XapianDatabaseFactory::getDatabase(m_databaseName, false);
-	if (pDatabase == NULL)
-	{
-		cerr << "Bad index " << m_databaseName << endl;
-		return false;
-	}
-
-	try
-	{
-		Xapian::WritableDatabase *pIndex = pDatabase->writeLock();
-		if (pIndex != NULL)
-		{
-			string term("XLABEL:");
-
-			// Get documents that have this label
-			term += XapianDatabase::limitTermLength(Url::escapeUrl(name));
-			for (Xapian::PostingIterator postingIter = pIndex->postlist_begin(term);
-				postingIter != pIndex->postlist_end(term); ++postingIter)
-			{
-				Xapian::docid docId = *postingIter;
-
-				// Get the document
-				Xapian::Document doc = pIndex->get_document(docId);
-				// Remove the term
-				doc.remove_term(term);
-				// ...and update the document
-				pIndex->replace_document(docId, doc);
-			}
-			deletedLabel = true;
-		}
-	}
-	catch (const Xapian::Error &error)
-	{
-		cerr << "Couldn't delete label: " << error.get_type() << ": " << error.get_msg() << endl;
-	}
-	catch (...)
-	{
-		cerr << "Couldn't delete label, unknown exception occured" << endl;
-	}
-	pDatabase->unlock();
-
-	return deletedLabel;
-}
-
 /// Flushes recent changes to the disk.
 bool XapianIndex::flush(void)
 {

Modified: trunk/Index/XapianIndex.h
===================================================================
--- trunk/Index/XapianIndex.h	2007-10-01 12:43:31 UTC (rev 1000)
+++ trunk/Index/XapianIndex.h	2007-10-02 14:25:04 UTC (rev 1001)
@@ -69,6 +69,15 @@
 		/// Gets the list of known labels.
 		virtual bool getLabels(std::set<std::string> &labels) const;
 
+		/// Adds a label.
+		virtual bool addLabel(const std::string &name);
+
+		/// Renames a label.
+		virtual bool renameLabel(const std::string &name, const std::string &newName);
+
+		/// Deletes all references to a label.
+		virtual bool deleteLabel(const std::string &name);
+
 		/// Determines whether a document has a label.
 		virtual bool hasLabel(unsigned int docId, const std::string &name) const;
 
@@ -125,12 +134,6 @@
 		/// Unindexes all documents.
 		virtual bool unindexAllDocuments(void);
 
-		/// Renames a label.
-		virtual bool renameLabel(const std::string &name, const std::string &newName);
-
-		/// Deletes all references to a label.
-		virtual bool deleteLabel(const std::string &name);
-
 		/// Flushes recent changes to the disk.
 		virtual bool flush(void);
 



From fabricecolin at mail.berlios.de  Tue Oct  2 16:30:43 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 2 Oct 2007 16:30:43 +0200
Subject: [Pinot-svn] r1002 - trunk/UI/GTK2/src
Message-ID: <200710021430.l92EUhIR008702@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-02 16:30:42 +0200 (Tue, 02 Oct 2007)
New Revision: 1002

Modified:
   trunk/UI/GTK2/src/prefsDialog.cc
   trunk/UI/GTK2/src/prefsDialog.hh
Log:
Keep track of new labels separately.


Modified: trunk/UI/GTK2/src/prefsDialog.cc
===================================================================
--- trunk/UI/GTK2/src/prefsDialog.cc	2007-10-02 14:25:04 UTC (rev 1001)
+++ trunk/UI/GTK2/src/prefsDialog.cc	2007-10-02 14:30:42 UTC (rev 1002)
@@ -128,6 +128,11 @@
 {
 }
 
+const set<string> &prefsDialog::getLabelsToAdd(void) const
+{
+	return m_addedLabels;
+}
+
 const set<string> &prefsDialog::getLabelsToDelete(void) const
 {
 	return m_deletedLabels;
@@ -154,8 +159,18 @@
 {
 	TreeModel::iterator iter;
 	TreeModel::Row row;
+	set<string> &labels = m_settings.m_labels;
 
-	const set<string> &labels = m_settings.getLabels();
+	// Get labels directly from the daemon's index
+	IndexInterface *pDaemonIndex = m_settings.getIndex(m_settings.m_daemonIndexLocation);
+	if (pDaemonIndex != NULL)
+	{
+		labels.clear();
+		pDaemonIndex->getLabels(labels);
+
+		delete pDaemonIndex;
+	}
+
 	if (labels.empty() == true)
 	{
 		// This button will stay disabled until labels are added to the list
@@ -183,9 +198,10 @@
 
 void prefsDialog::save_labelsTreeview()
 {
-	// Clear the current settings
-	m_settings.clearLabels();
+	set<string> &labels = m_settings.m_labels;
 
+	labels.clear();
+
 	// Go through the labels tree
 	TreeModel::Children children = m_refLabelsTree->children();
 	if (children.empty() == false)
@@ -196,8 +212,8 @@
 			TreeModel::Row row = *iter;
 
 			// Add this new label to the settings
-			ustring labelName = row[m_labelsColumns.m_name];
-			ustring oldName = row[m_labelsColumns.m_oldName];
+			ustring labelName(row[m_labelsColumns.m_name]);
+			ustring oldName(row[m_labelsColumns.m_oldName]);
 			// Was this label renamed ?
 			if ((row[m_labelsColumns.m_enabled] == true) &&
 				(labelName != oldName))
@@ -211,11 +227,16 @@
 			{
 				m_deletedLabels.erase(labelIter);
 			}
+			// Is this a nw label ?
+			if (row[m_labelsColumns.m_enabled] == false)
+			{
+				m_addedLabels.insert(from_utf8(labelName));
+			}
 
 #ifdef DEBUG
 			cout << "prefsDialog::save_labelsTreeview: " << labelName << endl;
 #endif
-			m_settings.addLabel(labelName);
+			labels.insert(labelName);
 		}
 	}
 }

Modified: trunk/UI/GTK2/src/prefsDialog.hh
===================================================================
--- trunk/UI/GTK2/src/prefsDialog.hh	2007-10-02 14:25:04 UTC (rev 1001)
+++ trunk/UI/GTK2/src/prefsDialog.hh	2007-10-02 14:30:42 UTC (rev 1002)
@@ -36,6 +36,8 @@
 	prefsDialog();
 	virtual ~prefsDialog();
 
+	const std::set<std::string> &getLabelsToAdd(void) const;
+
 	const std::set<std::string> &getLabelsToDelete(void) const;
 
 	const std::map<std::string, std::string> &getLabelsToRename(void) const;
@@ -71,6 +73,7 @@
 	TimestampedModelColumns m_mailColumns;
 	TimestampedModelColumns m_patternsColumns;
 	Glib::RefPtr<Gtk::ListStore> m_refPatternsTree;
+	std::set<std::string> m_addedLabels;
 	std::set<std::string> m_deletedLabels;
 	std::map<std::string, std::string> m_renamedLabels;
 	std::set<std::string> m_deletedDirectories;



From fabricecolin at mail.berlios.de  Tue Oct  2 16:40:12 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 2 Oct 2007 16:40:12 +0200
Subject: [Pinot-svn] r1003 - trunk/UI/GTK2/src
Message-ID: <200710021440.l92EeCIX009506@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-02 16:40:00 +0200 (Tue, 02 Oct 2007)
New Revision: 1003

Modified:
   trunk/UI/GTK2/src/PinotSettings.cpp
   trunk/UI/GTK2/src/PinotSettings.h
   trunk/UI/GTK2/src/ServerThreads.cpp
   trunk/UI/GTK2/src/WorkerThreads.cpp
   trunk/UI/GTK2/src/WorkerThreads.h
   trunk/UI/GTK2/src/importDialog.cc
   trunk/UI/GTK2/src/mainWindow.cc
   trunk/UI/GTK2/src/pinot-dbus-daemon.cc
   trunk/UI/GTK2/src/pinot-dbus-daemon.xml
   trunk/UI/GTK2/src/pinot.cc
   trunk/UI/GTK2/src/propertiesDialog.cc
   trunk/UI/GTK2/src/queryDialog.cc
   trunk/UI/GTK2/src/queryDialog.hh
Log:
Daemon supports new D-Bus methods AddLabel and GetLabels. The labels list is
updated if necessary whenever labels are manipulated. For instance, calling
SetDocumentLabels with a new label should create that label.
If new labels are defined in the UI, LabelUpdateThread calls addLabel().
PinotSettings' labels list can be accessed directly without going through
setters and getters.
Modified the order in which the index is checked at startup and reset to
take into account changes made to versioning and labels lists.
Added a --reindex option to the daemon.


Modified: trunk/UI/GTK2/src/PinotSettings.cpp
===================================================================
--- trunk/UI/GTK2/src/PinotSettings.cpp	2007-10-02 14:30:42 UTC (rev 1002)
+++ trunk/UI/GTK2/src/PinotSettings.cpp	2007-10-02 14:40:00 UTC (rev 1003)
@@ -1641,34 +1641,6 @@
 	m_queries.clear();
 }
 
-/// Returns the labels list.
-const set<string> &PinotSettings::getLabels(void) const
-{
-	return m_labels;
-}
-
-/// Adds a new label.
-void PinotSettings::addLabel(const string &name)
-{
-	m_labels.insert(name);
-}
-
-/// Removes a label.
-void PinotSettings::removeLabel(const string &name)
-{
-	set<string>::iterator labelIter = m_labels.find(name);
-	if (labelIter != m_labels.end())
-	{
-		m_labels.erase(labelIter);
-	}
-}
-
-/// Clears the labels list.
-void PinotSettings::clearLabels(void)
-{
-	m_labels.clear();
-}
-
 /// Determines if a file matches the blacklist.
 bool PinotSettings::isBlackListed(const string &fileName)
 {

Modified: trunk/UI/GTK2/src/PinotSettings.h
===================================================================
--- trunk/UI/GTK2/src/PinotSettings.h	2007-10-02 14:30:42 UTC (rev 1002)
+++ trunk/UI/GTK2/src/PinotSettings.h	2007-10-02 14:40:00 UTC (rev 1003)
@@ -130,18 +130,6 @@
 		/// Clears the queries map.
 		void clearQueries(void);
 
-		/// Returns the labels list.
-		const std::set<std::string> &getLabels(void) const;
-
-		/// Adds a new label.
-		void addLabel(const std::string &name);
-
-		/// Removes a label.
-		void removeLabel(const std::string &name);
-
-		/// Clears the labels list.
-		void clearLabels(void);
-
 		/// Determines if a file matches the blacklist.
 		bool isBlackListed(const std::string &fileName);
 
@@ -212,6 +200,7 @@
 		unsigned int m_proxyPort;
 		Glib::ustring  m_proxyType;
 		bool m_proxyEnabled;
+		std::set<std::string> m_labels;
 		std::set<IndexableLocation> m_indexableLocations;
 		std::set<Glib::ustring> m_filePatternsList;
 		bool m_isBlackList;
@@ -228,7 +217,6 @@
 		std::map<unsigned int, std::string> m_engineIds;
 		std::map<std::string, bool> m_engineChannels;
 		std::map<std::string, QueryProperties> m_queries;
-		std::set<std::string> m_labels;
 
 		PinotSettings();
 		bool loadConfiguration(const std::string &fileName, bool isGlobal);

Modified: trunk/UI/GTK2/src/ServerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/ServerThreads.cpp	2007-10-02 14:30:42 UTC (rev 1002)
+++ trunk/UI/GTK2/src/ServerThreads.cpp	2007-10-02 14:40:00 UTC (rev 1003)
@@ -625,7 +625,7 @@
 {
 	XapianIndex index(PinotSettings::getInstance().m_daemonIndexLocation);
 	DBusError error;
-	bool processedMessage = true, flushIndex = false;
+	bool processedMessage = true, updateLabelsCache = false, flushIndex = false;
 
 	if ((m_pServer == NULL) ||
 		(m_pConnection == NULL) ||
@@ -636,6 +636,13 @@
 
 	dbus_error_init(&error);
 
+	// Access the settings' labels list directly
+	set<string> &labelsCache = PinotSettings::getInstance().m_labels;
+	if (labelsCache.empty() == true)
+	{
+		index.getLabels(labelsCache);
+	}
+
 #ifdef DEBUG
 	const char *pSender = dbus_message_get_sender(m_pRequest);
 	if (pSender != NULL)
@@ -667,6 +674,114 @@
 				DBUS_TYPE_INVALID);
 		}
 	}
+	else if (dbus_message_is_method_call(m_pRequest, "de.berlios.Pinot", "Reload") == TRUE)
+	{
+		if (dbus_message_get_args(m_pRequest, &error,
+			DBUS_TYPE_INVALID) == TRUE)
+		{
+			gboolean reloading = TRUE;
+
+#ifdef DEBUG
+			cout << "DBusServletThread::doWork: received Reload" << endl;
+#endif
+			m_pServer->reload();
+
+			// Prepare the reply
+			m_pReply = newDBusReply(m_pRequest);
+			if (m_pReply != NULL)
+			{
+				dbus_message_append_args(m_pReply,
+					DBUS_TYPE_BOOLEAN, &reloading,
+					DBUS_TYPE_INVALID);
+			}
+		}
+	}
+	else if (dbus_message_is_method_call(m_pRequest, "de.berlios.Pinot", "Stop") == TRUE)
+	{
+		if (dbus_message_get_args(m_pRequest, &error,
+			DBUS_TYPE_INVALID) == TRUE)
+		{
+			int exitStatus = EXIT_SUCCESS;
+
+#ifdef DEBUG
+			cout << "DBusServletThread::doWork: received Stop" << endl;
+#endif
+			// Prepare the reply
+			m_pReply = newDBusReply(m_pRequest);
+			if (m_pReply != NULL)
+			{
+				dbus_message_append_args(m_pReply,
+					DBUS_TYPE_INT32, &exitStatus,
+					DBUS_TYPE_INVALID);
+			}
+
+			m_mustQuit = true;
+		}
+	}
+	else if (dbus_message_is_method_call(m_pRequest, "de.berlios.Pinot", "GetLabels") == TRUE)
+	{
+#ifdef DEBUG
+		cout << "DBusServletThread::doWork: received GetLabels" << endl;
+#endif
+		// This method doesn't take any argument
+		m_pArray = g_ptr_array_new();
+
+		for (set<string>::const_iterator labelIter = labelsCache.begin();
+			labelIter != labelsCache.end(); ++labelIter)
+		{
+			string labelName(*labelIter);
+
+			g_ptr_array_add(m_pArray, const_cast<char*>(labelName.c_str()));
+#ifdef DEBUG
+			cout << "DBusServletThread::doWork: adding label " << m_pArray->len << " " << labelName << endl;
+#endif
+		}
+
+		// Prepare the reply
+		m_pReply = newDBusReply(m_pRequest);
+		if (m_pReply != NULL)
+		{
+			dbus_message_append_args(m_pReply,
+				DBUS_TYPE_ARRAY, DBUS_TYPE_STRING, &m_pArray->pdata, m_pArray->len,
+				DBUS_TYPE_INVALID);
+		}
+	}
+	else if (dbus_message_is_method_call(m_pRequest, "de.berlios.Pinot", "AddLabel") == TRUE)
+	{
+		char *pLabel = NULL;
+
+		if (dbus_message_get_args(m_pRequest, &error,
+			DBUS_TYPE_STRING, &pLabel,
+			DBUS_TYPE_INVALID) == TRUE)
+		{
+#ifdef DEBUG
+			cout << "DBusServletThread::doWork: received AddLabel " << pLabel << endl;
+#endif
+			if (pLabel != NULL)
+			{
+				string labelName(pLabel);
+
+				// Add the label
+				flushIndex = index.addLabel(labelName);
+				// Is this a known label ?
+				if (labelsCache.find(labelName) == labelsCache.end())
+				{
+					// No, it isn't but that's okay
+					labelsCache.insert(labelName);
+					updateLabelsCache = true;
+				}
+			}
+
+			// Prepare the reply
+			m_pReply = newDBusReply(m_pRequest);
+			if (m_pReply != NULL)
+			{
+				dbus_message_append_args(m_pReply,
+					DBUS_TYPE_STRING, &pLabel,
+					DBUS_TYPE_INVALID);
+			}
+		}
+	}
 	else if (dbus_message_is_method_call(m_pRequest, "de.berlios.Pinot", "RenameLabel") == TRUE)
 	{
 		char *pOldLabel = NULL;
@@ -680,9 +795,22 @@
 #ifdef DEBUG
 			cout << "DBusServletThread::doWork: received RenameLabel " << pOldLabel << ", " << pNewLabel << endl;
 #endif
-			// Rename the label
-			flushIndex = index.renameLabel(pOldLabel, pNewLabel);
 
+			if ((pOldLabel != NULL) &&
+				(pNewLabel != NULL))
+			{
+				// Rename the label
+				flushIndex = index.renameLabel(pOldLabel, pNewLabel);
+				// Update the labels list
+				set<string>::const_iterator oldLabelIter = labelsCache.find(pOldLabel);
+				if (oldLabelIter != labelsCache.end())
+				{
+					labelsCache.erase(oldLabelIter);
+					labelsCache.insert(pNewLabel);
+					updateLabelsCache = true;
+				}
+			}
+
 			// Prepare the reply
 			m_pReply = newDBusReply(m_pRequest);
 			if (m_pReply != NULL)
@@ -704,8 +832,18 @@
 #ifdef DEBUG
 			cout << "DBusServletThread::doWork: received DeleteLabel " << pLabel << endl;
 #endif
-			// Delete the label
-			flushIndex = index.deleteLabel(pLabel);
+			if (pLabel != NULL)
+			{
+				// Delete the label
+				flushIndex = index.deleteLabel(pLabel);
+				// Update the labels list
+				set<string>::const_iterator labelIter = labelsCache.find(pLabel);
+				if (labelIter != labelsCache.end())
+				{
+					labelsCache.erase(labelIter);
+					updateLabelsCache = true;
+				}
+			}
 
 			// Prepare the reply
 			m_pReply = newDBusReply(m_pRequest);
@@ -783,7 +921,16 @@
 				{
 					break;
 				}
-				labels.insert(ppLabels[labelIndex]);
+
+				string labelName(ppLabels[labelIndex]);
+				labels.insert(labelName);
+				// Is this a known label ?
+				if (labelsCache.find(labelName) == labelsCache.end())
+				{
+					// No, it isn't but that's okay
+					labelsCache.insert(labelName);
+					updateLabelsCache = true;
+				}
 			}
 #ifdef DEBUG
 			cout << "DBusServletThread::doWork: received SetDocumentLabels on ID " << docId
@@ -836,14 +983,27 @@
 				{
 					break;
 				}
-				labels.insert(ppLabels[labelIndex]);
+
+				string labelName(ppLabels[labelIndex]);
+				labels.insert(labelName);
+				// Is this a known label ?
+				if (labelsCache.find(labelName) == labelsCache.end())
+				{
+					// No, it isn't but that's okay
+					labelsCache.insert(labelName);
+					updateLabelsCache = true;
+				}
 			}
 #ifdef DEBUG
 			cout << "DBusServletThread::doWork: received SetDocumentsLabels on " << docIds.size()
 				<< " IDs, " << labelsCount << " labels" << ", " << resetLabels << endl;
 #endif
 			// Set labels
-			flushIndex = index.setDocumentsLabels(docIds, labels, ((resetLabels == TRUE) ? true : false));
+			if (index.setDocumentsLabels(docIds, labels, ((resetLabels == TRUE) ? true : false)) == true)
+			{
+				resetLabels = TRUE;
+				flushIndex = true;
+			}
 
 			// Free container types
 			g_strfreev(ppDocIds);
@@ -854,7 +1014,7 @@
 			if (m_pReply != NULL)
 			{
 				dbus_message_append_args(m_pReply,
-					DBUS_TYPE_BOOLEAN, &flushIndex,
+					DBUS_TYPE_BOOLEAN, &resetLabels,
 					DBUS_TYPE_INVALID);
 			}
 		}
@@ -987,50 +1147,6 @@
 			}
 		}
 	}
-	else if (dbus_message_is_method_call(m_pRequest, "de.berlios.Pinot", "Reload") == TRUE)
-	{
-		if (dbus_message_get_args(m_pRequest, &error,
-			DBUS_TYPE_INVALID) == TRUE)
-		{
-			gboolean reloading = TRUE;
-
-#ifdef DEBUG
-			cout << "DBusServletThread::doWork: received Reload" << endl;
-#endif
-			m_pServer->reload();
-
-			// Prepare the reply
-			m_pReply = newDBusReply(m_pRequest);
-			if (m_pReply != NULL)
-			{
-				dbus_message_append_args(m_pReply,
-					DBUS_TYPE_BOOLEAN, &reloading,
-					DBUS_TYPE_INVALID);
-			}
-		}
-	}
-	else if (dbus_message_is_method_call(m_pRequest, "de.berlios.Pinot", "Stop") == TRUE)
-	{
-		if (dbus_message_get_args(m_pRequest, &error,
-			DBUS_TYPE_INVALID) == TRUE)
-		{
-			int exitStatus = EXIT_SUCCESS;
-
-#ifdef DEBUG
-			cout << "DBusServletThread::doWork: received Stop" << endl;
-#endif
-			// Prepare the reply
-			m_pReply = newDBusReply(m_pRequest);
-			if (m_pReply != NULL)
-			{
-				dbus_message_append_args(m_pReply,
-					DBUS_TYPE_INT32, &exitStatus,
-					DBUS_TYPE_INVALID);
-			}
-
-			m_mustQuit = true;
-		}
-	}
 	else if (dbus_message_is_method_call(m_pRequest, "de.berlios.Pinot", "UpdateDocument") == TRUE)
 	{
 		unsigned int docId = 0;
@@ -1100,6 +1216,14 @@
 
 	dbus_error_free(&error);
 
+	// Set labels ?
+	if ((updateLabelsCache == true) &&
+		(index.setLabels(labelsCache) == false))
+	{
+		// Updating failed... reset the cache
+		labelsCache.clear();
+		index.getLabels(labelsCache);
+	}
 	if (flushIndex == true)
 	{
 		// Flush now for the sake of the client application

Modified: trunk/UI/GTK2/src/WorkerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.cpp	2007-10-02 14:30:42 UTC (rev 1002)
+++ trunk/UI/GTK2/src/WorkerThreads.cpp	2007-10-02 14:40:00 UTC (rev 1003)
@@ -1126,10 +1126,12 @@
 	delete pEngine;
 }
 
-LabelUpdateThread::LabelUpdateThread(const set<string> &labelsToDelete,
-	const map<string, string> &labelsToRename) :
+LabelUpdateThread::LabelUpdateThread(const set<string> &labelsToAdd,
+	const set<string> &labelsToDelete, const map<string, string> &labelsToRename) :
 	WorkerThread()
 {
+	copy(labelsToAdd.begin(), labelsToAdd.end(),
+		inserter(m_labelsToAdd, m_labelsToAdd.begin()));
 	copy(labelsToDelete.begin(), labelsToDelete.end(),
 		inserter(m_labelsToDelete, m_labelsToDelete.begin()));
 	copy(labelsToRename.begin(), labelsToRename.end(),
@@ -1190,6 +1192,12 @@
 			pDaemonIndex->setDocumentsLabels(m_daemonIds, labels, false);
 		}
 	}
+	// Add labels
+	for (set<string>::iterator iter = m_labelsToAdd.begin(); iter != m_labelsToAdd.end(); ++iter)
+	{
+		pDocsIndex->addLabel(*iter);
+		pDaemonIndex->addLabel(*iter);
+	}
 	// Delete labels
 	for (set<string>::iterator iter = m_labelsToDelete.begin(); iter != m_labelsToDelete.end(); ++iter)
 	{
@@ -1774,12 +1782,9 @@
 
 void StartDaemonThread::doWork(void)
 {
-	if (m_done == false)
-        {
-		// Ask the daemon to reload its configuration
-		// Let D-Bus activate the service if necessary
-		DBusXapianIndex::reload();
-	}
+	// Ask the daemon to reload its configuration
+	// Let D-Bus activate the service if necessary
+	DBusXapianIndex::reload();
 }
 
 MonitorThread::MonitorThread(MonitorInterface *pMonitor, MonitorHandler *pHandler,

Modified: trunk/UI/GTK2/src/WorkerThreads.h
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.h	2007-10-02 14:30:42 UTC (rev 1002)
+++ trunk/UI/GTK2/src/WorkerThreads.h	2007-10-02 14:40:00 UTC (rev 1003)
@@ -311,7 +311,8 @@
 class LabelUpdateThread : public WorkerThread
 {
 	public:
-		LabelUpdateThread(const std::set<std::string> &labelsToDelete,
+		LabelUpdateThread(const std::set<std::string> &labelsToAdd,
+			const std::set<std::string> &labelsToDelete,
 			const std::map<std::string, std::string> &labelsToRename);
 		LabelUpdateThread(const std::string &labelName,
 			const std::set<unsigned int> &docsIds,
@@ -322,6 +323,7 @@
 		virtual std::string getType(void) const;
 
 	protected:
+		std::set<std::string> m_labelsToAdd;
 		std::set<std::string> m_labelsToDelete;
 		std::map<std::string, std::string> m_labelsToRename;
 		std::string m_labelName;

Modified: trunk/UI/GTK2/src/importDialog.cc
===================================================================
--- trunk/UI/GTK2/src/importDialog.cc	2007-10-02 14:30:42 UTC (rev 1002)
+++ trunk/UI/GTK2/src/importDialog.cc	2007-10-02 14:40:00 UTC (rev 1003)
@@ -88,7 +88,7 @@
 	labelNameCombobox->set_active(0);
 
 	// Add all labels
-	const set<string> &labels = PinotSettings::getInstance().getLabels();
+	set<string> &labels = PinotSettings::getInstance().m_labels;
 	for (set<string>::const_iterator labelIter = labels.begin();
 		labelIter != labels.end(); ++labelIter)
 	{

Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2007-10-02 14:30:42 UTC (rev 1002)
+++ trunk/UI/GTK2/src/mainWindow.cc	2007-10-02 14:40:00 UTC (rev 1003)
@@ -1724,13 +1724,15 @@
 		start_thread(new StartDaemonThread());
 	}
 
-	// Any labels to delete or rename ?
+	// Any labels to add, delete or rename ?
+	const set<string> &labelsToAdd = prefsBox.getLabelsToAdd();
 	const set<string> &labelsToDelete = prefsBox.getLabelsToDelete();
 	const std::map<string, string> &labelsToRename = prefsBox.getLabelsToRename();
-	if ((labelsToDelete.empty() == false) ||
+	if ((labelsToAdd.empty() == false) ||
+		(labelsToDelete.empty() == false) ||
 		(labelsToRename.empty() == false))
 	{
-		start_thread(new LabelUpdateThread(labelsToDelete, labelsToRename));
+		start_thread(new LabelUpdateThread(labelsToAdd, labelsToDelete, labelsToRename));
 	}
 }
 

Modified: trunk/UI/GTK2/src/pinot-dbus-daemon.cc
===================================================================
--- trunk/UI/GTK2/src/pinot-dbus-daemon.cc	2007-10-02 14:30:42 UTC (rev 1002)
+++ trunk/UI/GTK2/src/pinot-dbus-daemon.cc	2007-10-02 14:40:00 UTC (rev 1003)
@@ -61,6 +61,7 @@
 	{"fullscan", 1, 0, 'f'},
 	{"help", 0, 0, 'h'},
 	{"priority", 1, 0, 'p'},
+	{"reindex", 0, 0, 'r'},
 	{"version", 0, 0, 'v'},
 	{0, 0, 0, 0}
 };
@@ -166,35 +167,18 @@
 	return DBUS_HANDLER_RESULT_HANDLED;
 }
 
-static void checkIndexVersion(const string &indexName, bool &overwriteIndex, bool &upgradeIndex)
-{
-	// What version is the index at ?
-	XapianIndex index(indexName);
-	string indexVersion(index.getVersion());
-
-	// Is an upgrade necessary ?
-	if ((indexVersion < PINOT_INDEX_MIN_VERSION) &&
-		(index.getDocumentsCount() > 0))
-	{
-		cout << "Upgrading index from version " << indexVersion << " to " << VERSION << endl;
-
-		// Yes, it is
-		overwriteIndex = upgradeIndex = true;
-	}
-	index.setVersion(VERSION);
-}
-
 int main(int argc, char **argv)
 {
 	string prefixDir(PREFIX);
 	struct sigaction newAction;
 	int longOptionIndex = 0, priority = 15;
-	bool overwriteIndex = false;
-	bool upgradeIndex = false;
+	bool resetHistory = false;
+	bool resetLabels = false;
 	bool fullScan = false;
+	bool reindex = false;
 
 	// Look at the options
-	int optionChar = getopt_long(argc, argv, "fhp:v", g_longOptions, &longOptionIndex);
+	int optionChar = getopt_long(argc, argv, "fhp:rv", g_longOptions, &longOptionIndex);
 	while (optionChar != -1)
 	{
 		switch (optionChar)
@@ -210,6 +194,7 @@
 					<< "  -f, --fullscan	force a full scan\n"
 					<< "  -h, --help		display this help and exit\n"
 					<< "  -p, --priority	set the daemon's priority (default 15)\n"
+					<< "  -r, --reindex		force a reindex\n"
 					<< "  -v, --version		output version information and exit\n"
 					<< "\nReport bugs to " << PACKAGE_BUGREPORT << endl;
 				return EXIT_SUCCESS;
@@ -224,6 +209,9 @@
 					}
 				}
 				break;
+			case 'r':
+				reindex = true;
+				break;
 			case 'v':
 				cout << "pinot-dbus-daemon - " << PACKAGE_STRING << "\n\n" 
 					<< "This is free software.  You may redistribute copies of it under the terms of\n"
@@ -235,7 +223,7 @@
 		}
 
 		// Next option
-		optionChar = getopt_long(argc, argv, "fhp:v", g_longOptions, &longOptionIndex);
+		optionChar = getopt_long(argc, argv, "fhp:rv", g_longOptions, &longOptionIndex);
 	}
 
 #if defined(ENABLE_NLS)
@@ -362,7 +350,10 @@
 		cerr << "Couldn't open index " << settings.m_daemonIndexLocation << endl;
 		return EXIT_FAILURE;
 	}
-	upgradeIndex = pDb->wasObsoleteFormat();
+	if (pDb->wasObsoleteFormat() == true)
+	{
+		resetHistory = resetLabels = true;
+	}
 
 	// Do the same for the history database
 	PinotSettings::checkHistoryDatabase();
@@ -400,9 +391,6 @@
 	else cout << "Set priority to " << priority << endl;
 #endif
 
-	// What version of the daemon is this ?
-	checkIndexVersion(settings.m_daemonIndexLocation, overwriteIndex, upgradeIndex);
-
 	GError *pError = NULL;
 	DBusGConnection *pBus = dbus_g_bus_get(DBUS_BUS_SESSION, &pError);
 	if (pBus == NULL)
@@ -456,23 +444,39 @@
 
 		try
 		{
-			server.getQuitSignal().connect(SigC::slot(&quitAll));
+			XapianIndex index(settings.m_daemonIndexLocation);
+			set<string> labels;
+			string indexVersion(index.getVersion());
+			bool gotLabels = index.getLabels(labels);
 
-			// Connect to threads' finished signal
-			server.connect();
+			// What version is the index at ?
+			if (indexVersion < PINOT_INDEX_MIN_VERSION)
+			{
+				cout << "Upgrading index from version " << indexVersion << " to " << VERSION << endl;
 
-			if (overwriteIndex == true)
+				reindex = true;
+
+				resetLabels = true;
+			}
+			// Reindex all ?
+			if (reindex == true)
 			{
-				// Close and overwrite the index
-				XapianDatabaseFactory::closeAll();
-				XapianDatabaseFactory::getDatabase(settings.m_daemonIndexLocation, false, true);
+				if (index.getDocumentsCount() > 0)
+				{
+					// Reset the index so that all documents are reindexed
+					index.reset();
+					resetHistory = true;
+				}
 			}
+			index.setVersion(VERSION);
 
-			if (upgradeIndex == true)
+			if (resetHistory == true)
 			{
 				CrawlHistory history(historyDatabase);
 				map<unsigned int, string> sources;
 
+				cout << "Resetting history" << endl;
+
 				// Reset the history
 				history.getSources(sources);
 				for (std::map<unsigned int, string>::iterator sourceIter = sources.begin();
@@ -483,6 +487,29 @@
 				}
 			}
 
+			if (resetLabels == true)
+			{
+				// Re-apply the labels list
+				if (gotLabels == false)
+				{
+					// If this is an upgrade from a version < 0.80, the labels list
+					// needs to be pulled from the configuration file
+					index.setLabels(settings.m_labels);
+
+					cout << "Resetting labels as per the configuration file" << endl;
+				}
+				else
+				{
+					index.setLabels(labels);
+				}
+			}
+
+			// Connect to the quit signal
+			server.getQuitSignal().connect(SigC::slot(&quitAll));
+
+			// Connect to threads' finished signal
+			server.connect();
+
 			server.start(fullScan);
 
 			// Run the main loop

Modified: trunk/UI/GTK2/src/pinot-dbus-daemon.xml
===================================================================
--- trunk/UI/GTK2/src/pinot-dbus-daemon.xml	2007-10-02 14:30:42 UTC (rev 1002)
+++ trunk/UI/GTK2/src/pinot-dbus-daemon.xml	2007-10-02 14:40:00 UTC (rev 1003)
@@ -15,9 +15,44 @@
       <arg type="u" name="docsCount" direction="out"/>
     </method>
     <!--
+	Instructs the daemon program to reload the configuration file.
+	 loadStatus: TRUE if the configuration is being reloaded
+	-->
+    <method name="Reload">
+      <annotation name="de.berlios.Pinot.Reload" value="pinotDBus"/>
+      <arg type="b" name="reloading" direction="out" />
+    </method>
+    <!--
+	Stops the daemon program.
+	 exitStatus: the daemon's exit status.
+	-->
+    <method name="Stop">
+      <annotation name="de.berlios.Pinot.Stop" value="pinotDBus"/>
+      <arg type="i" name="exitStatus" direction="out" />
+    </method>
+    <!--
+	Gets the list of known labels.
+	 labels: array of labels
+	-->
+    <method name="GetLabels">
+      <annotation name="de.berlios.Pinot.GetLabels" value="pinotDBus"/>
+      <arg type="as" name="labels" direction="out"/>
+    </method>
+    <!--
+	Adds a label.
+	 label: the name of the new label
+        This method shouldn't be used by applications other than Pinot.
+	-->
+    <method name="AddLabel">
+      <annotation name="de.berlios.Pinot.AddLabel" value="pinotDBus"/>
+      <arg type="s" name="label" direction="in"/>
+      <arg type="s" name="label" direction="out"/>
+    </method>
+    <!--
 	Renames a label.
 	 oldLabel: the label to rename
 	 newLabel: the new label name
+        This method shouldn't be used by applications other than Pinot.
 	-->
     <method name="RenameLabel">
       <annotation name="de.berlios.Pinot.RenameLabel" value="pinotDBus"/>
@@ -28,6 +63,7 @@
     <!--
 	Deletes a label.
 	 label: the name of the label to delete
+        This method shouldn't be used by applications other than Pinot.
 	-->
     <method name="DeleteLabel">
       <annotation name="de.berlios.Pinot.DeleteLabel" value="pinotDBus"/>
@@ -45,14 +81,6 @@
       <arg type="as" name="labels" direction="out"/>
     </method>
     <!--
-	Instructs the daemon program to reload the configuration file.
-	 loadStatus: TRUE if the configuration is being reloaded
-	-->
-    <method name="Reload">
-      <annotation name="de.berlios.Pinot.Reload" value="pinotDBus"/>
-      <arg type="b" name="reloading" direction="out" />
-    </method>
-    <!--
 	Sets a document's labels.
 	 docId: the document's ID
 	 labels: array of labels to apply to the document
@@ -66,7 +94,7 @@
       <arg type="u" name="docId" direction="out"/>
     </method>
     <!--
-	Sets a group of documents' labels.
+	Sets labels on a group of documents.
 	 docIds: array of document IDs
 	 labels: array of labels to apply to the documents
 	 resetLabels: TRUE if existing labels should be unset
@@ -115,14 +143,6 @@
       <arg type="as" name="docIds" direction="out" />
     </method>
     <!--
-	Stops the daemon program.
-	 exitStatus: the daemon's exit status.
-	-->
-    <method name="Stop">
-      <annotation name="de.berlios.Pinot.Stop" value="pinotDBus"/>
-      <arg type="i" name="exitStatus" direction="out" />
-    </method>
-    <!--
 	Updates a document.
 	 docId: the document's ID
 	-->

Modified: trunk/UI/GTK2/src/pinot.cc
===================================================================
--- trunk/UI/GTK2/src/pinot.cc	2007-10-02 14:30:42 UTC (rev 1002)
+++ trunk/UI/GTK2/src/pinot.cc	2007-10-02 14:40:00 UTC (rev 1003)
@@ -106,29 +106,13 @@
 	Gtk::Main::quit();
 }
 
-static void checkIndexVersion(const string &indexName, bool &upgradeIndex)
-{
-	// What version is the index at ?
-	XapianIndex index(indexName);
-	string indexVersion(index.getVersion());
-
-	// Is an upgrade necessary ?
-	if ((indexVersion < PINOT_INDEX_MIN_VERSION) &&
-		(index.getDocumentsCount() > 0))
-	{
-		// Yes, it is
-		upgradeIndex = true;
-	}
-	index.setVersion(VERSION);
-}
-
 int main(int argc, char **argv)
 {
 	string prefixDir(PREFIX);
 	Glib::ustring errorMsg;
 	struct sigaction newAction;
 	int longOptionIndex = 0;
-	bool upgradeIndex = false;
+	bool warnAboutIndex = false;
 
 	// Look at the options
 	int optionChar = getopt_long(argc, argv, "hv", g_longOptions, &longOptionIndex);
@@ -292,7 +276,7 @@
 	}
 	else
 	{
-		upgradeIndex = pFirstDb->wasObsoleteFormat();
+		warnAboutIndex = pFirstDb->wasObsoleteFormat();
 	}
 	// ...and the daemon index in read-only mode
 	// If it can't be open, it just means the daemon has not yet created it
@@ -327,12 +311,22 @@
 
 	atexit(closeAll);
 
-	// What version of the UI is this ?
-	checkIndexVersion(settings.m_docsIndexLocation, upgradeIndex);
+	XapianIndex index(settings.m_docsIndexLocation);
+	string indexVersion(index.getVersion());
 
-	if ((upgradeIndex == true) &&
+	// What version is the index at ?
+	// Is an upgrade necessary ?
+	if ((indexVersion < PINOT_INDEX_MIN_VERSION) &&
+		(index.getDocumentsCount() > 0))
+	{
+		warnAboutIndex = true;
+	}
+	index.setVersion(VERSION);
+
+	if ((warnAboutIndex == true) &&
 		(errorMsg.empty() == true))
 	{
+		// Warn the user
 		errorMsg = _("Updating all documents in My Web Pages is recommended");
 	}
 

Modified: trunk/UI/GTK2/src/propertiesDialog.cc
===================================================================
--- trunk/UI/GTK2/src/propertiesDialog.cc	2007-10-02 14:30:42 UTC (rev 1002)
+++ trunk/UI/GTK2/src/propertiesDialog.cc	2007-10-02 14:40:00 UTC (rev 1003)
@@ -153,7 +153,7 @@
 	TreeModel::Row row;
 
 	// Populate the tree
-	const set<string> &sysLabels = PinotSettings::getInstance().getLabels();
+	set<string> &sysLabels = PinotSettings::getInstance().m_labels;
 	for (set<string>::const_iterator labelIter = sysLabels.begin(); labelIter != sysLabels.end(); ++labelIter)
 	{
 		string labelName(*labelIter);

Modified: trunk/UI/GTK2/src/queryDialog.cc
===================================================================
--- trunk/UI/GTK2/src/queryDialog.cc	2007-10-02 14:30:42 UTC (rev 1002)
+++ trunk/UI/GTK2/src/queryDialog.cc	2007-10-02 14:40:00 UTC (rev 1003)
@@ -36,7 +36,6 @@
 	queryDialog_glade(),
 	m_name(properties.getName()),
 	m_properties(properties),
-	m_labels(PinotSettings::getInstance().getLabels()),
 	m_badName(true)
 {
 	unsigned int day, month, year;
@@ -126,7 +125,8 @@
 	labelNameCombobox->append_text(_("None"));
 	labelNameCombobox->set_active(0);
 	// Add all labels to the label combo and select the one defined for the query
-	for (set<string>::const_iterator labelIter = m_labels.begin(); labelIter != m_labels.end(); ++labelIter)
+	set<string> &labels = PinotSettings::getInstance().m_labels;
+	for (set<string>::const_iterator labelIter = labels.begin(); labelIter != labels.end(); ++labelIter)
 	{
 		string labelName(*labelIter);
 

Modified: trunk/UI/GTK2/src/queryDialog.hh
===================================================================
--- trunk/UI/GTK2/src/queryDialog.hh	2007-10-02 14:30:42 UTC (rev 1002)
+++ trunk/UI/GTK2/src/queryDialog.hh	2007-10-02 14:40:00 UTC (rev 1003)
@@ -20,7 +20,6 @@
 #define _QUERYDIALOG_HH
 
 #include <string>
-#include <set>
 #include <glibmm/date.h>
 #include <glibmm/ustring.h>
 
@@ -39,7 +38,6 @@
 protected:
 	Glib::ustring m_name;
 	QueryProperties& m_properties;
-	const std::set<std::string> &m_labels;
 	Glib::Date m_fromDate;
 	Glib::Date m_toDate;
 	bool m_badName;



From fabricecolin at mail.berlios.de  Tue Oct  2 17:35:02 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 2 Oct 2007 17:35:02 +0200
Subject: [Pinot-svn] r1004 - trunk/UI/GTK2/src
Message-ID: <200710021535.l92FZ2h5014491@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-02 17:35:01 +0200 (Tue, 02 Oct 2007)
New Revision: 1004

Modified:
   trunk/UI/GTK2/src/pinot-dbus-daemon.cc
Log:
Reset everything when --reindex is passed, or when upgrading from an older
version.


Modified: trunk/UI/GTK2/src/pinot-dbus-daemon.cc
===================================================================
--- trunk/UI/GTK2/src/pinot-dbus-daemon.cc	2007-10-02 14:40:00 UTC (rev 1003)
+++ trunk/UI/GTK2/src/pinot-dbus-daemon.cc	2007-10-02 15:35:01 UTC (rev 1004)
@@ -455,18 +455,15 @@
 				cout << "Upgrading index from version " << indexVersion << " to " << VERSION << endl;
 
 				reindex = true;
-
-				resetLabels = true;
 			}
-			// Reindex all ?
 			if (reindex == true)
 			{
-				if (index.getDocumentsCount() > 0)
-				{
-					// Reset the index so that all documents are reindexed
-					index.reset();
-					resetHistory = true;
-				}
+				// Reset the index so that all documents are reindexed
+				index.reset();
+
+				cout << "Reset index" << endl;
+
+				resetHistory = resetLabels = true;
 			}
 			index.setVersion(VERSION);
 
@@ -475,8 +472,6 @@
 				CrawlHistory history(historyDatabase);
 				map<unsigned int, string> sources;
 
-				cout << "Resetting history" << endl;
-
 				// Reset the history
 				history.getSources(sources);
 				for (std::map<unsigned int, string>::iterator sourceIter = sources.begin();
@@ -485,6 +480,8 @@
 					history.deleteItems(sourceIter->first);
 					history.deleteSource(sourceIter->first);
 				}
+
+				cout << "Reset crawler history" << endl;
 			}
 
 			if (resetLabels == true)
@@ -496,7 +493,7 @@
 					// needs to be pulled from the configuration file
 					index.setLabels(settings.m_labels);
 
-					cout << "Resetting labels as per the configuration file" << endl;
+					cout << "Set labels as per the configuration file" << endl;
 				}
 				else
 				{



From fabricecolin at mail.berlios.de  Wed Oct  3 15:53:52 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Wed, 3 Oct 2007 15:53:52 +0200
Subject: [Pinot-svn] r1005 - trunk/UI/GTK2/src
Message-ID: <200710031353.l93DrqMH024838@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-03 15:53:49 +0200 (Wed, 03 Oct 2007)
New Revision: 1005

Modified:
   trunk/UI/GTK2/src/ServerThreads.cpp
   trunk/UI/GTK2/src/prefsDialog.cc
Log:
prefsDialog might not find labels in the index if the daemon hasn't had a
chance to upgrade it, in which case it should get them from the configuration
file.
More DEBUG in ServerThreads.


Modified: trunk/UI/GTK2/src/ServerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/ServerThreads.cpp	2007-10-02 15:35:01 UTC (rev 1004)
+++ trunk/UI/GTK2/src/ServerThreads.cpp	2007-10-03 13:53:49 UTC (rev 1005)
@@ -1223,6 +1223,9 @@
 		// Updating failed... reset the cache
 		labelsCache.clear();
 		index.getLabels(labelsCache);
+#ifdef DEBUG
+		cout << "DBusServletThread::doWork: failed to update labels" << endl;
+#endif
 	}
 	if (flushIndex == true)
 	{

Modified: trunk/UI/GTK2/src/prefsDialog.cc
===================================================================
--- trunk/UI/GTK2/src/prefsDialog.cc	2007-10-02 15:35:01 UTC (rev 1004)
+++ trunk/UI/GTK2/src/prefsDialog.cc	2007-10-03 13:53:49 UTC (rev 1005)
@@ -18,6 +18,7 @@
 
 #include <stdlib.h>
 #include <iostream>
+#include <algorithm>
 #include <glibmm/convert.h>
 #include <gdkmm/color.h>
 #include <gtkmm/colorselection.h>
@@ -165,9 +166,21 @@
 	IndexInterface *pDaemonIndex = m_settings.getIndex(m_settings.m_daemonIndexLocation);
 	if (pDaemonIndex != NULL)
 	{
-		labels.clear();
-		pDaemonIndex->getLabels(labels);
+		set<string> indexLabels;
 
+		// Nothing might be found if we are upgrading from an older version
+		// and the daemon has not been run
+		if (pDaemonIndex->getLabels(indexLabels) == true)
+		{
+			labels.clear();
+
+			copy(indexLabels.begin(), indexLabels.end(),
+				inserter(labels, labels.begin()));
+		}
+#ifdef DEBUG
+		else cout << "prefsDialog::populate_labelsTreeview: relying on configuration file" << endl;
+#endif
+
 		delete pDaemonIndex;
 	}
 



From fabricecolin at mail.berlios.de  Wed Oct  3 15:56:38 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Wed, 3 Oct 2007 15:56:38 +0200
Subject: [Pinot-svn] r1006 - trunk/Utils
Message-ID: <200710031356.l93DuclJ025230@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-03 15:56:38 +0200 (Wed, 03 Oct 2007)
New Revision: 1006

Modified:
   trunk/Utils/MIMEScanner.cpp
Log:
Don't attempt loading anything if initialize() wasn't provided paths.


Modified: trunk/Utils/MIMEScanner.cpp
===================================================================
--- trunk/Utils/MIMEScanner.cpp	2007-10-03 13:53:49 UTC (rev 1005)
+++ trunk/Utils/MIMEScanner.cpp	2007-10-03 13:56:38 UTC (rev 1006)
@@ -389,7 +389,8 @@
 	}
 
 	// Load user-specific settings first
-	if (userDirectory.empty() == false)
+	if ((userPrefix.empty() == false) &&
+		(userDirectory.empty() == false))
 	{
 		// Add the user's directory to the paths list
 		desktopFilesPaths.push_front(userDirectory);
@@ -404,7 +405,8 @@
 	}
 
 	// Then load system-wide settings
-	if (systemDirectory.empty() == false)
+	if ((systemPrefix.empty() == false) &&
+		(systemDirectory.empty() == false))
 	{
 		// Make sure only the system directory is in the list
 		desktopFilesPaths.clear();



From fabricecolin at mail.berlios.de  Thu Oct  4 14:50:50 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Thu, 4 Oct 2007 14:50:50 +0200
Subject: [Pinot-svn] r1007 - trunk/UI/GTK2/src
Message-ID: <200710041250.l94Coonl020045@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-04 14:50:50 +0200 (Thu, 04 Oct 2007)
New Revision: 1007

Modified:
   trunk/UI/GTK2/src/OnDiskHandler.cpp
   trunk/UI/GTK2/src/ServerThreads.cpp
Log:
Prefix the source label with "X-". Send reply over D-Bus before flushing the
index.


Modified: trunk/UI/GTK2/src/OnDiskHandler.cpp
===================================================================
--- trunk/UI/GTK2/src/OnDiskHandler.cpp	2007-10-03 13:56:38 UTC (rev 1006)
+++ trunk/UI/GTK2/src/OnDiskHandler.cpp	2007-10-04 12:50:50 UTC (rev 1007)
@@ -203,7 +203,7 @@
 			char sourceStr[64];
 
 			// That's the one
-			snprintf(sourceStr, 64, "SOURCE%u", sourceIter->first);
+			snprintf(sourceStr, 64, "X-SOURCE%u", sourceIter->first);
 			labels.insert(sourceStr);
 			break;
 		}
@@ -290,7 +290,7 @@
 			{
 				char sourceStr[64];
 
-				snprintf(sourceStr, 64, "SOURCE%u", sourceId);
+				snprintf(sourceStr, 64, "X-SOURCE%u", sourceId);
 
 #ifdef DEBUG
 				cout << "OnDiskHandler::initialize: " << sourceIter->second

Modified: trunk/UI/GTK2/src/ServerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/ServerThreads.cpp	2007-10-03 13:56:38 UTC (rev 1006)
+++ trunk/UI/GTK2/src/ServerThreads.cpp	2007-10-04 12:50:50 UTC (rev 1007)
@@ -176,8 +176,8 @@
 bool DirectoryScannerThread::stop(void)
 {
 	// Disconnect the signal
-	Signal3<void, const DocumentInfo&, const std::string&, bool>::slot_list_type slotsList = m_signalFileFound.slots();
-	Signal3<void, const DocumentInfo&, const std::string&, bool>::slot_list_type::iterator slotIter = slotsList.begin();
+	Signal3<void, const DocumentInfo&, const string&, bool>::slot_list_type slotsList = m_signalFileFound.slots();
+	Signal3<void, const DocumentInfo&, const string&, bool>::slot_list_type::iterator slotIter = slotsList.begin();
 	if (slotIter != slotsList.end())
 	{
 		if (slotIter->empty() == false)
@@ -191,7 +191,7 @@
 	return true;
 }
 
-Signal3<void, const DocumentInfo&, const std::string&, bool>& DirectoryScannerThread::getFileFoundSignal(void)
+Signal3<void, const DocumentInfo&, const string&, bool>& DirectoryScannerThread::getFileFoundSignal(void)
 {
 	return m_signalFileFound;
 }
@@ -229,8 +229,7 @@
 	}
 
 	// This identifies the source
-	snprintf(labelStr, 64, "SOURCE%u", m_sourceId);
-
+	snprintf(labelStr, 64, "X-SOURCE%u", m_sourceId);
 	m_signalFileFound(docInfo, labelStr, false);
 }
 
@@ -1227,11 +1226,6 @@
 		cout << "DBusServletThread::doWork: failed to update labels" << endl;
 #endif
 	}
-	if (flushIndex == true)
-	{
-		// Flush now for the sake of the client application
-		index.flush();
-	}
 
 	// Send a reply ?
 	if ((m_pConnection != NULL) &&
@@ -1244,5 +1238,12 @@
 #endif
 		dbus_message_unref(m_pReply);
 	}
+
+	// Flush the index ?
+	if (flushIndex == true)
+	{
+		// Flush now for the sake of the client application
+		index.flush();
+	}
 }
 



From fabricecolin at mail.berlios.de  Thu Oct  4 14:52:42 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Thu, 4 Oct 2007 14:52:42 +0200
Subject: [Pinot-svn] r1008 - trunk/Index
Message-ID: <200710041252.l94CqgP1020194@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-04 14:52:42 +0200 (Thu, 04 Oct 2007)
New Revision: 1008

Modified:
   trunk/Index/DBusXapianIndex.cpp
   trunk/Index/DBusXapianIndex.h
   trunk/Index/IndexInterface.h
Log:
Overloaded getDocumentLabels(). Fixed typo in interface header file.


Modified: trunk/Index/DBusXapianIndex.cpp
===================================================================
--- trunk/Index/DBusXapianIndex.cpp	2007-10-04 12:50:50 UTC (rev 1007)
+++ trunk/Index/DBusXapianIndex.cpp	2007-10-04 12:52:42 UTC (rev 1008)
@@ -575,6 +575,65 @@
 	return XapianIndex::getDocumentLabels(docId, labels);
 }
 
+/// Returns a document's labels.
+bool DBusXapianIndex::getDocumentLabels(unsigned int docId, set<string> &labels, bool forceDBus) const
+{
+	bool gotLabels = false;
+
+	if (forceDBus == false)
+	{
+		// Call overload
+		return getDocumentLabels(docId, labels);
+	}
+
+	DBusGConnection *pBus = getBusConnection();
+	if (pBus == NULL)
+	{
+		return false;
+	}
+
+	DBusGProxy *pBusProxy = getBusProxy(pBus);
+	if (pBusProxy == NULL)
+	{
+		cerr << "DBusXapianIndex::getDocumentLabels: couldn't get bus proxy" << endl;
+		return false;
+	}
+
+	GError *pError = NULL;
+	char **pLabels;
+
+	// G_TYPE_STRV is the GLib equivalent of DBUS_TYPE_ARRAY, DBUS_TYPE_STRING
+	if (dbus_g_proxy_call(pBusProxy, "GetDocumentLabels", &pError,
+		G_TYPE_UINT, docId,
+		G_TYPE_INVALID,
+		G_TYPE_STRV, &pLabels,
+		G_TYPE_INVALID) == TRUE)
+	{
+		for (char **pLabel = pLabels; (*pLabel) != NULL; ++pLabel)
+		{
+			labels.insert(*pLabel);
+		}
+
+		// Free the array
+		g_strfreev(pLabels);
+
+		gotLabels = true;
+	}
+	else
+	{
+		if (pError != NULL)
+		{
+			cerr << "DBusXapianIndex::getDocumentLabels: " << pError->message << endl;
+			g_error_free(pError);
+		}
+	}
+
+	g_object_unref(pBusProxy);
+	// FIXME: don't we have to call dbus_g_connection_unref(pBus); ?
+
+	return gotLabels;
+}
+
 /// Sets a document's labels.
 bool DBusXapianIndex::setDocumentLabels(unsigned int docId, const set<string> &labels,
 	bool resetLabels)

Modified: trunk/Index/DBusXapianIndex.h
===================================================================
--- trunk/Index/DBusXapianIndex.h	2007-10-04 12:50:50 UTC (rev 1007)
+++ trunk/Index/DBusXapianIndex.h	2007-10-04 12:52:42 UTC (rev 1008)
@@ -85,6 +85,10 @@
 		/// Returns a document's labels.
 		virtual bool getDocumentLabels(unsigned int docId, std::set<std::string> &labels) const;
 
+		/// Returns a document's labels.
+		bool getDocumentLabels(unsigned int docId, std::set<std::string> &labels,
+			bool forceDBus) const;
+
 		/// Sets a document's labels.
 		virtual bool setDocumentLabels(unsigned int docId, const std::set<std::string> &labels,
 			bool resetLabels = true);

Modified: trunk/Index/IndexInterface.h
===================================================================
--- trunk/Index/IndexInterface.h	2007-10-04 12:50:50 UTC (rev 1007)
+++ trunk/Index/IndexInterface.h	2007-10-04 12:52:42 UTC (rev 1008)
@@ -74,11 +74,11 @@
 
 		/// Sets a document's labels.
 		virtual bool setDocumentLabels(unsigned int docId, const std::set<std::string> &labels,
-			bool readdLabel = true) = 0;
+			bool resetLabels = true) = 0;
 
 		/// Sets documents' labels.
 		virtual bool setDocumentsLabels(const std::set<unsigned int> &docIds,
-			const std::set<std::string> &labels, bool readdLabel = true) = 0;
+			const std::set<std::string> &labels, bool resetLabels = true) = 0;
 
 		/// Checks whether the given URL is in the index.
 		virtual unsigned int hasDocument(const std::string &url) const = 0;



From fabricecolin at mail.berlios.de  Thu Oct  4 14:56:11 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Thu, 4 Oct 2007 14:56:11 +0200
Subject: [Pinot-svn] r1009 - trunk/Search/Plugins
Message-ID: <200710041256.l94CuBB0020491@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-04 14:56:11 +0200 (Thu, 04 Oct 2007)
New Revision: 1009

Added:
   trunk/Search/Plugins/Yahoo.src
Removed:
   trunk/Search/Plugins/Yahoo.src
   trunk/Search/Plugins/YahooAPI.src
Log:
Renamed YahooAPI plugin to Yahoo.


Deleted: trunk/Search/Plugins/Yahoo.src
===================================================================
--- trunk/Search/Plugins/Yahoo.src	2007-10-04 12:52:42 UTC (rev 1008)
+++ trunk/Search/Plugins/Yahoo.src	2007-10-04 12:56:11 UTC (rev 1009)
@@ -1,23 +0,0 @@
-# Yahoo! Search Plugin
-
-<SEARCH
-	version="1.0"
-	name="Yahoo!"
-	description="Yahoo.com"
-	method="GET"
-	action="http://search.yahoo.com/search"
-	routeType="The Web"
->
-
-<INPUT NAME="p" USER>
-<INPUT NAME="ei" VALUE="UTF-8">
-<INPUTNEXT NAME="b" FACTOR="10" VALUE="1">
-
-<INTERPRET
-resultListStart=""
-resultListEnd=""
-resultItemStart="<li><div>"
-resultItemEnd="</em> "
->
-
-</SEARCH>

Copied: trunk/Search/Plugins/Yahoo.src (from rev 1003, trunk/Search/Plugins/YahooAPI.src)
===================================================================
--- trunk/Search/Plugins/YahooAPI.src	2007-10-02 14:40:00 UTC (rev 1003)
+++ trunk/Search/Plugins/Yahoo.src	2007-10-04 12:56:11 UTC (rev 1009)
@@ -0,0 +1,33 @@
+# Yahoo! REST API Search Plugin
+
+<SEARCH
+	version="1.0"
+	name="Yahoo!"
+	description="Yahoo! REST API"
+	method="GET"
+	action="http://api.search.yahoo.com/WebSearchService/V1/webSearch"
+	routeType="The Web"
+>
+
+# Edit this field's value to set to your application ID
+<INPUT NAME="appid" VALUE="YahooDemo">
+<INPUT NAME="query" USER>
+<INPUT NAME="results" VALUE="10">
+
+<INTERPRET
+resultListStart="<ResultSet"
+resultListEnd="</ResultSet>"
+resultItemStart="<Result>"
+resultItemEnd="</Result>"
+# The following attributes are specific to Pinot
+resultTitleStart="<Title>"
+resultTitleEnd="</Title>"
+resultLinkStart="<Url>"
+resultLinkEnd="</Url>"
+resultExtractStart="<Summary>"
+resultExtractEnd="</Summary>"
+>
+
+</SEARCH>
+
+

Deleted: trunk/Search/Plugins/YahooAPI.src
===================================================================
--- trunk/Search/Plugins/YahooAPI.src	2007-10-04 12:52:42 UTC (rev 1008)
+++ trunk/Search/Plugins/YahooAPI.src	2007-10-04 12:56:11 UTC (rev 1009)
@@ -1,33 +0,0 @@
-# Yahoo! REST API Search Plugin
-
-<SEARCH
-	version="1.0"
-	name="Yahoo! API"
-	description="Yahoo! REST API"
-	method="GET"
-	action="http://api.search.yahoo.com/WebSearchService/V1/webSearch"
-	routeType="The Web"
->
-
-# Edit this field's value to set to your application ID
-<INPUT NAME="appid" VALUE="YahooDemo">
-<INPUT NAME="query" USER>
-<INPUT NAME="results" VALUE="10">
-
-<INTERPRET
-resultListStart="<ResultSet"
-resultListEnd="</ResultSet>"
-resultItemStart="<Result>"
-resultItemEnd="</Result>"
-# The following attributes are specific to Pinot
-resultTitleStart="<Title>"
-resultTitleEnd="</Title>"
-resultLinkStart="<Url>"
-resultLinkEnd="</Url>"
-resultExtractStart="<Summary>"
-resultExtractEnd="</Summary>"
->
-
-</SEARCH>
-
-



From fabricecolin at mail.berlios.de  Thu Oct  4 15:10:02 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Thu, 4 Oct 2007 15:10:02 +0200
Subject: [Pinot-svn] r1010 - trunk/Index
Message-ID: <200710041310.l94DA2vw022048@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-04 15:10:00 +0200 (Thu, 04 Oct 2007)
New Revision: 1010

Modified:
   trunk/Index/XapianIndex.cpp
Log:
Labels prefixed with "X-" are private, internal labels that can only be set when
the document is initially indexed and should be preserved until it's unindexed.


Modified: trunk/Index/XapianIndex.cpp
===================================================================
--- trunk/Index/XapianIndex.cpp	2007-10-04 12:56:11 UTC (rev 1009)
+++ trunk/Index/XapianIndex.cpp	2007-10-04 13:10:00 UTC (rev 1010)
@@ -698,6 +698,10 @@
 		if (pIndex != NULL)
 		{
 			version = pIndex->get_metadata("version");
+			if (version.empty() == true)
+			{
+				version = "0.00";
+			}
 		}
 	}
 	catch (const Xapian::Error &error)
@@ -915,6 +919,11 @@
 	for (set<string>::const_iterator labelIter = labels.begin();
 		labelIter != labels.end(); ++labelIter)
 	{
+		// Prevent from setting internal labels
+		if (labelIter->substr(0, 2) == "X-")
+		{
+			continue;
+		}
 		labelString += "[";
 		labelString += Url::escapeUrl(*labelIter);
 		labelString += "]";
@@ -1012,6 +1021,13 @@
 {
 	bool renamedLabel = false;
 
+	// Prevent from renaming or setting internal labels
+	if ((name.substr(0, 2) == "X-") ||
+		(newName.substr(0, 2) == "X-"))
+	{
+		return false;
+	}
+
 	XapianDatabase *pDatabase = XapianDatabaseFactory::getDatabase(m_databaseName, false);
 	if (pDatabase == NULL)
 	{
@@ -1064,6 +1080,12 @@
 {
 	bool deletedLabel = false;
 
+	// Prevent from deleting internal labels
+	if (name.substr(0, 2) == "X-")
+	{
+		return false;
+	}
+
 	XapianDatabase *pDatabase = XapianDatabaseFactory::getDatabase(m_databaseName, false);
 	if (pDatabase == NULL)
 	{
@@ -1254,10 +1276,13 @@
 					for (termIter.skip_to("XLABEL:");
 						termIter != pIndex->termlist_end(docId); ++termIter)
 					{
-						// Is this a label ?
-						if (strncasecmp((*termIter).c_str(), "XLABEL:", min(7, (int)(*termIter).length())) == 0)
+						string term(*termIter);
+
+						// Is this a non-internal label ?
+						if ((strncasecmp(term.c_str(), "XLABEL:", min(7, (int)term.length())) == 0) &&
+							(strncasecmp(term.c_str(), "XLABEL:X-", min(9, (int)term.length())) != 0))
 						{
-							doc.remove_term(*termIter);
+							doc.remove_term(term);
 						}
 					}
 				}
@@ -1267,7 +1292,9 @@
 			for (set<string>::const_iterator labelIter = labels.begin(); labelIter != labels.end();
 				++labelIter)
 			{
-				if (labelIter->empty() == false)
+				// Prevent from setting internal labels
+				if ((labelIter->empty() == false) &&
+					(labelIter->substr(0, 2) != "X-"))
 				{
 					doc.add_term(string("XLABEL:") + XapianDatabase::limitTermLength(Url::escapeUrl(*labelIter)));
 				}



From fabricecolin at mail.berlios.de  Thu Oct  4 15:15:25 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Thu, 4 Oct 2007 15:15:25 +0200
Subject: [Pinot-svn] r1011 - in trunk: . Index
Message-ID: <200710041315.l94DFP4h022712@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-04 15:15:24 +0200 (Thu, 04 Oct 2007)
New Revision: 1011

Added:
   trunk/Index/pinot-label.1
   trunk/Index/pinot-label.cpp
Modified:
   trunk/Index/Makefile.am
   trunk/Index/pinot-index.cpp
   trunk/Makefile.am
   trunk/README
   trunk/configure.in
   trunk/pinot.spec.in
Log:
New pinot-label tool to manipulate labels on indexed files.
Also increased requirement on Xapian to 1.0.3. This is enforced by configure.


Modified: trunk/Index/Makefile.am
===================================================================
--- trunk/Index/Makefile.am	2007-10-04 13:10:00 UTC (rev 1010)
+++ trunk/Index/Makefile.am	2007-10-04 13:15:24 UTC (rev 1011)
@@ -21,7 +21,7 @@
 	XapianDatabaseFactory.cpp \
 	XapianIndex.cpp
 
-bin_PROGRAMS = pinot-index
+bin_PROGRAMS = pinot-index pinot-label
 
 pinot_index_LDADD = -L../Utils -L../Tokenize -L../Collect \
 	-lIndex -lCollect -lTokenize -lBasicUtils -lUtils \
@@ -32,6 +32,15 @@
 
 pinot_index_DEPENDENCIES = libIndex.la
 
+pinot_label_LDADD = -L../Utils -L../Tokenize \
+	-lIndex -lTokenize -lBasicUtils -lUtils \
+	@GLIBMM_LIBS@ @INDEX_LIBS@ @DBUS_LIBS@ @XML_LIBS@ @GMIME_LIBS@ @MISC_LIBS@
+
+pinot_label_SOURCES = \
+	pinot-label.cpp
+
+pinot_label_DEPENDENCIES = libIndex.la
+
 AM_CXXFLAGS = -I$(srcdir)/../Utils -I$(srcdir)/../Tokenize -I$(srcdir)/../Tokenize/filters \
 	-I$(srcdir)/../Collect @HTTP_CFLAGS@ @GMIME_CFLAGS@ @XML_CFLAGS@ @DBUS_CFLAGS@ @INDEX_CFLAGS@
 

Modified: trunk/Index/pinot-index.cpp
===================================================================
--- trunk/Index/pinot-index.cpp	2007-10-04 13:10:00 UTC (rev 1010)
+++ trunk/Index/pinot-index.cpp	2007-10-04 13:15:24 UTC (rev 1011)
@@ -288,11 +288,11 @@
 		}
 		if (pIndex->getDocumentLabels(docId, labels) == true)
 		{
-			cout << "Labels:";
+			cout << "Labels: ";
 			for (set<string>::const_iterator labelIter = labels.begin();
 				labelIter != labels.end(); ++labelIter)
 			{
-				cout << " '" << *labelIter << "'";
+				cout << "[" << *labelIter << "]";
 			}
 			cout << endl;
 		}

Added: trunk/Index/pinot-label.1
===================================================================
--- trunk/Index/pinot-label.1	2007-10-04 13:10:00 UTC (rev 1010)
+++ trunk/Index/pinot-label.1	2007-10-04 13:15:24 UTC (rev 1011)
@@ -0,0 +1,37 @@
+.\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.36.
+.TH PINOT-LABEL "1" "October 2007" "pinot-label - pinot 0.76" "User Commands"
+.SH NAME
+pinot-label \- Label files from the command-line
+.SH SYNOPSIS
+.B pinot-label
+[\fIOPTIONS\fR] [\fIFILE\fR]
+.SH DESCRIPTION
+pinot\-label \- Label files from the command\-line
+.SH OPTIONS
+.TP
+\fB\-g\fR, \fB\-\-get\fR
+get the labels list for the given file
+.TP
+\fB\-h\fR, \fB\-\-help\fR
+display this help and exit
+.TP
+\fB\-l\fR, \fB\-\-list\fR
+list known labels
+.TP
+\fB\-s\fR, \fB\-\-set\fR
+set labels on the given file
+.TP
+\fB\-v\fR, \fB\-\-version\fR
+output version information and exit
+.SH EXAMPLES
+pinot\-label \fB\-\-get\fR /home/fabrice/Documents/Bozo.txt
+.PP
+pinot\-label \fB\-\-list\fR
+.PP
+pinot\-label \fB\-\-set\fR "[Clowns][Fun][My Hero]" /home/fabrice/Documents/Bozo.txt/
+.SH "REPORTING BUGS"
+Report bugs to fabricecolin at users.berlios.de
+.PP
+This is free software.  You may redistribute copies of it under the terms of
+the GNU General Public License <http://www.gnu.org/licenses/old\-licenses/gpl\-2.0.html>.
+There is NO WARRANTY, to the extent permitted by law.

Added: trunk/Index/pinot-label.cpp
===================================================================
--- trunk/Index/pinot-label.cpp	2007-10-04 13:10:00 UTC (rev 1010)
+++ trunk/Index/pinot-label.cpp	2007-10-04 13:15:24 UTC (rev 1011)
@@ -0,0 +1,253 @@
+/*
+ *  Copyright 2007 Fabrice Colin
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU Library General Public License for more details.
+ *
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+ */
+ 
+#include <getopt.h>
+#include <sys/types.h>
+#include <pwd.h>
+#include <iostream>
+#include <string>
+#include <set>
+#include "config.h"
+extern "C"
+{
+#if DBUS_NUM_VERSION < 1000000
+#define DBUS_API_SUBJECT_TO_CHANGE
+#endif
+#include <dbus/dbus.h>
+#include <dbus/dbus-glib.h>
+#include <dbus/dbus-glib-lowlevel.h>
+}
+
+#include "StringManip.h"
+#include "MIMEScanner.h"
+#include "DBusXapianIndex.h"
+#include "XapianDatabaseFactory.h"
+
+using namespace std;
+
+static struct option g_longOptions[] = {
+	{"get", 0, 0, 'g'},
+	{"help", 0, 0, 'h'},
+	{"list", 0, 0, 'l'},
+	{"set", 1, 0, 's'},
+	{"version", 0, 0, 'v'},
+	{0, 0, 0, 0}
+};
+
+
+static void printLabels(const set<string> &labels)
+{
+	cout << "Labels: ";
+	for (set<string>::const_iterator labelIter = labels.begin();
+		labelIter != labels.end(); ++labelIter)
+	{
+		cout << "[" << *labelIter << "]";
+	}
+	cout << endl;
+}
+
+static string getHomeDirectory(void)
+{
+	struct passwd *pPasswd = getpwuid(geteuid());
+
+	if ((pPasswd != NULL) &&
+		(pPasswd->pw_dir != NULL))
+	{
+		return pPasswd->pw_dir;
+	}
+	else
+	{
+		char *homeDir = getenv("HOME");
+		if (homeDir != NULL)
+		{
+			return homeDir;
+		}
+	}
+
+	return "~";
+}
+
+static void printHelp(void)
+{
+	// Help
+	cout << "pinot-label - Label files from the command-line\n\n"
+		<< "Usage: pinot-label [OPTIONS] [FILE]\n\n"
+		<< "Options:\n"
+		<< "  -g, --get                 get the labels list for the given file\n"
+		<< "  -h, --help                display this help and exit\n"
+		<< "  -l, --list                list known labels\n"
+		<< "  -s, --set                 set labels on the given file\n"
+		<< "  -v, --version             output version information and exit\n\n";
+	cout << "Examples:\n"
+		<< "pinot-label --get /home/fabrice/Documents/Bozo.txt\n\n"
+		<< "pinot-label --list\n\n"
+		<< "pinot-label --set \"[Clowns][Fun][My Hero]\" /home/fabrice/Documents/Bozo.txt/\n\n"
+		<< "Report bugs to " << PACKAGE_BUGREPORT << endl;
+}
+
+int main(int argc, char **argv)
+{
+	set<string> labels;
+	string labelsString;
+	int longOptionIndex = 0;
+	unsigned int docId = 0;
+	bool getLabels = false, getDocumentLabels = false, setDocumentLabels = false, success = false;
+
+	// Look at the options
+	int optionChar = getopt_long(argc, argv, "ghls:v", g_longOptions, &longOptionIndex);
+	while (optionChar != -1)
+	{
+		set<string> engines;
+
+		switch (optionChar)
+		{
+			case 'g':
+				getDocumentLabels = true;
+				break;
+			case 'h':
+				printHelp();
+				return EXIT_SUCCESS;
+			case 'l':
+				getLabels = true;
+				break;
+			case 's':
+				setDocumentLabels = true;
+				if (optarg != NULL)
+				{
+					labelsString = optarg;
+				}
+				break;
+			case 'v':
+				cout << "pinot-label - " << PACKAGE_STRING << "\n\n"
+					<< "This is free software.  You may redistribute copies of it under the terms of\n"
+					<< "the GNU General Public License <http://www.gnu.org/licenses/old-licenses/gpl-2.0.html>.\n"
+					<< "There is NO WARRANTY, to the extent permitted by law." << endl;
+				return EXIT_SUCCESS;
+			default:
+				return EXIT_FAILURE;
+		}
+
+		// Next option
+		optionChar = getopt_long(argc, argv, "ghls:v", g_longOptions, &longOptionIndex);
+	}
+
+	if (argc == 1)
+	{
+		printHelp();
+		return EXIT_SUCCESS;
+	}
+
+	if ((setDocumentLabels == true) &&
+		(labelsString.empty() == true))
+	{
+		cerr << "Incorrect parameters" << endl;
+		return EXIT_FAILURE;
+	}
+
+	// Initialize GType
+	g_type_init();
+
+	MIMEScanner::initialize("", "");
+
+	string indexLocation(getHomeDirectory() + "/.pinot/daemon");
+	DBusXapianIndex index(indexLocation);
+	if (index.isGood() == false)
+	{
+		cerr << "Couldn't obtain index for " << indexLocation << endl;
+
+		XapianDatabaseFactory::closeAll();
+		MIMEScanner::shutdown();
+
+		return EXIT_FAILURE;
+	}
+
+	if ((getDocumentLabels == true) ||
+		(setDocumentLabels == true))
+	{
+		string fileParam(argv[optind]);
+
+		docId = index.hasDocument(string("file://") + fileParam);
+		if (docId == 0)
+		{
+			cerr << "File is not indexed" << endl;
+
+			XapianDatabaseFactory::closeAll();
+			MIMEScanner::shutdown();
+
+			return EXIT_FAILURE;
+		}
+	}
+
+	if (getLabels == true)
+	{
+		if (index.getLabels(labels, true) == true)
+		{
+			printLabels(labels);
+
+			success = true;
+		}
+	}
+
+	if (getDocumentLabels == true)
+	{
+		labels.clear();
+
+		if (index.getDocumentLabels(docId, labels, true) == true)
+		{
+			printLabels(labels);
+
+			success = true;
+		}
+	}
+
+	if (setDocumentLabels == true)
+	{
+		string::size_type endPos = 0;
+		string label(StringManip::extractField(labelsString, "[", "]", endPos));
+
+		labels.clear();
+
+		// Parse labels
+		while (label.empty() == false)
+		{
+			labels.insert(Url::unescapeUrl(label));
+
+			if (endPos == string::npos)
+			{
+				break;
+			}
+			label = StringManip::extractField(labelsString, "[", "]", endPos);
+		}
+
+#ifdef DEBUG
+		printLabels(labels);
+#endif
+		success = index.setDocumentLabels(docId, labels);
+	}
+
+	XapianDatabaseFactory::closeAll();
+	MIMEScanner::shutdown();
+
+	// Did whatever operation we carried out succeed ?
+	if (success == true)
+	{
+		return EXIT_SUCCESS;
+	}
+
+	return EXIT_FAILURE;
+}

Modified: trunk/Makefile.am
===================================================================
--- trunk/Makefile.am	2007-10-04 13:10:00 UTC (rev 1010)
+++ trunk/Makefile.am	2007-10-04 13:15:24 UTC (rev 1011)
@@ -6,7 +6,7 @@
 	textcat_conf.txt textcat3_conf.txt \
 	pinot.desktop pinot-dbus-daemon.desktop pinot.spec \
 	Search/Plugins/*src Search/Plugins/*.xml \
-	Index/pinot-index.1 Search/pinot-search.1 \
+	Index/pinot-index.1 Index/pinot-label.1 Search/pinot-search.1 \
 	UI/GTK2/src/pinot.1 UI/GTK2/src/pinot-dbus-daemon.1 \
 	UI/GTK2/src/pinot-dbus-daemon.xml UI/GTK2/src/de.berlios.Pinot.service \
 	UI/GTK2/xapian-powered.png UI/icons/48x48/pinot.png \
@@ -15,7 +15,7 @@
 	UI/GTK2/metase-gtk2.glade UI/GTK2/metase-gtk2.gladep \
 	scripts/bash/pinot-enum-index.sh scripts/python/pinot-live.py
 
-man_MANS = Index/pinot-index.1 Search/pinot-search.1 \
+man_MANS = Index/pinot-index.1 Index/pinot-label.1 Search/pinot-search.1 \
 	UI/GTK2/src/pinot.1 UI/GTK2/src/pinot-dbus-daemon.1
 
 install-data-local:

Modified: trunk/README
===================================================================
--- trunk/README	2007-10-04 13:10:00 UTC (rev 1010)
+++ trunk/README	2007-10-04 13:15:24 UTC (rev 1011)
@@ -378,7 +378,7 @@
 SQLite							3.3.1
 http://www.sqlite.org/
 
-xapian-core						1.0.2
+xapian-core						1.0.3
 http://www.xapian.org/
 
 curl (1)						7.13.1

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2007-10-04 13:10:00 UTC (rev 1010)
+++ trunk/configure.in	2007-10-04 13:15:24 UTC (rev 1011)
@@ -162,6 +162,14 @@
 XAPIAN_NUM_VERSION=`xapian-config --version | $SED -e "s/xapian-config - xapian-core //g" | $AWK 'BEGIN { FS = "."; } { printf "%d", ($1 * 1000 + $2) * 1000 + $3;}'`
 AC_DEFINE_UNQUOTED(XAPIAN_NUM_VERSION,$XAPIAN_NUM_VERSION,
     [Xapian version number])
+AC_MSG_CHECKING(for Xapian >= 1.0.3)
+if test $XAPIAN_NUM_VERSION -gt 1000002; then
+   AC_MSG_RESULT(yes)
+else
+   AC_MSG_RESULT(no)
+   AC_MSG_ERROR([You need at least Xapian 1.0.3])
+   exit 1
+fi
 
 dnl inotify
 linuxinotify="no"

Modified: trunk/pinot.spec.in
===================================================================
--- trunk/pinot.spec.in	2007-10-04 13:10:00 UTC (rev 1010)
+++ trunk/pinot.spec.in	2007-10-04 13:15:24 UTC (rev 1011)
@@ -24,10 +24,10 @@
 Source: %{name}-%{version}.tar.gz
 URL: http://pinot.berlios.de/
 BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root-%(%{__id_u} -n)
-Requires: xapian-core-libs >= 1.0.2, libtextcat >= 2.2, sqlite >= 3.3.1, curl >= 7.13, gmime >= 2.1
+Requires: xapian-core-libs >= 1.0.3, libtextcat >= 2.2, sqlite >= 3.3.1, curl >= 7.13, gmime >= 2.1
 Requires: gtkmm24 >= 2.6, libxml++ >= 2.12, %{dbus_pkg} >= 0.60, shared-mime-info
 Requires: unzip, antiword, unrtf, %{pftotext_pkg}
-BuildRequires: xapian-core-devel >= 1.0.2, libtextcat-devel >= 2.2, sqlite-devel >= 3.3.1, curl-devel >= 7.13, gmime-devel >= 2.1, boost-devel >= 1.32
+BuildRequires: xapian-core-devel >= 1.0.3, libtextcat-devel >= 2.2, sqlite-devel >= 3.3.1, curl-devel >= 7.13, gmime-devel >= 2.1, boost-devel >= 1.32
 BuildRequires: gtkmm24-devel >= 2.6, libxml++-devel >= 2.12, %{dbus_dev_pkg} >= 0.60, gettext-devel, desktop-file-utils
 BuildRequires: taglib-devel >= 1.4
 BuildRequires: gcc-c++
@@ -102,6 +102,7 @@
 %{_bindir}/pinot
 %{_bindir}/pinot-dbus-daemon
 %{_bindir}/pinot-index
+%{_bindir}/pinot-label
 %{_bindir}/pinot-search
 %{_libdir}/pinot/filters/libexternalfilter.so*
 %{_libdir}/pinot/filters/libmboxfilter.so*
@@ -114,10 +115,7 @@
 %{_datadir}/icons/hicolor/16x16/apps/pinot.png
 %{_sysconfdir}/xdg/autostart/*.desktop
 %{_datadir}/applications/*.desktop
-%{_mandir}/man1/pinot.*
-%{_mandir}/man1/pinot-dbus-daemon.*
-%{_mandir}/man1/pinot-index.*
-%{_mandir}/man1/pinot-search.*
+%{_mandir}/man1/pinot*
 
 %files audio-docs 
 %defattr(-, root, root, -)



From fabricecolin at mail.berlios.de  Thu Oct  4 15:17:55 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Thu, 4 Oct 2007 15:17:55 +0200
Subject: [Pinot-svn] r1012 - trunk
Message-ID: <200710041317.l94DHtMr022940@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-04 15:17:49 +0200 (Thu, 04 Oct 2007)
New Revision: 1012

Modified:
   trunk/pinot.desktop
Log:
More translations for Name and Comment.


Modified: trunk/pinot.desktop
===================================================================
--- trunk/pinot.desktop	2007-10-04 13:15:24 UTC (rev 1011)
+++ trunk/pinot.desktop	2007-10-04 13:17:49 UTC (rev 1012)
@@ -1,19 +1,25 @@
 [Desktop Entry]
 Name=Pinot Metasearch Tool
-Name[es]=Metabuscador Pinot
+Name[es]=Herramienta metabuscador Pinot
+Name[de]=Pinot Werkzeug zur Metasuche
 Name[fr]=Pinot Outil De Recherche
+Name[it]=Pinot Tool di ricerca
 Name[nl]=Pinot Metazoek Tool
 Name[pt]=Mecanismo de metabusca Pinot
 Name[pt_BR]=Mecanismo de metabusca Pinot
 Name[ru]=?????????? ?????????? Pinot
 Name[sv]=Pinot Metas?kningsverktyg
+Name[zh_TW]=?????
 Comment=Search the Web and your documents
+Comment[de]=Durchsuchen Sie das Internet und Ihre Dokumente
 Comment[es]=Busca en el web y en sus documentos
-Comment[de]=Durchsuchen Sie das Internet und Ihre Dokumente
 Comment[fr]=Cherche le Web et vos documents
+Comment[it]=Cerca nel Web e nei documenti
+Comment[nl]=Zoek het web en uw documenten
 Comment[pt]=Pesquise a Web e os seus documentos
 Comment[pt_BR]=Pesquise a Web e os seus documentos
 Comment[sv]=S?k p? webben och i dina dokument
+Comment[zh_TW]=???????????
 Exec=pinot
 StartupNotify=true
 Icon=pinot.png



From fabricecolin at mail.berlios.de  Thu Oct  4 15:59:39 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Thu, 4 Oct 2007 15:59:39 +0200
Subject: [Pinot-svn] r1013 - trunk/UI/GTK2/src
Message-ID: <200710041359.l94DxdGE026004@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-04 15:59:39 +0200 (Thu, 04 Oct 2007)
New Revision: 1013

Modified:
   trunk/UI/GTK2/src/WorkerThreads.cpp
   trunk/UI/GTK2/src/statisticsDialog.cc
Log:
Got rid of leaks where the index returned by getIndex() wasn't deleted.


Modified: trunk/UI/GTK2/src/WorkerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.cpp	2007-10-04 13:17:49 UTC (rev 1012)
+++ trunk/UI/GTK2/src/WorkerThreads.cpp	2007-10-04 13:59:39 UTC (rev 1013)
@@ -1382,6 +1382,8 @@
 			m_status += _("at");
 			m_status += " ";
 			m_status += m_docInfo.getLocation();
+			delete pIndex;
+
 			return;
 		}
 	}
@@ -1461,6 +1463,8 @@
 				m_status += _("at");
 				m_status += " ";
 				m_status += m_docInfo.getLocation();
+				delete pIndex;
+
 				return;
 			}
 
@@ -1493,6 +1497,8 @@
 						m_status = _("Robots META tag forbids indexing");
 						m_status += " ";
 						m_status += m_docInfo.getLocation();
+						delete pIndex;
+
 						return;
 					}
 				}

Modified: trunk/UI/GTK2/src/statisticsDialog.cc
===================================================================
--- trunk/UI/GTK2/src/statisticsDialog.cc	2007-10-04 13:17:49 UTC (rev 1012)
+++ trunk/UI/GTK2/src/statisticsDialog.cc	2007-10-04 13:59:39 UTC (rev 1013)
@@ -119,13 +119,14 @@
 
 	row = *m_myWebPagesIter;
 	IndexInterface *pIndex = PinotSettings::getInstance().getIndex(PinotSettings::getInstance().m_docsIndexLocation);
-	if ((pIndex != NULL) &&
-		(pIndex->isGood() == true))
+	if (pIndex != NULL)
 	{
 		unsigned int docsCount = pIndex->getDocumentsCount();
 
 		snprintf(countStr, 64, "%u", docsCount);
 		row[m_statsColumns.m_name] = ustring(countStr) + " " + _("documents");
+
+		delete pIndex;
 	}
 	else
 	{
@@ -134,13 +135,14 @@
 
 	row = *m_myDocumentsIter;
 	pIndex = PinotSettings::getInstance().getIndex(PinotSettings::getInstance().m_daemonIndexLocation);
-	if ((pIndex != NULL) &&
-		(pIndex->isGood() == true))
+	if (pIndex != NULL)
 	{
 		unsigned int docsCount = pIndex->getDocumentsCount();
 
 		snprintf(countStr, 64, "%u", docsCount);
 		row[m_statsColumns.m_name] = ustring(countStr) + " " + _("documents");
+
+		delete pIndex;
 	}
 	else
 	{



From fabricecolin at mail.berlios.de  Sat Oct  6 17:19:33 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 6 Oct 2007 17:19:33 +0200
Subject: [Pinot-svn] r1014 - trunk/Search
Message-ID: <200710061519.l96FJXwP009675@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-06 17:19:33 +0200 (Sat, 06 Oct 2007)
New Revision: 1014

Modified:
   trunk/Search/XapianEngine.h
Log:
Corrected comment.


Modified: trunk/Search/XapianEngine.h
===================================================================
--- trunk/Search/XapianEngine.h	2007-10-04 13:59:39 UTC (rev 1013)
+++ trunk/Search/XapianEngine.h	2007-10-06 15:19:33 UTC (rev 1014)
@@ -30,7 +30,7 @@
 #include "DownloaderFactory.h"
 
 #if !ENABLE_XAPIAN_SPELLING_CORRECTION
-// Spelling correction in Xapian <= 1.0.2 may cause a crash
+// Spelling correction in Xapian 1.0.2 may cause a crash
 // See http://www.xapian.org/cgi-bin/bugzilla/show_bug.cgi?id=194
 #if XAPIAN_NUM_VERSION > 1000002
 #define ENABLE_XAPIAN_SPELLING_CORRECTION 1



From fabricecolin at mail.berlios.de  Sat Oct  6 17:21:40 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 6 Oct 2007 17:21:40 +0200
Subject: [Pinot-svn] r1015 - trunk/Index
Message-ID: <200710061521.l96FLefR009774@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-06 17:21:40 +0200 (Sat, 06 Oct 2007)
New Revision: 1015

Modified:
   trunk/Index/pinot-index.cpp
Log:
Deleting the index object when exiting cannot hurt.


Modified: trunk/Index/pinot-index.cpp
===================================================================
--- trunk/Index/pinot-index.cpp	2007-10-06 15:19:33 UTC (rev 1014)
+++ trunk/Index/pinot-index.cpp	2007-10-06 15:21:40 UTC (rev 1015)
@@ -215,6 +215,7 @@
 		{
 			cerr << "Couldn't obtain downloader for protocol " << thisUrl.getProtocol() << endl;
 
+			delete pIndex;
 			XapianDatabaseFactory::closeAll();
 			Dijon::FilterFactory::unloadFilters();
 			Dijon::HtmlFilter::shutdown();



From fabricecolin at mail.berlios.de  Sun Oct  7 12:22:38 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sun, 7 Oct 2007 12:22:38 +0200
Subject: [Pinot-svn] r1016 - trunk/Index
Message-ID: <200710071022.l97AMcYb025227@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-07 12:22:37 +0200 (Sun, 07 Oct 2007)
New Revision: 1016

Modified:
   trunk/Index/XapianDatabase.cpp
Log:
Activate keep alive for remote databases.


Modified: trunk/Index/XapianDatabase.cpp
===================================================================
--- trunk/Index/XapianDatabase.cpp	2007-10-06 15:21:40 UTC (rev 1015)
+++ trunk/Index/XapianDatabase.cpp	2007-10-07 10:22:37 UTC (rev 1016)
@@ -216,6 +216,12 @@
 #endif
 					Xapian::Database remoteDatabase = Xapian::Remote::open(hostName, port);
 					m_pDatabase = new Xapian::Database(remoteDatabase);
+				}
+
+				if (m_pDatabase != NULL)
+				{
+					// Stop remote databases timing out
+					m_pDatabase->keep_alive();
 					m_isOpen = true;
 				}
 
@@ -286,10 +292,15 @@
 
 			m_pDatabase = new Xapian::WritableDatabase(m_databaseName, openAction);
 		}
+
+		if (m_pDatabase != NULL)
+		{
 #ifdef DEBUG
-		cout << "XapianDatabase::openDatabase: opened " << m_databaseName << endl;
+			cout << "XapianDatabase::openDatabase: opened " << m_databaseName
+				<< " " << m_pDatabase->get_description() << endl;
 #endif
-		m_isOpen = true;
+			m_isOpen = true;
+		}
 
 		return;
 	}



From fabricecolin at mail.berlios.de  Sun Oct  7 12:26:08 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sun, 7 Oct 2007 12:26:08 +0200
Subject: [Pinot-svn] r1017 - trunk/Index
Message-ID: <200710071026.l97AQ8Fp025467@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-07 12:26:07 +0200 (Sun, 07 Oct 2007)
New Revision: 1017

Modified:
   trunk/Index/DBusXapianIndex.cpp
   trunk/Index/DBusXapianIndex.h
   trunk/Index/IndexInterface.h
   trunk/Index/XapianIndex.cpp
   trunk/Index/XapianIndex.h
Log:
New method getDocumentTerms().
In XapianIndex, revert to using the version file if metadata isn't supported
by the index backend (eg Quartz). Make sure setVersion() always creates the
CACHEDIR.TAG file.


Modified: trunk/Index/DBusXapianIndex.cpp
===================================================================
--- trunk/Index/DBusXapianIndex.cpp	2007-10-07 10:22:37 UTC (rev 1016)
+++ trunk/Index/DBusXapianIndex.cpp	2007-10-07 10:26:07 UTC (rev 1017)
@@ -27,6 +27,7 @@
 using std::endl;
 using std::string;
 using std::set;
+using std::map;
 using std::min;
 
 const char *g_fieldNames[] = { "caption", "url", "type", "language", "modtime", "size", NULL };
@@ -352,6 +353,23 @@
 	return XapianIndex::getDocumentInfo(docId, docInfo);
 }
 
+/// Returns a document's terms count.
+unsigned int DBusXapianIndex::getDocumentTermsCount(unsigned int docId) const
+{
+	reopen();
+
+	return XapianIndex::getDocumentTermsCount(docId);
+}
+
+/// Returns a document's terms.
+bool DBusXapianIndex::getDocumentTerms(unsigned int docId,
+	map<unsigned int, string> &wordsBuffer) const
+{
+	reopen();
+
+	return XapianIndex::getDocumentTerms(docId, wordsBuffer);
+}
+
 /// Sets the list of known labels.
 bool DBusXapianIndex::setLabels(const set<string> &labels)
 {

Modified: trunk/Index/DBusXapianIndex.h
===================================================================
--- trunk/Index/DBusXapianIndex.h	2007-10-07 10:22:37 UTC (rev 1016)
+++ trunk/Index/DBusXapianIndex.h	2007-10-07 10:26:07 UTC (rev 1017)
@@ -21,6 +21,7 @@
 
 #include <string>
 #include <set>
+#include <map>
 #include "config.h"
 extern "C"
 {
@@ -61,6 +62,13 @@
 		/// Returns a document's properties.
 		virtual bool getDocumentInfo(unsigned int docId, DocumentInfo &docInfo) const;
 
+		/// Returns a document's terms count.
+		virtual unsigned int getDocumentTermsCount(unsigned int docId) const;
+
+		/// Returns a document's terms.
+		virtual bool getDocumentTerms(unsigned int docId,
+			std::map<unsigned int, std::string> &wordsBuffer) const;
+
 		/// Sets the list of known labels.
 		virtual bool setLabels(const std::set<std::string> &labels);
 

Modified: trunk/Index/IndexInterface.h
===================================================================
--- trunk/Index/IndexInterface.h	2007-10-07 10:22:37 UTC (rev 1016)
+++ trunk/Index/IndexInterface.h	2007-10-07 10:26:07 UTC (rev 1017)
@@ -21,6 +21,7 @@
 
 #include <string>
 #include <set>
+#include <map>
 
 #include "Document.h"
 
@@ -51,6 +52,10 @@
 		/// Returns a document's terms count.
 		virtual unsigned int getDocumentTermsCount(unsigned int docId) const = 0;
 
+		/// Returns a document's terms.
+		virtual bool getDocumentTerms(unsigned int docId,
+			std::map<unsigned int, std::string> &wordsBuffer) const = 0;
+
 		/// Sets the list of known labels.
 		virtual bool setLabels(const std::set<std::string> &labels) = 0;
 

Modified: trunk/Index/XapianIndex.cpp
===================================================================
--- trunk/Index/XapianIndex.cpp	2007-10-07 10:22:37 UTC (rev 1016)
+++ trunk/Index/XapianIndex.cpp	2007-10-07 10:26:07 UTC (rev 1017)
@@ -17,6 +17,7 @@
  */
 
 #include <fcntl.h>
+#include <ctype.h>
 #include <unistd.h>
 #include <stdio.h>
 #include <stdlib.h>
@@ -47,9 +48,43 @@
 using std::string;
 using std::vector;
 using std::set;
+using std::map;
 using std::min;
 using std::max;
 
+static bool setVersionFile(const string &databaseName, const string &version)
+{
+	ofstream verFile;
+	string verFileName(databaseName + "/version");
+	bool setVer = false;
+
+	verFile.open(verFileName.c_str(), ios::trunc);
+	if (verFile.good() == true)
+	{
+		verFile << version;
+		setVer = true;
+	}
+	verFile.close();
+
+	return setVer;
+}
+
+static string getVersionFromFile(const string &databaseName)
+{
+	ifstream verFile;
+	string verFileName(databaseName + "/version");
+	string version;
+
+	verFile.open(verFileName.c_str());
+	if (verFile.good() == true)
+	{
+		verFile >> version;
+	}
+	verFile.close();
+
+	return version;
+}
+
 const string XapianIndex::MAGIC_TERM = "X-MetaSE-Doc";
 
 XapianIndex::XapianIndex(const string &indexName) :
@@ -704,6 +739,11 @@
 			}
 		}
 	}
+	catch (const Xapian::UnimplementedError &error)
+	{
+		cerr << "Couldn't get database version, no support for metadata: " << error.get_type() << ": " << error.get_msg() << endl;
+		version = getVersionFromFile(m_databaseName);
+	}
 	catch (const Xapian::Error &error)
 	{
 		cerr << "Couldn't get database version: " << error.get_type() << ": " << error.get_msg() << endl;
@@ -714,15 +754,7 @@
 	}
 	pDatabase->unlock();
 #else
-	ifstream verFile;
-	string verFileName(m_databaseName + "/version");
-
-	verFile.open(verFileName.c_str());
-	if (verFile.good() == true)
-	{
-		verFile >> version;
-	}
-	verFile.close();
+	version = getVersionFromFile(m_databaseName);
 #endif
 
 	return version;
@@ -750,6 +782,11 @@
 			setVer = true;
 		}
 	}
+	catch (const Xapian::UnimplementedError &error)
+	{
+		cerr << "Couldn't set database version, no support for metadata: " << error.get_type() << ": " << error.get_msg() << endl;
+		setVer = setVersionFile(m_databaseName, version);
+	}
 	catch (const Xapian::Error &error)
 	{
 		cerr << "Couldn't set database version: " << error.get_type() << ": " << error.get_msg() << endl;
@@ -760,20 +797,13 @@
 	}
 	pDatabase->unlock();
 #else
-	ofstream verFile, cacheDirFile;
-	string verFileName(m_databaseName + "/version");
-	string cacheDirFileName(m_databaseName + "/CACHEDIR.TAG");
+	setVer = setVersionFile(m_databaseName, version);
+#endif
 
-	verFile.open(verFileName.c_str(), ios::trunc);
-	if (verFile.good() == true)
-	{
-		verFile << version;
-		setVer = true;
-	}
-	verFile.close();
-
 	// While we are at it, create a CACHEDIR.TAG file
 	// See the spec at http://www.brynosaurus.com/cachedir/
+	string cacheDirFileName(m_databaseName + "/CACHEDIR.TAG");
+	ofstream cacheDirFile;
 	cacheDirFile.open(cacheDirFileName.c_str(), ios::trunc);
 	if (cacheDirFile.good() == true)
 	{
@@ -783,7 +813,6 @@
 		cacheDirFile << "# http://www.brynosaurus.com/cachedir/" << endl;
 	}
 	cacheDirFile.close();
-#endif
 
 	return setVer;
 }
@@ -901,6 +930,58 @@
 	return termsCount;
 }
 
+/// Returns a document's terms.
+bool XapianIndex::getDocumentTerms(unsigned int docId, map<unsigned int, string> &wordsBuffer) const
+{
+	bool gotTerms = false;
+
+	XapianDatabase *pDatabase = XapianDatabaseFactory::getDatabase(m_databaseName);
+	if (pDatabase == NULL)
+	{
+		cerr << "Bad index " << m_databaseName << endl;
+		return false;
+	}
+
+	try
+	{
+		Xapian::Database *pIndex = pDatabase->readLock();
+		if (pIndex != NULL)
+		{
+			// Go through the position list of each term
+			for (Xapian::TermIterator termIter = pIndex->termlist_begin(docId);
+				termIter != pIndex->termlist_end(docId); ++termIter)
+			{
+				string termName(*termIter);
+
+				// Skip prefixed terms
+				if (isupper((int)termName[0]) != 0)
+				{
+					continue;
+				}
+
+				for (Xapian::PositionIterator positionIter = pIndex->positionlist_begin(docId, termName);
+					positionIter != pIndex->positionlist_end(docId, termName); ++positionIter)
+				{
+					wordsBuffer[*positionIter] = termName;
+				}
+
+				gotTerms = true;
+			}
+		}
+	}
+	catch (const Xapian::Error &error)
+	{
+		cerr << "Couldn't get document terms: " << error.get_type() << ": " << error.get_msg() << endl;
+	}
+	catch (...)
+	{
+		cerr << "Couldn't get document terms, unknown exception occured" << endl;
+	}
+	pDatabase->unlock();
+
+	return gotTerms;
+}
+
 /// Sets the list of known labels.
 bool XapianIndex::setLabels(const set<string> &labels)
 {

Modified: trunk/Index/XapianIndex.h
===================================================================
--- trunk/Index/XapianIndex.h	2007-10-07 10:22:37 UTC (rev 1016)
+++ trunk/Index/XapianIndex.h	2007-10-07 10:26:07 UTC (rev 1017)
@@ -21,6 +21,7 @@
 
 #include <string>
 #include <set>
+#include <map>
 
 #include "config.h"
 #include "XapianDatabase.h"
@@ -63,6 +64,10 @@
 		/// Returns a document's terms count.
 		virtual unsigned int getDocumentTermsCount(unsigned int docId) const;
 
+		/// Returns a document's terms.
+		virtual bool getDocumentTerms(unsigned int docId,
+			std::map<unsigned int, std::string> &wordsBuffer) const;
+
 		/// Sets the list of known labels.
 		virtual bool setLabels(const std::set<std::string> &labels);
 



From fabricecolin at mail.berlios.de  Tue Oct  9 15:09:35 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 9 Oct 2007 15:09:35 +0200
Subject: [Pinot-svn] r1018 - in trunk: Index UI/GTK2/src
Message-ID: <200710091309.l99D9ZrS030939@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-09 15:09:35 +0200 (Tue, 09 Oct 2007)
New Revision: 1018

Modified:
   trunk/Index/FilterWrapper.cpp
   trunk/Index/pinot-index.cpp
   trunk/UI/GTK2/src/OnDiskHandler.cpp
   trunk/UI/GTK2/src/ServerThreads.cpp
Log:
Let FilterWrapper assign a default title to documents.


Modified: trunk/Index/FilterWrapper.cpp
===================================================================
--- trunk/Index/FilterWrapper.cpp	2007-10-07 10:26:07 UTC (rev 1017)
+++ trunk/Index/FilterWrapper.cpp	2007-10-09 13:09:35 UTC (rev 1018)
@@ -154,7 +154,17 @@
 			// Preserve the top-level document's title
 			filteredDoc.setTitle(originalTitle);
 		}
+		else if (filteredDoc.getTitle().empty() == false)
+		{
+			Url urlObj(doc.getLocation());
 
+			// Default to the file name as title
+			filteredDoc.setTitle(urlObj.getFile());
+#ifdef DEBUG
+			cout << "FilterWrapper::filterDocument: set default title " << urlObj.getFile() << endl;
+#endif
+		}
+
 		// Pass it down to another filter ?
 		if ((filteredDoc.getType().length() >= 10) &&
 			(filteredDoc.getType().substr(0, 10) == "text/plain"))

Modified: trunk/Index/pinot-index.cpp
===================================================================
--- trunk/Index/pinot-index.cpp	2007-10-07 10:26:07 UTC (rev 1017)
+++ trunk/Index/pinot-index.cpp	2007-10-09 13:09:35 UTC (rev 1018)
@@ -234,7 +234,7 @@
 			pDownloader->setSetting("proxytype", proxyType);
 		}
 
-		DocumentInfo docInfo(urlParam, urlParam, MIMEScanner::scanUrl(thisUrl), "");
+		DocumentInfo docInfo("", urlParam, MIMEScanner::scanUrl(thisUrl), "");
 		Document *pDoc = pDownloader->retrieveUrl(docInfo);
 		if (pDoc == NULL)
 		{

Modified: trunk/UI/GTK2/src/OnDiskHandler.cpp
===================================================================
--- trunk/UI/GTK2/src/OnDiskHandler.cpp	2007-10-07 10:26:07 UTC (rev 1017)
+++ trunk/UI/GTK2/src/OnDiskHandler.cpp	2007-10-09 13:09:35 UTC (rev 1018)
@@ -209,7 +209,7 @@
 		}
 	}
 
-	DocumentInfo docInfo(urlObj.getFile(), location, MIMEScanner::scanUrl(urlObj), "");
+	DocumentInfo docInfo("", location, MIMEScanner::scanUrl(urlObj), "");
 
 	FileCollector fileCollector;
 	Document *pDoc = fileCollector.retrieveUrl(docInfo);

Modified: trunk/UI/GTK2/src/ServerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/ServerThreads.cpp	2007-10-07 10:26:07 UTC (rev 1017)
+++ trunk/UI/GTK2/src/ServerThreads.cpp	2007-10-09 13:09:35 UTC (rev 1018)
@@ -429,10 +429,8 @@
 
 		if (reportFile == true)
 		{
-			DocumentInfo docInfo;
+			DocumentInfo docInfo("", location, "", "");
 
-			docInfo.setLocation(location);
-			docInfo.setTitle(urlObj.getFile());
 			if (S_ISDIR(fileStat.st_mode))
 			{
 				docInfo.setType("x-directory/normal");



From fabricecolin at mail.berlios.de  Tue Oct  9 15:12:14 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 9 Oct 2007 15:12:14 +0200
Subject: [Pinot-svn] r1019 - trunk/Index
Message-ID: <200710091312.l99DCEpG031275@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-09 15:12:13 +0200 (Tue, 09 Oct 2007)
New Revision: 1019

Modified:
   trunk/Index/LanguageDetector.cpp
   trunk/Index/pinot-label.cpp
Log:
Minor mods.


Modified: trunk/Index/LanguageDetector.cpp
===================================================================
--- trunk/Index/LanguageDetector.cpp	2007-10-09 13:09:35 UTC (rev 1018)
+++ trunk/Index/LanguageDetector.cpp	2007-10-09 13:12:13 UTC (rev 1019)
@@ -61,6 +61,7 @@
 			std::vector<std::string> &candidates)
 {
 	string confFile(SYSCONFDIR);
+	char *textCatVersion = textcat_Version();
 #ifdef HAVE_TEXTCAT_CAT
 	const char *catResults[10];
 #endif
@@ -69,11 +70,11 @@
 
 	// What configuration file should we use ?
 	confFile += "/pinot/";
-	if (strncasecmp(textcat_Version(), "TextCat 3", 9) == 0)
-	{
 #ifdef DEBUG
-		cout << "LanguageDetector::guessLanguage: detected libtextcat 3" << endl;
+	cout << "LanguageDetector::guessLanguage: detected " << textCatVersion << endl;
 #endif
+	if (strncasecmp(textCatVersion, "TextCat 3", 9) == 0)
+	{
 		// Version 3
 		confFile += "textcat3_conf.txt";
 	}

Modified: trunk/Index/pinot-label.cpp
===================================================================
--- trunk/Index/pinot-label.cpp	2007-10-09 13:09:35 UTC (rev 1018)
+++ trunk/Index/pinot-label.cpp	2007-10-09 13:12:13 UTC (rev 1019)
@@ -96,7 +96,7 @@
 	cout << "Examples:\n"
 		<< "pinot-label --get /home/fabrice/Documents/Bozo.txt\n\n"
 		<< "pinot-label --list\n\n"
-		<< "pinot-label --set \"[Clowns][Fun][My Hero]\" /home/fabrice/Documents/Bozo.txt/\n\n"
+		<< "pinot-label --set \"[Clowns][Fun][My Hero]\" /home/fabrice/Documents/Bozo.txt\n\n"
 		<< "Report bugs to " << PACKAGE_BUGREPORT << endl;
 }
 



From fabricecolin at mail.berlios.de  Tue Oct  9 15:26:11 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 9 Oct 2007 15:26:11 +0200
Subject: [Pinot-svn] r1020 - trunk/Index
Message-ID: <200710091326.l99DQBAB031985@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-09 15:26:10 +0200 (Tue, 09 Oct 2007)
New Revision: 1020

Modified:
   trunk/Index/XapianIndex.cpp
Log:
Xapian::Database::get_metadata() doesn't throw an exception when the backend
doesn't support metadata, so check the version file if get_metadata("version")
returns an empty string.
Extended getDocumentTerms() to return (some but not all) prefixed terms, and
terms that don't have positional information.


Modified: trunk/Index/XapianIndex.cpp
===================================================================
--- trunk/Index/XapianIndex.cpp	2007-10-09 13:12:13 UTC (rev 1019)
+++ trunk/Index/XapianIndex.cpp	2007-10-09 13:26:10 UTC (rev 1020)
@@ -732,18 +732,20 @@
 		Xapian::Database *pIndex = pDatabase->readLock();
 		if (pIndex != NULL)
 		{
+			// If this index type doesn't support metadata, no exception will be thrown
+			// We will just get an empty string
 			version = pIndex->get_metadata("version");
 			if (version.empty() == true)
 			{
-				version = "0.00";
+				// Is there a pre-0.80 version file ?
+				version = getVersionFromFile(m_databaseName);
+				if (version.empty() == true)
+				{
+					version = "0.00";
+				}
 			}
 		}
 	}
-	catch (const Xapian::UnimplementedError &error)
-	{
-		cerr << "Couldn't get database version, no support for metadata: " << error.get_type() << ": " << error.get_msg() << endl;
-		version = getVersionFromFile(m_databaseName);
-	}
 	catch (const Xapian::Error &error)
 	{
 		cerr << "Couldn't get database version: " << error.get_type() << ": " << error.get_msg() << endl;
@@ -785,6 +787,7 @@
 	catch (const Xapian::UnimplementedError &error)
 	{
 		cerr << "Couldn't set database version, no support for metadata: " << error.get_type() << ": " << error.get_msg() << endl;
+		// Revert to a version file
 		setVer = setVersionFile(m_databaseName, version);
 	}
 	catch (const Xapian::Error &error)
@@ -933,6 +936,7 @@
 /// Returns a document's terms.
 bool XapianIndex::getDocumentTerms(unsigned int docId, map<unsigned int, string> &wordsBuffer) const
 {
+	vector<string> noPosTerms;
 	bool gotTerms = false;
 
 	XapianDatabase *pDatabase = XapianDatabaseFactory::getDatabase(m_databaseName);
@@ -947,26 +951,58 @@
 		Xapian::Database *pIndex = pDatabase->readLock();
 		if (pIndex != NULL)
 		{
+			unsigned int lastPos = 0;
+
 			// Go through the position list of each term
 			for (Xapian::TermIterator termIter = pIndex->termlist_begin(docId);
 				termIter != pIndex->termlist_end(docId); ++termIter)
 			{
 				string termName(*termIter);
+				char firstChar = termName[0];
+				bool hasPositions = false;
 
-				// Skip prefixed terms
-				if (isupper((int)termName[0]) != 0)
+				// Is it prefixed ?
+				if (isupper((int)firstChar) != 0)
 				{
-					continue;
+					// Skip X-prefixed terms
+					if (firstChar == 'X')
+					{
+#ifdef DEBUG
+						cout << "XapianIndex::getDocumentTerms: skipping " << termName << endl;
+#endif
+						continue;
+					}
+
+					// Keep other prefixed terms (S, U, H, P, L, T...)
+					termName.erase(0, 1);
 				}
 
-				for (Xapian::PositionIterator positionIter = pIndex->positionlist_begin(docId, termName);
-					positionIter != pIndex->positionlist_end(docId, termName); ++positionIter)
+				for (Xapian::PositionIterator positionIter = pIndex->positionlist_begin(docId, *termIter);
+					positionIter != pIndex->positionlist_end(docId, *termIter); ++positionIter)
 				{
 					wordsBuffer[*positionIter] = termName;
+					if (*positionIter > lastPos)
+					{
+						lastPos = *positionIter;
+					}
+					hasPositions = true;
 				}
 
+				if (hasPositions == false)
+				{
+					noPosTerms.push_back(termName);
+				}
+
 				gotTerms = true;
 			}
+
+			// Append terms without positional information as if they were at the end of the document
+			for (vector<string>::const_iterator noPosIter = noPosTerms.begin();
+				noPosIter != noPosTerms.end(); ++noPosIter)
+			{
+				wordsBuffer[lastPos] = *noPosIter;
+				++lastPos;
+			}
 		}
 	}
 	catch (const Xapian::Error &error)



From fabricecolin at mail.berlios.de  Tue Oct  9 17:01:12 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 9 Oct 2007 17:01:12 +0200
Subject: [Pinot-svn] r1021 - trunk/Index
Message-ID: <200710091501.l99F1CW4010933@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-09 17:01:12 +0200 (Tue, 09 Oct 2007)
New Revision: 1021

Modified:
   trunk/Index/FilterWrapper.cpp
Log:
Doh ! Why do I always confuse true and false ? ;-P


Modified: trunk/Index/FilterWrapper.cpp
===================================================================
--- trunk/Index/FilterWrapper.cpp	2007-10-09 13:26:10 UTC (rev 1020)
+++ trunk/Index/FilterWrapper.cpp	2007-10-09 15:01:12 UTC (rev 1021)
@@ -154,7 +154,7 @@
 			// Preserve the top-level document's title
 			filteredDoc.setTitle(originalTitle);
 		}
-		else if (filteredDoc.getTitle().empty() == false)
+		else if (filteredDoc.getTitle().empty() == true)
 		{
 			Url urlObj(doc.getLocation());
 



From fabricecolin at mail.berlios.de  Wed Oct 10 15:50:32 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Wed, 10 Oct 2007 15:50:32 +0200
Subject: [Pinot-svn] r1022 - trunk/Utils
Message-ID: <200710101350.l9ADoW1H012185@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-10 15:50:32 +0200 (Wed, 10 Oct 2007)
New Revision: 1022

Modified:
   trunk/Utils/TimeConverter.cpp
Log:
Worry about timezones only if GM time is needed.


Modified: trunk/Utils/TimeConverter.cpp
===================================================================
--- trunk/Utils/TimeConverter.cpp	2007-10-09 15:01:12 UTC (rev 1021)
+++ trunk/Utils/TimeConverter.cpp	2007-10-10 13:50:32 UTC (rev 1022)
@@ -204,6 +204,10 @@
 		else
 		{
 			gmTime = mktime(&timeTm);
+#ifndef _STRPTIME_COPES_WITH_TIMEZONE
+			// No need to worry about the timezone here
+			fixTimezone = false;
+#endif
 		}
 
 #ifndef _STRPTIME_COPES_WITH_TIMEZONE



From fabricecolin at mail.berlios.de  Wed Oct 10 15:52:44 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Wed, 10 Oct 2007 15:52:44 +0200
Subject: [Pinot-svn] r1023 - trunk/Tokenize
Message-ID: <200710101352.l9ADqiUU012381@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-10 15:52:43 +0200 (Wed, 10 Oct 2007)
New Revision: 1023

Modified:
   trunk/Tokenize/FilterUtils.cpp
Log:
Look for date.


Modified: trunk/Tokenize/FilterUtils.cpp
===================================================================
--- trunk/Tokenize/FilterUtils.cpp	2007-10-10 13:50:32 UTC (rev 1022)
+++ trunk/Tokenize/FilterUtils.cpp	2007-10-10 13:52:43 UTC (rev 1023)
@@ -23,6 +23,7 @@
 
 #include "MIMEScanner.h"
 #include "StringManip.h"
+#include "TimeConverter.h"
 #include "Url.h"
 #include "FilterFactory.h"
 #include "FilterUtils.h"
@@ -248,6 +249,10 @@
 				<< " characters of data" << endl;
 #endif
 		}
+		else if (metaIter->first == "date")
+		{
+			doc.setTimestamp(metaIter->second);
+		}
 		else if (metaIter->first == "ipath")
 		{
 			ipath = metaIter->second;



From fabricecolin at mail.berlios.de  Wed Oct 10 16:02:29 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Wed, 10 Oct 2007 16:02:29 +0200
Subject: [Pinot-svn] r1024 - trunk/UI/GTK2/src
Message-ID: <200710101402.l9AE2TGo013209@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-10 16:02:28 +0200 (Wed, 10 Oct 2007)
New Revision: 1024

Modified:
   trunk/UI/GTK2/src/PinotUtils.cpp
Log:
File chooser asks for confirmation when overwriting files. File name and folder
are initialized correctly.


Modified: trunk/UI/GTK2/src/PinotUtils.cpp
===================================================================
--- trunk/UI/GTK2/src/PinotUtils.cpp	2007-10-10 13:52:43 UTC (rev 1023)
+++ trunk/UI/GTK2/src/PinotUtils.cpp	2007-10-10 14:02:28 UTC (rev 1024)
@@ -21,6 +21,8 @@
 
 #include "config.h"
 #include "NLS.h"
+#include "Url.h"
+#include "PinotSettings.h"
 #include "PinotUtils.h"
 
 using namespace std;
@@ -71,19 +73,15 @@
 	if (openOrCreate == false)
 	{
 		okButtonStockId = Stock::SAVE;
+		fileChooser.set_do_overwrite_confirmation(true);
 	}
 
 	// Have we been provided with an initial location ?
 	if (location.empty() == true)
 	{
 		// No, get the location of the home directory then
-		char *homeDir = getenv("HOME");
-		if (homeDir != NULL)
-		{
-			location = homeDir;
-			location += "/";
-			isDirectory = true;
-		}
+		location = PinotSettings::getInstance().getHomeDirectory();
+		isDirectory = true;
 	}
 
 	if (directoriesOnly == false)
@@ -111,14 +109,12 @@
 	}
 
 	fileChooser.set_action(chooserAction);
-	if (isDirectory == true)
+	Url urlObj(location);
+	fileChooser.set_current_folder(filename_from_utf8(urlObj.getLocation()));
+	if (isDirectory == false)
 	{
-		fileChooser.set_current_folder(filename_from_utf8(location));
+		fileChooser.set_current_name(filename_from_utf8(urlObj.getFile()));
 	}
-	else
-	{
-		fileChooser.set_filename(filename_from_utf8(location));
-	}
 	fileChooser.set_local_only();
 	fileChooser.set_select_multiple(false);
 	fileChooser.add_button(Stock::CANCEL, RESPONSE_CANCEL);



From fabricecolin at mail.berlios.de  Wed Oct 10 16:32:33 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Wed, 10 Oct 2007 16:32:33 +0200
Subject: [Pinot-svn] r1025 - trunk/UI/GTK2/src
Message-ID: <200710101432.l9AEWXn8015305@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-10 16:32:32 +0200 (Wed, 10 Oct 2007)
New Revision: 1025

Modified:
   trunk/UI/GTK2/src/ResultsTree.cpp
Log:
Set results' timestamps when exporting.


Modified: trunk/UI/GTK2/src/ResultsTree.cpp
===================================================================
--- trunk/UI/GTK2/src/ResultsTree.cpp	2007-10-10 14:02:28 UTC (rev 1024)
+++ trunk/UI/GTK2/src/ResultsTree.cpp	2007-10-10 14:32:32 UTC (rev 1025)
@@ -1306,6 +1306,7 @@
 				result.setExtract(queryHistory.getItemExtract(from_utf8(m_treeName),
 					engineName, result.getLocation(), charset));
 			}
+			result.setTimestamp(from_utf8(childRow[m_resultsColumns.m_timestamp]));
 
 			// Export this
 			pExporter->exportResult(engineName, result);



From fabricecolin at mail.berlios.de  Thu Oct 11 16:25:20 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Thu, 11 Oct 2007 16:25:20 +0200
Subject: [Pinot-svn] r1026 - trunk/Search
Message-ID: <200710111425.l9BEPKrE001459@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-11 16:25:20 +0200 (Thu, 11 Oct 2007)
New Revision: 1026

Modified:
   trunk/Search/XapianEngine.cpp
Log:
Consider Z-prefixed terms (stems) when expanding the query.
Fixed how the query is built when limited to several documents.


Modified: trunk/Search/XapianEngine.cpp
===================================================================
--- trunk/Search/XapianEngine.cpp	2007-10-10 14:32:32 UTC (rev 1025)
+++ trunk/Search/XapianEngine.cpp	2007-10-11 14:25:20 UTC (rev 1026)
@@ -222,7 +222,12 @@
 	// Any limit on what documents should be searched ?
 	if (limitQuery.empty() == false)
 	{
-		freeQuery += limitQuery;
+		string limitedQuery(limitQuery);
+
+		limitedQuery += " AND ( ";
+		limitedQuery += freeQuery;
+		limitedQuery += " )";
+		freeQuery = limitedQuery;
 #ifdef DEBUG
 		cout << "XapianEngine::parseQuery: " << freeQuery << endl;
 #endif
@@ -358,7 +363,10 @@
 	// Any correction ?
 	correctedFreeQuery = parser.get_corrected_query_string();
 #ifdef DEBUG
-	cout << "XapianEngine::parseQuery: corrected spelling to: " << correctedFreeQuery << endl;
+	if (correctedFreeQuery.empty() == false)
+	{
+		cout << "XapianEngine::parseQuery: corrected spelling to: " << correctedFreeQuery << endl;
+	}
 #endif
 #endif
 
@@ -481,7 +489,8 @@
 #endif
 
 			// Get 10 non-prefixed terms
-			PrefixDecider expandDecider("RS");
+			string allowedPrefixes("RSZ");
+			PrefixDecider expandDecider(allowedPrefixes);
 			Xapian::ESet expandTerms = enquire.get_eset(20, expandDocs, &expandDecider);
 #ifdef DEBUG
 			cout << "XapianEngine::queryDatabase: " << expandTerms.size() << " expand terms" << endl;
@@ -491,8 +500,7 @@
 			{
 				char firstChar = (*termIter)[0];
 
-				if ((firstChar == 'R') ||
-					(firstChar == 'S'))
+				if (allowedPrefixes.find(firstChar) != string::npos)
 				{
 					m_expandTerms.insert((*termIter).substr(1));
 				}
@@ -526,6 +534,7 @@
 /// Sets the set of documents to limit to.
 bool XapianEngine::setLimitSet(const set<string> &docsSet)
 {
+	unsigned int bracketsLevel = 1;
 	bool firstLocation = true;
 
 	m_limitQuery.clear();
@@ -536,20 +545,26 @@
 	}
 
 	// FIXME: there must be a better way !
-	m_limitQuery = " +(";
+	m_limitQuery = "( ";
 	for (set<string>::const_iterator docIter = docsSet.begin();
 		docIter != docsSet.end(); ++docIter)
 	{
 		if (firstLocation == false)
 		{
-			m_limitQuery += " or ";
+			m_limitQuery += " OR ( ";
+			++bracketsLevel;
 		}
+
 		m_limitQuery += "url:\"";
 		m_limitQuery += *docIter;
 		m_limitQuery += "\"";
+
 		firstLocation = false;
 	}
-	m_limitQuery += ")";
+	for (unsigned int count = 0; count < bracketsLevel; ++count)
+	{
+		m_limitQuery += " )";
+	}
 #ifdef DEBUG
 	cout << "XapianEngine::setLimitSet: " << m_limitQuery << endl;
 #endif



From fabricecolin at mail.berlios.de  Thu Oct 11 16:27:19 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Thu, 11 Oct 2007 16:27:19 +0200
Subject: [Pinot-svn] r1027 - trunk/Search/Plugins
Message-ID: <200710111427.l9BERJSZ001640@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-11 16:27:19 +0200 (Thu, 11 Oct 2007)
New Revision: 1027

Modified:
   trunk/Search/Plugins/Topix.src
Log:
Updated results parsing.


Modified: trunk/Search/Plugins/Topix.src
===================================================================
--- trunk/Search/Plugins/Topix.src	2007-10-11 14:25:20 UTC (rev 1026)
+++ trunk/Search/Plugins/Topix.src	2007-10-11 14:27:19 UTC (rev 1027)
@@ -16,8 +16,8 @@
 <INTERPRET
 resultListStart=""
 resultListEnd=""
-resultItemStart='<div class="article"'
-resultItemEnd='<div class="divclear">'
+resultItemStart='<p class="headline">'
+resultItemEnd='<li>'
 >
 
 </SEARCH>



From fabricecolin at mail.berlios.de  Sat Oct 13 05:02:27 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 13 Oct 2007 05:02:27 +0200
Subject: [Pinot-svn] r1028 - trunk/Tokenize
Message-ID: <200710130302.l9D32Ru2028956@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-13 05:02:26 +0200 (Sat, 13 Oct 2007)
New Revision: 1028

Modified:
   trunk/Tokenize/FilterUtils.cpp
Log:
If a type has no valid parent, add an entry in the alias cache that says so.


Modified: trunk/Tokenize/FilterUtils.cpp
===================================================================
--- trunk/Tokenize/FilterUtils.cpp	2007-10-11 14:27:19 UTC (rev 1027)
+++ trunk/Tokenize/FilterUtils.cpp	2007-10-13 03:02:26 UTC (rev 1028)
@@ -28,6 +28,8 @@
 #include "FilterFactory.h"
 #include "FilterUtils.h"
 
+#define UNSUPPORTED_TYPE "X-Unsupported"
+
 using std::cout;
 using std::cerr;
 using std::endl;
@@ -53,6 +55,12 @@
 	map<string, string>::const_iterator aliasIter = m_typeAliases.find(mimeType);
 	if (aliasIter != m_typeAliases.end())
 	{
+		if (aliasIter->second == UNSUPPORTED_TYPE)
+		{
+			// We already know that none of this type's parents are supported
+			return NULL;
+		}
+
 		pFilter = Dijon::FilterFactory::getFilter(aliasIter->second);
 	}
 	else
@@ -83,6 +91,9 @@
 				return pFilter;
 			}
 		}
+
+		// This type has no valid parent
+		m_typeAliases[mimeType] = UNSUPPORTED_TYPE;
 	}
 
 	return NULL;
@@ -94,7 +105,12 @@
 	map<string, string>::const_iterator aliasIter = m_typeAliases.find(mimeType);
 	if (aliasIter != m_typeAliases.end())
 	{
-		// There's an alias because we were able to get a filter for this parent type
+		if (aliasIter->second == UNSUPPORTED_TYPE)
+		{
+			return false;
+		}
+
+		// We were able to get a filter for this parent type
 		// or a previous call to isSupportedType() succeeded
 		return true;
 	}
@@ -115,6 +131,9 @@
 				return true;
 			}
 		}
+
+		// This type has no valid parent
+		m_typeAliases[mimeType] = UNSUPPORTED_TYPE;
 	}
 
 	return false;



From fabricecolin at mail.berlios.de  Sat Oct 13 07:11:31 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 13 Oct 2007 07:11:31 +0200
Subject: [Pinot-svn] r1029 - trunk/SQL
Message-ID: <200710130511.l9D5BVAE020122@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-13 07:11:30 +0200 (Sat, 13 Oct 2007)
New Revision: 1029

Modified:
   trunk/SQL/ActionQueue.cpp
Log:
Serialize labels too.


Modified: trunk/SQL/ActionQueue.cpp
===================================================================
--- trunk/SQL/ActionQueue.cpp	2007-10-13 03:02:26 UTC (rev 1028)
+++ trunk/SQL/ActionQueue.cpp	2007-10-13 05:11:30 UTC (rev 1029)
@@ -21,6 +21,7 @@
 #include <stdio.h>
 #include <stdlib.h>
 #include <unistd.h>
+#include <set>
 #include <iostream>
 
 #include "Url.h"
@@ -29,6 +30,7 @@
 #include "ActionQueue.h"
 
 using std::string;
+using std::set;
 using std::cout;
 using std::endl;
 
@@ -134,23 +136,25 @@
 
 	// Serialize DocumentInfo
 	info += docInfo.getTitle();
-	info += "\n";
-	info += "url=";
+	info += "\nurl=";
 	info += url;
-	info += "\n";
-	info += "type=";
+	info += "\ntype=";
 	info += docInfo.getType();
-	info += "\n";
-	info += "language=";
+	info += "\nlanguage=";
 	info += docInfo.getLanguage();
-	info += "\n";
-	info += "modtime=";
+	info += "\nmodtime=";
 	info += docInfo.getTimestamp();
-	info += "\n";
-	info += "size=";
+	info += "\nsize=";
 	char sizeStr[64];
 	snprintf(sizeStr, 64, "%ld", docInfo.getSize());
 	info += sizeStr;
+	info += "\nlabels=";
+	const set<string> &labels = docInfo.getLabels();
+	for (set<string>::const_iterator labelIter = labels.begin();
+		labelIter != labels.end(); ++labelIter)
+	{
+		info += "[" + Url::escapeUrl(*labelIter) + "]";
+	}
 	info += "\n";
 
 	if (update == false)
@@ -239,7 +243,28 @@
 			{
 				docInfo.setSize((off_t )atol(bytesSize.c_str()));
 			}
+			string labelsString(StringManip::extractField(info, "labels=", "\n"));
+			if (labelsString.empty() == false)
+			{
+				string::size_type endPos = 0;
+				string label(StringManip::extractField(labelsString, "[", "]", endPos));
+				set<string> labels;
 
+				// Parse labels
+				while (label.empty() == false)
+				{
+					labels.insert(Url::unescapeUrl(label));
+
+					if (endPos == string::npos)
+					{
+						break;
+					}
+					label = StringManip::extractField(labelsString, "[", "]", endPos);
+				}
+
+				docInfo.setLabels(labels);
+			}
+
 			delete row;
 		}
 



From fabricecolin at mail.berlios.de  Sat Oct 13 07:16:54 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 13 Oct 2007 07:16:54 +0200
Subject: [Pinot-svn] r1030 - trunk/SQL
Message-ID: <200710130516.l9D5GsIw027526@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-13 07:16:53 +0200 (Sat, 13 Oct 2007)
New Revision: 1030

Modified:
   trunk/SQL/CrawlHistory.cpp
   trunk/SQL/CrawlHistory.h
Log:
Extra column ErrorNum in CrawlHistory.
The table will be dropped and recreated but it should be okay since it will
take place when users upgrade to 0.80, which will trigger reindexing.


Modified: trunk/SQL/CrawlHistory.cpp
===================================================================
--- trunk/SQL/CrawlHistory.cpp	2007-10-13 05:11:30 UTC (rev 1029)
+++ trunk/SQL/CrawlHistory.cpp	2007-10-13 05:16:53 UTC (rev 1030)
@@ -81,6 +81,8 @@
 /// Creates the CrawlHistory table in the database.
 bool CrawlHistory::create(const string &database)
 {
+	bool createHistoryTable = false;
+
 	// The specified path must be a file
 	if (SQLiteBase::check(database) == false)
 	{
@@ -102,9 +104,29 @@
 	// Does CrawlHistory exist ?
 	if (db.executeSimpleStatement("SELECT * FROM CrawlHistory LIMIT 1;") == false)
 	{
-		if (db.executeSimpleStatement("CREATE TABLE CrawlHistory (Url VARCHAR(255) \
-			PRIMARY KEY, Status VARCHAR(255), SourceID INTEGER, DATE INTEGER);") == false)
+		createHistoryTable = true;
+	}
+	else
+	{
+		// Previous versions didn't include a ErrorNum field, so check for it
+		if (db.executeSimpleStatement("SELECT ErrorNum FROM CrawlHistory LIMIT 1;") == false)
 		{
+#ifdef DEBUG
+			cout << "CrawlHistory::create: CrawlHistory needs updating" << endl;
+#endif
+			// Ideally, we would use ALTER TABLE but it's not supported by SQLite
+			if (db.executeSimpleStatement("DROP TABLE CrawlHistory; VACUUM;") == true)
+			{
+				createHistoryTable = true;
+			}
+		}
+	}
+
+	if (createHistoryTable == true)
+	{
+		if (db.executeSimpleStatement("CREATE TABLE CrawlHistory (Url VARCHAR(255) PRIMARY KEY, \
+			Status VARCHAR(255), SourceID INTEGER, DATE INTEGER, ErrorNum INTEGER);") == false)
+		{
 			return false;
 		}
 	}
@@ -212,14 +234,15 @@
 }
 
 /// Inserts an URL.
-bool CrawlHistory::insertItem(const string &url, CrawlStatus status, unsigned int sourceId, time_t date)
+bool CrawlHistory::insertItem(const string &url, CrawlStatus status, unsigned int sourceId,
+	time_t date, int errNum)
 {
 	bool success = false;
 
 	SQLiteResults *results = executeStatement("INSERT INTO CrawlHistory \
-		VALUES('%q', '%q', '%u', '%d');",
+		VALUES('%q', '%q', '%u', '%d', '%d');",
 		Url::escapeUrl(url).c_str(), statusToText(status).c_str(), sourceId,
-		(date == 0 ? time(NULL) : date));
+		(date == 0 ? time(NULL) : date), errNum);
 	if (results != NULL)
 	{
 		success = true;
@@ -255,13 +278,13 @@
 }
 
 /// Updates an URL.
-bool CrawlHistory::updateItem(const string &url, CrawlStatus status, time_t date)
+bool CrawlHistory::updateItem(const string &url, CrawlStatus status, time_t date, int errNum)
 {
 	bool success = false;
 
 	SQLiteResults *results = executeStatement("UPDATE CrawlHistory \
-		SET Status='%q', Date='%d' WHERE Url='%q';",
-		statusToText(status).c_str(), (date == 0 ? time(NULL) : date),
+		SET Status='%q', Date='%d', ErrorNum='%d' WHERE Url='%q';",
+		statusToText(status).c_str(), (date == 0 ? time(NULL) : date), errNum,
 		Url::escapeUrl(url).c_str());
 	if (results != NULL)
 	{
@@ -313,6 +336,29 @@
 	return success;
 }
 
+/// Gets the error number for a URL.
+int CrawlHistory::getErrorNum(const string &url)
+{
+	int errNum = 0;
+
+	SQLiteResults *results = executeStatement("SELECT ErrorNum FROM CrawlHistory WHERE Url='%q';",
+		Url::escapeUrl(url).c_str());
+	if (results != NULL)
+	{
+		SQLiteRow *row = results->nextRow();
+		if (row != NULL)
+		{
+			errNum = atoi(row->getColumn(0).c_str());
+
+			delete row;
+		}
+
+		delete results;
+	}
+
+	return errNum;
+}
+
 /// Returns items that belong to a source.
 unsigned int CrawlHistory::getSourceItems(unsigned int sourceId, CrawlStatus status,
 	set<string> &urls, time_t minDate)

Modified: trunk/SQL/CrawlHistory.h
===================================================================
--- trunk/SQL/CrawlHistory.h	2007-10-13 05:11:30 UTC (rev 1029)
+++ trunk/SQL/CrawlHistory.h	2007-10-13 05:16:53 UTC (rev 1030)
@@ -53,13 +53,14 @@
 		bool deleteSource(unsigned int sourceId);
 
 		/// Inserts an URL.
-		bool insertItem(const string &url, CrawlStatus status, unsigned int sourceId, time_t date);
+		bool insertItem(const string &url, CrawlStatus status, unsigned int sourceId,
+			time_t date, int errNum = 0);
 
 		/// Checks if an URL is in the history.
 		bool hasItem(const string &url, CrawlStatus &status, time_t &date);
 
 		/// Updates an URL.
-		bool updateItem(const string &url, CrawlStatus status, time_t date);
+		bool updateItem(const string &url, CrawlStatus status, time_t date, int errNum = 0);
 
 		/// Updates URLs.
 		bool updateItems(const map<string, time_t> urls, CrawlStatus status);
@@ -67,6 +68,9 @@
 		/// Updates the status of items en masse.
 		bool updateItemsStatus(unsigned int sourceId, CrawlStatus currentStatus, CrawlStatus newStatus);
 
+		/// Gets the error number for a URL.
+		int getErrorNum(const string &url);
+
 		/// Returns items that belong to a source.
 		unsigned int getSourceItems(unsigned int sourceId, CrawlStatus status,
 			set<string> &urls, time_t minDate = 0);



From fabricecolin at mail.berlios.de  Sat Oct 13 07:20:23 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 13 Oct 2007 07:20:23 +0200
Subject: [Pinot-svn] r1031 - trunk/Index
Message-ID: <200710130520.l9D5KN9m003592@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-13 07:20:22 +0200 (Sat, 13 Oct 2007)
New Revision: 1031

Modified:
   trunk/Index/pinot-index.cpp
   trunk/Index/pinot-label.cpp
Log:
Display labels escaped since that's how they should be fed to pinot-label.


Modified: trunk/Index/pinot-index.cpp
===================================================================
--- trunk/Index/pinot-index.cpp	2007-10-13 05:16:53 UTC (rev 1030)
+++ trunk/Index/pinot-index.cpp	2007-10-13 05:20:22 UTC (rev 1031)
@@ -293,7 +293,7 @@
 			for (set<string>::const_iterator labelIter = labels.begin();
 				labelIter != labels.end(); ++labelIter)
 			{
-				cout << "[" << *labelIter << "]";
+				cout << "[" << Url::escapeUrl(*labelIter) << "]";
 			}
 			cout << endl;
 		}

Modified: trunk/Index/pinot-label.cpp
===================================================================
--- trunk/Index/pinot-label.cpp	2007-10-13 05:16:53 UTC (rev 1030)
+++ trunk/Index/pinot-label.cpp	2007-10-13 05:20:22 UTC (rev 1031)
@@ -56,7 +56,7 @@
 	for (set<string>::const_iterator labelIter = labels.begin();
 		labelIter != labels.end(); ++labelIter)
 	{
-		cout << "[" << *labelIter << "]";
+		cout << "[" << Url::escapeUrl(*labelIter) << "]";
 	}
 	cout << endl;
 }



From fabricecolin at mail.berlios.de  Sat Oct 13 08:54:13 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 13 Oct 2007 08:54:13 +0200
Subject: [Pinot-svn] r1032 - trunk/UI/GTK2/src
Message-ID: <200710130654.l9D6sDh3022387@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-13 08:54:13 +0200 (Sat, 13 Oct 2007)
New Revision: 1032

Modified:
   trunk/UI/GTK2/src/ServerThreads.cpp
   trunk/UI/GTK2/src/WorkerThreads.cpp
   trunk/UI/GTK2/src/WorkerThreads.h
Log:
When something fails, thread record an error number, which can be converted into
an error string by the caller if necessary.
DirectoryScannerThread records scanning errors directly into CrawlHistory.


Modified: trunk/UI/GTK2/src/ServerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/ServerThreads.cpp	2007-10-13 05:20:22 UTC (rev 1031)
+++ trunk/UI/GTK2/src/ServerThreads.cpp	2007-10-13 06:54:13 UTC (rev 1032)
@@ -239,7 +239,7 @@
 	string location("file://" + entryName);
 	time_t itemDate;
 	struct stat fileStat;
-	int statSuccess = 0;
+	int entryStatus = 0;
 	bool scanSuccess = true, reportFile = false, itemExists = false;
 
 	if (entryName.empty() == true)
@@ -260,24 +260,25 @@
 		return false;
 	}
 
+	// Is this item in the database already ?
+	itemExists = history.hasItem(location, status, itemDate);
+
 	if (m_followSymLinks == false)
 	{
-		statSuccess = lstat(entryName.c_str(), &fileStat);
+		entryStatus = lstat(entryName.c_str(), &fileStat);
 	}
 	else
 	{
 		// Stat the files pointed to by symlinks
-		statSuccess = stat(entryName.c_str(), &fileStat);
+		entryStatus = stat(entryName.c_str(), &fileStat);
 	}
 
-	// Is this item in the database already ?
-	itemExists = history.hasItem(location, status, itemDate);
-
-	if (statSuccess == -1)
+	if (entryStatus == -1)
 	{
 #ifdef DEBUG
-		cout << "DirectoryScannerThread::scanEntry: stat failed with error " << errno << " " << strerror(errno) << endl;
+		cout << "DirectoryScannerThread::scanEntry: stat failed with error " << errno << endl;
 #endif
+		entryStatus = errno;
 		scanSuccess = false;
 	}
 	// Is it a file or a directory ?
@@ -365,8 +366,9 @@
 			else
 			{
 #ifdef DEBUG
-				cout << "DirectoryScannerThread::scanEntry: opendir failed with error " << errno << " " << strerror(errno) << endl;
+				cout << "DirectoryScannerThread::scanEntry: opendir failed with error " << errno << endl;
 #endif
+				entryStatus = errno;
 				scanSuccess = false;
 			}
 		}
@@ -376,6 +378,7 @@
 #ifdef DEBUG
 		cout << "DirectoryScannerThread::scanEntry: unknown entry type" << endl;
 #endif
+		entryStatus = ENOENT;
 		scanSuccess = false;
 	}
 
@@ -387,11 +390,11 @@
 		// Record this error
 		if (itemExists == false)
 		{
-			history.insertItem(location, CrawlHistory::ERROR, m_sourceId, timeNow);
+			history.insertItem(location, CrawlHistory::ERROR, m_sourceId, timeNow, entryStatus);
 		}
 		else
 		{
-			history.updateItem(location, CrawlHistory::ERROR, timeNow);
+			history.updateItem(location, CrawlHistory::ERROR, timeNow, entryStatus);
 		}
 	}
 	else if (reportFile == true)
@@ -474,9 +477,8 @@
 
 	if (scanEntry(m_dirName, history) == false)
 	{
-		m_status = _("Couldn't open directory");
-		m_status += " ";
-		m_status += m_dirName;
+		m_errorNum = OPENDIR_FAILED;
+		m_errorParam = m_dirName;
 	}
 	flushUpdates(history);
 

Modified: trunk/UI/GTK2/src/WorkerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.cpp	2007-10-13 05:20:22 UTC (rev 1031)
+++ trunk/UI/GTK2/src/WorkerThreads.cpp	2007-10-13 06:54:13 UTC (rev 1032)
@@ -73,6 +73,58 @@
 pthread_mutex_t WorkerThread::m_dispatcherMutex = PTHREAD_MUTEX_INITIALIZER;
 bool WorkerThread::m_immediateFlush = true;
 
+string WorkerThread::errorToString(int errorNum)
+{
+	if (errorNum == 0)
+	{
+		return "";
+	}
+
+	if (errorNum < INDEX_ERROR)
+	{
+		return strerror(errorNum);
+	}
+
+	// Internal error codes
+	switch (errorNum)
+	{
+		case INDEX_ERROR:
+			return _("Index error");
+		case INDEXING_FAILED:
+			return _("Couldn't index document");
+		case UPDATE_FAILED:
+			return _("Couldn't update document");
+		case UNINDEXING_FAILED:
+			return _("Couldn't unindex document(s)");
+		case QUERY_FAILED:
+			return _("Couldn't run query on search engine");
+		case HISTORY_FAILED:
+			return _("Couldn't get history for search engine");
+		case DOWNLOAD_FAILED:
+			return _("Couldn't retrieve document");
+		case MONITORING_FAILED:
+			return _("Couldn't initialize file monitor");
+		case OPENDIR_FAILED:
+			return _("Couldn't open directory");
+		case UNKNOWN_INDEX:
+			return _("Index doesn't exist");
+		case UNKNOWN_ENGINE:
+			return  _("Couldn't create search engine");
+		case UNSUPPORTED_TYPE:
+			return _("Cannot index document type");
+		case UNSUPPORTED_PROTOCOL:
+			return _("No downloader for this protocol");
+		case ROBOTS_FORBIDDEN:
+			return _("Robots META tag forbids indexing");
+		case NO_MONITORING:
+			return _("No monitoring handler");
+		default:
+			break;
+	}
+
+	return _("Unknown error");
+}
+
 Dispatcher &WorkerThread::getDispatcher(void)
 {
 	return m_dispatcher;
@@ -86,7 +138,8 @@
 WorkerThread::WorkerThread() :
 	m_id(0),
 	m_background(false),
-	m_done(false)
+	m_done(false),
+	m_errorNum(0)
 {
 }
 
@@ -140,9 +193,24 @@
 	return m_done;
 }
 
+int WorkerThread::getErrorNum(void) const
+{
+	return m_errorNum;
+}
+
 string WorkerThread::getStatus(void) const
 {
-	return m_status;
+	string status(errorToString(m_errorNum));
+
+	if ((status.empty() == false) &&
+		(m_errorParam.empty() == false))
+	{
+		status += " (";
+		status += m_errorParam;
+		status += ")";
+	}
+
+	return status;
 }
 
 void WorkerThread::threadHandler(void)
@@ -417,7 +485,8 @@
 		unlock_threads();
 	}
 #ifdef DEBUG
-	cout << "ThreadsManager::get_threads_count: " << count << " threads left" << endl;
+	cout << "ThreadsManager::get_threads_count: " << count << "/"
+		<< m_backgroundThreadsCount << " threads left" << endl;
 #endif
 
 	// A negative count would mean that a background thread
@@ -676,11 +745,8 @@
 	map<string, string>::const_iterator mapIter = indexesMap.find(m_indexName);
 	if (mapIter == indexesMap.end())
 	{
-		m_status = _("Index");
-		m_status += " ";
-		m_status += m_indexName;
-		m_status += " ";
-		m_status += _("doesn't exist");
+		m_errorNum = UNKNOWN_INDEX;
+		m_errorParam = m_indexName;
 		return;
 	}
 
@@ -689,9 +755,8 @@
 	if ((pIndex == NULL) ||
 		(pIndex->isGood() == false))
 	{
-		m_status = _("Index error on");
-		m_status += " ";
-		m_status += mapIter->second;
+		m_errorNum = INDEX_ERROR;
+		m_errorParam = mapIter->second;
 		if (pIndex != NULL)
 		{
 			delete pIndex;
@@ -964,9 +1029,8 @@
 	SearchEngineInterface *pEngine = SearchEngineFactory::getSearchEngine(m_engineName, m_engineOption);
 	if (pEngine == NULL)
 	{
-		m_status = _("Couldn't create search engine");
-		m_status += " ";
-		m_status += m_engineDisplayableName;
+		m_errorNum = UNKNOWN_ENGINE;
+		m_errorParam = m_engineDisplayableName;
 		return;
 	}
 
@@ -993,9 +1057,8 @@
 	pEngine->setDefaultOperator(SearchEngineInterface::DEFAULT_OP_AND);
 	if (pEngine->runQuery(m_queryProps, m_startDoc) == false)
 	{
-		m_status = _("Couldn't run query on search engine");
-		m_status += " ";
-		m_status += m_engineDisplayableName;
+		m_errorNum = QUERY_FAILED;
+		m_errorParam = m_engineDisplayableName;
 	}
 	else
 	{
@@ -1054,9 +1117,8 @@
 	if (history.getItems(m_queryProps.getName(), m_engineDisplayableName,
 		m_maxDocsCount, m_documentsList) == false)
 	{
-		m_status = _("Couldn't get history for search engine");
-		m_status += " ";
-		m_status += m_engineDisplayableName;
+		m_errorNum = HISTORY_FAILED;
+		m_errorParam = m_engineDisplayableName;
 	}
 	else if (m_documentsList.empty() == false)
 	{
@@ -1100,9 +1162,8 @@
 	SearchEngineInterface *pEngine = SearchEngineFactory::getSearchEngine("xapian", "MERGED");
 	if (pEngine == NULL)
 	{
-		m_status = _("Couldn't create search engine");
-		m_status += " ";
-		m_status += m_queryProps.getName();
+		m_errorNum = UNKNOWN_ENGINE;
+		m_errorParam = m_queryProps.getName();
 		return;
 	}
 
@@ -1113,7 +1174,7 @@
 	pEngine->setDefaultOperator(SearchEngineInterface::DEFAULT_OP_AND);
 	if (pEngine->runQuery(m_queryProps) == false)
 	{
-		m_status = _("Couldn't run query on search engine");
+		m_errorNum = QUERY_FAILED;
 	}
 	else
 	{
@@ -1161,18 +1222,16 @@
 	IndexInterface *pDocsIndex = PinotSettings::getInstance().getIndex(PinotSettings::getInstance().m_docsIndexLocation);
 	if (pDocsIndex == NULL)
 	{
-		m_status = _("Index error on");
-		m_status += " ";
-		m_status += PinotSettings::getInstance().m_docsIndexLocation;
+		m_errorNum = INDEX_ERROR;
+		m_errorParam = PinotSettings::getInstance().m_docsIndexLocation;
 		return;
 	}
 
 	IndexInterface *pDaemonIndex = PinotSettings::getInstance().getIndex(PinotSettings::getInstance().m_daemonIndexLocation);
 	if (pDaemonIndex == NULL)
 	{
-		m_status = _("Index error on");
-		m_status += " ";
-		m_status += PinotSettings::getInstance().m_daemonIndexLocation;
+		m_errorNum = INDEX_ERROR;
+		m_errorParam = PinotSettings::getInstance().m_daemonIndexLocation;
 		delete pDocsIndex;
 		return;
 	}
@@ -1264,9 +1323,8 @@
 	m_pDownloader = DownloaderFactory::getDownloader(thisUrl.getProtocol());
 	if (m_pDownloader == NULL)
 	{
-		m_status = _("Couldn't obtain downloader for protocol");
-		m_status += " ";
-		m_status += thisUrl.getProtocol();
+		m_errorNum = UNSUPPORTED_PROTOCOL;
+		m_errorParam = thisUrl.getProtocol();
 	}
 	else if (m_done == false)
 	{
@@ -1289,9 +1347,8 @@
 
 	if (m_pDoc == NULL)
 	{
-		m_status = _("Couldn't retrieve");
-		m_status += " ";
-		m_status += m_docInfo.getLocation();
+		m_errorNum = DOWNLOAD_FAILED;
+		m_errorParam = m_docInfo.getLocation();
 	}
 }
 
@@ -1345,9 +1402,8 @@
 	if ((pIndex == NULL) ||
 		(pIndex->isGood() == false))
 	{
-		m_status = _("Index error on");
-		m_status += " ";
-		m_status += m_indexLocation;
+		m_errorNum = INDEX_ERROR;
+		m_errorParam = m_indexLocation;
 		if (pIndex != NULL)
 		{
 			delete pIndex;
@@ -1375,13 +1431,8 @@
 		// Skip unsupported types ?
 		if (m_allowAllMIMETypes == false)
 		{
-			m_status = _("Cannot index document type");
-			m_status += " ";
-			m_status += m_docInfo.getType();
-			m_status += " ";
-			m_status += _("at");
-			m_status += " ";
-			m_status += m_docInfo.getLocation();
+			m_errorNum = UNSUPPORTED_TYPE;
+			m_errorParam = m_docInfo.getType();
 			delete pIndex;
 
 			return;
@@ -1456,13 +1507,8 @@
 			// Skip unsupported types ?
 			if (m_allowAllMIMETypes == false)
 			{
-				m_status = _("Cannot index document type");
-				m_status += " ";
-				m_status += m_docInfo.getType();
-				m_status += " ";
-				m_status += _("at");
-				m_status += " ";
-				m_status += m_docInfo.getLocation();
+				m_errorNum = UNSUPPORTED_TYPE;
+				m_errorParam = m_docInfo.getType();
 				delete pIndex;
 
 				return;
@@ -1494,9 +1540,8 @@
 						(pos2 != string::npos))
 					{
 						// No, it isn't
-						m_status = _("Robots META tag forbids indexing");
-						m_status += " ";
-						m_status += m_docInfo.getLocation();
+						m_errorNum = ROBOTS_FORBIDDEN;
+						m_errorParam = m_docInfo.getLocation();
 						delete pIndex;
 
 						return;
@@ -1550,9 +1595,8 @@
 
 			if (success == false)
 			{
-				m_status = _("Couldn't index");
-				m_status += " ";
-				m_status += m_docInfo.getLocation();
+				m_errorNum = INDEXING_FAILED;
+				m_errorParam = m_docInfo.getLocation();
 			}
 			else
 			{
@@ -1615,9 +1659,8 @@
 	if ((pIndex == NULL) ||
 		(pIndex->isGood() == false))
 	{
-		m_status = _("Index error on");
-		m_status += " ";
-		m_status += m_indexLocation;
+		m_errorNum = INDEX_ERROR;
+		m_errorParam = m_indexLocation;
 		if (pIndex != NULL)
 		{
 			delete pIndex;
@@ -1626,7 +1669,7 @@
 	}
 
 	// Be pessimistic and assume something will go wrong ;-)
-	m_status = _("Couldn't unindex document(s)");
+	m_errorNum = UNINDEXING_FAILED;
 
 	// Are we supposed to remove documents based on labels ?
 	if (m_docIdList.empty() == true)
@@ -1653,7 +1696,7 @@
 		}
 
 		// Nothing to report
-		m_status = "";
+		m_errorNum = 0;
 	}
 	else
 	{
@@ -1687,7 +1730,7 @@
 		}
 
 		// Nothing to report
-		m_status = "";
+		m_errorNum = 0;
 	}
 
 	delete pIndex;
@@ -1729,11 +1772,8 @@
 		map<string, string>::const_iterator mapIter = indexesMap.find(m_indexName);
 		if (mapIter == indexesMap.end())
 		{
-			m_status = _("Index");
-			m_status += " ";
-			m_status += m_indexName;
-			m_status += " ";
-			m_status += _("doesn't exist");
+			m_errorNum = UNKNOWN_INDEX;
+			m_errorParam = m_indexName;
 			return;
 		}
 
@@ -1742,9 +1782,8 @@
 		if ((pIndex == NULL) ||
 			(pIndex->isGood() == false))
 		{
-			m_status = _("Index error on");
-			m_status += " ";
-			m_status += mapIter->second;
+			m_errorNum = INDEX_ERROR;
+			m_errorParam = mapIter->second;
 			if (pIndex != NULL)
 			{
 				delete pIndex;
@@ -1754,7 +1793,7 @@
 
 		if (pIndex->updateDocumentInfo(m_docId, m_docInfo) == false)
 		{
-			m_status = _("Couldn't update document");
+			m_errorNum = UPDATE_FAILED;
 		}
 		else
 		{
@@ -1981,7 +2020,7 @@
 	if ((m_pHandler == NULL) ||
 		(m_pMonitor == NULL))
 	{
-		m_status = _("No monitoring handler");
+		m_errorNum = NO_MONITORING;
 		return;
 	}
 
@@ -2023,7 +2062,7 @@
 		FD_SET(monitorFd, &listenSet);
 		if (monitorFd < 0)
 		{
-			m_status = _("Couldn't initialize file monitor");
+			m_errorNum = MONITORING_FAILED;
 			return;
 		}
 

Modified: trunk/UI/GTK2/src/WorkerThreads.h
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.h	2007-10-13 05:20:22 UTC (rev 1031)
+++ trunk/UI/GTK2/src/WorkerThreads.h	2007-10-13 06:54:13 UTC (rev 1032)
@@ -45,6 +45,13 @@
 		WorkerThread();
 		virtual ~WorkerThread();
 
+		typedef enum { INDEX_ERROR = 10000, INDEXING_FAILED, UPDATE_FAILED, UNINDEXING_FAILED, \
+			QUERY_FAILED, HISTORY_FAILED, DOWNLOAD_FAILED, MONITORING_FAILED, OPENDIR_FAILED, \
+			UNKNOWN_INDEX, UNKNOWN_ENGINE, UNSUPPORTED_TYPE, UNSUPPORTED_PROTOCOL, \
+			ROBOTS_FORBIDDEN, NO_MONITORING } ThreadError;
+
+		static std::string errorToString(int errorNum);
+
 		static Glib::Dispatcher &getDispatcher(void);
 
 		static void immediateFlush(bool doFlush);
@@ -67,6 +74,8 @@
 
 		bool isDone(void) const;
 
+		int getErrorNum(void) const;
+
 		std::string getStatus(void) const;
 
 	protected:
@@ -77,7 +86,8 @@
 		unsigned int m_id;
 		bool m_background;
 		bool m_done;
-		std::string m_status;
+		int m_errorNum;
+		std::string m_errorParam;
 
 		void threadHandler(void);
 



From fabricecolin at mail.berlios.de  Sat Oct 13 09:03:43 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 13 Oct 2007 09:03:43 +0200
Subject: [Pinot-svn] r1033 - trunk/UI/GTK2/src
Message-ID: <200710130703.l9D73h8G022820@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-13 09:03:43 +0200 (Sat, 13 Oct 2007)
New Revision: 1033

Modified:
   trunk/UI/GTK2/src/statisticsDialog.cc
   trunk/UI/GTK2/src/statisticsDialog.hh
Log:
Errors actually give some indication as to what failed. Errors of the same kind
are grouped together.


Modified: trunk/UI/GTK2/src/statisticsDialog.cc
===================================================================
--- trunk/UI/GTK2/src/statisticsDialog.cc	2007-10-13 06:54:13 UTC (rev 1032)
+++ trunk/UI/GTK2/src/statisticsDialog.cc	2007-10-13 07:03:43 UTC (rev 1033)
@@ -32,6 +32,7 @@
 #include "ViewHistory.h"
 #include "PinotSettings.h"
 #include "PinotUtils.h"
+#include "WorkerThreads.h"
 #include "statisticsDialog.hh"
 
 using namespace std;
@@ -193,47 +194,56 @@
 		// Did any error occur on this source ?
 		unsigned int errorCount = crawlerHistory.getSourceItems(sourceIter->first,
 			CrawlHistory::ERROR, errors, m_lastErrorDate);
+		m_lastErrorDate = time(NULL);
 		if ((errorCount > 0) &&
 			(errors.empty() == false))
 		{
-			Url urlObj(sourceIter->second);
-			ustring sourceName(urlObj.getLocation());
-
 			// Add an errors row
 			if (m_hasErrors == false)
 			{
-				m_errorsIter  = m_refStore->append(m_daemonIter->children());
-				row = *m_errorsIter;
+				m_errorsTopIter = m_refStore->append(m_daemonIter->children());
+				row = *m_errorsTopIter;
 				row[m_statsColumns.m_name] = _("Errors");
 
-				// Don't expand it
-				TreeModel::Path errPath = m_refStore->get_path(m_errorsIter);
-				statisticsTreeview->collapse_row(errPath);
-
 				m_hasErrors = true;
 			}
 
-			// Add the source
-			TreeModel::iterator srcIter = m_refStore->append(m_errorsIter->children());
-			row = *srcIter;
-			if (urlObj.getFile().empty() == false)
-			{
-				sourceName += "/";
-				sourceName += urlObj.getFile();
-			}
-			row[m_statsColumns.m_name] = sourceName;
-
 			// List them
 			for (set<string>::const_iterator errorIter = errors.begin();
 				errorIter != errors.end(); ++errorIter)
 			{
-				TreeModel::iterator errIter = m_refStore->append(srcIter->children());
-				row = *errIter;
-				row[m_statsColumns.m_name] = (*errorIter);
+				string locationWithError(*errorIter);
+				TreeModel::iterator errIter;
+				int errorNum = crawlerHistory.getErrorNum(locationWithError);
+
+				// Find or create the iterator for this particular kind of error
+				std::map<int, TreeModel::iterator>::const_iterator errorTreeIter = m_errorsIters.find(errorNum);
+				if (errorTreeIter == m_errorsIters.end())
+				{
+					string errorText(WorkerThread::errorToString(errorNum));
+
+					errIter = m_refStore->append(m_errorsTopIter->children());
+					row = *errIter;
+					row[m_statsColumns.m_name] = errorText;
+
+					m_errorsIters.insert(pair<int, TreeModel::iterator>(errorNum, errIter));
+				}
+				else
+				{
+					errIter = errorTreeIter->second;
+				}
+
+				// Display the location itself
+				TreeModel::iterator locIter = m_refStore->append(errIter->children());
+				row = *locIter;
+				row[m_statsColumns.m_name] = locationWithError;
 			}
+
+			// Expand errors
+			TreeModel::Path errPath = m_refStore->get_path(m_errorsTopIter);
+			statisticsTreeview->expand_to_path(errPath);
 		}
 	}
-	m_lastErrorDate = time(NULL);
 
 	return true;
 }

Modified: trunk/UI/GTK2/src/statisticsDialog.hh
===================================================================
--- trunk/UI/GTK2/src/statisticsDialog.hh	2007-10-13 06:54:13 UTC (rev 1032)
+++ trunk/UI/GTK2/src/statisticsDialog.hh	2007-10-13 07:03:43 UTC (rev 1033)
@@ -20,6 +20,7 @@
 #define _STATISTICSDIALOG_HH
 
 #include <time.h>
+#include <map>
 #include <sigc++/slot.h>
 #include <sigc++/connection.h>
 #include <glibmm/refptr.h>
@@ -43,7 +44,8 @@
 	Gtk::TreeModel::iterator m_daemonIter;
 	Gtk::TreeModel::iterator m_daemonStatIter;
 	Gtk::TreeModel::iterator m_crawledStatIter;
-	Gtk::TreeModel::iterator m_errorsIter;
+	Gtk::TreeModel::iterator m_errorsTopIter;
+	std::map<int, Gtk::TreeModel::iterator> m_errorsIters;
 	bool m_hasErrors;
 	time_t m_lastErrorDate;
 	SigC::Connection m_idleConnection;



From fabricecolin at mail.berlios.de  Sat Oct 13 10:31:22 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 13 Oct 2007 10:31:22 +0200
Subject: [Pinot-svn] r1034 - trunk/po
Message-ID: <200710130831.l9D8VMUN027218@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-13 10:31:22 +0200 (Sat, 13 Oct 2007)
New Revision: 1034

Modified:
   trunk/po/Makefile.in.in
Log:
Pass -c to msgfmt.


Modified: trunk/po/Makefile.in.in
===================================================================
--- trunk/po/Makefile.in.in	2007-10-13 07:03:43 UTC (rev 1033)
+++ trunk/po/Makefile.in.in	2007-10-13 08:31:22 UTC (rev 1034)
@@ -78,7 +78,7 @@
 
 .po.gmo:
 	file=$(srcdir)/`echo $* | sed 's,.*/,,'`.gmo \
-	  && rm -f $$file && $(GMSGFMT) -o $$file $<
+	  && rm -f $$file && $(GMSGFMT) -c -o $$file $<
 
 .po.cat:
 	sed -f ../intl/po2msg.sed < $< > $*.msg \



From fabricecolin at mail.berlios.de  Sat Oct 13 15:56:30 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 13 Oct 2007 15:56:30 +0200
Subject: [Pinot-svn] r1035 - in trunk/UI/GTK2: . src
Message-ID: <200710131356.l9DDuUCC001328@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-13 15:56:29 +0200 (Sat, 13 Oct 2007)
New Revision: 1035

Modified:
   trunk/UI/GTK2/metase-gtk2.glade
   trunk/UI/GTK2/src/mainWindow.cc
   trunk/UI/GTK2/src/propertiesDialog.cc
   trunk/UI/GTK2/src/propertiesDialog.hh
   trunk/UI/GTK2/src/propertiesDialog_glade.cc
   trunk/UI/GTK2/src/propertiesDialog_glade.hh
Log:
propertiesDialog can save a document's terms to file, and does some of the
processing previously done in mainWindow.
Also give a sensible default name to the file results are exported to.


Modified: trunk/UI/GTK2/metase-gtk2.glade
===================================================================
--- trunk/UI/GTK2/metase-gtk2.glade	2007-10-13 08:31:22 UTC (rev 1034)
+++ trunk/UI/GTK2/metase-gtk2.glade	2007-10-13 13:56:29 UTC (rev 1035)
@@ -2269,7 +2269,7 @@
 	    <widget class="GtkTable" id="nameTable">
 	      <property name="visible">True</property>
 	      <property name="n_rows">1</property>
-	      <property name="n_columns">3</property>
+	      <property name="n_columns">2</property>
 	      <property name="homogeneous">False</property>
 	      <property name="row_spacing">0</property>
 	      <property name="column_spacing">0</property>
@@ -2326,27 +2326,6 @@
 		  <property name="y_options"></property>
 		</packing>
 	      </child>
-
-	      <child>
-		<widget class="GtkButton" id="queryHistoryButton">
-		  <property agent="glademm" name="cxx_visibility">protected</property>
-		  <property name="visible">True</property>
-		  <property name="can_focus">True</property>
-		  <property name="label">Show History</property>
-		  <property name="use_underline">True</property>
-		  <property name="relief">GTK_RELIEF_NORMAL</property>
-		  <property name="focus_on_click">True</property>
-		  <signal name="clicked" handler="on_addFilterButton_clicked" last_modification_time="Sat, 14 Oct 2006 01:28:04 GMT"/>
-		</widget>
-		<packing>
-		  <property name="left_attach">2</property>
-		  <property name="right_attach">3</property>
-		  <property name="top_attach">0</property>
-		  <property name="bottom_attach">1</property>
-		  <property name="x_options">fill</property>
-		  <property name="y_options"></property>
-		</packing>
-	      </child>
 	    </widget>
 	    <packing>
 	      <property name="padding">0</property>
@@ -2973,30 +2952,6 @@
 	      </child>
 
 	      <child>
-		<widget class="GtkEntry" id="termsEntry">
-		  <property agent="glademm" name="cxx_visibility">protected</property>
-		  <property name="visible">True</property>
-		  <property name="can_focus">True</property>
-		  <property name="editable">False</property>
-		  <property name="visibility">True</property>
-		  <property name="max_length">0</property>
-		  <property name="text" translatable="yes"></property>
-		  <property name="has_frame">True</property>
-		  <property name="invisible_char">*</property>
-		  <property name="activates_default">False</property>
-		</widget>
-		<packing>
-		  <property name="left_attach">1</property>
-		  <property name="right_attach">2</property>
-		  <property name="top_attach">4</property>
-		  <property name="bottom_attach">5</property>
-		  <property name="x_padding">4</property>
-		  <property name="y_padding">4</property>
-		  <property name="y_options">fill</property>
-		</packing>
-	      </child>
-
-	      <child>
 		<widget class="GtkLabel" id="termsLabel">
 		  <property agent="glademm" name="cxx_visibility">protected</property>
 		  <property name="visible">True</property>
@@ -3026,6 +2981,60 @@
 		  <property name="y_options">fill</property>
 		</packing>
 	      </child>
+
+	      <child>
+		<widget class="GtkHBox" id="termsHbox">
+		  <property name="visible">True</property>
+		  <property name="homogeneous">False</property>
+		  <property name="spacing">0</property>
+
+		  <child>
+		    <widget class="GtkEntry" id="termsEntry">
+		      <property agent="glademm" name="cxx_visibility">protected</property>
+		      <property name="visible">True</property>
+		      <property name="can_focus">True</property>
+		      <property name="editable">False</property>
+		      <property name="visibility">True</property>
+		      <property name="max_length">0</property>
+		      <property name="text" translatable="yes"></property>
+		      <property name="has_frame">True</property>
+		      <property name="invisible_char">*</property>
+		      <property name="activates_default">False</property>
+		    </widget>
+		    <packing>
+		      <property name="padding">4</property>
+		      <property name="expand">True</property>
+		      <property name="fill">True</property>
+		    </packing>
+		  </child>
+
+		  <child>
+		    <widget class="GtkButton" id="saveTermsButton">
+		      <property agent="glademm" name="cxx_visibility">protected</property>
+		      <property name="visible">True</property>
+		      <property name="can_focus">True</property>
+		      <property name="label">gtk-save-as</property>
+		      <property name="use_stock">True</property>
+		      <property name="relief">GTK_RELIEF_NORMAL</property>
+		      <property name="focus_on_click">True</property>
+		      <signal name="clicked" handler="on_saveTermsButton_clicked" last_modification_time="Fri, 05 Oct 2007 07:57:40 GMT"/>
+		    </widget>
+		    <packing>
+		      <property name="padding">4</property>
+		      <property name="expand">False</property>
+		      <property name="fill">False</property>
+		    </packing>
+		  </child>
+		</widget>
+		<packing>
+		  <property name="left_attach">1</property>
+		  <property name="right_attach">2</property>
+		  <property name="top_attach">4</property>
+		  <property name="bottom_attach">5</property>
+		  <property name="x_options">fill</property>
+		  <property name="y_options">fill</property>
+		</packing>
+	      </child>
 	    </widget>
 	    <packing>
 	      <property name="padding">0</property>

Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2007-10-13 08:31:22 UTC (rev 1034)
+++ trunk/UI/GTK2/src/mainWindow.cc	2007-10-13 13:56:29 UTC (rev 1035)
@@ -2020,9 +2020,12 @@
 			{
 				FileChooserDialog fileChooser(_("Export Results"));
 				FileFilter csvFilter, xmlFilter;
-				ustring location;
+				ustring location(m_settings.getHomeDirectory());
 				bool exportToCSV = true;
 
+				location += "/";
+				location += pNotebookPage->getTitle();
+				location += ".csv";
 				prepare_file_chooser(fileChooser, location, false);
 
 				// Add filters
@@ -2255,12 +2258,8 @@
 void mainWindow::on_showfromindex_activate()
 {
 	vector<DocumentInfo> documentsList;
-	set<string> docLabels;
 	string indexName, queryName;
-	DocumentInfo docInfo;
-	unsigned int docId = 0, termsCount = 0;
 	int width, height;
-	bool editDocument = false;
 
 #ifdef DEBUG
 	cout << "mainWindow::on_showfromindex_activate: called" << endl;
@@ -2303,139 +2302,75 @@
 		return;
 	}
 
-	IndexInterface *pIndex = m_settings.getIndex(mapIter->second);
-	if ((pIndex == NULL) ||
-		(pIndex->isGood() == false))
-	{
-		if (pIndex != NULL)
-		{
-			delete pIndex;
-		}
-		return;
-	}
-
-	// If there's only one document selected, get its labels
-	if (documentsList.size() == 1)
-	{
-		vector<DocumentInfo>::iterator docIter = documentsList.begin();
-		unsigned int indexId = 0;
-
-		// Get the document ID
-		docId = docIter->getIsIndexed(indexId);
-#ifdef DEBUG
-		cout << "mainWindow::on_showfromindex_activate: document " << docId << " in index " << indexId << endl;
-#endif
-		if (docId > 0)
-		{
-			// Get the properties from the index because they have been altered
-			// by the tree for display purposes
-			pIndex->getDocumentInfo(docId, docInfo);
-			pIndex->getDocumentLabels(docId, docLabels);
-			docInfo.setIsIndexed(indexId, docId);
-			termsCount = pIndex->getDocumentTermsCount(docId);
-			editDocument = true;
-		}
-	}
-	else
-	{
-		// If all documents are of the same language, show it
-		for (vector<DocumentInfo>::iterator docIter = documentsList.begin();
-			docIter != documentsList.end(); ++docIter)
-		{
-			if (docInfo.getLanguage().empty() == true)
-			{
-				docInfo.setLanguage(docIter->getLanguage());
-			}
-			if (docIter->getLanguage() != docInfo.getLanguage())
-			{
-				// They aren't
-				docInfo.setLanguage("");
-				break;
-			}
-		}
-
-		// Show a blank labels list
-	}
-
 	// Let the user set the labels
 	get_size(width, height);
-	propertiesDialog propertiesBox(docLabels, docInfo, termsCount, editDocument);
+	propertiesDialog propertiesBox(mapIter->second, documentsList);
 	propertiesBox.setHeight(height / 2);
 	propertiesBox.show();
+	// What labels will this show ?
+	const set<string> &labels = propertiesBox.getLabels();
+	bool hasNoLabels = labels.empty();
 	if (propertiesBox.run() != RESPONSE_OK)
 	{
-		delete pIndex;
 		return;
 	}
 
-	const set<string> &labels = propertiesBox.getLabels();
-	string newTitle(propertiesBox.getDocumentInfo().getTitle());
-	string newLanguage(propertiesBox.getDocumentInfo().getLanguage());
+	DocumentInfo docInfo(propertiesBox.getDocumentInfo());
+	string newTitle(docInfo.getTitle());
+	string newLanguage(docInfo.getLanguage());
 #ifdef DEBUG
 	cout << "mainWindow::on_showfromindex_activate: properties changed to "
 		<< newTitle << ", " << newLanguage << endl;
 #endif
 
 	// Now apply these labels to all the documents
-	if ((docLabels.empty() == false) ||
-		(labels.empty() == false) ||
-		(documentsList.size() > 1))
+	// FIXME: do that only if something was modified
+	if ((hasNoLabels == false) &&
+		(labels.empty() == false))
 	{
-		set<unsigned int> docIds;
-
-		for (vector<DocumentInfo>::iterator docIter = documentsList.begin();
-			docIter != documentsList.end(); ++docIter)
+		IndexInterface *pIndex = m_settings.getIndex(mapIter->second);
+		if (pIndex != NULL)
 		{
-			unsigned int indexId = 0;
+			if (pIndex->isGood() == true)
+			{
+				set<unsigned int> docIds;
 
-			docIds.insert(docIter->getIsIndexed(indexId));
-		}
+				for (vector<DocumentInfo>::iterator docIter = documentsList.begin();
+					docIter != documentsList.end(); ++docIter)
+				{
+					unsigned int indexId = 0;
 
-		// Set the document's labels list
-		pIndex->setDocumentsLabels(docIds, labels);
-	}
+					docIds.insert(docIter->getIsIndexed(indexId));
+				}
 
-	if ((documentsList.size() == 1) &&
-		(docId > 0))
-	{
-		// Did the title or language change ?
-		if ((newTitle != docInfo.getTitle()) ||
-			(newLanguage != docInfo.getLanguage()))
-		{
-			docInfo.setTitle(newTitle);
-			docInfo.setLanguage(newLanguage);
+				// Set the document's labels list
+				// FIXME: this should be done by a thread
+				pIndex->setDocumentsLabels(docIds, labels);
+			}
 
-			// Update the document
-			start_thread(new UpdateDocumentThread(indexName, docId, docInfo));
+			delete pIndex;
 		}
 	}
-	else
+
+	// Update all documents
+	// FIXME: do that only if something was modified
+	for (vector<DocumentInfo>::iterator docIter = documentsList.begin();
+		docIter != documentsList.end(); ++docIter)
 	{
-		// Was the language changed ?
-		if (newLanguage.empty() == false)
-		{
-			// Update all documents
-			for (vector<DocumentInfo>::iterator docIter = documentsList.begin();
-				docIter != documentsList.end(); ++docIter)
-			{
-				unsigned int indexId = 0;
-				docId = docIter->getIsIndexed(indexId);
+		unsigned int indexId = 0;
+		unsigned int docId = docIter->getIsIndexed(indexId);
 
-				docIter->setLanguage(newLanguage);
+		docIter->setLanguage(newLanguage);
 
-				start_thread(new UpdateDocumentThread(indexName, docId, *docIter));
-			}
-		}
-
-		if (queryName.empty() == false)
-		{
-			// The current label may have been applied to or removed from
-			// one or more of the selected documents, so refresh the list
-			browse_index(indexName, queryName, 0, 0);
-		}
+		start_thread(new UpdateDocumentThread(indexName, docId, *docIter));
 	}
 
-	delete pIndex;
+	if (queryName.empty() == false)
+	{
+		// The current label may have been applied to or removed from
+		// one or more of the selected documents, so refresh the list
+		browse_index(indexName, queryName, 0, 0);
+	}
 }
 
 //

Modified: trunk/UI/GTK2/src/propertiesDialog.cc
===================================================================
--- trunk/UI/GTK2/src/propertiesDialog.cc	2007-10-13 08:31:22 UTC (rev 1034)
+++ trunk/UI/GTK2/src/propertiesDialog.cc	2007-10-13 13:56:29 UTC (rev 1035)
@@ -18,11 +18,13 @@
 
 #include <stdio.h>
 #include <iostream>
+#include <fstream>
 #include <utility>
 
 #include "config.h"
 #include "Languages.h"
 #include "NLS.h"
+#include "XapianIndex.h"
 #include "PinotSettings.h"
 #include "PinotUtils.h"
 #include "propertiesDialog.hh"
@@ -31,27 +33,64 @@
 using namespace Glib;
 using namespace Gtk;
 
-propertiesDialog::propertiesDialog(const std::set<std::string> &docLabels,
-	const DocumentInfo &docInfo, unsigned int termsCount, bool editDocument) :
+propertiesDialog::propertiesDialog(const string &indexLocation,
+	const vector<DocumentInfo> &documentsList) :
 	propertiesDialog_glade(),
-	m_editDocument(editDocument),
-	m_docInfo(docInfo)
+	m_indexLocation(indexLocation),
+	m_docId(0),
+	m_editDocument(false)
 {
-	string language(docInfo.getLanguage());
+	set<string> docLabels;
+	string language;
+	unsigned int termsCount = 0;
+	bool notALanguageName = false;
 	char numStr[128];
-	unsigned int indexId = 0;
-	bool notALanguageName = false;
 
-	// Get the document ID
-	unsigned int docId = docInfo.getIsIndexed(indexId);
+	IndexInterface *pIndex = PinotSettings::getInstance().getIndex(m_indexLocation);
+	if ((pIndex == NULL) ||
+		(pIndex->isGood() == false))
+	{
+		if (pIndex != NULL)
+		{
+			delete pIndex;
+		}
+		return;
+	}
+
+	// If there's only one document selected, get its labels
+	if (documentsList.size() == 1)
+	{
+		vector<DocumentInfo>::const_iterator docIter = documentsList.begin();
+		unsigned int indexId = 0;
+
+		// Get the document ID
+		m_docId = docIter->getIsIndexed(indexId);
 #ifdef DEBUG
-	cout << "propertiesDialog: document " << docId << endl;
+		cout << "propertiesDialog::propertiesDialog: document " << m_docId << " in index " << indexId << endl;
 #endif
-	if (docId > 0)
+		if (m_docId > 0)
+		{
+			// Get the properties from the index because they may have been altered
+			// for display purposes
+			pIndex->getDocumentInfo(m_docId, m_docInfo);
+			pIndex->getDocumentLabels(m_docId, docLabels);
+			m_docInfo.setIsIndexed(indexId, m_docId);
+			termsCount = pIndex->getDocumentTermsCount(m_docId);
+			language = m_docInfo.getLanguage();
+			m_editDocument = true;
+
+			snprintf(numStr, 128, "%u", m_docId);
+			set_title(get_title() + " (ID " + numStr + ")");
+		}
+	}
+	else
 	{
-		snprintf(numStr, 128, "%u", docId);
-		set_title(get_title() + " (ID " + numStr + ")");
+		// Leave the labels list blank
+		// FIXME: if all documents are of the same language, show it
+		language = _("Per document");
+		notALanguageName = true;
 	}
+	delete pIndex;
 
 	// Associate the columns model to the labels tree
 	m_refLabelsTree = ListStore::create(m_labelsColumns);
@@ -63,10 +102,10 @@
 
 	if (m_editDocument == true)
 	{
-		unsigned int size = docInfo.getSize();
+		unsigned int size = m_docInfo.getSize();
 
-		titleEntry->set_text(to_utf8(docInfo.getTitle()));
-		typeEntry->set_text(to_utf8(docInfo.getType()));
+		titleEntry->set_text(to_utf8(m_docInfo.getTitle()));
+		typeEntry->set_text(to_utf8(m_docInfo.getType()));
 		if (size == 0)
 		{
 			sizeEntry->set_text(_("Unknown"));
@@ -88,12 +127,6 @@
 	}
 	else
 	{
-		if (language.empty() == true)
-		{
-			language = _("Per document"); 
-			notALanguageName = true;
-		}
-
 		titleLabel->hide();
 		titleEntry->hide();
 		typeLabel->hide();
@@ -102,6 +135,7 @@
 		sizeEntry->hide();
 		termsLabel->hide();
 		termsEntry->hide();
+		saveTermsButton->hide();
 	}
 
 	populate_languageCombobox(language, notALanguageName);
@@ -169,6 +203,7 @@
 		{
 			// Yup
 			row[m_labelsColumns.m_enabled] = true;
+			m_labels.insert(labelName);
 		}
 		else
 		{
@@ -227,6 +262,7 @@
 	}
 
 	// Go through the labels tree
+	m_labels.clear();
 	TreeModel::Children children = m_refLabelsTree->children();
 	if (children.empty() == false)
 	{
@@ -243,3 +279,47 @@
 		}
 	}
 }
+
+void propertiesDialog::on_saveTermsButton_clicked()
+{
+	ustring location(PinotSettings::getInstance().getHomeDirectory());
+
+	location += "/terms.txt";
+#ifdef DEBUG
+	cout << "propertiesDialog::on_saveTermsButton_clicked: " << location << endl;
+#endif
+
+	IndexInterface *pIndex = PinotSettings::getInstance().getIndex(m_indexLocation);
+	if ((pIndex == NULL) ||
+		(pIndex->isGood() == false))
+	{
+		if (pIndex != NULL)
+		{
+			delete pIndex;
+		}
+		return;
+	}
+
+	if (select_file_name(_("Export Terms"), location, false) == true)
+	{
+		std::map<unsigned int, string> wordsMap;
+
+		if ((location.empty() == false) &&
+			(pIndex->getDocumentTerms(m_docId, wordsMap) == true))
+		{
+			ofstream termsFile;
+
+			termsFile.open(location.c_str());
+			if (termsFile.good() == true)
+			{
+				for (std::map<unsigned int, string>::const_iterator termIter = wordsMap.begin();
+					termIter != wordsMap.end(); ++termIter)
+				{
+					termsFile << termIter->second << " ";
+				}
+			}
+			termsFile.close();
+		}
+	}
+}
+

Modified: trunk/UI/GTK2/src/propertiesDialog.hh
===================================================================
--- trunk/UI/GTK2/src/propertiesDialog.hh	2007-10-13 08:31:22 UTC (rev 1034)
+++ trunk/UI/GTK2/src/propertiesDialog.hh	2007-10-13 13:56:29 UTC (rev 1035)
@@ -16,10 +16,11 @@
  *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
  */
 
-#ifndef _LABELDIALOG_HH
-#define _LABELDIALOG_HH
+#ifndef _PROPERTIESDIALOG_HH
+#define _PROPERTIESDIALOG_HH
 
 #include <string>
+#include <vector>
 #include <set>
 #include <glibmm/refptr.h>
 #include <gtkmm/liststore.h>
@@ -31,9 +32,8 @@
 class propertiesDialog : public propertiesDialog_glade
 {  
 public:
-	propertiesDialog(const std::set<std::string> &docLabels,
-		const DocumentInfo &docInfo, unsigned int termsCount,
-		bool editDocument = true);
+	propertiesDialog(const std::string &indexLocation,
+	        const std::vector<DocumentInfo> &documentsList);
 	virtual ~propertiesDialog();
 
 	void setHeight(int maxHeight);
@@ -45,7 +45,9 @@
 protected:
 	LabelModelColumns m_labelsColumns;
 	Glib::RefPtr<Gtk::ListStore> m_refLabelsTree;
+	std::string m_indexLocation;
 	std::set<std::string> m_labels;
+	unsigned int m_docId;
 	bool m_editDocument;
 	DocumentInfo m_docInfo;
 
@@ -53,7 +55,8 @@
 
 	void populate_labelsTreeview(const std::set<std::string> &docLabels);
 
-	void on_labelOkButton_clicked();
+	virtual void on_labelOkButton_clicked();
+	virtual void on_saveTermsButton_clicked();
 
 };
-#endif // _LABELDIALOG_HH
+#endif

Modified: trunk/UI/GTK2/src/propertiesDialog_glade.cc
===================================================================
--- trunk/UI/GTK2/src/propertiesDialog_glade.cc	2007-10-13 08:31:22 UTC (rev 1034)
+++ trunk/UI/GTK2/src/propertiesDialog_glade.cc	2007-10-13 13:56:29 UTC (rev 1035)
@@ -1,9 +1,9 @@
-// generated 2007/1/22 22:28:26 SGT by fabrice at amra.dyndns.org.(none)
+// generated 2007/10/5 15:58:25 SGT by fabrice at amra.dyndns.org.(none)
 // using glademm V2.12.1
 //
 // DO NOT EDIT THIS FILE ! It was created using
 // glade-- /home/fabrice/Projects/MetaSE/pinot/UI/GTK2/metase-gtk2.glade
-// for gtk 2.10.4 and gtkmm 2.10.5
+// for gtk 2.10.14 and gtkmm 2.10.11
 //
 // Please modify the corresponding derived classes in ./src/propertiesDialog.cc
 
@@ -39,10 +39,10 @@
 #include <gtkmm/accelgroup.h>
 #include <gtkmm/button.h>
 #include <gtkmm/buttonbox.h>
+#include <gtkmm/box.h>
 #include <gtkmm/table.h>
 #include <gtkmm/viewport.h>
 #include <gtkmm/adjustment.h>
-#include <gtkmm/box.h>
 #ifndef ENABLE_NLS
 #  define textdomain(String) (String)
 #  define gettext(String) (String)
@@ -69,9 +69,11 @@
    typeLabel = Gtk::manage(new class Gtk::Label(_("MIME type:")));
    sizeLabel = Gtk::manage(new class Gtk::Label(_("Size:")));
    sizeEntry = Gtk::manage(new class Gtk::Entry());
+   termsLabel = Gtk::manage(new class Gtk::Label(_("Terms:")));
    termsEntry = Gtk::manage(new class Gtk::Entry());
-   termsLabel = Gtk::manage(new class Gtk::Label(_("Terms:")));
+   saveTermsButton = Gtk::manage(new class Gtk::Button(Gtk::StockID("gtk-save-as")));
    
+   Gtk::HBox *termsHbox = Gtk::manage(new class Gtk::HBox(false, 0));
    Gtk::Table *propertiesTable = Gtk::manage(new class Gtk::Table(2, 2, false));
    labelsTreeview = Gtk::manage(new class Gtk::TreeView());
    
@@ -128,18 +130,22 @@
    sizeEntry->set_max_length(0);
    sizeEntry->set_has_frame(true);
    sizeEntry->set_activates_default(false);
+   termsLabel->set_alignment(0,0.5);
+   termsLabel->set_padding(0,0);
+   termsLabel->set_justify(Gtk::JUSTIFY_LEFT);
+   termsLabel->set_line_wrap(false);
+   termsLabel->set_use_markup(false);
+   termsLabel->set_selectable(false);
    termsEntry->set_flags(Gtk::CAN_FOCUS);
    termsEntry->set_visibility(true);
    termsEntry->set_editable(false);
    termsEntry->set_max_length(0);
    termsEntry->set_has_frame(true);
    termsEntry->set_activates_default(false);
-   termsLabel->set_alignment(0,0.5);
-   termsLabel->set_padding(0,0);
-   termsLabel->set_justify(Gtk::JUSTIFY_LEFT);
-   termsLabel->set_line_wrap(false);
-   termsLabel->set_use_markup(false);
-   termsLabel->set_selectable(false);
+   saveTermsButton->set_flags(Gtk::CAN_FOCUS);
+   saveTermsButton->set_relief(Gtk::RELIEF_NORMAL);
+   termsHbox->pack_start(*termsEntry, Gtk::PACK_EXPAND_WIDGET, 4);
+   termsHbox->pack_start(*saveTermsButton, Gtk::PACK_SHRINK, 4);
    propertiesTable->set_row_spacings(0);
    propertiesTable->set_col_spacings(0);
    propertiesTable->attach(*titleEntry, 1, 2, 0, 1, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
@@ -150,8 +156,8 @@
    propertiesTable->attach(*typeLabel, 0, 1, 2, 3, Gtk::FILL, Gtk::FILL, 4, 4);
    propertiesTable->attach(*sizeLabel, 0, 1, 3, 4, Gtk::FILL, Gtk::FILL, 4, 4);
    propertiesTable->attach(*sizeEntry, 1, 2, 3, 4, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
-   propertiesTable->attach(*termsEntry, 1, 2, 4, 5, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
    propertiesTable->attach(*termsLabel, 0, 1, 4, 5, Gtk::FILL, Gtk::FILL, 4, 4);
+   propertiesTable->attach(*termsHbox, 1, 2, 4, 5, Gtk::FILL, Gtk::FILL, 0, 0);
    labelsTreeview->set_flags(Gtk::CAN_FOCUS);
    labelsTreeview->set_headers_visible(true);
    labelsTreeview->set_rules_hint(false);
@@ -192,14 +198,17 @@
    typeLabel->show();
    sizeLabel->show();
    sizeEntry->show();
+   termsLabel->show();
    termsEntry->show();
-   termsLabel->show();
+   saveTermsButton->show();
+   termsHbox->show();
    propertiesTable->show();
    labelsTreeview->show();
    viewport1->show();
    labelsScrolledwindow->show();
    propertiesVbox->show();
    labelOkButton->signal_clicked().connect(SigC::slot(*this, &propertiesDialog_glade::on_labelOkButton_clicked), false);
+   saveTermsButton->signal_clicked().connect(SigC::slot(*this, &propertiesDialog_glade::on_saveTermsButton_clicked), false);
 }
 
 propertiesDialog_glade::~propertiesDialog_glade()

Modified: trunk/UI/GTK2/src/propertiesDialog_glade.hh
===================================================================
--- trunk/UI/GTK2/src/propertiesDialog_glade.hh	2007-10-13 08:31:22 UTC (rev 1034)
+++ trunk/UI/GTK2/src/propertiesDialog_glade.hh	2007-10-13 13:56:29 UTC (rev 1035)
@@ -1,9 +1,9 @@
-// generated 2007/1/22 22:22:59 SGT by fabrice at amra.dyndns.org.(none)
+// generated 2007/10/5 15:58:25 SGT by fabrice at amra.dyndns.org.(none)
 // using glademm V2.12.1
 //
 // DO NOT EDIT THIS FILE ! It was created using
 // glade-- /home/fabrice/Projects/MetaSE/pinot/UI/GTK2/metase-gtk2.glade
-// for gtk 2.10.4 and gtkmm 2.10.5
+// for gtk 2.10.14 and gtkmm 2.10.11
 //
 // Please modify the corresponding derived classes in ./src/propertiesDialog.hh and./src/propertiesDialog.cc
 
@@ -55,8 +55,9 @@
         class Gtk::Label * typeLabel;
         class Gtk::Label * sizeLabel;
         class Gtk::Entry * sizeEntry;
+        class Gtk::Label * termsLabel;
         class Gtk::Entry * termsEntry;
-        class Gtk::Label * termsLabel;
+        class Gtk::Button * saveTermsButton;
         class Gtk::TreeView * labelsTreeview;
         class Gtk::ScrolledWindow * labelsScrolledwindow;
         
@@ -65,5 +66,6 @@
         ~propertiesDialog_glade();
 private:
         virtual void on_labelOkButton_clicked() = 0;
+        virtual void on_saveTermsButton_clicked() = 0;
 };
 #endif



From fabricecolin at mail.berlios.de  Sun Oct 14 11:05:37 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sun, 14 Oct 2007 11:05:37 +0200
Subject: [Pinot-svn] r1036 - trunk/UI/GTK2/src
Message-ID: <200710140905.l9E95b4m014544@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-14 11:05:37 +0200 (Sun, 14 Oct 2007)
New Revision: 1036

Modified:
   trunk/UI/GTK2/src/PinotSettings.cpp
   trunk/UI/GTK2/src/queryDialog.cc
Log:
Removed unused variables.


Modified: trunk/UI/GTK2/src/PinotSettings.cpp
===================================================================
--- trunk/UI/GTK2/src/PinotSettings.cpp	2007-10-13 13:56:29 UTC (rev 1035)
+++ trunk/UI/GTK2/src/PinotSettings.cpp	2007-10-14 09:05:37 UTC (rev 1036)
@@ -1302,8 +1302,6 @@
 				return false;
 			}
 
-			unsigned int day, month, year;
-
 			addChildElement(pElem, "name", queryIter->first);
 			addChildElement(pElem, "sortorder", (queryIter->second.getSortOrder() == QueryProperties::DATE ? "DATE" : "RELEVANCE"));
 			addChildElement(pElem, "text", queryIter->second.getFreeQuery());

Modified: trunk/UI/GTK2/src/queryDialog.cc
===================================================================
--- trunk/UI/GTK2/src/queryDialog.cc	2007-10-13 13:56:29 UTC (rev 1035)
+++ trunk/UI/GTK2/src/queryDialog.cc	2007-10-14 09:05:37 UTC (rev 1036)
@@ -38,8 +38,6 @@
 	m_properties(properties),
 	m_badName(true)
 {
-	unsigned int day, month, year;
-
 	// Name
 	if (m_name.empty() == true)
 	{



From fabricecolin at mail.berlios.de  Sun Oct 14 11:06:55 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sun, 14 Oct 2007 11:06:55 +0200
Subject: [Pinot-svn] r1037 - in trunk/UI/GTK2: . src
Message-ID: <200710140906.l9E96tif014598@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-14 11:06:54 +0200 (Sun, 14 Oct 2007)
New Revision: 1037

Modified:
   trunk/UI/GTK2/metase-gtk2.glade
   trunk/UI/GTK2/src/propertiesDialog.cc
   trunk/UI/GTK2/src/propertiesDialog_glade.cc
   trunk/UI/GTK2/src/propertiesDialog_glade.hh
Log:
Reorganized the properties dialog box a bit.


Modified: trunk/UI/GTK2/metase-gtk2.glade
===================================================================
--- trunk/UI/GTK2/metase-gtk2.glade	2007-10-14 09:05:37 UTC (rev 1036)
+++ trunk/UI/GTK2/metase-gtk2.glade	2007-10-14 09:06:54 UTC (rev 1037)
@@ -2729,310 +2729,364 @@
 	  <property name="spacing">0</property>
 
 	  <child>
-	    <widget class="GtkTable" id="propertiesTable">
+	    <widget class="GtkHBox" id="propertiesHbox">
 	      <property name="visible">True</property>
-	      <property name="n_rows">5</property>
-	      <property name="n_columns">2</property>
 	      <property name="homogeneous">False</property>
-	      <property name="row_spacing">0</property>
-	      <property name="column_spacing">0</property>
+	      <property name="spacing">0</property>
 
 	      <child>
-		<widget class="GtkEntry" id="titleEntry">
-		  <property agent="glademm" name="cxx_visibility">protected</property>
+		<widget class="GtkVBox" id="propsLeftVbox">
 		  <property name="visible">True</property>
-		  <property name="can_focus">True</property>
-		  <property name="editable">True</property>
-		  <property name="visibility">True</property>
-		  <property name="max_length">0</property>
-		  <property name="text" translatable="yes"></property>
-		  <property name="has_frame">True</property>
-		  <property name="invisible_char">*</property>
-		  <property name="activates_default">False</property>
-		</widget>
-		<packing>
-		  <property name="left_attach">1</property>
-		  <property name="right_attach">2</property>
-		  <property name="top_attach">0</property>
-		  <property name="bottom_attach">1</property>
-		  <property name="x_padding">4</property>
-		  <property name="y_padding">4</property>
-		  <property name="y_options">fill</property>
-		</packing>
-	      </child>
+		  <property name="homogeneous">False</property>
+		  <property name="spacing">0</property>
 
-	      <child>
-		<widget class="GtkEntry" id="typeEntry">
-		  <property agent="glademm" name="cxx_visibility">protected</property>
-		  <property name="visible">True</property>
-		  <property name="can_focus">True</property>
-		  <property name="editable">False</property>
-		  <property name="visibility">True</property>
-		  <property name="max_length">0</property>
-		  <property name="text" translatable="yes"></property>
-		  <property name="has_frame">True</property>
-		  <property name="invisible_char">*</property>
-		  <property name="activates_default">False</property>
-		</widget>
-		<packing>
-		  <property name="left_attach">1</property>
-		  <property name="right_attach">2</property>
-		  <property name="top_attach">2</property>
-		  <property name="bottom_attach">3</property>
-		  <property name="x_padding">4</property>
-		  <property name="y_padding">4</property>
-		  <property name="y_options">fill</property>
-		</packing>
-	      </child>
+		  <child>
+		    <widget class="GtkLabel" id="titleLabel">
+		      <property agent="glademm" name="cxx_visibility">protected</property>
+		      <property name="visible">True</property>
+		      <property name="label" translatable="yes">Title:</property>
+		      <property name="use_underline">False</property>
+		      <property name="use_markup">False</property>
+		      <property name="justify">GTK_JUSTIFY_LEFT</property>
+		      <property name="wrap">False</property>
+		      <property name="selectable">False</property>
+		      <property name="xalign">0</property>
+		      <property name="yalign">0.5</property>
+		      <property name="xpad">0</property>
+		      <property name="ypad">0</property>
+		      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+		      <property name="width_chars">-1</property>
+		      <property name="single_line_mode">False</property>
+		      <property name="angle">0</property>
+		    </widget>
+		    <packing>
+		      <property name="padding">4</property>
+		      <property name="expand">True</property>
+		      <property name="fill">True</property>
+		    </packing>
+		  </child>
 
-	      <child>
-		<widget class="GtkComboBox" id="languageCombobox">
-		  <property agent="glademm" name="cxx_visibility">protected</property>
-		  <property name="visible">True</property>
-		  <property name="add_tearoffs">False</property>
-		  <property name="focus_on_click">True</property>
-		</widget>
-		<packing>
-		  <property name="left_attach">1</property>
-		  <property name="right_attach">2</property>
-		  <property name="top_attach">1</property>
-		  <property name="bottom_attach">2</property>
-		  <property name="x_padding">4</property>
-		  <property name="y_padding">4</property>
-		  <property name="y_options">fill</property>
-		</packing>
-	      </child>
+		  <child>
+		    <widget class="GtkLabel" id="languageLabel">
+		      <property agent="glademm" name="cxx_visibility">protected</property>
+		      <property name="visible">True</property>
+		      <property name="label" translatable="yes">Language:</property>
+		      <property name="use_underline">False</property>
+		      <property name="use_markup">False</property>
+		      <property name="justify">GTK_JUSTIFY_LEFT</property>
+		      <property name="wrap">False</property>
+		      <property name="selectable">False</property>
+		      <property name="xalign">0</property>
+		      <property name="yalign">0.5</property>
+		      <property name="xpad">0</property>
+		      <property name="ypad">0</property>
+		      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+		      <property name="width_chars">-1</property>
+		      <property name="single_line_mode">False</property>
+		      <property name="angle">0</property>
+		    </widget>
+		    <packing>
+		      <property name="padding">4</property>
+		      <property name="expand">True</property>
+		      <property name="fill">True</property>
+		    </packing>
+		  </child>
 
-	      <child>
-		<widget class="GtkLabel" id="titleLabel">
-		  <property agent="glademm" name="cxx_visibility">protected</property>
-		  <property name="visible">True</property>
-		  <property name="label" translatable="yes">Title:</property>
-		  <property name="use_underline">False</property>
-		  <property name="use_markup">False</property>
-		  <property name="justify">GTK_JUSTIFY_LEFT</property>
-		  <property name="wrap">False</property>
-		  <property name="selectable">False</property>
-		  <property name="xalign">0</property>
-		  <property name="yalign">0.5</property>
-		  <property name="xpad">0</property>
-		  <property name="ypad">0</property>
-		  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-		  <property name="width_chars">-1</property>
-		  <property name="single_line_mode">False</property>
-		  <property name="angle">0</property>
-		</widget>
-		<packing>
-		  <property name="left_attach">0</property>
-		  <property name="right_attach">1</property>
-		  <property name="top_attach">0</property>
-		  <property name="bottom_attach">1</property>
-		  <property name="x_padding">4</property>
-		  <property name="y_padding">4</property>
-		  <property name="x_options">fill</property>
-		  <property name="y_options">fill</property>
-		</packing>
-	      </child>
+		  <child>
+		    <widget class="GtkLabel" id="typeLabel">
+		      <property agent="glademm" name="cxx_visibility">protected</property>
+		      <property name="visible">True</property>
+		      <property name="label" translatable="yes">MIME type:</property>
+		      <property name="use_underline">False</property>
+		      <property name="use_markup">False</property>
+		      <property name="justify">GTK_JUSTIFY_LEFT</property>
+		      <property name="wrap">False</property>
+		      <property name="selectable">False</property>
+		      <property name="xalign">0</property>
+		      <property name="yalign">0.5</property>
+		      <property name="xpad">0</property>
+		      <property name="ypad">0</property>
+		      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+		      <property name="width_chars">-1</property>
+		      <property name="single_line_mode">False</property>
+		      <property name="angle">0</property>
+		    </widget>
+		    <packing>
+		      <property name="padding">4</property>
+		      <property name="expand">True</property>
+		      <property name="fill">True</property>
+		    </packing>
+		  </child>
 
-	      <child>
-		<widget class="GtkLabel" id="languageLabel">
-		  <property agent="glademm" name="cxx_visibility">protected</property>
-		  <property name="visible">True</property>
-		  <property name="label" translatable="yes">Language:</property>
-		  <property name="use_underline">False</property>
-		  <property name="use_markup">False</property>
-		  <property name="justify">GTK_JUSTIFY_LEFT</property>
-		  <property name="wrap">False</property>
-		  <property name="selectable">False</property>
-		  <property name="xalign">0</property>
-		  <property name="yalign">0.5</property>
-		  <property name="xpad">0</property>
-		  <property name="ypad">0</property>
-		  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-		  <property name="width_chars">-1</property>
-		  <property name="single_line_mode">False</property>
-		  <property name="angle">0</property>
-		</widget>
-		<packing>
-		  <property name="left_attach">0</property>
-		  <property name="right_attach">1</property>
-		  <property name="top_attach">1</property>
-		  <property name="bottom_attach">2</property>
-		  <property name="x_padding">4</property>
-		  <property name="y_padding">4</property>
-		  <property name="x_options">fill</property>
-		  <property name="y_options">fill</property>
-		</packing>
-	      </child>
+		  <child>
+		    <widget class="GtkLabel" id="sizeLabel">
+		      <property agent="glademm" name="cxx_visibility">protected</property>
+		      <property name="visible">True</property>
+		      <property name="label" translatable="yes">Size:</property>
+		      <property name="use_underline">False</property>
+		      <property name="use_markup">False</property>
+		      <property name="justify">GTK_JUSTIFY_LEFT</property>
+		      <property name="wrap">False</property>
+		      <property name="selectable">False</property>
+		      <property name="xalign">0</property>
+		      <property name="yalign">0.5</property>
+		      <property name="xpad">0</property>
+		      <property name="ypad">0</property>
+		      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+		      <property name="width_chars">-1</property>
+		      <property name="single_line_mode">False</property>
+		      <property name="angle">0</property>
+		    </widget>
+		    <packing>
+		      <property name="padding">4</property>
+		      <property name="expand">True</property>
+		      <property name="fill">True</property>
+		    </packing>
+		  </child>
 
-	      <child>
-		<widget class="GtkLabel" id="typeLabel">
-		  <property agent="glademm" name="cxx_visibility">protected</property>
-		  <property name="visible">True</property>
-		  <property name="label" translatable="yes">MIME type:</property>
-		  <property name="use_underline">False</property>
-		  <property name="use_markup">False</property>
-		  <property name="justify">GTK_JUSTIFY_LEFT</property>
-		  <property name="wrap">False</property>
-		  <property name="selectable">False</property>
-		  <property name="xalign">0</property>
-		  <property name="yalign">0.5</property>
-		  <property name="xpad">0</property>
-		  <property name="ypad">0</property>
-		  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-		  <property name="width_chars">-1</property>
-		  <property name="single_line_mode">False</property>
-		  <property name="angle">0</property>
+		  <child>
+		    <widget class="GtkLabel" id="termsLabel">
+		      <property agent="glademm" name="cxx_visibility">protected</property>
+		      <property name="visible">True</property>
+		      <property name="label" translatable="yes">Terms:</property>
+		      <property name="use_underline">False</property>
+		      <property name="use_markup">False</property>
+		      <property name="justify">GTK_JUSTIFY_LEFT</property>
+		      <property name="wrap">False</property>
+		      <property name="selectable">False</property>
+		      <property name="xalign">0</property>
+		      <property name="yalign">0.5</property>
+		      <property name="xpad">0</property>
+		      <property name="ypad">0</property>
+		      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+		      <property name="width_chars">-1</property>
+		      <property name="single_line_mode">False</property>
+		      <property name="angle">0</property>
+		    </widget>
+		    <packing>
+		      <property name="padding">4</property>
+		      <property name="expand">True</property>
+		      <property name="fill">True</property>
+		    </packing>
+		  </child>
 		</widget>
 		<packing>
-		  <property name="left_attach">0</property>
-		  <property name="right_attach">1</property>
-		  <property name="top_attach">2</property>
-		  <property name="bottom_attach">3</property>
-		  <property name="x_padding">4</property>
-		  <property name="y_padding">4</property>
-		  <property name="x_options">fill</property>
-		  <property name="y_options">fill</property>
+		  <property name="padding">0</property>
+		  <property name="expand">True</property>
+		  <property name="fill">True</property>
 		</packing>
 	      </child>
 
 	      <child>
-		<widget class="GtkLabel" id="sizeLabel">
-		  <property agent="glademm" name="cxx_visibility">protected</property>
+		<widget class="GtkVBox" id="propsRightVbox">
 		  <property name="visible">True</property>
-		  <property name="label" translatable="yes">Size:</property>
-		  <property name="use_underline">False</property>
-		  <property name="use_markup">False</property>
-		  <property name="justify">GTK_JUSTIFY_LEFT</property>
-		  <property name="wrap">False</property>
-		  <property name="selectable">False</property>
-		  <property name="xalign">0</property>
-		  <property name="yalign">0.5</property>
-		  <property name="xpad">0</property>
-		  <property name="ypad">0</property>
-		  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-		  <property name="width_chars">-1</property>
-		  <property name="single_line_mode">False</property>
-		  <property name="angle">0</property>
-		</widget>
-		<packing>
-		  <property name="left_attach">0</property>
-		  <property name="right_attach">1</property>
-		  <property name="top_attach">3</property>
-		  <property name="bottom_attach">4</property>
-		  <property name="x_padding">4</property>
-		  <property name="y_padding">4</property>
-		  <property name="x_options">fill</property>
-		  <property name="y_options">fill</property>
-		</packing>
-	      </child>
-
-	      <child>
-		<widget class="GtkEntry" id="sizeEntry">
-		  <property agent="glademm" name="cxx_visibility">protected</property>
-		  <property name="visible">True</property>
-		  <property name="can_focus">True</property>
-		  <property name="editable">False</property>
-		  <property name="visibility">True</property>
-		  <property name="max_length">0</property>
-		  <property name="text" translatable="yes"></property>
-		  <property name="has_frame">True</property>
-		  <property name="invisible_char">*</property>
-		  <property name="activates_default">False</property>
-		</widget>
-		<packing>
-		  <property name="left_attach">1</property>
-		  <property name="right_attach">2</property>
-		  <property name="top_attach">3</property>
-		  <property name="bottom_attach">4</property>
-		  <property name="x_padding">4</property>
-		  <property name="y_padding">4</property>
-		  <property name="y_options">fill</property>
-		</packing>
-	      </child>
-
-	      <child>
-		<widget class="GtkLabel" id="termsLabel">
-		  <property agent="glademm" name="cxx_visibility">protected</property>
-		  <property name="visible">True</property>
-		  <property name="label" translatable="yes">Terms:</property>
-		  <property name="use_underline">False</property>
-		  <property name="use_markup">False</property>
-		  <property name="justify">GTK_JUSTIFY_LEFT</property>
-		  <property name="wrap">False</property>
-		  <property name="selectable">False</property>
-		  <property name="xalign">0</property>
-		  <property name="yalign">0.5</property>
-		  <property name="xpad">0</property>
-		  <property name="ypad">0</property>
-		  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-		  <property name="width_chars">-1</property>
-		  <property name="single_line_mode">False</property>
-		  <property name="angle">0</property>
-		</widget>
-		<packing>
-		  <property name="left_attach">0</property>
-		  <property name="right_attach">1</property>
-		  <property name="top_attach">4</property>
-		  <property name="bottom_attach">5</property>
-		  <property name="x_padding">4</property>
-		  <property name="y_padding">4</property>
-		  <property name="x_options">fill</property>
-		  <property name="y_options">fill</property>
-		</packing>
-	      </child>
-
-	      <child>
-		<widget class="GtkHBox" id="termsHbox">
-		  <property name="visible">True</property>
 		  <property name="homogeneous">False</property>
 		  <property name="spacing">0</property>
 
 		  <child>
-		    <widget class="GtkEntry" id="termsEntry">
-		      <property agent="glademm" name="cxx_visibility">protected</property>
+		    <widget class="GtkTable" id="propertiesFirstTable">
 		      <property name="visible">True</property>
-		      <property name="can_focus">True</property>
-		      <property name="editable">False</property>
-		      <property name="visibility">True</property>
-		      <property name="max_length">0</property>
-		      <property name="text" translatable="yes"></property>
-		      <property name="has_frame">True</property>
-		      <property name="invisible_char">*</property>
-		      <property name="activates_default">False</property>
+		      <property name="n_rows">3</property>
+		      <property name="n_columns">1</property>
+		      <property name="homogeneous">False</property>
+		      <property name="row_spacing">0</property>
+		      <property name="column_spacing">0</property>
+
+		      <child>
+			<widget class="GtkEntry" id="titleEntry">
+			  <property agent="glademm" name="cxx_visibility">protected</property>
+			  <property name="visible">True</property>
+			  <property name="can_focus">True</property>
+			  <property name="editable">True</property>
+			  <property name="visibility">True</property>
+			  <property name="max_length">0</property>
+			  <property name="text" translatable="yes"></property>
+			  <property name="has_frame">True</property>
+			  <property name="invisible_char">*</property>
+			  <property name="activates_default">False</property>
+			</widget>
+			<packing>
+			  <property name="left_attach">0</property>
+			  <property name="right_attach">1</property>
+			  <property name="top_attach">0</property>
+			  <property name="bottom_attach">1</property>
+			  <property name="x_padding">4</property>
+			  <property name="y_padding">4</property>
+			  <property name="y_options">fill</property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkEntry" id="typeEntry">
+			  <property agent="glademm" name="cxx_visibility">protected</property>
+			  <property name="visible">True</property>
+			  <property name="can_focus">True</property>
+			  <property name="editable">False</property>
+			  <property name="visibility">True</property>
+			  <property name="max_length">0</property>
+			  <property name="text" translatable="yes"></property>
+			  <property name="has_frame">True</property>
+			  <property name="invisible_char">*</property>
+			  <property name="activates_default">False</property>
+			</widget>
+			<packing>
+			  <property name="left_attach">0</property>
+			  <property name="right_attach">1</property>
+			  <property name="top_attach">2</property>
+			  <property name="bottom_attach">3</property>
+			  <property name="x_padding">4</property>
+			  <property name="y_padding">4</property>
+			  <property name="y_options">fill</property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkComboBox" id="languageCombobox">
+			  <property agent="glademm" name="cxx_visibility">protected</property>
+			  <property name="visible">True</property>
+			  <property name="add_tearoffs">False</property>
+			  <property name="focus_on_click">True</property>
+			</widget>
+			<packing>
+			  <property name="left_attach">0</property>
+			  <property name="right_attach">1</property>
+			  <property name="top_attach">1</property>
+			  <property name="bottom_attach">2</property>
+			  <property name="x_padding">4</property>
+			  <property name="y_padding">4</property>
+			  <property name="y_options">fill</property>
+			</packing>
+		      </child>
 		    </widget>
 		    <packing>
-		      <property name="padding">4</property>
+		      <property name="padding">0</property>
 		      <property name="expand">True</property>
 		      <property name="fill">True</property>
 		    </packing>
 		  </child>
 
 		  <child>
-		    <widget class="GtkButton" id="saveTermsButton">
-		      <property agent="glademm" name="cxx_visibility">protected</property>
+		    <widget class="GtkTable" id="propertiesSecondTable">
 		      <property name="visible">True</property>
-		      <property name="can_focus">True</property>
-		      <property name="label">gtk-save-as</property>
-		      <property name="use_stock">True</property>
-		      <property name="relief">GTK_RELIEF_NORMAL</property>
-		      <property name="focus_on_click">True</property>
-		      <signal name="clicked" handler="on_saveTermsButton_clicked" last_modification_time="Fri, 05 Oct 2007 07:57:40 GMT"/>
+		      <property name="n_rows">2</property>
+		      <property name="n_columns">2</property>
+		      <property name="homogeneous">False</property>
+		      <property name="row_spacing">0</property>
+		      <property name="column_spacing">0</property>
+
+		      <child>
+			<widget class="GtkEntry" id="sizeEntry">
+			  <property agent="glademm" name="cxx_visibility">protected</property>
+			  <property name="visible">True</property>
+			  <property name="can_focus">True</property>
+			  <property name="editable">False</property>
+			  <property name="visibility">True</property>
+			  <property name="max_length">0</property>
+			  <property name="text" translatable="yes"></property>
+			  <property name="has_frame">True</property>
+			  <property name="invisible_char">*</property>
+			  <property name="activates_default">False</property>
+			</widget>
+			<packing>
+			  <property name="left_attach">0</property>
+			  <property name="right_attach">1</property>
+			  <property name="top_attach">0</property>
+			  <property name="bottom_attach">1</property>
+			  <property name="x_padding">4</property>
+			  <property name="y_padding">4</property>
+			  <property name="y_options">fill</property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkEntry" id="termsEntry">
+			  <property agent="glademm" name="cxx_visibility">protected</property>
+			  <property name="visible">True</property>
+			  <property name="can_focus">True</property>
+			  <property name="editable">False</property>
+			  <property name="visibility">True</property>
+			  <property name="max_length">0</property>
+			  <property name="text" translatable="yes"></property>
+			  <property name="has_frame">True</property>
+			  <property name="invisible_char">*</property>
+			  <property name="activates_default">False</property>
+			</widget>
+			<packing>
+			  <property name="left_attach">0</property>
+			  <property name="right_attach">1</property>
+			  <property name="top_attach">1</property>
+			  <property name="bottom_attach">2</property>
+			  <property name="x_padding">4</property>
+			  <property name="y_padding">4</property>
+			  <property name="y_options">fill</property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkLabel" id="bytesLabel">
+			  <property agent="glademm" name="cxx_visibility">protected</property>
+			  <property name="visible">True</property>
+			  <property name="label" translatable="yes">bytes</property>
+			  <property name="use_underline">False</property>
+			  <property name="use_markup">False</property>
+			  <property name="justify">GTK_JUSTIFY_LEFT</property>
+			  <property name="wrap">False</property>
+			  <property name="selectable">False</property>
+			  <property name="xalign">0</property>
+			  <property name="yalign">0.5</property>
+			  <property name="xpad">0</property>
+			  <property name="ypad">0</property>
+			  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+			  <property name="width_chars">-1</property>
+			  <property name="single_line_mode">False</property>
+			  <property name="angle">0</property>
+			</widget>
+			<packing>
+			  <property name="left_attach">1</property>
+			  <property name="right_attach">2</property>
+			  <property name="top_attach">0</property>
+			  <property name="bottom_attach">1</property>
+			  <property name="x_padding">4</property>
+			  <property name="y_padding">4</property>
+			  <property name="x_options">fill</property>
+			  <property name="y_options">fill</property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkButton" id="saveTermsButton">
+			  <property agent="glademm" name="cxx_visibility">protected</property>
+			  <property name="visible">True</property>
+			  <property name="can_focus">True</property>
+			  <property name="label">gtk-save-as</property>
+			  <property name="use_stock">True</property>
+			  <property name="relief">GTK_RELIEF_NORMAL</property>
+			  <property name="focus_on_click">True</property>
+			  <signal name="clicked" handler="on_saveTermsButton_clicked" last_modification_time="Fri, 05 Oct 2007 07:57:40 GMT"/>
+			</widget>
+			<packing>
+			  <property name="left_attach">1</property>
+			  <property name="right_attach">2</property>
+			  <property name="top_attach">1</property>
+			  <property name="bottom_attach">2</property>
+			  <property name="x_padding">4</property>
+			  <property name="y_padding">4</property>
+			  <property name="x_options">fill</property>
+			  <property name="y_options">fill</property>
+			</packing>
+		      </child>
 		    </widget>
 		    <packing>
-		      <property name="padding">4</property>
-		      <property name="expand">False</property>
-		      <property name="fill">False</property>
+		      <property name="padding">0</property>
+		      <property name="expand">True</property>
+		      <property name="fill">True</property>
 		    </packing>
 		  </child>
 		</widget>
 		<packing>
-		  <property name="left_attach">1</property>
-		  <property name="right_attach">2</property>
-		  <property name="top_attach">4</property>
-		  <property name="bottom_attach">5</property>
-		  <property name="x_options">fill</property>
-		  <property name="y_options">fill</property>
+		  <property name="padding">0</property>
+		  <property name="expand">True</property>
+		  <property name="fill">True</property>
 		</packing>
 	      </child>
 	    </widget>

Modified: trunk/UI/GTK2/src/propertiesDialog.cc
===================================================================
--- trunk/UI/GTK2/src/propertiesDialog.cc	2007-10-14 09:05:37 UTC (rev 1036)
+++ trunk/UI/GTK2/src/propertiesDialog.cc	2007-10-14 09:06:54 UTC (rev 1037)
@@ -85,10 +85,31 @@
 	}
 	else
 	{
+		string perDoc(_("Per document"));
+
 		// Leave the labels list blank
-		// FIXME: if all documents are of the same language, show it
-		language = _("Per document");
-		notALanguageName = true;
+		// If all documents are of the same language, show it
+		for (vector<DocumentInfo>::const_iterator docIter = documentsList.begin();
+			docIter != documentsList.end(); ++docIter)
+		{
+#ifdef DEBUG
+			cout << "propertiesDialog::propertiesDialog: language " << docIter->getLanguage() << endl;
+#endif
+			if (language.empty() == true)
+			{
+				language = docIter->getLanguage();
+			}
+			else if (language != docIter->getLanguage())
+			{
+				language = perDoc;
+				notALanguageName = true;
+			}
+		}
+		if (language.empty() == true)
+		{
+			language = perDoc;
+			notALanguageName = true;
+		}
 	}
 	delete pIndex;
 
@@ -132,6 +153,7 @@
 		typeLabel->hide();
 		typeEntry->hide();
 		sizeLabel->hide();
+		bytesLabel->hide();
 		sizeEntry->hide();
 		termsLabel->hide();
 		termsEntry->hide();

Modified: trunk/UI/GTK2/src/propertiesDialog_glade.cc
===================================================================
--- trunk/UI/GTK2/src/propertiesDialog_glade.cc	2007-10-14 09:05:37 UTC (rev 1036)
+++ trunk/UI/GTK2/src/propertiesDialog_glade.cc	2007-10-14 09:06:54 UTC (rev 1037)
@@ -1,4 +1,4 @@
-// generated 2007/10/5 15:58:25 SGT by fabrice at amra.dyndns.org.(none)
+// generated 2007/10/14 16:21:28 SGT by fabrice at amra.dyndns.org.(none)
 // using glademm V2.12.1
 //
 // DO NOT EDIT THIS FILE ! It was created using
@@ -61,20 +61,26 @@
    
    Gtk::Button *cancelbutton2 = Gtk::manage(new class Gtk::Button(Gtk::StockID("gtk-cancel")));
    labelOkButton = Gtk::manage(new class Gtk::Button(Gtk::StockID("gtk-ok")));
-   titleEntry = Gtk::manage(new class Gtk::Entry());
-   typeEntry = Gtk::manage(new class Gtk::Entry());
-   languageCombobox = Gtk::manage(new class Gtk::ComboBoxText());
    titleLabel = Gtk::manage(new class Gtk::Label(_("Title:")));
    languageLabel = Gtk::manage(new class Gtk::Label(_("Language:")));
    typeLabel = Gtk::manage(new class Gtk::Label(_("MIME type:")));
    sizeLabel = Gtk::manage(new class Gtk::Label(_("Size:")));
+   termsLabel = Gtk::manage(new class Gtk::Label(_("Terms:")));
+   
+   Gtk::VBox *propsLeftVbox = Gtk::manage(new class Gtk::VBox(false, 0));
+   titleEntry = Gtk::manage(new class Gtk::Entry());
+   typeEntry = Gtk::manage(new class Gtk::Entry());
+   languageCombobox = Gtk::manage(new class Gtk::ComboBoxText());
+   
+   Gtk::Table *propertiesFirstTable = Gtk::manage(new class Gtk::Table(2, 2, false));
    sizeEntry = Gtk::manage(new class Gtk::Entry());
-   termsLabel = Gtk::manage(new class Gtk::Label(_("Terms:")));
    termsEntry = Gtk::manage(new class Gtk::Entry());
+   bytesLabel = Gtk::manage(new class Gtk::Label(_("bytes")));
    saveTermsButton = Gtk::manage(new class Gtk::Button(Gtk::StockID("gtk-save-as")));
    
-   Gtk::HBox *termsHbox = Gtk::manage(new class Gtk::HBox(false, 0));
-   Gtk::Table *propertiesTable = Gtk::manage(new class Gtk::Table(2, 2, false));
+   Gtk::Table *propertiesSecondTable = Gtk::manage(new class Gtk::Table(2, 2, false));
+   Gtk::VBox *propsRightVbox = Gtk::manage(new class Gtk::VBox(false, 0));
+   Gtk::HBox *propertiesHbox = Gtk::manage(new class Gtk::HBox(false, 0));
    labelsTreeview = Gtk::manage(new class Gtk::TreeView());
    
    Gtk::Viewport *viewport1 = Gtk::manage(new class Gtk::Viewport(*manage(new Gtk::Adjustment(0,0,1)), *manage(new Gtk::Adjustment(0,0,1))));
@@ -88,76 +94,112 @@
    labelOkButton->set_flags(Gtk::CAN_DEFAULT);
    labelOkButton->set_relief(Gtk::RELIEF_NORMAL);
    propertiesDialog->get_action_area()->property_layout_style().set_value(Gtk::BUTTONBOX_END);
-   titleEntry->set_flags(Gtk::CAN_FOCUS);
-   titleEntry->set_visibility(true);
-   titleEntry->set_editable(true);
-   titleEntry->set_max_length(0);
-   titleEntry->set_has_frame(true);
-   titleEntry->set_activates_default(false);
-   typeEntry->set_flags(Gtk::CAN_FOCUS);
-   typeEntry->set_visibility(true);
-   typeEntry->set_editable(false);
-   typeEntry->set_max_length(0);
-   typeEntry->set_has_frame(true);
-   typeEntry->set_activates_default(false);
    titleLabel->set_alignment(0,0.5);
    titleLabel->set_padding(0,0);
    titleLabel->set_justify(Gtk::JUSTIFY_LEFT);
    titleLabel->set_line_wrap(false);
    titleLabel->set_use_markup(false);
    titleLabel->set_selectable(false);
+   titleLabel->set_ellipsize(Pango::ELLIPSIZE_NONE);
+   titleLabel->set_width_chars(-1);
+   titleLabel->set_angle(0);
+   titleLabel->set_single_line_mode(false);
    languageLabel->set_alignment(0,0.5);
    languageLabel->set_padding(0,0);
    languageLabel->set_justify(Gtk::JUSTIFY_LEFT);
    languageLabel->set_line_wrap(false);
    languageLabel->set_use_markup(false);
    languageLabel->set_selectable(false);
+   languageLabel->set_ellipsize(Pango::ELLIPSIZE_NONE);
+   languageLabel->set_width_chars(-1);
+   languageLabel->set_angle(0);
+   languageLabel->set_single_line_mode(false);
    typeLabel->set_alignment(0,0.5);
    typeLabel->set_padding(0,0);
    typeLabel->set_justify(Gtk::JUSTIFY_LEFT);
    typeLabel->set_line_wrap(false);
    typeLabel->set_use_markup(false);
    typeLabel->set_selectable(false);
+   typeLabel->set_ellipsize(Pango::ELLIPSIZE_NONE);
+   typeLabel->set_width_chars(-1);
+   typeLabel->set_angle(0);
+   typeLabel->set_single_line_mode(false);
    sizeLabel->set_alignment(0,0.5);
    sizeLabel->set_padding(0,0);
    sizeLabel->set_justify(Gtk::JUSTIFY_LEFT);
    sizeLabel->set_line_wrap(false);
    sizeLabel->set_use_markup(false);
    sizeLabel->set_selectable(false);
+   sizeLabel->set_ellipsize(Pango::ELLIPSIZE_NONE);
+   sizeLabel->set_width_chars(-1);
+   sizeLabel->set_angle(0);
+   sizeLabel->set_single_line_mode(false);
+   termsLabel->set_alignment(0,0.5);
+   termsLabel->set_padding(0,0);
+   termsLabel->set_justify(Gtk::JUSTIFY_LEFT);
+   termsLabel->set_line_wrap(false);
+   termsLabel->set_use_markup(false);
+   termsLabel->set_selectable(false);
+   termsLabel->set_ellipsize(Pango::ELLIPSIZE_NONE);
+   termsLabel->set_width_chars(-1);
+   termsLabel->set_angle(0);
+   termsLabel->set_single_line_mode(false);
+   propsLeftVbox->pack_start(*titleLabel, Gtk::PACK_EXPAND_WIDGET, 4);
+   propsLeftVbox->pack_start(*languageLabel, Gtk::PACK_EXPAND_WIDGET, 4);
+   propsLeftVbox->pack_start(*typeLabel, Gtk::PACK_EXPAND_WIDGET, 4);
+   propsLeftVbox->pack_start(*sizeLabel, Gtk::PACK_EXPAND_WIDGET, 4);
+   propsLeftVbox->pack_start(*termsLabel, Gtk::PACK_EXPAND_WIDGET, 4);
+   titleEntry->set_flags(Gtk::CAN_FOCUS);
+   titleEntry->set_visibility(true);
+   titleEntry->set_editable(true);
+   titleEntry->set_max_length(0);
+   titleEntry->set_has_frame(true);
+   titleEntry->set_activates_default(false);
+   typeEntry->set_flags(Gtk::CAN_FOCUS);
+   typeEntry->set_visibility(true);
+   typeEntry->set_editable(false);
+   typeEntry->set_max_length(0);
+   typeEntry->set_has_frame(true);
+   typeEntry->set_activates_default(false);
+   propertiesFirstTable->set_row_spacings(0);
+   propertiesFirstTable->set_col_spacings(0);
+   propertiesFirstTable->attach(*titleEntry, 0, 1, 0, 1, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
+   propertiesFirstTable->attach(*typeEntry, 0, 1, 2, 3, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
+   propertiesFirstTable->attach(*languageCombobox, 0, 1, 1, 2, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
    sizeEntry->set_flags(Gtk::CAN_FOCUS);
    sizeEntry->set_visibility(true);
    sizeEntry->set_editable(false);
    sizeEntry->set_max_length(0);
    sizeEntry->set_has_frame(true);
    sizeEntry->set_activates_default(false);
-   termsLabel->set_alignment(0,0.5);
-   termsLabel->set_padding(0,0);
-   termsLabel->set_justify(Gtk::JUSTIFY_LEFT);
-   termsLabel->set_line_wrap(false);
-   termsLabel->set_use_markup(false);
-   termsLabel->set_selectable(false);
    termsEntry->set_flags(Gtk::CAN_FOCUS);
    termsEntry->set_visibility(true);
    termsEntry->set_editable(false);
    termsEntry->set_max_length(0);
    termsEntry->set_has_frame(true);
    termsEntry->set_activates_default(false);
+   bytesLabel->set_alignment(0,0.5);
+   bytesLabel->set_padding(0,0);
+   bytesLabel->set_justify(Gtk::JUSTIFY_LEFT);
+   bytesLabel->set_line_wrap(false);
+   bytesLabel->set_use_markup(false);
+   bytesLabel->set_selectable(false);
+   bytesLabel->set_ellipsize(Pango::ELLIPSIZE_NONE);
+   bytesLabel->set_width_chars(-1);
+   bytesLabel->set_angle(0);
+   bytesLabel->set_single_line_mode(false);
    saveTermsButton->set_flags(Gtk::CAN_FOCUS);
    saveTermsButton->set_relief(Gtk::RELIEF_NORMAL);
-   termsHbox->pack_start(*termsEntry, Gtk::PACK_EXPAND_WIDGET, 4);
-   termsHbox->pack_start(*saveTermsButton, Gtk::PACK_SHRINK, 4);
-   propertiesTable->set_row_spacings(0);
-   propertiesTable->set_col_spacings(0);
-   propertiesTable->attach(*titleEntry, 1, 2, 0, 1, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
-   propertiesTable->attach(*typeEntry, 1, 2, 2, 3, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
-   propertiesTable->attach(*languageCombobox, 1, 2, 1, 2, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
-   propertiesTable->attach(*titleLabel, 0, 1, 0, 1, Gtk::FILL, Gtk::FILL, 4, 4);
-   propertiesTable->attach(*languageLabel, 0, 1, 1, 2, Gtk::FILL, Gtk::FILL, 4, 4);
-   propertiesTable->attach(*typeLabel, 0, 1, 2, 3, Gtk::FILL, Gtk::FILL, 4, 4);
-   propertiesTable->attach(*sizeLabel, 0, 1, 3, 4, Gtk::FILL, Gtk::FILL, 4, 4);
-   propertiesTable->attach(*sizeEntry, 1, 2, 3, 4, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
-   propertiesTable->attach(*termsLabel, 0, 1, 4, 5, Gtk::FILL, Gtk::FILL, 4, 4);
-   propertiesTable->attach(*termsHbox, 1, 2, 4, 5, Gtk::FILL, Gtk::FILL, 0, 0);
+   propertiesSecondTable->set_row_spacings(0);
+   propertiesSecondTable->set_col_spacings(0);
+   propertiesSecondTable->attach(*sizeEntry, 0, 1, 0, 1, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
+   propertiesSecondTable->attach(*termsEntry, 0, 1, 1, 2, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
+   propertiesSecondTable->attach(*bytesLabel, 1, 2, 0, 1, Gtk::FILL, Gtk::FILL, 4, 4);
+   propertiesSecondTable->attach(*saveTermsButton, 1, 2, 1, 2, Gtk::FILL, Gtk::FILL, 4, 4);
+   propsRightVbox->pack_start(*propertiesFirstTable);
+   propsRightVbox->pack_start(*propertiesSecondTable);
+   propertiesHbox->pack_start(*propsLeftVbox);
+   propertiesHbox->pack_start(*propsRightVbox);
    labelsTreeview->set_flags(Gtk::CAN_FOCUS);
    labelsTreeview->set_headers_visible(true);
    labelsTreeview->set_rules_hint(false);
@@ -175,7 +217,7 @@
    labelsScrolledwindow->set_policy(Gtk::POLICY_AUTOMATIC, Gtk::POLICY_AUTOMATIC);
    labelsScrolledwindow->property_window_placement().set_value(Gtk::CORNER_TOP_LEFT);
    labelsScrolledwindow->add(*viewport1);
-   propertiesVbox->pack_start(*propertiesTable, Gtk::PACK_SHRINK, 0);
+   propertiesVbox->pack_start(*propertiesHbox, Gtk::PACK_SHRINK, 0);
    propertiesVbox->pack_start(*labelsScrolledwindow);
    propertiesDialog->get_vbox()->set_homogeneous(false);
    propertiesDialog->get_vbox()->set_spacing(0);
@@ -190,19 +232,23 @@
    propertiesDialog->add_action_widget(*labelOkButton, -5);
    cancelbutton2->show();
    labelOkButton->show();
-   titleEntry->show();
-   typeEntry->show();
-   languageCombobox->show();
    titleLabel->show();
    languageLabel->show();
    typeLabel->show();
    sizeLabel->show();
+   termsLabel->show();
+   propsLeftVbox->show();
+   titleEntry->show();
+   typeEntry->show();
+   languageCombobox->show();
+   propertiesFirstTable->show();
    sizeEntry->show();
-   termsLabel->show();
    termsEntry->show();
+   bytesLabel->show();
    saveTermsButton->show();
-   termsHbox->show();
-   propertiesTable->show();
+   propertiesSecondTable->show();
+   propsRightVbox->show();
+   propertiesHbox->show();
    labelsTreeview->show();
    viewport1->show();
    labelsScrolledwindow->show();

Modified: trunk/UI/GTK2/src/propertiesDialog_glade.hh
===================================================================
--- trunk/UI/GTK2/src/propertiesDialog_glade.hh	2007-10-14 09:05:37 UTC (rev 1036)
+++ trunk/UI/GTK2/src/propertiesDialog_glade.hh	2007-10-14 09:06:54 UTC (rev 1037)
@@ -1,4 +1,4 @@
-// generated 2007/10/5 15:58:25 SGT by fabrice at amra.dyndns.org.(none)
+// generated 2007/10/14 16:21:28 SGT by fabrice at amra.dyndns.org.(none)
 // using glademm V2.12.1
 //
 // DO NOT EDIT THIS FILE ! It was created using
@@ -33,9 +33,9 @@
 
 #include <gtkmm/dialog.h>
 #include <gtkmm/button.h>
+#include <gtkmm/label.h>
 #include <gtkmm/entry.h>
 #include <gtkmm/comboboxtext.h>
-#include <gtkmm/label.h>
 #include <gtkmm/treeview.h>
 #include <gtkmm/scrolledwindow.h>
 
@@ -47,16 +47,17 @@
         class Gtk::Dialog * propertiesDialog;
 protected:
         class Gtk::Button * labelOkButton;
-        class Gtk::Entry * titleEntry;
-        class Gtk::Entry * typeEntry;
-        class Gtk::ComboBoxText * languageCombobox;
         class Gtk::Label * titleLabel;
         class Gtk::Label * languageLabel;
         class Gtk::Label * typeLabel;
         class Gtk::Label * sizeLabel;
+        class Gtk::Label * termsLabel;
+        class Gtk::Entry * titleEntry;
+        class Gtk::Entry * typeEntry;
+        class Gtk::ComboBoxText * languageCombobox;
         class Gtk::Entry * sizeEntry;
-        class Gtk::Label * termsLabel;
         class Gtk::Entry * termsEntry;
+        class Gtk::Label * bytesLabel;
         class Gtk::Button * saveTermsButton;
         class Gtk::TreeView * labelsTreeview;
         class Gtk::ScrolledWindow * labelsScrolledwindow;



From fabricecolin at mail.berlios.de  Mon Oct 15 04:52:31 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Mon, 15 Oct 2007 04:52:31 +0200
Subject: [Pinot-svn] r1038 - trunk/Utils
Message-ID: <200710150252.l9F2qVmE032260@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-15 04:52:22 +0200 (Mon, 15 Oct 2007)
New Revision: 1038

Modified:
   trunk/Utils/DocumentInfo.cpp
   trunk/Utils/DocumentInfo.h
Log:
Documents can be serialized to and from strings.


Modified: trunk/Utils/DocumentInfo.cpp
===================================================================
--- trunk/Utils/DocumentInfo.cpp	2007-10-14 09:06:54 UTC (rev 1037)
+++ trunk/Utils/DocumentInfo.cpp	2007-10-15 02:52:22 UTC (rev 1038)
@@ -16,9 +16,13 @@
  *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
  */
 
+#include <stdlib.h>
 #include <algorithm>
+
+#include "StringManip.h"
 #include "TimeConverter.h"
 #include "DocumentInfo.h"
+#include "Url.h"
 
 using std::string;
 using std::map;
@@ -92,6 +96,81 @@
 	return false;
 }
 
+/// Serializes the document.
+string DocumentInfo::serialize(void) const
+{
+	string info;
+	char numStr[64];
+
+	// Serialize DocumentInfo into a string
+	for (map<string, string>::const_iterator fieldIter = m_fields.begin();
+		fieldIter != m_fields.end(); ++fieldIter)
+	{
+		info += "\n";
+		info += fieldIter->first;
+		info += "=";
+		info += fieldIter->second;
+	}
+	info += "\nlabels=";
+	for (set<string>::const_iterator labelIter = m_labels.begin();
+		labelIter != m_labels.end(); ++labelIter)
+	{
+		info += "[" + Url::escapeUrl(*labelIter) + "]";
+	}
+	info += "\nextract=";
+	info += m_extract;
+	info += "\nscore=";
+	snprintf(numStr, 64, "%f", m_score);
+	info += numStr;
+	info += "\nindexid=";
+	snprintf(numStr, 64, "%u", m_indexId);
+	info += numStr;
+	info += "\ndocid=";
+	snprintf(numStr, 64, "%u", m_docId);
+	info += numStr;
+	info += "\n";
+
+	return Url::escapeUrl(info);
+}
+
+/// Deserializes the document.
+void DocumentInfo::deserialize(const string &info)
+{
+	string unescapedInfo(Url::unescapeUrl(info));
+
+	// Deserialize DocumentInfo
+	setField("caption", StringManip::extractField(unescapedInfo, "caption=", "\n"));
+	setField("url", StringManip::extractField(unescapedInfo, "url=", "\n"));
+	setField("type", StringManip::extractField(unescapedInfo, "type=", "\n"));
+	setField("language", StringManip::extractField(unescapedInfo, "language=", "\n"));
+	setField("modtime", StringManip::extractField(unescapedInfo, "modtime=", "\n"));
+	setField("size", StringManip::extractField(unescapedInfo, "size=", "\n"));
+	string labelsString(StringManip::extractField(unescapedInfo, "labels=", "\n"));
+	if (labelsString.empty() == false)
+	{
+		string::size_type endPos = 0;
+		string labelName(StringManip::extractField(labelsString, "[", "]", endPos));
+
+		m_labels.clear();
+
+		// Parse labels
+		while (labelName.empty() == false)
+		{
+			m_labels.insert(Url::unescapeUrl(labelName));
+
+			if (endPos == string::npos)
+			{
+				break;
+			}
+			labelName = StringManip::extractField(labelsString, "[", "]", endPos);
+		}
+	}
+	m_extract = StringManip::extractField(unescapedInfo, "extract=", "\n");
+	m_score = (float)atof(StringManip::extractField(unescapedInfo, "score=", "\n").c_str());
+	m_indexId = (unsigned int)atoi(StringManip::extractField(unescapedInfo, "indexid=", "\n").c_str());
+	m_docId = (unsigned int)atoi(StringManip::extractField(unescapedInfo, "docid=", "\n").c_str());
+}
+
 /// Sets the title of the document.
 void DocumentInfo::setTitle(const string &title)
 {

Modified: trunk/Utils/DocumentInfo.h
===================================================================
--- trunk/Utils/DocumentInfo.h	2007-10-14 09:06:54 UTC (rev 1037)
+++ trunk/Utils/DocumentInfo.h	2007-10-15 02:52:22 UTC (rev 1038)
@@ -38,6 +38,12 @@
 
 		bool operator<(const DocumentInfo& other) const;
 
+		/// Serializes the document.
+		std::string serialize(void) const;
+
+		/// Deserializes the document.
+		void deserialize(const std::string &info);
+
 		/// Sets the title of the document.
 		virtual void setTitle(const std::string &title);
 



From fabricecolin at mail.berlios.de  Mon Oct 15 04:54:28 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Mon, 15 Oct 2007 04:54:28 +0200
Subject: [Pinot-svn] r1039 - in trunk: SQL UI/GTK2/src
Message-ID: <200710150254.l9F2sSXn032350@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-15 04:54:27 +0200 (Mon, 15 Oct 2007)
New Revision: 1039

Modified:
   trunk/SQL/ActionQueue.cpp
   trunk/UI/GTK2/src/ModelColumns.cpp
   trunk/UI/GTK2/src/ModelColumns.h
   trunk/UI/GTK2/src/ResultsTree.cpp
   trunk/UI/GTK2/src/ResultsTree.h
Log:
Use DocumentInfo serialization in ActionQueue and ResultsTree.


Modified: trunk/SQL/ActionQueue.cpp
===================================================================
--- trunk/SQL/ActionQueue.cpp	2007-10-15 02:52:22 UTC (rev 1038)
+++ trunk/SQL/ActionQueue.cpp	2007-10-15 02:54:27 UTC (rev 1039)
@@ -110,7 +110,7 @@
 bool ActionQueue::pushItem(ActionType type, const DocumentInfo &docInfo)
 {
 	string url(docInfo.getLocation());
-	string info("caption=");
+	string info(docInfo.serialize());
 	bool update = false, success = false;
 
 	// Is there already an item for this URL ?
@@ -134,42 +134,19 @@
 		delete results;
 	}
 
-	// Serialize DocumentInfo
-	info += docInfo.getTitle();
-	info += "\nurl=";
-	info += url;
-	info += "\ntype=";
-	info += docInfo.getType();
-	info += "\nlanguage=";
-	info += docInfo.getLanguage();
-	info += "\nmodtime=";
-	info += docInfo.getTimestamp();
-	info += "\nsize=";
-	char sizeStr[64];
-	snprintf(sizeStr, 64, "%ld", docInfo.getSize());
-	info += sizeStr;
-	info += "\nlabels=";
-	const set<string> &labels = docInfo.getLabels();
-	for (set<string>::const_iterator labelIter = labels.begin();
-		labelIter != labels.end(); ++labelIter)
-	{
-		info += "[" + Url::escapeUrl(*labelIter) + "]";
-	}
-	info += "\n";
-
 	if (update == false)
 	{
 		results = executeStatement("INSERT INTO ActionQueue \
 			VALUES('%q', '%q', '%q', '%d', '%q');",
 			m_queueId.c_str(), Url::escapeUrl(url).c_str(),
-			typeToText(type).c_str(), time(NULL), Url::escapeUrl(info).c_str());
+			typeToText(type).c_str(), time(NULL), info.c_str());
 	}
 	else
 	{
 		results = executeStatement("UPDATE ActionQueue \
 			SET Type='%q', Date='%d', Info='%q' WHERE \
 			QueueId='%q' AND Url='%q';",
-			typeToText(type).c_str(), time(NULL), Url::escapeUrl(info).c_str(),
+			typeToText(type).c_str(), time(NULL), info.c_str(),
 			m_queueId.c_str(), Url::escapeUrl(url).c_str());
 	}
 	if (results != NULL)
@@ -219,7 +196,7 @@
 {
 	bool success = false;
 
-	SQLiteResults *results = executeStatement("SELECT Url, Type, Info FROM ActionQueue \
+	SQLiteResults *results = executeStatement("SELECT Type, Info FROM ActionQueue \
 		WHERE QueueId='%q' ORDER BY Date DESC LIMIT 1",
 		m_queueId.c_str());
 	if (results != NULL)
@@ -227,44 +204,12 @@
 		SQLiteRow *row = results->nextRow();
 		if (row != NULL)
 		{
-			string url(Url::unescapeUrl(row->getColumn(0)));
-			type = textToType(row->getColumn(1));
-			string info(Url::unescapeUrl(row->getColumn(2)));
+			type = textToType(row->getColumn(0));
 			success = true;
 
 			// Deserialize DocumentInfo
-			docInfo.setTitle(StringManip::extractField(info, "caption=", "\n"));
-			docInfo.setLocation(url);
-			docInfo.setType(StringManip::extractField(info, "type=", "\n"));
-			docInfo.setLanguage(StringManip::extractField(info, "language=", "\n"));
-			docInfo.setTimestamp(StringManip::extractField(info, "modtime=", "\n"));
-			string bytesSize(StringManip::extractField(info, "size=", "\n"));
-			if (bytesSize.empty() == false)
-			{
-				docInfo.setSize((off_t )atol(bytesSize.c_str()));
-			}
-			string labelsString(StringManip::extractField(info, "labels=", "\n"));
-			if (labelsString.empty() == false)
-			{
-				string::size_type endPos = 0;
-				string label(StringManip::extractField(labelsString, "[", "]", endPos));
-				set<string> labels;
+			docInfo.deserialize(row->getColumn(1));
 
-				// Parse labels
-				while (label.empty() == false)
-				{
-					labels.insert(Url::unescapeUrl(label));
-
-					if (endPos == string::npos)
-					{
-						break;
-					}
-					label = StringManip::extractField(labelsString, "[", "]", endPos);
-				}
-
-				docInfo.setLabels(labels);
-			}
-
 			delete row;
 		}
 

Modified: trunk/UI/GTK2/src/ModelColumns.cpp
===================================================================
--- trunk/UI/GTK2/src/ModelColumns.cpp	2007-10-15 02:52:22 UTC (rev 1038)
+++ trunk/UI/GTK2/src/ModelColumns.cpp	2007-10-15 02:54:27 UTC (rev 1039)
@@ -58,7 +58,6 @@
 {
 	add(m_text);
 	add(m_url);
-	add(m_type);
 	add(m_indexed);
 	add(m_viewed);
 	add(m_rankDiff);
@@ -70,6 +69,7 @@
 	add(m_resultType);
 	add(m_timestamp);
 	add(m_timestampTime);
+	add(m_serial);
 }
 
 ResultsModelColumns::~ResultsModelColumns()

Modified: trunk/UI/GTK2/src/ModelColumns.h
===================================================================
--- trunk/UI/GTK2/src/ModelColumns.h	2007-10-15 02:52:22 UTC (rev 1038)
+++ trunk/UI/GTK2/src/ModelColumns.h	2007-10-15 02:54:27 UTC (rev 1039)
@@ -81,7 +81,6 @@
 
 	Gtk::TreeModelColumn<Glib::ustring> m_text;
 	Gtk::TreeModelColumn<Glib::ustring> m_url;
-	Gtk::TreeModelColumn<Glib::ustring> m_type;
 	Gtk::TreeModelColumn<bool> m_indexed;
 	Gtk::TreeModelColumn<bool> m_viewed;
 	Gtk::TreeModelColumn<int> m_rankDiff;
@@ -94,6 +93,7 @@
 	Gtk::TreeModelColumn<RowType> m_resultType;
 	Gtk::TreeModelColumn<Glib::ustring> m_timestamp;
 	Gtk::TreeModelColumn<time_t> m_timestampTime;
+	Gtk::TreeModelColumn<Glib::ustring> m_serial;
 
 };
 

Modified: trunk/UI/GTK2/src/ResultsTree.cpp
===================================================================
--- trunk/UI/GTK2/src/ResultsTree.cpp	2007-10-15 02:52:22 UTC (rev 1038)
+++ trunk/UI/GTK2/src/ResultsTree.cpp	2007-10-15 02:54:27 UTC (rev 1039)
@@ -592,8 +592,9 @@
 
 		// OK, add a row for this result within the group
 		TreeModel::iterator titleIter;
-		if (appendResult(title, location, resultIter->getType(), (int)currentScore, rankDiff, isIndexed, wasViewed,
-			docId, resultIter->getTimestamp(), engineId, indexId, titleIter, groupIter, true) == true)
+		if (appendResult(title, location, (int)currentScore, rankDiff, isIndexed, wasViewed,
+			docId, resultIter->getTimestamp(), resultIter->serialize(),
+			engineId, indexId, titleIter, groupIter, true) == true)
 		{
 #ifdef DEBUG
 			cout << "ResultsTree::addResults: added row for result " << count
@@ -740,13 +741,13 @@
 					// Add result
 					success = appendResult(childRow[m_resultsColumns.m_text],
 						childRow[m_resultsColumns.m_url],
-						childRow[m_resultsColumns.m_type],
 						childRow[m_resultsColumns.m_score],
 						childRow[m_resultsColumns.m_rankDiff],
 						childRow[m_resultsColumns.m_indexed],
 						childRow[m_resultsColumns.m_viewed],
 						childRow[m_resultsColumns.m_docId],
 						childRow[m_resultsColumns.m_timestamp],
+						childRow[m_resultsColumns.m_serial],
 						engineIds, indexIds,
 						newIter, groupIter, true);
 				}
@@ -815,13 +816,13 @@
 							// Add result
 							appendResult(childRow[m_resultsColumns.m_text],
 								childRow[m_resultsColumns.m_url],
-								childRow[m_resultsColumns.m_type],
 								childRow[m_resultsColumns.m_score],
 								childRow[m_resultsColumns.m_rankDiff],
 								childRow[m_resultsColumns.m_indexed],
 								childRow[m_resultsColumns.m_viewed],
 								childRow[m_resultsColumns.m_docId],
 								childRow[m_resultsColumns.m_timestamp],
+								childRow[m_resultsColumns.m_serial],
 								engineId, indexId,
 								newIter, groupIter, true);
 #ifdef DEBUG
@@ -911,10 +912,11 @@
 		if ((skipIndexed == false) ||
 			(isIndexed == false))
 		{
-			DocumentInfo current(from_utf8(row[m_resultsColumns.m_text]),
-				from_utf8(row[m_resultsColumns.m_url]),
-				from_utf8(row[m_resultsColumns.m_type]), "");
+			DocumentInfo current;
+			string serial(from_utf8(row[m_resultsColumns.m_serial]));
 
+			current.deserialize(serial);
+
 			if (isIndexed == true)
 			{
 				set<string> indexNames;
@@ -997,10 +999,11 @@
 
 		if (docId == row[m_resultsColumns.m_docId])
 		{
-			updateRow(row, result.getTitle(), result.getLocation(), result.getType(),
+			updateRow(row, result.getTitle(), result.getLocation(),
 				row[m_resultsColumns.m_score], row[m_resultsColumns.m_engines],
 				row[m_resultsColumns.m_indexes], docId,
-				result.getTimestamp(), ResultsModelColumns::ROW_RESULT,
+				result.getTimestamp(), result.serialize(),
+				ResultsModelColumns::ROW_RESULT,
 				row[m_resultsColumns.m_indexed], row[m_resultsColumns.m_viewed],
 				row[m_resultsColumns.m_rankDiff]);
 			break;
@@ -1276,16 +1279,15 @@
 		{
 			set<string> engineNames, indexNames;
 			TreeModel::Row childRow = *childIter;
-			DocumentInfo result(from_utf8(childRow[m_resultsColumns.m_text]),
-				from_utf8(childRow[m_resultsColumns.m_url]),
-				from_utf8(childRow[m_resultsColumns.m_type]), "");
-			string engineName, charset;
+			DocumentInfo result;
+			string engineName, charset, serial(from_utf8(childRow[m_resultsColumns.m_serial]));
 			unsigned int engineIds = childRow[m_resultsColumns.m_engines];
 			unsigned int indexIds = childRow[m_resultsColumns.m_indexes];
 
 #ifdef DEBUG
 			cout << "ResultsTree::exportResults: engines " << engineIds << ", indexes " << indexIds << endl;
 #endif
+			result.deserialize(serial);
 			m_settings.getEngineNames(engineIds, engineNames);
 			if (engineNames.empty() == false)
 			{
@@ -1339,8 +1341,9 @@
 // Adds a new row in the results tree.
 //
 bool ResultsTree::appendResult(const ustring &text, const ustring &url,
-	const ustring &type, int score, int rankDiff, bool isIndexed, bool wasViewed,
-	unsigned int docId, const ustring &timestamp, unsigned int engineId,
+	int score, int rankDiff, bool isIndexed, bool wasViewed,
+	unsigned int docId, const ustring &timestamp,
+	const ustring &serial, unsigned int engineId,
 	unsigned int indexId, TreeModel::iterator &newRowIter,
 	const TreeModel::iterator &parentIter, bool noDuplicates)
 {
@@ -1386,8 +1389,8 @@
 	}
 
 	TreeModel::Row childRow = *newRowIter;
-	updateRow(childRow, text, url, type, score, engineId, indexId,
-		docId, timestamp, ResultsModelColumns::ROW_RESULT, isIndexed,
+	updateRow(childRow, text, url, score, engineId, indexId,
+		docId, timestamp, serial, ResultsModelColumns::ROW_RESULT, isIndexed,
 		wasViewed, rankDiff);
 
 	return true;
@@ -1409,7 +1412,7 @@
 		groupIter = m_refStore->append();
 		TreeModel::Row groupRow = *groupIter;
 		updateRow(groupRow, to_utf8(groupName),
-			"", "", 0, 0, 0, 0, "", groupType,
+			"", 0, 0, 0, 0, "", "", groupType,
 			false, false, false);
 
 		// Update the map
@@ -1477,16 +1480,14 @@
 // Updates a row.
 //
 void ResultsTree::updateRow(TreeModel::Row &row, const ustring &text,
-	const ustring &url, const ustring &type, int score,
-	unsigned int engineId, unsigned int indexId,
-	unsigned int docId, const ustring &timestamp,
+	const ustring &url, int score, 	unsigned int engineId, unsigned int indexId,
+	unsigned int docId, const ustring &timestamp, const ustring &serial,
 	ResultsModelColumns::RowType resultType, bool indexed, bool viewed, int rankDiff)
 {
 	try
 	{
 		row[m_resultsColumns.m_text] = text;
 		row[m_resultsColumns.m_url] = url;
-		row[m_resultsColumns.m_type] = type;
 		row[m_resultsColumns.m_score] = score;
 		row[m_resultsColumns.m_scoreText] = "";
 		row[m_resultsColumns.m_engines] = engineId;
@@ -1495,6 +1496,7 @@
 		row[m_resultsColumns.m_resultType] = resultType;
 		row[m_resultsColumns.m_timestamp] = timestamp;
 		row[m_resultsColumns.m_timestampTime] = TimeConverter::fromTimestamp(timestamp);
+		row[m_resultsColumns.m_serial] = serial;
 
 		row[m_resultsColumns.m_indexed] = indexed;
 		row[m_resultsColumns.m_viewed] = viewed;

Modified: trunk/UI/GTK2/src/ResultsTree.h
===================================================================
--- trunk/UI/GTK2/src/ResultsTree.h	2007-10-15 02:52:22 UTC (rev 1038)
+++ trunk/UI/GTK2/src/ResultsTree.h	2007-10-15 02:54:27 UTC (rev 1039)
@@ -159,8 +159,8 @@
 
 		/// Adds a new row in the results tree.
 		bool appendResult(const Glib::ustring &text, const Glib::ustring &url,
-			const Glib::ustring &type, int score, int rankDiff,
-			bool isIndexed, bool wasViewed, unsigned int docId, const Glib::ustring &timestamp,
+			int score, int rankDiff, bool isIndexed, bool wasViewed,
+			unsigned int docId, const Glib::ustring &timestamp, const Glib::ustring &serial,
 			unsigned int engineId, unsigned int indexId,
 			Gtk::TreeModel::iterator &newRowIter,
 			const Gtk::TreeModel::iterator &parentIter,
@@ -171,10 +171,9 @@
 
 		/// Updates a row.
 		void updateRow(Gtk::TreeModel::Row &row, const Glib::ustring &text,
-			const Glib::ustring &url, const Glib::ustring &type,
-			int score, unsigned int engineId, unsigned int indexId,
-			unsigned int docId, const Glib::ustring &timestamp,
-			ResultsModelColumns::RowType type, bool indexed, bool viewed, int rankDiff);
+			const Glib::ustring &url, int score, unsigned int engineId, unsigned int indexId,
+			unsigned int docId, const Glib::ustring &timestamp, const Glib::ustring &serial,
+			ResultsModelColumns::RowType resultType, bool indexed, bool viewed, int rankDiff);
 
 		/// Retrieves the extract to show for the given row.
 		Glib::ustring findResultsExtract(const Gtk::TreeModel::Row &row);



From fabricecolin at mail.berlios.de  Mon Oct 15 05:57:52 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Mon, 15 Oct 2007 05:57:52 +0200
Subject: [Pinot-svn] r1040 - trunk/UI/GTK2/src
Message-ID: <200710150357.l9F3vqr3002685@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-15 05:57:50 +0200 (Mon, 15 Oct 2007)
New Revision: 1040

Modified:
   trunk/UI/GTK2/src/WorkerThreads.cpp
   trunk/UI/GTK2/src/WorkerThreads.h
Log:
UpdateDocumentThread exports the index name and doesn't call getDocumentInfo()
after performing the update. It's not necessary, and may retrieve old data if
the update was done over D-Bus and the daemon has not flushed to the index.
IndexingThread restores the document and index IDs following the call to
getDocumentInfo(). We could probably do without this call, I'll have to look
into it later on...


Modified: trunk/UI/GTK2/src/WorkerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.cpp	2007-10-15 02:54:27 UTC (rev 1039)
+++ trunk/UI/GTK2/src/WorkerThreads.cpp	2007-10-15 03:57:50 UTC (rev 1040)
@@ -1396,8 +1396,21 @@
 {
 	IndexInterface *pIndex = PinotSettings::getInstance().getIndex(m_indexLocation);
 	Url thisUrl(m_docInfo.getLocation());
+	string indexName;
 	bool doDownload = true;
 
+	// What's the name of this index ?
+	const map<string, string> &indexesMap = PinotSettings::getInstance().getIndexes();
+	for (map<string, string>::const_iterator mapIter = indexesMap.begin();
+		mapIter != indexesMap.end(); ++mapIter)
+	{
+		if (m_indexLocation == mapIter->second)
+		{
+			indexName = mapIter->first;
+			break;
+		}
+	}
+
 	// First things first, get the index
 	if ((pIndex == NULL) ||
 		(pIndex->isGood() == false))
@@ -1608,6 +1621,7 @@
 
 				// The document properties may have changed
 				pIndex->getDocumentInfo(m_docId, m_docInfo);
+				m_docInfo.setIsIndexed(PinotSettings::getInstance().getIndexId(indexName), m_docId);
 			}
 		}
 	}
@@ -1754,6 +1768,11 @@
 	return "UpdateDocumentThread";
 }
 
+string UpdateDocumentThread::getIndexName(void) const
+{
+	return m_indexName;
+}
+
 unsigned int UpdateDocumentThread::getDocumentID(void) const
 {
 	return m_docId;
@@ -1795,16 +1814,10 @@
 		{
 			m_errorNum = UPDATE_FAILED;
 		}
-		else
+		// Flush the index ?
+		else if (m_immediateFlush == true)
 		{
-			// Flush the index ?
-			if (m_immediateFlush == true)
-			{
-				pIndex->flush();
-			}
-
-			// The document properties may have changed
-			pIndex->getDocumentInfo(m_docId, m_docInfo);
+			pIndex->flush();
 		}
 
 		delete pIndex;

Modified: trunk/UI/GTK2/src/WorkerThreads.h
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.h	2007-10-15 02:54:27 UTC (rev 1039)
+++ trunk/UI/GTK2/src/WorkerThreads.h	2007-10-15 03:57:50 UTC (rev 1040)
@@ -442,6 +442,8 @@
 
 		virtual std::string getType(void) const;
 
+		std::string getIndexName(void) const;
+
 		unsigned int getDocumentID(void) const;
 
 		const DocumentInfo &getDocumentInfo(void) const;



From fabricecolin at mail.berlios.de  Mon Oct 15 06:02:46 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Mon, 15 Oct 2007 06:02:46 +0200
Subject: [Pinot-svn] r1041 - trunk/UI/GTK2/src
Message-ID: <200710150402.l9F42kmM003066@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-15 06:02:41 +0200 (Mon, 15 Oct 2007)
New Revision: 1041

Modified:
   trunk/UI/GTK2/src/propertiesDialog.cc
   trunk/UI/GTK2/src/propertiesDialog.hh
Log:
Manipulate the documents list the dialog was passed directly. There's no need
to call getDocumentInfo(), since the tree now caches all that information.


Modified: trunk/UI/GTK2/src/propertiesDialog.cc
===================================================================
--- trunk/UI/GTK2/src/propertiesDialog.cc	2007-10-15 03:57:50 UTC (rev 1040)
+++ trunk/UI/GTK2/src/propertiesDialog.cc	2007-10-15 04:02:41 UTC (rev 1041)
@@ -34,120 +34,110 @@
 using namespace Gtk;
 
 propertiesDialog::propertiesDialog(const string &indexLocation,
-	const vector<DocumentInfo> &documentsList) :
+	vector<DocumentInfo> &documentsList) :
 	propertiesDialog_glade(),
 	m_indexLocation(indexLocation),
+	m_documentsList(documentsList),
 	m_docId(0),
+	m_notALanguageName(false),
 	m_editDocument(false)
 {
 	set<string> docLabels;
 	string language;
-	unsigned int termsCount = 0;
-	bool notALanguageName = false;
 	char numStr[128];
 
-	IndexInterface *pIndex = PinotSettings::getInstance().getIndex(m_indexLocation);
-	if ((pIndex == NULL) ||
-		(pIndex->isGood() == false))
-	{
-		if (pIndex != NULL)
-		{
-			delete pIndex;
-		}
-		return;
-	}
+	// Associate the columns model to the labels tree
+	m_refLabelsTree = ListStore::create(m_labelsColumns);
+	labelsTreeview->set_model(m_refLabelsTree);
+	labelsTreeview->append_column_editable(" ", m_labelsColumns.m_enabled);
+	labelsTreeview->append_column(_("Label"), m_labelsColumns.m_name);
+	// Allow only single selection
+	labelsTreeview->get_selection()->set_mode(SELECTION_SINGLE);
 
 	// If there's only one document selected, get its labels
-	if (documentsList.size() == 1)
+	if (m_documentsList.size() == 1)
 	{
-		vector<DocumentInfo>::const_iterator docIter = documentsList.begin();
+		DocumentInfo docInfo(m_documentsList.front());
 		unsigned int indexId = 0;
+		unsigned int termsCount = 0;
 
 		// Get the document ID
-		m_docId = docIter->getIsIndexed(indexId);
+		m_docId = docInfo.getIsIndexed(indexId);
 #ifdef DEBUG
 		cout << "propertiesDialog::propertiesDialog: document " << m_docId << " in index " << indexId << endl;
 #endif
 		if (m_docId > 0)
 		{
-			// Get the properties from the index because they may have been altered
-			// for display purposes
-			pIndex->getDocumentInfo(m_docId, m_docInfo);
-			pIndex->getDocumentLabels(m_docId, docLabels);
-			m_docInfo.setIsIndexed(indexId, m_docId);
-			termsCount = pIndex->getDocumentTermsCount(m_docId);
-			language = m_docInfo.getLanguage();
-			m_editDocument = true;
+			IndexInterface *pIndex = PinotSettings::getInstance().getIndex(m_indexLocation);
+			if (pIndex != NULL)
+			{
+				// Get the document's labels
+				pIndex->getDocumentLabels(m_docId, docLabels);
+				// Get the number of terms
+				termsCount = pIndex->getDocumentTermsCount(m_docId);
 
+				delete pIndex;
+			}
+			language = docInfo.getLanguage();
+
 			snprintf(numStr, 128, "%u", m_docId);
 			set_title(get_title() + " (ID " + numStr + ")");
+
+			titleEntry->set_text(to_utf8(docInfo.getTitle()));
+			typeEntry->set_text(to_utf8(docInfo.getType()));
+			unsigned int size = docInfo.getSize();
+			if (size == 0)
+			{
+				sizeEntry->set_text(_("Unknown"));
+			}
+			else
+			{
+				snprintf(numStr, 128, "%u", size);
+				sizeEntry->set_text(numStr);
+			}
+			if (termsCount == 0)
+			{
+				termsEntry->set_text(_("Unknown"));
+			}
+			else
+			{
+				snprintf(numStr, 128, "%u", termsCount);
+				termsEntry->set_text(numStr);
+			}
+
+			m_editDocument = true;
 		}
 	}
 	else
 	{
 		string perDoc(_("Per document"));
+		bool firstDoc = true;
 
-		// Leave the labels list blank
 		// If all documents are of the same language, show it
-		for (vector<DocumentInfo>::const_iterator docIter = documentsList.begin();
-			docIter != documentsList.end(); ++docIter)
+		for (vector<DocumentInfo>::const_iterator docIter = m_documentsList.begin();
+			docIter != m_documentsList.end(); ++docIter)
 		{
 #ifdef DEBUG
-			cout << "propertiesDialog::propertiesDialog: language " << docIter->getLanguage() << endl;
+			cout << "propertiesDialog::propertiesDialog: language " << language << endl;
 #endif
-			if (language.empty() == true)
+			if (firstDoc == true)
 			{
 				language = docIter->getLanguage();
+				firstDoc = false;
 			}
 			else if (language != docIter->getLanguage())
 			{
 				language = perDoc;
-				notALanguageName = true;
+				m_notALanguageName = true;
 			}
 		}
 		if (language.empty() == true)
 		{
 			language = perDoc;
-			notALanguageName = true;
+			m_notALanguageName = true;
 		}
-	}
-	delete pIndex;
 
-	// Associate the columns model to the labels tree
-	m_refLabelsTree = ListStore::create(m_labelsColumns);
-	labelsTreeview->set_model(m_refLabelsTree);
-	labelsTreeview->append_column_editable(" ", m_labelsColumns.m_enabled);
-	labelsTreeview->append_column(_("Label"), m_labelsColumns.m_name);
-	// Allow only single selection
-	labelsTreeview->get_selection()->set_mode(SELECTION_SINGLE);
-
-	if (m_editDocument == true)
-	{
-		unsigned int size = m_docInfo.getSize();
-
-		titleEntry->set_text(to_utf8(m_docInfo.getTitle()));
-		typeEntry->set_text(to_utf8(m_docInfo.getType()));
-		if (size == 0)
-		{
-			sizeEntry->set_text(_("Unknown"));
-		}
-		else
-		{
-			snprintf(numStr, 128, "%u", size);
-			sizeEntry->set_text(numStr);
-		}
-		if (termsCount == 0)
-		{
-			termsEntry->set_text(_("Unknown"));
-		}
-		else
-		{
-			snprintf(numStr, 128, "%u", termsCount);
-			termsEntry->set_text(numStr);
-		}
-	}
-	else
-	{
+		// Hide these widgets
 		titleLabel->hide();
 		titleEntry->hide();
 		typeLabel->hide();
@@ -160,7 +150,7 @@
 		saveTermsButton->hide();
 	}
 
-	populate_languageCombobox(language, notALanguageName);
+	populate_languageCombobox(language);
 	populate_labelsTreeview(docLabels);
 }
 
@@ -168,12 +158,12 @@
 {
 }
 
-void propertiesDialog::populate_languageCombobox(const string &language, bool notALanguageName)
+void propertiesDialog::populate_languageCombobox(const string &language)
 {
 	unsigned int languageStart = 0;
 	bool foundLanguage = false;
 
-	if (notALanguageName == true)
+	if (m_notALanguageName == true)
 	{
 		languageCombobox->append_text(to_utf8(language));
 		languageCombobox->set_active(0);
@@ -186,7 +176,7 @@
 		string languageName(Languages::getIntlName(languageNum));
 
 		languageCombobox->append_text(to_utf8(languageName));
-		if ((notALanguageName == false) &&
+		if ((m_notALanguageName == false) &&
 			(languageName == language))
 		{
 			languageCombobox->set_active(languageNum + languageStart);
@@ -195,7 +185,7 @@
 	}
 
 	// Did we find the given language ?
-	if ((notALanguageName == false) &&
+	if ((m_notALanguageName == false) &&
 		(foundLanguage == false))
 	{
 		// Select the first language in the list
@@ -232,6 +222,10 @@
 			row[m_labelsColumns.m_enabled] = false;
 		}
 	}
+#ifdef DEBUG
+	cout << "propertiesDialog::populate_labelsTreeview: showing " << docLabels.size()
+		<< "/" << sysLabels.size() << " labels" << endl;
+#endif
 }
 
 void propertiesDialog::setHeight(int maxHeight)
@@ -253,11 +247,6 @@
 	}
 }
 
-const DocumentInfo &propertiesDialog::getDocumentInfo(void)
-{
-	return m_docInfo;
-}
-
 const set<string> &propertiesDialog::getLabels(void) const
 {
 	return m_labels;
@@ -266,22 +255,24 @@
 void propertiesDialog::on_labelOkButton_clicked()
 {
 	unsigned int languageStart = 0;
+
+	// If only one document was edited, set its title
 	if (m_editDocument == true)
 	{
-		// Title
-		m_docInfo.setTitle(from_utf8(titleEntry->get_text()));
+		vector<DocumentInfo>::iterator docIter = m_documentsList.begin();
+
+		docIter->setTitle(from_utf8(titleEntry->get_text()));
 	}
 
 	// Did we add an extra string to the languages list ?
-	if (m_docInfo.getLanguage().empty() == true)
+	if (m_notALanguageName == true)
 	{
 		languageStart = 1;
 	}
 	int chosenLanguage = languageCombobox->get_active_row_number();
-	if (chosenLanguage >= languageStart)
-	{
-		m_docInfo.setLanguage(from_utf8(languageCombobox->get_active_text()));
-	}
+#ifdef DEBUG
+	cout << "propertiesDialog::on_labelOkButton_clicked: chosen language " << languageCombobox->get_active_text() << endl;
+#endif
 
 	// Go through the labels tree
 	m_labels.clear();
@@ -300,6 +291,22 @@
 			}
 		}
 	}
+#ifdef DEBUG
+	cout << "propertiesDialog::on_labelOkButton_clicked: chosen " << m_labels.size() << " labels" << endl;
+#endif
+
+	for (vector<DocumentInfo>::iterator docIter = m_documentsList.begin();
+		docIter != m_documentsList.end(); ++docIter)
+	{
+		// Apply the new language if necessary
+		if (chosenLanguage >= languageStart)
+		{
+			docIter->setLanguage(from_utf8(languageCombobox->get_active_text()));
+		}
+
+		// Apply labels
+		docIter->setLabels(m_labels);
+	}
 }
 
 void propertiesDialog::on_saveTermsButton_clicked()
@@ -312,13 +319,8 @@
 #endif
 
 	IndexInterface *pIndex = PinotSettings::getInstance().getIndex(m_indexLocation);
-	if ((pIndex == NULL) ||
-		(pIndex->isGood() == false))
+	if (pIndex == NULL)
 	{
-		if (pIndex != NULL)
-		{
-			delete pIndex;
-		}
 		return;
 	}
 
@@ -343,5 +345,7 @@
 			termsFile.close();
 		}
 	}
+
+	delete pIndex;
 }
 

Modified: trunk/UI/GTK2/src/propertiesDialog.hh
===================================================================
--- trunk/UI/GTK2/src/propertiesDialog.hh	2007-10-15 03:57:50 UTC (rev 1040)
+++ trunk/UI/GTK2/src/propertiesDialog.hh	2007-10-15 04:02:41 UTC (rev 1041)
@@ -33,25 +33,24 @@
 {  
 public:
 	propertiesDialog(const std::string &indexLocation,
-	        const std::vector<DocumentInfo> &documentsList);
+	        std::vector<DocumentInfo> &documentsList);
 	virtual ~propertiesDialog();
 
 	void setHeight(int maxHeight);
 
-	const DocumentInfo &getDocumentInfo(void);
-
 	const std::set<std::string> &getLabels(void) const;
 
 protected:
 	LabelModelColumns m_labelsColumns;
+	std::vector<DocumentInfo> &m_documentsList;
 	Glib::RefPtr<Gtk::ListStore> m_refLabelsTree;
 	std::string m_indexLocation;
 	std::set<std::string> m_labels;
 	unsigned int m_docId;
+	bool m_notALanguageName;
 	bool m_editDocument;
-	DocumentInfo m_docInfo;
 
-	void populate_languageCombobox(const std::string &language, bool notALanguageName);
+	void populate_languageCombobox(const std::string &language);
 
 	void populate_labelsTreeview(const std::set<std::string> &docLabels);
 



From fabricecolin at mail.berlios.de  Mon Oct 15 06:06:31 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Mon, 15 Oct 2007 06:06:31 +0200
Subject: [Pinot-svn] r1042 - trunk/UI/GTK2/src
Message-ID: <200710150406.l9F46VRN003327@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-15 06:06:30 +0200 (Mon, 15 Oct 2007)
New Revision: 1042

Modified:
   trunk/UI/GTK2/src/ResultsTree.cpp
   trunk/UI/GTK2/src/ResultsTree.h
   trunk/UI/GTK2/src/mainWindow.cc
Log:
Synced mainWindow with changes made to propertiesDialog. It also assumed that
UpdateDocumentThread only operates on My Web Pages, which is incorrect.
ResultsTree::updateResult() returns false if it failed.


Modified: trunk/UI/GTK2/src/ResultsTree.cpp
===================================================================
--- trunk/UI/GTK2/src/ResultsTree.cpp	2007-10-15 04:02:41 UTC (rev 1041)
+++ trunk/UI/GTK2/src/ResultsTree.cpp	2007-10-15 04:06:30 UTC (rev 1042)
@@ -981,14 +981,14 @@
 //
 // Updates a result's properties.
 //
-void ResultsTree::updateResult(const DocumentInfo &result)
+bool ResultsTree::updateResult(const DocumentInfo &result)
 {
 	unsigned int indexId = 0;
 	unsigned int docId = result.getIsIndexed(indexId);
 
 	if (docId == 0)
 	{
-		return;
+		return false;
 	}
 
 	// Go through the list
@@ -1006,9 +1006,12 @@
 				ResultsModelColumns::ROW_RESULT,
 				row[m_resultsColumns.m_indexed], row[m_resultsColumns.m_viewed],
 				row[m_resultsColumns.m_rankDiff]);
-			break;
+
+			return true;
 		}
 	}
+
+	return false;
 }
 
 //

Modified: trunk/UI/GTK2/src/ResultsTree.h
===================================================================
--- trunk/UI/GTK2/src/ResultsTree.h	2007-10-15 04:02:41 UTC (rev 1041)
+++ trunk/UI/GTK2/src/ResultsTree.h	2007-10-15 04:06:30 UTC (rev 1042)
@@ -79,7 +79,7 @@
 		void setSelectionState(bool viewed);
 
 		/// Updates a result's properties.
-		void updateResult(const DocumentInfo &result);
+		bool updateResult(const DocumentInfo &result);
 
 		/**
 		  * Deletes the current selection.

Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2007-10-15 04:02:41 UTC (rev 1041)
+++ trunk/UI/GTK2/src/mainWindow.cc	2007-10-15 04:06:30 UTC (rev 1042)
@@ -1597,18 +1597,17 @@
 			return;
 		}
 
-		IndexPage *pIndexPage = dynamic_cast<IndexPage*>(get_page(_("My Web Pages"), NotebookPageBox::INDEX_PAGE));
+		IndexPage *pIndexPage = dynamic_cast<IndexPage*>(get_page(pUpdateThread->getIndexName(), NotebookPageBox::INDEX_PAGE));
 		if (pIndexPage != NULL)
 		{
 			ResultsTree *pResultsTree = pIndexPage->getTree();
-			if (pResultsTree != NULL)
+			if ((pResultsTree != NULL) &&
+				(pResultsTree->updateResult(pUpdateThread->getDocumentInfo()) == true))
 			{
-				pResultsTree->updateResult(pUpdateThread->getDocumentInfo());
+				status = _("Updated document properties");
+				set_status(status);
 			}
 		}
-
-		status = _("Updated document properties");
-		set_status(status);
 	}
 	else if (type == "StartDaemonThread")
 	{
@@ -2309,45 +2308,34 @@
 	propertiesBox.show();
 	// What labels will this show ?
 	const set<string> &labels = propertiesBox.getLabels();
-	bool hasNoLabels = labels.empty();
+	bool hadNoLabels = labels.empty();
 	if (propertiesBox.run() != RESPONSE_OK)
 	{
 		return;
 	}
 
-	DocumentInfo docInfo(propertiesBox.getDocumentInfo());
-	string newTitle(docInfo.getTitle());
-	string newLanguage(docInfo.getLanguage());
-#ifdef DEBUG
-	cout << "mainWindow::on_showfromindex_activate: properties changed to "
-		<< newTitle << ", " << newLanguage << endl;
-#endif
-
 	// Now apply these labels to all the documents
 	// FIXME: do that only if something was modified
-	if ((hasNoLabels == false) &&
+	if ((hadNoLabels == false) &&
 		(labels.empty() == false))
 	{
 		IndexInterface *pIndex = m_settings.getIndex(mapIter->second);
 		if (pIndex != NULL)
 		{
-			if (pIndex->isGood() == true)
+			set<unsigned int> docIds;
+
+			for (vector<DocumentInfo>::iterator docIter = documentsList.begin();
+				docIter != documentsList.end(); ++docIter)
 			{
-				set<unsigned int> docIds;
+				unsigned int indexId = 0;
 
-				for (vector<DocumentInfo>::iterator docIter = documentsList.begin();
-					docIter != documentsList.end(); ++docIter)
-				{
-					unsigned int indexId = 0;
-
-					docIds.insert(docIter->getIsIndexed(indexId));
-				}
-
-				// Set the document's labels list
-				// FIXME: this should be done by a thread
-				pIndex->setDocumentsLabels(docIds, labels);
+				docIds.insert(docIter->getIsIndexed(indexId));
 			}
 
+			// Set the document's labels list
+			// FIXME: this should be done by a thread
+			pIndex->setDocumentsLabels(docIds, labels);
+
 			delete pIndex;
 		}
 	}
@@ -2360,15 +2348,13 @@
 		unsigned int indexId = 0;
 		unsigned int docId = docIter->getIsIndexed(indexId);
 
-		docIter->setLanguage(newLanguage);
-
 		start_thread(new UpdateDocumentThread(indexName, docId, *docIter));
 	}
 
+	// Is the index list filtered with a query ?
 	if (queryName.empty() == false)
 	{
-		// The current label may have been applied to or removed from
-		// one or more of the selected documents, so refresh the list
+		// The query may filter on a label, so refresh the list
 		browse_index(indexName, queryName, 0, 0);
 	}
 }



From fabricecolin at mail.berlios.de  Mon Oct 15 07:40:57 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Mon, 15 Oct 2007 07:40:57 +0200
Subject: [Pinot-svn] r1043 - trunk/UI/GTK2/src
Message-ID: <200710150540.l9F5evrN023684@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-15 07:40:56 +0200 (Mon, 15 Oct 2007)
New Revision: 1043

Modified:
   trunk/UI/GTK2/src/PinotSettings.cpp
   trunk/UI/GTK2/src/PinotSettings.h
   trunk/UI/GTK2/src/ResultsTree.cpp
   trunk/UI/GTK2/src/WorkerThreads.cpp
   trunk/UI/GTK2/src/mainWindow.cc
Log:
Get index IDs by name or location.


Modified: trunk/UI/GTK2/src/PinotSettings.cpp
===================================================================
--- trunk/UI/GTK2/src/PinotSettings.cpp	2007-10-15 04:06:30 UTC (rev 1042)
+++ trunk/UI/GTK2/src/PinotSettings.cpp	2007-10-15 05:40:56 UTC (rev 1043)
@@ -1455,9 +1455,10 @@
 }
 
 /// Returns an ID that identifies the given index.
-unsigned int PinotSettings::getIndexId(const std::string &name)
+unsigned int PinotSettings::getIndexIdByName(const std::string &name)
 {
 	unsigned int indexId = 0;
+
 	for (map<unsigned int, string>::iterator mapIter = m_indexIds.begin();
 		mapIter != m_indexIds.end(); ++mapIter)
 	{
@@ -1471,6 +1472,21 @@
 	return indexId;
 }
 
+/// Returns an ID that identifies the given index.
+unsigned int PinotSettings::getIndexIdByLocation(const std::string &location)
+{
+	for (map<string, string>::iterator mapIter = m_indexNames.begin();
+		mapIter != m_indexNames.end(); ++mapIter)
+	{
+		if (mapIter->second == location)
+		{
+			return getIndexIdByName(mapIter->first);
+		}
+	}
+
+	return 0;
+}
+
 /// Returns the name(s) for the given ID.
 void PinotSettings::getIndexNames(unsigned int id, std::set<std::string> &names)
 {

Modified: trunk/UI/GTK2/src/PinotSettings.h
===================================================================
--- trunk/UI/GTK2/src/PinotSettings.h	2007-10-15 04:06:30 UTC (rev 1042)
+++ trunk/UI/GTK2/src/PinotSettings.h	2007-10-15 05:40:56 UTC (rev 1043)
@@ -80,8 +80,11 @@
 		void clearIndexes(void);
 
 		/// Returns an ID that identifies the given index.
-		unsigned int getIndexId(const std::string &name);
+		unsigned int getIndexIdByName(const std::string &name);
 
+		/// Returns an ID that identifies the given index.
+		unsigned int getIndexIdByLocation(const std::string &location);
+
 		/// Returns the name(s) for the given ID.
 		void getIndexNames(unsigned int id, std::set<std::string> &names);
 

Modified: trunk/UI/GTK2/src/ResultsTree.cpp
===================================================================
--- trunk/UI/GTK2/src/ResultsTree.cpp	2007-10-15 04:06:30 UTC (rev 1042)
+++ trunk/UI/GTK2/src/ResultsTree.cpp	2007-10-15 05:40:56 UTC (rev 1043)
@@ -486,7 +486,7 @@
 		if (mapIter != m_settings.getIndexes().end())
 		{
 			// Yes, it is
-			indexId = m_settings.getIndexId(engineName);
+			indexId = m_settings.getIndexIdByName(engineName);
 			engineId = m_settings.getEngineId("Xapian");
 #ifdef DEBUG
 			cout << "ResultsTree::addResults: engine is index " << engineName << " " << indexId << endl;
@@ -797,7 +797,7 @@
 						if (engineId == 0)
 						{
 							// This is actually an index, not an engine...
-							indexId = m_settings.getIndexId(engineName);
+							indexId = m_settings.getIndexIdByName(engineName);
 							if (indexId > 0)
 							{
 								engineId = m_settings.getEngineId("Xapian");
@@ -931,7 +931,7 @@
 #ifdef DEBUG
 						cout << "ResultsTree::getSelection: result in internal index " << *indexIter << endl;
 #endif
-						current.setIsIndexed(m_settings.getIndexId(*indexIter), row[m_resultsColumns.m_docId]);
+						current.setIsIndexed(m_settings.getIndexIdByName(*indexIter), row[m_resultsColumns.m_docId]);
 						break;
 					}
 				}
@@ -1091,7 +1091,7 @@
 		if (mapIter != m_settings.getIndexes().end())
 		{
 			// Yes, it is
-			indexId = m_settings.getIndexId(engineName);
+			indexId = m_settings.getIndexIdByName(engineName);
 			engineId = m_settings.getEngineId("Xapian");
 		}
 	}

Modified: trunk/UI/GTK2/src/WorkerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.cpp	2007-10-15 04:06:30 UTC (rev 1042)
+++ trunk/UI/GTK2/src/WorkerThreads.cpp	2007-10-15 05:40:56 UTC (rev 1043)
@@ -782,7 +782,7 @@
 	m_documentsList.clear();
 	m_documentsList.reserve(m_maxDocsCount);
 
-	unsigned int indexId = PinotSettings::getInstance().getIndexId(m_indexName);
+	unsigned int indexId = PinotSettings::getInstance().getIndexIdByName(m_indexName);
 	for (set<unsigned int>::iterator iter = docIDList.begin(); iter != docIDList.end(); ++iter)
 	{
 		unsigned int docId = (*iter);
@@ -903,16 +903,12 @@
 	if (m_engineName == "xapian")
 	{
 		// Internal index ?
-		if (m_engineOption == settings.m_docsIndexLocation)
+		if ((m_engineOption == settings.m_docsIndexLocation) ||
+			(m_engineOption == settings.m_daemonIndexLocation))
 		{
-			indexId = settings.getIndexId(_("My Web Pages"));
+			indexId = settings.getIndexIdByLocation(m_engineOption);
 			isIndexQuery = true;
 		}
-		else if (m_engineOption == settings.m_daemonIndexLocation)
-		{
-			indexId = settings.getIndexId(_("My Documents"));
-			isIndexQuery = true;
-		}
 	}
 
 	// Will we have to query internal indices ?
@@ -964,7 +960,7 @@
 			docId = pDocsIndex->hasDocument(location);
 			if (docId > 0)
 			{
-				indexId = settings.getIndexId(_("My Web Pages"));
+				indexId = settings.getIndexIdByName(_("My Web Pages"));
 			}
 		}
 		if ((pDaemonIndex != NULL) &&
@@ -974,7 +970,7 @@
 			docId = pDaemonIndex->hasDocument(location);
 			if (docId > 0)
 			{
-				indexId = settings.getIndexId(_("My Documents"));
+				indexId = settings.getIndexIdByName(_("My Documents"));
 			}
 		}
 
@@ -1080,7 +1076,7 @@
 		else
 		{
 			processResults(resultsList,
-				PinotSettings::getInstance().getIndexId(m_engineDisplayableName));
+				PinotSettings::getInstance().getIndexIdByName(m_engineDisplayableName));
 		}
 
 		// Any spelling correction ?
@@ -1396,21 +1392,8 @@
 {
 	IndexInterface *pIndex = PinotSettings::getInstance().getIndex(m_indexLocation);
 	Url thisUrl(m_docInfo.getLocation());
-	string indexName;
 	bool doDownload = true;
 
-	// What's the name of this index ?
-	const map<string, string> &indexesMap = PinotSettings::getInstance().getIndexes();
-	for (map<string, string>::const_iterator mapIter = indexesMap.begin();
-		mapIter != indexesMap.end(); ++mapIter)
-	{
-		if (m_indexLocation == mapIter->second)
-		{
-			indexName = mapIter->first;
-			break;
-		}
-	}
-
 	// First things first, get the index
 	if ((pIndex == NULL) ||
 		(pIndex->isGood() == false))
@@ -1621,7 +1604,7 @@
 
 				// The document properties may have changed
 				pIndex->getDocumentInfo(m_docId, m_docInfo);
-				m_docInfo.setIsIndexed(PinotSettings::getInstance().getIndexId(indexName), m_docId);
+				m_docInfo.setIsIndexed(PinotSettings::getInstance().getIndexIdByLocation(m_indexLocation), m_docId);
 			}
 		}
 	}

Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2007-10-15 04:06:30 UTC (rev 1042)
+++ trunk/UI/GTK2/src/mainWindow.cc	2007-10-15 05:40:56 UTC (rev 1043)
@@ -1350,14 +1350,14 @@
 					// This document is not in either index
 					m_state.queue_index(docInfo);
 				}
-				else if (indexId == m_settings.getIndexId(_("My Web Pages")))
+				else if (indexId == m_settings.getIndexIdByName(_("My Web Pages")))
 				{
 					if (labelName.empty() == false)
 					{
 						docsIds.insert(docId);
 					}
 				}
-				else if (indexId == m_settings.getIndexId(_("My Documents")))
+				else if (indexId == m_settings.getIndexIdByName(_("My Documents")))
 				{
 					if (labelName.empty() == false)
 					{



From fabricecolin at mail.berlios.de  Mon Oct 15 15:47:39 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Mon, 15 Oct 2007 15:47:39 +0200
Subject: [Pinot-svn] r1044 - trunk/UI/GTK2/src
Message-ID: <200710151347.l9FDldHn007193@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-15 15:47:38 +0200 (Mon, 15 Oct 2007)
New Revision: 1044

Modified:
   trunk/UI/GTK2/src/WorkerThreads.cpp
   trunk/UI/GTK2/src/WorkerThreads.h
   trunk/UI/GTK2/src/mainWindow.cc
Log:
UpdateDocumentThread can update labels too.


Modified: trunk/UI/GTK2/src/WorkerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.cpp	2007-10-15 05:40:56 UTC (rev 1043)
+++ trunk/UI/GTK2/src/WorkerThreads.cpp	2007-10-15 13:47:38 UTC (rev 1044)
@@ -1671,8 +1671,7 @@
 	// Are we supposed to remove documents based on labels ?
 	if (m_docIdList.empty() == true)
 	{
-		// Yep
-		// FIXME: better delete documents one label at a time
+		// Yep, delete documents one label at a time
 		for (set<string>::iterator iter = m_labelNames.begin(); iter != m_labelNames.end(); ++iter)
 		{
 			string labelName = (*iter);
@@ -1733,12 +1732,13 @@
 	delete pIndex;
 }
 
-UpdateDocumentThread::UpdateDocumentThread(const string &indexName,
-	unsigned int docId, const DocumentInfo &docInfo) :
+UpdateDocumentThread::UpdateDocumentThread(const string &indexName, unsigned int docId,
+	const DocumentInfo &docInfo, bool updateLabels) :
 	WorkerThread(),
 	m_indexName(indexName),
 	m_docId(docId),
-	m_docInfo(docInfo)
+	m_docInfo(docInfo),
+	m_updateLabels(updateLabels)
 {
 }
 
@@ -1793,12 +1793,26 @@
 			return;
 		}
 
+		// Update the DocumentInfo
 		if (pIndex->updateDocumentInfo(m_docId, m_docInfo) == false)
 		{
 			m_errorNum = UPDATE_FAILED;
+			m_errorParam = m_docInfo.getLocation();
+			return;
 		}
+		// ...and the labels if necessary
+		if (m_updateLabels == true)
+		{
+			if (pIndex->setDocumentLabels(m_docId, m_docInfo.getLabels()) == false)
+			{
+				m_errorNum = UPDATE_FAILED;
+				m_errorParam = m_docInfo.getLocation();
+				return;
+			}
+		}
+
 		// Flush the index ?
-		else if (m_immediateFlush == true)
+		if (m_immediateFlush == true)
 		{
 			pIndex->flush();
 		}

Modified: trunk/UI/GTK2/src/WorkerThreads.h
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.h	2007-10-15 05:40:56 UTC (rev 1043)
+++ trunk/UI/GTK2/src/WorkerThreads.h	2007-10-15 13:47:38 UTC (rev 1044)
@@ -436,8 +436,8 @@
 {
 	public:
 		// Update a document's properties
-		UpdateDocumentThread(const std::string &indexName,
-			unsigned int docId, const DocumentInfo &docInfo);
+		UpdateDocumentThread(const std::string &indexName, unsigned int docId,
+			const DocumentInfo &docInfo, bool updateLabels);
 		virtual ~UpdateDocumentThread();
 
 		virtual std::string getType(void) const;
@@ -452,6 +452,7 @@
 		std::string m_indexName;
 		unsigned int m_docId;
 		DocumentInfo m_docInfo;
+		bool m_updateLabels;
 
 		virtual void doWork(void);
 

Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2007-10-15 05:40:56 UTC (rev 1043)
+++ trunk/UI/GTK2/src/mainWindow.cc	2007-10-15 13:47:38 UTC (rev 1044)
@@ -2316,7 +2316,7 @@
 
 	// Now apply these labels to all the documents
 	// FIXME: do that only if something was modified
-	if ((hadNoLabels == false) &&
+	if ((hadNoLabels == false) ||
 		(labels.empty() == false))
 	{
 		IndexInterface *pIndex = m_settings.getIndex(mapIter->second);
@@ -2348,7 +2348,7 @@
 		unsigned int indexId = 0;
 		unsigned int docId = docIter->getIsIndexed(indexId);
 
-		start_thread(new UpdateDocumentThread(indexName, docId, *docIter));
+		start_thread(new UpdateDocumentThread(indexName, docId, *docIter, false));
 	}
 
 	// Is the index list filtered with a query ?
@@ -3521,7 +3521,7 @@
 	ustring queryName = pIndexPage->getQueryName();
 	if (queryName.empty() == false)
 	{
-		// FIXME: run th document through the query
+		// FIXME: run the document through the query
 		appendToList = false;
 	}
 



From fabricecolin at mail.berlios.de  Mon Oct 15 16:18:26 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Mon, 15 Oct 2007 16:18:26 +0200
Subject: [Pinot-svn] r1045 - trunk/UI/GTK2/src
Message-ID: <200710151418.l9FEIQBL009359@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-15 16:18:26 +0200 (Mon, 15 Oct 2007)
New Revision: 1045

Modified:
   trunk/UI/GTK2/src/WorkerThreads.cpp
Log:
Be good and catch Glib exceptions too.


Modified: trunk/UI/GTK2/src/WorkerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.cpp	2007-10-15 13:47:38 UTC (rev 1044)
+++ trunk/UI/GTK2/src/WorkerThreads.cpp	2007-10-15 14:18:26 UTC (rev 1045)
@@ -30,6 +30,7 @@
 #include <sigc++/compatibility.h>
 #include <sigc++/slot.h>
 #include <glibmm/miscutils.h>
+#include <glibmm/exception.h>
 
 #include "MIMEScanner.h"
 #include "StringManip.h"
@@ -222,11 +223,16 @@
 	{
 		doWork();
 	}
-	catch (exception &ex)
+	catch (Glib::Exception &ex)
 	{
-		cerr << "Exception in thread " << m_id << ", type " << getType()
+		cerr << "Glib exception in thread " << m_id << ", type " << getType()
 			<< ":" << ex.what() << endl;
 	}
+	catch (std::exception &ex)
+	{
+		cerr << "STL exception in thread " << m_id << ", type " << getType()
+			<< ":" << ex.what() << endl;
+	}
 	catch (...)
 	{
 		cerr << "Unknown exception in thread " << m_id << ", type " << getType() << endl;



From fabricecolin at mail.berlios.de  Tue Oct 16 13:52:44 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 16 Oct 2007 13:52:44 +0200
Subject: [Pinot-svn] r1047 - trunk/UI/GTK2/src
Message-ID: <200710161152.l9GBqirw024892@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-16 13:52:44 +0200 (Tue, 16 Oct 2007)
New Revision: 1047

Modified:
   trunk/UI/GTK2/src/queryDialog.cc
Log:
Give default values to filters as examples, instead of just "xxx".


Modified: trunk/UI/GTK2/src/queryDialog.cc
===================================================================
--- trunk/UI/GTK2/src/queryDialog.cc	2007-10-16 11:30:29 UTC (rev 1046)
+++ trunk/UI/GTK2/src/queryDialog.cc	2007-10-16 11:52:44 UTC (rev 1047)
@@ -213,7 +213,6 @@
 	ustring filter;
 	time_t timeT = time(NULL);
 	struct tm *tm = localtime(&timeT);
-	bool hasValue = true;
 
 	// What's the corresponding filter ?
 	int chosenFilter = filterCombobox->get_active_row_number();
@@ -221,31 +220,31 @@
 	switch (chosenFilter)
 	{
 		case 0:
-			filter = "site";
+			filter = "site:localhost";
 			break;
 		case 1:
-			filter = "file";
+			filter = "file:xxx.txt";
 			break;
 		case 2:
-			filter = "ext";
+			filter = "ext:txt";
 			break;
 		case 3:
-			filter = "title";
+			filter = "title:pinot";
 			break;
 		case 4:
-			filter = "url";
+			filter = "url:file:///home/xxx/yyy.txt";
 			break;
 		case 5:
-			filter = "dir";
+			filter = "dir:/home/xxx";
 			break;
 		case 6:
-			filter = "lang";
+			filter = "lang:en";
 			break;
 		case 7:
-			filter = "type";
+			filter = "type:text/plain";
 			break;
 		case 8:
-			filter = "label";
+			filter = "label:New";
 			break;
 		case 9:
 			// Separator
@@ -253,16 +252,13 @@
 		case 10:
 			filter = TimeConverter::toYYYYMMDDString(tm->tm_year + 1900, tm->tm_mon + 1, tm->tm_mday);
 			filter += "..20991231";
-			hasValue = false;
 			break;
 		case 11:
 			filter = TimeConverter::toHHMMSSString(tm->tm_hour, tm->tm_min, tm->tm_sec);
 			filter += "..235959";
-			hasValue = false;
 			break;
 		case 12:
 			filter += "0..10240b";
-			hasValue = false;
 			break;
 		default:
 			break;
@@ -274,10 +270,6 @@
 		ustring queryText = refBuffer->get_text();
 		queryText += " ";
 		queryText += filter;
-		if (hasValue == true)
-		{
-			queryText += ":xxx";
-		}
 		refBuffer->set_text(queryText);
 	}
 }



From fabricecolin at mail.berlios.de  Tue Oct 16 13:30:30 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 16 Oct 2007 13:30:30 +0200
Subject: [Pinot-svn] r1046 - trunk
Message-ID: <200710161130.l9GBUUPW021761@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-16 13:30:29 +0200 (Tue, 16 Oct 2007)
New Revision: 1046

Modified:
   trunk/README
Log:
Examples of use for filters dir and title were not correct.


Modified: trunk/README
===================================================================
--- trunk/README	2007-10-15 14:18:26 UTC (rev 1045)
+++ trunk/README	2007-10-16 11:30:29 UTC (rev 1046)
@@ -167,8 +167,8 @@
   When querying an index, Pinot attempts to find the documents that best match
   the query. The query is run first as is. If no results are found, the terms
   are stemmed and the query is run again.
-  Stemming is available only to Stored Queries for which a language filter is
-  defined.
+  Stemming is available only to Stored Queries for which a language code filter
+  is defined.
 
   Queries can be expressed in a very natural way, using a combination of
   operators, filters and ranges. For instance, the query "type:text/html and
@@ -179,9 +179,9 @@
       "site" for host name, eg "site:pinot.berlios.de"
       "file" for file name, eg "file:index.html"
       "ext" for file extension, eg "ext:html"
-      "title" for title, eg "title:Session"
+      "title" for title, eg "title:pinot"
       "url" for URL, eg "url:http://pinot.berlios.de/"
-      "dir" for directory, eg "dir:/home/fabrice/test.txt"
+      "dir" for directory, eg "dir:/home/fabrice"
       "lang" for ISO language code, eg "lang:en"
       "type" for MIME type, eg "type:text/html"
       "label" for label, eg "label:Important"



From fabricecolin at mail.berlios.de  Tue Oct 16 15:55:04 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 16 Oct 2007 15:55:04 +0200
Subject: [Pinot-svn] r1048 - trunk/Search
Message-ID: <200710161355.l9GDt4Si002648@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-16 15:55:04 +0200 (Tue, 16 Oct 2007)
New Revision: 1048

Modified:
   trunk/Search/XapianEngine.cpp
Log:
Sort by relevance first and then by date, rather than by relevance only.
The latter seems to cause MSet::get_matches_estimated() to return figures way
below what we would get when sorting by date then relevance...


Modified: trunk/Search/XapianEngine.cpp
===================================================================
--- trunk/Search/XapianEngine.cpp	2007-10-16 11:52:44 UTC (rev 1047)
+++ trunk/Search/XapianEngine.cpp	2007-10-16 13:55:04 UTC (rev 1048)
@@ -398,12 +398,18 @@
 		if (queryProps.getSortOrder() == QueryProperties::RELEVANCE)
 		{
 			// By relevance, only
-			enquire.set_sort_by_relevance();
+			enquire.set_sort_by_relevance_then_value(4);
+#ifdef DEBUG
+			cout << "XapianEngine::queryDatabase: sorting by relevance first" << endl;
+#endif
 		}
 		else if (queryProps.getSortOrder() == QueryProperties::DATE)
 		{
 			// By date, and then by relevance
 			enquire.set_sort_by_value_then_relevance(4);
+#ifdef DEBUG
+			cout << "XapianEngine::queryDatabase: sorting by date and time first" << endl;
+#endif
 		}
 
 		// Get the top results of the query



From fabricecolin at mail.berlios.de  Tue Oct 16 16:03:27 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 16 Oct 2007 16:03:27 +0200
Subject: [Pinot-svn] r1049 - trunk/UI/GTK2/src
Message-ID: <200710161403.l9GE3RJh003679@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-16 16:03:27 +0200 (Tue, 16 Oct 2007)
New Revision: 1049

Modified:
   trunk/UI/GTK2/src/propertiesDialog.cc
Log:
Don't show Unknown for size 0, it's fine. Several labels may be applied, so
use the plural Labels in the list. Pass an empty string for language Unknown.


Modified: trunk/UI/GTK2/src/propertiesDialog.cc
===================================================================
--- trunk/UI/GTK2/src/propertiesDialog.cc	2007-10-16 13:55:04 UTC (rev 1048)
+++ trunk/UI/GTK2/src/propertiesDialog.cc	2007-10-16 14:03:27 UTC (rev 1049)
@@ -50,7 +50,7 @@
 	m_refLabelsTree = ListStore::create(m_labelsColumns);
 	labelsTreeview->set_model(m_refLabelsTree);
 	labelsTreeview->append_column_editable(" ", m_labelsColumns.m_enabled);
-	labelsTreeview->append_column(_("Label"), m_labelsColumns.m_name);
+	labelsTreeview->append_column(_("Labels"), m_labelsColumns.m_name);
 	// Allow only single selection
 	labelsTreeview->get_selection()->set_mode(SELECTION_SINGLE);
 
@@ -86,15 +86,8 @@
 			titleEntry->set_text(to_utf8(docInfo.getTitle()));
 			typeEntry->set_text(to_utf8(docInfo.getType()));
 			unsigned int size = docInfo.getSize();
-			if (size == 0)
-			{
-				sizeEntry->set_text(_("Unknown"));
-			}
-			else
-			{
-				snprintf(numStr, 128, "%u", size);
-				sizeEntry->set_text(numStr);
-			}
+			snprintf(numStr, 128, "%u", size);
+			sizeEntry->set_text(numStr);
 			if (termsCount == 0)
 			{
 				termsEntry->set_text(_("Unknown"));
@@ -254,7 +247,8 @@
 
 void propertiesDialog::on_labelOkButton_clicked()
 {
-	unsigned int languageStart = 0;
+	string languageName(from_utf8(languageCombobox->get_active_text()));
+	int unknownLanguagePos = 0;
 
 	// If only one document was edited, set its title
 	if (m_editDocument == true)
@@ -267,11 +261,15 @@
 	// Did we add an extra string to the languages list ?
 	if (m_notALanguageName == true)
 	{
-		languageStart = 1;
+		unknownLanguagePos = 1;
 	}
-	int chosenLanguage = languageCombobox->get_active_row_number();
+	int chosenLanguagePos = languageCombobox->get_active_row_number();
+	if (chosenLanguagePos == unknownLanguagePos)
+	{
+		languageName.clear();
+	}
 #ifdef DEBUG
-	cout << "propertiesDialog::on_labelOkButton_clicked: chosen language " << languageCombobox->get_active_text() << endl;
+	cout << "propertiesDialog::on_labelOkButton_clicked: chosen language " << languageName << endl;
 #endif
 
 	// Go through the labels tree
@@ -299,9 +297,9 @@
 		docIter != m_documentsList.end(); ++docIter)
 	{
 		// Apply the new language if necessary
-		if (chosenLanguage >= languageStart)
+		if (chosenLanguagePos >= unknownLanguagePos)
 		{
-			docIter->setLanguage(from_utf8(languageCombobox->get_active_text()));
+			docIter->setLanguage(from_utf8(languageName));
 		}
 
 		// Apply labels



From fabricecolin at mail.berlios.de  Tue Oct 16 16:22:32 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 16 Oct 2007 16:22:32 +0200
Subject: [Pinot-svn] r1050 - trunk/Tokenize
Message-ID: <200710161422.l9GEMWfO004777@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-16 16:22:32 +0200 (Tue, 16 Oct 2007)
New Revision: 1050

Modified:
   trunk/Tokenize/Makefile.am
Log:
Filter libraries need not link against libBasicUtils anymore.


Modified: trunk/Tokenize/Makefile.am
===================================================================
--- trunk/Tokenize/Makefile.am	2007-10-16 14:03:27 UTC (rev 1049)
+++ trunk/Tokenize/Makefile.am	2007-10-16 14:22:32 UTC (rev 1050)
@@ -22,7 +22,7 @@
 
 libexternalfilter_la_LDFLAGS = -module @XML_CFLAGS@
 
-libexternalfilter_la_LIBADD = -L../Utils -lBasicUtils
+libexternalfilter_la_LIBADD =
 
 libmboxfilter_la_SOURCES = \
 	filters/Filter.cc \
@@ -30,7 +30,7 @@
 
 libmboxfilter_la_LDFLAGS = -module @GMIME_CFLAGS@
 
-libmboxfilter_la_LIBADD = -L../Utils -lBasicUtils
+libmboxfilter_la_LIBADD =
 
 libtaglibfilter_la_SOURCES = \
 	filters/Filter.cc \
@@ -38,7 +38,7 @@
 
 libtaglibfilter_la_LDFLAGS = -module @TAGLIB_LIBS@
 
-libtaglibfilter_la_LIBADD = -L../Utils -lBasicUtils
+libtaglibfilter_la_LIBADD =
 
 libTokenize_la_SOURCES = \
 	FilterUtils.cpp \



From fabricecolin at mail.berlios.de  Wed Oct 17 16:26:54 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Wed, 17 Oct 2007 16:26:54 +0200
Subject: [Pinot-svn] r1051 - trunk
Message-ID: <200710171426.l9HEQsiE002008@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-17 16:26:54 +0200 (Wed, 17 Oct 2007)
New Revision: 1051

Modified:
   trunk/README
Log:
Revised section 6.


Modified: trunk/README
===================================================================
--- trunk/README	2007-10-16 14:22:32 UTC (rev 1050)
+++ trunk/README	2007-10-17 14:26:54 UTC (rev 1051)
@@ -8,7 +8,7 @@
 3. Available engines
 4. Indexes
 5. Indexing and monitoring
-6. Search strategy
+6. Searching
 7. Viewing cached results
 8. File formats
 9. File patterns
@@ -161,20 +161,22 @@
   patterns as described in section "9. File patterns".
 
 
-6. Search strategy
+6. Searching
 
 
-  When querying an index, Pinot attempts to find the documents that best match
-  the query. The query is run first as is. If no results are found, the terms
-  are stemmed and the query is run again.
-  Stemming is available only to Stored Queries for which a language code filter
-  is defined.
+  Searches are run differently based on the type of engine being queries.
 
-  Queries can be expressed in a very natural way, using a combination of
-  operators, filters and ranges. For instance, the query "type:text/html and
-  lang:en and (tcp near ip)" will look for HTML files in English that mention
-  TCP/IP. 
+  When querying a Web engine, Pinot assumes this engine understands the query,
+  which is sent as is. No pre-processing is performed on the text of the query,
+  and the results list is more or less presented as retrieved from the Web
+  engine.
 
+  When querying an index, things are somewhat different. Queries can be
+  expressed in a very natural way, using a combination of operators, filters
+  and ranges.
+  For instance, the query "type:text/html and lang:en and (tcp near ip)" will
+  look for HTML files in English that mention TCP/IP. 
+
   Supported filters are :
       "site" for host name, eg "site:pinot.berlios.de"
       "file" for file name, eg "file:index.html"
@@ -189,8 +191,14 @@
   Allowed language codes are "da", "nl", "en", "fi", "fr", "de", "it", "nn", "pt",
   "ru", "es" and "sv".
 
-  The values of "file", "url", "dir" and "label" may be double-quoted.
+  Stemming is available to queries for which a language code filter is defined.
+  If no results are found for such a query, the terms are stemmed and the query
+  is run again.
 
+  The values of "file", "url", "dir" and "label" may be double-quoted. It's also
+  worth pointing out that the query "dir:/X/Y" will return files and directories
+  located in /X/Y, but not Y itself, which is what "dir:/X file:Y" would do.
+
   Supported ranges are :
       "YYYYMMDD..YYYYMMDD" for date ranges, eg "20070801..20070831"
       "HHMMSS..HHMMSS" for time ranges, eg "090000..180000"



From fabricecolin at mail.berlios.de  Thu Oct 18 13:14:11 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Thu, 18 Oct 2007 13:14:11 +0200
Subject: [Pinot-svn] r1052 - trunk/Search
Message-ID: <200710181114.l9IBEBRe024524@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-18 13:14:10 +0200 (Thu, 18 Oct 2007)
New Revision: 1052

Modified:
   trunk/Search/XapianEngine.cpp
Log:
"title:" should really be a probabilistic term prefix. Some extra DEBUG.


Modified: trunk/Search/XapianEngine.cpp
===================================================================
--- trunk/Search/XapianEngine.cpp	2007-10-17 14:26:54 UTC (rev 1051)
+++ trunk/Search/XapianEngine.cpp	2007-10-18 11:14:10 UTC (rev 1052)
@@ -212,7 +212,7 @@
 	parser.add_boolean_prefix("site", "H");
 	parser.add_boolean_prefix("file", "P");
 	parser.add_boolean_prefix("ext", "XEXT:");
-	parser.add_boolean_prefix("title", "S");
+	parser.add_prefix("title", "S");
 	parser.add_boolean_prefix("url", "U");
 	parser.add_boolean_prefix("dir", "XDIR:");
 	parser.add_boolean_prefix("lang", "L");
@@ -418,8 +418,10 @@
 		{
 			m_resultsCountEstimate = matches.get_matches_estimated();
 #ifdef DEBUG
-			cout << "XapianEngine::queryDatabase: " << matches.size() << "/" << m_resultsCountEstimate << "/"
-				<< maxResultsCount << " results found from position " << startDoc << endl;
+			cout << "XapianEngine::queryDatabase: found " << matches.size() << "/" << maxResultsCount
+				<< " results found from position " << startDoc << endl;
+			cout << "XapianEngine::queryDatabase: estimated " << matches.get_matches_lower_bound()
+				<< "/" << m_resultsCountEstimate << "/" << matches.get_matches_upper_bound() << endl;
 #endif
 
 			// Get the results



From fabricecolin at mail.berlios.de  Thu Oct 18 13:23:15 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Thu, 18 Oct 2007 13:23:15 +0200
Subject: [Pinot-svn] r1053 - trunk
Message-ID: <200710181123.l9IBNFCi009923@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-18 13:23:15 +0200 (Thu, 18 Oct 2007)
New Revision: 1053

Modified:
   trunk/configure.in
Log:
Check for socketpair(), fork() and setrlimit().


Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2007-10-18 11:14:10 UTC (rev 1052)
+++ trunk/configure.in	2007-10-18 11:23:15 UTC (rev 1053)
@@ -283,6 +283,9 @@
 AC_CHECK_FUNCS(timegm)
 AC_CHECK_FUNCS(lstat)
 AC_CHECK_FUNCS(mmap)
+AC_CHECK_FUNCS(socketpair)
+AC_CHECK_FUNCS(fork)
+AC_CHECK_FUNCS(setrlimit)
 
 AC_OUTPUT( pinot.spec UI/GTK2/src/de.berlios.Pinot.service Makefile \
 	Utils/Makefile Tokenize/Makefile SQL/Makefile po/Makefile.in Collect/Makefile )



From fabricecolin at mail.berlios.de  Thu Oct 18 16:56:03 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Thu, 18 Oct 2007 16:56:03 +0200
Subject: [Pinot-svn] r1054 - in trunk: . Search UI/GTK2/src
Message-ID: <200710181456.l9IEu3OS027511@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-18 16:56:02 +0200 (Thu, 18 Oct 2007)
New Revision: 1054

Modified:
   trunk/README
   trunk/Search/QueryProperties.cpp
   trunk/Search/XapianEngine.cpp
   trunk/UI/GTK2/src/PinotSettings.cpp
Log:
XapianEngine::queryDatabase() logs how long queries took (setting up Enquire,
getting the MSet, generating abstracts).
PinotSettings creates a Me query on the first run.
Fixed comment in QueryProperties.
The README talks about D-Bus timeouts that may occur when the system is busy.


Modified: trunk/README
===================================================================
--- trunk/README	2007-10-18 11:23:15 UTC (rev 1053)
+++ trunk/README	2007-10-18 14:56:02 UTC (rev 1054)
@@ -318,13 +318,19 @@
      * when starting, the service will first crawl all configured locations
        and (re)index new and modified files. Starting with 0.64, the daemon's
        scheduling priority is set very low (15, can be adjusted with --priority)
-       so that you can still play UT2004 while it is indexing !
+       so that you can do stuff while it is indexing !
      * when finished crawling, the service will monitor these locations
        for changes and should consume little resources, unless a huge
        quantity of files needs its attention.
      * any change detected by the monitor is immediately queued and acted upon
        as soon as possible, eg reindex a file that was modified. This and low
        priority should make the daemon not very intrusive.
+     * operations that involve communicating with the daemon, such as editing
+       documents metadata, may timeout if the system is under heavy load and/or
+       the daemon is busy. In most cases, the message will have been received
+       by the daemon, but the reply may take longer than expected. The Pinot
+       UI may report that the operation failed, even though it was queued for
+       processing and will be acted upon by the daemon as soon as possible.
 
   If you have dbus-send installed, you can start the daemon manually by calling
   the GetStatistics method with

Modified: trunk/Search/QueryProperties.cpp
===================================================================
--- trunk/Search/QueryProperties.cpp	2007-10-18 11:23:15 UTC (rev 1053)
+++ trunk/Search/QueryProperties.cpp	2007-10-18 14:56:02 UTC (rev 1054)
@@ -193,7 +193,7 @@
 	return m_freeQueryWithoutFilters;
 }
 
-/// Gets the query's language.
+/// Gets the value of a specific filter.
 string QueryProperties::getFilter(const string &filterStr)
 {
 	if ((m_freeQuery.empty() == true) ||

Modified: trunk/Search/XapianEngine.cpp
===================================================================
--- trunk/Search/XapianEngine.cpp	2007-10-18 11:23:15 UTC (rev 1053)
+++ trunk/Search/XapianEngine.cpp	2007-10-18 14:56:02 UTC (rev 1054)
@@ -28,6 +28,7 @@
 #include "Languages.h"
 #include "StringManip.h"
 #include "TimeConverter.h"
+#include "Timer.h"
 #include "Url.h"
 #include "XapianDatabaseFactory.h"
 #include "AbstractGenerator.h"
@@ -376,6 +377,7 @@
 bool XapianEngine::queryDatabase(Xapian::Database *pIndex, Xapian::Query &query,
 	unsigned int startDoc, const QueryProperties &queryProps)
 {
+	Timer timer;
 	unsigned int maxResultsCount = queryProps.getMaximumResultsCount();
 	bool completedQuery = false;
 
@@ -387,6 +389,7 @@
 	// Start an enquire session on the database
 	Xapian::Enquire enquire(*pIndex);
 
+	timer.start();
 	try
 	{
 		AbstractGenerator abstractGen(pIndex, 50);
@@ -469,6 +472,7 @@
 	{
 		cerr << "XapianEngine::queryDatabase: " << error.get_type() << ": " << error.get_msg() << endl;
 	}
+	cout << "Ran query \"" << query.get_description() << "\" in " << timer.stop() << " ms" << endl;
 
 	try
 	{
@@ -630,9 +634,6 @@
 			m_defaultOperator, m_limitQuery, m_correctedFreeQuery);
 		while (fullQuery.empty() == false)
 		{
-#ifdef DEBUG
-			cout << "XapianEngine::runQuery: " << fullQuery.get_description() << endl;
-#endif
 			// Query the database
 			if (queryDatabase(pIndex, fullQuery, startDoc, queryProps) == false)
 			{

Modified: trunk/UI/GTK2/src/PinotSettings.cpp
===================================================================
--- trunk/UI/GTK2/src/PinotSettings.cpp	2007-10-18 11:23:15 UTC (rev 1053)
+++ trunk/UI/GTK2/src/PinotSettings.cpp	2007-10-18 14:56:02 UTC (rev 1054)
@@ -337,6 +337,30 @@
 		m_filePatternsList.insert("*.wmv");
 		m_filePatternsList.insert("*.xbm");
 		m_filePatternsList.insert("*.xpm");
+		// Create default queries
+		struct passwd *pPasswd = getpwuid(geteuid());
+		if (pPasswd != NULL)
+		{
+			string userName;
+
+			if ((pPasswd->pw_gecos != NULL) &&
+				(strlen(pPasswd->pw_gecos) > 0))
+			{
+				userName = pPasswd->pw_gecos;
+			}
+			else if (pPasswd->pw_name != NULL)
+			{
+				userName = pPasswd->pw_name;
+			}
+
+			if (userName.empty() == false)
+			{
+				QueryProperties queryProps(_("Me"), userName);
+
+				queryProps.setSortOrder(QueryProperties::DATE);
+				addQuery(queryProps);
+			}
+		}
 	}
 
 	// Some search engines are hardcoded
@@ -1620,7 +1644,7 @@
 /// Adds a new query.
 bool PinotSettings::addQuery(const QueryProperties &properties)
 {
-	string name = properties.getName();
+	string name(properties.getName());
 
 	map<string, QueryProperties>::iterator queryIter = m_queries.find(name);
 	if (queryIter == m_queries.end())



From fabricecolin at mail.berlios.de  Fri Oct 19 16:29:57 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Fri, 19 Oct 2007 16:29:57 +0200
Subject: [Pinot-svn] r1055 - trunk
Message-ID: <200710191429.l9JETvTg019693@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-19 16:29:56 +0200 (Fri, 19 Oct 2007)
New Revision: 1055

Modified:
   trunk/NEWS
   trunk/TODO
Log:
Current development status.


Modified: trunk/NEWS
===================================================================
--- trunk/NEWS	2007-10-18 14:56:02 UTC (rev 1054)
+++ trunk/NEWS	2007-10-19 14:29:56 UTC (rev 1055)
@@ -1,3 +1,38 @@
+??? version_0_8_0
+Build :
+ - SMP builds, thanks to Gabriel C
+Index :
+ - external programs are limited to 5 minutes of CPU time
+ - unknown document types can be indexed if one of their parent types is known
+ - new pinot-label tool to get, set and list labels from the command-line
+Search :
+ - support for date (year, month, day), time (hours, minutes, seconds) and
+  size (in bytes) ranges
+ - attempt to correct the spelling of index queries that don't match anything
+ - log how long queries take
+ - keep connection to remote databases alive
+ - better query expansion
+ - the Yahoo! plugin was replaced with the Yahoo! API plugin
+ - pass queries to Web engines unmodified, without attempting to filter results
+  based on filters or range used in the query
+Daemon :
+ - fixed Reload method
+ - new D-Bus methods to manage labels
+ - new --reindex option
+UI :
+ - Search This For menu to search in results
+ - suggest spelling corrections for index queries that don't match anything
+ - all indices can be browsed
+ - inline URL completion in the import dialog box, based on previous results
+ - better support for user-specific MIME settings, thanks to Lee Marks
+ - reload MIME settings when they are edited
+ - can now get a stored query to search in the results of a previous query
+ - results of stored queries can be sorted by relevance or by date
+ - new History button to show previous results for a stored query
+ - documents' properties are updated in the background
+ - documents' terms can be saved to a file
+ - Status window shows description of errors
+
 2007/08/23 version_0_7_6
 Build :
  - also look for textcat.h in libtextcat

Modified: trunk/TODO
===================================================================
--- trunk/TODO	2007-10-18 14:56:02 UTC (rev 1054)
+++ trunk/TODO	2007-10-19 14:29:56 UTC (rev 1055)
@@ -6,19 +6,18 @@
 - How to trouble-shoot with delve, get to a file with filters and labels
 - Explain when indexing and updating are done, eg in the results list, Index on
  a result already indexed doesn't update it
-- Document which query parameters apply to Web engines
 
 General
 - Fix the FIXMEs
 - Get rid of dead code/classes/methods...
 - Advertise service via Rendezvous
 - Extend metadata beyond title,location,language,type,timestamp,size
-- Sync with gtk+'s xdgmime
-- Build against Fedora's patched libtextcat
-- Remove Pinot dependencies from Dijon, move code to trunk
 - Don't package gmo files, they are platform dependent
-- Use po/LINGUAS
+- Check for http_proxy and such in the environment and initialize Network params
 
+Deskbar
+- Update to a module
+
 Tokenize
 - Allow to cache documents that had to be converted ? eg PDF, MS Word
 - PDF filter with poppler
@@ -30,10 +29,10 @@
 - Filters should have a version number so that new versions force reindexing documents of the
  given type
 - XmLFilter is slow-ish, rewrite file parsing with the TextReader interface
+- Filters should at least return errno when they fail
 
 SQL
 - Move history files into the index directories
-- Labels are lost when a document is queued for indexing !
 
 Monitor
 - Implement support for Solaris FEM
@@ -52,11 +51,10 @@
 - Make sure Description files' SyndicationRight is not private or closed
 - Get hold of stopwords lists for the languages supported by Xapian's stemmers
  and remove stopwords from queries as first step of search
-- Enable to search in results, either by combining queries or via a results set
-- The ext filter should apply to all engines
-- Google and maybe others support the site filter so don't remove it from queries
-- Isolate dependencies on Xapian so that it can eventually be moved into a .so
-- Filter on time
+- Isolate dependencies on Xapian so that they can eventually be moved into a .so
+- getCloseTerms() should be a search engine method so that WebEngine can use plugins'
+ suggestions Url field (http://developer.mozilla.org/en/docs/Supporting_search_suggestions_in_search_plugins)
+- pinot-search should be able to run stored queries, as found in the configuration file
 
 Index
 - Play around with the XAPIAN_FLUSH_THRESHOLD env var
@@ -69,10 +67,9 @@
 - Reverse terms so that left wildcards can be applied ?
 - XapianIndex could do with some common code refactoring
 - Automatically categorize documents based on MIME type and source into picture, video, etc...
-- DBusXapianIndex to use D-Bus method Index
-- pinot-index to instantiate a DBusXapianIndex if dealing with the daemon index
 - After indexing or updating a document, a call to getDocumentInfo() shouldn't be necessary
-- Add a value for time
+- Labels and the rest of DocumentInfo are handled separately, they shouldn't be
+- Indexes have no knowledge of indexId's
 
 Mail
 - Find out what kind of locking scheme Mozilla uses (POSIX lock ?) and use that
@@ -80,45 +77,34 @@
 - Index mail headers
 - Decypher and use Mozilla's mailbox scheme, eg
   mailbox://mbox_file_name?number=2164959&part=1.2&type=text/plain&filename=portability.txt
-- When parsing email's Date field, take the timezone offset into account, eg in
-    Date: Thu, 25 Aug 2005 11:04:49 +0800
-  +0800 is basically same as SGT. At the moment the date is assumed to be GMT !
 - Keep track of attachments and avoid indexing the same file twice
 
 Daemon
-- Allow building without inotify/the DBus daemon
+- Allow building without the daemon
+- Enable to deactivate D-Bus interface
 - Clean up method names
 - Prefer ustring to string whenever possible
 - Queue unindexing too
 - Don't link against SOAP stuff, it's not needed here
-- Labels should be managed by the daemon, and not saved to the configuration file
-- DBus SetDocument[s]Labels should create labels if necessary
-- Reintroduce Index method in D-Bus interface
 - Export term suggestion over D-Bus
-- There's currently no way to get a document's ID without running a search
+- There's currently no easy way to get a document's ID without running a search
 - Follow updates to Xesam specs
-- Enable to deactivate D-Bus interface
+- Suspend indexing on battery use (/proc/acpi/ac_adapter/AC/state, AC0/state,
+ ADp1/state or ACAD/state)
 
 UI
-- When sorting results by host name, give better score to results that appear
- several times
 - Show which threads are running, what they are doing, and allow to stop them
  selectively
-- Automatic indexing of a query's results depending on type, source, size,
- language
 - Display search engines icons (Gtk::IconSource::set_filename() and Gtk::Style::render_icon())
 - Replace glademm with libglademm ?
 - Make unique (http://guniqueapp.akl.lt/)
 - Either Live Query behaves like a live query (eg results list updated when new
  documents match) or it is renamed to something else to avoid confusion
-- When viewing a result, all rows for that same URL should be updated with the
- Viewed icon
-- Set results' indexed status after IndexingThread returns
+- When viewing or indexing a result, all rows for that same URL should be updated with
+ the Viewed or Indexed icons (the latter after IndexingThread returns)
 - Make use of GTKmm 2.10 StatusIcon
-- Query expansion should be interactive
 - UI doesn't show documents indexed by the daemon the very first time it's run,
  at least until it's restarted
-- Errors should say what failed !
 - Unknown exceptions in IndexingThread or elsewhere should be logged as errors
 - Show whether Pinot was built with boost Spirit and how many plugins of each
  type there are
@@ -126,7 +112,8 @@
 - Show which stored queries are fully, partially or not at all Web friendly
 - List viewed URLs
 - Let queries index only new results
-- Show a query's latest results, as cached in the history database
-- Query correction should be optional
+- Query expansion should be interactive
 - Default cache provider should be configurable
+- Keep warning about the old index version until silenced by the user, or until
+ documents are updated
 



From fabricecolin at mail.berlios.de  Fri Oct 19 16:32:50 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Fri, 19 Oct 2007 16:32:50 +0200
Subject: [Pinot-svn] r1056 - trunk/UI/GTK2/src
Message-ID: <200710191432.l9JEWoAJ019897@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-19 16:32:49 +0200 (Fri, 19 Oct 2007)
New Revision: 1056

Modified:
   trunk/UI/GTK2/src/DaemonState.cpp
   trunk/UI/GTK2/src/mainWindow.cc
Log:
In mainWindow, get UpdateDocumentThread to update labels on each document.
In DaemonState, log errors reported by IndexingThread.


Modified: trunk/UI/GTK2/src/DaemonState.cpp
===================================================================
--- trunk/UI/GTK2/src/DaemonState.cpp	2007-10-19 14:29:56 UTC (rev 1055)
+++ trunk/UI/GTK2/src/DaemonState.cpp	2007-10-19 14:32:49 UTC (rev 1056)
@@ -30,6 +30,7 @@
 #include "config.h"
 #include "Url.h"
 #include "MonitorFactory.h"
+#include "CrawlHistory.h"
 #include "XapianIndex.h"
 #include "DaemonState.h"
 #include "OnDiskHandler.h"
@@ -228,6 +229,17 @@
 		}
 	}
 
+	// Did it fail ?
+	int errorNum = pThread->getErrorNum();
+	if ((errorNum > 0) &&
+		(indexedUrl.empty() == false))
+	{
+		CrawlHistory history(PinotSettings::getInstance().getHistoryDatabaseName());
+
+		// An entry should already exist for this
+		history.updateItem(indexedUrl, CrawlHistory::ERROR, time(NULL), errorNum);
+	}
+
 	// Delete the thread
 	delete pThread;
 

Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2007-10-19 14:29:56 UTC (rev 1055)
+++ trunk/UI/GTK2/src/mainWindow.cc	2007-10-19 14:32:49 UTC (rev 1056)
@@ -1604,7 +1604,11 @@
 			if ((pResultsTree != NULL) &&
 				(pResultsTree->updateResult(pUpdateThread->getDocumentInfo()) == true))
 			{
-				status = _("Updated document properties");
+				char docIdStr[64];
+
+				status = _("Updated document");
+				snprintf(docIdStr, 64, "%u", pUpdateThread->getDocumentID());
+				status += docIdStr;
 				set_status(status);
 			}
 		}
@@ -2259,6 +2263,7 @@
 	vector<DocumentInfo> documentsList;
 	string indexName, queryName;
 	int width, height;
+	bool updateLabels = false;
 
 #ifdef DEBUG
 	cout << "mainWindow::on_showfromindex_activate: called" << endl;
@@ -2319,25 +2324,7 @@
 	if ((hadNoLabels == false) ||
 		(labels.empty() == false))
 	{
-		IndexInterface *pIndex = m_settings.getIndex(mapIter->second);
-		if (pIndex != NULL)
-		{
-			set<unsigned int> docIds;
-
-			for (vector<DocumentInfo>::iterator docIter = documentsList.begin();
-				docIter != documentsList.end(); ++docIter)
-			{
-				unsigned int indexId = 0;
-
-				docIds.insert(docIter->getIsIndexed(indexId));
-			}
-
-			// Set the document's labels list
-			// FIXME: this should be done by a thread
-			pIndex->setDocumentsLabels(docIds, labels);
-
-			delete pIndex;
-		}
+		updateLabels = true;
 	}
 
 	// Update all documents
@@ -2348,7 +2335,7 @@
 		unsigned int indexId = 0;
 		unsigned int docId = docIter->getIsIndexed(indexId);
 
-		start_thread(new UpdateDocumentThread(indexName, docId, *docIter, false));
+		start_thread(new UpdateDocumentThread(indexName, docId, *docIter, updateLabels));
 	}
 
 	// Is the index list filtered with a query ?



From fabricecolin at mail.berlios.de  Fri Oct 19 17:48:42 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Fri, 19 Oct 2007 17:48:42 +0200
Subject: [Pinot-svn] r1057 - trunk/UI/GTK2/src
Message-ID: <200710191548.l9JFmgx4025526@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-19 17:48:42 +0200 (Fri, 19 Oct 2007)
New Revision: 1057

Modified:
   trunk/UI/GTK2/src/propertiesDialog.hh
Log:
Fixed warning about order of initialization.


Modified: trunk/UI/GTK2/src/propertiesDialog.hh
===================================================================
--- trunk/UI/GTK2/src/propertiesDialog.hh	2007-10-19 14:32:49 UTC (rev 1056)
+++ trunk/UI/GTK2/src/propertiesDialog.hh	2007-10-19 15:48:42 UTC (rev 1057)
@@ -42,9 +42,9 @@
 
 protected:
 	LabelModelColumns m_labelsColumns;
-	std::vector<DocumentInfo> &m_documentsList;
 	Glib::RefPtr<Gtk::ListStore> m_refLabelsTree;
 	std::string m_indexLocation;
+	std::vector<DocumentInfo> &m_documentsList;
 	std::set<std::string> m_labels;
 	unsigned int m_docId;
 	bool m_notALanguageName;



From fabricecolin at mail.berlios.de  Fri Oct 19 18:20:05 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Fri, 19 Oct 2007 18:20:05 +0200
Subject: [Pinot-svn] r1058 - trunk/Search
Message-ID: <200710191620.l9JGK5jO027215@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-19 18:20:05 +0200 (Fri, 19 Oct 2007)
New Revision: 1058

Modified:
   trunk/Search/XapianEngine.cpp
   trunk/Search/pinot-search.cpp
Log:
Pinot-search didn't show date and size.
When showing query times, XapianEngine displays the query text instead of the
output of Query::get_description() which may be misleading.


Modified: trunk/Search/XapianEngine.cpp
===================================================================
--- trunk/Search/XapianEngine.cpp	2007-10-19 15:48:42 UTC (rev 1057)
+++ trunk/Search/XapianEngine.cpp	2007-10-19 16:20:05 UTC (rev 1058)
@@ -472,7 +472,7 @@
 	{
 		cerr << "XapianEngine::queryDatabase: " << error.get_type() << ": " << error.get_msg() << endl;
 	}
-	cout << "Ran query \"" << query.get_description() << "\" in " << timer.stop() << " ms" << endl;
+	cout << "Ran query \"" << queryProps.getFreeQuery() << "\" in " << timer.stop() << " ms" << endl;
 
 	try
 	{

Modified: trunk/Search/pinot-search.cpp
===================================================================
--- trunk/Search/pinot-search.cpp	2007-10-19 15:48:42 UTC (rev 1057)
+++ trunk/Search/pinot-search.cpp	2007-10-19 16:20:05 UTC (rev 1058)
@@ -272,15 +272,13 @@
 				while (resultIter != resultsList.end())
 				{
 					string rawUrl(resultIter->getLocation());
-					Url thisUrl(rawUrl);
 
-					cout << count << " Raw URL  : '" << rawUrl << "'"<< endl;
-					cout << count << " Protocol : " << thisUrl.getProtocol() << endl;
-					cout << count << " Host     : " << thisUrl.getHost() << endl;
-					cout << count << " Location : " << thisUrl.getLocation() << "/" << thisUrl.getFile() << endl;
+					cout << count << " Location : '" << rawUrl << "'"<< endl;
 					cout << count << " Title    : " << resultIter->getTitle() << endl;
 					cout << count << " Type     : " << resultIter->getType() << endl;
 					cout << count << " Language : " << resultIter->getLanguage() << endl;
+					cout << count << " Date     : " << resultIter->getTimestamp() << endl;
+					cout << count << " Size     : " << resultIter->getSize() << endl;
 					cout << count << " Extract  : " << resultIter->getExtract() << endl;
 					cout << count << " Score    : " << resultIter->getScore() << endl;
 					count++;



From fabricecolin at mail.berlios.de  Fri Oct 19 18:49:47 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Fri, 19 Oct 2007 18:49:47 +0200
Subject: [Pinot-svn] r1059 - trunk
Message-ID: <200710191649.l9JGnlZK000475@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-19 18:49:46 +0200 (Fri, 19 Oct 2007)
New Revision: 1059

Modified:
   trunk/README
Log:
Mention that "pinot-dbus-daemon --reindex" will reset the My Documents index.


Modified: trunk/README
===================================================================
--- trunk/README	2007-10-19 16:20:05 UTC (rev 1058)
+++ trunk/README	2007-10-19 16:49:46 UTC (rev 1059)
@@ -369,17 +369,22 @@
   If you want to reset My Web Pages, you can either :
     * use Pinot to unindex every single document by selecting them all
       and choosing Unindex in the Index menu
-    * or delete ~/.pinot/index or ~/.pinot/index/* while Pinot isn't running
+    * or delete ~/.pinot/index/* while Pinot isn't running
 
   If you want to reset My Documents, special considerations apply because
-  of the historical data maintained by the daemon. First, make sure the
-  daemon is stopped, then delete the index with
+  of the historical data maintained by the daemon. There are two ways to
+  proceed, and both require that the daemon be stopped.
+
+  The manual way is to delete the index with
   $ rm ~/.pinot/daemon/*
-  and remove historical data as follows
-  $ sqlite3 ~/.pinot/history-daemon "delete from CrawlHistory; \
-    delete from CrawlSources;"
+  and remove historical data with
+  $ sqlite3 ~/.pinot/history-daemon "delete from CrawlHistory; delete from CrawlSources;"
 
+  The automated way is to tell the daemon to reindex everything by launching
+  it with the "--reindex" option, ie
+  $ pinot-dbus-daemon --reindex
 
+
 15. Dependencies
 
 



From fabricecolin at mail.berlios.de  Sun Oct 21 17:15:38 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sun, 21 Oct 2007 17:15:38 +0200
Subject: [Pinot-svn] r1060 - trunk
Message-ID: <200710211515.l9LFFcx4006530@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-21 17:15:38 +0200 (Sun, 21 Oct 2007)
New Revision: 1060

Modified:
   trunk/configure.in
Log:
Check for the OpenSSL package if required by Curl. Reported by Adel Gadllah.


Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2007-10-19 16:49:46 UTC (rev 1059)
+++ trunk/configure.in	2007-10-21 15:15:38 UTC (rev 1060)
@@ -145,6 +145,7 @@
 else
    EXTRA_HTTP_CFLAGS="-DUSE_CURL -DUSE_SSL"
    AC_MSG_RESULT(yes)
+   PKG_CHECK_MODULES(SSL, openssl >= 0.9.7 )
 fi
 HTTP_DOWNLOADER="CurlDownloader"
 ;;
@@ -248,8 +249,8 @@
 PKG_CHECK_MODULES(SQL, sqlite3 >= 3.1 )
 AC_SUBST(SQL_CFLAGS)
 AC_SUBST(SQL_LIBS)
-HTTP_CFLAGS="$NEON_CFLAGS $SSL_CFLAGS $CURL_CFLAGS $EXTRA_HTTP_CFLAGS"
-HTTP_LIBS="$NEON_LIBS $SSL_LIBS $CURL_LIBS"
+HTTP_CFLAGS="$NEON_CFLAGS $CURL_CFLAGS $SSL_CFLAGS $EXTRA_HTTP_CFLAGS"
+HTTP_LIBS="$NEON_LIBS $CURL_LIBS $SSL_LIBS"
 AC_SUBST(HTTP_CFLAGS)
 AC_SUBST(HTTP_LIBS)
 PKG_CHECK_MODULES(GMIME, gmime-2.0 >= 2.0 )



From fabricecolin at mail.berlios.de  Mon Oct 22 13:43:43 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Mon, 22 Oct 2007 13:43:43 +0200
Subject: [Pinot-svn] r1061 - trunk/Search
Message-ID: <200710221143.l9MBhhgD028961@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-22 13:43:43 +0200 (Mon, 22 Oct 2007)
New Revision: 1061

Modified:
   trunk/Search/XapianEngine.cpp
Log:
Check at least twice the number of requested hits so that we have a reasonable
idea about whether a second hits page is needed.


Modified: trunk/Search/XapianEngine.cpp
===================================================================
--- trunk/Search/XapianEngine.cpp	2007-10-21 15:15:38 UTC (rev 1060)
+++ trunk/Search/XapianEngine.cpp	2007-10-22 11:43:43 UTC (rev 1061)
@@ -416,7 +416,7 @@
 		}
 
 		// Get the top results of the query
-		Xapian::MSet matches = enquire.get_mset(startDoc, maxResultsCount, maxResultsCount + 1);
+		Xapian::MSet matches = enquire.get_mset(startDoc, maxResultsCount, (2 * maxResultsCount) + 1);
 		if (matches.empty() == false)
 		{
 			m_resultsCountEstimate = matches.get_matches_estimated();



From fabricecolin at mail.berlios.de  Mon Oct 22 13:44:58 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Mon, 22 Oct 2007 13:44:58 +0200
Subject: [Pinot-svn] r1062 - trunk/Index
Message-ID: <200710221144.l9MBiwjM029034@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-22 13:44:57 +0200 (Mon, 22 Oct 2007)
New Revision: 1062

Modified:
   trunk/Index/DBusXapianIndex.cpp
Log:
Minor fix.


Modified: trunk/Index/DBusXapianIndex.cpp
===================================================================
--- trunk/Index/DBusXapianIndex.cpp	2007-10-22 11:43:43 UTC (rev 1061)
+++ trunk/Index/DBusXapianIndex.cpp	2007-10-22 11:44:57 UTC (rev 1062)
@@ -777,7 +777,7 @@
 			cerr << "DBusXapianIndex::setDocumentsLabels: " << pError->message << endl;
 			g_error_free(pError);
 		}
-		updatedLabels = false;
+		updatedLabels = FALSE;
 	}
 
 	// Free the arrays



From fabricecolin at mail.berlios.de  Mon Oct 22 13:50:20 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Mon, 22 Oct 2007 13:50:20 +0200
Subject: [Pinot-svn] r1063 - trunk/UI/GTK2/src
Message-ID: <200710221150.l9MBoKo4029418@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-22 13:50:20 +0200 (Mon, 22 Oct 2007)
New Revision: 1063

Modified:
   trunk/UI/GTK2/src/WorkerThreads.cpp
   trunk/UI/GTK2/src/WorkerThreads.h
Log:
Set the error number on exceptions.


Modified: trunk/UI/GTK2/src/WorkerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.cpp	2007-10-22 11:44:57 UTC (rev 1062)
+++ trunk/UI/GTK2/src/WorkerThreads.cpp	2007-10-22 11:50:20 UTC (rev 1063)
@@ -227,15 +227,18 @@
 	{
 		cerr << "Glib exception in thread " << m_id << ", type " << getType()
 			<< ":" << ex.what() << endl;
+		m_errorNum = UNKNOWN_ERROR;
 	}
 	catch (std::exception &ex)
 	{
 		cerr << "STL exception in thread " << m_id << ", type " << getType()
 			<< ":" << ex.what() << endl;
+		m_errorNum = UNKNOWN_ERROR;
 	}
 	catch (...)
 	{
 		cerr << "Unknown exception in thread " << m_id << ", type " << getType() << endl;
+		m_errorNum = UNKNOWN_ERROR;
 	}
 
 	emitSignal();

Modified: trunk/UI/GTK2/src/WorkerThreads.h
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.h	2007-10-22 11:44:57 UTC (rev 1062)
+++ trunk/UI/GTK2/src/WorkerThreads.h	2007-10-22 11:50:20 UTC (rev 1063)
@@ -45,7 +45,7 @@
 		WorkerThread();
 		virtual ~WorkerThread();
 
-		typedef enum { INDEX_ERROR = 10000, INDEXING_FAILED, UPDATE_FAILED, UNINDEXING_FAILED, \
+		typedef enum { UNKNOWN_ERROR = 10000, INDEX_ERROR, INDEXING_FAILED, UPDATE_FAILED, UNINDEXING_FAILED, \
 			QUERY_FAILED, HISTORY_FAILED, DOWNLOAD_FAILED, MONITORING_FAILED, OPENDIR_FAILED, \
 			UNKNOWN_INDEX, UNKNOWN_ENGINE, UNSUPPORTED_TYPE, UNSUPPORTED_PROTOCOL, \
 			ROBOTS_FORBIDDEN, NO_MONITORING } ThreadError;



From fabricecolin at mail.berlios.de  Mon Oct 22 13:51:31 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Mon, 22 Oct 2007 13:51:31 +0200
Subject: [Pinot-svn] r1064 - trunk/Tokenize
Message-ID: <200710221151.l9MBpV9K029563@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-22 13:51:31 +0200 (Mon, 22 Oct 2007)
New Revision: 1064

Modified:
   trunk/Tokenize/FilterUtils.cpp
Log:
Ignore size 0 from filters.


Modified: trunk/Tokenize/FilterUtils.cpp
===================================================================
--- trunk/Tokenize/FilterUtils.cpp	2007-10-22 11:50:20 UTC (rev 1063)
+++ trunk/Tokenize/FilterUtils.cpp	2007-10-22 11:51:31 UTC (rev 1064)
@@ -286,7 +286,15 @@
 		}
 		else if (metaIter->first == "size")
 		{
-			doc.setSize((off_t)atoi(metaIter->second.c_str()));
+			off_t size = (off_t)atoi(metaIter->second.c_str());
+
+			if (size > 0)
+			{
+				doc.setSize(size);
+			}
+#ifdef DEBUG
+			else cout << "FilterUtils::populateDocument: ignoring size zero" << endl;
+#endif
 		}
 		else if (metaIter->first == "title")
 		{



From fabricecolin at mail.berlios.de  Tue Oct 23 16:35:08 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 23 Oct 2007 16:35:08 +0200
Subject: [Pinot-svn] r1065 - trunk/Index
Message-ID: <200710231435.l9NEZ8mI014302@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-23 16:35:08 +0200 (Tue, 23 Oct 2007)
New Revision: 1065

Modified:
   trunk/Index/LanguageDetector.cpp
Log:
Cosmetic.


Modified: trunk/Index/LanguageDetector.cpp
===================================================================
--- trunk/Index/LanguageDetector.cpp	2007-10-22 11:51:31 UTC (rev 1064)
+++ trunk/Index/LanguageDetector.cpp	2007-10-23 14:35:08 UTC (rev 1065)
@@ -108,7 +108,7 @@
 	{
 		for (unsigned int i=0; i<resultNum; ++i)
 		{
-			string language = StringManip::toLowerCase(catResults[i]);
+			string language(StringManip::toLowerCase(catResults[i]));
 
 			// Remove the charset information
 			string::size_type dashPos = language.find('-');
@@ -139,7 +139,7 @@
 		}
 		else
 		{
-			string languageList = languages;
+			string languageList(languages);
 			string::size_type lastPos = 0, pos = languageList.find_first_of("[");
 
 			while (pos != string::npos)
@@ -151,7 +151,7 @@
 					break;
 				}
 
-				string language = StringManip::toLowerCase(languageList.substr(pos, lastPos - pos));
+				string language(StringManip::toLowerCase(languageList.substr(pos, lastPos - pos)));
 				// Remove the charset information
 				string::size_type dashPos = language.find('-');
 				if (dashPos != string::npos)



From fabricecolin at mail.berlios.de  Tue Oct 23 16:39:09 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 23 Oct 2007 16:39:09 +0200
Subject: [Pinot-svn] r1066 - in trunk: Index Search
Message-ID: <200710231439.l9NEd9xI014490@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-23 16:39:08 +0200 (Tue, 23 Oct 2007)
New Revision: 1066

Modified:
   trunk/Index/XapianDatabase.cpp
   trunk/Index/XapianIndex.cpp
   trunk/Search/XapianEngine.cpp
Log:
The language stored by XapianDatabase::propsToRecord() is in English, so make
sure both XapianIndex and XapianEngine convert to locale after calling
recordToProps().
Dropped code about pre-0.60 timestamps; those indexes will be upgraded.


Modified: trunk/Index/XapianDatabase.cpp
===================================================================
--- trunk/Index/XapianDatabase.cpp	2007-10-23 14:35:08 UTC (rev 1065)
+++ trunk/Index/XapianDatabase.cpp	2007-10-23 14:39:08 UTC (rev 1066)
@@ -539,7 +539,7 @@
 	record += tmpStr;
 	// ...and the language
 	record += "\nlanguage=";
-	record += StringManip::toLowerCase(pDoc->getLanguage());
+	record += pDoc->getLanguage();
 	// ...and the file size
 	record += "\nsize=";
 	snprintf(tmpStr, 64, "%ld", pDoc->getSize());
@@ -573,13 +573,12 @@
 	// ... the language, if available
 	pDoc->setLanguage(StringManip::extractField(record, "language=", "\n"));
 	// ... and the timestamp
-	string timestamp, modTime(StringManip::extractField(record, "modtime=", "\n"));
+	string modTime(StringManip::extractField(record, "modtime=", "\n"));
 	if (modTime.empty() == false)
 	{
 		time_t timeT = (time_t )atol(modTime.c_str());
-		timestamp = TimeConverter::toTimestamp(timeT);
+		pDoc->setTimestamp(TimeConverter::toTimestamp(timeT));
 	}
-	pDoc->setTimestamp(timestamp);
 	string bytesSize(StringManip::extractField(record, "size=", ""));
 	if (bytesSize.empty() == false)
 	{

Modified: trunk/Index/XapianIndex.cpp
===================================================================
--- trunk/Index/XapianIndex.cpp	2007-10-23 14:35:08 UTC (rev 1065)
+++ trunk/Index/XapianIndex.cpp	2007-10-23 14:39:08 UTC (rev 1066)
@@ -474,23 +474,17 @@
 	}
 
 	string language(StringManip::extractField(record, "language=", "\n"));
-	string timestamp(StringManip::extractField(record, "timestamp=", "\n"));
 
 	docInfo = DocumentInfo(StringManip::extractField(record, "caption=", "\n"),
 		StringManip::extractField(record, "url=", "\n"),
 		StringManip::extractField(record, "type=", "\n"),
 		Languages::toLocale(language));
-	// We used to use timestamp prior to 0.60
-	if (timestamp.empty() == true)
+	string modTime(StringManip::extractField(record, "modtime=", "\n"));
+	if (modTime.empty() == false)
 	{
-		string modTime(StringManip::extractField(record, "modtime=", "\n"));
-		if (modTime.empty() == false)
-		{
-			time_t timeT = (time_t )atol(modTime.c_str());
-			timestamp = TimeConverter::toTimestamp(timeT);
-		}
+		time_t timeT = (time_t )atol(modTime.c_str());
+		docInfo.setTimestamp(TimeConverter::toTimestamp(timeT));
 	}
-	docInfo.setTimestamp(timestamp);
 	string bytesSize(StringManip::extractField(record, "size=", ""));
 	if (bytesSize.empty() == false)
 	{
@@ -656,6 +650,7 @@
 	doc.add_value(4, yyyymmdd + hhmmss);
 
 	DocumentInfo docCopy(info);
+	// XapianDatabase expects the language in English, which is okay here
 	docCopy.setLanguage(language);
 	doc.set_data(XapianDatabase::propsToRecord(&docCopy));
 }
@@ -849,35 +844,14 @@
 		if (pIndex != NULL)
 		{
 			Xapian::Document doc = pIndex->get_document(docId);
+			string record(doc.get_data());
 
 			// Get the current document data
-			string record = doc.get_data();
 			if (record.empty() == false)
 			{
-				string language(Languages::toLocale(StringManip::extractField(record, "language=", "\n")));
-				// We used to use timestamp prior to 0.60
-				string timestamp(StringManip::extractField(record, "timestamp=", "\n"));
-
-				docInfo = DocumentInfo(StringManip::extractField(record, "caption=", "\n"),
-					StringManip::extractField(record, "url=", "\n"),
-					StringManip::extractField(record, "type=", "\n"),
-					language);
-				if (timestamp.empty() == true)
-				{
-					// This is the format used by Omega
-					string modTime(StringManip::extractField(record, "modtime=", "\n"));
-					if (modTime.empty() == false)
-					{
-						time_t timeT = (time_t )atol(modTime.c_str());
-						timestamp = TimeConverter::toTimestamp(timeT);
-					}
-				}
-				docInfo.setTimestamp(timestamp);
-				string bytesSize(StringManip::extractField(record, "size=", ""));
-				if (bytesSize.empty() == false)
-				{
-					docInfo.setSize((off_t )atol(bytesSize.c_str()));
-				}
+				XapianDatabase::recordToProps(record, &docInfo);
+				// XapianDatabase stored the language in English
+				docInfo.setLanguage(Languages::toLocale(docInfo.getLanguage()));
 				foundDocument = true;
 			}
 		}

Modified: trunk/Search/XapianEngine.cpp
===================================================================
--- trunk/Search/XapianEngine.cpp	2007-10-23 14:35:08 UTC (rev 1065)
+++ trunk/Search/XapianEngine.cpp	2007-10-23 14:39:08 UTC (rev 1066)
@@ -449,6 +449,8 @@
 				cout << "XapianEngine::queryDatabase: found document ID " << docId << endl;
 #endif
 				XapianDatabase::recordToProps(doc.get_data(), &thisResult);
+				// XapianDatabase stored the language in English
+				thisResult.setLanguage(Languages::toLocale(thisResult.getLanguage()));
 
 				string url(thisResult.getLocation());
 				if (url.empty() == true)



From fabricecolin at mail.berlios.de  Tue Oct 23 16:42:32 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 23 Oct 2007 16:42:32 +0200
Subject: [Pinot-svn] r1067 - trunk/Index
Message-ID: <200710231442.l9NEgWTs014633@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-23 16:42:32 +0200 (Tue, 23 Oct 2007)
New Revision: 1067

Modified:
   trunk/Index/pinot-index.cpp
   trunk/Index/pinot-label.cpp
Log:
Process all parameters instead of stopping after the first one...
Don't display internal labels.


Modified: trunk/Index/pinot-index.cpp
===================================================================
--- trunk/Index/pinot-index.cpp	2007-10-23 14:39:08 UTC (rev 1066)
+++ trunk/Index/pinot-index.cpp	2007-10-23 14:42:32 UTC (rev 1067)
@@ -51,7 +51,7 @@
 {
 	// Help
 	cout << "pinot-index - Index documents from the command-line\n\n"
-		<< "Usage: pinot-index [OPTIONS] URL\n\n"
+		<< "Usage: pinot-index [OPTIONS] URLS\n\n"
 		<< "Options:\n"
 		<< "  -c, --check               check whether the given URL is in the index\n"
 		<< "  -d, --db                  path to index to use (mandatory)\n"
@@ -143,7 +143,7 @@
 	}
 
 	if ((argc < 2) ||
-		(argc - optind != 1))
+		(argc - optind == 0))
 	{
 		cerr << "Not enough parameters" << endl;
 		return EXIT_FAILURE;
@@ -191,112 +191,116 @@
 		return EXIT_FAILURE;
 	}
 
-	string urlParam(argv[optind]);
+	while (optind < argc)
+	{
+		string urlParam(argv[optind]);
 
-	if (checkDocument == true)
-	{
-		if (pIndex->isGood() == true)
+		if (checkDocument == true)
 		{
-			docId = pIndex->hasDocument(urlParam);
-			if (docId > 0)
+			if (pIndex->isGood() == true)
 			{
-				cout << urlParam << ": document ID " << docId << endl;
-				success = true;
+				docId = pIndex->hasDocument(urlParam);
+				if (docId > 0)
+				{
+					cout << urlParam << ": document ID " << docId << endl;
+					success = true;
+				}
 			}
 		}
-	}
-	if (indexDocument == true)
-	{
-		Url thisUrl(urlParam);
-
-		// Which Downloader ?
-		DownloaderInterface *pDownloader = DownloaderFactory::getDownloader(thisUrl.getProtocol());
-		if (pDownloader == NULL)
+		if (indexDocument == true)
 		{
-			cerr << "Couldn't obtain downloader for protocol " << thisUrl.getProtocol() << endl;
+			Url thisUrl(urlParam);
 
-			delete pIndex;
-			XapianDatabaseFactory::closeAll();
-			Dijon::FilterFactory::unloadFilters();
-			Dijon::HtmlFilter::shutdown();
-			DownloaderInterface::shutdown();
-			MIMEScanner::shutdown();
+			// Which Downloader ?
+			DownloaderInterface *pDownloader = DownloaderFactory::getDownloader(thisUrl.getProtocol());
+			if (pDownloader == NULL)
+			{
+				cerr << "Couldn't obtain downloader for protocol " << thisUrl.getProtocol() << endl;
 
-			return EXIT_FAILURE;
-		}
+				success = false;
+				continue;
+			}
 
-		// Set up the proxy
-		if ((proxyAddress.empty() == false) &&
-			(proxyPort.empty() == false))
-		{
-			pDownloader->setSetting("proxyaddress", proxyAddress);
-			pDownloader->setSetting("proxyport", proxyPort);
-			pDownloader->setSetting("proxytype", proxyType);
-		}
+			// Set up the proxy
+			if ((proxyAddress.empty() == false) &&
+				(proxyPort.empty() == false))
+			{
+				pDownloader->setSetting("proxyaddress", proxyAddress);
+				pDownloader->setSetting("proxyport", proxyPort);
+				pDownloader->setSetting("proxytype", proxyType);
+			}
 
-		DocumentInfo docInfo("", urlParam, MIMEScanner::scanUrl(thisUrl), "");
-		Document *pDoc = pDownloader->retrieveUrl(docInfo);
-		if (pDoc == NULL)
-		{
-			cerr << "Download operation failed !" << endl;
-		}
-		else
-		{
-			FilterWrapper wrapFilter(pIndex);
-			set<string> labels;
-
-			// Update an existing document or add to the index ?
-			docId = pIndex->hasDocument(urlParam);
-			if (docId > 0)
+			DocumentInfo docInfo("", urlParam, MIMEScanner::scanUrl(thisUrl), "");
+			Document *pDoc = pDownloader->retrieveUrl(docInfo);
+			if (pDoc == NULL)
 			{
-				// Update the document
-				if (wrapFilter.updateDocument(*pDoc, docId) == true)
-				{
-					success = true;
-				}
+				cerr << "Couldn't download " << urlParam << endl;
 			}
 			else
 			{
-				// Index the document
-				success = wrapFilter.indexDocument(*pDoc, labels, docId);
-			}
+				FilterWrapper wrapFilter(pIndex);
+				set<string> labels;
 
-			if (success == true)
-			{
-				// Flush the index
-				pIndex->flush();
-			}
+				// Update an existing document or add to the index ?
+				docId = pIndex->hasDocument(urlParam);
+				if (docId > 0)
+				{
+					// Update the document
+					if (wrapFilter.updateDocument(*pDoc, docId) == true)
+					{
+						success = true;
+					}
+				}
+				else
+				{
+					// Index the document
+					success = wrapFilter.indexDocument(*pDoc, labels, docId);
+				}
 
-			delete pDoc;
-		}
+				if (success == true)
+				{
+					// Flush the index
+					pIndex->flush();
+				}
 
-		delete pDownloader;
-	}
-	if ((showInfo == true) &&
-		(docId > 0))
-	{
-		DocumentInfo docInfo;
-		set<string> labels;
+				delete pDoc;
+			}
 
-		if (pIndex->getDocumentInfo(docId, docInfo) == true)
-		{
-			cout << "Title: " << docInfo.getTitle() << endl;
-			cout << "Location: " << docInfo.getLocation() << endl;
-			cout << "Type: " << docInfo.getType() << endl;
-			cout << "Language: " << docInfo.getLanguage() << endl;
-			cout << "Timestamp: " << docInfo.getTimestamp() << endl;
-			cout << "Size: " << docInfo.getSize() << endl;
+			delete pDownloader;
 		}
-		if (pIndex->getDocumentLabels(docId, labels) == true)
+		if ((showInfo == true) &&
+			(docId > 0))
 		{
-			cout << "Labels: ";
-			for (set<string>::const_iterator labelIter = labels.begin();
-				labelIter != labels.end(); ++labelIter)
+			DocumentInfo docInfo;
+			set<string> labels;
+
+			if (pIndex->getDocumentInfo(docId, docInfo) == true)
 			{
-				cout << "[" << Url::escapeUrl(*labelIter) << "]";
+				cout << "Location : '" << docInfo.getLocation() << "'" << endl;
+				cout << "Title    : " << docInfo.getTitle() << endl;
+				cout << "Type     : " << docInfo.getType() << endl;
+				cout << "Language : " << docInfo.getLanguage() << endl;
+				cout << "Date     : " << docInfo.getTimestamp() << endl;
+				cout << "Size     : " << docInfo.getSize() << endl;
 			}
-			cout << endl;
+			if (pIndex->getDocumentLabels(docId, labels) == true)
+			{
+				cout << "Labels   : ";
+				for (set<string>::const_iterator labelIter = labels.begin();
+					labelIter != labels.end(); ++labelIter)
+				{
+					if (labelIter->substr(0, 2) == "X-")
+					{
+						continue;
+					}
+					cout << "[" << Url::escapeUrl(*labelIter) << "]";
+				}
+				cout << endl;
+			}
 		}
+
+		// Next
+		++optind;
 	}
 	delete pIndex;
 

Modified: trunk/Index/pinot-label.cpp
===================================================================
--- trunk/Index/pinot-label.cpp	2007-10-23 14:39:08 UTC (rev 1066)
+++ trunk/Index/pinot-label.cpp	2007-10-23 14:42:32 UTC (rev 1067)
@@ -50,12 +50,21 @@
 };
 
 
-static void printLabels(const set<string> &labels)
+static void printLabels(const set<string> &labels, const string &fileName)
 {
+	if (fileName.empty() == false)
+	{
+		cout << fileName << endl;
+	}
 	cout << "Labels: ";
+
 	for (set<string>::const_iterator labelIter = labels.begin();
 		labelIter != labels.end(); ++labelIter)
 	{
+		if (labelIter->substr(0, 2) == "X-")
+		{
+			continue;
+		}
 		cout << "[" << Url::escapeUrl(*labelIter) << "]";
 	}
 	cout << endl;
@@ -86,7 +95,7 @@
 {
 	// Help
 	cout << "pinot-label - Label files from the command-line\n\n"
-		<< "Usage: pinot-label [OPTIONS] [FILE]\n\n"
+		<< "Usage: pinot-label [OPTIONS] [FILES]\n\n"
 		<< "Options:\n"
 		<< "  -g, --get                 get the labels list for the given file\n"
 		<< "  -h, --help                display this help and exit\n"
@@ -152,6 +161,13 @@
 		return EXIT_SUCCESS;
 	}
 
+	if ((argc < 2) ||
+		(argc - optind == 0))
+	{
+		cerr << "Not enough parameters" << endl;
+		return EXIT_FAILURE;
+	}
+
 	if ((setDocumentLabels == true) &&
 		(labelsString.empty() == true))
 	{
@@ -176,68 +192,72 @@
 		return EXIT_FAILURE;
 	}
 
-	if ((getDocumentLabels == true) ||
-		(setDocumentLabels == true))
-	{
-		string fileParam(argv[optind]);
-
-		docId = index.hasDocument(string("file://") + fileParam);
-		if (docId == 0)
-		{
-			cerr << "File is not indexed" << endl;
-
-			XapianDatabaseFactory::closeAll();
-			MIMEScanner::shutdown();
-
-			return EXIT_FAILURE;
-		}
-	}
-
 	if (getLabels == true)
 	{
 		if (index.getLabels(labels, true) == true)
 		{
-			printLabels(labels);
+			printLabels(labels, "");
 
 			success = true;
 		}
 	}
 
-	if (getDocumentLabels == true)
+	while (optind < argc)
 	{
-		labels.clear();
+		string fileParam(argv[optind]);
 
-		if (index.getDocumentLabels(docId, labels, true) == true)
+		if ((getDocumentLabels == true) ||
+			(setDocumentLabels == true))
 		{
-			printLabels(labels);
+			docId = index.hasDocument(string("file://") + fileParam);
+			if (docId == 0)
+			{
+				cerr << fileParam << " is not indexed" << endl;
 
-			success = true;
+				success = false;
+				continue;
+			}
 		}
-	}
 
-	if (setDocumentLabels == true)
-	{
-		string::size_type endPos = 0;
-		string label(StringManip::extractField(labelsString, "[", "]", endPos));
+		if (getDocumentLabels == true)
+		{
+			labels.clear();
 
-		labels.clear();
+			if (index.getDocumentLabels(docId, labels, true) == true)
+			{
+				printLabels(labels, fileParam);
 
-		// Parse labels
-		while (label.empty() == false)
+				success = true;
+			}
+		}
+
+		if (setDocumentLabels == true)
 		{
-			labels.insert(Url::unescapeUrl(label));
+			string::size_type endPos = 0;
+			string label(StringManip::extractField(labelsString, "[", "]", endPos));
 
-			if (endPos == string::npos)
+			labels.clear();
+
+			// Parse labels
+			while (label.empty() == false)
 			{
-				break;
+				labels.insert(Url::unescapeUrl(label));
+
+				if (endPos == string::npos)
+				{
+					break;
+				}
+				label = StringManip::extractField(labelsString, "[", "]", endPos);
 			}
-			label = StringManip::extractField(labelsString, "[", "]", endPos);
-		}
 
 #ifdef DEBUG
-		printLabels(labels);
+			printLabels(labels, fileParam);
 #endif
-		success = index.setDocumentLabels(docId, labels);
+			success = index.setDocumentLabels(docId, labels);
+		}
+
+		// Next
+		++optind;
 	}
 
 	XapianDatabaseFactory::closeAll();



From fabricecolin at mail.berlios.de  Tue Oct 23 16:43:39 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 23 Oct 2007 16:43:39 +0200
Subject: [Pinot-svn] r1068 - trunk/Search
Message-ID: <200710231443.l9NEhdtU014709@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-23 16:43:39 +0200 (Tue, 23 Oct 2007)
New Revision: 1068

Modified:
   trunk/Search/pinot-search.cpp
Log:
Slightly better error message.


Modified: trunk/Search/pinot-search.cpp
===================================================================
--- trunk/Search/pinot-search.cpp	2007-10-23 14:42:32 UTC (rev 1067)
+++ trunk/Search/pinot-search.cpp	2007-10-23 14:43:39 UTC (rev 1068)
@@ -194,7 +194,7 @@
 	if ((argc < 4) ||
 		(argc - optind != 3))
 	{
-		cerr << "Not enough parameters" << endl;
+		cerr << "Wrong number of parameters" << endl;
 		return EXIT_FAILURE;
 	}
 



From fabricecolin at mail.berlios.de  Tue Oct 23 16:52:07 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 23 Oct 2007 16:52:07 +0200
Subject: [Pinot-svn] r1069 - trunk/UI/GTK2/src
Message-ID: <200710231452.l9NEq7YE015466@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-23 16:52:05 +0200 (Tue, 23 Oct 2007)
New Revision: 1069

Modified:
   trunk/UI/GTK2/src/WorkerThreads.cpp
   trunk/UI/GTK2/src/WorkerThreads.h
   trunk/UI/GTK2/src/mainWindow.cc
   trunk/UI/GTK2/src/propertiesDialog.cc
   trunk/UI/GTK2/src/propertiesDialog.hh
Log:
propertiesDialog should be able to tell when the user made modifications.
Modified LabelUpdateThread to set several labels on N documents at once. That's
used after labels are edited on several documents.


Modified: trunk/UI/GTK2/src/WorkerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.cpp	2007-10-23 14:43:39 UTC (rev 1068)
+++ trunk/UI/GTK2/src/WorkerThreads.cpp	2007-10-23 14:52:05 UTC (rev 1069)
@@ -1194,7 +1194,8 @@
 
 LabelUpdateThread::LabelUpdateThread(const set<string> &labelsToAdd,
 	const set<string> &labelsToDelete, const map<string, string> &labelsToRename) :
-	WorkerThread()
+	WorkerThread(),
+	m_resetLabels(false)
 {
 	copy(labelsToAdd.begin(), labelsToAdd.end(),
 		inserter(m_labelsToAdd, m_labelsToAdd.begin()));
@@ -1204,13 +1205,18 @@
 		inserter(m_labelsToRename, m_labelsToRename.begin()));
 }
 
-LabelUpdateThread::LabelUpdateThread(const string &labelName,
-	const set<unsigned int> &docsIds, const set<unsigned int> &daemonIds) :
+LabelUpdateThread::LabelUpdateThread(const set<string> &labelsToAdd,
+	const set<unsigned int> &docsIds, const set<unsigned int> &daemonIds,
+	bool resetLabels) :
 	WorkerThread(),
-	m_labelName(labelName)
+	m_resetLabels(resetLabels)
 {
-	copy(docsIds.begin(), docsIds.end(), inserter(m_docsIds, m_docsIds.begin()));
-	copy(daemonIds.begin(), daemonIds.end(), inserter(m_daemonIds, m_daemonIds.begin()));
+	copy(labelsToAdd.begin(), labelsToAdd.end(),
+		inserter(m_labelsToAdd, m_labelsToAdd.begin()));
+	copy(docsIds.begin(), docsIds.end(),
+		inserter(m_docsIds, m_docsIds.begin()));
+	copy(daemonIds.begin(), daemonIds.end(),
+		inserter(m_daemonIds, m_daemonIds.begin()));
 }
 
 LabelUpdateThread::~LabelUpdateThread()
@@ -1224,6 +1230,8 @@
 
 void LabelUpdateThread::doWork(void)
 {
+	bool actOnDocuments = false;
+
 	IndexInterface *pDocsIndex = PinotSettings::getInstance().getIndex(PinotSettings::getInstance().m_docsIndexLocation);
 	if (pDocsIndex == NULL)
 	{
@@ -1241,39 +1249,39 @@
 		return;
 	}
 
-	// Apply the new label to existing documents
-	if (m_labelName.empty() == false)
+	// Apply the labels to existing documents
+	if (m_docsIds.empty() == false)
 	{
-		set<string> labels;
+		pDocsIndex->setDocumentsLabels(m_docsIds, m_labelsToAdd, m_resetLabels);
+		actOnDocuments = true;
+	}
+	if (m_daemonIds.empty() == false)
+	{
+		pDaemonIndex->setDocumentsLabels(m_daemonIds, m_labelsToAdd, m_resetLabels);
+		actOnDocuments = true;
+	}
 
-		labels.insert(m_labelName);
-		if (m_docsIds.empty() == false)
+	if (actOnDocuments == false)
+	{
+		// Add labels
+		for (set<string>::iterator iter = m_labelsToAdd.begin(); iter != m_labelsToAdd.end(); ++iter)
 		{
-			pDocsIndex->setDocumentsLabels(m_docsIds, labels, false);
+			pDocsIndex->addLabel(*iter);
+			pDaemonIndex->addLabel(*iter);
 		}
-		if (m_daemonIds.empty() == false)
+		// Delete labels
+		for (set<string>::iterator iter = m_labelsToDelete.begin(); iter != m_labelsToDelete.end(); ++iter)
 		{
-			pDaemonIndex->setDocumentsLabels(m_daemonIds, labels, false);
+			pDocsIndex->deleteLabel(*iter);
+			pDaemonIndex->deleteLabel(*iter);
 		}
+		// Rename labels
+		for (map<string, string>::iterator iter = m_labelsToRename.begin(); iter != m_labelsToRename.end(); ++iter)
+		{
+			pDocsIndex->renameLabel(iter->first, iter->second);
+			pDaemonIndex->renameLabel(iter->first, iter->second);
+		}
 	}
-	// Add labels
-	for (set<string>::iterator iter = m_labelsToAdd.begin(); iter != m_labelsToAdd.end(); ++iter)
-	{
-		pDocsIndex->addLabel(*iter);
-		pDaemonIndex->addLabel(*iter);
-	}
-	// Delete labels
-	for (set<string>::iterator iter = m_labelsToDelete.begin(); iter != m_labelsToDelete.end(); ++iter)
-	{
-		pDocsIndex->deleteLabel(*iter);
-		pDaemonIndex->deleteLabel(*iter);
-	}
-	// Rename labels
-	for (map<string, string>::iterator iter = m_labelsToRename.begin(); iter != m_labelsToRename.end(); ++iter)
-	{
-		pDocsIndex->renameLabel(iter->first, iter->second);
-		pDaemonIndex->renameLabel(iter->first, iter->second);
-	}
 
 	delete pDaemonIndex;
 	delete pDocsIndex;

Modified: trunk/UI/GTK2/src/WorkerThreads.h
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.h	2007-10-23 14:43:39 UTC (rev 1068)
+++ trunk/UI/GTK2/src/WorkerThreads.h	2007-10-23 14:52:05 UTC (rev 1069)
@@ -324,9 +324,10 @@
 		LabelUpdateThread(const std::set<std::string> &labelsToAdd,
 			const std::set<std::string> &labelsToDelete,
 			const std::map<std::string, std::string> &labelsToRename);
-		LabelUpdateThread(const std::string &labelName,
+		LabelUpdateThread(const std::set<std::string> &labelsToAdd,
 			const std::set<unsigned int> &docsIds,
-			const std::set<unsigned int> &daemonIds);
+			const std::set<unsigned int> &daemonIds,
+			bool resetLabels);
 
 		virtual ~LabelUpdateThread();
 
@@ -336,9 +337,9 @@
 		std::set<std::string> m_labelsToAdd;
 		std::set<std::string> m_labelsToDelete;
 		std::map<std::string, std::string> m_labelsToRename;
-		std::string m_labelName;
 		std::set<unsigned int> m_docsIds;
 		std::set<unsigned int> m_daemonIds;
+		bool m_resetLabels;
 
 		virtual void doWork(void);
 

Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2007-10-23 14:43:39 UTC (rev 1068)
+++ trunk/UI/GTK2/src/mainWindow.cc	2007-10-23 14:52:05 UTC (rev 1069)
@@ -1370,8 +1370,11 @@
 				((docsIds.empty() == false) ||
 				(daemonIds.empty() == false)))
 			{
+				set<string> labels;
+
 				// Apply the new label to existing documents
-				start_thread(new LabelUpdateThread(labelName, docsIds, daemonIds));
+				labels.insert(labelName);
+				start_thread(new LabelUpdateThread(labels, docsIds, daemonIds, false));
 			}
 		}
 	}
@@ -1607,6 +1610,7 @@
 				char docIdStr[64];
 
 				status = _("Updated document");
+				status += " ";
 				snprintf(docIdStr, 64, "%u", pUpdateThread->getDocumentID());
 				status += docIdStr;
 				set_status(status);
@@ -2261,9 +2265,10 @@
 void mainWindow::on_showfromindex_activate()
 {
 	vector<DocumentInfo> documentsList;
+	set<unsigned int> docIds;
 	string indexName, queryName;
 	int width, height;
-	bool updateLabels = false;
+	bool docsIndex = false, daemonIndex = false;
 
 #ifdef DEBUG
 	cout << "mainWindow::on_showfromindex_activate: called" << endl;
@@ -2278,9 +2283,16 @@
 	}
 
 	// Allow this only for internal indexes
-	if ((indexName != _("My Web Pages")) &&
-		(indexName != _("My Documents")))
+	if (indexName == _("My Web Pages"))
 	{
+		docsIndex = true;
+	}
+	else if (indexName == _("My Documents"))
+	{
+		daemonIndex = true;
+	}
+	else
+	{
 		return;
 	}
 
@@ -2313,31 +2325,49 @@
 	propertiesBox.show();
 	// What labels will this show ?
 	const set<string> &labels = propertiesBox.getLabels();
-	bool hadNoLabels = labels.empty();
 	if (propertiesBox.run() != RESPONSE_OK)
 	{
 		return;
 	}
 
-	// Now apply these labels to all the documents
-	// FIXME: do that only if something was modified
-	if ((hadNoLabels == false) ||
-		(labels.empty() == false))
-	{
-		updateLabels = true;
-	}
-
 	// Update all documents
-	// FIXME: do that only if something was modified
 	for (vector<DocumentInfo>::iterator docIter = documentsList.begin();
 		docIter != documentsList.end(); ++docIter)
 	{
 		unsigned int indexId = 0;
 		unsigned int docId = docIter->getIsIndexed(indexId);
 
-		start_thread(new UpdateDocumentThread(indexName, docId, *docIter, updateLabels));
+		// ... only if something was modified
+		if (propertiesBox.changedInfo() == true)
+		{
+			start_thread(new UpdateDocumentThread(indexName, docId, *docIter, false));
+		}
+
+		docIds.insert(docId);
 	}
 
+	// Now apply these labels to all the documents
+	if (propertiesBox.changedLabels() == true)
+	{
+		LabelUpdateThread *pThread = NULL;
+		set<unsigned int> empty;
+
+		// Apply the labels en masse
+		if (docsIndex == true)
+		{
+			pThread = new LabelUpdateThread(labels, docIds, empty, true);
+		}
+		else if (daemonIndex == true)
+		{
+			pThread = new LabelUpdateThread(labels, empty, docIds, true);
+		}
+
+		if (pThread != NULL)
+		{
+			start_thread(pThread);
+		}
+	}
+
 	// Is the index list filtered with a query ?
 	if (queryName.empty() == false)
 	{

Modified: trunk/UI/GTK2/src/propertiesDialog.cc
===================================================================
--- trunk/UI/GTK2/src/propertiesDialog.cc	2007-10-23 14:43:39 UTC (rev 1068)
+++ trunk/UI/GTK2/src/propertiesDialog.cc	2007-10-23 14:52:05 UTC (rev 1069)
@@ -23,6 +23,7 @@
 
 #include "config.h"
 #include "Languages.h"
+#include "StringManip.h"
 #include "NLS.h"
 #include "XapianIndex.h"
 #include "PinotSettings.h"
@@ -40,10 +41,12 @@
 	m_documentsList(documentsList),
 	m_docId(0),
 	m_notALanguageName(false),
-	m_editDocument(false)
+	m_editDocument(false),
+	m_changedInfo(false),
+	m_changedLabels(false)
 {
 	set<string> docLabels;
-	string language;
+	string title, language;
 	char numStr[128];
 
 	// Associate the columns model to the labels tree
@@ -78,12 +81,13 @@
 
 				delete pIndex;
 			}
+			title = docInfo.getTitle();
 			language = docInfo.getLanguage();
 
 			snprintf(numStr, 128, "%u", m_docId);
 			set_title(get_title() + " (ID " + numStr + ")");
 
-			titleEntry->set_text(to_utf8(docInfo.getTitle()));
+			titleEntry->set_text(to_utf8(title));
 			typeEntry->set_text(to_utf8(docInfo.getType()));
 			unsigned int size = docInfo.getSize();
 			snprintf(numStr, 128, "%u", size);
@@ -144,6 +148,7 @@
 	}
 
 	populate_languageCombobox(language);
+	m_infoHash = StringManip::hashString(title + language);
 	populate_labelsTreeview(docLabels);
 }
 
@@ -153,14 +158,14 @@
 
 void propertiesDialog::populate_languageCombobox(const string &language)
 {
-	unsigned int languageStart = 0;
+	int unknownLanguagePos = 0;
 	bool foundLanguage = false;
 
 	if (m_notALanguageName == true)
 	{
 		languageCombobox->append_text(to_utf8(language));
 		languageCombobox->set_active(0);
-		languageStart = 1;
+		unknownLanguagePos = 1;
 	}
 
 	// Add all supported languages
@@ -169,10 +174,12 @@
 		string languageName(Languages::getIntlName(languageNum));
 
 		languageCombobox->append_text(to_utf8(languageName));
+		// Is this the language we are looking for ?
 		if ((m_notALanguageName == false) &&
-			(languageName == language))
+			(strncasecmp(languageName.c_str(), language.c_str(),
+			min(languageName.length(), language.length())) == 0))
 		{
-			languageCombobox->set_active(languageNum + languageStart);
+			languageCombobox->set_active(languageNum + unknownLanguagePos);
 			foundLanguage = true;
 		}
 	}
@@ -181,8 +188,8 @@
 	if ((m_notALanguageName == false) &&
 		(foundLanguage == false))
 	{
-		// Select the first language in the list
-		languageCombobox->set_active(languageStart);
+		// The first language in the list should be unknown
+		languageCombobox->set_active(unknownLanguagePos);
 	}
 }
 
@@ -190,6 +197,7 @@
 {
 	TreeModel::iterator iter;
 	TreeModel::Row row;
+	string labelsString;
 
 	// Populate the tree
 	set<string> &sysLabels = PinotSettings::getInstance().m_labels;
@@ -208,6 +216,7 @@
 		{
 			// Yup
 			row[m_labelsColumns.m_enabled] = true;
+			labelsString += labelName;
 			m_labels.insert(labelName);
 		}
 		else
@@ -219,6 +228,9 @@
 	cout << "propertiesDialog::populate_labelsTreeview: showing " << docLabels.size()
 		<< "/" << sysLabels.size() << " labels" << endl;
 #endif
+
+	// This will help determining if changes were made
+	m_labelsHash = StringManip::hashString(labelsString);
 }
 
 void propertiesDialog::setHeight(int maxHeight)
@@ -245,9 +257,19 @@
 	return m_labels;
 }
 
+bool propertiesDialog::changedInfo(void) const
+{
+	return m_changedInfo;
+}
+
+bool propertiesDialog::changedLabels(void) const
+{
+	return m_changedLabels;
+}
+
 void propertiesDialog::on_labelOkButton_clicked()
 {
-	string languageName(from_utf8(languageCombobox->get_active_text()));
+	string title, languageName(from_utf8(languageCombobox->get_active_text())), labelsString;
 	int unknownLanguagePos = 0;
 
 	// If only one document was edited, set its title
@@ -255,15 +277,20 @@
 	{
 		vector<DocumentInfo>::iterator docIter = m_documentsList.begin();
 
-		docIter->setTitle(from_utf8(titleEntry->get_text()));
+		title = from_utf8(titleEntry->get_text());
+		docIter->setTitle(title);
+		// FIXME: find out if changes were actually made 
 	}
+#ifdef DEBUG
+	cout << "propertiesDialog::on_labelOkButton_clicked: chosen title " << title << endl;
+#endif
 
 	// Did we add an extra string to the languages list ?
+	int chosenLanguagePos = languageCombobox->get_active_row_number();
 	if (m_notALanguageName == true)
 	{
 		unknownLanguagePos = 1;
 	}
-	int chosenLanguagePos = languageCombobox->get_active_row_number();
 	if (chosenLanguagePos == unknownLanguagePos)
 	{
 		languageName.clear();
@@ -271,6 +298,14 @@
 #ifdef DEBUG
 	cout << "propertiesDialog::on_labelOkButton_clicked: chosen language " << languageName << endl;
 #endif
+	string newInfoHash(StringManip::hashString(title + languageName));
+	if (newInfoHash != m_infoHash)
+	{
+#ifdef DEBUG
+		cout << "propertiesDialog::on_labelOkButton_clicked: properties changed" << endl;
+#endif
+		m_changedInfo = true;
+	}
 
 	// Go through the labels tree
 	m_labels.clear();
@@ -285,6 +320,7 @@
 			if (enabled == true)
 			{
 				ustring labelName = row[m_labelsColumns.m_name];
+				labelsString += labelName;
 				m_labels.insert(from_utf8(labelName));
 			}
 		}
@@ -292,6 +328,14 @@
 #ifdef DEBUG
 	cout << "propertiesDialog::on_labelOkButton_clicked: chosen " << m_labels.size() << " labels" << endl;
 #endif
+	string newLabelsHash(StringManip::hashString(labelsString));
+	if (newLabelsHash != m_labelsHash)
+	{
+#ifdef DEBUG
+		cout << "propertiesDialog::on_labelOkButton_clicked: labels changed" << endl;
+#endif
+		m_changedLabels = true;
+	}
 
 	for (vector<DocumentInfo>::iterator docIter = m_documentsList.begin();
 		docIter != m_documentsList.end(); ++docIter)

Modified: trunk/UI/GTK2/src/propertiesDialog.hh
===================================================================
--- trunk/UI/GTK2/src/propertiesDialog.hh	2007-10-23 14:43:39 UTC (rev 1068)
+++ trunk/UI/GTK2/src/propertiesDialog.hh	2007-10-23 14:52:05 UTC (rev 1069)
@@ -40,6 +40,10 @@
 
 	const std::set<std::string> &getLabels(void) const;
 
+	bool changedInfo(void) const;
+
+	bool changedLabels(void) const;
+
 protected:
 	LabelModelColumns m_labelsColumns;
 	Glib::RefPtr<Gtk::ListStore> m_refLabelsTree;
@@ -49,6 +53,10 @@
 	unsigned int m_docId;
 	bool m_notALanguageName;
 	bool m_editDocument;
+	std::string m_infoHash;
+	std::string m_labelsHash;
+	bool m_changedInfo;
+	bool m_changedLabels;
 
 	void populate_languageCombobox(const std::string &language);
 



From fabricecolin at mail.berlios.de  Tue Oct 23 16:58:24 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 23 Oct 2007 16:58:24 +0200
Subject: [Pinot-svn] r1070 - in trunk: Index Search
Message-ID: <200710231458.l9NEwOls015843@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-23 16:58:24 +0200 (Tue, 23 Oct 2007)
New Revision: 1070

Modified:
   trunk/Index/pinot-index.cpp
   trunk/Search/pinot-search.cpp
Log:
Following the fix on language in XapianDatabase's records, we need to provide
names for all languages.


Modified: trunk/Index/pinot-index.cpp
===================================================================
--- trunk/Index/pinot-index.cpp	2007-10-23 14:52:05 UTC (rev 1069)
+++ trunk/Index/pinot-index.cpp	2007-10-23 14:58:24 UTC (rev 1070)
@@ -23,6 +23,7 @@
 #include <string>
 #include <fstream>
 
+#include "Languages.h"
 #include "MIMEScanner.h"
 #include "Url.h"
 #include "FilterFactory.h"
@@ -159,6 +160,23 @@
 
 	MIMEScanner::initialize("", "");
 	DownloaderInterface::initialize();
+	// Localize language names
+	Languages::setIntlName(0, "Unknown");
+	Languages::setIntlName(1, "Danish");
+	Languages::setIntlName(2, "Dutch");
+	Languages::setIntlName(3, "English");
+	Languages::setIntlName(4, "Finnish");
+	Languages::setIntlName(5, "French");
+	Languages::setIntlName(6, "German");
+	Languages::setIntlName(7, "Hungarian");
+	Languages::setIntlName(8, "Italian");
+	Languages::setIntlName(9, "Norwegian");
+	Languages::setIntlName(10, "Portuguese");
+	Languages::setIntlName(11, "Romanian");
+	Languages::setIntlName(12, "Russian");
+	Languages::setIntlName(13, "Spanish");
+	Languages::setIntlName(14, "Swedish");
+	Languages::setIntlName(15, "Turkish");
 	Dijon::HtmlFilter::initialize();
 	Dijon::FilterFactory::loadFilters(string(LIBDIR) + string("/pinot/filters"));
 

Modified: trunk/Search/pinot-search.cpp
===================================================================
--- trunk/Search/pinot-search.cpp	2007-10-23 14:52:05 UTC (rev 1069)
+++ trunk/Search/pinot-search.cpp	2007-10-23 14:58:24 UTC (rev 1070)
@@ -23,6 +23,7 @@
 #include <fstream>
 #include <string>
 
+#include "Languages.h"
 #include "MIMEScanner.h"
 #include "Url.h"
 #include "XapianDatabaseFactory.h"
@@ -200,6 +201,23 @@
 
 	MIMEScanner::initialize("", "");
 	DownloaderInterface::initialize();
+	// Localize language names
+	Languages::setIntlName(0, "Unknown");
+	Languages::setIntlName(1, "Danish");
+	Languages::setIntlName(2, "Dutch");
+	Languages::setIntlName(3, "English");
+	Languages::setIntlName(4, "Finnish");
+	Languages::setIntlName(5, "French");
+	Languages::setIntlName(6, "German");
+	Languages::setIntlName(7, "Hungarian");
+	Languages::setIntlName(8, "Italian");
+	Languages::setIntlName(9, "Norwegian");
+	Languages::setIntlName(10, "Portuguese");
+	Languages::setIntlName(11, "Romanian");
+	Languages::setIntlName(12, "Russian");
+	Languages::setIntlName(13, "Spanish");
+	Languages::setIntlName(14, "Swedish");
+	Languages::setIntlName(15, "Turkish");
 
 	engineType = argv[optind];
 	option = argv[optind + 1];



From fabricecolin at mail.berlios.de  Wed Oct 24 15:53:17 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Wed, 24 Oct 2007 15:53:17 +0200
Subject: [Pinot-svn] r1071 - trunk/UI/GTK2/src
Message-ID: <200710241353.l9ODrHZh010164@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-24 15:53:17 +0200 (Wed, 24 Oct 2007)
New Revision: 1071

Modified:
   trunk/UI/GTK2/src/mainWindow.cc
   trunk/UI/GTK2/src/propertiesDialog.cc
Log:
Don't refresh the index list if labels were not changed in any way.
Don't bother looking for the document's language if it's unknown !


Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2007-10-23 14:58:24 UTC (rev 1070)
+++ trunk/UI/GTK2/src/mainWindow.cc	2007-10-24 13:53:17 UTC (rev 1071)
@@ -2366,13 +2366,13 @@
 		{
 			start_thread(pThread);
 		}
-	}
 
-	// Is the index list filtered with a query ?
-	if (queryName.empty() == false)
-	{
-		// The query may filter on a label, so refresh the list
-		browse_index(indexName, queryName, 0, 0);
+		// Is the index list filtered with a query ?
+		if (queryName.empty() == false)
+		{
+			// The query may filter on a label, so refresh the list
+			browse_index(indexName, queryName, 0, 0);
+		}
 	}
 }
 

Modified: trunk/UI/GTK2/src/propertiesDialog.cc
===================================================================
--- trunk/UI/GTK2/src/propertiesDialog.cc	2007-10-23 14:58:24 UTC (rev 1070)
+++ trunk/UI/GTK2/src/propertiesDialog.cc	2007-10-24 13:53:17 UTC (rev 1071)
@@ -176,6 +176,7 @@
 		languageCombobox->append_text(to_utf8(languageName));
 		// Is this the language we are looking for ?
 		if ((m_notALanguageName == false) &&
+			(language.empty() == false) &&
 			(strncasecmp(languageName.c_str(), language.c_str(),
 			min(languageName.length(), language.length())) == 0))
 		{



From fabricecolin at mail.berlios.de  Wed Oct 24 16:05:41 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Wed, 24 Oct 2007 16:05:41 +0200
Subject: [Pinot-svn] r1072 - trunk/UI/GTK2/src
Message-ID: <200710241405.l9OE5fIm011806@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-24 16:05:41 +0200 (Wed, 24 Oct 2007)
New Revision: 1072

Modified:
   trunk/UI/GTK2/src/mainWindow.cc
Log:
In get_results_page_details(), set the query's name so that we can tell the user
what we failed to find. One case where this applies is More Like This on a
in-results search.


Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2007-10-24 13:53:17 UTC (rev 1071)
+++ trunk/UI/GTK2/src/mainWindow.cc	2007-10-24 14:05:41 UTC (rev 1072)
@@ -609,6 +609,7 @@
 
 		if (foundQuery == false)
 		{
+			queryProps.setName(currentQueryName);
 			return false;
 		}
 	}



From fabricecolin at mail.berlios.de  Fri Oct 26 17:18:13 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Fri, 26 Oct 2007 17:18:13 +0200
Subject: [Pinot-svn] r1073 - trunk/UI/GTK2/src
Message-ID: <200710261518.l9QFIDMb025479@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-26 17:18:13 +0200 (Fri, 26 Oct 2007)
New Revision: 1073

Modified:
   trunk/UI/GTK2/src/prefsDialog.cc
   trunk/UI/GTK2/src/prefsDialog.hh
   trunk/UI/GTK2/src/propertiesDialog.cc
Log:
Better at telling when properties or daemon preferences have changed.


Modified: trunk/UI/GTK2/src/prefsDialog.cc
===================================================================
--- trunk/UI/GTK2/src/prefsDialog.cc	2007-10-24 14:05:41 UTC (rev 1072)
+++ trunk/UI/GTK2/src/prefsDialog.cc	2007-10-26 15:18:13 UTC (rev 1073)
@@ -25,9 +25,10 @@
 #include <gtkmm/menu.h>
 #include <gtkmm/messagedialog.h>
 
-#include "SearchEngineFactory.h"
 #include "config.h"
 #include "NLS.h"
+#include "StringManip.h"
+#include "SearchEngineFactory.h"
 #include "PinotUtils.h"
 #include "prefsDialog.hh"
 
@@ -100,14 +101,6 @@
 	// Allow only single selection
 	patternsTreeview->get_selection()->set_mode(SELECTION_SINGLE);
 	populate_patternsTreeview();
-	if (m_settings.m_isBlackList == true)
-	{
-		patternsCombobox->set_active(0);
-	}
-	else
-	{
-		patternsCombobox->set_active(1);
-	}
 
 	// Hide the Google API entry field ?
 	if (SearchEngineFactory::isSupported("googleapi") == false)
@@ -258,6 +251,7 @@
 {
 	TreeModel::iterator iter;
 	TreeModel::Row row;
+	ustring dirsString;
 
 	if (m_settings.m_indexableLocations.empty() == true)
 	{
@@ -276,14 +270,16 @@
 		row = *iter;
 		row[m_directoriesColumns.m_monitor] = dirIter->m_monitor;
 		row[m_directoriesColumns.m_location] = dirIter->m_name;
+		dirsString += dirIter->m_name + (dirIter->m_monitor == true ? "1" : "0") + "|";
 	}
 
+	m_directoriesHash = StringManip::hashString(dirsString);
 	removeDirectoryButton->set_sensitive(true);
 }
 
 bool prefsDialog::save_directoriesTreeview()
 {
-	bool startService = false;
+	string dirsString;
 
 	// Clear the current settings
 	m_settings.m_indexableLocations.clear();
@@ -316,17 +312,26 @@
 			cout << "prefsDialog::save_directoriesTreeview: " << indexableLocation.m_name << endl;
 #endif
 			m_settings.m_indexableLocations.insert(indexableLocation);
-			startService = true;
+			dirsString += indexableLocation.m_name + (indexableLocation.m_monitor == true ? "1" : "0") + "|";
 		}
 	}
 
-	return startService;
+	if (m_directoriesHash != StringManip::hashString(dirsString))
+	{
+#ifdef DEBUG
+		cout << "prefsDialog::save_directoriesTreeview: directories changed" << endl;
+#endif
+		return true;
+	}
+
+	return false;
 }
 
 void prefsDialog::populate_patternsTreeview()
 {
 	TreeModel::iterator iter;
 	TreeModel::Row row;
+	ustring patternsString;
 
 	if (m_settings.m_filePatternsList.empty() == true)
 	{
@@ -340,20 +345,39 @@
 		patternIter != m_settings.m_filePatternsList.end();
 		++patternIter)
 	{
+		ustring pattern(*patternIter);
+
 		// Create a new row
 		iter = m_refPatternsTree->append();
 		row = *iter;
 		// Set its name
-		row[m_patternsColumns.m_location] = *patternIter;
+		row[m_patternsColumns.m_location] = pattern;
+		patternsString += pattern + "|";
 	}
 	patternsCombobox->append_text(_("Exclude these patterns from indexing"));
 	patternsCombobox->append_text(_("Only index these patterns"));
 
 	removePatternButton->set_sensitive(true);
+
+	// Is it a black or white list ?
+	if (m_settings.m_isBlackList == true)
+	{
+		patternsCombobox->set_active(0);
+		patternsString += "0";
+	}
+	else
+	{
+		patternsCombobox->set_active(1);
+		patternsString += "1";
+	}
+
+	m_patternsHash = StringManip::hashString(patternsString);
 }
 
-void prefsDialog::save_patternsTreeview()
+bool prefsDialog::save_patternsTreeview()
 {
+	ustring patternsString;
+
 	// Clear the current settings
 	m_settings.m_filePatternsList.clear();
 
@@ -370,17 +394,30 @@
 			if (pattern.empty() == false)
 			{
 				m_settings.m_filePatternsList.insert(pattern);
+				patternsString += pattern + "|";
 			}
 		}
 	}
 	if (patternsCombobox->get_active_row_number() == 0)
 	{
 		m_settings.m_isBlackList = true;
+		patternsString += "0";
 	}
 	else
 	{
 		m_settings.m_isBlackList = false;
+		patternsString += "1";
 	}
+
+	if (m_patternsHash != StringManip::hashString(patternsString))
+	{
+#ifdef DEBUG
+		cout << "prefsDialog::save_patternsTreeview: patterns changed" << endl;
+#endif
+		return true;
+	}
+
+	return false;
 }
 
 void prefsDialog::on_prefsOkbutton_clicked()
@@ -414,8 +451,9 @@
 	// Validate the current lists
 	save_labelsTreeview();
 	bool startForDirectories = save_directoriesTreeview();
-	save_patternsTreeview();
-	if (startForDirectories == true)
+	bool startForPatterns = save_patternsTreeview();
+	if ((startForDirectories == true) ||
+		(startForPatterns == true))
 	{
 		// Save the settings
 		m_settings.save();

Modified: trunk/UI/GTK2/src/prefsDialog.hh
===================================================================
--- trunk/UI/GTK2/src/prefsDialog.hh	2007-10-24 14:05:41 UTC (rev 1072)
+++ trunk/UI/GTK2/src/prefsDialog.hh	2007-10-26 15:18:13 UTC (rev 1073)
@@ -45,6 +45,23 @@
 	bool startDaemon(void) const;
 
 protected:
+	PinotSettings &m_settings;
+	Glib::RefPtr<Gtk::ListStore> m_refViewTree;
+	LabelModelColumns m_labelsColumns;
+	Glib::RefPtr<Gtk::ListStore> m_refLabelsTree;
+	IndexableModelColumns m_directoriesColumns;
+	Glib::RefPtr<Gtk::ListStore> m_refDirectoriesTree;
+	TimestampedModelColumns m_mailColumns;
+	TimestampedModelColumns m_patternsColumns;
+	Glib::RefPtr<Gtk::ListStore> m_refPatternsTree;
+	std::set<std::string> m_addedLabels;
+	std::set<std::string> m_deletedLabels;
+	std::map<std::string, std::string> m_renamedLabels;
+	std::set<std::string> m_deletedDirectories;
+	std::string m_directoriesHash;
+	std::string m_patternsHash;
+	bool m_startDaemon;
+
 	virtual void on_prefsOkbutton_clicked();
 	virtual void on_directConnectionRadiobutton_toggled();
 	virtual void on_addLabelButton_clicked();
@@ -61,23 +78,8 @@
 	void populate_directoriesTreeview();
 	bool save_directoriesTreeview();
 	void populate_patternsTreeview();
-	void save_patternsTreeview();
+	bool save_patternsTreeview();
 
-private:
-	PinotSettings &m_settings;
-	Glib::RefPtr<Gtk::ListStore> m_refViewTree;
-	LabelModelColumns m_labelsColumns;
-	Glib::RefPtr<Gtk::ListStore> m_refLabelsTree;
-	IndexableModelColumns m_directoriesColumns;
-	Glib::RefPtr<Gtk::ListStore> m_refDirectoriesTree;
-	TimestampedModelColumns m_mailColumns;
-	TimestampedModelColumns m_patternsColumns;
-	Glib::RefPtr<Gtk::ListStore> m_refPatternsTree;
-	std::set<std::string> m_addedLabels;
-	std::set<std::string> m_deletedLabels;
-	std::map<std::string, std::string> m_renamedLabels;
-	std::set<std::string> m_deletedDirectories;
-	bool m_startDaemon;
+};
 
-};
 #endif

Modified: trunk/UI/GTK2/src/propertiesDialog.cc
===================================================================
--- trunk/UI/GTK2/src/propertiesDialog.cc	2007-10-24 14:05:41 UTC (rev 1072)
+++ trunk/UI/GTK2/src/propertiesDialog.cc	2007-10-26 15:18:13 UTC (rev 1073)
@@ -217,7 +217,7 @@
 		{
 			// Yup
 			row[m_labelsColumns.m_enabled] = true;
-			labelsString += labelName;
+			labelsString += labelName + "|";
 			m_labels.insert(labelName);
 		}
 		else
@@ -299,8 +299,7 @@
 #ifdef DEBUG
 	cout << "propertiesDialog::on_labelOkButton_clicked: chosen language " << languageName << endl;
 #endif
-	string newInfoHash(StringManip::hashString(title + languageName));
-	if (newInfoHash != m_infoHash)
+	if (m_infoHash != StringManip::hashString(title + languageName))
 	{
 #ifdef DEBUG
 		cout << "propertiesDialog::on_labelOkButton_clicked: properties changed" << endl;
@@ -321,7 +320,7 @@
 			if (enabled == true)
 			{
 				ustring labelName = row[m_labelsColumns.m_name];
-				labelsString += labelName;
+				labelsString += labelName + "|";
 				m_labels.insert(from_utf8(labelName));
 			}
 		}
@@ -329,8 +328,7 @@
 #ifdef DEBUG
 	cout << "propertiesDialog::on_labelOkButton_clicked: chosen " << m_labels.size() << " labels" << endl;
 #endif
-	string newLabelsHash(StringManip::hashString(labelsString));
-	if (newLabelsHash != m_labelsHash)
+	if (m_labelsHash != StringManip::hashString(labelsString))
 	{
 #ifdef DEBUG
 		cout << "propertiesDialog::on_labelOkButton_clicked: labels changed" << endl;



From fabricecolin at mail.berlios.de  Sat Oct 27 04:37:24 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 27 Oct 2007 04:37:24 +0200
Subject: [Pinot-svn] r1074 - trunk/Index
Message-ID: <200710270237.l9R2bOxb009738@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-27 04:37:24 +0200 (Sat, 27 Oct 2007)
New Revision: 1074

Modified:
   trunk/Index/pinot-label.cpp
Log:
Option --list doesn't need any parameter.


Modified: trunk/Index/pinot-label.cpp
===================================================================
--- trunk/Index/pinot-label.cpp	2007-10-26 15:18:13 UTC (rev 1073)
+++ trunk/Index/pinot-label.cpp	2007-10-27 02:37:24 UTC (rev 1074)
@@ -115,6 +115,7 @@
 	string labelsString;
 	int longOptionIndex = 0;
 	unsigned int docId = 0;
+	int minArgNum = 1;
 	bool getLabels = false, getDocumentLabels = false, setDocumentLabels = false, success = false;
 
 	// Look at the options
@@ -132,6 +133,7 @@
 				printHelp();
 				return EXIT_SUCCESS;
 			case 'l':
+				minArgNum = 0;
 				getLabels = true;
 				break;
 			case 's':
@@ -162,7 +164,7 @@
 	}
 
 	if ((argc < 2) ||
-		(argc - optind == 0))
+		(argc - optind < minArgNum))
 	{
 		cerr << "Not enough parameters" << endl;
 		return EXIT_FAILURE;



From fabricecolin at mail.berlios.de  Sat Oct 27 05:45:26 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 27 Oct 2007 05:45:26 +0200
Subject: [Pinot-svn] r1075 - trunk/Search
Message-ID: <200710270345.l9R3jQ9S012142@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-27 05:45:26 +0200 (Sat, 27 Oct 2007)
New Revision: 1075

Modified:
   trunk/Search/XapianEngine.cpp
Log:
In DEBUG mode, get a description of the Query object, that's pretty useful.


Modified: trunk/Search/XapianEngine.cpp
===================================================================
--- trunk/Search/XapianEngine.cpp	2007-10-27 02:37:24 UTC (rev 1074)
+++ trunk/Search/XapianEngine.cpp	2007-10-27 03:45:26 UTC (rev 1075)
@@ -396,6 +396,9 @@
 		vector<string> seedTerms;
 
 		// Give the query object to the enquire session
+#ifdef DEBUG
+		cout << "XapianEngine::queryDatabase: enquiring about " << query.get_description() << endl;
+#endif
 		enquire.set_query(query);
 		// How should results be sorted ?
 		if (queryProps.getSortOrder() == QueryProperties::RELEVANCE)



From fabricecolin at mail.berlios.de  Sat Oct 27 05:47:12 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 27 Oct 2007 05:47:12 +0200
Subject: [Pinot-svn] r1076 - trunk/Utils
Message-ID: <200710270347.l9R3lCRO012258@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-27 05:47:11 +0200 (Sat, 27 Oct 2007)
New Revision: 1076

Modified:
   trunk/Utils/Url.cpp
Log:
Escape '+'. That doesn't do any harm and prevents Xapian's spelling correction
from mistaking '+' in url filters for a boolean operator.


Modified: trunk/Utils/Url.cpp
===================================================================
--- trunk/Utils/Url.cpp	2007-10-27 03:45:26 UTC (rev 1075)
+++ trunk/Utils/Url.cpp	2007-10-27 03:47:11 UTC (rev 1076)
@@ -24,7 +24,7 @@
 static const int g_rfc2396Encoded[] = {
 	1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,  /* 0x00 - 0x0f */
 	1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,  /* 0x10 - 0x1f */
-	1, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,  /*  ' ' - '/'  */
+	1, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0,  /*  ' ' - '/'  */
 	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0,  /*  '0' - '?'  */
 	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,  /*  '@' - 'O'  */
 	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0,  /*  'P' - '_'  */



From fabricecolin at mail.berlios.de  Sat Oct 27 14:58:17 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 27 Oct 2007 14:58:17 +0200
Subject: [Pinot-svn] r1077 - trunk/po
Message-ID: <200710271258.l9RCwHsO005031@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-27 14:57:33 +0200 (Sat, 27 Oct 2007)
New Revision: 1077

Modified:
   trunk/po/de.po
   trunk/po/es.po
   trunk/po/fr.po
   trunk/po/it.po
   trunk/po/nl.po
   trunk/po/pt.po
   trunk/po/pt_BR.po
   trunk/po/ru.po
   trunk/po/sv.po
   trunk/po/zh_TW.po
Log:
Current translations, including updates from JW (nl) and Leonardo Melo (pt_BR).


Modified: trunk/po/de.po
===================================================================
--- trunk/po/de.po	2007-10-27 03:47:11 UTC (rev 1076)
+++ trunk/po/de.po	2007-10-27 12:57:33 UTC (rev 1077)
@@ -6,7 +6,7 @@
 msgstr ""
 "Project-Id-Version: pinot 0.75\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2007-09-23 19:22+0800\n"
+"POT-Creation-Date: 2007-10-27 00:15+0800\n"
 "PO-Revision-Date: 2007-09-10 12:48+0000\n"
 "Last-Translator: Christian Dywan <christian at twotoasts.de>\n"
 "Language-Team: German <de at li.org>\n"
@@ -27,22 +27,22 @@
 #. Enable these menu items unless it is not the documents index
 #. Allow this only for internal indexes
 #. Internal indices
-#: UI/GTK2/src/EnginesTree.cpp:337 UI/GTK2/src/mainWindow.cc:677
-#: UI/GTK2/src/mainWindow.cc:1187 UI/GTK2/src/mainWindow.cc:1339
-#: UI/GTK2/src/mainWindow.cc:1381 UI/GTK2/src/mainWindow.cc:1403
-#: UI/GTK2/src/mainWindow.cc:1434 UI/GTK2/src/mainWindow.cc:2045
-#: UI/GTK2/src/mainWindow.cc:2157 UI/GTK2/src/PinotSettings.cpp:311
-#: UI/GTK2/src/PinotSettings.cpp:1387 UI/GTK2/src/PinotSettings.cpp:1443
-#: UI/GTK2/src/statisticsDialog.cc:77 UI/GTK2/src/WorkerThreads.cpp:822
-#: UI/GTK2/src/WorkerThreads.cpp:881
+#: UI/GTK2/src/EnginesTree.cpp:337 UI/GTK2/src/mainWindow.cc:795
+#: UI/GTK2/src/mainWindow.cc:1017 UI/GTK2/src/mainWindow.cc:1354
+#: UI/GTK2/src/mainWindow.cc:1509 UI/GTK2/src/mainWindow.cc:1551
+#: UI/GTK2/src/mainWindow.cc:1573 UI/GTK2/src/mainWindow.cc:2177
+#: UI/GTK2/src/mainWindow.cc:2287 UI/GTK2/src/PinotSettings.cpp:311
+#: UI/GTK2/src/PinotSettings.cpp:1421 UI/GTK2/src/PinotSettings.cpp:1477
+#: UI/GTK2/src/statisticsDialog.cc:78 UI/GTK2/src/WorkerThreads.cpp:972
 msgid "My Web Pages"
 msgstr "Meine Webseiten"
 
-#: UI/GTK2/src/EnginesTree.cpp:338 UI/GTK2/src/mainWindow.cc:680
-#: UI/GTK2/src/mainWindow.cc:1194 UI/GTK2/src/mainWindow.cc:2158
-#: UI/GTK2/src/PinotSettings.cpp:312 UI/GTK2/src/PinotSettings.cpp:1388
-#: UI/GTK2/src/PinotSettings.cpp:1444 UI/GTK2/src/statisticsDialog.cc:82
-#: UI/GTK2/src/WorkerThreads.cpp:827 UI/GTK2/src/WorkerThreads.cpp:891
+#. Spawn new threads
+#: UI/GTK2/src/EnginesTree.cpp:338 UI/GTK2/src/mainWindow.cc:798
+#: UI/GTK2/src/mainWindow.cc:1011 UI/GTK2/src/mainWindow.cc:1361
+#: UI/GTK2/src/mainWindow.cc:2291 UI/GTK2/src/PinotSettings.cpp:312
+#: UI/GTK2/src/PinotSettings.cpp:1422 UI/GTK2/src/PinotSettings.cpp:1478
+#: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:982
 msgid "My Documents"
 msgstr "Meine Dokumente"
 
@@ -86,12 +86,13 @@
 msgid "External index"
 msgstr "Externer Index"
 
-#: UI/GTK2/src/importDialog.cc:87 UI/GTK2/src/queryDialog.cc:95
+#. Labels
+#: UI/GTK2/src/importDialog.cc:87 UI/GTK2/src/queryDialog.cc:123
 msgid "None"
 msgstr "Keine"
 
 #: UI/GTK2/src/importDialog_glade.cc:68
-#: UI/GTK2/src/propertiesDialog_glade.cc:67
+#: UI/GTK2/src/propertiesDialog_glade.cc:64
 msgid "Title:"
 msgstr "Titel"
 
@@ -103,7 +104,7 @@
 msgid "Import"
 msgstr "Importieren"
 
-#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:221
+#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:216
 msgid "Import URL"
 msgstr "URL importieren"
 
@@ -136,401 +137,434 @@
 msgid "Helper application"
 msgstr "Hilfsprogramm"
 
-#: UI/GTK2/src/mainWindow.cc:211
+#: UI/GTK2/src/mainWindow.cc:212
 msgid "Query Name"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:216
+#: UI/GTK2/src/mainWindow.cc:217
 msgid "Last Run"
 msgstr "Zuletzt ausgef?hrt"
 
-#: UI/GTK2/src/mainWindow.cc:221
+#: UI/GTK2/src/mainWindow.cc:222
 msgid "Summary"
 msgstr "?bersicht"
 
 #. Set tooltips
-#: UI/GTK2/src/mainWindow.cc:255
+#: UI/GTK2/src/mainWindow.cc:252
 msgid "Show all search engines"
 msgstr "Alle Suchmaschinen anzeigen"
 
-#: UI/GTK2/src/mainWindow.cc:256
-msgid "Add index"
+#: UI/GTK2/src/mainWindow.cc:253
+msgid "Find documents that match the query string"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:254
+#, fuzzy
+msgid "Add an index"
 msgstr "Index hinzuf?gen"
 
+#: UI/GTK2/src/mainWindow.cc:255
+#, fuzzy
+msgid "Remove an index"
+msgstr "Index entfernen"
+
+#: UI/GTK2/src/mainWindow.cc:256
+msgid "Add a query"
+msgstr ""
+
 #: UI/GTK2/src/mainWindow.cc:257
-msgid "Remove index"
+#, fuzzy
+msgid "Remove a query"
 msgstr "Index entfernen"
 
+#: UI/GTK2/src/mainWindow.cc:258
+msgid "Show the query's previous results"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:259
+msgid "Find documents that match the query"
+msgstr ""
+
 #. Now we are ready
-#: UI/GTK2/src/mainWindow.cc:282
+#: UI/GTK2/src/mainWindow.cc:289
 msgid "Ready"
 msgstr "Bereit"
 
-#: UI/GTK2/src/mainWindow.cc:342
+#: UI/GTK2/src/mainWindow.cc:349
 msgid "N/A"
 msgstr "N/V"
 
-#: UI/GTK2/src/mainWindow.cc:357
+#: UI/GTK2/src/mainWindow.cc:364
 msgid "Undefined"
 msgstr "Unbestimmt"
 
+#. Find this query
+#: UI/GTK2/src/mainWindow.cc:587 UI/GTK2/src/mainWindow.cc:2675
+msgid "Live query"
+msgstr ""
+
 #. Show the URL of the first result in the status bar
-#: UI/GTK2/src/mainWindow.cc:611
+#: UI/GTK2/src/mainWindow.cc:727
 msgid "Result location is"
 msgstr ""
 
 #. Show the URL in the status bar
-#: UI/GTK2/src/mainWindow.cc:691
+#: UI/GTK2/src/mainWindow.cc:809
 msgid "Document location is"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:1024
+#: UI/GTK2/src/mainWindow.cc:993 UI/GTK2/src/mainWindow.cc:2109
+msgid "Couldn't find query"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:1008
 #, fuzzy
+msgid "In Results"
+msgstr "Ergebnisse"
+
+#: UI/GTK2/src/mainWindow.cc:1191
+#, fuzzy
 msgid "Showing"
 msgstr "Zeigen"
 
-#: UI/GTK2/src/mainWindow.cc:1029
+#: UI/GTK2/src/mainWindow.cc:1196
 msgid "of"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:1034
+#: UI/GTK2/src/mainWindow.cc:1201
 msgid "documents, starting at"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:1068
+#: UI/GTK2/src/mainWindow.cc:1235
 msgid "Query"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:1072 UI/GTK2/src/mainWindow.cc:3177
+#: UI/GTK2/src/mainWindow.cc:1239 UI/GTK2/src/mainWindow.cc:3268
 msgid "on"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:1076
+#: UI/GTK2/src/mainWindow.cc:1243
 msgid "ended"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:1137
+#: UI/GTK2/src/mainWindow.cc:1304
 msgid "Corrected"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:1223
+#: UI/GTK2/src/mainWindow.cc:1393
 msgid "More Like"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:1265
+#: UI/GTK2/src/mainWindow.cc:1435
 msgid "Updated label(s)"
 msgstr ""
 
 #. Yes, it did
-#: UI/GTK2/src/mainWindow.cc:1349
+#: UI/GTK2/src/mainWindow.cc:1519 UI/GTK2/src/mainWindow.cc:1613
 msgid "Updated document"
 msgstr "Dokument aktualisiert"
 
-#: UI/GTK2/src/mainWindow.cc:1362
+#: UI/GTK2/src/mainWindow.cc:1532
 msgid "Indexed"
 msgstr "Indiziert"
 
-#: UI/GTK2/src/mainWindow.cc:1404
+#: UI/GTK2/src/mainWindow.cc:1574
 msgid "Unindexed document(s)"
 msgstr "Nicht indizierte(s) Dokument(e)"
 
-#: UI/GTK2/src/mainWindow.cc:1444
-msgid "Updated document properties"
-msgstr "Aktualisierte Dokumenteneigenschaften"
-
-#: UI/GTK2/src/mainWindow.cc:1497
+#: UI/GTK2/src/mainWindow.cc:1671
 msgid "Couldn't rename index, name"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:1501 UI/GTK2/src/mainWindow.cc:2441
-#: UI/GTK2/src/mainWindow.cc:2982
+#: UI/GTK2/src/mainWindow.cc:1675 UI/GTK2/src/mainWindow.cc:2501
+#: UI/GTK2/src/mainWindow.cc:3072
 #, fuzzy
 msgid "is already in use"
 msgstr "wird bereits benutzt"
 
-#: UI/GTK2/src/mainWindow.cc:1514
+#: UI/GTK2/src/mainWindow.cc:1688
 msgid "Couldn't rename index"
 msgstr "Index konnte nicht umbenannt werden"
 
-#: UI/GTK2/src/mainWindow.cc:1527
+#: UI/GTK2/src/mainWindow.cc:1701
 msgid "Edited index"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:1853
+#: UI/GTK2/src/mainWindow.cc:2029
 #, fuzzy
 msgid "Export Results"
 msgstr "Ergebnisse exportieren"
 
-#. Find this query
-#: UI/GTK2/src/mainWindow.cc:1942 UI/GTK2/src/mainWindow.cc:2615
-msgid "Live query"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:1968
-msgid "Couldn't find query"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:2167 UI/GTK2/src/WorkerThreads.cpp:678
-#: UI/GTK2/src/WorkerThreads.cpp:1720
+#: UI/GTK2/src/mainWindow.cc:2304
 msgid "Index"
 msgstr "Index"
 
-#: UI/GTK2/src/mainWindow.cc:2171 UI/GTK2/src/WorkerThreads.cpp:682
-#: UI/GTK2/src/WorkerThreads.cpp:1724
+#: UI/GTK2/src/mainWindow.cc:2308
 msgid "doesn't exist"
 msgstr "existiert nicht"
 
-#: UI/GTK2/src/mainWindow.cc:2326
+#: UI/GTK2/src/mainWindow.cc:2386
 msgid "Remove this document from the index ?"
 msgstr "Soll dieses Dokument aus dem Index entfernt werden?"
 
-#: UI/GTK2/src/mainWindow.cc:2345
+#: UI/GTK2/src/mainWindow.cc:2405
 msgid "Remove these documents from the index ?"
 msgstr "Sollen diese Dokumente aus dem Index entfernt werden?"
 
-#: UI/GTK2/src/mainWindow.cc:2391
+#: UI/GTK2/src/mainWindow.cc:2451
 msgid "A metasearch tool for the Free Desktop"
 msgstr "Ein Werkzeug zur Metasuche f?r den kostenfreien Desktop"
 
-#: UI/GTK2/src/mainWindow.cc:2392
+#: UI/GTK2/src/mainWindow.cc:2452
 msgid "Search the Web and your documents !"
 msgstr "Durchsuchen Sie das Internet und Ihre Dokumente !"
 
-#: UI/GTK2/src/mainWindow.cc:2437
+#: UI/GTK2/src/mainWindow.cc:2497
 msgid "Index name"
 msgstr "Indexbezeichnung"
 
-#: UI/GTK2/src/mainWindow.cc:2452
+#: UI/GTK2/src/mainWindow.cc:2512
 msgid "Couldn't add index"
 msgstr "Konnte Index nicht hinzuf?gen"
 
-#: UI/GTK2/src/mainWindow.cc:2468
+#: UI/GTK2/src/mainWindow.cc:2528
 msgid "Added new index"
 msgstr "Neuer Index hinzugef?gt"
 
-#: UI/GTK2/src/mainWindow.cc:2503
+#: UI/GTK2/src/mainWindow.cc:2563
 msgid "Couldn't remove index"
 msgstr "Konnte Index nicht entfernen"
 
-#: UI/GTK2/src/mainWindow.cc:2795
+#: UI/GTK2/src/mainWindow.cc:2768
+msgid "No history for"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:2884
 msgid "At least one task hasn't completed yet. Quit now ?"
 msgstr ""
 "Mindestens ein Vorgang wurde noch nicht abgeschlossen. Jetzt trotzdem "
 "beenden?"
 
-#: UI/GTK2/src/mainWindow.cc:2978
+#: UI/GTK2/src/mainWindow.cc:3068
 msgid "Query name"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:3005
+#: UI/GTK2/src/mainWindow.cc:3095
 msgid "Couldn't update query"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:3013
+#: UI/GTK2/src/mainWindow.cc:3103
 msgid "Edited query"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:3020
+#: UI/GTK2/src/mainWindow.cc:3110
 msgid "Couldn't add query"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:3028
+#: UI/GTK2/src/mainWindow.cc:3118
 msgid "Added new query"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:3066
+#: UI/GTK2/src/mainWindow.cc:3157
 msgid "Query is not set"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:3077
+#: UI/GTK2/src/mainWindow.cc:3168
 msgid "No search engine selected"
 msgstr "Keine Suchmaschine ausgew?hlt"
 
-#: UI/GTK2/src/mainWindow.cc:3164
+#: UI/GTK2/src/mainWindow.cc:3255
 msgid "Please set the Google API key first"
 msgstr "Bitte geben Sie zuerst den Google API-Schl?ssel ein"
 
-#: UI/GTK2/src/mainWindow.cc:3173
+#: UI/GTK2/src/mainWindow.cc:3264
 msgid "Running query"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:3382
+#: UI/GTK2/src/mainWindow.cc:3473
 msgid "No default application defined for type"
 msgstr "Keine Standardanwendung f?r Typ angegeben"
 
-#: UI/GTK2/src/mainWindow_glade.cc:126
+#: UI/GTK2/src/mainWindow_glade.cc:127
 msgid "Query:"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow_glade.cc:138
-msgid "Edit"
-msgstr "Bearbeiten"
+#: UI/GTK2/src/mainWindow_glade.cc:138 UI/GTK2/src/statisticsDialog.cc:88
+#, fuzzy
+msgid "History"
+msgstr "Historie"
 
-#: UI/GTK2/src/mainWindow_glade.cc:147
+#: UI/GTK2/src/mainWindow_glade.cc:143
 msgid "Stored queries"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow_glade.cc:164 UI/GTK2/src/statisticsDialog.cc:50
+#: UI/GTK2/src/mainWindow_glade.cc:156 UI/GTK2/src/statisticsDialog.cc:51
 #: UI/GTK2/src/statisticsDialog_glade.cc:87
 msgid "Status"
 msgstr "Status"
 
-#: UI/GTK2/src/mainWindow_glade.cc:185
+#: UI/GTK2/src/mainWindow_glade.cc:177
 msgid "Search Engine"
 msgstr "Suchmaschine"
 
-#: UI/GTK2/src/mainWindow_glade.cc:188
+#: UI/GTK2/src/mainWindow_glade.cc:180
 msgid "Host Name"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow_glade.cc:191
+#: UI/GTK2/src/mainWindow_glade.cc:183
 msgid "Show Extract"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow_glade.cc:194
+#: UI/GTK2/src/mainWindow_glade.cc:186
 msgid "Group By"
 msgstr "Gruppieren nach"
 
-#: UI/GTK2/src/mainWindow_glade.cc:200
+#: UI/GTK2/src/mainWindow_glade.cc:192
 msgid "Clear List"
 msgstr "Liste l?schen"
 
-#: UI/GTK2/src/mainWindow_glade.cc:206
+#: UI/GTK2/src/mainWindow_glade.cc:198
 msgid "Vie_w"
 msgstr "_Anzeigen"
 
-#: UI/GTK2/src/mainWindow_glade.cc:209
+#: UI/GTK2/src/mainWindow_glade.cc:201
 msgid "View Cache"
 msgstr "Zwischenspeicher ansehen"
 
-#: UI/GTK2/src/mainWindow_glade.cc:212
+#: UI/GTK2/src/mainWindow_glade.cc:204
 msgid "More Like This"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow_glade.cc:215 UI/GTK2/src/mainWindow_glade.cc:251
+#: UI/GTK2/src/mainWindow_glade.cc:207
+#, fuzzy
+msgid "Search This For"
+msgstr "Suchmaschinen"
+
+#: UI/GTK2/src/mainWindow_glade.cc:210 UI/GTK2/src/mainWindow_glade.cc:246
 msgid "_Index"
 msgstr "_Index"
 
-#: UI/GTK2/src/mainWindow_glade.cc:218
+#: UI/GTK2/src/mainWindow_glade.cc:213
 msgid "List Contents Of"
 msgstr "Liste Inhalte von"
 
-#: UI/GTK2/src/mainWindow_glade.cc:227
+#: UI/GTK2/src/mainWindow_glade.cc:222
 msgid "View"
 msgstr "Ansicht"
 
-#: UI/GTK2/src/mainWindow_glade.cc:230
+#: UI/GTK2/src/mainWindow_glade.cc:225
 msgid "Update"
 msgstr "Aktualisieren"
 
-#: UI/GTK2/src/mainWindow_glade.cc:233
+#: UI/GTK2/src/mainWindow_glade.cc:228
 msgid "Unindex"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow_glade.cc:236
-#: UI/GTK2/src/propertiesDialog_glade.cc:177
+#: UI/GTK2/src/mainWindow_glade.cc:231
+#: UI/GTK2/src/propertiesDialog_glade.cc:225
 msgid "Properties"
 msgstr "Eigenschaften"
 
-#: UI/GTK2/src/mainWindow_glade.cc:239
+#: UI/GTK2/src/mainWindow_glade.cc:234
 msgid "_About"
 msgstr "_?ber"
 
-#: UI/GTK2/src/mainWindow_glade.cc:242
+#: UI/GTK2/src/mainWindow_glade.cc:237
 msgid "_Session"
 msgstr "_Sitzung"
 
-#: UI/GTK2/src/mainWindow_glade.cc:245
+#: UI/GTK2/src/mainWindow_glade.cc:240
 msgid "_Edit"
 msgstr "_Bearbeiten"
 
-#: UI/GTK2/src/mainWindow_glade.cc:248
+#: UI/GTK2/src/mainWindow_glade.cc:243
 msgid "_Results"
 msgstr "_Ergebnisse"
 
-#: UI/GTK2/src/mainWindow_glade.cc:254
+#: UI/GTK2/src/mainWindow_glade.cc:249
 msgid "_Help"
 msgstr "_Hilfe"
 
-#: UI/GTK2/src/mainWindow_glade.cc:403
+#: UI/GTK2/src/mainWindow_glade.cc:378
 msgid "Pinot"
 msgstr ""
 
 #. Localize language names
-#: UI/GTK2/src/pinot.cc:249 UI/GTK2/src/pinot-dbus-daemon.cc:324
-#: UI/GTK2/src/propertiesDialog.cc:72 UI/GTK2/src/propertiesDialog.cc:81
+#: UI/GTK2/src/pinot.cc:233 UI/GTK2/src/pinot-dbus-daemon.cc:312
+#: UI/GTK2/src/propertiesDialog.cc:97
 msgid "Unknown"
 msgstr "Unbekannt"
 
-#: UI/GTK2/src/pinot.cc:250 UI/GTK2/src/pinot-dbus-daemon.cc:325
+#: UI/GTK2/src/pinot.cc:234 UI/GTK2/src/pinot-dbus-daemon.cc:313
 msgid "Danish"
 msgstr "D?nisch"
 
-#: UI/GTK2/src/pinot.cc:251 UI/GTK2/src/pinot-dbus-daemon.cc:326
+#: UI/GTK2/src/pinot.cc:235 UI/GTK2/src/pinot-dbus-daemon.cc:314
 msgid "Dutch"
 msgstr "Niederl?nisch"
 
-#: UI/GTK2/src/pinot.cc:252 UI/GTK2/src/pinot-dbus-daemon.cc:327
+#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:315
 msgid "English"
 msgstr "Englisch"
 
-#: UI/GTK2/src/pinot.cc:253 UI/GTK2/src/pinot-dbus-daemon.cc:328
+#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:316
 msgid "Finnish"
 msgstr "Finnisch"
 
-#: UI/GTK2/src/pinot.cc:254 UI/GTK2/src/pinot-dbus-daemon.cc:329
+#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:317
 msgid "French"
 msgstr "Franz?sisch"
 
-#: UI/GTK2/src/pinot.cc:255 UI/GTK2/src/pinot-dbus-daemon.cc:330
+#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:318
 msgid "German"
 msgstr "Deutsch"
 
-#: UI/GTK2/src/pinot.cc:256 UI/GTK2/src/pinot-dbus-daemon.cc:331
+#: UI/GTK2/src/pinot.cc:240 UI/GTK2/src/pinot-dbus-daemon.cc:319
 msgid "Hungarian"
 msgstr "Ungarisch"
 
-#: UI/GTK2/src/pinot.cc:257 UI/GTK2/src/pinot-dbus-daemon.cc:332
+#: UI/GTK2/src/pinot.cc:241 UI/GTK2/src/pinot-dbus-daemon.cc:320
 msgid "Italian"
 msgstr "Italienisch"
 
-#: UI/GTK2/src/pinot.cc:258 UI/GTK2/src/pinot-dbus-daemon.cc:333
+#: UI/GTK2/src/pinot.cc:242 UI/GTK2/src/pinot-dbus-daemon.cc:321
 msgid "Norwegian"
 msgstr "Norwegisch"
 
-#: UI/GTK2/src/pinot.cc:259 UI/GTK2/src/pinot-dbus-daemon.cc:334
+#: UI/GTK2/src/pinot.cc:243 UI/GTK2/src/pinot-dbus-daemon.cc:322
 msgid "Portuguese"
 msgstr "Portugiesisch"
 
-#: UI/GTK2/src/pinot.cc:260 UI/GTK2/src/pinot-dbus-daemon.cc:335
+#: UI/GTK2/src/pinot.cc:244 UI/GTK2/src/pinot-dbus-daemon.cc:323
 msgid "Romanian"
 msgstr "Rum?nisch"
 
-#: UI/GTK2/src/pinot.cc:261 UI/GTK2/src/pinot-dbus-daemon.cc:336
+#: UI/GTK2/src/pinot.cc:245 UI/GTK2/src/pinot-dbus-daemon.cc:324
 msgid "Russian"
 msgstr "Russisch"
 
-#: UI/GTK2/src/pinot.cc:262 UI/GTK2/src/pinot-dbus-daemon.cc:337
+#: UI/GTK2/src/pinot.cc:246 UI/GTK2/src/pinot-dbus-daemon.cc:325
 msgid "Spanish"
 msgstr "Spanisch"
 
-#: UI/GTK2/src/pinot.cc:263 UI/GTK2/src/pinot-dbus-daemon.cc:338
+#: UI/GTK2/src/pinot.cc:247 UI/GTK2/src/pinot-dbus-daemon.cc:326
 msgid "Swedish"
 msgstr "Schwedisch"
 
-#: UI/GTK2/src/pinot.cc:264 UI/GTK2/src/pinot-dbus-daemon.cc:339
+#: UI/GTK2/src/pinot.cc:248 UI/GTK2/src/pinot-dbus-daemon.cc:327
 msgid "Turkish"
 msgstr "T?rkisch"
 
-#: UI/GTK2/src/pinot.cc:289
+#: UI/GTK2/src/pinot.cc:273
 msgid "Couldn't open index"
 msgstr "Konnte Index nicht ?ffnen"
 
-#: UI/GTK2/src/pinot.cc:310
+#: UI/GTK2/src/pinot.cc:294
 msgid "Couldn't create history database"
 msgstr "Konnte Verlaufsdatenbank nicht anlegen"
 
-#: UI/GTK2/src/pinot.cc:336
+#. Warn the user
+#: UI/GTK2/src/pinot.cc:330
 msgid "Updating all documents in My Web Pages is recommended"
 msgstr ""
 
@@ -547,39 +581,43 @@
 msgid "Personal"
 msgstr "Pers?nlich"
 
-#: UI/GTK2/src/PinotSettings.cpp:1198
+#: UI/GTK2/src/PinotSettings.cpp:358
+msgid "Me"
+msgstr ""
+
+#: UI/GTK2/src/PinotSettings.cpp:1233
 msgid "Unclassified"
 msgstr ""
 
-#: UI/GTK2/src/prefsDialog.cc:81
+#: UI/GTK2/src/prefsDialog.cc:83
 msgid "Name"
 msgstr "Name"
 
-#: UI/GTK2/src/prefsDialog.cc:89
+#: UI/GTK2/src/prefsDialog.cc:91
 msgid "Monitor"
 msgstr "?berwachen"
 
-#: UI/GTK2/src/prefsDialog.cc:90
+#: UI/GTK2/src/prefsDialog.cc:92
 msgid "Location"
 msgstr "Ort"
 
-#: UI/GTK2/src/prefsDialog.cc:98
+#: UI/GTK2/src/prefsDialog.cc:100
 msgid "Pattern"
 msgstr ""
 
-#: UI/GTK2/src/prefsDialog.cc:315
+#: UI/GTK2/src/prefsDialog.cc:357
 msgid "Exclude these patterns from indexing"
 msgstr ""
 
-#: UI/GTK2/src/prefsDialog.cc:316
+#: UI/GTK2/src/prefsDialog.cc:358
 msgid "Only index these patterns"
 msgstr ""
 
-#: UI/GTK2/src/prefsDialog.cc:406
+#: UI/GTK2/src/prefsDialog.cc:478
 msgid "New Label"
 msgstr ""
 
-#: UI/GTK2/src/prefsDialog.cc:447
+#: UI/GTK2/src/prefsDialog.cc:519
 msgid "Directory to index"
 msgstr "Zu indizierendes Verzeichnis"
 
@@ -636,7 +674,7 @@
 msgid "Remove"
 msgstr "Entfernen"
 
-#: UI/GTK2/src/prefsDialog_glade.cc:113
+#: UI/GTK2/src/prefsDialog_glade.cc:113 UI/GTK2/src/propertiesDialog.cc:56
 msgid "Labels"
 msgstr ""
 
@@ -658,79 +696,98 @@
 msgid "Preferences"
 msgstr "Einstellungen"
 
-#: UI/GTK2/src/propertiesDialog.cc:60 UI/GTK2/src/queryDialog.cc:124
-msgid "Label"
-msgstr ""
-
-#: UI/GTK2/src/propertiesDialog.cc:93
+#: UI/GTK2/src/propertiesDialog.cc:110
 msgid "Per document"
 msgstr "Pro Dokument"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:68
+#: UI/GTK2/src/propertiesDialog.cc:368
+#, fuzzy
+msgid "Export Terms"
+msgstr "Ergebnisse exportieren"
+
+#: UI/GTK2/src/propertiesDialog_glade.cc:65
 msgid "Language:"
 msgstr "Sprache:"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:69
+#: UI/GTK2/src/propertiesDialog_glade.cc:66
 msgid "MIME type:"
 msgstr "MIME-Typ:"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:70
+#: UI/GTK2/src/propertiesDialog_glade.cc:67
 msgid "Size:"
 msgstr "Gr??e"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:73
+#: UI/GTK2/src/propertiesDialog_glade.cc:68
 msgid "Terms:"
 msgstr ""
 
-#: UI/GTK2/src/queryDialog.cc:114
+#: UI/GTK2/src/propertiesDialog_glade.cc:78
+msgid "bytes"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog.cc:94
 msgid "Host name"
 msgstr "Rechnername"
 
-#: UI/GTK2/src/queryDialog.cc:115
+#: UI/GTK2/src/queryDialog.cc:95
 msgid "File name"
 msgstr "Dateiname"
 
-#: UI/GTK2/src/queryDialog.cc:118
+#: UI/GTK2/src/queryDialog.cc:96
 msgid "File extension"
 msgstr "Dateiendung"
 
 #. This is the title column
-#: UI/GTK2/src/queryDialog.cc:119 UI/GTK2/src/ResultsTree.cpp:133
+#: UI/GTK2/src/queryDialog.cc:97 UI/GTK2/src/ResultsTree.cpp:133
 msgid "Title"
 msgstr ""
 
 #. URL
-#: UI/GTK2/src/queryDialog.cc:120 UI/GTK2/src/ResultsTree.cpp:143
+#: UI/GTK2/src/queryDialog.cc:98 UI/GTK2/src/ResultsTree.cpp:143
 msgid "URL"
 msgstr "URL"
 
-#: UI/GTK2/src/queryDialog.cc:121
+#: UI/GTK2/src/queryDialog.cc:99
 msgid "Directory"
 msgstr "Verzeichnis"
 
-#: UI/GTK2/src/queryDialog.cc:122
+#: UI/GTK2/src/queryDialog.cc:100
 msgid "Language code"
 msgstr ""
 
-#: UI/GTK2/src/queryDialog.cc:123
+#: UI/GTK2/src/queryDialog.cc:101
 msgid "MIME type"
 msgstr ""
 
+#: UI/GTK2/src/queryDialog.cc:102
+msgid "Label"
+msgstr ""
+
 #. The last column is for the timestamp
-#: UI/GTK2/src/queryDialog.cc:127 UI/GTK2/src/ResultsTree.cpp:151
+#: UI/GTK2/src/queryDialog.cc:105 UI/GTK2/src/ResultsTree.cpp:151
 msgid "Date"
 msgstr "Datum"
 
-#: UI/GTK2/src/queryDialog.cc:128
+#: UI/GTK2/src/queryDialog.cc:106
 #, fuzzy
 msgid "Time"
 msgstr "Titel"
 
-#: UI/GTK2/src/queryDialog.cc:129
+#: UI/GTK2/src/queryDialog.cc:107
 #, fuzzy
 msgid "Size"
 msgstr "Gr??e"
 
+#. Sort order
+#: UI/GTK2/src/queryDialog.cc:111
+msgid "By relevance"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog.cc:112
+#, fuzzy
+msgid "By date"
+msgstr "Aktualisieren"
+
 #: UI/GTK2/src/queryDialog_glade.cc:72
 msgid "New filter or range:"
 msgstr ""
@@ -747,7 +804,11 @@
 msgid "Number of results:"
 msgstr "Anzahl der Ergebnisse:"
 
-#: UI/GTK2/src/queryDialog_glade.cc:181
+#: UI/GTK2/src/queryDialog_glade.cc:90
+msgid "Sort order:"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog_glade.cc:192
 msgid "Query parameters"
 msgstr ""
 
@@ -761,127 +822,132 @@
 msgid "Extract"
 msgstr "Auslesen"
 
-#: UI/GTK2/src/statisticsDialog.cc:72
+#: UI/GTK2/src/statisticsDialog.cc:73
 #, fuzzy
 msgid "Indexes"
 msgstr "Indizes"
 
-#: UI/GTK2/src/statisticsDialog.cc:87
-#, fuzzy
-msgid "History"
-msgstr "Historie"
-
-#: UI/GTK2/src/statisticsDialog.cc:92
+#: UI/GTK2/src/statisticsDialog.cc:93
 msgid "Daemon"
 msgstr "D?mon"
 
-#: UI/GTK2/src/statisticsDialog.cc:128 UI/GTK2/src/statisticsDialog.cc:143
+#: UI/GTK2/src/statisticsDialog.cc:128 UI/GTK2/src/statisticsDialog.cc:144
 msgid "documents"
 msgstr "Dokumente"
 
-#: UI/GTK2/src/statisticsDialog.cc:132 UI/GTK2/src/statisticsDialog.cc:147
+#: UI/GTK2/src/statisticsDialog.cc:134 UI/GTK2/src/statisticsDialog.cc:150
+#: UI/GTK2/src/WorkerThreads.cpp:126
 msgid "Unknown error"
 msgstr "Unbekannter Fehler"
 
-#: UI/GTK2/src/statisticsDialog.cc:154
+#: UI/GTK2/src/statisticsDialog.cc:157
 #, fuzzy
 msgid "Viewed"
 msgstr "Angesehen"
 
-#: UI/GTK2/src/statisticsDialog.cc:154
+#: UI/GTK2/src/statisticsDialog.cc:157
 msgid "results"
 msgstr "Ergebnisse"
 
 #. FIXME: check whether it's actually running !
-#: UI/GTK2/src/statisticsDialog.cc:171
+#: UI/GTK2/src/statisticsDialog.cc:174
 msgid "Running under PID"
 msgstr ""
 
-#: UI/GTK2/src/statisticsDialog.cc:175
+#: UI/GTK2/src/statisticsDialog.cc:178
 msgid "Currently not running"
 msgstr ""
 
-#: UI/GTK2/src/statisticsDialog.cc:182
+#: UI/GTK2/src/statisticsDialog.cc:185
 msgid "Crawled"
 msgstr ""
 
-#: UI/GTK2/src/statisticsDialog.cc:182
+#: UI/GTK2/src/statisticsDialog.cc:185
 msgid "files"
 msgstr "Dateien"
 
-#: UI/GTK2/src/statisticsDialog.cc:205
+#: UI/GTK2/src/statisticsDialog.cc:206
 msgid "Errors"
 msgstr "Fehler"
 
-#: UI/GTK2/src/WorkerThreads.cpp:307
-msgid "Can't index mail here"
-msgstr ""
+#: UI/GTK2/src/WorkerThreads.cpp:93
+#, fuzzy
+msgid "Index error"
+msgstr "Indiziert"
 
-#: UI/GTK2/src/WorkerThreads.cpp:328 UI/GTK2/src/WorkerThreads.cpp:581
-msgid "is already being indexed"
-msgstr ""
+#: UI/GTK2/src/WorkerThreads.cpp:95
+#, fuzzy
+msgid "Couldn't index document"
+msgstr "Dokument konnte nicht aktualisiert werden"
 
-#: UI/GTK2/src/WorkerThreads.cpp:338
-msgid "is blacklisted"
+#: UI/GTK2/src/WorkerThreads.cpp:97
+msgid "Couldn't update document"
+msgstr "Dokument konnte nicht aktualisiert werden"
+
+#: UI/GTK2/src/WorkerThreads.cpp:99
+msgid "Couldn't unindex document(s)"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:691 UI/GTK2/src/WorkerThreads.cpp:1051
-#: UI/GTK2/src/WorkerThreads.cpp:1135 UI/GTK2/src/WorkerThreads.cpp:1144
-#: UI/GTK2/src/WorkerThreads.cpp:1330 UI/GTK2/src/WorkerThreads.cpp:1600
-#: UI/GTK2/src/WorkerThreads.cpp:1733
-msgid "Index error on"
+#: UI/GTK2/src/WorkerThreads.cpp:101
+msgid "Couldn't run query on search engine"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:844
-msgid "No title"
-msgstr "Kein Titel"
+#: UI/GTK2/src/WorkerThreads.cpp:103
+#, fuzzy
+msgid "Couldn't get history for search engine"
+msgstr "Konnte Verlaufsdatenbank nicht anlegen"
 
-#: UI/GTK2/src/WorkerThreads.cpp:946 UI/GTK2/src/WorkerThreads.cpp:1072
-msgid "Couldn't create search engine"
-msgstr ""
+#: UI/GTK2/src/WorkerThreads.cpp:105
+#, fuzzy
+msgid "Couldn't retrieve document"
+msgstr "Dokument konnte nicht aktualisiert werden"
 
-#: UI/GTK2/src/WorkerThreads.cpp:970 UI/GTK2/src/WorkerThreads.cpp:1085
-msgid "Couldn't run query on search engine"
+#: UI/GTK2/src/WorkerThreads.cpp:107
+msgid "Couldn't initialize file monitor"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:1238
-msgid "Couldn't obtain downloader for protocol"
-msgstr ""
+#: UI/GTK2/src/WorkerThreads.cpp:109
+#, fuzzy
+msgid "Couldn't open directory"
+msgstr "Konnte Index nicht ?ffnen"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1263
-msgid "Couldn't retrieve"
+#: UI/GTK2/src/WorkerThreads.cpp:111
+#, fuzzy
+msgid "Index doesn't exist"
+msgstr "existiert nicht"
+
+#: UI/GTK2/src/WorkerThreads.cpp:113
+msgid "Couldn't create search engine"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:1360 UI/GTK2/src/WorkerThreads.cpp:1439
+#: UI/GTK2/src/WorkerThreads.cpp:115
 msgid "Cannot index document type"
 msgstr "Kann Dokumenttyp nicht indizieren"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1364 UI/GTK2/src/WorkerThreads.cpp:1443
-msgid "at"
+#: UI/GTK2/src/WorkerThreads.cpp:117
+msgid "No downloader for this protocol"
 msgstr ""
 
-#. No, it isn't
-#: UI/GTK2/src/WorkerThreads.cpp:1475
+#: UI/GTK2/src/WorkerThreads.cpp:119
 msgid "Robots META tag forbids indexing"
 msgstr "Robots META-Tag verbietet das Indizieren"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1529
-msgid "Couldn't index"
+#: UI/GTK2/src/WorkerThreads.cpp:121
+msgid "No monitoring handler"
 msgstr ""
 
-#. Be pessimistic and assume something will go wrong ;-)
-#: UI/GTK2/src/WorkerThreads.cpp:1611
-msgid "Couldn't unindex document(s)"
+#: UI/GTK2/src/WorkerThreads.cpp:391
+msgid "Can't index mail here"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:1745
-msgid "Couldn't update document"
-msgstr "Dokument konnte nicht aktualisiert werden"
+#: UI/GTK2/src/WorkerThreads.cpp:412 UI/GTK2/src/WorkerThreads.cpp:666
+msgid "is already being indexed"
+msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:1981
-msgid "No monitoring handler"
+#: UI/GTK2/src/WorkerThreads.cpp:422
+msgid "is blacklisted"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:2023
-msgid "Couldn't initialize file monitor"
-msgstr ""
+#: UI/GTK2/src/WorkerThreads.cpp:935
+msgid "No title"
+msgstr "Kein Titel"

Modified: trunk/po/es.po
===================================================================
--- trunk/po/es.po	2007-10-27 03:47:11 UTC (rev 1076)
+++ trunk/po/es.po	2007-10-27 12:57:33 UTC (rev 1077)
@@ -7,7 +7,7 @@
 msgstr ""
 "Project-Id-Version: pinot 0.75\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2007-09-23 19:22+0800\n"
+"POT-Creation-Date: 2007-10-27 00:15+0800\n"
 "PO-Revision-Date: 2007-09-20 21:14+0000\n"
 "Last-Translator: Gar Bage <garbage at openfutura.com>\n"
 "Language-Team: es <fabricecolin at users.berlios.de>\n"
@@ -28,22 +28,22 @@
 #. Enable these menu items unless it is not the documents index
 #. Allow this only for internal indexes
 #. Internal indices
-#: UI/GTK2/src/EnginesTree.cpp:337 UI/GTK2/src/mainWindow.cc:677
-#: UI/GTK2/src/mainWindow.cc:1187 UI/GTK2/src/mainWindow.cc:1339
-#: UI/GTK2/src/mainWindow.cc:1381 UI/GTK2/src/mainWindow.cc:1403
-#: UI/GTK2/src/mainWindow.cc:1434 UI/GTK2/src/mainWindow.cc:2045
-#: UI/GTK2/src/mainWindow.cc:2157 UI/GTK2/src/PinotSettings.cpp:311
-#: UI/GTK2/src/PinotSettings.cpp:1387 UI/GTK2/src/PinotSettings.cpp:1443
-#: UI/GTK2/src/statisticsDialog.cc:77 UI/GTK2/src/WorkerThreads.cpp:822
-#: UI/GTK2/src/WorkerThreads.cpp:881
+#: UI/GTK2/src/EnginesTree.cpp:337 UI/GTK2/src/mainWindow.cc:795
+#: UI/GTK2/src/mainWindow.cc:1017 UI/GTK2/src/mainWindow.cc:1354
+#: UI/GTK2/src/mainWindow.cc:1509 UI/GTK2/src/mainWindow.cc:1551
+#: UI/GTK2/src/mainWindow.cc:1573 UI/GTK2/src/mainWindow.cc:2177
+#: UI/GTK2/src/mainWindow.cc:2287 UI/GTK2/src/PinotSettings.cpp:311
+#: UI/GTK2/src/PinotSettings.cpp:1421 UI/GTK2/src/PinotSettings.cpp:1477
+#: UI/GTK2/src/statisticsDialog.cc:78 UI/GTK2/src/WorkerThreads.cpp:972
 msgid "My Web Pages"
 msgstr "Mis Paginas Web"
 
-#: UI/GTK2/src/EnginesTree.cpp:338 UI/GTK2/src/mainWindow.cc:680
-#: UI/GTK2/src/mainWindow.cc:1194 UI/GTK2/src/mainWindow.cc:2158
-#: UI/GTK2/src/PinotSettings.cpp:312 UI/GTK2/src/PinotSettings.cpp:1388
-#: UI/GTK2/src/PinotSettings.cpp:1444 UI/GTK2/src/statisticsDialog.cc:82
-#: UI/GTK2/src/WorkerThreads.cpp:827 UI/GTK2/src/WorkerThreads.cpp:891
+#. Spawn new threads
+#: UI/GTK2/src/EnginesTree.cpp:338 UI/GTK2/src/mainWindow.cc:798
+#: UI/GTK2/src/mainWindow.cc:1011 UI/GTK2/src/mainWindow.cc:1361
+#: UI/GTK2/src/mainWindow.cc:2291 UI/GTK2/src/PinotSettings.cpp:312
+#: UI/GTK2/src/PinotSettings.cpp:1422 UI/GTK2/src/PinotSettings.cpp:1478
+#: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:982
 msgid "My Documents"
 msgstr "Mis documentos"
 
@@ -87,12 +87,13 @@
 msgid "External index"
 msgstr "?ndice externo"
 
-#: UI/GTK2/src/importDialog.cc:87 UI/GTK2/src/queryDialog.cc:95
+#. Labels
+#: UI/GTK2/src/importDialog.cc:87 UI/GTK2/src/queryDialog.cc:123
 msgid "None"
 msgstr "Ninguno"
 
 #: UI/GTK2/src/importDialog_glade.cc:68
-#: UI/GTK2/src/propertiesDialog_glade.cc:67
+#: UI/GTK2/src/propertiesDialog_glade.cc:64
 msgid "Title:"
 msgstr "T?tulo:"
 
@@ -104,7 +105,7 @@
 msgid "Import"
 msgstr "Importar"
 
-#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:221
+#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:216
 msgid "Import URL"
 msgstr "Importar una URL"
 
@@ -136,396 +137,429 @@
 msgid "Helper application"
 msgstr "Aplicaci?n de ayuda"
 
-#: UI/GTK2/src/mainWindow.cc:211
+#: UI/GTK2/src/mainWindow.cc:212
 msgid "Query Name"
 msgstr "Nombre de la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:216
+#: UI/GTK2/src/mainWindow.cc:217
 msgid "Last Run"
 msgstr "?ltima ejecuci?n"
 
-#: UI/GTK2/src/mainWindow.cc:221
+#: UI/GTK2/src/mainWindow.cc:222
 msgid "Summary"
 msgstr "Sumario"
 
 #. Set tooltips
-#: UI/GTK2/src/mainWindow.cc:255
+#: UI/GTK2/src/mainWindow.cc:252
 msgid "Show all search engines"
 msgstr "Mostrar todos los motores de b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:256
-msgid "Add index"
+#: UI/GTK2/src/mainWindow.cc:253
+msgid "Find documents that match the query string"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:254
+#, fuzzy
+msgid "Add an index"
 msgstr "A?adir ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:257
-msgid "Remove index"
+#: UI/GTK2/src/mainWindow.cc:255
+#, fuzzy
+msgid "Remove an index"
 msgstr "Borrar ?ndice"
 
+#: UI/GTK2/src/mainWindow.cc:256
+#, fuzzy
+msgid "Add a query"
+msgstr "A?adida una nueva b?squeda"
+
+#: UI/GTK2/src/mainWindow.cc:257
+#, fuzzy
+msgid "Remove a query"
+msgstr "B?squeda activa"
+
+#: UI/GTK2/src/mainWindow.cc:258
+msgid "Show the query's previous results"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:259
+msgid "Find documents that match the query"
+msgstr ""
+
 #. Now we are ready
-#: UI/GTK2/src/mainWindow.cc:282
+#: UI/GTK2/src/mainWindow.cc:289
 msgid "Ready"
 msgstr "Preparado"
 
-#: UI/GTK2/src/mainWindow.cc:342
+#: UI/GTK2/src/mainWindow.cc:349
 msgid "N/A"
 msgstr "Desconocido"
 
-#: UI/GTK2/src/mainWindow.cc:357
+#: UI/GTK2/src/mainWindow.cc:364
 msgid "Undefined"
 msgstr "Indefinido"
 
+#. Find this query
+#: UI/GTK2/src/mainWindow.cc:587 UI/GTK2/src/mainWindow.cc:2675
+msgid "Live query"
+msgstr "B?squeda activa"
+
 #. Show the URL of the first result in the status bar
-#: UI/GTK2/src/mainWindow.cc:611
+#: UI/GTK2/src/mainWindow.cc:727
 msgid "Result location is"
 msgstr "La localizaci?n del resultado es"
 
 #. Show the URL in the status bar
-#: UI/GTK2/src/mainWindow.cc:691
+#: UI/GTK2/src/mainWindow.cc:809
 msgid "Document location is"
 msgstr "La localizaci?n del documento es"
 
-#: UI/GTK2/src/mainWindow.cc:1024
+#: UI/GTK2/src/mainWindow.cc:993 UI/GTK2/src/mainWindow.cc:2109
+msgid "Couldn't find query"
+msgstr "No se pudo a?adir la b?squeda"
+
+#: UI/GTK2/src/mainWindow.cc:1008
+#, fuzzy
+msgid "In Results"
+msgstr "resultados"
+
+#: UI/GTK2/src/mainWindow.cc:1191
 msgid "Showing"
 msgstr "Mostrando"
 
-#: UI/GTK2/src/mainWindow.cc:1029
+#: UI/GTK2/src/mainWindow.cc:1196
 msgid "of"
 msgstr "documentos"
 
-#: UI/GTK2/src/mainWindow.cc:1034
+#: UI/GTK2/src/mainWindow.cc:1201
 msgid "documents, starting at"
 msgstr "documentos comenzando en"
 
-#: UI/GTK2/src/mainWindow.cc:1068
+#: UI/GTK2/src/mainWindow.cc:1235
 msgid "Query"
 msgstr "B?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:1072 UI/GTK2/src/mainWindow.cc:3177
+#: UI/GTK2/src/mainWindow.cc:1239 UI/GTK2/src/mainWindow.cc:3268
 msgid "on"
 msgstr "en"
 
-#: UI/GTK2/src/mainWindow.cc:1076
+#: UI/GTK2/src/mainWindow.cc:1243
 msgid "ended"
 msgstr "finalizado"
 
-#: UI/GTK2/src/mainWindow.cc:1137
+#: UI/GTK2/src/mainWindow.cc:1304
 msgid "Corrected"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:1223
+#: UI/GTK2/src/mainWindow.cc:1393
 msgid "More Like"
 msgstr "M?s como"
 
-#: UI/GTK2/src/mainWindow.cc:1265
+#: UI/GTK2/src/mainWindow.cc:1435
 msgid "Updated label(s)"
 msgstr "Etiqueta(s) actualizada(s)"
 
 #. Yes, it did
-#: UI/GTK2/src/mainWindow.cc:1349
+#: UI/GTK2/src/mainWindow.cc:1519 UI/GTK2/src/mainWindow.cc:1613
 msgid "Updated document"
 msgstr "Documento actualizado"
 
-#: UI/GTK2/src/mainWindow.cc:1362
+#: UI/GTK2/src/mainWindow.cc:1532
 msgid "Indexed"
 msgstr "Indizado"
 
-#: UI/GTK2/src/mainWindow.cc:1404
+#: UI/GTK2/src/mainWindow.cc:1574
 msgid "Unindexed document(s)"
 msgstr "Documento(s) no indizado(s)"
 
-#: UI/GTK2/src/mainWindow.cc:1444
-msgid "Updated document properties"
-msgstr "Propiedades del documento actualizadas"
-
-#: UI/GTK2/src/mainWindow.cc:1497
+#: UI/GTK2/src/mainWindow.cc:1671
 msgid "Couldn't rename index, name"
 msgstr "No se pudo renombrar ?ndice, nombre"
 
-#: UI/GTK2/src/mainWindow.cc:1501 UI/GTK2/src/mainWindow.cc:2441
-#: UI/GTK2/src/mainWindow.cc:2982
+#: UI/GTK2/src/mainWindow.cc:1675 UI/GTK2/src/mainWindow.cc:2501
+#: UI/GTK2/src/mainWindow.cc:3072
 msgid "is already in use"
 msgstr "ya est? en uso"
 
-#: UI/GTK2/src/mainWindow.cc:1514
+#: UI/GTK2/src/mainWindow.cc:1688
 msgid "Couldn't rename index"
 msgstr "No se pudo renombrar el ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:1527
+#: UI/GTK2/src/mainWindow.cc:1701
 msgid "Edited index"
 msgstr "?ndice editado"
 
-#: UI/GTK2/src/mainWindow.cc:1853
+#: UI/GTK2/src/mainWindow.cc:2029
 msgid "Export Results"
 msgstr "Exportar resultados"
 
-#. Find this query
-#: UI/GTK2/src/mainWindow.cc:1942 UI/GTK2/src/mainWindow.cc:2615
-msgid "Live query"
-msgstr "B?squeda activa"
-
-#: UI/GTK2/src/mainWindow.cc:1968
-msgid "Couldn't find query"
-msgstr "No se pudo a?adir la b?squeda"
-
-#: UI/GTK2/src/mainWindow.cc:2167 UI/GTK2/src/WorkerThreads.cpp:678
-#: UI/GTK2/src/WorkerThreads.cpp:1720
+#: UI/GTK2/src/mainWindow.cc:2304
 msgid "Index"
 msgstr "?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2171 UI/GTK2/src/WorkerThreads.cpp:682
-#: UI/GTK2/src/WorkerThreads.cpp:1724
+#: UI/GTK2/src/mainWindow.cc:2308
 msgid "doesn't exist"
 msgstr "no existe"
 
-#: UI/GTK2/src/mainWindow.cc:2326
+#: UI/GTK2/src/mainWindow.cc:2386
 msgid "Remove this document from the index ?"
 msgstr "?Borrar este documento del ?ndice?"
 
-#: UI/GTK2/src/mainWindow.cc:2345
+#: UI/GTK2/src/mainWindow.cc:2405
 msgid "Remove these documents from the index ?"
 msgstr "?Borrar este documento del ?ndice?"
 
-#: UI/GTK2/src/mainWindow.cc:2391
+#: UI/GTK2/src/mainWindow.cc:2451
 msgid "A metasearch tool for the Free Desktop"
 msgstr "Una herramienta metabuscador para el escritorio libre"
 
-#: UI/GTK2/src/mainWindow.cc:2392
+#: UI/GTK2/src/mainWindow.cc:2452
 msgid "Search the Web and your documents !"
 msgstr "Busca en el web y en sus documentos"
 
-#: UI/GTK2/src/mainWindow.cc:2437
+#: UI/GTK2/src/mainWindow.cc:2497
 msgid "Index name"
 msgstr "Nombre del ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2452
+#: UI/GTK2/src/mainWindow.cc:2512
 msgid "Couldn't add index"
 msgstr "No se pudo a?adir el ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2468
+#: UI/GTK2/src/mainWindow.cc:2528
 msgid "Added new index"
 msgstr "A?adido un nuevo ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2503
+#: UI/GTK2/src/mainWindow.cc:2563
 msgid "Couldn't remove index"
 msgstr "No se pudo borrar el ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2795
+#: UI/GTK2/src/mainWindow.cc:2768
+msgid "No history for"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:2884
 msgid "At least one task hasn't completed yet. Quit now ?"
 msgstr "Al menos una tarea no ha finalizado. ?Parar ahora?"
 
-#: UI/GTK2/src/mainWindow.cc:2978
+#: UI/GTK2/src/mainWindow.cc:3068
 msgid "Query name"
 msgstr "Nombre la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:3005
+#: UI/GTK2/src/mainWindow.cc:3095
 msgid "Couldn't update query"
 msgstr "No se pudo actualizar la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:3013
+#: UI/GTK2/src/mainWindow.cc:3103
 msgid "Edited query"
 msgstr "B?squeda editada"
 
-#: UI/GTK2/src/mainWindow.cc:3020
+#: UI/GTK2/src/mainWindow.cc:3110
 msgid "Couldn't add query"
 msgstr "No se pudo a?adir la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:3028
+#: UI/GTK2/src/mainWindow.cc:3118
 msgid "Added new query"
 msgstr "A?adida una nueva b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:3066
+#: UI/GTK2/src/mainWindow.cc:3157
 msgid "Query is not set"
 msgstr "B?squeda no definida"
 
-#: UI/GTK2/src/mainWindow.cc:3077
+#: UI/GTK2/src/mainWindow.cc:3168
 msgid "No search engine selected"
 msgstr "Motor de b?squeda no seleccionado"
 
-#: UI/GTK2/src/mainWindow.cc:3164
+#: UI/GTK2/src/mainWindow.cc:3255
 msgid "Please set the Google API key first"
 msgstr "Por favor, primero configure el API de Google"
 
-#: UI/GTK2/src/mainWindow.cc:3173
+#: UI/GTK2/src/mainWindow.cc:3264
 msgid "Running query"
 msgstr "Ejecutando la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:3382
+#: UI/GTK2/src/mainWindow.cc:3473
 msgid "No default application defined for type"
 msgstr "No hay aplicaci?n predefinida para el tipo"
 
-#: UI/GTK2/src/mainWindow_glade.cc:126
+#: UI/GTK2/src/mainWindow_glade.cc:127
 msgid "Query:"
 msgstr "B?squeda:"
 
-#: UI/GTK2/src/mainWindow_glade.cc:138
-msgid "Edit"
-msgstr "Editar"
+#: UI/GTK2/src/mainWindow_glade.cc:138 UI/GTK2/src/statisticsDialog.cc:88
+msgid "History"
+msgstr "Hist?rico de b?squeda"
 
-#: UI/GTK2/src/mainWindow_glade.cc:147
+#: UI/GTK2/src/mainWindow_glade.cc:143
 msgid "Stored queries"
 msgstr "B?squedas guardadas"
 
-#: UI/GTK2/src/mainWindow_glade.cc:164 UI/GTK2/src/statisticsDialog.cc:50
+#: UI/GTK2/src/mainWindow_glade.cc:156 UI/GTK2/src/statisticsDialog.cc:51
 #: UI/GTK2/src/statisticsDialog_glade.cc:87
 msgid "Status"
 msgstr "Estatus"
 
-#: UI/GTK2/src/mainWindow_glade.cc:185
+#: UI/GTK2/src/mainWindow_glade.cc:177
 msgid "Search Engine"
 msgstr "Motor de b?squeda"
 
-#: UI/GTK2/src/mainWindow_glade.cc:188
+#: UI/GTK2/src/mainWindow_glade.cc:180
 msgid "Host Name"
 msgstr "Nombre del servidor"
 
-#: UI/GTK2/src/mainWindow_glade.cc:191
+#: UI/GTK2/src/mainWindow_glade.cc:183
 msgid "Show Extract"
 msgstr "Mostrar extra?dos"
 
-#: UI/GTK2/src/mainWindow_glade.cc:194
+#: UI/GTK2/src/mainWindow_glade.cc:186
 msgid "Group By"
 msgstr "Agrupar por"
 
-#: UI/GTK2/src/mainWindow_glade.cc:200
+#: UI/GTK2/src/mainWindow_glade.cc:192
 msgid "Clear List"
 msgstr "Limpiar la lista"
 
-#: UI/GTK2/src/mainWindow_glade.cc:206
+#: UI/GTK2/src/mainWindow_glade.cc:198
 msgid "Vie_w"
 msgstr "Ver"
 
-#: UI/GTK2/src/mainWindow_glade.cc:209
+#: UI/GTK2/src/mainWindow_glade.cc:201
 msgid "View Cache"
 msgstr "Ver la cache"
 
-#: UI/GTK2/src/mainWindow_glade.cc:212
+#: UI/GTK2/src/mainWindow_glade.cc:204
 msgid "More Like This"
 msgstr "Documentos similares"
 
-#: UI/GTK2/src/mainWindow_glade.cc:215 UI/GTK2/src/mainWindow_glade.cc:251
+#: UI/GTK2/src/mainWindow_glade.cc:207
+#, fuzzy
+msgid "Search This For"
+msgstr "Motores de b?squeda"
+
+#: UI/GTK2/src/mainWindow_glade.cc:210 UI/GTK2/src/mainWindow_glade.cc:246
 msgid "_Index"
 msgstr "?ndice"
 
-#: UI/GTK2/src/mainWindow_glade.cc:218
+#: UI/GTK2/src/mainWindow_glade.cc:213
 msgid "List Contents Of"
 msgstr "Listar el contenido de"
 
-#: UI/GTK2/src/mainWindow_glade.cc:227
+#: UI/GTK2/src/mainWindow_glade.cc:222
 msgid "View"
 msgstr "Ver"
 
-#: UI/GTK2/src/mainWindow_glade.cc:230
+#: UI/GTK2/src/mainWindow_glade.cc:225
 msgid "Update"
 msgstr "Actualizar"
 
-#: UI/GTK2/src/mainWindow_glade.cc:233
+#: UI/GTK2/src/mainWindow_glade.cc:228
 msgid "Unindex"
 msgstr "Des-indizar"
 
-#: UI/GTK2/src/mainWindow_glade.cc:236
-#: UI/GTK2/src/propertiesDialog_glade.cc:177
+#: UI/GTK2/src/mainWindow_glade.cc:231
+#: UI/GTK2/src/propertiesDialog_glade.cc:225
 msgid "Properties"
 msgstr "Propiedades"
 
-#: UI/GTK2/src/mainWindow_glade.cc:239
+#: UI/GTK2/src/mainWindow_glade.cc:234
 msgid "_About"
 msgstr "Sobre"
 
-#: UI/GTK2/src/mainWindow_glade.cc:242
+#: UI/GTK2/src/mainWindow_glade.cc:237
 msgid "_Session"
 msgstr "Sesi?n"
 
-#: UI/GTK2/src/mainWindow_glade.cc:245
+#: UI/GTK2/src/mainWindow_glade.cc:240
 msgid "_Edit"
 msgstr "Editar"
 
-#: UI/GTK2/src/mainWindow_glade.cc:248
+#: UI/GTK2/src/mainWindow_glade.cc:243
 msgid "_Results"
 msgstr "Resultados"
 
-#: UI/GTK2/src/mainWindow_glade.cc:254
+#: UI/GTK2/src/mainWindow_glade.cc:249
 msgid "_Help"
 msgstr "Ayuda"
 
-#: UI/GTK2/src/mainWindow_glade.cc:403
+#: UI/GTK2/src/mainWindow_glade.cc:378
 msgid "Pinot"
 msgstr "Pinot"
 
 #. Localize language names
-#: UI/GTK2/src/pinot.cc:249 UI/GTK2/src/pinot-dbus-daemon.cc:324
-#: UI/GTK2/src/propertiesDialog.cc:72 UI/GTK2/src/propertiesDialog.cc:81
+#: UI/GTK2/src/pinot.cc:233 UI/GTK2/src/pinot-dbus-daemon.cc:312
+#: UI/GTK2/src/propertiesDialog.cc:97
 msgid "Unknown"
 msgstr "Desconocido"
 
-#: UI/GTK2/src/pinot.cc:250 UI/GTK2/src/pinot-dbus-daemon.cc:325
+#: UI/GTK2/src/pinot.cc:234 UI/GTK2/src/pinot-dbus-daemon.cc:313
 msgid "Danish"
 msgstr "Dan?s"
 
-#: UI/GTK2/src/pinot.cc:251 UI/GTK2/src/pinot-dbus-daemon.cc:326
+#: UI/GTK2/src/pinot.cc:235 UI/GTK2/src/pinot-dbus-daemon.cc:314
 msgid "Dutch"
 msgstr "Holand?s"
 
-#: UI/GTK2/src/pinot.cc:252 UI/GTK2/src/pinot-dbus-daemon.cc:327
+#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:315
 msgid "English"
 msgstr "Ingl?s"
 
-#: UI/GTK2/src/pinot.cc:253 UI/GTK2/src/pinot-dbus-daemon.cc:328
+#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:316
 msgid "Finnish"
 msgstr "Finland?s"
 
-#: UI/GTK2/src/pinot.cc:254 UI/GTK2/src/pinot-dbus-daemon.cc:329
+#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:317
 msgid "French"
 msgstr "Franc?s"
 
-#: UI/GTK2/src/pinot.cc:255 UI/GTK2/src/pinot-dbus-daemon.cc:330
+#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:318
 msgid "German"
 msgstr "Alem?n"
 
-#: UI/GTK2/src/pinot.cc:256 UI/GTK2/src/pinot-dbus-daemon.cc:331
+#: UI/GTK2/src/pinot.cc:240 UI/GTK2/src/pinot-dbus-daemon.cc:319
 msgid "Hungarian"
 msgstr "H?ngaro"
 
-#: UI/GTK2/src/pinot.cc:257 UI/GTK2/src/pinot-dbus-daemon.cc:332
+#: UI/GTK2/src/pinot.cc:241 UI/GTK2/src/pinot-dbus-daemon.cc:320
 msgid "Italian"
 msgstr "Italiano"
 
-#: UI/GTK2/src/pinot.cc:258 UI/GTK2/src/pinot-dbus-daemon.cc:333
+#: UI/GTK2/src/pinot.cc:242 UI/GTK2/src/pinot-dbus-daemon.cc:321
 msgid "Norwegian"
 msgstr "Noruego"
 
-#: UI/GTK2/src/pinot.cc:259 UI/GTK2/src/pinot-dbus-daemon.cc:334
+#: UI/GTK2/src/pinot.cc:243 UI/GTK2/src/pinot-dbus-daemon.cc:322
 msgid "Portuguese"
 msgstr "Portugu?s"
 
-#: UI/GTK2/src/pinot.cc:260 UI/GTK2/src/pinot-dbus-daemon.cc:335
+#: UI/GTK2/src/pinot.cc:244 UI/GTK2/src/pinot-dbus-daemon.cc:323
 msgid "Romanian"
 msgstr "Rumano"
 
-#: UI/GTK2/src/pinot.cc:261 UI/GTK2/src/pinot-dbus-daemon.cc:336
+#: UI/GTK2/src/pinot.cc:245 UI/GTK2/src/pinot-dbus-daemon.cc:324
 msgid "Russian"
 msgstr "Ruso"
 
-#: UI/GTK2/src/pinot.cc:262 UI/GTK2/src/pinot-dbus-daemon.cc:337
+#: UI/GTK2/src/pinot.cc:246 UI/GTK2/src/pinot-dbus-daemon.cc:325
 msgid "Spanish"
 msgstr "Espa?ol"
 
-#: UI/GTK2/src/pinot.cc:263 UI/GTK2/src/pinot-dbus-daemon.cc:338
+#: UI/GTK2/src/pinot.cc:247 UI/GTK2/src/pinot-dbus-daemon.cc:326
 msgid "Swedish"
 msgstr "Sueco"
 
-#: UI/GTK2/src/pinot.cc:264 UI/GTK2/src/pinot-dbus-daemon.cc:339
+#: UI/GTK2/src/pinot.cc:248 UI/GTK2/src/pinot-dbus-daemon.cc:327
 msgid "Turkish"
 msgstr "Turco"
 
-#: UI/GTK2/src/pinot.cc:289
+#: UI/GTK2/src/pinot.cc:273
 msgid "Couldn't open index"
 msgstr "No se pudo abrir el ?ndice"
 
-#: UI/GTK2/src/pinot.cc:310
+#: UI/GTK2/src/pinot.cc:294
 msgid "Couldn't create history database"
 msgstr "No se pudo crear la base de datos del hist?rico"
 
-#: UI/GTK2/src/pinot.cc:336
+#. Warn the user
+#: UI/GTK2/src/pinot.cc:330
 msgid "Updating all documents in My Web Pages is recommended"
 msgstr "Se recomienda actualizar todos los documentos en Mis P?ginas Web"
 
@@ -542,39 +576,43 @@
 msgid "Personal"
 msgstr "Personal"
 
-#: UI/GTK2/src/PinotSettings.cpp:1198
+#: UI/GTK2/src/PinotSettings.cpp:358
+msgid "Me"
+msgstr ""
+
+#: UI/GTK2/src/PinotSettings.cpp:1233
 msgid "Unclassified"
 msgstr "No clasificado"
 
-#: UI/GTK2/src/prefsDialog.cc:81
+#: UI/GTK2/src/prefsDialog.cc:83
 msgid "Name"
 msgstr "Nombre"
 
-#: UI/GTK2/src/prefsDialog.cc:89
+#: UI/GTK2/src/prefsDialog.cc:91
 msgid "Monitor"
 msgstr "Supervisar"
 
-#: UI/GTK2/src/prefsDialog.cc:90
+#: UI/GTK2/src/prefsDialog.cc:92
 msgid "Location"
 msgstr "Localizaci?n"
 
-#: UI/GTK2/src/prefsDialog.cc:98
+#: UI/GTK2/src/prefsDialog.cc:100
 msgid "Pattern"
 msgstr "Patron"
 
-#: UI/GTK2/src/prefsDialog.cc:315
+#: UI/GTK2/src/prefsDialog.cc:357
 msgid "Exclude these patterns from indexing"
 msgstr "Excluir de la indizacion estos patrones"
 
-#: UI/GTK2/src/prefsDialog.cc:316
+#: UI/GTK2/src/prefsDialog.cc:358
 msgid "Only index these patterns"
 msgstr "Indizar s?lo estos patrones"
 
-#: UI/GTK2/src/prefsDialog.cc:406
+#: UI/GTK2/src/prefsDialog.cc:478
 msgid "New Label"
 msgstr "Nueva etiqueta"
 
-#: UI/GTK2/src/prefsDialog.cc:447
+#: UI/GTK2/src/prefsDialog.cc:519
 msgid "Directory to index"
 msgstr "Carpeta a indexar"
 
@@ -631,7 +669,7 @@
 msgid "Remove"
 msgstr "Borrar"
 
-#: UI/GTK2/src/prefsDialog_glade.cc:113
+#: UI/GTK2/src/prefsDialog_glade.cc:113 UI/GTK2/src/propertiesDialog.cc:56
 msgid "Labels"
 msgstr "Etiquetas"
 
@@ -652,79 +690,98 @@
 msgid "Preferences"
 msgstr "Preferencias"
 
-#: UI/GTK2/src/propertiesDialog.cc:60 UI/GTK2/src/queryDialog.cc:124
-msgid "Label"
-msgstr "Etiqueta"
-
-#: UI/GTK2/src/propertiesDialog.cc:93
+#: UI/GTK2/src/propertiesDialog.cc:110
 msgid "Per document"
 msgstr "Documento"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:68
+#: UI/GTK2/src/propertiesDialog.cc:368
+#, fuzzy
+msgid "Export Terms"
+msgstr "Exportar resultados"
+
+#: UI/GTK2/src/propertiesDialog_glade.cc:65
 msgid "Language:"
 msgstr "Idioma:"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:69
+#: UI/GTK2/src/propertiesDialog_glade.cc:66
 msgid "MIME type:"
 msgstr "Tipo MIME:"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:70
+#: UI/GTK2/src/propertiesDialog_glade.cc:67
 msgid "Size:"
 msgstr "Tama?o:"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:73
+#: UI/GTK2/src/propertiesDialog_glade.cc:68
 msgid "Terms:"
 msgstr "T?rminos:"
 
-#: UI/GTK2/src/queryDialog.cc:114
+#: UI/GTK2/src/propertiesDialog_glade.cc:78
+msgid "bytes"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog.cc:94
 msgid "Host name"
 msgstr "Nombre de servidor"
 
-#: UI/GTK2/src/queryDialog.cc:115
+#: UI/GTK2/src/queryDialog.cc:95
 msgid "File name"
 msgstr "Nombre de archivo"
 
-#: UI/GTK2/src/queryDialog.cc:118
+#: UI/GTK2/src/queryDialog.cc:96
 msgid "File extension"
 msgstr "Extensi?n del archivo"
 
 #. This is the title column
-#: UI/GTK2/src/queryDialog.cc:119 UI/GTK2/src/ResultsTree.cpp:133
+#: UI/GTK2/src/queryDialog.cc:97 UI/GTK2/src/ResultsTree.cpp:133
 msgid "Title"
 msgstr "T?tulo"
 
 #. URL
-#: UI/GTK2/src/queryDialog.cc:120 UI/GTK2/src/ResultsTree.cpp:143
+#: UI/GTK2/src/queryDialog.cc:98 UI/GTK2/src/ResultsTree.cpp:143
 msgid "URL"
 msgstr "URL"
 
-#: UI/GTK2/src/queryDialog.cc:121
+#: UI/GTK2/src/queryDialog.cc:99
 msgid "Directory"
 msgstr "Carpeta"
 
-#: UI/GTK2/src/queryDialog.cc:122
+#: UI/GTK2/src/queryDialog.cc:100
 msgid "Language code"
 msgstr "Codigo de idioma"
 
-#: UI/GTK2/src/queryDialog.cc:123
+#: UI/GTK2/src/queryDialog.cc:101
 msgid "MIME type"
 msgstr "Tipo MIME"
 
+#: UI/GTK2/src/queryDialog.cc:102
+msgid "Label"
+msgstr "Etiqueta"
+
 #. The last column is for the timestamp
-#: UI/GTK2/src/queryDialog.cc:127 UI/GTK2/src/ResultsTree.cpp:151
+#: UI/GTK2/src/queryDialog.cc:105 UI/GTK2/src/ResultsTree.cpp:151
 msgid "Date"
 msgstr "Date"
 
-#: UI/GTK2/src/queryDialog.cc:128
+#: UI/GTK2/src/queryDialog.cc:106
 #, fuzzy
 msgid "Time"
 msgstr "T?tulo"
 
-#: UI/GTK2/src/queryDialog.cc:129
+#: UI/GTK2/src/queryDialog.cc:107
 #, fuzzy
 msgid "Size"
 msgstr "Tama?o:"
 
+#. Sort order
+#: UI/GTK2/src/queryDialog.cc:111
+msgid "By relevance"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog.cc:112
+#, fuzzy
+msgid "By date"
+msgstr "Actualizar"
+
 #: UI/GTK2/src/queryDialog_glade.cc:72
 #, fuzzy
 msgid "New filter or range:"
@@ -742,7 +799,11 @@
 msgid "Number of results:"
 msgstr "N?mero de resultados:"
 
-#: UI/GTK2/src/queryDialog_glade.cc:181
+#: UI/GTK2/src/queryDialog_glade.cc:90
+msgid "Sort order:"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog_glade.cc:192
 msgid "Query parameters"
 msgstr "Par?metros de b?squeda"
 
@@ -755,124 +816,131 @@
 msgid "Extract"
 msgstr "Extra?dos"
 
-#: UI/GTK2/src/statisticsDialog.cc:72
+#: UI/GTK2/src/statisticsDialog.cc:73
 msgid "Indexes"
 msgstr "?ndices"
 
-#: UI/GTK2/src/statisticsDialog.cc:87
-msgid "History"
-msgstr "Hist?rico de b?squeda"
-
-#: UI/GTK2/src/statisticsDialog.cc:92
+#: UI/GTK2/src/statisticsDialog.cc:93
 msgid "Daemon"
 msgstr "Daemon"
 
-#: UI/GTK2/src/statisticsDialog.cc:128 UI/GTK2/src/statisticsDialog.cc:143
+#: UI/GTK2/src/statisticsDialog.cc:128 UI/GTK2/src/statisticsDialog.cc:144
 msgid "documents"
 msgstr "documentos"
 
-#: UI/GTK2/src/statisticsDialog.cc:132 UI/GTK2/src/statisticsDialog.cc:147
+#: UI/GTK2/src/statisticsDialog.cc:134 UI/GTK2/src/statisticsDialog.cc:150
+#: UI/GTK2/src/WorkerThreads.cpp:126
 msgid "Unknown error"
 msgstr "Error desconocido"
 
-#: UI/GTK2/src/statisticsDialog.cc:154
+#: UI/GTK2/src/statisticsDialog.cc:157
 msgid "Viewed"
 msgstr "Ver"
 
-#: UI/GTK2/src/statisticsDialog.cc:154
+#: UI/GTK2/src/statisticsDialog.cc:157
 msgid "results"
 msgstr "resultados"
 
 #. FIXME: check whether it's actually running !
-#: UI/GTK2/src/statisticsDialog.cc:171
+#: UI/GTK2/src/statisticsDialog.cc:174
 msgid "Running under PID"
 msgstr "Ejecut?ndose bajo PID"
 
-#: UI/GTK2/src/statisticsDialog.cc:175
+#: UI/GTK2/src/statisticsDialog.cc:178
 msgid "Currently not running"
 msgstr "No se ejecuta actualmente"
 
-#: UI/GTK2/src/statisticsDialog.cc:182
+#: UI/GTK2/src/statisticsDialog.cc:185
 msgid "Crawled"
 msgstr "Capturado"
 
-#: UI/GTK2/src/statisticsDialog.cc:182
+#: UI/GTK2/src/statisticsDialog.cc:185
 msgid "files"
 msgstr "archivos"
 
-#: UI/GTK2/src/statisticsDialog.cc:205
+#: UI/GTK2/src/statisticsDialog.cc:206
 msgid "Errors"
 msgstr "Errores"
 
-#: UI/GTK2/src/WorkerThreads.cpp:307
-msgid "Can't index mail here"
-msgstr "No se pudo indizar el buzon de correo"
+#: UI/GTK2/src/WorkerThreads.cpp:93
+#, fuzzy
+msgid "Index error"
+msgstr "Error en el ?ndice"
 
-#: UI/GTK2/src/WorkerThreads.cpp:328 UI/GTK2/src/WorkerThreads.cpp:581
-msgid "is already being indexed"
-msgstr "ya est? indizado"
+#: UI/GTK2/src/WorkerThreads.cpp:95
+#, fuzzy
+msgid "Couldn't index document"
+msgstr "No se pudo des-indizar lo(s) documento(s)"
 
-#: UI/GTK2/src/WorkerThreads.cpp:338
-msgid "is blacklisted"
-msgstr "ya excluido"
+#: UI/GTK2/src/WorkerThreads.cpp:97
+msgid "Couldn't update document"
+msgstr "No se pudo actualizar el documento"
 
-#: UI/GTK2/src/WorkerThreads.cpp:691 UI/GTK2/src/WorkerThreads.cpp:1051
-#: UI/GTK2/src/WorkerThreads.cpp:1135 UI/GTK2/src/WorkerThreads.cpp:1144
-#: UI/GTK2/src/WorkerThreads.cpp:1330 UI/GTK2/src/WorkerThreads.cpp:1600
-#: UI/GTK2/src/WorkerThreads.cpp:1733
-msgid "Index error on"
-msgstr "Error en el ?ndice"
+#: UI/GTK2/src/WorkerThreads.cpp:99
+msgid "Couldn't unindex document(s)"
+msgstr "No se pudo des-indizar lo(s) documento(s)"
 
-#: UI/GTK2/src/WorkerThreads.cpp:844
-msgid "No title"
-msgstr "Sin t?tulo"
-
-#: UI/GTK2/src/WorkerThreads.cpp:946 UI/GTK2/src/WorkerThreads.cpp:1072
-msgid "Couldn't create search engine"
-msgstr "No se pudo crear el motor de b?squeda"
-
-#: UI/GTK2/src/WorkerThreads.cpp:970 UI/GTK2/src/WorkerThreads.cpp:1085
+#: UI/GTK2/src/WorkerThreads.cpp:101
 msgid "Couldn't run query on search engine"
 msgstr "No se pudo ejecutar la b?squeda contra el motor"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1238
-msgid "Couldn't obtain downloader for protocol"
-msgstr "No se pudo usar un recuperador para el protocolo"
+#: UI/GTK2/src/WorkerThreads.cpp:103
+#, fuzzy
+msgid "Couldn't get history for search engine"
+msgstr "No se pudo ejecutar la b?squeda contra el motor"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1263
-msgid "Couldn't retrieve"
-msgstr "No se pudo descargar"
+#: UI/GTK2/src/WorkerThreads.cpp:105
+#, fuzzy
+msgid "Couldn't retrieve document"
+msgstr "No se pudo actualizar el documento"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1360 UI/GTK2/src/WorkerThreads.cpp:1439
+#: UI/GTK2/src/WorkerThreads.cpp:107
+msgid "Couldn't initialize file monitor"
+msgstr ""
+
+#: UI/GTK2/src/WorkerThreads.cpp:109
+#, fuzzy
+msgid "Couldn't open directory"
+msgstr "No se pudo abrir el ?ndice"
+
+#: UI/GTK2/src/WorkerThreads.cpp:111
+#, fuzzy
+msgid "Index doesn't exist"
+msgstr "no existe"
+
+#: UI/GTK2/src/WorkerThreads.cpp:113
+msgid "Couldn't create search engine"
+msgstr "No se pudo crear el motor de b?squeda"
+
+#: UI/GTK2/src/WorkerThreads.cpp:115
 msgid "Cannot index document type"
 msgstr "No se pudo indizar el tipo de documento"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1364 UI/GTK2/src/WorkerThreads.cpp:1443
-msgid "at"
-msgstr "a"
+#: UI/GTK2/src/WorkerThreads.cpp:117
+#, fuzzy
+msgid "No downloader for this protocol"
+msgstr "No se pudo usar un recuperador para el protocolo"
 
-#. No, it isn't
-#: UI/GTK2/src/WorkerThreads.cpp:1475
+#: UI/GTK2/src/WorkerThreads.cpp:119
 msgid "Robots META tag forbids indexing"
 msgstr "La etiqueta META Robots proh?be la indizaci?n"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1529
-msgid "Couldn't index"
-msgstr "No se pudo indizar"
+#: UI/GTK2/src/WorkerThreads.cpp:121
+msgid "No monitoring handler"
+msgstr ""
 
-#. Be pessimistic and assume something will go wrong ;-)
-#: UI/GTK2/src/WorkerThreads.cpp:1611
-msgid "Couldn't unindex document(s)"
-msgstr "No se pudo des-indizar lo(s) documento(s)"
+#: UI/GTK2/src/WorkerThreads.cpp:391
+msgid "Can't index mail here"
+msgstr "No se pudo indizar el buzon de correo"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1745
-msgid "Couldn't update document"
-msgstr "No se pudo actualizar el documento"
+#: UI/GTK2/src/WorkerThreads.cpp:412 UI/GTK2/src/WorkerThreads.cpp:666
+msgid "is already being indexed"
+msgstr "ya est? indizado"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1981
-msgid "No monitoring handler"
-msgstr ""
+#: UI/GTK2/src/WorkerThreads.cpp:422
+msgid "is blacklisted"
+msgstr "ya excluido"
 
-#: UI/GTK2/src/WorkerThreads.cpp:2023
-msgid "Couldn't initialize file monitor"
-msgstr ""
+#: UI/GTK2/src/WorkerThreads.cpp:935
+msgid "No title"
+msgstr "Sin t?tulo"

Modified: trunk/po/fr.po
===================================================================
--- trunk/po/fr.po	2007-10-27 03:47:11 UTC (rev 1076)
+++ trunk/po/fr.po	2007-10-27 12:57:33 UTC (rev 1077)
@@ -7,8 +7,8 @@
 msgstr ""
 "Project-Id-Version: pinot 0.75\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2007-09-23 19:22+0800\n"
-"PO-Revision-Date: 2007-04-03 04:46+0000\n"
+"POT-Creation-Date: 2007-10-27 00:15+0800\n"
+"PO-Revision-Date: 2007-10-19 22:30+0000\n"
 "Last-Translator: Fabrice Colin <fabricecolin at users.berlios.de>\n"
 "Language-Team: fr <fabricecolin at users.berlios.de>\n"
 "MIME-Version: 1.0\n"
@@ -28,22 +28,22 @@
 #. Enable these menu items unless it is not the documents index
 #. Allow this only for internal indexes
 #. Internal indices
-#: UI/GTK2/src/EnginesTree.cpp:337 UI/GTK2/src/mainWindow.cc:677
-#: UI/GTK2/src/mainWindow.cc:1187 UI/GTK2/src/mainWindow.cc:1339
-#: UI/GTK2/src/mainWindow.cc:1381 UI/GTK2/src/mainWindow.cc:1403
-#: UI/GTK2/src/mainWindow.cc:1434 UI/GTK2/src/mainWindow.cc:2045
-#: UI/GTK2/src/mainWindow.cc:2157 UI/GTK2/src/PinotSettings.cpp:311
-#: UI/GTK2/src/PinotSettings.cpp:1387 UI/GTK2/src/PinotSettings.cpp:1443
-#: UI/GTK2/src/statisticsDialog.cc:77 UI/GTK2/src/WorkerThreads.cpp:822
-#: UI/GTK2/src/WorkerThreads.cpp:881
+#: UI/GTK2/src/EnginesTree.cpp:337 UI/GTK2/src/mainWindow.cc:795
+#: UI/GTK2/src/mainWindow.cc:1017 UI/GTK2/src/mainWindow.cc:1354
+#: UI/GTK2/src/mainWindow.cc:1509 UI/GTK2/src/mainWindow.cc:1551
+#: UI/GTK2/src/mainWindow.cc:1573 UI/GTK2/src/mainWindow.cc:2177
+#: UI/GTK2/src/mainWindow.cc:2287 UI/GTK2/src/PinotSettings.cpp:311
+#: UI/GTK2/src/PinotSettings.cpp:1421 UI/GTK2/src/PinotSettings.cpp:1477
+#: UI/GTK2/src/statisticsDialog.cc:78 UI/GTK2/src/WorkerThreads.cpp:972
 msgid "My Web Pages"
 msgstr "Mes Pages Web"
 
-#: UI/GTK2/src/EnginesTree.cpp:338 UI/GTK2/src/mainWindow.cc:680
-#: UI/GTK2/src/mainWindow.cc:1194 UI/GTK2/src/mainWindow.cc:2158
-#: UI/GTK2/src/PinotSettings.cpp:312 UI/GTK2/src/PinotSettings.cpp:1388
-#: UI/GTK2/src/PinotSettings.cpp:1444 UI/GTK2/src/statisticsDialog.cc:82
-#: UI/GTK2/src/WorkerThreads.cpp:827 UI/GTK2/src/WorkerThreads.cpp:891
+#. Spawn new threads
+#: UI/GTK2/src/EnginesTree.cpp:338 UI/GTK2/src/mainWindow.cc:798
+#: UI/GTK2/src/mainWindow.cc:1011 UI/GTK2/src/mainWindow.cc:1361
+#: UI/GTK2/src/mainWindow.cc:2291 UI/GTK2/src/PinotSettings.cpp:312
+#: UI/GTK2/src/PinotSettings.cpp:1422 UI/GTK2/src/PinotSettings.cpp:1478
+#: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:982
 msgid "My Documents"
 msgstr "Mes Documents"
 
@@ -87,12 +87,13 @@
 msgid "External index"
 msgstr "Index externe"
 
-#: UI/GTK2/src/importDialog.cc:87 UI/GTK2/src/queryDialog.cc:95
+#. Labels
+#: UI/GTK2/src/importDialog.cc:87 UI/GTK2/src/queryDialog.cc:123
 msgid "None"
 msgstr "Aucune"
 
 #: UI/GTK2/src/importDialog_glade.cc:68
-#: UI/GTK2/src/propertiesDialog_glade.cc:67
+#: UI/GTK2/src/propertiesDialog_glade.cc:64
 msgid "Title:"
 msgstr "Titre:"
 
@@ -104,7 +105,7 @@
 msgid "Import"
 msgstr "Importer"
 
-#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:221
+#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:216
 msgid "Import URL"
 msgstr "Importer une URL"
 
@@ -136,397 +137,423 @@
 msgid "Helper application"
 msgstr "Application"
 
-#: UI/GTK2/src/mainWindow.cc:211
+#: UI/GTK2/src/mainWindow.cc:212
 msgid "Query Name"
 msgstr "Nom de la Recherche"
 
-#: UI/GTK2/src/mainWindow.cc:216
+#: UI/GTK2/src/mainWindow.cc:217
 msgid "Last Run"
 msgstr "Derniere Utilisation"
 
-#: UI/GTK2/src/mainWindow.cc:221
+#: UI/GTK2/src/mainWindow.cc:222
 msgid "Summary"
 msgstr "Sommaire"
 
 #. Set tooltips
-#: UI/GTK2/src/mainWindow.cc:255
+#: UI/GTK2/src/mainWindow.cc:252
 msgid "Show all search engines"
 msgstr "Montrer tous les moteurs"
 
-#: UI/GTK2/src/mainWindow.cc:256
-msgid "Add index"
+#: UI/GTK2/src/mainWindow.cc:253
+msgid "Find documents that match the query string"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:254
+msgid "Add an index"
 msgstr "Ajouter un index"
 
-#: UI/GTK2/src/mainWindow.cc:257
-msgid "Remove index"
+#: UI/GTK2/src/mainWindow.cc:255
+msgid "Remove an index"
 msgstr "Enlever un index"
 
+#: UI/GTK2/src/mainWindow.cc:256
+msgid "Add a query"
+msgstr "Ajouter une recherche"
+
+#: UI/GTK2/src/mainWindow.cc:257
+msgid "Remove a query"
+msgstr "Effacer une recherche"
+
+#: UI/GTK2/src/mainWindow.cc:258
+msgid "Show the query's previous results"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:259
+msgid "Find documents that match the query"
+msgstr ""
+
 #. Now we are ready
-#: UI/GTK2/src/mainWindow.cc:282
+#: UI/GTK2/src/mainWindow.cc:289
 msgid "Ready"
 msgstr "Pret"
 
-#: UI/GTK2/src/mainWindow.cc:342
+#: UI/GTK2/src/mainWindow.cc:349
 msgid "N/A"
 msgstr "Inconnue"
 
-#: UI/GTK2/src/mainWindow.cc:357
+#: UI/GTK2/src/mainWindow.cc:364
 msgid "Undefined"
 msgstr "Indefini"
 
+#. Find this query
+#: UI/GTK2/src/mainWindow.cc:587 UI/GTK2/src/mainWindow.cc:2675
+msgid "Live query"
+msgstr "Recherche"
+
 #. Show the URL of the first result in the status bar
-#: UI/GTK2/src/mainWindow.cc:611
+#: UI/GTK2/src/mainWindow.cc:727
 msgid "Result location is"
 msgstr "Le chemin du resultat est"
 
 #. Show the URL in the status bar
-#: UI/GTK2/src/mainWindow.cc:691
+#: UI/GTK2/src/mainWindow.cc:809
 msgid "Document location is"
 msgstr "Le chemin du document is"
 
-#: UI/GTK2/src/mainWindow.cc:1024
-#, fuzzy
+#: UI/GTK2/src/mainWindow.cc:993 UI/GTK2/src/mainWindow.cc:2109
+msgid "Couldn't find query"
+msgstr "N'a pas pu trouver"
+
+#: UI/GTK2/src/mainWindow.cc:1008
+msgid "In Results"
+msgstr "Dans Les Resultats"
+
+#: UI/GTK2/src/mainWindow.cc:1191
 msgid "Showing"
 msgstr "Montrant"
 
-#: UI/GTK2/src/mainWindow.cc:1029
+#: UI/GTK2/src/mainWindow.cc:1196
 msgid "of"
 msgstr "documents,"
 
-#: UI/GTK2/src/mainWindow.cc:1034
+#: UI/GTK2/src/mainWindow.cc:1201
 msgid "documents, starting at"
 msgstr "au total, a partir de"
 
-#: UI/GTK2/src/mainWindow.cc:1068
+#: UI/GTK2/src/mainWindow.cc:1235
 msgid "Query"
 msgstr "La recherche"
 
-#: UI/GTK2/src/mainWindow.cc:1072 UI/GTK2/src/mainWindow.cc:3177
+#: UI/GTK2/src/mainWindow.cc:1239 UI/GTK2/src/mainWindow.cc:3268
 msgid "on"
 msgstr "sur"
 
-#: UI/GTK2/src/mainWindow.cc:1076
+#: UI/GTK2/src/mainWindow.cc:1243
 msgid "ended"
 msgstr "est terminee"
 
-#: UI/GTK2/src/mainWindow.cc:1137
+#: UI/GTK2/src/mainWindow.cc:1304
 msgid "Corrected"
 msgstr "Corrige"
 
-#: UI/GTK2/src/mainWindow.cc:1223
+#: UI/GTK2/src/mainWindow.cc:1393
 msgid "More Like"
 msgstr "Similaire a"
 
-#: UI/GTK2/src/mainWindow.cc:1265
+#: UI/GTK2/src/mainWindow.cc:1435
 msgid "Updated label(s)"
 msgstr "Mis a jour l(es) etiquette(s)"
 
 #. Yes, it did
-#: UI/GTK2/src/mainWindow.cc:1349
+#: UI/GTK2/src/mainWindow.cc:1519 UI/GTK2/src/mainWindow.cc:1613
 msgid "Updated document"
 msgstr "Mis a jour le document"
 
-#: UI/GTK2/src/mainWindow.cc:1362
+#: UI/GTK2/src/mainWindow.cc:1532
 msgid "Indexed"
 msgstr "Indexe"
 
-#: UI/GTK2/src/mainWindow.cc:1404
+#: UI/GTK2/src/mainWindow.cc:1574
 msgid "Unindexed document(s)"
 msgstr "Desindexe le(s) document(s)"
 
-#: UI/GTK2/src/mainWindow.cc:1444
-msgid "Updated document properties"
-msgstr "Mis a jour les proprietes du document"
-
-#: UI/GTK2/src/mainWindow.cc:1497
+#: UI/GTK2/src/mainWindow.cc:1671
 msgid "Couldn't rename index, name"
 msgstr "N'a pas pu renommer l'index, le nom"
 
-#: UI/GTK2/src/mainWindow.cc:1501 UI/GTK2/src/mainWindow.cc:2441
-#: UI/GTK2/src/mainWindow.cc:2982
+#: UI/GTK2/src/mainWindow.cc:1675 UI/GTK2/src/mainWindow.cc:2501
+#: UI/GTK2/src/mainWindow.cc:3072
 msgid "is already in use"
 msgstr "est deja utilise"
 
-#: UI/GTK2/src/mainWindow.cc:1514
+#: UI/GTK2/src/mainWindow.cc:1688
 msgid "Couldn't rename index"
 msgstr "N'a pas pu renommer l'index"
 
-#: UI/GTK2/src/mainWindow.cc:1527
+#: UI/GTK2/src/mainWindow.cc:1701
 msgid "Edited index"
 msgstr "Edite l'index"
 
-#: UI/GTK2/src/mainWindow.cc:1853
+#: UI/GTK2/src/mainWindow.cc:2029
 msgid "Export Results"
 msgstr "Exporter Les Resultats"
 
-#. Find this query
-#: UI/GTK2/src/mainWindow.cc:1942 UI/GTK2/src/mainWindow.cc:2615
-msgid "Live query"
-msgstr "Recherche"
-
-#: UI/GTK2/src/mainWindow.cc:1968
-msgid "Couldn't find query"
-msgstr "N'a pas pu trouver"
-
-#: UI/GTK2/src/mainWindow.cc:2167 UI/GTK2/src/WorkerThreads.cpp:678
-#: UI/GTK2/src/WorkerThreads.cpp:1720
+#: UI/GTK2/src/mainWindow.cc:2304
 msgid "Index"
 msgstr "L'index"
 
-#: UI/GTK2/src/mainWindow.cc:2171 UI/GTK2/src/WorkerThreads.cpp:682
-#: UI/GTK2/src/WorkerThreads.cpp:1724
+#: UI/GTK2/src/mainWindow.cc:2308
 msgid "doesn't exist"
 msgstr "n'existe pas"
 
-#: UI/GTK2/src/mainWindow.cc:2326
+#: UI/GTK2/src/mainWindow.cc:2386
 msgid "Remove this document from the index ?"
 msgstr "Enlever ce document de l'index ?"
 
-#: UI/GTK2/src/mainWindow.cc:2345
+#: UI/GTK2/src/mainWindow.cc:2405
 msgid "Remove these documents from the index ?"
 msgstr "Enlever ces documents de l'index ?"
 
-#: UI/GTK2/src/mainWindow.cc:2391
+#: UI/GTK2/src/mainWindow.cc:2451
 msgid "A metasearch tool for the Free Desktop"
 msgstr "Un outil de recherche pour le Bureau Libre"
 
-#: UI/GTK2/src/mainWindow.cc:2392
+#: UI/GTK2/src/mainWindow.cc:2452
 msgid "Search the Web and your documents !"
 msgstr "Cherche le Web et vos documents"
 
-#: UI/GTK2/src/mainWindow.cc:2437
+#: UI/GTK2/src/mainWindow.cc:2497
 msgid "Index name"
 msgstr "Nom de l'index"
 
-#: UI/GTK2/src/mainWindow.cc:2452
+#: UI/GTK2/src/mainWindow.cc:2512
 msgid "Couldn't add index"
 msgstr "N'a pas pu ajouter l'index"
 
-#: UI/GTK2/src/mainWindow.cc:2468
+#: UI/GTK2/src/mainWindow.cc:2528
 msgid "Added new index"
 msgstr "Ajoute un nouvel index"
 
-#: UI/GTK2/src/mainWindow.cc:2503
+#: UI/GTK2/src/mainWindow.cc:2563
 msgid "Couldn't remove index"
 msgstr "N'a pas pu enlever l'index"
 
-#: UI/GTK2/src/mainWindow.cc:2795
+#: UI/GTK2/src/mainWindow.cc:2768
+msgid "No history for"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:2884
 msgid "At least one task hasn't completed yet. Quit now ?"
 msgstr "Au moins une tache n'est pas terminee. Quitter maintenant ?"
 
-#: UI/GTK2/src/mainWindow.cc:2978
+#: UI/GTK2/src/mainWindow.cc:3068
 msgid "Query name"
 msgstr "Nom de la recherche"
 
-#: UI/GTK2/src/mainWindow.cc:3005
+#: UI/GTK2/src/mainWindow.cc:3095
 msgid "Couldn't update query"
 msgstr "N'a pas pu mettre a jour la recherche"
 
-#: UI/GTK2/src/mainWindow.cc:3013
+#: UI/GTK2/src/mainWindow.cc:3103
 msgid "Edited query"
 msgstr "Edite la recherche"
 
-#: UI/GTK2/src/mainWindow.cc:3020
+#: UI/GTK2/src/mainWindow.cc:3110
 msgid "Couldn't add query"
 msgstr "N'a pas pu ajouter la recherche"
 
-#: UI/GTK2/src/mainWindow.cc:3028
+#: UI/GTK2/src/mainWindow.cc:3118
 msgid "Added new query"
 msgstr "Ajoute une nouvelle recherche"
 
-#: UI/GTK2/src/mainWindow.cc:3066
+#: UI/GTK2/src/mainWindow.cc:3157
 msgid "Query is not set"
 msgstr "Recherche indefinie"
 
-#: UI/GTK2/src/mainWindow.cc:3077
+#: UI/GTK2/src/mainWindow.cc:3168
 msgid "No search engine selected"
 msgstr "Pas de moteur selectionne"
 
-#: UI/GTK2/src/mainWindow.cc:3164
+#: UI/GTK2/src/mainWindow.cc:3255
 msgid "Please set the Google API key first"
 msgstr "Configurez la clef de l'API Google"
 
-#: UI/GTK2/src/mainWindow.cc:3173
+#: UI/GTK2/src/mainWindow.cc:3264
 msgid "Running query"
 msgstr "Recherche en cours"
 
-#: UI/GTK2/src/mainWindow.cc:3382
+#: UI/GTK2/src/mainWindow.cc:3473
 msgid "No default application defined for type"
 msgstr "Pas d'application definie pour le type"
 
-#: UI/GTK2/src/mainWindow_glade.cc:126
+#: UI/GTK2/src/mainWindow_glade.cc:127
 msgid "Query:"
 msgstr "Recherche:"
 
-#: UI/GTK2/src/mainWindow_glade.cc:138
-msgid "Edit"
-msgstr "Editer"
+#: UI/GTK2/src/mainWindow_glade.cc:138 UI/GTK2/src/statisticsDialog.cc:88
+msgid "History"
+msgstr "Historique"
 
-#: UI/GTK2/src/mainWindow_glade.cc:147
+#: UI/GTK2/src/mainWindow_glade.cc:143
 msgid "Stored queries"
 msgstr "Recherches sauvegardees"
 
-#: UI/GTK2/src/mainWindow_glade.cc:164 UI/GTK2/src/statisticsDialog.cc:50
+#: UI/GTK2/src/mainWindow_glade.cc:156 UI/GTK2/src/statisticsDialog.cc:51
 #: UI/GTK2/src/statisticsDialog_glade.cc:87
 msgid "Status"
 msgstr "Statistiques"
 
-#: UI/GTK2/src/mainWindow_glade.cc:185
+#: UI/GTK2/src/mainWindow_glade.cc:177
 msgid "Search Engine"
 msgstr "Moteur"
 
-#: UI/GTK2/src/mainWindow_glade.cc:188
+#: UI/GTK2/src/mainWindow_glade.cc:180
 msgid "Host Name"
 msgstr "Nom de Machine"
 
-#: UI/GTK2/src/mainWindow_glade.cc:191
+#: UI/GTK2/src/mainWindow_glade.cc:183
 msgid "Show Extract"
 msgstr "Montrer l'Extrait"
 
-#: UI/GTK2/src/mainWindow_glade.cc:194
+#: UI/GTK2/src/mainWindow_glade.cc:186
 msgid "Group By"
 msgstr "Grouper Par"
 
-#: UI/GTK2/src/mainWindow_glade.cc:200
+#: UI/GTK2/src/mainWindow_glade.cc:192
 msgid "Clear List"
 msgstr "Nettoyer la Liste"
 
-#: UI/GTK2/src/mainWindow_glade.cc:206
+#: UI/GTK2/src/mainWindow_glade.cc:198
 msgid "Vie_w"
 msgstr "Voir"
 
-#: UI/GTK2/src/mainWindow_glade.cc:209
+#: UI/GTK2/src/mainWindow_glade.cc:201
 msgid "View Cache"
 msgstr "Voir le Cache"
 
-#: UI/GTK2/src/mainWindow_glade.cc:212
+#: UI/GTK2/src/mainWindow_glade.cc:204
 msgid "More Like This"
 msgstr "Documents similaires"
 
-#: UI/GTK2/src/mainWindow_glade.cc:215 UI/GTK2/src/mainWindow_glade.cc:251
+#: UI/GTK2/src/mainWindow_glade.cc:207
+msgid "Search This For"
+msgstr "Chercher Cela Pour"
+
+#: UI/GTK2/src/mainWindow_glade.cc:210 UI/GTK2/src/mainWindow_glade.cc:246
 msgid "_Index"
 msgstr "Index"
 
-#: UI/GTK2/src/mainWindow_glade.cc:218
+#: UI/GTK2/src/mainWindow_glade.cc:213
 msgid "List Contents Of"
 msgstr "Lister le Contenu de"
 
-#: UI/GTK2/src/mainWindow_glade.cc:227
+#: UI/GTK2/src/mainWindow_glade.cc:222
 msgid "View"
 msgstr "Voir"
 
-#: UI/GTK2/src/mainWindow_glade.cc:230
+#: UI/GTK2/src/mainWindow_glade.cc:225
 msgid "Update"
 msgstr "Mettre a Jour"
 
-#: UI/GTK2/src/mainWindow_glade.cc:233
+#: UI/GTK2/src/mainWindow_glade.cc:228
 msgid "Unindex"
 msgstr "Desindexer"
 
-#: UI/GTK2/src/mainWindow_glade.cc:236
-#: UI/GTK2/src/propertiesDialog_glade.cc:177
+#: UI/GTK2/src/mainWindow_glade.cc:231
+#: UI/GTK2/src/propertiesDialog_glade.cc:225
 msgid "Properties"
 msgstr "Proprietes"
 
-#: UI/GTK2/src/mainWindow_glade.cc:239
+#: UI/GTK2/src/mainWindow_glade.cc:234
 msgid "_About"
 msgstr "A Propos"
 
-#: UI/GTK2/src/mainWindow_glade.cc:242
+#: UI/GTK2/src/mainWindow_glade.cc:237
 msgid "_Session"
 msgstr "Session"
 
-#: UI/GTK2/src/mainWindow_glade.cc:245
+#: UI/GTK2/src/mainWindow_glade.cc:240
 msgid "_Edit"
 msgstr "Editer"
 
-#: UI/GTK2/src/mainWindow_glade.cc:248
+#: UI/GTK2/src/mainWindow_glade.cc:243
 msgid "_Results"
 msgstr "Resultats"
 
-#: UI/GTK2/src/mainWindow_glade.cc:254
+#: UI/GTK2/src/mainWindow_glade.cc:249
 msgid "_Help"
 msgstr "Aide"
 
-#: UI/GTK2/src/mainWindow_glade.cc:403
+#: UI/GTK2/src/mainWindow_glade.cc:378
 msgid "Pinot"
 msgstr "Pinot"
 
 #. Localize language names
-#: UI/GTK2/src/pinot.cc:249 UI/GTK2/src/pinot-dbus-daemon.cc:324
-#: UI/GTK2/src/propertiesDialog.cc:72 UI/GTK2/src/propertiesDialog.cc:81
+#: UI/GTK2/src/pinot.cc:233 UI/GTK2/src/pinot-dbus-daemon.cc:312
+#: UI/GTK2/src/propertiesDialog.cc:97
 msgid "Unknown"
 msgstr "Inconnu"
 
-#: UI/GTK2/src/pinot.cc:250 UI/GTK2/src/pinot-dbus-daemon.cc:325
+#: UI/GTK2/src/pinot.cc:234 UI/GTK2/src/pinot-dbus-daemon.cc:313
 msgid "Danish"
 msgstr "Danois"
 
-#: UI/GTK2/src/pinot.cc:251 UI/GTK2/src/pinot-dbus-daemon.cc:326
+#: UI/GTK2/src/pinot.cc:235 UI/GTK2/src/pinot-dbus-daemon.cc:314
 msgid "Dutch"
 msgstr "Hollandais"
 
-#: UI/GTK2/src/pinot.cc:252 UI/GTK2/src/pinot-dbus-daemon.cc:327
+#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:315
 msgid "English"
 msgstr "Anglais"
 
-#: UI/GTK2/src/pinot.cc:253 UI/GTK2/src/pinot-dbus-daemon.cc:328
+#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:316
 msgid "Finnish"
 msgstr "Finlandais"
 
-#: UI/GTK2/src/pinot.cc:254 UI/GTK2/src/pinot-dbus-daemon.cc:329
+#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:317
 msgid "French"
 msgstr "Francais"
 
-#: UI/GTK2/src/pinot.cc:255 UI/GTK2/src/pinot-dbus-daemon.cc:330
+#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:318
 msgid "German"
 msgstr "Allemand"
 
-#: UI/GTK2/src/pinot.cc:256 UI/GTK2/src/pinot-dbus-daemon.cc:331
+#: UI/GTK2/src/pinot.cc:240 UI/GTK2/src/pinot-dbus-daemon.cc:319
 msgid "Hungarian"
 msgstr "Hongrois"
 
-#: UI/GTK2/src/pinot.cc:257 UI/GTK2/src/pinot-dbus-daemon.cc:332
+#: UI/GTK2/src/pinot.cc:241 UI/GTK2/src/pinot-dbus-daemon.cc:320
 msgid "Italian"
 msgstr "Italien"
 
-#: UI/GTK2/src/pinot.cc:258 UI/GTK2/src/pinot-dbus-daemon.cc:333
+#: UI/GTK2/src/pinot.cc:242 UI/GTK2/src/pinot-dbus-daemon.cc:321
 msgid "Norwegian"
 msgstr "Norvegien"
 
-#: UI/GTK2/src/pinot.cc:259 UI/GTK2/src/pinot-dbus-daemon.cc:334
+#: UI/GTK2/src/pinot.cc:243 UI/GTK2/src/pinot-dbus-daemon.cc:322
 msgid "Portuguese"
 msgstr "Portugais"
 
-#: UI/GTK2/src/pinot.cc:260 UI/GTK2/src/pinot-dbus-daemon.cc:335
+#: UI/GTK2/src/pinot.cc:244 UI/GTK2/src/pinot-dbus-daemon.cc:323
 msgid "Romanian"
 msgstr "Roumain"
 
-#: UI/GTK2/src/pinot.cc:261 UI/GTK2/src/pinot-dbus-daemon.cc:336
+#: UI/GTK2/src/pinot.cc:245 UI/GTK2/src/pinot-dbus-daemon.cc:324
 msgid "Russian"
 msgstr "Russe"
 
-#: UI/GTK2/src/pinot.cc:262 UI/GTK2/src/pinot-dbus-daemon.cc:337
+#: UI/GTK2/src/pinot.cc:246 UI/GTK2/src/pinot-dbus-daemon.cc:325
 msgid "Spanish"
 msgstr "Espagnol"
 
-#: UI/GTK2/src/pinot.cc:263 UI/GTK2/src/pinot-dbus-daemon.cc:338
+#: UI/GTK2/src/pinot.cc:247 UI/GTK2/src/pinot-dbus-daemon.cc:326
 msgid "Swedish"
 msgstr "Suedois"
 
-#: UI/GTK2/src/pinot.cc:264 UI/GTK2/src/pinot-dbus-daemon.cc:339
+#: UI/GTK2/src/pinot.cc:248 UI/GTK2/src/pinot-dbus-daemon.cc:327
 msgid "Turkish"
 msgstr "Turc"
 
-#: UI/GTK2/src/pinot.cc:289
+#: UI/GTK2/src/pinot.cc:273
 msgid "Couldn't open index"
 msgstr "N'a pas pu ouvrir l'index"
 
-#: UI/GTK2/src/pinot.cc:310
+#: UI/GTK2/src/pinot.cc:294
 msgid "Couldn't create history database"
 msgstr "N'a pas pu creer la base d'historiques"
 
-#: UI/GTK2/src/pinot.cc:336
+#. Warn the user
+#: UI/GTK2/src/pinot.cc:330
 msgid "Updating all documents in My Web Pages is recommended"
 msgstr "Il est recommende de mettre a jour tous les documents de Mes Pages Web"
 
@@ -543,39 +570,43 @@
 msgid "Personal"
 msgstr "Personnel"
 
-#: UI/GTK2/src/PinotSettings.cpp:1198
+#: UI/GTK2/src/PinotSettings.cpp:358
+msgid "Me"
+msgstr ""
+
+#: UI/GTK2/src/PinotSettings.cpp:1233
 msgid "Unclassified"
 msgstr "Sans classification"
 
-#: UI/GTK2/src/prefsDialog.cc:81
+#: UI/GTK2/src/prefsDialog.cc:83
 msgid "Name"
 msgstr "Nom"
 
-#: UI/GTK2/src/prefsDialog.cc:89
+#: UI/GTK2/src/prefsDialog.cc:91
 msgid "Monitor"
 msgstr "Surveiller"
 
-#: UI/GTK2/src/prefsDialog.cc:90
+#: UI/GTK2/src/prefsDialog.cc:92
 msgid "Location"
 msgstr "Chemin"
 
-#: UI/GTK2/src/prefsDialog.cc:98
+#: UI/GTK2/src/prefsDialog.cc:100
 msgid "Pattern"
 msgstr "Motif"
 
-#: UI/GTK2/src/prefsDialog.cc:315
+#: UI/GTK2/src/prefsDialog.cc:357
 msgid "Exclude these patterns from indexing"
 msgstr "Ne pas indexer ces motifs"
 
-#: UI/GTK2/src/prefsDialog.cc:316
+#: UI/GTK2/src/prefsDialog.cc:358
 msgid "Only index these patterns"
 msgstr "Indexer uniquement ces motifs"
 
-#: UI/GTK2/src/prefsDialog.cc:406
+#: UI/GTK2/src/prefsDialog.cc:478
 msgid "New Label"
 msgstr "Nouvelle Etiquette"
 
-#: UI/GTK2/src/prefsDialog.cc:447
+#: UI/GTK2/src/prefsDialog.cc:519
 msgid "Directory to index"
 msgstr "Repertoire a indexer"
 
@@ -632,7 +663,7 @@
 msgid "Remove"
 msgstr "Enlever"
 
-#: UI/GTK2/src/prefsDialog_glade.cc:113
+#: UI/GTK2/src/prefsDialog_glade.cc:113 UI/GTK2/src/propertiesDialog.cc:56
 msgid "Labels"
 msgstr "Etiquettes"
 
@@ -652,79 +683,96 @@
 msgid "Preferences"
 msgstr "Preferences"
 
-#: UI/GTK2/src/propertiesDialog.cc:60 UI/GTK2/src/queryDialog.cc:124
-msgid "Label"
-msgstr "Etiquette"
-
-#: UI/GTK2/src/propertiesDialog.cc:93
+#: UI/GTK2/src/propertiesDialog.cc:110
 msgid "Per document"
 msgstr "Par document"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:68
+#: UI/GTK2/src/propertiesDialog.cc:368
+msgid "Export Terms"
+msgstr "Exporter Les Termes"
+
+#: UI/GTK2/src/propertiesDialog_glade.cc:65
 msgid "Language:"
 msgstr "Langue:"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:69
+#: UI/GTK2/src/propertiesDialog_glade.cc:66
 msgid "MIME type:"
 msgstr "Type MIME:"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:70
+#: UI/GTK2/src/propertiesDialog_glade.cc:67
 msgid "Size:"
 msgstr "Taille:"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:73
+#: UI/GTK2/src/propertiesDialog_glade.cc:68
 msgid "Terms:"
 msgstr "Termes:"
 
-#: UI/GTK2/src/queryDialog.cc:114
+#: UI/GTK2/src/propertiesDialog_glade.cc:78
+msgid "bytes"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog.cc:94
 msgid "Host name"
 msgstr "Nom de machine"
 
-#: UI/GTK2/src/queryDialog.cc:115
+#: UI/GTK2/src/queryDialog.cc:95
 msgid "File name"
 msgstr "Nom de fichier"
 
-#: UI/GTK2/src/queryDialog.cc:118
+#: UI/GTK2/src/queryDialog.cc:96
 msgid "File extension"
 msgstr "Extension de fichier"
 
 #. This is the title column
-#: UI/GTK2/src/queryDialog.cc:119 UI/GTK2/src/ResultsTree.cpp:133
+#: UI/GTK2/src/queryDialog.cc:97 UI/GTK2/src/ResultsTree.cpp:133
 msgid "Title"
 msgstr "Titre"
 
 #. URL
-#: UI/GTK2/src/queryDialog.cc:120 UI/GTK2/src/ResultsTree.cpp:143
+#: UI/GTK2/src/queryDialog.cc:98 UI/GTK2/src/ResultsTree.cpp:143
 msgid "URL"
 msgstr "URL"
 
-#: UI/GTK2/src/queryDialog.cc:121
+#: UI/GTK2/src/queryDialog.cc:99
 msgid "Directory"
 msgstr "Repertoire"
 
-#: UI/GTK2/src/queryDialog.cc:122
+#: UI/GTK2/src/queryDialog.cc:100
 msgid "Language code"
 msgstr "Code langue"
 
-#: UI/GTK2/src/queryDialog.cc:123
+#: UI/GTK2/src/queryDialog.cc:101
 msgid "MIME type"
 msgstr "Type MIME"
 
+#: UI/GTK2/src/queryDialog.cc:102
+msgid "Label"
+msgstr "Etiquette"
+
 #. The last column is for the timestamp
-#: UI/GTK2/src/queryDialog.cc:127 UI/GTK2/src/ResultsTree.cpp:151
+#: UI/GTK2/src/queryDialog.cc:105 UI/GTK2/src/ResultsTree.cpp:151
 msgid "Date"
 msgstr "Date"
 
-#: UI/GTK2/src/queryDialog.cc:128
+#: UI/GTK2/src/queryDialog.cc:106
 msgid "Time"
 msgstr "Heure"
 
-#: UI/GTK2/src/queryDialog.cc:129
+#: UI/GTK2/src/queryDialog.cc:107
 msgid "Size"
 msgstr "Taille"
 
+#. Sort order
+#: UI/GTK2/src/queryDialog.cc:111
+#, fuzzy
+msgid "By relevance"
+msgstr "Par relevance"
+
+#: UI/GTK2/src/queryDialog.cc:112
+msgid "By date"
+msgstr "Par date"
+
 #: UI/GTK2/src/queryDialog_glade.cc:72
-#, fuzzy
 msgid "New filter or range:"
 msgstr "Nouveau filtre ou gamme num?rique:"
 
@@ -740,7 +788,11 @@
 msgid "Number of results:"
 msgstr "Nombre de resultats:"
 
-#: UI/GTK2/src/queryDialog_glade.cc:181
+#: UI/GTK2/src/queryDialog_glade.cc:90
+msgid "Sort order:"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog_glade.cc:192
 msgid "Query parameters"
 msgstr "Parametres de la recherche"
 
@@ -753,124 +805,124 @@
 msgid "Extract"
 msgstr "Extrait"
 
-#: UI/GTK2/src/statisticsDialog.cc:72
+#: UI/GTK2/src/statisticsDialog.cc:73
 msgid "Indexes"
 msgstr "Indexes"
 
-#: UI/GTK2/src/statisticsDialog.cc:87
-msgid "History"
-msgstr "Historique"
-
-#: UI/GTK2/src/statisticsDialog.cc:92
+#: UI/GTK2/src/statisticsDialog.cc:93
 msgid "Daemon"
 msgstr "Daemon"
 
-#: UI/GTK2/src/statisticsDialog.cc:128 UI/GTK2/src/statisticsDialog.cc:143
+#: UI/GTK2/src/statisticsDialog.cc:128 UI/GTK2/src/statisticsDialog.cc:144
 msgid "documents"
 msgstr "documents"
 
-#: UI/GTK2/src/statisticsDialog.cc:132 UI/GTK2/src/statisticsDialog.cc:147
+#: UI/GTK2/src/statisticsDialog.cc:134 UI/GTK2/src/statisticsDialog.cc:150
+#: UI/GTK2/src/WorkerThreads.cpp:126
 msgid "Unknown error"
 msgstr "Erreur inconnue"
 
-#: UI/GTK2/src/statisticsDialog.cc:154
+#: UI/GTK2/src/statisticsDialog.cc:157
 msgid "Viewed"
 msgstr "Visualise"
 
-#: UI/GTK2/src/statisticsDialog.cc:154
+#: UI/GTK2/src/statisticsDialog.cc:157
 msgid "results"
 msgstr "resultats"
 
 #. FIXME: check whether it's actually running !
-#: UI/GTK2/src/statisticsDialog.cc:171
+#: UI/GTK2/src/statisticsDialog.cc:174
 msgid "Running under PID"
 msgstr "PID"
 
-#: UI/GTK2/src/statisticsDialog.cc:175
+#: UI/GTK2/src/statisticsDialog.cc:178
 msgid "Currently not running"
 msgstr "Arrete"
 
-#: UI/GTK2/src/statisticsDialog.cc:182
+#: UI/GTK2/src/statisticsDialog.cc:185
 msgid "Crawled"
 msgstr "Parcouru"
 
-#: UI/GTK2/src/statisticsDialog.cc:182
+#: UI/GTK2/src/statisticsDialog.cc:185
 msgid "files"
 msgstr "fichiers"
 
-#: UI/GTK2/src/statisticsDialog.cc:205
+#: UI/GTK2/src/statisticsDialog.cc:206
 msgid "Errors"
 msgstr "Erreurs"
 
-#: UI/GTK2/src/WorkerThreads.cpp:307
-msgid "Can't index mail here"
-msgstr "Ne peut pas indexer le courrier ici"
+#: UI/GTK2/src/WorkerThreads.cpp:93
+msgid "Index error"
+msgstr "Erreur sur l'index"
 
-#: UI/GTK2/src/WorkerThreads.cpp:328 UI/GTK2/src/WorkerThreads.cpp:581
-msgid "is already being indexed"
-msgstr "est deja indexe"
+#: UI/GTK2/src/WorkerThreads.cpp:95
+msgid "Couldn't index document"
+msgstr "N'a pas pu indexer le document"
 
-#: UI/GTK2/src/WorkerThreads.cpp:338
-msgid "is blacklisted"
-msgstr "est exclus"
+#: UI/GTK2/src/WorkerThreads.cpp:97
+msgid "Couldn't update document"
+msgstr "N'a pas pu mettre a jour le document"
 
-#: UI/GTK2/src/WorkerThreads.cpp:691 UI/GTK2/src/WorkerThreads.cpp:1051
-#: UI/GTK2/src/WorkerThreads.cpp:1135 UI/GTK2/src/WorkerThreads.cpp:1144
-#: UI/GTK2/src/WorkerThreads.cpp:1330 UI/GTK2/src/WorkerThreads.cpp:1600
-#: UI/GTK2/src/WorkerThreads.cpp:1733
-msgid "Index error on"
-msgstr "Erreur sur l'index"
+#: UI/GTK2/src/WorkerThreads.cpp:99
+msgid "Couldn't unindex document(s)"
+msgstr "N'a pas pu desindexer le(s) document(s)"
 
-#: UI/GTK2/src/WorkerThreads.cpp:844
-msgid "No title"
-msgstr "Pas de titre"
-
-#: UI/GTK2/src/WorkerThreads.cpp:946 UI/GTK2/src/WorkerThreads.cpp:1072
-msgid "Couldn't create search engine"
-msgstr "N'a pas pu creer le moteur"
-
-#: UI/GTK2/src/WorkerThreads.cpp:970 UI/GTK2/src/WorkerThreads.cpp:1085
+#: UI/GTK2/src/WorkerThreads.cpp:101
 msgid "Couldn't run query on search engine"
 msgstr "N'a pas pu lancer la recherche sur le moteur"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1238
-msgid "Couldn't obtain downloader for protocol"
-msgstr "N'a pas pu obtenir un brouteur pour"
+#: UI/GTK2/src/WorkerThreads.cpp:103
+msgid "Couldn't get history for search engine"
+msgstr "N'a pas pu obtenir l'historique de la recherche"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1263
-msgid "Couldn't retrieve"
-msgstr "N'a pas pu telecharger"
+#: UI/GTK2/src/WorkerThreads.cpp:105
+msgid "Couldn't retrieve document"
+msgstr "N'a pas pu telecharger le document"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1360 UI/GTK2/src/WorkerThreads.cpp:1439
+#: UI/GTK2/src/WorkerThreads.cpp:107
+msgid "Couldn't initialize file monitor"
+msgstr "N'a pas pu initialiser le moniteur de fichiers"
+
+#: UI/GTK2/src/WorkerThreads.cpp:109
+msgid "Couldn't open directory"
+msgstr "N'a pas pu ouvrir le repertoire"
+
+#: UI/GTK2/src/WorkerThreads.cpp:111
+msgid "Index doesn't exist"
+msgstr "L'index n'existe pas"
+
+#: UI/GTK2/src/WorkerThreads.cpp:113
+msgid "Couldn't create search engine"
+msgstr "N'a pas pu creer le moteur"
+
+#: UI/GTK2/src/WorkerThreads.cpp:115
 msgid "Cannot index document type"
 msgstr "Impossible d'indexer ce type de documents"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1364 UI/GTK2/src/WorkerThreads.cpp:1443
-msgid "at"
-msgstr "a"
+#: UI/GTK2/src/WorkerThreads.cpp:117
+msgid "No downloader for this protocol"
+msgstr "Pas de brouteur pour ce protocole"
 
-#. No, it isn't
-#: UI/GTK2/src/WorkerThreads.cpp:1475
+#: UI/GTK2/src/WorkerThreads.cpp:119
 msgid "Robots META tag forbids indexing"
 msgstr "Le META tag Robots interdit d'indexer"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1529
-msgid "Couldn't index"
-msgstr "N'a pas pu indexer"
+#: UI/GTK2/src/WorkerThreads.cpp:121
+msgid "No monitoring handler"
+msgstr "Pas de moniteur de fichiers disponible"
 
-#. Be pessimistic and assume something will go wrong ;-)
-#: UI/GTK2/src/WorkerThreads.cpp:1611
-msgid "Couldn't unindex document(s)"
-msgstr "N'a pas pu desindexer le(s) document(s)"
+#: UI/GTK2/src/WorkerThreads.cpp:391
+msgid "Can't index mail here"
+msgstr "Ne peut pas indexer le courrier ici"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1745
-msgid "Couldn't update document"
-msgstr "N'a pas pu mettre a jour le document"
+#: UI/GTK2/src/WorkerThreads.cpp:412 UI/GTK2/src/WorkerThreads.cpp:666
+msgid "is already being indexed"
+msgstr "est deja indexe"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1981
-msgid "No monitoring handler"
-msgstr "Pas de moniteur de fichiers disponible"
+#: UI/GTK2/src/WorkerThreads.cpp:422
+msgid "is blacklisted"
+msgstr "est exclus"
 
-#: UI/GTK2/src/WorkerThreads.cpp:2023
-msgid "Couldn't initialize file monitor"
-msgstr "N'a pas pu initialiser le moniteur de fichiers"
+#: UI/GTK2/src/WorkerThreads.cpp:935
+msgid "No title"
+msgstr "Pas de titre"

Modified: trunk/po/it.po
===================================================================
--- trunk/po/it.po	2007-10-27 03:47:11 UTC (rev 1076)
+++ trunk/po/it.po	2007-10-27 12:57:33 UTC (rev 1077)
@@ -6,7 +6,7 @@
 msgstr ""
 "Project-Id-Version: pinot 0.75\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2007-09-23 19:22+0800\n"
+"POT-Creation-Date: 2007-10-27 00:15+0800\n"
 "PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
 "Last-Translator: Marco Bazzani <visitors at libero.it>\n"
 "Language-Team: Italian <it at li.org>\n"
@@ -27,22 +27,22 @@
 #. Enable these menu items unless it is not the documents index
 #. Allow this only for internal indexes
 #. Internal indices
-#: UI/GTK2/src/EnginesTree.cpp:337 UI/GTK2/src/mainWindow.cc:677
-#: UI/GTK2/src/mainWindow.cc:1187 UI/GTK2/src/mainWindow.cc:1339
-#: UI/GTK2/src/mainWindow.cc:1381 UI/GTK2/src/mainWindow.cc:1403
-#: UI/GTK2/src/mainWindow.cc:1434 UI/GTK2/src/mainWindow.cc:2045
-#: UI/GTK2/src/mainWindow.cc:2157 UI/GTK2/src/PinotSettings.cpp:311
-#: UI/GTK2/src/PinotSettings.cpp:1387 UI/GTK2/src/PinotSettings.cpp:1443
-#: UI/GTK2/src/statisticsDialog.cc:77 UI/GTK2/src/WorkerThreads.cpp:822
-#: UI/GTK2/src/WorkerThreads.cpp:881
+#: UI/GTK2/src/EnginesTree.cpp:337 UI/GTK2/src/mainWindow.cc:795
+#: UI/GTK2/src/mainWindow.cc:1017 UI/GTK2/src/mainWindow.cc:1354
+#: UI/GTK2/src/mainWindow.cc:1509 UI/GTK2/src/mainWindow.cc:1551
+#: UI/GTK2/src/mainWindow.cc:1573 UI/GTK2/src/mainWindow.cc:2177
+#: UI/GTK2/src/mainWindow.cc:2287 UI/GTK2/src/PinotSettings.cpp:311
+#: UI/GTK2/src/PinotSettings.cpp:1421 UI/GTK2/src/PinotSettings.cpp:1477
+#: UI/GTK2/src/statisticsDialog.cc:78 UI/GTK2/src/WorkerThreads.cpp:972
 msgid "My Web Pages"
 msgstr "Pagine web personali"
 
-#: UI/GTK2/src/EnginesTree.cpp:338 UI/GTK2/src/mainWindow.cc:680
-#: UI/GTK2/src/mainWindow.cc:1194 UI/GTK2/src/mainWindow.cc:2158
-#: UI/GTK2/src/PinotSettings.cpp:312 UI/GTK2/src/PinotSettings.cpp:1388
-#: UI/GTK2/src/PinotSettings.cpp:1444 UI/GTK2/src/statisticsDialog.cc:82
-#: UI/GTK2/src/WorkerThreads.cpp:827 UI/GTK2/src/WorkerThreads.cpp:891
+#. Spawn new threads
+#: UI/GTK2/src/EnginesTree.cpp:338 UI/GTK2/src/mainWindow.cc:798
+#: UI/GTK2/src/mainWindow.cc:1011 UI/GTK2/src/mainWindow.cc:1361
+#: UI/GTK2/src/mainWindow.cc:2291 UI/GTK2/src/PinotSettings.cpp:312
+#: UI/GTK2/src/PinotSettings.cpp:1422 UI/GTK2/src/PinotSettings.cpp:1478
+#: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:982
 msgid "My Documents"
 msgstr "Documenti personali"
 
@@ -86,12 +86,13 @@
 msgid "External index"
 msgstr "Indice esterno"
 
-#: UI/GTK2/src/importDialog.cc:87 UI/GTK2/src/queryDialog.cc:95
+#. Labels
+#: UI/GTK2/src/importDialog.cc:87 UI/GTK2/src/queryDialog.cc:123
 msgid "None"
 msgstr "Nessuno"
 
 #: UI/GTK2/src/importDialog_glade.cc:68
-#: UI/GTK2/src/propertiesDialog_glade.cc:67
+#: UI/GTK2/src/propertiesDialog_glade.cc:64
 msgid "Title:"
 msgstr "Titolo:"
 
@@ -103,7 +104,7 @@
 msgid "Import"
 msgstr "Importare"
 
-#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:221
+#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:216
 msgid "Import URL"
 msgstr "Importa URL"
 
@@ -135,397 +136,430 @@
 msgid "Helper application"
 msgstr "Applicazione associata"
 
-#: UI/GTK2/src/mainWindow.cc:211
+#: UI/GTK2/src/mainWindow.cc:212
 msgid "Query Name"
 msgstr "Nome da interrogare"
 
-#: UI/GTK2/src/mainWindow.cc:216
+#: UI/GTK2/src/mainWindow.cc:217
 msgid "Last Run"
 msgstr "Ultimo Eseguito"
 
-#: UI/GTK2/src/mainWindow.cc:221
+#: UI/GTK2/src/mainWindow.cc:222
 msgid "Summary"
 msgstr "Sommario"
 
 #. Set tooltips
-#: UI/GTK2/src/mainWindow.cc:255
+#: UI/GTK2/src/mainWindow.cc:252
 msgid "Show all search engines"
 msgstr "Mostrare tutti i motori di ricerca"
 
-#: UI/GTK2/src/mainWindow.cc:256
-msgid "Add index"
+#: UI/GTK2/src/mainWindow.cc:253
+msgid "Find documents that match the query string"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:254
+#, fuzzy
+msgid "Add an index"
 msgstr "Aggiungi Indice"
 
-#: UI/GTK2/src/mainWindow.cc:257
-msgid "Remove index"
+#: UI/GTK2/src/mainWindow.cc:255
+#, fuzzy
+msgid "Remove an index"
 msgstr "Rimuovi indice"
 
+#: UI/GTK2/src/mainWindow.cc:256
+#, fuzzy
+msgid "Add a query"
+msgstr "Nuova query aggiunto"
+
+#: UI/GTK2/src/mainWindow.cc:257
+#, fuzzy
+msgid "Remove a query"
+msgstr "Live Query"
+
+#: UI/GTK2/src/mainWindow.cc:258
+msgid "Show the query's previous results"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:259
+msgid "Find documents that match the query"
+msgstr ""
+
 #. Now we are ready
-#: UI/GTK2/src/mainWindow.cc:282
+#: UI/GTK2/src/mainWindow.cc:289
 msgid "Ready"
 msgstr "Pronto"
 
-#: UI/GTK2/src/mainWindow.cc:342
+#: UI/GTK2/src/mainWindow.cc:349
 msgid "N/A"
 msgstr "N/D"
 
-#: UI/GTK2/src/mainWindow.cc:357
+#: UI/GTK2/src/mainWindow.cc:364
 msgid "Undefined"
 msgstr "Non Definito"
 
+#. Find this query
+#: UI/GTK2/src/mainWindow.cc:587 UI/GTK2/src/mainWindow.cc:2675
+msgid "Live query"
+msgstr "Live Query"
+
 #. Show the URL of the first result in the status bar
-#: UI/GTK2/src/mainWindow.cc:611
+#: UI/GTK2/src/mainWindow.cc:727
 msgid "Result location is"
 msgstr "la posizione del risultato ?"
 
 #. Show the URL in the status bar
-#: UI/GTK2/src/mainWindow.cc:691
+#: UI/GTK2/src/mainWindow.cc:809
 msgid "Document location is"
 msgstr "La posizione Documento ?"
 
-#: UI/GTK2/src/mainWindow.cc:1024
+#: UI/GTK2/src/mainWindow.cc:993 UI/GTK2/src/mainWindow.cc:2109
+msgid "Couldn't find query"
+msgstr "Impossibile trovare la query"
+
+#: UI/GTK2/src/mainWindow.cc:1008
+#, fuzzy
+msgid "In Results"
+msgstr "risultati"
+
+#: UI/GTK2/src/mainWindow.cc:1191
 msgid "Showing"
 msgstr "Mostrando"
 
-#: UI/GTK2/src/mainWindow.cc:1029
+#: UI/GTK2/src/mainWindow.cc:1196
 msgid "of"
 msgstr "dei"
 
-#: UI/GTK2/src/mainWindow.cc:1034
+#: UI/GTK2/src/mainWindow.cc:1201
 msgid "documents, starting at"
 msgstr "documenti, inizio a"
 
-#: UI/GTK2/src/mainWindow.cc:1068
+#: UI/GTK2/src/mainWindow.cc:1235
 msgid "Query"
 msgstr "Richiesta"
 
-#: UI/GTK2/src/mainWindow.cc:1072 UI/GTK2/src/mainWindow.cc:3177
+#: UI/GTK2/src/mainWindow.cc:1239 UI/GTK2/src/mainWindow.cc:3268
 msgid "on"
 msgstr "sulla"
 
-#: UI/GTK2/src/mainWindow.cc:1076
+#: UI/GTK2/src/mainWindow.cc:1243
 msgid "ended"
 msgstr "conclusione"
 
-#: UI/GTK2/src/mainWindow.cc:1137
+#: UI/GTK2/src/mainWindow.cc:1304
 msgid "Corrected"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:1223
+#: UI/GTK2/src/mainWindow.cc:1393
 msgid "More Like"
 msgstr "Molti gradiscono"
 
-#: UI/GTK2/src/mainWindow.cc:1265
+#: UI/GTK2/src/mainWindow.cc:1435
 msgid "Updated label(s)"
 msgstr "Descrizione(i) aggiornata"
 
 #. Yes, it did
-#: UI/GTK2/src/mainWindow.cc:1349
+#: UI/GTK2/src/mainWindow.cc:1519 UI/GTK2/src/mainWindow.cc:1613
 msgid "Updated document"
 msgstr "Documento aggiornato"
 
-#: UI/GTK2/src/mainWindow.cc:1362
+#: UI/GTK2/src/mainWindow.cc:1532
 msgid "Indexed"
 msgstr "Indicizzato"
 
-#: UI/GTK2/src/mainWindow.cc:1404
+#: UI/GTK2/src/mainWindow.cc:1574
 msgid "Unindexed document(s)"
 msgstr "Documento/i non Indicizzato/i"
 
-#: UI/GTK2/src/mainWindow.cc:1444
-msgid "Updated document properties"
-msgstr "Propriet? documento aggiornata"
-
-#: UI/GTK2/src/mainWindow.cc:1497
+#: UI/GTK2/src/mainWindow.cc:1671
 msgid "Couldn't rename index, name"
 msgstr "Impossibile rinominare l'indice, nome"
 
-#: UI/GTK2/src/mainWindow.cc:1501 UI/GTK2/src/mainWindow.cc:2441
-#: UI/GTK2/src/mainWindow.cc:2982
+#: UI/GTK2/src/mainWindow.cc:1675 UI/GTK2/src/mainWindow.cc:2501
+#: UI/GTK2/src/mainWindow.cc:3072
 msgid "is already in use"
 msgstr "? gi? in uso"
 
-#: UI/GTK2/src/mainWindow.cc:1514
+#: UI/GTK2/src/mainWindow.cc:1688
 msgid "Couldn't rename index"
 msgstr "Impossibile rinominare l'indice"
 
-#: UI/GTK2/src/mainWindow.cc:1527
+#: UI/GTK2/src/mainWindow.cc:1701
 msgid "Edited index"
 msgstr "Indice modificato"
 
-#: UI/GTK2/src/mainWindow.cc:1853
+#: UI/GTK2/src/mainWindow.cc:2029
 #, fuzzy
 msgid "Export Results"
 msgstr "risultati"
 
-#. Find this query
-#: UI/GTK2/src/mainWindow.cc:1942 UI/GTK2/src/mainWindow.cc:2615
-msgid "Live query"
-msgstr "Live Query"
-
-#: UI/GTK2/src/mainWindow.cc:1968
-msgid "Couldn't find query"
-msgstr "Impossibile trovare la query"
-
-#: UI/GTK2/src/mainWindow.cc:2167 UI/GTK2/src/WorkerThreads.cpp:678
-#: UI/GTK2/src/WorkerThreads.cpp:1720
+#: UI/GTK2/src/mainWindow.cc:2304
 msgid "Index"
 msgstr "Indice"
 
-#: UI/GTK2/src/mainWindow.cc:2171 UI/GTK2/src/WorkerThreads.cpp:682
-#: UI/GTK2/src/WorkerThreads.cpp:1724
+#: UI/GTK2/src/mainWindow.cc:2308
 msgid "doesn't exist"
 msgstr "non esiste"
 
-#: UI/GTK2/src/mainWindow.cc:2326
+#: UI/GTK2/src/mainWindow.cc:2386
 msgid "Remove this document from the index ?"
 msgstr "Rimuovere questo documento dall'indice?"
 
-#: UI/GTK2/src/mainWindow.cc:2345
+#: UI/GTK2/src/mainWindow.cc:2405
 msgid "Remove these documents from the index ?"
 msgstr "Rimuovere questi documenti dall'indice?"
 
-#: UI/GTK2/src/mainWindow.cc:2391
+#: UI/GTK2/src/mainWindow.cc:2451
 msgid "A metasearch tool for the Free Desktop"
 msgstr "Un tool di ricerca per il Desktop Libero"
 
-#: UI/GTK2/src/mainWindow.cc:2392
+#: UI/GTK2/src/mainWindow.cc:2452
 msgid "Search the Web and your documents !"
 msgstr "Cerca nel Web e nei documenti !"
 
-#: UI/GTK2/src/mainWindow.cc:2437
+#: UI/GTK2/src/mainWindow.cc:2497
 msgid "Index name"
 msgstr "Nome indice"
 
-#: UI/GTK2/src/mainWindow.cc:2452
+#: UI/GTK2/src/mainWindow.cc:2512
 msgid "Couldn't add index"
 msgstr "Impossibile aggiungere l'indice"
 
-#: UI/GTK2/src/mainWindow.cc:2468
+#: UI/GTK2/src/mainWindow.cc:2528
 msgid "Added new index"
 msgstr "Nuovo indice aggiunto"
 
-#: UI/GTK2/src/mainWindow.cc:2503
+#: UI/GTK2/src/mainWindow.cc:2563
 msgid "Couldn't remove index"
 msgstr "Impossibile rimuovere l'indice"
 
-#: UI/GTK2/src/mainWindow.cc:2795
+#: UI/GTK2/src/mainWindow.cc:2768
+msgid "No history for"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:2884
 msgid "At least one task hasn't completed yet. Quit now ?"
 msgstr "Nessuna operazione completata. Uscire comunque ?"
 
-#: UI/GTK2/src/mainWindow.cc:2978
+#: UI/GTK2/src/mainWindow.cc:3068
 msgid "Query name"
 msgstr "Nome Query"
 
-#: UI/GTK2/src/mainWindow.cc:3005
+#: UI/GTK2/src/mainWindow.cc:3095
 msgid "Couldn't update query"
 msgstr "Impossibile aggiornare la query"
 
-#: UI/GTK2/src/mainWindow.cc:3013
+#: UI/GTK2/src/mainWindow.cc:3103
 msgid "Edited query"
 msgstr "Query modificata"
 
-#: UI/GTK2/src/mainWindow.cc:3020
+#: UI/GTK2/src/mainWindow.cc:3110
 msgid "Couldn't add query"
 msgstr "Impossibile aggiungere la query"
 
-#: UI/GTK2/src/mainWindow.cc:3028
+#: UI/GTK2/src/mainWindow.cc:3118
 msgid "Added new query"
 msgstr "Nuova query aggiunto"
 
-#: UI/GTK2/src/mainWindow.cc:3066
+#: UI/GTK2/src/mainWindow.cc:3157
 msgid "Query is not set"
 msgstr "Query non configurata"
 
-#: UI/GTK2/src/mainWindow.cc:3077
+#: UI/GTK2/src/mainWindow.cc:3168
 msgid "No search engine selected"
 msgstr "Nessun motore di ricerca selezionato"
 
-#: UI/GTK2/src/mainWindow.cc:3164
+#: UI/GTK2/src/mainWindow.cc:3255
 msgid "Please set the Google API key first"
 msgstr "Prima inserisci la tua Google API key"
 
-#: UI/GTK2/src/mainWindow.cc:3173
+#: UI/GTK2/src/mainWindow.cc:3264
 msgid "Running query"
 msgstr "Query in esecuzione"
 
-#: UI/GTK2/src/mainWindow.cc:3382
+#: UI/GTK2/src/mainWindow.cc:3473
 msgid "No default application defined for type"
 msgstr "Nessuna applicazione di default ? stata definita per tipo"
 
-#: UI/GTK2/src/mainWindow_glade.cc:126
+#: UI/GTK2/src/mainWindow_glade.cc:127
 msgid "Query:"
 msgstr "Query:"
 
-#: UI/GTK2/src/mainWindow_glade.cc:138
-msgid "Edit"
-msgstr "Modifica"
+#: UI/GTK2/src/mainWindow_glade.cc:138 UI/GTK2/src/statisticsDialog.cc:88
+msgid "History"
+msgstr "Cronologia"
 
-#: UI/GTK2/src/mainWindow_glade.cc:147
+#: UI/GTK2/src/mainWindow_glade.cc:143
 msgid "Stored queries"
 msgstr "Queries conservati"
 
-#: UI/GTK2/src/mainWindow_glade.cc:164 UI/GTK2/src/statisticsDialog.cc:50
+#: UI/GTK2/src/mainWindow_glade.cc:156 UI/GTK2/src/statisticsDialog.cc:51
 #: UI/GTK2/src/statisticsDialog_glade.cc:87
 msgid "Status"
 msgstr "Stato"
 
-#: UI/GTK2/src/mainWindow_glade.cc:185
+#: UI/GTK2/src/mainWindow_glade.cc:177
 msgid "Search Engine"
 msgstr "Motore di ricerca"
 
-#: UI/GTK2/src/mainWindow_glade.cc:188
+#: UI/GTK2/src/mainWindow_glade.cc:180
 msgid "Host Name"
 msgstr "Nome Host"
 
-#: UI/GTK2/src/mainWindow_glade.cc:191
+#: UI/GTK2/src/mainWindow_glade.cc:183
 msgid "Show Extract"
 msgstr "Mostrare un estratto"
 
-#: UI/GTK2/src/mainWindow_glade.cc:194
+#: UI/GTK2/src/mainWindow_glade.cc:186
 msgid "Group By"
 msgstr "Raggruppa Per"
 
-#: UI/GTK2/src/mainWindow_glade.cc:200
+#: UI/GTK2/src/mainWindow_glade.cc:192
 msgid "Clear List"
 msgstr "Pulisci llista"
 
-#: UI/GTK2/src/mainWindow_glade.cc:206
+#: UI/GTK2/src/mainWindow_glade.cc:198
 msgid "Vie_w"
 msgstr "Visualizza"
 
-#: UI/GTK2/src/mainWindow_glade.cc:209
+#: UI/GTK2/src/mainWindow_glade.cc:201
 msgid "View Cache"
 msgstr "Guarda Cache"
 
-#: UI/GTK2/src/mainWindow_glade.cc:212
+#: UI/GTK2/src/mainWindow_glade.cc:204
 msgid "More Like This"
 msgstr "Altri risultati"
 
-#: UI/GTK2/src/mainWindow_glade.cc:215 UI/GTK2/src/mainWindow_glade.cc:251
+#: UI/GTK2/src/mainWindow_glade.cc:207
+#, fuzzy
+msgid "Search This For"
+msgstr "Motori di ricerca"
+
+#: UI/GTK2/src/mainWindow_glade.cc:210 UI/GTK2/src/mainWindow_glade.cc:246
 msgid "_Index"
 msgstr "_Indice"
 
-#: UI/GTK2/src/mainWindow_glade.cc:218
+#: UI/GTK2/src/mainWindow_glade.cc:213
 msgid "List Contents Of"
 msgstr "Lista contenuti di"
 
-#: UI/GTK2/src/mainWindow_glade.cc:227
+#: UI/GTK2/src/mainWindow_glade.cc:222
 msgid "View"
 msgstr "Vedi"
 
-#: UI/GTK2/src/mainWindow_glade.cc:230
+#: UI/GTK2/src/mainWindow_glade.cc:225
 msgid "Update"
 msgstr "Aggiorna"
 
-#: UI/GTK2/src/mainWindow_glade.cc:233
+#: UI/GTK2/src/mainWindow_glade.cc:228
 msgid "Unindex"
 msgstr "Rimuovi dall'indice"
 
-#: UI/GTK2/src/mainWindow_glade.cc:236
-#: UI/GTK2/src/propertiesDialog_glade.cc:177
+#: UI/GTK2/src/mainWindow_glade.cc:231
+#: UI/GTK2/src/propertiesDialog_glade.cc:225
 msgid "Properties"
 msgstr "Propriet?"
 
-#: UI/GTK2/src/mainWindow_glade.cc:239
+#: UI/GTK2/src/mainWindow_glade.cc:234
 msgid "_About"
 msgstr "_About"
 
-#: UI/GTK2/src/mainWindow_glade.cc:242
+#: UI/GTK2/src/mainWindow_glade.cc:237
 msgid "_Session"
 msgstr "_Sessione"
 
-#: UI/GTK2/src/mainWindow_glade.cc:245
+#: UI/GTK2/src/mainWindow_glade.cc:240
 msgid "_Edit"
 msgstr "_Modifica"
 
-#: UI/GTK2/src/mainWindow_glade.cc:248
+#: UI/GTK2/src/mainWindow_glade.cc:243
 msgid "_Results"
 msgstr "_Risultati"
 
-#: UI/GTK2/src/mainWindow_glade.cc:254
+#: UI/GTK2/src/mainWindow_glade.cc:249
 msgid "_Help"
 msgstr "_Aiuto"
 
-#: UI/GTK2/src/mainWindow_glade.cc:403
+#: UI/GTK2/src/mainWindow_glade.cc:378
 msgid "Pinot"
 msgstr "Pinot"
 
 #. Localize language names
-#: UI/GTK2/src/pinot.cc:249 UI/GTK2/src/pinot-dbus-daemon.cc:324
-#: UI/GTK2/src/propertiesDialog.cc:72 UI/GTK2/src/propertiesDialog.cc:81
+#: UI/GTK2/src/pinot.cc:233 UI/GTK2/src/pinot-dbus-daemon.cc:312
+#: UI/GTK2/src/propertiesDialog.cc:97
 msgid "Unknown"
 msgstr "Sconosciuto"
 
-#: UI/GTK2/src/pinot.cc:250 UI/GTK2/src/pinot-dbus-daemon.cc:325
+#: UI/GTK2/src/pinot.cc:234 UI/GTK2/src/pinot-dbus-daemon.cc:313
 msgid "Danish"
 msgstr "Danese"
 
-#: UI/GTK2/src/pinot.cc:251 UI/GTK2/src/pinot-dbus-daemon.cc:326
+#: UI/GTK2/src/pinot.cc:235 UI/GTK2/src/pinot-dbus-daemon.cc:314
 msgid "Dutch"
 msgstr "Olandese"
 
-#: UI/GTK2/src/pinot.cc:252 UI/GTK2/src/pinot-dbus-daemon.cc:327
+#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:315
 msgid "English"
 msgstr "Inglese"
 
-#: UI/GTK2/src/pinot.cc:253 UI/GTK2/src/pinot-dbus-daemon.cc:328
+#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:316
 msgid "Finnish"
 msgstr "Finlandese"
 
-#: UI/GTK2/src/pinot.cc:254 UI/GTK2/src/pinot-dbus-daemon.cc:329
+#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:317
 msgid "French"
 msgstr "Francese"
 
-#: UI/GTK2/src/pinot.cc:255 UI/GTK2/src/pinot-dbus-daemon.cc:330
+#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:318
 msgid "German"
 msgstr "Tedesco"
 
-#: UI/GTK2/src/pinot.cc:256 UI/GTK2/src/pinot-dbus-daemon.cc:331
+#: UI/GTK2/src/pinot.cc:240 UI/GTK2/src/pinot-dbus-daemon.cc:319
 msgid "Hungarian"
 msgstr ""
 
-#: UI/GTK2/src/pinot.cc:257 UI/GTK2/src/pinot-dbus-daemon.cc:332
+#: UI/GTK2/src/pinot.cc:241 UI/GTK2/src/pinot-dbus-daemon.cc:320
 msgid "Italian"
 msgstr "Italiano"
 
-#: UI/GTK2/src/pinot.cc:258 UI/GTK2/src/pinot-dbus-daemon.cc:333
+#: UI/GTK2/src/pinot.cc:242 UI/GTK2/src/pinot-dbus-daemon.cc:321
 msgid "Norwegian"
 msgstr "Norvegese"
 
-#: UI/GTK2/src/pinot.cc:259 UI/GTK2/src/pinot-dbus-daemon.cc:334
+#: UI/GTK2/src/pinot.cc:243 UI/GTK2/src/pinot-dbus-daemon.cc:322
 msgid "Portuguese"
 msgstr "Portoghese"
 
-#: UI/GTK2/src/pinot.cc:260 UI/GTK2/src/pinot-dbus-daemon.cc:335
+#: UI/GTK2/src/pinot.cc:244 UI/GTK2/src/pinot-dbus-daemon.cc:323
 msgid "Romanian"
 msgstr ""
 
-#: UI/GTK2/src/pinot.cc:261 UI/GTK2/src/pinot-dbus-daemon.cc:336
+#: UI/GTK2/src/pinot.cc:245 UI/GTK2/src/pinot-dbus-daemon.cc:324
 msgid "Russian"
 msgstr "Russo"
 
-#: UI/GTK2/src/pinot.cc:262 UI/GTK2/src/pinot-dbus-daemon.cc:337
+#: UI/GTK2/src/pinot.cc:246 UI/GTK2/src/pinot-dbus-daemon.cc:325
 msgid "Spanish"
 msgstr "Spagnolo"
 
-#: UI/GTK2/src/pinot.cc:263 UI/GTK2/src/pinot-dbus-daemon.cc:338
+#: UI/GTK2/src/pinot.cc:247 UI/GTK2/src/pinot-dbus-daemon.cc:326
 msgid "Swedish"
 msgstr "Svedese"
 
-#: UI/GTK2/src/pinot.cc:264 UI/GTK2/src/pinot-dbus-daemon.cc:339
+#: UI/GTK2/src/pinot.cc:248 UI/GTK2/src/pinot-dbus-daemon.cc:327
 msgid "Turkish"
 msgstr ""
 
-#: UI/GTK2/src/pinot.cc:289
+#: UI/GTK2/src/pinot.cc:273
 msgid "Couldn't open index"
 msgstr "Impossibile aprire l'indice"
 
-#: UI/GTK2/src/pinot.cc:310
+#: UI/GTK2/src/pinot.cc:294
 msgid "Couldn't create history database"
 msgstr "Impossibile creare una cronologia del database"
 
-#: UI/GTK2/src/pinot.cc:336
+#. Warn the user
+#: UI/GTK2/src/pinot.cc:330
 msgid "Updating all documents in My Web Pages is recommended"
 msgstr "E' consigliato aggiornare tutti le pagine web personali"
 
@@ -542,39 +576,43 @@
 msgid "Personal"
 msgstr "Personale"
 
-#: UI/GTK2/src/PinotSettings.cpp:1198
+#: UI/GTK2/src/PinotSettings.cpp:358
+msgid "Me"
+msgstr ""
+
+#: UI/GTK2/src/PinotSettings.cpp:1233
 msgid "Unclassified"
 msgstr "Non classificato"
 
-#: UI/GTK2/src/prefsDialog.cc:81
+#: UI/GTK2/src/prefsDialog.cc:83
 msgid "Name"
 msgstr "Nome"
 
-#: UI/GTK2/src/prefsDialog.cc:89
+#: UI/GTK2/src/prefsDialog.cc:91
 msgid "Monitor"
 msgstr "Monitor"
 
-#: UI/GTK2/src/prefsDialog.cc:90
+#: UI/GTK2/src/prefsDialog.cc:92
 msgid "Location"
 msgstr "Posizione"
 
-#: UI/GTK2/src/prefsDialog.cc:98
+#: UI/GTK2/src/prefsDialog.cc:100
 msgid "Pattern"
 msgstr "Espressione"
 
-#: UI/GTK2/src/prefsDialog.cc:315
+#: UI/GTK2/src/prefsDialog.cc:357
 msgid "Exclude these patterns from indexing"
 msgstr ""
 
-#: UI/GTK2/src/prefsDialog.cc:316
+#: UI/GTK2/src/prefsDialog.cc:358
 msgid "Only index these patterns"
 msgstr ""
 
-#: UI/GTK2/src/prefsDialog.cc:406
+#: UI/GTK2/src/prefsDialog.cc:478
 msgid "New Label"
 msgstr "Nuova descrizione"
 
-#: UI/GTK2/src/prefsDialog.cc:447
+#: UI/GTK2/src/prefsDialog.cc:519
 msgid "Directory to index"
 msgstr "Directory da indicizzare"
 
@@ -631,7 +669,7 @@
 msgid "Remove"
 msgstr "Rimuovi"
 
-#: UI/GTK2/src/prefsDialog_glade.cc:113
+#: UI/GTK2/src/prefsDialog_glade.cc:113 UI/GTK2/src/propertiesDialog.cc:56
 msgid "Labels"
 msgstr "Descrizioni"
 
@@ -654,79 +692,98 @@
 msgid "Preferences"
 msgstr "Preferenze"
 
-#: UI/GTK2/src/propertiesDialog.cc:60 UI/GTK2/src/queryDialog.cc:124
-msgid "Label"
-msgstr "Descrizione"
-
-#: UI/GTK2/src/propertiesDialog.cc:93
+#: UI/GTK2/src/propertiesDialog.cc:110
 msgid "Per document"
 msgstr "Per documento"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:68
+#: UI/GTK2/src/propertiesDialog.cc:368
+#, fuzzy
+msgid "Export Terms"
+msgstr "risultati"
+
+#: UI/GTK2/src/propertiesDialog_glade.cc:65
 msgid "Language:"
 msgstr "Lingua:"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:69
+#: UI/GTK2/src/propertiesDialog_glade.cc:66
 msgid "MIME type:"
 msgstr "Tipo MIME:"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:70
+#: UI/GTK2/src/propertiesDialog_glade.cc:67
 msgid "Size:"
 msgstr "Dimesione"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:73
+#: UI/GTK2/src/propertiesDialog_glade.cc:68
 msgid "Terms:"
 msgstr "Termini:"
 
-#: UI/GTK2/src/queryDialog.cc:114
+#: UI/GTK2/src/propertiesDialog_glade.cc:78
+msgid "bytes"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog.cc:94
 msgid "Host name"
 msgstr "Nome host"
 
-#: UI/GTK2/src/queryDialog.cc:115
+#: UI/GTK2/src/queryDialog.cc:95
 msgid "File name"
 msgstr "Nome file"
 
-#: UI/GTK2/src/queryDialog.cc:118
+#: UI/GTK2/src/queryDialog.cc:96
 msgid "File extension"
 msgstr "Estensione file"
 
 #. This is the title column
-#: UI/GTK2/src/queryDialog.cc:119 UI/GTK2/src/ResultsTree.cpp:133
+#: UI/GTK2/src/queryDialog.cc:97 UI/GTK2/src/ResultsTree.cpp:133
 msgid "Title"
 msgstr "Titolo"
 
 #. URL
-#: UI/GTK2/src/queryDialog.cc:120 UI/GTK2/src/ResultsTree.cpp:143
+#: UI/GTK2/src/queryDialog.cc:98 UI/GTK2/src/ResultsTree.cpp:143
 msgid "URL"
 msgstr "URL"
 
-#: UI/GTK2/src/queryDialog.cc:121
+#: UI/GTK2/src/queryDialog.cc:99
 msgid "Directory"
 msgstr "Directory"
 
-#: UI/GTK2/src/queryDialog.cc:122
+#: UI/GTK2/src/queryDialog.cc:100
 msgid "Language code"
 msgstr "Codice di linguaggio"
 
-#: UI/GTK2/src/queryDialog.cc:123
+#: UI/GTK2/src/queryDialog.cc:101
 msgid "MIME type"
 msgstr "Tipo MIME"
 
+#: UI/GTK2/src/queryDialog.cc:102
+msgid "Label"
+msgstr "Descrizione"
+
 #. The last column is for the timestamp
-#: UI/GTK2/src/queryDialog.cc:127 UI/GTK2/src/ResultsTree.cpp:151
+#: UI/GTK2/src/queryDialog.cc:105 UI/GTK2/src/ResultsTree.cpp:151
 msgid "Date"
 msgstr "Data"
 
-#: UI/GTK2/src/queryDialog.cc:128
+#: UI/GTK2/src/queryDialog.cc:106
 #, fuzzy
 msgid "Time"
 msgstr "Titolo"
 
-#: UI/GTK2/src/queryDialog.cc:129
+#: UI/GTK2/src/queryDialog.cc:107
 #, fuzzy
 msgid "Size"
 msgstr "Dimesione"
 
+#. Sort order
+#: UI/GTK2/src/queryDialog.cc:111
+msgid "By relevance"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog.cc:112
+#, fuzzy
+msgid "By date"
+msgstr "Aggiorna"
+
 #: UI/GTK2/src/queryDialog_glade.cc:72
 #, fuzzy
 msgid "New filter or range:"
@@ -744,7 +801,11 @@
 msgid "Number of results:"
 msgstr "Numero di risultati:"
 
-#: UI/GTK2/src/queryDialog_glade.cc:181
+#: UI/GTK2/src/queryDialog_glade.cc:90
+msgid "Sort order:"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog_glade.cc:192
 msgid "Query parameters"
 msgstr "Parametri di Ricerca"
 
@@ -757,124 +818,131 @@
 msgid "Extract"
 msgstr "Estrai"
 
-#: UI/GTK2/src/statisticsDialog.cc:72
+#: UI/GTK2/src/statisticsDialog.cc:73
 msgid "Indexes"
 msgstr "Indici"
 
-#: UI/GTK2/src/statisticsDialog.cc:87
-msgid "History"
-msgstr "Cronologia"
-
-#: UI/GTK2/src/statisticsDialog.cc:92
+#: UI/GTK2/src/statisticsDialog.cc:93
 msgid "Daemon"
 msgstr "Demone"
 
-#: UI/GTK2/src/statisticsDialog.cc:128 UI/GTK2/src/statisticsDialog.cc:143
+#: UI/GTK2/src/statisticsDialog.cc:128 UI/GTK2/src/statisticsDialog.cc:144
 msgid "documents"
 msgstr "documenti"
 
-#: UI/GTK2/src/statisticsDialog.cc:132 UI/GTK2/src/statisticsDialog.cc:147
+#: UI/GTK2/src/statisticsDialog.cc:134 UI/GTK2/src/statisticsDialog.cc:150
+#: UI/GTK2/src/WorkerThreads.cpp:126
 msgid "Unknown error"
 msgstr "errore Sconosciuto"
 
-#: UI/GTK2/src/statisticsDialog.cc:154
+#: UI/GTK2/src/statisticsDialog.cc:157
 msgid "Viewed"
 msgstr "Visti"
 
-#: UI/GTK2/src/statisticsDialog.cc:154
+#: UI/GTK2/src/statisticsDialog.cc:157
 msgid "results"
 msgstr "risultati"
 
 #. FIXME: check whether it's actually running !
-#: UI/GTK2/src/statisticsDialog.cc:171
+#: UI/GTK2/src/statisticsDialog.cc:174
 msgid "Running under PID"
 msgstr "Avviato con PID"
 
-#: UI/GTK2/src/statisticsDialog.cc:175
+#: UI/GTK2/src/statisticsDialog.cc:178
 msgid "Currently not running"
 msgstr "Attualmente non in esecuzione"
 
-#: UI/GTK2/src/statisticsDialog.cc:182
+#: UI/GTK2/src/statisticsDialog.cc:185
 msgid "Crawled"
 msgstr "Analizzati"
 
-#: UI/GTK2/src/statisticsDialog.cc:182
+#: UI/GTK2/src/statisticsDialog.cc:185
 msgid "files"
 msgstr "files"
 
-#: UI/GTK2/src/statisticsDialog.cc:205
+#: UI/GTK2/src/statisticsDialog.cc:206
 msgid "Errors"
 msgstr "Errori"
 
-#: UI/GTK2/src/WorkerThreads.cpp:307
-msgid "Can't index mail here"
-msgstr "Impossibile indicizzare la mail qui"
+#: UI/GTK2/src/WorkerThreads.cpp:93
+#, fuzzy
+msgid "Index error"
+msgstr "Errori indice su"
 
-#: UI/GTK2/src/WorkerThreads.cpp:328 UI/GTK2/src/WorkerThreads.cpp:581
-msgid "is already being indexed"
-msgstr "? gia' stato indicizzato"
+#: UI/GTK2/src/WorkerThreads.cpp:95
+#, fuzzy
+msgid "Couldn't index document"
+msgstr "Impossiible rimuovere i(l) documento/i dall'indice"
 
-#: UI/GTK2/src/WorkerThreads.cpp:338
-msgid "is blacklisted"
-msgstr "e' blacklistato"
+#: UI/GTK2/src/WorkerThreads.cpp:97
+msgid "Couldn't update document"
+msgstr "Impossibile aggiornare il documento"
 
-#: UI/GTK2/src/WorkerThreads.cpp:691 UI/GTK2/src/WorkerThreads.cpp:1051
-#: UI/GTK2/src/WorkerThreads.cpp:1135 UI/GTK2/src/WorkerThreads.cpp:1144
-#: UI/GTK2/src/WorkerThreads.cpp:1330 UI/GTK2/src/WorkerThreads.cpp:1600
-#: UI/GTK2/src/WorkerThreads.cpp:1733
-msgid "Index error on"
-msgstr "Errori indice su"
+#: UI/GTK2/src/WorkerThreads.cpp:99
+msgid "Couldn't unindex document(s)"
+msgstr "Impossiible rimuovere i(l) documento/i dall'indice"
 
-#: UI/GTK2/src/WorkerThreads.cpp:844
-msgid "No title"
-msgstr "Nessun titolo"
-
-#: UI/GTK2/src/WorkerThreads.cpp:946 UI/GTK2/src/WorkerThreads.cpp:1072
-msgid "Couldn't create search engine"
-msgstr "Impossibile creare un motore di ricerca"
-
-#: UI/GTK2/src/WorkerThreads.cpp:970 UI/GTK2/src/WorkerThreads.cpp:1085
+#: UI/GTK2/src/WorkerThreads.cpp:101
 msgid "Couldn't run query on search engine"
 msgstr "Impossibile avviare un query sul motore di ricerca"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1238
-msgid "Couldn't obtain downloader for protocol"
-msgstr "Impossibile ottenere un downloader per il protocollo"
+#: UI/GTK2/src/WorkerThreads.cpp:103
+#, fuzzy
+msgid "Couldn't get history for search engine"
+msgstr "Impossibile avviare un query sul motore di ricerca"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1263
-msgid "Couldn't retrieve"
-msgstr "Impossibile recuperare"
+#: UI/GTK2/src/WorkerThreads.cpp:105
+#, fuzzy
+msgid "Couldn't retrieve document"
+msgstr "Impossibile aggiornare il documento"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1360 UI/GTK2/src/WorkerThreads.cpp:1439
+#: UI/GTK2/src/WorkerThreads.cpp:107
+msgid "Couldn't initialize file monitor"
+msgstr ""
+
+#: UI/GTK2/src/WorkerThreads.cpp:109
+#, fuzzy
+msgid "Couldn't open directory"
+msgstr "Impossibile aprire l'indice"
+
+#: UI/GTK2/src/WorkerThreads.cpp:111
+#, fuzzy
+msgid "Index doesn't exist"
+msgstr "non esiste"
+
+#: UI/GTK2/src/WorkerThreads.cpp:113
+msgid "Couldn't create search engine"
+msgstr "Impossibile creare un motore di ricerca"
+
+#: UI/GTK2/src/WorkerThreads.cpp:115
 msgid "Cannot index document type"
 msgstr "Impossibile indicizzare tipo di documento"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1364 UI/GTK2/src/WorkerThreads.cpp:1443
-msgid "at"
-msgstr "a"
+#: UI/GTK2/src/WorkerThreads.cpp:117
+#, fuzzy
+msgid "No downloader for this protocol"
+msgstr "Impossibile ottenere un downloader per il protocollo"
 
-#. No, it isn't
-#: UI/GTK2/src/WorkerThreads.cpp:1475
+#: UI/GTK2/src/WorkerThreads.cpp:119
 msgid "Robots META tag forbids indexing"
 msgstr "il Robots META tag vieta l'indicizzazione"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1529
-msgid "Couldn't index"
-msgstr "Impossibile indicizzare"
+#: UI/GTK2/src/WorkerThreads.cpp:121
+msgid "No monitoring handler"
+msgstr ""
 
-#. Be pessimistic and assume something will go wrong ;-)
-#: UI/GTK2/src/WorkerThreads.cpp:1611
-msgid "Couldn't unindex document(s)"
-msgstr "Impossiible rimuovere i(l) documento/i dall'indice"
+#: UI/GTK2/src/WorkerThreads.cpp:391
+msgid "Can't index mail here"
+msgstr "Impossibile indicizzare la mail qui"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1745
-msgid "Couldn't update document"
-msgstr "Impossibile aggiornare il documento"
+#: UI/GTK2/src/WorkerThreads.cpp:412 UI/GTK2/src/WorkerThreads.cpp:666
+msgid "is already being indexed"
+msgstr "? gia' stato indicizzato"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1981
-msgid "No monitoring handler"
-msgstr ""
+#: UI/GTK2/src/WorkerThreads.cpp:422
+msgid "is blacklisted"
+msgstr "e' blacklistato"
 
-#: UI/GTK2/src/WorkerThreads.cpp:2023
-msgid "Couldn't initialize file monitor"
-msgstr ""
+#: UI/GTK2/src/WorkerThreads.cpp:935
+msgid "No title"
+msgstr "Nessun titolo"

Modified: trunk/po/nl.po
===================================================================
--- trunk/po/nl.po	2007-10-27 03:47:11 UTC (rev 1076)
+++ trunk/po/nl.po	2007-10-27 12:57:33 UTC (rev 1077)
@@ -6,14 +6,14 @@
 msgstr ""
 "Project-Id-Version: pinot 0.75\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2007-09-23 19:22+0800\n"
-"PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
+"POT-Creation-Date: 2007-10-27 00:15+0800\n"
+"PO-Revision-Date: 2007-10-21 13:24+0000\n"
 "Last-Translator: JW <jw00000 at gmail.com>\n"
 "Language-Team: Dutch <nl at li.org>\n"
 "MIME-Version: 1.0\n"
 "Content-Type: text/plain; charset=UTF-8\n"
 "Content-Transfer-Encoding: 8bit\n"
-"X-Launchpad-Export-Date: 2007-09-23 13:58+0000\n"
+"X-Launchpad-Export-Date: 2007-10-25 17:19+0000\n"
 "X-Generator: Launchpad (build Unknown)\n"
 
 #: UI/GTK2/src/EnginesTree.cpp:68
@@ -27,22 +27,22 @@
 #. Enable these menu items unless it is not the documents index
 #. Allow this only for internal indexes
 #. Internal indices
-#: UI/GTK2/src/EnginesTree.cpp:337 UI/GTK2/src/mainWindow.cc:677
-#: UI/GTK2/src/mainWindow.cc:1187 UI/GTK2/src/mainWindow.cc:1339
-#: UI/GTK2/src/mainWindow.cc:1381 UI/GTK2/src/mainWindow.cc:1403
-#: UI/GTK2/src/mainWindow.cc:1434 UI/GTK2/src/mainWindow.cc:2045
-#: UI/GTK2/src/mainWindow.cc:2157 UI/GTK2/src/PinotSettings.cpp:311
-#: UI/GTK2/src/PinotSettings.cpp:1387 UI/GTK2/src/PinotSettings.cpp:1443
-#: UI/GTK2/src/statisticsDialog.cc:77 UI/GTK2/src/WorkerThreads.cpp:822
-#: UI/GTK2/src/WorkerThreads.cpp:881
+#: UI/GTK2/src/EnginesTree.cpp:337 UI/GTK2/src/mainWindow.cc:795
+#: UI/GTK2/src/mainWindow.cc:1017 UI/GTK2/src/mainWindow.cc:1354
+#: UI/GTK2/src/mainWindow.cc:1509 UI/GTK2/src/mainWindow.cc:1551
+#: UI/GTK2/src/mainWindow.cc:1573 UI/GTK2/src/mainWindow.cc:2177
+#: UI/GTK2/src/mainWindow.cc:2287 UI/GTK2/src/PinotSettings.cpp:311
+#: UI/GTK2/src/PinotSettings.cpp:1421 UI/GTK2/src/PinotSettings.cpp:1477
+#: UI/GTK2/src/statisticsDialog.cc:78 UI/GTK2/src/WorkerThreads.cpp:972
 msgid "My Web Pages"
 msgstr "Mijn webpagina's"
 
-#: UI/GTK2/src/EnginesTree.cpp:338 UI/GTK2/src/mainWindow.cc:680
-#: UI/GTK2/src/mainWindow.cc:1194 UI/GTK2/src/mainWindow.cc:2158
-#: UI/GTK2/src/PinotSettings.cpp:312 UI/GTK2/src/PinotSettings.cpp:1388
-#: UI/GTK2/src/PinotSettings.cpp:1444 UI/GTK2/src/statisticsDialog.cc:82
-#: UI/GTK2/src/WorkerThreads.cpp:827 UI/GTK2/src/WorkerThreads.cpp:891
+#. Spawn new threads
+#: UI/GTK2/src/EnginesTree.cpp:338 UI/GTK2/src/mainWindow.cc:798
+#: UI/GTK2/src/mainWindow.cc:1011 UI/GTK2/src/mainWindow.cc:1361
+#: UI/GTK2/src/mainWindow.cc:2291 UI/GTK2/src/PinotSettings.cpp:312
+#: UI/GTK2/src/PinotSettings.cpp:1422 UI/GTK2/src/PinotSettings.cpp:1478
+#: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:982
 msgid "My Documents"
 msgstr "Mijn documenten"
 
@@ -86,12 +86,13 @@
 msgid "External index"
 msgstr "Externe index"
 
-#: UI/GTK2/src/importDialog.cc:87 UI/GTK2/src/queryDialog.cc:95
+#. Labels
+#: UI/GTK2/src/importDialog.cc:87 UI/GTK2/src/queryDialog.cc:123
 msgid "None"
 msgstr "Geen"
 
 #: UI/GTK2/src/importDialog_glade.cc:68
-#: UI/GTK2/src/propertiesDialog_glade.cc:67
+#: UI/GTK2/src/propertiesDialog_glade.cc:64
 msgid "Title:"
 msgstr "Titel"
 
@@ -103,7 +104,7 @@
 msgid "Import"
 msgstr "Importeren"
 
-#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:221
+#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:216
 msgid "Import URL"
 msgstr "Importeren URL"
 
@@ -117,7 +118,7 @@
 
 #: UI/GTK2/src/IndexPage.cpp:189
 msgid "All"
-msgstr ""
+msgstr "Alle"
 
 #: UI/GTK2/src/launcherDialog_glade.cc:64
 msgid ""
@@ -135,397 +136,423 @@
 msgid "Helper application"
 msgstr "Hulptoepassing"
 
-#: UI/GTK2/src/mainWindow.cc:211
+#: UI/GTK2/src/mainWindow.cc:212
 msgid "Query Name"
 msgstr "Querynaam"
 
-#: UI/GTK2/src/mainWindow.cc:216
+#: UI/GTK2/src/mainWindow.cc:217
 msgid "Last Run"
 msgstr "Laatst geopend"
 
-#: UI/GTK2/src/mainWindow.cc:221
+#: UI/GTK2/src/mainWindow.cc:222
 msgid "Summary"
 msgstr "Samenvatting"
 
 #. Set tooltips
-#: UI/GTK2/src/mainWindow.cc:255
+#: UI/GTK2/src/mainWindow.cc:252
 msgid "Show all search engines"
 msgstr "Toon alle zoekmachines"
 
+#: UI/GTK2/src/mainWindow.cc:253
+msgid "Find documents that match the query string"
+msgstr "Zoeken naar documenten die aan de zoekopdracht voldoen"
+
+#: UI/GTK2/src/mainWindow.cc:254
+msgid "Add an index"
+msgstr "Een index toevoegen"
+
+#: UI/GTK2/src/mainWindow.cc:255
+msgid "Remove an index"
+msgstr "Een index verwijderen"
+
 #: UI/GTK2/src/mainWindow.cc:256
-msgid "Add index"
-msgstr "Toevoegen index"
+msgid "Add a query"
+msgstr "Zoekopdracht toevoegen"
 
 #: UI/GTK2/src/mainWindow.cc:257
-msgid "Remove index"
-msgstr "Verwijderen index"
+msgid "Remove a query"
+msgstr "Een zoekopdracht verwijderen"
 
+#: UI/GTK2/src/mainWindow.cc:258
+msgid "Show the query's previous results"
+msgstr "De vorige resultaten van de zoekopdracht weergeven"
+
+#: UI/GTK2/src/mainWindow.cc:259
+msgid "Find documents that match the query"
+msgstr "Zoeken naar documenten die aan de zoekopdracht voldoen"
+
 #. Now we are ready
-#: UI/GTK2/src/mainWindow.cc:282
+#: UI/GTK2/src/mainWindow.cc:289
 msgid "Ready"
 msgstr "Gereed"
 
-#: UI/GTK2/src/mainWindow.cc:342
+#: UI/GTK2/src/mainWindow.cc:349
 msgid "N/A"
 msgstr "NVT"
 
-#: UI/GTK2/src/mainWindow.cc:357
+#: UI/GTK2/src/mainWindow.cc:364
 msgid "Undefined"
 msgstr "Niet gedefinieerd"
 
+#. Find this query
+#: UI/GTK2/src/mainWindow.cc:587 UI/GTK2/src/mainWindow.cc:2675
+msgid "Live query"
+msgstr "Rechtstreekse query"
+
 #. Show the URL of the first result in the status bar
-#: UI/GTK2/src/mainWindow.cc:611
+#: UI/GTK2/src/mainWindow.cc:727
 msgid "Result location is"
 msgstr "Uitvoerlocatie is"
 
 #. Show the URL in the status bar
-#: UI/GTK2/src/mainWindow.cc:691
+#: UI/GTK2/src/mainWindow.cc:809
 msgid "Document location is"
 msgstr "Documentlocatie is"
 
-#: UI/GTK2/src/mainWindow.cc:1024
+#: UI/GTK2/src/mainWindow.cc:993 UI/GTK2/src/mainWindow.cc:2109
+msgid "Couldn't find query"
+msgstr "Kon query niet vinden"
+
+#: UI/GTK2/src/mainWindow.cc:1008
+msgid "In Results"
+msgstr "In de resultaten"
+
+#: UI/GTK2/src/mainWindow.cc:1191
 msgid "Showing"
 msgstr "Aan het tonen"
 
-#: UI/GTK2/src/mainWindow.cc:1029
+#: UI/GTK2/src/mainWindow.cc:1196
 msgid "of"
 msgstr "van"
 
-#: UI/GTK2/src/mainWindow.cc:1034
+#: UI/GTK2/src/mainWindow.cc:1201
 msgid "documents, starting at"
 msgstr "documenten, beginnend bij"
 
-#: UI/GTK2/src/mainWindow.cc:1068
+#: UI/GTK2/src/mainWindow.cc:1235
 msgid "Query"
 msgstr "Query"
 
-#: UI/GTK2/src/mainWindow.cc:1072 UI/GTK2/src/mainWindow.cc:3177
+#: UI/GTK2/src/mainWindow.cc:1239 UI/GTK2/src/mainWindow.cc:3268
 msgid "on"
 msgstr "op"
 
-#: UI/GTK2/src/mainWindow.cc:1076
+#: UI/GTK2/src/mainWindow.cc:1243
 msgid "ended"
 msgstr "Beeindigd"
 
-#: UI/GTK2/src/mainWindow.cc:1137
+#: UI/GTK2/src/mainWindow.cc:1304
 msgid "Corrected"
-msgstr ""
+msgstr "Gecorrigeerd"
 
-#: UI/GTK2/src/mainWindow.cc:1223
+#: UI/GTK2/src/mainWindow.cc:1393
 msgid "More Like"
 msgstr "Meer zoals"
 
-#: UI/GTK2/src/mainWindow.cc:1265
+#: UI/GTK2/src/mainWindow.cc:1435
 msgid "Updated label(s)"
 msgstr "Vernieuwde na(a)m(en)"
 
 #. Yes, it did
-#: UI/GTK2/src/mainWindow.cc:1349
+#: UI/GTK2/src/mainWindow.cc:1519 UI/GTK2/src/mainWindow.cc:1613
 msgid "Updated document"
 msgstr "Vernieuwd document"
 
-#: UI/GTK2/src/mainWindow.cc:1362
+#: UI/GTK2/src/mainWindow.cc:1532
 msgid "Indexed"
 msgstr "Geindexeerd"
 
-#: UI/GTK2/src/mainWindow.cc:1404
+#: UI/GTK2/src/mainWindow.cc:1574
 msgid "Unindexed document(s)"
 msgstr "Niet geindexeerd(e) document(en)"
 
-#: UI/GTK2/src/mainWindow.cc:1444
-msgid "Updated document properties"
-msgstr "Vernieuwde documenteigenschappen"
-
-#: UI/GTK2/src/mainWindow.cc:1497
+#: UI/GTK2/src/mainWindow.cc:1671
 msgid "Couldn't rename index, name"
 msgstr "Kon index niet hernoemen, naam"
 
-#: UI/GTK2/src/mainWindow.cc:1501 UI/GTK2/src/mainWindow.cc:2441
-#: UI/GTK2/src/mainWindow.cc:2982
+#: UI/GTK2/src/mainWindow.cc:1675 UI/GTK2/src/mainWindow.cc:2501
+#: UI/GTK2/src/mainWindow.cc:3072
 msgid "is already in use"
 msgstr "is reeds in gebruik"
 
-#: UI/GTK2/src/mainWindow.cc:1514
+#: UI/GTK2/src/mainWindow.cc:1688
 msgid "Couldn't rename index"
 msgstr "Kon index niet hernoemen"
 
-#: UI/GTK2/src/mainWindow.cc:1527
+#: UI/GTK2/src/mainWindow.cc:1701
 msgid "Edited index"
 msgstr "Bewerkte index"
 
-#: UI/GTK2/src/mainWindow.cc:1853
-#, fuzzy
+#: UI/GTK2/src/mainWindow.cc:2029
 msgid "Export Results"
-msgstr "resultaten"
+msgstr "Resultaten exporteren"
 
-#. Find this query
-#: UI/GTK2/src/mainWindow.cc:1942 UI/GTK2/src/mainWindow.cc:2615
-msgid "Live query"
-msgstr "Rechtstreekse query"
-
-#: UI/GTK2/src/mainWindow.cc:1968
-msgid "Couldn't find query"
-msgstr "Kon query niet vinden"
-
-#: UI/GTK2/src/mainWindow.cc:2167 UI/GTK2/src/WorkerThreads.cpp:678
-#: UI/GTK2/src/WorkerThreads.cpp:1720
+#: UI/GTK2/src/mainWindow.cc:2304
 msgid "Index"
 msgstr "Inhoudsopgave"
 
-#: UI/GTK2/src/mainWindow.cc:2171 UI/GTK2/src/WorkerThreads.cpp:682
-#: UI/GTK2/src/WorkerThreads.cpp:1724
+#: UI/GTK2/src/mainWindow.cc:2308
 msgid "doesn't exist"
 msgstr "bestaat niet"
 
-#: UI/GTK2/src/mainWindow.cc:2326
+#: UI/GTK2/src/mainWindow.cc:2386
 msgid "Remove this document from the index ?"
 msgstr "Verwijder dit document uit de inhoudsopgave"
 
-#: UI/GTK2/src/mainWindow.cc:2345
+#: UI/GTK2/src/mainWindow.cc:2405
 msgid "Remove these documents from the index ?"
 msgstr "Verwijder deze documenten uit de inhoudsopgave"
 
-#: UI/GTK2/src/mainWindow.cc:2391
+#: UI/GTK2/src/mainWindow.cc:2451
 msgid "A metasearch tool for the Free Desktop"
 msgstr "Een metazoek tool voor de Free Desktop"
 
-#: UI/GTK2/src/mainWindow.cc:2392
+#: UI/GTK2/src/mainWindow.cc:2452
 msgid "Search the Web and your documents !"
 msgstr "Zoek het web en uw documenten!"
 
-#: UI/GTK2/src/mainWindow.cc:2437
+#: UI/GTK2/src/mainWindow.cc:2497
 msgid "Index name"
 msgstr "Naam inhoudsopgave"
 
-#: UI/GTK2/src/mainWindow.cc:2452
+#: UI/GTK2/src/mainWindow.cc:2512
 msgid "Couldn't add index"
 msgstr "Kon inhoudsopgave niet toevoegen"
 
-#: UI/GTK2/src/mainWindow.cc:2468
+#: UI/GTK2/src/mainWindow.cc:2528
 msgid "Added new index"
 msgstr "Nieuwe inhoudsopgave toegevoegd"
 
-#: UI/GTK2/src/mainWindow.cc:2503
+#: UI/GTK2/src/mainWindow.cc:2563
 msgid "Couldn't remove index"
 msgstr "Kon inhoudsopgave niet verwijderen"
 
-#: UI/GTK2/src/mainWindow.cc:2795
+#: UI/GTK2/src/mainWindow.cc:2768
+msgid "No history for"
+msgstr "Geen geschiedenis voor"
+
+#: UI/GTK2/src/mainWindow.cc:2884
 msgid "At least one task hasn't completed yet. Quit now ?"
 msgstr "Tenminste een taak is nog niet gereed. Nu stoppen?"
 
-#: UI/GTK2/src/mainWindow.cc:2978
+#: UI/GTK2/src/mainWindow.cc:3068
 msgid "Query name"
 msgstr "Naam query"
 
-#: UI/GTK2/src/mainWindow.cc:3005
+#: UI/GTK2/src/mainWindow.cc:3095
 msgid "Couldn't update query"
 msgstr "Kon query niet actualiseren"
 
-#: UI/GTK2/src/mainWindow.cc:3013
+#: UI/GTK2/src/mainWindow.cc:3103
 msgid "Edited query"
 msgstr "Bewerkte query"
 
-#: UI/GTK2/src/mainWindow.cc:3020
+#: UI/GTK2/src/mainWindow.cc:3110
 msgid "Couldn't add query"
 msgstr "Kon query niet toevoegen"
 
-#: UI/GTK2/src/mainWindow.cc:3028
+#: UI/GTK2/src/mainWindow.cc:3118
 msgid "Added new query"
 msgstr "Nieuwe query toegevoegd"
 
-#: UI/GTK2/src/mainWindow.cc:3066
+#: UI/GTK2/src/mainWindow.cc:3157
 msgid "Query is not set"
 msgstr "Query niet vastgelegd"
 
-#: UI/GTK2/src/mainWindow.cc:3077
+#: UI/GTK2/src/mainWindow.cc:3168
 msgid "No search engine selected"
 msgstr "Geen zoekmachine geselecteerd"
 
-#: UI/GTK2/src/mainWindow.cc:3164
+#: UI/GTK2/src/mainWindow.cc:3255
 msgid "Please set the Google API key first"
 msgstr "Geef eerst de Google API sleutel in"
 
-#: UI/GTK2/src/mainWindow.cc:3173
+#: UI/GTK2/src/mainWindow.cc:3264
 msgid "Running query"
 msgstr "Lopende query"
 
-#: UI/GTK2/src/mainWindow.cc:3382
+#: UI/GTK2/src/mainWindow.cc:3473
 msgid "No default application defined for type"
 msgstr "Geen standaard toepassing gedefinieerd voor het type"
 
-#: UI/GTK2/src/mainWindow_glade.cc:126
+#: UI/GTK2/src/mainWindow_glade.cc:127
 msgid "Query:"
 msgstr "Query:"
 
-#: UI/GTK2/src/mainWindow_glade.cc:138
-msgid "Edit"
-msgstr "Bewerken"
+#: UI/GTK2/src/mainWindow_glade.cc:138 UI/GTK2/src/statisticsDialog.cc:88
+msgid "History"
+msgstr "Geschiedenis"
 
-#: UI/GTK2/src/mainWindow_glade.cc:147
+#: UI/GTK2/src/mainWindow_glade.cc:143
 msgid "Stored queries"
 msgstr "Opgeslagen queries"
 
-#: UI/GTK2/src/mainWindow_glade.cc:164 UI/GTK2/src/statisticsDialog.cc:50
+#: UI/GTK2/src/mainWindow_glade.cc:156 UI/GTK2/src/statisticsDialog.cc:51
 #: UI/GTK2/src/statisticsDialog_glade.cc:87
 msgid "Status"
 msgstr "Status"
 
-#: UI/GTK2/src/mainWindow_glade.cc:185
+#: UI/GTK2/src/mainWindow_glade.cc:177
 msgid "Search Engine"
 msgstr "Zoekmachine"
 
-#: UI/GTK2/src/mainWindow_glade.cc:188
+#: UI/GTK2/src/mainWindow_glade.cc:180
 msgid "Host Name"
 msgstr "Naam host"
 
-#: UI/GTK2/src/mainWindow_glade.cc:191
+#: UI/GTK2/src/mainWindow_glade.cc:183
 msgid "Show Extract"
 msgstr "Toon uittreksel"
 
-#: UI/GTK2/src/mainWindow_glade.cc:194
+#: UI/GTK2/src/mainWindow_glade.cc:186
 msgid "Group By"
 msgstr "Groeperen op"
 
-#: UI/GTK2/src/mainWindow_glade.cc:200
+#: UI/GTK2/src/mainWindow_glade.cc:192
 msgid "Clear List"
 msgstr "Lijst opschonen"
 
-#: UI/GTK2/src/mainWindow_glade.cc:206
+#: UI/GTK2/src/mainWindow_glade.cc:198
 msgid "Vie_w"
 msgstr "_Toon"
 
-#: UI/GTK2/src/mainWindow_glade.cc:209
+#: UI/GTK2/src/mainWindow_glade.cc:201
 msgid "View Cache"
 msgstr "Toon cache"
 
-#: UI/GTK2/src/mainWindow_glade.cc:212
+#: UI/GTK2/src/mainWindow_glade.cc:204
 msgid "More Like This"
 msgstr "Meer zoals deze"
 
-#: UI/GTK2/src/mainWindow_glade.cc:215 UI/GTK2/src/mainWindow_glade.cc:251
+#: UI/GTK2/src/mainWindow_glade.cc:207
+msgid "Search This For"
+msgstr "Doorzoek dit voor"
+
+#: UI/GTK2/src/mainWindow_glade.cc:210 UI/GTK2/src/mainWindow_glade.cc:246
 msgid "_Index"
 msgstr "_Index"
 
-#: UI/GTK2/src/mainWindow_glade.cc:218
+#: UI/GTK2/src/mainWindow_glade.cc:213
 msgid "List Contents Of"
 msgstr "Lijstinhoud van"
 
-#: UI/GTK2/src/mainWindow_glade.cc:227
+#: UI/GTK2/src/mainWindow_glade.cc:222
 msgid "View"
 msgstr "Toon"
 
-#: UI/GTK2/src/mainWindow_glade.cc:230
+#: UI/GTK2/src/mainWindow_glade.cc:225
 msgid "Update"
 msgstr "Verversen"
 
-#: UI/GTK2/src/mainWindow_glade.cc:233
+#: UI/GTK2/src/mainWindow_glade.cc:228
 msgid "Unindex"
 msgstr "De-indexeren"
 
-#: UI/GTK2/src/mainWindow_glade.cc:236
-#: UI/GTK2/src/propertiesDialog_glade.cc:177
+#: UI/GTK2/src/mainWindow_glade.cc:231
+#: UI/GTK2/src/propertiesDialog_glade.cc:225
 msgid "Properties"
 msgstr "Eigenschappen"
 
-#: UI/GTK2/src/mainWindow_glade.cc:239
+#: UI/GTK2/src/mainWindow_glade.cc:234
 msgid "_About"
 msgstr "_Over"
 
-#: UI/GTK2/src/mainWindow_glade.cc:242
+#: UI/GTK2/src/mainWindow_glade.cc:237
 msgid "_Session"
 msgstr "_Sessie"
 
-#: UI/GTK2/src/mainWindow_glade.cc:245
+#: UI/GTK2/src/mainWindow_glade.cc:240
 msgid "_Edit"
 msgstr "_Bewerken"
 
-#: UI/GTK2/src/mainWindow_glade.cc:248
+#: UI/GTK2/src/mainWindow_glade.cc:243
 msgid "_Results"
 msgstr "_Resultaten"
 
-#: UI/GTK2/src/mainWindow_glade.cc:254
+#: UI/GTK2/src/mainWindow_glade.cc:249
 msgid "_Help"
 msgstr "_Help"
 
-#: UI/GTK2/src/mainWindow_glade.cc:403
+#: UI/GTK2/src/mainWindow_glade.cc:378
 msgid "Pinot"
 msgstr "Pinot"
 
 #. Localize language names
-#: UI/GTK2/src/pinot.cc:249 UI/GTK2/src/pinot-dbus-daemon.cc:324
-#: UI/GTK2/src/propertiesDialog.cc:72 UI/GTK2/src/propertiesDialog.cc:81
+#: UI/GTK2/src/pinot.cc:233 UI/GTK2/src/pinot-dbus-daemon.cc:312
+#: UI/GTK2/src/propertiesDialog.cc:97
 msgid "Unknown"
 msgstr "Niet bekend"
 
-#: UI/GTK2/src/pinot.cc:250 UI/GTK2/src/pinot-dbus-daemon.cc:325
+#: UI/GTK2/src/pinot.cc:234 UI/GTK2/src/pinot-dbus-daemon.cc:313
 msgid "Danish"
 msgstr "Deens"
 
-#: UI/GTK2/src/pinot.cc:251 UI/GTK2/src/pinot-dbus-daemon.cc:326
+#: UI/GTK2/src/pinot.cc:235 UI/GTK2/src/pinot-dbus-daemon.cc:314
 msgid "Dutch"
 msgstr "Nederlands"
 
-#: UI/GTK2/src/pinot.cc:252 UI/GTK2/src/pinot-dbus-daemon.cc:327
+#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:315
 msgid "English"
 msgstr "Engels"
 
-#: UI/GTK2/src/pinot.cc:253 UI/GTK2/src/pinot-dbus-daemon.cc:328
+#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:316
 msgid "Finnish"
 msgstr "Fins"
 
-#: UI/GTK2/src/pinot.cc:254 UI/GTK2/src/pinot-dbus-daemon.cc:329
+#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:317
 msgid "French"
 msgstr "Frans"
 
-#: UI/GTK2/src/pinot.cc:255 UI/GTK2/src/pinot-dbus-daemon.cc:330
+#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:318
 msgid "German"
 msgstr "Duits"
 
-#: UI/GTK2/src/pinot.cc:256 UI/GTK2/src/pinot-dbus-daemon.cc:331
+#: UI/GTK2/src/pinot.cc:240 UI/GTK2/src/pinot-dbus-daemon.cc:319
 msgid "Hungarian"
-msgstr ""
+msgstr "Hongaars"
 
-#: UI/GTK2/src/pinot.cc:257 UI/GTK2/src/pinot-dbus-daemon.cc:332
+#: UI/GTK2/src/pinot.cc:241 UI/GTK2/src/pinot-dbus-daemon.cc:320
 msgid "Italian"
 msgstr "Italiaans"
 
-#: UI/GTK2/src/pinot.cc:258 UI/GTK2/src/pinot-dbus-daemon.cc:333
+#: UI/GTK2/src/pinot.cc:242 UI/GTK2/src/pinot-dbus-daemon.cc:321
 msgid "Norwegian"
 msgstr "Noors"
 
-#: UI/GTK2/src/pinot.cc:259 UI/GTK2/src/pinot-dbus-daemon.cc:334
+#: UI/GTK2/src/pinot.cc:243 UI/GTK2/src/pinot-dbus-daemon.cc:322
 msgid "Portuguese"
 msgstr "Portugees"
 
-#: UI/GTK2/src/pinot.cc:260 UI/GTK2/src/pinot-dbus-daemon.cc:335
+#: UI/GTK2/src/pinot.cc:244 UI/GTK2/src/pinot-dbus-daemon.cc:323
 msgid "Romanian"
-msgstr ""
+msgstr "Roemeens"
 
-#: UI/GTK2/src/pinot.cc:261 UI/GTK2/src/pinot-dbus-daemon.cc:336
+#: UI/GTK2/src/pinot.cc:245 UI/GTK2/src/pinot-dbus-daemon.cc:324
 msgid "Russian"
 msgstr "Russisch"
 
-#: UI/GTK2/src/pinot.cc:262 UI/GTK2/src/pinot-dbus-daemon.cc:337
+#: UI/GTK2/src/pinot.cc:246 UI/GTK2/src/pinot-dbus-daemon.cc:325
 msgid "Spanish"
 msgstr "Spaans"
 
-#: UI/GTK2/src/pinot.cc:263 UI/GTK2/src/pinot-dbus-daemon.cc:338
+#: UI/GTK2/src/pinot.cc:247 UI/GTK2/src/pinot-dbus-daemon.cc:326
 msgid "Swedish"
 msgstr "Zweeds"
 
-#: UI/GTK2/src/pinot.cc:264 UI/GTK2/src/pinot-dbus-daemon.cc:339
+#: UI/GTK2/src/pinot.cc:248 UI/GTK2/src/pinot-dbus-daemon.cc:327
 msgid "Turkish"
-msgstr ""
+msgstr "Turks"
 
-#: UI/GTK2/src/pinot.cc:289
+#: UI/GTK2/src/pinot.cc:273
 msgid "Couldn't open index"
 msgstr "Kan index niet openen"
 
-#: UI/GTK2/src/pinot.cc:310
+#: UI/GTK2/src/pinot.cc:294
 msgid "Couldn't create history database"
 msgstr "Kon historische database niet maken"
 
-#: UI/GTK2/src/pinot.cc:336
+#. Warn the user
+#: UI/GTK2/src/pinot.cc:330
 msgid "Updating all documents in My Web Pages is recommended"
 msgstr ""
 "Het is aangeraden alle documenten in \"Mijn webpagina's\" te vernieuwen"
@@ -543,39 +570,43 @@
 msgid "Personal"
 msgstr "Persoonlijk"
 
-#: UI/GTK2/src/PinotSettings.cpp:1198
+#: UI/GTK2/src/PinotSettings.cpp:358
+msgid "Me"
+msgstr ""
+
+#: UI/GTK2/src/PinotSettings.cpp:1233
 msgid "Unclassified"
 msgstr "Niet geclassificeerd"
 
-#: UI/GTK2/src/prefsDialog.cc:81
+#: UI/GTK2/src/prefsDialog.cc:83
 msgid "Name"
 msgstr "Naam"
 
-#: UI/GTK2/src/prefsDialog.cc:89
+#: UI/GTK2/src/prefsDialog.cc:91
 msgid "Monitor"
 msgstr "Observeren"
 
-#: UI/GTK2/src/prefsDialog.cc:90
+#: UI/GTK2/src/prefsDialog.cc:92
 msgid "Location"
 msgstr "Locatie"
 
-#: UI/GTK2/src/prefsDialog.cc:98
+#: UI/GTK2/src/prefsDialog.cc:100
 msgid "Pattern"
 msgstr "Patroon"
 
-#: UI/GTK2/src/prefsDialog.cc:315
+#: UI/GTK2/src/prefsDialog.cc:357
 msgid "Exclude these patterns from indexing"
-msgstr ""
+msgstr "Deze patronen niet indexeren"
 
-#: UI/GTK2/src/prefsDialog.cc:316
+#: UI/GTK2/src/prefsDialog.cc:358
 msgid "Only index these patterns"
-msgstr ""
+msgstr "Enkel deze patronen indexeren"
 
-#: UI/GTK2/src/prefsDialog.cc:406
+#: UI/GTK2/src/prefsDialog.cc:478
 msgid "New Label"
 msgstr "Nieuwe naam"
 
-#: UI/GTK2/src/prefsDialog.cc:447
+#: UI/GTK2/src/prefsDialog.cc:519
 msgid "Directory to index"
 msgstr "Directory naar inhoudsopgave"
 
@@ -633,7 +664,7 @@
 msgid "Remove"
 msgstr "Verwijderen"
 
-#: UI/GTK2/src/prefsDialog_glade.cc:113
+#: UI/GTK2/src/prefsDialog_glade.cc:113 UI/GTK2/src/propertiesDialog.cc:56
 msgid "Labels"
 msgstr "Bijschriften"
 
@@ -644,9 +675,8 @@
 "bij veranderingen:"
 
 #: UI/GTK2/src/prefsDialog_glade.cc:127
-#, fuzzy
 msgid "File patterns:"
-msgstr "Bestandsextensie"
+msgstr "Bestandspatronen:"
 
 #: UI/GTK2/src/prefsDialog_glade.cc:144
 msgid "Indexing"
@@ -656,83 +686,97 @@
 msgid "Preferences"
 msgstr "Voorkeuren"
 
-#: UI/GTK2/src/propertiesDialog.cc:60 UI/GTK2/src/queryDialog.cc:124
-msgid "Label"
-msgstr "Bijschrift"
-
-#: UI/GTK2/src/propertiesDialog.cc:93
+#: UI/GTK2/src/propertiesDialog.cc:110
 msgid "Per document"
 msgstr "Per document"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:68
+#: UI/GTK2/src/propertiesDialog.cc:368
+msgid "Export Terms"
+msgstr "Termen exporteren"
+
+#: UI/GTK2/src/propertiesDialog_glade.cc:65
 msgid "Language:"
 msgstr "Taal:"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:69
+#: UI/GTK2/src/propertiesDialog_glade.cc:66
 msgid "MIME type:"
 msgstr "MIME type:"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:70
+#: UI/GTK2/src/propertiesDialog_glade.cc:67
 msgid "Size:"
 msgstr "Grootte:"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:73
+#: UI/GTK2/src/propertiesDialog_glade.cc:68
 msgid "Terms:"
 msgstr "Termen:"
 
-#: UI/GTK2/src/queryDialog.cc:114
+#: UI/GTK2/src/propertiesDialog_glade.cc:78
+msgid "bytes"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog.cc:94
 msgid "Host name"
 msgstr "Hostnaam"
 
-#: UI/GTK2/src/queryDialog.cc:115
+#: UI/GTK2/src/queryDialog.cc:95
 msgid "File name"
 msgstr "Bestandsnaam"
 
-#: UI/GTK2/src/queryDialog.cc:118
+#: UI/GTK2/src/queryDialog.cc:96
 msgid "File extension"
 msgstr "Bestandsextensie"
 
 #. This is the title column
-#: UI/GTK2/src/queryDialog.cc:119 UI/GTK2/src/ResultsTree.cpp:133
+#: UI/GTK2/src/queryDialog.cc:97 UI/GTK2/src/ResultsTree.cpp:133
 msgid "Title"
 msgstr "Titel"
 
 #. URL
-#: UI/GTK2/src/queryDialog.cc:120 UI/GTK2/src/ResultsTree.cpp:143
+#: UI/GTK2/src/queryDialog.cc:98 UI/GTK2/src/ResultsTree.cpp:143
 msgid "URL"
 msgstr "URL"
 
-#: UI/GTK2/src/queryDialog.cc:121
+#: UI/GTK2/src/queryDialog.cc:99
 msgid "Directory"
 msgstr "Map"
 
-#: UI/GTK2/src/queryDialog.cc:122
+#: UI/GTK2/src/queryDialog.cc:100
 msgid "Language code"
 msgstr "Taal code"
 
-#: UI/GTK2/src/queryDialog.cc:123
+#: UI/GTK2/src/queryDialog.cc:101
 msgid "MIME type"
 msgstr "MIME type"
 
+#: UI/GTK2/src/queryDialog.cc:102
+msgid "Label"
+msgstr "Bijschrift"
+
 #. The last column is for the timestamp
-#: UI/GTK2/src/queryDialog.cc:127 UI/GTK2/src/ResultsTree.cpp:151
+#: UI/GTK2/src/queryDialog.cc:105 UI/GTK2/src/ResultsTree.cpp:151
 msgid "Date"
 msgstr "Datum"
 
-#: UI/GTK2/src/queryDialog.cc:128
-#, fuzzy
+#: UI/GTK2/src/queryDialog.cc:106
 msgid "Time"
-msgstr "Titel"
+msgstr "Tijd"
 
-#: UI/GTK2/src/queryDialog.cc:129
-#, fuzzy
+#: UI/GTK2/src/queryDialog.cc:107
 msgid "Size"
-msgstr "Grootte:"
+msgstr "Grootte"
 
+#. Sort order
+#: UI/GTK2/src/queryDialog.cc:111
+msgid "By relevance"
+msgstr "Volgens relevantie"
+
+#: UI/GTK2/src/queryDialog.cc:112
+msgid "By date"
+msgstr "Volgens datum"
+
 #: UI/GTK2/src/queryDialog_glade.cc:72
-#, fuzzy
 msgid "New filter or range:"
-msgstr "Nieuw filter:"
+msgstr "Nieuwe filter of bereik:"
 
 #: UI/GTK2/src/queryDialog_glade.cc:81
 msgid "Query Text"
@@ -746,7 +790,11 @@
 msgid "Number of results:"
 msgstr "Aantal resultaten:"
 
-#: UI/GTK2/src/queryDialog_glade.cc:181
+#: UI/GTK2/src/queryDialog_glade.cc:90
+msgid "Sort order:"
+msgstr "Sorteervolgorde:"
+
+#: UI/GTK2/src/queryDialog_glade.cc:192
 msgid "Query parameters"
 msgstr "Queryparameters"
 
@@ -759,124 +807,124 @@
 msgid "Extract"
 msgstr "Uitpakken"
 
-#: UI/GTK2/src/statisticsDialog.cc:72
+#: UI/GTK2/src/statisticsDialog.cc:73
 msgid "Indexes"
 msgstr "Indexen"
 
-#: UI/GTK2/src/statisticsDialog.cc:87
-msgid "History"
-msgstr "Geschiedenis"
-
-#: UI/GTK2/src/statisticsDialog.cc:92
+#: UI/GTK2/src/statisticsDialog.cc:93
 msgid "Daemon"
 msgstr "Daemon"
 
-#: UI/GTK2/src/statisticsDialog.cc:128 UI/GTK2/src/statisticsDialog.cc:143
+#: UI/GTK2/src/statisticsDialog.cc:128 UI/GTK2/src/statisticsDialog.cc:144
 msgid "documents"
 msgstr "documenten"
 
-#: UI/GTK2/src/statisticsDialog.cc:132 UI/GTK2/src/statisticsDialog.cc:147
+#: UI/GTK2/src/statisticsDialog.cc:134 UI/GTK2/src/statisticsDialog.cc:150
+#: UI/GTK2/src/WorkerThreads.cpp:126
 msgid "Unknown error"
 msgstr "Onbekende fout."
 
-#: UI/GTK2/src/statisticsDialog.cc:154
+#: UI/GTK2/src/statisticsDialog.cc:157
 msgid "Viewed"
 msgstr "Weergegeven"
 
-#: UI/GTK2/src/statisticsDialog.cc:154
+#: UI/GTK2/src/statisticsDialog.cc:157
 msgid "results"
 msgstr "resultaten"
 
 #. FIXME: check whether it's actually running !
-#: UI/GTK2/src/statisticsDialog.cc:171
+#: UI/GTK2/src/statisticsDialog.cc:174
 msgid "Running under PID"
 msgstr "Wordt uitgevoerd on het PID"
 
-#: UI/GTK2/src/statisticsDialog.cc:175
+#: UI/GTK2/src/statisticsDialog.cc:178
 msgid "Currently not running"
 msgstr "Wordt momenteel niet uitgevoerd"
 
-#: UI/GTK2/src/statisticsDialog.cc:182
+#: UI/GTK2/src/statisticsDialog.cc:185
 msgid "Crawled"
 msgstr "Gecrawld"
 
-#: UI/GTK2/src/statisticsDialog.cc:182
+#: UI/GTK2/src/statisticsDialog.cc:185
 msgid "files"
 msgstr "bestanden"
 
-#: UI/GTK2/src/statisticsDialog.cc:205
+#: UI/GTK2/src/statisticsDialog.cc:206
 msgid "Errors"
 msgstr "Fouten"
 
-#: UI/GTK2/src/WorkerThreads.cpp:307
-msgid "Can't index mail here"
-msgstr "Kan mail hier niet indexeren"
+#: UI/GTK2/src/WorkerThreads.cpp:93
+msgid "Index error"
+msgstr "Indexfout"
 
-#: UI/GTK2/src/WorkerThreads.cpp:328 UI/GTK2/src/WorkerThreads.cpp:581
-msgid "is already being indexed"
-msgstr "wordt al geindexeerd"
+#: UI/GTK2/src/WorkerThreads.cpp:95
+msgid "Couldn't index document"
+msgstr "Het document kon niet ge?ndexeerd worden"
 
-#: UI/GTK2/src/WorkerThreads.cpp:338
-msgid "is blacklisted"
-msgstr "staat op blacklist"
+#: UI/GTK2/src/WorkerThreads.cpp:97
+msgid "Couldn't update document"
+msgstr "Kan document niet actualiseren"
 
-#: UI/GTK2/src/WorkerThreads.cpp:691 UI/GTK2/src/WorkerThreads.cpp:1051
-#: UI/GTK2/src/WorkerThreads.cpp:1135 UI/GTK2/src/WorkerThreads.cpp:1144
-#: UI/GTK2/src/WorkerThreads.cpp:1330 UI/GTK2/src/WorkerThreads.cpp:1600
-#: UI/GTK2/src/WorkerThreads.cpp:1733
-msgid "Index error on"
-msgstr "Indexeringsfout op"
+#: UI/GTK2/src/WorkerThreads.cpp:99
+msgid "Couldn't unindex document(s)"
+msgstr "Kan indexering van bestand(en) niet ongedaan maken"
 
-#: UI/GTK2/src/WorkerThreads.cpp:844
-msgid "No title"
-msgstr "Geen titel"
-
-#: UI/GTK2/src/WorkerThreads.cpp:946 UI/GTK2/src/WorkerThreads.cpp:1072
-msgid "Couldn't create search engine"
-msgstr "Kon zoekmachine niet maken"
-
-#: UI/GTK2/src/WorkerThreads.cpp:970 UI/GTK2/src/WorkerThreads.cpp:1085
+#: UI/GTK2/src/WorkerThreads.cpp:101
 msgid "Couldn't run query on search engine"
 msgstr "Kon query niet uitvoeren op zoekmachine"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1238
-msgid "Couldn't obtain downloader for protocol"
-msgstr "Kon geen downloader verkrijgen voor protocol"
+#: UI/GTK2/src/WorkerThreads.cpp:103
+msgid "Couldn't get history for search engine"
+msgstr "De geschiedenis voor de zoekmachine kon niet verkregen worden"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1263
-msgid "Couldn't retrieve"
-msgstr "Kon niet opzoeken"
+#: UI/GTK2/src/WorkerThreads.cpp:105
+msgid "Couldn't retrieve document"
+msgstr "Het document kon niet verkregen worden"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1360 UI/GTK2/src/WorkerThreads.cpp:1439
+#: UI/GTK2/src/WorkerThreads.cpp:107
+msgid "Couldn't initialize file monitor"
+msgstr "Kan bestandsmonitor niet initialiseren"
+
+#: UI/GTK2/src/WorkerThreads.cpp:109
+msgid "Couldn't open directory"
+msgstr "De map kon niet geopend worden"
+
+#: UI/GTK2/src/WorkerThreads.cpp:111
+msgid "Index doesn't exist"
+msgstr "De index bestaat niet"
+
+#: UI/GTK2/src/WorkerThreads.cpp:113
+msgid "Couldn't create search engine"
+msgstr "Kon zoekmachine niet maken"
+
+#: UI/GTK2/src/WorkerThreads.cpp:115
 msgid "Cannot index document type"
 msgstr "Kan documenttype niet indexeren"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1364 UI/GTK2/src/WorkerThreads.cpp:1443
-msgid "at"
-msgstr "bij"
+#: UI/GTK2/src/WorkerThreads.cpp:117
+msgid "No downloader for this protocol"
+msgstr "Er is geen downloader voor dit protocol"
 
-#. No, it isn't
-#: UI/GTK2/src/WorkerThreads.cpp:1475
+#: UI/GTK2/src/WorkerThreads.cpp:119
 msgid "Robots META tag forbids indexing"
 msgstr "Robots META taf verbiedt indexeren"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1529
-msgid "Couldn't index"
-msgstr "Kon niet indexeren"
+#: UI/GTK2/src/WorkerThreads.cpp:121
+msgid "No monitoring handler"
+msgstr "Geen monitoring handler"
 
-#. Be pessimistic and assume something will go wrong ;-)
-#: UI/GTK2/src/WorkerThreads.cpp:1611
-msgid "Couldn't unindex document(s)"
-msgstr "Kan indexering van bestand(en) niet ongedaan maken"
+#: UI/GTK2/src/WorkerThreads.cpp:391
+msgid "Can't index mail here"
+msgstr "Kan mail hier niet indexeren"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1745
-msgid "Couldn't update document"
-msgstr "Kan document niet actualiseren"
+#: UI/GTK2/src/WorkerThreads.cpp:412 UI/GTK2/src/WorkerThreads.cpp:666
+msgid "is already being indexed"
+msgstr "wordt al geindexeerd"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1981
-msgid "No monitoring handler"
-msgstr ""
+#: UI/GTK2/src/WorkerThreads.cpp:422
+msgid "is blacklisted"
+msgstr "staat op blacklist"
 
-#: UI/GTK2/src/WorkerThreads.cpp:2023
-msgid "Couldn't initialize file monitor"
-msgstr ""
+#: UI/GTK2/src/WorkerThreads.cpp:935
+msgid "No title"
+msgstr "Geen titel"

Modified: trunk/po/pt.po
===================================================================
--- trunk/po/pt.po	2007-10-27 03:47:11 UTC (rev 1076)
+++ trunk/po/pt.po	2007-10-27 12:57:33 UTC (rev 1077)
@@ -6,7 +6,7 @@
 msgstr ""
 "Project-Id-Version: pinot 0.75\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2007-09-23 19:22+0800\n"
+"POT-Creation-Date: 2007-10-27 00:15+0800\n"
 "PO-Revision-Date: 2007-08-17 10:07+0000\n"
 "Last-Translator: _PN_boy <pedro_nuno_pn at iol.pt>\n"
 "Language-Team: Portuguese <pt at li.org>\n"
@@ -28,22 +28,22 @@
 #. Enable these menu items unless it is not the documents index
 #. Allow this only for internal indexes
 #. Internal indices
-#: UI/GTK2/src/EnginesTree.cpp:337 UI/GTK2/src/mainWindow.cc:677
-#: UI/GTK2/src/mainWindow.cc:1187 UI/GTK2/src/mainWindow.cc:1339
-#: UI/GTK2/src/mainWindow.cc:1381 UI/GTK2/src/mainWindow.cc:1403
-#: UI/GTK2/src/mainWindow.cc:1434 UI/GTK2/src/mainWindow.cc:2045
-#: UI/GTK2/src/mainWindow.cc:2157 UI/GTK2/src/PinotSettings.cpp:311
-#: UI/GTK2/src/PinotSettings.cpp:1387 UI/GTK2/src/PinotSettings.cpp:1443
-#: UI/GTK2/src/statisticsDialog.cc:77 UI/GTK2/src/WorkerThreads.cpp:822
-#: UI/GTK2/src/WorkerThreads.cpp:881
+#: UI/GTK2/src/EnginesTree.cpp:337 UI/GTK2/src/mainWindow.cc:795
+#: UI/GTK2/src/mainWindow.cc:1017 UI/GTK2/src/mainWindow.cc:1354
+#: UI/GTK2/src/mainWindow.cc:1509 UI/GTK2/src/mainWindow.cc:1551
+#: UI/GTK2/src/mainWindow.cc:1573 UI/GTK2/src/mainWindow.cc:2177
+#: UI/GTK2/src/mainWindow.cc:2287 UI/GTK2/src/PinotSettings.cpp:311
+#: UI/GTK2/src/PinotSettings.cpp:1421 UI/GTK2/src/PinotSettings.cpp:1477
+#: UI/GTK2/src/statisticsDialog.cc:78 UI/GTK2/src/WorkerThreads.cpp:972
 msgid "My Web Pages"
 msgstr "As minhas p?ginas Web"
 
-#: UI/GTK2/src/EnginesTree.cpp:338 UI/GTK2/src/mainWindow.cc:680
-#: UI/GTK2/src/mainWindow.cc:1194 UI/GTK2/src/mainWindow.cc:2158
-#: UI/GTK2/src/PinotSettings.cpp:312 UI/GTK2/src/PinotSettings.cpp:1388
-#: UI/GTK2/src/PinotSettings.cpp:1444 UI/GTK2/src/statisticsDialog.cc:82
-#: UI/GTK2/src/WorkerThreads.cpp:827 UI/GTK2/src/WorkerThreads.cpp:891
+#. Spawn new threads
+#: UI/GTK2/src/EnginesTree.cpp:338 UI/GTK2/src/mainWindow.cc:798
+#: UI/GTK2/src/mainWindow.cc:1011 UI/GTK2/src/mainWindow.cc:1361
+#: UI/GTK2/src/mainWindow.cc:2291 UI/GTK2/src/PinotSettings.cpp:312
+#: UI/GTK2/src/PinotSettings.cpp:1422 UI/GTK2/src/PinotSettings.cpp:1478
+#: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:982
 msgid "My Documents"
 msgstr "Os Meus Documentos"
 
@@ -87,12 +87,13 @@
 msgid "External index"
 msgstr "Index externo"
 
-#: UI/GTK2/src/importDialog.cc:87 UI/GTK2/src/queryDialog.cc:95
+#. Labels
+#: UI/GTK2/src/importDialog.cc:87 UI/GTK2/src/queryDialog.cc:123
 msgid "None"
 msgstr "Nenhum"
 
 #: UI/GTK2/src/importDialog_glade.cc:68
-#: UI/GTK2/src/propertiesDialog_glade.cc:67
+#: UI/GTK2/src/propertiesDialog_glade.cc:64
 msgid "Title:"
 msgstr "T?tulo:"
 
@@ -104,7 +105,7 @@
 msgid "Import"
 msgstr "Importar"
 
-#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:221
+#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:216
 msgid "Import URL"
 msgstr "Importar URL"
 
@@ -136,397 +137,430 @@
 msgid "Helper application"
 msgstr "Aplica??o"
 
-#: UI/GTK2/src/mainWindow.cc:211
+#: UI/GTK2/src/mainWindow.cc:212
 msgid "Query Name"
 msgstr "Nome da Consulta"
 
-#: UI/GTK2/src/mainWindow.cc:216
+#: UI/GTK2/src/mainWindow.cc:217
 msgid "Last Run"
 msgstr "?ltima execu??o"
 
-#: UI/GTK2/src/mainWindow.cc:221
+#: UI/GTK2/src/mainWindow.cc:222
 msgid "Summary"
 msgstr "Resumo"
 
 #. Set tooltips
-#: UI/GTK2/src/mainWindow.cc:255
+#: UI/GTK2/src/mainWindow.cc:252
 msgid "Show all search engines"
 msgstr "Mostrar todos os motores de pesquisa"
 
-#: UI/GTK2/src/mainWindow.cc:256
-msgid "Add index"
+#: UI/GTK2/src/mainWindow.cc:253
+msgid "Find documents that match the query string"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:254
+#, fuzzy
+msgid "Add an index"
 msgstr "Adicionar index"
 
-#: UI/GTK2/src/mainWindow.cc:257
-msgid "Remove index"
+#: UI/GTK2/src/mainWindow.cc:255
+#, fuzzy
+msgid "Remove an index"
 msgstr "Remover index"
 
+#: UI/GTK2/src/mainWindow.cc:256
+#, fuzzy
+msgid "Add a query"
+msgstr "Adicionar nova consulta"
+
+#: UI/GTK2/src/mainWindow.cc:257
+#, fuzzy
+msgid "Remove a query"
+msgstr "Consulta activa"
+
+#: UI/GTK2/src/mainWindow.cc:258
+msgid "Show the query's previous results"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:259
+msgid "Find documents that match the query"
+msgstr ""
+
 #. Now we are ready
-#: UI/GTK2/src/mainWindow.cc:282
+#: UI/GTK2/src/mainWindow.cc:289
 msgid "Ready"
 msgstr "Pronto"
 
-#: UI/GTK2/src/mainWindow.cc:342
+#: UI/GTK2/src/mainWindow.cc:349
 msgid "N/A"
 msgstr "N/D"
 
-#: UI/GTK2/src/mainWindow.cc:357
+#: UI/GTK2/src/mainWindow.cc:364
 msgid "Undefined"
 msgstr "Indefinido"
 
+#. Find this query
+#: UI/GTK2/src/mainWindow.cc:587 UI/GTK2/src/mainWindow.cc:2675
+msgid "Live query"
+msgstr "Consulta activa"
+
 #. Show the URL of the first result in the status bar
-#: UI/GTK2/src/mainWindow.cc:611
+#: UI/GTK2/src/mainWindow.cc:727
 msgid "Result location is"
 msgstr "A localiza??o do resultado ?"
 
 #. Show the URL in the status bar
-#: UI/GTK2/src/mainWindow.cc:691
+#: UI/GTK2/src/mainWindow.cc:809
 msgid "Document location is"
 msgstr "A localiza??o do documento ?"
 
-#: UI/GTK2/src/mainWindow.cc:1024
+#: UI/GTK2/src/mainWindow.cc:993 UI/GTK2/src/mainWindow.cc:2109
+msgid "Couldn't find query"
+msgstr "N?o foi poss?vel encontrar a consulta"
+
+#: UI/GTK2/src/mainWindow.cc:1008
+#, fuzzy
+msgid "In Results"
+msgstr "resultados"
+
+#: UI/GTK2/src/mainWindow.cc:1191
 msgid "Showing"
 msgstr "Visualizando"
 
-#: UI/GTK2/src/mainWindow.cc:1029
+#: UI/GTK2/src/mainWindow.cc:1196
 msgid "of"
 msgstr "de"
 
-#: UI/GTK2/src/mainWindow.cc:1034
+#: UI/GTK2/src/mainWindow.cc:1201
 msgid "documents, starting at"
 msgstr "documentos, come?ando em"
 
-#: UI/GTK2/src/mainWindow.cc:1068
+#: UI/GTK2/src/mainWindow.cc:1235
 msgid "Query"
 msgstr "Pesquisa"
 
-#: UI/GTK2/src/mainWindow.cc:1072 UI/GTK2/src/mainWindow.cc:3177
+#: UI/GTK2/src/mainWindow.cc:1239 UI/GTK2/src/mainWindow.cc:3268
 msgid "on"
 msgstr "activar"
 
-#: UI/GTK2/src/mainWindow.cc:1076
+#: UI/GTK2/src/mainWindow.cc:1243
 msgid "ended"
 msgstr "terminado"
 
-#: UI/GTK2/src/mainWindow.cc:1137
+#: UI/GTK2/src/mainWindow.cc:1304
 msgid "Corrected"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:1223
+#: UI/GTK2/src/mainWindow.cc:1393
 msgid "More Like"
 msgstr "Mais identico"
 
-#: UI/GTK2/src/mainWindow.cc:1265
+#: UI/GTK2/src/mainWindow.cc:1435
 msgid "Updated label(s)"
 msgstr "T?tulo(s) atualizado(s)"
 
 #. Yes, it did
-#: UI/GTK2/src/mainWindow.cc:1349
+#: UI/GTK2/src/mainWindow.cc:1519 UI/GTK2/src/mainWindow.cc:1613
 msgid "Updated document"
 msgstr "Documento actualizado"
 
-#: UI/GTK2/src/mainWindow.cc:1362
+#: UI/GTK2/src/mainWindow.cc:1532
 msgid "Indexed"
 msgstr "Indexado"
 
-#: UI/GTK2/src/mainWindow.cc:1404
+#: UI/GTK2/src/mainWindow.cc:1574
 msgid "Unindexed document(s)"
 msgstr "Documento(s) n?o indexado(s)"
 
-#: UI/GTK2/src/mainWindow.cc:1444
-msgid "Updated document properties"
-msgstr "Propriedades do documento actualizado"
-
-#: UI/GTK2/src/mainWindow.cc:1497
+#: UI/GTK2/src/mainWindow.cc:1671
 msgid "Couldn't rename index, name"
 msgstr "N?o foi poss?vel renomear o ?ndice, nome"
 
-#: UI/GTK2/src/mainWindow.cc:1501 UI/GTK2/src/mainWindow.cc:2441
-#: UI/GTK2/src/mainWindow.cc:2982
+#: UI/GTK2/src/mainWindow.cc:1675 UI/GTK2/src/mainWindow.cc:2501
+#: UI/GTK2/src/mainWindow.cc:3072
 msgid "is already in use"
 msgstr "j? est? em uso"
 
-#: UI/GTK2/src/mainWindow.cc:1514
+#: UI/GTK2/src/mainWindow.cc:1688
 msgid "Couldn't rename index"
 msgstr "N?o foi poss?vel renomear o ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:1527
+#: UI/GTK2/src/mainWindow.cc:1701
 msgid "Edited index"
 msgstr "?ndice editado"
 
-#: UI/GTK2/src/mainWindow.cc:1853
+#: UI/GTK2/src/mainWindow.cc:2029
 #, fuzzy
 msgid "Export Results"
 msgstr "resultados"
 
-#. Find this query
-#: UI/GTK2/src/mainWindow.cc:1942 UI/GTK2/src/mainWindow.cc:2615
-msgid "Live query"
-msgstr "Consulta activa"
-
-#: UI/GTK2/src/mainWindow.cc:1968
-msgid "Couldn't find query"
-msgstr "N?o foi poss?vel encontrar a consulta"
-
-#: UI/GTK2/src/mainWindow.cc:2167 UI/GTK2/src/WorkerThreads.cpp:678
-#: UI/GTK2/src/WorkerThreads.cpp:1720
+#: UI/GTK2/src/mainWindow.cc:2304
 msgid "Index"
 msgstr "?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2171 UI/GTK2/src/WorkerThreads.cpp:682
-#: UI/GTK2/src/WorkerThreads.cpp:1724
+#: UI/GTK2/src/mainWindow.cc:2308
 msgid "doesn't exist"
 msgstr "n?o existe"
 
-#: UI/GTK2/src/mainWindow.cc:2326
+#: UI/GTK2/src/mainWindow.cc:2386
 msgid "Remove this document from the index ?"
 msgstr "Remover este documento do ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2345
+#: UI/GTK2/src/mainWindow.cc:2405
 msgid "Remove these documents from the index ?"
 msgstr "Remover estes documentos do ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2391
+#: UI/GTK2/src/mainWindow.cc:2451
 msgid "A metasearch tool for the Free Desktop"
 msgstr "Um mecanismo de metabusca para o Free Desktop"
 
-#: UI/GTK2/src/mainWindow.cc:2392
+#: UI/GTK2/src/mainWindow.cc:2452
 msgid "Search the Web and your documents !"
 msgstr "Pesquise a Web e os seus documentos"
 
-#: UI/GTK2/src/mainWindow.cc:2437
+#: UI/GTK2/src/mainWindow.cc:2497
 msgid "Index name"
 msgstr "Nome do ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2452
+#: UI/GTK2/src/mainWindow.cc:2512
 msgid "Couldn't add index"
 msgstr "N?o foi poss?vel adicionar ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2468
+#: UI/GTK2/src/mainWindow.cc:2528
 msgid "Added new index"
 msgstr "Adicionar novo ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2503
+#: UI/GTK2/src/mainWindow.cc:2563
 msgid "Couldn't remove index"
 msgstr "N?o foi possivel remover o ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2795
+#: UI/GTK2/src/mainWindow.cc:2768
+msgid "No history for"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:2884
 msgid "At least one task hasn't completed yet. Quit now ?"
 msgstr "Pelo menos uma tarefa ainda n?o foi concluida. Sair agora?"
 
-#: UI/GTK2/src/mainWindow.cc:2978
+#: UI/GTK2/src/mainWindow.cc:3068
 msgid "Query name"
 msgstr "Nome da consulta"
 
-#: UI/GTK2/src/mainWindow.cc:3005
+#: UI/GTK2/src/mainWindow.cc:3095
 msgid "Couldn't update query"
 msgstr "N?o foi poss?vel actualizar a consulta"
 
-#: UI/GTK2/src/mainWindow.cc:3013
+#: UI/GTK2/src/mainWindow.cc:3103
 msgid "Edited query"
 msgstr "Consulta editada"
 
-#: UI/GTK2/src/mainWindow.cc:3020
+#: UI/GTK2/src/mainWindow.cc:3110
 msgid "Couldn't add query"
 msgstr "N?o foi poss?vel adicionar consulta"
 
-#: UI/GTK2/src/mainWindow.cc:3028
+#: UI/GTK2/src/mainWindow.cc:3118
 msgid "Added new query"
 msgstr "Adicionar nova consulta"
 
-#: UI/GTK2/src/mainWindow.cc:3066
+#: UI/GTK2/src/mainWindow.cc:3157
 msgid "Query is not set"
 msgstr "Consulta n?o foi actualizada"
 
-#: UI/GTK2/src/mainWindow.cc:3077
+#: UI/GTK2/src/mainWindow.cc:3168
 msgid "No search engine selected"
 msgstr "Nenhum mecanismo de pesquisa seleccionado"
 
-#: UI/GTK2/src/mainWindow.cc:3164
+#: UI/GTK2/src/mainWindow.cc:3255
 msgid "Please set the Google API key first"
 msgstr "Primeiro escolha a tecla para a API Google"
 
-#: UI/GTK2/src/mainWindow.cc:3173
+#: UI/GTK2/src/mainWindow.cc:3264
 msgid "Running query"
 msgstr "A executar consulta"
 
-#: UI/GTK2/src/mainWindow.cc:3382
+#: UI/GTK2/src/mainWindow.cc:3473
 msgid "No default application defined for type"
 msgstr "Nenhuma aplica??o associada ao tipo"
 
-#: UI/GTK2/src/mainWindow_glade.cc:126
+#: UI/GTK2/src/mainWindow_glade.cc:127
 msgid "Query:"
 msgstr "Pesquisa:"
 
-#: UI/GTK2/src/mainWindow_glade.cc:138
-msgid "Edit"
-msgstr "Editar"
+#: UI/GTK2/src/mainWindow_glade.cc:138 UI/GTK2/src/statisticsDialog.cc:88
+msgid "History"
+msgstr "Hist?rico"
 
-#: UI/GTK2/src/mainWindow_glade.cc:147
+#: UI/GTK2/src/mainWindow_glade.cc:143
 msgid "Stored queries"
 msgstr "Consultas armazenadas"
 
-#: UI/GTK2/src/mainWindow_glade.cc:164 UI/GTK2/src/statisticsDialog.cc:50
+#: UI/GTK2/src/mainWindow_glade.cc:156 UI/GTK2/src/statisticsDialog.cc:51
 #: UI/GTK2/src/statisticsDialog_glade.cc:87
 msgid "Status"
 msgstr "Situa??o"
 
-#: UI/GTK2/src/mainWindow_glade.cc:185
+#: UI/GTK2/src/mainWindow_glade.cc:177
 msgid "Search Engine"
 msgstr "Motor de busca"
 
-#: UI/GTK2/src/mainWindow_glade.cc:188
+#: UI/GTK2/src/mainWindow_glade.cc:180
 msgid "Host Name"
 msgstr "Nome da M?quina"
 
-#: UI/GTK2/src/mainWindow_glade.cc:191
+#: UI/GTK2/src/mainWindow_glade.cc:183
 msgid "Show Extract"
 msgstr "Mostrar extracto"
 
-#: UI/GTK2/src/mainWindow_glade.cc:194
+#: UI/GTK2/src/mainWindow_glade.cc:186
 msgid "Group By"
 msgstr "Agrupar Por"
 
-#: UI/GTK2/src/mainWindow_glade.cc:200
+#: UI/GTK2/src/mainWindow_glade.cc:192
 msgid "Clear List"
 msgstr "Limpar Lista"
 
-#: UI/GTK2/src/mainWindow_glade.cc:206
+#: UI/GTK2/src/mainWindow_glade.cc:198
 msgid "Vie_w"
 msgstr "M_ostrar"
 
-#: UI/GTK2/src/mainWindow_glade.cc:209
+#: UI/GTK2/src/mainWindow_glade.cc:201
 msgid "View Cache"
 msgstr "Ver Cache"
 
-#: UI/GTK2/src/mainWindow_glade.cc:212
+#: UI/GTK2/src/mainWindow_glade.cc:204
 msgid "More Like This"
 msgstr "Mais identicos"
 
-#: UI/GTK2/src/mainWindow_glade.cc:215 UI/GTK2/src/mainWindow_glade.cc:251
+#: UI/GTK2/src/mainWindow_glade.cc:207
+#, fuzzy
+msgid "Search This For"
+msgstr "Motores de pesquisa"
+
+#: UI/GTK2/src/mainWindow_glade.cc:210 UI/GTK2/src/mainWindow_glade.cc:246
 msgid "_Index"
 msgstr "?nd_ice"
 
-#: UI/GTK2/src/mainWindow_glade.cc:218
+#: UI/GTK2/src/mainWindow_glade.cc:213
 msgid "List Contents Of"
 msgstr "Mostrar conte?do(s) de"
 
-#: UI/GTK2/src/mainWindow_glade.cc:227
+#: UI/GTK2/src/mainWindow_glade.cc:222
 msgid "View"
 msgstr "Visualizar"
 
-#: UI/GTK2/src/mainWindow_glade.cc:230
+#: UI/GTK2/src/mainWindow_glade.cc:225
 msgid "Update"
 msgstr "Actualizar"
 
-#: UI/GTK2/src/mainWindow_glade.cc:233
+#: UI/GTK2/src/mainWindow_glade.cc:228
 msgid "Unindex"
 msgstr "Retirar do ?ndice"
 
-#: UI/GTK2/src/mainWindow_glade.cc:236
-#: UI/GTK2/src/propertiesDialog_glade.cc:177
+#: UI/GTK2/src/mainWindow_glade.cc:231
+#: UI/GTK2/src/propertiesDialog_glade.cc:225
 msgid "Properties"
 msgstr "Propriedades"
 
-#: UI/GTK2/src/mainWindow_glade.cc:239
+#: UI/GTK2/src/mainWindow_glade.cc:234
 msgid "_About"
 msgstr "_Sobre"
 
-#: UI/GTK2/src/mainWindow_glade.cc:242
+#: UI/GTK2/src/mainWindow_glade.cc:237
 msgid "_Session"
 msgstr "_Sess?o"
 
-#: UI/GTK2/src/mainWindow_glade.cc:245
+#: UI/GTK2/src/mainWindow_glade.cc:240
 msgid "_Edit"
 msgstr "_Editar"
 
-#: UI/GTK2/src/mainWindow_glade.cc:248
+#: UI/GTK2/src/mainWindow_glade.cc:243
 msgid "_Results"
 msgstr "_Resultados"
 
-#: UI/GTK2/src/mainWindow_glade.cc:254
+#: UI/GTK2/src/mainWindow_glade.cc:249
 msgid "_Help"
 msgstr "_Ajuda"
 
-#: UI/GTK2/src/mainWindow_glade.cc:403
+#: UI/GTK2/src/mainWindow_glade.cc:378
 msgid "Pinot"
 msgstr "Pinot"
 
 #. Localize language names
-#: UI/GTK2/src/pinot.cc:249 UI/GTK2/src/pinot-dbus-daemon.cc:324
-#: UI/GTK2/src/propertiesDialog.cc:72 UI/GTK2/src/propertiesDialog.cc:81
+#: UI/GTK2/src/pinot.cc:233 UI/GTK2/src/pinot-dbus-daemon.cc:312
+#: UI/GTK2/src/propertiesDialog.cc:97
 msgid "Unknown"
 msgstr "Desconhecido"
 
-#: UI/GTK2/src/pinot.cc:250 UI/GTK2/src/pinot-dbus-daemon.cc:325
+#: UI/GTK2/src/pinot.cc:234 UI/GTK2/src/pinot-dbus-daemon.cc:313
 msgid "Danish"
 msgstr "Dinamarqu?s"
 
-#: UI/GTK2/src/pinot.cc:251 UI/GTK2/src/pinot-dbus-daemon.cc:326
+#: UI/GTK2/src/pinot.cc:235 UI/GTK2/src/pinot-dbus-daemon.cc:314
 msgid "Dutch"
 msgstr "Holand?s"
 
-#: UI/GTK2/src/pinot.cc:252 UI/GTK2/src/pinot-dbus-daemon.cc:327
+#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:315
 msgid "English"
 msgstr "Ingl?s"
 
-#: UI/GTK2/src/pinot.cc:253 UI/GTK2/src/pinot-dbus-daemon.cc:328
+#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:316
 msgid "Finnish"
 msgstr "Finl?ndes"
 
-#: UI/GTK2/src/pinot.cc:254 UI/GTK2/src/pinot-dbus-daemon.cc:329
+#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:317
 msgid "French"
 msgstr "Franc?s"
 
-#: UI/GTK2/src/pinot.cc:255 UI/GTK2/src/pinot-dbus-daemon.cc:330
+#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:318
 msgid "German"
 msgstr "Alem?o"
 
-#: UI/GTK2/src/pinot.cc:256 UI/GTK2/src/pinot-dbus-daemon.cc:331
+#: UI/GTK2/src/pinot.cc:240 UI/GTK2/src/pinot-dbus-daemon.cc:319
 msgid "Hungarian"
 msgstr "H?ngaro"
 
-#: UI/GTK2/src/pinot.cc:257 UI/GTK2/src/pinot-dbus-daemon.cc:332
+#: UI/GTK2/src/pinot.cc:241 UI/GTK2/src/pinot-dbus-daemon.cc:320
 msgid "Italian"
 msgstr "Italiano"
 
-#: UI/GTK2/src/pinot.cc:258 UI/GTK2/src/pinot-dbus-daemon.cc:333
+#: UI/GTK2/src/pinot.cc:242 UI/GTK2/src/pinot-dbus-daemon.cc:321
 msgid "Norwegian"
 msgstr "Noruegu?s"
 
-#: UI/GTK2/src/pinot.cc:259 UI/GTK2/src/pinot-dbus-daemon.cc:334
+#: UI/GTK2/src/pinot.cc:243 UI/GTK2/src/pinot-dbus-daemon.cc:322
 msgid "Portuguese"
 msgstr "Portugu?s"
 
-#: UI/GTK2/src/pinot.cc:260 UI/GTK2/src/pinot-dbus-daemon.cc:335
+#: UI/GTK2/src/pinot.cc:244 UI/GTK2/src/pinot-dbus-daemon.cc:323
 msgid "Romanian"
 msgstr "Romeno"
 
-#: UI/GTK2/src/pinot.cc:261 UI/GTK2/src/pinot-dbus-daemon.cc:336
+#: UI/GTK2/src/pinot.cc:245 UI/GTK2/src/pinot-dbus-daemon.cc:324
 msgid "Russian"
 msgstr "Russo"
 
-#: UI/GTK2/src/pinot.cc:262 UI/GTK2/src/pinot-dbus-daemon.cc:337
+#: UI/GTK2/src/pinot.cc:246 UI/GTK2/src/pinot-dbus-daemon.cc:325
 msgid "Spanish"
 msgstr "Espanhol"
 
-#: UI/GTK2/src/pinot.cc:263 UI/GTK2/src/pinot-dbus-daemon.cc:338
+#: UI/GTK2/src/pinot.cc:247 UI/GTK2/src/pinot-dbus-daemon.cc:326
 msgid "Swedish"
 msgstr "Sueco"
 
-#: UI/GTK2/src/pinot.cc:264 UI/GTK2/src/pinot-dbus-daemon.cc:339
+#: UI/GTK2/src/pinot.cc:248 UI/GTK2/src/pinot-dbus-daemon.cc:327
 msgid "Turkish"
 msgstr "Turco"
 
-#: UI/GTK2/src/pinot.cc:289
+#: UI/GTK2/src/pinot.cc:273
 msgid "Couldn't open index"
 msgstr "N?o foi poss?vel abrir o ?ndice"
 
-#: UI/GTK2/src/pinot.cc:310
+#: UI/GTK2/src/pinot.cc:294
 msgid "Couldn't create history database"
 msgstr "N?o foi poss?vel criar base de dados do hist?rico"
 
-#: UI/GTK2/src/pinot.cc:336
+#. Warn the user
+#: UI/GTK2/src/pinot.cc:330
 msgid "Updating all documents in My Web Pages is recommended"
 msgstr "A actualizar todos os documentos nas Minhas P?ginas Web ? recomendado"
 
@@ -543,39 +577,43 @@
 msgid "Personal"
 msgstr "Pessoal"
 
-#: UI/GTK2/src/PinotSettings.cpp:1198
+#: UI/GTK2/src/PinotSettings.cpp:358
+msgid "Me"
+msgstr ""
+
+#: UI/GTK2/src/PinotSettings.cpp:1233
 msgid "Unclassified"
 msgstr "N?o classificado"
 
-#: UI/GTK2/src/prefsDialog.cc:81
+#: UI/GTK2/src/prefsDialog.cc:83
 msgid "Name"
 msgstr "Nome :"
 
-#: UI/GTK2/src/prefsDialog.cc:89
+#: UI/GTK2/src/prefsDialog.cc:91
 msgid "Monitor"
 msgstr "Supervisar"
 
-#: UI/GTK2/src/prefsDialog.cc:90
+#: UI/GTK2/src/prefsDialog.cc:92
 msgid "Location"
 msgstr "Localiza??o"
 
-#: UI/GTK2/src/prefsDialog.cc:98
+#: UI/GTK2/src/prefsDialog.cc:100
 msgid "Pattern"
 msgstr "Padr?o:"
 
-#: UI/GTK2/src/prefsDialog.cc:315
+#: UI/GTK2/src/prefsDialog.cc:357
 msgid "Exclude these patterns from indexing"
 msgstr ""
 
-#: UI/GTK2/src/prefsDialog.cc:316
+#: UI/GTK2/src/prefsDialog.cc:358
 msgid "Only index these patterns"
 msgstr ""
 
-#: UI/GTK2/src/prefsDialog.cc:406
+#: UI/GTK2/src/prefsDialog.cc:478
 msgid "New Label"
 msgstr "Novo t?tulo"
 
-#: UI/GTK2/src/prefsDialog.cc:447
+#: UI/GTK2/src/prefsDialog.cc:519
 msgid "Directory to index"
 msgstr "Direct?rio a indexar"
 
@@ -632,7 +670,7 @@
 msgid "Remove"
 msgstr "Remover"
 
-#: UI/GTK2/src/prefsDialog_glade.cc:113
+#: UI/GTK2/src/prefsDialog_glade.cc:113 UI/GTK2/src/propertiesDialog.cc:56
 msgid "Labels"
 msgstr "Etiquetas"
 
@@ -655,79 +693,98 @@
 msgid "Preferences"
 msgstr "Prefer?ncias"
 
-#: UI/GTK2/src/propertiesDialog.cc:60 UI/GTK2/src/queryDialog.cc:124
-msgid "Label"
-msgstr "Etiqueta"
-
-#: UI/GTK2/src/propertiesDialog.cc:93
+#: UI/GTK2/src/propertiesDialog.cc:110
 msgid "Per document"
 msgstr "Por documento"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:68
+#: UI/GTK2/src/propertiesDialog.cc:368
+#, fuzzy
+msgid "Export Terms"
+msgstr "resultados"
+
+#: UI/GTK2/src/propertiesDialog_glade.cc:65
 msgid "Language:"
 msgstr "Idioma:"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:69
+#: UI/GTK2/src/propertiesDialog_glade.cc:66
 msgid "MIME type:"
 msgstr "Tipo MIME:"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:70
+#: UI/GTK2/src/propertiesDialog_glade.cc:67
 msgid "Size:"
 msgstr "Tamanho:"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:73
+#: UI/GTK2/src/propertiesDialog_glade.cc:68
 msgid "Terms:"
 msgstr "Termos:"
 
-#: UI/GTK2/src/queryDialog.cc:114
+#: UI/GTK2/src/propertiesDialog_glade.cc:78
+msgid "bytes"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog.cc:94
 msgid "Host name"
 msgstr "Nome da m?quina"
 
-#: UI/GTK2/src/queryDialog.cc:115
+#: UI/GTK2/src/queryDialog.cc:95
 msgid "File name"
 msgstr "Nome do ficheiro"
 
-#: UI/GTK2/src/queryDialog.cc:118
+#: UI/GTK2/src/queryDialog.cc:96
 msgid "File extension"
 msgstr "Extens?o do ficheiro"
 
 #. This is the title column
-#: UI/GTK2/src/queryDialog.cc:119 UI/GTK2/src/ResultsTree.cpp:133
+#: UI/GTK2/src/queryDialog.cc:97 UI/GTK2/src/ResultsTree.cpp:133
 msgid "Title"
 msgstr "Titulo"
 
 #. URL
-#: UI/GTK2/src/queryDialog.cc:120 UI/GTK2/src/ResultsTree.cpp:143
+#: UI/GTK2/src/queryDialog.cc:98 UI/GTK2/src/ResultsTree.cpp:143
 msgid "URL"
 msgstr "URL"
 
-#: UI/GTK2/src/queryDialog.cc:121
+#: UI/GTK2/src/queryDialog.cc:99
 msgid "Directory"
 msgstr "Direct?rio"
 
-#: UI/GTK2/src/queryDialog.cc:122
+#: UI/GTK2/src/queryDialog.cc:100
 msgid "Language code"
 msgstr "C?digo do idioma"
 
-#: UI/GTK2/src/queryDialog.cc:123
+#: UI/GTK2/src/queryDialog.cc:101
 msgid "MIME type"
 msgstr "Tipo MIME"
 
+#: UI/GTK2/src/queryDialog.cc:102
+msgid "Label"
+msgstr "Etiqueta"
+
 #. The last column is for the timestamp
-#: UI/GTK2/src/queryDialog.cc:127 UI/GTK2/src/ResultsTree.cpp:151
+#: UI/GTK2/src/queryDialog.cc:105 UI/GTK2/src/ResultsTree.cpp:151
 msgid "Date"
 msgstr "Data"
 
-#: UI/GTK2/src/queryDialog.cc:128
+#: UI/GTK2/src/queryDialog.cc:106
 #, fuzzy
 msgid "Time"
 msgstr "Titulo"
 
-#: UI/GTK2/src/queryDialog.cc:129
+#: UI/GTK2/src/queryDialog.cc:107
 #, fuzzy
 msgid "Size"
 msgstr "Tamanho:"
 
+#. Sort order
+#: UI/GTK2/src/queryDialog.cc:111
+msgid "By relevance"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog.cc:112
+#, fuzzy
+msgid "By date"
+msgstr "Actualizar"
+
 #: UI/GTK2/src/queryDialog_glade.cc:72
 #, fuzzy
 msgid "New filter or range:"
@@ -745,7 +802,11 @@
 msgid "Number of results:"
 msgstr "N?mero de resultados:"
 
-#: UI/GTK2/src/queryDialog_glade.cc:181
+#: UI/GTK2/src/queryDialog_glade.cc:90
+msgid "Sort order:"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog_glade.cc:192
 msgid "Query parameters"
 msgstr "Par?metros da consulta"
 
@@ -758,124 +819,131 @@
 msgid "Extract"
 msgstr "Extrair"
 
-#: UI/GTK2/src/statisticsDialog.cc:72
+#: UI/GTK2/src/statisticsDialog.cc:73
 msgid "Indexes"
 msgstr "?ndices"
 
-#: UI/GTK2/src/statisticsDialog.cc:87
-msgid "History"
-msgstr "Hist?rico"
-
-#: UI/GTK2/src/statisticsDialog.cc:92
+#: UI/GTK2/src/statisticsDialog.cc:93
 msgid "Daemon"
 msgstr "Daemon"
 
-#: UI/GTK2/src/statisticsDialog.cc:128 UI/GTK2/src/statisticsDialog.cc:143
+#: UI/GTK2/src/statisticsDialog.cc:128 UI/GTK2/src/statisticsDialog.cc:144
 msgid "documents"
 msgstr "documentos"
 
-#: UI/GTK2/src/statisticsDialog.cc:132 UI/GTK2/src/statisticsDialog.cc:147
+#: UI/GTK2/src/statisticsDialog.cc:134 UI/GTK2/src/statisticsDialog.cc:150
+#: UI/GTK2/src/WorkerThreads.cpp:126
 msgid "Unknown error"
 msgstr "Erro desconhecido"
 
-#: UI/GTK2/src/statisticsDialog.cc:154
+#: UI/GTK2/src/statisticsDialog.cc:157
 msgid "Viewed"
 msgstr "Visualizado"
 
-#: UI/GTK2/src/statisticsDialog.cc:154
+#: UI/GTK2/src/statisticsDialog.cc:157
 msgid "results"
 msgstr "resultados"
 
 #. FIXME: check whether it's actually running !
-#: UI/GTK2/src/statisticsDialog.cc:171
+#: UI/GTK2/src/statisticsDialog.cc:174
 msgid "Running under PID"
 msgstr "A correr com o PID"
 
-#: UI/GTK2/src/statisticsDialog.cc:175
+#: UI/GTK2/src/statisticsDialog.cc:178
 msgid "Currently not running"
 msgstr "Presentemente n?o est? a correr"
 
-#: UI/GTK2/src/statisticsDialog.cc:182
+#: UI/GTK2/src/statisticsDialog.cc:185
 msgid "Crawled"
 msgstr ""
 
-#: UI/GTK2/src/statisticsDialog.cc:182
+#: UI/GTK2/src/statisticsDialog.cc:185
 msgid "files"
 msgstr "ficheiros"
 
-#: UI/GTK2/src/statisticsDialog.cc:205
+#: UI/GTK2/src/statisticsDialog.cc:206
 msgid "Errors"
 msgstr "Erros"
 
-#: UI/GTK2/src/WorkerThreads.cpp:307
-msgid "Can't index mail here"
-msgstr "N?o foi poss?vel indexar o mail aqui"
+#: UI/GTK2/src/WorkerThreads.cpp:93
+#, fuzzy
+msgid "Index error"
+msgstr "Erro na indexa??o em"
 
-#: UI/GTK2/src/WorkerThreads.cpp:328 UI/GTK2/src/WorkerThreads.cpp:581
-msgid "is already being indexed"
-msgstr "j? est? a ser indexado"
+#: UI/GTK2/src/WorkerThreads.cpp:95
+#, fuzzy
+msgid "Couldn't index document"
+msgstr "N?o foi poss?vel remover documento(s) do ?ndice"
 
-#: UI/GTK2/src/WorkerThreads.cpp:338
-msgid "is blacklisted"
-msgstr "est? na lista negra"
+#: UI/GTK2/src/WorkerThreads.cpp:97
+msgid "Couldn't update document"
+msgstr "N?o foi poss?vel actualizar o documento"
 
-#: UI/GTK2/src/WorkerThreads.cpp:691 UI/GTK2/src/WorkerThreads.cpp:1051
-#: UI/GTK2/src/WorkerThreads.cpp:1135 UI/GTK2/src/WorkerThreads.cpp:1144
-#: UI/GTK2/src/WorkerThreads.cpp:1330 UI/GTK2/src/WorkerThreads.cpp:1600
-#: UI/GTK2/src/WorkerThreads.cpp:1733
-msgid "Index error on"
-msgstr "Erro na indexa??o em"
+#: UI/GTK2/src/WorkerThreads.cpp:99
+msgid "Couldn't unindex document(s)"
+msgstr "N?o foi poss?vel remover documento(s) do ?ndice"
 
-#: UI/GTK2/src/WorkerThreads.cpp:844
-msgid "No title"
-msgstr "Sem t?tulo"
-
-#: UI/GTK2/src/WorkerThreads.cpp:946 UI/GTK2/src/WorkerThreads.cpp:1072
-msgid "Couldn't create search engine"
-msgstr "N?o foi poss?vel criar mecanismo de pesquisa"
-
-#: UI/GTK2/src/WorkerThreads.cpp:970 UI/GTK2/src/WorkerThreads.cpp:1085
+#: UI/GTK2/src/WorkerThreads.cpp:101
 msgid "Couldn't run query on search engine"
 msgstr "N?o foi poss?vel efectuar consulta no mecanismo de pesquisa"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1238
-msgid "Couldn't obtain downloader for protocol"
-msgstr "N?o foi poss?vel obter fonte de transfer?ncia para o protocolo"
+#: UI/GTK2/src/WorkerThreads.cpp:103
+#, fuzzy
+msgid "Couldn't get history for search engine"
+msgstr "N?o foi poss?vel efectuar consulta no mecanismo de pesquisa"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1263
-msgid "Couldn't retrieve"
-msgstr "N?o foi poss?vel carregar"
+#: UI/GTK2/src/WorkerThreads.cpp:105
+#, fuzzy
+msgid "Couldn't retrieve document"
+msgstr "N?o foi poss?vel actualizar o documento"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1360 UI/GTK2/src/WorkerThreads.cpp:1439
+#: UI/GTK2/src/WorkerThreads.cpp:107
+msgid "Couldn't initialize file monitor"
+msgstr ""
+
+#: UI/GTK2/src/WorkerThreads.cpp:109
+#, fuzzy
+msgid "Couldn't open directory"
+msgstr "N?o foi poss?vel abrir o ?ndice"
+
+#: UI/GTK2/src/WorkerThreads.cpp:111
+#, fuzzy
+msgid "Index doesn't exist"
+msgstr "n?o existe"
+
+#: UI/GTK2/src/WorkerThreads.cpp:113
+msgid "Couldn't create search engine"
+msgstr "N?o foi poss?vel criar mecanismo de pesquisa"
+
+#: UI/GTK2/src/WorkerThreads.cpp:115
 msgid "Cannot index document type"
 msgstr "Imposs?vel indexar tipo de ficheiro"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1364 UI/GTK2/src/WorkerThreads.cpp:1443
-msgid "at"
-msgstr "no"
+#: UI/GTK2/src/WorkerThreads.cpp:117
+#, fuzzy
+msgid "No downloader for this protocol"
+msgstr "N?o foi poss?vel obter fonte de transfer?ncia para o protocolo"
 
-#. No, it isn't
-#: UI/GTK2/src/WorkerThreads.cpp:1475
+#: UI/GTK2/src/WorkerThreads.cpp:119
 msgid "Robots META tag forbids indexing"
 msgstr "Robots META tag n?o s?o permitidos no ?ndice"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1529
-msgid "Couldn't index"
-msgstr "N?o foi poss?vel indexar"
+#: UI/GTK2/src/WorkerThreads.cpp:121
+msgid "No monitoring handler"
+msgstr ""
 
-#. Be pessimistic and assume something will go wrong ;-)
-#: UI/GTK2/src/WorkerThreads.cpp:1611
-msgid "Couldn't unindex document(s)"
-msgstr "N?o foi poss?vel remover documento(s) do ?ndice"
+#: UI/GTK2/src/WorkerThreads.cpp:391
+msgid "Can't index mail here"
+msgstr "N?o foi poss?vel indexar o mail aqui"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1745
-msgid "Couldn't update document"
-msgstr "N?o foi poss?vel actualizar o documento"
+#: UI/GTK2/src/WorkerThreads.cpp:412 UI/GTK2/src/WorkerThreads.cpp:666
+msgid "is already being indexed"
+msgstr "j? est? a ser indexado"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1981
-msgid "No monitoring handler"
-msgstr ""
+#: UI/GTK2/src/WorkerThreads.cpp:422
+msgid "is blacklisted"
+msgstr "est? na lista negra"
 
-#: UI/GTK2/src/WorkerThreads.cpp:2023
-msgid "Couldn't initialize file monitor"
-msgstr ""
+#: UI/GTK2/src/WorkerThreads.cpp:935
+msgid "No title"
+msgstr "Sem t?tulo"

Modified: trunk/po/pt_BR.po
===================================================================
--- trunk/po/pt_BR.po	2007-10-27 03:47:11 UTC (rev 1076)
+++ trunk/po/pt_BR.po	2007-10-27 12:57:33 UTC (rev 1077)
@@ -6,14 +6,14 @@
 msgstr ""
 "Project-Id-Version: pinot 0.75\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2007-09-23 19:22+0800\n"
+"POT-Creation-Date: 2007-10-27 00:15+0800\n"
 "PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
 "Last-Translator: Leonardo Melo <leonardovazmelo at gmail.com>\n"
 "Language-Team: Portuguese (Brazil) <pt_BR at li.org>\n"
 "MIME-Version: 1.0\n"
 "Content-Type: text/plain; charset=UTF-8\n"
 "Content-Transfer-Encoding: 8bit\n"
-"X-Launchpad-Export-Date: 2007-09-23 13:58+0000\n"
+"X-Launchpad-Export-Date: 2007-10-27 12:48+0000\n"
 "X-Generator: Launchpad (build Unknown)\n"
 
 #: UI/GTK2/src/EnginesTree.cpp:68
@@ -27,22 +27,22 @@
 #. Enable these menu items unless it is not the documents index
 #. Allow this only for internal indexes
 #. Internal indices
-#: UI/GTK2/src/EnginesTree.cpp:337 UI/GTK2/src/mainWindow.cc:677
-#: UI/GTK2/src/mainWindow.cc:1187 UI/GTK2/src/mainWindow.cc:1339
-#: UI/GTK2/src/mainWindow.cc:1381 UI/GTK2/src/mainWindow.cc:1403
-#: UI/GTK2/src/mainWindow.cc:1434 UI/GTK2/src/mainWindow.cc:2045
-#: UI/GTK2/src/mainWindow.cc:2157 UI/GTK2/src/PinotSettings.cpp:311
-#: UI/GTK2/src/PinotSettings.cpp:1387 UI/GTK2/src/PinotSettings.cpp:1443
-#: UI/GTK2/src/statisticsDialog.cc:77 UI/GTK2/src/WorkerThreads.cpp:822
-#: UI/GTK2/src/WorkerThreads.cpp:881
+#: UI/GTK2/src/EnginesTree.cpp:337 UI/GTK2/src/mainWindow.cc:795
+#: UI/GTK2/src/mainWindow.cc:1017 UI/GTK2/src/mainWindow.cc:1354
+#: UI/GTK2/src/mainWindow.cc:1509 UI/GTK2/src/mainWindow.cc:1551
+#: UI/GTK2/src/mainWindow.cc:1573 UI/GTK2/src/mainWindow.cc:2177
+#: UI/GTK2/src/mainWindow.cc:2287 UI/GTK2/src/PinotSettings.cpp:311
+#: UI/GTK2/src/PinotSettings.cpp:1421 UI/GTK2/src/PinotSettings.cpp:1477
+#: UI/GTK2/src/statisticsDialog.cc:78 UI/GTK2/src/WorkerThreads.cpp:972
 msgid "My Web Pages"
 msgstr "Minhas P?ginas Web"
 
-#: UI/GTK2/src/EnginesTree.cpp:338 UI/GTK2/src/mainWindow.cc:680
-#: UI/GTK2/src/mainWindow.cc:1194 UI/GTK2/src/mainWindow.cc:2158
-#: UI/GTK2/src/PinotSettings.cpp:312 UI/GTK2/src/PinotSettings.cpp:1388
-#: UI/GTK2/src/PinotSettings.cpp:1444 UI/GTK2/src/statisticsDialog.cc:82
-#: UI/GTK2/src/WorkerThreads.cpp:827 UI/GTK2/src/WorkerThreads.cpp:891
+#. Spawn new threads
+#: UI/GTK2/src/EnginesTree.cpp:338 UI/GTK2/src/mainWindow.cc:798
+#: UI/GTK2/src/mainWindow.cc:1011 UI/GTK2/src/mainWindow.cc:1361
+#: UI/GTK2/src/mainWindow.cc:2291 UI/GTK2/src/PinotSettings.cpp:312
+#: UI/GTK2/src/PinotSettings.cpp:1422 UI/GTK2/src/PinotSettings.cpp:1478
+#: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:982
 msgid "My Documents"
 msgstr "Meus Documentos"
 
@@ -87,12 +87,13 @@
 msgid "External index"
 msgstr "?ndice externo"
 
-#: UI/GTK2/src/importDialog.cc:87 UI/GTK2/src/queryDialog.cc:95
+#. Labels
+#: UI/GTK2/src/importDialog.cc:87 UI/GTK2/src/queryDialog.cc:123
 msgid "None"
 msgstr "Nenhum"
 
 #: UI/GTK2/src/importDialog_glade.cc:68
-#: UI/GTK2/src/propertiesDialog_glade.cc:67
+#: UI/GTK2/src/propertiesDialog_glade.cc:64
 msgid "Title:"
 msgstr "T?tulo:"
 
@@ -104,7 +105,7 @@
 msgid "Import"
 msgstr "Importar"
 
-#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:221
+#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:216
 msgid "Import URL"
 msgstr "Importar URL"
 
@@ -134,398 +135,432 @@
 msgid "Helper application"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:211
+#: UI/GTK2/src/mainWindow.cc:212
 msgid "Query Name"
 msgstr "Nome da consulta"
 
-#: UI/GTK2/src/mainWindow.cc:216
+#: UI/GTK2/src/mainWindow.cc:217
 msgid "Last Run"
 msgstr "?ltimo executado"
 
-#: UI/GTK2/src/mainWindow.cc:221
+#: UI/GTK2/src/mainWindow.cc:222
 msgid "Summary"
 msgstr "Resumo"
 
 #. Set tooltips
-#: UI/GTK2/src/mainWindow.cc:255
+#: UI/GTK2/src/mainWindow.cc:252
 msgid "Show all search engines"
 msgstr "Mostrar todos mecanimos de pesquisa"
 
-#: UI/GTK2/src/mainWindow.cc:256
-msgid "Add index"
+#: UI/GTK2/src/mainWindow.cc:253
+msgid "Find documents that match the query string"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:254
+#, fuzzy
+msgid "Add an index"
 msgstr "Adicionar ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:257
-msgid "Remove index"
+#: UI/GTK2/src/mainWindow.cc:255
+#, fuzzy
+msgid "Remove an index"
 msgstr "Remover ?ndice"
 
+#: UI/GTK2/src/mainWindow.cc:256
+#, fuzzy
+msgid "Add a query"
+msgstr "Adicionar nova consulta"
+
+#: UI/GTK2/src/mainWindow.cc:257
+#, fuzzy
+msgid "Remove a query"
+msgstr "Query ativa"
+
+#: UI/GTK2/src/mainWindow.cc:258
+msgid "Show the query's previous results"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:259
+msgid "Find documents that match the query"
+msgstr ""
+
 #. Now we are ready
-#: UI/GTK2/src/mainWindow.cc:282
+#: UI/GTK2/src/mainWindow.cc:289
 msgid "Ready"
 msgstr "Pronto"
 
-#: UI/GTK2/src/mainWindow.cc:342
+#: UI/GTK2/src/mainWindow.cc:349
 msgid "N/A"
 msgstr "N/A"
 
-#: UI/GTK2/src/mainWindow.cc:357
+#: UI/GTK2/src/mainWindow.cc:364
 #, fuzzy
 msgid "Undefined"
 msgstr "<indefinido>"
 
+#. Find this query
+#: UI/GTK2/src/mainWindow.cc:587 UI/GTK2/src/mainWindow.cc:2675
+msgid "Live query"
+msgstr "Query ativa"
+
 #. Show the URL of the first result in the status bar
-#: UI/GTK2/src/mainWindow.cc:611
+#: UI/GTK2/src/mainWindow.cc:727
 msgid "Result location is"
 msgstr "Local resultante ?"
 
 #. Show the URL in the status bar
-#: UI/GTK2/src/mainWindow.cc:691
+#: UI/GTK2/src/mainWindow.cc:809
 msgid "Document location is"
 msgstr "Localiza??o do documento ?"
 
-#: UI/GTK2/src/mainWindow.cc:1024
+#: UI/GTK2/src/mainWindow.cc:993 UI/GTK2/src/mainWindow.cc:2109
+msgid "Couldn't find query"
+msgstr "N?o foi poss?vel encontrar consulta"
+
+#: UI/GTK2/src/mainWindow.cc:1008
+#, fuzzy
+msgid "In Results"
+msgstr "_Resultados"
+
+#: UI/GTK2/src/mainWindow.cc:1191
 msgid "Showing"
 msgstr "Exibindo"
 
-#: UI/GTK2/src/mainWindow.cc:1029
+#: UI/GTK2/src/mainWindow.cc:1196
 msgid "of"
 msgstr "de"
 
-#: UI/GTK2/src/mainWindow.cc:1034
+#: UI/GTK2/src/mainWindow.cc:1201
 msgid "documents, starting at"
 msgstr "documentos, come?am no"
 
-#: UI/GTK2/src/mainWindow.cc:1068
+#: UI/GTK2/src/mainWindow.cc:1235
 msgid "Query"
 msgstr "Consulta"
 
-#: UI/GTK2/src/mainWindow.cc:1072 UI/GTK2/src/mainWindow.cc:3177
+#: UI/GTK2/src/mainWindow.cc:1239 UI/GTK2/src/mainWindow.cc:3268
 msgid "on"
 msgstr "no"
 
-#: UI/GTK2/src/mainWindow.cc:1076
+#: UI/GTK2/src/mainWindow.cc:1243
 msgid "ended"
 msgstr "finalizada"
 
-#: UI/GTK2/src/mainWindow.cc:1137
+#: UI/GTK2/src/mainWindow.cc:1304
 msgid "Corrected"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:1223
+#: UI/GTK2/src/mainWindow.cc:1393
 msgid "More Like"
 msgstr "Mais pr?xima"
 
-#: UI/GTK2/src/mainWindow.cc:1265
+#: UI/GTK2/src/mainWindow.cc:1435
 msgid "Updated label(s)"
 msgstr "T?tulo(s) atualizado(s)"
 
 #. Yes, it did
-#: UI/GTK2/src/mainWindow.cc:1349
+#: UI/GTK2/src/mainWindow.cc:1519 UI/GTK2/src/mainWindow.cc:1613
 msgid "Updated document"
 msgstr "Documento atualizado"
 
-#: UI/GTK2/src/mainWindow.cc:1362
+#: UI/GTK2/src/mainWindow.cc:1532
 msgid "Indexed"
 msgstr "Indexado"
 
-#: UI/GTK2/src/mainWindow.cc:1404
+#: UI/GTK2/src/mainWindow.cc:1574
 msgid "Unindexed document(s)"
 msgstr "Documento(s) n?o indexidado(s)"
 
-#: UI/GTK2/src/mainWindow.cc:1444
-msgid "Updated document properties"
-msgstr "Propriedade de documentos atualizados"
-
-#: UI/GTK2/src/mainWindow.cc:1497
+#: UI/GTK2/src/mainWindow.cc:1671
 msgid "Couldn't rename index, name"
 msgstr "N?o foi poss?vel renomear ?ndice, nome"
 
-#: UI/GTK2/src/mainWindow.cc:1501 UI/GTK2/src/mainWindow.cc:2441
-#: UI/GTK2/src/mainWindow.cc:2982
+#: UI/GTK2/src/mainWindow.cc:1675 UI/GTK2/src/mainWindow.cc:2501
+#: UI/GTK2/src/mainWindow.cc:3072
 msgid "is already in use"
 msgstr "j? est? em uso"
 
-#: UI/GTK2/src/mainWindow.cc:1514
+#: UI/GTK2/src/mainWindow.cc:1688
 msgid "Couldn't rename index"
 msgstr "N?o foi poss?vel renomear ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:1527
+#: UI/GTK2/src/mainWindow.cc:1701
 msgid "Edited index"
 msgstr "?ndice editado"
 
-#: UI/GTK2/src/mainWindow.cc:1853
+#: UI/GTK2/src/mainWindow.cc:2029
 #, fuzzy
 msgid "Export Results"
 msgstr "_Resultados"
 
-#. Find this query
-#: UI/GTK2/src/mainWindow.cc:1942 UI/GTK2/src/mainWindow.cc:2615
-msgid "Live query"
-msgstr "Query ativa"
-
-#: UI/GTK2/src/mainWindow.cc:1968
-msgid "Couldn't find query"
-msgstr "N?o foi poss?vel encontrar consulta"
-
-#: UI/GTK2/src/mainWindow.cc:2167 UI/GTK2/src/WorkerThreads.cpp:678
-#: UI/GTK2/src/WorkerThreads.cpp:1720
+#: UI/GTK2/src/mainWindow.cc:2304
 msgid "Index"
 msgstr "?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2171 UI/GTK2/src/WorkerThreads.cpp:682
-#: UI/GTK2/src/WorkerThreads.cpp:1724
+#: UI/GTK2/src/mainWindow.cc:2308
 msgid "doesn't exist"
 msgstr "n?o existe"
 
-#: UI/GTK2/src/mainWindow.cc:2326
+#: UI/GTK2/src/mainWindow.cc:2386
 msgid "Remove this document from the index ?"
 msgstr "Remover documento do ?ndice?"
 
-#: UI/GTK2/src/mainWindow.cc:2345
+#: UI/GTK2/src/mainWindow.cc:2405
 msgid "Remove these documents from the index ?"
 msgstr "Remover documentos do ?ndice?"
 
-#: UI/GTK2/src/mainWindow.cc:2391
+#: UI/GTK2/src/mainWindow.cc:2451
 msgid "A metasearch tool for the Free Desktop"
 msgstr "Um mecanismo de metabusca gr?tis para Desktop"
 
-#: UI/GTK2/src/mainWindow.cc:2392
+#: UI/GTK2/src/mainWindow.cc:2452
 msgid "Search the Web and your documents !"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:2437
+#: UI/GTK2/src/mainWindow.cc:2497
 msgid "Index name"
 msgstr "Nome do ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2452
+#: UI/GTK2/src/mainWindow.cc:2512
 msgid "Couldn't add index"
 msgstr "N?o foi poss?vel adicionar ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2468
+#: UI/GTK2/src/mainWindow.cc:2528
 msgid "Added new index"
 msgstr "Adicionar novo ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2503
+#: UI/GTK2/src/mainWindow.cc:2563
 msgid "Couldn't remove index"
 msgstr "N?o foi poss?vel remover ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2795
+#: UI/GTK2/src/mainWindow.cc:2768
+msgid "No history for"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:2884
 msgid "At least one task hasn't completed yet. Quit now ?"
 msgstr "Pelo menos uma tarefa n?o terminou ainda. Sair assim mesmo?"
 
-#: UI/GTK2/src/mainWindow.cc:2978
+#: UI/GTK2/src/mainWindow.cc:3068
 msgid "Query name"
 msgstr "Nome da consulta"
 
-#: UI/GTK2/src/mainWindow.cc:3005
+#: UI/GTK2/src/mainWindow.cc:3095
 msgid "Couldn't update query"
 msgstr "N?o foi poss?vel atualizar consulta"
 
-#: UI/GTK2/src/mainWindow.cc:3013
+#: UI/GTK2/src/mainWindow.cc:3103
 msgid "Edited query"
 msgstr "Consulta editada"
 
-#: UI/GTK2/src/mainWindow.cc:3020
+#: UI/GTK2/src/mainWindow.cc:3110
 msgid "Couldn't add query"
 msgstr "N?o foi poss?vel adicionar consulta"
 
-#: UI/GTK2/src/mainWindow.cc:3028
+#: UI/GTK2/src/mainWindow.cc:3118
 msgid "Added new query"
 msgstr "Adicionar nova consulta"
 
-#: UI/GTK2/src/mainWindow.cc:3066
+#: UI/GTK2/src/mainWindow.cc:3157
 msgid "Query is not set"
 msgstr "Consulta n?o foi atualizada"
 
-#: UI/GTK2/src/mainWindow.cc:3077
+#: UI/GTK2/src/mainWindow.cc:3168
 msgid "No search engine selected"
 msgstr "Nenhum mecanismo de pesquisa selecionado"
 
-#: UI/GTK2/src/mainWindow.cc:3164
+#: UI/GTK2/src/mainWindow.cc:3255
 msgid "Please set the Google API key first"
 msgstr "Primeiro informe a tecla para Google API"
 
-#: UI/GTK2/src/mainWindow.cc:3173
+#: UI/GTK2/src/mainWindow.cc:3264
 msgid "Running query"
 msgstr "Executando consulta"
 
-#: UI/GTK2/src/mainWindow.cc:3382
+#: UI/GTK2/src/mainWindow.cc:3473
 msgid "No default application defined for type"
 msgstr "Aplica??o associada ao tipo n?o definida"
 
-#: UI/GTK2/src/mainWindow_glade.cc:126
+#: UI/GTK2/src/mainWindow_glade.cc:127
 msgid "Query:"
 msgstr "Consulta:"
 
-#: UI/GTK2/src/mainWindow_glade.cc:138
-msgid "Edit"
-msgstr "Editar"
+#: UI/GTK2/src/mainWindow_glade.cc:138 UI/GTK2/src/statisticsDialog.cc:88
+#, fuzzy
+msgid "History"
+msgstr "Diret?rio"
 
-#: UI/GTK2/src/mainWindow_glade.cc:147
+#: UI/GTK2/src/mainWindow_glade.cc:143
 msgid "Stored queries"
 msgstr "Consultas armazenadas"
 
-#: UI/GTK2/src/mainWindow_glade.cc:164 UI/GTK2/src/statisticsDialog.cc:50
+#: UI/GTK2/src/mainWindow_glade.cc:156 UI/GTK2/src/statisticsDialog.cc:51
 #: UI/GTK2/src/statisticsDialog_glade.cc:87
 msgid "Status"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow_glade.cc:185
+#: UI/GTK2/src/mainWindow_glade.cc:177
 msgid "Search Engine"
 msgstr "Mecanismo de pesquisa"
 
-#: UI/GTK2/src/mainWindow_glade.cc:188
+#: UI/GTK2/src/mainWindow_glade.cc:180
 msgid "Host Name"
 msgstr "Nome do host"
 
-#: UI/GTK2/src/mainWindow_glade.cc:191
+#: UI/GTK2/src/mainWindow_glade.cc:183
 msgid "Show Extract"
 msgstr "Mostrar extrato"
 
-#: UI/GTK2/src/mainWindow_glade.cc:194
+#: UI/GTK2/src/mainWindow_glade.cc:186
 msgid "Group By"
 msgstr "Agrupar por"
 
-#: UI/GTK2/src/mainWindow_glade.cc:200
+#: UI/GTK2/src/mainWindow_glade.cc:192
 msgid "Clear List"
 msgstr "Limpar lista"
 
-#: UI/GTK2/src/mainWindow_glade.cc:206
+#: UI/GTK2/src/mainWindow_glade.cc:198
 msgid "Vie_w"
 msgstr "Exibir"
 
-#: UI/GTK2/src/mainWindow_glade.cc:209
+#: UI/GTK2/src/mainWindow_glade.cc:201
 msgid "View Cache"
 msgstr "Exibir cache"
 
-#: UI/GTK2/src/mainWindow_glade.cc:212
+#: UI/GTK2/src/mainWindow_glade.cc:204
 msgid "More Like This"
 msgstr "Mais como este"
 
-#: UI/GTK2/src/mainWindow_glade.cc:215 UI/GTK2/src/mainWindow_glade.cc:251
+#: UI/GTK2/src/mainWindow_glade.cc:207
+#, fuzzy
+msgid "Search This For"
+msgstr "Mecanismos de Pesquisa"
+
+#: UI/GTK2/src/mainWindow_glade.cc:210 UI/GTK2/src/mainWindow_glade.cc:246
 msgid "_Index"
 msgstr "_?ndice"
 
-#: UI/GTK2/src/mainWindow_glade.cc:218
+#: UI/GTK2/src/mainWindow_glade.cc:213
 msgid "List Contents Of"
 msgstr "Mostrar conte?do de"
 
-#: UI/GTK2/src/mainWindow_glade.cc:227
+#: UI/GTK2/src/mainWindow_glade.cc:222
 msgid "View"
 msgstr "Visualizar"
 
-#: UI/GTK2/src/mainWindow_glade.cc:230
+#: UI/GTK2/src/mainWindow_glade.cc:225
 msgid "Update"
 msgstr "Atualizar"
 
-#: UI/GTK2/src/mainWindow_glade.cc:233
+#: UI/GTK2/src/mainWindow_glade.cc:228
 msgid "Unindex"
 msgstr "Retirar do ?ndice"
 
-#: UI/GTK2/src/mainWindow_glade.cc:236
-#: UI/GTK2/src/propertiesDialog_glade.cc:177
+#: UI/GTK2/src/mainWindow_glade.cc:231
+#: UI/GTK2/src/propertiesDialog_glade.cc:225
 msgid "Properties"
 msgstr "Propriedades"
 
-#: UI/GTK2/src/mainWindow_glade.cc:239
+#: UI/GTK2/src/mainWindow_glade.cc:234
 msgid "_About"
 msgstr "_Sobre"
 
-#: UI/GTK2/src/mainWindow_glade.cc:242
+#: UI/GTK2/src/mainWindow_glade.cc:237
 msgid "_Session"
 msgstr "_Sess?o"
 
-#: UI/GTK2/src/mainWindow_glade.cc:245
+#: UI/GTK2/src/mainWindow_glade.cc:240
 msgid "_Edit"
 msgstr "_Editar"
 
-#: UI/GTK2/src/mainWindow_glade.cc:248
+#: UI/GTK2/src/mainWindow_glade.cc:243
 msgid "_Results"
 msgstr "_Resultados"
 
-#: UI/GTK2/src/mainWindow_glade.cc:254
+#: UI/GTK2/src/mainWindow_glade.cc:249
 msgid "_Help"
 msgstr "_Ajuda"
 
-#: UI/GTK2/src/mainWindow_glade.cc:403
+#: UI/GTK2/src/mainWindow_glade.cc:378
 msgid "Pinot"
 msgstr "Pino"
 
 #. Localize language names
-#: UI/GTK2/src/pinot.cc:249 UI/GTK2/src/pinot-dbus-daemon.cc:324
-#: UI/GTK2/src/propertiesDialog.cc:72 UI/GTK2/src/propertiesDialog.cc:81
+#: UI/GTK2/src/pinot.cc:233 UI/GTK2/src/pinot-dbus-daemon.cc:312
+#: UI/GTK2/src/propertiesDialog.cc:97
 msgid "Unknown"
 msgstr "Desconhecido"
 
-#: UI/GTK2/src/pinot.cc:250 UI/GTK2/src/pinot-dbus-daemon.cc:325
+#: UI/GTK2/src/pinot.cc:234 UI/GTK2/src/pinot-dbus-daemon.cc:313
 msgid "Danish"
 msgstr "Danish"
 
-#: UI/GTK2/src/pinot.cc:251 UI/GTK2/src/pinot-dbus-daemon.cc:326
+#: UI/GTK2/src/pinot.cc:235 UI/GTK2/src/pinot-dbus-daemon.cc:314
 msgid "Dutch"
 msgstr "Dutch"
 
-#: UI/GTK2/src/pinot.cc:252 UI/GTK2/src/pinot-dbus-daemon.cc:327
+#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:315
 msgid "English"
 msgstr "English"
 
-#: UI/GTK2/src/pinot.cc:253 UI/GTK2/src/pinot-dbus-daemon.cc:328
+#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:316
 msgid "Finnish"
 msgstr "Terminar"
 
-#: UI/GTK2/src/pinot.cc:254 UI/GTK2/src/pinot-dbus-daemon.cc:329
+#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:317
 msgid "French"
 msgstr "French"
 
-#: UI/GTK2/src/pinot.cc:255 UI/GTK2/src/pinot-dbus-daemon.cc:330
+#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:318
 msgid "German"
 msgstr "German"
 
-#: UI/GTK2/src/pinot.cc:256 UI/GTK2/src/pinot-dbus-daemon.cc:331
+#: UI/GTK2/src/pinot.cc:240 UI/GTK2/src/pinot-dbus-daemon.cc:319
 msgid "Hungarian"
 msgstr ""
 
-#: UI/GTK2/src/pinot.cc:257 UI/GTK2/src/pinot-dbus-daemon.cc:332
+#: UI/GTK2/src/pinot.cc:241 UI/GTK2/src/pinot-dbus-daemon.cc:320
 msgid "Italian"
 msgstr "Italian"
 
-#: UI/GTK2/src/pinot.cc:258 UI/GTK2/src/pinot-dbus-daemon.cc:333
+#: UI/GTK2/src/pinot.cc:242 UI/GTK2/src/pinot-dbus-daemon.cc:321
 msgid "Norwegian"
 msgstr "Norwegian"
 
-#: UI/GTK2/src/pinot.cc:259 UI/GTK2/src/pinot-dbus-daemon.cc:334
+#: UI/GTK2/src/pinot.cc:243 UI/GTK2/src/pinot-dbus-daemon.cc:322
 msgid "Portuguese"
 msgstr "Portugu?s"
 
-#: UI/GTK2/src/pinot.cc:260 UI/GTK2/src/pinot-dbus-daemon.cc:335
+#: UI/GTK2/src/pinot.cc:244 UI/GTK2/src/pinot-dbus-daemon.cc:323
 msgid "Romanian"
 msgstr ""
 
-#: UI/GTK2/src/pinot.cc:261 UI/GTK2/src/pinot-dbus-daemon.cc:336
+#: UI/GTK2/src/pinot.cc:245 UI/GTK2/src/pinot-dbus-daemon.cc:324
 msgid "Russian"
 msgstr "Russian"
 
-#: UI/GTK2/src/pinot.cc:262 UI/GTK2/src/pinot-dbus-daemon.cc:337
+#: UI/GTK2/src/pinot.cc:246 UI/GTK2/src/pinot-dbus-daemon.cc:325
 msgid "Spanish"
 msgstr "Spanish"
 
-#: UI/GTK2/src/pinot.cc:263 UI/GTK2/src/pinot-dbus-daemon.cc:338
+#: UI/GTK2/src/pinot.cc:247 UI/GTK2/src/pinot-dbus-daemon.cc:326
 msgid "Swedish"
 msgstr "Swedish"
 
-#: UI/GTK2/src/pinot.cc:264 UI/GTK2/src/pinot-dbus-daemon.cc:339
+#: UI/GTK2/src/pinot.cc:248 UI/GTK2/src/pinot-dbus-daemon.cc:327
 msgid "Turkish"
 msgstr ""
 
-#: UI/GTK2/src/pinot.cc:289
+#: UI/GTK2/src/pinot.cc:273
 msgid "Couldn't open index"
 msgstr "N?o foi poss?vel abrir ?ndice"
 
-#: UI/GTK2/src/pinot.cc:310
+#: UI/GTK2/src/pinot.cc:294
 msgid "Couldn't create history database"
 msgstr "N?o foi poss?vel criar base de hist?rico"
 
-#: UI/GTK2/src/pinot.cc:336
+#. Warn the user
+#: UI/GTK2/src/pinot.cc:330
 msgid "Updating all documents in My Web Pages is recommended"
 msgstr ""
 
@@ -542,39 +577,43 @@
 msgid "Personal"
 msgstr "Pessoal"
 
-#: UI/GTK2/src/PinotSettings.cpp:1198
+#: UI/GTK2/src/PinotSettings.cpp:358
+msgid "Me"
+msgstr ""
+
+#: UI/GTK2/src/PinotSettings.cpp:1233
 msgid "Unclassified"
 msgstr "N?o classificado"
 
-#: UI/GTK2/src/prefsDialog.cc:81
+#: UI/GTK2/src/prefsDialog.cc:83
 msgid "Name"
 msgstr "Nome"
 
-#: UI/GTK2/src/prefsDialog.cc:89
+#: UI/GTK2/src/prefsDialog.cc:91
 msgid "Monitor"
 msgstr "Monitor"
 
-#: UI/GTK2/src/prefsDialog.cc:90
+#: UI/GTK2/src/prefsDialog.cc:92
 msgid "Location"
 msgstr "Localiza??o"
 
-#: UI/GTK2/src/prefsDialog.cc:98
+#: UI/GTK2/src/prefsDialog.cc:100
 msgid "Pattern"
 msgstr "Conjunto"
 
-#: UI/GTK2/src/prefsDialog.cc:315
+#: UI/GTK2/src/prefsDialog.cc:357
 msgid "Exclude these patterns from indexing"
 msgstr ""
 
-#: UI/GTK2/src/prefsDialog.cc:316
+#: UI/GTK2/src/prefsDialog.cc:358
 msgid "Only index these patterns"
 msgstr ""
 
-#: UI/GTK2/src/prefsDialog.cc:406
+#: UI/GTK2/src/prefsDialog.cc:478
 msgid "New Label"
 msgstr "Novo t?tulo"
 
-#: UI/GTK2/src/prefsDialog.cc:447
+#: UI/GTK2/src/prefsDialog.cc:519
 msgid "Directory to index"
 msgstr "Diret?rio do ?ndice"
 
@@ -633,7 +672,7 @@
 msgid "Remove"
 msgstr "Remover"
 
-#: UI/GTK2/src/prefsDialog_glade.cc:113
+#: UI/GTK2/src/prefsDialog_glade.cc:113 UI/GTK2/src/propertiesDialog.cc:56
 msgid "Labels"
 msgstr "T?tulos"
 
@@ -657,79 +696,98 @@
 msgid "Preferences"
 msgstr "Prefer?ncias"
 
-#: UI/GTK2/src/propertiesDialog.cc:60 UI/GTK2/src/queryDialog.cc:124
-msgid "Label"
-msgstr "T?tulo"
-
-#: UI/GTK2/src/propertiesDialog.cc:93
+#: UI/GTK2/src/propertiesDialog.cc:110
 msgid "Per document"
 msgstr "Por documento"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:68
+#: UI/GTK2/src/propertiesDialog.cc:368
+#, fuzzy
+msgid "Export Terms"
+msgstr "_Resultados"
+
+#: UI/GTK2/src/propertiesDialog_glade.cc:65
 msgid "Language:"
 msgstr "L?ngua:"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:69
+#: UI/GTK2/src/propertiesDialog_glade.cc:66
 msgid "MIME type:"
 msgstr "Tipo MIME:"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:70
+#: UI/GTK2/src/propertiesDialog_glade.cc:67
 msgid "Size:"
 msgstr ""
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:73
+#: UI/GTK2/src/propertiesDialog_glade.cc:68
 msgid "Terms:"
 msgstr ""
 
-#: UI/GTK2/src/queryDialog.cc:114
+#: UI/GTK2/src/propertiesDialog_glade.cc:78
+msgid "bytes"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog.cc:94
 msgid "Host name"
 msgstr "Nome do host"
 
-#: UI/GTK2/src/queryDialog.cc:115
+#: UI/GTK2/src/queryDialog.cc:95
 msgid "File name"
 msgstr "Nome do arquivo"
 
-#: UI/GTK2/src/queryDialog.cc:118
+#: UI/GTK2/src/queryDialog.cc:96
 msgid "File extension"
 msgstr "Extens?o do arquivo"
 
 #. This is the title column
-#: UI/GTK2/src/queryDialog.cc:119 UI/GTK2/src/ResultsTree.cpp:133
+#: UI/GTK2/src/queryDialog.cc:97 UI/GTK2/src/ResultsTree.cpp:133
 msgid "Title"
 msgstr "T?tulo"
 
 #. URL
-#: UI/GTK2/src/queryDialog.cc:120 UI/GTK2/src/ResultsTree.cpp:143
+#: UI/GTK2/src/queryDialog.cc:98 UI/GTK2/src/ResultsTree.cpp:143
 msgid "URL"
 msgstr "URL"
 
-#: UI/GTK2/src/queryDialog.cc:121
+#: UI/GTK2/src/queryDialog.cc:99
 msgid "Directory"
 msgstr "Diret?rio"
 
-#: UI/GTK2/src/queryDialog.cc:122
+#: UI/GTK2/src/queryDialog.cc:100
 msgid "Language code"
 msgstr "C?digo da l?ngua"
 
-#: UI/GTK2/src/queryDialog.cc:123
+#: UI/GTK2/src/queryDialog.cc:101
 msgid "MIME type"
 msgstr "Tipo MIME"
 
+#: UI/GTK2/src/queryDialog.cc:102
+msgid "Label"
+msgstr "T?tulo"
+
 #. The last column is for the timestamp
-#: UI/GTK2/src/queryDialog.cc:127 UI/GTK2/src/ResultsTree.cpp:151
+#: UI/GTK2/src/queryDialog.cc:105 UI/GTK2/src/ResultsTree.cpp:151
 #, fuzzy
 msgid "Date"
 msgstr "no"
 
-#: UI/GTK2/src/queryDialog.cc:128
+#: UI/GTK2/src/queryDialog.cc:106
 #, fuzzy
 msgid "Time"
 msgstr "T?tulo"
 
-#: UI/GTK2/src/queryDialog.cc:129
+#: UI/GTK2/src/queryDialog.cc:107
 msgid "Size"
 msgstr ""
 
+#. Sort order
+#: UI/GTK2/src/queryDialog.cc:111
+msgid "By relevance"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog.cc:112
+#, fuzzy
+msgid "By date"
+msgstr "Atualizar"
+
 #: UI/GTK2/src/queryDialog_glade.cc:72
 #, fuzzy
 msgid "New filter or range:"
@@ -748,7 +806,11 @@
 msgid "Number of results:"
 msgstr "N?mero de resultados:"
 
-#: UI/GTK2/src/queryDialog_glade.cc:181
+#: UI/GTK2/src/queryDialog_glade.cc:90
+msgid "Sort order:"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog_glade.cc:192
 msgid "Query parameters"
 msgstr "Par?metros da consulta"
 
@@ -761,130 +823,135 @@
 msgid "Extract"
 msgstr "Extrair"
 
-#: UI/GTK2/src/statisticsDialog.cc:72
+#: UI/GTK2/src/statisticsDialog.cc:73
 #, fuzzy
 msgid "Indexes"
 msgstr "Indexado"
 
-#: UI/GTK2/src/statisticsDialog.cc:87
-#, fuzzy
-msgid "History"
-msgstr "Diret?rio"
-
-#: UI/GTK2/src/statisticsDialog.cc:92
+#: UI/GTK2/src/statisticsDialog.cc:93
 msgid "Daemon"
 msgstr ""
 
-#: UI/GTK2/src/statisticsDialog.cc:128 UI/GTK2/src/statisticsDialog.cc:143
+#: UI/GTK2/src/statisticsDialog.cc:128 UI/GTK2/src/statisticsDialog.cc:144
 #, fuzzy
 msgid "documents"
 msgstr "Meus Documentos"
 
-#: UI/GTK2/src/statisticsDialog.cc:132 UI/GTK2/src/statisticsDialog.cc:147
+#: UI/GTK2/src/statisticsDialog.cc:134 UI/GTK2/src/statisticsDialog.cc:150
+#: UI/GTK2/src/WorkerThreads.cpp:126
 msgid "Unknown error"
 msgstr ""
 
-#: UI/GTK2/src/statisticsDialog.cc:154
+#: UI/GTK2/src/statisticsDialog.cc:157
 #, fuzzy
 msgid "Viewed"
 msgstr "Visualizar"
 
-#: UI/GTK2/src/statisticsDialog.cc:154
+#: UI/GTK2/src/statisticsDialog.cc:157
 #, fuzzy
 msgid "results"
 msgstr "_Resultados"
 
 #. FIXME: check whether it's actually running !
-#: UI/GTK2/src/statisticsDialog.cc:171
+#: UI/GTK2/src/statisticsDialog.cc:174
 #, fuzzy
 msgid "Running under PID"
 msgstr "Executando consulta"
 
-#: UI/GTK2/src/statisticsDialog.cc:175
+#: UI/GTK2/src/statisticsDialog.cc:178
 msgid "Currently not running"
 msgstr ""
 
-#: UI/GTK2/src/statisticsDialog.cc:182
+#: UI/GTK2/src/statisticsDialog.cc:185
 msgid "Crawled"
 msgstr ""
 
-#: UI/GTK2/src/statisticsDialog.cc:182
+#: UI/GTK2/src/statisticsDialog.cc:185
 msgid "files"
 msgstr ""
 
-#: UI/GTK2/src/statisticsDialog.cc:205
+#: UI/GTK2/src/statisticsDialog.cc:206
 msgid "Errors"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:307
-msgid "Can't index mail here"
-msgstr "N?o foi poss?vel indexar mail aqui"
+#: UI/GTK2/src/WorkerThreads.cpp:93
+#, fuzzy
+msgid "Index error"
+msgstr "Erro no ?ndice no"
 
-#: UI/GTK2/src/WorkerThreads.cpp:328 UI/GTK2/src/WorkerThreads.cpp:581
-msgid "is already being indexed"
-msgstr "j? est? sendo indexado"
+#: UI/GTK2/src/WorkerThreads.cpp:95
+#, fuzzy
+msgid "Couldn't index document"
+msgstr "N?o foi poss?vel remover documento(s) do ?ndice"
 
-#: UI/GTK2/src/WorkerThreads.cpp:338
-msgid "is blacklisted"
-msgstr "est? na lista negra"
+#: UI/GTK2/src/WorkerThreads.cpp:97
+msgid "Couldn't update document"
+msgstr "N?o foi poss?vel atualizar documento"
 
-#: UI/GTK2/src/WorkerThreads.cpp:691 UI/GTK2/src/WorkerThreads.cpp:1051
-#: UI/GTK2/src/WorkerThreads.cpp:1135 UI/GTK2/src/WorkerThreads.cpp:1144
-#: UI/GTK2/src/WorkerThreads.cpp:1330 UI/GTK2/src/WorkerThreads.cpp:1600
-#: UI/GTK2/src/WorkerThreads.cpp:1733
-msgid "Index error on"
-msgstr "Erro no ?ndice no"
+#: UI/GTK2/src/WorkerThreads.cpp:99
+msgid "Couldn't unindex document(s)"
+msgstr "N?o foi poss?vel remover documento(s) do ?ndice"
 
-#: UI/GTK2/src/WorkerThreads.cpp:844
-msgid "No title"
-msgstr "Sem t?tulo"
-
-#: UI/GTK2/src/WorkerThreads.cpp:946 UI/GTK2/src/WorkerThreads.cpp:1072
-msgid "Couldn't create search engine"
-msgstr "N?o foi poss?vel criar mecanismo de pesquisa"
-
-#: UI/GTK2/src/WorkerThreads.cpp:970 UI/GTK2/src/WorkerThreads.cpp:1085
+#: UI/GTK2/src/WorkerThreads.cpp:101
 msgid "Couldn't run query on search engine"
 msgstr "N?o foi poss?vel executar consulta no mecanismo de pesquisa"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1238
-msgid "Couldn't obtain downloader for protocol"
-msgstr "N?o foi poss?vel obter fonte de download para o protocolo"
+#: UI/GTK2/src/WorkerThreads.cpp:103
+#, fuzzy
+msgid "Couldn't get history for search engine"
+msgstr "N?o foi poss?vel executar consulta no mecanismo de pesquisa"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1263
-msgid "Couldn't retrieve"
-msgstr "N?o foi poss?vel carregar"
+#: UI/GTK2/src/WorkerThreads.cpp:105
+#, fuzzy
+msgid "Couldn't retrieve document"
+msgstr "N?o foi poss?vel atualizar documento"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1360 UI/GTK2/src/WorkerThreads.cpp:1439
+#: UI/GTK2/src/WorkerThreads.cpp:107
+msgid "Couldn't initialize file monitor"
+msgstr "N?o foi poss?vel inicializar monitor de arquivos"
+
+#: UI/GTK2/src/WorkerThreads.cpp:109
+msgid "Couldn't open directory"
+msgstr "N?o foi poss?vel abrir diret?rio"
+
+#: UI/GTK2/src/WorkerThreads.cpp:111
+#, fuzzy
+msgid "Index doesn't exist"
+msgstr "n?o existe"
+
+#: UI/GTK2/src/WorkerThreads.cpp:113
+msgid "Couldn't create search engine"
+msgstr "N?o foi poss?vel criar mecanismo de pesquisa"
+
+#: UI/GTK2/src/WorkerThreads.cpp:115
 msgid "Cannot index document type"
 msgstr "Imposs?vel indexar tipo de arquivo"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1364 UI/GTK2/src/WorkerThreads.cpp:1443
-msgid "at"
-msgstr "no"
+#: UI/GTK2/src/WorkerThreads.cpp:117
+#, fuzzy
+msgid "No downloader for this protocol"
+msgstr "N?o foi poss?vel obter fonte de download para o protocolo"
 
-#. No, it isn't
-#: UI/GTK2/src/WorkerThreads.cpp:1475
+#: UI/GTK2/src/WorkerThreads.cpp:119
 msgid "Robots META tag forbids indexing"
 msgstr "Robots META tag n?o s?o permitidos no ?ndice"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1529
-msgid "Couldn't index"
-msgstr "N?o foi poss?vel indexar"
+#: UI/GTK2/src/WorkerThreads.cpp:121
+msgid "No monitoring handler"
+msgstr "Nenhum manipulador de monitoramento"
 
-#. Be pessimistic and assume something will go wrong ;-)
-#: UI/GTK2/src/WorkerThreads.cpp:1611
-msgid "Couldn't unindex document(s)"
-msgstr "N?o foi poss?vel remover documento(s) do ?ndice"
+#: UI/GTK2/src/WorkerThreads.cpp:391
+msgid "Can't index mail here"
+msgstr "N?o foi poss?vel indexar mail aqui"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1745
-msgid "Couldn't update document"
-msgstr "N?o foi poss?vel atualizar documento"
+#: UI/GTK2/src/WorkerThreads.cpp:412 UI/GTK2/src/WorkerThreads.cpp:666
+msgid "is already being indexed"
+msgstr "j? est? sendo indexado"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1981
-msgid "No monitoring handler"
-msgstr ""
+#: UI/GTK2/src/WorkerThreads.cpp:422
+msgid "is blacklisted"
+msgstr "est? na lista negra"
 
-#: UI/GTK2/src/WorkerThreads.cpp:2023
-msgid "Couldn't initialize file monitor"
-msgstr ""
+#: UI/GTK2/src/WorkerThreads.cpp:935
+msgid "No title"
+msgstr "Sem t?tulo"

Modified: trunk/po/ru.po
===================================================================
--- trunk/po/ru.po	2007-10-27 03:47:11 UTC (rev 1076)
+++ trunk/po/ru.po	2007-10-27 12:57:33 UTC (rev 1077)
@@ -6,7 +6,7 @@
 msgstr ""
 "Project-Id-Version: pinot 0.75\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2007-09-23 19:22+0800\n"
+"POT-Creation-Date: 2007-10-27 00:15+0800\n"
 "PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
 "Last-Translator: Sergey Vostrikov <s.vostrikov at gmail.com>\n"
 "Language-Team: Russian <ru at li.org>\n"
@@ -27,22 +27,22 @@
 #. Enable these menu items unless it is not the documents index
 #. Allow this only for internal indexes
 #. Internal indices
-#: UI/GTK2/src/EnginesTree.cpp:337 UI/GTK2/src/mainWindow.cc:677
-#: UI/GTK2/src/mainWindow.cc:1187 UI/GTK2/src/mainWindow.cc:1339
-#: UI/GTK2/src/mainWindow.cc:1381 UI/GTK2/src/mainWindow.cc:1403
-#: UI/GTK2/src/mainWindow.cc:1434 UI/GTK2/src/mainWindow.cc:2045
-#: UI/GTK2/src/mainWindow.cc:2157 UI/GTK2/src/PinotSettings.cpp:311
-#: UI/GTK2/src/PinotSettings.cpp:1387 UI/GTK2/src/PinotSettings.cpp:1443
-#: UI/GTK2/src/statisticsDialog.cc:77 UI/GTK2/src/WorkerThreads.cpp:822
-#: UI/GTK2/src/WorkerThreads.cpp:881
+#: UI/GTK2/src/EnginesTree.cpp:337 UI/GTK2/src/mainWindow.cc:795
+#: UI/GTK2/src/mainWindow.cc:1017 UI/GTK2/src/mainWindow.cc:1354
+#: UI/GTK2/src/mainWindow.cc:1509 UI/GTK2/src/mainWindow.cc:1551
+#: UI/GTK2/src/mainWindow.cc:1573 UI/GTK2/src/mainWindow.cc:2177
+#: UI/GTK2/src/mainWindow.cc:2287 UI/GTK2/src/PinotSettings.cpp:311
+#: UI/GTK2/src/PinotSettings.cpp:1421 UI/GTK2/src/PinotSettings.cpp:1477
+#: UI/GTK2/src/statisticsDialog.cc:78 UI/GTK2/src/WorkerThreads.cpp:972
 msgid "My Web Pages"
 msgstr "??? web-????????"
 
-#: UI/GTK2/src/EnginesTree.cpp:338 UI/GTK2/src/mainWindow.cc:680
-#: UI/GTK2/src/mainWindow.cc:1194 UI/GTK2/src/mainWindow.cc:2158
-#: UI/GTK2/src/PinotSettings.cpp:312 UI/GTK2/src/PinotSettings.cpp:1388
-#: UI/GTK2/src/PinotSettings.cpp:1444 UI/GTK2/src/statisticsDialog.cc:82
-#: UI/GTK2/src/WorkerThreads.cpp:827 UI/GTK2/src/WorkerThreads.cpp:891
+#. Spawn new threads
+#: UI/GTK2/src/EnginesTree.cpp:338 UI/GTK2/src/mainWindow.cc:798
+#: UI/GTK2/src/mainWindow.cc:1011 UI/GTK2/src/mainWindow.cc:1361
+#: UI/GTK2/src/mainWindow.cc:2291 UI/GTK2/src/PinotSettings.cpp:312
+#: UI/GTK2/src/PinotSettings.cpp:1422 UI/GTK2/src/PinotSettings.cpp:1478
+#: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:982
 msgid "My Documents"
 msgstr "??? ?????????"
 
@@ -87,12 +87,13 @@
 msgid "External index"
 msgstr "??????? ??????"
 
-#: UI/GTK2/src/importDialog.cc:87 UI/GTK2/src/queryDialog.cc:95
+#. Labels
+#: UI/GTK2/src/importDialog.cc:87 UI/GTK2/src/queryDialog.cc:123
 msgid "None"
 msgstr "???"
 
 #: UI/GTK2/src/importDialog_glade.cc:68
-#: UI/GTK2/src/propertiesDialog_glade.cc:67
+#: UI/GTK2/src/propertiesDialog_glade.cc:64
 msgid "Title:"
 msgstr "????????:"
 
@@ -104,7 +105,7 @@
 msgid "Import"
 msgstr "??????"
 
-#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:221
+#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:216
 msgid "Import URL"
 msgstr "?????? URL"
 
@@ -134,398 +135,432 @@
 msgid "Helper application"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:211
+#: UI/GTK2/src/mainWindow.cc:212
 msgid "Query Name"
 msgstr "??????"
 
-#: UI/GTK2/src/mainWindow.cc:216
+#: UI/GTK2/src/mainWindow.cc:217
 msgid "Last Run"
 msgstr "????????? ?????????"
 
-#: UI/GTK2/src/mainWindow.cc:221
+#: UI/GTK2/src/mainWindow.cc:222
 msgid "Summary"
 msgstr "??????"
 
 #. Set tooltips
-#: UI/GTK2/src/mainWindow.cc:255
+#: UI/GTK2/src/mainWindow.cc:252
 msgid "Show all search engines"
 msgstr "??? ????????? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:256
-msgid "Add index"
+#: UI/GTK2/src/mainWindow.cc:253
+msgid "Find documents that match the query string"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:254
+#, fuzzy
+msgid "Add an index"
 msgstr "???????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:257
-msgid "Remove index"
+#: UI/GTK2/src/mainWindow.cc:255
+#, fuzzy
+msgid "Remove an index"
 msgstr "??????? ??????"
 
+#: UI/GTK2/src/mainWindow.cc:256
+#, fuzzy
+msgid "Add a query"
+msgstr "???????? ????? ??????"
+
+#: UI/GTK2/src/mainWindow.cc:257
+#, fuzzy
+msgid "Remove a query"
+msgstr "???????? ??????"
+
+#: UI/GTK2/src/mainWindow.cc:258
+msgid "Show the query's previous results"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:259
+msgid "Find documents that match the query"
+msgstr ""
+
 #. Now we are ready
-#: UI/GTK2/src/mainWindow.cc:282
+#: UI/GTK2/src/mainWindow.cc:289
 msgid "Ready"
 msgstr "?????"
 
-#: UI/GTK2/src/mainWindow.cc:342
+#: UI/GTK2/src/mainWindow.cc:349
 msgid "N/A"
 msgstr "N/A"
 
-#: UI/GTK2/src/mainWindow.cc:357
+#: UI/GTK2/src/mainWindow.cc:364
 #, fuzzy
 msgid "Undefined"
 msgstr "<??????????????>"
 
+#. Find this query
+#: UI/GTK2/src/mainWindow.cc:587 UI/GTK2/src/mainWindow.cc:2675
+msgid "Live query"
+msgstr "???????? ??????"
+
 #. Show the URL of the first result in the status bar
-#: UI/GTK2/src/mainWindow.cc:611
+#: UI/GTK2/src/mainWindow.cc:727
 msgid "Result location is"
 msgstr "??????? ?"
 
 #. Show the URL in the status bar
-#: UI/GTK2/src/mainWindow.cc:691
+#: UI/GTK2/src/mainWindow.cc:809
 msgid "Document location is"
 msgstr "???????????? ?????????"
 
-#: UI/GTK2/src/mainWindow.cc:1024
+#: UI/GTK2/src/mainWindow.cc:993 UI/GTK2/src/mainWindow.cc:2109
+msgid "Couldn't find query"
+msgstr "?????????? ????? ??????"
+
+#: UI/GTK2/src/mainWindow.cc:1008
+#, fuzzy
+msgid "In Results"
+msgstr "_?????????"
+
+#: UI/GTK2/src/mainWindow.cc:1191
 msgid "Showing"
 msgstr "????????"
 
-#: UI/GTK2/src/mainWindow.cc:1029
+#: UI/GTK2/src/mainWindow.cc:1196
 msgid "of"
 msgstr "??"
 
-#: UI/GTK2/src/mainWindow.cc:1034
+#: UI/GTK2/src/mainWindow.cc:1201
 msgid "documents, starting at"
 msgstr "??????????, ??????? ?"
 
-#: UI/GTK2/src/mainWindow.cc:1068
+#: UI/GTK2/src/mainWindow.cc:1235
 msgid "Query"
 msgstr "??????"
 
-#: UI/GTK2/src/mainWindow.cc:1072 UI/GTK2/src/mainWindow.cc:3177
+#: UI/GTK2/src/mainWindow.cc:1239 UI/GTK2/src/mainWindow.cc:3268
 msgid "on"
 msgstr "??"
 
-#: UI/GTK2/src/mainWindow.cc:1076
+#: UI/GTK2/src/mainWindow.cc:1243
 msgid "ended"
 msgstr "?????????????"
 
-#: UI/GTK2/src/mainWindow.cc:1137
+#: UI/GTK2/src/mainWindow.cc:1304
 msgid "Corrected"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:1223
+#: UI/GTK2/src/mainWindow.cc:1393
 msgid "More Like"
 msgstr "????? ????????"
 
-#: UI/GTK2/src/mainWindow.cc:1265
+#: UI/GTK2/src/mainWindow.cc:1435
 msgid "Updated label(s)"
 msgstr "????????? ????? (??)"
 
 #. Yes, it did
-#: UI/GTK2/src/mainWindow.cc:1349
+#: UI/GTK2/src/mainWindow.cc:1519 UI/GTK2/src/mainWindow.cc:1613
 msgid "Updated document"
 msgstr "??????????? ????????"
 
-#: UI/GTK2/src/mainWindow.cc:1362
+#: UI/GTK2/src/mainWindow.cc:1532
 msgid "Indexed"
 msgstr "?????????????"
 
-#: UI/GTK2/src/mainWindow.cc:1404
+#: UI/GTK2/src/mainWindow.cc:1574
 msgid "Unindexed document(s)"
 msgstr "?? ????????????? ??????????"
 
-#: UI/GTK2/src/mainWindow.cc:1444
-msgid "Updated document properties"
-msgstr "?????????? ??????? ?????????"
-
-#: UI/GTK2/src/mainWindow.cc:1497
+#: UI/GTK2/src/mainWindow.cc:1671
 msgid "Couldn't rename index, name"
 msgstr "?????????? ????????????? ??????, ????????"
 
-#: UI/GTK2/src/mainWindow.cc:1501 UI/GTK2/src/mainWindow.cc:2441
-#: UI/GTK2/src/mainWindow.cc:2982
+#: UI/GTK2/src/mainWindow.cc:1675 UI/GTK2/src/mainWindow.cc:2501
+#: UI/GTK2/src/mainWindow.cc:3072
 msgid "is already in use"
 msgstr "??? ????????????"
 
-#: UI/GTK2/src/mainWindow.cc:1514
+#: UI/GTK2/src/mainWindow.cc:1688
 msgid "Couldn't rename index"
 msgstr "?????????? ????????????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:1527
+#: UI/GTK2/src/mainWindow.cc:1701
 msgid "Edited index"
 msgstr "?????????????? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:1853
+#: UI/GTK2/src/mainWindow.cc:2029
 #, fuzzy
 msgid "Export Results"
 msgstr "_?????????"
 
-#. Find this query
-#: UI/GTK2/src/mainWindow.cc:1942 UI/GTK2/src/mainWindow.cc:2615
-msgid "Live query"
-msgstr "???????? ??????"
-
-#: UI/GTK2/src/mainWindow.cc:1968
-msgid "Couldn't find query"
-msgstr "?????????? ????? ??????"
-
-#: UI/GTK2/src/mainWindow.cc:2167 UI/GTK2/src/WorkerThreads.cpp:678
-#: UI/GTK2/src/WorkerThreads.cpp:1720
+#: UI/GTK2/src/mainWindow.cc:2304
 msgid "Index"
 msgstr "??????"
 
-#: UI/GTK2/src/mainWindow.cc:2171 UI/GTK2/src/WorkerThreads.cpp:682
-#: UI/GTK2/src/WorkerThreads.cpp:1724
+#: UI/GTK2/src/mainWindow.cc:2308
 msgid "doesn't exist"
 msgstr "???"
 
-#: UI/GTK2/src/mainWindow.cc:2326
+#: UI/GTK2/src/mainWindow.cc:2386
 msgid "Remove this document from the index ?"
 msgstr "??????? ???????? ?? ??????? ?"
 
-#: UI/GTK2/src/mainWindow.cc:2345
+#: UI/GTK2/src/mainWindow.cc:2405
 msgid "Remove these documents from the index ?"
 msgstr "??????? ??? ????????? ?? ????????"
 
-#: UI/GTK2/src/mainWindow.cc:2391
+#: UI/GTK2/src/mainWindow.cc:2451
 msgid "A metasearch tool for the Free Desktop"
 msgstr "?????????? ?????????? ??? ?????????? ????????"
 
-#: UI/GTK2/src/mainWindow.cc:2392
+#: UI/GTK2/src/mainWindow.cc:2452
 msgid "Search the Web and your documents !"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:2437
+#: UI/GTK2/src/mainWindow.cc:2497
 msgid "Index name"
 msgstr "???????? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:2452
+#: UI/GTK2/src/mainWindow.cc:2512
 msgid "Couldn't add index"
 msgstr "?????????? ???????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:2468
+#: UI/GTK2/src/mainWindow.cc:2528
 msgid "Added new index"
 msgstr "???????? ????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:2503
+#: UI/GTK2/src/mainWindow.cc:2563
 msgid "Couldn't remove index"
 msgstr "?????????? ??????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:2795
+#: UI/GTK2/src/mainWindow.cc:2768
+msgid "No history for"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:2884
 msgid "At least one task hasn't completed yet. Quit now ?"
 msgstr "?? ??????? ???? ???? ?????? ??? ?? ?????????. ????? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:2978
+#: UI/GTK2/src/mainWindow.cc:3068
 msgid "Query name"
 msgstr "???????? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:3005
+#: UI/GTK2/src/mainWindow.cc:3095
 msgid "Couldn't update query"
 msgstr "?????????? ???????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:3013
+#: UI/GTK2/src/mainWindow.cc:3103
 msgid "Edited query"
 msgstr "?????? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:3020
+#: UI/GTK2/src/mainWindow.cc:3110
 msgid "Couldn't add query"
 msgstr "?????????? ???????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:3028
+#: UI/GTK2/src/mainWindow.cc:3118
 msgid "Added new query"
 msgstr "???????? ????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:3066
+#: UI/GTK2/src/mainWindow.cc:3157
 msgid "Query is not set"
 msgstr "?????? ?? ??????????"
 
-#: UI/GTK2/src/mainWindow.cc:3077
+#: UI/GTK2/src/mainWindow.cc:3168
 msgid "No search engine selected"
 msgstr "?? ???? ????????? ??????? ?? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:3164
+#: UI/GTK2/src/mainWindow.cc:3255
 msgid "Please set the Google API key first"
 msgstr "??????????, ??????? ????????????? ???? Google API"
 
-#: UI/GTK2/src/mainWindow.cc:3173
+#: UI/GTK2/src/mainWindow.cc:3264
 msgid "Running query"
 msgstr "?????? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:3382
+#: UI/GTK2/src/mainWindow.cc:3473
 msgid "No default application defined for type"
 msgstr "?? ???? ?????????? ?? ????????? ?? ?????????? ??? ???? ??????????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:126
+#: UI/GTK2/src/mainWindow_glade.cc:127
 msgid "Query:"
 msgstr "??????:"
 
-#: UI/GTK2/src/mainWindow_glade.cc:138
-msgid "Edit"
-msgstr "??????"
+#: UI/GTK2/src/mainWindow_glade.cc:138 UI/GTK2/src/statisticsDialog.cc:88
+#, fuzzy
+msgid "History"
+msgstr "???????? ??????????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:147
+#: UI/GTK2/src/mainWindow_glade.cc:143
 msgid "Stored queries"
 msgstr "??????????? ???????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:164 UI/GTK2/src/statisticsDialog.cc:50
+#: UI/GTK2/src/mainWindow_glade.cc:156 UI/GTK2/src/statisticsDialog.cc:51
 #: UI/GTK2/src/statisticsDialog_glade.cc:87
 msgid "Status"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow_glade.cc:185
+#: UI/GTK2/src/mainWindow_glade.cc:177
 msgid "Search Engine"
 msgstr "????????? ??????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:188
+#: UI/GTK2/src/mainWindow_glade.cc:180
 msgid "Host Name"
 msgstr "??? ?????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:191
+#: UI/GTK2/src/mainWindow_glade.cc:183
 msgid "Show Extract"
 msgstr "???????? ????????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:194
+#: UI/GTK2/src/mainWindow_glade.cc:186
 msgid "Group By"
 msgstr "???????????? ??"
 
-#: UI/GTK2/src/mainWindow_glade.cc:200
+#: UI/GTK2/src/mainWindow_glade.cc:192
 msgid "Clear List"
 msgstr "???????? ??????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:206
+#: UI/GTK2/src/mainWindow_glade.cc:198
 msgid "Vie_w"
 msgstr "_???"
 
-#: UI/GTK2/src/mainWindow_glade.cc:209
+#: UI/GTK2/src/mainWindow_glade.cc:201
 msgid "View Cache"
 msgstr "???????? ????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:212
+#: UI/GTK2/src/mainWindow_glade.cc:204
 msgid "More Like This"
 msgstr "????????? ?? ????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:215 UI/GTK2/src/mainWindow_glade.cc:251
+#: UI/GTK2/src/mainWindow_glade.cc:207
+#, fuzzy
+msgid "Search This For"
+msgstr "????????? ??????"
+
+#: UI/GTK2/src/mainWindow_glade.cc:210 UI/GTK2/src/mainWindow_glade.cc:246
 msgid "_Index"
 msgstr "_??????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:218
+#: UI/GTK2/src/mainWindow_glade.cc:213
 msgid "List Contents Of"
 msgstr "?????? ???????????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:227
+#: UI/GTK2/src/mainWindow_glade.cc:222
 msgid "View"
 msgstr "???"
 
-#: UI/GTK2/src/mainWindow_glade.cc:230
+#: UI/GTK2/src/mainWindow_glade.cc:225
 msgid "Update"
 msgstr "????????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:233
+#: UI/GTK2/src/mainWindow_glade.cc:228
 msgid "Unindex"
 msgstr "????? ??????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:236
-#: UI/GTK2/src/propertiesDialog_glade.cc:177
+#: UI/GTK2/src/mainWindow_glade.cc:231
+#: UI/GTK2/src/propertiesDialog_glade.cc:225
 msgid "Properties"
 msgstr "????????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:239
+#: UI/GTK2/src/mainWindow_glade.cc:234
 msgid "_About"
 msgstr "? ?????????..."
 
-#: UI/GTK2/src/mainWindow_glade.cc:242
+#: UI/GTK2/src/mainWindow_glade.cc:237
 msgid "_Session"
 msgstr "_??????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:245
+#: UI/GTK2/src/mainWindow_glade.cc:240
 msgid "_Edit"
 msgstr "_??????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:248
+#: UI/GTK2/src/mainWindow_glade.cc:243
 msgid "_Results"
 msgstr "_?????????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:254
+#: UI/GTK2/src/mainWindow_glade.cc:249
 msgid "_Help"
 msgstr "???????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:403
+#: UI/GTK2/src/mainWindow_glade.cc:378
 msgid "Pinot"
 msgstr "Pinot"
 
 #. Localize language names
-#: UI/GTK2/src/pinot.cc:249 UI/GTK2/src/pinot-dbus-daemon.cc:324
-#: UI/GTK2/src/propertiesDialog.cc:72 UI/GTK2/src/propertiesDialog.cc:81
+#: UI/GTK2/src/pinot.cc:233 UI/GTK2/src/pinot-dbus-daemon.cc:312
+#: UI/GTK2/src/propertiesDialog.cc:97
 msgid "Unknown"
 msgstr "???????????"
 
-#: UI/GTK2/src/pinot.cc:250 UI/GTK2/src/pinot-dbus-daemon.cc:325
+#: UI/GTK2/src/pinot.cc:234 UI/GTK2/src/pinot-dbus-daemon.cc:313
 msgid "Danish"
 msgstr "???????"
 
-#: UI/GTK2/src/pinot.cc:251 UI/GTK2/src/pinot-dbus-daemon.cc:326
+#: UI/GTK2/src/pinot.cc:235 UI/GTK2/src/pinot-dbus-daemon.cc:314
 msgid "Dutch"
 msgstr "???????????"
 
-#: UI/GTK2/src/pinot.cc:252 UI/GTK2/src/pinot-dbus-daemon.cc:327
+#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:315
 msgid "English"
 msgstr "??????????"
 
-#: UI/GTK2/src/pinot.cc:253 UI/GTK2/src/pinot-dbus-daemon.cc:328
+#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:316
 msgid "Finnish"
 msgstr "???????"
 
-#: UI/GTK2/src/pinot.cc:254 UI/GTK2/src/pinot-dbus-daemon.cc:329
+#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:317
 msgid "French"
 msgstr "???????????"
 
-#: UI/GTK2/src/pinot.cc:255 UI/GTK2/src/pinot-dbus-daemon.cc:330
+#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:318
 msgid "German"
 msgstr "????????"
 
-#: UI/GTK2/src/pinot.cc:256 UI/GTK2/src/pinot-dbus-daemon.cc:331
+#: UI/GTK2/src/pinot.cc:240 UI/GTK2/src/pinot-dbus-daemon.cc:319
 msgid "Hungarian"
 msgstr ""
 
-#: UI/GTK2/src/pinot.cc:257 UI/GTK2/src/pinot-dbus-daemon.cc:332
+#: UI/GTK2/src/pinot.cc:241 UI/GTK2/src/pinot-dbus-daemon.cc:320
 msgid "Italian"
 msgstr "???????????"
 
-#: UI/GTK2/src/pinot.cc:258 UI/GTK2/src/pinot-dbus-daemon.cc:333
+#: UI/GTK2/src/pinot.cc:242 UI/GTK2/src/pinot-dbus-daemon.cc:321
 msgid "Norwegian"
 msgstr "??????????"
 
-#: UI/GTK2/src/pinot.cc:259 UI/GTK2/src/pinot-dbus-daemon.cc:334
+#: UI/GTK2/src/pinot.cc:243 UI/GTK2/src/pinot-dbus-daemon.cc:322
 msgid "Portuguese"
 msgstr "?????????????"
 
-#: UI/GTK2/src/pinot.cc:260 UI/GTK2/src/pinot-dbus-daemon.cc:335
+#: UI/GTK2/src/pinot.cc:244 UI/GTK2/src/pinot-dbus-daemon.cc:323
 msgid "Romanian"
 msgstr ""
 
-#: UI/GTK2/src/pinot.cc:261 UI/GTK2/src/pinot-dbus-daemon.cc:336
+#: UI/GTK2/src/pinot.cc:245 UI/GTK2/src/pinot-dbus-daemon.cc:324
 msgid "Russian"
 msgstr "???????"
 
-#: UI/GTK2/src/pinot.cc:262 UI/GTK2/src/pinot-dbus-daemon.cc:337
+#: UI/GTK2/src/pinot.cc:246 UI/GTK2/src/pinot-dbus-daemon.cc:325
 msgid "Spanish"
 msgstr "?????????"
 
-#: UI/GTK2/src/pinot.cc:263 UI/GTK2/src/pinot-dbus-daemon.cc:338
+#: UI/GTK2/src/pinot.cc:247 UI/GTK2/src/pinot-dbus-daemon.cc:326
 msgid "Swedish"
 msgstr "????????"
 
-#: UI/GTK2/src/pinot.cc:264 UI/GTK2/src/pinot-dbus-daemon.cc:339
+#: UI/GTK2/src/pinot.cc:248 UI/GTK2/src/pinot-dbus-daemon.cc:327
 msgid "Turkish"
 msgstr ""
 
-#: UI/GTK2/src/pinot.cc:289
+#: UI/GTK2/src/pinot.cc:273
 msgid "Couldn't open index"
 msgstr "?????????? ??????? ??????"
 
-#: UI/GTK2/src/pinot.cc:310
+#: UI/GTK2/src/pinot.cc:294
 msgid "Couldn't create history database"
 msgstr "?? ??????? ??????? ???? ?????? ???????"
 
-#: UI/GTK2/src/pinot.cc:336
+#. Warn the user
+#: UI/GTK2/src/pinot.cc:330
 msgid "Updating all documents in My Web Pages is recommended"
 msgstr ""
 
@@ -542,39 +577,43 @@
 msgid "Personal"
 msgstr "??????"
 
-#: UI/GTK2/src/PinotSettings.cpp:1198
+#: UI/GTK2/src/PinotSettings.cpp:358
+msgid "Me"
+msgstr ""
+
+#: UI/GTK2/src/PinotSettings.cpp:1233
 msgid "Unclassified"
 msgstr "??????????????"
 
-#: UI/GTK2/src/prefsDialog.cc:81
+#: UI/GTK2/src/prefsDialog.cc:83
 msgid "Name"
 msgstr "???"
 
-#: UI/GTK2/src/prefsDialog.cc:89
+#: UI/GTK2/src/prefsDialog.cc:91
 msgid "Monitor"
 msgstr "???????"
 
-#: UI/GTK2/src/prefsDialog.cc:90
+#: UI/GTK2/src/prefsDialog.cc:92
 msgid "Location"
 msgstr "?????????????????"
 
-#: UI/GTK2/src/prefsDialog.cc:98
+#: UI/GTK2/src/prefsDialog.cc:100
 msgid "Pattern"
 msgstr "???????"
 
-#: UI/GTK2/src/prefsDialog.cc:315
+#: UI/GTK2/src/prefsDialog.cc:357
 msgid "Exclude these patterns from indexing"
 msgstr ""
 
-#: UI/GTK2/src/prefsDialog.cc:316
+#: UI/GTK2/src/prefsDialog.cc:358
 msgid "Only index these patterns"
 msgstr ""
 
-#: UI/GTK2/src/prefsDialog.cc:406
+#: UI/GTK2/src/prefsDialog.cc:478
 msgid "New Label"
 msgstr "????? ?????"
 
-#: UI/GTK2/src/prefsDialog.cc:447
+#: UI/GTK2/src/prefsDialog.cc:519
 msgid "Directory to index"
 msgstr "????? ??? ??????????????"
 
@@ -631,7 +670,7 @@
 msgid "Remove"
 msgstr "???????"
 
-#: UI/GTK2/src/prefsDialog_glade.cc:113
+#: UI/GTK2/src/prefsDialog_glade.cc:113 UI/GTK2/src/propertiesDialog.cc:56
 msgid "Labels"
 msgstr "?????"
 
@@ -653,79 +692,98 @@
 msgid "Preferences"
 msgstr "?????????"
 
-#: UI/GTK2/src/propertiesDialog.cc:60 UI/GTK2/src/queryDialog.cc:124
-msgid "Label"
-msgstr "?????"
-
-#: UI/GTK2/src/propertiesDialog.cc:93
+#: UI/GTK2/src/propertiesDialog.cc:110
 msgid "Per document"
 msgstr "??? ?????????? ?????????"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:68
+#: UI/GTK2/src/propertiesDialog.cc:368
+#, fuzzy
+msgid "Export Terms"
+msgstr "_?????????"
+
+#: UI/GTK2/src/propertiesDialog_glade.cc:65
 msgid "Language:"
 msgstr "????:"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:69
+#: UI/GTK2/src/propertiesDialog_glade.cc:66
 msgid "MIME type:"
 msgstr "??? MIME:"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:70
+#: UI/GTK2/src/propertiesDialog_glade.cc:67
 msgid "Size:"
 msgstr ""
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:73
+#: UI/GTK2/src/propertiesDialog_glade.cc:68
 msgid "Terms:"
 msgstr ""
 
-#: UI/GTK2/src/queryDialog.cc:114
+#: UI/GTK2/src/propertiesDialog_glade.cc:78
+msgid "bytes"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog.cc:94
 msgid "Host name"
 msgstr "??? ????"
 
-#: UI/GTK2/src/queryDialog.cc:115
+#: UI/GTK2/src/queryDialog.cc:95
 msgid "File name"
 msgstr "????"
 
-#: UI/GTK2/src/queryDialog.cc:118
+#: UI/GTK2/src/queryDialog.cc:96
 msgid "File extension"
 msgstr "?????????? ?????"
 
 #. This is the title column
-#: UI/GTK2/src/queryDialog.cc:119 UI/GTK2/src/ResultsTree.cpp:133
+#: UI/GTK2/src/queryDialog.cc:97 UI/GTK2/src/ResultsTree.cpp:133
 msgid "Title"
 msgstr "????????"
 
 #. URL
-#: UI/GTK2/src/queryDialog.cc:120 UI/GTK2/src/ResultsTree.cpp:143
+#: UI/GTK2/src/queryDialog.cc:98 UI/GTK2/src/ResultsTree.cpp:143
 msgid "URL"
 msgstr "URL"
 
-#: UI/GTK2/src/queryDialog.cc:121
+#: UI/GTK2/src/queryDialog.cc:99
 msgid "Directory"
 msgstr "???????? ??????????"
 
-#: UI/GTK2/src/queryDialog.cc:122
+#: UI/GTK2/src/queryDialog.cc:100
 msgid "Language code"
 msgstr "??? ?????"
 
-#: UI/GTK2/src/queryDialog.cc:123
+#: UI/GTK2/src/queryDialog.cc:101
 msgid "MIME type"
 msgstr "??? MIME"
 
+#: UI/GTK2/src/queryDialog.cc:102
+msgid "Label"
+msgstr "?????"
+
 #. The last column is for the timestamp
-#: UI/GTK2/src/queryDialog.cc:127 UI/GTK2/src/ResultsTree.cpp:151
+#: UI/GTK2/src/queryDialog.cc:105 UI/GTK2/src/ResultsTree.cpp:151
 #, fuzzy
 msgid "Date"
 msgstr "?"
 
-#: UI/GTK2/src/queryDialog.cc:128
+#: UI/GTK2/src/queryDialog.cc:106
 #, fuzzy
 msgid "Time"
 msgstr "????????"
 
-#: UI/GTK2/src/queryDialog.cc:129
+#: UI/GTK2/src/queryDialog.cc:107
 msgid "Size"
 msgstr ""
 
+#. Sort order
+#: UI/GTK2/src/queryDialog.cc:111
+msgid "By relevance"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog.cc:112
+#, fuzzy
+msgid "By date"
+msgstr "????????"
+
 #: UI/GTK2/src/queryDialog_glade.cc:72
 #, fuzzy
 msgid "New filter or range:"
@@ -744,7 +802,11 @@
 msgid "Number of results:"
 msgstr "?????????? ???????????:"
 
-#: UI/GTK2/src/queryDialog_glade.cc:181
+#: UI/GTK2/src/queryDialog_glade.cc:90
+msgid "Sort order:"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog_glade.cc:192
 msgid "Query parameters"
 msgstr "????????? ???????"
 
@@ -757,130 +819,136 @@
 msgid "Extract"
 msgstr "??????????"
 
-#: UI/GTK2/src/statisticsDialog.cc:72
+#: UI/GTK2/src/statisticsDialog.cc:73
 #, fuzzy
 msgid "Indexes"
 msgstr "?????????????"
 
-#: UI/GTK2/src/statisticsDialog.cc:87
-#, fuzzy
-msgid "History"
-msgstr "???????? ??????????"
-
-#: UI/GTK2/src/statisticsDialog.cc:92
+#: UI/GTK2/src/statisticsDialog.cc:93
 msgid "Daemon"
 msgstr ""
 
-#: UI/GTK2/src/statisticsDialog.cc:128 UI/GTK2/src/statisticsDialog.cc:143
+#: UI/GTK2/src/statisticsDialog.cc:128 UI/GTK2/src/statisticsDialog.cc:144
 #, fuzzy
 msgid "documents"
 msgstr "??? ?????????"
 
-#: UI/GTK2/src/statisticsDialog.cc:132 UI/GTK2/src/statisticsDialog.cc:147
+#: UI/GTK2/src/statisticsDialog.cc:134 UI/GTK2/src/statisticsDialog.cc:150
+#: UI/GTK2/src/WorkerThreads.cpp:126
 msgid "Unknown error"
 msgstr ""
 
-#: UI/GTK2/src/statisticsDialog.cc:154
+#: UI/GTK2/src/statisticsDialog.cc:157
 #, fuzzy
 msgid "Viewed"
 msgstr "???"
 
-#: UI/GTK2/src/statisticsDialog.cc:154
+#: UI/GTK2/src/statisticsDialog.cc:157
 #, fuzzy
 msgid "results"
 msgstr "_?????????"
 
 #. FIXME: check whether it's actually running !
-#: UI/GTK2/src/statisticsDialog.cc:171
+#: UI/GTK2/src/statisticsDialog.cc:174
 #, fuzzy
 msgid "Running under PID"
 msgstr "?????? ???????"
 
-#: UI/GTK2/src/statisticsDialog.cc:175
+#: UI/GTK2/src/statisticsDialog.cc:178
 msgid "Currently not running"
 msgstr ""
 
-#: UI/GTK2/src/statisticsDialog.cc:182
+#: UI/GTK2/src/statisticsDialog.cc:185
 msgid "Crawled"
 msgstr ""
 
-#: UI/GTK2/src/statisticsDialog.cc:182
+#: UI/GTK2/src/statisticsDialog.cc:185
 msgid "files"
 msgstr ""
 
-#: UI/GTK2/src/statisticsDialog.cc:205
+#: UI/GTK2/src/statisticsDialog.cc:206
 msgid "Errors"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:307
-msgid "Can't index mail here"
-msgstr "?????? ????????????? ????? ?????"
+#: UI/GTK2/src/WorkerThreads.cpp:93
+#, fuzzy
+msgid "Index error"
+msgstr "?????? ??????? ??"
 
-#: UI/GTK2/src/WorkerThreads.cpp:328 UI/GTK2/src/WorkerThreads.cpp:581
-msgid "is already being indexed"
-msgstr "??? ??????????????????"
+#: UI/GTK2/src/WorkerThreads.cpp:95
+#, fuzzy
+msgid "Couldn't index document"
+msgstr "?????????? ??????????????? ????????(?)"
 
-#: UI/GTK2/src/WorkerThreads.cpp:338
-msgid "is blacklisted"
-msgstr "??????????? ? ?????? ??????"
+#: UI/GTK2/src/WorkerThreads.cpp:97
+msgid "Couldn't update document"
+msgstr "?????????? ???????? ????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:691 UI/GTK2/src/WorkerThreads.cpp:1051
-#: UI/GTK2/src/WorkerThreads.cpp:1135 UI/GTK2/src/WorkerThreads.cpp:1144
-#: UI/GTK2/src/WorkerThreads.cpp:1330 UI/GTK2/src/WorkerThreads.cpp:1600
-#: UI/GTK2/src/WorkerThreads.cpp:1733
-msgid "Index error on"
-msgstr "?????? ??????? ??"
+#: UI/GTK2/src/WorkerThreads.cpp:99
+msgid "Couldn't unindex document(s)"
+msgstr "?????????? ??????????????? ????????(?)"
 
-#: UI/GTK2/src/WorkerThreads.cpp:844
-msgid "No title"
-msgstr "??? ????????"
-
-#: UI/GTK2/src/WorkerThreads.cpp:946 UI/GTK2/src/WorkerThreads.cpp:1072
-msgid "Couldn't create search engine"
-msgstr "?? ??????? ??????? ????????? ???????"
-
-#: UI/GTK2/src/WorkerThreads.cpp:970 UI/GTK2/src/WorkerThreads.cpp:1085
+#: UI/GTK2/src/WorkerThreads.cpp:101
 msgid "Couldn't run query on search engine"
 msgstr "?? ??????? ????????? ?????? ? ????????? ???????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1238
-msgid "Couldn't obtain downloader for protocol"
-msgstr "?? ??????? ???????? ????????? ??? ?????????"
+#: UI/GTK2/src/WorkerThreads.cpp:103
+#, fuzzy
+msgid "Couldn't get history for search engine"
+msgstr "?? ??????? ????????? ?????? ? ????????? ???????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1263
-msgid "Couldn't retrieve"
-msgstr "?? ??????? ???????"
+#: UI/GTK2/src/WorkerThreads.cpp:105
+#, fuzzy
+msgid "Couldn't retrieve document"
+msgstr "?????????? ???????? ????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1360 UI/GTK2/src/WorkerThreads.cpp:1439
+#: UI/GTK2/src/WorkerThreads.cpp:107
+msgid "Couldn't initialize file monitor"
+msgstr ""
+
+#: UI/GTK2/src/WorkerThreads.cpp:109
+#, fuzzy
+msgid "Couldn't open directory"
+msgstr "?????????? ??????? ??????"
+
+#: UI/GTK2/src/WorkerThreads.cpp:111
+#, fuzzy
+msgid "Index doesn't exist"
+msgstr "???"
+
+#: UI/GTK2/src/WorkerThreads.cpp:113
+msgid "Couldn't create search engine"
+msgstr "?? ??????? ??????? ????????? ???????"
+
+#: UI/GTK2/src/WorkerThreads.cpp:115
 msgid "Cannot index document type"
 msgstr "?????????? ????????????? ?????? ??? ??????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1364 UI/GTK2/src/WorkerThreads.cpp:1443
-msgid "at"
-msgstr "?"
+#: UI/GTK2/src/WorkerThreads.cpp:117
+#, fuzzy
+msgid "No downloader for this protocol"
+msgstr "?? ??????? ???????? ????????? ??? ?????????"
 
-#. No, it isn't
-#: UI/GTK2/src/WorkerThreads.cpp:1475
+#: UI/GTK2/src/WorkerThreads.cpp:119
 msgid "Robots META tag forbids indexing"
 msgstr "META-???? ??????? ????????? ??????????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1529
-msgid "Couldn't index"
-msgstr "?????????? ????????? ??????"
+#: UI/GTK2/src/WorkerThreads.cpp:121
+msgid "No monitoring handler"
+msgstr ""
 
-#. Be pessimistic and assume something will go wrong ;-)
-#: UI/GTK2/src/WorkerThreads.cpp:1611
-msgid "Couldn't unindex document(s)"
-msgstr "?????????? ??????????????? ????????(?)"
+#: UI/GTK2/src/WorkerThreads.cpp:391
+msgid "Can't index mail here"
+msgstr "?????? ????????????? ????? ?????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1745
-msgid "Couldn't update document"
-msgstr "?????????? ???????? ????????"
+#: UI/GTK2/src/WorkerThreads.cpp:412 UI/GTK2/src/WorkerThreads.cpp:666
+msgid "is already being indexed"
+msgstr "??? ??????????????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1981
-msgid "No monitoring handler"
-msgstr ""
+#: UI/GTK2/src/WorkerThreads.cpp:422
+msgid "is blacklisted"
+msgstr "??????????? ? ?????? ??????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:2023
-msgid "Couldn't initialize file monitor"
-msgstr ""
+#: UI/GTK2/src/WorkerThreads.cpp:935
+msgid "No title"
+msgstr "??? ????????"

Modified: trunk/po/sv.po
===================================================================
--- trunk/po/sv.po	2007-10-27 03:47:11 UTC (rev 1076)
+++ trunk/po/sv.po	2007-10-27 12:57:33 UTC (rev 1077)
@@ -7,7 +7,7 @@
 msgstr ""
 "Project-Id-Version: pinot\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2007-09-23 19:22+0800\n"
+"POT-Creation-Date: 2007-10-27 00:15+0800\n"
 "PO-Revision-Date: 2007-07-29 16:48+0000\n"
 "Last-Translator: Daniel Nylander <yeager at ubuntu.com>\n"
 "Language-Team: Swedish <tp-sv at listor.tp-sv.se>\n"
@@ -28,22 +28,22 @@
 #. Enable these menu items unless it is not the documents index
 #. Allow this only for internal indexes
 #. Internal indices
-#: UI/GTK2/src/EnginesTree.cpp:337 UI/GTK2/src/mainWindow.cc:677
-#: UI/GTK2/src/mainWindow.cc:1187 UI/GTK2/src/mainWindow.cc:1339
-#: UI/GTK2/src/mainWindow.cc:1381 UI/GTK2/src/mainWindow.cc:1403
-#: UI/GTK2/src/mainWindow.cc:1434 UI/GTK2/src/mainWindow.cc:2045
-#: UI/GTK2/src/mainWindow.cc:2157 UI/GTK2/src/PinotSettings.cpp:311
-#: UI/GTK2/src/PinotSettings.cpp:1387 UI/GTK2/src/PinotSettings.cpp:1443
-#: UI/GTK2/src/statisticsDialog.cc:77 UI/GTK2/src/WorkerThreads.cpp:822
-#: UI/GTK2/src/WorkerThreads.cpp:881
+#: UI/GTK2/src/EnginesTree.cpp:337 UI/GTK2/src/mainWindow.cc:795
+#: UI/GTK2/src/mainWindow.cc:1017 UI/GTK2/src/mainWindow.cc:1354
+#: UI/GTK2/src/mainWindow.cc:1509 UI/GTK2/src/mainWindow.cc:1551
+#: UI/GTK2/src/mainWindow.cc:1573 UI/GTK2/src/mainWindow.cc:2177
+#: UI/GTK2/src/mainWindow.cc:2287 UI/GTK2/src/PinotSettings.cpp:311
+#: UI/GTK2/src/PinotSettings.cpp:1421 UI/GTK2/src/PinotSettings.cpp:1477
+#: UI/GTK2/src/statisticsDialog.cc:78 UI/GTK2/src/WorkerThreads.cpp:972
 msgid "My Web Pages"
 msgstr "Mina webbsidor"
 
-#: UI/GTK2/src/EnginesTree.cpp:338 UI/GTK2/src/mainWindow.cc:680
-#: UI/GTK2/src/mainWindow.cc:1194 UI/GTK2/src/mainWindow.cc:2158
-#: UI/GTK2/src/PinotSettings.cpp:312 UI/GTK2/src/PinotSettings.cpp:1388
-#: UI/GTK2/src/PinotSettings.cpp:1444 UI/GTK2/src/statisticsDialog.cc:82
-#: UI/GTK2/src/WorkerThreads.cpp:827 UI/GTK2/src/WorkerThreads.cpp:891
+#. Spawn new threads
+#: UI/GTK2/src/EnginesTree.cpp:338 UI/GTK2/src/mainWindow.cc:798
+#: UI/GTK2/src/mainWindow.cc:1011 UI/GTK2/src/mainWindow.cc:1361
+#: UI/GTK2/src/mainWindow.cc:2291 UI/GTK2/src/PinotSettings.cpp:312
+#: UI/GTK2/src/PinotSettings.cpp:1422 UI/GTK2/src/PinotSettings.cpp:1478
+#: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:982
 msgid "My Documents"
 msgstr "Mina dokument"
 
@@ -87,12 +87,13 @@
 msgid "External index"
 msgstr "Externt index"
 
-#: UI/GTK2/src/importDialog.cc:87 UI/GTK2/src/queryDialog.cc:95
+#. Labels
+#: UI/GTK2/src/importDialog.cc:87 UI/GTK2/src/queryDialog.cc:123
 msgid "None"
 msgstr "Ingen"
 
 #: UI/GTK2/src/importDialog_glade.cc:68
-#: UI/GTK2/src/propertiesDialog_glade.cc:67
+#: UI/GTK2/src/propertiesDialog_glade.cc:64
 msgid "Title:"
 msgstr "Titel:"
 
@@ -104,7 +105,7 @@
 msgid "Import"
 msgstr "Importera"
 
-#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:221
+#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:216
 msgid "Import URL"
 msgstr "Importera url"
 
@@ -136,396 +137,429 @@
 msgid "Helper application"
 msgstr "Hj?lpprogram"
 
-#: UI/GTK2/src/mainWindow.cc:211
+#: UI/GTK2/src/mainWindow.cc:212
 msgid "Query Name"
 msgstr "Fr?genamn"
 
-#: UI/GTK2/src/mainWindow.cc:216
+#: UI/GTK2/src/mainWindow.cc:217
 msgid "Last Run"
 msgstr "Senaste k?rning"
 
-#: UI/GTK2/src/mainWindow.cc:221
+#: UI/GTK2/src/mainWindow.cc:222
 msgid "Summary"
 msgstr "Sammandrag"
 
 #. Set tooltips
-#: UI/GTK2/src/mainWindow.cc:255
+#: UI/GTK2/src/mainWindow.cc:252
 msgid "Show all search engines"
 msgstr "Visa alla s?kmotorer"
 
-#: UI/GTK2/src/mainWindow.cc:256
-msgid "Add index"
+#: UI/GTK2/src/mainWindow.cc:253
+msgid "Find documents that match the query string"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:254
+#, fuzzy
+msgid "Add an index"
 msgstr "L?gg till index"
 
-#: UI/GTK2/src/mainWindow.cc:257
-msgid "Remove index"
+#: UI/GTK2/src/mainWindow.cc:255
+#, fuzzy
+msgid "Remove an index"
 msgstr "Ta bort index"
 
+#: UI/GTK2/src/mainWindow.cc:256
+#, fuzzy
+msgid "Add a query"
+msgstr "Lade till ny fr?ga"
+
+#: UI/GTK2/src/mainWindow.cc:257
+#, fuzzy
+msgid "Remove a query"
+msgstr "Levande fr?ga"
+
+#: UI/GTK2/src/mainWindow.cc:258
+msgid "Show the query's previous results"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:259
+msgid "Find documents that match the query"
+msgstr ""
+
 #. Now we are ready
-#: UI/GTK2/src/mainWindow.cc:282
+#: UI/GTK2/src/mainWindow.cc:289
 msgid "Ready"
 msgstr "Redo"
 
-#: UI/GTK2/src/mainWindow.cc:342
+#: UI/GTK2/src/mainWindow.cc:349
 msgid "N/A"
 msgstr "-"
 
-#: UI/GTK2/src/mainWindow.cc:357
+#: UI/GTK2/src/mainWindow.cc:364
 msgid "Undefined"
 msgstr "Odefinierad"
 
+#. Find this query
+#: UI/GTK2/src/mainWindow.cc:587 UI/GTK2/src/mainWindow.cc:2675
+msgid "Live query"
+msgstr "Levande fr?ga"
+
 #. Show the URL of the first result in the status bar
-#: UI/GTK2/src/mainWindow.cc:611
+#: UI/GTK2/src/mainWindow.cc:727
 msgid "Result location is"
 msgstr "Resultatplatsen ?r"
 
 #. Show the URL in the status bar
-#: UI/GTK2/src/mainWindow.cc:691
+#: UI/GTK2/src/mainWindow.cc:809
 msgid "Document location is"
 msgstr "Dokumentplatsen ?r"
 
-#: UI/GTK2/src/mainWindow.cc:1024
+#: UI/GTK2/src/mainWindow.cc:993 UI/GTK2/src/mainWindow.cc:2109
+msgid "Couldn't find query"
+msgstr "Kunde inte hitta fr?ga"
+
+#: UI/GTK2/src/mainWindow.cc:1008
+#, fuzzy
+msgid "In Results"
+msgstr "resultat"
+
+#: UI/GTK2/src/mainWindow.cc:1191
 msgid "Showing"
 msgstr "Visar"
 
-#: UI/GTK2/src/mainWindow.cc:1029
+#: UI/GTK2/src/mainWindow.cc:1196
 msgid "of"
 msgstr "av"
 
-#: UI/GTK2/src/mainWindow.cc:1034
+#: UI/GTK2/src/mainWindow.cc:1201
 msgid "documents, starting at"
 msgstr "dokument, b?rjar med"
 
-#: UI/GTK2/src/mainWindow.cc:1068
+#: UI/GTK2/src/mainWindow.cc:1235
 msgid "Query"
 msgstr "Fr?ga"
 
-#: UI/GTK2/src/mainWindow.cc:1072 UI/GTK2/src/mainWindow.cc:3177
+#: UI/GTK2/src/mainWindow.cc:1239 UI/GTK2/src/mainWindow.cc:3268
 msgid "on"
 msgstr "p?"
 
-#: UI/GTK2/src/mainWindow.cc:1076
+#: UI/GTK2/src/mainWindow.cc:1243
 msgid "ended"
 msgstr "slutade"
 
-#: UI/GTK2/src/mainWindow.cc:1137
+#: UI/GTK2/src/mainWindow.cc:1304
 msgid "Corrected"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:1223
+#: UI/GTK2/src/mainWindow.cc:1393
 msgid "More Like"
 msgstr "Kanske mer som"
 
-#: UI/GTK2/src/mainWindow.cc:1265
+#: UI/GTK2/src/mainWindow.cc:1435
 msgid "Updated label(s)"
 msgstr "Uppdaterade etikett(er)"
 
 #. Yes, it did
-#: UI/GTK2/src/mainWindow.cc:1349
+#: UI/GTK2/src/mainWindow.cc:1519 UI/GTK2/src/mainWindow.cc:1613
 msgid "Updated document"
 msgstr "Uppdaterade dokument"
 
-#: UI/GTK2/src/mainWindow.cc:1362
+#: UI/GTK2/src/mainWindow.cc:1532
 msgid "Indexed"
 msgstr "Indexerade"
 
-#: UI/GTK2/src/mainWindow.cc:1404
+#: UI/GTK2/src/mainWindow.cc:1574
 msgid "Unindexed document(s)"
 msgstr "Ej indexerade dokument"
 
-#: UI/GTK2/src/mainWindow.cc:1444
-msgid "Updated document properties"
-msgstr "Egenskaper f?r uppdaterade dokument"
-
-#: UI/GTK2/src/mainWindow.cc:1497
+#: UI/GTK2/src/mainWindow.cc:1671
 msgid "Couldn't rename index, name"
 msgstr "Kunde inte byta namn p? index, namn"
 
-#: UI/GTK2/src/mainWindow.cc:1501 UI/GTK2/src/mainWindow.cc:2441
-#: UI/GTK2/src/mainWindow.cc:2982
+#: UI/GTK2/src/mainWindow.cc:1675 UI/GTK2/src/mainWindow.cc:2501
+#: UI/GTK2/src/mainWindow.cc:3072
 msgid "is already in use"
 msgstr "anv?nds redan"
 
-#: UI/GTK2/src/mainWindow.cc:1514
+#: UI/GTK2/src/mainWindow.cc:1688
 msgid "Couldn't rename index"
 msgstr "Kunde inte byta namn p? index"
 
-#: UI/GTK2/src/mainWindow.cc:1527
+#: UI/GTK2/src/mainWindow.cc:1701
 msgid "Edited index"
 msgstr "Redigerade index"
 
-#: UI/GTK2/src/mainWindow.cc:1853
+#: UI/GTK2/src/mainWindow.cc:2029
 msgid "Export Results"
 msgstr "Exportresultat"
 
-#. Find this query
-#: UI/GTK2/src/mainWindow.cc:1942 UI/GTK2/src/mainWindow.cc:2615
-msgid "Live query"
-msgstr "Levande fr?ga"
-
-#: UI/GTK2/src/mainWindow.cc:1968
-msgid "Couldn't find query"
-msgstr "Kunde inte hitta fr?ga"
-
-#: UI/GTK2/src/mainWindow.cc:2167 UI/GTK2/src/WorkerThreads.cpp:678
-#: UI/GTK2/src/WorkerThreads.cpp:1720
+#: UI/GTK2/src/mainWindow.cc:2304
 msgid "Index"
 msgstr "Index"
 
-#: UI/GTK2/src/mainWindow.cc:2171 UI/GTK2/src/WorkerThreads.cpp:682
-#: UI/GTK2/src/WorkerThreads.cpp:1724
+#: UI/GTK2/src/mainWindow.cc:2308
 msgid "doesn't exist"
 msgstr "finns inte"
 
-#: UI/GTK2/src/mainWindow.cc:2326
+#: UI/GTK2/src/mainWindow.cc:2386
 msgid "Remove this document from the index ?"
 msgstr "Ta bort detta dokument fr?n indexet?"
 
-#: UI/GTK2/src/mainWindow.cc:2345
+#: UI/GTK2/src/mainWindow.cc:2405
 msgid "Remove these documents from the index ?"
 msgstr "Ta bort dessa dokument fr?n indexet?"
 
-#: UI/GTK2/src/mainWindow.cc:2391
+#: UI/GTK2/src/mainWindow.cc:2451
 msgid "A metasearch tool for the Free Desktop"
 msgstr "Ett metas?kningsverktyg f?r Free Desktop"
 
-#: UI/GTK2/src/mainWindow.cc:2392
+#: UI/GTK2/src/mainWindow.cc:2452
 msgid "Search the Web and your documents !"
 msgstr "S?k p? webben och i dina dokument!"
 
-#: UI/GTK2/src/mainWindow.cc:2437
+#: UI/GTK2/src/mainWindow.cc:2497
 msgid "Index name"
 msgstr "Indexnamn"
 
-#: UI/GTK2/src/mainWindow.cc:2452
+#: UI/GTK2/src/mainWindow.cc:2512
 msgid "Couldn't add index"
 msgstr "Kunde inte l?gga till index"
 
-#: UI/GTK2/src/mainWindow.cc:2468
+#: UI/GTK2/src/mainWindow.cc:2528
 msgid "Added new index"
 msgstr "Lade till nytt index"
 
-#: UI/GTK2/src/mainWindow.cc:2503
+#: UI/GTK2/src/mainWindow.cc:2563
 msgid "Couldn't remove index"
 msgstr "Kunde inte ta bort index"
 
-#: UI/GTK2/src/mainWindow.cc:2795
+#: UI/GTK2/src/mainWindow.cc:2768
+msgid "No history for"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:2884
 msgid "At least one task hasn't completed yet. Quit now ?"
 msgstr "?tminstone en uppgift har inte f?rdigst?llts ?n. Avsluta nu?"
 
-#: UI/GTK2/src/mainWindow.cc:2978
+#: UI/GTK2/src/mainWindow.cc:3068
 msgid "Query name"
 msgstr "Fr?genamn"
 
-#: UI/GTK2/src/mainWindow.cc:3005
+#: UI/GTK2/src/mainWindow.cc:3095
 msgid "Couldn't update query"
 msgstr "Kunde inte uppdatera fr?ga"
 
-#: UI/GTK2/src/mainWindow.cc:3013
+#: UI/GTK2/src/mainWindow.cc:3103
 msgid "Edited query"
 msgstr "Redigerade fr?ga"
 
-#: UI/GTK2/src/mainWindow.cc:3020
+#: UI/GTK2/src/mainWindow.cc:3110
 msgid "Couldn't add query"
 msgstr "Kunde inte l?gga till fr?ga"
 
-#: UI/GTK2/src/mainWindow.cc:3028
+#: UI/GTK2/src/mainWindow.cc:3118
 msgid "Added new query"
 msgstr "Lade till ny fr?ga"
 
-#: UI/GTK2/src/mainWindow.cc:3066
+#: UI/GTK2/src/mainWindow.cc:3157
 msgid "Query is not set"
 msgstr "Fr?gan ?r inte inst?lld"
 
-#: UI/GTK2/src/mainWindow.cc:3077
+#: UI/GTK2/src/mainWindow.cc:3168
 msgid "No search engine selected"
 msgstr "Ingen s?kmotor vald"
 
-#: UI/GTK2/src/mainWindow.cc:3164
+#: UI/GTK2/src/mainWindow.cc:3255
 msgid "Please set the Google API key first"
 msgstr "St?ll in Google API-nyckeln f?rst"
 
-#: UI/GTK2/src/mainWindow.cc:3173
+#: UI/GTK2/src/mainWindow.cc:3264
 msgid "Running query"
 msgstr "K?r fr?ga"
 
-#: UI/GTK2/src/mainWindow.cc:3382
+#: UI/GTK2/src/mainWindow.cc:3473
 msgid "No default application defined for type"
 msgstr "Inget standardprogram definierat f?r typen"
 
-#: UI/GTK2/src/mainWindow_glade.cc:126
+#: UI/GTK2/src/mainWindow_glade.cc:127
 msgid "Query:"
 msgstr "Fr?ga:"
 
-#: UI/GTK2/src/mainWindow_glade.cc:138
-msgid "Edit"
-msgstr "Redigera"
+#: UI/GTK2/src/mainWindow_glade.cc:138 UI/GTK2/src/statisticsDialog.cc:88
+msgid "History"
+msgstr "Historik"
 
-#: UI/GTK2/src/mainWindow_glade.cc:147
+#: UI/GTK2/src/mainWindow_glade.cc:143
 msgid "Stored queries"
 msgstr "Lagrade fr?gor"
 
-#: UI/GTK2/src/mainWindow_glade.cc:164 UI/GTK2/src/statisticsDialog.cc:50
+#: UI/GTK2/src/mainWindow_glade.cc:156 UI/GTK2/src/statisticsDialog.cc:51
 #: UI/GTK2/src/statisticsDialog_glade.cc:87
 msgid "Status"
 msgstr "Status"
 
-#: UI/GTK2/src/mainWindow_glade.cc:185
+#: UI/GTK2/src/mainWindow_glade.cc:177
 msgid "Search Engine"
 msgstr "S?kmotor"
 
-#: UI/GTK2/src/mainWindow_glade.cc:188
+#: UI/GTK2/src/mainWindow_glade.cc:180
 msgid "Host Name"
 msgstr "V?rdnamn"
 
-#: UI/GTK2/src/mainWindow_glade.cc:191
+#: UI/GTK2/src/mainWindow_glade.cc:183
 msgid "Show Extract"
 msgstr "Visa utdrag"
 
-#: UI/GTK2/src/mainWindow_glade.cc:194
+#: UI/GTK2/src/mainWindow_glade.cc:186
 msgid "Group By"
 msgstr "Gruppera efter"
 
-#: UI/GTK2/src/mainWindow_glade.cc:200
+#: UI/GTK2/src/mainWindow_glade.cc:192
 msgid "Clear List"
 msgstr "T?m lista"
 
-#: UI/GTK2/src/mainWindow_glade.cc:206
+#: UI/GTK2/src/mainWindow_glade.cc:198
 msgid "Vie_w"
 msgstr "Vi_sa"
 
-#: UI/GTK2/src/mainWindow_glade.cc:209
+#: UI/GTK2/src/mainWindow_glade.cc:201
 msgid "View Cache"
 msgstr "Visa cache"
 
-#: UI/GTK2/src/mainWindow_glade.cc:212
+#: UI/GTK2/src/mainWindow_glade.cc:204
 msgid "More Like This"
 msgstr "Mer som det h?r"
 
-#: UI/GTK2/src/mainWindow_glade.cc:215 UI/GTK2/src/mainWindow_glade.cc:251
+#: UI/GTK2/src/mainWindow_glade.cc:207
+#, fuzzy
+msgid "Search This For"
+msgstr "S?kmotorer"
+
+#: UI/GTK2/src/mainWindow_glade.cc:210 UI/GTK2/src/mainWindow_glade.cc:246
 msgid "_Index"
 msgstr "_Index"
 
-#: UI/GTK2/src/mainWindow_glade.cc:218
+#: UI/GTK2/src/mainWindow_glade.cc:213
 msgid "List Contents Of"
 msgstr "Lista inneh?ll f?r"
 
-#: UI/GTK2/src/mainWindow_glade.cc:227
+#: UI/GTK2/src/mainWindow_glade.cc:222
 msgid "View"
 msgstr "Visa"
 
-#: UI/GTK2/src/mainWindow_glade.cc:230
+#: UI/GTK2/src/mainWindow_glade.cc:225
 msgid "Update"
 msgstr "Uppdatera"
 
-#: UI/GTK2/src/mainWindow_glade.cc:233
+#: UI/GTK2/src/mainWindow_glade.cc:228
 msgid "Unindex"
 msgstr "Avindexera"
 
-#: UI/GTK2/src/mainWindow_glade.cc:236
-#: UI/GTK2/src/propertiesDialog_glade.cc:177
+#: UI/GTK2/src/mainWindow_glade.cc:231
+#: UI/GTK2/src/propertiesDialog_glade.cc:225
 msgid "Properties"
 msgstr "Egenskaper"
 
-#: UI/GTK2/src/mainWindow_glade.cc:239
+#: UI/GTK2/src/mainWindow_glade.cc:234
 msgid "_About"
 msgstr "_Om"
 
-#: UI/GTK2/src/mainWindow_glade.cc:242
+#: UI/GTK2/src/mainWindow_glade.cc:237
 msgid "_Session"
 msgstr "_Session"
 
-#: UI/GTK2/src/mainWindow_glade.cc:245
+#: UI/GTK2/src/mainWindow_glade.cc:240
 msgid "_Edit"
 msgstr "R_edigera"
 
-#: UI/GTK2/src/mainWindow_glade.cc:248
+#: UI/GTK2/src/mainWindow_glade.cc:243
 msgid "_Results"
 msgstr "_Resultat"
 
-#: UI/GTK2/src/mainWindow_glade.cc:254
+#: UI/GTK2/src/mainWindow_glade.cc:249
 msgid "_Help"
 msgstr "_Hj?lp"
 
-#: UI/GTK2/src/mainWindow_glade.cc:403
+#: UI/GTK2/src/mainWindow_glade.cc:378
 msgid "Pinot"
 msgstr "Pinot"
 
 #. Localize language names
-#: UI/GTK2/src/pinot.cc:249 UI/GTK2/src/pinot-dbus-daemon.cc:324
-#: UI/GTK2/src/propertiesDialog.cc:72 UI/GTK2/src/propertiesDialog.cc:81
+#: UI/GTK2/src/pinot.cc:233 UI/GTK2/src/pinot-dbus-daemon.cc:312
+#: UI/GTK2/src/propertiesDialog.cc:97
 msgid "Unknown"
 msgstr "Ok?nd"
 
-#: UI/GTK2/src/pinot.cc:250 UI/GTK2/src/pinot-dbus-daemon.cc:325
+#: UI/GTK2/src/pinot.cc:234 UI/GTK2/src/pinot-dbus-daemon.cc:313
 msgid "Danish"
 msgstr "Danska"
 
-#: UI/GTK2/src/pinot.cc:251 UI/GTK2/src/pinot-dbus-daemon.cc:326
+#: UI/GTK2/src/pinot.cc:235 UI/GTK2/src/pinot-dbus-daemon.cc:314
 msgid "Dutch"
 msgstr "Nederl?ndska"
 
-#: UI/GTK2/src/pinot.cc:252 UI/GTK2/src/pinot-dbus-daemon.cc:327
+#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:315
 msgid "English"
 msgstr "Engelska"
 
-#: UI/GTK2/src/pinot.cc:253 UI/GTK2/src/pinot-dbus-daemon.cc:328
+#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:316
 msgid "Finnish"
 msgstr "Finska"
 
-#: UI/GTK2/src/pinot.cc:254 UI/GTK2/src/pinot-dbus-daemon.cc:329
+#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:317
 msgid "French"
 msgstr "Franska"
 
-#: UI/GTK2/src/pinot.cc:255 UI/GTK2/src/pinot-dbus-daemon.cc:330
+#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:318
 msgid "German"
 msgstr "Tyska"
 
-#: UI/GTK2/src/pinot.cc:256 UI/GTK2/src/pinot-dbus-daemon.cc:331
+#: UI/GTK2/src/pinot.cc:240 UI/GTK2/src/pinot-dbus-daemon.cc:319
 msgid "Hungarian"
 msgstr "Ungerska"
 
-#: UI/GTK2/src/pinot.cc:257 UI/GTK2/src/pinot-dbus-daemon.cc:332
+#: UI/GTK2/src/pinot.cc:241 UI/GTK2/src/pinot-dbus-daemon.cc:320
 msgid "Italian"
 msgstr "Italienska"
 
-#: UI/GTK2/src/pinot.cc:258 UI/GTK2/src/pinot-dbus-daemon.cc:333
+#: UI/GTK2/src/pinot.cc:242 UI/GTK2/src/pinot-dbus-daemon.cc:321
 msgid "Norwegian"
 msgstr "Norska"
 
-#: UI/GTK2/src/pinot.cc:259 UI/GTK2/src/pinot-dbus-daemon.cc:334
+#: UI/GTK2/src/pinot.cc:243 UI/GTK2/src/pinot-dbus-daemon.cc:322
 msgid "Portuguese"
 msgstr "Portugisiska"
 
-#: UI/GTK2/src/pinot.cc:260 UI/GTK2/src/pinot-dbus-daemon.cc:335
+#: UI/GTK2/src/pinot.cc:244 UI/GTK2/src/pinot-dbus-daemon.cc:323
 msgid "Romanian"
 msgstr "Rum?nska"
 
-#: UI/GTK2/src/pinot.cc:261 UI/GTK2/src/pinot-dbus-daemon.cc:336
+#: UI/GTK2/src/pinot.cc:245 UI/GTK2/src/pinot-dbus-daemon.cc:324
 msgid "Russian"
 msgstr "Ryska"
 
-#: UI/GTK2/src/pinot.cc:262 UI/GTK2/src/pinot-dbus-daemon.cc:337
+#: UI/GTK2/src/pinot.cc:246 UI/GTK2/src/pinot-dbus-daemon.cc:325
 msgid "Spanish"
 msgstr "Spanska"
 
-#: UI/GTK2/src/pinot.cc:263 UI/GTK2/src/pinot-dbus-daemon.cc:338
+#: UI/GTK2/src/pinot.cc:247 UI/GTK2/src/pinot-dbus-daemon.cc:326
 msgid "Swedish"
 msgstr "Svenska"
 
-#: UI/GTK2/src/pinot.cc:264 UI/GTK2/src/pinot-dbus-daemon.cc:339
+#: UI/GTK2/src/pinot.cc:248 UI/GTK2/src/pinot-dbus-daemon.cc:327
 msgid "Turkish"
 msgstr "Turkiska"
 
-#: UI/GTK2/src/pinot.cc:289
+#: UI/GTK2/src/pinot.cc:273
 msgid "Couldn't open index"
 msgstr "Kunde inte ?ppna index"
 
-#: UI/GTK2/src/pinot.cc:310
+#: UI/GTK2/src/pinot.cc:294
 msgid "Couldn't create history database"
 msgstr "Kunde inte skapa historikdatabas"
 
-#: UI/GTK2/src/pinot.cc:336
+#. Warn the user
+#: UI/GTK2/src/pinot.cc:330
 msgid "Updating all documents in My Web Pages is recommended"
 msgstr "Uppdatering av alla dokument i Mina webbsidor rekommenderas"
 
@@ -542,39 +576,43 @@
 msgid "Personal"
 msgstr "Personlig"
 
-#: UI/GTK2/src/PinotSettings.cpp:1198
+#: UI/GTK2/src/PinotSettings.cpp:358
+msgid "Me"
+msgstr ""
+
+#: UI/GTK2/src/PinotSettings.cpp:1233
 msgid "Unclassified"
 msgstr "Oklassificerad"
 
-#: UI/GTK2/src/prefsDialog.cc:81
+#: UI/GTK2/src/prefsDialog.cc:83
 msgid "Name"
 msgstr "Namn"
 
-#: UI/GTK2/src/prefsDialog.cc:89
+#: UI/GTK2/src/prefsDialog.cc:91
 msgid "Monitor"
 msgstr "?vervaka"
 
-#: UI/GTK2/src/prefsDialog.cc:90
+#: UI/GTK2/src/prefsDialog.cc:92
 msgid "Location"
 msgstr "Plats"
 
-#: UI/GTK2/src/prefsDialog.cc:98
+#: UI/GTK2/src/prefsDialog.cc:100
 msgid "Pattern"
 msgstr "M?nster"
 
-#: UI/GTK2/src/prefsDialog.cc:315
+#: UI/GTK2/src/prefsDialog.cc:357
 msgid "Exclude these patterns from indexing"
 msgstr "Undanta dessa m?nster fr?n indexering"
 
-#: UI/GTK2/src/prefsDialog.cc:316
+#: UI/GTK2/src/prefsDialog.cc:358
 msgid "Only index these patterns"
 msgstr "Indexera endast dessa m?nster"
 
-#: UI/GTK2/src/prefsDialog.cc:406
+#: UI/GTK2/src/prefsDialog.cc:478
 msgid "New Label"
 msgstr "Ny etikett"
 
-#: UI/GTK2/src/prefsDialog.cc:447
+#: UI/GTK2/src/prefsDialog.cc:519
 msgid "Directory to index"
 msgstr "Katalog f?r index"
 
@@ -631,7 +669,7 @@
 msgid "Remove"
 msgstr "Ta bort"
 
-#: UI/GTK2/src/prefsDialog_glade.cc:113
+#: UI/GTK2/src/prefsDialog_glade.cc:113 UI/GTK2/src/propertiesDialog.cc:56
 msgid "Labels"
 msgstr "Etiketter"
 
@@ -653,79 +691,98 @@
 msgid "Preferences"
 msgstr "Inst?llningar"
 
-#: UI/GTK2/src/propertiesDialog.cc:60 UI/GTK2/src/queryDialog.cc:124
-msgid "Label"
-msgstr "Etikett"
-
-#: UI/GTK2/src/propertiesDialog.cc:93
+#: UI/GTK2/src/propertiesDialog.cc:110
 msgid "Per document"
 msgstr "Per dokument"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:68
+#: UI/GTK2/src/propertiesDialog.cc:368
+#, fuzzy
+msgid "Export Terms"
+msgstr "Exportresultat"
+
+#: UI/GTK2/src/propertiesDialog_glade.cc:65
 msgid "Language:"
 msgstr "Spr?k:"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:69
+#: UI/GTK2/src/propertiesDialog_glade.cc:66
 msgid "MIME type:"
 msgstr "MIME-typ:"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:70
+#: UI/GTK2/src/propertiesDialog_glade.cc:67
 msgid "Size:"
 msgstr "Storlek:"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:73
+#: UI/GTK2/src/propertiesDialog_glade.cc:68
 msgid "Terms:"
 msgstr "Villkor:"
 
-#: UI/GTK2/src/queryDialog.cc:114
+#: UI/GTK2/src/propertiesDialog_glade.cc:78
+msgid "bytes"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog.cc:94
 msgid "Host name"
 msgstr "V?rdnamn"
 
-#: UI/GTK2/src/queryDialog.cc:115
+#: UI/GTK2/src/queryDialog.cc:95
 msgid "File name"
 msgstr "Filnamn"
 
-#: UI/GTK2/src/queryDialog.cc:118
+#: UI/GTK2/src/queryDialog.cc:96
 msgid "File extension"
 msgstr "Fil?ndelse"
 
 #. This is the title column
-#: UI/GTK2/src/queryDialog.cc:119 UI/GTK2/src/ResultsTree.cpp:133
+#: UI/GTK2/src/queryDialog.cc:97 UI/GTK2/src/ResultsTree.cpp:133
 msgid "Title"
 msgstr "Titel"
 
 #. URL
-#: UI/GTK2/src/queryDialog.cc:120 UI/GTK2/src/ResultsTree.cpp:143
+#: UI/GTK2/src/queryDialog.cc:98 UI/GTK2/src/ResultsTree.cpp:143
 msgid "URL"
 msgstr "Url"
 
-#: UI/GTK2/src/queryDialog.cc:121
+#: UI/GTK2/src/queryDialog.cc:99
 msgid "Directory"
 msgstr "Katalog"
 
-#: UI/GTK2/src/queryDialog.cc:122
+#: UI/GTK2/src/queryDialog.cc:100
 msgid "Language code"
 msgstr "Spr?kkod"
 
-#: UI/GTK2/src/queryDialog.cc:123
+#: UI/GTK2/src/queryDialog.cc:101
 msgid "MIME type"
 msgstr "MIME-typ"
 
+#: UI/GTK2/src/queryDialog.cc:102
+msgid "Label"
+msgstr "Etikett"
+
 #. The last column is for the timestamp
-#: UI/GTK2/src/queryDialog.cc:127 UI/GTK2/src/ResultsTree.cpp:151
+#: UI/GTK2/src/queryDialog.cc:105 UI/GTK2/src/ResultsTree.cpp:151
 msgid "Date"
 msgstr "Datum"
 
-#: UI/GTK2/src/queryDialog.cc:128
+#: UI/GTK2/src/queryDialog.cc:106
 #, fuzzy
 msgid "Time"
 msgstr "Titel"
 
-#: UI/GTK2/src/queryDialog.cc:129
+#: UI/GTK2/src/queryDialog.cc:107
 #, fuzzy
 msgid "Size"
 msgstr "Storlek:"
 
+#. Sort order
+#: UI/GTK2/src/queryDialog.cc:111
+msgid "By relevance"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog.cc:112
+#, fuzzy
+msgid "By date"
+msgstr "Uppdatera"
+
 #: UI/GTK2/src/queryDialog_glade.cc:72
 #, fuzzy
 msgid "New filter or range:"
@@ -743,7 +800,11 @@
 msgid "Number of results:"
 msgstr "Antal resultat:"
 
-#: UI/GTK2/src/queryDialog_glade.cc:181
+#: UI/GTK2/src/queryDialog_glade.cc:90
+msgid "Sort order:"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog_glade.cc:192
 msgid "Query parameters"
 msgstr "Fr?geparametrar"
 
@@ -756,124 +817,131 @@
 msgid "Extract"
 msgstr "Utdrag"
 
-#: UI/GTK2/src/statisticsDialog.cc:72
+#: UI/GTK2/src/statisticsDialog.cc:73
 msgid "Indexes"
 msgstr "Index"
 
-#: UI/GTK2/src/statisticsDialog.cc:87
-msgid "History"
-msgstr "Historik"
-
-#: UI/GTK2/src/statisticsDialog.cc:92
+#: UI/GTK2/src/statisticsDialog.cc:93
 msgid "Daemon"
 msgstr "Demon"
 
-#: UI/GTK2/src/statisticsDialog.cc:128 UI/GTK2/src/statisticsDialog.cc:143
+#: UI/GTK2/src/statisticsDialog.cc:128 UI/GTK2/src/statisticsDialog.cc:144
 msgid "documents"
 msgstr "dokument"
 
-#: UI/GTK2/src/statisticsDialog.cc:132 UI/GTK2/src/statisticsDialog.cc:147
+#: UI/GTK2/src/statisticsDialog.cc:134 UI/GTK2/src/statisticsDialog.cc:150
+#: UI/GTK2/src/WorkerThreads.cpp:126
 msgid "Unknown error"
 msgstr "Ok?nt fel"
 
-#: UI/GTK2/src/statisticsDialog.cc:154
+#: UI/GTK2/src/statisticsDialog.cc:157
 msgid "Viewed"
 msgstr "Visad"
 
-#: UI/GTK2/src/statisticsDialog.cc:154
+#: UI/GTK2/src/statisticsDialog.cc:157
 msgid "results"
 msgstr "resultat"
 
 #. FIXME: check whether it's actually running !
-#: UI/GTK2/src/statisticsDialog.cc:171
+#: UI/GTK2/src/statisticsDialog.cc:174
 msgid "Running under PID"
 msgstr "K?r under PID"
 
-#: UI/GTK2/src/statisticsDialog.cc:175
+#: UI/GTK2/src/statisticsDialog.cc:178
 msgid "Currently not running"
 msgstr "K?r f?r tillf?llet inte"
 
-#: UI/GTK2/src/statisticsDialog.cc:182
+#: UI/GTK2/src/statisticsDialog.cc:185
 msgid "Crawled"
 msgstr "Insamlad"
 
-#: UI/GTK2/src/statisticsDialog.cc:182
+#: UI/GTK2/src/statisticsDialog.cc:185
 msgid "files"
 msgstr "filer"
 
-#: UI/GTK2/src/statisticsDialog.cc:205
+#: UI/GTK2/src/statisticsDialog.cc:206
 msgid "Errors"
 msgstr "Fel"
 
-#: UI/GTK2/src/WorkerThreads.cpp:307
-msgid "Can't index mail here"
-msgstr "Kan inte indexera post h?r"
+#: UI/GTK2/src/WorkerThreads.cpp:93
+#, fuzzy
+msgid "Index error"
+msgstr "Indexfel p?"
 
-#: UI/GTK2/src/WorkerThreads.cpp:328 UI/GTK2/src/WorkerThreads.cpp:581
-msgid "is already being indexed"
-msgstr "h?ller redan p? att bli indexerad"
+#: UI/GTK2/src/WorkerThreads.cpp:95
+#, fuzzy
+msgid "Couldn't index document"
+msgstr "Kunde inte avindexera dokument"
 
-#: UI/GTK2/src/WorkerThreads.cpp:338
-msgid "is blacklisted"
-msgstr "?r svartlistad"
+#: UI/GTK2/src/WorkerThreads.cpp:97
+msgid "Couldn't update document"
+msgstr "Kunde inte uppdatera dokument"
 
-#: UI/GTK2/src/WorkerThreads.cpp:691 UI/GTK2/src/WorkerThreads.cpp:1051
-#: UI/GTK2/src/WorkerThreads.cpp:1135 UI/GTK2/src/WorkerThreads.cpp:1144
-#: UI/GTK2/src/WorkerThreads.cpp:1330 UI/GTK2/src/WorkerThreads.cpp:1600
-#: UI/GTK2/src/WorkerThreads.cpp:1733
-msgid "Index error on"
-msgstr "Indexfel p?"
+#: UI/GTK2/src/WorkerThreads.cpp:99
+msgid "Couldn't unindex document(s)"
+msgstr "Kunde inte avindexera dokument"
 
-#: UI/GTK2/src/WorkerThreads.cpp:844
-msgid "No title"
-msgstr "Ingen titel"
-
-#: UI/GTK2/src/WorkerThreads.cpp:946 UI/GTK2/src/WorkerThreads.cpp:1072
-msgid "Couldn't create search engine"
-msgstr "Kunde inte skapa s?kmotor"
-
-#: UI/GTK2/src/WorkerThreads.cpp:970 UI/GTK2/src/WorkerThreads.cpp:1085
+#: UI/GTK2/src/WorkerThreads.cpp:101
 msgid "Couldn't run query on search engine"
 msgstr "Kunde inte k?ra fr?ga p? s?kmotor"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1238
-msgid "Couldn't obtain downloader for protocol"
-msgstr "Kunde inte f? protokollh?mtare"
+#: UI/GTK2/src/WorkerThreads.cpp:103
+#, fuzzy
+msgid "Couldn't get history for search engine"
+msgstr "Kunde inte k?ra fr?ga p? s?kmotor"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1263
-msgid "Couldn't retrieve"
-msgstr "Kunde inte h?mta"
+#: UI/GTK2/src/WorkerThreads.cpp:105
+#, fuzzy
+msgid "Couldn't retrieve document"
+msgstr "Kunde inte uppdatera dokument"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1360 UI/GTK2/src/WorkerThreads.cpp:1439
+#: UI/GTK2/src/WorkerThreads.cpp:107
+msgid "Couldn't initialize file monitor"
+msgstr ""
+
+#: UI/GTK2/src/WorkerThreads.cpp:109
+#, fuzzy
+msgid "Couldn't open directory"
+msgstr "Kunde inte ?ppna index"
+
+#: UI/GTK2/src/WorkerThreads.cpp:111
+#, fuzzy
+msgid "Index doesn't exist"
+msgstr "finns inte"
+
+#: UI/GTK2/src/WorkerThreads.cpp:113
+msgid "Couldn't create search engine"
+msgstr "Kunde inte skapa s?kmotor"
+
+#: UI/GTK2/src/WorkerThreads.cpp:115
 msgid "Cannot index document type"
 msgstr "Kan inte indexera dokumenttyp"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1364 UI/GTK2/src/WorkerThreads.cpp:1443
-msgid "at"
-msgstr "p?"
+#: UI/GTK2/src/WorkerThreads.cpp:117
+#, fuzzy
+msgid "No downloader for this protocol"
+msgstr "Kunde inte f? protokollh?mtare"
 
-#. No, it isn't
-#: UI/GTK2/src/WorkerThreads.cpp:1475
+#: UI/GTK2/src/WorkerThreads.cpp:119
 msgid "Robots META tag forbids indexing"
 msgstr "Robots META-tagg f?rbjuder indexering"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1529
-msgid "Couldn't index"
-msgstr "Kunde inte indexera"
+#: UI/GTK2/src/WorkerThreads.cpp:121
+msgid "No monitoring handler"
+msgstr ""
 
-#. Be pessimistic and assume something will go wrong ;-)
-#: UI/GTK2/src/WorkerThreads.cpp:1611
-msgid "Couldn't unindex document(s)"
-msgstr "Kunde inte avindexera dokument"
+#: UI/GTK2/src/WorkerThreads.cpp:391
+msgid "Can't index mail here"
+msgstr "Kan inte indexera post h?r"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1745
-msgid "Couldn't update document"
-msgstr "Kunde inte uppdatera dokument"
+#: UI/GTK2/src/WorkerThreads.cpp:412 UI/GTK2/src/WorkerThreads.cpp:666
+msgid "is already being indexed"
+msgstr "h?ller redan p? att bli indexerad"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1981
-msgid "No monitoring handler"
-msgstr ""
+#: UI/GTK2/src/WorkerThreads.cpp:422
+msgid "is blacklisted"
+msgstr "?r svartlistad"
 
-#: UI/GTK2/src/WorkerThreads.cpp:2023
-msgid "Couldn't initialize file monitor"
-msgstr ""
+#: UI/GTK2/src/WorkerThreads.cpp:935
+msgid "No title"
+msgstr "Ingen titel"

Modified: trunk/po/zh_TW.po
===================================================================
--- trunk/po/zh_TW.po	2007-10-27 03:47:11 UTC (rev 1076)
+++ trunk/po/zh_TW.po	2007-10-27 12:57:33 UTC (rev 1077)
@@ -7,7 +7,7 @@
 msgstr ""
 "Project-Id-Version: pinot\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2007-09-23 19:22+0800\n"
+"POT-Creation-Date: 2007-10-27 00:15+0800\n"
 "PO-Revision-Date: 2007-08-17 15:54+0000\n"
 "Last-Translator: Yung-chung Lin <henearkrxern at gmail.com>\n"
 "Language-Team: Traditional Chinese <zh_TW at li.org>\n"
@@ -28,22 +28,22 @@
 #. Enable these menu items unless it is not the documents index
 #. Allow this only for internal indexes
 #. Internal indices
-#: UI/GTK2/src/EnginesTree.cpp:337 UI/GTK2/src/mainWindow.cc:677
-#: UI/GTK2/src/mainWindow.cc:1187 UI/GTK2/src/mainWindow.cc:1339
-#: UI/GTK2/src/mainWindow.cc:1381 UI/GTK2/src/mainWindow.cc:1403
-#: UI/GTK2/src/mainWindow.cc:1434 UI/GTK2/src/mainWindow.cc:2045
-#: UI/GTK2/src/mainWindow.cc:2157 UI/GTK2/src/PinotSettings.cpp:311
-#: UI/GTK2/src/PinotSettings.cpp:1387 UI/GTK2/src/PinotSettings.cpp:1443
-#: UI/GTK2/src/statisticsDialog.cc:77 UI/GTK2/src/WorkerThreads.cpp:822
-#: UI/GTK2/src/WorkerThreads.cpp:881
+#: UI/GTK2/src/EnginesTree.cpp:337 UI/GTK2/src/mainWindow.cc:795
+#: UI/GTK2/src/mainWindow.cc:1017 UI/GTK2/src/mainWindow.cc:1354
+#: UI/GTK2/src/mainWindow.cc:1509 UI/GTK2/src/mainWindow.cc:1551
+#: UI/GTK2/src/mainWindow.cc:1573 UI/GTK2/src/mainWindow.cc:2177
+#: UI/GTK2/src/mainWindow.cc:2287 UI/GTK2/src/PinotSettings.cpp:311
+#: UI/GTK2/src/PinotSettings.cpp:1421 UI/GTK2/src/PinotSettings.cpp:1477
+#: UI/GTK2/src/statisticsDialog.cc:78 UI/GTK2/src/WorkerThreads.cpp:972
 msgid "My Web Pages"
 msgstr "????"
 
-#: UI/GTK2/src/EnginesTree.cpp:338 UI/GTK2/src/mainWindow.cc:680
-#: UI/GTK2/src/mainWindow.cc:1194 UI/GTK2/src/mainWindow.cc:2158
-#: UI/GTK2/src/PinotSettings.cpp:312 UI/GTK2/src/PinotSettings.cpp:1388
-#: UI/GTK2/src/PinotSettings.cpp:1444 UI/GTK2/src/statisticsDialog.cc:82
-#: UI/GTK2/src/WorkerThreads.cpp:827 UI/GTK2/src/WorkerThreads.cpp:891
+#. Spawn new threads
+#: UI/GTK2/src/EnginesTree.cpp:338 UI/GTK2/src/mainWindow.cc:798
+#: UI/GTK2/src/mainWindow.cc:1011 UI/GTK2/src/mainWindow.cc:1361
+#: UI/GTK2/src/mainWindow.cc:2291 UI/GTK2/src/PinotSettings.cpp:312
+#: UI/GTK2/src/PinotSettings.cpp:1422 UI/GTK2/src/PinotSettings.cpp:1478
+#: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:982
 msgid "My Documents"
 msgstr "????"
 
@@ -87,12 +87,13 @@
 msgid "External index"
 msgstr "????"
 
-#: UI/GTK2/src/importDialog.cc:87 UI/GTK2/src/queryDialog.cc:95
+#. Labels
+#: UI/GTK2/src/importDialog.cc:87 UI/GTK2/src/queryDialog.cc:123
 msgid "None"
 msgstr "?"
 
 #: UI/GTK2/src/importDialog_glade.cc:68
-#: UI/GTK2/src/propertiesDialog_glade.cc:67
+#: UI/GTK2/src/propertiesDialog_glade.cc:64
 msgid "Title:"
 msgstr "?? :"
 
@@ -104,7 +105,7 @@
 msgid "Import"
 msgstr "??"
 
-#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:221
+#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:216
 msgid "Import URL"
 msgstr "??URL"
 
@@ -134,397 +135,430 @@
 msgid "Helper application"
 msgstr "????"
 
-#: UI/GTK2/src/mainWindow.cc:211
+#: UI/GTK2/src/mainWindow.cc:212
 msgid "Query Name"
 msgstr "????"
 
-#: UI/GTK2/src/mainWindow.cc:216
+#: UI/GTK2/src/mainWindow.cc:217
 msgid "Last Run"
 msgstr "???????"
 
-#: UI/GTK2/src/mainWindow.cc:221
+#: UI/GTK2/src/mainWindow.cc:222
 msgid "Summary"
 msgstr "??"
 
 #. Set tooltips
-#: UI/GTK2/src/mainWindow.cc:255
+#: UI/GTK2/src/mainWindow.cc:252
 msgid "Show all search engines"
 msgstr "?????????"
 
-#: UI/GTK2/src/mainWindow.cc:256
-msgid "Add index"
+#: UI/GTK2/src/mainWindow.cc:253
+msgid "Find documents that match the query string"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:254
+#, fuzzy
+msgid "Add an index"
 msgstr "????"
 
+#: UI/GTK2/src/mainWindow.cc:255
+#, fuzzy
+msgid "Remove an index"
+msgstr "????"
+
+#: UI/GTK2/src/mainWindow.cc:256
+#, fuzzy
+msgid "Add a query"
+msgstr "?????"
+
 #: UI/GTK2/src/mainWindow.cc:257
-msgid "Remove index"
+#, fuzzy
+msgid "Remove a query"
 msgstr "????"
 
+#: UI/GTK2/src/mainWindow.cc:258
+msgid "Show the query's previous results"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:259
+msgid "Find documents that match the query"
+msgstr ""
+
 #. Now we are ready
-#: UI/GTK2/src/mainWindow.cc:282
+#: UI/GTK2/src/mainWindow.cc:289
 msgid "Ready"
 msgstr "???"
 
-#: UI/GTK2/src/mainWindow.cc:342
+#: UI/GTK2/src/mainWindow.cc:349
 msgid "N/A"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:357
+#: UI/GTK2/src/mainWindow.cc:364
 msgid "Undefined"
 msgstr "???"
 
+#. Find this query
+#: UI/GTK2/src/mainWindow.cc:587 UI/GTK2/src/mainWindow.cc:2675
+msgid "Live query"
+msgstr ""
+
 #. Show the URL of the first result in the status bar
-#: UI/GTK2/src/mainWindow.cc:611
+#: UI/GTK2/src/mainWindow.cc:727
 msgid "Result location is"
 msgstr "??????"
 
 #. Show the URL in the status bar
-#: UI/GTK2/src/mainWindow.cc:691
+#: UI/GTK2/src/mainWindow.cc:809
 msgid "Document location is"
 msgstr "?????"
 
-#: UI/GTK2/src/mainWindow.cc:1024
+#: UI/GTK2/src/mainWindow.cc:993 UI/GTK2/src/mainWindow.cc:2109
+msgid "Couldn't find query"
+msgstr "???????"
+
+#: UI/GTK2/src/mainWindow.cc:1008
+#, fuzzy
+msgid "In Results"
+msgstr "??"
+
+#: UI/GTK2/src/mainWindow.cc:1191
 msgid "Showing"
 msgstr "??"
 
-#: UI/GTK2/src/mainWindow.cc:1029
+#: UI/GTK2/src/mainWindow.cc:1196
 msgid "of"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:1034
+#: UI/GTK2/src/mainWindow.cc:1201
 msgid "documents, starting at"
 msgstr "??????"
 
-#: UI/GTK2/src/mainWindow.cc:1068
+#: UI/GTK2/src/mainWindow.cc:1235
 msgid "Query"
 msgstr "??"
 
-#: UI/GTK2/src/mainWindow.cc:1072 UI/GTK2/src/mainWindow.cc:3177
+#: UI/GTK2/src/mainWindow.cc:1239 UI/GTK2/src/mainWindow.cc:3268
 msgid "on"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:1076
+#: UI/GTK2/src/mainWindow.cc:1243
 msgid "ended"
 msgstr "??"
 
-#: UI/GTK2/src/mainWindow.cc:1137
+#: UI/GTK2/src/mainWindow.cc:1304
 msgid "Corrected"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:1223
+#: UI/GTK2/src/mainWindow.cc:1393
 msgid "More Like"
 msgstr "????"
 
-#: UI/GTK2/src/mainWindow.cc:1265
+#: UI/GTK2/src/mainWindow.cc:1435
 msgid "Updated label(s)"
 msgstr "?????"
 
 #. Yes, it did
-#: UI/GTK2/src/mainWindow.cc:1349
+#: UI/GTK2/src/mainWindow.cc:1519 UI/GTK2/src/mainWindow.cc:1613
 msgid "Updated document"
 msgstr "?????"
 
-#: UI/GTK2/src/mainWindow.cc:1362
+#: UI/GTK2/src/mainWindow.cc:1532
 msgid "Indexed"
 msgstr "???"
 
-#: UI/GTK2/src/mainWindow.cc:1404
+#: UI/GTK2/src/mainWindow.cc:1574
 msgid "Unindexed document(s)"
 msgstr "??????"
 
-#: UI/GTK2/src/mainWindow.cc:1444
-msgid "Updated document properties"
-msgstr "???????"
-
-#: UI/GTK2/src/mainWindow.cc:1497
+#: UI/GTK2/src/mainWindow.cc:1671
 msgid "Couldn't rename index, name"
 msgstr "????????????"
 
-#: UI/GTK2/src/mainWindow.cc:1501 UI/GTK2/src/mainWindow.cc:2441
-#: UI/GTK2/src/mainWindow.cc:2982
+#: UI/GTK2/src/mainWindow.cc:1675 UI/GTK2/src/mainWindow.cc:2501
+#: UI/GTK2/src/mainWindow.cc:3072
 msgid "is already in use"
 msgstr "??????"
 
-#: UI/GTK2/src/mainWindow.cc:1514
+#: UI/GTK2/src/mainWindow.cc:1688
 msgid "Couldn't rename index"
 msgstr "?????????"
 
-#: UI/GTK2/src/mainWindow.cc:1527
+#: UI/GTK2/src/mainWindow.cc:1701
 msgid "Edited index"
 msgstr "??????"
 
-#: UI/GTK2/src/mainWindow.cc:1853
+#: UI/GTK2/src/mainWindow.cc:2029
 #, fuzzy
 msgid "Export Results"
 msgstr "????"
 
-#. Find this query
-#: UI/GTK2/src/mainWindow.cc:1942 UI/GTK2/src/mainWindow.cc:2615
-msgid "Live query"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:1968
-msgid "Couldn't find query"
-msgstr "???????"
-
-#: UI/GTK2/src/mainWindow.cc:2167 UI/GTK2/src/WorkerThreads.cpp:678
-#: UI/GTK2/src/WorkerThreads.cpp:1720
+#: UI/GTK2/src/mainWindow.cc:2304
 msgid "Index"
 msgstr "??"
 
-#: UI/GTK2/src/mainWindow.cc:2171 UI/GTK2/src/WorkerThreads.cpp:682
-#: UI/GTK2/src/WorkerThreads.cpp:1724
+#: UI/GTK2/src/mainWindow.cc:2308
 msgid "doesn't exist"
 msgstr "???"
 
-#: UI/GTK2/src/mainWindow.cc:2326
+#: UI/GTK2/src/mainWindow.cc:2386
 msgid "Remove this document from the index ?"
 msgstr "????????????"
 
-#: UI/GTK2/src/mainWindow.cc:2345
+#: UI/GTK2/src/mainWindow.cc:2405
 msgid "Remove these documents from the index ?"
 msgstr "????????????"
 
-#: UI/GTK2/src/mainWindow.cc:2391
+#: UI/GTK2/src/mainWindow.cc:2451
 msgid "A metasearch tool for the Free Desktop"
 msgstr "Free Desktop ??????"
 
-#: UI/GTK2/src/mainWindow.cc:2392
+#: UI/GTK2/src/mainWindow.cc:2452
 msgid "Search the Web and your documents !"
 msgstr "????????????"
 
-#: UI/GTK2/src/mainWindow.cc:2437
+#: UI/GTK2/src/mainWindow.cc:2497
 msgid "Index name"
 msgstr "????"
 
-#: UI/GTK2/src/mainWindow.cc:2452
+#: UI/GTK2/src/mainWindow.cc:2512
 msgid "Couldn't add index"
 msgstr "??????"
 
-#: UI/GTK2/src/mainWindow.cc:2468
+#: UI/GTK2/src/mainWindow.cc:2528
 msgid "Added new index"
 msgstr "??????"
 
-#: UI/GTK2/src/mainWindow.cc:2503
+#: UI/GTK2/src/mainWindow.cc:2563
 msgid "Couldn't remove index"
 msgstr "??????"
 
-#: UI/GTK2/src/mainWindow.cc:2795
+#: UI/GTK2/src/mainWindow.cc:2768
+msgid "No history for"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:2884
 msgid "At least one task hasn't completed yet. Quit now ?"
 msgstr "??????????????????"
 
-#: UI/GTK2/src/mainWindow.cc:2978
+#: UI/GTK2/src/mainWindow.cc:3068
 msgid "Query name"
 msgstr "????"
 
-#: UI/GTK2/src/mainWindow.cc:3005
+#: UI/GTK2/src/mainWindow.cc:3095
 msgid "Couldn't update query"
 msgstr "??????"
 
-#: UI/GTK2/src/mainWindow.cc:3013
+#: UI/GTK2/src/mainWindow.cc:3103
 msgid "Edited query"
 msgstr "??????"
 
-#: UI/GTK2/src/mainWindow.cc:3020
+#: UI/GTK2/src/mainWindow.cc:3110
 msgid "Couldn't add query"
 msgstr "??????"
 
-#: UI/GTK2/src/mainWindow.cc:3028
+#: UI/GTK2/src/mainWindow.cc:3118
 msgid "Added new query"
 msgstr "?????"
 
-#: UI/GTK2/src/mainWindow.cc:3066
+#: UI/GTK2/src/mainWindow.cc:3157
 msgid "Query is not set"
 msgstr "???????"
 
-#: UI/GTK2/src/mainWindow.cc:3077
+#: UI/GTK2/src/mainWindow.cc:3168
 msgid "No search engine selected"
 msgstr "????????"
 
-#: UI/GTK2/src/mainWindow.cc:3164
+#: UI/GTK2/src/mainWindow.cc:3255
 msgid "Please set the Google API key first"
 msgstr "????Google API key"
 
-#: UI/GTK2/src/mainWindow.cc:3173
+#: UI/GTK2/src/mainWindow.cc:3264
 msgid "Running query"
 msgstr "???????"
 
-#: UI/GTK2/src/mainWindow.cc:3382
+#: UI/GTK2/src/mainWindow.cc:3473
 msgid "No default application defined for type"
 msgstr "????????????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:126
+#: UI/GTK2/src/mainWindow_glade.cc:127
 msgid "Query:"
 msgstr "???"
 
-#: UI/GTK2/src/mainWindow_glade.cc:138
-msgid "Edit"
-msgstr "??"
+#: UI/GTK2/src/mainWindow_glade.cc:138 UI/GTK2/src/statisticsDialog.cc:88
+msgid "History"
+msgstr "????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:147
+#: UI/GTK2/src/mainWindow_glade.cc:143
 msgid "Stored queries"
 msgstr "?????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:164 UI/GTK2/src/statisticsDialog.cc:50
+#: UI/GTK2/src/mainWindow_glade.cc:156 UI/GTK2/src/statisticsDialog.cc:51
 #: UI/GTK2/src/statisticsDialog_glade.cc:87
 msgid "Status"
 msgstr "??"
 
-#: UI/GTK2/src/mainWindow_glade.cc:185
+#: UI/GTK2/src/mainWindow_glade.cc:177
 msgid "Search Engine"
 msgstr "????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:188
+#: UI/GTK2/src/mainWindow_glade.cc:180
 msgid "Host Name"
 msgstr "????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:191
+#: UI/GTK2/src/mainWindow_glade.cc:183
 msgid "Show Extract"
 msgstr "????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:194
+#: UI/GTK2/src/mainWindow_glade.cc:186
 msgid "Group By"
 msgstr "???"
 
-#: UI/GTK2/src/mainWindow_glade.cc:200
+#: UI/GTK2/src/mainWindow_glade.cc:192
 msgid "Clear List"
 msgstr "????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:206
+#: UI/GTK2/src/mainWindow_glade.cc:198
 msgid "Vie_w"
 msgstr "??(_w)"
 
-#: UI/GTK2/src/mainWindow_glade.cc:209
+#: UI/GTK2/src/mainWindow_glade.cc:201
 msgid "View Cache"
 msgstr "????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:212
+#: UI/GTK2/src/mainWindow_glade.cc:204
 msgid "More Like This"
 msgstr "?????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:215 UI/GTK2/src/mainWindow_glade.cc:251
+#: UI/GTK2/src/mainWindow_glade.cc:207
+#, fuzzy
+msgid "Search This For"
+msgstr "????"
+
+#: UI/GTK2/src/mainWindow_glade.cc:210 UI/GTK2/src/mainWindow_glade.cc:246
 msgid "_Index"
 msgstr "??(_I)"
 
-#: UI/GTK2/src/mainWindow_glade.cc:218
+#: UI/GTK2/src/mainWindow_glade.cc:213
 msgid "List Contents Of"
 msgstr "????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:227
+#: UI/GTK2/src/mainWindow_glade.cc:222
 msgid "View"
 msgstr "??"
 
-#: UI/GTK2/src/mainWindow_glade.cc:230
+#: UI/GTK2/src/mainWindow_glade.cc:225
 msgid "Update"
 msgstr "??"
 
-#: UI/GTK2/src/mainWindow_glade.cc:233
+#: UI/GTK2/src/mainWindow_glade.cc:228
 msgid "Unindex"
 msgstr "????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:236
-#: UI/GTK2/src/propertiesDialog_glade.cc:177
+#: UI/GTK2/src/mainWindow_glade.cc:231
+#: UI/GTK2/src/propertiesDialog_glade.cc:225
 msgid "Properties"
 msgstr "??"
 
-#: UI/GTK2/src/mainWindow_glade.cc:239
+#: UI/GTK2/src/mainWindow_glade.cc:234
 msgid "_About"
 msgstr "??(_A)"
 
-#: UI/GTK2/src/mainWindow_glade.cc:242
+#: UI/GTK2/src/mainWindow_glade.cc:237
 msgid "_Session"
 msgstr "????(_S)"
 
-#: UI/GTK2/src/mainWindow_glade.cc:245
+#: UI/GTK2/src/mainWindow_glade.cc:240
 msgid "_Edit"
 msgstr "??(_E)"
 
-#: UI/GTK2/src/mainWindow_glade.cc:248
+#: UI/GTK2/src/mainWindow_glade.cc:243
 msgid "_Results"
 msgstr "??(_R)"
 
-#: UI/GTK2/src/mainWindow_glade.cc:254
+#: UI/GTK2/src/mainWindow_glade.cc:249
 msgid "_Help"
 msgstr "??(_H)"
 
-#: UI/GTK2/src/mainWindow_glade.cc:403
+#: UI/GTK2/src/mainWindow_glade.cc:378
 msgid "Pinot"
 msgstr "Pinot"
 
 #. Localize language names
-#: UI/GTK2/src/pinot.cc:249 UI/GTK2/src/pinot-dbus-daemon.cc:324
-#: UI/GTK2/src/propertiesDialog.cc:72 UI/GTK2/src/propertiesDialog.cc:81
+#: UI/GTK2/src/pinot.cc:233 UI/GTK2/src/pinot-dbus-daemon.cc:312
+#: UI/GTK2/src/propertiesDialog.cc:97
 msgid "Unknown"
 msgstr ""
 
-#: UI/GTK2/src/pinot.cc:250 UI/GTK2/src/pinot-dbus-daemon.cc:325
+#: UI/GTK2/src/pinot.cc:234 UI/GTK2/src/pinot-dbus-daemon.cc:313
 msgid "Danish"
 msgstr "???"
 
-#: UI/GTK2/src/pinot.cc:251 UI/GTK2/src/pinot-dbus-daemon.cc:326
+#: UI/GTK2/src/pinot.cc:235 UI/GTK2/src/pinot-dbus-daemon.cc:314
 msgid "Dutch"
 msgstr "???"
 
-#: UI/GTK2/src/pinot.cc:252 UI/GTK2/src/pinot-dbus-daemon.cc:327
+#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:315
 msgid "English"
 msgstr "??"
 
-#: UI/GTK2/src/pinot.cc:253 UI/GTK2/src/pinot-dbus-daemon.cc:328
+#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:316
 msgid "Finnish"
 msgstr "???"
 
-#: UI/GTK2/src/pinot.cc:254 UI/GTK2/src/pinot-dbus-daemon.cc:329
+#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:317
 msgid "French"
 msgstr "??"
 
-#: UI/GTK2/src/pinot.cc:255 UI/GTK2/src/pinot-dbus-daemon.cc:330
+#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:318
 msgid "German"
 msgstr "??"
 
-#: UI/GTK2/src/pinot.cc:256 UI/GTK2/src/pinot-dbus-daemon.cc:331
+#: UI/GTK2/src/pinot.cc:240 UI/GTK2/src/pinot-dbus-daemon.cc:319
 msgid "Hungarian"
 msgstr "????"
 
-#: UI/GTK2/src/pinot.cc:257 UI/GTK2/src/pinot-dbus-daemon.cc:332
+#: UI/GTK2/src/pinot.cc:241 UI/GTK2/src/pinot-dbus-daemon.cc:320
 msgid "Italian"
 msgstr "????"
 
-#: UI/GTK2/src/pinot.cc:258 UI/GTK2/src/pinot-dbus-daemon.cc:333
+#: UI/GTK2/src/pinot.cc:242 UI/GTK2/src/pinot-dbus-daemon.cc:321
 msgid "Norwegian"
 msgstr "???"
 
-#: UI/GTK2/src/pinot.cc:259 UI/GTK2/src/pinot-dbus-daemon.cc:334
+#: UI/GTK2/src/pinot.cc:243 UI/GTK2/src/pinot-dbus-daemon.cc:322
 msgid "Portuguese"
 msgstr "????"
 
-#: UI/GTK2/src/pinot.cc:260 UI/GTK2/src/pinot-dbus-daemon.cc:335
+#: UI/GTK2/src/pinot.cc:244 UI/GTK2/src/pinot-dbus-daemon.cc:323
 msgid "Romanian"
 msgstr "?????"
 
-#: UI/GTK2/src/pinot.cc:261 UI/GTK2/src/pinot-dbus-daemon.cc:336
+#: UI/GTK2/src/pinot.cc:245 UI/GTK2/src/pinot-dbus-daemon.cc:324
 msgid "Russian"
 msgstr "??"
 
-#: UI/GTK2/src/pinot.cc:262 UI/GTK2/src/pinot-dbus-daemon.cc:337
+#: UI/GTK2/src/pinot.cc:246 UI/GTK2/src/pinot-dbus-daemon.cc:325
 msgid "Spanish"
 msgstr "????"
 
-#: UI/GTK2/src/pinot.cc:263 UI/GTK2/src/pinot-dbus-daemon.cc:338
+#: UI/GTK2/src/pinot.cc:247 UI/GTK2/src/pinot-dbus-daemon.cc:326
 msgid "Swedish"
 msgstr "???"
 
-#: UI/GTK2/src/pinot.cc:264 UI/GTK2/src/pinot-dbus-daemon.cc:339
+#: UI/GTK2/src/pinot.cc:248 UI/GTK2/src/pinot-dbus-daemon.cc:327
 msgid "Turkish"
 msgstr "????"
 
-#: UI/GTK2/src/pinot.cc:289
+#: UI/GTK2/src/pinot.cc:273
 msgid "Couldn't open index"
 msgstr "??????"
 
-#: UI/GTK2/src/pinot.cc:310
+#: UI/GTK2/src/pinot.cc:294
 msgid "Couldn't create history database"
 msgstr "?????????"
 
-#: UI/GTK2/src/pinot.cc:336
+#. Warn the user
+#: UI/GTK2/src/pinot.cc:330
 msgid "Updating all documents in My Web Pages is recommended"
 msgstr "???????????????"
 
@@ -541,39 +575,43 @@
 msgid "Personal"
 msgstr "????"
 
-#: UI/GTK2/src/PinotSettings.cpp:1198
+#: UI/GTK2/src/PinotSettings.cpp:358
+msgid "Me"
+msgstr ""
+
+#: UI/GTK2/src/PinotSettings.cpp:1233
 msgid "Unclassified"
 msgstr "????"
 
-#: UI/GTK2/src/prefsDialog.cc:81
+#: UI/GTK2/src/prefsDialog.cc:83
 msgid "Name"
 msgstr "??"
 
-#: UI/GTK2/src/prefsDialog.cc:89
+#: UI/GTK2/src/prefsDialog.cc:91
 msgid "Monitor"
 msgstr "???"
 
-#: UI/GTK2/src/prefsDialog.cc:90
+#: UI/GTK2/src/prefsDialog.cc:92
 msgid "Location"
 msgstr "??"
 
-#: UI/GTK2/src/prefsDialog.cc:98
+#: UI/GTK2/src/prefsDialog.cc:100
 msgid "Pattern"
 msgstr "??"
 
-#: UI/GTK2/src/prefsDialog.cc:315
+#: UI/GTK2/src/prefsDialog.cc:357
 msgid "Exclude these patterns from indexing"
 msgstr "?????????"
 
-#: UI/GTK2/src/prefsDialog.cc:316
+#: UI/GTK2/src/prefsDialog.cc:358
 msgid "Only index these patterns"
 msgstr "????????????"
 
-#: UI/GTK2/src/prefsDialog.cc:406
+#: UI/GTK2/src/prefsDialog.cc:478
 msgid "New Label"
 msgstr "????"
 
-#: UI/GTK2/src/prefsDialog.cc:447
+#: UI/GTK2/src/prefsDialog.cc:519
 msgid "Directory to index"
 msgstr "?????"
 
@@ -630,7 +668,7 @@
 msgid "Remove"
 msgstr "??"
 
-#: UI/GTK2/src/prefsDialog_glade.cc:113
+#: UI/GTK2/src/prefsDialog_glade.cc:113 UI/GTK2/src/propertiesDialog.cc:56
 msgid "Labels"
 msgstr "??"
 
@@ -651,79 +689,98 @@
 msgid "Preferences"
 msgstr "????"
 
-#: UI/GTK2/src/propertiesDialog.cc:60 UI/GTK2/src/queryDialog.cc:124
-msgid "Label"
-msgstr "??"
-
-#: UI/GTK2/src/propertiesDialog.cc:93
+#: UI/GTK2/src/propertiesDialog.cc:110
 msgid "Per document"
 msgstr "????"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:68
+#: UI/GTK2/src/propertiesDialog.cc:368
+#, fuzzy
+msgid "Export Terms"
+msgstr "????"
+
+#: UI/GTK2/src/propertiesDialog_glade.cc:65
 msgid "Language:"
 msgstr "?? :"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:69
+#: UI/GTK2/src/propertiesDialog_glade.cc:66
 msgid "MIME type:"
 msgstr "MIME ???"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:70
+#: UI/GTK2/src/propertiesDialog_glade.cc:67
 msgid "Size:"
 msgstr "???"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:73
+#: UI/GTK2/src/propertiesDialog_glade.cc:68
 msgid "Terms:"
 msgstr "??"
 
-#: UI/GTK2/src/queryDialog.cc:114
+#: UI/GTK2/src/propertiesDialog_glade.cc:78
+msgid "bytes"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog.cc:94
 msgid "Host name"
 msgstr "????"
 
-#: UI/GTK2/src/queryDialog.cc:115
+#: UI/GTK2/src/queryDialog.cc:95
 msgid "File name"
 msgstr "????"
 
-#: UI/GTK2/src/queryDialog.cc:118
+#: UI/GTK2/src/queryDialog.cc:96
 msgid "File extension"
 msgstr "???"
 
 #. This is the title column
-#: UI/GTK2/src/queryDialog.cc:119 UI/GTK2/src/ResultsTree.cpp:133
+#: UI/GTK2/src/queryDialog.cc:97 UI/GTK2/src/ResultsTree.cpp:133
 msgid "Title"
 msgstr "??"
 
 #. URL
-#: UI/GTK2/src/queryDialog.cc:120 UI/GTK2/src/ResultsTree.cpp:143
+#: UI/GTK2/src/queryDialog.cc:98 UI/GTK2/src/ResultsTree.cpp:143
 msgid "URL"
 msgstr "??"
 
-#: UI/GTK2/src/queryDialog.cc:121
+#: UI/GTK2/src/queryDialog.cc:99
 msgid "Directory"
 msgstr "??"
 
-#: UI/GTK2/src/queryDialog.cc:122
+#: UI/GTK2/src/queryDialog.cc:100
 msgid "Language code"
 msgstr "????"
 
-#: UI/GTK2/src/queryDialog.cc:123
+#: UI/GTK2/src/queryDialog.cc:101
 msgid "MIME type"
 msgstr "MIME ??"
 
+#: UI/GTK2/src/queryDialog.cc:102
+msgid "Label"
+msgstr "??"
+
 #. The last column is for the timestamp
-#: UI/GTK2/src/queryDialog.cc:127 UI/GTK2/src/ResultsTree.cpp:151
+#: UI/GTK2/src/queryDialog.cc:105 UI/GTK2/src/ResultsTree.cpp:151
 msgid "Date"
 msgstr "??"
 
-#: UI/GTK2/src/queryDialog.cc:128
+#: UI/GTK2/src/queryDialog.cc:106
 #, fuzzy
 msgid "Time"
 msgstr "??"
 
-#: UI/GTK2/src/queryDialog.cc:129
+#: UI/GTK2/src/queryDialog.cc:107
 #, fuzzy
 msgid "Size"
 msgstr "???"
 
+#. Sort order
+#: UI/GTK2/src/queryDialog.cc:111
+msgid "By relevance"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog.cc:112
+#, fuzzy
+msgid "By date"
+msgstr "??"
+
 #: UI/GTK2/src/queryDialog_glade.cc:72
 #, fuzzy
 msgid "New filter or range:"
@@ -741,7 +798,11 @@
 msgid "Number of results:"
 msgstr "????"
 
-#: UI/GTK2/src/queryDialog_glade.cc:181
+#: UI/GTK2/src/queryDialog_glade.cc:90
+msgid "Sort order:"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog_glade.cc:192
 msgid "Query parameters"
 msgstr "?????"
 
@@ -754,124 +815,130 @@
 msgid "Extract"
 msgstr ""
 
-#: UI/GTK2/src/statisticsDialog.cc:72
+#: UI/GTK2/src/statisticsDialog.cc:73
 msgid "Indexes"
 msgstr "??"
 
-#: UI/GTK2/src/statisticsDialog.cc:87
-msgid "History"
-msgstr "????"
-
-#: UI/GTK2/src/statisticsDialog.cc:92
+#: UI/GTK2/src/statisticsDialog.cc:93
 msgid "Daemon"
 msgstr "????"
 
-#: UI/GTK2/src/statisticsDialog.cc:128 UI/GTK2/src/statisticsDialog.cc:143
+#: UI/GTK2/src/statisticsDialog.cc:128 UI/GTK2/src/statisticsDialog.cc:144
 msgid "documents"
 msgstr "??"
 
-#: UI/GTK2/src/statisticsDialog.cc:132 UI/GTK2/src/statisticsDialog.cc:147
+#: UI/GTK2/src/statisticsDialog.cc:134 UI/GTK2/src/statisticsDialog.cc:150
+#: UI/GTK2/src/WorkerThreads.cpp:126
 msgid "Unknown error"
 msgstr "???????"
 
-#: UI/GTK2/src/statisticsDialog.cc:154
+#: UI/GTK2/src/statisticsDialog.cc:157
 msgid "Viewed"
 msgstr "????"
 
-#: UI/GTK2/src/statisticsDialog.cc:154
+#: UI/GTK2/src/statisticsDialog.cc:157
 msgid "results"
 msgstr "??"
 
 #. FIXME: check whether it's actually running !
-#: UI/GTK2/src/statisticsDialog.cc:171
+#: UI/GTK2/src/statisticsDialog.cc:174
 msgid "Running under PID"
 msgstr "?????????"
 
-#: UI/GTK2/src/statisticsDialog.cc:175
+#: UI/GTK2/src/statisticsDialog.cc:178
 msgid "Currently not running"
 msgstr "???????"
 
-#: UI/GTK2/src/statisticsDialog.cc:182
+#: UI/GTK2/src/statisticsDialog.cc:185
 msgid "Crawled"
 msgstr "????"
 
-#: UI/GTK2/src/statisticsDialog.cc:182
+#: UI/GTK2/src/statisticsDialog.cc:185
 msgid "files"
 msgstr "??"
 
-#: UI/GTK2/src/statisticsDialog.cc:205
+#: UI/GTK2/src/statisticsDialog.cc:206
 msgid "Errors"
 msgstr "??"
 
-#: UI/GTK2/src/WorkerThreads.cpp:307
-msgid "Can't index mail here"
-msgstr "??????"
+#: UI/GTK2/src/WorkerThreads.cpp:93
+#, fuzzy
+msgid "Index error"
+msgstr "?????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:328 UI/GTK2/src/WorkerThreads.cpp:581
-msgid "is already being indexed"
-msgstr "??????"
+#: UI/GTK2/src/WorkerThreads.cpp:95
+#, fuzzy
+msgid "Couldn't index document"
+msgstr "?????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:338
-msgid "is blacklisted"
-msgstr "?????"
+#: UI/GTK2/src/WorkerThreads.cpp:97
+msgid "Couldn't update document"
+msgstr "??????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:691 UI/GTK2/src/WorkerThreads.cpp:1051
-#: UI/GTK2/src/WorkerThreads.cpp:1135 UI/GTK2/src/WorkerThreads.cpp:1144
-#: UI/GTK2/src/WorkerThreads.cpp:1330 UI/GTK2/src/WorkerThreads.cpp:1600
-#: UI/GTK2/src/WorkerThreads.cpp:1733
-msgid "Index error on"
-msgstr "?????"
+#: UI/GTK2/src/WorkerThreads.cpp:99
+msgid "Couldn't unindex document(s)"
+msgstr "?????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:844
-msgid "No title"
-msgstr "???"
-
-#: UI/GTK2/src/WorkerThreads.cpp:946 UI/GTK2/src/WorkerThreads.cpp:1072
-msgid "Couldn't create search engine"
-msgstr "????????"
-
-#: UI/GTK2/src/WorkerThreads.cpp:970 UI/GTK2/src/WorkerThreads.cpp:1085
+#: UI/GTK2/src/WorkerThreads.cpp:101
 msgid "Couldn't run query on search engine"
 msgstr "??????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1238
-msgid "Couldn't obtain downloader for protocol"
+#: UI/GTK2/src/WorkerThreads.cpp:103
+#, fuzzy
+msgid "Couldn't get history for search engine"
+msgstr "??????????"
+
+#: UI/GTK2/src/WorkerThreads.cpp:105
+#, fuzzy
+msgid "Couldn't retrieve document"
+msgstr "??????"
+
+#: UI/GTK2/src/WorkerThreads.cpp:107
+msgid "Couldn't initialize file monitor"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:1263
-msgid "Couldn't retrieve"
-msgstr "????"
+#: UI/GTK2/src/WorkerThreads.cpp:109
+#, fuzzy
+msgid "Couldn't open directory"
+msgstr "??????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1360 UI/GTK2/src/WorkerThreads.cpp:1439
+#: UI/GTK2/src/WorkerThreads.cpp:111
+#, fuzzy
+msgid "Index doesn't exist"
+msgstr "???"
+
+#: UI/GTK2/src/WorkerThreads.cpp:113
+msgid "Couldn't create search engine"
+msgstr "????????"
+
+#: UI/GTK2/src/WorkerThreads.cpp:115
 msgid "Cannot index document type"
 msgstr "????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1364 UI/GTK2/src/WorkerThreads.cpp:1443
-msgid "at"
+#: UI/GTK2/src/WorkerThreads.cpp:117
+msgid "No downloader for this protocol"
 msgstr ""
 
-#. No, it isn't
-#: UI/GTK2/src/WorkerThreads.cpp:1475
+#: UI/GTK2/src/WorkerThreads.cpp:119
 msgid "Robots META tag forbids indexing"
 msgstr "Robots?meta???????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1529
-msgid "Couldn't index"
-msgstr "????"
+#: UI/GTK2/src/WorkerThreads.cpp:121
+msgid "No monitoring handler"
+msgstr ""
 
-#. Be pessimistic and assume something will go wrong ;-)
-#: UI/GTK2/src/WorkerThreads.cpp:1611
-msgid "Couldn't unindex document(s)"
-msgstr "?????????"
+#: UI/GTK2/src/WorkerThreads.cpp:391
+msgid "Can't index mail here"
+msgstr "??????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1745
-msgid "Couldn't update document"
-msgstr "??????"
+#: UI/GTK2/src/WorkerThreads.cpp:412 UI/GTK2/src/WorkerThreads.cpp:666
+msgid "is already being indexed"
+msgstr "??????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1981
-msgid "No monitoring handler"
-msgstr ""
+#: UI/GTK2/src/WorkerThreads.cpp:422
+msgid "is blacklisted"
+msgstr "?????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:2023
-msgid "Couldn't initialize file monitor"
-msgstr ""
+#: UI/GTK2/src/WorkerThreads.cpp:935
+msgid "No title"
+msgstr "???"



From fabricecolin at mail.berlios.de  Sat Oct 27 15:10:35 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 27 Oct 2007 15:10:35 +0200
Subject: [Pinot-svn] r1078 - trunk
Message-ID: <200710271310.l9RDAZsb006659@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-27 15:10:35 +0200 (Sat, 27 Oct 2007)
New Revision: 1078

Modified:
   trunk/NEWS
   trunk/README
Log:
Updated README with used external filter programs, and NEWS with current status.


Modified: trunk/NEWS
===================================================================
--- trunk/NEWS	2007-10-27 12:57:33 UTC (rev 1077)
+++ trunk/NEWS	2007-10-27 13:10:35 UTC (rev 1078)
@@ -2,9 +2,10 @@
 Build :
  - SMP builds, thanks to Gabriel C
 Index :
- - external programs are limited to 5 minutes of CPU time
  - unknown document types can be indexed if one of their parent types is known
- - new pinot-label tool to get, set and list labels from the command-line
+ - new pinot-label tool to get, set and list labels on indexed files from the
+  command-line
+ - limit external programs to 5 minutes of CPU time
 Search :
  - support for date (year, month, day), time (hours, minutes, seconds) and
   size (in bytes) ranges
@@ -14,7 +15,7 @@
  - better query expansion
  - the Yahoo! plugin was replaced with the Yahoo! API plugin
  - pass queries to Web engines unmodified, without attempting to filter results
-  based on filters or range used in the query
+  based on a filter or a range used in the query
 Daemon :
  - fixed Reload method
  - new D-Bus methods to manage labels
@@ -26,12 +27,14 @@
  - inline URL completion in the import dialog box, based on previous results
  - better support for user-specific MIME settings, thanks to Lee Marks
  - reload MIME settings when they are edited
- - can now get a stored query to search in the results of a previous query
- - results of stored queries can be sorted by relevance or by date
+ - results of stored queries can be sorted by relevance (default) or by date
  - new History button to show previous results for a stored query
  - documents' properties are updated in the background
  - documents' terms can be saved to a file
  - Status window shows description of errors
+ - send a Reload to the daemon only when the relevant preferences are modified
+ - updated Brazilian Portuguese translation by Leonardo Melo
+ - updated Dutch translation by JW
 
 2007/08/23 version_0_7_6
 Build :

Modified: trunk/README
===================================================================
--- trunk/README	2007-10-27 12:57:33 UTC (rev 1077)
+++ trunk/README	2007-10-27 13:10:35 UTC (rev 1078)
@@ -392,7 +392,7 @@
   with; older versions may or may not work.
 
 ---------------------------------------------------------------
-Name							Version
+Libraries and tools					Version
 ---------------------------------------------------------------
 SQLite							3.3.1
 http://www.sqlite.org/
@@ -435,25 +435,38 @@
 desktop-file-utils					0.10
 http://www.freedesktop.org/software/desktop-file-utils
 
-unzip							5.52
+TagLib							1.4
+http://ktown.kde.org/~wheeler/taglib/
+
+openssh-askpass (4)					4.3
+http://www.openssh.com/portable.html
+
+---------------------------------------------------------------
+External filter programs
+---------------------------------------------------------------
+unzip
 http://www.info-zip.org/pub/infozip/UnZip.html
 
-pdftotext						3.00
+pdftotext
 http://www.foolabs.com/xpdf/
 http://poppler.freedesktop.org/
 
-antiword						0.36.1
+antiword
 http://www.winfield.demon.nl/
 
-unrtf							0.19.3
+unrtf
 http://www.gnu.org/software/unrtf/unrtf.html
 
-TagLib							1.4
-http://ktown.kde.org/~wheeler/taglib/
+djvutxt							
+http://djvu.sourceforge.net/
 
-openssh-askpass (4)					4.3
-http://www.openssh.com/portable.html
+catdvi
+http://catdvi.sourceforge.net/
 
+catppt
+xls2csv
+http://www.wagner.pp.ru/~vitus/software/catdoc/
+
 ---------------------------------------------------------------
 Notes :
 (1) enabled with "./configure --with-http=neon|curl"



From fabricecolin at mail.berlios.de  Sun Oct 28 07:33:08 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sun, 28 Oct 2007 07:33:08 +0100
Subject: [Pinot-svn] r1079 - trunk/UI/GTK2/src
Message-ID: <200710280633.l9S6X8YP028865@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-28 07:33:05 +0100 (Sun, 28 Oct 2007)
New Revision: 1079

Modified:
   trunk/UI/GTK2/src/WorkerThreads.cpp
Log:
Added missing includes for stat().


Modified: trunk/UI/GTK2/src/WorkerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.cpp	2007-10-27 13:10:35 UTC (rev 1078)
+++ trunk/UI/GTK2/src/WorkerThreads.cpp	2007-10-28 06:33:05 UTC (rev 1079)
@@ -16,6 +16,8 @@
  *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
  */
 
+#include <sys/types.h>
+#include <sys/stat.h>
 #include <unistd.h>
 #include <stdlib.h>
 #include <stdio.h>



From fabricecolin at mail.berlios.de  Tue Oct 30 12:07:26 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 30 Oct 2007 12:07:26 +0100
Subject: [Pinot-svn] r1080 - trunk
Message-ID: <200710301107.l9UB7Qpg020036@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-30 12:07:25 +0100 (Tue, 30 Oct 2007)
New Revision: 1080

Modified:
   trunk/configure.in
Log:
New option --with-ssl=PATH for those systems on which Curl or Neon require
OpenSSL but pkg-config can't be relied on.


Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2007-10-28 06:33:05 UTC (rev 1079)
+++ trunk/configure.in	2007-10-30 11:07:25 UTC (rev 1080)
@@ -2,7 +2,7 @@
 # using glademm V2.6.0
 
 AC_PREREQ(2.50)
-AC_INIT(pinot, 0.76,[fabricecolin at users.berlios.de])
+AC_INIT(pinot, 0.78,[fabricecolin at users.berlios.de])
 AM_INIT_AUTOMAKE
 AC_CONFIG_HEADERS(config.h)
 
@@ -16,7 +16,7 @@
 AM_PROG_LIBTOOL
 
 dnl An index with a version older than this should be upgraded
-AC_DEFINE_UNQUOTED(PINOT_INDEX_MIN_VERSION,"0.76",
+AC_DEFINE_UNQUOTED(PINOT_INDEX_MIN_VERSION,"0.78",
     [Minimum index version])
 
 dnl gettext support
@@ -115,17 +115,18 @@
 dnl Neon or Curl ?
 AC_MSG_CHECKING(which HTTP library to use)
 AC_ARG_WITH(http,
-   [AS_HELP_STRING([--with-http@<:@=neon|curl@:>@], [which HTTP library to use [default=curl]])])
+   [AS_HELP_STRING([--with-http=@<:@neon|curl@:>@], [which HTTP library to use [default=curl]])])
 httplibrary=$with_http
 if test "x$httplibrary" = "x"; then
    httplibrary="curl"
 fi
 AC_MSG_RESULT($httplibrary)
 
+testforssl="no"
 case "$httplibrary" in
 neon)
 PKG_CHECK_MODULES(NEON, neon >= 0.24 )
-PKG_CHECK_MODULES(SSL, openssl >= 0.9.7 )
+testforssl="yes"
 EXTRA_HTTP_CFLAGS="-DUSE_NEON -DUSE_SSL"
 HTTP_DOWNLOADER="NeonDownloader"
 ;;
@@ -145,13 +146,37 @@
 else
    EXTRA_HTTP_CFLAGS="-DUSE_CURL -DUSE_SSL"
    AC_MSG_RESULT(yes)
-   PKG_CHECK_MODULES(SSL, openssl >= 0.9.7 )
+   testforssl="yes"
 fi
 HTTP_DOWNLOADER="CurlDownloader"
 ;;
 esac
 AC_SUBST(HTTP_DOWNLOADER)
 
+dnl OpenSSL
+dnl If no path is provided, fall back on pkg-config
+if test "$testforssl" = "yes" ; then
+   AC_ARG_WITH(ssl,
+   [AS_HELP_STRING([--with-ssl=PATH], [where to look for OpenSSL [default=/usr/local/ssl]])])
+   sslpath=$with_ssl
+   dnl We want a prefix, not yes or no
+   case "$sslpath" in
+   yes)
+   sslpath="/usr/local/ssl"
+   ;;
+   no)
+   sslpath="/usr/local/ssl"
+   ;;
+   esac
+
+   if test "x$sslpath" = "x"; then
+      PKG_CHECK_MODULES(SSL, openssl >= 0.9.7 )
+   else
+      SSL_CFLAGS="-I$sslpath/include -I$sslpath/include/openssl"
+      SSL_LIBS="-L$sslpath/lib -lssl -lcrypto"
+   fi
+fi
+
 dnl Xapian
 AC_PATH_PROG(XAPIAN_CONFIG, xapian-config, no)
 if test "$XAPIAN_CONFIG" = "no" ; then



From fabricecolin at mail.berlios.de  Tue Oct 30 12:25:21 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 30 Oct 2007 12:25:21 +0100
Subject: [Pinot-svn] r1081 - trunk
Message-ID: <200710301125.l9UBPLdS021705@sheep.berlios.de>

Author: fabricecolin
Date: 2007-10-30 12:25:20 +0100 (Tue, 30 Oct 2007)
New Revision: 1081

Modified:
   trunk/pinot.spec.in
Log:
Merged audio-docs, deskbar and omega sub-packages into main one.


Modified: trunk/pinot.spec.in
===================================================================
--- trunk/pinot.spec.in	2007-10-30 11:07:25 UTC (rev 1080)
+++ trunk/pinot.spec.in	2007-10-30 11:25:20 UTC (rev 1081)
@@ -26,7 +26,8 @@
 BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root-%(%{__id_u} -n)
 Requires: xapian-core-libs >= 1.0.3, libtextcat >= 2.2, sqlite >= 3.3.1, curl >= 7.13, gmime >= 2.1
 Requires: gtkmm24 >= 2.6, libxml++ >= 2.12, %{dbus_pkg} >= 0.60, shared-mime-info
-Requires: unzip, antiword, unrtf, %{pftotext_pkg}
+Requires: deskbar-applet, taglib >= 1.4, unzip, antiword, unrtf, %{pftotext_pkg}
+#Suggests: xapian-omega
 BuildRequires: xapian-core-devel >= 1.0.3, libtextcat-devel >= 2.2, sqlite-devel >= 3.3.1, curl-devel >= 7.13, gmime-devel >= 2.1, boost-devel >= 1.32
 BuildRequires: gtkmm24-devel >= 2.6, libxml++-devel >= 2.12, %{dbus_dev_pkg} >= 0.60, gettext-devel, desktop-file-utils
 BuildRequires: taglib-devel >= 1.4
@@ -34,40 +35,18 @@
 %if 0%{?_with_soap:1}
 BuildRequires: gsoap >= 2.7.9e
 %endif
+# These used to be independant packages
+Obsoletes: pinot-audio-docs
+Obsoletes: pinot-deskbar
+Obsoletes: pinot-omega
 
 %description
 Pinot is a D-Bus service that crawls, indexes your documents and monitors them
 for changes, as well as a GTK-based user interface that enables to query
 the index built by the service and your favourite Web engines, and display and
-analyze the results
+analyze the results.
+A plugin for DeskbarApplet is included.
 
-%package audio-docs 
-Summary: Help Pinot handle various audio document formats
-Group: Applications/Internet
-Requires: %{name} = %{version}
-Requires: taglib >= 1.4
-
-%description audio-docs 
-The included filter adds support for OGG, MP3 and FLAC files
-
-%package omega 
-Summary: Xapian Omega plugin for Pinot
-Group: Applications/Internet
-Requires: %{name} = %{version}
-Requires: xapian-omega
-
-%description omega
-The included plugin enables Pinot to use Xapian Omega as a search engine
-
-%package deskbar
-Summary: Pinot plugin for DeskbarApplet
-Group: Applications/Internet
-Requires: %{name} = %{version}
-Requires: deskbar-applet
-
-%description deskbar
-The included plugin enables Deskbar to search documents indexed by Pinot
-
 %prep
 %setup -q
 
@@ -106,6 +85,8 @@
 %{_bindir}/pinot-search
 %{_libdir}/pinot/filters/libexternalfilter.so*
 %{_libdir}/pinot/filters/libmboxfilter.so*
+%{_libdir}/pinot/filters/libtaglibfilter.so*
+%{_libdir}/deskbar-applet/handlers/pinot-live.py*
 %{_datadir}/dbus-1/services/de.berlios.Pinot.service
 %{_datadir}/pinot/
 %{_datadir}/icons/hicolor/48x48/apps/pinot.png
@@ -117,17 +98,5 @@
 %{_datadir}/applications/*.desktop
 %{_mandir}/man1/pinot*
 
-%files audio-docs 
-%defattr(-, root, root, -)
-%{_libdir}/pinot/filters/libtaglibfilter.so*
-
-%files omega
-%defattr(-, root, root, -)
-%{_datadir}/pinot/engines/OmegaDescription.xml
-
-%files deskbar
-%defattr(-, root, root, -)
-%{_libdir}/deskbar-applet/handlers/pinot-live.py*
-
 %changelog
 



