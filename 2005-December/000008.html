<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Pinot-svn] r9 - in trunk/UI/GTK2: . src
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/pinot-svn/2005-December/index.html" >
   <LINK REL="made" HREF="mailto:pinot-svn%40lists.berlios.de?Subject=Re%3A%20%5BPinot-svn%5D%20r9%20-%20in%20trunk/UI/GTK2%3A%20.%20src&In-Reply-To=%3C200512151446.jBFEkqI1032719%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000007.html">
   <LINK REL="Next"  HREF="000009.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Pinot-svn] r9 - in trunk/UI/GTK2: . src</H1>
    <B>fabricecolin at BerliOS</B> 
    <A HREF="mailto:pinot-svn%40lists.berlios.de?Subject=Re%3A%20%5BPinot-svn%5D%20r9%20-%20in%20trunk/UI/GTK2%3A%20.%20src&In-Reply-To=%3C200512151446.jBFEkqI1032719%40sheep.berlios.de%3E"
       TITLE="[Pinot-svn] r9 - in trunk/UI/GTK2: . src">fabricecolin at berlios.de
       </A><BR>
    <I>Thu Dec 15 15:46:52 CET 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000007.html">[Pinot-svn] r8 - in trunk: Index SQL Search Search/Google Search/ObjectsSearch
</A></li>
        <LI>Next message: <A HREF="000009.html">[Pinot-svn] r10 - trunk/SQL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8">[ date ]</a>
              <a href="thread.html#8">[ thread ]</a>
              <a href="subject.html#8">[ subject ]</a>
              <a href="author.html#8">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: fabricecolin
Date: 2005-12-15 15:46:50 +0100 (Thu, 15 Dec 2005)
New Revision: 9

Modified:
   trunk/UI/GTK2/metase-gtk2.glade
   trunk/UI/GTK2/src/MonitorHandler.cpp
   trunk/UI/GTK2/src/MonitorHandler.h
   trunk/UI/GTK2/src/PinotSettings.cpp
   trunk/UI/GTK2/src/ResultsTree.cpp
   trunk/UI/GTK2/src/WorkerThreads.cpp
   trunk/UI/GTK2/src/WorkerThreads.h
   trunk/UI/GTK2/src/mainWindow.cc
   trunk/UI/GTK2/src/pinot.cpp
   trunk/UI/GTK2/src/prefsDialog.cc
   trunk/UI/GTK2/src/prefsDialog.hh
   trunk/UI/GTK2/src/queryDialog.cc
   trunk/UI/GTK2/src/queryDialog.hh
   trunk/UI/GTK2/src/queryDialog_glade.cc
   trunk/UI/GTK2/src/queryDialog_glade.hh
Log:
&quot;None of the words&quot; is in the queries first properties tab, as it should work
with all engines. Added a label filter in Advanced. All labels operations are
handled by the index now, LabelManager is obsolete.


Modified: trunk/UI/GTK2/metase-gtk2.glade
===================================================================
--- trunk/UI/GTK2/metase-gtk2.glade	2005-12-15 14:44:29 UTC (rev 8)
+++ trunk/UI/GTK2/metase-gtk2.glade	2005-12-15 14:46:50 UTC (rev 9)
@@ -2423,7 +2423,7 @@
 		  &lt;child&gt;
 		    &lt;widget class=&quot;GtkTable&quot; id=&quot;tersmTable&quot;&gt;
 		      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-		      &lt;property name=&quot;n_rows&quot;&gt;5&lt;/property&gt;
+		      &lt;property name=&quot;n_rows&quot;&gt;6&lt;/property&gt;
 		      &lt;property name=&quot;n_columns&quot;&gt;2&lt;/property&gt;
 		      &lt;property name=&quot;homogeneous&quot;&gt;False&lt;/property&gt;
 		      &lt;property name=&quot;row_spacing&quot;&gt;0&lt;/property&gt;
@@ -2469,8 +2469,8 @@
 			&lt;packing&gt;
 			  &lt;property name=&quot;left_attach&quot;&gt;1&lt;/property&gt;
 			  &lt;property name=&quot;right_attach&quot;&gt;2&lt;/property&gt;
-			  &lt;property name=&quot;top_attach&quot;&gt;1&lt;/property&gt;
-			  &lt;property name=&quot;bottom_attach&quot;&gt;2&lt;/property&gt;
+			  &lt;property name=&quot;top_attach&quot;&gt;2&lt;/property&gt;
+			  &lt;property name=&quot;bottom_attach&quot;&gt;3&lt;/property&gt;
 			  &lt;property name=&quot;x_padding&quot;&gt;4&lt;/property&gt;
 			  &lt;property name=&quot;y_padding&quot;&gt;4&lt;/property&gt;
 			  &lt;property name=&quot;y_options&quot;&gt;fill&lt;/property&gt;
@@ -2493,8 +2493,8 @@
 			&lt;packing&gt;
 			  &lt;property name=&quot;left_attach&quot;&gt;1&lt;/property&gt;
 			  &lt;property name=&quot;right_attach&quot;&gt;2&lt;/property&gt;
-			  &lt;property name=&quot;top_attach&quot;&gt;2&lt;/property&gt;
-			  &lt;property name=&quot;bottom_attach&quot;&gt;3&lt;/property&gt;
+			  &lt;property name=&quot;top_attach&quot;&gt;3&lt;/property&gt;
+			  &lt;property name=&quot;bottom_attach&quot;&gt;4&lt;/property&gt;
 			  &lt;property name=&quot;x_padding&quot;&gt;4&lt;/property&gt;
 			  &lt;property name=&quot;y_padding&quot;&gt;4&lt;/property&gt;
 			  &lt;property name=&quot;y_options&quot;&gt;fill&lt;/property&gt;
@@ -2517,8 +2517,8 @@
 			&lt;packing&gt;
 			  &lt;property name=&quot;left_attach&quot;&gt;1&lt;/property&gt;
 			  &lt;property name=&quot;right_attach&quot;&gt;2&lt;/property&gt;
-			  &lt;property name=&quot;top_attach&quot;&gt;3&lt;/property&gt;
-			  &lt;property name=&quot;bottom_attach&quot;&gt;4&lt;/property&gt;
+			  &lt;property name=&quot;top_attach&quot;&gt;4&lt;/property&gt;
+			  &lt;property name=&quot;bottom_attach&quot;&gt;5&lt;/property&gt;
 			  &lt;property name=&quot;x_padding&quot;&gt;4&lt;/property&gt;
 			  &lt;property name=&quot;y_padding&quot;&gt;4&lt;/property&gt;
 			  &lt;property name=&quot;y_options&quot;&gt;fill&lt;/property&gt;
@@ -2541,8 +2541,8 @@
 			&lt;packing&gt;
 			  &lt;property name=&quot;left_attach&quot;&gt;0&lt;/property&gt;
 			  &lt;property name=&quot;right_attach&quot;&gt;1&lt;/property&gt;
-			  &lt;property name=&quot;top_attach&quot;&gt;4&lt;/property&gt;
-			  &lt;property name=&quot;bottom_attach&quot;&gt;5&lt;/property&gt;
+			  &lt;property name=&quot;top_attach&quot;&gt;5&lt;/property&gt;
+			  &lt;property name=&quot;bottom_attach&quot;&gt;6&lt;/property&gt;
 			  &lt;property name=&quot;x_padding&quot;&gt;4&lt;/property&gt;
 			  &lt;property name=&quot;y_padding&quot;&gt;4&lt;/property&gt;
 			  &lt;property name=&quot;x_options&quot;&gt;fill&lt;/property&gt;
@@ -2579,9 +2579,9 @@
 		      &lt;/child&gt;
 
 		      &lt;child&gt;
-			&lt;widget class=&quot;GtkLabel&quot; id=&quot;hostLabel&quot;&gt;
+			&lt;widget class=&quot;GtkLabel&quot; id=&quot;fileNameLabel&quot;&gt;
 			  &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-			  &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;Host name:&lt;/property&gt;
+			  &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;File name:&lt;/property&gt;
 			  &lt;property name=&quot;use_underline&quot;&gt;False&lt;/property&gt;
 			  &lt;property name=&quot;use_markup&quot;&gt;False&lt;/property&gt;
 			  &lt;property name=&quot;justify&quot;&gt;GTK_JUSTIFY_LEFT&lt;/property&gt;
@@ -2599,17 +2599,17 @@
 			&lt;packing&gt;
 			  &lt;property name=&quot;left_attach&quot;&gt;0&lt;/property&gt;
 			  &lt;property name=&quot;right_attach&quot;&gt;1&lt;/property&gt;
-			  &lt;property name=&quot;top_attach&quot;&gt;1&lt;/property&gt;
-			  &lt;property name=&quot;bottom_attach&quot;&gt;2&lt;/property&gt;
+			  &lt;property name=&quot;top_attach&quot;&gt;3&lt;/property&gt;
+			  &lt;property name=&quot;bottom_attach&quot;&gt;4&lt;/property&gt;
 			  &lt;property name=&quot;x_options&quot;&gt;fill&lt;/property&gt;
 			  &lt;property name=&quot;y_options&quot;&gt;fill&lt;/property&gt;
 			&lt;/packing&gt;
 		      &lt;/child&gt;
 
 		      &lt;child&gt;
-			&lt;widget class=&quot;GtkLabel&quot; id=&quot;fileNameLabel&quot;&gt;
+			&lt;widget class=&quot;GtkLabel&quot; id=&quot;resultsCountLabel&quot;&gt;
 			  &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-			  &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;File name:&lt;/property&gt;
+			  &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;Number of results:&lt;/property&gt;
 			  &lt;property name=&quot;use_underline&quot;&gt;False&lt;/property&gt;
 			  &lt;property name=&quot;use_markup&quot;&gt;False&lt;/property&gt;
 			  &lt;property name=&quot;justify&quot;&gt;GTK_JUSTIFY_LEFT&lt;/property&gt;
@@ -2627,6 +2627,52 @@
 			&lt;packing&gt;
 			  &lt;property name=&quot;left_attach&quot;&gt;0&lt;/property&gt;
 			  &lt;property name=&quot;right_attach&quot;&gt;1&lt;/property&gt;
+			  &lt;property name=&quot;top_attach&quot;&gt;4&lt;/property&gt;
+			  &lt;property name=&quot;bottom_attach&quot;&gt;5&lt;/property&gt;
+			  &lt;property name=&quot;x_options&quot;&gt;fill&lt;/property&gt;
+			  &lt;property name=&quot;y_options&quot;&gt;fill&lt;/property&gt;
+			&lt;/packing&gt;
+		      &lt;/child&gt;
+
+		      &lt;child&gt;
+			&lt;widget class=&quot;GtkComboBox&quot; id=&quot;labelNameCombobox&quot;&gt;
+			  &lt;property agent=&quot;glademm&quot; name=&quot;cxx_visibility&quot;&gt;protected&lt;/property&gt;
+			  &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
+			  &lt;property name=&quot;add_tearoffs&quot;&gt;False&lt;/property&gt;
+			  &lt;property name=&quot;focus_on_click&quot;&gt;True&lt;/property&gt;
+			&lt;/widget&gt;
+			&lt;packing&gt;
+			  &lt;property name=&quot;left_attach&quot;&gt;1&lt;/property&gt;
+			  &lt;property name=&quot;right_attach&quot;&gt;2&lt;/property&gt;
+			  &lt;property name=&quot;top_attach&quot;&gt;5&lt;/property&gt;
+			  &lt;property name=&quot;bottom_attach&quot;&gt;6&lt;/property&gt;
+			  &lt;property name=&quot;x_padding&quot;&gt;4&lt;/property&gt;
+			  &lt;property name=&quot;y_padding&quot;&gt;4&lt;/property&gt;
+			  &lt;property name=&quot;y_options&quot;&gt;fill&lt;/property&gt;
+			&lt;/packing&gt;
+		      &lt;/child&gt;
+
+		      &lt;child&gt;
+			&lt;widget class=&quot;GtkLabel&quot; id=&quot;hostLabel&quot;&gt;
+			  &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
+			  &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;Host name:&lt;/property&gt;
+			  &lt;property name=&quot;use_underline&quot;&gt;False&lt;/property&gt;
+			  &lt;property name=&quot;use_markup&quot;&gt;False&lt;/property&gt;
+			  &lt;property name=&quot;justify&quot;&gt;GTK_JUSTIFY_LEFT&lt;/property&gt;
+			  &lt;property name=&quot;wrap&quot;&gt;False&lt;/property&gt;
+			  &lt;property name=&quot;selectable&quot;&gt;False&lt;/property&gt;
+			  &lt;property name=&quot;xalign&quot;&gt;0&lt;/property&gt;
+			  &lt;property name=&quot;yalign&quot;&gt;0.5&lt;/property&gt;
+			  &lt;property name=&quot;xpad&quot;&gt;4&lt;/property&gt;
+			  &lt;property name=&quot;ypad&quot;&gt;4&lt;/property&gt;
+			  &lt;property name=&quot;ellipsize&quot;&gt;PANGO_ELLIPSIZE_NONE&lt;/property&gt;
+			  &lt;property name=&quot;width_chars&quot;&gt;-1&lt;/property&gt;
+			  &lt;property name=&quot;single_line_mode&quot;&gt;False&lt;/property&gt;
+			  &lt;property name=&quot;angle&quot;&gt;0&lt;/property&gt;
+			&lt;/widget&gt;
+			&lt;packing&gt;
+			  &lt;property name=&quot;left_attach&quot;&gt;0&lt;/property&gt;
+			  &lt;property name=&quot;right_attach&quot;&gt;1&lt;/property&gt;
 			  &lt;property name=&quot;top_attach&quot;&gt;2&lt;/property&gt;
 			  &lt;property name=&quot;bottom_attach&quot;&gt;3&lt;/property&gt;
 			  &lt;property name=&quot;x_options&quot;&gt;fill&lt;/property&gt;
@@ -2635,9 +2681,9 @@
 		      &lt;/child&gt;
 
 		      &lt;child&gt;
-			&lt;widget class=&quot;GtkLabel&quot; id=&quot;resultsCountLabel&quot;&gt;
+			&lt;widget class=&quot;GtkLabel&quot; id=&quot;notLabel&quot;&gt;
 			  &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-			  &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;Number of results:&lt;/property&gt;
+			  &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;None of the words:&lt;/property&gt;
 			  &lt;property name=&quot;use_underline&quot;&gt;False&lt;/property&gt;
 			  &lt;property name=&quot;use_markup&quot;&gt;False&lt;/property&gt;
 			  &lt;property name=&quot;justify&quot;&gt;GTK_JUSTIFY_LEFT&lt;/property&gt;
@@ -2655,25 +2701,31 @@
 			&lt;packing&gt;
 			  &lt;property name=&quot;left_attach&quot;&gt;0&lt;/property&gt;
 			  &lt;property name=&quot;right_attach&quot;&gt;1&lt;/property&gt;
-			  &lt;property name=&quot;top_attach&quot;&gt;3&lt;/property&gt;
-			  &lt;property name=&quot;bottom_attach&quot;&gt;4&lt;/property&gt;
+			  &lt;property name=&quot;top_attach&quot;&gt;1&lt;/property&gt;
+			  &lt;property name=&quot;bottom_attach&quot;&gt;2&lt;/property&gt;
 			  &lt;property name=&quot;x_options&quot;&gt;fill&lt;/property&gt;
 			  &lt;property name=&quot;y_options&quot;&gt;fill&lt;/property&gt;
 			&lt;/packing&gt;
 		      &lt;/child&gt;
 
 		      &lt;child&gt;
-			&lt;widget class=&quot;GtkComboBox&quot; id=&quot;labelCombobox&quot;&gt;
+			&lt;widget class=&quot;GtkEntry&quot; id=&quot;notEntry&quot;&gt;
 			  &lt;property agent=&quot;glademm&quot; name=&quot;cxx_visibility&quot;&gt;protected&lt;/property&gt;
 			  &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-			  &lt;property name=&quot;add_tearoffs&quot;&gt;False&lt;/property&gt;
-			  &lt;property name=&quot;focus_on_click&quot;&gt;True&lt;/property&gt;
+			  &lt;property name=&quot;can_focus&quot;&gt;True&lt;/property&gt;
+			  &lt;property name=&quot;editable&quot;&gt;True&lt;/property&gt;
+			  &lt;property name=&quot;visibility&quot;&gt;True&lt;/property&gt;
+			  &lt;property name=&quot;max_length&quot;&gt;0&lt;/property&gt;
+			  &lt;property name=&quot;text&quot; translatable=&quot;yes&quot;&gt;&lt;/property&gt;
+			  &lt;property name=&quot;has_frame&quot;&gt;True&lt;/property&gt;
+			  &lt;property name=&quot;invisible_char&quot;&gt;*&lt;/property&gt;
+			  &lt;property name=&quot;activates_default&quot;&gt;False&lt;/property&gt;
 			&lt;/widget&gt;
 			&lt;packing&gt;
 			  &lt;property name=&quot;left_attach&quot;&gt;1&lt;/property&gt;
 			  &lt;property name=&quot;right_attach&quot;&gt;2&lt;/property&gt;
-			  &lt;property name=&quot;top_attach&quot;&gt;4&lt;/property&gt;
-			  &lt;property name=&quot;bottom_attach&quot;&gt;5&lt;/property&gt;
+			  &lt;property name=&quot;top_attach&quot;&gt;1&lt;/property&gt;
+			  &lt;property name=&quot;bottom_attach&quot;&gt;2&lt;/property&gt;
 			  &lt;property name=&quot;x_padding&quot;&gt;4&lt;/property&gt;
 			  &lt;property name=&quot;y_padding&quot;&gt;4&lt;/property&gt;
 			  &lt;property name=&quot;y_options&quot;&gt;fill&lt;/property&gt;
@@ -2781,30 +2833,6 @@
 		      &lt;/child&gt;
 
 		      &lt;child&gt;
-			&lt;widget class=&quot;GtkEntry&quot; id=&quot;notEntry&quot;&gt;
-			  &lt;property agent=&quot;glademm&quot; name=&quot;cxx_visibility&quot;&gt;protected&lt;/property&gt;
-			  &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-			  &lt;property name=&quot;can_focus&quot;&gt;True&lt;/property&gt;
-			  &lt;property name=&quot;editable&quot;&gt;True&lt;/property&gt;
-			  &lt;property name=&quot;visibility&quot;&gt;True&lt;/property&gt;
-			  &lt;property name=&quot;max_length&quot;&gt;0&lt;/property&gt;
-			  &lt;property name=&quot;text&quot; translatable=&quot;yes&quot;&gt;&lt;/property&gt;
-			  &lt;property name=&quot;has_frame&quot;&gt;True&lt;/property&gt;
-			  &lt;property name=&quot;invisible_char&quot;&gt;*&lt;/property&gt;
-			  &lt;property name=&quot;activates_default&quot;&gt;False&lt;/property&gt;
-			&lt;/widget&gt;
-			&lt;packing&gt;
-			  &lt;property name=&quot;left_attach&quot;&gt;1&lt;/property&gt;
-			  &lt;property name=&quot;right_attach&quot;&gt;2&lt;/property&gt;
-			  &lt;property name=&quot;top_attach&quot;&gt;2&lt;/property&gt;
-			  &lt;property name=&quot;bottom_attach&quot;&gt;3&lt;/property&gt;
-			  &lt;property name=&quot;x_padding&quot;&gt;4&lt;/property&gt;
-			  &lt;property name=&quot;y_padding&quot;&gt;4&lt;/property&gt;
-			  &lt;property name=&quot;y_options&quot;&gt;fill&lt;/property&gt;
-			&lt;/packing&gt;
-		      &lt;/child&gt;
-
-		      &lt;child&gt;
 			&lt;widget class=&quot;GtkLabel&quot; id=&quot;phraseLabel&quot;&gt;
 			  &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
 			  &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;the exact phrase:&lt;/property&gt;
@@ -2833,9 +2861,9 @@
 		      &lt;/child&gt;
 
 		      &lt;child&gt;
-			&lt;widget class=&quot;GtkLabel&quot; id=&quot;notLabel&quot;&gt;
+			&lt;widget class=&quot;GtkLabel&quot; id=&quot;languageLabel&quot;&gt;
 			  &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-			  &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;none of the words:&lt;/property&gt;
+			  &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;the language:&lt;/property&gt;
 			  &lt;property name=&quot;use_underline&quot;&gt;False&lt;/property&gt;
 			  &lt;property name=&quot;use_markup&quot;&gt;False&lt;/property&gt;
 			  &lt;property name=&quot;justify&quot;&gt;GTK_JUSTIFY_LEFT&lt;/property&gt;
@@ -2861,34 +2889,6 @@
 		      &lt;/child&gt;
 
 		      &lt;child&gt;
-			&lt;widget class=&quot;GtkLabel&quot; id=&quot;label14&quot;&gt;
-			  &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-			  &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;the language:&lt;/property&gt;
-			  &lt;property name=&quot;use_underline&quot;&gt;False&lt;/property&gt;
-			  &lt;property name=&quot;use_markup&quot;&gt;False&lt;/property&gt;
-			  &lt;property name=&quot;justify&quot;&gt;GTK_JUSTIFY_LEFT&lt;/property&gt;
-			  &lt;property name=&quot;wrap&quot;&gt;False&lt;/property&gt;
-			  &lt;property name=&quot;selectable&quot;&gt;False&lt;/property&gt;
-			  &lt;property name=&quot;xalign&quot;&gt;0&lt;/property&gt;
-			  &lt;property name=&quot;yalign&quot;&gt;0.5&lt;/property&gt;
-			  &lt;property name=&quot;xpad&quot;&gt;4&lt;/property&gt;
-			  &lt;property name=&quot;ypad&quot;&gt;4&lt;/property&gt;
-			  &lt;property name=&quot;ellipsize&quot;&gt;PANGO_ELLIPSIZE_NONE&lt;/property&gt;
-			  &lt;property name=&quot;width_chars&quot;&gt;-1&lt;/property&gt;
-			  &lt;property name=&quot;single_line_mode&quot;&gt;False&lt;/property&gt;
-			  &lt;property name=&quot;angle&quot;&gt;0&lt;/property&gt;
-			&lt;/widget&gt;
-			&lt;packing&gt;
-			  &lt;property name=&quot;left_attach&quot;&gt;0&lt;/property&gt;
-			  &lt;property name=&quot;right_attach&quot;&gt;1&lt;/property&gt;
-			  &lt;property name=&quot;top_attach&quot;&gt;3&lt;/property&gt;
-			  &lt;property name=&quot;bottom_attach&quot;&gt;4&lt;/property&gt;
-			  &lt;property name=&quot;x_options&quot;&gt;fill&lt;/property&gt;
-			  &lt;property name=&quot;y_options&quot;&gt;fill&lt;/property&gt;
-			&lt;/packing&gt;
-		      &lt;/child&gt;
-
-		      &lt;child&gt;
 			&lt;widget class=&quot;GtkComboBox&quot; id=&quot;languageCombobox&quot;&gt;
 			  &lt;property agent=&quot;glademm&quot; name=&quot;cxx_visibility&quot;&gt;protected&lt;/property&gt;
 			  &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
@@ -2898,8 +2898,8 @@
 			&lt;packing&gt;
 			  &lt;property name=&quot;left_attach&quot;&gt;1&lt;/property&gt;
 			  &lt;property name=&quot;right_attach&quot;&gt;2&lt;/property&gt;
-			  &lt;property name=&quot;top_attach&quot;&gt;3&lt;/property&gt;
-			  &lt;property name=&quot;bottom_attach&quot;&gt;4&lt;/property&gt;
+			  &lt;property name=&quot;top_attach&quot;&gt;2&lt;/property&gt;
+			  &lt;property name=&quot;bottom_attach&quot;&gt;3&lt;/property&gt;
 			  &lt;property name=&quot;x_padding&quot;&gt;4&lt;/property&gt;
 			  &lt;property name=&quot;y_padding&quot;&gt;4&lt;/property&gt;
 			  &lt;property name=&quot;y_options&quot;&gt;fill&lt;/property&gt;
@@ -2957,6 +2957,52 @@
 			  &lt;property name=&quot;y_options&quot;&gt;fill&lt;/property&gt;
 			&lt;/packing&gt;
 		      &lt;/child&gt;
+
+		      &lt;child&gt;
+			&lt;widget class=&quot;GtkLabel&quot; id=&quot;labelLabel&quot;&gt;
+			  &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
+			  &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;the label:&lt;/property&gt;
+			  &lt;property name=&quot;use_underline&quot;&gt;False&lt;/property&gt;
+			  &lt;property name=&quot;use_markup&quot;&gt;False&lt;/property&gt;
+			  &lt;property name=&quot;justify&quot;&gt;GTK_JUSTIFY_LEFT&lt;/property&gt;
+			  &lt;property name=&quot;wrap&quot;&gt;False&lt;/property&gt;
+			  &lt;property name=&quot;selectable&quot;&gt;False&lt;/property&gt;
+			  &lt;property name=&quot;xalign&quot;&gt;0&lt;/property&gt;
+			  &lt;property name=&quot;yalign&quot;&gt;0.5&lt;/property&gt;
+			  &lt;property name=&quot;xpad&quot;&gt;4&lt;/property&gt;
+			  &lt;property name=&quot;ypad&quot;&gt;4&lt;/property&gt;
+			  &lt;property name=&quot;ellipsize&quot;&gt;PANGO_ELLIPSIZE_NONE&lt;/property&gt;
+			  &lt;property name=&quot;width_chars&quot;&gt;-1&lt;/property&gt;
+			  &lt;property name=&quot;single_line_mode&quot;&gt;False&lt;/property&gt;
+			  &lt;property name=&quot;angle&quot;&gt;0&lt;/property&gt;
+			&lt;/widget&gt;
+			&lt;packing&gt;
+			  &lt;property name=&quot;left_attach&quot;&gt;0&lt;/property&gt;
+			  &lt;property name=&quot;right_attach&quot;&gt;1&lt;/property&gt;
+			  &lt;property name=&quot;top_attach&quot;&gt;3&lt;/property&gt;
+			  &lt;property name=&quot;bottom_attach&quot;&gt;4&lt;/property&gt;
+			  &lt;property name=&quot;x_options&quot;&gt;fill&lt;/property&gt;
+			  &lt;property name=&quot;y_options&quot;&gt;fill&lt;/property&gt;
+			&lt;/packing&gt;
+		      &lt;/child&gt;
+
+		      &lt;child&gt;
+			&lt;widget class=&quot;GtkComboBox&quot; id=&quot;labelFilterCombobox&quot;&gt;
+			  &lt;property agent=&quot;glademm&quot; name=&quot;cxx_visibility&quot;&gt;protected&lt;/property&gt;
+			  &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
+			  &lt;property name=&quot;add_tearoffs&quot;&gt;False&lt;/property&gt;
+			  &lt;property name=&quot;focus_on_click&quot;&gt;True&lt;/property&gt;
+			&lt;/widget&gt;
+			&lt;packing&gt;
+			  &lt;property name=&quot;left_attach&quot;&gt;1&lt;/property&gt;
+			  &lt;property name=&quot;right_attach&quot;&gt;2&lt;/property&gt;
+			  &lt;property name=&quot;top_attach&quot;&gt;3&lt;/property&gt;
+			  &lt;property name=&quot;bottom_attach&quot;&gt;4&lt;/property&gt;
+			  &lt;property name=&quot;x_padding&quot;&gt;4&lt;/property&gt;
+			  &lt;property name=&quot;y_padding&quot;&gt;4&lt;/property&gt;
+			  &lt;property name=&quot;y_options&quot;&gt;fill&lt;/property&gt;
+			&lt;/packing&gt;
+		      &lt;/child&gt;
 		    &lt;/widget&gt;
 		    &lt;packing&gt;
 		      &lt;property name=&quot;padding&quot;&gt;0&lt;/property&gt;

Modified: trunk/UI/GTK2/src/MonitorHandler.cpp
===================================================================
--- trunk/UI/GTK2/src/MonitorHandler.cpp	2005-12-15 14:44:29 UTC (rev 8)
+++ trunk/UI/GTK2/src/MonitorHandler.cpp	2005-12-15 14:46:50 UTC (rev 9)
@@ -112,7 +112,7 @@
 }
 
 bool MboxHandler::parseMailAccount(MboxParser &amp;boxParser, IndexInterface *pIndex,
-	LabelManager &amp;labelMan, time_t &amp;lastMessageTime,
+	time_t &amp;lastMessageTime,
 	const string &amp;tempSourceLabel, const string &amp;sourceLabel)
 {
 	bool indexedFile = false;
@@ -133,7 +133,7 @@
 	while (pMessage != NULL)
 	{
 		// Has this message already been indexed ?
-		unsigned int docId = pIndex-&gt;hasDocument(*pMessage);
+		unsigned int docId = pIndex-&gt;hasDocument(pMessage-&gt;getLocation());
 		if (docId == 0)
 		{
 			pIndex-&gt;setStemmingMode(IndexInterface::STORE_BOTH);
@@ -148,8 +148,11 @@
 				break;	
 			}
 
+			set&lt;string&gt; labels;
+			labels.insert(tempSourceLabel);
+
 			unsigned int docId = 0;
-			indexedFile = pIndex-&gt;indexDocument(*pTokenizer, docId);
+			indexedFile = pIndex-&gt;indexDocument(*pTokenizer, labels, docId);
 			if (indexedFile == true)
 			{
 				time_t messageDate = boxParser.getDate();
@@ -160,9 +163,7 @@
 					lastMessageTime = messageDate;
 				}
 
-				set&lt;string&gt; labels;
-				labels.insert(tempSourceLabel);
-				labelMan.setLabels(docId, pIndex-&gt;getLocation(), labels);
+				pIndex-&gt;setDocumentLabels(docId, labels);
 
 				IndexedDocument docInfo(pMessage-&gt;getTitle(),
 					XapianEngine::buildUrl(PinotSettings::getInstance().m_mailIndexLocation, docId),
@@ -189,7 +190,7 @@
 				set&lt;string&gt; labels;
 
 				// Get the message's labels
-				labelMan.getLabels(docId, pIndex-&gt;getLocation(), labels);
+				pIndex-&gt;getDocumentLabels(docId, labels);
 				// The source label must have been applied to the message when originally indexed
 				set&lt;string&gt;::iterator labelIter = labels.find(sourceLabel.c_str());
 				if (labelIter != labels.end())
@@ -198,7 +199,7 @@
 					labels.erase(labelIter);
 					// Add the temporary label
 					labels.insert(tempSourceLabel);
-					labelMan.setLabels(docId, pIndex-&gt;getLocation(), labels);
+					pIndex-&gt;setDocumentLabels(docId, labels);
 				}
 			}
 		}
@@ -223,8 +224,7 @@
 	return indexedFile;
 }
 
-bool MboxHandler::deleteMessages(IndexInterface *pIndex,  LabelManager &amp;labelMan,
-	const string &amp;sourceLabel)
+bool MboxHandler::deleteMessages(IndexInterface *pIndex, const string &amp;sourceLabel)
 {
 	set&lt;unsigned int&gt; docIdList;
 	bool unindexedMsgs = false;
@@ -235,7 +235,7 @@
 	}
 
 	// Unindex all documents labeled with this source label
-	if ((labelMan.getDocumentsWithLabel(sourceLabel, pIndex-&gt;getLocation(), docIdList) == true) &amp;&amp;
+	if ((pIndex-&gt;getDocumentsWithLabel(sourceLabel, docIdList) == true) &amp;&amp;
 		(docIdList.empty() == false))
 	{
 #ifdef DEBUG
@@ -313,7 +313,6 @@
 
 bool MboxHandler::fileExists(const string &amp;fileName, bool end)
 {
-	LabelManager labelMan(PinotSettings::getInstance().m_historyDatabase);
 	PinotSettings::MailAccount mailAccount;
 	off_t previousSize = 0;
 
@@ -350,19 +349,19 @@
 	// Get a parser
 	MboxParser boxParser(fileName);
 
-	bool indexedFile = parseMailAccount(boxParser, &amp;index, labelMan,
+	bool indexedFile = parseMailAccount(boxParser, &amp;index, 
 		mailAccount.m_lastMessageTime, tempSourceLabel, sourceLabel);
 
 	// Any document still labeled with this source label wasn't found
 	// this time around and should be unindexed
-	if (deleteMessages(&amp;index, labelMan, sourceLabel) == true)
+	if (deleteMessages(&amp;index, sourceLabel) == true)
 	{
 		indexedFile = true;
 	}
 
 	// Rename the temporary label for next time the mbox is parsed
-	labelMan.deleteLabel(sourceLabel);
-	labelMan.renameLabel(tempSourceLabel, sourceLabel);
+	index.deleteLabel(sourceLabel);
+	index.renameLabel(tempSourceLabel, sourceLabel);
 
 	// Flush the index
 	index.flush();
@@ -386,7 +385,6 @@
 
 bool MboxHandler::fileChanged(const string &amp;fileName)
 {
-	LabelManager labelMan(PinotSettings::getInstance().m_historyDatabase);
 	PinotSettings::MailAccount mailAccount;
 	off_t previousSize = 0, mboxOffset = 0;
 
@@ -431,7 +429,7 @@
 	// Get a parser
 	MboxParser boxParser(fileName, mboxOffset);
 
-	bool indexedFile = parseMailAccount(boxParser, &amp;index, labelMan,
+	bool indexedFile = parseMailAccount(boxParser, &amp;index,
 		mailAccount.m_lastMessageTime, sourceLabel, &quot;&quot;);
 	if (indexedFile == true)
 	{
@@ -458,7 +456,6 @@
 
 bool MboxHandler::fileDeleted(const string &amp;fileName)
 {
-	LabelManager labelMan(PinotSettings::getInstance().m_historyDatabase);
 	string sourceLabel = string(&quot;<A HREF="mailbox://">mailbox://</A>&quot;) + fileName;
 	bool unindexedFile = false;
 
@@ -474,10 +471,10 @@
 	}
 
 	// Unindex all documents labeled with this source label
-	if (deleteMessages(&amp;index, labelMan, sourceLabel) == true)
+	if (deleteMessages(&amp;index, sourceLabel) == true)
 	{
 		// Delete the label
-		labelMan.deleteLabel(sourceLabel);
+		index.deleteLabel(sourceLabel);
 
 		return true;
 	}

Modified: trunk/UI/GTK2/src/MonitorHandler.h
===================================================================
--- trunk/UI/GTK2/src/MonitorHandler.h	2005-12-15 14:44:29 UTC (rev 8)
+++ trunk/UI/GTK2/src/MonitorHandler.h	2005-12-15 14:46:50 UTC (rev 9)
@@ -26,7 +26,6 @@
 #include &quot;DocumentInfo.h&quot;
 #include &quot;IndexedDocument.h&quot;
 #include &quot;MboxParser.h&quot;
-#include &quot;LabelManager.h&quot;
 #include &quot;IndexInterface.h&quot;
 #include &quot;PinotSettings.h&quot;
 
@@ -91,12 +90,11 @@
 			off_t &amp;previousSize);
 
 		bool parseMailAccount(MboxParser &amp;boxParser, IndexInterface *pIndex,
-			LabelManager &amp;labelMan, time_t &amp;lastMessageTime,
-			const std::string &amp;tempSourceLabel, const std::string &amp;sourceLabel);
-
-		bool deleteMessages(IndexInterface *pIndex, LabelManager &amp;labelMan,
+			time_t &amp;lastMessageTime, const std::string &amp;tempSourceLabel,
 			const std::string &amp;sourceLabel);
 
+		bool deleteMessages(IndexInterface *pIndex, const std::string &amp;sourceLabel);
+
 	private:
 		MboxHandler(const MboxHandler &amp;other);
 		MboxHandler &amp;operator=(const MboxHandler &amp;other);

Modified: trunk/UI/GTK2/src/PinotSettings.cpp
===================================================================
--- trunk/UI/GTK2/src/PinotSettings.cpp	2005-12-15 14:44:29 UTC (rev 8)
+++ trunk/UI/GTK2/src/PinotSettings.cpp	2005-12-15 14:46:50 UTC (rev 9)
@@ -476,14 +476,18 @@
 		{
 			queryProps.setLanguage(nodeContent);
 		}
-		else if (nodeName == &quot;hostname&quot;)
+		else if (nodeName == &quot;hostfilter&quot;)
 		{
-			queryProps.setHostNameFilter(nodeContent);
+			queryProps.setHostFilter(nodeContent);
 		}
-		else if (nodeName == &quot;filename&quot;)
+		else if (nodeName == &quot;filefilter&quot;)
 		{
-			queryProps.setFileNameFilter(nodeContent);
+			queryProps.setFileFilter(nodeContent);
 		}
+		else if (nodeName == &quot;labelfilter&quot;)
+		{
+			queryProps.setLabelFilter(nodeContent);
+		}
 		else if (nodeName == &quot;maxresults&quot;)
 		{
 			int count = atoi(nodeContent.c_str());
@@ -789,8 +793,9 @@
 		addChildElement(pElem, &quot;phrase&quot;, queryIter-&gt;second.getPhrase());
 		addChildElement(pElem, &quot;any&quot;, queryIter-&gt;second.getAnyWords());
 		addChildElement(pElem, &quot;not&quot;, queryIter-&gt;second.getNotWords());
-		addChildElement(pElem, &quot;hostname&quot;, queryIter-&gt;second.getHostNameFilter());
-		addChildElement(pElem, &quot;filename&quot;, queryIter-&gt;second.getFileNameFilter());
+		addChildElement(pElem, &quot;hostfilter&quot;, queryIter-&gt;second.getHostFilter());
+		addChildElement(pElem, &quot;filefilter&quot;, queryIter-&gt;second.getFileFilter());
+		addChildElement(pElem, &quot;labelfilter&quot;, queryIter-&gt;second.getLabelFilter());
 		addChildElement(pElem, &quot;language&quot;, queryIter-&gt;second.getLanguage());
 		sprintf(numStr, &quot;%u&quot;, queryIter-&gt;second.getMaximumResultsCount());
 		addChildElement(pElem, &quot;maxresults&quot;, numStr);

Modified: trunk/UI/GTK2/src/ResultsTree.cpp
===================================================================
--- trunk/UI/GTK2/src/ResultsTree.cpp	2005-12-15 14:44:29 UTC (rev 8)
+++ trunk/UI/GTK2/src/ResultsTree.cpp	2005-12-15 14:46:50 UTC (rev 9)
@@ -1007,12 +1007,11 @@
 	string strippedText = HtmlTokenizer::stripTags(text);
 	XapianIndex index(m_settings.m_indexLocation);
 	ViewHistory viewHistory(m_settings.m_historyDatabase);
-	DocumentInfo docInfo(text, url, &quot;&quot;, language);
 	bool isIndexed = false;
 
 	// Is this document indexed ?
 	if ((index.isGood() == true) &amp;&amp;
-		(index.hasDocument(docInfo) &gt; 0))
+		(index.hasDocument(url) &gt; 0))
 	{
 		isIndexed = true;
 	}

Modified: trunk/UI/GTK2/src/WorkerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.cpp	2005-12-15 14:44:29 UTC (rev 8)
+++ trunk/UI/GTK2/src/WorkerThreads.cpp	2005-12-15 14:46:50 UTC (rev 9)
@@ -33,7 +33,6 @@
 #include &quot;StringManip.h&quot;
 #include &quot;TimeConverter.h&quot;
 #include &quot;Url.h&quot;
-#include &quot;LabelManager.h&quot;
 #include &quot;QueryHistory.h&quot;
 #include &quot;IndexedDocument.h&quot;
 #include &quot;DownloaderFactory.h&quot;
@@ -166,7 +165,7 @@
 	return true;
 }
 
-SigC::Signal3&lt;void, IndexedDocument, unsigned int, std::string&gt;&amp; IndexBrowserThread::getUpdateSignal(void)
+SigC::Signal3&lt;void, IndexedDocument, unsigned int, string&gt;&amp; IndexBrowserThread::getUpdateSignal(void)
 {
 	return m_signalUpdate;
 }
@@ -216,7 +215,7 @@
 		&lt;&lt; &quot; documents to browse, starting at &quot; &lt;&lt; m_startDoc &lt;&lt; endl;
 #endif
 	index.getDocumentIDs(docIDList, m_maxDocsCount, m_startDoc);
-	for (set&lt;unsigned int&gt;::iterator iter = docIDList.begin(); iter != docIDList.end(); iter++)
+	for (set&lt;unsigned int&gt;::iterator iter = docIDList.begin(); iter != docIDList.end(); ++iter)
 	{
 		if (m_done == true)
 		{
@@ -409,8 +408,8 @@
 
 void LabelQueryThread::do_querying()
 {
-	LabelManager labelMan(PinotSettings::getInstance().m_historyDatabase);
 	const map&lt;string, string&gt; &amp;indexesMap = PinotSettings::getInstance().getIndexes();
+
 	map&lt;string, string&gt;::const_iterator mapIter = indexesMap.find(m_indexName);
 	if (mapIter == indexesMap.end())
 	{
@@ -423,11 +422,90 @@
 		return;
 	}
 
-	labelMan.getDocumentsWithLabel(m_labelName, mapIter-&gt;second, m_documentsList);
+	XapianIndex index(mapIter-&gt;second);
+	if (index.isGood() == false)
+	{
+		m_status = _(&quot;Index error on&quot;);
+		m_status += &quot; &quot;;
+		m_status += mapIter-&gt;second;
+		emitSignal();
+		return;
+	}
 
+	index.getDocumentsWithLabel(m_labelName, m_documentsList);
+
 	emitSignal();
 }
 
+LabelUpdateThread::LabelUpdateThread(const set&lt;string&gt; &amp;labelsToDelete,
+	const map&lt;string, string&gt; &amp;labelsToRename)
+{
+	copy(labelsToDelete.begin(), labelsToDelete.end(), inserter(m_labelsToDelete, m_labelsToDelete.begin()));
+	copy(labelsToRename.begin(), labelsToRename.end(), inserter(m_labelsToRename, m_labelsToRename.begin()));
+}
+
+LabelUpdateThread::~LabelUpdateThread()
+{
+}
+
+bool LabelUpdateThread::start(void)
+{
+	// Create a non-joinable thread
+	Thread::create(slot_class(*this, &amp;LabelUpdateThread::do_update), false);
+
+	return true;
+}
+
+string LabelUpdateThread::getType(void) const
+{
+	return &quot;LabelUpdateThread&quot;;
+}
+
+bool LabelUpdateThread::stop(void)
+{
+	m_done = true;
+	m_status = _(&quot;Stopped querying index labels&quot;);
+	return true;
+}
+
+void LabelUpdateThread::do_update()
+{
+	XapianIndex docsIndex(PinotSettings::getInstance().m_indexLocation);
+	if (docsIndex.isGood() == false)
+	{
+		m_status = _(&quot;Index error on&quot;);
+		m_status += &quot; &quot;;
+		m_status += PinotSettings::getInstance().m_indexLocation;
+		emitSignal();
+		return;
+	}
+
+	XapianIndex mailIndex(PinotSettings::getInstance().m_mailIndexLocation);
+	if (mailIndex.isGood() == false)
+	{
+		m_status = _(&quot;Index error on&quot;);
+		m_status += &quot; &quot;;
+		m_status += PinotSettings::getInstance().m_mailIndexLocation;
+		emitSignal();
+		return;
+	}
+
+	// Delete labels
+	for (set&lt;string&gt;::iterator iter = m_labelsToDelete.begin(); iter != m_labelsToDelete.end(); ++iter)
+	{
+		docsIndex.deleteLabel(*iter);
+		mailIndex.deleteLabel(*iter);
+	}
+	// Rename labels
+	for (map&lt;string, string&gt;::iterator iter = m_labelsToRename.begin(); iter != m_labelsToRename.end(); ++iter)
+	{
+		docsIndex.renameLabel(iter-&gt;first, iter-&gt;second);
+		mailIndex.renameLabel(iter-&gt;first, iter-&gt;second);
+	}
+
+	emitSignal();
+}
+
 DownloadingThread::DownloadingThread(const string url, bool fromCache) :
 	WorkerThread()
 {
@@ -594,7 +672,7 @@
 	return m_labelName;
 }
 
-const std::set&lt;unsigned int&gt; &amp;IndexingThread::getDocumentIDs(void) const
+const set&lt;unsigned int&gt; &amp;IndexingThread::getDocumentIDs(void) const
 {
 	return m_docIdList;
 }
@@ -739,18 +817,14 @@
 			}
 			else
 			{
+				set&lt;string&gt; labels;
 				unsigned int docId = 0;
 
 				// Save the new document ID
-				success = index.indexDocument(*pTokens, docId);
+				labels.insert(m_labelName);
+				success = index.indexDocument(*pTokens, labels, docId);
 				if (success == true)
 				{
-					LabelManager labelMan(PinotSettings::getInstance().m_historyDatabase);
-
-					set&lt;string&gt; labels;
-					labels.insert(m_labelName);
-					labelMan.setLabels(docId, index.getLocation(), labels);
-
 					m_docIdList.insert(docId);
 				}
 			}
@@ -830,7 +904,6 @@
 {
 	if (m_done == false)
 	{
-		LabelManager labelMan(PinotSettings::getInstance().m_historyDatabase);
 		XapianIndex index(m_indexLocation);
 
 		if (index.isGood() == false)
@@ -850,51 +923,47 @@
 		{
 			// Yep
 			// FIXME: better delete documents one label at a time
-			for (set&lt;string&gt;::iterator iter = m_labelNames.begin(); iter != m_labelNames.end(); iter++)
+			for (set&lt;string&gt;::iterator iter = m_labelNames.begin(); iter != m_labelNames.end(); ++iter)
 			{
 				string labelName = (*iter);
-				labelMan.getDocumentsWithLabel(labelName, m_indexLocation, m_docIdList);
-				labelMan.deleteLabel(labelName);
+
+				// By unindexing all documents that match the label,
+				// we effectively delete the label from the index
+				if (index.unindexDocuments(labelName) == true)
+				{
+					// OK
+					++m_docsCount;
+				}
 			}
-#ifdef DEBUG
-			cout &lt;&lt; &quot;UnindexingThread::do_unindexing: &quot; &lt;&lt; m_docIdList.size() &lt;&lt; &quot; documents have one of the labels&quot; &lt;&lt; endl;
-#endif
+
+			// Nothing to report
+			m_status = &quot;&quot;;
 		}
-
-		for (set&lt;unsigned int&gt;::iterator iter = m_docIdList.begin(); iter != m_docIdList.end(); iter++)
+		else
 		{
-			unsigned int docId = (*iter);
+			for (set&lt;unsigned int&gt;::iterator iter = m_docIdList.begin(); iter != m_docIdList.end(); ++iter)
+			{
+				unsigned int docId = (*iter);
 
-			if (index.unindexDocument(docId) == true)
-			{
-				// Delete any label this document may have had
-				if (labelMan.deleteItem(docId, m_indexLocation) == false)
+				if (index.unindexDocument(docId) == true)
 				{
+					// OK
+					++m_docsCount;
+				}
 #ifdef DEBUG
-					cout &lt;&lt; &quot;UnindexingThread::do_unindexing: &quot; &lt;&lt; docId
-						&lt;&lt; &quot; may not have had labels&quot; &lt;&lt; endl;
+				else cout &lt;&lt; &quot;UnindexingThread::do_unindexing: couldn't remove &quot; &lt;&lt; docId &lt;&lt; endl;
 #endif
-				}
-
-				// OK
-				m_status = &quot;&quot;;
-				++m_docsCount;
 			}
 #ifdef DEBUG
-			else cout &lt;&lt; &quot;UnindexingThread::do_unindexing: couldn't remove &quot; &lt;&lt; docId &lt;&lt; endl;
+			cout &lt;&lt; &quot;UnindexingThread::do_unindexing: removed &quot; &lt;&lt; m_docsCount &lt;&lt; &quot; documents&quot; &lt;&lt; endl;
 #endif
 		}
 
-		if (m_docIdList.empty() == false)
+		if (m_docsCount &gt; 0)
 		{
-#ifdef DEBUG
-			cout &lt;&lt; &quot;UnindexingThread::do_unindexing: removed &quot; &lt;&lt; m_docIdList.size() &lt;&lt; &quot; documents&quot; &lt;&lt; endl;
-#endif
 			// Flush the index
 			index.flush();
-		}
-		else
-		{
+
 			// Nothing to report
 			m_status = &quot;&quot;;
 		}
@@ -1215,7 +1284,7 @@
 			}
 
 			// Go through the locations map
-			for (map&lt;unsigned long, std::string&gt;::const_iterator fsIter = fsLocations.begin(); fsIter != fsLocations.end(); ++fsIter)
+			for (map&lt;unsigned long, string&gt;::const_iterator fsIter = fsLocations.begin(); fsIter != fsLocations.end(); ++fsIter)
 			{
 				string fsLocation = fsIter-&gt;second;
 				struct stat fileStat;
@@ -1266,7 +1335,15 @@
 			cout &lt;&lt; &quot;MonitorThread::do_monitoring: select() returned&quot; &lt;&lt; endl;
 #endif
 			// There might be more than one event waiting...
-			while ((FAMPending(&amp;famConn) &gt;= 1) &amp;&amp;
+			int pendingEvents = FAMPending(&amp;famConn);
+			if (pendingEvents &lt; 0)
+			{
+#ifdef DEBUG
+				perror(&quot;MonitorThread::do_monitoring: FAMPending() failed&quot;);
+#endif
+				break;
+			}
+			while ((pendingEvents &gt;= 1) &amp;&amp;
 				(m_done == false))
 			{
 				double averageLoad[3];
@@ -1347,6 +1424,9 @@
 						}
 					}
 				}
+
+				// Anything else pending ?
+				pendingEvents = FAMPending(&amp;famConn);
 			}
 		}
 		else

Modified: trunk/UI/GTK2/src/WorkerThreads.h
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.h	2005-12-15 14:44:29 UTC (rev 8)
+++ trunk/UI/GTK2/src/WorkerThreads.h	2005-12-15 14:46:50 UTC (rev 9)
@@ -177,6 +177,31 @@
 
 };
 
+class LabelUpdateThread : public WorkerThread
+{
+	public:
+		LabelUpdateThread(const std::set&lt;std::string&gt; &amp;labelsToDelete,
+			const std::map&lt;std::string, std::string&gt; &amp;labelsToRename);
+		virtual ~LabelUpdateThread();
+
+		virtual bool start(void);
+
+		virtual std::string getType(void) const;
+
+		virtual bool stop(void);
+
+	protected:
+		std::set&lt;std::string&gt; m_labelsToDelete;
+		std::map&lt;std::string, std::string&gt; m_labelsToRename;
+
+		void do_update();
+
+	private:
+		LabelUpdateThread(const LabelUpdateThread &amp;other);
+		LabelUpdateThread &amp;operator=(const LabelUpdateThread &amp;other);
+
+};
+
 class DownloadingThread : public WorkerThread
 {
 	public:

Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2005-12-15 14:44:29 UTC (rev 8)
+++ trunk/UI/GTK2/src/mainWindow.cc	2005-12-15 14:46:50 UTC (rev 9)
@@ -36,7 +36,6 @@
 #include &quot;TimeConverter.h&quot;
 #include &quot;Url.h&quot;
 #include &quot;ActionHistory.h&quot;
-#include &quot;LabelManager.h&quot;
 #include &quot;QueryHistory.h&quot;
 #include &quot;ViewHistory.h&quot;
 #include &quot;DownloaderFactory.h&quot;
@@ -974,6 +973,18 @@
 			}
 		}
 	}
+	else if (type == &quot;LabelUpdateThread&quot;)
+	{
+		LabelQueryThread *pLabelQueryThread = dynamic_cast&lt;LabelQueryThread *&gt;(pThread);
+		if (pLabelQueryThread == NULL)
+		{
+			delete pThread;
+			return;
+		}
+
+		status = _(&quot;Updated label(s)&quot;);
+		set_status(status);
+	}
 	else if (type == &quot;DownloadingThread&quot;)
 	{
 		DownloadingThread *pDownloadThread = dynamic_cast&lt;DownloadingThread *&gt;(pThread);
@@ -1059,25 +1070,27 @@
 			if (m_state.getCurrentIndex() == _(&quot;My Documents&quot;))
 			{
 				XapianIndex index(m_settings.m_indexLocation);
-				DocumentInfo docInfo;
-				string date;
 
-				// Update the index tree
-				for (set&lt;unsigned int&gt;::iterator idIter = docIdList.begin();
-					idIter != docIdList.end(); ++idIter)
+				if (index.isGood() == true)
 				{
-					unsigned int docId = *idIter;
-
-					// Get that document's properties
-					if (index.getDocumentInfo(docId, docInfo) == true)
+					// Update the index tree
+					for (set&lt;unsigned int&gt;::iterator idIter = docIdList.begin();
+						idIter != docIdList.end(); ++idIter)
 					{
-						// Append to the index tree
-						IndexedDocument indexedDoc(docInfo.getTitle(),
-							XapianEngine::buildUrl(m_settings.m_indexLocation, docId),
-							docInfo.getLocation(), docInfo.getType(),
-							docInfo.getLanguage());
-						indexedDoc.setTimestamp(docInfo.getTimestamp());
-						m_pIndexTree-&gt;appendDocument(indexedDoc, labeled);
+						DocumentInfo docInfo;
+						unsigned int docId = *idIter;
+
+						// Get that document's properties
+						if (index.getDocumentInfo(docId, docInfo) == true)
+						{
+							// Append to the index tree
+							IndexedDocument indexedDoc(docInfo.getTitle(),
+								XapianEngine::buildUrl(m_settings.m_indexLocation, docId),
+								docInfo.getLocation(), docInfo.getType(),
+								docInfo.getLanguage());
+							indexedDoc.setTimestamp(docInfo.getTimestamp());
+							m_pIndexTree-&gt;appendDocument(indexedDoc, labeled);
+						}
 					}
 				}
 
@@ -1231,9 +1244,6 @@
 //
 void mainWindow::on_message_indexupdate(IndexedDocument docInfo, unsigned int docId, string indexName)
 {
-	LabelManager labelMan(m_settings.m_historyDatabase);
-	bool hasLabel = false;
-
 	if (indexName != locale_from_utf8(m_state.getCurrentIndex()))
 	{
 		// Ignore
@@ -1262,15 +1272,8 @@
 		return;
 	}
 
-	// Does that document have the current label ?
-	string currentLabelName;
-	if (m_state.getCurrentLabel(currentLabelName) &gt; 0)
-	{
-		hasLabel = labelMan.hasLabel(docId, mapIter-&gt;second, currentLabelName);
-	}
-
 	// Add a row
-	if (m_pIndexTree-&gt;appendDocument(docInfo, hasLabel) == true)
+	if (m_pIndexTree-&gt;appendDocument(docInfo, true) == true)
 	{
 #ifdef DEBUG
 		cout &lt;&lt; &quot;mainWindow::on_message_indexupdate: added document to index list&quot; &lt;&lt; endl;
@@ -1339,11 +1342,20 @@
 		}
 	}
 
+	// Any labels to delete or rename ?
+	const set&lt;string&gt; &amp;labelsToDelete = prefsBox.getLabelsToDelete();
+	const std::map&lt;string, string&gt; &amp;labelsToRename = prefsBox.getLabelsToRename();
+	if ((labelsToDelete.empty() == false) ||
+		(labelsToRename.empty() == false))
+	{
+		start_thread(new LabelUpdateThread(labelsToDelete, labelsToRename));
+	}
+
 	// Any mail documents we should delete ?
-	const set&lt;string&gt; &amp;labelNames = prefsBox.getMailLabelsToDelete();
-	if (labelNames.empty() == false)
+	const set&lt;string&gt; &amp;mailLabelsToDelete = prefsBox.getMailLabelsToDelete();
+	if (mailLabelsToDelete.empty() == false)
 	{
-		start_thread(new UnindexingThread(labelNames, locale_from_utf8(m_settings.m_mailIndexLocation)));
+		start_thread(new UnindexingThread(mailLabelsToDelete, locale_from_utf8(m_settings.m_mailIndexLocation)));
 	}
 }
 
@@ -1670,13 +1682,12 @@
 //
 void mainWindow::on_showfromindex_activate()
 {
-	LabelManager labelMan(m_settings.m_historyDatabase);
 	vector&lt;IndexedDocument&gt; documentsList;
 	set&lt;string&gt; docLabels;
 	DocumentInfo docInfo;
 	unsigned int docId = 0;
 	int width, height;
-	bool matchedLabel = false, editTitle = false;
+	bool editTitle = false;
 
 	const std::map&lt;string, string&gt; &amp;indexesMap = PinotSettings::getInstance().getIndexes();
 	std::map&lt;string, string&gt;::const_iterator mapIter = indexesMap.find(m_state.getCurrentIndex());	
@@ -1691,6 +1702,8 @@
 		return;
 	}
 
+	XapianIndex index(mapIter-&gt;second);
+
 	// Get the current documents selection
 	if ((m_pIndexTree-&gt;getSelection(documentsList) == false) ||
 		(documentsList.empty() == true))
@@ -1707,23 +1720,14 @@
 		// Get the document ID
 		Url urlObj(docIter-&gt;getLocation());
 		docId = (unsigned int)atoi(urlObj.getFile().c_str());
-		if (docId &gt; 0)
-		{
-			labelMan.getLabels(docId, mapIter-&gt;second, docLabels);
 
-			// Does it match the current label ?
-			string currentLabelName;
-			if ((m_state.getCurrentLabel(currentLabelName) &gt; 0) &amp;&amp;
-				(find(docLabels.begin(), docLabels.end(), currentLabelName) != docLabels.end()))
-			{
-				matchedLabel = true;
-			}
+		if (index.isGood() == true)
+		{
+			index.getDocumentLabels(docId, docLabels);
 		}
 
-		docInfo.setTitle(docIter-&gt;getTitle());
-		docInfo.setLocation(docIter-&gt;getOriginalLocation());
-		docInfo.setType(docIter-&gt;getType());
-		docInfo.setLanguage(docIter-&gt;getLanguage());
+		docInfo = DocumentInfo(docIter-&gt;getTitle(), docIter-&gt;getOriginalLocation(),
+			docIter-&gt;getType(), docIter-&gt;getLanguage());
 		docInfo.setTimestamp(docIter-&gt;getTimestamp());
 		editTitle = true;
 	}
@@ -1740,40 +1744,20 @@
 	}
 	const set&lt;string&gt; &amp;labels = propertiesBox.getLabels();
 
-	// Now apply these labels to all documents
-	for (vector&lt;IndexedDocument&gt;::const_iterator docIter = documentsList.begin();
-		docIter != documentsList.end(); ++docIter)
+	if (index.isGood() == true)
 	{
-		// Check the document ID
-		unsigned int docId = docIter-&gt;getID();
-		if (docId == 0)
+		// Now apply these labels to all the documents
+		for (vector&lt;IndexedDocument&gt;::const_iterator docIter = documentsList.begin();
+			docIter != documentsList.end(); ++docIter)
 		{
-			continue;
+			// Set the document's labels list
+			index.setDocumentLabels(docIter-&gt;getID(), labels);
 		}
-		// Set the document's labels list
-		labelMan.setLabels(docId, mapIter-&gt;second, labels);
 	}
 
 	if ((documentsList.size() == 1) &amp;&amp;
 		(docId &gt; 0))
 	{
-		bool matchesLabel = false;
-
-		// Does the sole selected document match the current label now ?
-		string currentLabelName;
-		if ((m_state.getCurrentLabel(currentLabelName) &gt; 0) &amp;&amp;
-			(find(labels.begin(), labels.end(), currentLabelName) != labels.end()))
-		{
-			matchesLabel = true;
-		}
-
-		// Was there any change ?
-		if (matchesLabel != matchedLabel)
-		{
-			// Update this document to the index tree
-			m_pIndexTree-&gt;setDocumentLabeledState(docId, matchesLabel);
-		}
-
 		string newTitle = propertiesBox.getDocumentInfo().getTitle();
 		if (newTitle != docInfo.getTitle())
 		{
@@ -1787,10 +1771,12 @@
 	{
 		string currentLabelName;
 
-		// Because the current label may have been applied to or removed from
-		// one or more of the selected documents, refresh the list of matching documents
-		m_state.getCurrentLabel(currentLabelName);
-		start_thread(new LabelQueryThread(m_state.getCurrentIndex(), currentLabelName));
+		if (m_state.getCurrentLabel(currentLabelName) &gt; 0)
+		{
+			// The current label may have been applied to or removed from
+			// one or more of the selected documents, so refresh the list
+			start_thread(new LabelQueryThread(m_state.getCurrentIndex(), currentLabelName));
+		}
 	}
 }
 
@@ -2533,16 +2519,17 @@
 void mainWindow::index_document(const DocumentInfo &amp;docInfo,
 	const string &amp;labelName, unsigned int docId)
 {
-	LabelManager labelMan(m_settings.m_historyDatabase);
 	Url urlObj(docInfo.getLocation());
-	string indexName = m_settings.m_indexLocation;
+	string indexLocation = m_settings.m_indexLocation;
 
 	// If the document is mail, we need to check My Email
 	if (urlObj.getProtocol() == &quot;mailbox&quot;)
 	{
-		indexName = m_settings.m_mailIndexLocation;
+		indexLocation = m_settings.m_mailIndexLocation;
 	}
 
+	XapianIndex index(indexLocation);
+
 	// Is it an update ?
 	if (docId &gt; 0)
 	{
@@ -2551,7 +2538,6 @@
 	}
 	else
 	{
-		XapianIndex index(indexName);
 		string url(docInfo.getLocation());
 		bool isNewDocument = false;
 
@@ -2559,7 +2545,7 @@
 		// or is being indexed
 		if (index.isGood() == true)
 		{
-			docId = index.hasDocument(docInfo);
+			docId = index.hasDocument(url);
 		}
 		if ((docId == 0) &amp;&amp;
 			(m_state.writeLock(4) == true))
@@ -2589,31 +2575,12 @@
 	{
 		set&lt;string&gt; docLabels;
 
-		// Get the labels for this document
-		labelMan.getLabels(docId, indexName, docLabels);
-
-		// Add this new label if it's not in
-		if (find(docLabels.begin(), docLabels.end(), labelName) == docLabels.end())
-		{
+		// Add this new label
 #ifdef DEBUG
-			cout &lt;&lt; &quot;mainWindow::index_document: applying label &quot; &lt;&lt; labelName &lt;&lt; &quot; to document &quot; &lt;&lt; docId &lt;&lt; endl;
+		cout &lt;&lt; &quot;mainWindow::index_document: applying label &quot; &lt;&lt; labelName &lt;&lt; &quot; to document &quot; &lt;&lt; docId &lt;&lt; endl;
 #endif
-			// Update the document's labels list
-			docLabels.insert(labelName);
-			labelMan.setLabels(docId, indexName, docLabels);
-
-			// Is this the current label ?
-			string currentLabelName;
-			if ((m_state.getCurrentLabel(currentLabelName) &gt; 0) &amp;&amp;
-				(labelName == currentLabelName))
-			{
-				// Update this document in the index tree
-				m_pIndexTree-&gt;setDocumentLabeledState(docId, true);
-			}
-		}
-#ifdef DEBUG
-		else cout &lt;&lt; &quot;mainWindow::index_document: label &quot; &lt;&lt; labelName &lt;&lt; &quot; already applied to document &quot; &lt;&lt; docId &lt;&lt; endl;
-#endif
+		docLabels.insert(labelName);
+		index.setDocumentLabels(docId, docLabels, false);
 	}
 }
 

Modified: trunk/UI/GTK2/src/pinot.cpp
===================================================================
--- trunk/UI/GTK2/src/pinot.cpp	2005-12-15 14:44:29 UTC (rev 8)
+++ trunk/UI/GTK2/src/pinot.cpp	2005-12-15 14:46:50 UTC (rev 9)
@@ -28,7 +28,6 @@
 #include &quot;TokenizerFactory.h&quot;
 #include &quot;Languages.h&quot;
 #include &quot;ActionHistory.h&quot;
-#include &quot;LabelManager.h&quot;
 #include &quot;QueryHistory.h&quot;
 #include &quot;ViewHistory.h&quot;
 #include &quot;XapianDatabase.h&quot;
@@ -120,7 +119,6 @@
 	// Do the same for the history database
 	if ((settings.m_historyDatabase.empty() == true) ||
 		(ActionHistory::create(settings.m_historyDatabase) == false) ||
-		(LabelManager::create(settings.m_historyDatabase) == false) ||
 		(QueryHistory::create(settings.m_historyDatabase) == false) ||
 		(ViewHistory::create(settings.m_historyDatabase) == false))
 	{

Modified: trunk/UI/GTK2/src/prefsDialog.cc
===================================================================
--- trunk/UI/GTK2/src/prefsDialog.cc	2005-12-15 14:44:29 UTC (rev 8)
+++ trunk/UI/GTK2/src/prefsDialog.cc	2005-12-15 14:46:50 UTC (rev 9)
@@ -15,7 +15,6 @@
 
 #include &quot;MIMEScanner.h&quot;
 #include &quot;SearchEngineFactory.h&quot;
-#include &quot;LabelManager.h&quot;
 #include &quot;QueryHistory.h&quot;
 #include &quot;Url.h&quot;
 #include &quot;config.h&quot;
@@ -86,13 +85,21 @@
 {
 }
 
-const set&lt;string&gt; &amp;prefsDialog::getMailLabelsToDelete(void) const
+const set&lt;string&gt; &amp;prefsDialog::getLabelsToDelete(void) const
 {
-	// This will have been reset by save_labelsTreeview()
-	// and set by save_mailTreeview() !
 	return m_deletedLabels;
 }
 
+const map&lt;string, string&gt; &amp;prefsDialog::getLabelsToRename(void) const
+{
+	return m_renamedLabels;
+}
+
+const set&lt;string&gt; &amp;prefsDialog::getMailLabelsToDelete(void) const
+{
+	return m_deletedMail;
+}
+
 void prefsDialog::populate_comboboxes()
 {
 	TreeModel::iterator iter = m_refViewTree-&gt;append();
@@ -149,8 +156,6 @@
 
 bool prefsDialog::save_labelsTreeview()
 {
-	LabelManager labelMan(m_settings.m_historyDatabase);
-
 	// Clear the current settings
 	m_settings.m_labels.clear();
 
@@ -172,7 +177,7 @@
 				(label.m_name != oldName))
 			{
 				// Yes, it was
-				labelMan.renameLabel(locale_from_utf8(oldName), locale_from_utf8(label.m_name));
+				m_renamedLabels[locale_from_utf8(oldName)] = locale_from_utf8(label.m_name);
 			}
 			// Check user didn't recreate this label after having deleted it
 			set&lt;string&gt;::iterator labelIter = m_deletedLabels.find(locale_from_utf8(label.m_name));
@@ -192,13 +197,6 @@
 		}
 	}
 
-	// Remove all references to labels that have been deleted
-	for (set&lt;string&gt;::iterator labelIter = m_deletedLabels.begin(); labelIter != m_deletedLabels.end(); ++labelIter)
-	{
-		labelMan.deleteLabel(*labelIter);
-	}
-	m_deletedLabels.clear();
-
 	return true;
 }
 
@@ -258,8 +256,11 @@
 				mailAccount.m_modTime = row[m_mailColumns.m_mTime];
 				mailAccount.m_lastMessageTime = row[m_mailColumns.m_minDate];
 
+				string mailLabel(&quot;<A HREF="mailbox://">mailbox://</A>&quot;);
+				mailLabel += locale_from_utf8(mailAccount.m_name);
+
 				// Check user didn't recreate this mail account after having deleted it
-				set&lt;ustring&gt;::iterator mailIter = m_deletedMail.find(mailAccount.m_name);
+				set&lt;string&gt;::iterator mailIter = m_deletedMail.find(mailLabel);
 				if (mailIter != m_deletedMail.end())
 				{
 					m_deletedMail.erase(mailIter);
@@ -277,19 +278,6 @@
 		}
 	}
 
-	// Remove all documents from deleted mail accounts
-	for (set&lt;ustring&gt;::iterator mailIter = m_deletedMail.begin(); mailIter != m_deletedMail.end(); ++mailIter)
-	{
-		string sourceLabel = &quot;<A HREF="mailbox://">mailbox://</A>&quot;;
-		sourceLabel += *mailIter;
-
-		// Reuse the labels list
-		m_deletedLabels.insert(sourceLabel);
-#ifdef DEBUG
-		cout &lt;&lt; &quot;prefsDialog::save_mailTreeview: will unindex documents from &quot; &lt;&lt; *mailIter &lt;&lt; endl;
-#endif
-	}
-
 	return true;
 }
 
@@ -492,15 +480,19 @@
 	TreeModel::iterator iter = mailTreeview-&gt;get_selection()-&gt;get_selected();
 	if (iter)
 	{
+		string mailLabel(&quot;<A HREF="mailbox://">mailbox://</A>&quot;);
+
 		// Unselect
 		mailTreeview-&gt;get_selection()-&gt;unselect(iter);
 		// Select another row
 		TreeModel::Path path = m_refMailTree-&gt;get_path(iter);
 		path.next();
 		mailTreeview-&gt;get_selection()-&gt;select(path);
+
 		// Erase
 		TreeModel::Row row = *iter;
-		m_deletedMail.insert(row[m_mailColumns.m_location]);
+		mailLabel += locale_from_utf8(row[m_mailColumns.m_location]);
+		m_deletedMail.insert(mailLabel);
 		m_refMailTree-&gt;erase(row);
 
 		TreeModel::Children children = m_refMailTree-&gt;children();

Modified: trunk/UI/GTK2/src/prefsDialog.hh
===================================================================
--- trunk/UI/GTK2/src/prefsDialog.hh	2005-12-15 14:44:29 UTC (rev 8)
+++ trunk/UI/GTK2/src/prefsDialog.hh	2005-12-15 14:46:50 UTC (rev 9)
@@ -13,6 +13,7 @@
 #define _PREFSDIALOG_HH
 
 #include &lt;string&gt;
+#include &lt;map&gt;
 #include &lt;set&gt;
 #include &lt;glibmm/refptr.h&gt;
 #include &lt;glibmm/ustring.h&gt;
@@ -28,6 +29,10 @@
 	prefsDialog();
 	virtual ~prefsDialog();
 
+	const std::set&lt;std::string&gt; &amp;getLabelsToDelete(void) const;
+
+	const std::map&lt;std::string, std::string&gt; &amp;getLabelsToRename(void) const;
+
 	const std::set&lt;std::string&gt; &amp;getMailLabelsToDelete(void) const;
 
 protected:
@@ -59,9 +64,9 @@
 	Glib::RefPtr&lt;Gtk::ListStore&gt; m_refLabelsTree;
 	MailAccountModelColumns m_mailColumns;
 	Glib::RefPtr&lt;Gtk::ListStore&gt; m_refMailTree;
-	std::set&lt;Glib::ustring&gt; m_deletedIndexes;
 	std::set&lt;std::string&gt; m_deletedLabels;
-	std::set&lt;Glib::ustring&gt; m_deletedMail;
+	std::map&lt;std::string, std::string&gt; m_renamedLabels;
+	std::set&lt;std::string&gt; m_deletedMail;
 	static unsigned int m_maxDirLevel;
 
 };

Modified: trunk/UI/GTK2/src/queryDialog.cc
===================================================================
--- trunk/UI/GTK2/src/queryDialog.cc	2005-12-15 14:44:29 UTC (rev 8)
+++ trunk/UI/GTK2/src/queryDialog.cc	2005-12-15 14:46:50 UTC (rev 9)
@@ -28,10 +28,14 @@
 {
 	string name = m_properties.getName();
 
-	// Associate the columns model to the label combo
-	m_refLabelTree = ListStore::create(m_labelColumns);
-	labelCombobox-&gt;set_model(m_refLabelTree);
-	labelCombobox-&gt;pack_start(m_labelColumns.m_name);
+	// Associate the columns model to the index label combo
+	m_refLabelNameTree = ListStore::create(m_labelNameColumns);
+	labelNameCombobox-&gt;set_model(m_refLabelNameTree);
+	labelNameCombobox-&gt;pack_start(m_labelNameColumns.m_name);
+	// ...and the label filter combo
+	m_refLabelFilterTree = ListStore::create(m_labelFilterColumns);
+	labelFilterCombobox-&gt;set_model(m_refLabelFilterTree);
+	labelFilterCombobox-&gt;pack_start(m_labelFilterColumns.m_name);
 	// Associate the columns model to the language combo
 	m_refLanguageTree = ListStore::create(m_languageColumns);
 	languageCombobox-&gt;set_model(m_refLanguageTree);
@@ -55,9 +59,9 @@
 	notEntry-&gt;set_text(locale_to_utf8(m_properties.getNotWords()));
 
 	// Host name
-	hostNameEntry-&gt;set_text(locale_to_utf8(m_properties.getHostNameFilter()));
+	hostNameEntry-&gt;set_text(locale_to_utf8(m_properties.getHostFilter()));
 	// File name
-	fileNameEntry-&gt;set_text(locale_to_utf8(m_properties.getFileNameFilter()));
+	fileNameEntry-&gt;set_text(locale_to_utf8(m_properties.getFileFilter()));
 	// Maximum number of results
 	resultsCountSpinbutton-&gt;set_value((double)m_properties.getMaximumResultsCount());
 	// Index all results
@@ -71,45 +75,47 @@
 void queryDialog::populate_comboboxes()
 {
 	unsigned int labelNum = 1;
-	bool foundLanguage = false;
 
-	TreeModel::iterator iter = m_refLabelTree-&gt;append();
+	TreeModel::iterator iter = m_refLabelNameTree-&gt;append();
 	TreeModel::Row row = *iter;
-	row[m_labelColumns.m_name] = &quot;None&quot;;
-	labelCombobox-&gt;set_active(0);
+	row[m_labelNameColumns.m_name] = _(&quot;None&quot;);
+	labelNameCombobox-&gt;set_active(0);
 
-#ifdef DEBUG
-	cout &lt;&lt; &quot;queryDialog::populate_comboboxes: looking for &quot; &lt;&lt; m_properties.getLabelName() &lt;&lt; endl;
-#endif
-	// Add all labels to the combo and select the one defined for the query
+	iter = m_refLabelFilterTree-&gt;append();
+	row = *iter;
+	row[m_labelFilterColumns.m_name] = _(&quot;Any&quot;);
+	labelFilterCombobox-&gt;set_active(0);
+
+	// Add all labels to both label combos and select the one defined for the query
 	for (set&lt;PinotSettings::Label&gt;::const_iterator labelIter = m_labels.begin(); labelIter != m_labels.end(); ++labelIter)
 	{
 		string labelName = labelIter-&gt;m_name;
 
-		iter = m_refLabelTree-&gt;append();
+		iter = m_refLabelNameTree-&gt;append();
 		row = *iter;
-		row[m_labelColumns.m_name] = locale_to_utf8(labelName);
-#ifdef DEBUG
-	cout &lt;&lt; &quot;queryDialog::populate_comboboxes: added label &quot; &lt;&lt; labelName &lt;&lt; endl;
-#endif
-
+		row[m_labelNameColumns.m_name] = locale_to_utf8(labelName);
 		if (labelName == m_properties.getLabelName())
 		{
-			labelCombobox-&gt;set_active(labelNum);
-			// Keep going
+			labelNameCombobox-&gt;set_active(labelNum);
 		}
+
+		iter = m_refLabelFilterTree-&gt;append();
+		row = *iter;
+		row[m_labelFilterColumns.m_name] = locale_to_utf8(labelName);
+		if (labelName == m_properties.getLabelFilter())
+		{
+			labelFilterCombobox-&gt;set_active(labelNum);
+		}
+
 		++labelNum;
 	}
 
-	string queryLanguage = m_properties.getLanguage();
 	iter = m_refLanguageTree-&gt;append();
 	row = *iter;
 	row[m_languageColumns.m_name] = _(&quot;Any&quot;);
+	languageCombobox-&gt;set_active(0);
 
 	// Add all supported languages and select the one defined for the query
-#ifdef DEBUG
-	cout &lt;&lt; &quot;queryDialog::populate_comboboxes: looking for &quot; &lt;&lt; queryLanguage &lt;&lt; endl;
-#endif
 	for (unsigned int languageNum = 0; languageNum &lt; Languages::m_count; ++languageNum)
 	{
 		string languageName = Languages::getIntlName(languageNum);
@@ -117,21 +123,14 @@
 		row = *iter;
 		row[m_languageColumns.m_name] = languageName;
 
-		if ((foundLanguage == false) &amp;&amp;
-			(queryLanguage.empty() == false) &amp;&amp;
-			(queryLanguage == languageName))
+		if (languageName == m_properties.getLanguage())
 		{
 #ifdef DEBUG
 			cout &lt;&lt; &quot;queryDialog::populate_comboboxes: found at &quot; &lt;&lt; languageNum &lt;&lt; endl;
 #endif
 			languageCombobox-&gt;set_active(languageNum + 1);
-			foundLanguage = true;
 		}
 	}
-	if (foundLanguage == false)
-	{
-		languageCombobox-&gt;set_active(0);
-	}
 }
 
 bool queryDialog::badName(void) const
@@ -176,34 +175,34 @@
 			m_properties.setLanguage(Languages::getIntlName(chosenLanguage));
 		}
 	}
-	// Host name
-	m_properties.setHostNameFilter(locale_from_utf8(hostNameEntry-&gt;get_text()));
-	// File name
-	m_properties.setFileNameFilter(locale_from_utf8(fileNameEntry-&gt;get_text()));
 	// Maximum number of results
 	m_properties.setMaximumResultsCount((unsigned int)resultsCountSpinbutton-&gt;get_value());
 	// Index all results
 	m_properties.setIndexResults(indexCheckbutton-&gt;get_active());
-	// Label
-	int chosenLabel = labelCombobox-&gt;get_active_row_number();
-#ifdef DEBUG
-	cout &lt;&lt; &quot;queryDialog::on_queryOkbutton_clicked: chosen label &quot; &lt;&lt; chosenLabel &lt;&lt; endl;
-#endif
-	if (chosenLabel == 0)
+	// Index label
+	int chosenLabel = labelNameCombobox-&gt;get_active_row_number();
+	m_properties.setLabelName(&quot;&quot;);
+	if (chosenLabel &gt; 0)
 	{
-		// No label
-		m_properties.setLabelName(&quot;&quot;);
+		TreeModel::iterator iter = labelNameCombobox-&gt;get_active();
+		TreeModel::Row row = *iter;
+		string labelName = locale_from_utf8(row[m_labelNameColumns.m_name]);
+
+		m_properties.setLabelName(labelName);
 	}
-	else
+	// Filters
+	m_properties.setHostFilter(locale_from_utf8(hostNameEntry-&gt;get_text()));
+	m_properties.setFileFilter(locale_from_utf8(fileNameEntry-&gt;get_text()));
+	// Label filter
+	chosenLabel = labelFilterCombobox-&gt;get_active_row_number();
+	m_properties.setLabelFilter(&quot;&quot;);
+	if (chosenLabel &gt; 0)
 	{
-		TreeModel::iterator iter = labelCombobox-&gt;get_active();
+		TreeModel::iterator iter = labelFilterCombobox-&gt;get_active();
 		TreeModel::Row row = *iter;
-		string labelName = locale_from_utf8(row[m_labelColumns.m_name]);
+		string labelName = locale_from_utf8(row[m_labelFilterColumns.m_name]);
 
-#ifdef DEBUG
-		cout &lt;&lt; &quot;queryDialog::on_queryOkbutton_clicked: label is &quot; &lt;&lt; labelName &lt;&lt; endl;
-#endif
-		m_properties.setLabelName(labelName);
+		m_properties.setLabelFilter(labelName);
 	}
 }
 

Modified: trunk/UI/GTK2/src/queryDialog.hh
===================================================================
--- trunk/UI/GTK2/src/queryDialog.hh	2005-12-15 14:44:29 UTC (rev 8)
+++ trunk/UI/GTK2/src/queryDialog.hh	2005-12-15 14:46:50 UTC (rev 9)
@@ -33,10 +33,12 @@
 	std::string m_name;
 	QueryProperties&amp; m_properties;
 	const std::set&lt;PinotSettings::Label&gt; &amp;m_labels;
-	ComboModelColumns m_labelColumns;
-	Glib::RefPtr&lt;Gtk::ListStore&gt; m_refLabelTree;
+	ComboModelColumns m_labelNameColumns;
+	Glib::RefPtr&lt;Gtk::ListStore&gt; m_refLabelNameTree;
 	ComboModelColumns m_languageColumns;
 	Glib::RefPtr&lt;Gtk::ListStore&gt; m_refLanguageTree;
+	ComboModelColumns m_labelFilterColumns;
+	Glib::RefPtr&lt;Gtk::ListStore&gt; m_refLabelFilterTree;
 	bool m_badName;
 
 	void populate_comboboxes();

Modified: trunk/UI/GTK2/src/queryDialog_glade.cc
===================================================================
--- trunk/UI/GTK2/src/queryDialog_glade.cc	2005-12-15 14:44:29 UTC (rev 8)
+++ trunk/UI/GTK2/src/queryDialog_glade.cc	2005-12-15 14:46:50 UTC (rev 9)
@@ -1,4 +1,4 @@
-// generated 2005/11/26 12:46:55 SGT by <A HREF="https://lists.berlios.de/mailman/listinfo/pinot-svn">fabrice at amra.dyndns.org.</A>(none)
+// generated 2005/12/15 22:39:14 SGT by <A HREF="https://lists.berlios.de/mailman/listinfo/pinot-svn">fabrice at amra.dyndns.org.</A>(none)
 // using glademm V2.6.0
 //
 // DO NOT EDIT THIS FILE ! It was created using
@@ -70,25 +70,29 @@
    indexCheckbutton = Gtk::manage(new class Gtk::CheckButton(_(&quot;Index all results with label&quot;)));
    
    Gtk::Label *anyLabel = Gtk::manage(new class Gtk::Label(_(&quot;Any of the words:&quot;)));
-   Gtk::Label *hostLabel = Gtk::manage(new class Gtk::Label(_(&quot;Host name:&quot;)));
    Gtk::Label *fileNameLabel = Gtk::manage(new class Gtk::Label(_(&quot;File name:&quot;)));
    Gtk::Label *resultsCountLabel = Gtk::manage(new class Gtk::Label(_(&quot;Number of results:&quot;)));
-   labelCombobox = Gtk::manage(new class Gtk::ComboBox());
+   labelNameCombobox = Gtk::manage(new class Gtk::ComboBox());
    
+   Gtk::Label *hostLabel = Gtk::manage(new class Gtk::Label(_(&quot;Host name:&quot;)));
+   Gtk::Label *notLabel = Gtk::manage(new class Gtk::Label(_(&quot;None of the words:&quot;)));
+   notEntry = Gtk::manage(new class Gtk::Entry());
+   
    Gtk::Table *tersmTable = Gtk::manage(new class Gtk::Table(2, 2, false));
    Gtk::VBox *termsVbox = Gtk::manage(new class Gtk::VBox(false, 0));
    Gtk::Label *propertiesLabel = Gtk::manage(new class Gtk::Label(_(&quot;Properties&quot;)));
    Gtk::Label *filtersLabel = Gtk::manage(new class Gtk::Label(_(&quot;Limit to documents that match&quot;)));
    phraseEntry = Gtk::manage(new class Gtk::Entry());
-   notEntry = Gtk::manage(new class Gtk::Entry());
    
    Gtk::Label *phraseLabel = Gtk::manage(new class Gtk::Label(_(&quot;the exact phrase:&quot;)));
-   Gtk::Label *notLabel = Gtk::manage(new class Gtk::Label(_(&quot;none of the words:&quot;)));
-   Gtk::Label *label14 = Gtk::manage(new class Gtk::Label(_(&quot;the language:&quot;)));
+   Gtk::Label *languageLabel = Gtk::manage(new class Gtk::Label(_(&quot;the language:&quot;)));
    languageCombobox = Gtk::manage(new class Gtk::ComboBox());
    andEntry = Gtk::manage(new class Gtk::Entry());
    
    Gtk::Label *andLabel = Gtk::manage(new class Gtk::Label(_(&quot;all the words:&quot;)));
+   Gtk::Label *labelLabel = Gtk::manage(new class Gtk::Label(_(&quot;the label:&quot;)));
+   labelFilterCombobox = Gtk::manage(new class Gtk::ComboBox());
+   
    Gtk::Table *advancedTable = Gtk::manage(new class Gtk::Table(2, 2, false));
    Gtk::VBox *advancedVbox = Gtk::manage(new class Gtk::VBox(false, 0));
    Gtk::Label *advancedLabel = Gtk::manage(new class Gtk::Label(_(&quot;Advanced&quot;)));
@@ -155,12 +159,6 @@
    anyLabel-&gt;set_line_wrap(false);
    anyLabel-&gt;set_use_markup(false);
    anyLabel-&gt;set_selectable(false);
-   hostLabel-&gt;set_alignment(0,0.5);
-   hostLabel-&gt;set_padding(4,4);
-   hostLabel-&gt;set_justify(Gtk::JUSTIFY_LEFT);
-   hostLabel-&gt;set_line_wrap(false);
-   hostLabel-&gt;set_use_markup(false);
-   hostLabel-&gt;set_selectable(false);
    fileNameLabel-&gt;set_alignment(0,0.5);
    fileNameLabel-&gt;set_padding(4,4);
    fileNameLabel-&gt;set_justify(Gtk::JUSTIFY_LEFT);
@@ -173,18 +171,39 @@
    resultsCountLabel-&gt;set_line_wrap(false);
    resultsCountLabel-&gt;set_use_markup(false);
    resultsCountLabel-&gt;set_selectable(false);
+   hostLabel-&gt;set_alignment(0,0.5);
+   hostLabel-&gt;set_padding(4,4);
+   hostLabel-&gt;set_justify(Gtk::JUSTIFY_LEFT);
+   hostLabel-&gt;set_line_wrap(false);
+   hostLabel-&gt;set_use_markup(false);
+   hostLabel-&gt;set_selectable(false);
+   notLabel-&gt;set_alignment(0,0.5);
+   notLabel-&gt;set_padding(4,4);
+   notLabel-&gt;set_justify(Gtk::JUSTIFY_LEFT);
+   notLabel-&gt;set_line_wrap(false);
+   notLabel-&gt;set_use_markup(false);
+   notLabel-&gt;set_selectable(false);
+   notEntry-&gt;set_flags(Gtk::CAN_FOCUS);
+   notEntry-&gt;set_visibility(true);
+   notEntry-&gt;set_editable(true);
+   notEntry-&gt;set_max_length(0);
+   notEntry-&gt;set_text(_(&quot;&quot;));
+   notEntry-&gt;set_has_frame(true);
+   notEntry-&gt;set_activates_default(false);
    tersmTable-&gt;set_row_spacings(0);
    tersmTable-&gt;set_col_spacings(0);
    tersmTable-&gt;attach(*anyEntry, 1, 2, 0, 1, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
-   tersmTable-&gt;attach(*hostNameEntry, 1, 2, 1, 2, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
-   tersmTable-&gt;attach(*fileNameEntry, 1, 2, 2, 3, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
-   tersmTable-&gt;attach(*resultsCountSpinbutton, 1, 2, 3, 4, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
-   tersmTable-&gt;attach(*indexCheckbutton, 0, 1, 4, 5, Gtk::FILL, Gtk::FILL, 4, 4);
+   tersmTable-&gt;attach(*hostNameEntry, 1, 2, 2, 3, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
+   tersmTable-&gt;attach(*fileNameEntry, 1, 2, 3, 4, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
+   tersmTable-&gt;attach(*resultsCountSpinbutton, 1, 2, 4, 5, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
+   tersmTable-&gt;attach(*indexCheckbutton, 0, 1, 5, 6, Gtk::FILL, Gtk::FILL, 4, 4);
    tersmTable-&gt;attach(*anyLabel, 0, 1, 0, 1, Gtk::FILL, Gtk::FILL, 0, 0);
-   tersmTable-&gt;attach(*hostLabel, 0, 1, 1, 2, Gtk::FILL, Gtk::FILL, 0, 0);
-   tersmTable-&gt;attach(*fileNameLabel, 0, 1, 2, 3, Gtk::FILL, Gtk::FILL, 0, 0);
-   tersmTable-&gt;attach(*resultsCountLabel, 0, 1, 3, 4, Gtk::FILL, Gtk::FILL, 0, 0);
-   tersmTable-&gt;attach(*labelCombobox, 1, 2, 4, 5, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
+   tersmTable-&gt;attach(*fileNameLabel, 0, 1, 3, 4, Gtk::FILL, Gtk::FILL, 0, 0);
+   tersmTable-&gt;attach(*resultsCountLabel, 0, 1, 4, 5, Gtk::FILL, Gtk::FILL, 0, 0);
+   tersmTable-&gt;attach(*labelNameCombobox, 1, 2, 5, 6, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
+   tersmTable-&gt;attach(*hostLabel, 0, 1, 2, 3, Gtk::FILL, Gtk::FILL, 0, 0);
+   tersmTable-&gt;attach(*notLabel, 0, 1, 1, 2, Gtk::FILL, Gtk::FILL, 0, 0);
+   tersmTable-&gt;attach(*notEntry, 1, 2, 1, 2, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
    termsVbox-&gt;pack_start(*tersmTable, Gtk::PACK_SHRINK, 4);
    propertiesLabel-&gt;set_alignment(0.5,0.5);
    propertiesLabel-&gt;set_padding(0,0);
@@ -205,31 +224,18 @@
    phraseEntry-&gt;set_text(_(&quot;&quot;));
    phraseEntry-&gt;set_has_frame(true);
    phraseEntry-&gt;set_activates_default(false);
-   notEntry-&gt;set_flags(Gtk::CAN_FOCUS);
-   notEntry-&gt;set_visibility(true);
-   notEntry-&gt;set_editable(true);
-   notEntry-&gt;set_max_length(0);
-   notEntry-&gt;set_text(_(&quot;&quot;));
-   notEntry-&gt;set_has_frame(true);
-   notEntry-&gt;set_activates_default(false);
    phraseLabel-&gt;set_alignment(0,0.5);
    phraseLabel-&gt;set_padding(4,4);
    phraseLabel-&gt;set_justify(Gtk::JUSTIFY_LEFT);
    phraseLabel-&gt;set_line_wrap(false);
    phraseLabel-&gt;set_use_markup(false);
    phraseLabel-&gt;set_selectable(false);
-   notLabel-&gt;set_alignment(0,0.5);
-   notLabel-&gt;set_padding(4,4);
-   notLabel-&gt;set_justify(Gtk::JUSTIFY_LEFT);
-   notLabel-&gt;set_line_wrap(false);
-   notLabel-&gt;set_use_markup(false);
-   notLabel-&gt;set_selectable(false);
-   label14-&gt;set_alignment(0,0.5);
-   label14-&gt;set_padding(4,4);
-   label14-&gt;set_justify(Gtk::JUSTIFY_LEFT);
-   label14-&gt;set_line_wrap(false);
-   label14-&gt;set_use_markup(false);
-   label14-&gt;set_selectable(false);
+   languageLabel-&gt;set_alignment(0,0.5);
+   languageLabel-&gt;set_padding(4,4);
+   languageLabel-&gt;set_justify(Gtk::JUSTIFY_LEFT);
+   languageLabel-&gt;set_line_wrap(false);
+   languageLabel-&gt;set_use_markup(false);
+   languageLabel-&gt;set_selectable(false);
    andEntry-&gt;set_flags(Gtk::CAN_FOCUS);
    andEntry-&gt;set_visibility(true);
    andEntry-&gt;set_editable(true);
@@ -243,16 +249,22 @@
    andLabel-&gt;set_line_wrap(false);
    andLabel-&gt;set_use_markup(false);
    andLabel-&gt;set_selectable(false);
+   labelLabel-&gt;set_alignment(0,0.5);
+   labelLabel-&gt;set_padding(4,4);
+   labelLabel-&gt;set_justify(Gtk::JUSTIFY_LEFT);
+   labelLabel-&gt;set_line_wrap(false);
+   labelLabel-&gt;set_use_markup(false);
+   labelLabel-&gt;set_selectable(false);
    advancedTable-&gt;set_row_spacings(0);
    advancedTable-&gt;set_col_spacings(0);
    advancedTable-&gt;attach(*phraseEntry, 1, 2, 1, 2, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
-   advancedTable-&gt;attach(*notEntry, 1, 2, 2, 3, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
    advancedTable-&gt;attach(*phraseLabel, 0, 1, 1, 2, Gtk::FILL, Gtk::FILL, 0, 0);
-   advancedTable-&gt;attach(*notLabel, 0, 1, 2, 3, Gtk::FILL, Gtk::FILL, 0, 0);
-   advancedTable-&gt;attach(*label14, 0, 1, 3, 4, Gtk::FILL, Gtk::FILL, 0, 0);
-   advancedTable-&gt;attach(*languageCombobox, 1, 2, 3, 4, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
+   advancedTable-&gt;attach(*languageLabel, 0, 1, 2, 3, Gtk::FILL, Gtk::FILL, 0, 0);
+   advancedTable-&gt;attach(*languageCombobox, 1, 2, 2, 3, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
    advancedTable-&gt;attach(*andEntry, 1, 2, 0, 1, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
    advancedTable-&gt;attach(*andLabel, 0, 1, 0, 1, Gtk::FILL, Gtk::FILL, 0, 0);
+   advancedTable-&gt;attach(*labelLabel, 0, 1, 3, 4, Gtk::FILL, Gtk::FILL, 0, 0);
+   advancedTable-&gt;attach(*labelFilterCombobox, 1, 2, 3, 4, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
    advancedVbox-&gt;pack_start(*filtersLabel, Gtk::PACK_SHRINK, 4);
    advancedVbox-&gt;pack_start(*advancedTable, Gtk::PACK_SHRINK, 0);
    advancedLabel-&gt;set_alignment(0.5,0.5);
@@ -294,22 +306,24 @@
    resultsCountSpinbutton-&gt;show();
    indexCheckbutton-&gt;show();
    anyLabel-&gt;show();
-   hostLabel-&gt;show();
    fileNameLabel-&gt;show();
    resultsCountLabel-&gt;show();
-   labelCombobox-&gt;show();
+   labelNameCombobox-&gt;show();
+   hostLabel-&gt;show();
+   notLabel-&gt;show();
+   notEntry-&gt;show();
    tersmTable-&gt;show();
    termsVbox-&gt;show();
    propertiesLabel-&gt;show();
    filtersLabel-&gt;show();
    phraseEntry-&gt;show();
-   notEntry-&gt;show();
    phraseLabel-&gt;show();
-   notLabel-&gt;show();
-   label14-&gt;show();
+   languageLabel-&gt;show();
    languageCombobox-&gt;show();
    andEntry-&gt;show();
    andLabel-&gt;show();
+   labelLabel-&gt;show();
+   labelFilterCombobox-&gt;show();
    advancedTable-&gt;show();
    advancedVbox-&gt;show();
    advancedLabel-&gt;show();

Modified: trunk/UI/GTK2/src/queryDialog_glade.hh
===================================================================
--- trunk/UI/GTK2/src/queryDialog_glade.hh	2005-12-15 14:44:29 UTC (rev 8)
+++ trunk/UI/GTK2/src/queryDialog_glade.hh	2005-12-15 14:46:50 UTC (rev 9)
@@ -1,4 +1,4 @@
-// generated 2005/11/26 12:46:55 SGT by <A HREF="https://lists.berlios.de/mailman/listinfo/pinot-svn">fabrice at amra.dyndns.org.</A>(none)
+// generated 2005/12/15 22:39:14 SGT by <A HREF="https://lists.berlios.de/mailman/listinfo/pinot-svn">fabrice at amra.dyndns.org.</A>(none)
 // using glademm V2.6.0
 //
 // DO NOT EDIT THIS FILE ! It was created using
@@ -54,11 +54,12 @@
         class Gtk::Entry * fileNameEntry;
         class Gtk::SpinButton * resultsCountSpinbutton;
         class Gtk::CheckButton * indexCheckbutton;
-        class Gtk::ComboBox * labelCombobox;
+        class Gtk::ComboBox * labelNameCombobox;
+        class Gtk::Entry * notEntry;
         class Gtk::Entry * phraseEntry;
-        class Gtk::Entry * notEntry;
         class Gtk::ComboBox * languageCombobox;
         class Gtk::Entry * andEntry;
+        class Gtk::ComboBox * labelFilterCombobox;
         class Gtk::Notebook * queryNotebook;
         
         queryDialog_glade();


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000007.html">[Pinot-svn] r8 - in trunk: Index SQL Search Search/Google Search/ObjectsSearch
</A></li>
	<LI>Next message: <A HREF="000009.html">[Pinot-svn] r10 - trunk/SQL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8">[ date ]</a>
              <a href="thread.html#8">[ thread ]</a>
              <a href="subject.html#8">[ subject ]</a>
              <a href="author.html#8">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/pinot-svn">More information about the Pinot-svn
mailing list</a><br>
</body></html>
