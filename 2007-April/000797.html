<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Pinot-svn] r803 - in trunk: Monitor Search Search/Google Utils
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/pinot-svn/2007-April/index.html" >
   <LINK REL="made" HREF="mailto:pinot-svn%40lists.berlios.de?Subject=Re%3A%20%5BPinot-svn%5D%20r803%20-%20in%20trunk%3A%20Monitor%20Search%20Search/Google%20Utils&In-Reply-To=%3C200704091249.l39CnEAE026511%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000796.html">
   <LINK REL="Next"  HREF="000798.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Pinot-svn] r803 - in trunk: Monitor Search Search/Google Utils</H1>
    <B>fabricecolin at BerliOS</B> 
    <A HREF="mailto:pinot-svn%40lists.berlios.de?Subject=Re%3A%20%5BPinot-svn%5D%20r803%20-%20in%20trunk%3A%20Monitor%20Search%20Search/Google%20Utils&In-Reply-To=%3C200704091249.l39CnEAE026511%40sheep.berlios.de%3E"
       TITLE="[Pinot-svn] r803 - in trunk: Monitor Search Search/Google Utils">fabricecolin at mail.berlios.de
       </A><BR>
    <I>Mon Apr  9 14:49:14 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000796.html">[Pinot-svn] r802 - trunk/UI/GTK2/src
</A></li>
        <LI>Next message: <A HREF="000798.html">[Pinot-svn] r804 - trunk/SQL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#797">[ date ]</a>
              <a href="thread.html#797">[ thread ]</a>
              <a href="subject.html#797">[ subject ]</a>
              <a href="author.html#797">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: fabricecolin
Date: 2007-04-09 14:49:10 +0200 (Mon, 09 Apr 2007)
New Revision: 803

Removed:
   trunk/Utils/IndexedDocument.cpp
   trunk/Utils/IndexedDocument.h
   trunk/Utils/Result.cpp
   trunk/Utils/Result.h
Modified:
   trunk/Monitor/MonitorHandler.h
   trunk/Search/Google/GoogleAPIEngine.cpp
   trunk/Search/OpenSearchParser.cpp
   trunk/Search/OpenSearchParser.h
   trunk/Search/PluginParsers.h
   trunk/Search/PluginWebEngine.cpp
   trunk/Search/QueryProperties.h
   trunk/Search/SearchEngineInterface.cpp
   trunk/Search/SearchEngineInterface.h
   trunk/Search/SherlockParser.cpp
   trunk/Search/SherlockParser.h
   trunk/Search/WebEngine.cpp
   trunk/Search/WebEngine.h
   trunk/Search/XapianEngine.cpp
   trunk/Search/XapianEngine.h
   trunk/Search/pinot-search.cpp
   trunk/Utils/DocumentInfo.cpp
   trunk/Utils/DocumentInfo.h
   trunk/Utils/Makefile.am
Log:
Merged Result and IndexedDocument back into DocumentInfo.
In XapianEngine, generate an abstract with the terms matched by the document.


Modified: trunk/Monitor/MonitorHandler.h
===================================================================
--- trunk/Monitor/MonitorHandler.h	2007-04-04 13:32:31 UTC (rev 802)
+++ trunk/Monitor/MonitorHandler.h	2007-04-09 12:49:10 UTC (rev 803)
@@ -23,7 +23,6 @@
 #include &lt;set&gt;
 #include &lt;map&gt;
 
-#include &quot;IndexedDocument.h&quot;
 #include &quot;MonitorInterface.h&quot;
 
 /// Handles events generated by a monitor.

Modified: trunk/Search/Google/GoogleAPIEngine.cpp
===================================================================
--- trunk/Search/Google/GoogleAPIEngine.cpp	2007-04-04 13:32:31 UTC (rev 802)
+++ trunk/Search/Google/GoogleAPIEngine.cpp	2007-04-09 12:49:10 UTC (rev 803)
@@ -130,8 +130,11 @@
 		for (int i = 0; i &lt; searchResult-&gt;resultElements-&gt;__size; ++i)
 		{
 			struct gapi1__ResultElement *resultElement = searchResult-&gt;resultElements-&gt;__ptr[i];
-			Result result(resultElement-&gt;URL, resultElement-&gt;title, resultElement-&gt;snippet, &quot;&quot;, pseudoScore);
 
+			DocumentInfo result(resultElement-&gt;title, resultElement-&gt;URL, &quot;&quot;, &quot;&quot;);
+			result.setExtract(resultElement-&gt;snippet);
+			result.setScore(pseudoScore);
+
 			if (processResult(&quot;<A HREF="http://www.google.com/">http://www.google.com/</A>&quot;, result) == true)
 			{
 				m_resultsList.push_back(result);

Modified: trunk/Search/OpenSearchParser.cpp
===================================================================
--- trunk/Search/OpenSearchParser.cpp	2007-04-04 13:32:31 UTC (rev 802)
+++ trunk/Search/OpenSearchParser.cpp	2007-04-09 12:49:10 UTC (rev 803)
@@ -84,7 +84,7 @@
 {
 }
 
-bool OpenSearchResponseParser::parse(const ::Document *pResponseDoc, vector&lt;Result&gt; &amp;resultsList,
+bool OpenSearchResponseParser::parse(const ::Document *pResponseDoc, vector&lt;DocumentInfo&gt; &amp;resultsList,
 	unsigned int &amp;totalResults, unsigned int &amp;firstResultIndex) const
 {
 	float pseudoScore = 100;
@@ -259,7 +259,11 @@
 				}
 			}
 
-			resultsList.push_back(Result(url, title, extract, &quot;&quot;, pseudoScore));
+			DocumentInfo result(title, url, &quot;&quot;, &quot;&quot;);
+			result.setExtract(extract);
+			result.setScore(pseudoScore);
+
+			resultsList.push_back(result);
 			--pseudoScore;
 			foundResult = true;
 			if (resultsList.size() &gt;= totalResults)

Modified: trunk/Search/OpenSearchParser.h
===================================================================
--- trunk/Search/OpenSearchParser.h	2007-04-04 13:32:31 UTC (rev 802)
+++ trunk/Search/OpenSearchParser.h	2007-04-09 12:49:10 UTC (rev 803)
@@ -32,7 +32,7 @@
 		virtual ~OpenSearchResponseParser();
 
 		/// Parses the response; false if not all could be parsed.
-		virtual bool parse(const Document *pResponseDoc, std::vector&lt;Result&gt; &amp;resultsList,
+		virtual bool parse(const Document *pResponseDoc, std::vector&lt;DocumentInfo&gt; &amp;resultsList,
 			unsigned int &amp;totalResults, unsigned int &amp;firstResultIndex) const;
 
 	protected:

Modified: trunk/Search/PluginParsers.h
===================================================================
--- trunk/Search/PluginParsers.h	2007-04-04 13:32:31 UTC (rev 802)
+++ trunk/Search/PluginParsers.h	2007-04-09 12:49:10 UTC (rev 803)
@@ -23,7 +23,6 @@
 #include &lt;vector&gt;
 
 #include &quot;Document.h&quot;
-#include &quot;Result.h&quot;
 #include &quot;SearchPluginProperties.h&quot;
 
 /// Interface implemented by response parsers.
@@ -35,7 +34,7 @@
 		}
 
 		/// Parses the response; false if not all could be parsed.
-		virtual bool parse(const Document *pResponseDoc, std::vector&lt;Result&gt; &amp;resultsList,
+		virtual bool parse(const Document *pResponseDoc, std::vector&lt;DocumentInfo&gt; &amp;resultsList,
 			unsigned int &amp;totalResults, unsigned int &amp;firstResultIndex) const = 0;
 
 	protected:

Modified: trunk/Search/PluginWebEngine.cpp
===================================================================
--- trunk/Search/PluginWebEngine.cpp	2007-04-04 13:32:31 UTC (rev 802)
+++ trunk/Search/PluginWebEngine.cpp	2007-04-09 12:49:10 UTC (rev 803)
@@ -102,7 +102,7 @@
 
 	bool success = m_pResponseParser-&gt;parse(pResponseDoc, m_resultsList,
 		m_maxResultsCount, m_properties.m_nextBase);
-	vector&lt;Result&gt;::iterator resultIter = m_resultsList.begin();
+	vector&lt;DocumentInfo&gt;::iterator resultIter = m_resultsList.begin();
 	while (resultIter != m_resultsList.end())
 	{
 		if (processResult(formattedQuery, *resultIter) == false)
@@ -115,7 +115,7 @@
 			}
 			else
 			{
-				vector&lt;Result&gt;::iterator badResultIter = resultIter;
+				vector&lt;DocumentInfo&gt;::iterator badResultIter = resultIter;
 				--resultIter;
 				m_resultsList.erase(badResultIter);
 			}

Modified: trunk/Search/QueryProperties.h
===================================================================
--- trunk/Search/QueryProperties.h	2007-04-04 13:32:31 UTC (rev 802)
+++ trunk/Search/QueryProperties.h	2007-04-09 12:49:10 UTC (rev 803)
@@ -22,8 +22,6 @@
 #include &lt;string&gt;
 #include &lt;set&gt;
 
-#include &quot;Result.h&quot;
-
 using namespace std;
 
 /// This represents a query.

Modified: trunk/Search/SearchEngineInterface.cpp
===================================================================
--- trunk/Search/SearchEngineInterface.cpp	2007-04-04 13:32:31 UTC (rev 802)
+++ trunk/Search/SearchEngineInterface.cpp	2007-04-09 12:49:10 UTC (rev 803)
@@ -70,7 +70,7 @@
 }
 
 /// Returns the results for the previous query.
-const vector&lt;Result&gt; &amp;SearchEngineInterface::getResults(void) const
+const vector&lt;DocumentInfo&gt; &amp;SearchEngineInterface::getResults(void) const
 {
 	return m_resultsList;
 }

Modified: trunk/Search/SearchEngineInterface.h
===================================================================
--- trunk/Search/SearchEngineInterface.h	2007-04-04 13:32:31 UTC (rev 802)
+++ trunk/Search/SearchEngineInterface.h	2007-04-09 12:49:10 UTC (rev 803)
@@ -26,7 +26,7 @@
 
 #include &quot;DownloaderInterface.h&quot;
 #include &quot;QueryProperties.h&quot;
-#include &quot;Result.h&quot;
+#include &quot;DocumentInfo.h&quot;
 
 using namespace std;
 
@@ -55,7 +55,7 @@
 		virtual bool runQuery(QueryProperties&amp; queryProps) = 0;
 
 		/// Returns the results for the previous query.
-		virtual const vector&lt;Result&gt; &amp;getResults(void) const;
+		virtual const vector&lt;DocumentInfo&gt; &amp;getResults(void) const;
 
 		/// Returns the charset for the previous query's results.
 		virtual string getResultsCharset(void) const;
@@ -69,7 +69,7 @@
 		time_t m_startTime;
 		unsigned int m_maxResultsCount;
 		bool m_expandQueries;
-		vector&lt;Result&gt; m_resultsList;
+		vector&lt;DocumentInfo&gt; m_resultsList;
 		string m_charset;
 		set&lt;string&gt; m_expandTerms;
 

Modified: trunk/Search/SherlockParser.cpp
===================================================================
--- trunk/Search/SherlockParser.cpp	2007-04-04 13:32:31 UTC (rev 802)
+++ trunk/Search/SherlockParser.cpp	2007-04-09 12:49:10 UTC (rev 803)
@@ -269,7 +269,7 @@
 {
 }
 
-bool SherlockResponseParser::parse(const Document *pResponseDoc, vector&lt;Result&gt; &amp;resultsList,
+bool SherlockResponseParser::parse(const Document *pResponseDoc, vector&lt;DocumentInfo&gt; &amp;resultsList,
 	unsigned int &amp;totalResults, unsigned int &amp;firstResultIndex) const
 {
 	float pseudoScore = 100;
@@ -457,7 +457,11 @@
 				url = tmpUrl;
 			}
 
-			resultsList.push_back(Result(url, name, extract, &quot;&quot;, pseudoScore));
+			DocumentInfo result(name, url, &quot;&quot;, &quot;&quot;);
+			result.setExtract(extract);
+			result.setScore(pseudoScore);
+
+			resultsList.push_back(result);
 			--pseudoScore;
 			foundResult = true;
 			if (resultsList.size() == totalResults)

Modified: trunk/Search/SherlockParser.h
===================================================================
--- trunk/Search/SherlockParser.h	2007-04-04 13:32:31 UTC (rev 802)
+++ trunk/Search/SherlockParser.h	2007-04-09 12:49:10 UTC (rev 803)
@@ -33,7 +33,7 @@
 		virtual ~SherlockResponseParser();
 
 		/// Parses the response; false if not all could be parsed.
-		virtual bool parse(const Document *pResponseDoc, std::vector&lt;Result&gt; &amp;resultsList,
+		virtual bool parse(const Document *pResponseDoc, std::vector&lt;DocumentInfo&gt; &amp;resultsList,
 			unsigned int &amp;totalResults, unsigned int &amp;firstResultIndex) const;
 
 		std::string m_resultListStart;

Modified: trunk/Search/WebEngine.cpp
===================================================================
--- trunk/Search/WebEngine.cpp	2007-04-04 13:32:31 UTC (rev 802)
+++ trunk/Search/WebEngine.cpp	2007-04-09 12:49:10 UTC (rev 803)
@@ -126,7 +126,7 @@
 	queryProps.getTerms(m_queryTerms);
 }
 
-bool WebEngine::processResult(const string &amp;queryUrl, Result &amp;result)
+bool WebEngine::processResult(const string &amp;queryUrl, DocumentInfo &amp;result)
 {
 	Url queryUrlObj(queryUrl);
 	string resultUrl(result.getLocation());

Modified: trunk/Search/WebEngine.h
===================================================================
--- trunk/Search/WebEngine.h	2007-04-04 13:32:31 UTC (rev 802)
+++ trunk/Search/WebEngine.h	2007-04-09 12:49:10 UTC (rev 803)
@@ -50,7 +50,7 @@
 
 		void setQuery(const QueryProperties &amp;queryProps);
 
-		virtual bool processResult(const string &amp;queryUrl, Result &amp;result);
+		virtual bool processResult(const string &amp;queryUrl, DocumentInfo &amp;result);
 
 	private:
 		WebEngine(const WebEngine &amp;other);

Modified: trunk/Search/XapianEngine.cpp
===================================================================
--- trunk/Search/XapianEngine.cpp	2007-04-04 13:32:31 UTC (rev 802)
+++ trunk/Search/XapianEngine.cpp	2007-04-09 12:49:10 UTC (rev 803)
@@ -392,6 +392,9 @@
 
 	try
 	{
+		AbstractGenerator abstractGen(pIndex, 50);
+		vector&lt;string&gt; seedTerms;
+
 		// Give the query object to the enquire session
 		enquire.set_query(query);
 
@@ -399,33 +402,6 @@
 		Xapian::MSet matches = enquire.get_mset(0, m_maxResultsCount);
 		if (matches.empty() == false)
 		{
-			multimap&lt;Xapian::weight, string&gt; queryTerms;
-			vector&lt;string&gt; seedTerms;
-			Xapian::weight maxWeight = matches.get_max_attained();
-
-			// Sort query terms by weight
-			for (Xapian::TermIterator termIter = query.get_terms_begin();
-				termIter != query.get_terms_end(); ++termIter)
-			{
-				string termName(*termIter);
-				Xapian::weight termWeight = matches.get_termweight(termName);
-
-				if (termWeight &gt; 0)
-				{
-					queryTerms.insert(pair&lt;Xapian::weight, string&gt;(maxWeight - termWeight, termName));
-#ifdef DEBUG
-					cout &lt;&lt; &quot;XapianEngine::queryDatabase: term &quot; &lt;&lt; termName
-						&lt;&lt; &quot; has weight &quot; &lt;&lt; termWeight &lt;&lt; &quot;/&quot; &lt;&lt; maxWeight &lt;&lt; endl;
-#endif
-				}
-			}
-
-			for (multimap&lt;Xapian::weight, string&gt;::iterator weightIter = queryTerms.begin();
-				weightIter != queryTerms.end(); ++weightIter)
-			{
-				seedTerms.push_back(weightIter-&gt;second);
-			}
-
 			// Get the results
 #ifdef DEBUG
 			cout &lt;&lt; &quot;XapianEngine::queryDatabase: &quot; &lt;&lt; matches.get_matches_estimated()
@@ -435,11 +411,19 @@
 			{
 				Xapian::docid docId = *mIter;
 				Xapian::Document doc(mIter.get_document());
-				AbstractGenerator abstractGen(pIndex, 50);
-				// FIXME: we could use enquire.get_matching_terms_begin(docId) to populate seedTerms
-				Result thisResult(&quot;&quot;, &quot;&quot;, abstractGen.generateAbstract(docId, seedTerms),
-					&quot;&quot;, (float)mIter.get_percent());
 
+				// What terms did this document match ?
+				seedTerms.clear();
+				for (Xapian::TermIterator termIter = enquire.get_matching_terms_begin(docId);
+					termIter != enquire.get_matching_terms_end(docId); ++termIter)
+				{
+					seedTerms.push_back(*termIter);
+				}
+
+				DocumentInfo thisResult;
+				thisResult.setExtract(abstractGen.generateAbstract(docId, seedTerms));
+				thisResult.setScore((float)mIter.get_percent());
+
 #ifdef DEBUG
 				cout &lt;&lt; &quot;XapianEngine::queryDatabase: found document ID &quot; &lt;&lt; docId &lt;&lt; endl;
 #endif
@@ -615,10 +599,3 @@
 
 	return false;
 }
-
-/// Returns the results for the previous query.
-const vector&lt;Result&gt; &amp;XapianEngine::getResults(void) const
-{
-	return m_resultsList;
-}
-

Modified: trunk/Search/XapianEngine.h
===================================================================
--- trunk/Search/XapianEngine.h	2007-04-04 13:32:31 UTC (rev 802)
+++ trunk/Search/XapianEngine.h	2007-04-09 12:49:10 UTC (rev 803)
@@ -45,9 +45,6 @@
 		/// Runs a query; true if success.
 		virtual bool runQuery(QueryProperties&amp; queryProps);
 
-		/// Returns the results for the previous query.
-		virtual const std::vector&lt;Result&gt; &amp;getResults(void) const;
-
 	protected:
 		std::string m_databaseName;
 		std::set&lt;unsigned int&gt; m_relevantDocuments;

Modified: trunk/Search/pinot-search.cpp
===================================================================
--- trunk/Search/pinot-search.cpp	2007-04-04 13:32:31 UTC (rev 802)
+++ trunk/Search/pinot-search.cpp	2007-04-09 12:49:10 UTC (rev 803)
@@ -177,14 +177,14 @@
 		string resultsPage;
 
 		// Try getting a list of links
-		const vector&lt;Result&gt; resultsList = pEngine-&gt;getResults();
+		const vector&lt;DocumentInfo&gt; resultsList = pEngine-&gt;getResults();
 		if (resultsList.empty() == false)
 		{
 			unsigned int count = 0;
 
 			cout &lt;&lt; &quot;Matching documents are :&quot; &lt;&lt; endl;
 
-			vector&lt;Result&gt;::const_iterator resultIter = resultsList.begin();
+			vector&lt;DocumentInfo&gt;::const_iterator resultIter = resultsList.begin();
 			while (resultIter != resultsList.end())
 			{
 				string rawUrl(resultIter-&gt;getLocation());

Modified: trunk/Utils/DocumentInfo.cpp
===================================================================
--- trunk/Utils/DocumentInfo.cpp	2007-04-04 13:32:31 UTC (rev 802)
+++ trunk/Utils/DocumentInfo.cpp	2007-04-09 12:49:10 UTC (rev 803)
@@ -21,35 +21,40 @@
 #include &quot;DocumentInfo.h&quot;
 
 using std::string;
+using std::map;
 using std::set;
 using std::copy;
 using std::inserter;
 
 DocumentInfo::DocumentInfo() :
-	m_size(0)
+	m_score(0.0),
+	m_indexId(0),
+	m_docId(0)
 {
-	m_timestamp = TimeConverter::toTimestamp(time(NULL));
+	setField(&quot;modtime&quot;, TimeConverter::toTimestamp(time(NULL)));
 }
 
 DocumentInfo::DocumentInfo(const string &amp;title, const string &amp;location,
 	const string &amp;type, const string &amp;language) :
-	m_title(title),
-	m_location(location),
-	m_type(type),
-	m_language(language),
-	m_size(0)
+	m_score(0.0),
+	m_indexId(0),
+	m_docId(0)
 {
-	m_timestamp = TimeConverter::toTimestamp(time(NULL));
+	setField(&quot;caption&quot;, title);
+	setField(&quot;url&quot;, location);
+	setField(&quot;type&quot;, type);
+	setField(&quot;language&quot;, language);
+	setField(&quot;modtime&quot;, TimeConverter::toTimestamp(time(NULL)));
 }
 
 DocumentInfo::DocumentInfo(const DocumentInfo &amp;other) :
-	m_title(other.m_title),
-	m_location(other.m_location),
-	m_type(other.m_type),
-	m_language(other.m_language),
-	m_timestamp(other.m_timestamp),
-	m_size(other.m_size)
+	m_extract(other.m_extract),
+	m_score(other.m_score),
+	m_indexId(other.m_indexId),
+	m_docId(other.m_docId)
 {
+	copy(other.m_fields.begin(), other.m_fields.end(),
+		inserter(m_fields, m_fields.begin()));
 	copy(other.m_labels.begin(), other.m_labels.end(),
 		inserter(m_labels, m_labels.begin()));
 }
@@ -62,15 +67,16 @@
 {
 	if (this != &amp;other)
 	{
-		m_title = other.m_title;
-		m_location = other.m_location;
-		m_type = other.m_type;
-		m_language = other.m_language;
-		m_timestamp = other.m_timestamp;
-		m_size = other.m_size;
+		m_fields.clear();
+		copy(other.m_fields.begin(), other.m_fields.end(),
+			inserter(m_fields, m_fields.begin()));
+		m_extract = other.m_extract;
+		m_score = other.m_score;
 		m_labels.clear();
 		copy(other.m_labels.begin(), other.m_labels.end(),
 			inserter(m_labels, m_labels.begin()));
+		m_indexId = other.m_indexId;
+		m_docId = other.m_docId;
 	}
 
 	return *this;
@@ -78,7 +84,7 @@
 
 bool DocumentInfo::operator&lt;(const DocumentInfo&amp; other) const
 {
-	if (m_location &lt; other.m_location)
+	if (getField(&quot;url&quot;) &lt; other.getField(&quot;url&quot;))
 	{
 		return true;
 	}
@@ -89,75 +95,109 @@
 /// Sets the title of the document.
 void DocumentInfo::setTitle(const string &amp;title)
 {
-	m_title = title;
+	setField(&quot;caption&quot;, title);
 }
 
 /// Returns the title of the document.
 string DocumentInfo::getTitle(void) const
 {
-	return m_title;
+	return getField(&quot;caption&quot;);
 }
 
 /// Sets the original location of the document.
 void DocumentInfo::setLocation(const string &amp;location)
 {
-	m_location = location;
+	setField(&quot;url&quot;, location);
 }
 
 /// Returns the original location of the document.
 string DocumentInfo::getLocation(void) const
 {
-	return m_location;
+	return getField(&quot;url&quot;);
 }
 
 /// Sets the type of the document.
 void DocumentInfo::setType(const string &amp;type)
 {
-	m_type = type;
+	setField(&quot;type&quot;, type);
 }
 
 /// Returns the type of the document.
 string DocumentInfo::getType(void) const
 {
-	return m_type;
+	return getField(&quot;type&quot;);
 }
 
 /// Sets the language of the document.
 void DocumentInfo::setLanguage(const string &amp;language)
 {
-	m_language = language;
+	setField(&quot;language&quot;, language);
 }
 
 /// Returns the document's language.
 string DocumentInfo::getLanguage(void) const
 {
-	return m_language;
+	return getField(&quot;language&quot;);
 }
 
 /// Sets the document's timestamp.
 void DocumentInfo::setTimestamp(const string &amp;timestamp)
 {
-	m_timestamp = timestamp;
+	setField(&quot;modtime&quot;, timestamp);
 }
 
 /// Returns the document's timestamp.
 string DocumentInfo::getTimestamp(void) const
 {
-	return m_timestamp;
+	return getField(&quot;modtime&quot;);
 }
 
 /// Sets the document's size in bytes.
 void DocumentInfo::setSize(off_t size)
 {
-	m_size = size;
+	char sizeStr[64];
+
+	snprintf(sizeStr, 64, &quot;%u&quot;, size);
+	setField(&quot;size&quot;, sizeStr);
 }
 
 /// Returns the document's size in bytes.
 off_t DocumentInfo::getSize(void) const
 {
-	return m_size;
+	string sizeStr(getField(&quot;size&quot;));
+
+	if (sizeStr.empty() == true)
+	{
+		return 0;
+	}
+
+	return (off_t)atoi(sizeStr.c_str());
 }
 
+/// Sets the document's extract.
+void DocumentInfo::setExtract(const string &amp;extract)
+{
+	m_extract = extract;
+}
+
+/// Returns the document's extract.
+string DocumentInfo::getExtract(void) const
+{
+	return m_extract;
+}
+
+/// Sets the document's score.
+void DocumentInfo::setScore(float score)
+{
+	m_score = score;
+}
+
+/// Returns the document's score.
+float DocumentInfo::getScore(void) const
+{
+	return m_score;
+}
+
 /// Sets the document's labels.
 void DocumentInfo::setLabels(const set&lt;string&gt; &amp;labels)
 {
@@ -171,3 +211,52 @@
 	return m_labels;
 }
 
+/// Sets that the document is indexed.
+void DocumentInfo::setIsIndexed(unsigned int indexId, unsigned int docId)
+{
+	m_indexId = indexId;
+	m_docId = docId;
+}
+
+/// Sets that the document is not indexed.
+void DocumentInfo::setIsNotIndexed(void)
+{
+	m_indexId = 0;
+	m_docId = 0;
+}
+
+/// Gets whether the document is indexed.
+bool DocumentInfo::getIsIndexed(void) const
+{
+	if (m_docId &gt; 0)
+	{
+		return true;
+	}
+
+	return false;
+}
+
+/// Gets whether the documentt is indexed.
+unsigned int DocumentInfo::getIsIndexed(unsigned int &amp;indexId) const
+{
+	indexId = m_indexId;
+
+	return m_docId;
+}
+
+void DocumentInfo::setField(const string &amp;name, const string &amp;value)
+{
+	m_fields[name] = value;
+}
+
+string DocumentInfo::getField(const string &amp;name) const
+{
+	map&lt;string, string&gt;::const_iterator fieldIter = m_fields.find(name);
+	if (fieldIter != m_fields.end())
+	{
+		return fieldIter-&gt;second;
+	}
+
+	return &quot;&quot;;
+}
+

Modified: trunk/Utils/DocumentInfo.h
===================================================================
--- trunk/Utils/DocumentInfo.h	2007-04-04 13:32:31 UTC (rev 802)
+++ trunk/Utils/DocumentInfo.h	2007-04-09 12:49:10 UTC (rev 803)
@@ -21,6 +21,7 @@
 
 #include &lt;sys/types.h&gt;
 #include &lt;string&gt;
+#include &lt;map&gt;
 #include &lt;set&gt;
 
 /// This represents all the properties of a document.
@@ -73,21 +74,48 @@
 		/// Returns the document's size in bytes.
 		virtual off_t getSize(void) const;
 
+		/// Sets the document's extract.
+		virtual void setExtract(const std::string &amp;extract);
+
+		/// Returns the document's extract.
+		virtual std::string getExtract(void) const;
+
+		/// Sets the document's score.
+		void setScore(float score);
+
+		/// Returns the document's score.
+		float getScore(void) const;
+
 		/// Sets the document's labels.
 		virtual void setLabels(const std::set&lt;std::string&gt; &amp;labels);
 
 		/// Returns the document's labels.
 		virtual const std::set&lt;std::string&gt; &amp;getLabels(void) const;
 
+		/// Sets that the document is indexed.
+		void setIsIndexed(unsigned int indexId, unsigned int docId);
+
+		/// Sets that the document is not indexed.
+		void setIsNotIndexed(void);
+
+		/// Gets whether the document is indexed.
+		bool getIsIndexed(void) const;
+
+		/// Gets whether the document is indexed.
+		unsigned int getIsIndexed(unsigned int &amp;indexId) const;
+
 	protected:
-		std::string m_title;
-		std::string m_location;
-		std::string m_type;
-		std::string m_language;
-		std::string m_timestamp;
-		off_t m_size;
+		std::map&lt;std::string, std::string&gt; m_fields;
+		std::string m_extract;
+		float m_score;
 		std::set&lt;std::string&gt; m_labels;
+		unsigned int m_indexId;
+		unsigned int m_docId;
 
+		void setField(const std::string &amp;name, const std::string &amp;value);
+
+		std::string getField(const std::string &amp;name) const;
+
 };
 
 #endif // _DOCUMENT_INFO_H

Deleted: trunk/Utils/IndexedDocument.cpp
===================================================================
--- trunk/Utils/IndexedDocument.cpp	2007-04-04 13:32:31 UTC (rev 802)
+++ trunk/Utils/IndexedDocument.cpp	2007-04-09 12:49:10 UTC (rev 803)
@@ -1,83 +0,0 @@
-/*
- *  Copyright 2005,2006 Fabrice Colin
- *
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU Library General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
- */
-
-#include &quot;Url.h&quot;
-#include &quot;IndexedDocument.h&quot;
-
-using std::string;
-
-IndexedDocument::IndexedDocument(const string &amp;title, const string &amp;location,
-	const string &amp;originalLocation, const string &amp;type, const string &amp;language) :
-	Document(title, location, type, language),
-	m_originalLocation(originalLocation)
-{
-}
-
-IndexedDocument::IndexedDocument(const IndexedDocument &amp;other) :
-	Document(other),
-	m_originalLocation(other.m_originalLocation)
-{
-}
-
-IndexedDocument::~IndexedDocument()
-{
-}
-
-IndexedDocument&amp; IndexedDocument::operator=(const IndexedDocument&amp; other)
-{
-	if (this != &amp;other)
-	{
-		Document::operator=(other);
-		m_originalLocation = other.m_originalLocation;
-	}
-
-	return *this;
-}
-
-/// Returns the document ID.
-unsigned int IndexedDocument::getID(void) const
-{
-	unsigned int docId = 0;
-
-	// Double-check the URL
-	Url urlObj(m_location);
-	if ((urlObj.getProtocol() == &quot;xapian&quot;) ||
-		(urlObj.getFile() != &quot;&quot;))
-	{
-		// The document ID is the final part of the URL, ie the file
-		int val = atoi(urlObj.getFile().c_str());
-		if (val &gt; 0)
-		{
-			docId = (unsigned int)val;
-		}
-	}
-
-	return docId;
-}
-
-/// Sets the original location of the document.
-void IndexedDocument::setOriginalLocation(const string &amp;originalLocation)
-{
-	m_originalLocation = originalLocation;
-}
-
-/// Returns the original location of the document.
-string IndexedDocument::getOriginalLocation(void) const
-{
-	return m_originalLocation;
-}

Deleted: trunk/Utils/IndexedDocument.h
===================================================================
--- trunk/Utils/IndexedDocument.h	2007-04-04 13:32:31 UTC (rev 802)
+++ trunk/Utils/IndexedDocument.h	2007-04-09 12:49:10 UTC (rev 803)
@@ -1,52 +0,0 @@
-/*
- *  Copyright 2005,2006 Fabrice Colin
- *
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU Library General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
- */
-
-#ifndef _INDEXED_DOCUMENT_H
-#define _INDEXED_DOCUMENT_H
-
-#include &lt;string&gt;
-
-#include &quot;Document.h&quot;
-
-/// An entry in the index.
-class IndexedDocument : public Document
-{
-	public:
-		IndexedDocument(const std::string &amp;title, const std::string &amp;location,
-			const std::string &amp;originalLocation, const std::string &amp;type,
-			const std::string &amp;language);
-		IndexedDocument(const IndexedDocument &amp;other);
-		virtual ~IndexedDocument();
-
-		IndexedDocument&amp; operator=(const IndexedDocument&amp; other);
-
-		/// Returns the document ID.
-		virtual unsigned int getID(void) const;
-
-		/// Sets the original location of the document.
-		virtual void setOriginalLocation(const std::string &amp;originalLocation);
-
-		/// Returns the original location of the document.
-		virtual std::string getOriginalLocation(void) const;
-
-	protected:
-		std::string m_originalLocation;
-
-};
-	
-#endif // _INDEXED_DOCUMENT_H

Modified: trunk/Utils/Makefile.am
===================================================================
--- trunk/Utils/Makefile.am	2007-04-04 13:32:31 UTC (rev 802)
+++ trunk/Utils/Makefile.am	2007-04-09 12:49:10 UTC (rev 803)
@@ -4,11 +4,9 @@
 	CommandLine.h \
 	Document.h \
 	DocumentInfo.h \
-	IndexedDocument.h \
 	Languages.h \
 	MIMEScanner.h \
 	NLS.h \
-	Result.h \
 	StringManip.h \
 	TimeConverter.h \
 	Timer.h \
@@ -32,10 +30,8 @@
 	Url.cpp
 
 libUtils_la_SOURCES = \
-	IndexedDocument.cpp \
 	Languages.cpp \
 	MIMEScanner.cpp \
-	Result.cpp \
 	Timer.cpp \
 	xdgmime/xdgmimealias.c \
 	xdgmime/xdgmime.c \

Deleted: trunk/Utils/Result.cpp
===================================================================
--- trunk/Utils/Result.cpp	2007-04-04 13:32:31 UTC (rev 802)
+++ trunk/Utils/Result.cpp	2007-04-09 12:49:10 UTC (rev 803)
@@ -1,124 +0,0 @@
-/*
- *  Copyright 2005,2006 Fabrice Colin
- *
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU Library General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
- */
-
-#include &quot;Result.h&quot;
-
-using std::string;
-
-Result::Result(const string &amp;location, const string &amp;title, const string &amp;extract,
-	const string &amp;language, float percentageScore) :
-	DocumentInfo(title, location, &quot;&quot;, language),
-	m_extract(extract),
-	m_score(percentageScore),
-	m_indexId(0),
-	m_docId(0)
-{
-}
-
-Result::Result(const Result &amp;other) :
-	DocumentInfo(other),
-	m_extract(other.m_extract),
-	m_score(other.m_score),
-	m_indexId(other.m_indexId),
-	m_docId(other.m_docId)
-{
-}
-
-Result::~Result()
-{
-}
-
-Result &amp;Result::operator=(const Result &amp;other)
-{
-	if (this != &amp;other)
-	{
-		DocumentInfo::operator=(other);
-		m_extract = other.m_extract;
-		m_score = other.m_score;
-		m_indexId = other.m_indexId;
-		m_docId = other.m_docId;
-	}
-
-	return *this;
-}
-
-bool Result::operator&lt;(const Result&amp; other) const
-{
-	if (DocumentInfo::operator&lt;(other) == false)
-	{
-		if (m_score &lt; other.m_score)
-		{
-			return true;
-		}
-
-		return false;
-	}
-
-	return true;
-}
-
-/// Sets the result extract.
-void Result::setExtract(const string &amp;extract)
-{
-	m_extract = extract;
-}
-
-/// Gets the result extract.
-string Result::getExtract(void) const
-{
-	return m_extract;
-}
-
-/// Gets the result score.
-float Result::getScore(void) const
-{
-	return m_score;
-}
-
-/// Sets that the result is indexed.
-void Result::setIsIndexed(unsigned int indexId, unsigned int docId)
-{
-	m_indexId = indexId;
-	m_docId = docId;
-}
-
-/// Sets that the result is not indexed.
-void Result::setIsNotIndexed(void)
-{
-	m_indexId = 0;
-	m_docId = 0;
-}
-
-/// Gets whether the result is indexed.
-bool Result::getIsIndexed(void) const
-{
-	if (m_docId &gt; 0)
-	{
-		return true;
-	}
-
-	return false;
-}
-
-/// Gets whether the result is indexed.
-unsigned int Result::getIsIndexed(unsigned int &amp;indexId) const
-{
-	indexId = m_indexId;
-
-	return m_docId;
-}

Deleted: trunk/Utils/Result.h
===================================================================
--- trunk/Utils/Result.h	2007-04-04 13:32:31 UTC (rev 802)
+++ trunk/Utils/Result.h	2007-04-09 12:49:10 UTC (rev 803)
@@ -1,69 +0,0 @@
-/*
- *  Copyright 2005,2006 Fabrice Colin
- *
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU Library General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
- */
-
-#ifndef _RESULT_H
-#define _RESULT_H
-
-#include &lt;string&gt;
-
-#include &quot;DocumentInfo.h&quot;
-
-/// A document returned by a search engine.
-class Result : public DocumentInfo
-{
-	public:
-		Result(const std::string &amp;location, const std::string &amp;title,
-			const std::string &amp;extract, const std::string &amp;language,
-			float percentageScore = 0.0);
-		Result(const Result &amp;other);
-		virtual ~Result();
-
-		Result &amp;operator=(const Result &amp;other);
-
-		bool operator&lt;(const Result&amp; other) const;
-
-		/// Sets the result extract.
-		void setExtract(const std::string &amp;extract);
-
-		/// Gets the result extract.
-		std::string getExtract(void) const;
-
-		/// Gets the result score.
-		float getScore(void) const;
-
-		/// Sets that the result is indexed.
-		void setIsIndexed(unsigned int indexId, unsigned int docId);
-
-		/// Sets that the result is not indexed.
-		void setIsNotIndexed(void);
-
-		/// Gets whether the result is indexed.
-		bool getIsIndexed(void) const;
-
-		/// Gets whether the result is indexed.
-		unsigned int getIsIndexed(unsigned int &amp;indexId) const;
-
-	protected:
-		std::string m_extract;
-		float m_score;
-		unsigned int m_indexId;
-		unsigned int m_docId;
-
-};
-
-#endif // _RESULT_H


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000796.html">[Pinot-svn] r802 - trunk/UI/GTK2/src
</A></li>
	<LI>Next message: <A HREF="000798.html">[Pinot-svn] r804 - trunk/SQL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#797">[ date ]</a>
              <a href="thread.html#797">[ thread ]</a>
              <a href="subject.html#797">[ subject ]</a>
              <a href="author.html#797">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/pinot-svn">More information about the Pinot-svn
mailing list</a><br>
</body></html>
