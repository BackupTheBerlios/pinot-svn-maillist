<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Pinot-svn] r1537 - in trunk: . Core IndexSearch
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/pinot-svn/2009-February/index.html" >
   <LINK REL="made" HREF="mailto:pinot-svn%40lists.berlios.de?Subject=Re%3A%20%5BPinot-svn%5D%20r1537%20-%20in%20trunk%3A%20.%20Core%20IndexSearch&In-Reply-To=%3C200902021344.n12DiLBR019106%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001526.html">
   <LINK REL="Next"  HREF="001528.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Pinot-svn] r1537 - in trunk: . Core IndexSearch</H1>
    <B>fabricecolin at mail.berlios.de</B> 
    <A HREF="mailto:pinot-svn%40lists.berlios.de?Subject=Re%3A%20%5BPinot-svn%5D%20r1537%20-%20in%20trunk%3A%20.%20Core%20IndexSearch&In-Reply-To=%3C200902021344.n12DiLBR019106%40sheep.berlios.de%3E"
       TITLE="[Pinot-svn] r1537 - in trunk: . Core IndexSearch">fabricecolin at mail.berlios.de
       </A><BR>
    <I>Mon Feb  2 14:44:21 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="001526.html">[Pinot-svn] r1536 - in trunk: . Core
</A></li>
        <LI>Next message: <A HREF="001528.html">[Pinot-svn] r1538 - in trunk: Core IndexSearch UI/GTK2/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1527">[ date ]</a>
              <a href="thread.html#1527">[ thread ]</a>
              <a href="subject.html#1527">[ subject ]</a>
              <a href="author.html#1527">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: fabricecolin
Date: 2009-02-02 14:44:00 +0100 (Mon, 02 Feb 2009)
New Revision: 1537

Added:
   trunk/Core/pinot-index.1
   trunk/Core/pinot-index.cpp
Removed:
   trunk/IndexSearch/pinot-index.1
   trunk/IndexSearch/pinot-index.cpp
Modified:
   trunk/Core/Makefile.am
   trunk/IndexSearch/Makefile.am
   trunk/Makefile.am
Log:
Moved pinot-index to Core. Use PinotSettings for proxy parameters.
The -d/--db option may be the name of an index.


Modified: trunk/Core/Makefile.am
===================================================================
--- trunk/Core/Makefile.am	2009-02-01 14:28:52 UTC (rev 1536)
+++ trunk/Core/Makefile.am	2009-02-02 13:44:00 UTC (rev 1537)
@@ -19,9 +19,9 @@
 	WorkerThreads.cpp
 
 if HAVE_DBUS
-bin_PROGRAMS = pinot-search pinot-dbus-daemon
+bin_PROGRAMS = pinot-index pinot-search pinot-dbus-daemon
 else
-bin_PROGRAMS = pinot-search
+bin_PROGRAMS = pinot-index pinot-search
 endif
 
 AM_CXXFLAGS = \
@@ -40,6 +40,22 @@
 AM_CXXFLAGS += -DHAVE_DBUS
 endif
 
+pinot_index_LDFLAGS = \
+	-rdynamic
+
+pinot_index_LDADD = \
+	-L$(top_builddir)/Utils \
+	-L$(top_builddir)/Tokenize \
+	-L$(top_builddir)/Collect \
+	-L$(top_builddir)/IndexSearch \
+	-lCore -lIndexSearch -lCollect -lTokenize -lUtils -lBasicUtils \
+	@GLIBMM_LIBS@ @DBUS_LIBS@ \
+	@XML_LIBS@ @HTTP_LIBS@ @MISC_LIBS@
+
+pinot_index_SOURCES = pinot-index.cpp
+
+pinot_index_DEPENDENCIES = libCore.la
+
 pinot_search_LDFLAGS = \
 	-rdynamic
 

Copied: trunk/Core/pinot-index.1 (from rev 1536, trunk/IndexSearch/pinot-index.1)
===================================================================
--- trunk/IndexSearch/pinot-index.1	2009-02-01 14:28:52 UTC (rev 1536)
+++ trunk/Core/pinot-index.1	2009-02-02 13:44:00 UTC (rev 1537)
@@ -0,0 +1,43 @@
+.\&quot; DO NOT MODIFY THIS FILE!  It was generated by help2man 1.36.
+.TH PINOT-INDEX &quot;1&quot; &quot;February 2009&quot; &quot;pinot-index - pinot 0.90&quot; &quot;User Commands&quot;
+.SH NAME
+pinot-index \- Index documents from the command-line
+.SH SYNOPSIS
+.B pinot-index
+[\fIOPTIONS\fR] \fIURLS\fR
+.SH DESCRIPTION
+pinot\-index \- Index documents from the command\-line
+.SH OPTIONS
+.TP
+\fB\-b\fR, \fB\-\-backend\fR
+name of back\-end to use (default xapian)
+.TP
+\fB\-c\fR, \fB\-\-check\fR
+check whether the given URL is in the index
+.TP
+\fB\-d\fR, \fB\-\-db\fR
+path to, or name of, index to use (mandatory)
+.TP
+\fB\-h\fR, \fB\-\-help\fR
+display this help and exit
+.TP
+\fB\-i\fR, \fB\-\-index\fR
+index the given URL
+.TP
+\fB\-s\fR, \fB\-\-showinfo\fR
+show information about the document
+.TP
+\fB\-v\fR, \fB\-\-version\fR
+output version information and exit
+.PP
+Supported back\-ends are : 'xapian'
+.SH EXAMPLES
+pinot\-index \fB\-\-check\fR \fB\-\-showinfo\fR \fB\-\-backend\fR xapian \fB\-\-db\fR ~/.pinot/daemon <A HREF="file:///home/fabrice/Documents/Bozo.txt">file:///home/fabrice/Documents/Bozo.txt</A>
+.PP
+pinot\-index \fB\-\-index\fR \fB\-\-db\fR &quot;My Web Pages&quot; <A HREF="http://pinot.berlios.de/">http://pinot.berlios.de/</A>
+.SH &quot;REPORTING BUGS&quot;
+Report bugs to <A HREF="https://lists.berlios.de/mailman/listinfo/pinot-svn">fabricecolin at users.berlios.de</A>
+.PP
+This is free software.  You may redistribute copies of it under the terms of
+the GNU General Public License &lt;<A HREF="http://www.gnu.org/licenses/old\-licenses/gpl\-2.0.html">http://www.gnu.org/licenses/old\-licenses/gpl\-2.0.html</A>&gt;.
+There is NO WARRANTY, to the extent permitted by law.


Property changes on: trunk/Core/pinot-index.1
___________________________________________________________________
Name: svn:mergeinfo
   + 

Copied: trunk/Core/pinot-index.cpp (from rev 1536, trunk/IndexSearch/pinot-index.cpp)
===================================================================
--- trunk/IndexSearch/pinot-index.cpp	2009-02-01 14:28:52 UTC (rev 1536)
+++ trunk/Core/pinot-index.cpp	2009-02-02 13:44:00 UTC (rev 1537)
@@ -0,0 +1,373 @@
+/*
+ *  Copyright 2005-2009 Fabrice Colin
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+ */
+ 
+#include &lt;getopt.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;stdio.h&gt;
+#include &lt;iostream&gt;
+#include &lt;string&gt;
+#include &lt;fstream&gt;
+
+#include &quot;config.h&quot;
+#include &quot;NLS.h&quot;
+#include &quot;Languages.h&quot;
+#include &quot;MIMEScanner.h&quot;
+#include &quot;Url.h&quot;
+#include &quot;FilterFactory.h&quot;
+#include &quot;DownloaderFactory.h&quot;
+#include &quot;FilterWrapper.h&quot;
+#include &quot;ModuleFactory.h&quot;
+#include &quot;PinotSettings.h&quot;
+
+using namespace std;
+
+static struct option g_longOptions[] = {
+	{&quot;backend&quot;, 1, 0, 'b'},
+	{&quot;check&quot;, 0, 0, 'c'},
+	{&quot;db&quot;, 1, 0, 'd'},
+	{&quot;help&quot;, 0, 0, 'h'},
+	{&quot;index&quot;, 0, 0, 'i'},
+	{&quot;showinfo&quot;, 0, 0, 's'},
+	{&quot;version&quot;, 0, 0, 'v'},
+	{0, 0, 0, 0}
+};
+
+static void printHelp(void)
+{
+	map&lt;ModuleProperties, bool&gt; engines;
+
+	// Help
+	ModuleFactory::loadModules(string(LIBDIR) + string(&quot;/pinot/backends&quot;));
+	ModuleFactory::getSupportedEngines(engines);
+	cout &lt;&lt; &quot;pinot-index - Index documents from the command-line\n\n&quot;
+		&lt;&lt; &quot;Usage: pinot-index [OPTIONS] URLS\n\n&quot;
+		&lt;&lt; &quot;Options:\n&quot;
+		&lt;&lt; &quot;  -b, --backend             name of back-end to use (default &quot; &lt;&lt; PinotSettings::getInstance().m_defaultBackend &lt;&lt; &quot;)\n&quot;
+		&lt;&lt; &quot;  -c, --check               check whether the given URL is in the index\n&quot;
+		&lt;&lt; &quot;  -d, --db                  path to, or name of, index to use (mandatory)\n&quot;
+		&lt;&lt; &quot;  -h, --help                display this help and exit\n&quot;
+		&lt;&lt; &quot;  -i, --index               index the given URL\n&quot;
+		&lt;&lt; &quot;  -s, --showinfo            show information about the document\n&quot;
+		&lt;&lt; &quot;  -v, --version             output version information and exit\n\n&quot;
+		&lt;&lt; &quot;Supported back-ends are :&quot;;
+	for (map&lt;ModuleProperties, bool&gt;::const_iterator engineIter = engines.begin(); engineIter != engines.end(); ++engineIter)
+	{
+		if ((engineIter-&gt;second == true) &amp;&amp;
+			(ModuleFactory::isSupported(engineIter-&gt;first.m_name, true) == true))
+		{
+			cout &lt;&lt; &quot; '&quot; &lt;&lt; engineIter-&gt;first.m_name &lt;&lt; &quot;'&quot;;
+		}
+	}
+	ModuleFactory::unloadModules();
+	cout &lt;&lt; &quot;\n\nExamples:\n&quot;
+		&lt;&lt; &quot;pinot-index --check --showinfo --backend xapian --db ~/.pinot/daemon <A HREF="file:///home/fabrice/Documents/Bozo.txt\n\n">file:///home/fabrice/Documents/Bozo.txt\n\n</A>&quot;
+		&lt;&lt; &quot;pinot-index --index --db \&quot;My Web Pages\&quot; <A HREF="http://pinot.berlios.de/\n\n">http://pinot.berlios.de/\n\n</A>&quot;
+		&lt;&lt; &quot;Report bugs to &quot; &lt;&lt; PACKAGE_BUGREPORT &lt;&lt; endl;
+}
+
+static void closeAll(void)
+{
+	// Close everything
+	ModuleFactory::unloadModules();
+	Dijon::FilterFactory::unloadFilters();
+	Dijon::HtmlFilter::shutdown();
+	DownloaderInterface::shutdown();
+	MIMEScanner::shutdown();
+}
+
+int main(int argc, char **argv)
+{
+	string type, option;
+	string backendType, databaseName;
+	int longOptionIndex = 0;
+	unsigned int docId = 0;
+	bool checkDocument = false, indexDocument = false, showInfo = false, success = false;
+
+	// Look at the options
+	int optionChar = getopt_long(argc, argv, &quot;b:cd:hisv&quot;, g_longOptions, &amp;longOptionIndex);
+	while (optionChar != -1)
+	{
+		set&lt;string&gt; engines;
+
+		switch (optionChar)
+		{
+			case 'b':
+				if (optarg != NULL)
+				{
+					backendType = optarg;
+				}
+				break;
+			case 'c':
+				checkDocument = true;
+				break;
+			case 'd':
+				if (optarg != NULL)
+				{
+					databaseName = optarg;
+				}
+				break;
+			case 'h':
+				printHelp();
+				return EXIT_SUCCESS;
+			case 'i':
+				indexDocument = true;
+				break;
+			case 's':
+				showInfo = true;
+				break;
+			case 'v':
+				cout &lt;&lt; &quot;pinot-index - &quot; &lt;&lt; PACKAGE_STRING &lt;&lt; &quot;\n\n&quot;
+					&lt;&lt; &quot;This is free software.  You may redistribute copies of it under the terms of\n&quot;
+					&lt;&lt; &quot;the GNU General Public License &lt;<A HREF="http://www.gnu.org/licenses/old-licenses/gpl-2.0.html">http://www.gnu.org/licenses/old-licenses/gpl-2.0.html</A>&gt;.\n&quot;
+					&lt;&lt; &quot;There is NO WARRANTY, to the extent permitted by law.&quot; &lt;&lt; endl;
+				return EXIT_SUCCESS;
+			default:
+				return EXIT_FAILURE;
+		}
+
+		// Next option
+		optionChar = getopt_long(argc, argv, &quot;b:cd:hisv&quot;, g_longOptions, &amp;longOptionIndex);
+	}
+
+	if (argc == 1)
+	{
+		printHelp();
+		return EXIT_SUCCESS;
+	}
+
+	if ((argc &lt; 2) ||
+		(argc - optind == 0))
+	{
+		cerr &lt;&lt; &quot;Not enough parameters&quot; &lt;&lt; endl;
+		return EXIT_FAILURE;
+	}
+
+	if (((indexDocument == false) &amp;&amp;
+		(checkDocument == false)) ||
+		(databaseName.empty() == true))
+	{
+		cerr &lt;&lt; &quot;Incorrect parameters&quot; &lt;&lt; endl;
+		return EXIT_FAILURE;
+	}
+
+	// This will create the necessary directories on the first run
+	PinotSettings &amp;settings = PinotSettings::getInstance();
+	string confDirectory(PinotSettings::getConfigurationDirectory());
+
+	if (MIMEScanner::initialize(PinotSettings::getHomeDirectory() + &quot;/.local&quot;,
+		string(SHARED_MIME_INFO_PREFIX)) == false)
+	{
+		cerr &lt;&lt; &quot;Couldn't load MIME settings&quot; &lt;&lt; endl;
+	}
+	DownloaderInterface::initialize();
+	Dijon::HtmlFilter::initialize();
+	Dijon::FilterFactory::loadFilters(string(LIBDIR) + string(&quot;/pinot/filters&quot;));
+	ModuleFactory::loadModules(string(LIBDIR) + string(&quot;/pinot/backends&quot;));
+	ModuleFactory::loadModules(confDirectory + &quot;/backends&quot;);
+
+	// Localize language names
+	Languages::setIntlName(0, _(&quot;Unknown&quot;));
+	Languages::setIntlName(1, _(&quot;Danish&quot;));
+	Languages::setIntlName(2, _(&quot;Dutch&quot;));
+	Languages::setIntlName(3, _(&quot;English&quot;));
+	Languages::setIntlName(4, _(&quot;Finnish&quot;));
+	Languages::setIntlName(5, _(&quot;French&quot;));
+	Languages::setIntlName(6, _(&quot;German&quot;));
+	Languages::setIntlName(7, _(&quot;Hungarian&quot;));
+	Languages::setIntlName(8, _(&quot;Italian&quot;));
+	Languages::setIntlName(9, _(&quot;Norwegian&quot;));
+	Languages::setIntlName(10, _(&quot;Portuguese&quot;));
+	Languages::setIntlName(11, _(&quot;Romanian&quot;));
+	Languages::setIntlName(12, _(&quot;Russian&quot;));
+	Languages::setIntlName(13, _(&quot;Spanish&quot;));
+	Languages::setIntlName(14, _(&quot;Swedish&quot;));
+	Languages::setIntlName(15, _(&quot;Turkish&quot;));
+
+	// Load the settings
+	settings.load(PinotSettings::LOAD_ALL);
+
+	atexit(closeAll);
+
+	if (backendType.empty() == true)
+	{
+		backendType = settings.m_defaultBackend;
+	}
+
+	// Is this a known index name ?
+	PinotSettings::IndexProperties indexProps = settings.getIndexPropertiesByName(databaseName);
+	if (indexProps.m_name.empty() == true)
+	{
+		// No, it's not
+		indexProps.m_location = databaseName;
+	}
+
+	// Make sure the index is open in the correct mode
+	bool wasObsoleteFormat = false;
+	if (ModuleFactory::openOrCreateIndex(backendType, indexProps.m_location, wasObsoleteFormat, (indexDocument ? false : true)) == false)
+	{
+		cerr &lt;&lt; &quot;Couldn't open index &quot; &lt;&lt; indexProps.m_location &lt;&lt; endl;
+
+		return EXIT_FAILURE;
+	}
+
+	// Get a read-write index of the given type
+	IndexInterface *pIndex = ModuleFactory::getIndex(backendType, indexProps.m_location);
+	if (pIndex == NULL)
+	{
+		cerr &lt;&lt; &quot;Couldn't obtain index for &quot; &lt;&lt; indexProps.m_location &lt;&lt; endl;
+
+		return EXIT_FAILURE;
+	}
+
+	while (optind &lt; argc)
+	{
+		string urlParam(argv[optind]);
+
+		if (checkDocument == true)
+		{
+			if (pIndex-&gt;isGood() == true)
+			{
+				docId = pIndex-&gt;hasDocument(urlParam);
+				if (docId &gt; 0)
+				{
+					cout &lt;&lt; urlParam &lt;&lt; &quot;: document ID &quot; &lt;&lt; docId &lt;&lt; endl;
+					success = true;
+				}
+			}
+		}
+		if (indexDocument == true)
+		{
+			Url thisUrl(urlParam);
+
+			// Which Downloader ?
+			DownloaderInterface *pDownloader = DownloaderFactory::getDownloader(thisUrl.getProtocol());
+			if (pDownloader == NULL)
+			{
+				cerr &lt;&lt; &quot;Couldn't obtain downloader for protocol &quot; &lt;&lt; thisUrl.getProtocol() &lt;&lt; endl;
+
+				success = false;
+
+				// Next
+				++optind;
+				continue;
+			}
+
+			// Set up the proxy
+			if ((settings.m_proxyEnabled == true) &amp;&amp;
+				(settings.m_proxyAddress.empty() == false))
+			{
+				char portStr[64];
+
+				pDownloader-&gt;setSetting(&quot;proxyaddress&quot;, settings.m_proxyAddress);
+				snprintf(portStr, 64, &quot;%u&quot;, settings.m_proxyPort);
+				pDownloader-&gt;setSetting(&quot;proxyport&quot;, portStr);
+				pDownloader-&gt;setSetting(&quot;proxytype&quot;, settings.m_proxyType);
+			}
+
+			DocumentInfo docInfo(&quot;&quot;, urlParam, MIMEScanner::scanUrl(thisUrl), &quot;&quot;);
+			Document *pDoc = pDownloader-&gt;retrieveUrl(docInfo);
+			if (pDoc == NULL)
+			{
+				cerr &lt;&lt; &quot;Couldn't download &quot; &lt;&lt; urlParam &lt;&lt; endl;
+			}
+			else
+			{
+				FilterWrapper wrapFilter(pIndex);
+				set&lt;string&gt; labels;
+
+				// Update an existing document or add to the index ?
+				docId = pIndex-&gt;hasDocument(urlParam);
+				if (docId &gt; 0)
+				{
+					// Update the document
+					if (wrapFilter.updateDocument(*pDoc, docId) == true)
+					{
+						success = true;
+					}
+				}
+				else
+				{
+					// Index the document
+					success = wrapFilter.indexDocument(*pDoc, labels, docId);
+				}
+
+				if (success == true)
+				{
+					// Flush the index
+					pIndex-&gt;flush();
+				}
+
+				delete pDoc;
+			}
+
+			delete pDownloader;
+		}
+		if ((showInfo == true) &amp;&amp;
+			(docId &gt; 0))
+		{
+			DocumentInfo docInfo;
+			set&lt;string&gt; labels;
+
+			cout &lt;&lt; &quot;Index version       : &quot; &lt;&lt; pIndex-&gt;getMetadata(&quot;version&quot;) &lt;&lt; endl;
+
+			if (pIndex-&gt;getDocumentInfo(docId, docInfo) == true)
+			{
+				cout &lt;&lt; &quot;Location : '&quot; &lt;&lt; docInfo.getLocation() &lt;&lt; &quot;'&quot; &lt;&lt; endl;
+				cout &lt;&lt; &quot;Title    : &quot; &lt;&lt; docInfo.getTitle() &lt;&lt; endl;
+				cout &lt;&lt; &quot;Type     : &quot; &lt;&lt; docInfo.getType() &lt;&lt; endl;
+				cout &lt;&lt; &quot;Language : &quot; &lt;&lt; docInfo.getLanguage() &lt;&lt; endl;
+				cout &lt;&lt; &quot;Date     : &quot; &lt;&lt; docInfo.getTimestamp() &lt;&lt; endl;
+				cout &lt;&lt; &quot;Size     : &quot; &lt;&lt; docInfo.getSize() &lt;&lt; endl;
+			}
+			if (pIndex-&gt;getDocumentLabels(docId, labels) == true)
+			{
+				cout &lt;&lt; &quot;Labels   : &quot;;
+				for (set&lt;string&gt;::const_iterator labelIter = labels.begin();
+					labelIter != labels.end(); ++labelIter)
+				{
+					if (labelIter-&gt;substr(0, 2) == &quot;X-&quot;)
+					{
+						continue;
+					}
+					cout &lt;&lt; &quot;[&quot; &lt;&lt; Url::escapeUrl(*labelIter) &lt;&lt; &quot;]&quot;;
+				}
+				cout &lt;&lt; endl;
+			}
+
+			vector&lt;MIMEAction&gt; typeActions;
+			MIMEScanner::getDefaultActions(docInfo.getType(), typeActions);
+			for (vector&lt;MIMEAction&gt;::const_iterator actionIter = typeActions.begin();
+				actionIter != typeActions.end(); ++actionIter)
+			{
+				cout &lt;&lt; &quot;Action   : '&quot; &lt;&lt; actionIter-&gt;m_name &lt;&lt; &quot;' &quot; &lt;&lt; actionIter-&gt;m_exec &lt;&lt; endl;
+			}
+		}
+
+		// Next
+		++optind;
+	}
+	delete pIndex;
+
+	// Did whatever operation we carried out succeed ?
+	if (success == true)
+	{
+		return EXIT_SUCCESS;
+	}
+
+	return EXIT_FAILURE;
+}


Property changes on: trunk/Core/pinot-index.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Modified: trunk/IndexSearch/Makefile.am
===================================================================
--- trunk/IndexSearch/Makefile.am	2009-02-01 14:28:52 UTC (rev 1536)
+++ trunk/IndexSearch/Makefile.am	2009-02-02 13:44:00 UTC (rev 1537)
@@ -46,27 +46,9 @@
 endif
 
 if HAVE_DBUS
-bin_PROGRAMS = pinot-index pinot-label
-else
-bin_PROGRAMS = pinot-index
+bin_PROGRAMS = pinot-label
 endif
 
-pinot_index_LDFLAGS = \
-	-rdynamic
-
-pinot_index_LDADD = \
-	-L$(top_builddir)/Utils \
-	-L$(top_builddir)/Tokenize \
-	-L$(top_builddir)/Collect \
-	-L$(top_builddir)/IndexSearch/Google \
-	-lIndexSearch -lCollect -lTokenize -lUtils -lBasicUtils \
-	@GLIBMM_LIBS@ @DBUS_LIBS@ \
-	@XML_LIBS@ @HTTP_LIBS@ @MISC_LIBS@
-
-pinot_index_SOURCES = pinot-index.cpp
-
-pinot_index_DEPENDENCIES = libIndexSearch.la
-
 pinot_label_LDFLAGS = \
 	-rdynamic
 

Deleted: trunk/IndexSearch/pinot-index.1
===================================================================
--- trunk/IndexSearch/pinot-index.1	2009-02-01 14:28:52 UTC (rev 1536)
+++ trunk/IndexSearch/pinot-index.1	2009-02-02 13:44:00 UTC (rev 1537)
@@ -1,52 +0,0 @@
-.\&quot; DO NOT MODIFY THIS FILE!  It was generated by help2man 1.36.
-.TH PINOT-INDEX &quot;1&quot; &quot;January 2009&quot; &quot;pinot-index - pinot 0.90&quot; &quot;User Commands&quot;
-.SH NAME
-pinot-index \- Index documents from the command-line
-.SH SYNOPSIS
-.B pinot-index
-[\fIOPTIONS\fR] \fIURLS\fR
-.SH DESCRIPTION
-pinot\-index \- Index documents from the command\-line
-.SH OPTIONS
-.TP
-\fB\-b\fR, \fB\-\-backend\fR
-name of back\-end to use (default xapian)
-.TP
-\fB\-c\fR, \fB\-\-check\fR
-check whether the given URL is in the index
-.TP
-\fB\-d\fR, \fB\-\-db\fR
-path to index to use (mandatory)
-.TP
-\fB\-h\fR, \fB\-\-help\fR
-display this help and exit
-.TP
-\fB\-i\fR, \fB\-\-index\fR
-index the given URL
-.TP
-\fB\-a\fR, \fB\-\-proxyaddress\fR
-proxy address
-.TP
-\fB\-p\fR, \fB\-\-proxyport\fR
-proxy port
-.TP
-\fB\-t\fR, \fB\-\-proxytype\fR
-proxy type (default HTTP, SOCKS4, SOCKS5)
-.TP
-\fB\-s\fR, \fB\-\-showinfo\fR
-show information about the document
-.TP
-\fB\-v\fR, \fB\-\-version\fR
-output version information and exit
-.PP
-Supported back\-ends are : 'xapian'
-.SH EXAMPLES
-pinot\-index \fB\-\-check\fR \fB\-\-showinfo\fR \fB\-\-backend\fR xapian \fB\-\-db\fR ~/.pinot/daemon <A HREF="file:///home/fabrice/Documents/Bozo.txt">file:///home/fabrice/Documents/Bozo.txt</A>
-.PP
-pinot\-index \fB\-\-index\fR \fB\-\-db\fR ~/.pinot/index <A HREF="http://pinot.berlios.de/">http://pinot.berlios.de/</A>
-.SH &quot;REPORTING BUGS&quot;
-Report bugs to <A HREF="https://lists.berlios.de/mailman/listinfo/pinot-svn">fabricecolin at users.berlios.de</A>
-.PP
-This is free software.  You may redistribute copies of it under the terms of
-the GNU General Public License &lt;<A HREF="http://www.gnu.org/licenses/old\-licenses/gpl\-2.0.html">http://www.gnu.org/licenses/old\-licenses/gpl\-2.0.html</A>&gt;.
-There is NO WARRANTY, to the extent permitted by law.

Deleted: trunk/IndexSearch/pinot-index.cpp
===================================================================
--- trunk/IndexSearch/pinot-index.cpp	2009-02-01 14:28:52 UTC (rev 1536)
+++ trunk/IndexSearch/pinot-index.cpp	2009-02-02 13:44:00 UTC (rev 1537)
@@ -1,370 +0,0 @@
-/*
- *  Copyright 2005-2008 Fabrice Colin
- *
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
- */
- 
-#include &lt;getopt.h&gt;
-#include &lt;cstdlib&gt;
-#include &lt;cstdio&gt;
-#include &lt;iostream&gt;
-#include &lt;string&gt;
-#include &lt;fstream&gt;
-
-#include &quot;config.h&quot;
-#include &quot;Languages.h&quot;
-#include &quot;MIMEScanner.h&quot;
-#include &quot;Url.h&quot;
-#include &quot;FilterFactory.h&quot;
-#include &quot;DownloaderFactory.h&quot;
-#include &quot;FilterWrapper.h&quot;
-#include &quot;ModuleFactory.h&quot;
-#include &quot;config.h&quot;
-
-using namespace std;
-
-static struct option g_longOptions[] = {
-	{&quot;backend&quot;, 1, 0, 'b'},
-	{&quot;check&quot;, 0, 0, 'c'},
-	{&quot;db&quot;, 1, 0, 'd'},
-	{&quot;help&quot;, 0, 0, 'h'},
-	{&quot;index&quot;, 0, 0, 'i'},
-	{&quot;proxyaddress&quot;, 1, 0, 'a'},
-	{&quot;proxyport&quot;, 1, 0, 'p'},
-	{&quot;proxytype&quot;, 1, 0, 't'},
-	{&quot;showinfo&quot;, 0, 0, 's'},
-	{&quot;version&quot;, 0, 0, 'v'},
-	{0, 0, 0, 0}
-};
-
-static void printHelp(void)
-{
-	map&lt;ModuleProperties, bool&gt; engines;
-
-	// Help
-	ModuleFactory::loadModules(string(LIBDIR) + string(&quot;/pinot/backends&quot;));
-	ModuleFactory::getSupportedEngines(engines);
-	cout &lt;&lt; &quot;pinot-index - Index documents from the command-line\n\n&quot;
-		&lt;&lt; &quot;Usage: pinot-index [OPTIONS] URLS\n\n&quot;
-		&lt;&lt; &quot;Options:\n&quot;
-		&lt;&lt; &quot;  -b, --backend             name of back-end to use (default xapian)\n&quot;
-		&lt;&lt; &quot;  -c, --check               check whether the given URL is in the index\n&quot;
-		&lt;&lt; &quot;  -d, --db                  path to index to use (mandatory)\n&quot;
-		&lt;&lt; &quot;  -h, --help                display this help and exit\n&quot;
-		&lt;&lt; &quot;  -i, --index               index the given URL\n&quot;
-		&lt;&lt; &quot;  -a, --proxyaddress        proxy address\n&quot;
-		&lt;&lt; &quot;  -p, --proxyport           proxy port\n&quot;
-		&lt;&lt; &quot;  -t, --proxytype           proxy type (default HTTP, SOCKS4, SOCKS5)\n&quot;
-		&lt;&lt; &quot;  -s, --showinfo            show information about the document\n&quot;
-		&lt;&lt; &quot;  -v, --version             output version information and exit\n\n&quot;
-		&lt;&lt; &quot;Supported back-ends are :&quot;;
-	for (map&lt;ModuleProperties, bool&gt;::const_iterator engineIter = engines.begin(); engineIter != engines.end(); ++engineIter)
-	{
-		if ((engineIter-&gt;second == true) &amp;&amp;
-			(ModuleFactory::isSupported(engineIter-&gt;first.m_name, true) == true))
-		{
-			cout &lt;&lt; &quot; '&quot; &lt;&lt; engineIter-&gt;first.m_name &lt;&lt; &quot;'&quot;;
-		}
-	}
-	ModuleFactory::unloadModules();
-	cout &lt;&lt; &quot;\n\nExamples:\n&quot;
-		&lt;&lt; &quot;pinot-index --check --showinfo --backend xapian --db ~/.pinot/daemon <A HREF="file:///home/fabrice/Documents/Bozo.txt\n\n">file:///home/fabrice/Documents/Bozo.txt\n\n</A>&quot;
-		&lt;&lt; &quot;pinot-index --index --db ~/.pinot/index <A HREF="http://pinot.berlios.de/\n\n">http://pinot.berlios.de/\n\n</A>&quot;
-		&lt;&lt; &quot;Report bugs to &quot; &lt;&lt; PACKAGE_BUGREPORT &lt;&lt; endl;
-}
-
-static void closeAll(void)
-{
-	// Close everything
-	ModuleFactory::unloadModules();
-	Dijon::FilterFactory::unloadFilters();
-	Dijon::HtmlFilter::shutdown();
-	DownloaderInterface::shutdown();
-	MIMEScanner::shutdown();
-}
-
-int main(int argc, char **argv)
-{
-	string type, option;
-	// Use back-end xapian by default for backward compatibility
-	string backendType(&quot;xapian&quot;), databaseName, proxyAddress, proxyPort, proxyType;
-	int longOptionIndex = 0;
-	unsigned int docId = 0;
-	bool checkDocument = false, indexDocument = false, showInfo = false, success = false;
-
-	// Look at the options
-	int optionChar = getopt_long(argc, argv, &quot;a:b:cd:hip:t:sv&quot;, g_longOptions, &amp;longOptionIndex);
-	while (optionChar != -1)
-	{
-		set&lt;string&gt; engines;
-
-		switch (optionChar)
-		{
-			case 'a':
-				if (optarg != NULL)
-				{
-					proxyAddress = optarg;
-				}
-				break;
-			case 'b':
-				if (optarg != NULL)
-				{
-					backendType = optarg;
-				}
-				break;
-			case 'c':
-				checkDocument = true;
-				break;
-			case 'd':
-				if (optarg != NULL)
-				{
-					databaseName = optarg;
-				}
-				break;
-			case 'h':
-				printHelp();
-				return EXIT_SUCCESS;
-			case 'i':
-				indexDocument = true;
-				break;
-			case 'p':
-				if (optarg != NULL)
-				{
-					proxyPort = optarg;
-				}
-				break;
-			case 's':
-				showInfo = true;
-				break;
-			case 't':
-				if (optarg != NULL)
-				{
-					proxyType = optarg;
-				}
-				break;
-			case 'v':
-				cout &lt;&lt; &quot;pinot-index - &quot; &lt;&lt; PACKAGE_STRING &lt;&lt; &quot;\n\n&quot;
-					&lt;&lt; &quot;This is free software.  You may redistribute copies of it under the terms of\n&quot;
-					&lt;&lt; &quot;the GNU General Public License &lt;<A HREF="http://www.gnu.org/licenses/old-licenses/gpl-2.0.html">http://www.gnu.org/licenses/old-licenses/gpl-2.0.html</A>&gt;.\n&quot;
-					&lt;&lt; &quot;There is NO WARRANTY, to the extent permitted by law.&quot; &lt;&lt; endl;
-				return EXIT_SUCCESS;
-			default:
-				return EXIT_FAILURE;
-		}
-
-		// Next option
-		optionChar = getopt_long(argc, argv, &quot;a:b:cd:hip:t:sv&quot;, g_longOptions, &amp;longOptionIndex);
-	}
-
-	if (argc == 1)
-	{
-		printHelp();
-		return EXIT_SUCCESS;
-	}
-
-	if ((argc &lt; 2) ||
-		(argc - optind == 0))
-	{
-		cerr &lt;&lt; &quot;Not enough parameters&quot; &lt;&lt; endl;
-		return EXIT_FAILURE;
-	}
-
-	if (((indexDocument == false) &amp;&amp;
-		(checkDocument == false)) ||
-		(backendType.empty() == true) ||
-		(databaseName.empty() == true))
-	{
-		cerr &lt;&lt; &quot;Incorrect parameters&quot; &lt;&lt; endl;
-		return EXIT_FAILURE;
-	}
-
-	MIMEScanner::initialize(&quot;&quot;, &quot;&quot;);
-	DownloaderInterface::initialize();
-	Dijon::HtmlFilter::initialize();
-	Dijon::FilterFactory::loadFilters(string(LIBDIR) + string(&quot;/pinot/filters&quot;));
-	ModuleFactory::loadModules(string(LIBDIR) + string(&quot;/pinot/backends&quot;));
-
-	// Localize language names
-	Languages::setIntlName (0, &quot;Unknown&quot;);
-	Languages::setIntlName (1, &quot;Danish&quot;);
-	Languages::setIntlName (2, &quot;Dutch&quot;);
-	Languages::setIntlName (3, &quot;English&quot;);
-	Languages::setIntlName (4, &quot;Finnish&quot;);
-	Languages::setIntlName (5, &quot;French&quot;);
-	Languages::setIntlName (6, &quot;German&quot;);
-	Languages::setIntlName (7, &quot;Hungarian&quot;);
-	Languages::setIntlName (8, &quot;Italian&quot;);
-	Languages::setIntlName (9, &quot;Norwegian&quot;);
-	Languages::setIntlName (10, &quot;Portuguese&quot;);
-	Languages::setIntlName (11, &quot;Romanian&quot;);
-	Languages::setIntlName (12, &quot;Russian&quot;);
-	Languages::setIntlName (13, &quot;Spanish&quot;);
-	Languages::setIntlName (14, &quot;Swedish&quot;);
-	Languages::setIntlName (15, &quot;Turkish&quot;);
-
-	atexit(closeAll);
-
-	// Make sure the index is open in the correct mode
-	bool wasObsoleteFormat = false;
-	if (ModuleFactory::openOrCreateIndex(backendType, databaseName, wasObsoleteFormat, (indexDocument ? false : true)) == false)
-	{
-		cerr &lt;&lt; &quot;Couldn't open index &quot; &lt;&lt; databaseName &lt;&lt; endl;
-
-		return EXIT_FAILURE;
-	}
-
-	// Get a read-write index of the given type
-	IndexInterface *pIndex = ModuleFactory::getIndex(backendType, databaseName);
-	if (pIndex == NULL)
-	{
-		cerr &lt;&lt; &quot;Couldn't obtain index for &quot; &lt;&lt; databaseName &lt;&lt; endl;
-
-		return EXIT_FAILURE;
-	}
-
-	while (optind &lt; argc)
-	{
-		string urlParam(argv[optind]);
-
-		if (checkDocument == true)
-		{
-			if (pIndex-&gt;isGood() == true)
-			{
-				docId = pIndex-&gt;hasDocument(urlParam);
-				if (docId &gt; 0)
-				{
-					cout &lt;&lt; urlParam &lt;&lt; &quot;: document ID &quot; &lt;&lt; docId &lt;&lt; endl;
-					success = true;
-				}
-			}
-		}
-		if (indexDocument == true)
-		{
-			Url thisUrl(urlParam);
-
-			// Which Downloader ?
-			DownloaderInterface *pDownloader = DownloaderFactory::getDownloader(thisUrl.getProtocol());
-			if (pDownloader == NULL)
-			{
-				cerr &lt;&lt; &quot;Couldn't obtain downloader for protocol &quot; &lt;&lt; thisUrl.getProtocol() &lt;&lt; endl;
-
-				success = false;
-
-				// Next
-				++optind;
-				continue;
-			}
-
-			// Set up the proxy
-			if ((proxyAddress.empty() == false) &amp;&amp;
-				(proxyPort.empty() == false))
-			{
-				pDownloader-&gt;setSetting(&quot;proxyaddress&quot;, proxyAddress);
-				pDownloader-&gt;setSetting(&quot;proxyport&quot;, proxyPort);
-				pDownloader-&gt;setSetting(&quot;proxytype&quot;, proxyType);
-			}
-
-			DocumentInfo docInfo(&quot;&quot;, urlParam, MIMEScanner::scanUrl(thisUrl), &quot;&quot;);
-			Document *pDoc = pDownloader-&gt;retrieveUrl(docInfo);
-			if (pDoc == NULL)
-			{
-				cerr &lt;&lt; &quot;Couldn't download &quot; &lt;&lt; urlParam &lt;&lt; endl;
-			}
-			else
-			{
-				FilterWrapper wrapFilter(pIndex);
-				set&lt;string&gt; labels;
-
-				// Update an existing document or add to the index ?
-				docId = pIndex-&gt;hasDocument(urlParam);
-				if (docId &gt; 0)
-				{
-					// Update the document
-					if (wrapFilter.updateDocument(*pDoc, docId) == true)
-					{
-						success = true;
-					}
-				}
-				else
-				{
-					// Index the document
-					success = wrapFilter.indexDocument(*pDoc, labels, docId);
-				}
-
-				if (success == true)
-				{
-					// Flush the index
-					pIndex-&gt;flush();
-				}
-
-				delete pDoc;
-			}
-
-			delete pDownloader;
-		}
-		if ((showInfo == true) &amp;&amp;
-			(docId &gt; 0))
-		{
-			DocumentInfo docInfo;
-			set&lt;string&gt; labels;
-
-			cout &lt;&lt; &quot;Index version       : &quot; &lt;&lt; pIndex-&gt;getMetadata(&quot;version&quot;) &lt;&lt; endl;
-
-			if (pIndex-&gt;getDocumentInfo(docId, docInfo) == true)
-			{
-				cout &lt;&lt; &quot;Location : '&quot; &lt;&lt; docInfo.getLocation() &lt;&lt; &quot;'&quot; &lt;&lt; endl;
-				cout &lt;&lt; &quot;Title    : &quot; &lt;&lt; docInfo.getTitle() &lt;&lt; endl;
-				cout &lt;&lt; &quot;Type     : &quot; &lt;&lt; docInfo.getType() &lt;&lt; endl;
-				cout &lt;&lt; &quot;Language : &quot; &lt;&lt; docInfo.getLanguage() &lt;&lt; endl;
-				cout &lt;&lt; &quot;Date     : &quot; &lt;&lt; docInfo.getTimestamp() &lt;&lt; endl;
-				cout &lt;&lt; &quot;Size     : &quot; &lt;&lt; docInfo.getSize() &lt;&lt; endl;
-			}
-			if (pIndex-&gt;getDocumentLabels(docId, labels) == true)
-			{
-				cout &lt;&lt; &quot;Labels   : &quot;;
-				for (set&lt;string&gt;::const_iterator labelIter = labels.begin();
-					labelIter != labels.end(); ++labelIter)
-				{
-					if (labelIter-&gt;substr(0, 2) == &quot;X-&quot;)
-					{
-						continue;
-					}
-					cout &lt;&lt; &quot;[&quot; &lt;&lt; Url::escapeUrl(*labelIter) &lt;&lt; &quot;]&quot;;
-				}
-				cout &lt;&lt; endl;
-			}
-
-			vector&lt;MIMEAction&gt; typeActions;
-			MIMEScanner::getDefaultActions(docInfo.getType(), typeActions);
-			for (vector&lt;MIMEAction&gt;::const_iterator actionIter = typeActions.begin();
-				actionIter != typeActions.end(); ++actionIter)
-			{
-				cout &lt;&lt; &quot;Action   : '&quot; &lt;&lt; actionIter-&gt;m_name &lt;&lt; &quot;' &quot; &lt;&lt; actionIter-&gt;m_exec &lt;&lt; endl;
-			}
-		}
-
-		// Next
-		++optind;
-	}
-	delete pIndex;
-
-	// Did whatever operation we carried out succeed ?
-	if (success == true)
-	{
-		return EXIT_SUCCESS;
-	}
-
-	return EXIT_FAILURE;
-}

Modified: trunk/Makefile.am
===================================================================
--- trunk/Makefile.am	2009-02-01 14:28:52 UTC (rev 1536)
+++ trunk/Makefile.am	2009-02-02 13:44:00 UTC (rev 1537)
@@ -7,7 +7,7 @@
 	textcat_conf.txt textcat3_conf.txt \
 	pinot*.desktop pinot.spec \
 	IndexSearch/Plugins/*src IndexSearch/Plugins/*.xml \
-	IndexSearch/pinot-index.1 IndexSearch/pinot-label.1 \
+	Core/pinot-index.1 IndexSearch/pinot-label.1 \
 	Core/pinot-search.1 UI/GTK2/src/pinot.1 \
 	Core/pinot-dbus-daemon.1 Core/pinot-dbus-daemon.xml \
 	Core/de.berlios.Pinot.service \
@@ -17,11 +17,11 @@
 	UI/GTK2/metase-gtk2.glade UI/GTK2/metase-gtk2.gladep \
 	scripts/bash/*.sh scripts/python/*.py
 
-man_MANS = IndexSearch/pinot-index.1 IndexSearch/pinot-label.1 \
+man_MANS = Core/pinot-index.1 IndexSearch/pinot-label.1 \
 	Core/pinot-search.1 Core/pinot-dbus-daemon.1 UI/GTK2/src/pinot.1
 
 manuals:
-	@help2man --no-info --name &quot;Index documents from the command-line&quot; IndexSearch/pinot-index &gt;IndexSearch/pinot-index.1
+	@help2man --no-info --name &quot;Index documents from the command-line&quot; Core/pinot-index &gt;Core/pinot-index.1
 	@help2man --no-info --name &quot;Label files from the command-line&quot; IndexSearch/pinot-label     &gt;IndexSearch/pinot-label.1
 	@help2man --no-info --name &quot;Query search engines from the command-line&quot; Core/pinot-search  &gt;Core/pinot-search.1
 	@help2man --no-info --name &quot;D-Bus search and index daemon&quot; Core/pinot-dbus-daemon          &gt;Core/pinot-dbus-daemon.1


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001526.html">[Pinot-svn] r1536 - in trunk: . Core
</A></li>
	<LI>Next message: <A HREF="001528.html">[Pinot-svn] r1538 - in trunk: Core IndexSearch UI/GTK2/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1527">[ date ]</a>
              <a href="thread.html#1527">[ thread ]</a>
              <a href="subject.html#1527">[ subject ]</a>
              <a href="author.html#1527">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/pinot-svn">More information about the Pinot-svn
mailing list</a><br>
</body></html>
