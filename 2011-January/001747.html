<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Pinot-svn] r1758 - trunk
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/pinot-svn/2011-January/index.html" >
   <LINK REL="made" HREF="mailto:pinot-svn%40lists.berlios.de?Subject=Re%3A%20%5BPinot-svn%5D%20r1758%20-%20trunk&In-Reply-To=%3C20110109104131.8AB26480A26%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001746.html">
   <LINK REL="Next"  HREF="001748.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Pinot-svn] r1758 - trunk</H1>
    <B>fabricecolin at mail.berlios.de</B> 
    <A HREF="mailto:pinot-svn%40lists.berlios.de?Subject=Re%3A%20%5BPinot-svn%5D%20r1758%20-%20trunk&In-Reply-To=%3C20110109104131.8AB26480A26%40sheep.berlios.de%3E"
       TITLE="[Pinot-svn] r1758 - trunk">fabricecolin at mail.berlios.de
       </A><BR>
    <I>Sun Jan  9 11:41:31 CET 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="001746.html">[Pinot-svn] r1757 - trunk
</A></li>
        <LI>Next message: <A HREF="001748.html">[Pinot-svn] r1759 - in trunk: . po
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1747">[ date ]</a>
              <a href="thread.html#1747">[ thread ]</a>
              <a href="subject.html#1747">[ subject ]</a>
              <a href="author.html#1747">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: fabricecolin
Date: 2011-01-09 11:41:31 +0100 (Sun, 09 Jan 2011)
New Revision: 1758

Modified:
   trunk/ltmain.sh
Log:
Regenerated with libtool 2.2.10.
Changes for --as-needed from SVN r1713 are still in.


Modified: trunk/ltmain.sh
===================================================================
--- trunk/ltmain.sh	2011-01-06 11:41:18 UTC (rev 1757)
+++ trunk/ltmain.sh	2011-01-09 10:41:31 UTC (rev 1758)
@@ -1,9 +1,10 @@
 # Generated from ltmain.m4sh.
 
-# ltmain.sh (GNU libtool) 2.2.6b
+# libtool (GNU libtool) 2.2.10
 # Written by Gordon Matzigkeit &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/pinot-svn">gord at gnu.ai.mit.edu</A>&gt;, 1996
 
-# Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2003, 2004, 2005, 2006, 2007 2008 Free Software Foundation, Inc.
+# Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2003, 2004, 2005, 2006,
+# 2007, 2008, 2009, 2010 Free Software Foundation, Inc.
 # This is free software; see the source for copying conditions.  There is NO
 # warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
 
@@ -32,50 +33,54 @@
 #
 # Provide generalized library-building support services.
 #
-#     --config             show all configuration variables
-#     --debug              enable verbose shell tracing
-# -n, --dry-run            display commands without modifying any files
-#     --features           display basic configuration information and exit
-#     --mode=MODE          use operation mode MODE
-#     --preserve-dup-deps  don't remove duplicate dependency libraries
-#     --quiet, --silent    don't print informational messages
-#     --tag=TAG            use configuration variables from tag TAG
-# -v, --verbose            print informational messages (default)
-#     --version            print version information
-# -h, --help               print short or long help message
+#       --config             show all configuration variables
+#       --debug              enable verbose shell tracing
+#   -n, --dry-run            display commands without modifying any files
+#       --features           display basic configuration information and exit
+#       --mode=MODE          use operation mode MODE
+#       --preserve-dup-deps  don't remove duplicate dependency libraries
+#       --quiet, --silent    don't print informational messages
+#       --no-quiet, --no-silent
+#                            print informational messages (default)
+#       --tag=TAG            use configuration variables from tag TAG
+#   -v, --verbose            print more informational messages than default
+#       --no-verbose         don't print the extra informational messages
+#       --version            print version information
+#   -h, --help, --help-all   print short, long, or detailed help message
 #
 # MODE must be one of the following:
 #
-#       clean              remove files from the build directory
-#       compile            compile a source file into a libtool object
-#       execute            automatically set library path, then run a program
-#       finish             complete the installation of libtool libraries
-#       install            install libraries or executables
-#       link               create a library or an executable
-#       uninstall          remove libraries from an installed directory
+#         clean              remove files from the build directory
+#         compile            compile a source file into a libtool object
+#         execute            automatically set library path, then run a program
+#         finish             complete the installation of libtool libraries
+#         install            install libraries or executables
+#         link               create a library or an executable
+#         uninstall          remove libraries from an installed directory
 #
-# MODE-ARGS vary depending on the MODE.
+# MODE-ARGS vary depending on the MODE.  When passed as first option,
+# `--mode=MODE' may be abbreviated as `MODE' or a unique abbreviation of that.
 # Try `$progname --help --mode=MODE' for a more detailed description of MODE.
 #
 # When reporting a bug, please describe a test case to reproduce it and
 # include the following information:
 #
-#       host-triplet:	$host
-#       shell:		$SHELL
-#       compiler:		$LTCC
-#       compiler flags:		$LTCFLAGS
-#       linker:		$LD (gnu? $with_gnu_ld)
-#       $progname:		(GNU libtool) 2.2.6b
-#       automake:		$automake_version
-#       autoconf:		$autoconf_version
+#         host-triplet:	$host
+#         shell:		$SHELL
+#         compiler:		$LTCC
+#         compiler flags:		$LTCFLAGS
+#         linker:		$LD (gnu? $with_gnu_ld)
+#         $progname:	(GNU libtool) 2.2.10
+#         automake:	$automake_version
+#         autoconf:	$autoconf_version
 #
 # Report bugs to &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/pinot-svn">bug-libtool at gnu.org</A>&gt;.
 
-PROGRAM=ltmain.sh
+PROGRAM=libtool
 PACKAGE=libtool
-VERSION=2.2.6b
+VERSION=2.2.10
 TIMESTAMP=&quot;&quot;
-package_revision=1.3017
+package_revision=1.3175
 
 # Be Bourne compatible
 if test -n &quot;${ZSH_VERSION+set}&quot; &amp;&amp; (emulate sh) &gt;/dev/null 2&gt;&amp;1; then
@@ -91,10 +96,15 @@
 BIN_SH=xpg4; export BIN_SH # for Tru64
 DUALCASE=1; export DUALCASE # for MKS sh
 
+# A function that is used when there is no print builtin or printf.
+func_fallback_echo ()
+{
+  eval 'cat &lt;&lt;_LTECHO_EOF
+$1
+_LTECHO_EOF'
+}
+
 # NLS nuisances: We save the old values to restore during execute mode.
-# Only set LANG and LC_ALL to C if already set.
-# These must not be set unconditionally because not all systems understand
-# e.g. LANG=C (notably SCO).
 lt_user_locale=
 lt_safe_locale=
 for lt_var in LANG LANGUAGE LC_ALL LC_CTYPE LC_COLLATE LC_MESSAGES
@@ -107,15 +117,24 @@
 	  lt_safe_locale=\&quot;$lt_var=C; \$lt_safe_locale\&quot;
 	fi&quot;
 done
+LC_ALL=C
+LANGUAGE=C
+export LANGUAGE LC_ALL
 
 $lt_unset CDPATH
 
 
+# Work around backward compatibility issue on IRIX 6.5. On IRIX 6.4+, sh
+# is ksh but when the shell is invoked as &quot;sh&quot; and the current value of
+# the _XPG environment variable is not equal to 1 (one), the special
+# positional parameter $0, within a function call, is the name of the
+# function.
+progpath=&quot;$0&quot;
 
 
 
 : ${CP=&quot;cp -f&quot;}
-: ${ECHO=&quot;echo&quot;}
+test &quot;${ECHO+set}&quot; = set || ECHO=${as_echo-'printf %s\n'}
 : ${EGREP=&quot;/bin/grep -E&quot;}
 : ${FGREP=&quot;/bin/grep -F&quot;}
 : ${GREP=&quot;/bin/grep&quot;}
@@ -159,32 +178,168 @@
 func_dirname_and_basename ()
 {
   # Extract subdirectory from the argument.
-  func_dirname_result=`$ECHO &quot;X${1}&quot; | $Xsed -e &quot;$dirname&quot;`
+  func_dirname_result=`$ECHO &quot;${1}&quot; | $SED -e &quot;$dirname&quot;`
   if test &quot;X$func_dirname_result&quot; = &quot;X${1}&quot;; then
     func_dirname_result=&quot;${3}&quot;
   else
     func_dirname_result=&quot;$func_dirname_result${2}&quot;
   fi
-  func_basename_result=`$ECHO &quot;X${1}&quot; | $Xsed -e &quot;$basename&quot;`
+  func_basename_result=`$ECHO &quot;${1}&quot; | $SED -e &quot;$basename&quot;`
 }
 
 # Generated shell functions inserted here.
 
-# Work around backward compatibility issue on IRIX 6.5. On IRIX 6.4+, sh
-# is ksh but when the shell is invoked as &quot;sh&quot; and the current value of
-# the _XPG environment variable is not equal to 1 (one), the special
-# positional parameter $0, within a function call, is the name of the
-# function.
-progpath=&quot;$0&quot;
+# These SED scripts presuppose an absolute path with a trailing slash.
+pathcar='s,^/\([^/]*\).*$,\1,'
+pathcdr='s,^/[^/]*,,'
+removedotparts=':dotsl
+		s@/\./@/@g
+		t dotsl
+		s,/\.$,/,'
+collapseslashes='s@/\{1,\}@/@g'
+finalslash='s,/*$,/,'
 
+# func_normal_abspath PATH
+# Remove doubled-up and trailing slashes, &quot;.&quot; path components,
+# and cancel out any &quot;..&quot; path components in PATH after making
+# it an absolute path.
+#             value returned in &quot;$func_normal_abspath_result&quot;
+func_normal_abspath ()
+{
+  # Start from root dir and reassemble the path.
+  func_normal_abspath_result=
+  func_normal_abspath_tpath=$1
+  func_normal_abspath_altnamespace=
+  case $func_normal_abspath_tpath in
+    &quot;&quot;)
+      # Empty path, that just means $cwd.
+      func_stripname '' '/' &quot;`pwd`&quot;
+      func_normal_abspath_result=$func_stripname_result
+      return
+    ;;
+    # The next three entries are used to spot a run of precisely
+    # two leading slashes without using negated character classes;
+    # we take advantage of case's first-match behaviour.
+    ///*)
+      # Unusual form of absolute path, do nothing.
+    ;;
+    //*)
+      # Not necessarily an ordinary path; POSIX reserves leading '//'
+      # and for example Cygwin uses it to access remote file shares
+      # over CIFS/SMB, so we conserve a leading double slash if found.
+      func_normal_abspath_altnamespace=/
+    ;;
+    /*)
+      # Absolute path, do nothing.
+    ;;
+    *)
+      # Relative path, prepend $cwd.
+      func_normal_abspath_tpath=`pwd`/$func_normal_abspath_tpath
+    ;;
+  esac
+  # Cancel out all the simple stuff to save iterations.  We also want
+  # the path to end with a slash for ease of parsing, so make sure
+  # there is one (and only one) here.
+  func_normal_abspath_tpath=`$ECHO &quot;$func_normal_abspath_tpath&quot; | $SED \
+        -e &quot;$removedotparts&quot; -e &quot;$collapseslashes&quot; -e &quot;$finalslash&quot;`
+  while :; do
+    # Processed it all yet?
+    if test &quot;$func_normal_abspath_tpath&quot; = / ; then
+      # If we ascended to the root using &quot;..&quot; the result may be empty now.
+      if test -z &quot;$func_normal_abspath_result&quot; ; then
+        func_normal_abspath_result=/
+      fi
+      break
+    fi
+    func_normal_abspath_tcomponent=`$ECHO &quot;$func_normal_abspath_tpath&quot; | $SED \
+        -e &quot;$pathcar&quot;`
+    func_normal_abspath_tpath=`$ECHO &quot;$func_normal_abspath_tpath&quot; | $SED \
+        -e &quot;$pathcdr&quot;`
+    # Figure out what to do with it
+    case $func_normal_abspath_tcomponent in
+      &quot;&quot;)
+        # Trailing empty path component, ignore it.
+      ;;
+      ..)
+        # Parent dir; strip last assembled component from result.
+        func_dirname &quot;$func_normal_abspath_result&quot;
+        func_normal_abspath_result=$func_dirname_result
+      ;;
+      *)
+        # Actual path component, append it.
+        func_normal_abspath_result=$func_normal_abspath_result/$func_normal_abspath_tcomponent
+      ;;
+    esac
+  done
+  # Restore leading double-slash if one was found on entry.
+  func_normal_abspath_result=$func_normal_abspath_altnamespace$func_normal_abspath_result
+}
+
+# func_relative_path SRCDIR DSTDIR
+# generates a relative path from SRCDIR to DSTDIR, with a trailing
+# slash if non-empty, suitable for immediately appending a filename
+# without needing to append a separator.
+#             value returned in &quot;$func_relative_path_result&quot;
+func_relative_path ()
+{
+  func_relative_path_result=
+  func_normal_abspath &quot;$1&quot;
+  func_relative_path_tlibdir=$func_normal_abspath_result
+  func_normal_abspath &quot;$2&quot;
+  func_relative_path_tbindir=$func_normal_abspath_result
+
+  # Ascend the tree starting from libdir
+  while :; do
+    # check if we have found a prefix of bindir
+    case $func_relative_path_tbindir in
+      $func_relative_path_tlibdir)
+        # found an exact match
+        func_relative_path_tcancelled=
+        break
+        ;;
+      $func_relative_path_tlibdir*)
+        # found a matching prefix
+        func_stripname &quot;$func_relative_path_tlibdir&quot; '' &quot;$func_relative_path_tbindir&quot;
+        func_relative_path_tcancelled=$func_stripname_result
+        if test -z &quot;$func_relative_path_result&quot;; then
+          func_relative_path_result=.
+        fi
+        break
+        ;;
+      *)
+        func_dirname $func_relative_path_tlibdir
+        func_relative_path_tlibdir=${func_dirname_result}
+        if test &quot;x$func_relative_path_tlibdir&quot; = x ; then
+          # Have to descend all the way to the root!
+          func_relative_path_result=../$func_relative_path_result
+          func_relative_path_tcancelled=$func_relative_path_tbindir
+          break
+        fi
+        func_relative_path_result=../$func_relative_path_result
+        ;;
+    esac
+  done
+
+  # Now calculate path; take care to avoid doubling-up slashes.
+  func_stripname '' '/' &quot;$func_relative_path_result&quot;
+  func_relative_path_result=$func_stripname_result
+  func_stripname '/' '/' &quot;$func_relative_path_tcancelled&quot;
+  if test &quot;x$func_stripname_result&quot; != x ; then
+    func_relative_path_result=${func_relative_path_result}/${func_stripname_result}
+  fi
+
+  # Normalisation. If bindir is libdir, return empty string,
+  # else relative path ending with a slash; either way, target
+  # file name can be directly appended.
+  if test ! -z &quot;$func_relative_path_result&quot;; then
+    func_stripname './' '' &quot;$func_relative_path_result/&quot;
+    func_relative_path_result=$func_stripname_result
+  fi
+}
+
 # The name of this program:
-# In the unlikely event $progname began with a '-', it would play havoc with
-# func_echo (imagine progname=-n), so we prepend ./ in that case:
 func_dirname_and_basename &quot;$progpath&quot;
 progname=$func_basename_result
-case $progname in
-  -*) progname=./$progname ;;
-esac
 
 # Make sure we have an absolute path for reexecution:
 case $progpath in
@@ -258,6 +413,13 @@
     :
 }
 
+# func_echo_all arg...
+# Invoke $ECHO with all args, space-separated.
+func_echo_all ()
+{
+    $ECHO &quot;$*&quot;
+}
+
 # func_error arg...
 # Echo program name prefixed message to standard error.
 func_error ()
@@ -326,9 +488,9 @@
         case $my_directory_path in */*) ;; *) break ;; esac
 
         # ...otherwise throw away the child directory and loop
-        my_directory_path=`$ECHO &quot;X$my_directory_path&quot; | $Xsed -e &quot;$dirname&quot;`
+        my_directory_path=`$ECHO &quot;$my_directory_path&quot; | $SED -e &quot;$dirname&quot;`
       done
-      my_dir_list=`$ECHO &quot;X$my_dir_list&quot; | $Xsed -e 's,:*$,,'`
+      my_dir_list=`$ECHO &quot;$my_dir_list&quot; | $SED 's,:*$,,'`
 
       save_mkdir_p_IFS=&quot;$IFS&quot;; IFS=':'
       for my_dir in $my_dir_list; do
@@ -378,7 +540,7 @@
         func_fatal_error &quot;cannot create temporary directory \`$my_tmpdir'&quot;
     fi
 
-    $ECHO &quot;X$my_tmpdir&quot; | $Xsed
+    $ECHO &quot;$my_tmpdir&quot;
 }
 
 
@@ -392,7 +554,7 @@
 {
     case $1 in
       *[\\\`\&quot;\$]*)
-	func_quote_for_eval_unquoted_result=`$ECHO &quot;X$1&quot; | $Xsed -e &quot;$sed_quote_subst&quot;` ;;
+	func_quote_for_eval_unquoted_result=`$ECHO &quot;$1&quot; | $SED &quot;$sed_quote_subst&quot;` ;;
       *)
         func_quote_for_eval_unquoted_result=&quot;$1&quot; ;;
     esac
@@ -419,7 +581,7 @@
 {
     case $1 in
       *[\\\`\&quot;]*)
-	my_arg=`$ECHO &quot;X$1&quot; | $Xsed \
+	my_arg=`$ECHO &quot;$1&quot; | $SED \
 	    -e &quot;$double_quote_subst&quot; -e &quot;$sed_double_backslash&quot;` ;;
       *)
         my_arg=&quot;$1&quot; ;;
@@ -489,14 +651,19 @@
 }
 
 
-
-
-
 # func_version
 # Echo version message to standard output and exit.
 func_version ()
 {
-    $SED -n '/^# '$PROGRAM' (GNU /,/# warranty; / {
+    $SED -n '/(C)/!b go
+	:more
+	/\./!{
+	  N
+	  s/\n# / /
+	  b more
+	}
+	:go
+	/^# '$PROGRAM' (GNU /,/# warranty; / {
         s/^# //
 	s/^# *$//
         s/\((C)\)[ 0-9,-]*\( [1-9][0-9]*\)/\1\2/
@@ -509,19 +676,20 @@
 # Echo short help message to standard output and exit.
 func_usage ()
 {
-    $SED -n '/^# Usage:/,/# -h/ {
+    $SED -n '/^# Usage:/,/^#  *.*--help/ {
         s/^# //
 	s/^# *$//
 	s/\$progname/'$progname'/
 	p
     }' &lt; &quot;$progpath&quot;
-    $ECHO
+    echo
     $ECHO &quot;run \`$progname --help | more' for full usage&quot;
     exit $?
 }
 
-# func_help
-# Echo long help message to standard output and exit.
+# func_help [NOEXIT]
+# Echo long help message to standard output and exit,
+# unless 'noexit' is passed as argument.
 func_help ()
 {
     $SED -n '/^# Usage:/,/# Report bugs to/ {
@@ -538,7 +706,10 @@
 	s/\$autoconf_version/'&quot;`(autoconf --version) 2&gt;/dev/null |$SED 1q`&quot;'/
 	p
      }' &lt; &quot;$progpath&quot;
-    exit $?
+    ret=$?
+    if test -z &quot;$1&quot;; then
+      exit $ret
+    fi
 }
 
 # func_missing_arg argname
@@ -546,7 +717,7 @@
 # exit_cmd.
 func_missing_arg ()
 {
-    func_error &quot;missing argument for $1&quot;
+    func_error &quot;missing argument for $1.&quot;
     exit_cmd=exit
 }
 
@@ -556,30 +727,7 @@
 
 
 
-# Check that we have a working $ECHO.
-if test &quot;X$1&quot; = X--no-reexec; then
-  # Discard the --no-reexec flag, and continue.
-  shift
-elif test &quot;X$1&quot; = X--fallback-echo; then
-  # Avoid inline document here, it may be left over
-  :
-elif test &quot;X`{ $ECHO '\t'; } 2&gt;/dev/null`&quot; = 'X\t'; then
-  # Yippee, $ECHO works!
-  :
-else
-  # Restart under the correct shell, and then maybe $ECHO will work.
-  exec $SHELL &quot;$progpath&quot; --no-reexec ${1+&quot;$@&quot;}
-fi
 
-if test &quot;X$1&quot; = X--fallback-echo; then
-  # used as fallback echo
-  shift
-  cat &lt;&lt;EOF
-$*
-EOF
-  exit $EXIT_SUCCESS
-fi
-
 magic=&quot;%%%MAGIC variable%%%&quot;
 magic_exe=&quot;%%%MAGIC EXE variable%%%&quot;
 
@@ -636,16 +784,16 @@
 # Display the features supported by this script.
 func_features ()
 {
-    $ECHO &quot;host: $host&quot;
+    echo &quot;host: $host&quot;
     if test &quot;$build_libtool_libs&quot; = yes; then
-      $ECHO &quot;enable shared libraries&quot;
+      echo &quot;enable shared libraries&quot;
     else
-      $ECHO &quot;disable shared libraries&quot;
+      echo &quot;disable shared libraries&quot;
     fi
     if test &quot;$build_old_libs&quot; = yes; then
-      $ECHO &quot;enable static libraries&quot;
+      echo &quot;enable static libraries&quot;
     else
-      $ECHO &quot;disable static libraries&quot;
+      echo &quot;disable static libraries&quot;
     fi
 
     exit $?
@@ -772,12 +920,23 @@
 
       --quiet|--silent)	preserve_args=&quot;$preserve_args $opt&quot;
 			opt_silent=:
+			opt_verbose=false
 			;;
 
+      --no-quiet|--no-silent)
+			preserve_args=&quot;$preserve_args $opt&quot;
+			opt_silent=false
+			;;
+
       --verbose| -v)	preserve_args=&quot;$preserve_args $opt&quot;
 			opt_silent=false
+			opt_verbose=:
 			;;
 
+      --no-verbose)	preserve_args=&quot;$preserve_args $opt&quot;
+			opt_verbose=false
+			;;
+
       --tag)		test &quot;$#&quot; -eq 0 &amp;&amp; func_missing_arg &quot;$opt&quot; &amp;&amp; break
 			preserve_args=&quot;$preserve_args $opt $1&quot;
 			func_enable_tag &quot;$1&quot;	# tagname is set here
@@ -793,6 +952,7 @@
 
       -\?|-h)		func_usage					;;
       --help)		opt_help=:					;;
+      --help-all)	opt_help=': help-all'				;;
       --version)	func_version					;;
 
       -*)		func_fatal_help &quot;unrecognized option \`$opt'&quot;	;;
@@ -1016,10 +1176,13 @@
         func_quote_for_eval &quot;$arg&quot;
 	CC_quoted=&quot;$CC_quoted $func_quote_for_eval_result&quot;
       done
+      CC_expanded=`func_echo_all $CC`
+      CC_quoted_expanded=`func_echo_all $CC_quoted`
       case $@ in
       # Blanks in the command may have been stripped by the calling shell,
       # but not from the CC environment variable when configure was run.
-      &quot; $CC &quot;* | &quot;$CC &quot;* | &quot; `$ECHO $CC` &quot;* | &quot;`$ECHO $CC` &quot;* | &quot; $CC_quoted&quot;* | &quot;$CC_quoted &quot;* | &quot; `$ECHO $CC_quoted` &quot;* | &quot;`$ECHO $CC_quoted` &quot;*) ;;
+      &quot; $CC &quot;* | &quot;$CC &quot;* | &quot; $CC_expanded &quot;* | &quot;$CC_expanded &quot;* | \
+      &quot; $CC_quoted&quot;* | &quot;$CC_quoted &quot;* | &quot; $CC_quoted_expanded &quot;* | &quot;$CC_quoted_expanded &quot;*) ;;
       # Blanks at the start of $base_compile will cause this to fail
       # if we don't check for them as well.
       *)
@@ -1033,8 +1196,11 @@
 	      func_quote_for_eval &quot;$arg&quot;
 	      CC_quoted=&quot;$CC_quoted $func_quote_for_eval_result&quot;
 	    done
+	    CC_expanded=`func_echo_all $CC`
+	    CC_quoted_expanded=`func_echo_all $CC_quoted`
 	    case &quot;$@ &quot; in
-	      &quot; $CC &quot;* | &quot;$CC &quot;* | &quot; `$ECHO $CC` &quot;* | &quot;`$ECHO $CC` &quot;* | &quot; $CC_quoted&quot;* | &quot;$CC_quoted &quot;* | &quot; `$ECHO $CC_quoted` &quot;* | &quot;`$ECHO $CC_quoted` &quot;*)
+	    &quot; $CC &quot;* | &quot;$CC &quot;* | &quot; $CC_expanded &quot;* | &quot;$CC_expanded &quot;* | \
+	    &quot; $CC_quoted&quot;* | &quot;$CC_quoted &quot;* | &quot; $CC_quoted_expanded &quot;* | &quot;$CC_quoted_expanded &quot;*)
 	      # The compiler in the base compile command matches
 	      # the one in the tagged configuration.
 	      # Assume this is the tagged configuration we want.
@@ -1213,7 +1379,7 @@
     *.[cCFSifmso] | \
     *.ada | *.adb | *.ads | *.asm | \
     *.c++ | *.cc | *.ii | *.class | *.cpp | *.cxx | \
-    *.[fF][09]? | *.for | *.java | *.obj | *.sx)
+    *.[fF][09]? | *.for | *.java | *.obj | *.sx | *.cu | *.cup)
       func_xform &quot;$libobj&quot;
       libobj=$func_xform_result
       ;;
@@ -1288,7 +1454,7 @@
     # Calculate the filename of the output object if compiler does
     # not support -o with -c
     if test &quot;$compiler_c_o&quot; = no; then
-      output_obj=`$ECHO &quot;X$srcfile&quot; | $Xsed -e 's%^.*/%%' -e 's%\.[^.]*$%%'`.${objext}
+      output_obj=`$ECHO &quot;$srcfile&quot; | $SED 's%^.*/%%; s%\.[^.]*$%%'`.${objext}
       lockfile=&quot;$output_obj.lock&quot;
     else
       output_obj=
@@ -1445,7 +1611,7 @@
 }
 
 $opt_help || {
-test &quot;$mode&quot; = compile &amp;&amp; func_mode_compile ${1+&quot;$@&quot;}
+  test &quot;$mode&quot; = compile &amp;&amp; func_mode_compile ${1+&quot;$@&quot;}
 }
 
 func_mode_help ()
@@ -1482,10 +1648,11 @@
 
   -o OUTPUT-FILE    set the output file name to OUTPUT-FILE
   -no-suppress      do not suppress compiler output for multiple passes
-  -prefer-pic       try to building PIC objects only
-  -prefer-non-pic   try to building non-PIC objects only
+  -prefer-pic       try to build PIC objects only
+  -prefer-non-pic   try to build non-PIC objects only
   -shared           do not build a \`.o' file suitable for static linking
   -static           only build a \`.o' file suitable for static linking
+  -Wc,FLAG          pass FLAG directly to the compiler
 
 COMPILE-COMMAND is a command to be used in creating a \`standard' object file
 from the given SOURCEFILE.
@@ -1538,7 +1705,7 @@
 
 The following components of INSTALL-COMMAND are treated specially:
 
-  -inst-prefix PREFIX-DIR  Use PREFIX-DIR as a staging area for installation
+  -inst-prefix-dir PREFIX-DIR  Use PREFIX-DIR as a staging area for installation
 
 The rest of the components are interpreted as arguments to that command (only
 BSD-compatible install options are recognized).&quot;
@@ -1558,6 +1725,8 @@
 
   -all-static       do not do any dynamic linking at all
   -avoid-version    do not add a version suffix if possible
+  -bindir BINDIR    specify path to binaries directory (for systems where
+                    libraries must be found in the PATH setting at runtime)
   -dlopen FILE      \`-dlpreopen' FILE if it cannot be dlopened at runtime
   -dlpreopen FILE   link in FILE and add its symbols to lt_preloaded_symbols
   -export-dynamic   allow symbols from OUTPUT-FILE to be resolved with dlsym(3)
@@ -1586,6 +1755,11 @@
   -version-info CURRENT[:REVISION[:AGE]]
                     specify library version info [each variable defaults to 0]
   -weak LIBNAME     declare that the target provides the LIBNAME interface
+  -Wc,FLAG
+  -Xcompiler FLAG   pass linker-specific FLAG directly to the compiler
+  -Wl,FLAG
+  -Xlinker FLAG     pass linker-specific FLAG directly to the linker
+  -XCClinker FLAG   pass link-specific FLAG to the compiler driver (CC)
 
 All other options (arguments beginning with \`-') are ignored.
 
@@ -1623,14 +1797,40 @@
         ;;
     esac
 
-    $ECHO
+    echo
     $ECHO &quot;Try \`$progname --help' for more information about other modes.&quot;
-
-    exit $?
 }
 
-  # Now that we've collected a possible --mode arg, show help if necessary
-  $opt_help &amp;&amp; func_mode_help
+# Now that we've collected a possible --mode arg, show help if necessary
+if $opt_help; then
+  if test &quot;$opt_help&quot; = :; then
+    func_mode_help
+  else
+    {
+      func_help noexit
+      for mode in compile link execute install finish uninstall clean; do
+	func_mode_help
+      done
+    } | sed -n '1p; 2,$s/^Usage:/  or: /p'
+    {
+      func_help noexit
+      for mode in compile link execute install finish uninstall clean; do
+	echo
+	func_mode_help
+      done
+    } |
+    sed '1d
+      /^When reporting/,/^Report/{
+	H
+	d
+      }
+      $x
+      /information about other modes/d
+      /more detailed .*MODE/d
+      s/^Usage:.*--mode=\([^ ]*\) .*/Description of \1 mode:/'
+  fi
+  exit $?
+fi
 
 
 # func_mode_execute arg...
@@ -1712,7 +1912,7 @@
     for file
     do
       case $file in
-      -*) ;;
+      -* | *.la | *.lo ) ;;
       *)
 	# Do a test to see if this is really a libtool program.
 	if func_ltwrapper_script_p &quot;$file&quot;; then
@@ -1754,7 +1954,7 @@
       # Display what would be done.
       if test -n &quot;$shlibpath_var&quot;; then
 	eval &quot;\$ECHO \&quot;\$shlibpath_var=\$$shlibpath_var\&quot;&quot;
-	$ECHO &quot;export $shlibpath_var&quot;
+	echo &quot;export $shlibpath_var&quot;
       fi
       $ECHO &quot;$cmd$args&quot;
       exit $EXIT_SUCCESS
@@ -1795,23 +1995,23 @@
     # Exit here if they wanted silent mode.
     $opt_silent &amp;&amp; exit $EXIT_SUCCESS
 
-    $ECHO &quot;X----------------------------------------------------------------------&quot; | $Xsed
-    $ECHO &quot;Libraries have been installed in:&quot;
+    echo &quot;----------------------------------------------------------------------&quot;
+    echo &quot;Libraries have been installed in:&quot;
     for libdir in $libdirs; do
       $ECHO &quot;   $libdir&quot;
     done
-    $ECHO
-    $ECHO &quot;If you ever happen to want to link against installed libraries&quot;
-    $ECHO &quot;in a given directory, LIBDIR, you must either use libtool, and&quot;
-    $ECHO &quot;specify the full pathname of the library, or use the \`-LLIBDIR'&quot;
-    $ECHO &quot;flag during linking and do at least one of the following:&quot;
+    echo
+    echo &quot;If you ever happen to want to link against installed libraries&quot;
+    echo &quot;in a given directory, LIBDIR, you must either use libtool, and&quot;
+    echo &quot;specify the full pathname of the library, or use the \`-LLIBDIR'&quot;
+    echo &quot;flag during linking and do at least one of the following:&quot;
     if test -n &quot;$shlibpath_var&quot;; then
-      $ECHO &quot;   - add LIBDIR to the \`$shlibpath_var' environment variable&quot;
-      $ECHO &quot;     during execution&quot;
+      echo &quot;   - add LIBDIR to the \`$shlibpath_var' environment variable&quot;
+      echo &quot;     during execution&quot;
     fi
     if test -n &quot;$runpath_var&quot;; then
-      $ECHO &quot;   - add LIBDIR to the \`$runpath_var' environment variable&quot;
-      $ECHO &quot;     during linking&quot;
+      echo &quot;   - add LIBDIR to the \`$runpath_var' environment variable&quot;
+      echo &quot;     during linking&quot;
     fi
     if test -n &quot;$hardcode_libdir_flag_spec&quot;; then
       libdir=LIBDIR
@@ -1823,21 +2023,21 @@
       $ECHO &quot;   - have your system administrator run these commands:$admincmds&quot;
     fi
     if test -f /etc/ld.so.conf; then
-      $ECHO &quot;   - have your system administrator add LIBDIR to \`/etc/ld.so.conf'&quot;
+      echo &quot;   - have your system administrator add LIBDIR to \`/etc/ld.so.conf'&quot;
     fi
-    $ECHO
+    echo
 
-    $ECHO &quot;See any operating system documentation about shared libraries for&quot;
+    echo &quot;See any operating system documentation about shared libraries for&quot;
     case $host in
       solaris2.[6789]|solaris2.1[0-9])
-        $ECHO &quot;more information, such as the ld(1), crle(1) and ld.so(8) manual&quot;
-	$ECHO &quot;pages.&quot;
+        echo &quot;more information, such as the ld(1), crle(1) and ld.so(8) manual&quot;
+	echo &quot;pages.&quot;
 	;;
       *)
-        $ECHO &quot;more information, such as the ld(1) and ld.so(8) manual pages.&quot;
+        echo &quot;more information, such as the ld(1) and ld.so(8) manual pages.&quot;
         ;;
     esac
-    $ECHO &quot;X----------------------------------------------------------------------&quot; | $Xsed
+    echo &quot;----------------------------------------------------------------------&quot;
     exit $EXIT_SUCCESS
 }
 
@@ -1852,7 +2052,7 @@
     # install_prog (especially on Windows NT).
     if test &quot;$nonopt&quot; = &quot;$SHELL&quot; || test &quot;$nonopt&quot; = /bin/sh ||
        # Allow the use of GNU shtool's install command.
-       $ECHO &quot;X$nonopt&quot; | $GREP shtool &gt;/dev/null; then
+       case $nonopt in *shtool*) :;; *) false;; esac; then
       # Aesthetically quote it.
       func_quote_for_eval &quot;$nonopt&quot;
       install_prog=&quot;$func_quote_for_eval_result &quot;
@@ -1867,6 +2067,11 @@
     # Aesthetically quote it.
     func_quote_for_eval &quot;$arg&quot;
     install_prog=&quot;$install_prog$func_quote_for_eval_result&quot;
+    install_shared_prog=$install_prog
+    case &quot; $install_prog &quot; in
+      *[\\\ /]cp\ *) install_cp=: ;;
+      *) install_cp=false ;;
+    esac
 
     # We need to accept at least all the BSD install flags.
     dest=
@@ -1876,8 +2081,10 @@
     install_type=
     isdir=no
     stripme=
+    no_mode=:
     for arg
     do
+      arg2=
       if test -n &quot;$dest&quot;; then
 	files=&quot;$files $dest&quot;
 	dest=$arg
@@ -1887,10 +2094,9 @@
       case $arg in
       -d) isdir=yes ;;
       -f)
-	case &quot; $install_prog &quot; in
-	*[\\\ /]cp\ *) ;;
-	*) prev=$arg ;;
-	esac
+	if $install_cp; then :; else
+	  prev=$arg
+	fi
 	;;
       -g | -m | -o)
 	prev=$arg
@@ -1904,6 +2110,10 @@
       *)
 	# If the previous option needed an argument, then skip it.
 	if test -n &quot;$prev&quot;; then
+	  if test &quot;x$prev&quot; = x-m &amp;&amp; test -n &quot;$install_override_mode&quot;; then
+	    arg2=$install_override_mode
+	    no_mode=false
+	  fi
 	  prev=
 	else
 	  dest=$arg
@@ -1915,6 +2125,10 @@
       # Aesthetically quote the argument.
       func_quote_for_eval &quot;$arg&quot;
       install_prog=&quot;$install_prog $func_quote_for_eval_result&quot;
+      if test -n &quot;$arg2&quot;; then
+	func_quote_for_eval &quot;$arg2&quot;
+      fi
+      install_shared_prog=&quot;$install_shared_prog $func_quote_for_eval_result&quot;
     done
 
     test -z &quot;$install_prog&quot; &amp;&amp; \
@@ -1923,6 +2137,13 @@
     test -n &quot;$prev&quot; &amp;&amp; \
       func_fatal_help &quot;the \`$prev' option requires an argument&quot;
 
+    if test -n &quot;$install_override_mode&quot; &amp;&amp; $no_mode; then
+      if $install_cp; then :; else
+	func_quote_for_eval &quot;$install_override_mode&quot;
+	install_shared_prog=&quot;$install_shared_prog -m $func_quote_for_eval_result&quot;
+      fi
+    fi
+
     if test -z &quot;$files&quot;; then
       if test -z &quot;$dest&quot;; then
 	func_fatal_help &quot;no file or destination specified&quot;
@@ -2010,7 +2231,7 @@
 
 	if test -n &quot;$relink_command&quot;; then
 	  # Determine the prefix the user has applied to our future dir.
-	  inst_prefix_dir=`$ECHO &quot;X$destdir&quot; | $Xsed -e &quot;s%$libdir\$%%&quot;`
+	  inst_prefix_dir=`$ECHO &quot;$destdir&quot; | $SED -e &quot;s%$libdir\$%%&quot;`
 
 	  # Don't allow the user to place us outside of our expected
 	  # location b/c this prevents finding dependent libraries that
@@ -2023,9 +2244,9 @@
 
 	  if test -n &quot;$inst_prefix_dir&quot;; then
 	    # Stick the inst_prefix_dir data into the link command.
-	    relink_command=`$ECHO &quot;X$relink_command&quot; | $Xsed -e &quot;s%@inst_prefix_dir@%-inst-prefix-dir $inst_prefix_dir%&quot;`
+	    relink_command=`$ECHO &quot;$relink_command&quot; | $SED &quot;s%@inst_prefix_dir@%-inst-prefix-dir $inst_prefix_dir%&quot;`
 	  else
-	    relink_command=`$ECHO &quot;X$relink_command&quot; | $Xsed -e &quot;s%@inst_prefix_dir@%%&quot;`
+	    relink_command=`$ECHO &quot;$relink_command&quot; | $SED &quot;s%@inst_prefix_dir@%%&quot;`
 	  fi
 
 	  func_warning &quot;relinking \`$file'&quot;
@@ -2043,7 +2264,7 @@
 	  test -n &quot;$relink_command&quot; &amp;&amp; srcname=&quot;$realname&quot;T
 
 	  # Install the shared library and build the symlinks.
-	  func_show_eval &quot;$install_prog $dir/$srcname $destdir/$realname&quot; \
+	  func_show_eval &quot;$install_shared_prog $dir/$srcname $destdir/$realname&quot; \
 	      'exit $?'
 	  tstripme=&quot;$stripme&quot;
 	  case $host_os in
@@ -2183,7 +2404,7 @@
 	    if test -f &quot;$lib&quot;; then
 	      func_source &quot;$lib&quot;
 	    fi
-	    libfile=&quot;$libdir/&quot;`$ECHO &quot;X$lib&quot; | $Xsed -e 's%^.*/%%g'` ### testsuite: skip nested quoting test
+	    libfile=&quot;$libdir/&quot;`$ECHO &quot;$lib&quot; | $SED 's%^.*/%%g'` ### testsuite: skip nested quoting test
 	    if test -n &quot;$libdir&quot; &amp;&amp; test ! -f &quot;$libfile&quot;; then
 	      func_warning &quot;\`$lib' has not been installed in \`$libdir'&quot;
 	      finalize=no
@@ -2202,7 +2423,7 @@
 		file=&quot;$func_basename_result&quot;
 	        outputname=&quot;$tmpdir/$file&quot;
 	        # Replace the output file specification.
-	        relink_command=`$ECHO &quot;X$relink_command&quot; | $Xsed -e 's%@OUTPUT@%'&quot;$outputname&quot;'%g'`
+	        relink_command=`$ECHO &quot;$relink_command&quot; | $SED 's%@OUTPUT@%'&quot;$outputname&quot;'%g'`
 
 	        $opt_silent || {
 	          func_quote_for_expand &quot;$relink_command&quot;
@@ -2221,7 +2442,7 @@
 	    }
 	  else
 	    # Install the binary that we compiled earlier.
-	    file=`$ECHO &quot;X$file$stripped_ext&quot; | $Xsed -e &quot;s%\([^/]*\)$%$objdir/\1%&quot;`
+	    file=`$ECHO &quot;$file$stripped_ext&quot; | $SED &quot;s%\([^/]*\)$%$objdir/\1%&quot;`
 	  fi
 	fi
 
@@ -2323,6 +2544,10 @@
 extern \&quot;C\&quot; {
 #endif
 
+#if defined(__GNUC__) &amp;&amp; (((__GNUC__ == 4) &amp;&amp; (__GNUC_MINOR__ &gt;= 4)) || (__GNUC__ &gt; 4))
+#pragma GCC diagnostic ignored \&quot;-Wstrict-prototypes\&quot;
+#endif
+
 /* External symbol declarations for the compiler. */\
 &quot;
 
@@ -2332,7 +2557,7 @@
 	  $opt_dry_run || echo ': @PROGRAM@ ' &gt; &quot;$nlist&quot;
 
 	  # Add our own program objects to the symbol list.
-	  progfiles=`$ECHO &quot;X$objs$old_deplibs&quot; | $SP2NL | $Xsed -e &quot;$lo2o&quot; | $NL2SP`
+	  progfiles=`$ECHO &quot;$objs$old_deplibs&quot; | $SP2NL | $SED &quot;$lo2o&quot; | $NL2SP`
 	  for progfile in $progfiles; do
 	    func_verbose &quot;extracting global C symbols from \`$progfile'&quot;
 	    $opt_dry_run || eval &quot;$NM $progfile | $global_symbol_pipe &gt;&gt; '$nlist'&quot;
@@ -2371,7 +2596,7 @@
 	      eval '$GREP -f &quot;$output_objdir/$outputname.exp&quot; &lt; &quot;$nlist&quot; &gt; &quot;$nlist&quot;T'
 	      eval '$MV &quot;$nlist&quot;T &quot;$nlist&quot;'
 	      case $host in
-	        *cygwin | *mingw* | *cegcc* )
+	        *cygwin* | *mingw* | *cegcc* )
 	          eval &quot;echo EXPORTS &quot;'&gt; &quot;$output_objdir/$outputname.def&quot;'
 	          eval 'cat &quot;$nlist&quot; &gt;&gt; &quot;$output_objdir/$outputname.def&quot;'
 	          ;;
@@ -2415,10 +2640,10 @@
 	  if test -f &quot;$nlist&quot;S; then
 	    eval &quot;$global_symbol_to_cdecl&quot;' &lt; &quot;$nlist&quot;S &gt;&gt; &quot;$output_objdir/$my_dlsyms&quot;'
 	  else
-	    $ECHO '/* NONE */' &gt;&gt; &quot;$output_objdir/$my_dlsyms&quot;
+	    echo '/* NONE */' &gt;&gt; &quot;$output_objdir/$my_dlsyms&quot;
 	  fi
 
-	  $ECHO &gt;&gt; &quot;$output_objdir/$my_dlsyms&quot; &quot;\
+	  echo &gt;&gt; &quot;$output_objdir/$my_dlsyms&quot; &quot;\
 
 /* The mapping between symbol names and symbols.  */
 typedef struct {
@@ -2428,7 +2653,7 @@
 &quot;
 	  case $host in
 	  *cygwin* | *mingw* | *cegcc* )
-	    $ECHO &gt;&gt; &quot;$output_objdir/$my_dlsyms&quot; &quot;\
+	    echo &gt;&gt; &quot;$output_objdir/$my_dlsyms&quot; &quot;\
 /* DATA imports from DLLs on WIN32 con't be const, because
    runtime relocations are performed -- see ld's documentation
    on pseudo-relocs.  */&quot;
@@ -2441,7 +2666,7 @@
 	    lt_dlsym_const=const ;;
 	  esac
 
-	  $ECHO &gt;&gt; &quot;$output_objdir/$my_dlsyms&quot; &quot;\
+	  echo &gt;&gt; &quot;$output_objdir/$my_dlsyms&quot; &quot;\
 extern $lt_dlsym_const lt_dlsymlist
 lt_${my_prefix}_LTX_preloaded_symbols[];
 $lt_dlsym_const lt_dlsymlist
@@ -2457,7 +2682,7 @@
 	    eval &quot;$global_symbol_to_c_name_address_lib_prefix&quot; &lt; &quot;$nlist&quot; &gt;&gt; &quot;$output_objdir/$my_dlsyms&quot;
 	    ;;
 	  esac
-	  $ECHO &gt;&gt; &quot;$output_objdir/$my_dlsyms&quot; &quot;\
+	  echo &gt;&gt; &quot;$output_objdir/$my_dlsyms&quot; &quot;\
   {0, (void *) 0}
 };
 
@@ -2515,16 +2740,16 @@
 	case $host in
 	*cygwin* | *mingw* | *cegcc* )
 	  if test -f &quot;$output_objdir/$my_outputname.def&quot;; then
-	    compile_command=`$ECHO &quot;X$compile_command&quot; | $Xsed -e &quot;s%@SYMFILE@%$output_objdir/$my_outputname.def $symfileobj%&quot;`
-	    finalize_command=`$ECHO &quot;X$finalize_command&quot; | $Xsed -e &quot;s%@SYMFILE@%$output_objdir/$my_outputname.def $symfileobj%&quot;`
+	    compile_command=`$ECHO &quot;$compile_command&quot; | $SED &quot;s%@SYMFILE@%$output_objdir/$my_outputname.def $symfileobj%&quot;`
+	    finalize_command=`$ECHO &quot;$finalize_command&quot; | $SED &quot;s%@SYMFILE@%$output_objdir/$my_outputname.def $symfileobj%&quot;`
 	  else
-	    compile_command=`$ECHO &quot;X$compile_command&quot; | $Xsed -e &quot;s%@SYMFILE@%$symfileobj%&quot;`
-	    finalize_command=`$ECHO &quot;X$finalize_command&quot; | $Xsed -e &quot;s%@SYMFILE@%$symfileobj%&quot;`
+	    compile_command=`$ECHO &quot;$compile_command&quot; | $SED &quot;s%@SYMFILE@%$symfileobj%&quot;`
+	    finalize_command=`$ECHO &quot;$finalize_command&quot; | $SED &quot;s%@SYMFILE@%$symfileobj%&quot;`
 	  fi
 	  ;;
 	*)
-	  compile_command=`$ECHO &quot;X$compile_command&quot; | $Xsed -e &quot;s%@SYMFILE@%$symfileobj%&quot;`
-	  finalize_command=`$ECHO &quot;X$finalize_command&quot; | $Xsed -e &quot;s%@SYMFILE@%$symfileobj%&quot;`
+	  compile_command=`$ECHO &quot;$compile_command&quot; | $SED &quot;s%@SYMFILE@%$symfileobj%&quot;`
+	  finalize_command=`$ECHO &quot;$finalize_command&quot; | $SED &quot;s%@SYMFILE@%$symfileobj%&quot;`
 	  ;;
 	esac
 	;;
@@ -2538,8 +2763,8 @@
       # really was required.
 
       # Nullify the symbol file.
-      compile_command=`$ECHO &quot;X$compile_command&quot; | $Xsed -e &quot;s% @SYMFILE@%%&quot;`
-      finalize_command=`$ECHO &quot;X$finalize_command&quot; | $Xsed -e &quot;s% @SYMFILE@%%&quot;`
+      compile_command=`$ECHO &quot;$compile_command&quot; | $SED &quot;s% @SYMFILE@%%&quot;`
+      finalize_command=`$ECHO &quot;$finalize_command&quot; | $SED &quot;s% @SYMFILE@%%&quot;`
     fi
 }
 
@@ -2549,6 +2774,7 @@
 # Need a lot of goo to handle *both* DLLs and import libs
 # Has to be a shell function in order to 'eat' the argument
 # that is supplied when $file_magic_command is called.
+# Despite the name, also deal with 64 bit binaries.
 func_win32_libid ()
 {
   $opt_debug
@@ -2559,8 +2785,9 @@
     win32_libid_type=&quot;x86 archive import&quot;
     ;;
   *ar\ archive*) # could be an import, or static
+    # Keep the egrep pattern in sync with the one in _LT_CHECK_MAGIC_METHOD.
     if eval $OBJDUMP -f $1 | $SED -e '10q' 2&gt;/dev/null |
-       $EGREP 'file format pe-i386(.*architecture: i386)?' &gt;/dev/null ; then
+       $EGREP 'file format (pei*-i386(.*architecture: i386)?|pe-arm-wince|pe-x86-64)' &gt;/dev/null; then
       win32_nmres=`eval $NM -f posix -A $1 |
 	$SED -n -e '
 	    1,100{
@@ -2598,7 +2825,18 @@
     $opt_debug
     f_ex_an_ar_dir=&quot;$1&quot;; shift
     f_ex_an_ar_oldlib=&quot;$1&quot;
-    func_show_eval &quot;(cd \$f_ex_an_ar_dir &amp;&amp; $AR x \&quot;\$f_ex_an_ar_oldlib\&quot;)&quot; 'exit $?'
+    if test &quot;$lock_old_archive_extraction&quot; = yes; then
+      lockfile=$f_ex_an_ar_oldlib.lock
+      until $opt_dry_run || ln &quot;$progpath&quot; &quot;$lockfile&quot; 2&gt;/dev/null; do
+	func_echo &quot;Waiting for $lockfile to be removed&quot;
+	sleep 2
+      done
+    fi
+    func_show_eval &quot;(cd \$f_ex_an_ar_dir &amp;&amp; $AR x \&quot;\$f_ex_an_ar_oldlib\&quot;)&quot; \
+		   'stat=$?; rm -f &quot;$lockfile&quot;; exit $stat'
+    if test &quot;$lock_old_archive_extraction&quot; = yes; then
+      $opt_dry_run || rm -f &quot;$lockfile&quot;
+    fi
     if ($AR t &quot;$f_ex_an_ar_oldlib&quot; | sort | sort -uc &gt;/dev/null 2&gt;&amp;1); then
      :
     else
@@ -2669,7 +2907,7 @@
 	    darwin_file=
 	    darwin_files=
 	    for darwin_file in $darwin_filelist; do
-	      darwin_files=`find unfat-$$ -name $darwin_file -print | $NL2SP`
+	      darwin_files=`find unfat-$$ -name $darwin_file -print | sort | $NL2SP`
 	      $LIPO -create -output &quot;$darwin_file&quot; $darwin_files
 	    done # $darwin_filelist
 	    $RM -rf unfat-$$
@@ -2684,25 +2922,30 @@
         func_extract_an_archive &quot;$my_xdir&quot; &quot;$my_xabs&quot;
 	;;
       esac
-      my_oldobjs=&quot;$my_oldobjs &quot;`find $my_xdir -name \*.$objext -print -o -name \*.lo -print | $NL2SP`
+      my_oldobjs=&quot;$my_oldobjs &quot;`find $my_xdir -name \*.$objext -print -o -name \*.lo -print | sort | $NL2SP`
     done
 
     func_extract_archives_result=&quot;$my_oldobjs&quot;
 }
 
 
-
-# func_emit_wrapper_part1 [arg=no]
+# func_emit_wrapper [arg=no]
 #
-# Emit the first part of a libtool wrapper script on stdout.
-# For more information, see the description associated with
-# func_emit_wrapper(), below.
-func_emit_wrapper_part1 ()
+# Emit a libtool wrapper script on stdout.
+# Don't directly open a file because we may want to
+# incorporate the script contents within a cygwin/mingw
+# wrapper executable.  Must ONLY be called from within
+# func_mode_link because it depends on a number of variables
+# set therein.
+#
+# ARG is the value that the WRAPPER_SCRIPT_BELONGS_IN_OBJDIR
+# variable will take.  If 'yes', then the emitted script
+# will assume that the directory in which it is stored is
+# the $objdir directory.  This is a cygwin/mingw-specific
+# behavior.
+func_emit_wrapper ()
 {
-	func_emit_wrapper_part1_arg1=no
-	if test -n &quot;$1&quot; ; then
-	  func_emit_wrapper_part1_arg1=$1
-	fi
+	func_emit_wrapper_arg1=${1-no}
 
 	$ECHO &quot;\
 #! $SHELL
@@ -2718,7 +2961,6 @@
 
 # Sed substitution that helps us do robust quoting.  It backslashifies
 # metacharacters that are still active within double-quoted strings.
-Xsed='${SED} -e 1s/^X//'
 sed_quote_subst='$sed_quote_subst'
 
 # Be Bourne compatible
@@ -2749,31 +2991,132 @@
 else
   # When we are sourced in execute mode, \$file and \$ECHO are already set.
   if test \&quot;\$libtool_execute_magic\&quot; != \&quot;$magic\&quot;; then
-    ECHO=\&quot;$qecho\&quot;
-    file=\&quot;\$0\&quot;
-    # Make sure echo works.
-    if test \&quot;X\$1\&quot; = X--no-reexec; then
-      # Discard the --no-reexec flag, and continue.
-      shift
-    elif test \&quot;X\`{ \$ECHO '\t'; } 2&gt;/dev/null\`\&quot; = 'X\t'; then
-      # Yippee, \$ECHO works!
-      :
-    else
-      # Restart under the correct shell, and then maybe \$ECHO will work.
-      exec $SHELL \&quot;\$0\&quot; --no-reexec \${1+\&quot;\$@\&quot;}
-    fi
-  fi\
+    file=\&quot;\$0\&quot;&quot;
+
+    qECHO=`$ECHO &quot;$ECHO&quot; | $SED &quot;$sed_quote_subst&quot;`
+    $ECHO &quot;\
+
+# A function that is used when there is no print builtin or printf.
+func_fallback_echo ()
+{
+  eval 'cat &lt;&lt;_LTECHO_EOF
+\$1
+_LTECHO_EOF'
+}
+    ECHO=\&quot;$qECHO\&quot;
+  fi
+
+# Very basic option parsing. These options are (a) specific to
+# the libtool wrapper, (b) are identical between the wrapper
+# /script/ and the wrapper /executable/ which is used only on
+# windows platforms, and (c) all begin with the string &quot;--lt-&quot;
+# (application programs are unlikely to have options which match
+# this pattern).
+#
+# There are only two supported options: --lt-debug and
+# --lt-dump-script. There is, deliberately, no --lt-help.
+#
+# The first argument to this parsing function should be the
+# script's $0 value, followed by &quot;$@&quot;.
+lt_option_debug=
+func_parse_lt_options ()
+{
+  lt_script_arg0=\$0
+  shift
+  for lt_opt
+  do
+    case \&quot;\$lt_opt\&quot; in
+    --lt-debug) lt_option_debug=1 ;;
+    --lt-dump-script)
+        lt_dump_D=\`\$ECHO \&quot;X\$lt_script_arg0\&quot; | $SED -e 's/^X//' -e 's%/[^/]*$%%'\`
+        test \&quot;X\$lt_dump_D\&quot; = \&quot;X\$lt_script_arg0\&quot; &amp;&amp; lt_dump_D=.
+        lt_dump_F=\`\$ECHO \&quot;X\$lt_script_arg0\&quot; | $SED -e 's/^X//' -e 's%^.*/%%'\`
+        cat \&quot;\$lt_dump_D/\$lt_dump_F\&quot;
+        exit 0
+      ;;
+    --lt-*)
+        \$ECHO \&quot;Unrecognized --lt- option: '\$lt_opt'\&quot; 1&gt;&amp;2
+        exit 1
+      ;;
+    esac
+  done
+
+  # Print the debug banner immediately:
+  if test -n \&quot;\$lt_option_debug\&quot;; then
+    echo \&quot;${outputname}:${output}:\${LINENO}: libtool wrapper (GNU $PACKAGE$TIMESTAMP) $VERSION\&quot; 1&gt;&amp;2
+  fi
+}
+
+# Used when --lt-debug. Prints its arguments to stdout
+# (redirection is the responsibility of the caller)
+func_lt_dump_args ()
+{
+  lt_dump_args_N=1;
+  for lt_arg
+  do
+    \$ECHO \&quot;${outputname}:${output}:\${LINENO}: newargv[\$lt_dump_args_N]: \$lt_arg\&quot;
+    lt_dump_args_N=\`expr \$lt_dump_args_N + 1\`
+  done
+}
+
+# Core function for launching the target application
+func_exec_program_core ()
+{
 &quot;
-	$ECHO &quot;\
+  case $host in
+  # Backslashes separate directories on plain windows
+  *-*-mingw | *-*-os2* | *-cegcc*)
+    $ECHO &quot;\
+      if test -n \&quot;\$lt_option_debug\&quot;; then
+        \$ECHO \&quot;${outputname}:${output}:\${LINENO}: newargv[0]: \$progdir\\\\\$program\&quot; 1&gt;&amp;2
+        func_lt_dump_args \${1+\&quot;\$@\&quot;} 1&gt;&amp;2
+      fi
+      exec \&quot;\$progdir\\\\\$program\&quot; \${1+\&quot;\$@\&quot;}
+&quot;
+    ;;
 
+  *)
+    $ECHO &quot;\
+      if test -n \&quot;\$lt_option_debug\&quot;; then
+        \$ECHO \&quot;${outputname}:${output}:\${LINENO}: newargv[0]: \$progdir/\$program\&quot; 1&gt;&amp;2
+        func_lt_dump_args \${1+\&quot;\$@\&quot;} 1&gt;&amp;2
+      fi
+      exec \&quot;\$progdir/\$program\&quot; \${1+\&quot;\$@\&quot;}
+&quot;
+    ;;
+  esac
+  $ECHO &quot;\
+      \$ECHO \&quot;\$0: cannot exec \$program \$*\&quot; 1&gt;&amp;2
+      exit 1
+}
+
+# A function to encapsulate launching the target application
+# Strips options in the --lt-* namespace from \$@ and
+# launches target application with the remaining arguments.
+func_exec_program ()
+{
+  for lt_wr_arg
+  do
+    case \$lt_wr_arg in
+    --lt-*) ;;
+    *) set x \&quot;\$@\&quot; \&quot;\$lt_wr_arg\&quot;; shift;;
+    esac
+    shift
+  done
+  func_exec_program_core \${1+\&quot;\$@\&quot;}
+}
+
+  # Parse options
+  func_parse_lt_options \&quot;\$0\&quot; \${1+\&quot;\$@\&quot;}
+
   # Find the directory that this script lives in.
-  thisdir=\`\$ECHO \&quot;X\$file\&quot; | \$Xsed -e 's%/[^/]*$%%'\`
+  thisdir=\`\$ECHO \&quot;\$file\&quot; | $SED 's%/[^/]*$%%'\`
   test \&quot;x\$thisdir\&quot; = \&quot;x\$file\&quot; &amp;&amp; thisdir=.
 
   # Follow symbolic links until we get to the real thisdir.
-  file=\`ls -ld \&quot;\$file\&quot; | ${SED} -n 's/.*-&gt; //p'\`
+  file=\`ls -ld \&quot;\$file\&quot; | $SED -n 's/.*-&gt; //p'\`
   while test -n \&quot;\$file\&quot;; do
-    destdir=\`\$ECHO \&quot;X\$file\&quot; | \$Xsed -e 's%/[^/]*\$%%'\`
+    destdir=\`\$ECHO \&quot;\$file\&quot; | $SED 's%/[^/]*\$%%'\`
 
     # If there was a directory component, then change thisdir.
     if test \&quot;x\$destdir\&quot; != \&quot;x\$file\&quot;; then
@@ -2783,30 +3126,13 @@
       esac
     fi
 
-    file=\`\$ECHO \&quot;X\$file\&quot; | \$Xsed -e 's%^.*/%%'\`
-    file=\`ls -ld \&quot;\$thisdir/\$file\&quot; | ${SED} -n 's/.*-&gt; //p'\`
+    file=\`\$ECHO \&quot;\$file\&quot; | $SED 's%^.*/%%'\`
+    file=\`ls -ld \&quot;\$thisdir/\$file\&quot; | $SED -n 's/.*-&gt; //p'\`
   done
-&quot;
-}
-# end: func_emit_wrapper_part1
 
-# func_emit_wrapper_part2 [arg=no]
-#
-# Emit the second part of a libtool wrapper script on stdout.
-# For more information, see the description associated with
-# func_emit_wrapper(), below.
-func_emit_wrapper_part2 ()
-{
-	func_emit_wrapper_part2_arg1=no
-	if test -n &quot;$1&quot; ; then
-	  func_emit_wrapper_part2_arg1=$1
-	fi
-
-	$ECHO &quot;\
-
   # Usually 'no', except on cygwin/mingw when embedded into
   # the cwrapper.
-  WRAPPER_SCRIPT_BELONGS_IN_OBJDIR=$func_emit_wrapper_part2_arg1
+  WRAPPER_SCRIPT_BELONGS_IN_OBJDIR=$func_emit_wrapper_arg1
   if test \&quot;\$WRAPPER_SCRIPT_BELONGS_IN_OBJDIR\&quot; = \&quot;yes\&quot;; then
     # special case for '.'
     if test \&quot;\$thisdir\&quot; = \&quot;.\&quot;; then
@@ -2814,7 +3140,7 @@
     fi
     # remove .libs from thisdir
     case \&quot;\$thisdir\&quot; in
-    *[\\\\/]$objdir ) thisdir=\`\$ECHO \&quot;X\$thisdir\&quot; | \$Xsed -e 's%[\\\\/][^\\\\/]*$%%'\` ;;
+    *[\\\\/]$objdir ) thisdir=\`\$ECHO \&quot;\$thisdir\&quot; | $SED 's%[\\\\/][^\\\\/]*$%%'\` ;;
     $objdir )   thisdir=. ;;
     esac
   fi
@@ -2877,7 +3203,7 @@
 
     # Some systems cannot cope with colon-terminated $shlibpath_var
     # The second colon is a workaround for a bug in BeOS R4 sed
-    $shlibpath_var=\`\$ECHO \&quot;X\$$shlibpath_var\&quot; | \$Xsed -e 's/::*\$//'\`
+    $shlibpath_var=\`\$ECHO \&quot;\$$shlibpath_var\&quot; | $SED 's/::*\$//'\`
 
     export $shlibpath_var
 &quot;
@@ -2894,66 +3220,20 @@
 	$ECHO &quot;\
     if test \&quot;\$libtool_execute_magic\&quot; != \&quot;$magic\&quot;; then
       # Run the actual program with our arguments.
-&quot;
-	case $host in
-	# Backslashes separate directories on plain windows
-	*-*-mingw | *-*-os2* | *-cegcc*)
-	  $ECHO &quot;\
-      exec \&quot;\$progdir\\\\\$program\&quot; \${1+\&quot;\$@\&quot;}
-&quot;
-	  ;;
-
-	*)
-	  $ECHO &quot;\
-      exec \&quot;\$progdir/\$program\&quot; \${1+\&quot;\$@\&quot;}
-&quot;
-	  ;;
-	esac
-	$ECHO &quot;\
-      \$ECHO \&quot;\$0: cannot exec \$program \$*\&quot; 1&gt;&amp;2
-      exit 1
+      func_exec_program \${1+\&quot;\$@\&quot;}
     fi
   else
     # The program doesn't exist.
     \$ECHO \&quot;\$0: error: \\\`\$progdir/\$program' does not exist\&quot; 1&gt;&amp;2
     \$ECHO \&quot;This script is just a wrapper for \$program.\&quot; 1&gt;&amp;2
-    $ECHO \&quot;See the $PACKAGE documentation for more information.\&quot; 1&gt;&amp;2
+    \$ECHO \&quot;See the $PACKAGE documentation for more information.\&quot; 1&gt;&amp;2
     exit 1
   fi
 fi\
 &quot;
 }
-# end: func_emit_wrapper_part2
 
 
-# func_emit_wrapper [arg=no]
-#
-# Emit a libtool wrapper script on stdout.
-# Don't directly open a file because we may want to
-# incorporate the script contents within a cygwin/mingw
-# wrapper executable.  Must ONLY be called from within
-# func_mode_link because it depends on a number of variables
-# set therein.
-#
-# ARG is the value that the WRAPPER_SCRIPT_BELONGS_IN_OBJDIR
-# variable will take.  If 'yes', then the emitted script
-# will assume that the directory in which it is stored is
-# the $objdir directory.  This is a cygwin/mingw-specific
-# behavior.
-func_emit_wrapper ()
-{
-	func_emit_wrapper_arg1=no
-	if test -n &quot;$1&quot; ; then
-	  func_emit_wrapper_arg1=$1
-	fi
-
-	# split this up so that func_emit_cwrapperexe_src
-	# can call each part independently.
-	func_emit_wrapper_part1 &quot;${func_emit_wrapper_arg1}&quot;
-	func_emit_wrapper_part2 &quot;${func_emit_wrapper_arg1}&quot;
-}
-
-
 # func_to_host_path arg
 #
 # Convert paths to host format when used with build tools.
@@ -2978,23 +3258,19 @@
 func_to_host_path ()
 {
   func_to_host_path_result=&quot;$1&quot;
-  if test -n &quot;$1&quot; ; then
+  if test -n &quot;$1&quot;; then
     case $host in
       *mingw* )
         lt_sed_naive_backslashify='s|\\\\*|\\|g;s|/|\\|g;s|\\|\\\\|g'
         case $build in
           *mingw* ) # actually, msys
             # awkward: cmd appends spaces to result
-            lt_sed_strip_trailing_spaces=&quot;s/[ ]*\$//&quot;
-            func_to_host_path_tmp1=`( cmd //c echo &quot;$1&quot; |\
-              $SED -e &quot;$lt_sed_strip_trailing_spaces&quot; ) 2&gt;/dev/null || echo &quot;&quot;`
-            func_to_host_path_result=`echo &quot;$func_to_host_path_tmp1&quot; |\
-              $SED -e &quot;$lt_sed_naive_backslashify&quot;`
+            func_to_host_path_result=`( cmd //c echo &quot;$1&quot; ) 2&gt;/dev/null |
+              $SED -e 's/[ ]*$//' -e &quot;$lt_sed_naive_backslashify&quot;`
             ;;
           *cygwin* )
-            func_to_host_path_tmp1=`cygpath -w &quot;$1&quot;`
-            func_to_host_path_result=`echo &quot;$func_to_host_path_tmp1&quot; |\
-              $SED -e &quot;$lt_sed_naive_backslashify&quot;`
+            func_to_host_path_result=`cygpath -w &quot;$1&quot; |
+	      $SED -e &quot;$lt_sed_naive_backslashify&quot;`
             ;;
           * )
             # Unfortunately, winepath does not exit with a non-zero
@@ -3006,17 +3282,17 @@
             # the odd construction:
             func_to_host_path_tmp1=`winepath -w &quot;$1&quot; 2&gt;/dev/null`
             if test &quot;$?&quot; -eq 0 &amp;&amp; test -n &quot;${func_to_host_path_tmp1}&quot;; then
-              func_to_host_path_result=`echo &quot;$func_to_host_path_tmp1&quot; |\
+              func_to_host_path_result=`$ECHO &quot;$func_to_host_path_tmp1&quot; |
                 $SED -e &quot;$lt_sed_naive_backslashify&quot;`
             else
               # Allow warning below.
-              func_to_host_path_result=&quot;&quot;
+              func_to_host_path_result=
             fi
             ;;
         esac
         if test -z &quot;$func_to_host_path_result&quot; ; then
           func_error &quot;Could not determine host path corresponding to&quot;
-          func_error &quot;  '$1'&quot;
+          func_error &quot;  \`$1'&quot;
           func_error &quot;Continuing, but uninstalled executables may not work.&quot;
           # Fallback:
           func_to_host_path_result=&quot;$1&quot;
@@ -3049,30 +3325,24 @@
 func_to_host_pathlist ()
 {
   func_to_host_pathlist_result=&quot;$1&quot;
-  if test -n &quot;$1&quot; ; then
+  if test -n &quot;$1&quot;; then
     case $host in
       *mingw* )
         lt_sed_naive_backslashify='s|\\\\*|\\|g;s|/|\\|g;s|\\|\\\\|g'
         # Remove leading and trailing path separator characters from
         # ARG. msys behavior is inconsistent here, cygpath turns them
         # into '.;' and ';.', and winepath ignores them completely.
-        func_to_host_pathlist_tmp2=&quot;$1&quot;
-        # Once set for this call, this variable should not be
-        # reassigned. It is used in tha fallback case.
-        func_to_host_pathlist_tmp1=`echo &quot;$func_to_host_pathlist_tmp2&quot; |\
-          $SED -e 's|^:*||' -e 's|:*$||'`
+	func_stripname : : &quot;$1&quot;
+        func_to_host_pathlist_tmp1=$func_stripname_result
         case $build in
           *mingw* ) # Actually, msys.
             # Awkward: cmd appends spaces to result.
-            lt_sed_strip_trailing_spaces=&quot;s/[ ]*\$//&quot;
-            func_to_host_pathlist_tmp2=`( cmd //c echo &quot;$func_to_host_pathlist_tmp1&quot; |\
-              $SED -e &quot;$lt_sed_strip_trailing_spaces&quot; ) 2&gt;/dev/null || echo &quot;&quot;`
-            func_to_host_pathlist_result=`echo &quot;$func_to_host_pathlist_tmp2&quot; |\
-              $SED -e &quot;$lt_sed_naive_backslashify&quot;`
+            func_to_host_pathlist_result=`
+	      ( cmd //c echo &quot;$func_to_host_pathlist_tmp1&quot; ) 2&gt;/dev/null |
+	      $SED -e 's/[ ]*$//' -e &quot;$lt_sed_naive_backslashify&quot;`
             ;;
           *cygwin* )
-            func_to_host_pathlist_tmp2=`cygpath -w -p &quot;$func_to_host_pathlist_tmp1&quot;`
-            func_to_host_pathlist_result=`echo &quot;$func_to_host_pathlist_tmp2&quot; |\
+            func_to_host_pathlist_result=`cygpath -w -p &quot;$func_to_host_pathlist_tmp1&quot; |
               $SED -e &quot;$lt_sed_naive_backslashify&quot;`
             ;;
           * )
@@ -3088,18 +3358,17 @@
                   if test -z &quot;$func_to_host_pathlist_result&quot; ; then
                     func_to_host_pathlist_result=&quot;$func_to_host_path_result&quot;
                   else
-                    func_to_host_pathlist_result=&quot;$func_to_host_pathlist_result;$func_to_host_path_result&quot;
+                    func_append func_to_host_pathlist_result &quot;;$func_to_host_path_result&quot;
                   fi
                 fi
               fi
-              IFS=:
             done
             IFS=$func_to_host_pathlist_oldIFS
             ;;
         esac
-        if test -z &quot;$func_to_host_pathlist_result&quot; ; then
+        if test -z &quot;$func_to_host_pathlist_result&quot;; then
           func_error &quot;Could not determine the host path(s) corresponding to&quot;
-          func_error &quot;  '$1'&quot;
+          func_error &quot;  \`$1'&quot;
           func_error &quot;Continuing, but uninstalled executables may not work.&quot;
           # Fallback. This may break if $1 contains DOS-style drive
           # specifications. The fix is not to complicate the expression
@@ -3116,7 +3385,7 @@
             ;;
         esac
         case &quot;$1&quot; in
-          *: ) func_to_host_pathlist_result=&quot;$func_to_host_pathlist_result;&quot;
+          *: ) func_append func_to_host_pathlist_result &quot;;&quot;
             ;;
         esac
         ;;
@@ -3141,31 +3410,23 @@
 
    This wrapper executable should never be moved out of the build directory.
    If it is, it will not operate correctly.
-
-   Currently, it simply execs the wrapper *script* &quot;$SHELL $output&quot;,
-   but could eventually absorb all of the scripts functionality and
-   exec $objdir/$outputname directly.
 */
 EOF
 	    cat &lt;&lt;&quot;EOF&quot;
+#ifdef _MSC_VER
+# define _CRT_SECURE_NO_DEPRECATE 1
+#endif
 #include &lt;stdio.h&gt;
 #include &lt;stdlib.h&gt;
 #ifdef _MSC_VER
 # include &lt;direct.h&gt;
 # include &lt;process.h&gt;
 # include &lt;io.h&gt;
-# define setmode _setmode
 #else
 # include &lt;unistd.h&gt;
 # include &lt;stdint.h&gt;
 # ifdef __CYGWIN__
 #  include &lt;io.h&gt;
-#  define HAVE_SETENV
-#  ifdef __STRICT_ANSI__
-char *realpath (const char *, char *);
-int putenv (char *);
-int setenv (const char *, const char *, int);
-#  endif
 # endif
 #endif
 #include &lt;malloc.h&gt;
@@ -3177,6 +3438,44 @@
 #include &lt;fcntl.h&gt;
 #include &lt;sys/stat.h&gt;
 
+/* declarations of non-ANSI functions */
+#if defined(__MINGW32__)
+# ifdef __STRICT_ANSI__
+int _putenv (const char *);
+# endif
+#elif defined(__CYGWIN__)
+# ifdef __STRICT_ANSI__
+char *realpath (const char *, char *);
+int putenv (char *);
+int setenv (const char *, const char *, int);
+# endif
+/* #elif defined (other platforms) ... */
+#endif
+
+/* portability defines, excluding path handling macros */
+#if defined(_MSC_VER)
+# define setmode _setmode
+# define stat    _stat
+# define chmod   _chmod
+# define getcwd  _getcwd
+# define putenv  _putenv
+# define S_IXUSR _S_IEXEC
+# ifndef _INTPTR_T_DEFINED
+#  define _INTPTR_T_DEFINED
+#  define intptr_t int
+# endif
+#elif defined(__MINGW32__)
+# define setmode _setmode
+# define stat    _stat
+# define chmod   _chmod
+# define getcwd  _getcwd
+# define putenv  _putenv
+#elif defined(__CYGWIN__)
+# define HAVE_SETENV
+# define FOPEN_WB &quot;wb&quot;
+/* #elif defined (other platforms) ... */
+#endif
+
 #if defined(PATH_MAX)
 # define LT_PATHMAX PATH_MAX
 #elif defined(MAXPATHLEN)
@@ -3192,14 +3491,7 @@
 # define S_IXGRP 0
 #endif
 
-#ifdef _MSC_VER
-# define S_IXUSR _S_IEXEC
-# define stat _stat
-# ifndef _INTPTR_T_DEFINED
-#  define intptr_t int
-# endif
-#endif
-
+/* path handling portability macros */
 #ifndef DIR_SEPARATOR
 # define DIR_SEPARATOR '/'
 # define PATH_SEPARATOR ':'
@@ -3230,10 +3522,6 @@
 # define IS_PATH_SEPARATOR(ch) ((ch) == PATH_SEPARATOR_2)
 #endif /* PATH_SEPARATOR_2 */
 
-#ifdef __CYGWIN__
-# define FOPEN_WB &quot;wb&quot;
-#endif
-
 #ifndef FOPEN_WB
 # define FOPEN_WB &quot;w&quot;
 #endif
@@ -3246,22 +3534,13 @@
   if (stale) { free ((void *) stale); stale = 0; } \
 } while (0)
 
-#undef LTWRAPPER_DEBUGPRINTF
-#if defined DEBUGWRAPPER
-# define LTWRAPPER_DEBUGPRINTF(args) ltwrapper_debugprintf args
-static void
-ltwrapper_debugprintf (const char *fmt, ...)
-{
-    va_list args;
-    va_start (args, fmt);
-    (void) vfprintf (stderr, fmt, args);
-    va_end (args);
-}
+#if defined(LT_DEBUGWRAPPER)
+static int lt_debug = 1;
 #else
-# define LTWRAPPER_DEBUGPRINTF(args)
+static int lt_debug = 0;
 #endif
 
-const char *program_name = NULL;
+const char *program_name = &quot;libtool-wrapper&quot;; /* in case xstrdup fails */
 
 void *xmalloc (size_t num);
 char *xstrdup (const char *string);
@@ -3271,33 +3550,19 @@
 int make_executable (const char *path);
 int check_executable (const char *path);
 char *strendzap (char *str, const char *pat);
-void lt_fatal (const char *message, ...);
+void lt_debugprintf (const char *file, int line, const char *fmt, ...);
+void lt_fatal (const char *file, int line, const char *message, ...);
+static const char *nonnull (const char *s);
+static const char *nonempty (const char *s);
 void lt_setenv (const char *name, const char *value);
 char *lt_extend_str (const char *orig_value, const char *add, int to_end);
-void lt_opt_process_env_set (const char *arg);
-void lt_opt_process_env_prepend (const char *arg);
-void lt_opt_process_env_append (const char *arg);
-int lt_split_name_value (const char *arg, char** name, char** value);
 void lt_update_exe_path (const char *name, const char *value);
 void lt_update_lib_path (const char *name, const char *value);
-
-static const char *script_text_part1 =
+char **prepare_spawn (char **argv);
+void lt_dump_script (FILE *f);
 EOF
 
-	    func_emit_wrapper_part1 yes |
-	        $SED -e 's/\([\\&quot;]\)/\\\1/g' \
-	             -e 's/^/  &quot;/' -e 's/$/\\n&quot;/'
-	    echo &quot;;&quot;
 	    cat &lt;&lt;EOF
-
-static const char *script_text_part2 =
-EOF
-	    func_emit_wrapper_part2 yes |
-	        $SED -e 's/\([\\&quot;]\)/\\\1/g' \
-	             -e 's/^/  &quot;/' -e 's/$/\\n&quot;/'
-	    echo &quot;;&quot;
-
-	    cat &lt;&lt;EOF
 const char * MAGIC_EXE = &quot;$magic_exe&quot;;
 const char * LIB_PATH_VARNAME = &quot;$shlibpath_var&quot;;
 EOF
@@ -3340,25 +3605,11 @@
 	    cat &lt;&lt;&quot;EOF&quot;
 
 #define LTWRAPPER_OPTION_PREFIX         &quot;--lt-&quot;
-#define LTWRAPPER_OPTION_PREFIX_LENGTH  5
 
-static const size_t opt_prefix_len         = LTWRAPPER_OPTION_PREFIX_LENGTH;
 static const char *ltwrapper_option_prefix = LTWRAPPER_OPTION_PREFIX;
-
 static const char *dumpscript_opt       = LTWRAPPER_OPTION_PREFIX &quot;dump-script&quot;;
+static const char *debug_opt            = LTWRAPPER_OPTION_PREFIX &quot;debug&quot;;
 
-static const size_t env_set_opt_len     = LTWRAPPER_OPTION_PREFIX_LENGTH + 7;
-static const char *env_set_opt          = LTWRAPPER_OPTION_PREFIX &quot;env-set&quot;;
-  /* argument is putenv-style &quot;foo=bar&quot;, value of foo is set to bar */
-
-static const size_t env_prepend_opt_len = LTWRAPPER_OPTION_PREFIX_LENGTH + 11;
-static const char *env_prepend_opt      = LTWRAPPER_OPTION_PREFIX &quot;env-prepend&quot;;
-  /* argument is putenv-style &quot;foo=bar&quot;, new value of foo is bar${foo} */
-
-static const size_t env_append_opt_len  = LTWRAPPER_OPTION_PREFIX_LENGTH + 10;
-static const char *env_append_opt       = LTWRAPPER_OPTION_PREFIX &quot;env-append&quot;;
-  /* argument is putenv-style &quot;foo=bar&quot;, new value of foo is ${foo}bar */
-
 int
 main (int argc, char *argv[])
 {
@@ -3374,10 +3625,13 @@
   int i;
 
   program_name = (char *) xstrdup (base_name (argv[0]));
-  LTWRAPPER_DEBUGPRINTF ((&quot;(main) argv[0]      : %s\n&quot;, argv[0]));
-  LTWRAPPER_DEBUGPRINTF ((&quot;(main) program_name : %s\n&quot;, program_name));
+  newargz = XMALLOC (char *, argc + 1);
 
-  /* very simple arg parsing; don't want to rely on getopt */
+  /* very simple arg parsing; don't want to rely on getopt
+   * also, copy all non cwrapper options to newargz, except
+   * argz[0], which is handled differently
+   */
+  newargc=0;
   for (i = 1; i &lt; argc; i++)
     {
       if (strcmp (argv[i], dumpscript_opt) == 0)
@@ -3391,25 +3645,57 @@
 	      esac
 
 	    cat &lt;&lt;&quot;EOF&quot;
-	  printf (&quot;%s&quot;, script_text_part1);
-	  printf (&quot;%s&quot;, script_text_part2);
+	  lt_dump_script (stdout);
 	  return 0;
 	}
+      if (strcmp (argv[i], debug_opt) == 0)
+	{
+          lt_debug = 1;
+          continue;
+	}
+      if (strcmp (argv[i], ltwrapper_option_prefix) == 0)
+        {
+          /* however, if there is an option in the LTWRAPPER_OPTION_PREFIX
+             namespace, but it is not one of the ones we know about and
+             have already dealt with, above (inluding dump-script), then
+             report an error. Otherwise, targets might begin to believe
+             they are allowed to use options in the LTWRAPPER_OPTION_PREFIX
+             namespace. The first time any user complains about this, we'll
+             need to make LTWRAPPER_OPTION_PREFIX a configure-time option
+             or a configure.ac-settable value.
+           */
+          lt_fatal (__FILE__, __LINE__,
+		    &quot;unrecognized %s option: '%s'&quot;,
+                    ltwrapper_option_prefix, argv[i]);
+        }
+      /* otherwise ... */
+      newargz[++newargc] = xstrdup (argv[i]);
     }
+  newargz[++newargc] = NULL;
 
-  newargz = XMALLOC (char *, argc + 1);
+EOF
+	    cat &lt;&lt;EOF
+  /* The GNU banner must be the first non-error debug message */
+  lt_debugprintf (__FILE__, __LINE__, &quot;libtool wrapper (GNU $PACKAGE$TIMESTAMP) $VERSION\n&quot;);
+EOF
+	    cat &lt;&lt;&quot;EOF&quot;
+  lt_debugprintf (__FILE__, __LINE__, &quot;(main) argv[0]: %s\n&quot;, argv[0]);
+  lt_debugprintf (__FILE__, __LINE__, &quot;(main) program_name: %s\n&quot;, program_name);
+
   tmp_pathspec = find_executable (argv[0]);
   if (tmp_pathspec == NULL)
-    lt_fatal (&quot;Couldn't find %s&quot;, argv[0]);
-  LTWRAPPER_DEBUGPRINTF ((&quot;(main) found exe (before symlink chase) at : %s\n&quot;,
-			  tmp_pathspec));
+    lt_fatal (__FILE__, __LINE__, &quot;couldn't find %s&quot;, argv[0]);
+  lt_debugprintf (__FILE__, __LINE__,
+                  &quot;(main) found exe (before symlink chase) at: %s\n&quot;,
+		  tmp_pathspec);
 
   actual_cwrapper_path = chase_symlinks (tmp_pathspec);
-  LTWRAPPER_DEBUGPRINTF ((&quot;(main) found exe (after symlink chase) at : %s\n&quot;,
-			  actual_cwrapper_path));
+  lt_debugprintf (__FILE__, __LINE__,
+                  &quot;(main) found exe (after symlink chase) at: %s\n&quot;,
+		  actual_cwrapper_path);
   XFREE (tmp_pathspec);
 
-  actual_cwrapper_name = xstrdup( base_name (actual_cwrapper_path));
+  actual_cwrapper_name = xstrdup (base_name (actual_cwrapper_path));
   strendzap (actual_cwrapper_path, actual_cwrapper_name);
 
   /* wrapper name transforms */
@@ -3427,8 +3713,9 @@
   target_name = tmp_pathspec;
   tmp_pathspec = 0;
 
-  LTWRAPPER_DEBUGPRINTF ((&quot;(main) libtool target name: %s\n&quot;,
-			  target_name));
+  lt_debugprintf (__FILE__, __LINE__,
+		  &quot;(main) libtool target name: %s\n&quot;,
+		  target_name);
 EOF
 
 	    cat &lt;&lt;EOF
@@ -3481,77 +3768,12 @@
   lt_update_lib_path (LIB_PATH_VARNAME, LIB_PATH_VALUE);
   lt_update_exe_path (EXE_PATH_VARNAME, EXE_PATH_VALUE);
 
-  newargc=0;
-  for (i = 1; i &lt; argc; i++)
-    {
-      if (strncmp (argv[i], env_set_opt, env_set_opt_len) == 0)
-        {
-          if (argv[i][env_set_opt_len] == '=')
-            {
-              const char *p = argv[i] + env_set_opt_len + 1;
-              lt_opt_process_env_set (p);
-            }
-          else if (argv[i][env_set_opt_len] == '\0' &amp;&amp; i + 1 &lt; argc)
-            {
-              lt_opt_process_env_set (argv[++i]); /* don't copy */
-            }
-          else
-            lt_fatal (&quot;%s missing required argument&quot;, env_set_opt);
-          continue;
-        }
-      if (strncmp (argv[i], env_prepend_opt, env_prepend_opt_len) == 0)
-        {
-          if (argv[i][env_prepend_opt_len] == '=')
-            {
-              const char *p = argv[i] + env_prepend_opt_len + 1;
-              lt_opt_process_env_prepend (p);
-            }
-          else if (argv[i][env_prepend_opt_len] == '\0' &amp;&amp; i + 1 &lt; argc)
-            {
-              lt_opt_process_env_prepend (argv[++i]); /* don't copy */
-            }
-          else
-            lt_fatal (&quot;%s missing required argument&quot;, env_prepend_opt);
-          continue;
-        }
-      if (strncmp (argv[i], env_append_opt, env_append_opt_len) == 0)
-        {
-          if (argv[i][env_append_opt_len] == '=')
-            {
-              const char *p = argv[i] + env_append_opt_len + 1;
-              lt_opt_process_env_append (p);
-            }
-          else if (argv[i][env_append_opt_len] == '\0' &amp;&amp; i + 1 &lt; argc)
-            {
-              lt_opt_process_env_append (argv[++i]); /* don't copy */
-            }
-          else
-            lt_fatal (&quot;%s missing required argument&quot;, env_append_opt);
-          continue;
-        }
-      if (strncmp (argv[i], ltwrapper_option_prefix, opt_prefix_len) == 0)
-        {
-          /* however, if there is an option in the LTWRAPPER_OPTION_PREFIX
-             namespace, but it is not one of the ones we know about and
-             have already dealt with, above (inluding dump-script), then
-             report an error. Otherwise, targets might begin to believe
-             they are allowed to use options in the LTWRAPPER_OPTION_PREFIX
-             namespace. The first time any user complains about this, we'll
-             need to make LTWRAPPER_OPTION_PREFIX a configure-time option
-             or a configure.ac-settable value.
-           */
-          lt_fatal (&quot;Unrecognized option in %s namespace: '%s'&quot;,
-                    ltwrapper_option_prefix, argv[i]);
-        }
-      /* otherwise ... */
-      newargz[++newargc] = xstrdup (argv[i]);
-    }
-  newargz[++newargc] = NULL;
-
-  LTWRAPPER_DEBUGPRINTF     ((&quot;(main) lt_argv_zero : %s\n&quot;, (lt_argv_zero ? lt_argv_zero : &quot;&lt;NULL&gt;&quot;)));
+  lt_debugprintf (__FILE__, __LINE__, &quot;(main) lt_argv_zero: %s\n&quot;,
+		  nonnull (lt_argv_zero));
   for (i = 0; i &lt; newargc; i++)
     {
-      LTWRAPPER_DEBUGPRINTF ((&quot;(main) newargz[%d]   : %s\n&quot;, i, (newargz[i] ? newargz[i] : &quot;&lt;NULL&gt;&quot;)));
+      lt_debugprintf (__FILE__, __LINE__, &quot;(main) newargz[%d]: %s\n&quot;,
+		      i, nonnull (newargz[i]));
     }
 
 EOF
@@ -3560,11 +3782,14 @@
 	      mingw*)
 		cat &lt;&lt;&quot;EOF&quot;
   /* execv doesn't actually work on mingw as expected on unix */
+  newargz = prepare_spawn (newargz);
   rval = _spawnv (_P_WAIT, lt_argv_zero, (const char * const *) newargz);
   if (rval == -1)
     {
       /* failed to start process */
-      LTWRAPPER_DEBUGPRINTF ((&quot;(main) failed to launch target \&quot;%s\&quot;: errno = %d\n&quot;, lt_argv_zero, errno));
+      lt_debugprintf (__FILE__, __LINE__,
+		      &quot;(main) failed to launch target \&quot;%s\&quot;: %s\n&quot;,
+		      lt_argv_zero, nonnull (strerror (errno)));
       return 127;
     }
   return rval;
@@ -3586,7 +3811,7 @@
 {
   void *p = (void *) malloc (num);
   if (!p)
-    lt_fatal (&quot;Memory exhausted&quot;);
+    lt_fatal (__FILE__, __LINE__, &quot;memory exhausted&quot;);
 
   return p;
 }
@@ -3620,8 +3845,8 @@
 {
   struct stat st;
 
-  LTWRAPPER_DEBUGPRINTF ((&quot;(check_executable)  : %s\n&quot;,
-			  path ? (*path ? path : &quot;EMPTY!&quot;) : &quot;NULL!&quot;));
+  lt_debugprintf (__FILE__, __LINE__, &quot;(check_executable): %s\n&quot;,
+                  nonempty (path));
   if ((!path) || (!*path))
     return 0;
 
@@ -3638,8 +3863,8 @@
   int rval = 0;
   struct stat st;
 
-  LTWRAPPER_DEBUGPRINTF ((&quot;(make_executable)   : %s\n&quot;,
-			  path ? (*path ? path : &quot;EMPTY!&quot;) : &quot;NULL!&quot;));
+  lt_debugprintf (__FILE__, __LINE__, &quot;(make_executable): %s\n&quot;,
+                  nonempty (path));
   if ((!path) || (!*path))
     return 0;
 
@@ -3665,8 +3890,8 @@
   int tmp_len;
   char *concat_name;
 
-  LTWRAPPER_DEBUGPRINTF ((&quot;(find_executable)   : %s\n&quot;,
-			  wrapper ? (*wrapper ? wrapper : &quot;EMPTY!&quot;) : &quot;NULL!&quot;));
+  lt_debugprintf (__FILE__, __LINE__, &quot;(find_executable): %s\n&quot;,
+                  nonempty (wrapper));
 
   if ((wrapper == NULL) || (*wrapper == '\0'))
     return NULL;
@@ -3719,7 +3944,8 @@
 		{
 		  /* empty path: current directory */
 		  if (getcwd (tmp, LT_PATHMAX) == NULL)
-		    lt_fatal (&quot;getcwd failed&quot;);
+		    lt_fatal (__FILE__, __LINE__, &quot;getcwd failed: %s&quot;,
+                              nonnull (strerror (errno)));
 		  tmp_len = strlen (tmp);
 		  concat_name =
 		    XMALLOC (char, tmp_len + 1 + strlen (wrapper) + 1);
@@ -3744,7 +3970,8 @@
     }
   /* Relative path | not found in path: prepend cwd */
   if (getcwd (tmp, LT_PATHMAX) == NULL)
-    lt_fatal (&quot;getcwd failed&quot;);
+    lt_fatal (__FILE__, __LINE__, &quot;getcwd failed: %s&quot;,
+              nonnull (strerror (errno)));
   tmp_len = strlen (tmp);
   concat_name = XMALLOC (char, tmp_len + 1 + strlen (wrapper) + 1);
   memcpy (concat_name, tmp, tmp_len);
@@ -3770,8 +3997,9 @@
   int has_symlinks = 0;
   while (strlen (tmp_pathspec) &amp;&amp; !has_symlinks)
     {
-      LTWRAPPER_DEBUGPRINTF ((&quot;checking path component for symlinks: %s\n&quot;,
-			      tmp_pathspec));
+      lt_debugprintf (__FILE__, __LINE__,
+		      &quot;checking path component for symlinks: %s\n&quot;,
+		      tmp_pathspec);
       if (lstat (tmp_pathspec, &amp;s) == 0)
 	{
 	  if (S_ISLNK (s.st_mode) != 0)
@@ -3793,8 +4021,9 @@
 	}
       else
 	{
-	  char *errstr = strerror (errno);
-	  lt_fatal (&quot;Error accessing file %s (%s)&quot;, tmp_pathspec, errstr);
+	  lt_fatal (__FILE__, __LINE__,
+		    &quot;error accessing file \&quot;%s\&quot;: %s&quot;,
+		    tmp_pathspec, nonnull (strerror (errno)));
 	}
     }
   XFREE (tmp_pathspec);
@@ -3807,7 +4036,8 @@
   tmp_pathspec = realpath (pathspec, buf);
   if (tmp_pathspec == 0)
     {
-      lt_fatal (&quot;Could not follow symlinks for %s&quot;, pathspec);
+      lt_fatal (__FILE__, __LINE__,
+		&quot;could not follow symlinks for %s&quot;, pathspec);
     }
   return xstrdup (tmp_pathspec);
 #endif
@@ -3833,11 +4063,25 @@
   return str;
 }
 
+void
+lt_debugprintf (const char *file, int line, const char *fmt, ...)
+{
+  va_list args;
+  if (lt_debug)
+    {
+      (void) fprintf (stderr, &quot;%s:%s:%d: &quot;, program_name, file, line);
+      va_start (args, fmt);
+      (void) vfprintf (stderr, fmt, args);
+      va_end (args);
+    }
+}
+
 static void
-lt_error_core (int exit_status, const char *mode,
+lt_error_core (int exit_status, const char *file,
+	       int line, const char *mode,
 	       const char *message, va_list ap)
 {
-  fprintf (stderr, &quot;%s: %s: &quot;, program_name, mode);
+  fprintf (stderr, &quot;%s:%s:%d: %s: &quot;, program_name, file, line, mode);
   vfprintf (stderr, message, ap);
   fprintf (stderr, &quot;.\n&quot;);
 
@@ -3846,20 +4090,32 @@
 }
 
 void
-lt_fatal (const char *message, ...)
+lt_fatal (const char *file, int line, const char *message, ...)
 {
   va_list ap;
   va_start (ap, message);
-  lt_error_core (EXIT_FAILURE, &quot;FATAL&quot;, message, ap);
+  lt_error_core (EXIT_FAILURE, file, line, &quot;FATAL&quot;, message, ap);
   va_end (ap);
 }
 
+static const char *
+nonnull (const char *s)
+{
+  return s ? s : &quot;(null)&quot;;
+}
+
+static const char *
+nonempty (const char *s)
+{
+  return (s &amp;&amp; !*s) ? &quot;(empty)&quot; : nonnull (s);
+}
+
 void
 lt_setenv (const char *name, const char *value)
 {
-  LTWRAPPER_DEBUGPRINTF ((&quot;(lt_setenv) setting '%s' to '%s'\n&quot;,
-                          (name ? name : &quot;&lt;NULL&gt;&quot;),
-                          (value ? value : &quot;&lt;NULL&gt;&quot;)));
+  lt_debugprintf (__FILE__, __LINE__,
+		  &quot;(lt_setenv) setting '%s' to '%s'\n&quot;,
+                  nonnull (name), nonnull (value));
   {
 #ifdef HAVE_SETENV
     /* always make a copy, for consistency with !HAVE_SETENV */
@@ -3904,95 +4160,12 @@
   return new_value;
 }
 
-int
-lt_split_name_value (const char *arg, char** name, char** value)
-{
-  const char *p;
-  int len;
-  if (!arg || !*arg)
-    return 1;
-
-  p = strchr (arg, (int)'=');
-
-  if (!p)
-    return 1;
-
-  *value = xstrdup (++p);
-
-  len = strlen (arg) - strlen (*value);
-  *name = XMALLOC (char, len);
-  strncpy (*name, arg, len-1);
-  (*name)[len - 1] = '\0';
-
-  return 0;
-}
-
 void
-lt_opt_process_env_set (const char *arg)
-{
-  char *name = NULL;
-  char *value = NULL;
-
-  if (lt_split_name_value (arg, &amp;name, &amp;value) != 0)
-    {
-      XFREE (name);
-      XFREE (value);
-      lt_fatal (&quot;bad argument for %s: '%s'&quot;, env_set_opt, arg);
-    }
-
-  lt_setenv (name, value);
-  XFREE (name);
-  XFREE (value);
-}
-
-void
-lt_opt_process_env_prepend (const char *arg)
-{
-  char *name = NULL;
-  char *value = NULL;
-  char *new_value = NULL;
-
-  if (lt_split_name_value (arg, &amp;name, &amp;value) != 0)
-    {
-      XFREE (name);
-      XFREE (value);
-      lt_fatal (&quot;bad argument for %s: '%s'&quot;, env_prepend_opt, arg);
-    }
-
-  new_value = lt_extend_str (getenv (name), value, 0);
-  lt_setenv (name, new_value);
-  XFREE (new_value);
-  XFREE (name);
-  XFREE (value);
-}
-
-void
-lt_opt_process_env_append (const char *arg)
-{
-  char *name = NULL;
-  char *value = NULL;
-  char *new_value = NULL;
-
-  if (lt_split_name_value (arg, &amp;name, &amp;value) != 0)
-    {
-      XFREE (name);
-      XFREE (value);
-      lt_fatal (&quot;bad argument for %s: '%s'&quot;, env_append_opt, arg);
-    }
-
-  new_value = lt_extend_str (getenv (name), value, 1);
-  lt_setenv (name, new_value);
-  XFREE (new_value);
-  XFREE (name);
-  XFREE (value);
-}
-
-void
 lt_update_exe_path (const char *name, const char *value)
 {
-  LTWRAPPER_DEBUGPRINTF ((&quot;(lt_update_exe_path) modifying '%s' by prepending '%s'\n&quot;,
-                          (name ? name : &quot;&lt;NULL&gt;&quot;),
-                          (value ? value : &quot;&lt;NULL&gt;&quot;)));
+  lt_debugprintf (__FILE__, __LINE__,
+		  &quot;(lt_update_exe_path) modifying '%s' by prepending '%s'\n&quot;,
+                  nonnull (name), nonnull (value));
 
   if (name &amp;&amp; *name &amp;&amp; value &amp;&amp; *value)
     {
@@ -4011,9 +4184,9 @@
 void
 lt_update_lib_path (const char *name, const char *value)
 {
-  LTWRAPPER_DEBUGPRINTF ((&quot;(lt_update_lib_path) modifying '%s' by prepending '%s'\n&quot;,
-                          (name ? name : &quot;&lt;NULL&gt;&quot;),
-                          (value ? value : &quot;&lt;NULL&gt;&quot;)));
+  lt_debugprintf (__FILE__, __LINE__,
+		  &quot;(lt_update_lib_path) modifying '%s' by prepending '%s'\n&quot;,
+                  nonnull (name), nonnull (value));
 
   if (name &amp;&amp; *name &amp;&amp; value &amp;&amp; *value)
     {
@@ -4023,11 +4196,152 @@
     }
 }
 
+EOF
+	    case $host_os in
+	      mingw*)
+		cat &lt;&lt;&quot;EOF&quot;
 
+/* Prepares an argument vector before calling spawn().
+   Note that spawn() does not by itself call the command interpreter
+     (getenv (&quot;COMSPEC&quot;) != NULL ? getenv (&quot;COMSPEC&quot;) :
+      ({ OSVERSIONINFO v; v.dwOSVersionInfoSize = sizeof(OSVERSIONINFO);
+         GetVersionEx(&amp;v);
+         v.dwPlatformId == VER_PLATFORM_WIN32_NT;
+      }) ? &quot;cmd.exe&quot; : &quot;command.com&quot;).
+   Instead it simply concatenates the arguments, separated by ' ', and calls
+   CreateProcess().  We must quote the arguments since Win32 CreateProcess()
+   interprets characters like ' ', '\t', '\\', '&quot;' (but not '&lt;' and '&gt;') in a
+   special way:
+   - Space and tab are interpreted as delimiters. They are not treated as
+     delimiters if they are surrounded by double quotes: &quot;...&quot;.
+   - Unescaped double quotes are removed from the input. Their only effect is
+     that within double quotes, space and tab are treated like normal
+     characters.
+   - Backslashes not followed by double quotes are not special.
+   - But 2*n+1 backslashes followed by a double quote become
+     n backslashes followed by a double quote (n &gt;= 0):
+       \&quot; -&gt; &quot;
+       \\\&quot; -&gt; \&quot;
+       \\\\\&quot; -&gt; \\&quot;
+ */
+#define SHELL_SPECIAL_CHARS &quot;\&quot;\\ \001\002\003\004\005\006\007\010\011\012\013\014\015\016\017\020\021\022\023\024\025\026\027\030\031\032\033\034\035\036\037&quot;
+#define SHELL_SPACE_CHARS &quot; \001\002\003\004\005\006\007\010\011\012\013\014\015\016\017\020\021\022\023\024\025\026\027\030\031\032\033\034\035\036\037&quot;
+char **
+prepare_spawn (char **argv)
+{
+  size_t argc;
+  char **new_argv;
+  size_t i;
+
+  /* Count number of arguments.  */
+  for (argc = 0; argv[argc] != NULL; argc++)
+    ;
+
+  /* Allocate new argument vector.  */
+  new_argv = XMALLOC (char *, argc + 1);
+
+  /* Put quoted arguments into the new argument vector.  */
+  for (i = 0; i &lt; argc; i++)
+    {
+      const char *string = argv[i];
+
+      if (string[0] == '\0')
+	new_argv[i] = xstrdup (&quot;\&quot;\&quot;&quot;);
+      else if (strpbrk (string, SHELL_SPECIAL_CHARS) != NULL)
+	{
+	  int quote_around = (strpbrk (string, SHELL_SPACE_CHARS) != NULL);
+	  size_t length;
+	  unsigned int backslashes;
+	  const char *s;
+	  char *quoted_string;
+	  char *p;
+
+	  length = 0;
+	  backslashes = 0;
+	  if (quote_around)
+	    length++;
+	  for (s = string; *s != '\0'; s++)
+	    {
+	      char c = *s;
+	      if (c == '&quot;')
+		length += backslashes + 1;
+	      length++;
+	      if (c == '\\')
+		backslashes++;
+	      else
+		backslashes = 0;
+	    }
+	  if (quote_around)
+	    length += backslashes + 1;
+
+	  quoted_string = XMALLOC (char, length + 1);
+
+	  p = quoted_string;
+	  backslashes = 0;
+	  if (quote_around)
+	    *p++ = '&quot;';
+	  for (s = string; *s != '\0'; s++)
+	    {
+	      char c = *s;
+	      if (c == '&quot;')
+		{
+		  unsigned int j;
+		  for (j = backslashes + 1; j &gt; 0; j--)
+		    *p++ = '\\';
+		}
+	      *p++ = c;
+	      if (c == '\\')
+		backslashes++;
+	      else
+		backslashes = 0;
+	    }
+	  if (quote_around)
+	    {
+	      unsigned int j;
+	      for (j = backslashes; j &gt; 0; j--)
+		*p++ = '\\';
+	      *p++ = '&quot;';
+	    }
+	  *p = '\0';
+
+	  new_argv[i] = quoted_string;
+	}
+      else
+	new_argv[i] = (char *) string;
+    }
+  new_argv[argc] = NULL;
+
+  return new_argv;
+}
 EOF
+		;;
+	    esac
+
+            cat &lt;&lt;&quot;EOF&quot;
+void lt_dump_script (FILE* f)
+{
+EOF
+	    func_emit_wrapper yes |
+              $SED -e 's/\([\\&quot;]\)/\\\1/g' \
+	           -e 's/^/  fputs (&quot;/' -e 's/$/\\n&quot;, f);/'
+
+            cat &lt;&lt;&quot;EOF&quot;
 }
+EOF
+}
 # end: func_emit_cwrapperexe_src
 
+# func_win32_import_lib_p ARG
+# True if ARG is an import lib, as indicated by $file_magic_cmd
+func_win32_import_lib_p ()
+{
+    $opt_debug
+    case `eval $file_magic_cmd \&quot;\$1\&quot; 2&gt;/dev/null | $SED -e 10q` in
+    *import*) : ;;
+    *) false ;;
+    esac
+}
+
 # func_mode_link arg...
 func_mode_link ()
 {
@@ -4072,6 +4386,7 @@
     new_inherited_linker_flags=
 
     avoid_version=no
+    bindir=
     dlfiles=
     dlprefiles=
     dlself=no
@@ -4164,6 +4479,11 @@
 	esac
 
 	case $prev in
+	bindir)
+	  bindir=&quot;$arg&quot;
+	  prev=
+	  continue
+	  ;;
 	dlfiles|dlprefiles)
 	  if test &quot;$preload&quot; = no; then
 	    # Add the symbol object into the linking commands.
@@ -4425,6 +4745,11 @@
 	continue
 	;;
 
+      -bindir)
+	prev=bindir
+	continue
+	;;
+
       -dlopen)
 	prev=dlfiles
 	continue
@@ -4503,7 +4828,7 @@
 	esac
 	case $host in
 	*-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-os2* | *-cegcc*)
-	  testbindir=`$ECHO &quot;X$dir&quot; | $Xsed -e 's*/lib$*/bin*'`
+	  testbindir=`$ECHO &quot;$dir&quot; | $SED 's*/lib$*/bin*'`
 	  case :$dllsearchpath: in
 	  *&quot;:$dir:&quot;*) ;;
 	  ::) dllsearchpath=$dir;;
@@ -4522,7 +4847,7 @@
       -l*)
 	if test &quot;X$arg&quot; = &quot;X-lc&quot; || test &quot;X$arg&quot; = &quot;X-lm&quot;; then
 	  case $host in
-	  *-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-beos* | *-cegcc*)
+	  *-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-beos* | *-cegcc* | *-*-haiku*)
 	    # These systems don't actually have a C or math library (as such)
 	    continue
 	    ;;
@@ -4708,7 +5033,7 @@
 	for flag in $args; do
 	  IFS=&quot;$save_ifs&quot;
           func_quote_for_eval &quot;$flag&quot;
-	  arg=&quot;$arg $wl$func_quote_for_eval_result&quot;
+	  arg=&quot;$arg $func_quote_for_eval_result&quot;
 	  compiler_flags=&quot;$compiler_flags $func_quote_for_eval_result&quot;
 	done
 	IFS=&quot;$save_ifs&quot;
@@ -4759,18 +5084,19 @@
 	arg=&quot;$func_quote_for_eval_result&quot;
 	;;
 
-      # -64, -mips[0-9] enable 64-bit mode on the SGI compiler
-      # -r[0-9][0-9]* specifies the processor on the SGI compiler
-      # -xarch=*, -xtarget=* enable 64-bit mode on the Sun compiler
-      # +DA*, +DD* enable 64-bit mode on the HP compiler
-      # -q* pass through compiler args for the IBM compiler
-      # -m*, -t[45]*, -txscale* pass through architecture-specific
-      # compiler args for GCC
-      # -F/path gives path to uninstalled frameworks, gcc on darwin
-      # -p, -pg, --coverage, -fprofile-* pass through profiling flag for GCC
-      # @file GCC response files
+      # Flags to be passed through unchanged, with rationale:
+      # -64, -mips[0-9]      enable 64-bit mode for the SGI compiler
+      # -r[0-9][0-9]*        specify processor for the SGI compiler
+      # -xarch=*, -xtarget=* enable 64-bit mode for the Sun compiler
+      # +DA*, +DD*           enable 64-bit mode for the HP compiler
+      # -q*                  compiler args for the IBM compiler
+      # -m*, -t[45]*, -txscale* architecture-specific flags for GCC
+      # -F/path              path to uninstalled frameworks, gcc on darwin
+      # -p, -pg, --coverage, -fprofile-*  profiling flags for GCC
+      # @file                GCC response files
+      # -tp=*                Portland pgcc target processor selection
       -64|-mips[0-9]|-r[0-9][0-9]*|-xarch=*|-xtarget=*|+DA*|+DD*|-q*|-m*| \
-      -t[45]*|-txscale*|-p|-pg|--coverage|-fprofile-*|-F*|@*)
+      -t[45]*|-txscale*|-p|-pg|--coverage|-fprofile-*|-F*|@*|-tp=*)
         func_quote_for_eval &quot;$arg&quot;
 	arg=&quot;$func_quote_for_eval_result&quot;
         func_append compile_command &quot; $arg&quot;
@@ -4930,7 +5256,7 @@
 
     if test -n &quot;$shlibpath_var&quot;; then
       # get the directories listed in $shlibpath_var
-      eval shlib_search_path=\`\$ECHO \&quot;X\${$shlibpath_var}\&quot; \| \$Xsed -e \'s/:/ /g\'\`
+      eval shlib_search_path=\`\$ECHO \&quot;\${$shlibpath_var}\&quot; \| \$SED \'s/:/ /g\'\`
     else
       shlib_search_path=
     fi
@@ -5053,7 +5379,8 @@
 	  # Collect preopened libtool deplibs, except any this library
 	  # has declared as weak libs
 	  for deplib in $dependency_libs; do
-            deplib_base=`$ECHO &quot;X$deplib&quot; | $Xsed -e &quot;$basename&quot;`
+	    func_basename &quot;$deplib&quot;
+            deplib_base=$func_basename_result
 	    case &quot; $weak_libs &quot; in
 	    *&quot; $deplib_base &quot;*) ;;
 	    *) deplibs=&quot;$deplibs $deplib&quot; ;;
@@ -5241,7 +5568,7 @@
 		match_pattern*)
 		  set dummy $deplibs_check_method; shift
 		  match_pattern_regex=`expr &quot;$deplibs_check_method&quot; : &quot;$1 \(.*\)&quot;`
-		  if eval &quot;\$ECHO \&quot;X$deplib\&quot;&quot; 2&gt;/dev/null | $Xsed -e 10q \
+		  if eval &quot;\$ECHO \&quot;$deplib\&quot;&quot; 2&gt;/dev/null | $SED 10q \
 		    | $EGREP &quot;$match_pattern_regex&quot; &gt; /dev/null; then
 		    valid_a_lib=yes
 		  fi
@@ -5251,15 +5578,15 @@
 		;;
 	      esac
 	      if test &quot;$valid_a_lib&quot; != yes; then
-		$ECHO
+		echo
 		$ECHO &quot;*** Warning: Trying to link with static lib archive $deplib.&quot;
-		$ECHO &quot;*** I have the capability to make that library automatically link in when&quot;
-		$ECHO &quot;*** you link to this library.  But I can only do this if you have a&quot;
-		$ECHO &quot;*** shared version of the library, which you do not appear to have&quot;
-		$ECHO &quot;*** because the file extensions .$libext of this argument makes me believe&quot;
-		$ECHO &quot;*** that it is just a static archive that I should not use here.&quot;
+		echo &quot;*** I have the capability to make that library automatically link in when&quot;
+		echo &quot;*** you link to this library.  But I can only do this if you have a&quot;
+		echo &quot;*** shared version of the library, which you do not appear to have&quot;
+		echo &quot;*** because the file extensions .$libext of this argument makes me believe&quot;
+		echo &quot;*** that it is just a static archive that I should not use here.&quot;
 	      else
-		$ECHO
+		echo
 		$ECHO &quot;*** Warning: Linking the shared library $output against the&quot;
 		$ECHO &quot;*** static library $deplib is not portable!&quot;
 		deplibs=&quot;$deplib $deplibs&quot;
@@ -5332,7 +5659,7 @@
 
 	# Convert &quot;-framework foo&quot; to &quot;foo.ltframework&quot;
 	if test -n &quot;$inherited_linker_flags&quot;; then
-	  tmp_inherited_linker_flags=`$ECHO &quot;X$inherited_linker_flags&quot; | $Xsed -e 's/-framework \([^ $]*\)/\1.ltframework/g'`
+	  tmp_inherited_linker_flags=`$ECHO &quot;$inherited_linker_flags&quot; | $SED 's/-framework \([^ $]*\)/\1.ltframework/g'`
 	  for tmp_inherited_linker_flag in $tmp_inherited_linker_flags; do
 	    case &quot; $new_inherited_linker_flags &quot; in
 	      *&quot; $tmp_inherited_linker_flag &quot;*) ;;
@@ -5340,7 +5667,7 @@
 	    esac
 	  done
 	fi
-	dependency_libs=`$ECHO &quot;X $dependency_libs&quot; | $Xsed -e 's% \([^ $]*\).ltframework% -framework \1%g'`
+	dependency_libs=`$ECHO &quot; $dependency_libs&quot; | $SED 's% \([^ $]*\).ltframework% -framework \1%g'`
 	if test &quot;$linkmode,$pass&quot; = &quot;lib,link&quot; ||
 	   test &quot;$linkmode,$pass&quot; = &quot;prog,scan&quot; ||
 	   { test &quot;$linkmode&quot; != prog &amp;&amp; test &quot;$linkmode&quot; != lib; }; then
@@ -5594,7 +5921,7 @@
 	    fi
 	  done
 	  if test -z &quot;$dlopenmodule&quot; &amp;&amp; test &quot;$shouldnotlink&quot; = yes &amp;&amp; test &quot;$pass&quot; = link; then
-	    $ECHO
+	    echo
 	    if test &quot;$linkmode&quot; = prog; then
 	      $ECHO &quot;*** Warning: Linking the executable $output against the loadable module&quot;
 	    else
@@ -5697,9 +6024,9 @@
 		      if test &quot;X$dlopenmodule&quot; != &quot;X$lib&quot;; then
 			$ECHO &quot;*** Warning: lib $linklib is a module, not a shared library&quot;
 			if test -z &quot;$old_library&quot; ; then
-			  $ECHO
-			  $ECHO &quot;*** And there doesn't seem to be a static archive available&quot;
-			  $ECHO &quot;*** The link will probably fail, sorry&quot;
+			  echo
+			  echo &quot;*** And there doesn't seem to be a static archive available&quot;
+			  echo &quot;*** The link will probably fail, sorry&quot;
 			else
 			  add=&quot;$dir/$old_library&quot;
 			fi
@@ -5839,21 +6166,21 @@
 
 	    # Just print a warning and add the library to dependency_libs so
 	    # that the program can be linked against the static library.
-	    $ECHO
+	    echo
 	    $ECHO &quot;*** Warning: This system can not link to static lib archive $lib.&quot;
-	    $ECHO &quot;*** I have the capability to make that library automatically link in when&quot;
-	    $ECHO &quot;*** you link to this library.  But I can only do this if you have a&quot;
-	    $ECHO &quot;*** shared version of the library, which you do not appear to have.&quot;
+	    echo &quot;*** I have the capability to make that library automatically link in when&quot;
+	    echo &quot;*** you link to this library.  But I can only do this if you have a&quot;
+	    echo &quot;*** shared version of the library, which you do not appear to have.&quot;
 	    if test &quot;$module&quot; = yes; then
-	      $ECHO &quot;*** But as you try to build a module library, libtool will still create &quot;
-	      $ECHO &quot;*** a static module, that should work as long as the dlopening application&quot;
-	      $ECHO &quot;*** is linked with the -dlopen flag to resolve symbols at runtime.&quot;
+	      echo &quot;*** But as you try to build a module library, libtool will still create &quot;
+	      echo &quot;*** a static module, that should work as long as the dlopening application&quot;
+	      echo &quot;*** is linked with the -dlopen flag to resolve symbols at runtime.&quot;
 	      if test -z &quot;$global_symbol_pipe&quot;; then
-		$ECHO
-		$ECHO &quot;*** However, this would only work if libtool was able to extract symbol&quot;
-		$ECHO &quot;*** lists from a program, using \`nm' or equivalent, but libtool could&quot;
-		$ECHO &quot;*** not find such a program.  So, this module is probably useless.&quot;
-		$ECHO &quot;*** \`nm' from GNU binutils and a full rebuild may help.&quot;
+		echo
+		echo &quot;*** However, this would only work if libtool was able to extract symbol&quot;
+		echo &quot;*** lists from a program, using \`nm' or equivalent, but libtool could&quot;
+		echo &quot;*** not find such a program.  So, this module is probably useless.&quot;
+		echo &quot;*** \`nm' from GNU binutils and a full rebuild may help.&quot;
 	      fi
 	      if test &quot;$build_old_libs&quot; = no; then
 		build_libtool_libs=module
@@ -5907,6 +6234,7 @@
 	  if test &quot;$link_all_deplibs&quot; != no; then
 	    # Add the search paths of all dependency libraries
 	    for deplib in $dependency_libs; do
+	      path=
 	      case $deplib in
 	      -L*) path=&quot;$deplib&quot; ;;
 	      *.la)
@@ -5972,7 +6300,7 @@
 	  compile_deplibs=&quot;$new_inherited_linker_flags $compile_deplibs&quot;
 	  finalize_deplibs=&quot;$new_inherited_linker_flags $finalize_deplibs&quot;
 	else
-	  compiler_flags=&quot;$compiler_flags &quot;`$ECHO &quot;X $new_inherited_linker_flags&quot; | $Xsed -e 's% \([^ $]*\).ltframework% -framework \1%g'`
+	  compiler_flags=&quot;$compiler_flags &quot;`$ECHO &quot; $new_inherited_linker_flags&quot; | $SED 's% \([^ $]*\).ltframework% -framework \1%g'`
 	fi
       fi
       dependency_libs=&quot;$newdependency_libs&quot;
@@ -6140,7 +6468,7 @@
 	if test &quot;$deplibs_check_method&quot; != pass_all; then
 	  func_fatal_error &quot;cannot build libtool library \`$output' from non-libtool objects on this host:$objs&quot;
 	else
-	  $ECHO
+	  echo
 	  $ECHO &quot;*** Warning: Linking the shared library $output against the non-libtool&quot;
 	  $ECHO &quot;*** objects $objs is not portable!&quot;
 	  libobjs=&quot;$libobjs $objs&quot;
@@ -6208,7 +6536,7 @@
 	    age=&quot;$number_minor&quot;
 	    revision=&quot;$number_revision&quot;
 	    ;;
-	  freebsd-aout|freebsd-elf|sunos)
+	  freebsd-aout|freebsd-elf|qnx|sunos)
 	    current=&quot;$number_major&quot;
 	    revision=&quot;$number_minor&quot;
 	    age=&quot;0&quot;
@@ -6442,14 +6770,14 @@
 	oldlibs=&quot;$oldlibs $output_objdir/$libname.$libext&quot;
 
 	# Transform .lo files to .o files.
-	oldobjs=&quot;$objs &quot;`$ECHO &quot;X$libobjs&quot; | $SP2NL | $Xsed -e '/\.'${libext}'$/d' -e &quot;$lo2o&quot; | $NL2SP`
+	oldobjs=&quot;$objs &quot;`$ECHO &quot;$libobjs&quot; | $SP2NL | $SED &quot;/\.${libext}$/d; $lo2o&quot; | $NL2SP`
       fi
 
       # Eliminate all temporary directories.
       #for path in $notinst_path; do
-      #	lib_search_path=`$ECHO &quot;X$lib_search_path &quot; | $Xsed -e &quot;s% $path % %g&quot;`
-      #	deplibs=`$ECHO &quot;X$deplibs &quot; | $Xsed -e &quot;s% -L$path % %g&quot;`
-      #	dependency_libs=`$ECHO &quot;X$dependency_libs &quot; | $Xsed -e &quot;s% -L$path % %g&quot;`
+      #	lib_search_path=`$ECHO &quot;$lib_search_path &quot; | $SED &quot;s% $path % %g&quot;`
+      #	deplibs=`$ECHO &quot;$deplibs &quot; | $SED &quot;s% -L$path % %g&quot;`
+      #	dependency_libs=`$ECHO &quot;$dependency_libs &quot; | $SED &quot;s% -L$path % %g&quot;`
       #done
 
       if test -n &quot;$xrpath&quot;; then
@@ -6490,7 +6818,7 @@
       if test &quot;$build_libtool_libs&quot; = yes; then
 	if test -n &quot;$rpath&quot;; then
 	  case $host in
-	  *-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-os2* | *-*-beos* | *-cegcc*)
+	  *-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-os2* | *-*-beos* | *-cegcc* | *-*-haiku*)
 	    # these systems don't actually have a c library (as such)!
 	    ;;
 	  *-*-rhapsody* | *-*-darwin1.[012])
@@ -6575,13 +6903,13 @@
 		    newdeplibs=&quot;$newdeplibs $i&quot;
 		  else
 		    droppeddeps=yes
-		    $ECHO
+		    echo
 		    $ECHO &quot;*** Warning: dynamic linker does not accept needed library $i.&quot;
-		    $ECHO &quot;*** I have the capability to make that library automatically link in when&quot;
-		    $ECHO &quot;*** you link to this library.  But I can only do this if you have a&quot;
-		    $ECHO &quot;*** shared version of the library, which I believe you do not have&quot;
-		    $ECHO &quot;*** because a test_compile did reveal that the linker did not use it for&quot;
-		    $ECHO &quot;*** its dynamic dependency list that programs get resolved with at runtime.&quot;
+		    echo &quot;*** I have the capability to make that library automatically link in when&quot;
+		    echo &quot;*** you link to this library.  But I can only do this if you have a&quot;
+		    echo &quot;*** shared version of the library, which I believe you do not have&quot;
+		    echo &quot;*** because a test_compile did reveal that the linker did not use it for&quot;
+		    echo &quot;*** its dynamic dependency list that programs get resolved with at runtime.&quot;
 		  fi
 		fi
 		;;
@@ -6618,22 +6946,22 @@
 		      newdeplibs=&quot;$newdeplibs $i&quot;
 		    else
 		      droppeddeps=yes
-		      $ECHO
+		      echo
 		      $ECHO &quot;*** Warning: dynamic linker does not accept needed library $i.&quot;
-		      $ECHO &quot;*** I have the capability to make that library automatically link in when&quot;
-		      $ECHO &quot;*** you link to this library.  But I can only do this if you have a&quot;
-		      $ECHO &quot;*** shared version of the library, which you do not appear to have&quot;
-		      $ECHO &quot;*** because a test_compile did reveal that the linker did not use this one&quot;
-		      $ECHO &quot;*** as a dynamic dependency that programs can get resolved with at runtime.&quot;
+		      echo &quot;*** I have the capability to make that library automatically link in when&quot;
+		      echo &quot;*** you link to this library.  But I can only do this if you have a&quot;
+		      echo &quot;*** shared version of the library, which you do not appear to have&quot;
+		      echo &quot;*** because a test_compile did reveal that the linker did not use this one&quot;
+		      echo &quot;*** as a dynamic dependency that programs can get resolved with at runtime.&quot;
 		    fi
 		  fi
 		else
 		  droppeddeps=yes
-		  $ECHO
+		  echo
 		  $ECHO &quot;*** Warning!  Library $i is needed by this library but I was not able to&quot;
-		  $ECHO &quot;*** make it link in!  You will probably need to install it or some&quot;
-		  $ECHO &quot;*** library that it depends on before this library will be fully&quot;
-		  $ECHO &quot;*** functional.  Installing it before continuing would be even better.&quot;
+		  echo &quot;*** make it link in!  You will probably need to install it or some&quot;
+		  echo &quot;*** library that it depends on before this library will be fully&quot;
+		  echo &quot;*** functional.  Installing it before continuing would be even better.&quot;
 		fi
 		;;
 	      *)
@@ -6679,7 +7007,7 @@
 			potliblink=`ls -ld $potlib | ${SED} 's/.* -&gt; //'`
 			case $potliblink in
 			[\\/]* | [A-Za-z]:[\\/]*) potlib=&quot;$potliblink&quot;;;
-			*) potlib=`$ECHO &quot;X$potlib&quot; | $Xsed -e 's,[^/]*$,,'`&quot;$potliblink&quot;;;
+			*) potlib=`$ECHO &quot;$potlib&quot; | $SED 's,[^/]*$,,'`&quot;$potliblink&quot;;;
 			esac
 		      done
 		      if eval $file_magic_cmd \&quot;\$potlib\&quot; 2&gt;/dev/null |
@@ -6694,12 +7022,12 @@
 	      fi
 	      if test -n &quot;$a_deplib&quot; ; then
 		droppeddeps=yes
-		$ECHO
+		echo
 		$ECHO &quot;*** Warning: linker path does not have real file for library $a_deplib.&quot;
-		$ECHO &quot;*** I have the capability to make that library automatically link in when&quot;
-		$ECHO &quot;*** you link to this library.  But I can only do this if you have a&quot;
-		$ECHO &quot;*** shared version of the library, which you do not appear to have&quot;
-		$ECHO &quot;*** because I did check the linker path looking for a file starting&quot;
+		echo &quot;*** I have the capability to make that library automatically link in when&quot;
+		echo &quot;*** you link to this library.  But I can only do this if you have a&quot;
+		echo &quot;*** shared version of the library, which you do not appear to have&quot;
+		echo &quot;*** because I did check the linker path looking for a file starting&quot;
 		if test -z &quot;$potlib&quot; ; then
 		  $ECHO &quot;*** with $libname but no candidates were found. (...for file magic test)&quot;
 		else
@@ -6737,7 +7065,7 @@
 		  potential_libs=`ls $i/$libname[.-]* 2&gt;/dev/null`
 		  for potent_lib in $potential_libs; do
 		    potlib=&quot;$potent_lib&quot; # see symlink-check above in file_magic test
-		    if eval &quot;\$ECHO \&quot;X$potent_lib\&quot;&quot; 2&gt;/dev/null | $Xsed -e 10q | \
+		    if eval &quot;\$ECHO \&quot;$potent_lib\&quot;&quot; 2&gt;/dev/null | $SED 10q | \
 		       $EGREP &quot;$match_pattern_regex&quot; &gt; /dev/null; then
 		      newdeplibs=&quot;$newdeplibs $a_deplib&quot;
 		      a_deplib=&quot;&quot;
@@ -6748,12 +7076,12 @@
 	      fi
 	      if test -n &quot;$a_deplib&quot; ; then
 		droppeddeps=yes
-		$ECHO
+		echo
 		$ECHO &quot;*** Warning: linker path does not have real file for library $a_deplib.&quot;
-		$ECHO &quot;*** I have the capability to make that library automatically link in when&quot;
-		$ECHO &quot;*** you link to this library.  But I can only do this if you have a&quot;
-		$ECHO &quot;*** shared version of the library, which you do not appear to have&quot;
-		$ECHO &quot;*** because I did check the linker path looking for a file starting&quot;
+		echo &quot;*** I have the capability to make that library automatically link in when&quot;
+		echo &quot;*** you link to this library.  But I can only do this if you have a&quot;
+		echo &quot;*** shared version of the library, which you do not appear to have&quot;
+		echo &quot;*** because I did check the linker path looking for a file starting&quot;
 		if test -z &quot;$potlib&quot; ; then
 		  $ECHO &quot;*** with $libname but no candidates were found. (...for regex pattern test)&quot;
 		else
@@ -6771,25 +7099,25 @@
 	  ;;
 	none | unknown | *)
 	  newdeplibs=&quot;&quot;
-	  tmp_deplibs=`$ECHO &quot;X $deplibs&quot; | $Xsed \
-	      -e 's/ -lc$//' -e 's/ -[LR][^ ]*//g'`
+	  tmp_deplibs=`$ECHO &quot; $deplibs&quot; | $SED 's/ -lc$//; s/ -[LR][^ ]*//g'`
 	  if test &quot;X$allow_libtool_libs_with_static_runtimes&quot; = &quot;Xyes&quot; ; then
 	    for i in $predeps $postdeps ; do
 	      # can't use Xsed below, because $i might contain '/'
-	      tmp_deplibs=`$ECHO &quot;X $tmp_deplibs&quot; | $Xsed -e &quot;s,$i,,&quot;`
+	      tmp_deplibs=`$ECHO &quot; $tmp_deplibs&quot; | $SED &quot;s,$i,,&quot;`
 	    done
 	  fi
-	  if $ECHO &quot;X $tmp_deplibs&quot; | $Xsed -e 's/[	 ]//g' |
-	     $GREP . &gt;/dev/null; then
-	    $ECHO
+	  case $tmp_deplibs in
+	  *[!\	\ ]*)
+	    echo
 	    if test &quot;X$deplibs_check_method&quot; = &quot;Xnone&quot;; then
-	      $ECHO &quot;*** Warning: inter-library dependencies are not supported in this platform.&quot;
+	      echo &quot;*** Warning: inter-library dependencies are not supported in this platform.&quot;
 	    else
-	      $ECHO &quot;*** Warning: inter-library dependencies are not known to be supported.&quot;
+	      echo &quot;*** Warning: inter-library dependencies are not known to be supported.&quot;
 	    fi
-	    $ECHO &quot;*** All declared inter-library dependencies are being dropped.&quot;
+	    echo &quot;*** All declared inter-library dependencies are being dropped.&quot;
 	    droppeddeps=yes
-	  fi
+	    ;;
+	  esac
 	  ;;
 	esac
 	versuffix=$versuffix_save
@@ -6801,23 +7129,23 @@
 	case $host in
 	*-*-rhapsody* | *-*-darwin1.[012])
 	  # On Rhapsody replace the C library with the System framework
-	  newdeplibs=`$ECHO &quot;X $newdeplibs&quot; | $Xsed -e 's/ -lc / System.ltframework /'`
+	  newdeplibs=`$ECHO &quot; $newdeplibs&quot; | $SED 's/ -lc / System.ltframework /'`
 	  ;;
 	esac
 
 	if test &quot;$droppeddeps&quot; = yes; then
 	  if test &quot;$module&quot; = yes; then
-	    $ECHO
-	    $ECHO &quot;*** Warning: libtool could not satisfy all declared inter-library&quot;
+	    echo
+	    echo &quot;*** Warning: libtool could not satisfy all declared inter-library&quot;
 	    $ECHO &quot;*** dependencies of module $libname.  Therefore, libtool will create&quot;
-	    $ECHO &quot;*** a static module, that should work as long as the dlopening&quot;
-	    $ECHO &quot;*** application is linked with the -dlopen flag.&quot;
+	    echo &quot;*** a static module, that should work as long as the dlopening&quot;
+	    echo &quot;*** application is linked with the -dlopen flag.&quot;
 	    if test -z &quot;$global_symbol_pipe&quot;; then
-	      $ECHO
-	      $ECHO &quot;*** However, this would only work if libtool was able to extract symbol&quot;
-	      $ECHO &quot;*** lists from a program, using \`nm' or equivalent, but libtool could&quot;
-	      $ECHO &quot;*** not find such a program.  So, this module is probably useless.&quot;
-	      $ECHO &quot;*** \`nm' from GNU binutils and a full rebuild may help.&quot;
+	      echo
+	      echo &quot;*** However, this would only work if libtool was able to extract symbol&quot;
+	      echo &quot;*** lists from a program, using \`nm' or equivalent, but libtool could&quot;
+	      echo &quot;*** not find such a program.  So, this module is probably useless.&quot;
+	      echo &quot;*** \`nm' from GNU binutils and a full rebuild may help.&quot;
 	    fi
 	    if test &quot;$build_old_libs&quot; = no; then
 	      oldlibs=&quot;$output_objdir/$libname.$libext&quot;
@@ -6827,16 +7155,16 @@
 	      build_libtool_libs=no
 	    fi
 	  else
-	    $ECHO &quot;*** The inter-library dependencies that have been dropped here will be&quot;
-	    $ECHO &quot;*** automatically added whenever a program is linked with this library&quot;
-	    $ECHO &quot;*** or is declared to -dlopen it.&quot;
+	    echo &quot;*** The inter-library dependencies that have been dropped here will be&quot;
+	    echo &quot;*** automatically added whenever a program is linked with this library&quot;
+	    echo &quot;*** or is declared to -dlopen it.&quot;
 
 	    if test &quot;$allow_undefined&quot; = no; then
-	      $ECHO
-	      $ECHO &quot;*** Since this library must not contain undefined symbols,&quot;
-	      $ECHO &quot;*** because either the platform does not support them or&quot;
-	      $ECHO &quot;*** it was explicitly requested with -no-undefined,&quot;
-	      $ECHO &quot;*** libtool will only create a static version of it.&quot;
+	      echo
+	      echo &quot;*** Since this library must not contain undefined symbols,&quot;
+	      echo &quot;*** because either the platform does not support them or&quot;
+	      echo &quot;*** it was explicitly requested with -no-undefined,&quot;
+	      echo &quot;*** libtool will only create a static version of it.&quot;
 	      if test &quot;$build_old_libs&quot; = no; then
 		oldlibs=&quot;$output_objdir/$libname.$libext&quot;
 		build_libtool_libs=module
@@ -6853,9 +7181,9 @@
       # Time to change all our &quot;foo.ltframework&quot; stuff back to &quot;-framework foo&quot;
       case $host in
 	*-*-darwin*)
-	  newdeplibs=`$ECHO &quot;X $newdeplibs&quot; | $Xsed -e 's% \([^ $]*\).ltframework% -framework \1%g'`
-	  new_inherited_linker_flags=`$ECHO &quot;X $new_inherited_linker_flags&quot; | $Xsed -e 's% \([^ $]*\).ltframework% -framework \1%g'`
-	  deplibs=`$ECHO &quot;X $deplibs&quot; | $Xsed -e 's% \([^ $]*\).ltframework% -framework \1%g'`
+	  newdeplibs=`$ECHO &quot; $newdeplibs&quot; | $SED 's% \([^ $]*\).ltframework% -framework \1%g'`
+	  new_inherited_linker_flags=`$ECHO &quot; $new_inherited_linker_flags&quot; | $SED 's% \([^ $]*\).ltframework% -framework \1%g'`
+	  deplibs=`$ECHO &quot; $deplibs&quot; | $SED 's% \([^ $]*\).ltframework% -framework \1%g'`
 	  ;;
       esac
 
@@ -6977,7 +7305,7 @@
 	done
 
 	# Use standard objects if they are pic
-	test -z &quot;$pic_flag&quot; &amp;&amp; libobjs=`$ECHO &quot;X$libobjs&quot; | $SP2NL | $Xsed -e &quot;$lo2o&quot; | $NL2SP`
+	test -z &quot;$pic_flag&quot; &amp;&amp; libobjs=`$ECHO &quot;$libobjs&quot; | $SP2NL | $SED &quot;$lo2o&quot; | $NL2SP`
 	test &quot;X$libobjs&quot; = &quot;X &quot; &amp;&amp; libobjs=
 
 	delfiles=
@@ -7043,7 +7371,7 @@
 	if test -n &quot;$export_symbols&quot; &amp;&amp; test -n &quot;$include_expsyms&quot;; then
 	  tmp_export_symbols=&quot;$export_symbols&quot;
 	  test -n &quot;$orig_export_symbols&quot; &amp;&amp; tmp_export_symbols=&quot;$orig_export_symbols&quot;
-	  $opt_dry_run || eval '$ECHO &quot;X$include_expsyms&quot; | $Xsed | $SP2NL &gt;&gt; &quot;$tmp_export_symbols&quot;'
+	  $opt_dry_run || eval '$ECHO &quot;$include_expsyms&quot; | $SP2NL &gt;&gt; &quot;$tmp_export_symbols&quot;'
 	fi
 
 	if test &quot;X$skipped_export&quot; != &quot;X:&quot; &amp;&amp; test -n &quot;$orig_export_symbols&quot;; then
@@ -7144,7 +7472,8 @@
 	    save_libobjs=$libobjs
 	  fi
 	  save_output=$output
-	  output_la=`$ECHO &quot;X$output&quot; | $Xsed -e &quot;$basename&quot;`
+	  func_basename &quot;$output&quot;
+	  output_la=$func_basename_result
 
 	  # Clear the reloadable object creation command queue and
 	  # initialize k to one.
@@ -7157,12 +7486,12 @@
 	  if test -n &quot;$save_libobjs&quot; &amp;&amp; test &quot;X$skipped_export&quot; != &quot;X:&quot; &amp;&amp; test &quot;$with_gnu_ld&quot; = yes; then
 	    output=${output_objdir}/${output_la}.lnkscript
 	    func_verbose &quot;creating GNU ld script: $output&quot;
-	    $ECHO 'INPUT (' &gt; $output
+	    echo 'INPUT (' &gt; $output
 	    for obj in $save_libobjs
 	    do
 	      $ECHO &quot;$obj&quot; &gt;&gt; $output
 	    done
-	    $ECHO ')' &gt;&gt; $output
+	    echo ')' &gt;&gt; $output
 	    delfiles=&quot;$delfiles $output&quot;
 	  elif test -n &quot;$save_libobjs&quot; &amp;&amp; test &quot;X$skipped_export&quot; != &quot;X:&quot; &amp;&amp; test &quot;X$file_list_spec&quot; != X; then
 	    output=${output_objdir}/${output_la}.lnk
@@ -7204,17 +7533,19 @@
 		  # command to the queue.
 		  if test &quot;$k&quot; -eq 1 ; then
 		    # The first file doesn't have a previous command to add.
-		    eval concat_cmds=\&quot;$reload_cmds $objlist $last_robj\&quot;
+		    reload_objs=$objlist
+		    eval concat_cmds=\&quot;$reload_cmds\&quot;
 		  else
 		    # All subsequent reloadable object files will link in
 		    # the last one created.
-		    eval concat_cmds=\&quot;\$concat_cmds~$reload_cmds $objlist $last_robj~\$RM $last_robj\&quot;
+		    reload_objs=&quot;$objlist $last_robj&quot;
+		    eval concat_cmds=\&quot;\$concat_cmds~$reload_cmds~\$RM $last_robj\&quot;
 		  fi
 		  last_robj=$output_objdir/$output_la-${k}.$objext
 		  func_arith $k + 1
 		  k=$func_arith_result
 		  output=$output_objdir/$output_la-${k}.$objext
-		  objlist=$obj
+		  objlist=&quot; $obj&quot;
 		  func_len &quot; $last_robj&quot;
 		  func_arith $len0 + $func_len_result
 		  len=$func_arith_result
@@ -7224,7 +7555,8 @@
 	      # reloadable object file.  All subsequent reloadable object
 	      # files will link in the last one created.
 	      test -z &quot;$concat_cmds&quot; || concat_cmds=$concat_cmds~
-	      eval concat_cmds=\&quot;\${concat_cmds}$reload_cmds $objlist $last_robj\&quot;
+	      reload_objs=&quot;$objlist $last_robj&quot;
+	      eval concat_cmds=\&quot;\${concat_cmds}$reload_cmds\&quot;
 	      if test -n &quot;$last_robj&quot;; then
 	        eval concat_cmds=\&quot;\${concat_cmds}~\$RM $last_robj\&quot;
 	      fi
@@ -7283,7 +7615,7 @@
 	    if test -n &quot;$export_symbols&quot; &amp;&amp; test -n &quot;$include_expsyms&quot;; then
 	      tmp_export_symbols=&quot;$export_symbols&quot;
 	      test -n &quot;$orig_export_symbols&quot; &amp;&amp; tmp_export_symbols=&quot;$orig_export_symbols&quot;
-	      $opt_dry_run || eval '$ECHO &quot;X$include_expsyms&quot; | $Xsed | $SP2NL &gt;&gt; &quot;$tmp_export_symbols&quot;'
+	      $opt_dry_run || eval '$ECHO &quot;$include_expsyms&quot; | $SP2NL &gt;&gt; &quot;$tmp_export_symbols&quot;'
 	    fi
 
 	    if test -n &quot;$orig_export_symbols&quot;; then
@@ -7448,7 +7780,7 @@
       if test -n &quot;$convenience&quot;; then
 	if test -n &quot;$whole_archive_flag_spec&quot;; then
 	  eval tmp_whole_archive_flags=\&quot;$whole_archive_flag_spec\&quot;
-	  reload_conv_objs=$reload_objs\ `$ECHO &quot;X$tmp_whole_archive_flags&quot; | $Xsed -e 's|,| |g'`
+	  reload_conv_objs=$reload_objs\ `$ECHO &quot;$tmp_whole_archive_flags&quot; | $SED 's|,| |g'`
 	else
 	  gentop=&quot;$output_objdir/${obj}x&quot;
 	  generated=&quot;$generated $gentop&quot;
@@ -7459,7 +7791,7 @@
       fi
 
       # Create the old-style object.
-      reload_objs=&quot;$objs$old_deplibs &quot;`$ECHO &quot;X$libobjs&quot; | $SP2NL | $Xsed -e '/\.'${libext}$'/d' -e '/\.lib$/d' -e &quot;$lo2o&quot; | $NL2SP`&quot; $reload_conv_objs&quot; ### testsuite: skip nested quoting test
+      reload_objs=&quot;$objs$old_deplibs &quot;`$ECHO &quot;$libobjs&quot; | $SP2NL | $SED &quot;/\.${libext}$/d; /\.lib$/d; $lo2o&quot; | $NL2SP`&quot; $reload_conv_objs&quot; ### testsuite: skip nested quoting test
 
       output=&quot;$obj&quot;
       func_execute_cmds &quot;$reload_cmds&quot; 'exit $?'
@@ -7519,8 +7851,8 @@
       case $host in
       *-*-rhapsody* | *-*-darwin1.[012])
 	# On Rhapsody replace the C library is the System framework
-	compile_deplibs=`$ECHO &quot;X $compile_deplibs&quot; | $Xsed -e 's/ -lc / System.ltframework /'`
-	finalize_deplibs=`$ECHO &quot;X $finalize_deplibs&quot; | $Xsed -e 's/ -lc / System.ltframework /'`
+	compile_deplibs=`$ECHO &quot; $compile_deplibs&quot; | $SED 's/ -lc / System.ltframework /'`
+	finalize_deplibs=`$ECHO &quot; $finalize_deplibs&quot; | $SED 's/ -lc / System.ltframework /'`
 	;;
       esac
 
@@ -7537,8 +7869,8 @@
 	  esac
 	fi
 	# Time to change all our &quot;foo.ltframework&quot; stuff back to &quot;-framework foo&quot;
-	compile_deplibs=`$ECHO &quot;X $compile_deplibs&quot; | $Xsed -e 's% \([^ $]*\).ltframework% -framework \1%g'`
-	finalize_deplibs=`$ECHO &quot;X $finalize_deplibs&quot; | $Xsed -e 's% \([^ $]*\).ltframework% -framework \1%g'`
+	compile_deplibs=`$ECHO &quot; $compile_deplibs&quot; | $SED 's% \([^ $]*\).ltframework% -framework \1%g'`
+	finalize_deplibs=`$ECHO &quot; $finalize_deplibs&quot; | $SED 's% \([^ $]*\).ltframework% -framework \1%g'`
 	;;
       esac
 
@@ -7675,8 +8007,8 @@
 
       if test -n &quot;$libobjs&quot; &amp;&amp; test &quot;$build_old_libs&quot; = yes; then
 	# Transform all the library objects into standard objects.
-	compile_command=`$ECHO &quot;X$compile_command&quot; | $SP2NL | $Xsed -e &quot;$lo2o&quot; | $NL2SP`
-	finalize_command=`$ECHO &quot;X$finalize_command&quot; | $SP2NL | $Xsed -e &quot;$lo2o&quot; | $NL2SP`
+	compile_command=`$ECHO &quot;$compile_command&quot; | $SP2NL | $SED &quot;$lo2o&quot; | $NL2SP`
+	finalize_command=`$ECHO &quot;$finalize_command&quot; | $SP2NL | $SED &quot;$lo2o&quot; | $NL2SP`
       fi
 
       func_generate_dlsyms &quot;$outputname&quot; &quot;@PROGRAM@&quot; &quot;no&quot;
@@ -7688,15 +8020,15 @@
 
       wrappers_required=yes
       case $host in
+      *cegcc* | *mingw32ce*)
+        # Disable wrappers for cegcc and mingw32ce hosts, we are cross compiling anyway.
+        wrappers_required=no
+        ;;
       *cygwin* | *mingw* )
         if test &quot;$build_libtool_libs&quot; != yes; then
           wrappers_required=no
         fi
         ;;
-      *cegcc)
-        # Disable wrappers for cegcc, we are cross compiling anyway.
-        wrappers_required=no
-        ;;
       *)
         if test &quot;$need_relink&quot; = no || test &quot;$build_libtool_libs&quot; != yes; then
           wrappers_required=no
@@ -7705,7 +8037,7 @@
       esac
       if test &quot;$wrappers_required&quot; = no; then
 	# Replace the output file specification.
-	compile_command=`$ECHO &quot;X$compile_command&quot; | $Xsed -e 's%@OUTPUT@%'&quot;$output&quot;'%g'`
+	compile_command=`$ECHO &quot;$compile_command&quot; | $SED 's%@OUTPUT@%'&quot;$output&quot;'%g'`
 	link_command=&quot;$compile_command$compile_rpath&quot;
 
 	# We have no uninstalled library dependencies, so finalize right now.
@@ -7752,7 +8084,7 @@
 	# We don't need to create a wrapper script.
 	link_command=&quot;$compile_var$compile_command$compile_rpath&quot;
 	# Replace the output file specification.
-	link_command=`$ECHO &quot;X$link_command&quot; | $Xsed -e 's%@OUTPUT@%'&quot;$output&quot;'%g'`
+	link_command=`$ECHO &quot;$link_command&quot; | $SED 's%@OUTPUT@%'&quot;$output&quot;'%g'`
 	# Delete the old output file.
 	$opt_dry_run || $RM $output
 	# Link the executable and exit
@@ -7771,7 +8103,7 @@
 	if test &quot;$fast_install&quot; != no; then
 	  link_command=&quot;$finalize_var$compile_command$finalize_rpath&quot;
 	  if test &quot;$fast_install&quot; = yes; then
-	    relink_command=`$ECHO &quot;X$compile_var$compile_command$compile_rpath&quot; | $Xsed -e 's%@OUTPUT@%\$progdir/\$file%g'`
+	    relink_command=`$ECHO &quot;$compile_var$compile_command$compile_rpath&quot; | $SED 's%@OUTPUT@%\$progdir/\$file%g'`
 	  else
 	    # fast_install is set to needless
 	    relink_command=
@@ -7783,7 +8115,7 @@
       fi
 
       # Replace the output file specification.
-      link_command=`$ECHO &quot;X$link_command&quot; | $Xsed -e 's%@OUTPUT@%'&quot;$output_objdir/$outputname&quot;'%g'`
+      link_command=`$ECHO &quot;$link_command&quot; | $SED 's%@OUTPUT@%'&quot;$output_objdir/$outputname&quot;'%g'`
 
       # Delete the old output files.
       $opt_dry_run || $RM $output $output_objdir/$outputname $output_objdir/lt-$outputname
@@ -7807,20 +8139,9 @@
 	  fi
 	done
 	relink_command=&quot;(cd `pwd`; $relink_command)&quot;
-	relink_command=`$ECHO &quot;X$relink_command&quot; | $Xsed -e &quot;$sed_quote_subst&quot;`
+	relink_command=`$ECHO &quot;$relink_command&quot; | $SED &quot;$sed_quote_subst&quot;`
       fi
 
-      # Quote $ECHO for shipping.
-      if test &quot;X$ECHO&quot; = &quot;X$SHELL $progpath --fallback-echo&quot;; then
-	case $progpath in
-	[\\/]* | [A-Za-z]:[\\/]*) qecho=&quot;$SHELL $progpath --fallback-echo&quot;;;
-	*) qecho=&quot;$SHELL `pwd`/$progpath --fallback-echo&quot;;;
-	esac
-	qecho=`$ECHO &quot;X$qecho&quot; | $Xsed -e &quot;$sed_quote_subst&quot;`
-      else
-	qecho=`$ECHO &quot;X$ECHO&quot; | $Xsed -e &quot;$sed_quote_subst&quot;`
-      fi
-
       # Only actually do things if not in dry run mode.
       $opt_dry_run || {
 	# win32 will think the script is a binary if it has
@@ -7939,7 +8260,7 @@
 	    done | sort | sort -uc &gt;/dev/null 2&gt;&amp;1); then
 	  :
 	else
-	  $ECHO &quot;copying selected object files to avoid basename conflicts...&quot;
+	  echo &quot;copying selected object files to avoid basename conflicts...&quot;
 	  gentop=&quot;$output_objdir/${outputname}x&quot;
 	  generated=&quot;$generated $gentop&quot;
 	  func_mkdir_p &quot;$gentop&quot;
@@ -8050,7 +8371,7 @@
       done
       # Quote the link command for shipping.
       relink_command=&quot;(cd `pwd`; $SHELL $progpath $preserve_args --mode=relink $libtool_args @inst_prefix_dir@)&quot;
-      relink_command=`$ECHO &quot;X$relink_command&quot; | $Xsed -e &quot;$sed_quote_subst&quot;`
+      relink_command=`$ECHO &quot;$relink_command&quot; | $SED &quot;$sed_quote_subst&quot;`
       if test &quot;$hardcode_automatic&quot; = yes ; then
 	relink_command=
       fi
@@ -8135,9 +8456,27 @@
 	  fi
 	  $RM $output
 	  # place dlname in correct position for cygwin
+	  # In fact, it would be nice if we could use this code for all target
+	  # systems that can't hard-code library paths into their executables
+	  # and that have no shared library path variable independent of PATH,
+	  # but it turns out we can't easily determine that from inspecting
+	  # libtool variables, so we have to hard-code the OSs to which it
+	  # applies here; at the moment, that means platforms that use the PE
+	  # object format with DLL files.  See the long comment at the top of
+	  # tests/bindir.at for full details.
 	  tdlname=$dlname
 	  case $host,$output,$installed,$module,$dlname in
-	    *cygwin*,*lai,yes,no,*.dll | *mingw*,*lai,yes,no,*.dll | *cegcc*,*lai,yes,no,*.dll) tdlname=../bin/$dlname ;;
+	    *cygwin*,*lai,yes,no,*.dll | *mingw*,*lai,yes,no,*.dll | *cegcc*,*lai,yes,no,*.dll)
+	      # If a -bindir argument was supplied, place the dll there.
+	      if test &quot;x$bindir&quot; != x ;
+	      then
+		func_relative_path &quot;$install_libdir&quot; &quot;$bindir&quot;
+		tdlname=$func_relative_path_result$dlname
+	      else
+		# Otherwise fall back on heuristic.
+		tdlname=../bin/$dlname
+	      fi
+	      ;;
 	  esac
 	  $ECHO &gt; $output &quot;\
 # $outputname - a libtool library file


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001746.html">[Pinot-svn] r1757 - trunk
</A></li>
	<LI>Next message: <A HREF="001748.html">[Pinot-svn] r1759 - in trunk: . po
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1747">[ date ]</a>
              <a href="thread.html#1747">[ thread ]</a>
              <a href="subject.html#1747">[ subject ]</a>
              <a href="author.html#1747">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/pinot-svn">More information about the Pinot-svn
mailing list</a><br>
</body></html>
