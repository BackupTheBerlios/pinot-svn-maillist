From fabricecolin at mail.berlios.de  Mon Dec  6 14:21:40 2010
From: fabricecolin at mail.berlios.de (fabricecolin at mail.berlios.de)
Date: Mon,  6 Dec 2010 14:21:40 +0100
Subject: [Pinot-svn] r1735 - in trunk: . po
Message-ID: <20101206132140.49281480CB6@sheep.berlios.de>

Author: fabricecolin
Date: 2010-12-06 14:21:39 +0100 (Mon, 06 Dec 2010)
New Revision: 1735

Modified:
   trunk/AUTHORS
   trunk/po/es.po
   trunk/po/it.po
Log:
Spanish and Italian translation updates by Fitoschido and Simone Sandri.


Modified: trunk/AUTHORS
===================================================================
--- trunk/AUTHORS	2010-10-25 11:41:55 UTC (rev 1734)
+++ trunk/AUTHORS	2010-12-06 13:21:39 UTC (rev 1735)
@@ -94,6 +94,7 @@
 		& DiegoJ <diegojromerolopez at gmail dot com>
 		& Juan Miguel Boyero Corral <???>
 		& Matias Fonzo <selkfoster at gmail dot com>
+		& Fitoschido <???>
 	Swedish - Daniel Nylander <po at danielnylander dot se>
 		& Zirro <???>
 

Modified: trunk/po/es.po
===================================================================
--- trunk/po/es.po	2010-10-25 11:41:55 UTC (rev 1734)
+++ trunk/po/es.po	2010-12-06 13:21:39 UTC (rev 1735)
@@ -7,9 +7,9 @@
 msgstr ""
 "Project-Id-Version: pinot 0.96\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2010-08-01 15:56+0800\n"
-"PO-Revision-Date: 2010-09-08 03:15+0000\n"
-"Last-Translator: Matias Fonzo <selkfoster at gmail.com>\n"
+"POT-Creation-Date: 2010-12-06 21:15+0800\n"
+"PO-Revision-Date: 2010-12-01 14:03+0000\n"
+"Last-Translator: Fitoschido <Unknown>\n"
 "Language-Team: es <fabricecolin at users.berlios.de>\n"
 "Language: \n"
 "MIME-Version: 1.0\n"
@@ -101,7 +101,7 @@
 #. Apply this label
 #. Is this an internal index ?
 #: Core/PinotSettings.cpp:436 Core/PinotSettings.cpp:1712
-#: Core/WorkerThreads.cpp:1036 UI/GTK2/src/mainWindow.cc:873
+#: Core/WorkerThreads.cpp:1048 UI/GTK2/src/mainWindow.cc:873
 #: UI/GTK2/src/mainWindow.cc:1139 UI/GTK2/src/mainWindow.cc:1402
 #: UI/GTK2/src/mainWindow.cc:1562 UI/GTK2/src/mainWindow.cc:1565
 #: UI/GTK2/src/mainWindow.cc:1669 UI/GTK2/src/mainWindow.cc:1703
@@ -112,7 +112,7 @@
 
 #. Spawn new threads
 #: Core/PinotSettings.cpp:437 Core/PinotSettings.cpp:1713
-#: Core/WorkerThreads.cpp:1046 UI/GTK2/src/mainWindow.cc:1134
+#: Core/WorkerThreads.cpp:1058 UI/GTK2/src/mainWindow.cc:1134
 #: UI/GTK2/src/mainWindow.cc:1392 UI/GTK2/src/mainWindow.cc:1406
 #: UI/GTK2/src/mainWindow.cc:1573 UI/GTK2/src/mainWindow.cc:1576
 #: UI/GTK2/src/mainWindow.cc:2441 UI/GTK2/src/statisticsDialog.cc:163
@@ -229,23 +229,23 @@
 msgid "Unknown error"
 msgstr "Error desconocido"
 
-#: Core/WorkerThreads.cpp:439
+#: Core/WorkerThreads.cpp:451
 msgid "Indexing was stopped"
 msgstr "La indexaci?n fue detenida"
 
-#: Core/WorkerThreads.cpp:452
+#: Core/WorkerThreads.cpp:464
 msgid "Can't index mail here"
 msgstr "No se puede indexar el correo aqu?"
 
-#: Core/WorkerThreads.cpp:473 Core/WorkerThreads.cpp:764
+#: Core/WorkerThreads.cpp:485 Core/WorkerThreads.cpp:776
 msgid "is already being indexed"
 msgstr "Ya se est? indexando"
 
-#: Core/WorkerThreads.cpp:483
+#: Core/WorkerThreads.cpp:495
 msgid "is blacklisted"
 msgstr "Est? excluido"
 
-#: Core/WorkerThreads.cpp:999
+#: Core/WorkerThreads.cpp:1011
 msgid "No title"
 msgstr "Sin t?tulo"
 
@@ -662,7 +662,7 @@
 
 #: UI/GTK2/src/mainWindow_glade.cc:258
 msgid "_Edit"
-msgstr "Editar"
+msgstr "_Editar"
 
 #: UI/GTK2/src/mainWindow_glade.cc:261
 msgid "_Options"
@@ -680,7 +680,7 @@
 msgid "Did you mean ?"
 msgstr "?Te refieres a?"
 
-#: UI/GTK2/src/Notebook.cc:95 UI/GTK2/src/Notebook.cc:236
+#: UI/GTK2/src/Notebook.cc:95 UI/GTK2/src/Notebook.cc:242
 msgid "Close"
 msgstr "Cerrar"
 
@@ -741,7 +741,7 @@
 #: UI/GTK2/src/prefsWindow_glade.cc:74 UI/GTK2/src/prefsWindow_glade.cc:90
 #: UI/GTK2/src/prefsWindow_glade.cc:106
 msgid "Add"
-msgstr "Agregar"
+msgstr "A?adir"
 
 #: UI/GTK2/src/prefsWindow_glade.cc:82
 msgid "File patterns:"

Modified: trunk/po/it.po
===================================================================
--- trunk/po/it.po	2010-10-25 11:41:55 UTC (rev 1734)
+++ trunk/po/it.po	2010-12-06 13:21:39 UTC (rev 1735)
@@ -6,10 +6,11 @@
 msgstr ""
 "Project-Id-Version: pinot 0.96\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2010-06-20 16:10+0800\n"
-"PO-Revision-Date: 2010-10-11 14:03+0000\n"
+"POT-Creation-Date: 2010-12-06 21:15+0800\n"
+"PO-Revision-Date: 2010-10-30 20:15+0000\n"
 "Last-Translator: simone.sandri <Unknown>\n"
 "Language-Team: Italian <it at li.org>\n"
+"Language: it\n"
 "MIME-Version: 1.0\n"
 "Content-Type: text/plain; charset=UTF-8\n"
 "Content-Transfer-Encoding: 8bit\n"
@@ -20,7 +21,7 @@
 
 #: SQL/SQLiteBase.cpp:455
 msgid "failed to rollback transaction"
-msgstr ""
+msgstr "impossibile annulare la transazione"
 
 #: SQL/SQLiteBase.cpp:491
 msgid "failed to end transaction"
@@ -28,70 +29,70 @@
 
 #: SQL/SQLiteBase.cpp:553
 msgid "couldn't format SQL statement"
-msgstr ""
+msgstr "Impossibile formattare lo stato SQL"
 
 #. Localize language names
-#: Core/pinot-dbus-daemon.cpp:543 UI/GTK2/src/pinot.cc:309
+#: Core/pinot-dbus-daemon.cpp:543 UI/GTK2/src/pinot.cc:308
 msgid "Unknown"
 msgstr "Sconosciuto"
 
-#: Core/pinot-dbus-daemon.cpp:544 UI/GTK2/src/pinot.cc:310
+#: Core/pinot-dbus-daemon.cpp:544 UI/GTK2/src/pinot.cc:309
 msgid "Danish"
 msgstr "Danese"
 
-#: Core/pinot-dbus-daemon.cpp:545 UI/GTK2/src/pinot.cc:311
+#: Core/pinot-dbus-daemon.cpp:545 UI/GTK2/src/pinot.cc:310
 msgid "Dutch"
 msgstr "Olandese"
 
-#: Core/pinot-dbus-daemon.cpp:546 UI/GTK2/src/pinot.cc:312
+#: Core/pinot-dbus-daemon.cpp:546 UI/GTK2/src/pinot.cc:311
 msgid "English"
 msgstr "Inglese"
 
-#: Core/pinot-dbus-daemon.cpp:547 UI/GTK2/src/pinot.cc:313
+#: Core/pinot-dbus-daemon.cpp:547 UI/GTK2/src/pinot.cc:312
 msgid "Finnish"
 msgstr "Finlandese"
 
-#: Core/pinot-dbus-daemon.cpp:548 UI/GTK2/src/pinot.cc:314
+#: Core/pinot-dbus-daemon.cpp:548 UI/GTK2/src/pinot.cc:313
 msgid "French"
 msgstr "Francese"
 
-#: Core/pinot-dbus-daemon.cpp:549 UI/GTK2/src/pinot.cc:315
+#: Core/pinot-dbus-daemon.cpp:549 UI/GTK2/src/pinot.cc:314
 msgid "German"
 msgstr "Tedesco"
 
-#: Core/pinot-dbus-daemon.cpp:550 UI/GTK2/src/pinot.cc:316
+#: Core/pinot-dbus-daemon.cpp:550 UI/GTK2/src/pinot.cc:315
 msgid "Hungarian"
 msgstr "Ungherese"
 
-#: Core/pinot-dbus-daemon.cpp:551 UI/GTK2/src/pinot.cc:317
+#: Core/pinot-dbus-daemon.cpp:551 UI/GTK2/src/pinot.cc:316
 msgid "Italian"
 msgstr "Italiano"
 
-#: Core/pinot-dbus-daemon.cpp:552 UI/GTK2/src/pinot.cc:318
+#: Core/pinot-dbus-daemon.cpp:552 UI/GTK2/src/pinot.cc:317
 msgid "Norwegian"
 msgstr "Norvegese"
 
-#: Core/pinot-dbus-daemon.cpp:553 UI/GTK2/src/pinot.cc:319
+#: Core/pinot-dbus-daemon.cpp:553 UI/GTK2/src/pinot.cc:318
 msgid "Portuguese"
 msgstr "Portoghese"
 
-#: Core/pinot-dbus-daemon.cpp:554 UI/GTK2/src/pinot.cc:320
+#: Core/pinot-dbus-daemon.cpp:554 UI/GTK2/src/pinot.cc:319
 msgid "Romanian"
 msgstr "Romeno"
 
-#: Core/pinot-dbus-daemon.cpp:555 UI/GTK2/src/pinot.cc:321
+#: Core/pinot-dbus-daemon.cpp:555 UI/GTK2/src/pinot.cc:320
 msgid "Russian"
 msgstr "Russo"
 
-#: Core/pinot-dbus-daemon.cpp:556 UI/GTK2/src/pinot.cc:322
+#: Core/pinot-dbus-daemon.cpp:556 UI/GTK2/src/pinot.cc:321
 msgid "Spanish"
 msgstr "Spagnolo"
 
-#: Core/pinot-dbus-daemon.cpp:557 UI/GTK2/src/pinot.cc:323
+#: Core/pinot-dbus-daemon.cpp:557 UI/GTK2/src/pinot.cc:322
 msgid "Swedish"
 msgstr "Svedese"
 
-#: Core/pinot-dbus-daemon.cpp:558 UI/GTK2/src/pinot.cc:324
+#: Core/pinot-dbus-daemon.cpp:558 UI/GTK2/src/pinot.cc:323
 msgid "Turkish"
 msgstr "Turco"
 
@@ -99,7 +100,7 @@
 #. Apply this label
 #. Is this an internal index ?
 #: Core/PinotSettings.cpp:436 Core/PinotSettings.cpp:1712
-#: Core/WorkerThreads.cpp:1036 UI/GTK2/src/mainWindow.cc:873
+#: Core/WorkerThreads.cpp:1048 UI/GTK2/src/mainWindow.cc:873
 #: UI/GTK2/src/mainWindow.cc:1139 UI/GTK2/src/mainWindow.cc:1402
 #: UI/GTK2/src/mainWindow.cc:1562 UI/GTK2/src/mainWindow.cc:1565
 #: UI/GTK2/src/mainWindow.cc:1669 UI/GTK2/src/mainWindow.cc:1703
@@ -110,7 +111,7 @@
 
 #. Spawn new threads
 #: Core/PinotSettings.cpp:437 Core/PinotSettings.cpp:1713
-#: Core/WorkerThreads.cpp:1046 UI/GTK2/src/mainWindow.cc:1134
+#: Core/WorkerThreads.cpp:1058 UI/GTK2/src/mainWindow.cc:1134
 #: UI/GTK2/src/mainWindow.cc:1392 UI/GTK2/src/mainWindow.cc:1406
 #: UI/GTK2/src/mainWindow.cc:1573 UI/GTK2/src/mainWindow.cc:1576
 #: UI/GTK2/src/mainWindow.cc:2441 UI/GTK2/src/statisticsDialog.cc:163
@@ -227,23 +228,23 @@
 msgid "Unknown error"
 msgstr "Errore sconosciuto"
 
-#: Core/WorkerThreads.cpp:439
+#: Core/WorkerThreads.cpp:451
 msgid "Indexing was stopped"
 msgstr "L'indicizzazione ? stata fermata"
 
-#: Core/WorkerThreads.cpp:452
+#: Core/WorkerThreads.cpp:464
 msgid "Can't index mail here"
 msgstr "Impossibile indicizzare la mail qui"
 
-#: Core/WorkerThreads.cpp:473 Core/WorkerThreads.cpp:764
+#: Core/WorkerThreads.cpp:485 Core/WorkerThreads.cpp:776
 msgid "is already being indexed"
 msgstr "? gia' stato indicizzato"
 
-#: Core/WorkerThreads.cpp:483
+#: Core/WorkerThreads.cpp:495
 msgid "is blacklisted"
 msgstr "? segnato come da non indicizzare"
 
-#: Core/WorkerThreads.cpp:999
+#: Core/WorkerThreads.cpp:1011
 msgid "No title"
 msgstr "Senza titolo"
 
@@ -680,15 +681,15 @@
 msgid "Did you mean ?"
 msgstr "Forse intendevi ?"
 
-#: UI/GTK2/src/Notebook.cc:95 UI/GTK2/src/Notebook.cc:236
+#: UI/GTK2/src/Notebook.cc:95 UI/GTK2/src/Notebook.cc:242
 msgid "Close"
 msgstr "Chiudi"
 
-#: UI/GTK2/src/pinot.cc:350
+#: UI/GTK2/src/pinot.cc:349
 msgid "Couldn't open index"
 msgstr "Impossibile aprire l'indice"
 
-#: UI/GTK2/src/pinot.cc:371
+#: UI/GTK2/src/pinot.cc:370
 msgid "Couldn't create history database"
 msgstr "Impossibile creare una cronologia del database"
 
@@ -733,8 +734,7 @@
 msgstr "Nuova descrizione"
 
 #: UI/GTK2/src/prefsWindow_glade.cc:69
-msgid ""
-"These directories will be indexed and optionally monitored for changes:"
+msgid "These directories will be indexed and optionally monitored for changes:"
 msgstr ""
 "Queste directory devono essere indicizzate e opzionalmente monitorate per "
 "cambiamenti:"



From fabricecolin at mail.berlios.de  Mon Dec  6 14:24:41 2010
From: fabricecolin at mail.berlios.de (fabricecolin at mail.berlios.de)
Date: Mon,  6 Dec 2010 14:24:41 +0100
Subject: [Pinot-svn] r1736 - trunk
Message-ID: <20101206132441.D583A480CB6@sheep.berlios.de>

Author: fabricecolin
Date: 2010-12-06 14:24:41 +0100 (Mon, 06 Dec 2010)
New Revision: 1736

Modified:
   trunk/README
   trunk/textcat_conf.txt
Log:
README's reset of historical data bit ignored ActionQueue.
Brought textcat_conf.txt in line with how libtextcat 2.x is packaged on most
platforms.


Modified: trunk/README
===================================================================
--- trunk/README	2010-12-06 13:21:39 UTC (rev 1735)
+++ trunk/README	2010-12-06 13:24:41 UTC (rev 1736)
@@ -499,7 +499,7 @@
   The manual way is to delete the index with
   $ rm ~/.pinot/daemon/*
   and remove historical data with
-  $ sqlite3 ~/.pinot/history-daemon "delete from CrawlHistory; delete from CrawlSources;"
+  $ sqlite3 ~/.pinot/history-daemon "delete from CrawlHistory; delete from CrawlSources; delete from ActionQueue;"
 
   The automated way is to tell the daemon to reindex everything by launching
   it with the "--reindex" option, ie

Modified: trunk/textcat_conf.txt
===================================================================
--- trunk/textcat_conf.txt	2010-12-06 13:21:39 UTC (rev 1735)
+++ trunk/textcat_conf.txt	2010-12-06 13:24:41 UTC (rev 1736)
@@ -3,20 +3,18 @@
 # The following languages are supported by Xapian::Stem
 # Languages names MUST be in English
 #
-/usr/share/libtextcat/LM/danish.lm			danish
-/usr/share/libtextcat/LM/dutch.lm			dutch
-/usr/share/libtextcat/LM/english.lm			english
-/usr/share/libtextcat/LM/finnish.lm			finnish
-/usr/share/libtextcat/LM/french.lm			french
-/usr/share/libtextcat/LM/german.lm			german
-/usr/share/libtextcat/LM/hungarian.lm			hungarian
-/usr/share/libtextcat/LM/italian.lm			italian
-/usr/share/libtextcat/LM/norwegian.lm			norwegian
-/usr/share/libtextcat/LM/portuguese.lm			portuguese
-/usr/share/libtextcat/LM/romanian.lm			romanian
-/usr/share/libtextcat/LM/russian-iso8859_5.lm		russian-iso8859_5
-/usr/share/libtextcat/LM/russian-koi8_r.lm		russian-koi8_r
-/usr/share/libtextcat/LM/russian-windows1251.lm		russian-windows1251
-/usr/share/libtextcat/LM/spanish.lm			spanish
-/usr/share/libtextcat/LM/swedish.lm			swedish
-/usr/share/libtextcat/LM/turkish.lm			turkish
+/usr/share/libtextcat/danish.lm			danish
+/usr/share/libtextcat/dutch.lm			dutch
+/usr/share/libtextcat/english.lm		english
+/usr/share/libtextcat/finnish.lm		finnish
+/usr/share/libtextcat/french.lm			french
+/usr/share/libtextcat/german.lm			german
+/usr/share/libtextcat/hungarian.lm		hungarian
+/usr/share/libtextcat/italian.lm		italian
+/usr/share/libtextcat/norwegian.lm		norwegian
+/usr/share/libtextcat/portuguese.lm		portuguese
+/usr/share/libtextcat/romanian.lm		romanian
+/usr/share/libtextcat/russian.lm		russian
+/usr/share/libtextcat/spanish.lm		spanish
+/usr/share/libtextcat/swedish.lm		swedish
+/usr/share/libtextcat/turkish.lm		turkish



From fabricecolin at mail.berlios.de  Mon Dec  6 16:47:19 2010
From: fabricecolin at mail.berlios.de (fabricecolin at mail.berlios.de)
Date: Mon,  6 Dec 2010 16:47:19 +0100
Subject: [Pinot-svn] r1737 - trunk
Message-ID: <20101206154719.B7D22480D42@sheep.berlios.de>

Author: fabricecolin
Date: 2010-12-06 16:47:19 +0100 (Mon, 06 Dec 2010)
New Revision: 1737

Modified:
   trunk/Makefile.am
   trunk/pinot.spec.in
Log:
Moved the deskbar plugins to /usr/libexec, where they should have been since
version 2_27_91 !


Modified: trunk/Makefile.am
===================================================================
--- trunk/Makefile.am	2010-12-06 13:24:41 UTC (rev 1736)
+++ trunk/Makefile.am	2010-12-06 15:47:19 UTC (rev 1737)
@@ -73,10 +73,10 @@
 if HAVE_DBUS
 	@desktop-file-install --vendor="" --dir=$(DESTDIR)${sysconfdir}/xdg/autostart $(srcdir)/pinot-dbus-daemon.desktop
 endif
-	@mkdir -p $(DESTDIR)$(libdir)/deskbar-applet/handlers/
-	$(INSTALL_DATA) $(srcdir)/scripts/python/pinot-live.py $(DESTDIR)$(libdir)/deskbar-applet/handlers/
-	@mkdir -p $(DESTDIR)$(libdir)/deskbar-applet/modules-2.20-compatible/
-	$(INSTALL_DATA) $(srcdir)/scripts/python/pinot-module.py $(DESTDIR)$(libdir)/deskbar-applet/modules-2.20-compatible/
+	@mkdir -p $(DESTDIR)$(libexecdir)/deskbar-applet/handlers/
+	$(INSTALL_DATA) $(srcdir)/scripts/python/pinot-live.py $(DESTDIR)$(libexecdir)/deskbar-applet/handlers/
+	@mkdir -p $(DESTDIR)$(libexecdir)/deskbar-applet/modules-2.20-compatible/
+	$(INSTALL_DATA) $(srcdir)/scripts/python/pinot-module.py $(DESTDIR)$(libexecdir)/deskbar-applet/modules-2.20-compatible/
 	$(INSTALL_DATA) $(srcdir)/scripts/bash/*.sh $(DESTDIR)$(datadir)/pinot/
 
 uninstall-local:

Modified: trunk/pinot.spec.in
===================================================================
--- trunk/pinot.spec.in	2010-12-06 13:24:41 UTC (rev 1736)
+++ trunk/pinot.spec.in	2010-12-06 15:47:19 UTC (rev 1737)
@@ -116,8 +116,8 @@
 
 %files deskbar
 %defattr(-,root,root,-)
-%{_libdir}/deskbar-applet/handlers/pinot-*
-%{_libdir}/deskbar-applet/modules-2.20-compatible/pinot-*
+%{_libexecdir}/deskbar-applet/handlers/pinot-*
+%{_libexecdir}/deskbar-applet/modules-2.20-compatible/pinot-*
 
 %changelog
 



From fabricecolin at mail.berlios.de  Wed Dec  8 16:03:04 2010
From: fabricecolin at mail.berlios.de (fabricecolin at mail.berlios.de)
Date: Wed,  8 Dec 2010 16:03:04 +0100
Subject: [Pinot-svn] r1738 - trunk/IndexSearch/Xapian
Message-ID: <20101208150304.8957E480DF3@sheep.berlios.de>

Author: fabricecolin
Date: 2010-12-08 16:03:04 +0100 (Wed, 08 Dec 2010)
New Revision: 1738

Modified:
   trunk/IndexSearch/Xapian/XapianIndex.cpp
Log:
Remove dots at the end of terms that don't look like acronyms.


Modified: trunk/IndexSearch/Xapian/XapianIndex.cpp
===================================================================
--- trunk/IndexSearch/Xapian/XapianIndex.cpp	2010-12-06 15:47:19 UTC (rev 1737)
+++ trunk/IndexSearch/Xapian/XapianIndex.cpp	2010-12-08 15:03:04 UTC (rev 1738)
@@ -115,6 +115,50 @@
 				return true;
 			}
 
+			// Does it end with a dot ?
+			if (term[term.length() - 1] == '.')
+			{
+				bool foundNonDot = false;
+
+#ifdef DEBUG
+				cout << "TokensIndexer::handle_token: dot at end of " << term << endl;
+#endif
+				string::size_type pos = term.length() - 1;
+				while (pos >= 0)
+				{
+					if (term[pos] != '.')
+					{
+						foundNonDot = true;
+
+						// Any dot before that ?
+						if ((pos == 0) ||
+							(term.find_last_of(".", pos - 1) == string::npos))
+						{
+							// No, all dots are at the end, trim them
+							term.erase(pos + 1);
+#ifdef DEBUG
+							cout << "TokensIndexer::handle_token: trimmed to " << term << " " << pos + 1 << endl;
+#endif
+						}
+#ifdef DEBUG
+						else cout << "TokensIndexer::handle_token: keeping potential acronym " << term << endl;
+#endif
+						break;
+					}
+
+					if (pos == 0)
+					{
+						break;
+					}
+					--pos;
+				}
+
+				if (foundNonDot == false)
+				{
+					// It's all dots !
+					return true;
+				}
+			}
 			m_doc.add_posting(m_prefix + XapianDatabase::limitTermLength(term), m_termPos);
 
 			// Is this CJKV ?



From fabricecolin at mail.berlios.de  Fri Dec 10 03:07:47 2010
From: fabricecolin at mail.berlios.de (fabricecolin at mail.berlios.de)
Date: Fri, 10 Dec 2010 03:07:47 +0100
Subject: [Pinot-svn] r1739 - trunk
Message-ID: <20101210020747.48A09480EBB@sheep.berlios.de>

Author: fabricecolin
Date: 2010-12-10 03:07:46 +0100 (Fri, 10 Dec 2010)
New Revision: 1739

Modified:
   trunk/Makefile.am
   trunk/pinot.spec.in
Log:
Leave the old DeskBar handlers in libdir.


Modified: trunk/Makefile.am
===================================================================
--- trunk/Makefile.am	2010-12-08 15:03:04 UTC (rev 1738)
+++ trunk/Makefile.am	2010-12-10 02:07:46 UTC (rev 1739)
@@ -73,8 +73,8 @@
 if HAVE_DBUS
 	@desktop-file-install --vendor="" --dir=$(DESTDIR)${sysconfdir}/xdg/autostart $(srcdir)/pinot-dbus-daemon.desktop
 endif
-	@mkdir -p $(DESTDIR)$(libexecdir)/deskbar-applet/handlers/
-	$(INSTALL_DATA) $(srcdir)/scripts/python/pinot-live.py $(DESTDIR)$(libexecdir)/deskbar-applet/handlers/
+	@mkdir -p $(DESTDIR)$(libdir)/deskbar-applet/handlers/
+	$(INSTALL_DATA) $(srcdir)/scripts/python/pinot-live.py $(DESTDIR)$(libdir)/deskbar-applet/handlers/
 	@mkdir -p $(DESTDIR)$(libexecdir)/deskbar-applet/modules-2.20-compatible/
 	$(INSTALL_DATA) $(srcdir)/scripts/python/pinot-module.py $(DESTDIR)$(libexecdir)/deskbar-applet/modules-2.20-compatible/
 	$(INSTALL_DATA) $(srcdir)/scripts/bash/*.sh $(DESTDIR)$(datadir)/pinot/
@@ -92,5 +92,5 @@
 	@rm -rf $(DESTDIR)$(datadir)/applications/pinot.desktop
 	@rm -rf $(DESTDIR)${sysconfdir}/xdg/autostart/pinot-dbus-daemon.desktop
 	@rm -rf $(DESTDIR)$(libdir)/deskbar-applet/handlers/pinot-live.py*
-	@rm -rf $(DESTDIR)$(libdir)/deskbar-applet/modules-2.20-compatible/pinot-module.py*
+	@rm -rf $(DESTDIR)$(libexecdir)/deskbar-applet/modules-2.20-compatible/pinot-module.py*
 

Modified: trunk/pinot.spec.in
===================================================================
--- trunk/pinot.spec.in	2010-12-08 15:03:04 UTC (rev 1738)
+++ trunk/pinot.spec.in	2010-12-10 02:07:46 UTC (rev 1739)
@@ -116,7 +116,7 @@
 
 %files deskbar
 %defattr(-,root,root,-)
-%{_libexecdir}/deskbar-applet/handlers/pinot-*
+%{_libdir}/deskbar-applet/handlers/pinot-*
 %{_libexecdir}/deskbar-applet/modules-2.20-compatible/pinot-*
 
 %changelog



From fabricecolin at mail.berlios.de  Fri Dec 10 03:13:32 2010
From: fabricecolin at mail.berlios.de (fabricecolin at mail.berlios.de)
Date: Fri, 10 Dec 2010 03:13:32 +0100
Subject: [Pinot-svn] r1740 - in trunk: Core UI/GTK2/src
Message-ID: <20101210021333.11626480EBB@sheep.berlios.de>

Author: fabricecolin
Date: 2010-12-10 03:13:32 +0100 (Fri, 10 Dec 2010)
New Revision: 1740

Modified:
   trunk/Core/DaemonState.cpp
   trunk/Core/ServerThreads.cpp
   trunk/Core/ServerThreads.h
   trunk/Core/WorkerThreads.cpp
   trunk/Core/WorkerThreads.h
   trunk/Core/pinot-index.cpp
   trunk/UI/GTK2/src/mainWindow.cc
   trunk/UI/GTK2/src/prefsWindow.cc
   trunk/UI/GTK2/src/prefsWindow.hh
   trunk/UI/GTK2/src/statisticsDialog.cc
   trunk/UI/GTK2/src/statisticsDialog.hh
Log:
The maximum number of indexing threads defaults to 1, can still be controlled
globally by PINOT_MAXIMUM_INDEX_THREADS. Crawler and DirectoryScanner threads
index documents inline by default, don't delegate to an Indexing thread.


Modified: trunk/Core/DaemonState.cpp
===================================================================
--- trunk/Core/DaemonState.cpp	2010-12-10 02:07:46 UTC (rev 1739)
+++ trunk/Core/DaemonState.cpp	2010-12-10 02:13:32 UTC (rev 1740)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2005-2009 Fabrice Colin
+ *  Copyright 2005-2010 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
@@ -317,7 +317,7 @@
 #endif
 
 DaemonState::DaemonState() :
-	ThreadsManager(PinotSettings::getInstance().m_daemonIndexLocation, 4),
+	ThreadsManager(PinotSettings::getInstance().m_daemonIndexLocation),
 	m_isReindex(false),
 	m_reload(false),
 	m_flush(false),
@@ -328,19 +328,6 @@
 {
 	FD_ZERO(&m_flagsSet);
 
-	// Override the number of indexing threads ?
-	char *pEnvVar = getenv("PINOT_MAXIMUM_INDEX_THREADS");
-	if ((pEnvVar != NULL) &&
-		(strlen(pEnvVar) > 0))
-	{
-		int threadsNum = atoi(pEnvVar);
-
-		if (threadsNum > 0)
-		{
-			m_maxIndexThreads = (unsigned int)threadsNum;
-		}
-	}
-
 	// Check disk usage every minute
 	m_timeoutConnection = Glib::signal_timeout().connect(sigc::mem_fun(*this,
 		&DaemonState::on_activity_timeout), 60000);
@@ -441,10 +428,11 @@
 
 bool DaemonState::crawl_location(const PinotSettings::IndexableLocation &location)
 {
+	CrawlerThread *pCrawlerThread = NULL;
 	string locationToCrawl(location.m_name);
 	bool doMonitoring = location.m_monitor;
 	bool isSource = location.m_isSource;
-	CrawlerThread *pCrawlerThread = NULL;
+	bool inlineIndexing = false;
 
 	// Can we go ahead and crawl ?
 	if ((is_flag_set(LOW_DISK_SPACE) == true) ||
@@ -461,17 +449,22 @@
 		return false;
 	}
 
+	if (m_maxIndexThreads < 2)
+	{
+		inlineIndexing = true;
+	}
+
 	if (doMonitoring == false)
 	{
 		// Monitoring is not necessary, but we still have to pass the handler
 		// so that we can act on documents that have been deleted
 		pCrawlerThread = new CrawlerThread(locationToCrawl, isSource,
-			NULL, m_pDiskHandler);
+			NULL, m_pDiskHandler, inlineIndexing);
 	}
 	else
 	{
 		pCrawlerThread = new CrawlerThread(locationToCrawl, isSource,
-			m_pDiskMonitor, m_pDiskHandler);
+			m_pDiskMonitor, m_pDiskHandler, inlineIndexing);
 	}
 	pCrawlerThread->getFileFoundSignal().connect(sigc::mem_fun(*this, &DaemonState::on_message_filefound));
 

Modified: trunk/Core/ServerThreads.cpp
===================================================================
--- trunk/Core/ServerThreads.cpp	2010-12-10 02:07:46 UTC (rev 1739)
+++ trunk/Core/ServerThreads.cpp	2010-12-10 02:13:32 UTC (rev 1740)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2005-2009 Fabrice Colin
+ *  Copyright 2005-2010 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
@@ -113,10 +113,11 @@
 }
 
 CrawlerThread::CrawlerThread(const string &dirName, bool isSource,
-	MonitorInterface *pMonitor, MonitorHandler *pHandler) :
+	MonitorInterface *pMonitor, MonitorHandler *pHandler,
+	bool inlineIndexing) :
 	DirectoryScannerThread(dirName,
 		PinotSettings::getInstance().m_daemonIndexLocation,
-		0, false, true),
+		0, inlineIndexing, true),
 	m_sourceId(0),
 	m_pMonitor(pMonitor),
 	m_pHandler(pHandler),

Modified: trunk/Core/ServerThreads.h
===================================================================
--- trunk/Core/ServerThreads.h	2010-12-10 02:07:46 UTC (rev 1739)
+++ trunk/Core/ServerThreads.h	2010-12-10 02:13:32 UTC (rev 1740)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2005-2009 Fabrice Colin
+ *  Copyright 2005-2010 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
@@ -41,7 +41,8 @@
 {
 	public:
 		CrawlerThread(const std::string &dirName, bool isSource,
-			MonitorInterface *pMonitor, MonitorHandler *pHandler);
+			MonitorInterface *pMonitor, MonitorHandler *pHandler,
+			bool inlineIndexing = false);
 		virtual ~CrawlerThread();
 
 		virtual std::string getType(void) const;

Modified: trunk/Core/WorkerThreads.cpp
===================================================================
--- trunk/Core/WorkerThreads.cpp	2010-12-10 02:07:46 UTC (rev 1739)
+++ trunk/Core/WorkerThreads.cpp	2010-12-10 02:13:32 UTC (rev 1740)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2005-2009 Fabrice Colin
+ *  Copyright 2005-2010 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
@@ -274,11 +274,10 @@
 unsigned int ThreadsManager::m_nextThreadId = 1;
 
 ThreadsManager::ThreadsManager(const string &defaultIndexLocation,
-	unsigned int maxIndexThreads, unsigned int maxThreadsTime,
-	bool scanLocalFiles) :
+	unsigned int maxThreadsTime, bool scanLocalFiles) :
 	m_actionQueue(PinotSettings::getInstance().getHistoryDatabaseName(), get_application_name()),
 	m_defaultIndexLocation(defaultIndexLocation),
-	m_maxIndexThreads(maxIndexThreads),
+	m_maxIndexThreads(1),
 	m_backgroundThreadsCount(0),
 	m_foregroundThreadsMaxTime(maxThreadsTime),
 	m_scanLocalFiles(scanLocalFiles),
@@ -288,6 +287,19 @@
 	pthread_rwlock_init(&m_threadsLock, NULL);
 	pthread_rwlock_init(&m_listsLock, NULL);
 
+	// Override the number of indexing threads ?
+	char *pEnvVar = getenv("PINOT_MAXIMUM_INDEX_THREADS");
+	if ((pEnvVar != NULL) &&
+		(strlen(pEnvVar) > 0))
+	{
+		int threadsNum = atoi(pEnvVar);
+
+		if (threadsNum > 0)
+		{
+			m_maxIndexThreads = (unsigned int)threadsNum;
+		}
+	}
+
 #ifdef __OpenBSD__
 	int mib[2], ncpus;
 

Modified: trunk/Core/WorkerThreads.h
===================================================================
--- trunk/Core/WorkerThreads.h	2010-12-10 02:07:46 UTC (rev 1739)
+++ trunk/Core/WorkerThreads.h	2010-12-10 02:13:32 UTC (rev 1740)
@@ -112,7 +112,6 @@
 {
 	public:
 		ThreadsManager(const std::string &defaultIndexLocation,
-			unsigned int maxIndexThreads,
 			unsigned int maxThreadsTime = 300,
 			bool scanLocalFiles = false);
 		virtual ~ThreadsManager();

Modified: trunk/Core/pinot-index.cpp
===================================================================
--- trunk/Core/pinot-index.cpp	2010-12-10 02:07:46 UTC (rev 1739)
+++ trunk/Core/pinot-index.cpp	2010-12-10 02:13:32 UTC (rev 1740)
@@ -60,7 +60,7 @@
 {
 	public:
 		IndexingState(const string &indexLocation) :
-			ThreadsManager(indexLocation, 1, 60, true),
+			ThreadsManager(indexLocation, 60, true),
 			m_docId(0)
 		{
 			// Disable implicit flushing

Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2010-12-10 02:07:46 UTC (rev 1739)
+++ trunk/UI/GTK2/src/mainWindow.cc	2010-12-10 02:13:32 UTC (rev 1740)
@@ -116,7 +116,7 @@
 }
 
 mainWindow::InternalState::InternalState(mainWindow *pWindow) :
-	ThreadsManager(PinotSettings::getInstance().m_docsIndexLocation, 2, 60, true),
+	ThreadsManager(PinotSettings::getInstance().m_docsIndexLocation, 60, true),
 	m_liveQueryLength(0),
 	m_currentPage(0),
 	m_browsingIndex(false)

Modified: trunk/UI/GTK2/src/prefsWindow.cc
===================================================================
--- trunk/UI/GTK2/src/prefsWindow.cc	2010-12-10 02:07:46 UTC (rev 1739)
+++ trunk/UI/GTK2/src/prefsWindow.cc	2010-12-10 02:13:32 UTC (rev 1740)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2008-2009 Fabrice Colin
+ *  Copyright 2008-2010 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
@@ -129,8 +129,8 @@
 
 };
 
-prefsWindow::InternalState::InternalState(unsigned int maxIndexThreads, prefsWindow *pWindow) :
-        ThreadsManager(PinotSettings::getInstance().m_docsIndexLocation, maxIndexThreads),
+prefsWindow::InternalState::InternalState(prefsWindow *pWindow) :
+        ThreadsManager(PinotSettings::getInstance().m_docsIndexLocation),
 	m_savedPrefs(false)
 {
         m_onThreadEndSignal.connect(sigc::mem_fun(*pWindow, &prefsWindow::on_thread_end));
@@ -143,7 +143,7 @@
 prefsWindow::prefsWindow() :
 	prefsWindow_glade(),
 	m_settings(PinotSettings::getInstance()),
-	m_state(10, this)
+	m_state(this)
 {
 	Color newColour;
 	ustring desktopName(_("File Indexing and Search"));

Modified: trunk/UI/GTK2/src/prefsWindow.hh
===================================================================
--- trunk/UI/GTK2/src/prefsWindow.hh	2010-12-10 02:07:46 UTC (rev 1739)
+++ trunk/UI/GTK2/src/prefsWindow.hh	2010-12-10 02:13:32 UTC (rev 1740)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2008-2009 Fabrice Colin
+ *  Copyright 2008-2010 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
@@ -57,8 +57,7 @@
 	class InternalState : public ThreadsManager
 	{
 	public:
-		InternalState(unsigned int maxIndexThreads,
-			prefsWindow *pWindow);
+		InternalState(prefsWindow *pWindow);
 		~InternalState();
 
 		bool m_savedPrefs;

Modified: trunk/UI/GTK2/src/statisticsDialog.cc
===================================================================
--- trunk/UI/GTK2/src/statisticsDialog.cc	2010-12-10 02:07:46 UTC (rev 1739)
+++ trunk/UI/GTK2/src/statisticsDialog.cc	2010-12-10 02:13:32 UTC (rev 1740)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2005-2009 Fabrice Colin
+ *  Copyright 2005-2010 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
@@ -91,8 +91,8 @@
 };
 #endif
 
-statisticsDialog::InternalState::InternalState(unsigned int maxIndexThreads, statisticsDialog *pWindow) :
-        ThreadsManager(PinotSettings::getInstance().m_docsIndexLocation, maxIndexThreads),
+statisticsDialog::InternalState::InternalState(statisticsDialog *pWindow) :
+        ThreadsManager(PinotSettings::getInstance().m_docsIndexLocation),
 	m_getStats(true),
 	m_gettingStats(false),
 	m_lowDiskSpace(false),
@@ -112,7 +112,7 @@
 	m_hasDiskSpace(false),
 	m_hasBattery(false),
 	m_hasCrawl(false),
-	m_state(10, this)
+	m_state(this)
 {
 	// Associate the columns model to the engines tree
 	m_refStore = TreeStore::create(m_statsColumns);

Modified: trunk/UI/GTK2/src/statisticsDialog.hh
===================================================================
--- trunk/UI/GTK2/src/statisticsDialog.hh	2010-12-10 02:07:46 UTC (rev 1739)
+++ trunk/UI/GTK2/src/statisticsDialog.hh	2010-12-10 02:13:32 UTC (rev 1740)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2005-2009 Fabrice Colin
+ *  Copyright 2005-2010 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
@@ -58,8 +58,7 @@
 	class InternalState : public ThreadsManager
 	{
 	public:
-		InternalState(unsigned int maxIndexThreads,
-			statisticsDialog *pWindow);
+		InternalState(statisticsDialog *pWindow);
 		~InternalState();
 
 		bool m_getStats;



From fabricecolin at mail.berlios.de  Fri Dec 10 03:15:33 2010
From: fabricecolin at mail.berlios.de (fabricecolin at mail.berlios.de)
Date: Fri, 10 Dec 2010 03:15:33 +0100
Subject: [Pinot-svn] r1741 - trunk/Utils
Message-ID: <20101210021533.570E8480EBB@sheep.berlios.de>

Author: fabricecolin
Date: 2010-12-10 03:15:33 +0100 (Fri, 10 Dec 2010)
New Revision: 1741

Modified:
   trunk/Utils/Memory.cpp
   trunk/Utils/Memory.h
Log:
Obsoleted our custom memory pool class, use boost::singleton_pool if available.


Modified: trunk/Utils/Memory.cpp
===================================================================
--- trunk/Utils/Memory.cpp	2010-12-10 02:13:32 UTC (rev 1740)
+++ trunk/Utils/Memory.cpp	2010-12-10 02:15:33 UTC (rev 1741)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2009 Fabrice Colin
+ *  Copyright 2009-2010 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
@@ -30,13 +30,13 @@
 #ifdef HAVE_BOOST_POOL_POOLFWD_HPP
 #ifdef HAVE_UMEM_H
 // Memory pool with umem
-typedef fixed_singleton_pool<umem_allocator_tag,
+typedef boost::singleton_pool<umem_allocator_tag,
 	sizeof(char), umem_allocator,
 	boost::details::pool::default_mutex, 131072> filter_pool;
 #else
 // Memory pool with malloc (glibc's or any other implementation)
 // The tag is actually ignored
-typedef fixed_singleton_pool<fixed_pool_allocator_tag,
+typedef boost::singleton_pool<boost::pool_allocator_tag,
 	sizeof(char), boost::default_user_allocator_malloc_free,
 	boost::details::pool::default_mutex, 131072> filter_pool;
 #endif
@@ -105,18 +105,11 @@
 void Memory::reclaim(void)
 {
 #ifdef HAVE_BOOST_POOL_POOLFWD_HPP
-#ifdef HAVE_UMEM_H
-	bool releasedMemory = fixed_singleton_pool<fixed_pool_allocator_tag, sizeof(char), umem_allocator, boost::details::pool::default_mutex, 131072>::release_memory();
+	bool releasedMemory = filter_pool::release_memory();
 #ifdef DEBUG
-	clog << "Memory::reclaim: released umem allocated memory pool (" << releasedMemory << ")" << endl;
+	clog << "Memory::reclaim: released allocated memory pool (" << releasedMemory << ")" << endl;
 #endif
-#else
-	bool releasedMemory = fixed_singleton_pool<fixed_pool_allocator_tag, sizeof(char), boost::default_user_allocator_malloc_free, boost::details::pool::default_mutex, 131072>::release_memory();
-#ifdef DEBUG
-	clog << "Memory::reclaim: released malloc allocated memory pool (" << releasedMemory << ")" << endl;
 #endif
-#endif
-#endif
 
 #ifdef HAVE_UMEM_H
 	umem_reap();
@@ -124,7 +117,7 @@
 #ifdef HAVE_MALLOC_TRIM
 	int trimmedMemory = malloc_trim(0);
 #ifdef DEBUG
-	clog << "Memory::reclaim: trimmed malloc allocated memory (" << trimmedMemory << ")" << endl;
+	clog << "Memory::reclaim: trimmed allocated memory (" << trimmedMemory << ")" << endl;
 #endif
 #endif
 #endif

Modified: trunk/Utils/Memory.h
===================================================================
--- trunk/Utils/Memory.h	2010-12-10 02:13:32 UTC (rev 1740)
+++ trunk/Utils/Memory.h	2010-12-10 02:15:33 UTC (rev 1741)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2009 Fabrice Colin
+ *  Copyright 2009-2010 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
@@ -20,6 +20,7 @@
 #define _MEMORY_H
 
 #include "config.h"
+#include <execinfo.h>
 #include <string>
 #include <iostream>
 #ifdef HAVE_UMEM_H
@@ -153,241 +154,18 @@
 #ifdef HAVE_BOOST_POOL_POOLFWD_HPP
 // This header should be available if poolfwd.hpp is
 #include <boost/pool/pool_alloc.hpp>
-
-/// Based on boost::singleton_pool, with changes to release_memory() and purge_memory()
-template <typename Tag,
-	unsigned RequestedSize,
-	typename UserAllocator,
-	typename Mutex,
-	unsigned NextSize>
-struct fixed_singleton_pool
-{
-	public:
-		typedef Tag           tag;
-		typedef Mutex         mutex;
-		typedef UserAllocator user_allocator;
-		typedef typename boost::pool<UserAllocator>::size_type size_type;
-		typedef typename boost::pool<UserAllocator>::difference_type difference_type;
-
-		BOOST_STATIC_CONSTANT(unsigned, requested_size = RequestedSize);
-		BOOST_STATIC_CONSTANT(unsigned, next_size = NextSize);
-
-	private:
-		struct pool_type: Mutex
-		{
-			boost::pool<UserAllocator> p;
-			pool_type():p(RequestedSize, NextSize)
-			{
-			}
-		};
-
-		typedef boost::details::pool::singleton_default<pool_type> singleton;
-
-		fixed_singleton_pool();
-
-	public:
-		static void *malloc()
-		{
-			pool_type &p = singleton::instance();
-			boost::details::pool::guard<Mutex> g(p);
-			return p.p.malloc();
-		}
-		static void *ordered_malloc()
-		{
-			pool_type &p = singleton::instance();
-			boost::details::pool::guard<Mutex> g(p);
-			return p.p.ordered_malloc();
-		}
-		static void *ordered_malloc(const size_type n)
-		{
-			pool_type &p = singleton::instance();
-			boost::details::pool::guard<Mutex> g(p);
-#ifdef DEBUG
-			std::cout << "fixed_singleton_pool::ordered_malloc: allocating " << n << std::endl;
 #endif
-			return p.p.ordered_malloc(n);
-		}
-		static bool is_from(void *const ptr)
-		{
-			pool_type &p = singleton::instance();
-			boost::details::pool::guard<Mutex> g(p);
-			return p.p.is_from(ptr);
-		}
-		static void free(void *const ptr)
-		{
-			pool_type &p = singleton::instance();
-			boost::details::pool::guard<Mutex> g(p);
-			p.p.free(ptr);
-		}
-		static void ordered_free(void *const ptr)
-		{
-			pool_type &p = singleton::instance();
-			boost::details::pool::guard<Mutex> g(p);
-			p.p.ordered_free(ptr);
-		}
-		static void free(void *const ptr, const size_type n)
-		{
-			pool_type &p = singleton::instance();
-			boost::details::pool::guard<Mutex> g(p);
-			p.p.free(ptr, n);
-		}
-		static void ordered_free(void *const ptr, const size_type n)
-		{
-			pool_type &p = singleton::instance();
-			boost::details::pool::guard<Mutex> g(p);
-#ifdef DEBUG
-			std::cout << "fixed_singleton_pool::ordered_free: freeing " << n << std::endl;
-#endif
-			p.p.ordered_free(ptr, n);
-		}
-		static bool release_memory()
-		{
-			pool_type &p = singleton::instance();
-			boost::details::pool::guard<Mutex> g(p);
-			size_type next_size_before_release = p.p.get_next_size();
-			bool has_released = p.p.release_memory();
-			size_type next_size_after_release = p.p.get_next_size();
-#ifdef DEBUG
-			std::cout << "fixed_singleton_pool::release_memory: next size before " << next_size_before_release
-				<< " after " << next_size_after_release << std::endl; 
-#endif
-			p.p.set_next_size(NextSize);
-			return has_released;
-		}
-		static bool purge_memory()
-		{
-			pool_type &p = singleton::instance();
-			boost::details::pool::guard<Mutex> g(p);
-			size_type next_size_before_release = p.p.get_next_size();
-			bool has_purged = p.p.purge_memory();
-			size_type next_size_after_release = p.p.get_next_size();
-#ifdef DEBUG
-			std::cout << "fixed_singleton_pool::purge_memory: next size before " << next_size_before_release
-				<< " after " << next_size_after_release << std::endl; 
-#endif
-			p.p.set_next_size(NextSize);
-			return has_purged;
-		}
 
-};
-
-struct fixed_pool_allocator_tag { };
-
-/// Based on an example gven at http://www.ddj.com/cpp/184403759
-template <typename T,
-	typename UserAllocator,
-	typename Mutex,
-	unsigned NextSize>
-class fixed_pool_allocator
-{
-	public:
-		typedef T                 value_type;
-		typedef UserAllocator     user_allocator;
-		typedef Mutex             mutex;
-		BOOST_STATIC_CONSTANT(unsigned, next_size = NextSize);
-		typedef value_type*       pointer;
-		typedef const value_type* const_pointer;
-		typedef value_type&       reference;
-		typedef const value_type& const_reference;
-		typedef typename boost::pool<UserAllocator>::size_type size_type;
-		typedef typename boost::pool<UserAllocator>::difference_type difference_type;
-
-		template <typename U>
-		struct rebind
-		{
-			typedef fixed_pool_allocator<U, UserAllocator, Mutex, NextSize> other;
-		};
-
-		fixed_pool_allocator()
-		{
-		}
-		template <typename U>
-		fixed_pool_allocator(const fixed_pool_allocator<U, UserAllocator, Mutex, NextSize> &)
-		{
-		}
-		~fixed_pool_allocator()
-		{
-		}
-
-		static pointer address(reference x)
-		{
-			return &x;
-		}
-
-		static const_pointer address(const_reference x)
-		{
-			return x;
-		}
-
-		static size_type max_size()
-		{
-			return (std::numeric_limits<size_type>::max)();
-		}
-
-		static void construct(pointer p, const value_type &t)
-		{
-			new(p) T(t);
-		}
-
-		static void destroy(pointer p)
-		{
-			p->~T();
-			// Avoid unused variable warning
-			(void)p;
-		}
-
-		bool operator==(const fixed_pool_allocator &) const
-		{
-			return true;
-		}
-
-		bool operator!=(const fixed_pool_allocator &) const
-		{
-			return false;
-		}
-
-		static pointer allocate(size_type n)
-		{
-			const pointer ret = static_cast<pointer>(
-					fixed_singleton_pool<fixed_pool_allocator_tag, sizeof(T), UserAllocator, Mutex,
-					NextSize>::ordered_malloc(n) );
-			if (ret == NULL)
-			{
-				throw std::bad_alloc();
-			}
-			return ret;
-		}
-
-		static pointer allocate(const size_type n, const void *const)
-		{
-			return allocate(n);
-		}
-
-		static void deallocate(pointer p, size_type n)
-		{
-			if ((p == NULL) ||
-				(n == 0))
-			{
-				return;
-			}
-
-			fixed_singleton_pool<fixed_pool_allocator_tag, sizeof(T), UserAllocator, Mutex,
-				NextSize>::ordered_free(p, n);
-		}
-
-};
-#endif
-
 #include "Visibility.h"
 
 #ifdef HAVE_BOOST_POOL_POOLFWD_HPP
 #ifdef HAVE_UMEM_H
 // Memory pool with umem
-typedef fixed_pool_allocator<char,
+typedef boost::pool_allocator<char,
 	umem_allocator> filter_allocator;
 #else
 // Memory pool with malloc (glibc's or any other implementation)
-typedef fixed_pool_allocator<char,
+typedef boost::pool_allocator<char,
 	boost::default_user_allocator_malloc_free,
 	boost::details::pool::default_mutex, 131072> filter_allocator;
 #endif



From fabricecolin at mail.berlios.de  Tue Dec 14 14:21:57 2010
From: fabricecolin at mail.berlios.de (fabricecolin at mail.berlios.de)
Date: Tue, 14 Dec 2010 14:21:57 +0100
Subject: [Pinot-svn] r1742 - trunk/Utils
Message-ID: <20101214132157.77B5A480BFC@sheep.berlios.de>

Author: fabricecolin
Date: 2010-12-14 14:21:57 +0100 (Tue, 14 Dec 2010)
New Revision: 1742

Modified:
   trunk/Utils/Document.cpp
Log:
Don't try and map more than 2Gb. Use shared mappings.


Modified: trunk/Utils/Document.cpp
===================================================================
--- trunk/Utils/Document.cpp	2010-12-10 02:15:33 UTC (rev 1741)
+++ trunk/Utils/Document.cpp	2010-12-14 13:21:57 UTC (rev 1742)
@@ -218,8 +218,16 @@
 	resetData();
 
 #ifdef HAVE_MMAP
-	// Request a private mapping of the whole file
-	void *mapSpace = mmap(NULL, (size_t)fileStat.st_size, PROT_READ, MAP_PRIVATE, fd, 0);
+	// Don't try and map more than 2Gb !
+	if (fileStat.st_size > 2147483647)
+	{
+#ifdef DEBUG
+		clog << "Document::setDataFromFile: reached large file cap" << endl;
+#endif
+		fileStat.st_size = 2147483647;
+	}
+	// Request a mapping of the whole file
+	void *mapSpace = mmap(NULL, (size_t)fileStat.st_size, PROT_READ, MAP_SHARED, fd, 0);
 	if (mapSpace != MAP_FAILED)
 	{
 		m_pData = (char*)mapSpace;



From fabricecolin at mail.berlios.de  Tue Dec 14 14:27:33 2010
From: fabricecolin at mail.berlios.de (fabricecolin at mail.berlios.de)
Date: Tue, 14 Dec 2010 14:27:33 +0100
Subject: [Pinot-svn] r1743 - trunk/Core
Message-ID: <20101214132733.80384480BFC@sheep.berlios.de>

Author: fabricecolin
Date: 2010-12-14 14:27:33 +0100 (Tue, 14 Dec 2010)
New Revision: 1743

Modified:
   trunk/Core/WorkerThreads.cpp
   trunk/Core/WorkerThreads.h
Log:
Added ThreadsManager::mustQuit() for applications to signal that quitting is
necessary and try and stop threads.


Modified: trunk/Core/WorkerThreads.cpp
===================================================================
--- trunk/Core/WorkerThreads.cpp	2010-12-14 13:21:57 UTC (rev 1742)
+++ trunk/Core/WorkerThreads.cpp	2010-12-14 13:27:33 UTC (rev 1743)
@@ -275,6 +275,7 @@
 
 ThreadsManager::ThreadsManager(const string &defaultIndexLocation,
 	unsigned int maxThreadsTime, bool scanLocalFiles) :
+	m_mustQuit(false),
 	m_actionQueue(PinotSettings::getInstance().getHistoryDatabaseName(), get_application_name()),
 	m_defaultIndexLocation(defaultIndexLocation),
 	m_maxIndexThreads(1),
@@ -677,6 +678,17 @@
 	m_onThreadEndSignal(pThread);
 }
 
+bool ThreadsManager::mustQuit(bool quit)
+{
+	if (quit == true)
+	{
+		m_mustQuit = true;
+		stop_threads();
+	}
+
+	return m_mustQuit;
+}
+
 ustring ThreadsManager::queue_index(const DocumentInfo &docInfo)
 {
 	bool addToQueue = false;
@@ -1424,7 +1436,7 @@
 
 		if (pFilter != NULL)
 		{
-			// We may able to feed the document directly to the filter
+			// We may be able to feed the document directly to the filter
 			if (((pFilter->is_data_input_ok(Dijon::Filter::DOCUMENT_FILE_NAME) == true) &&
 				(thisUrl.getProtocol() == "file")) ||
 				((pFilter->is_data_input_ok(Dijon::Filter::DOCUMENT_URI) == true) &&

Modified: trunk/Core/WorkerThreads.h
===================================================================
--- trunk/Core/WorkerThreads.h	2010-12-14 13:21:57 UTC (rev 1742)
+++ trunk/Core/WorkerThreads.h	2010-12-14 13:27:33 UTC (rev 1743)
@@ -136,8 +136,10 @@
 
 		void unlock_lists(void);
 
-		Glib::ustring queue_index(const DocumentInfo &docInfo);
+		bool mustQuit(bool quit = false);
 
+		virtual Glib::ustring queue_index(const DocumentInfo &docInfo);
+
 		bool pop_queue(const std::string &urlWasIndexed = "");
 
 	protected:
@@ -146,6 +148,7 @@
 		pthread_rwlock_t m_threadsLock;
 		pthread_rwlock_t m_listsLock;
 		std::map<unsigned int, WorkerThread *> m_threads;
+		bool m_mustQuit;
 		ActionQueue m_actionQueue;
 		std::string m_defaultIndexLocation;
 		unsigned int m_maxIndexThreads;



From fabricecolin at mail.berlios.de  Tue Dec 14 15:00:43 2010
From: fabricecolin at mail.berlios.de (fabricecolin at mail.berlios.de)
Date: Tue, 14 Dec 2010 15:00:43 +0100
Subject: [Pinot-svn] r1744 - trunk/Core
Message-ID: <20101214140044.35477480BFC@sheep.berlios.de>

Author: fabricecolin
Date: 2010-12-14 15:00:43 +0100 (Tue, 14 Dec 2010)
New Revision: 1744

Modified:
   trunk/Core/pinot-dbus-daemon.cpp
   trunk/Core/pinot-index.cpp
Log:
Both call mustQuit() when signaled; simply quitting the main loop isn't enough
when running in single thread mode.
pinot-index's IndexingState provides a simple, queue-less queue_index(),
attempts to reclaim memory when threads end.


Modified: trunk/Core/pinot-dbus-daemon.cpp
===================================================================
--- trunk/Core/pinot-dbus-daemon.cpp	2010-12-14 13:27:33 UTC (rev 1743)
+++ trunk/Core/pinot-dbus-daemon.cpp	2010-12-14 14:00:43 UTC (rev 1744)
@@ -84,6 +84,7 @@
 };
 #endif
 static Glib::RefPtr<Glib::MainLoop> g_refMainLoop;
+static ThreadsManager *g_pState = NULL;
 
 static void closeAll(void)
 {
@@ -121,6 +122,10 @@
 	{
 		cout << "Quitting..." << endl;
 
+		if (g_pState != NULL)
+		{
+			g_pState->mustQuit(true);
+		}
 		g_refMainLoop->quit();
 	}
 }
@@ -692,6 +697,7 @@
 	DaemonState server;
 	IndexInterface *pIndex = NULL;
 
+	g_pState = &server;
 #ifdef HAVE_DBUS
 	DBusError error;
 	dbus_error_init(&error);
@@ -927,7 +933,8 @@
 
 	// Stop everything
 	server.disconnect();
-	server.stop_threads();
+	server.mustQuit(true);
+	g_pState = NULL;
 
 	return EXIT_SUCCESS;
 }

Modified: trunk/Core/pinot-index.cpp
===================================================================
--- trunk/Core/pinot-index.cpp	2010-12-14 13:27:33 UTC (rev 1743)
+++ trunk/Core/pinot-index.cpp	2010-12-14 14:00:43 UTC (rev 1744)
@@ -32,6 +32,7 @@
 #include "config.h"
 #include "NLS.h"
 #include "Languages.h"
+#include "Memory.h"
 #include "MIMEScanner.h"
 #include "Url.h"
 #include "FilterFactory.h"
@@ -73,6 +74,12 @@
 		{
 		}
 
+		virtual Glib::ustring queue_index(const DocumentInfo &docInfo)
+		{
+			// Index directly
+			return index_document(docInfo);
+		}
+
 		void on_thread_end(WorkerThread *pThread)
 		{
 			string indexedUrl;
@@ -115,6 +122,8 @@
 			// Delete the thread
 			delete pThread;
 
+			Memory::reclaim();
+
 			// Stop there
 			g_refMainLoop->quit();
 		}
@@ -178,6 +187,10 @@
 	{
 		cout << "Quitting..." << endl;
 
+		if (g_pState != NULL)
+		{
+			g_pState->mustQuit(true);
+		}
 		g_refMainLoop->quit();
 	}
 }
@@ -454,6 +467,10 @@
 			g_pState->disconnect();
 
 			docId = g_pState->getDocumentID();
+			if (g_pState->mustQuit() == true)
+			{
+				break;
+			}
 		}
 		if ((showInfo == true) &&
 			(docId > 0))
@@ -502,6 +519,7 @@
 	if (g_pState != NULL)
 	{
 		delete g_pState;
+		g_pState = NULL;
 	}
 
 	// Did whatever operation we carried out succeed ?



From fabricecolin at mail.berlios.de  Wed Dec 15 14:19:49 2010
From: fabricecolin at mail.berlios.de (fabricecolin at mail.berlios.de)
Date: Wed, 15 Dec 2010 14:19:49 +0100
Subject: [Pinot-svn] r1745 - trunk/IndexSearch/Xapian
Message-ID: <20101215131949.3DF1B480CA2@sheep.berlios.de>

Author: fabricecolin
Date: 2010-12-15 14:19:48 +0100 (Wed, 15 Dec 2010)
New Revision: 1745

Modified:
   trunk/IndexSearch/Xapian/AbstractGenerator.cpp
   trunk/IndexSearch/Xapian/XapianIndex.cpp
Log:
Index components off terms that include dots separately, in line with how the
QueryParser processes such terms in queries.
When generating abstracts, we may find several terms at the same position, in
which case the shortest is preferred.


Modified: trunk/IndexSearch/Xapian/AbstractGenerator.cpp
===================================================================
--- trunk/IndexSearch/Xapian/AbstractGenerator.cpp	2010-12-14 14:00:43 UTC (rev 1744)
+++ trunk/IndexSearch/Xapian/AbstractGenerator.cpp	2010-12-15 13:19:48 UTC (rev 1745)
@@ -171,7 +171,7 @@
 	{
 #ifdef DEBUG
 		cout << "AbstractGenerator::generateAbstract: position " << winIter->first
-			<< " weights " << winIter->second.m_backWeight 
+			<< " weighs " << winIter->second.m_backWeight 
 			<< "/" << winIter->second.m_forwardWeight << endl;
 #endif
 		if (bestWeight < winIter->second.m_forwardWeight)
@@ -224,7 +224,13 @@
 				if ((startPosition <= termPos + 1) &&
 					(termPos < startPosition + m_wordsCount))
 				{
-					wordsBuffer[termPos] = termName;
+					// If several terms exist at this position, prefer the shortest one
+					map<Xapian::termpos, string>::const_iterator wordIter = wordsBuffer.find(termPos);
+					if ((wordIter == wordsBuffer.end()) ||
+						(wordIter->second.length() > termName.length()))
+					{
+						wordsBuffer[termPos] = termName;
+					}
 				}
 			}
 		}

Modified: trunk/IndexSearch/Xapian/XapianIndex.cpp
===================================================================
--- trunk/IndexSearch/Xapian/XapianIndex.cpp	2010-12-14 14:00:43 UTC (rev 1744)
+++ trunk/IndexSearch/Xapian/XapianIndex.cpp	2010-12-15 13:19:48 UTC (rev 1745)
@@ -140,9 +140,7 @@
 							cout << "TokensIndexer::handle_token: trimmed to " << term << " " << pos + 1 << endl;
 #endif
 						}
-#ifdef DEBUG
-						else cout << "TokensIndexer::handle_token: keeping potential acronym " << term << endl;
-#endif
+						// Else, it's probably an acronym
 						break;
 					}
 
@@ -193,6 +191,50 @@
 #endif
 				}
 
+				// Does it include dots ?
+				string::size_type dotPos = term.find('.');
+				if (dotPos != string::npos)
+				{
+					string::size_type startPos = 0;
+					bool addRemainder = true;
+
+#ifdef DEBUG
+					cout << "TokensIndexer::handle_token: found dots in " << term << endl;
+#endif
+					while (dotPos != string::npos)
+					{
+						string component(term.substr(startPos, dotPos - startPos));
+
+						if (component.empty() == false)
+						{
+#ifdef DEBUG
+							cout << "TokensIndexer::handle_token: adding posting for " << component << endl;
+#endif
+							m_doc.add_posting(m_prefix + XapianDatabase::limitTermLength(component), m_termPos);
+							++m_termPos;
+						}
+
+						// Next
+						if (dotPos == term.length() - 1)
+						{
+							addRemainder = false;
+							break;
+						}
+						startPos = dotPos + 1;
+						dotPos = term.find('.', startPos);
+					}
+
+					if (addRemainder == true)
+					{
+						string lastComponent(term.substr(startPos));
+
+#ifdef DEBUG
+						cout << "TokensIndexer::handle_token: adding last posting for " << lastComponent << endl;
+#endif
+						m_doc.add_posting(m_prefix + XapianDatabase::limitTermLength(lastComponent), m_termPos);
+					}
+				}
+
 				addSpelling = m_doSpelling;
 				++m_termPos;
 				m_nGramCount = 0;



From fabricecolin at mail.berlios.de  Wed Dec 15 14:24:41 2010
From: fabricecolin at mail.berlios.de (fabricecolin at mail.berlios.de)
Date: Wed, 15 Dec 2010 14:24:41 +0100
Subject: [Pinot-svn] r1746 - trunk/Tokenize
Message-ID: <20101215132441.E76DB480CA2@sheep.berlios.de>

Author: fabricecolin
Date: 2010-12-15 14:24:41 +0100 (Wed, 15 Dec 2010)
New Revision: 1746

Modified:
   trunk/Tokenize/FilterUtils.cpp
   trunk/Tokenize/FilterUtils.h
Log:
If the environment variable PINOT_MAXIMUM_NESTED_SIZE is set, feed its value to
filters, as property MAXIMUM_NESTED_SIZE.


Modified: trunk/Tokenize/FilterUtils.cpp
===================================================================
--- trunk/Tokenize/FilterUtils.cpp	2010-12-15 13:19:48 UTC (rev 1745)
+++ trunk/Tokenize/FilterUtils.cpp	2010-12-15 13:24:41 UTC (rev 1746)
@@ -19,6 +19,7 @@
 #include <sys/types.h>
 #include <sys/stat.h>
 #include <fcntl.h>
+#include <string.h>
 #include <stdlib.h>
 #include <unistd.h>
 #include <iostream>
@@ -46,6 +47,7 @@
 
 set<string> FilterUtils::m_types;
 map<string, string> FilterUtils::m_typeAliases;
+string FilterUtils::m_maxNestedSize;
 
 ReducedAction::ReducedAction()
 {
@@ -74,6 +76,16 @@
 
 FilterUtils::FilterUtils()
 {
+	char *pEnvVar = getenv("PINOT_MAXIMUM_NESTED_SIZE");
+	if ((pEnvVar != NULL) &&
+		(strlen(pEnvVar) > 0))
+	{
+		off_t maxSize = (off_t)atoll(pEnvVar);
+		if (maxSize > 0)
+		{
+			m_maxNestedSize = pEnvVar;
+		}
+	}
 }
 
 FilterUtils::~FilterUtils()
@@ -467,6 +479,11 @@
 
 	if (pFilter != NULL)
 	{
+		// Limit the size of nested documents ?
+		if (m_maxNestedSize.empty() == false)
+		{
+			pFilter->set_property(Dijon::Filter::MAXIMUM_NESTED_SIZE, m_maxNestedSize);
+		}
 		fedFilter = FilterUtils::feedFilter(doc, pFilter);
 	}
 	positionedFilter = action.positionFilter(doc, pFilter);

Modified: trunk/Tokenize/FilterUtils.h
===================================================================
--- trunk/Tokenize/FilterUtils.h	2010-12-15 13:19:48 UTC (rev 1745)
+++ trunk/Tokenize/FilterUtils.h	2010-12-15 13:24:41 UTC (rev 1746)
@@ -76,6 +76,7 @@
 	protected:
 		static std::set<std::string> m_types;
 		static std::map<std::string, std::string> m_typeAliases;
+		static std::string m_maxNestedSize;
 
 		FilterUtils();
 



From fabricecolin at mail.berlios.de  Wed Dec 15 14:26:46 2010
From: fabricecolin at mail.berlios.de (fabricecolin at mail.berlios.de)
Date: Wed, 15 Dec 2010 14:26:46 +0100
Subject: [Pinot-svn] r1747 - in trunk: . po
Message-ID: <20101215132646.E0C9B480CA2@sheep.berlios.de>

Author: fabricecolin
Date: 2010-12-15 14:26:46 +0100 (Wed, 15 Dec 2010)
New Revision: 1747

Modified:
   trunk/AUTHORS
   trunk/po/zh_CN.po
Log:
Simplified Chinese translation update by mike2718.


Modified: trunk/AUTHORS
===================================================================
--- trunk/AUTHORS	2010-12-15 13:24:41 UTC (rev 1746)
+++ trunk/AUTHORS	2010-12-15 13:26:46 UTC (rev 1747)
@@ -55,6 +55,7 @@
 		& rainofchaos <rainofchaos at gmail dot com>
 		& Aron Xu <???>
 		& Eleanor Chen <chenyueg at gmail dot com>
+		& mike2718 <mike2718 at gmail dot com>
 	Chinese (Traditional) - ??? Yung-Chung Lin <henearkrxern at gmail dot com>
 	Dutch - Tikkel <???>
 		& JW <jw00000 at gmail dot com>

Modified: trunk/po/zh_CN.po
===================================================================
--- trunk/po/zh_CN.po	2010-12-15 13:24:41 UTC (rev 1746)
+++ trunk/po/zh_CN.po	2010-12-15 13:26:46 UTC (rev 1747)
@@ -6,14 +6,16 @@
 msgstr ""
 "Project-Id-Version: pinot 0.96\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2010-07-12 22:14+0800\n"
-"PO-Revision-Date: 2010-06-20 08:47+0000\n"
-"Last-Translator: Eleanor Chen <chenyueg at gmail.com>\n"
+"POT-Creation-Date: 2010-12-14 21:24+0800\n"
+"PO-Revision-Date: 2010-12-15 03:59+0000\n"
+"Last-Translator: mike2718 <mike2718 at gmail.com>\n"
 "Language-Team: \n"
 "Language: \n"
 "MIME-Version: 1.0\n"
 "Content-Type: text/plain; charset=UTF-8\n"
 "Content-Transfer-Encoding: 8bit\n"
+"X-Launchpad-Export-Date: 2010-12-15 08:44+0000\n"
+"X-Generator: Launchpad (build Unknown)\n"
 
 #: SQL/SQLiteBase.cpp:419
 msgid "failed to begin transaction"
@@ -29,70 +31,70 @@
 
 #: SQL/SQLiteBase.cpp:553
 msgid "couldn't format SQL statement"
-msgstr ""
+msgstr "?????SQL??"
 
 #. Localize language names
-#: Core/pinot-dbus-daemon.cpp:543 UI/GTK2/src/pinot.cc:308
+#: Core/pinot-dbus-daemon.cpp:548 UI/GTK2/src/pinot.cc:308
 msgid "Unknown"
-msgstr ""
+msgstr "??"
 
-#: Core/pinot-dbus-daemon.cpp:544 UI/GTK2/src/pinot.cc:309
+#: Core/pinot-dbus-daemon.cpp:549 UI/GTK2/src/pinot.cc:309
 msgid "Danish"
 msgstr "???"
 
-#: Core/pinot-dbus-daemon.cpp:545 UI/GTK2/src/pinot.cc:310
+#: Core/pinot-dbus-daemon.cpp:550 UI/GTK2/src/pinot.cc:310
 msgid "Dutch"
 msgstr "???"
 
-#: Core/pinot-dbus-daemon.cpp:546 UI/GTK2/src/pinot.cc:311
+#: Core/pinot-dbus-daemon.cpp:551 UI/GTK2/src/pinot.cc:311
 msgid "English"
 msgstr "??"
 
-#: Core/pinot-dbus-daemon.cpp:547 UI/GTK2/src/pinot.cc:312
+#: Core/pinot-dbus-daemon.cpp:552 UI/GTK2/src/pinot.cc:312
 msgid "Finnish"
 msgstr "???"
 
-#: Core/pinot-dbus-daemon.cpp:548 UI/GTK2/src/pinot.cc:313
+#: Core/pinot-dbus-daemon.cpp:553 UI/GTK2/src/pinot.cc:313
 msgid "French"
 msgstr "??"
 
-#: Core/pinot-dbus-daemon.cpp:549 UI/GTK2/src/pinot.cc:314
+#: Core/pinot-dbus-daemon.cpp:554 UI/GTK2/src/pinot.cc:314
 msgid "German"
 msgstr "??"
 
-#: Core/pinot-dbus-daemon.cpp:550 UI/GTK2/src/pinot.cc:315
+#: Core/pinot-dbus-daemon.cpp:555 UI/GTK2/src/pinot.cc:315
 msgid "Hungarian"
 msgstr "????"
 
-#: Core/pinot-dbus-daemon.cpp:551 UI/GTK2/src/pinot.cc:316
+#: Core/pinot-dbus-daemon.cpp:556 UI/GTK2/src/pinot.cc:316
 msgid "Italian"
 msgstr "????"
 
-#: Core/pinot-dbus-daemon.cpp:552 UI/GTK2/src/pinot.cc:317
+#: Core/pinot-dbus-daemon.cpp:557 UI/GTK2/src/pinot.cc:317
 msgid "Norwegian"
 msgstr "???"
 
-#: Core/pinot-dbus-daemon.cpp:553 UI/GTK2/src/pinot.cc:318
+#: Core/pinot-dbus-daemon.cpp:558 UI/GTK2/src/pinot.cc:318
 msgid "Portuguese"
 msgstr "????"
 
-#: Core/pinot-dbus-daemon.cpp:554 UI/GTK2/src/pinot.cc:319
+#: Core/pinot-dbus-daemon.cpp:559 UI/GTK2/src/pinot.cc:319
 msgid "Romanian"
 msgstr "?????"
 
-#: Core/pinot-dbus-daemon.cpp:555 UI/GTK2/src/pinot.cc:320
+#: Core/pinot-dbus-daemon.cpp:560 UI/GTK2/src/pinot.cc:320
 msgid "Russian"
 msgstr "??"
 
-#: Core/pinot-dbus-daemon.cpp:556 UI/GTK2/src/pinot.cc:321
+#: Core/pinot-dbus-daemon.cpp:561 UI/GTK2/src/pinot.cc:321
 msgid "Spanish"
 msgstr "????"
 
-#: Core/pinot-dbus-daemon.cpp:557 UI/GTK2/src/pinot.cc:322
+#: Core/pinot-dbus-daemon.cpp:562 UI/GTK2/src/pinot.cc:322
 msgid "Swedish"
 msgstr "???"
 
-#: Core/pinot-dbus-daemon.cpp:558 UI/GTK2/src/pinot.cc:323
+#: Core/pinot-dbus-daemon.cpp:563 UI/GTK2/src/pinot.cc:323
 msgid "Turkish"
 msgstr "????"
 
@@ -100,7 +102,7 @@
 #. Apply this label
 #. Is this an internal index ?
 #: Core/PinotSettings.cpp:436 Core/PinotSettings.cpp:1712
-#: Core/WorkerThreads.cpp:1036 UI/GTK2/src/mainWindow.cc:873
+#: Core/WorkerThreads.cpp:1060 UI/GTK2/src/mainWindow.cc:873
 #: UI/GTK2/src/mainWindow.cc:1139 UI/GTK2/src/mainWindow.cc:1402
 #: UI/GTK2/src/mainWindow.cc:1562 UI/GTK2/src/mainWindow.cc:1565
 #: UI/GTK2/src/mainWindow.cc:1669 UI/GTK2/src/mainWindow.cc:1703
@@ -111,7 +113,7 @@
 
 #. Spawn new threads
 #: Core/PinotSettings.cpp:437 Core/PinotSettings.cpp:1713
-#: Core/WorkerThreads.cpp:1046 UI/GTK2/src/mainWindow.cc:1134
+#: Core/WorkerThreads.cpp:1070 UI/GTK2/src/mainWindow.cc:1134
 #: UI/GTK2/src/mainWindow.cc:1392 UI/GTK2/src/mainWindow.cc:1406
 #: UI/GTK2/src/mainWindow.cc:1573 UI/GTK2/src/mainWindow.cc:1576
 #: UI/GTK2/src/mainWindow.cc:2441 UI/GTK2/src/statisticsDialog.cc:163
@@ -228,23 +230,23 @@
 msgid "Unknown error"
 msgstr "????"
 
-#: Core/WorkerThreads.cpp:439
+#: Core/WorkerThreads.cpp:452
 msgid "Indexing was stopped"
 msgstr ""
 
-#: Core/WorkerThreads.cpp:452
+#: Core/WorkerThreads.cpp:465
 msgid "Can't index mail here"
 msgstr "??????"
 
-#: Core/WorkerThreads.cpp:473 Core/WorkerThreads.cpp:764
+#: Core/WorkerThreads.cpp:486 Core/WorkerThreads.cpp:788
 msgid "is already being indexed"
 msgstr "??????"
 
-#: Core/WorkerThreads.cpp:483
+#: Core/WorkerThreads.cpp:496
 msgid "is blacklisted"
 msgstr "?????"
 
-#: Core/WorkerThreads.cpp:999
+#: Core/WorkerThreads.cpp:1023
 msgid "No title"
 msgstr "???"
 
@@ -677,7 +679,7 @@
 msgid "Did you mean ?"
 msgstr ""
 
-#: UI/GTK2/src/Notebook.cc:95 UI/GTK2/src/Notebook.cc:236
+#: UI/GTK2/src/Notebook.cc:95 UI/GTK2/src/Notebook.cc:242
 msgid "Close"
 msgstr ""
 



From fabricecolin at mail.berlios.de  Wed Dec 15 14:29:36 2010
From: fabricecolin at mail.berlios.de (fabricecolin at mail.berlios.de)
Date: Wed, 15 Dec 2010 14:29:36 +0100
Subject: [Pinot-svn] r1748 - trunk
Message-ID: <20101215132936.76680480CA2@sheep.berlios.de>

Author: fabricecolin
Date: 2010-12-15 14:29:36 +0100 (Wed, 15 Dec 2010)
New Revision: 1748

Modified:
   trunk/FAQ
   trunk/README
Log:
Updates about env vars, DeskbarApplet, libtextcat.


Modified: trunk/FAQ
===================================================================
--- trunk/FAQ	2010-12-15 13:26:46 UTC (rev 1747)
+++ trunk/FAQ	2010-12-15 13:29:36 UTC (rev 1748)
@@ -20,8 +20,6 @@
     - increase the frequency at which memory is returned to the OS by setting
       MALLOC_TRIM_THRESHOLD_ to a value lower than 128kb (the default) :
       $ export MALLOC_TRIM_THRESHOLD_=65536
-    - reduce the number of indexing threads (defaults to 4) :
-      $ export PINOT_MAXIMUM_INDEX_THREADS=1
     - reduce the number of documents Xapian buffers in memory before changes
       are flushed to the disk (default is 10000) :
       $ export XAPIAN_FLUSH_THRESHOLD=1000

Modified: trunk/README
===================================================================
--- trunk/README	2010-12-15 13:26:46 UTC (rev 1747)
+++ trunk/README	2010-12-15 13:29:36 UTC (rev 1748)
@@ -15,7 +15,7 @@
 10. Digging deeper
 11. Saving results
 12. D-Bus service
-13. Deskbar Applet plugins
+13. DeskbarApplet plugins
 14. CJKV support
 15. Environment variables and aliases
 16. How to reset indexes
@@ -174,6 +174,9 @@
   own stopword list, for instance a stopwords list for English should be
   copied to $PREFIX/share/pinot/stopwords/stopwords.en
 
+  Language detection is done with libtextcat. Ensure that the paths listed in
+  /etc/pinot/textcat_conf.txt are correct.
+
   The pinot-index program allows indexing and peeking at documents' properties
   from the command-line. Using the -i/--index option with the My Documents or
   My Web Pages index is not recommended. For more details, see the manual page
@@ -383,10 +386,10 @@
   in the file pinot-dbus-daemon.xml.
 
 
-13. Deskbar Applet plugins
+13. DeskbarApplet plugins
 
 
-  Deskbar Applet provides an omnipresent versatile search interface for Gnome.
+  DeskbarApplet provides an omnipresent versatile search interface for Gnome.
   Searching documents indexed by Pinot with the applet is possible.
 
   Starting with Pinot 0.81, two plugins are available : a "module" for Deskbar
@@ -395,13 +398,13 @@
 
   The module is at scripts/python/pinot-module.py, while the handler is at
   scripts/python/pinot-live.py. The module should be copied into
-  $LIBS/deskbar-applet/modules-2.20-compatible and the handler in
-  $LIBS/deskbar-applet/handlers for use by all users.
+  /usr/libexec/deskbar-applet/modules-2.20-compatible and the handler in
+  /usr/libexec/deskbar-applet/handlers for use by all users.
   For use only by the current user, the directories to copy to are
   ~/.gnome2/deskbar-applet/modules-2.20-compatible and
   ~/.gnome2/deskbar-applet/handlers respectively.
 
-  Deskbar Applet appears to sort results by names, so it may not present
+  DeskbarApplet appears to sort results by names, so it may not present
   results in the same order as the Pinot UI. Additionally, searches run through
   the D-Bus interface are treated a bit differently, as terms are OR'ed
   together if no exact match is found.
@@ -451,7 +454,11 @@
       $ export PINOT_MINIMUM_DISK_SPACE=100
     * PINOT_MAXIMUM_INDEX_THREADS
       This sets the maximum number of concurrent indexing threads used by the
-      daemon. The default value is 4.
+      daemon. The default value is 1.
+    * PINOT_MAXIMUM_NESTED_SIZE
+      This limits the extraction of documents nested inside others, such as
+      archives or mail messages, based on their size. By default, this is
+      deactivated and set to 0.
 
   Another environment variable that you may want to tweak comes from Xapian.
   XAPIAN_FLUSH_THRESHOLD can be set to the number of documents after which
@@ -568,12 +575,12 @@
 libexif							0.6
 http://libexif.sourceforge.net/
 
-xesam-glib (6)						0.4.0
-http://xesam.org/people/kamstrup/xesam-glib/
-
-openssh-askpass (7)					4.3
+openssh-askpass (6)					4.3
 http://www.openssh.com/portable.html
 
+DeskbarApplet (7)					2.30
+http://live.gnome.org/DeskbarApplet
+
 ---------------------------------------------------------------
 External filter programs
 ---------------------------------------------------------------
@@ -607,7 +614,7 @@
 (3) for gmime 2.0 support, edit configure.in
 (4) for building only
 (5) experimental - enabled with "./configure --enable-libarchive=yes"
-(6) enabled with "./configure --enable-xesam-glib=yes
-(7) experimental - required only if _SSH_TUNNEL is set
+(6) experimental - required only if _SSH_TUNNEL is set
+(7) optional DeskbarApplet plugins 
 ---------------------------------------------------------------------
 



From fabricecolin at mail.berlios.de  Mon Dec 20 09:42:38 2010
From: fabricecolin at mail.berlios.de (fabricecolin at mail.berlios.de)
Date: Mon, 20 Dec 2010 09:42:38 +0100
Subject: [Pinot-svn] r1749 - in trunk: . UI/GTK2 UI/GTK2/src
Message-ID: <20101220084238.8FB1848146A@sheep.berlios.de>

Author: fabricecolin
Date: 2010-12-20 09:42:38 +0100 (Mon, 20 Dec 2010)
New Revision: 1749

Modified:
   trunk/README
   trunk/UI/GTK2/metase-gtk2.glade
   trunk/UI/GTK2/src/mainWindow.cc
   trunk/UI/GTK2/src/mainWindow.hh
   trunk/UI/GTK2/src/prefsWindow.cc
   trunk/UI/GTK2/src/queryDialog_glade.cc
Log:
The UI checks for the environment variable PINOT_MAXIMUM_QUERY_RESULTS. This
overrides the number of results returned by queries run through the UI's Query
field as well as the number of results initially set for new stored queries,
which is now capped to 1000.
The UI calls mustQuit() on exit.


Modified: trunk/README
===================================================================
--- trunk/README	2010-12-15 13:29:36 UTC (rev 1748)
+++ trunk/README	2010-12-20 08:42:38 UTC (rev 1749)
@@ -1,5 +1,5 @@
 Pinot
-Copyright 2005-2009 Fabrice Colin <fabricecolin at users dot berlios dot de>
+Copyright 2005-2010 Fabrice Colin <fabricecolin at users dot berlios dot de>
 http://pinot.berlios.de/
 
 
@@ -459,6 +459,10 @@
       This limits the extraction of documents nested inside others, such as
       archives or mail messages, based on their size. By default, this is
       deactivated and set to 0.
+    * PINOT_MAXIMUM_QUERY_RESULTS
+      This overrides the number of results returned by queries run through
+      the UI's Query field as well as the number of results initially set
+      for new stored queries.
 
   Another environment variable that you may want to tweak comes from Xapian.
   XAPIAN_FLUSH_THRESHOLD can be set to the number of documents after which

Modified: trunk/UI/GTK2/metase-gtk2.glade
===================================================================
--- trunk/UI/GTK2/metase-gtk2.glade	2010-12-15 13:29:36 UTC (rev 1748)
+++ trunk/UI/GTK2/metase-gtk2.glade	2010-12-20 08:42:38 UTC (rev 1749)
@@ -1307,7 +1307,7 @@
 		  <property name="update_policy">GTK_UPDATE_ALWAYS</property>
 		  <property name="snap_to_ticks">False</property>
 		  <property name="wrap">False</property>
-		  <property name="adjustment">10 10 100 10 20 0</property>
+		  <property name="adjustment">10 10 1000 10 20 0</property>
 		</widget>
 		<packing>
 		  <property name="left_attach">1</property>

Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2010-12-15 13:29:36 UTC (rev 1748)
+++ trunk/UI/GTK2/src/mainWindow.cc	2010-12-20 08:42:38 UTC (rev 1749)
@@ -141,8 +141,22 @@
 	m_pFindMenu(NULL),
 	m_pSettingsMonitor(MonitorFactory::getMonitor()),
 	m_pSettingsHandler(NULL),
-	m_state(this)
+	m_state(this),
+	m_maxResultsCount(10)
 {
+	// Override the number of query results ?
+	char *pEnvVar = getenv("PINOT_MAXIMUM_QUERY_RESULTS");
+	if ((pEnvVar != NULL) &&
+		(strlen(pEnvVar) > 0))
+	{
+		int threadsNum = atoi(pEnvVar);
+
+		if (threadsNum > 0)
+		{
+			m_maxResultsCount = (unsigned int)threadsNum;
+		}
+	}
+
 	// Reposition and resize the window
 	// Make sure the coordinates and sizes make sense
 	if ((m_settings.m_xPos >= 0) &&
@@ -2832,6 +2846,8 @@
 {
 	QueryProperties queryProps(_("Live query"), liveQueryEntry->get_text());
 
+	queryProps.setMaximumResultsCount(m_maxResultsCount);
+
 	run_search(queryProps);
 }
 
@@ -3001,15 +3017,11 @@
 		{
 			return true;
 		}
-
-		m_state.disconnect();
-		m_state.stop_threads();
 	}
-	else
-	{
-		m_state.disconnect();
-	}
 
+	m_state.disconnect();
+	m_state.mustQuit(true);
+
 	// Disconnect UI signals
 	m_pageSwitchConnection.disconnect();
 
@@ -3164,6 +3176,11 @@
 		// Backup the current name
 		queryName = queryProps.getName();
 	}
+	else
+	{
+		// Initialize the number of results
+		queryProps.setMaximumResultsCount(m_maxResultsCount);
+	}
 
 	// Edit the query's properties
 	queryDialog queryBox(queryProps);

Modified: trunk/UI/GTK2/src/mainWindow.hh
===================================================================
--- trunk/UI/GTK2/src/mainWindow.hh	2010-12-15 13:29:36 UTC (rev 1748)
+++ trunk/UI/GTK2/src/mainWindow.hh	2010-12-20 08:42:38 UTC (rev 1749)
@@ -200,6 +200,7 @@
 
 	} m_state;
 	static unsigned int m_maxDocsCount;
+	unsigned int m_maxResultsCount;
 
 };
 

Modified: trunk/UI/GTK2/src/prefsWindow.cc
===================================================================
--- trunk/UI/GTK2/src/prefsWindow.cc	2010-12-15 13:29:36 UTC (rev 1748)
+++ trunk/UI/GTK2/src/prefsWindow.cc	2010-12-20 08:42:38 UTC (rev 1749)
@@ -969,7 +969,7 @@
 		}
 
 		m_state.disconnect();
-		m_state.stop_threads();
+		m_state.mustQuit(true);
 	}
 	else
 	{

Modified: trunk/UI/GTK2/src/queryDialog_glade.cc
===================================================================
--- trunk/UI/GTK2/src/queryDialog_glade.cc	2010-12-15 13:29:36 UTC (rev 1748)
+++ trunk/UI/GTK2/src/queryDialog_glade.cc	2010-12-20 08:42:38 UTC (rev 1749)
@@ -83,7 +83,7 @@
    labelNameCombobox = Gtk::manage(new class Gtk::ComboBoxText());
    
    Gtk::Label *resultsCountLabel = Gtk::manage(new class Gtk::Label(_("Number of results:")));
-   Gtk::Adjustment *resultsCountSpinbutton_adj = Gtk::manage(new class Gtk::Adjustment(10, 10, 100, 10, 20, 0));
+   Gtk::Adjustment *resultsCountSpinbutton_adj = Gtk::manage(new class Gtk::Adjustment(10, 10, 1000, 10, 20, 0));
    resultsCountSpinbutton = Gtk::manage(new class Gtk::SpinButton(*resultsCountSpinbutton_adj, 1, 0));
    
    Gtk::Label *sortOrderLabel = Gtk::manage(new class Gtk::Label(_("Sort order:")));



From fabricecolin at mail.berlios.de  Mon Dec 20 09:42:55 2010
From: fabricecolin at mail.berlios.de (fabricecolin at mail.berlios.de)
Date: Mon, 20 Dec 2010 09:42:55 +0100
Subject: [Pinot-svn] r1750 - trunk/IndexSearch/Xapian
Message-ID: <20101220084255.B7AC348146A@sheep.berlios.de>

Author: fabricecolin
Date: 2010-12-20 09:42:55 +0100 (Mon, 20 Dec 2010)
New Revision: 1750

Modified:
   trunk/IndexSearch/Xapian/XapianIndex.cpp
Log:
Less DEBUG.


Modified: trunk/IndexSearch/Xapian/XapianIndex.cpp
===================================================================
--- trunk/IndexSearch/Xapian/XapianIndex.cpp	2010-12-20 08:42:38 UTC (rev 1749)
+++ trunk/IndexSearch/Xapian/XapianIndex.cpp	2010-12-20 08:42:55 UTC (rev 1750)
@@ -120,9 +120,6 @@
 			{
 				bool foundNonDot = false;
 
-#ifdef DEBUG
-				cout << "TokensIndexer::handle_token: dot at end of " << term << endl;
-#endif
 				string::size_type pos = term.length() - 1;
 				while (pos >= 0)
 				{
@@ -136,9 +133,6 @@
 						{
 							// No, all dots are at the end, trim them
 							term.erase(pos + 1);
-#ifdef DEBUG
-							cout << "TokensIndexer::handle_token: trimmed to " << term << " " << pos + 1 << endl;
-#endif
 						}
 						// Else, it's probably an acronym
 						break;
@@ -207,9 +201,6 @@
 
 						if (component.empty() == false)
 						{
-#ifdef DEBUG
-							cout << "TokensIndexer::handle_token: adding posting for " << component << endl;
-#endif
 							m_doc.add_posting(m_prefix + XapianDatabase::limitTermLength(component), m_termPos);
 							++m_termPos;
 						}
@@ -228,9 +219,6 @@
 					{
 						string lastComponent(term.substr(startPos));
 
-#ifdef DEBUG
-						cout << "TokensIndexer::handle_token: adding last posting for " << lastComponent << endl;
-#endif
 						m_doc.add_posting(m_prefix + XapianDatabase::limitTermLength(lastComponent), m_termPos);
 					}
 				}



From fabricecolin at mail.berlios.de  Mon Dec 20 09:53:13 2010
From: fabricecolin at mail.berlios.de (fabricecolin at mail.berlios.de)
Date: Mon, 20 Dec 2010 09:53:13 +0100
Subject: [Pinot-svn] r1751 - in trunk: . po
Message-ID: <20101220085313.8242A48146A@sheep.berlios.de>

Author: fabricecolin
Date: 2010-12-20 09:53:13 +0100 (Mon, 20 Dec 2010)
New Revision: 1751

Modified:
   trunk/AUTHORS
   trunk/po/ru.po
Log:
Russian translation update and valuable feedback from Nikolay Kachanov.


Modified: trunk/AUTHORS
===================================================================
--- trunk/AUTHORS	2010-12-20 08:42:55 UTC (rev 1750)
+++ trunk/AUTHORS	2010-12-20 08:53:13 UTC (rev 1751)
@@ -32,6 +32,7 @@
 	Antoine Jacoutot <ajacoutot at bsdfrog dot org>
 	Jonas Smedegaard <dr at jones dot dk>
 	Jens Wilhelm Wulf <jens_w2 at gmx dot net>
+	Nikolay Kachanov <nikolay dot kachanov at gmail dot com>
 
 The source in Utils/unac is from unac 1.7.0 (Copyright Loic Dachary
 <loic at senga dot org>).
@@ -90,6 +91,7 @@
 		& feen <???>
 	Russian - Sergey Vostrikov <memphis at jabber dot snc dot ru>
 		& Alexander 'FONTER' Zinin <spore_09 at mail dot ru>
+		& Nikolay Kachanov <nikolay dot kachanov at gmail dot com>
 	Spanish - Jes?s Tramullas <jesus at tramullas dot com>
 		& Garbage <garbage at openfutura dot com>
 		& DiegoJ <diegojromerolopez at gmail dot com>

Modified: trunk/po/ru.po
===================================================================
--- trunk/po/ru.po	2010-12-20 08:42:55 UTC (rev 1750)
+++ trunk/po/ru.po	2010-12-20 08:53:13 UTC (rev 1751)
@@ -6,10 +6,11 @@
 msgstr ""
 "Project-Id-Version: pinot 0.96\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2010-06-20 16:10+0800\n"
-"PO-Revision-Date: 2010-10-04 06:20+0000\n"
-"Last-Translator: Alexander 'FONTER' Zinin <spore_09 at mail.ru>\n"
+"POT-Creation-Date: 2010-12-20 09:51+0100\n"
+"PO-Revision-Date: 2010-12-18 22:47+0000\n"
+"Last-Translator: Nikolay Kachanov <Nikolay.Kachanov at gmail.Com>\n"
 "Language-Team: Russian <ru at li.org>\n"
+"Language: ru\n"
 "MIME-Version: 1.0\n"
 "Content-Type: text/plain; charset=UTF-8\n"
 "Content-Transfer-Encoding: 8bit\n"
@@ -24,74 +25,74 @@
 
 #: SQL/SQLiteBase.cpp:491
 msgid "failed to end transaction"
-msgstr ""
+msgstr "?? ??????? ????????? ??????????"
 
 #: SQL/SQLiteBase.cpp:553
 msgid "couldn't format SQL statement"
-msgstr ""
+msgstr "?????????? ????????? ?????????????? ????????? SQL"
 
 #. Localize language names
-#: Core/pinot-dbus-daemon.cpp:543 UI/GTK2/src/pinot.cc:309
+#: Core/pinot-dbus-daemon.cpp:548 UI/GTK2/src/pinot.cc:308
 msgid "Unknown"
 msgstr "???????????"
 
-#: Core/pinot-dbus-daemon.cpp:544 UI/GTK2/src/pinot.cc:310
+#: Core/pinot-dbus-daemon.cpp:549 UI/GTK2/src/pinot.cc:309
 msgid "Danish"
 msgstr "???????"
 
-#: Core/pinot-dbus-daemon.cpp:545 UI/GTK2/src/pinot.cc:311
+#: Core/pinot-dbus-daemon.cpp:550 UI/GTK2/src/pinot.cc:310
 msgid "Dutch"
 msgstr "???????????"
 
-#: Core/pinot-dbus-daemon.cpp:546 UI/GTK2/src/pinot.cc:312
+#: Core/pinot-dbus-daemon.cpp:551 UI/GTK2/src/pinot.cc:311
 msgid "English"
 msgstr "??????????"
 
-#: Core/pinot-dbus-daemon.cpp:547 UI/GTK2/src/pinot.cc:313
+#: Core/pinot-dbus-daemon.cpp:552 UI/GTK2/src/pinot.cc:312
 msgid "Finnish"
 msgstr "???????"
 
-#: Core/pinot-dbus-daemon.cpp:548 UI/GTK2/src/pinot.cc:314
+#: Core/pinot-dbus-daemon.cpp:553 UI/GTK2/src/pinot.cc:313
 msgid "French"
 msgstr "???????????"
 
-#: Core/pinot-dbus-daemon.cpp:549 UI/GTK2/src/pinot.cc:315
+#: Core/pinot-dbus-daemon.cpp:554 UI/GTK2/src/pinot.cc:314
 msgid "German"
 msgstr "????????"
 
-#: Core/pinot-dbus-daemon.cpp:550 UI/GTK2/src/pinot.cc:316
+#: Core/pinot-dbus-daemon.cpp:555 UI/GTK2/src/pinot.cc:315
 msgid "Hungarian"
 msgstr "??????????"
 
-#: Core/pinot-dbus-daemon.cpp:551 UI/GTK2/src/pinot.cc:317
+#: Core/pinot-dbus-daemon.cpp:556 UI/GTK2/src/pinot.cc:316
 msgid "Italian"
 msgstr "???????????"
 
-#: Core/pinot-dbus-daemon.cpp:552 UI/GTK2/src/pinot.cc:318
+#: Core/pinot-dbus-daemon.cpp:557 UI/GTK2/src/pinot.cc:317
 msgid "Norwegian"
 msgstr "??????????"
 
-#: Core/pinot-dbus-daemon.cpp:553 UI/GTK2/src/pinot.cc:319
+#: Core/pinot-dbus-daemon.cpp:558 UI/GTK2/src/pinot.cc:318
 msgid "Portuguese"
 msgstr "?????????????"
 
-#: Core/pinot-dbus-daemon.cpp:554 UI/GTK2/src/pinot.cc:320
+#: Core/pinot-dbus-daemon.cpp:559 UI/GTK2/src/pinot.cc:319
 msgid "Romanian"
 msgstr "?????????"
 
-#: Core/pinot-dbus-daemon.cpp:555 UI/GTK2/src/pinot.cc:321
+#: Core/pinot-dbus-daemon.cpp:560 UI/GTK2/src/pinot.cc:320
 msgid "Russian"
 msgstr "???????"
 
-#: Core/pinot-dbus-daemon.cpp:556 UI/GTK2/src/pinot.cc:322
+#: Core/pinot-dbus-daemon.cpp:561 UI/GTK2/src/pinot.cc:321
 msgid "Spanish"
 msgstr "?????????"
 
-#: Core/pinot-dbus-daemon.cpp:557 UI/GTK2/src/pinot.cc:323
+#: Core/pinot-dbus-daemon.cpp:562 UI/GTK2/src/pinot.cc:322
 msgid "Swedish"
 msgstr "????????"
 
-#: Core/pinot-dbus-daemon.cpp:558 UI/GTK2/src/pinot.cc:324
+#: Core/pinot-dbus-daemon.cpp:563 UI/GTK2/src/pinot.cc:323
 msgid "Turkish"
 msgstr "????????"
 
@@ -99,21 +100,21 @@
 #. Apply this label
 #. Is this an internal index ?
 #: Core/PinotSettings.cpp:436 Core/PinotSettings.cpp:1712
-#: Core/WorkerThreads.cpp:1036 UI/GTK2/src/mainWindow.cc:873
-#: UI/GTK2/src/mainWindow.cc:1139 UI/GTK2/src/mainWindow.cc:1402
-#: UI/GTK2/src/mainWindow.cc:1562 UI/GTK2/src/mainWindow.cc:1565
-#: UI/GTK2/src/mainWindow.cc:1669 UI/GTK2/src/mainWindow.cc:1703
-#: UI/GTK2/src/mainWindow.cc:1728 UI/GTK2/src/mainWindow.cc:2437
+#: Core/WorkerThreads.cpp:1060 UI/GTK2/src/mainWindow.cc:887
+#: UI/GTK2/src/mainWindow.cc:1153 UI/GTK2/src/mainWindow.cc:1416
+#: UI/GTK2/src/mainWindow.cc:1576 UI/GTK2/src/mainWindow.cc:1579
+#: UI/GTK2/src/mainWindow.cc:1683 UI/GTK2/src/mainWindow.cc:1717
+#: UI/GTK2/src/mainWindow.cc:1742 UI/GTK2/src/mainWindow.cc:2451
 #: UI/GTK2/src/statisticsDialog.cc:157
 msgid "My Web Pages"
 msgstr "??? web-????????"
 
 #. Spawn new threads
 #: Core/PinotSettings.cpp:437 Core/PinotSettings.cpp:1713
-#: Core/WorkerThreads.cpp:1046 UI/GTK2/src/mainWindow.cc:1134
-#: UI/GTK2/src/mainWindow.cc:1392 UI/GTK2/src/mainWindow.cc:1406
-#: UI/GTK2/src/mainWindow.cc:1573 UI/GTK2/src/mainWindow.cc:1576
-#: UI/GTK2/src/mainWindow.cc:2441 UI/GTK2/src/statisticsDialog.cc:163
+#: Core/WorkerThreads.cpp:1070 UI/GTK2/src/mainWindow.cc:1148
+#: UI/GTK2/src/mainWindow.cc:1406 UI/GTK2/src/mainWindow.cc:1420
+#: UI/GTK2/src/mainWindow.cc:1587 UI/GTK2/src/mainWindow.cc:1590
+#: UI/GTK2/src/mainWindow.cc:2455 UI/GTK2/src/statisticsDialog.cc:163
 msgid "My Documents"
 msgstr "??? ?????????"
 
@@ -140,11 +141,11 @@
 
 #: Core/PinotSettings.cpp:477
 msgid "Home Stuff"
-msgstr ""
+msgstr "???????? ?????"
 
 #: Core/PinotSettings.cpp:478
 msgid "With Label New"
-msgstr ""
+msgstr "?????????? ??? ?????"
 
 #: Core/PinotSettings.cpp:479
 msgid "Have CJKV"
@@ -152,7 +153,7 @@
 
 #: Core/PinotSettings.cpp:480
 msgid "In English"
-msgstr ""
+msgstr "?? ??????????"
 
 #: Core/PinotSettings.cpp:481
 msgid "10kb And Smaller"
@@ -168,7 +169,7 @@
 
 #: Core/WorkerThreads.cpp:98
 msgid "Couldn't index document"
-msgstr ""
+msgstr "?????????? ???????????????? ????????"
 
 #: Core/WorkerThreads.cpp:100
 msgid "Couldn't update document"
@@ -200,7 +201,7 @@
 
 #: Core/WorkerThreads.cpp:114
 msgid "Index doesn't exist"
-msgstr ""
+msgstr "?????? ?? ??????????"
 
 #: Core/WorkerThreads.cpp:116
 msgid "Couldn't create search engine"
@@ -212,7 +213,7 @@
 
 #: Core/WorkerThreads.cpp:120
 msgid "No downloader for this protocol"
-msgstr ""
+msgstr "??? ?????????? ??? ????? ?????????"
 
 #: Core/WorkerThreads.cpp:122
 msgid "Robots META tag forbids indexing"
@@ -227,23 +228,23 @@
 msgid "Unknown error"
 msgstr "??????????? ??????"
 
-#: Core/WorkerThreads.cpp:439
+#: Core/WorkerThreads.cpp:452
 msgid "Indexing was stopped"
 msgstr "?????????? ???? ???????????"
 
-#: Core/WorkerThreads.cpp:452
+#: Core/WorkerThreads.cpp:465
 msgid "Can't index mail here"
 msgstr "?????? ????????????? ????? ?????"
 
-#: Core/WorkerThreads.cpp:473 Core/WorkerThreads.cpp:764
+#: Core/WorkerThreads.cpp:486 Core/WorkerThreads.cpp:788
 msgid "is already being indexed"
 msgstr "??? ??????????????????"
 
-#: Core/WorkerThreads.cpp:483
+#: Core/WorkerThreads.cpp:496
 msgid "is blacklisted"
 msgstr "??????????? ? ?????? ??????"
 
-#: Core/WorkerThreads.cpp:999
+#: Core/WorkerThreads.cpp:1023
 msgid "No title"
 msgstr "??? ????????"
 
@@ -332,262 +333,264 @@
 "There is no helper application defined for this document's type.\n"
 "Please enter the command to open this document."
 msgstr ""
+"??????????????? ?????????? ??? ??????? ???? ?????????? ?? ??????????.\n"
+"??????????, ??????? ????????, ??????? ???????? ??????? ???? ????????."
 
 #: UI/GTK2/src/launcherDialog_glade.cc:66
 msgid "Use this command for other documents of the same type."
-msgstr ""
+msgstr "???????????? ??? ???????? ??? ???? ?????????? ???? ?? ????."
 
 #: UI/GTK2/src/launcherDialog_glade.cc:98
 msgid "Helper application"
-msgstr ""
+msgstr "??????????????? ??????????"
 
-#: UI/GTK2/src/mainWindow.cc:200
+#: UI/GTK2/src/mainWindow.cc:214
 msgid "Query Name"
 msgstr "??????"
 
-#: UI/GTK2/src/mainWindow.cc:205
+#: UI/GTK2/src/mainWindow.cc:219
 msgid "Last Run"
 msgstr "????????? ?????????"
 
-#: UI/GTK2/src/mainWindow.cc:210
+#: UI/GTK2/src/mainWindow.cc:224
 msgid "Summary"
 msgstr "??????"
 
 #. Set tooltips
-#: UI/GTK2/src/mainWindow.cc:252
+#: UI/GTK2/src/mainWindow.cc:266
 msgid "Show all search engines"
 msgstr "??? ????????? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:254 UI/GTK2/src/mainWindow.cc:263
+#: UI/GTK2/src/mainWindow.cc:268 UI/GTK2/src/mainWindow.cc:277
 msgid "Find documents that match the query"
-msgstr ""
+msgstr "????? ?????????, ??????????????? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:256
+#: UI/GTK2/src/mainWindow.cc:270
 msgid "Find documents that match the query string"
-msgstr ""
+msgstr "????? ?????????, ??????????????? ?????? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:258
+#: UI/GTK2/src/mainWindow.cc:272
 msgid "Add an index"
 msgstr "???????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:259
+#: UI/GTK2/src/mainWindow.cc:273
 msgid "Remove an index"
 msgstr "??????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:260
+#: UI/GTK2/src/mainWindow.cc:274
 msgid "Add a query"
-msgstr ""
+msgstr "???????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:261
+#: UI/GTK2/src/mainWindow.cc:275
 msgid "Remove a query"
-msgstr ""
+msgstr "??????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:262
+#: UI/GTK2/src/mainWindow.cc:276
 msgid "Show the query's previous results"
-msgstr ""
+msgstr "???????? ?????????? ?????????? ?? ????? ???????"
 
 #. Now we are ready
-#: UI/GTK2/src/mainWindow.cc:282
+#: UI/GTK2/src/mainWindow.cc:296
 msgid "Ready"
 msgstr "?????"
 
-#: UI/GTK2/src/mainWindow.cc:294
+#: UI/GTK2/src/mainWindow.cc:308
 msgid "Updating all documents in My Web Pages is recommended"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:302
+#: UI/GTK2/src/mainWindow.cc:316
 msgid "Don't warn me again"
 msgstr "?? ????????????? ???? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:310 UI/GTK2/src/mainWindow_glade.cc:177
+#: UI/GTK2/src/mainWindow.cc:324 UI/GTK2/src/mainWindow_glade.cc:177
 msgid "Update"
 msgstr "????????"
 
-#: UI/GTK2/src/mainWindow.cc:371
+#: UI/GTK2/src/mainWindow.cc:385
 msgid "N/A"
 msgstr "N/A"
 
-#: UI/GTK2/src/mainWindow.cc:389
+#: UI/GTK2/src/mainWindow.cc:403
 msgid "Undefined"
 msgstr "??????????????"
 
 #. Find this query
-#: UI/GTK2/src/mainWindow.cc:628 UI/GTK2/src/mainWindow.cc:2833
+#: UI/GTK2/src/mainWindow.cc:642 UI/GTK2/src/mainWindow.cc:2847
 msgid "Live query"
 msgstr "???????? ??????"
 
 #. Show the URL of the first document in the status bar
-#: UI/GTK2/src/mainWindow.cc:901
+#: UI/GTK2/src/mainWindow.cc:915
 msgid "Document location is"
 msgstr "???????????? ?????????"
 
-#: UI/GTK2/src/mainWindow.cc:1120
+#: UI/GTK2/src/mainWindow.cc:1134
 msgid "Couldn't search in results"
-msgstr ""
+msgstr "?????????? ????????? ????? ? ???????????"
 
-#: UI/GTK2/src/mainWindow.cc:1130
+#: UI/GTK2/src/mainWindow.cc:1144
 msgid "In Results"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:1303
+#: UI/GTK2/src/mainWindow.cc:1317
 msgid "Showing"
 msgstr "????????"
 
-#: UI/GTK2/src/mainWindow.cc:1311
+#: UI/GTK2/src/mainWindow.cc:1325
 msgid "of"
 msgstr "??"
 
-#: UI/GTK2/src/mainWindow.cc:1353
+#: UI/GTK2/src/mainWindow.cc:1367
 msgid "Query"
 msgstr "??????"
 
-#: UI/GTK2/src/mainWindow.cc:1357 UI/GTK2/src/mainWindow.cc:3378
+#: UI/GTK2/src/mainWindow.cc:1371 UI/GTK2/src/mainWindow.cc:3395
 msgid "on"
 msgstr "??"
 
-#: UI/GTK2/src/mainWindow.cc:1361
+#: UI/GTK2/src/mainWindow.cc:1375
 msgid "ended"
 msgstr "?????????????"
 
-#: UI/GTK2/src/mainWindow.cc:1516
+#: UI/GTK2/src/mainWindow.cc:1530
 msgid "More Like"
 msgstr "????? ????????"
 
-#: UI/GTK2/src/mainWindow.cc:1583
+#: UI/GTK2/src/mainWindow.cc:1597
 msgid "Updated label(s)"
 msgstr "????????? ????? (??)"
 
 #. Yes, it did
-#: UI/GTK2/src/mainWindow.cc:1679 UI/GTK2/src/mainWindow.cc:1769
+#: UI/GTK2/src/mainWindow.cc:1693 UI/GTK2/src/mainWindow.cc:1783
 msgid "Updated document"
 msgstr "??????????? ????????"
 
-#: UI/GTK2/src/mainWindow.cc:1692
+#: UI/GTK2/src/mainWindow.cc:1706
 msgid "Indexed"
 msgstr "?????????????"
 
-#: UI/GTK2/src/mainWindow.cc:1729
+#: UI/GTK2/src/mainWindow.cc:1743
 msgid "Unindexed document(s)"
 msgstr "?? ????????????? ??????????"
 
-#: UI/GTK2/src/mainWindow.cc:1824
+#: UI/GTK2/src/mainWindow.cc:1838
 msgid "Couldn't rename index, name"
 msgstr "?????????? ????????????? ??????, ????????"
 
-#: UI/GTK2/src/mainWindow.cc:1828 UI/GTK2/src/mainWindow.cc:2637
-#: UI/GTK2/src/mainWindow.cc:3184
+#: UI/GTK2/src/mainWindow.cc:1842 UI/GTK2/src/mainWindow.cc:2651
+#: UI/GTK2/src/mainWindow.cc:3201
 msgid "is already in use"
 msgstr "??? ????????????"
 
-#: UI/GTK2/src/mainWindow.cc:1840
+#: UI/GTK2/src/mainWindow.cc:1854
 msgid "Couldn't rename index"
 msgstr "?????????? ????????????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:1855
+#: UI/GTK2/src/mainWindow.cc:1869
 msgid "Edited index"
 msgstr "?????????????? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:2165
+#: UI/GTK2/src/mainWindow.cc:2179
 msgid "Export"
 msgstr "???????"
 
-#: UI/GTK2/src/mainWindow.cc:2210
+#: UI/GTK2/src/mainWindow.cc:2224
 msgid "Couldn't find similar documents"
 msgstr "?? ??????? ????? ???????? ?????????"
 
-#: UI/GTK2/src/mainWindow.cc:2453
+#: UI/GTK2/src/mainWindow.cc:2467
 msgid "Index"
 msgstr "??????"
 
-#: UI/GTK2/src/mainWindow.cc:2457
+#: UI/GTK2/src/mainWindow.cc:2471
 msgid "doesn't exist"
 msgstr "???"
 
-#: UI/GTK2/src/mainWindow.cc:2524
+#: UI/GTK2/src/mainWindow.cc:2538
 msgid "Remove this document from the index ?"
 msgstr "??????? ???????? ?? ??????? ?"
 
-#: UI/GTK2/src/mainWindow.cc:2543
+#: UI/GTK2/src/mainWindow.cc:2557
 msgid "Remove these documents from the index ?"
 msgstr "??????? ??? ????????? ?? ????????"
 
-#: UI/GTK2/src/mainWindow.cc:2548 UI/GTK2/src/mainWindow_glade.cc:180
+#: UI/GTK2/src/mainWindow.cc:2562 UI/GTK2/src/mainWindow_glade.cc:180
 msgid "Unindex"
 msgstr "????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:2587
+#: UI/GTK2/src/mainWindow.cc:2601
 msgid "A metasearch tool for the Free Desktop"
 msgstr "?????????? ?????????? ??? ?????????? ????????"
 
-#: UI/GTK2/src/mainWindow.cc:2588
+#: UI/GTK2/src/mainWindow.cc:2602
 msgid "Search the Web and your documents !"
-msgstr ""
+msgstr "????? ? ???? ? ? ????? ??????????!"
 
-#: UI/GTK2/src/mainWindow.cc:2633
+#: UI/GTK2/src/mainWindow.cc:2647
 msgid "Index name"
 msgstr "???????? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:2647
+#: UI/GTK2/src/mainWindow.cc:2661
 msgid "Couldn't add index"
 msgstr "?????????? ???????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:2663
+#: UI/GTK2/src/mainWindow.cc:2677
 msgid "Added new index"
 msgstr "???????? ????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:2698
+#: UI/GTK2/src/mainWindow.cc:2712
 msgid "Couldn't remove index"
 msgstr "?????????? ??????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:2922
+#: UI/GTK2/src/mainWindow.cc:2938
 msgid "No history for"
 msgstr "??? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:2994 UI/GTK2/src/prefsWindow.cc:960
+#: UI/GTK2/src/mainWindow.cc:3010 UI/GTK2/src/prefsWindow.cc:960
 msgid "At least one task hasn't completed yet. Quit now ?"
 msgstr "?? ??????? ???? ???? ?????? ??? ?? ?????????. ????? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:2996 UI/GTK2/src/prefsWindow.cc:962
+#: UI/GTK2/src/mainWindow.cc:3012 UI/GTK2/src/prefsWindow.cc:962
 msgid "Quit"
 msgstr "?????"
 
-#: UI/GTK2/src/mainWindow.cc:3180
+#: UI/GTK2/src/mainWindow.cc:3197
 msgid "Query name"
 msgstr "???????? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:3207
+#: UI/GTK2/src/mainWindow.cc:3224
 msgid "Couldn't update query"
 msgstr "?????????? ???????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:3218
+#: UI/GTK2/src/mainWindow.cc:3235
 msgid "Edited query"
 msgstr "?????? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:3225
+#: UI/GTK2/src/mainWindow.cc:3242
 msgid "Couldn't add query"
 msgstr "?????????? ???????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:3233
+#: UI/GTK2/src/mainWindow.cc:3250
 msgid "Added new query"
 msgstr "???????? ????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:3267
+#: UI/GTK2/src/mainWindow.cc:3284
 msgid "Query is not set"
 msgstr "?????? ?? ??????????"
 
-#: UI/GTK2/src/mainWindow.cc:3278
+#: UI/GTK2/src/mainWindow.cc:3295
 msgid "No search engine selected"
 msgstr "?? ???? ????????? ??????? ?? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:3365
+#: UI/GTK2/src/mainWindow.cc:3382
 msgid "Please set the Google API key first"
 msgstr "??????????, ??????? ????????????? ???? Google API"
 
-#: UI/GTK2/src/mainWindow.cc:3374
+#: UI/GTK2/src/mainWindow.cc:3391
 msgid "Running query"
 msgstr "?????? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:3581
+#: UI/GTK2/src/mainWindow.cc:3598
 msgid "No default application defined for type"
 msgstr "?? ???? ?????????? ?? ????????? ?? ?????????? ??? ???? ??????????"
 
@@ -613,7 +616,7 @@
 
 #: UI/GTK2/src/mainWindow_glade.cc:174
 msgid "_Add To Index"
-msgstr ""
+msgstr "_???????? ? ??????"
 
 #: UI/GTK2/src/mainWindow_glade.cc:186
 msgid "More Like This"
@@ -621,7 +624,7 @@
 
 #: UI/GTK2/src/mainWindow_glade.cc:189
 msgid "Search This For"
-msgstr ""
+msgstr "?????? ? ?????????"
 
 #: UI/GTK2/src/mainWindow_glade.cc:222
 msgid "Search Engine"
@@ -637,15 +640,15 @@
 
 #: UI/GTK2/src/mainWindow_glade.cc:231
 msgid "Group Results By"
-msgstr ""
+msgstr "???????????? ?????????? ??"
 
 #: UI/GTK2/src/mainWindow_glade.cc:234
 msgid "Show Extracts"
-msgstr ""
+msgstr "?????????? ????????"
 
 #: UI/GTK2/src/mainWindow_glade.cc:243
 msgid "Export List"
-msgstr ""
+msgstr "??????? ??????"
 
 #: UI/GTK2/src/mainWindow_glade.cc:249 UI/GTK2/src/statisticsDialog.cc:121
 #: UI/GTK2/src/statisticsDialog_glade.cc:86
@@ -674,27 +677,27 @@
 
 #: UI/GTK2/src/Notebook.cc:84
 msgid "Did you mean ?"
-msgstr ""
+msgstr "????????, ?? ????? ? ????"
 
-#: UI/GTK2/src/Notebook.cc:95 UI/GTK2/src/Notebook.cc:236
+#: UI/GTK2/src/Notebook.cc:95 UI/GTK2/src/Notebook.cc:242
 msgid "Close"
 msgstr "???????"
 
-#: UI/GTK2/src/pinot.cc:350
+#: UI/GTK2/src/pinot.cc:349
 msgid "Couldn't open index"
 msgstr "?????????? ??????? ??????"
 
-#: UI/GTK2/src/pinot.cc:371
+#: UI/GTK2/src/pinot.cc:370
 msgid "Couldn't create history database"
 msgstr "?? ??????? ??????? ???? ?????? ???????"
 
 #: UI/GTK2/src/prefsWindow.cc:149
 msgid "File Indexing and Search"
-msgstr ""
+msgstr "?????????? ? ????? ? ??????"
 
 #: UI/GTK2/src/prefsWindow.cc:150
 msgid "Configure Pinot to index your files"
-msgstr ""
+msgstr "????????? Pinot ??? ?????????? ????? ??????"
 
 #: UI/GTK2/src/prefsWindow.cc:208
 msgid "Name"
@@ -714,11 +717,11 @@
 
 #: UI/GTK2/src/prefsWindow.cc:572
 msgid "Exclude these patterns from indexing"
-msgstr ""
+msgstr "?? ????????????? ?????, ??????????? ? ????? ?????????"
 
 #: UI/GTK2/src/prefsWindow.cc:573
 msgid "Only index these patterns"
-msgstr ""
+msgstr "????????????? ?????? ??????????? ? ????? ????????? ?????"
 
 #: UI/GTK2/src/prefsWindow.cc:772
 msgid "Directory to index"
@@ -729,8 +732,7 @@
 msgstr "????? ?????"
 
 #: UI/GTK2/src/prefsWindow_glade.cc:69
-msgid ""
-"These directories will be indexed and optionally monitored for changes:"
+msgid "These directories will be indexed and optionally monitored for changes:"
 msgstr ""
 "??? ???????? ????? ??????????????? ? ????????????? ??? ???????? ?????????:"
 
@@ -883,7 +885,7 @@
 
 #: UI/GTK2/src/queryDialog.cc:120
 msgid "MIME class"
-msgstr ""
+msgstr "MIME-?????"
 
 #: UI/GTK2/src/queryDialog.cc:121
 msgid "Label"
@@ -913,7 +915,7 @@
 
 #: UI/GTK2/src/queryDialog_glade.cc:71
 msgid "New filter or range:"
-msgstr ""
+msgstr "????? ?????? ??? ????????:"
 
 #: UI/GTK2/src/queryDialog_glade.cc:80
 msgid "Query Text"
@@ -933,7 +935,7 @@
 
 #: UI/GTK2/src/queryDialog_glade.cc:93
 msgid "Stemming:"
-msgstr ""
+msgstr "?????????????:"
 
 #: UI/GTK2/src/queryDialog_glade.cc:94
 msgid "Only index new results"
@@ -959,7 +961,7 @@
 #: UI/GTK2/src/statisticsDialog.cc:160 UI/GTK2/src/statisticsDialog.cc:166
 #: UI/GTK2/src/statisticsDialog.cc:197
 msgid "Checking"
-msgstr ""
+msgstr "????????"
 
 #: UI/GTK2/src/statisticsDialog.cc:194
 msgid "Daemon"
@@ -967,7 +969,7 @@
 
 #: UI/GTK2/src/statisticsDialog.cc:216
 msgid "Viewed"
-msgstr ""
+msgstr "???????????"
 
 #: UI/GTK2/src/statisticsDialog.cc:216
 msgid "results"
@@ -988,7 +990,7 @@
 #. FIXME: check whether it's actually running !
 #: UI/GTK2/src/statisticsDialog.cc:284
 msgid "Running under PID"
-msgstr ""
+msgstr "????????, ????????????? ????????"
 
 #: UI/GTK2/src/statisticsDialog.cc:306
 msgid "Disconnected from D-Bus"
@@ -996,7 +998,7 @@
 
 #: UI/GTK2/src/statisticsDialog.cc:310
 msgid "Stopped"
-msgstr ""
+msgstr "??????????"
 
 #: UI/GTK2/src/statisticsDialog.cc:314
 msgid "Currently not running"



From fabricecolin at mail.berlios.de  Fri Dec 31 09:45:05 2010
From: fabricecolin at mail.berlios.de (fabricecolin at mail.berlios.de)
Date: Fri, 31 Dec 2010 09:45:05 +0100
Subject: [Pinot-svn] r1752 - trunk/po
Message-ID: <20101231084505.59F054803D7@sheep.berlios.de>

Author: fabricecolin
Date: 2010-12-31 09:45:04 +0100 (Fri, 31 Dec 2010)
New Revision: 1752

Modified:
   trunk/po/es.po
   trunk/po/ru.po
   trunk/po/zh_CN.po
Log:
Updates from Fitoschido, Nikolay Kachanov and mike2718.


Modified: trunk/po/es.po
===================================================================
--- trunk/po/es.po	2010-12-20 08:53:13 UTC (rev 1751)
+++ trunk/po/es.po	2010-12-31 08:45:04 UTC (rev 1752)
@@ -7,11 +7,10 @@
 msgstr ""
 "Project-Id-Version: pinot 0.96\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2010-12-06 21:15+0800\n"
-"PO-Revision-Date: 2010-12-01 14:03+0000\n"
+"POT-Creation-Date: 2010-06-20 16:10+0800\n"
+"PO-Revision-Date: 2010-12-31 07:12+0000\n"
 "Last-Translator: Fitoschido <Unknown>\n"
 "Language-Team: es <fabricecolin at users.berlios.de>\n"
-"Language: \n"
 "MIME-Version: 1.0\n"
 "Content-Type: text/plain; charset=utf-8\n"
 "Content-Transfer-Encoding: 8bit\n"
@@ -33,67 +32,67 @@
 msgstr "No se pudo formatear la sentencia SQL"
 
 #. Localize language names
-#: Core/pinot-dbus-daemon.cpp:543 UI/GTK2/src/pinot.cc:308
+#: Core/pinot-dbus-daemon.cpp:543 UI/GTK2/src/pinot.cc:309
 msgid "Unknown"
 msgstr "Desconocido"
 
-#: Core/pinot-dbus-daemon.cpp:544 UI/GTK2/src/pinot.cc:309
+#: Core/pinot-dbus-daemon.cpp:544 UI/GTK2/src/pinot.cc:310
 msgid "Danish"
 msgstr "Dan?s"
 
-#: Core/pinot-dbus-daemon.cpp:545 UI/GTK2/src/pinot.cc:310
+#: Core/pinot-dbus-daemon.cpp:545 UI/GTK2/src/pinot.cc:311
 msgid "Dutch"
 msgstr "Holand?s"
 
-#: Core/pinot-dbus-daemon.cpp:546 UI/GTK2/src/pinot.cc:311
+#: Core/pinot-dbus-daemon.cpp:546 UI/GTK2/src/pinot.cc:312
 msgid "English"
 msgstr "Ingl?s"
 
-#: Core/pinot-dbus-daemon.cpp:547 UI/GTK2/src/pinot.cc:312
+#: Core/pinot-dbus-daemon.cpp:547 UI/GTK2/src/pinot.cc:313
 msgid "Finnish"
 msgstr "Finland?s"
 
-#: Core/pinot-dbus-daemon.cpp:548 UI/GTK2/src/pinot.cc:313
+#: Core/pinot-dbus-daemon.cpp:548 UI/GTK2/src/pinot.cc:314
 msgid "French"
 msgstr "Franc?s"
 
-#: Core/pinot-dbus-daemon.cpp:549 UI/GTK2/src/pinot.cc:314
+#: Core/pinot-dbus-daemon.cpp:549 UI/GTK2/src/pinot.cc:315
 msgid "German"
 msgstr "Alem?n"
 
-#: Core/pinot-dbus-daemon.cpp:550 UI/GTK2/src/pinot.cc:315
+#: Core/pinot-dbus-daemon.cpp:550 UI/GTK2/src/pinot.cc:316
 msgid "Hungarian"
 msgstr "H?ngaro"
 
-#: Core/pinot-dbus-daemon.cpp:551 UI/GTK2/src/pinot.cc:316
+#: Core/pinot-dbus-daemon.cpp:551 UI/GTK2/src/pinot.cc:317
 msgid "Italian"
 msgstr "Italiano"
 
-#: Core/pinot-dbus-daemon.cpp:552 UI/GTK2/src/pinot.cc:317
+#: Core/pinot-dbus-daemon.cpp:552 UI/GTK2/src/pinot.cc:318
 msgid "Norwegian"
 msgstr "Noruego"
 
-#: Core/pinot-dbus-daemon.cpp:553 UI/GTK2/src/pinot.cc:318
+#: Core/pinot-dbus-daemon.cpp:553 UI/GTK2/src/pinot.cc:319
 msgid "Portuguese"
 msgstr "Portugu?s"
 
-#: Core/pinot-dbus-daemon.cpp:554 UI/GTK2/src/pinot.cc:319
+#: Core/pinot-dbus-daemon.cpp:554 UI/GTK2/src/pinot.cc:320
 msgid "Romanian"
 msgstr "Rumano"
 
-#: Core/pinot-dbus-daemon.cpp:555 UI/GTK2/src/pinot.cc:320
+#: Core/pinot-dbus-daemon.cpp:555 UI/GTK2/src/pinot.cc:321
 msgid "Russian"
 msgstr "Ruso"
 
-#: Core/pinot-dbus-daemon.cpp:556 UI/GTK2/src/pinot.cc:321
+#: Core/pinot-dbus-daemon.cpp:556 UI/GTK2/src/pinot.cc:322
 msgid "Spanish"
 msgstr "Espa?ol"
 
-#: Core/pinot-dbus-daemon.cpp:557 UI/GTK2/src/pinot.cc:322
+#: Core/pinot-dbus-daemon.cpp:557 UI/GTK2/src/pinot.cc:323
 msgid "Swedish"
 msgstr "Sueco"
 
-#: Core/pinot-dbus-daemon.cpp:558 UI/GTK2/src/pinot.cc:323
+#: Core/pinot-dbus-daemon.cpp:558 UI/GTK2/src/pinot.cc:324
 msgid "Turkish"
 msgstr "Turco"
 
@@ -101,7 +100,7 @@
 #. Apply this label
 #. Is this an internal index ?
 #: Core/PinotSettings.cpp:436 Core/PinotSettings.cpp:1712
-#: Core/WorkerThreads.cpp:1048 UI/GTK2/src/mainWindow.cc:873
+#: Core/WorkerThreads.cpp:1036 UI/GTK2/src/mainWindow.cc:873
 #: UI/GTK2/src/mainWindow.cc:1139 UI/GTK2/src/mainWindow.cc:1402
 #: UI/GTK2/src/mainWindow.cc:1562 UI/GTK2/src/mainWindow.cc:1565
 #: UI/GTK2/src/mainWindow.cc:1669 UI/GTK2/src/mainWindow.cc:1703
@@ -112,7 +111,7 @@
 
 #. Spawn new threads
 #: Core/PinotSettings.cpp:437 Core/PinotSettings.cpp:1713
-#: Core/WorkerThreads.cpp:1058 UI/GTK2/src/mainWindow.cc:1134
+#: Core/WorkerThreads.cpp:1046 UI/GTK2/src/mainWindow.cc:1134
 #: UI/GTK2/src/mainWindow.cc:1392 UI/GTK2/src/mainWindow.cc:1406
 #: UI/GTK2/src/mainWindow.cc:1573 UI/GTK2/src/mainWindow.cc:1576
 #: UI/GTK2/src/mainWindow.cc:2441 UI/GTK2/src/statisticsDialog.cc:163
@@ -229,23 +228,23 @@
 msgid "Unknown error"
 msgstr "Error desconocido"
 
-#: Core/WorkerThreads.cpp:451
+#: Core/WorkerThreads.cpp:439
 msgid "Indexing was stopped"
 msgstr "La indexaci?n fue detenida"
 
-#: Core/WorkerThreads.cpp:464
+#: Core/WorkerThreads.cpp:452
 msgid "Can't index mail here"
 msgstr "No se puede indexar el correo aqu?"
 
-#: Core/WorkerThreads.cpp:485 Core/WorkerThreads.cpp:776
+#: Core/WorkerThreads.cpp:473 Core/WorkerThreads.cpp:764
 msgid "is already being indexed"
 msgstr "Ya se est? indexando"
 
-#: Core/WorkerThreads.cpp:495
+#: Core/WorkerThreads.cpp:483
 msgid "is blacklisted"
 msgstr "Est? excluido"
 
-#: Core/WorkerThreads.cpp:1011
+#: Core/WorkerThreads.cpp:999
 msgid "No title"
 msgstr "Sin t?tulo"
 
@@ -680,15 +679,15 @@
 msgid "Did you mean ?"
 msgstr "?Te refieres a?"
 
-#: UI/GTK2/src/Notebook.cc:95 UI/GTK2/src/Notebook.cc:242
+#: UI/GTK2/src/Notebook.cc:95 UI/GTK2/src/Notebook.cc:236
 msgid "Close"
 msgstr "Cerrar"
 
-#: UI/GTK2/src/pinot.cc:349
+#: UI/GTK2/src/pinot.cc:350
 msgid "Couldn't open index"
 msgstr "No se pudo abrir el ?ndice"
 
-#: UI/GTK2/src/pinot.cc:370
+#: UI/GTK2/src/pinot.cc:371
 msgid "Couldn't create history database"
 msgstr "No se pudo crear la base de datos de la historia"
 
@@ -733,7 +732,8 @@
 msgstr "Nueva etiqueta"
 
 #: UI/GTK2/src/prefsWindow_glade.cc:69
-msgid "These directories will be indexed and optionally monitored for changes:"
+msgid ""
+"These directories will be indexed and optionally monitored for changes:"
 msgstr ""
 "Estos directorios ser?n indexados, y opcionalmente, monitoreados para "
 "cambios:"
@@ -757,7 +757,8 @@
 
 #: UI/GTK2/src/prefsWindow_glade.cc:101
 msgid "Labels are used to classify indexed documents:"
-msgstr "Las etiquetas son utilizadas para clasificar los documentos indexados:"
+msgstr ""
+"Las etiquetas son utilizadas para clasificar los documentos indexados:"
 
 #: UI/GTK2/src/prefsWindow_glade.cc:112
 msgid "Remove"
@@ -904,7 +905,7 @@
 
 #: UI/GTK2/src/queryDialog.cc:126
 msgid "Size"
-msgstr "Tama?o:"
+msgstr "Tama?o"
 
 #. Sort order
 #: UI/GTK2/src/queryDialog.cc:130

Modified: trunk/po/ru.po
===================================================================
--- trunk/po/ru.po	2010-12-20 08:53:13 UTC (rev 1751)
+++ trunk/po/ru.po	2010-12-31 08:45:04 UTC (rev 1752)
@@ -6,11 +6,10 @@
 msgstr ""
 "Project-Id-Version: pinot 0.96\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2010-12-20 09:51+0100\n"
-"PO-Revision-Date: 2010-12-18 22:47+0000\n"
+"POT-Creation-Date: 2010-06-20 16:10+0800\n"
+"PO-Revision-Date: 2010-12-25 22:10+0000\n"
 "Last-Translator: Nikolay Kachanov <Nikolay.Kachanov at gmail.Com>\n"
 "Language-Team: Russian <ru at li.org>\n"
-"Language: ru\n"
 "MIME-Version: 1.0\n"
 "Content-Type: text/plain; charset=UTF-8\n"
 "Content-Transfer-Encoding: 8bit\n"
@@ -32,67 +31,67 @@
 msgstr "?????????? ????????? ?????????????? ????????? SQL"
 
 #. Localize language names
-#: Core/pinot-dbus-daemon.cpp:548 UI/GTK2/src/pinot.cc:308
+#: Core/pinot-dbus-daemon.cpp:543 UI/GTK2/src/pinot.cc:309
 msgid "Unknown"
 msgstr "???????????"
 
-#: Core/pinot-dbus-daemon.cpp:549 UI/GTK2/src/pinot.cc:309
+#: Core/pinot-dbus-daemon.cpp:544 UI/GTK2/src/pinot.cc:310
 msgid "Danish"
 msgstr "???????"
 
-#: Core/pinot-dbus-daemon.cpp:550 UI/GTK2/src/pinot.cc:310
+#: Core/pinot-dbus-daemon.cpp:545 UI/GTK2/src/pinot.cc:311
 msgid "Dutch"
 msgstr "???????????"
 
-#: Core/pinot-dbus-daemon.cpp:551 UI/GTK2/src/pinot.cc:311
+#: Core/pinot-dbus-daemon.cpp:546 UI/GTK2/src/pinot.cc:312
 msgid "English"
 msgstr "??????????"
 
-#: Core/pinot-dbus-daemon.cpp:552 UI/GTK2/src/pinot.cc:312
+#: Core/pinot-dbus-daemon.cpp:547 UI/GTK2/src/pinot.cc:313
 msgid "Finnish"
 msgstr "???????"
 
-#: Core/pinot-dbus-daemon.cpp:553 UI/GTK2/src/pinot.cc:313
+#: Core/pinot-dbus-daemon.cpp:548 UI/GTK2/src/pinot.cc:314
 msgid "French"
 msgstr "???????????"
 
-#: Core/pinot-dbus-daemon.cpp:554 UI/GTK2/src/pinot.cc:314
+#: Core/pinot-dbus-daemon.cpp:549 UI/GTK2/src/pinot.cc:315
 msgid "German"
 msgstr "????????"
 
-#: Core/pinot-dbus-daemon.cpp:555 UI/GTK2/src/pinot.cc:315
+#: Core/pinot-dbus-daemon.cpp:550 UI/GTK2/src/pinot.cc:316
 msgid "Hungarian"
 msgstr "??????????"
 
-#: Core/pinot-dbus-daemon.cpp:556 UI/GTK2/src/pinot.cc:316
+#: Core/pinot-dbus-daemon.cpp:551 UI/GTK2/src/pinot.cc:317
 msgid "Italian"
 msgstr "???????????"
 
-#: Core/pinot-dbus-daemon.cpp:557 UI/GTK2/src/pinot.cc:317
+#: Core/pinot-dbus-daemon.cpp:552 UI/GTK2/src/pinot.cc:318
 msgid "Norwegian"
 msgstr "??????????"
 
-#: Core/pinot-dbus-daemon.cpp:558 UI/GTK2/src/pinot.cc:318
+#: Core/pinot-dbus-daemon.cpp:553 UI/GTK2/src/pinot.cc:319
 msgid "Portuguese"
 msgstr "?????????????"
 
-#: Core/pinot-dbus-daemon.cpp:559 UI/GTK2/src/pinot.cc:319
+#: Core/pinot-dbus-daemon.cpp:554 UI/GTK2/src/pinot.cc:320
 msgid "Romanian"
 msgstr "?????????"
 
-#: Core/pinot-dbus-daemon.cpp:560 UI/GTK2/src/pinot.cc:320
+#: Core/pinot-dbus-daemon.cpp:555 UI/GTK2/src/pinot.cc:321
 msgid "Russian"
 msgstr "???????"
 
-#: Core/pinot-dbus-daemon.cpp:561 UI/GTK2/src/pinot.cc:321
+#: Core/pinot-dbus-daemon.cpp:556 UI/GTK2/src/pinot.cc:322
 msgid "Spanish"
 msgstr "?????????"
 
-#: Core/pinot-dbus-daemon.cpp:562 UI/GTK2/src/pinot.cc:322
+#: Core/pinot-dbus-daemon.cpp:557 UI/GTK2/src/pinot.cc:323
 msgid "Swedish"
 msgstr "????????"
 
-#: Core/pinot-dbus-daemon.cpp:563 UI/GTK2/src/pinot.cc:323
+#: Core/pinot-dbus-daemon.cpp:558 UI/GTK2/src/pinot.cc:324
 msgid "Turkish"
 msgstr "????????"
 
@@ -100,21 +99,21 @@
 #. Apply this label
 #. Is this an internal index ?
 #: Core/PinotSettings.cpp:436 Core/PinotSettings.cpp:1712
-#: Core/WorkerThreads.cpp:1060 UI/GTK2/src/mainWindow.cc:887
-#: UI/GTK2/src/mainWindow.cc:1153 UI/GTK2/src/mainWindow.cc:1416
-#: UI/GTK2/src/mainWindow.cc:1576 UI/GTK2/src/mainWindow.cc:1579
-#: UI/GTK2/src/mainWindow.cc:1683 UI/GTK2/src/mainWindow.cc:1717
-#: UI/GTK2/src/mainWindow.cc:1742 UI/GTK2/src/mainWindow.cc:2451
+#: Core/WorkerThreads.cpp:1036 UI/GTK2/src/mainWindow.cc:873
+#: UI/GTK2/src/mainWindow.cc:1139 UI/GTK2/src/mainWindow.cc:1402
+#: UI/GTK2/src/mainWindow.cc:1562 UI/GTK2/src/mainWindow.cc:1565
+#: UI/GTK2/src/mainWindow.cc:1669 UI/GTK2/src/mainWindow.cc:1703
+#: UI/GTK2/src/mainWindow.cc:1728 UI/GTK2/src/mainWindow.cc:2437
 #: UI/GTK2/src/statisticsDialog.cc:157
 msgid "My Web Pages"
 msgstr "??? web-????????"
 
 #. Spawn new threads
 #: Core/PinotSettings.cpp:437 Core/PinotSettings.cpp:1713
-#: Core/WorkerThreads.cpp:1070 UI/GTK2/src/mainWindow.cc:1148
-#: UI/GTK2/src/mainWindow.cc:1406 UI/GTK2/src/mainWindow.cc:1420
-#: UI/GTK2/src/mainWindow.cc:1587 UI/GTK2/src/mainWindow.cc:1590
-#: UI/GTK2/src/mainWindow.cc:2455 UI/GTK2/src/statisticsDialog.cc:163
+#: Core/WorkerThreads.cpp:1046 UI/GTK2/src/mainWindow.cc:1134
+#: UI/GTK2/src/mainWindow.cc:1392 UI/GTK2/src/mainWindow.cc:1406
+#: UI/GTK2/src/mainWindow.cc:1573 UI/GTK2/src/mainWindow.cc:1576
+#: UI/GTK2/src/mainWindow.cc:2441 UI/GTK2/src/statisticsDialog.cc:163
 msgid "My Documents"
 msgstr "??? ?????????"
 
@@ -149,7 +148,7 @@
 
 #: Core/PinotSettings.cpp:479
 msgid "Have CJKV"
-msgstr ""
+msgstr "? ????????-?????????? ???????????"
 
 #: Core/PinotSettings.cpp:480
 msgid "In English"
@@ -193,7 +192,7 @@
 
 #: Core/WorkerThreads.cpp:110
 msgid "File monitor error"
-msgstr ""
+msgstr "?????? ????????? ????????"
 
 #: Core/WorkerThreads.cpp:112
 msgid "Couldn't open directory"
@@ -228,23 +227,23 @@
 msgid "Unknown error"
 msgstr "??????????? ??????"
 
-#: Core/WorkerThreads.cpp:452
+#: Core/WorkerThreads.cpp:439
 msgid "Indexing was stopped"
 msgstr "?????????? ???? ???????????"
 
-#: Core/WorkerThreads.cpp:465
+#: Core/WorkerThreads.cpp:452
 msgid "Can't index mail here"
 msgstr "?????? ????????????? ????? ?????"
 
-#: Core/WorkerThreads.cpp:486 Core/WorkerThreads.cpp:788
+#: Core/WorkerThreads.cpp:473 Core/WorkerThreads.cpp:764
 msgid "is already being indexed"
 msgstr "??? ??????????????????"
 
-#: Core/WorkerThreads.cpp:496
+#: Core/WorkerThreads.cpp:483
 msgid "is blacklisted"
 msgstr "??????????? ? ?????? ??????"
 
-#: Core/WorkerThreads.cpp:1023
+#: Core/WorkerThreads.cpp:999
 msgid "No title"
 msgstr "??? ????????"
 
@@ -344,253 +343,255 @@
 msgid "Helper application"
 msgstr "??????????????? ??????????"
 
-#: UI/GTK2/src/mainWindow.cc:214
+#: UI/GTK2/src/mainWindow.cc:200
 msgid "Query Name"
 msgstr "??????"
 
-#: UI/GTK2/src/mainWindow.cc:219
+#: UI/GTK2/src/mainWindow.cc:205
 msgid "Last Run"
 msgstr "????????? ?????????"
 
-#: UI/GTK2/src/mainWindow.cc:224
+#: UI/GTK2/src/mainWindow.cc:210
 msgid "Summary"
 msgstr "??????"
 
 #. Set tooltips
-#: UI/GTK2/src/mainWindow.cc:266
+#: UI/GTK2/src/mainWindow.cc:252
 msgid "Show all search engines"
 msgstr "??? ????????? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:268 UI/GTK2/src/mainWindow.cc:277
+#: UI/GTK2/src/mainWindow.cc:254 UI/GTK2/src/mainWindow.cc:263
 msgid "Find documents that match the query"
 msgstr "????? ?????????, ??????????????? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:270
+#: UI/GTK2/src/mainWindow.cc:256
 msgid "Find documents that match the query string"
 msgstr "????? ?????????, ??????????????? ?????? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:272
+#: UI/GTK2/src/mainWindow.cc:258
 msgid "Add an index"
 msgstr "???????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:273
+#: UI/GTK2/src/mainWindow.cc:259
 msgid "Remove an index"
 msgstr "??????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:274
+#: UI/GTK2/src/mainWindow.cc:260
 msgid "Add a query"
 msgstr "???????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:275
+#: UI/GTK2/src/mainWindow.cc:261
 msgid "Remove a query"
 msgstr "??????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:276
+#: UI/GTK2/src/mainWindow.cc:262
 msgid "Show the query's previous results"
 msgstr "???????? ?????????? ?????????? ?? ????? ???????"
 
 #. Now we are ready
-#: UI/GTK2/src/mainWindow.cc:296
+#: UI/GTK2/src/mainWindow.cc:282
 msgid "Ready"
 msgstr "?????"
 
-#: UI/GTK2/src/mainWindow.cc:308
+#: UI/GTK2/src/mainWindow.cc:294
 msgid "Updating all documents in My Web Pages is recommended"
 msgstr ""
+"????????????? ????????? ?????????? ???? ?????????? ? ??????? \"??? ???-"
+"????????\""
 
-#: UI/GTK2/src/mainWindow.cc:316
+#: UI/GTK2/src/mainWindow.cc:302
 msgid "Don't warn me again"
 msgstr "?? ????????????? ???? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:324 UI/GTK2/src/mainWindow_glade.cc:177
+#: UI/GTK2/src/mainWindow.cc:310 UI/GTK2/src/mainWindow_glade.cc:177
 msgid "Update"
 msgstr "????????"
 
-#: UI/GTK2/src/mainWindow.cc:385
+#: UI/GTK2/src/mainWindow.cc:371
 msgid "N/A"
 msgstr "N/A"
 
-#: UI/GTK2/src/mainWindow.cc:403
+#: UI/GTK2/src/mainWindow.cc:389
 msgid "Undefined"
 msgstr "??????????????"
 
 #. Find this query
-#: UI/GTK2/src/mainWindow.cc:642 UI/GTK2/src/mainWindow.cc:2847
+#: UI/GTK2/src/mainWindow.cc:628 UI/GTK2/src/mainWindow.cc:2833
 msgid "Live query"
 msgstr "???????? ??????"
 
 #. Show the URL of the first document in the status bar
-#: UI/GTK2/src/mainWindow.cc:915
+#: UI/GTK2/src/mainWindow.cc:901
 msgid "Document location is"
 msgstr "???????????? ?????????"
 
-#: UI/GTK2/src/mainWindow.cc:1134
+#: UI/GTK2/src/mainWindow.cc:1120
 msgid "Couldn't search in results"
 msgstr "?????????? ????????? ????? ? ???????????"
 
-#: UI/GTK2/src/mainWindow.cc:1144
+#: UI/GTK2/src/mainWindow.cc:1130
 msgid "In Results"
-msgstr ""
+msgstr "? ??????????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:1317
+#: UI/GTK2/src/mainWindow.cc:1303
 msgid "Showing"
 msgstr "????????"
 
-#: UI/GTK2/src/mainWindow.cc:1325
+#: UI/GTK2/src/mainWindow.cc:1311
 msgid "of"
 msgstr "??"
 
-#: UI/GTK2/src/mainWindow.cc:1367
+#: UI/GTK2/src/mainWindow.cc:1353
 msgid "Query"
 msgstr "??????"
 
-#: UI/GTK2/src/mainWindow.cc:1371 UI/GTK2/src/mainWindow.cc:3395
+#: UI/GTK2/src/mainWindow.cc:1357 UI/GTK2/src/mainWindow.cc:3378
 msgid "on"
 msgstr "??"
 
-#: UI/GTK2/src/mainWindow.cc:1375
+#: UI/GTK2/src/mainWindow.cc:1361
 msgid "ended"
 msgstr "?????????????"
 
-#: UI/GTK2/src/mainWindow.cc:1530
+#: UI/GTK2/src/mainWindow.cc:1516
 msgid "More Like"
 msgstr "????? ????????"
 
-#: UI/GTK2/src/mainWindow.cc:1597
+#: UI/GTK2/src/mainWindow.cc:1583
 msgid "Updated label(s)"
 msgstr "????????? ????? (??)"
 
 #. Yes, it did
-#: UI/GTK2/src/mainWindow.cc:1693 UI/GTK2/src/mainWindow.cc:1783
+#: UI/GTK2/src/mainWindow.cc:1679 UI/GTK2/src/mainWindow.cc:1769
 msgid "Updated document"
 msgstr "??????????? ????????"
 
-#: UI/GTK2/src/mainWindow.cc:1706
+#: UI/GTK2/src/mainWindow.cc:1692
 msgid "Indexed"
 msgstr "?????????????"
 
-#: UI/GTK2/src/mainWindow.cc:1743
+#: UI/GTK2/src/mainWindow.cc:1729
 msgid "Unindexed document(s)"
 msgstr "?? ????????????? ??????????"
 
-#: UI/GTK2/src/mainWindow.cc:1838
+#: UI/GTK2/src/mainWindow.cc:1824
 msgid "Couldn't rename index, name"
 msgstr "?????????? ????????????? ??????, ????????"
 
-#: UI/GTK2/src/mainWindow.cc:1842 UI/GTK2/src/mainWindow.cc:2651
-#: UI/GTK2/src/mainWindow.cc:3201
+#: UI/GTK2/src/mainWindow.cc:1828 UI/GTK2/src/mainWindow.cc:2637
+#: UI/GTK2/src/mainWindow.cc:3184
 msgid "is already in use"
 msgstr "??? ????????????"
 
-#: UI/GTK2/src/mainWindow.cc:1854
+#: UI/GTK2/src/mainWindow.cc:1840
 msgid "Couldn't rename index"
 msgstr "?????????? ????????????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:1869
+#: UI/GTK2/src/mainWindow.cc:1855
 msgid "Edited index"
 msgstr "?????????????? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:2179
+#: UI/GTK2/src/mainWindow.cc:2165
 msgid "Export"
 msgstr "???????"
 
-#: UI/GTK2/src/mainWindow.cc:2224
+#: UI/GTK2/src/mainWindow.cc:2210
 msgid "Couldn't find similar documents"
 msgstr "?? ??????? ????? ???????? ?????????"
 
-#: UI/GTK2/src/mainWindow.cc:2467
+#: UI/GTK2/src/mainWindow.cc:2453
 msgid "Index"
 msgstr "??????"
 
-#: UI/GTK2/src/mainWindow.cc:2471
+#: UI/GTK2/src/mainWindow.cc:2457
 msgid "doesn't exist"
 msgstr "???"
 
-#: UI/GTK2/src/mainWindow.cc:2538
+#: UI/GTK2/src/mainWindow.cc:2524
 msgid "Remove this document from the index ?"
 msgstr "??????? ???????? ?? ??????? ?"
 
-#: UI/GTK2/src/mainWindow.cc:2557
+#: UI/GTK2/src/mainWindow.cc:2543
 msgid "Remove these documents from the index ?"
 msgstr "??????? ??? ????????? ?? ????????"
 
-#: UI/GTK2/src/mainWindow.cc:2562 UI/GTK2/src/mainWindow_glade.cc:180
+#: UI/GTK2/src/mainWindow.cc:2548 UI/GTK2/src/mainWindow_glade.cc:180
 msgid "Unindex"
 msgstr "????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:2601
+#: UI/GTK2/src/mainWindow.cc:2587
 msgid "A metasearch tool for the Free Desktop"
 msgstr "?????????? ?????????? ??? ?????????? ????????"
 
-#: UI/GTK2/src/mainWindow.cc:2602
+#: UI/GTK2/src/mainWindow.cc:2588
 msgid "Search the Web and your documents !"
 msgstr "????? ? ???? ? ? ????? ??????????!"
 
-#: UI/GTK2/src/mainWindow.cc:2647
+#: UI/GTK2/src/mainWindow.cc:2633
 msgid "Index name"
 msgstr "???????? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:2661
+#: UI/GTK2/src/mainWindow.cc:2647
 msgid "Couldn't add index"
 msgstr "?????????? ???????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:2677
+#: UI/GTK2/src/mainWindow.cc:2663
 msgid "Added new index"
 msgstr "???????? ????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:2712
+#: UI/GTK2/src/mainWindow.cc:2698
 msgid "Couldn't remove index"
 msgstr "?????????? ??????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:2938
+#: UI/GTK2/src/mainWindow.cc:2922
 msgid "No history for"
 msgstr "??? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:3010 UI/GTK2/src/prefsWindow.cc:960
+#: UI/GTK2/src/mainWindow.cc:2994 UI/GTK2/src/prefsWindow.cc:960
 msgid "At least one task hasn't completed yet. Quit now ?"
 msgstr "?? ??????? ???? ???? ?????? ??? ?? ?????????. ????? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:3012 UI/GTK2/src/prefsWindow.cc:962
+#: UI/GTK2/src/mainWindow.cc:2996 UI/GTK2/src/prefsWindow.cc:962
 msgid "Quit"
 msgstr "?????"
 
-#: UI/GTK2/src/mainWindow.cc:3197
+#: UI/GTK2/src/mainWindow.cc:3180
 msgid "Query name"
 msgstr "???????? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:3224
+#: UI/GTK2/src/mainWindow.cc:3207
 msgid "Couldn't update query"
 msgstr "?????????? ???????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:3235
+#: UI/GTK2/src/mainWindow.cc:3218
 msgid "Edited query"
 msgstr "?????? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:3242
+#: UI/GTK2/src/mainWindow.cc:3225
 msgid "Couldn't add query"
 msgstr "?????????? ???????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:3250
+#: UI/GTK2/src/mainWindow.cc:3233
 msgid "Added new query"
 msgstr "???????? ????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:3284
+#: UI/GTK2/src/mainWindow.cc:3267
 msgid "Query is not set"
 msgstr "?????? ?? ??????????"
 
-#: UI/GTK2/src/mainWindow.cc:3295
+#: UI/GTK2/src/mainWindow.cc:3278
 msgid "No search engine selected"
 msgstr "?? ???? ????????? ??????? ?? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:3382
+#: UI/GTK2/src/mainWindow.cc:3365
 msgid "Please set the Google API key first"
 msgstr "??????????, ??????? ????????????? ???? Google API"
 
-#: UI/GTK2/src/mainWindow.cc:3391
+#: UI/GTK2/src/mainWindow.cc:3374
 msgid "Running query"
 msgstr "?????? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:3598
+#: UI/GTK2/src/mainWindow.cc:3581
 msgid "No default application defined for type"
 msgstr "?? ???? ?????????? ?? ????????? ?? ?????????? ??? ???? ??????????"
 
@@ -612,7 +613,7 @@
 
 #: UI/GTK2/src/mainWindow_glade.cc:168
 msgid "Open Parent"
-msgstr ""
+msgstr "??????? ?????????"
 
 #: UI/GTK2/src/mainWindow_glade.cc:174
 msgid "_Add To Index"
@@ -679,15 +680,15 @@
 msgid "Did you mean ?"
 msgstr "????????, ?? ????? ? ????"
 
-#: UI/GTK2/src/Notebook.cc:95 UI/GTK2/src/Notebook.cc:242
+#: UI/GTK2/src/Notebook.cc:95 UI/GTK2/src/Notebook.cc:236
 msgid "Close"
 msgstr "???????"
 
-#: UI/GTK2/src/pinot.cc:349
+#: UI/GTK2/src/pinot.cc:350
 msgid "Couldn't open index"
 msgstr "?????????? ??????? ??????"
 
-#: UI/GTK2/src/pinot.cc:370
+#: UI/GTK2/src/pinot.cc:371
 msgid "Couldn't create history database"
 msgstr "?? ??????? ??????? ???? ?????? ???????"
 
@@ -732,7 +733,8 @@
 msgstr "????? ?????"
 
 #: UI/GTK2/src/prefsWindow_glade.cc:69
-msgid "These directories will be indexed and optionally monitored for changes:"
+msgid ""
+"These directories will be indexed and optionally monitored for changes:"
 msgstr ""
 "??? ???????? ????? ??????????????? ? ????????????? ??? ???????? ?????????:"
 

Modified: trunk/po/zh_CN.po
===================================================================
--- trunk/po/zh_CN.po	2010-12-20 08:53:13 UTC (rev 1751)
+++ trunk/po/zh_CN.po	2010-12-31 08:45:04 UTC (rev 1752)
@@ -6,16 +6,13 @@
 msgstr ""
 "Project-Id-Version: pinot 0.96\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2010-12-14 21:24+0800\n"
+"POT-Creation-Date: 2010-06-20 16:10+0800\n"
 "PO-Revision-Date: 2010-12-15 03:59+0000\n"
 "Last-Translator: mike2718 <mike2718 at gmail.com>\n"
 "Language-Team: \n"
-"Language: \n"
 "MIME-Version: 1.0\n"
 "Content-Type: text/plain; charset=UTF-8\n"
 "Content-Transfer-Encoding: 8bit\n"
-"X-Launchpad-Export-Date: 2010-12-15 08:44+0000\n"
-"X-Generator: Launchpad (build Unknown)\n"
 
 #: SQL/SQLiteBase.cpp:419
 msgid "failed to begin transaction"
@@ -34,67 +31,67 @@
 msgstr "?????SQL??"
 
 #. Localize language names
-#: Core/pinot-dbus-daemon.cpp:548 UI/GTK2/src/pinot.cc:308
+#: Core/pinot-dbus-daemon.cpp:543 UI/GTK2/src/pinot.cc:309
 msgid "Unknown"
 msgstr "??"
 
-#: Core/pinot-dbus-daemon.cpp:549 UI/GTK2/src/pinot.cc:309
+#: Core/pinot-dbus-daemon.cpp:544 UI/GTK2/src/pinot.cc:310
 msgid "Danish"
 msgstr "???"
 
-#: Core/pinot-dbus-daemon.cpp:550 UI/GTK2/src/pinot.cc:310
+#: Core/pinot-dbus-daemon.cpp:545 UI/GTK2/src/pinot.cc:311
 msgid "Dutch"
 msgstr "???"
 
-#: Core/pinot-dbus-daemon.cpp:551 UI/GTK2/src/pinot.cc:311
+#: Core/pinot-dbus-daemon.cpp:546 UI/GTK2/src/pinot.cc:312
 msgid "English"
 msgstr "??"
 
-#: Core/pinot-dbus-daemon.cpp:552 UI/GTK2/src/pinot.cc:312
+#: Core/pinot-dbus-daemon.cpp:547 UI/GTK2/src/pinot.cc:313
 msgid "Finnish"
 msgstr "???"
 
-#: Core/pinot-dbus-daemon.cpp:553 UI/GTK2/src/pinot.cc:313
+#: Core/pinot-dbus-daemon.cpp:548 UI/GTK2/src/pinot.cc:314
 msgid "French"
 msgstr "??"
 
-#: Core/pinot-dbus-daemon.cpp:554 UI/GTK2/src/pinot.cc:314
+#: Core/pinot-dbus-daemon.cpp:549 UI/GTK2/src/pinot.cc:315
 msgid "German"
 msgstr "??"
 
-#: Core/pinot-dbus-daemon.cpp:555 UI/GTK2/src/pinot.cc:315
+#: Core/pinot-dbus-daemon.cpp:550 UI/GTK2/src/pinot.cc:316
 msgid "Hungarian"
 msgstr "????"
 
-#: Core/pinot-dbus-daemon.cpp:556 UI/GTK2/src/pinot.cc:316
+#: Core/pinot-dbus-daemon.cpp:551 UI/GTK2/src/pinot.cc:317
 msgid "Italian"
 msgstr "????"
 
-#: Core/pinot-dbus-daemon.cpp:557 UI/GTK2/src/pinot.cc:317
+#: Core/pinot-dbus-daemon.cpp:552 UI/GTK2/src/pinot.cc:318
 msgid "Norwegian"
 msgstr "???"
 
-#: Core/pinot-dbus-daemon.cpp:558 UI/GTK2/src/pinot.cc:318
+#: Core/pinot-dbus-daemon.cpp:553 UI/GTK2/src/pinot.cc:319
 msgid "Portuguese"
 msgstr "????"
 
-#: Core/pinot-dbus-daemon.cpp:559 UI/GTK2/src/pinot.cc:319
+#: Core/pinot-dbus-daemon.cpp:554 UI/GTK2/src/pinot.cc:320
 msgid "Romanian"
 msgstr "?????"
 
-#: Core/pinot-dbus-daemon.cpp:560 UI/GTK2/src/pinot.cc:320
+#: Core/pinot-dbus-daemon.cpp:555 UI/GTK2/src/pinot.cc:321
 msgid "Russian"
 msgstr "??"
 
-#: Core/pinot-dbus-daemon.cpp:561 UI/GTK2/src/pinot.cc:321
+#: Core/pinot-dbus-daemon.cpp:556 UI/GTK2/src/pinot.cc:322
 msgid "Spanish"
 msgstr "????"
 
-#: Core/pinot-dbus-daemon.cpp:562 UI/GTK2/src/pinot.cc:322
+#: Core/pinot-dbus-daemon.cpp:557 UI/GTK2/src/pinot.cc:323
 msgid "Swedish"
 msgstr "???"
 
-#: Core/pinot-dbus-daemon.cpp:563 UI/GTK2/src/pinot.cc:323
+#: Core/pinot-dbus-daemon.cpp:558 UI/GTK2/src/pinot.cc:324
 msgid "Turkish"
 msgstr "????"
 
@@ -102,7 +99,7 @@
 #. Apply this label
 #. Is this an internal index ?
 #: Core/PinotSettings.cpp:436 Core/PinotSettings.cpp:1712
-#: Core/WorkerThreads.cpp:1060 UI/GTK2/src/mainWindow.cc:873
+#: Core/WorkerThreads.cpp:1036 UI/GTK2/src/mainWindow.cc:873
 #: UI/GTK2/src/mainWindow.cc:1139 UI/GTK2/src/mainWindow.cc:1402
 #: UI/GTK2/src/mainWindow.cc:1562 UI/GTK2/src/mainWindow.cc:1565
 #: UI/GTK2/src/mainWindow.cc:1669 UI/GTK2/src/mainWindow.cc:1703
@@ -113,7 +110,7 @@
 
 #. Spawn new threads
 #: Core/PinotSettings.cpp:437 Core/PinotSettings.cpp:1713
-#: Core/WorkerThreads.cpp:1070 UI/GTK2/src/mainWindow.cc:1134
+#: Core/WorkerThreads.cpp:1046 UI/GTK2/src/mainWindow.cc:1134
 #: UI/GTK2/src/mainWindow.cc:1392 UI/GTK2/src/mainWindow.cc:1406
 #: UI/GTK2/src/mainWindow.cc:1573 UI/GTK2/src/mainWindow.cc:1576
 #: UI/GTK2/src/mainWindow.cc:2441 UI/GTK2/src/statisticsDialog.cc:163
@@ -230,23 +227,23 @@
 msgid "Unknown error"
 msgstr "????"
 
-#: Core/WorkerThreads.cpp:452
+#: Core/WorkerThreads.cpp:439
 msgid "Indexing was stopped"
 msgstr ""
 
-#: Core/WorkerThreads.cpp:465
+#: Core/WorkerThreads.cpp:452
 msgid "Can't index mail here"
 msgstr "??????"
 
-#: Core/WorkerThreads.cpp:486 Core/WorkerThreads.cpp:788
+#: Core/WorkerThreads.cpp:473 Core/WorkerThreads.cpp:764
 msgid "is already being indexed"
 msgstr "??????"
 
-#: Core/WorkerThreads.cpp:496
+#: Core/WorkerThreads.cpp:483
 msgid "is blacklisted"
 msgstr "?????"
 
-#: Core/WorkerThreads.cpp:1023
+#: Core/WorkerThreads.cpp:999
 msgid "No title"
 msgstr "???"
 
@@ -679,15 +676,15 @@
 msgid "Did you mean ?"
 msgstr ""
 
-#: UI/GTK2/src/Notebook.cc:95 UI/GTK2/src/Notebook.cc:242
+#: UI/GTK2/src/Notebook.cc:95 UI/GTK2/src/Notebook.cc:236
 msgid "Close"
 msgstr ""
 
-#: UI/GTK2/src/pinot.cc:349
+#: UI/GTK2/src/pinot.cc:350
 msgid "Couldn't open index"
 msgstr "??????"
 
-#: UI/GTK2/src/pinot.cc:370
+#: UI/GTK2/src/pinot.cc:371
 msgid "Couldn't create history database"
 msgstr "?????????"
 
@@ -732,7 +729,8 @@
 msgstr "????"
 
 #: UI/GTK2/src/prefsWindow_glade.cc:69
-msgid "These directories will be indexed and optionally monitored for changes:"
+msgid ""
+"These directories will be indexed and optionally monitored for changes:"
 msgstr "??????????????????????????"
 
 #: UI/GTK2/src/prefsWindow_glade.cc:74 UI/GTK2/src/prefsWindow_glade.cc:90



