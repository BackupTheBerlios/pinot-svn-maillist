From fabricecolin at mail.berlios.de  Sat May  3 08:06:49 2008
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 3 May 2008 08:06:49 +0200
Subject: [Pinot-svn] r1235 - in trunk: . IndexSearch IndexSearch/Xapian
	Tokenize po
Message-ID: <200805030606.m4366n11021515@sheep.berlios.de>

Author: fabricecolin
Date: 2008-05-03 08:06:48 +0200 (Sat, 03 May 2008)
New Revision: 1235

Added:
   trunk/po/ja.po
Modified:
   trunk/IndexSearch/Makefile.am
   trunk/IndexSearch/Xapian/Makefile.am
   trunk/Tokenize/Makefile.am
   trunk/configure.in
Log:
CJKVTokenizer is useful to code outside of the Xapian back-end and should be
in libTokenize. The new Exif filter is also compiled.
Adding Mizuki-san's Japanese translation.


Modified: trunk/IndexSearch/Makefile.am
===================================================================
--- trunk/IndexSearch/Makefile.am	2008-04-29 12:57:49 UTC (rev 1234)
+++ trunk/IndexSearch/Makefile.am	2008-05-03 06:06:48 UTC (rev 1235)
@@ -111,6 +111,7 @@
 	-I$(top_srcdir)/Tokenize \
 	-I$(top_srcdir)/Tokenize/filters \
 	-I$(top_srcdir)/Collect \
+	-I$(top_srcdir)/IndexSearch/cjkv \
 	-I$(top_srcdir)/IndexSearch/Google \
 	-I$(top_srcdir)/IndexSearch/xesam \
 	@HTTP_CFLAGS@ @XML_CFLAGS@ @SOAP_CFLAGS@ \

Modified: trunk/IndexSearch/Xapian/Makefile.am
===================================================================
--- trunk/IndexSearch/Xapian/Makefile.am	2008-04-29 12:57:49 UTC (rev 1234)
+++ trunk/IndexSearch/Xapian/Makefile.am	2008-05-03 06:06:48 UTC (rev 1235)
@@ -7,7 +7,6 @@
 	XapianDatabaseFactory.h \
 	XapianIndex.h \
 	XapianEngine.h \
-	$(top_srcdir)/IndexSearch/cjkv/CJKVTokenizer.h \
 	$(top_srcdir)/IndexSearch/xesam/XapianQueryBuilder.h \
 	$(top_srcdir)/IndexSearch/xesam/XesamParser.h \
 	$(top_srcdir)/IndexSearch/xesam/XesamQLParser.h \
@@ -24,7 +23,6 @@
 	XapianDatabaseFactory.cpp \
 	XapianIndex.cpp \
 	XapianEngine.cpp \
-	$(top_srcdir)/IndexSearch/cjkv/CJKVTokenizer.cc \
 	$(top_srcdir)/IndexSearch/xesam/XapianQueryBuilder.cc \
 	$(top_srcdir)/IndexSearch/xesam/XesamQLParser.cc \
 	$(top_srcdir)/IndexSearch/xesam/XesamQueryBuilder.cc

Modified: trunk/Tokenize/Makefile.am
===================================================================
--- trunk/Tokenize/Makefile.am	2008-04-29 12:57:49 UTC (rev 1234)
+++ trunk/Tokenize/Makefile.am	2008-05-03 06:06:48 UTC (rev 1235)
@@ -3,7 +3,8 @@
 noinst_HEADERS = \
 	FilterUtils.h \
 	TextConverter.h \
-	Tokenizer.h \
+	$(top_srcdir)/IndexSearch/cjkv/CJKVTokenizer.h \
+	$(top_srcdir)/Tokenize/filters/ExifImageFilter.h \
 	$(top_srcdir)/Tokenize/filters/ExternalFilter.h \
 	$(top_srcdir)/Tokenize/filters/Filter.h \
 	$(top_srcdir)/Tokenize/filters/FilterFactory.h \
@@ -13,10 +14,18 @@
 	$(top_srcdir)/Tokenize/filters/TextFilter.h \
 	$(top_srcdir)/Tokenize/filters/XmlFilter.h
 
-lib_LTLIBRARIES = libexternalfilter.la libmboxfilter.la libtaglibfilter.la
+lib_LTLIBRARIES = libexifimagefilter.la libexternalfilter.la libmboxfilter.la libtaglibfilter.la
 
 noinst_LTLIBRARIES = libTokenize.la
 
+libexifimagefilter_la_SOURCES = \
+	$(top_srcdir)/Tokenize/filters/Filter.cc \
+	$(top_srcdir)/Tokenize/filters/ExifImageFilter.cc
+
+libexifimagefilter_la_LDFLAGS = -module @EXIF_LIBS@
+
+libexifimagefilter_la_LIBADD =
+
 libexternalfilter_la_SOURCES = \
 	$(top_srcdir)/Tokenize/filters/Filter.cc \
 	$(top_srcdir)/Tokenize/filters/ExternalFilter.cc
@@ -44,7 +53,7 @@
 libTokenize_la_SOURCES = \
 	FilterUtils.cpp \
 	TextConverter.cpp \
-	Tokenizer.cpp \
+	$(top_srcdir)/IndexSearch/cjkv/CJKVTokenizer.cc \
 	$(top_srcdir)/Tokenize/filters/Filter.cc \
 	$(top_srcdir)/Tokenize/filters/FilterFactory.cc \
 	$(top_srcdir)/Tokenize/filters/HtmlFilter.cc \
@@ -54,6 +63,7 @@
 AM_CXXFLAGS = \
 	-fPIC \
 	-I$(top_srcdir)/Utils -Ifilters \
-	@GMIME_CFLAGS@ @XML_CFLAGS@ @TAGLIB_CFLAGS@ -D_DYNAMIC_DIJON_FILTERS \
+	@GMIME_CFLAGS@ @XML_CFLAGS@ @EXIF_CFLAGS@ @TAGLIB_CFLAGS@ \
+	-D_DYNAMIC_DIJON_FILTERS \
 	-D_DIJON_EXTERNALFILTER_CONFFILE=\"$(sysconfdir)/pinot/external-filters.xml\"
 

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2008-04-29 12:57:49 UTC (rev 1234)
+++ trunk/configure.in	2008-05-03 06:06:48 UTC (rev 1235)
@@ -26,7 +26,7 @@
 		[the gettext domain])
 
 dnl Add the languages which your application supports here.
-ALL_LINGUAS="de es fr it nl pt pt_BR ru sv zh_CN zh_TW"
+ALL_LINGUAS="de es fr it ja nl pt pt_BR ru sv zh_CN zh_TW"
 #AM_GNU_GETTEXT([external]) 
 AM_GLIB_GNU_GETTEXT
 
@@ -262,6 +262,9 @@
 AC_SUBST(SHARED_MIME_INFO_PREFIX)
 AC_DEFINE_UNQUOTED(SHARED_MIME_INFO_PREFIX,"$SHARED_MIME_INFO_PREFIX",
     [the shared-mime-info prefix])
+PKG_CHECK_MODULES(EXIF, libexif >= 0.6 )
+AC_SUBST(EXIF_CFLAGS)
+AC_SUBST(EXIF_LIBS)
 PKG_CHECK_MODULES(TAGLIB, taglib >= 1.4 )
 AC_SUBST(TAGLIB_CFLAGS)
 AC_SUBST(TAGLIB_LIBS)

Added: trunk/po/ja.po
===================================================================
--- trunk/po/ja.po	2008-04-29 12:57:49 UTC (rev 1234)
+++ trunk/po/ja.po	2008-05-03 06:06:48 UTC (rev 1235)
@@ -0,0 +1,988 @@
+# Japanese translation for pinot
+# Copyright (c) 2008 Rosetta Contributors and Canonical Ltd 2008
+# This file is distributed under the same license as the pinot package.
+# FIRST AUTHOR <EMAIL at ADDRESS>, 2008.
+#
+msgid ""
+msgstr ""
+"Project-Id-Version: pinot\n"
+"Report-Msgid-Bugs-To: \n"
+"POT-Creation-Date: 2008-04-26 09:55+0800\n"
+"PO-Revision-Date: 2008-04-14 04:25+0000\n"
+"Last-Translator: Takeo Mizuki <Unknown>\n"
+"Language-Team: Japanese <ja at li.org>\n"
+"MIME-Version: 1.0\n"
+"Content-Type: text/plain; charset=UTF-8\n"
+"Content-Transfer-Encoding: 8bit\n"
+"X-Launchpad-Export-Date: 2008-04-24 13:56+0000\n"
+"X-Generator: Launchpad (build Unknown)\n"
+
+#: UI/GTK2/src/EnginesTree.cpp:68 UI/GTK2/src/statisticsDialog.cc:89
+msgid "Search Engines"
+msgstr "??????"
+
+#: UI/GTK2/src/EnginesTree.cpp:326
+msgid "Current User"
+msgstr "???????"
+
+#. Enable these menu items unless it is not the documents index
+#. Add a row to the index tree
+#. Allow this only for internal indexes
+#. Internal indices
+#: UI/GTK2/src/EnginesTree.cpp:337 UI/GTK2/src/mainWindow.cc:760
+#: UI/GTK2/src/mainWindow.cc:984 UI/GTK2/src/mainWindow.cc:1283
+#: UI/GTK2/src/mainWindow.cc:1504 UI/GTK2/src/mainWindow.cc:1540
+#: UI/GTK2/src/mainWindow.cc:1562 UI/GTK2/src/mainWindow.cc:2273
+#: UI/GTK2/src/PinotSettings.cpp:322 UI/GTK2/src/PinotSettings.cpp:1470
+#: UI/GTK2/src/PinotSettings.cpp:1526 UI/GTK2/src/statisticsDialog.cc:79
+#: UI/GTK2/src/WorkerThreads.cpp:1019
+msgid "My Web Pages"
+msgstr "????????"
+
+#. Spawn new threads
+#: UI/GTK2/src/EnginesTree.cpp:338 UI/GTK2/src/mainWindow.cc:763
+#: UI/GTK2/src/mainWindow.cc:978 UI/GTK2/src/mainWindow.cc:1287
+#: UI/GTK2/src/mainWindow.cc:2277 UI/GTK2/src/PinotSettings.cpp:323
+#: UI/GTK2/src/PinotSettings.cpp:1471 UI/GTK2/src/PinotSettings.cpp:1527
+#: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:1029
+msgid "My Documents"
+msgstr "????????"
+
+#: UI/GTK2/src/indexDialog.cc:122
+msgid "Served by"
+msgstr ""
+
+#: UI/GTK2/src/indexDialog.cc:124
+msgid "Local"
+msgstr "????"
+
+#: UI/GTK2/src/indexDialog.cc:286
+msgid "Index location"
+msgstr "????????????"
+
+#: UI/GTK2/src/indexDialog_glade.cc:64 UI/GTK2/src/queryDialog_glade.cc:67
+msgid "Name:"
+msgstr "??:"
+
+#: UI/GTK2/src/indexDialog_glade.cc:66
+msgid "..."
+msgstr "..."
+
+#: UI/GTK2/src/indexDialog_glade.cc:69 UI/GTK2/src/prefsDialog_glade.cc:84
+msgid "Type:"
+msgstr "???:"
+
+#: UI/GTK2/src/indexDialog_glade.cc:70 UI/GTK2/src/importDialog_glade.cc:65
+msgid "Location:"
+msgstr "??:"
+
+#: UI/GTK2/src/indexDialog_glade.cc:71 UI/GTK2/src/prefsDialog_glade.cc:85
+msgid "Port:"
+msgstr "?????:"
+
+#: UI/GTK2/src/indexDialog_glade.cc:78 UI/GTK2/src/prefsDialog_glade.cc:81
+msgid "Address:"
+msgstr "????:"
+
+#: UI/GTK2/src/indexDialog_glade.cc:182
+msgid "External index"
+msgstr "????????"
+
+#. Stemming language
+#. Labels
+#: UI/GTK2/src/importDialog.cc:73 UI/GTK2/src/queryDialog.cc:140
+#: UI/GTK2/src/queryDialog.cc:156
+msgid "None"
+msgstr "??"
+
+#: UI/GTK2/src/importDialog_glade.cc:66
+#: UI/GTK2/src/propertiesDialog_glade.cc:63
+msgid "Title:"
+msgstr "????:"
+
+#: UI/GTK2/src/importDialog_glade.cc:69
+msgid "Apply label:"
+msgstr "?????"
+
+#: UI/GTK2/src/importDialog_glade.cc:132 UI/GTK2/src/mainWindow_glade.cc:215
+msgid "Import URL"
+msgstr "URL?????"
+
+#: UI/GTK2/src/IndexPage.cpp:50
+msgid "Show Previous"
+msgstr "????"
+
+#: UI/GTK2/src/IndexPage.cpp:56
+msgid "Show Next"
+msgstr "????"
+
+#: UI/GTK2/src/IndexPage.cpp:188
+msgid "All"
+msgstr "???"
+
+#: UI/GTK2/src/launcherDialog_glade.cc:63
+msgid ""
+"There is no helper application defined for this document's type.\n"
+"Please enter the command to open this document."
+msgstr ""
+"???????????????????????????????????\n"
+"?????????????????????"
+
+#: UI/GTK2/src/launcherDialog_glade.cc:66
+msgid "Use this command for other documents of the same type."
+msgstr "????????????????????????"
+
+#: UI/GTK2/src/launcherDialog_glade.cc:98
+msgid "Helper application"
+msgstr "????????????"
+
+#: UI/GTK2/src/mainWindow.cc:166
+msgid "Query Name"
+msgstr "?????"
+
+#: UI/GTK2/src/mainWindow.cc:171
+msgid "Last Run"
+msgstr "?????"
+
+#: UI/GTK2/src/mainWindow.cc:176
+msgid "Summary"
+msgstr "??"
+
+#. Set tooltips
+#: UI/GTK2/src/mainWindow.cc:206
+msgid "Show all search engines"
+msgstr "????????????"
+
+#: UI/GTK2/src/mainWindow.cc:207
+msgid "Find documents that match the query string"
+msgstr "?????????????????"
+
+#: UI/GTK2/src/mainWindow.cc:208
+msgid "Add an index"
+msgstr "????????"
+
+#: UI/GTK2/src/mainWindow.cc:209
+msgid "Remove an index"
+msgstr "????????"
+
+#: UI/GTK2/src/mainWindow.cc:210
+msgid "Add a query"
+msgstr "??????"
+
+#: UI/GTK2/src/mainWindow.cc:211
+msgid "Remove a query"
+msgstr "??????"
+
+#: UI/GTK2/src/mainWindow.cc:212
+msgid "Show the query's previous results"
+msgstr "????????????"
+
+#: UI/GTK2/src/mainWindow.cc:213
+msgid "Find documents that match the query"
+msgstr "??????????????"
+
+#. Now we are ready
+#: UI/GTK2/src/mainWindow.cc:232
+msgid "Ready"
+msgstr "????"
+
+#: UI/GTK2/src/mainWindow.cc:244
+#, fuzzy
+msgid "Updating all documents in My Web Pages is recommended"
+msgstr "?????????????????????????????"
+
+#: UI/GTK2/src/mainWindow.cc:252
+msgid "Don't warn me again"
+msgstr "???????????"
+
+#: UI/GTK2/src/mainWindow.cc:260 UI/GTK2/src/mainWindow_glade.cc:224
+msgid "Update"
+msgstr "??"
+
+#: UI/GTK2/src/mainWindow.cc:314
+msgid "N/A"
+msgstr "N/A"
+
+#: UI/GTK2/src/mainWindow.cc:329
+msgid "Undefined"
+msgstr "???"
+
+#. Find this query
+#: UI/GTK2/src/mainWindow.cc:552 UI/GTK2/src/mainWindow.cc:2662
+msgid "Live query"
+msgstr "???????"
+
+#. Show the URL of the first result in the status bar
+#: UI/GTK2/src/mainWindow.cc:692
+msgid "Result location is"
+msgstr "??:"
+
+#. Show the URL in the status bar
+#: UI/GTK2/src/mainWindow.cc:774
+msgid "Document location is"
+msgstr "??????:"
+
+#: UI/GTK2/src/mainWindow.cc:960 UI/GTK2/src/mainWindow.cc:2098
+msgid "Couldn't find query"
+msgstr "?????????????"
+
+#: UI/GTK2/src/mainWindow.cc:974
+msgid "In Results"
+msgstr "??"
+
+#: UI/GTK2/src/mainWindow.cc:1167
+msgid "Showing"
+msgstr "???"
+
+#: UI/GTK2/src/mainWindow.cc:1172
+msgid "of"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:1177
+msgid "documents, starting at"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:1219
+msgid "Query"
+msgstr "????"
+
+#: UI/GTK2/src/mainWindow.cc:1223 UI/GTK2/src/mainWindow.cc:3259
+msgid "on"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:1227
+msgid "ended"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:1233
+msgid "Corrected"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:1387
+msgid "More Like"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:1430
+#, fuzzy
+msgid "Updated label(s)"
+msgstr "???????????"
+
+#. Yes, it did
+#: UI/GTK2/src/mainWindow.cc:1514 UI/GTK2/src/mainWindow.cc:1602
+#, fuzzy
+msgid "Updated document"
+msgstr "??????????"
+
+#: UI/GTK2/src/mainWindow.cc:1527
+#, fuzzy
+msgid "Indexed"
+msgstr "??????"
+
+#: UI/GTK2/src/mainWindow.cc:1563
+msgid "Unindexed document(s)"
+msgstr "??????????????"
+
+#: UI/GTK2/src/mainWindow.cc:1660
+msgid "Couldn't rename index, name"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:1664 UI/GTK2/src/mainWindow.cc:2488
+#: UI/GTK2/src/mainWindow.cc:3060
+msgid "is already in use"
+msgstr "??????????"
+
+#: UI/GTK2/src/mainWindow.cc:1677
+msgid "Couldn't rename index"
+msgstr "????????????????"
+
+#: UI/GTK2/src/mainWindow.cc:1690
+#, fuzzy
+msgid "Edited index"
+msgstr "?????????"
+
+#: UI/GTK2/src/mainWindow.cc:2018
+msgid "Export Results"
+msgstr "?????????"
+
+#: UI/GTK2/src/mainWindow.cc:2290
+msgid "Index"
+msgstr "??????"
+
+#: UI/GTK2/src/mainWindow.cc:2294
+#, fuzzy
+msgid "doesn't exist"
+msgstr "??????"
+
+#: UI/GTK2/src/mainWindow.cc:2372
+msgid "Remove this document from the index ?"
+msgstr "????????????????????"
+
+#: UI/GTK2/src/mainWindow.cc:2391
+#, fuzzy
+msgid "Remove these documents from the index ?"
+msgstr "??????????????????????"
+
+#: UI/GTK2/src/mainWindow.cc:2396 UI/GTK2/src/mainWindow_glade.cc:227
+msgid "Unindex"
+msgstr "????????"
+
+#: UI/GTK2/src/mainWindow.cc:2438
+msgid "A metasearch tool for the Free Desktop"
+msgstr "???????????????????"
+
+#: UI/GTK2/src/mainWindow.cc:2439
+msgid "Search the Web and your documents !"
+msgstr "????????????????!"
+
+#: UI/GTK2/src/mainWindow.cc:2484
+msgid "Index name"
+msgstr "???????"
+
+#: UI/GTK2/src/mainWindow.cc:2499
+msgid "Couldn't add index"
+msgstr "??????????????"
+
+#: UI/GTK2/src/mainWindow.cc:2515
+#, fuzzy
+msgid "Added new index"
+msgstr "???????????"
+
+#: UI/GTK2/src/mainWindow.cc:2550
+msgid "Couldn't remove index"
+msgstr "??????????????"
+
+#: UI/GTK2/src/mainWindow.cc:2755
+msgid "No history for"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:2871
+msgid "At least one task hasn't completed yet. Quit now ?"
+msgstr ""
+"?????????????????????????????????????"
+
+#: UI/GTK2/src/mainWindow.cc:2873
+msgid "Quit"
+msgstr "??"
+
+#: UI/GTK2/src/mainWindow.cc:3056
+msgid "Query name"
+msgstr "?????"
+
+#: UI/GTK2/src/mainWindow.cc:3083
+msgid "Couldn't update query"
+msgstr "????????????"
+
+#: UI/GTK2/src/mainWindow.cc:3094
+#, fuzzy
+msgid "Edited query"
+msgstr "?????????"
+
+#: UI/GTK2/src/mainWindow.cc:3101
+msgid "Couldn't add query"
+msgstr "????????????"
+
+#: UI/GTK2/src/mainWindow.cc:3109
+#, fuzzy
+msgid "Added new query"
+msgstr "?????????"
+
+#: UI/GTK2/src/mainWindow.cc:3148
+msgid "Query is not set"
+msgstr "??????????????"
+
+#: UI/GTK2/src/mainWindow.cc:3159
+msgid "No search engine selected"
+msgstr "????????????????"
+
+#: UI/GTK2/src/mainWindow.cc:3246
+msgid "Please set the Google API key first"
+msgstr "????Google API???????????"
+
+#: UI/GTK2/src/mainWindow.cc:3255
+msgid "Running query"
+msgstr "????????"
+
+#: UI/GTK2/src/mainWindow.cc:3465
+msgid "No default application defined for type"
+msgstr "??????????????????????????????"
+
+#: UI/GTK2/src/mainWindow_glade.cc:126
+msgid "Query:"
+msgstr "????:"
+
+#: UI/GTK2/src/mainWindow_glade.cc:137 UI/GTK2/src/statisticsDialog.cc:102
+msgid "History"
+msgstr "??"
+
+#: UI/GTK2/src/mainWindow_glade.cc:142
+#, fuzzy
+msgid "Stored queries"
+msgstr "?????????"
+
+#: UI/GTK2/src/mainWindow_glade.cc:155 UI/GTK2/src/statisticsDialog.cc:50
+#: UI/GTK2/src/statisticsDialog_glade.cc:86
+msgid "Status"
+msgstr "?????"
+
+#: UI/GTK2/src/mainWindow_glade.cc:176
+msgid "Search Engine"
+msgstr "??????"
+
+#: UI/GTK2/src/mainWindow_glade.cc:179
+msgid "Host Name"
+msgstr "????"
+
+#: UI/GTK2/src/mainWindow_glade.cc:182
+msgid "Show Extract"
+msgstr "??????"
+
+#: UI/GTK2/src/mainWindow_glade.cc:185
+msgid "Group By"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow_glade.cc:191
+msgid "Clear List"
+msgstr "???????"
+
+#: UI/GTK2/src/mainWindow_glade.cc:197
+msgid "Vie_w"
+msgstr "??(_w)"
+
+#: UI/GTK2/src/mainWindow_glade.cc:200
+msgid "View Cache"
+msgstr "???????"
+
+#: UI/GTK2/src/mainWindow_glade.cc:203
+msgid "More Like This"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow_glade.cc:206
+msgid "Search This For"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow_glade.cc:209 UI/GTK2/src/mainWindow_glade.cc:245
+msgid "_Index"
+msgstr "??????(_I)"
+
+#: UI/GTK2/src/mainWindow_glade.cc:212
+msgid "List Contents Of"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow_glade.cc:221
+msgid "View"
+msgstr "??"
+
+#: UI/GTK2/src/mainWindow_glade.cc:230
+#: UI/GTK2/src/propertiesDialog_glade.cc:224
+msgid "Properties"
+msgstr "?????"
+
+#: UI/GTK2/src/mainWindow_glade.cc:233
+msgid "_About"
+msgstr "??(_A)"
+
+#: UI/GTK2/src/mainWindow_glade.cc:236
+msgid "_Session"
+msgstr "?????(_S)"
+
+#: UI/GTK2/src/mainWindow_glade.cc:239
+msgid "_Edit"
+msgstr "??(_E)"
+
+#: UI/GTK2/src/mainWindow_glade.cc:242
+msgid "_Results"
+msgstr "??(_R)"
+
+#: UI/GTK2/src/mainWindow_glade.cc:248
+msgid "_Help"
+msgstr "???(_H)"
+
+#: UI/GTK2/src/mainWindow_glade.cc:377
+msgid "Pinot"
+msgstr "Pinot"
+
+#. Localize language names
+#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:492
+msgid "Unknown"
+msgstr "??"
+
+#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:493
+msgid "Danish"
+msgstr "??????"
+
+#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:494
+msgid "Dutch"
+msgstr "?????"
+
+#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:495
+msgid "English"
+msgstr "??"
+
+#: UI/GTK2/src/pinot.cc:240 UI/GTK2/src/pinot-dbus-daemon.cc:496
+msgid "Finnish"
+msgstr "????"
+
+#: UI/GTK2/src/pinot.cc:241 UI/GTK2/src/pinot-dbus-daemon.cc:497
+msgid "French"
+msgstr "?????"
+
+#: UI/GTK2/src/pinot.cc:242 UI/GTK2/src/pinot-dbus-daemon.cc:498
+msgid "German"
+msgstr "????"
+
+#: UI/GTK2/src/pinot.cc:243 UI/GTK2/src/pinot-dbus-daemon.cc:499
+#, fuzzy
+msgid "Hungarian"
+msgstr "??????"
+
+#: UI/GTK2/src/pinot.cc:244 UI/GTK2/src/pinot-dbus-daemon.cc:500
+msgid "Italian"
+msgstr "?????"
+
+#: UI/GTK2/src/pinot.cc:245 UI/GTK2/src/pinot-dbus-daemon.cc:501
+msgid "Norwegian"
+msgstr "??????"
+
+#: UI/GTK2/src/pinot.cc:246 UI/GTK2/src/pinot-dbus-daemon.cc:502
+msgid "Portuguese"
+msgstr "??????"
+
+#: UI/GTK2/src/pinot.cc:247 UI/GTK2/src/pinot-dbus-daemon.cc:503
+msgid "Romanian"
+msgstr "??????"
+
+#: UI/GTK2/src/pinot.cc:248 UI/GTK2/src/pinot-dbus-daemon.cc:504
+msgid "Russian"
+msgstr "????"
+
+#: UI/GTK2/src/pinot.cc:249 UI/GTK2/src/pinot-dbus-daemon.cc:505
+msgid "Spanish"
+msgstr "?????"
+
+#: UI/GTK2/src/pinot.cc:250 UI/GTK2/src/pinot-dbus-daemon.cc:506
+msgid "Swedish"
+msgstr "???????"
+
+#: UI/GTK2/src/pinot.cc:251 UI/GTK2/src/pinot-dbus-daemon.cc:507
+msgid "Turkish"
+msgstr "????"
+
+#: UI/GTK2/src/pinot.cc:271
+msgid "Couldn't open index"
+msgstr "????????????"
+
+#: UI/GTK2/src/pinot.cc:292
+msgid "Couldn't create history database"
+msgstr "????????????????"
+
+#. Add default labels
+#: UI/GTK2/src/PinotSettings.cpp:328
+msgid "Important"
+msgstr "??"
+
+#: UI/GTK2/src/PinotSettings.cpp:329
+#, fuzzy
+msgid "New"
+msgstr "????"
+
+#: UI/GTK2/src/PinotSettings.cpp:330
+#, fuzzy
+msgid "Personal"
+msgstr "???"
+
+#: UI/GTK2/src/PinotSettings.cpp:350
+msgid "Me"
+msgstr ""
+
+#: UI/GTK2/src/PinotSettings.cpp:1266
+msgid "Unclassified"
+msgstr "???"
+
+#: UI/GTK2/src/prefsDialog.cc:83
+msgid "Name"
+msgstr "??"
+
+#: UI/GTK2/src/prefsDialog.cc:91
+msgid "Monitor"
+msgstr "????"
+
+#: UI/GTK2/src/prefsDialog.cc:92
+#, fuzzy
+msgid "Location"
+msgstr "??"
+
+#: UI/GTK2/src/prefsDialog.cc:100
+msgid "Pattern"
+msgstr "????"
+
+#: UI/GTK2/src/prefsDialog.cc:333
+msgid "Exclude these patterns from indexing"
+msgstr "???????????????????"
+
+#: UI/GTK2/src/prefsDialog.cc:334
+msgid "Only index these patterns"
+msgstr "???????????????????"
+
+#: UI/GTK2/src/prefsDialog.cc:483
+msgid "New Label"
+msgstr "?????"
+
+#: UI/GTK2/src/prefsDialog.cc:524
+#, fuzzy
+msgid "Directory to index"
+msgstr "??????????????????"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:65
+msgid "Google API key:"
+msgstr "Google API??:"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:68
+msgid "New results:"
+msgstr "????:"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:69
+msgid "Queries:"
+msgstr "????:"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:70
+msgid "Enable search terms suggestion"
+msgstr ""
+
+#: UI/GTK2/src/prefsDialog_glade.cc:72
+msgid "Ignore robots.txt and Robots META tag"
+msgstr "robots.txt?????????????"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:73
+msgid "HTTP crawling:"
+msgstr "HTTP??????"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:76
+msgid "General"
+msgstr "??"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:78
+msgid "Direct connection to the Internet"
+msgstr "????????????"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:79
+msgid "Manual proxy configuration:"
+msgstr "????????"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:92
+msgid "Network"
+msgstr "??????"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:93
+msgid "Labels are used to classify indexed documents:"
+msgstr ""
+
+#: UI/GTK2/src/prefsDialog_glade.cc:98 UI/GTK2/src/prefsDialog_glade.cc:118
+#: UI/GTK2/src/prefsDialog_glade.cc:134
+msgid "Add"
+msgstr "??"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:104
+msgid "Remove"
+msgstr "??"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:112 UI/GTK2/src/propertiesDialog.cc:56
+msgid "Labels"
+msgstr "???"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:113
+msgid "These directories will be indexed and optionally monitored for changes:"
+msgstr ""
+
+#: UI/GTK2/src/prefsDialog_glade.cc:126
+msgid "File patterns:"
+msgstr "????????:"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:139
+#, fuzzy
+msgid "Reset"
+msgstr "??(_R)"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:144
+#, fuzzy
+msgid "Indexing"
+msgstr "??????????"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:512
+msgid "Preferences"
+msgstr "??"
+
+#: UI/GTK2/src/propertiesDialog.cc:105
+msgid "Per document"
+msgstr ""
+
+#: UI/GTK2/src/propertiesDialog.cc:365
+#, fuzzy
+msgid "Export Terms"
+msgstr "????????"
+
+#: UI/GTK2/src/propertiesDialog_glade.cc:64
+msgid "Language:"
+msgstr "??:"
+
+#: UI/GTK2/src/propertiesDialog_glade.cc:65
+msgid "MIME type:"
+msgstr "MIME ???:"
+
+#: UI/GTK2/src/propertiesDialog_glade.cc:66
+msgid "Size:"
+msgstr "???:"
+
+#: UI/GTK2/src/propertiesDialog_glade.cc:67
+#, fuzzy
+msgid "Terms:"
+msgstr "??:"
+
+#: UI/GTK2/src/propertiesDialog_glade.cc:77
+msgid "bytes"
+msgstr "???"
+
+#: UI/GTK2/src/queryDialog.cc:110
+msgid "Host name"
+msgstr "????"
+
+#: UI/GTK2/src/queryDialog.cc:111
+msgid "File name"
+msgstr "?????"
+
+#: UI/GTK2/src/queryDialog.cc:112
+msgid "File extension"
+msgstr "???????"
+
+#. This is the title column
+#: UI/GTK2/src/queryDialog.cc:113 UI/GTK2/src/ResultsTree.cpp:132
+msgid "Title"
+msgstr "????"
+
+#. URL
+#: UI/GTK2/src/queryDialog.cc:114 UI/GTK2/src/ResultsTree.cpp:142
+msgid "URL"
+msgstr "URL"
+
+#: UI/GTK2/src/queryDialog.cc:115
+msgid "Directory"
+msgstr "??????"
+
+#: UI/GTK2/src/queryDialog.cc:116
+msgid "Language code"
+msgstr "?????"
+
+#: UI/GTK2/src/queryDialog.cc:117
+msgid "MIME type"
+msgstr "MIME???"
+
+#: UI/GTK2/src/queryDialog.cc:118
+msgid "MIME class"
+msgstr "MIME???"
+
+#: UI/GTK2/src/queryDialog.cc:119
+msgid "Label"
+msgstr "???"
+
+#. The last column is for the timestamp
+#: UI/GTK2/src/queryDialog.cc:122 UI/GTK2/src/ResultsTree.cpp:150
+msgid "Date"
+msgstr "??"
+
+#: UI/GTK2/src/queryDialog.cc:123
+#, fuzzy
+msgid "Time"
+msgstr "??"
+
+#: UI/GTK2/src/queryDialog.cc:124
+msgid "Size"
+msgstr "???"
+
+#. Sort order
+#: UI/GTK2/src/queryDialog.cc:128
+msgid "By relevance"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog.cc:129
+msgid "By date"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog_glade.cc:71
+#, fuzzy
+msgid "New filter or range:"
+msgstr "??????/??"
+
+#: UI/GTK2/src/queryDialog_glade.cc:80
+msgid "Query Text"
+msgstr "????????"
+
+#: UI/GTK2/src/queryDialog_glade.cc:82
+msgid "Index results with label"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog_glade.cc:85
+msgid "Number of results:"
+msgstr "????:"
+
+#: UI/GTK2/src/queryDialog_glade.cc:89
+msgid "Sort order:"
+msgstr "????:"
+
+#: UI/GTK2/src/queryDialog_glade.cc:93
+msgid "Stemming:"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog_glade.cc:94
+#, fuzzy
+msgid "Only index new results"
+msgstr "???????????????????"
+
+#: UI/GTK2/src/queryDialog_glade.cc:208
+msgid "Query parameters"
+msgstr "?????????"
+
+#. This is the score column
+#: UI/GTK2/src/ResultsTree.cpp:121
+msgid "Score"
+msgstr "???"
+
+#: UI/GTK2/src/ResultsTree.cpp:179
+msgid "Extract"
+msgstr "??"
+
+#: UI/GTK2/src/statisticsDialog.cc:76
+msgid "Indexes"
+msgstr "??????"
+
+#: UI/GTK2/src/statisticsDialog.cc:109
+msgid "Daemon"
+msgstr "????"
+
+#: UI/GTK2/src/statisticsDialog.cc:145 UI/GTK2/src/statisticsDialog.cc:161
+msgid "documents"
+msgstr "??"
+
+#: UI/GTK2/src/statisticsDialog.cc:151 UI/GTK2/src/statisticsDialog.cc:169
+#: UI/GTK2/src/WorkerThreads.cpp:124
+msgid "Unknown error"
+msgstr "??????"
+
+#: UI/GTK2/src/statisticsDialog.cc:176
+msgid "Viewed"
+msgstr ""
+
+#: UI/GTK2/src/statisticsDialog.cc:176
+msgid "results"
+msgstr "??"
+
+#: UI/GTK2/src/statisticsDialog.cc:182
+msgid "Crawled"
+msgstr ""
+
+#: UI/GTK2/src/statisticsDialog.cc:182
+msgid "files"
+msgstr "????"
+
+#. FIXME: check whether it's actually running !
+#: UI/GTK2/src/statisticsDialog.cc:199
+msgid "Running under PID"
+msgstr "??? PID"
+
+#: UI/GTK2/src/statisticsDialog.cc:205
+msgid "Disconnected from D-Bus"
+msgstr ""
+
+#: UI/GTK2/src/statisticsDialog.cc:209
+msgid "Stopped"
+msgstr ""
+
+#: UI/GTK2/src/statisticsDialog.cc:213
+msgid "Currently not running"
+msgstr ""
+
+#: UI/GTK2/src/statisticsDialog.cc:243
+msgid "Errors"
+msgstr "???"
+
+#: UI/GTK2/src/WorkerThreads.cpp:91
+msgid "Index error"
+msgstr "?????????"
+
+#: UI/GTK2/src/WorkerThreads.cpp:93
+msgid "Couldn't index document"
+msgstr "?????????????????"
+
+#: UI/GTK2/src/WorkerThreads.cpp:95
+msgid "Couldn't update document"
+msgstr "??????????"
+
+#: UI/GTK2/src/WorkerThreads.cpp:97
+msgid "Couldn't unindex document(s)"
+msgstr "??????????????????"
+
+#: UI/GTK2/src/WorkerThreads.cpp:99
+msgid "Couldn't run query on search engine"
+msgstr "???????????????????"
+
+#: UI/GTK2/src/WorkerThreads.cpp:101
+msgid "Couldn't get history for search engine"
+msgstr "??????????????????"
+
+#: UI/GTK2/src/WorkerThreads.cpp:103
+msgid "Couldn't retrieve document"
+msgstr "??????????"
+
+#: UI/GTK2/src/WorkerThreads.cpp:105
+msgid "File monitor error"
+msgstr "???????????"
+
+#: UI/GTK2/src/WorkerThreads.cpp:107
+msgid "Couldn't open directory"
+msgstr "????????????"
+
+#: UI/GTK2/src/WorkerThreads.cpp:109
+#, fuzzy
+msgid "Index doesn't exist"
+msgstr "?????????????"
+
+#: UI/GTK2/src/WorkerThreads.cpp:111
+msgid "Couldn't create search engine"
+msgstr "??????????????"
+
+#: UI/GTK2/src/WorkerThreads.cpp:113
+msgid "Cannot index document type"
+msgstr "????????????????????"
+
+#: UI/GTK2/src/WorkerThreads.cpp:115
+msgid "No downloader for this protocol"
+msgstr "????????????????????????"
+
+#: UI/GTK2/src/WorkerThreads.cpp:117
+msgid "Robots META tag forbids indexing"
+msgstr ""
+
+#: UI/GTK2/src/WorkerThreads.cpp:119
+msgid "No monitoring handler"
+msgstr "?????????????????"
+
+#: UI/GTK2/src/WorkerThreads.cpp:415
+#, fuzzy
+msgid "Indexing was stopped"
+msgstr "???????????????"
+
+#: UI/GTK2/src/WorkerThreads.cpp:428
+msgid "Can't index mail here"
+msgstr "??????????????????"
+
+#: UI/GTK2/src/WorkerThreads.cpp:449 UI/GTK2/src/WorkerThreads.cpp:725
+#, fuzzy
+msgid "is already being indexed"
+msgstr "??????????????????"
+
+#: UI/GTK2/src/WorkerThreads.cpp:459
+#, fuzzy
+msgid "is blacklisted"
+msgstr "?????????????????"
+
+#: UI/GTK2/src/WorkerThreads.cpp:982
+msgid "No title"
+msgstr "??????"



From fabricecolin at mail.berlios.de  Sat May  3 08:10:10 2008
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 3 May 2008 08:10:10 +0200
Subject: [Pinot-svn] r1236 - trunk
Message-ID: <200805030610.m436AAwg021824@sheep.berlios.de>

Author: fabricecolin
Date: 2008-05-03 08:10:08 +0200 (Sat, 03 May 2008)
New Revision: 1236

Modified:
   trunk/Makefile.am
Log:
David Paleino suggests removing the dependency on the m4 directory.


Modified: trunk/Makefile.am
===================================================================
--- trunk/Makefile.am	2008-05-03 06:06:48 UTC (rev 1235)
+++ trunk/Makefile.am	2008-05-03 06:10:08 UTC (rev 1236)
@@ -77,5 +77,3 @@
 	@rm -rf $(DESTDIR)$(libdir)/deskbar-applet/handlers/pinot-live.py*
 	@rm -rf $(DESTDIR)$(libdir)/deskbar-applet/modules-2.20-compatible/pinot-module.py*
 
-ACLOCAL_AMFLAGS = -I m4
-



From fabricecolin at mail.berlios.de  Sat May  3 08:13:45 2008
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 3 May 2008 08:13:45 +0200
Subject: [Pinot-svn] r1237 - in trunk/IndexSearch: . Xapian
Message-ID: <200805030613.m436Dj0R022079@sheep.berlios.de>

Author: fabricecolin
Date: 2008-05-03 08:13:44 +0200 (Sat, 03 May 2008)
New Revision: 1237

Modified:
   trunk/IndexSearch/QueryProperties.cpp
   trunk/IndexSearch/WebEngine.cpp
   trunk/IndexSearch/Xapian/XapianEngine.cpp
Log:
Rely on the CJKV TokensHandler interface to remove filters from queries and get
sets of terms (QueryProperties), highlight terms (WebEngine) and tweak mixed
CJKV queries (XapianEngine).


Modified: trunk/IndexSearch/QueryProperties.cpp
===================================================================
--- trunk/IndexSearch/QueryProperties.cpp	2008-05-03 06:10:08 UTC (rev 1236)
+++ trunk/IndexSearch/QueryProperties.cpp	2008-05-03 06:13:44 UTC (rev 1237)
@@ -22,9 +22,103 @@
 #include <algorithm>
 #include <utility>
 
-#include "Tokenizer.h"
+#include "Document.h"
+#include "CJKVTokenizer.h"
 #include "QueryProperties.h"
 
+class FilterRemover : public Dijon::CJKVTokenizer::TokensHandler
+{
+        public:
+                FilterRemover(string &freeQueryWithoutFilters,
+			unsigned int nGramSize) :
+			Dijon::CJKVTokenizer::TokensHandler(),
+			m_freeQueryWithoutFilters(freeQueryWithoutFilters),
+			m_nGramSize(nGramSize),
+			m_nGramCount(0)
+		{
+		}
+
+		virtual ~FilterRemover()
+		{
+		}
+
+		virtual bool handle_token(const string &tok, bool is_cjkv)
+		{
+			if (tok.empty() == true)
+			{
+				return false;
+			}
+
+			// Is this CJKV ?
+			if (is_cjkv == false)
+			{
+				m_nGramCount = 0;
+
+				if ((tok.find(':') != string::npos) ||
+					(tok.find("..") != string::npos))
+				{
+					// It's a filter or a range
+#ifdef DEBUG
+					cout << "QueryProperties::getFreeQuery: ignoring filter '" << tok << "'" << endl;
+#endif
+					return true;
+				}
+			}
+			else
+			{
+				++m_nGramCount;
+				if (m_nGramCount % m_nGramSize != 0)
+				{
+#ifdef DEBUG
+					cout << "QueryProperties::getFreeQuery: ignoring " << m_nGramCount << " '" << tok << "'" << endl;
+#endif
+					return true;
+				}
+			}
+#ifdef DEBUG
+			cout << "QueryProperties::getFreeQuery: keeping '" << tok << "'" << endl;
+#endif
+
+			if (m_freeQueryWithoutFilters.empty() == false)
+			{
+				m_freeQueryWithoutFilters += " ";
+			}
+			m_freeQueryWithoutFilters += tok;
+
+			return true;
+		}
+
+	protected:
+		string &m_freeQueryWithoutFilters;
+		unsigned int m_nGramSize;
+		unsigned int m_nGramCount;
+
+};
+
+class SetTokensHandler : public Dijon::CJKVTokenizer::TokensHandler
+{
+	public:
+		SetTokensHandler(set<string> &tokens) :
+			Dijon::CJKVTokenizer::TokensHandler(),
+			m_tokens(tokens)
+		{
+		}
+
+		virtual ~SetTokensHandler()
+		{
+		}
+
+		virtual bool handle_token(const string &tok, bool is_cjkv)
+		{
+			m_tokens.insert(tok);
+			return true;
+		}
+
+	protected:
+		set<string> &m_tokens;
+
+};
+
 QueryProperties::QueryProperties() :
 	m_type(XAPIAN_QP),
 	m_order(RELEVANCE),
@@ -119,27 +213,10 @@
 		return;
 	}
 
-	Document doc;
+	Dijon::CJKVTokenizer tokenizer;
+	FilterRemover handler(m_freeQueryWithoutFilters, tokenizer.get_ngram_size());
 
-	doc.setData(m_freeQuery.c_str(), m_freeQuery.length());
-	Tokenizer tokens(&doc);
-
-	string token;
-	while (tokens.nextToken(token) == true)
-	{
-		if ((token.find(':') != string::npos) ||
-			(token.find("..") != string::npos))
-		{
-			// It's a filter or a range
-			continue;
-		}
-
-		if (m_freeQueryWithoutFilters.empty() == false)
-		{
-			m_freeQueryWithoutFilters += " ";
-		}
-		m_freeQueryWithoutFilters += token;
-	}
+	tokenizer.tokenize(m_freeQuery, handler, true);
 }
 
 /// Sets the name.
@@ -262,18 +339,11 @@
 /// Returns the query's terms.
 void QueryProperties::getTerms(set<string> &terms) const
 {
-	Document doc;
+	Dijon::CJKVTokenizer tokenizer;
+	SetTokensHandler handler(terms);
 
-	doc.setData(m_freeQueryWithoutFilters.c_str(), m_freeQueryWithoutFilters.length());
-	Tokenizer tokens(&doc);
-
 	terms.clear();
-
-	string token;
-	while (tokens.nextToken(token) == true)
-	{
-		terms.insert(token);
-	}
+	tokenizer.tokenize(m_freeQueryWithoutFilters, handler);
 }
 
 /// Returns whether the query is empty.

Modified: trunk/IndexSearch/WebEngine.cpp
===================================================================
--- trunk/IndexSearch/WebEngine.cpp	2008-05-03 06:10:08 UTC (rev 1236)
+++ trunk/IndexSearch/WebEngine.cpp	2008-05-03 06:13:44 UTC (rev 1237)
@@ -28,7 +28,7 @@
 #include "HtmlFilter.h"
 #include "DownloaderFactory.h"
 #include "FilterUtils.h"
-#include "Tokenizer.h"
+#include "CJKVTokenizer.h"
 #include "WebEngine.h"
 
 using std::cout;
@@ -38,6 +38,65 @@
 using std::set;
 using std::vector;
 
+class TermHighlighter : public Dijon::CJKVTokenizer::TokensHandler
+{
+        public:
+                TermHighlighter(string &extract, set<string> &queryTerms) :
+			Dijon::CJKVTokenizer::TokensHandler(),
+			m_extract(extract),
+			m_queryTerms(queryTerms)
+		{
+		}
+
+		virtual ~TermHighlighter()
+		{
+		}
+
+		virtual bool handle_token(const string &tok, bool is_cjkv)
+		{
+			gchar *pEscToken = NULL;
+			gchar *pUTF8Token = NULL;
+			gsize bytesWritten = 0;
+
+			if (tok.empty() == true)
+			{
+				return false;
+			}
+
+			pUTF8Token = g_locale_to_utf8(tok.c_str(), tok.length(),
+				NULL, &bytesWritten, NULL);
+			if (pUTF8Token != NULL)
+			{
+				pEscToken = g_markup_escape_text(pUTF8Token, -1);
+				g_free(pUTF8Token);
+			}
+			if (pEscToken == NULL)
+			{
+				return true;
+			}
+
+			// Is this a query term ?
+			if (m_queryTerms.find(StringManip::toLowerCase(tok)) == m_queryTerms.end())
+			{
+				m_extract += pEscToken;
+			}
+			else
+			{
+				m_extract += "<b>";
+				m_extract += pEscToken;
+				m_extract += "</b>";
+			}
+			m_extract += " ";
+
+			g_free(pEscToken);
+		}
+
+	protected:
+		string &m_extract;
+		set<string> &m_queryTerms;
+
+};
+
 WebEngine::WebEngine() :
 	SearchEngineInterface(),
 	m_pDownloader(DownloaderFactory::getDownloader("http"))
@@ -182,49 +241,14 @@
 		return true;
 	}
 
-	Document doc;
-	doc.setData(extract.c_str(), extract.length());
-	Tokenizer tokens(&doc);
+	Dijon::CJKVTokenizer tokenizer;
+	TermHighlighter handler(extract, m_queryTerms);
 
+	// Highlight query terms in the extract
 	extract.clear();
+	tokenizer.tokenize(result.getExtract(), handler);
+	result.setExtract(extract);
 
-	string token;
-	while (tokens.nextToken(token) == true)
-	{
-		gchar *pEscToken = NULL;
-		gchar *pUTF8Token = NULL;
-		gsize bytesWritten = 0;
-
-		pUTF8Token = g_locale_to_utf8(token.c_str(), token.length(),
-			NULL, &bytesWritten, NULL);
-		if (pUTF8Token != NULL)
-		{
-			pEscToken = g_markup_escape_text(pUTF8Token, -1);
-			g_free(pUTF8Token);
-		}
-		if (pEscToken == NULL)
-		{
-			continue;
-		}
-
-		// Is this a query term ?
-		if (m_queryTerms.find(StringManip::toLowerCase(token)) == m_queryTerms.end())
-		{
-			extract += pEscToken;
-		}
-		else
-		{
-			extract += "<b>";
-			extract += pEscToken;
-			extract += "</b>";
-		}
-		extract += " ";
-
-		g_free(pEscToken);
-
-		result.setExtract(extract);
-	}
-
 	return true;
 }
 

Modified: trunk/IndexSearch/Xapian/XapianEngine.cpp
===================================================================
--- trunk/IndexSearch/Xapian/XapianEngine.cpp	2008-05-03 06:10:08 UTC (rev 1236)
+++ trunk/IndexSearch/Xapian/XapianEngine.cpp	2008-05-03 06:13:44 UTC (rev 1237)
@@ -153,6 +153,172 @@
 
 };
 
+class QueryModifier : public Dijon::CJKVTokenizer::TokensHandler
+{
+	public:
+		typedef enum { NONE = 0, BRACKETS } CJKVWrap;
+
+		QueryModifier(const string &query, unsigned int nGramSize) :
+			m_query(query),
+			m_pos(0),
+			m_wrap(BRACKETS),
+			m_nGramCount(0),
+			m_nGramSize(nGramSize)
+		{
+		}
+
+		virtual ~QueryModifier()
+		{
+		}
+
+		virtual bool handle_token(const string &tok, bool is_cjkv)
+		{
+			if (tok.empty() == true)
+			{
+				return false;
+			}
+#ifdef DEBUG
+			cout << "QueryModifier::handle_token: " << tok << endl;
+#endif
+
+			// Where is this token in the original query ?
+			string::size_type tokPos = m_query.find(tok, m_pos);
+
+			// Is this CJKV ?
+			if (is_cjkv == false)
+			{
+				char lastChar = tok[tok.length() - 1];
+
+				if (tokPos == string::npos)
+				{
+					// This should have been found
+					return false;
+				}
+
+				if (m_nGramCount > 0)
+				{
+					wrapClose();
+
+					m_nGramCount = 0;
+					m_pos = tokPos;
+				}
+
+				m_currentFilter.clear();
+				if (lastChar == '"')
+				{
+					// It's a quoted string
+					m_wrap = NONE;
+				}
+				else if (lastChar == ':')
+				{
+					// It's a filter
+					m_wrap = NONE;
+					m_currentFilter = tok;
+#ifdef DEBUG
+					cout << "QueryModifier::handle_token: in filter" << endl;
+#endif
+				}
+				else
+				{
+#ifdef DEBUG
+					cout << "QueryModifier::handle_token: in brackets" << endl;
+#endif
+					m_wrap = BRACKETS;
+				}
+
+				// Return right away
+				return true;
+			}
+
+			// First n-gram ?
+#ifdef DEBUG
+			cout << "QueryModifier::handle_token: " << m_nGramCount << " n-gram" << endl;
+#endif
+			if (m_nGramCount == 0)
+			{
+				if (tokPos == string::npos)
+				{
+					// That's definitely not right
+					return false;
+				}
+
+				// Append non-CJKV text that precedes and start wrapping CJKV tokens
+				if (tokPos > m_pos)
+				{
+					m_modifiedQuery += " " + m_query.substr(m_pos, tokPos - m_pos);
+				}
+				switch (m_wrap)
+				{
+					case BRACKETS:
+						m_modifiedQuery += " (";
+						break;
+					case NONE:
+					default:
+						break;
+				}
+			}
+			else
+			{
+				m_modifiedQuery += " ";
+				if (m_currentFilter.empty() == false)
+				{
+					m_modifiedQuery += m_currentFilter;
+				}
+			}
+			m_modifiedQuery += tok;
+#ifdef DEBUG
+			cout << "QueryModifier::handle_token: " << m_modifiedQuery << endl;
+#endif
+
+			++m_nGramCount;
+			if ((m_nGramCount % m_nGramSize == 0) &&
+				(tokPos != string::npos))
+			{
+				m_pos = tokPos + tok.length();
+			}
+
+			return true;
+		}
+
+		string get_modified_query(void)
+		{
+			if (m_pos < m_query.length())
+			{
+				m_modifiedQuery += " " + m_query.substr(m_pos);
+			}
+			wrapClose();
+#ifdef DEBUG
+			cout << "QueryModifier::get_modified_query: " << m_modifiedQuery << endl;
+#endif
+
+			return m_modifiedQuery;
+		}
+
+	protected:
+		string m_query;
+		string m_modifiedQuery;
+		string::size_type m_pos;
+		CJKVWrap m_wrap;
+		string m_currentFilter;
+		unsigned int m_nGramCount;
+		unsigned int m_nGramSize;
+
+		void wrapClose(void)
+		{
+			// Finish wrapping CJKV tokens
+			switch (m_wrap)
+			{
+				case BRACKETS:
+					m_modifiedQuery += ')';
+					break;
+				case NONE:
+				default:
+					break;
+			}
+		}
+
+};
+
 XapianEngine::XapianEngine(const string &database) :
 	SearchEngineInterface()
 {
@@ -182,20 +348,13 @@
 	unsigned int minDay, minMonth, minYear = 0;
 	unsigned int maxDay, maxMonth, maxYear = 0;
 
-	if (tokenizer.has_cjkv_only(freeQuery) == true)
+	if (tokenizer.has_cjkv(freeQuery) == true)
 	{
-		vector<string> tokens;
-		string cjkvQuery;
+		QueryModifier handler(freeQuery, tokenizer.get_ngram_size());
 
-		tokenizer.tokenize(freeQuery, tokens);
+		tokenizer.tokenize(freeQuery, handler, true);
 
-		// Get the terms
-		for (vector<string>::const_iterator tokenIter = tokens.begin();
-			tokenIter != tokens.end(); ++tokenIter)
-		{
-			cjkvQuery += *tokenIter;
-			cjkvQuery += " ";
-		}
+		string cjkvQuery(handler.get_modified_query());
 #ifdef DEBUG
 		cout << "XapianEngine::parseQuery: CJKV query is " << cjkvQuery << endl;
 #endif



From fabricecolin at mail.berlios.de  Sat May  3 08:17:11 2008
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 3 May 2008 08:17:11 +0200
Subject: [Pinot-svn] r1238 - trunk
Message-ID: <200805030617.m436HBgx022413@sheep.berlios.de>

Author: fabricecolin
Date: 2008-05-03 08:17:10 +0200 (Sat, 03 May 2008)
New Revision: 1238

Modified:
   trunk/AUTHORS
   trunk/README
   trunk/pinot.spec.in
Log:
New dependency on libexif.
Added Mizuki-san to the AUTHORS file.


Modified: trunk/AUTHORS
===================================================================
--- trunk/AUTHORS	2008-05-03 06:13:44 UTC (rev 1237)
+++ trunk/AUTHORS	2008-05-03 06:17:10 UTC (rev 1238)
@@ -43,6 +43,7 @@
 	Italian - Michele Angrisano <darksun1988 at gmail dot com>
 		& Vincenzo Consales <aquarius987 at gmail dot com>>
 		& Marco Bazzani <visik7 at tin dot it>
+	Japanese - Takeo Mizuki <???>
 	Portuguese - _PN_boy <pedro_nuno_pn at iol dot pt>
 		& Tiago Silva <???>
 	Portuguese (Brazil) - Leonardo Melo <leonardovazmelo at gmail dot com>

Modified: trunk/README
===================================================================
--- trunk/README	2008-05-03 06:13:44 UTC (rev 1237)
+++ trunk/README	2008-05-03 06:17:10 UTC (rev 1238)
@@ -515,6 +515,9 @@
 TagLib							1.4
 http://ktown.kde.org/~wheeler/taglib/
 
+libexif							0.6
+http://libexif.sourceforge.net/
+
 openssh-askpass (4)					4.3
 http://www.openssh.com/portable.html
 

Modified: trunk/pinot.spec.in
===================================================================
--- trunk/pinot.spec.in	2008-05-03 06:13:44 UTC (rev 1237)
+++ trunk/pinot.spec.in	2008-05-03 06:17:10 UTC (rev 1238)
@@ -26,11 +26,11 @@
 BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root-%(%{__id_u} -n)
 Requires: xapian-core-libs >= 1.0.3, libtextcat >= 2.2, sqlite >= 3.3.1, curl >= 7.13, gmime >= 2.1
 Requires: gtkmm24 >= 2.10, libxml++ >= 2.12, %{dbus_pkg} >= 0.60, shared-mime-info
-Requires: taglib >= 1.4, unzip, antiword, unrtf, %{pftotext_pkg}
+Requires: taglib >= 1.4, libexif >= 0.6, unzip, antiword, unrtf, %{pftotext_pkg}
 #Suggests: xapian-omega
 BuildRequires: xapian-core-devel >= 1.0.3, libtextcat-devel >= 2.2, sqlite-devel >= 3.3.1, curl-devel >= 7.13, gmime-devel >= 2.1, boost-devel >= 1.32
 BuildRequires: gtkmm24-devel >= 2.10, libxml++-devel >= 2.12, %{dbus_dev_pkg} >= 0.60, gettext-devel, desktop-file-utils
-BuildRequires: taglib-devel >= 1.4
+BuildRequires: taglib-devel >= 1.4, libexif-devel >= 0.6
 BuildRequires: gcc-c++
 %if 0%{?_with_soap:1}
 BuildRequires: gsoap >= 2.7.9e
@@ -90,6 +90,7 @@
 %{_bindir}/pinot-index
 %{_bindir}/pinot-label
 %{_bindir}/pinot-search
+%{_libdir}/pinot/filters/libexifimagefilter.so*
 %{_libdir}/pinot/filters/libexternalfilter.so*
 %{_libdir}/pinot/filters/libmboxfilter.so*
 %{_libdir}/pinot/filters/libtaglibfilter.so*



From fabricecolin at mail.berlios.de  Sat May  3 08:25:58 2008
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 3 May 2008 08:25:58 +0200
Subject: [Pinot-svn] r1239 - trunk
Message-ID: <200805030625.m436PwM9023103@sheep.berlios.de>

Author: fabricecolin
Date: 2008-05-03 08:25:58 +0200 (Sat, 03 May 2008)
New Revision: 1239

Modified:
   trunk/README
Log:
Mention the limitation of mixed queries doesn't apply to 0.85 and newer and give
an example.


Modified: trunk/README
===================================================================
--- trunk/README	2008-05-03 06:17:10 UTC (rev 1238)
+++ trunk/README	2008-05-03 06:25:58 UTC (rev 1239)
@@ -393,14 +393,16 @@
   If you would like to try this out, you will have to reset the My Documents
   index, as described in section "16. How to reset indexes".
 
-  At search time, queries that consist exclusively of CJKV characters are
-  processed in a manner compatible with the CJKV indexing scheme. There is no
-  need to format the query in a specific format, ie no need to separate
-  characters with spaces.
-  Please note that mixed queries, queries that also contain non-CJKV characters,
-  are processed as per normal. This means that operators or filters shouldn't be
-  used in CJKV queries. This limitation will be removed in future versions.
+  At search time, queries that include CJKV characters are processed in a manner
+  compatible with the CJKV indexing scheme. There is no need to format the query
+  in a specific format, ie no need to separate characters with spaces.
+  For example, the query :
+      Fabrice ?? title:????
+  will be modified internally to :
+      Fabrice  (? ?? ?) title:? title:?? title:? title:?? title:? title:?? title:?
 
+  Prior to v0.85, this processing only applied to pure CJKV queries.
+
   You can get a list of documents in which CJKV characters were detected
   by the indexer with the special filter "tokens:CJKV".
 



From fabricecolin at mail.berlios.de  Sun May  4 16:09:28 2008
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sun, 4 May 2008 16:09:28 +0200
Subject: [Pinot-svn] r1240 - trunk/UI/GTK2/src
Message-ID: <200805041409.m44E9Sqi006789@sheep.berlios.de>

Author: fabricecolin
Date: 2008-05-04 16:09:28 +0200 (Sun, 04 May 2008)
New Revision: 1240

Modified:
   trunk/UI/GTK2/src/WorkerThreads.cpp
   trunk/UI/GTK2/src/WorkerThreads.h
Log:
In MonitorThread::stop(), write to the control pipe after the stop flag is set
by the call to the parent's method.
Removed unused method.


Modified: trunk/UI/GTK2/src/WorkerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.cpp	2008-05-03 06:25:58 UTC (rev 1239)
+++ trunk/UI/GTK2/src/WorkerThreads.cpp	2008-05-04 14:09:28 UTC (rev 1240)
@@ -24,6 +24,7 @@
 #include <fcntl.h>
 #include <string.h>
 #include <signal.h>
+#include <time.h>
 #include <errno.h>
 #include <exception>
 #include <iostream>
@@ -565,16 +566,6 @@
 	return (unsigned int)max(count , 0);
 }
 
-bool ThreadsManager::has_threads(void)
-{
-	if (m_threads.empty() == true)
-	{
-		return false;
-	}
-
-	return true;
-}
-
 void ThreadsManager::stop_threads(void)
 {
 	if (m_threads.empty() == false)
@@ -583,7 +574,6 @@
 		{
 			// Stop threads
 			for_each(m_threads.begin(), m_threads.end(), StopThreadFunc());
-			m_threads.clear();
 
 			unlock_threads();
 		}
@@ -1949,8 +1939,8 @@
 
 void MonitorThread::stop(void)
 {
-	write(m_ctrlWritePipe, "X", 1);
 	WorkerThread::stop();
+	write(m_ctrlWritePipe, "X", 1);
 }
 
 void MonitorThread::processEvents(void)

Modified: trunk/UI/GTK2/src/WorkerThreads.h
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.h	2008-05-03 06:25:58 UTC (rev 1239)
+++ trunk/UI/GTK2/src/WorkerThreads.h	2008-05-04 14:09:28 UTC (rev 1240)
@@ -116,8 +116,6 @@
 
 		unsigned int get_threads_count(void);
 
-		bool has_threads(void);
-
 		void stop_threads(void);
 
 		virtual void connect(void);



From fabricecolin at mail.berlios.de  Mon May  5 14:07:51 2008
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Mon, 5 May 2008 14:07:51 +0200
Subject: [Pinot-svn] r1241 - trunk/UI/GTK2/src
Message-ID: <200805051207.m45C7pm9028939@sheep.berlios.de>

Author: fabricecolin
Date: 2008-05-05 14:07:50 +0200 (Mon, 05 May 2008)
New Revision: 1241

Modified:
   trunk/UI/GTK2/src/PinotSettings.cpp
   trunk/UI/GTK2/src/pinot-dbus-daemon.xml
Log:
Removed JPEG from default blacklist.
Cosmetic modifications to pinot-dbus-daemon.xml.


Modified: trunk/UI/GTK2/src/PinotSettings.cpp
===================================================================
--- trunk/UI/GTK2/src/PinotSettings.cpp	2008-05-04 14:09:28 UTC (rev 1240)
+++ trunk/UI/GTK2/src/PinotSettings.cpp	2008-05-05 12:07:50 UTC (rev 1241)
@@ -1744,8 +1744,6 @@
 	defaultPatterns.insert("*.flv");
 	defaultPatterns.insert("*.gif");
 	defaultPatterns.insert("*.iso");
-	defaultPatterns.insert("*.jpeg");
-	defaultPatterns.insert("*.jpg");
 	defaultPatterns.insert("*.la");
 	defaultPatterns.insert("*.lha");
 	defaultPatterns.insert("*.mov");

Modified: trunk/UI/GTK2/src/pinot-dbus-daemon.xml
===================================================================
--- trunk/UI/GTK2/src/pinot-dbus-daemon.xml	2008-05-04 14:09:28 UTC (rev 1240)
+++ trunk/UI/GTK2/src/pinot-dbus-daemon.xml	2008-05-05 12:07:50 UTC (rev 1241)
@@ -21,7 +21,7 @@
     </method>
     <!--
 	Instructs the daemon program to reload the configuration file.
-	 loadStatus: TRUE if the configuration is being reloaded
+	 reloading: TRUE if the configuration is being reloaded
 	-->
     <method name="Reload">
       <annotation name="de.berlios.Pinot.Reload" value="pinotDBus"/>
@@ -29,7 +29,7 @@
     </method>
     <!--
 	Stops the daemon program.
-	 exitStatus: the daemon's exit status.
+	 exitStatus: the daemon's exit status
 	-->
     <method name="Stop">
       <annotation name="de.berlios.Pinot.Stop" value="pinotDBus"/>



From fabricecolin at mail.berlios.de  Mon May  5 14:36:27 2008
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Mon, 5 May 2008 14:36:27 +0200
Subject: [Pinot-svn] r1242 - in trunk: . IndexSearch UI/GTK2/src po
Message-ID: <200805051236.m45CaRiu032247@sheep.berlios.de>

Author: fabricecolin
Date: 2008-05-05 14:36:21 +0200 (Mon, 05 May 2008)
New Revision: 1242

Modified:
   trunk/IndexSearch/pinot-index.1
   trunk/IndexSearch/pinot-label.1
   trunk/IndexSearch/pinot-search.1
   trunk/NEWS
   trunk/UI/GTK2/src/pinot-dbus-daemon.1
   trunk/UI/GTK2/src/pinot.1
   trunk/configure.in
   trunk/po/de.po
   trunk/po/es.po
   trunk/po/fr.po
   trunk/po/it.po
   trunk/po/ja.po
   trunk/po/nl.po
   trunk/po/pt.po
   trunk/po/pt_BR.po
   trunk/po/ru.po
   trunk/po/sv.po
   trunk/po/zh_CN.po
   trunk/po/zh_TW.po
Log:
Bumped version number to 0.85.


Modified: trunk/IndexSearch/pinot-index.1
===================================================================
--- trunk/IndexSearch/pinot-index.1	2008-05-05 12:07:50 UTC (rev 1241)
+++ trunk/IndexSearch/pinot-index.1	2008-05-05 12:36:21 UTC (rev 1242)
@@ -1,5 +1,5 @@
 .\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.36.
-.TH PINOT-INDEX "1" "March 2008" "pinot-index - pinot 0.84" "User Commands"
+.TH PINOT-INDEX "1" "May 2008" "pinot-index - pinot 0.85" "User Commands"
 .SH NAME
 pinot-index \- Index documents from the command-line
 .SH SYNOPSIS

Modified: trunk/IndexSearch/pinot-label.1
===================================================================
--- trunk/IndexSearch/pinot-label.1	2008-05-05 12:07:50 UTC (rev 1241)
+++ trunk/IndexSearch/pinot-label.1	2008-05-05 12:36:21 UTC (rev 1242)
@@ -1,5 +1,5 @@
 .\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.36.
-.TH PINOT-LABEL "1" "March 2008" "pinot-label - pinot 0.84" "User Commands"
+.TH PINOT-LABEL "1" "May 2008" "pinot-label - pinot 0.85" "User Commands"
 .SH NAME
 pinot-label \- Label files from the command-line
 .SH SYNOPSIS

Modified: trunk/IndexSearch/pinot-search.1
===================================================================
--- trunk/IndexSearch/pinot-search.1	2008-05-05 12:07:50 UTC (rev 1241)
+++ trunk/IndexSearch/pinot-search.1	2008-05-05 12:36:21 UTC (rev 1242)
@@ -1,5 +1,5 @@
 .\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.36.
-.TH PINOT-SEARCH "1" "March 2008" "pinot-search - pinot 0.84" "User Commands"
+.TH PINOT-SEARCH "1" "May 2008" "pinot-search - pinot 0.85" "User Commands"
 .SH NAME
 pinot-search \- Query search engines from the command-line
 .SH SYNOPSIS

Modified: trunk/NEWS
===================================================================
--- trunk/NEWS	2008-05-05 12:07:50 UTC (rev 1241)
+++ trunk/NEWS	2008-05-05 12:36:21 UTC (rev 1242)
@@ -1,3 +1,24 @@
+2008/05/05 version_0_8_5
+Build :
+ - removed reference to m4 directory
+Tokenize :
+ - new libexif-based filter to extract image metadata
+ - the mbox filter attempts to convert non UTF-8 text
+ - tweaks to the CJKV tokenizer
+SQL :
+ - somewhat more abstract interface to databases
+Search :
+ - fixed CJKV queries on Web engines
+Xapian :
+ - mixed CJKV queries should be processed correctly. See README.
+ - if the document specifies a language, double check it's valid
+Daemon :
+ - check whether there's already a daemon process running and exit if there is
+ - fixed concurrency issues
+ - fixed crawling and monitoring of new directories
+UI :
+ - new Japanese translation by Takeo Mizuki
+
 2008/03/27 version_0_8_4
 Build :
  - patch by Adel Gadllah to fix gcc 4.3 build errors

Modified: trunk/UI/GTK2/src/pinot-dbus-daemon.1
===================================================================
--- trunk/UI/GTK2/src/pinot-dbus-daemon.1	2008-05-05 12:07:50 UTC (rev 1241)
+++ trunk/UI/GTK2/src/pinot-dbus-daemon.1	2008-05-05 12:36:21 UTC (rev 1242)
@@ -1,5 +1,5 @@
 .\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.36.
-.TH PINOT-DBUS-DAEMON "1" "March 2008" "pinot-dbus-daemon - pinot 0.84" "User Commands"
+.TH PINOT-DBUS-DAEMON "1" "May 2008" "pinot-dbus-daemon - pinot 0.85" "User Commands"
 .SH NAME
 pinot-dbus-daemon \- D-Bus search and index daemon
 .SH SYNOPSIS

Modified: trunk/UI/GTK2/src/pinot.1
===================================================================
--- trunk/UI/GTK2/src/pinot.1	2008-05-05 12:07:50 UTC (rev 1241)
+++ trunk/UI/GTK2/src/pinot.1	2008-05-05 12:36:21 UTC (rev 1242)
@@ -1,5 +1,5 @@
 .\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.36.
-.TH PINOT "1" "March 2008" "pinot - pinot 0.84" "User Commands"
+.TH PINOT "1" "May 2008" "pinot - pinot 0.85" "User Commands"
 .SH NAME
 pinot \- A metasearch tool for the Free Desktop
 .SH SYNOPSIS

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2008-05-05 12:07:50 UTC (rev 1241)
+++ trunk/configure.in	2008-05-05 12:36:21 UTC (rev 1242)
@@ -2,7 +2,7 @@
 # using glademm V2.6.0
 
 AC_PREREQ(2.50)
-AC_INIT(pinot, 0.84,[fabricecolin at users.berlios.de])
+AC_INIT(pinot, 0.85,[fabricecolin at users.berlios.de])
 AM_INIT_AUTOMAKE
 AC_CONFIG_HEADERS(config.h)
 

Modified: trunk/po/de.po
===================================================================
--- trunk/po/de.po	2008-05-05 12:07:50 UTC (rev 1241)
+++ trunk/po/de.po	2008-05-05 12:36:21 UTC (rev 1242)
@@ -4,9 +4,9 @@
 #
 msgid ""
 msgstr ""
-"Project-Id-Version: pinot 0.83\n"
+"Project-Id-Version: pinot 0.85\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2008-03-26 14:43+0800\n"
+"POT-Creation-Date: 2008-05-04 22:14+0800\n"
 "PO-Revision-Date: 2008-01-15 00:16+0000\n"
 "Last-Translator: Christian Dywan <christian at twotoasts.de>\n"
 "Language-Team: German <de at li.org>\n"
@@ -34,7 +34,7 @@
 #: UI/GTK2/src/mainWindow.cc:1562 UI/GTK2/src/mainWindow.cc:2273
 #: UI/GTK2/src/PinotSettings.cpp:322 UI/GTK2/src/PinotSettings.cpp:1470
 #: UI/GTK2/src/PinotSettings.cpp:1526 UI/GTK2/src/statisticsDialog.cc:79
-#: UI/GTK2/src/WorkerThreads.cpp:998
+#: UI/GTK2/src/WorkerThreads.cpp:1009
 msgid "My Web Pages"
 msgstr "Meine Webseiten"
 
@@ -43,7 +43,7 @@
 #: UI/GTK2/src/mainWindow.cc:978 UI/GTK2/src/mainWindow.cc:1287
 #: UI/GTK2/src/mainWindow.cc:2277 UI/GTK2/src/PinotSettings.cpp:323
 #: UI/GTK2/src/PinotSettings.cpp:1471 UI/GTK2/src/PinotSettings.cpp:1527
-#: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:1008
+#: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:1019
 msgid "My Documents"
 msgstr "Meine Dokumente"
 
@@ -502,67 +502,67 @@
 msgstr ""
 
 #. Localize language names
-#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:431
+#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:492
 msgid "Unknown"
 msgstr "Unbekannt"
 
-#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:432
+#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:493
 msgid "Danish"
 msgstr "D?nisch"
 
-#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:433
+#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:494
 msgid "Dutch"
 msgstr "Niederl?nisch"
 
-#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:434
+#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:495
 msgid "English"
 msgstr "Englisch"
 
-#: UI/GTK2/src/pinot.cc:240 UI/GTK2/src/pinot-dbus-daemon.cc:435
+#: UI/GTK2/src/pinot.cc:240 UI/GTK2/src/pinot-dbus-daemon.cc:496
 msgid "Finnish"
 msgstr "Finnisch"
 
-#: UI/GTK2/src/pinot.cc:241 UI/GTK2/src/pinot-dbus-daemon.cc:436
+#: UI/GTK2/src/pinot.cc:241 UI/GTK2/src/pinot-dbus-daemon.cc:497
 msgid "French"
 msgstr "Franz?sisch"
 
-#: UI/GTK2/src/pinot.cc:242 UI/GTK2/src/pinot-dbus-daemon.cc:437
+#: UI/GTK2/src/pinot.cc:242 UI/GTK2/src/pinot-dbus-daemon.cc:498
 msgid "German"
 msgstr "Deutsch"
 
-#: UI/GTK2/src/pinot.cc:243 UI/GTK2/src/pinot-dbus-daemon.cc:438
+#: UI/GTK2/src/pinot.cc:243 UI/GTK2/src/pinot-dbus-daemon.cc:499
 msgid "Hungarian"
 msgstr "Ungarisch"
 
-#: UI/GTK2/src/pinot.cc:244 UI/GTK2/src/pinot-dbus-daemon.cc:439
+#: UI/GTK2/src/pinot.cc:244 UI/GTK2/src/pinot-dbus-daemon.cc:500
 msgid "Italian"
 msgstr "Italienisch"
 
-#: UI/GTK2/src/pinot.cc:245 UI/GTK2/src/pinot-dbus-daemon.cc:440
+#: UI/GTK2/src/pinot.cc:245 UI/GTK2/src/pinot-dbus-daemon.cc:501
 msgid "Norwegian"
 msgstr "Norwegisch"
 
-#: UI/GTK2/src/pinot.cc:246 UI/GTK2/src/pinot-dbus-daemon.cc:441
+#: UI/GTK2/src/pinot.cc:246 UI/GTK2/src/pinot-dbus-daemon.cc:502
 msgid "Portuguese"
 msgstr "Portugiesisch"
 
-#: UI/GTK2/src/pinot.cc:247 UI/GTK2/src/pinot-dbus-daemon.cc:442
+#: UI/GTK2/src/pinot.cc:247 UI/GTK2/src/pinot-dbus-daemon.cc:503
 msgid "Romanian"
 msgstr "Rum?nisch"
 
-#: UI/GTK2/src/pinot.cc:248 UI/GTK2/src/pinot-dbus-daemon.cc:443
+#: UI/GTK2/src/pinot.cc:248 UI/GTK2/src/pinot-dbus-daemon.cc:504
 msgid "Russian"
 msgstr "Russisch"
 
-#: UI/GTK2/src/pinot.cc:249 UI/GTK2/src/pinot-dbus-daemon.cc:444
+#: UI/GTK2/src/pinot.cc:249 UI/GTK2/src/pinot-dbus-daemon.cc:505
 msgid "Spanish"
 msgstr "Spanisch"
 
-#: UI/GTK2/src/pinot.cc:250 UI/GTK2/src/pinot-dbus-daemon.cc:445
+#: UI/GTK2/src/pinot.cc:250 UI/GTK2/src/pinot-dbus-daemon.cc:506
 msgid "Swedish"
 msgstr "Schwedisch"
 
-#: UI/GTK2/src/pinot.cc:251 UI/GTK2/src/pinot-dbus-daemon.cc:446
+#: UI/GTK2/src/pinot.cc:251 UI/GTK2/src/pinot-dbus-daemon.cc:507
 msgid "Turkish"
 msgstr "T?rkisch"
 
@@ -859,7 +859,7 @@
 msgstr "Dokumente"
 
 #: UI/GTK2/src/statisticsDialog.cc:151 UI/GTK2/src/statisticsDialog.cc:169
-#: UI/GTK2/src/WorkerThreads.cpp:124
+#: UI/GTK2/src/WorkerThreads.cpp:125
 msgid "Unknown error"
 msgstr "Unbekannter Fehler"
 
@@ -901,88 +901,88 @@
 msgid "Errors"
 msgstr "Fehler"
 
-#: UI/GTK2/src/WorkerThreads.cpp:91
+#: UI/GTK2/src/WorkerThreads.cpp:92
 #, fuzzy
 msgid "Index error"
 msgstr "Indiziert"
 
-#: UI/GTK2/src/WorkerThreads.cpp:93
+#: UI/GTK2/src/WorkerThreads.cpp:94
 #, fuzzy
 msgid "Couldn't index document"
 msgstr "Dokument konnte nicht aktualisiert werden"
 
-#: UI/GTK2/src/WorkerThreads.cpp:95
+#: UI/GTK2/src/WorkerThreads.cpp:96
 msgid "Couldn't update document"
 msgstr "Dokument konnte nicht aktualisiert werden"
 
-#: UI/GTK2/src/WorkerThreads.cpp:97
+#: UI/GTK2/src/WorkerThreads.cpp:98
 msgid "Couldn't unindex document(s)"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:99
+#: UI/GTK2/src/WorkerThreads.cpp:100
 msgid "Couldn't run query on search engine"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:101
+#: UI/GTK2/src/WorkerThreads.cpp:102
 #, fuzzy
 msgid "Couldn't get history for search engine"
 msgstr "Konnte Verlaufsdatenbank nicht anlegen"
 
-#: UI/GTK2/src/WorkerThreads.cpp:103
+#: UI/GTK2/src/WorkerThreads.cpp:104
 #, fuzzy
 msgid "Couldn't retrieve document"
 msgstr "Dokument konnte nicht aktualisiert werden"
 
-#: UI/GTK2/src/WorkerThreads.cpp:105
+#: UI/GTK2/src/WorkerThreads.cpp:106
 msgid "File monitor error"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:107
+#: UI/GTK2/src/WorkerThreads.cpp:108
 #, fuzzy
 msgid "Couldn't open directory"
 msgstr "Konnte Index nicht ?ffnen"
 
-#: UI/GTK2/src/WorkerThreads.cpp:109
+#: UI/GTK2/src/WorkerThreads.cpp:110
 #, fuzzy
 msgid "Index doesn't exist"
 msgstr "existiert nicht"
 
-#: UI/GTK2/src/WorkerThreads.cpp:111
+#: UI/GTK2/src/WorkerThreads.cpp:112
 msgid "Couldn't create search engine"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:113
+#: UI/GTK2/src/WorkerThreads.cpp:114
 msgid "Cannot index document type"
 msgstr "Kann Dokumenttyp nicht indizieren"
 
-#: UI/GTK2/src/WorkerThreads.cpp:115
+#: UI/GTK2/src/WorkerThreads.cpp:116
 msgid "No downloader for this protocol"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:117
+#: UI/GTK2/src/WorkerThreads.cpp:118
 msgid "Robots META tag forbids indexing"
 msgstr "Robots META-Tag verbietet das Indizieren"
 
-#: UI/GTK2/src/WorkerThreads.cpp:119
+#: UI/GTK2/src/WorkerThreads.cpp:120
 msgid "No monitoring handler"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:415
+#: UI/GTK2/src/WorkerThreads.cpp:416
 msgid "Indexing was stopped"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:428
+#: UI/GTK2/src/WorkerThreads.cpp:429
 msgid "Can't index mail here"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:449 UI/GTK2/src/WorkerThreads.cpp:704
+#: UI/GTK2/src/WorkerThreads.cpp:450 UI/GTK2/src/WorkerThreads.cpp:715
 msgid "is already being indexed"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:459
+#: UI/GTK2/src/WorkerThreads.cpp:460
 msgid "is blacklisted"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:961
+#: UI/GTK2/src/WorkerThreads.cpp:972
 msgid "No title"
 msgstr "Kein Titel"

Modified: trunk/po/es.po
===================================================================
--- trunk/po/es.po	2008-05-05 12:07:50 UTC (rev 1241)
+++ trunk/po/es.po	2008-05-05 12:36:21 UTC (rev 1242)
@@ -5,16 +5,16 @@
 #
 msgid ""
 msgstr ""
-"Project-Id-Version: pinot 0.83\n"
+"Project-Id-Version: pinot 0.85\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2008-03-26 14:43+0800\n"
-"PO-Revision-Date: 2008-02-17 13:04+0000\n"
-"Last-Translator: Gar Bage <garbage at openfutura.com>\n"
+"POT-Creation-Date: 2008-05-04 22:14+0800\n"
+"PO-Revision-Date: 2008-04-05 23:03+0000\n"
+"Last-Translator: Jesus Tramullas <jesus at tramullas.com>\n"
 "Language-Team: es <fabricecolin at users.berlios.de>\n"
 "MIME-Version: 1.0\n"
 "Content-Type: text/plain; charset=utf-8\n"
 "Content-Transfer-Encoding: 8bit\n"
-"X-Launchpad-Export-Date: 2008-02-18 14:08+0000\n"
+"X-Launchpad-Export-Date: 2008-04-13 15:20+0000\n"
 "X-Generator: Launchpad (build Unknown)\n"
 
 #: UI/GTK2/src/EnginesTree.cpp:68 UI/GTK2/src/statisticsDialog.cc:89
@@ -35,7 +35,7 @@
 #: UI/GTK2/src/mainWindow.cc:1562 UI/GTK2/src/mainWindow.cc:2273
 #: UI/GTK2/src/PinotSettings.cpp:322 UI/GTK2/src/PinotSettings.cpp:1470
 #: UI/GTK2/src/PinotSettings.cpp:1526 UI/GTK2/src/statisticsDialog.cc:79
-#: UI/GTK2/src/WorkerThreads.cpp:998
+#: UI/GTK2/src/WorkerThreads.cpp:1009
 msgid "My Web Pages"
 msgstr "Mis Paginas Web"
 
@@ -44,7 +44,7 @@
 #: UI/GTK2/src/mainWindow.cc:978 UI/GTK2/src/mainWindow.cc:1287
 #: UI/GTK2/src/mainWindow.cc:2277 UI/GTK2/src/PinotSettings.cpp:323
 #: UI/GTK2/src/PinotSettings.cpp:1471 UI/GTK2/src/PinotSettings.cpp:1527
-#: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:1008
+#: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:1019
 msgid "My Documents"
 msgstr "Mis documentos"
 
@@ -490,67 +490,67 @@
 msgstr "Pinot"
 
 #. Localize language names
-#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:431
+#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:492
 msgid "Unknown"
 msgstr "Desconocido"
 
-#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:432
+#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:493
 msgid "Danish"
 msgstr "Dan?s"
 
-#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:433
+#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:494
 msgid "Dutch"
 msgstr "Holand?s"
 
-#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:434
+#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:495
 msgid "English"
 msgstr "Ingl?s"
 
-#: UI/GTK2/src/pinot.cc:240 UI/GTK2/src/pinot-dbus-daemon.cc:435
+#: UI/GTK2/src/pinot.cc:240 UI/GTK2/src/pinot-dbus-daemon.cc:496
 msgid "Finnish"
 msgstr "Finland?s"
 
-#: UI/GTK2/src/pinot.cc:241 UI/GTK2/src/pinot-dbus-daemon.cc:436
+#: UI/GTK2/src/pinot.cc:241 UI/GTK2/src/pinot-dbus-daemon.cc:497
 msgid "French"
 msgstr "Franc?s"
 
-#: UI/GTK2/src/pinot.cc:242 UI/GTK2/src/pinot-dbus-daemon.cc:437
+#: UI/GTK2/src/pinot.cc:242 UI/GTK2/src/pinot-dbus-daemon.cc:498
 msgid "German"
 msgstr "Alem?n"
 
-#: UI/GTK2/src/pinot.cc:243 UI/GTK2/src/pinot-dbus-daemon.cc:438
+#: UI/GTK2/src/pinot.cc:243 UI/GTK2/src/pinot-dbus-daemon.cc:499
 msgid "Hungarian"
 msgstr "H?ngaro"
 
-#: UI/GTK2/src/pinot.cc:244 UI/GTK2/src/pinot-dbus-daemon.cc:439
+#: UI/GTK2/src/pinot.cc:244 UI/GTK2/src/pinot-dbus-daemon.cc:500
 msgid "Italian"
 msgstr "Italiano"
 
-#: UI/GTK2/src/pinot.cc:245 UI/GTK2/src/pinot-dbus-daemon.cc:440
+#: UI/GTK2/src/pinot.cc:245 UI/GTK2/src/pinot-dbus-daemon.cc:501
 msgid "Norwegian"
 msgstr "Noruego"
 
-#: UI/GTK2/src/pinot.cc:246 UI/GTK2/src/pinot-dbus-daemon.cc:441
+#: UI/GTK2/src/pinot.cc:246 UI/GTK2/src/pinot-dbus-daemon.cc:502
 msgid "Portuguese"
 msgstr "Portugu?s"
 
-#: UI/GTK2/src/pinot.cc:247 UI/GTK2/src/pinot-dbus-daemon.cc:442
+#: UI/GTK2/src/pinot.cc:247 UI/GTK2/src/pinot-dbus-daemon.cc:503
 msgid "Romanian"
 msgstr "Rumano"
 
-#: UI/GTK2/src/pinot.cc:248 UI/GTK2/src/pinot-dbus-daemon.cc:443
+#: UI/GTK2/src/pinot.cc:248 UI/GTK2/src/pinot-dbus-daemon.cc:504
 msgid "Russian"
 msgstr "Ruso"
 
-#: UI/GTK2/src/pinot.cc:249 UI/GTK2/src/pinot-dbus-daemon.cc:444
+#: UI/GTK2/src/pinot.cc:249 UI/GTK2/src/pinot-dbus-daemon.cc:505
 msgid "Spanish"
 msgstr "Espa?ol"
 
-#: UI/GTK2/src/pinot.cc:250 UI/GTK2/src/pinot-dbus-daemon.cc:445
+#: UI/GTK2/src/pinot.cc:250 UI/GTK2/src/pinot-dbus-daemon.cc:506
 msgid "Swedish"
 msgstr "Sueco"
 
-#: UI/GTK2/src/pinot.cc:251 UI/GTK2/src/pinot-dbus-daemon.cc:446
+#: UI/GTK2/src/pinot.cc:251 UI/GTK2/src/pinot-dbus-daemon.cc:507
 msgid "Turkish"
 msgstr "Turco"
 
@@ -840,7 +840,7 @@
 msgstr "documentos"
 
 #: UI/GTK2/src/statisticsDialog.cc:151 UI/GTK2/src/statisticsDialog.cc:169
-#: UI/GTK2/src/WorkerThreads.cpp:124
+#: UI/GTK2/src/WorkerThreads.cpp:125
 msgid "Unknown error"
 msgstr "Error desconocido"
 
@@ -881,82 +881,82 @@
 msgid "Errors"
 msgstr "Errores"
 
-#: UI/GTK2/src/WorkerThreads.cpp:91
+#: UI/GTK2/src/WorkerThreads.cpp:92
 msgid "Index error"
 msgstr "Error en el ?ndice"
 
-#: UI/GTK2/src/WorkerThreads.cpp:93
+#: UI/GTK2/src/WorkerThreads.cpp:94
 msgid "Couldn't index document"
 msgstr "No se pudo indizar el documento"
 
-#: UI/GTK2/src/WorkerThreads.cpp:95
+#: UI/GTK2/src/WorkerThreads.cpp:96
 msgid "Couldn't update document"
 msgstr "No se pudo actualizar el documento"
 
-#: UI/GTK2/src/WorkerThreads.cpp:97
+#: UI/GTK2/src/WorkerThreads.cpp:98
 msgid "Couldn't unindex document(s)"
 msgstr "No se pudo des-indizar lo(s) documento(s)"
 
-#: UI/GTK2/src/WorkerThreads.cpp:99
+#: UI/GTK2/src/WorkerThreads.cpp:100
 msgid "Couldn't run query on search engine"
 msgstr "No se pudo ejecutar la b?squeda contra el motor"
 
-#: UI/GTK2/src/WorkerThreads.cpp:101
+#: UI/GTK2/src/WorkerThreads.cpp:102
 msgid "Couldn't get history for search engine"
 msgstr "No se pudo recuperar el hist?rico de b?squedas de este motor"
 
-#: UI/GTK2/src/WorkerThreads.cpp:103
+#: UI/GTK2/src/WorkerThreads.cpp:104
 msgid "Couldn't retrieve document"
 msgstr "No se pudo recuperar el documento"
 
-#: UI/GTK2/src/WorkerThreads.cpp:105
+#: UI/GTK2/src/WorkerThreads.cpp:106
 msgid "File monitor error"
 msgstr "Error del monitor de ficheros"
 
-#: UI/GTK2/src/WorkerThreads.cpp:107
+#: UI/GTK2/src/WorkerThreads.cpp:108
 msgid "Couldn't open directory"
 msgstr "No se pudo abrir el directorio"
 
-#: UI/GTK2/src/WorkerThreads.cpp:109
+#: UI/GTK2/src/WorkerThreads.cpp:110
 msgid "Index doesn't exist"
 msgstr "No existe el ?ndice"
 
-#: UI/GTK2/src/WorkerThreads.cpp:111
+#: UI/GTK2/src/WorkerThreads.cpp:112
 msgid "Couldn't create search engine"
 msgstr "No se pudo crear el motor de b?squeda"
 
-#: UI/GTK2/src/WorkerThreads.cpp:113
+#: UI/GTK2/src/WorkerThreads.cpp:114
 msgid "Cannot index document type"
 msgstr "No se pudo indizar el tipo de documento"
 
-#: UI/GTK2/src/WorkerThreads.cpp:115
+#: UI/GTK2/src/WorkerThreads.cpp:116
 msgid "No downloader for this protocol"
 msgstr "No hay recuperador para este protocolo"
 
-#: UI/GTK2/src/WorkerThreads.cpp:117
+#: UI/GTK2/src/WorkerThreads.cpp:118
 msgid "Robots META tag forbids indexing"
 msgstr "La etiqueta META Robots proh?be la indizaci?n"
 
-#: UI/GTK2/src/WorkerThreads.cpp:119
+#: UI/GTK2/src/WorkerThreads.cpp:120
 msgid "No monitoring handler"
 msgstr "No hay monitorizaci?n"
 
-#: UI/GTK2/src/WorkerThreads.cpp:415
+#: UI/GTK2/src/WorkerThreads.cpp:416
 msgid "Indexing was stopped"
 msgstr "La indizaci?n se ha detenido"
 
-#: UI/GTK2/src/WorkerThreads.cpp:428
+#: UI/GTK2/src/WorkerThreads.cpp:429
 msgid "Can't index mail here"
 msgstr "No se pudo indizar el buzon de correo"
 
-#: UI/GTK2/src/WorkerThreads.cpp:449 UI/GTK2/src/WorkerThreads.cpp:704
+#: UI/GTK2/src/WorkerThreads.cpp:450 UI/GTK2/src/WorkerThreads.cpp:715
 msgid "is already being indexed"
 msgstr "ya est? indizado"
 
-#: UI/GTK2/src/WorkerThreads.cpp:459
+#: UI/GTK2/src/WorkerThreads.cpp:460
 msgid "is blacklisted"
 msgstr "ya excluido"
 
-#: UI/GTK2/src/WorkerThreads.cpp:961
+#: UI/GTK2/src/WorkerThreads.cpp:972
 msgid "No title"
 msgstr "Sin t?tulo"

Modified: trunk/po/fr.po
===================================================================
--- trunk/po/fr.po	2008-05-05 12:07:50 UTC (rev 1241)
+++ trunk/po/fr.po	2008-05-05 12:36:21 UTC (rev 1242)
@@ -5,9 +5,9 @@
 #
 msgid ""
 msgstr ""
-"Project-Id-Version: pinot 0.83\n"
+"Project-Id-Version: pinot 0.85\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2008-03-26 14:43+0800\n"
+"POT-Creation-Date: 2008-05-04 22:14+0800\n"
 "PO-Revision-Date: 2008-03-24 18:17+0800\n"
 "Last-Translator: Fabrice Colin <fabricecolin at users.berlios.de>\n"
 "Language-Team: fr <fabricecolin at users.berlios.de>\n"
@@ -35,7 +35,7 @@
 #: UI/GTK2/src/mainWindow.cc:1562 UI/GTK2/src/mainWindow.cc:2273
 #: UI/GTK2/src/PinotSettings.cpp:322 UI/GTK2/src/PinotSettings.cpp:1470
 #: UI/GTK2/src/PinotSettings.cpp:1526 UI/GTK2/src/statisticsDialog.cc:79
-#: UI/GTK2/src/WorkerThreads.cpp:998
+#: UI/GTK2/src/WorkerThreads.cpp:1009
 msgid "My Web Pages"
 msgstr "Mes Pages Web"
 
@@ -44,7 +44,7 @@
 #: UI/GTK2/src/mainWindow.cc:978 UI/GTK2/src/mainWindow.cc:1287
 #: UI/GTK2/src/mainWindow.cc:2277 UI/GTK2/src/PinotSettings.cpp:323
 #: UI/GTK2/src/PinotSettings.cpp:1471 UI/GTK2/src/PinotSettings.cpp:1527
-#: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:1008
+#: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:1019
 msgid "My Documents"
 msgstr "Mes Documents"
 
@@ -491,67 +491,67 @@
 msgstr "Pinot"
 
 #. Localize language names
-#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:431
+#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:492
 msgid "Unknown"
 msgstr "Inconnu"
 
-#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:432
+#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:493
 msgid "Danish"
 msgstr "Danois"
 
-#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:433
+#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:494
 msgid "Dutch"
 msgstr "Hollandais"
 
-#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:434
+#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:495
 msgid "English"
 msgstr "Anglais"
 
-#: UI/GTK2/src/pinot.cc:240 UI/GTK2/src/pinot-dbus-daemon.cc:435
+#: UI/GTK2/src/pinot.cc:240 UI/GTK2/src/pinot-dbus-daemon.cc:496
 msgid "Finnish"
 msgstr "Finlandais"
 
-#: UI/GTK2/src/pinot.cc:241 UI/GTK2/src/pinot-dbus-daemon.cc:436
+#: UI/GTK2/src/pinot.cc:241 UI/GTK2/src/pinot-dbus-daemon.cc:497
 msgid "French"
 msgstr "Francais"
 
-#: UI/GTK2/src/pinot.cc:242 UI/GTK2/src/pinot-dbus-daemon.cc:437
+#: UI/GTK2/src/pinot.cc:242 UI/GTK2/src/pinot-dbus-daemon.cc:498
 msgid "German"
 msgstr "Allemand"
 
-#: UI/GTK2/src/pinot.cc:243 UI/GTK2/src/pinot-dbus-daemon.cc:438
+#: UI/GTK2/src/pinot.cc:243 UI/GTK2/src/pinot-dbus-daemon.cc:499
 msgid "Hungarian"
 msgstr "Hongrois"
 
-#: UI/GTK2/src/pinot.cc:244 UI/GTK2/src/pinot-dbus-daemon.cc:439
+#: UI/GTK2/src/pinot.cc:244 UI/GTK2/src/pinot-dbus-daemon.cc:500
 msgid "Italian"
 msgstr "Italien"
 
-#: UI/GTK2/src/pinot.cc:245 UI/GTK2/src/pinot-dbus-daemon.cc:440
+#: UI/GTK2/src/pinot.cc:245 UI/GTK2/src/pinot-dbus-daemon.cc:501
 msgid "Norwegian"
 msgstr "Norvegien"
 
-#: UI/GTK2/src/pinot.cc:246 UI/GTK2/src/pinot-dbus-daemon.cc:441
+#: UI/GTK2/src/pinot.cc:246 UI/GTK2/src/pinot-dbus-daemon.cc:502
 msgid "Portuguese"
 msgstr "Portugais"
 
-#: UI/GTK2/src/pinot.cc:247 UI/GTK2/src/pinot-dbus-daemon.cc:442
+#: UI/GTK2/src/pinot.cc:247 UI/GTK2/src/pinot-dbus-daemon.cc:503
 msgid "Romanian"
 msgstr "Roumain"
 
-#: UI/GTK2/src/pinot.cc:248 UI/GTK2/src/pinot-dbus-daemon.cc:443
+#: UI/GTK2/src/pinot.cc:248 UI/GTK2/src/pinot-dbus-daemon.cc:504
 msgid "Russian"
 msgstr "Russe"
 
-#: UI/GTK2/src/pinot.cc:249 UI/GTK2/src/pinot-dbus-daemon.cc:444
+#: UI/GTK2/src/pinot.cc:249 UI/GTK2/src/pinot-dbus-daemon.cc:505
 msgid "Spanish"
 msgstr "Espagnol"
 
-#: UI/GTK2/src/pinot.cc:250 UI/GTK2/src/pinot-dbus-daemon.cc:445
+#: UI/GTK2/src/pinot.cc:250 UI/GTK2/src/pinot-dbus-daemon.cc:506
 msgid "Swedish"
 msgstr "Suedois"
 
-#: UI/GTK2/src/pinot.cc:251 UI/GTK2/src/pinot-dbus-daemon.cc:446
+#: UI/GTK2/src/pinot.cc:251 UI/GTK2/src/pinot-dbus-daemon.cc:507
 msgid "Turkish"
 msgstr "Turc"
 
@@ -843,7 +843,7 @@
 msgstr "documents"
 
 #: UI/GTK2/src/statisticsDialog.cc:151 UI/GTK2/src/statisticsDialog.cc:169
-#: UI/GTK2/src/WorkerThreads.cpp:124
+#: UI/GTK2/src/WorkerThreads.cpp:125
 msgid "Unknown error"
 msgstr "Erreur inconnue"
 
@@ -884,82 +884,82 @@
 msgid "Errors"
 msgstr "Erreurs"
 
-#: UI/GTK2/src/WorkerThreads.cpp:91
+#: UI/GTK2/src/WorkerThreads.cpp:92
 msgid "Index error"
 msgstr "Erreur sur l'index"
 
-#: UI/GTK2/src/WorkerThreads.cpp:93
+#: UI/GTK2/src/WorkerThreads.cpp:94
 msgid "Couldn't index document"
 msgstr "N'a pas pu indexer le document"
 
-#: UI/GTK2/src/WorkerThreads.cpp:95
+#: UI/GTK2/src/WorkerThreads.cpp:96
 msgid "Couldn't update document"
 msgstr "N'a pas pu mettre a jour le document"
 
-#: UI/GTK2/src/WorkerThreads.cpp:97
+#: UI/GTK2/src/WorkerThreads.cpp:98
 msgid "Couldn't unindex document(s)"
 msgstr "N'a pas pu desindexer le(s) document(s)"
 
-#: UI/GTK2/src/WorkerThreads.cpp:99
+#: UI/GTK2/src/WorkerThreads.cpp:100
 msgid "Couldn't run query on search engine"
 msgstr "N'a pas pu lancer la recherche sur le moteur"
 
-#: UI/GTK2/src/WorkerThreads.cpp:101
+#: UI/GTK2/src/WorkerThreads.cpp:102
 msgid "Couldn't get history for search engine"
 msgstr "N'a pas pu obtenir l'historique de la recherche"
 
-#: UI/GTK2/src/WorkerThreads.cpp:103
+#: UI/GTK2/src/WorkerThreads.cpp:104
 msgid "Couldn't retrieve document"
 msgstr "N'a pas pu telecharger le document"
 
-#: UI/GTK2/src/WorkerThreads.cpp:105
+#: UI/GTK2/src/WorkerThreads.cpp:106
 msgid "File monitor error"
 msgstr "Erreur du moniteur de fichiers"
 
-#: UI/GTK2/src/WorkerThreads.cpp:107
+#: UI/GTK2/src/WorkerThreads.cpp:108
 msgid "Couldn't open directory"
 msgstr "N'a pas pu ouvrir le repertoire"
 
-#: UI/GTK2/src/WorkerThreads.cpp:109
+#: UI/GTK2/src/WorkerThreads.cpp:110
 msgid "Index doesn't exist"
 msgstr "L'index n'existe pas"
 
-#: UI/GTK2/src/WorkerThreads.cpp:111
+#: UI/GTK2/src/WorkerThreads.cpp:112
 msgid "Couldn't create search engine"
 msgstr "N'a pas pu creer le moteur"
 
-#: UI/GTK2/src/WorkerThreads.cpp:113
+#: UI/GTK2/src/WorkerThreads.cpp:114
 msgid "Cannot index document type"
 msgstr "Impossible d'indexer ce type de documents"
 
-#: UI/GTK2/src/WorkerThreads.cpp:115
+#: UI/GTK2/src/WorkerThreads.cpp:116
 msgid "No downloader for this protocol"
 msgstr "Pas de brouteur pour ce protocole"
 
-#: UI/GTK2/src/WorkerThreads.cpp:117
+#: UI/GTK2/src/WorkerThreads.cpp:118
 msgid "Robots META tag forbids indexing"
 msgstr "Le META tag Robots interdit d'indexer"
 
-#: UI/GTK2/src/WorkerThreads.cpp:119
+#: UI/GTK2/src/WorkerThreads.cpp:120
 msgid "No monitoring handler"
 msgstr "Pas de moniteur de fichiers disponible"
 
-#: UI/GTK2/src/WorkerThreads.cpp:415
+#: UI/GTK2/src/WorkerThreads.cpp:416
 msgid "Indexing was stopped"
 msgstr "Indexation est arretee"
 
-#: UI/GTK2/src/WorkerThreads.cpp:428
+#: UI/GTK2/src/WorkerThreads.cpp:429
 msgid "Can't index mail here"
 msgstr "Ne peut pas indexer le courrier ici"
 
-#: UI/GTK2/src/WorkerThreads.cpp:449 UI/GTK2/src/WorkerThreads.cpp:704
+#: UI/GTK2/src/WorkerThreads.cpp:450 UI/GTK2/src/WorkerThreads.cpp:715
 msgid "is already being indexed"
 msgstr "est deja indexe"
 
-#: UI/GTK2/src/WorkerThreads.cpp:459
+#: UI/GTK2/src/WorkerThreads.cpp:460
 msgid "is blacklisted"
 msgstr "est exclus"
 
-#: UI/GTK2/src/WorkerThreads.cpp:961
+#: UI/GTK2/src/WorkerThreads.cpp:972
 msgid "No title"
 msgstr "Pas de titre"

Modified: trunk/po/it.po
===================================================================
--- trunk/po/it.po	2008-05-05 12:07:50 UTC (rev 1241)
+++ trunk/po/it.po	2008-05-05 12:36:21 UTC (rev 1242)
@@ -4,9 +4,9 @@
 #
 msgid ""
 msgstr ""
-"Project-Id-Version: pinot 0.83\n"
+"Project-Id-Version: pinot 0.85\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2008-03-26 14:43+0800\n"
+"POT-Creation-Date: 2008-05-04 22:14+0800\n"
 "PO-Revision-Date: 2008-01-15 00:09+0000\n"
 "Last-Translator: Marco Bazzani <visitors at libero.it>\n"
 "Language-Team: Italian <it at li.org>\n"
@@ -34,7 +34,7 @@
 #: UI/GTK2/src/mainWindow.cc:1562 UI/GTK2/src/mainWindow.cc:2273
 #: UI/GTK2/src/PinotSettings.cpp:322 UI/GTK2/src/PinotSettings.cpp:1470
 #: UI/GTK2/src/PinotSettings.cpp:1526 UI/GTK2/src/statisticsDialog.cc:79
-#: UI/GTK2/src/WorkerThreads.cpp:998
+#: UI/GTK2/src/WorkerThreads.cpp:1009
 msgid "My Web Pages"
 msgstr "Pagine web personali"
 
@@ -43,7 +43,7 @@
 #: UI/GTK2/src/mainWindow.cc:978 UI/GTK2/src/mainWindow.cc:1287
 #: UI/GTK2/src/mainWindow.cc:2277 UI/GTK2/src/PinotSettings.cpp:323
 #: UI/GTK2/src/PinotSettings.cpp:1471 UI/GTK2/src/PinotSettings.cpp:1527
-#: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:1008
+#: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:1019
 msgid "My Documents"
 msgstr "Documenti personali"
 
@@ -497,67 +497,67 @@
 msgstr "Pinot"
 
 #. Localize language names
-#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:431
+#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:492
 msgid "Unknown"
 msgstr "Sconosciuto"
 
-#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:432
+#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:493
 msgid "Danish"
 msgstr "Danese"
 
-#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:433
+#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:494
 msgid "Dutch"
 msgstr "Olandese"
 
-#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:434
+#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:495
 msgid "English"
 msgstr "Inglese"
 
-#: UI/GTK2/src/pinot.cc:240 UI/GTK2/src/pinot-dbus-daemon.cc:435
+#: UI/GTK2/src/pinot.cc:240 UI/GTK2/src/pinot-dbus-daemon.cc:496
 msgid "Finnish"
 msgstr "Finlandese"
 
-#: UI/GTK2/src/pinot.cc:241 UI/GTK2/src/pinot-dbus-daemon.cc:436
+#: UI/GTK2/src/pinot.cc:241 UI/GTK2/src/pinot-dbus-daemon.cc:497
 msgid "French"
 msgstr "Francese"
 
-#: UI/GTK2/src/pinot.cc:242 UI/GTK2/src/pinot-dbus-daemon.cc:437
+#: UI/GTK2/src/pinot.cc:242 UI/GTK2/src/pinot-dbus-daemon.cc:498
 msgid "German"
 msgstr "Tedesco"
 
-#: UI/GTK2/src/pinot.cc:243 UI/GTK2/src/pinot-dbus-daemon.cc:438
+#: UI/GTK2/src/pinot.cc:243 UI/GTK2/src/pinot-dbus-daemon.cc:499
 msgid "Hungarian"
 msgstr ""
 
-#: UI/GTK2/src/pinot.cc:244 UI/GTK2/src/pinot-dbus-daemon.cc:439
+#: UI/GTK2/src/pinot.cc:244 UI/GTK2/src/pinot-dbus-daemon.cc:500
 msgid "Italian"
 msgstr "Italiano"
 
-#: UI/GTK2/src/pinot.cc:245 UI/GTK2/src/pinot-dbus-daemon.cc:440
+#: UI/GTK2/src/pinot.cc:245 UI/GTK2/src/pinot-dbus-daemon.cc:501
 msgid "Norwegian"
 msgstr "Norvegese"
 
-#: UI/GTK2/src/pinot.cc:246 UI/GTK2/src/pinot-dbus-daemon.cc:441
+#: UI/GTK2/src/pinot.cc:246 UI/GTK2/src/pinot-dbus-daemon.cc:502
 msgid "Portuguese"
 msgstr "Portoghese"
 
-#: UI/GTK2/src/pinot.cc:247 UI/GTK2/src/pinot-dbus-daemon.cc:442
+#: UI/GTK2/src/pinot.cc:247 UI/GTK2/src/pinot-dbus-daemon.cc:503
 msgid "Romanian"
 msgstr ""
 
-#: UI/GTK2/src/pinot.cc:248 UI/GTK2/src/pinot-dbus-daemon.cc:443
+#: UI/GTK2/src/pinot.cc:248 UI/GTK2/src/pinot-dbus-daemon.cc:504
 msgid "Russian"
 msgstr "Russo"
 
-#: UI/GTK2/src/pinot.cc:249 UI/GTK2/src/pinot-dbus-daemon.cc:444
+#: UI/GTK2/src/pinot.cc:249 UI/GTK2/src/pinot-dbus-daemon.cc:505
 msgid "Spanish"
 msgstr "Spagnolo"
 
-#: UI/GTK2/src/pinot.cc:250 UI/GTK2/src/pinot-dbus-daemon.cc:445
+#: UI/GTK2/src/pinot.cc:250 UI/GTK2/src/pinot-dbus-daemon.cc:506
 msgid "Swedish"
 msgstr "Svedese"
 
-#: UI/GTK2/src/pinot.cc:251 UI/GTK2/src/pinot-dbus-daemon.cc:446
+#: UI/GTK2/src/pinot.cc:251 UI/GTK2/src/pinot-dbus-daemon.cc:507
 msgid "Turkish"
 msgstr ""
 
@@ -854,7 +854,7 @@
 msgstr "documenti"
 
 #: UI/GTK2/src/statisticsDialog.cc:151 UI/GTK2/src/statisticsDialog.cc:169
-#: UI/GTK2/src/WorkerThreads.cpp:124
+#: UI/GTK2/src/WorkerThreads.cpp:125
 msgid "Unknown error"
 msgstr "errore Sconosciuto"
 
@@ -895,88 +895,88 @@
 msgid "Errors"
 msgstr "Errori"
 
-#: UI/GTK2/src/WorkerThreads.cpp:91
+#: UI/GTK2/src/WorkerThreads.cpp:92
 #, fuzzy
 msgid "Index error"
 msgstr "Errori indice su"
 
-#: UI/GTK2/src/WorkerThreads.cpp:93
+#: UI/GTK2/src/WorkerThreads.cpp:94
 #, fuzzy
 msgid "Couldn't index document"
 msgstr "Impossiible rimuovere i(l) documento/i dall'indice"
 
-#: UI/GTK2/src/WorkerThreads.cpp:95
+#: UI/GTK2/src/WorkerThreads.cpp:96
 msgid "Couldn't update document"
 msgstr "Impossibile aggiornare il documento"
 
-#: UI/GTK2/src/WorkerThreads.cpp:97
+#: UI/GTK2/src/WorkerThreads.cpp:98
 msgid "Couldn't unindex document(s)"
 msgstr "Impossiible rimuovere i(l) documento/i dall'indice"
 
-#: UI/GTK2/src/WorkerThreads.cpp:99
+#: UI/GTK2/src/WorkerThreads.cpp:100
 msgid "Couldn't run query on search engine"
 msgstr "Impossibile avviare un query sul motore di ricerca"
 
-#: UI/GTK2/src/WorkerThreads.cpp:101
+#: UI/GTK2/src/WorkerThreads.cpp:102
 #, fuzzy
 msgid "Couldn't get history for search engine"
 msgstr "Impossibile avviare un query sul motore di ricerca"
 
-#: UI/GTK2/src/WorkerThreads.cpp:103
+#: UI/GTK2/src/WorkerThreads.cpp:104
 #, fuzzy
 msgid "Couldn't retrieve document"
 msgstr "Impossibile aggiornare il documento"
 
-#: UI/GTK2/src/WorkerThreads.cpp:105
+#: UI/GTK2/src/WorkerThreads.cpp:106
 msgid "File monitor error"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:107
+#: UI/GTK2/src/WorkerThreads.cpp:108
 msgid "Couldn't open directory"
 msgstr "Impossibile aprire la directory"
 
-#: UI/GTK2/src/WorkerThreads.cpp:109
+#: UI/GTK2/src/WorkerThreads.cpp:110
 #, fuzzy
 msgid "Index doesn't exist"
 msgstr "non esiste"
 
-#: UI/GTK2/src/WorkerThreads.cpp:111
+#: UI/GTK2/src/WorkerThreads.cpp:112
 msgid "Couldn't create search engine"
 msgstr "Impossibile creare un motore di ricerca"
 
-#: UI/GTK2/src/WorkerThreads.cpp:113
+#: UI/GTK2/src/WorkerThreads.cpp:114
 msgid "Cannot index document type"
 msgstr "Impossibile indicizzare tipo di documento"
 
-#: UI/GTK2/src/WorkerThreads.cpp:115
+#: UI/GTK2/src/WorkerThreads.cpp:116
 #, fuzzy
 msgid "No downloader for this protocol"
 msgstr "Impossibile ottenere un downloader per il protocollo"
 
-#: UI/GTK2/src/WorkerThreads.cpp:117
+#: UI/GTK2/src/WorkerThreads.cpp:118
 msgid "Robots META tag forbids indexing"
 msgstr "il Robots META tag vieta l'indicizzazione"
 
-#: UI/GTK2/src/WorkerThreads.cpp:119
+#: UI/GTK2/src/WorkerThreads.cpp:120
 msgid "No monitoring handler"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:415
+#: UI/GTK2/src/WorkerThreads.cpp:416
 msgid "Indexing was stopped"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:428
+#: UI/GTK2/src/WorkerThreads.cpp:429
 msgid "Can't index mail here"
 msgstr "Impossibile indicizzare la mail qui"
 
-#: UI/GTK2/src/WorkerThreads.cpp:449 UI/GTK2/src/WorkerThreads.cpp:704
+#: UI/GTK2/src/WorkerThreads.cpp:450 UI/GTK2/src/WorkerThreads.cpp:715
 msgid "is already being indexed"
 msgstr "? gia' stato indicizzato"
 
-#: UI/GTK2/src/WorkerThreads.cpp:459
+#: UI/GTK2/src/WorkerThreads.cpp:460
 msgid "is blacklisted"
 msgstr "e' blacklistato"
 
-#: UI/GTK2/src/WorkerThreads.cpp:961
+#: UI/GTK2/src/WorkerThreads.cpp:972
 msgid "No title"
 msgstr "Nessun titolo"

Modified: trunk/po/ja.po
===================================================================
--- trunk/po/ja.po	2008-05-05 12:07:50 UTC (rev 1241)
+++ trunk/po/ja.po	2008-05-05 12:36:21 UTC (rev 1242)
@@ -5,9 +5,9 @@
 #
 msgid ""
 msgstr ""
-"Project-Id-Version: pinot\n"
+"Project-Id-Version: pinot 0.85\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2008-04-26 09:55+0800\n"
+"POT-Creation-Date: 2008-05-04 22:14+0800\n"
 "PO-Revision-Date: 2008-04-14 04:25+0000\n"
 "Last-Translator: Takeo Mizuki <Unknown>\n"
 "Language-Team: Japanese <ja at li.org>\n"
@@ -35,7 +35,7 @@
 #: UI/GTK2/src/mainWindow.cc:1562 UI/GTK2/src/mainWindow.cc:2273
 #: UI/GTK2/src/PinotSettings.cpp:322 UI/GTK2/src/PinotSettings.cpp:1470
 #: UI/GTK2/src/PinotSettings.cpp:1526 UI/GTK2/src/statisticsDialog.cc:79
-#: UI/GTK2/src/WorkerThreads.cpp:1019
+#: UI/GTK2/src/WorkerThreads.cpp:1009
 msgid "My Web Pages"
 msgstr "????????"
 
@@ -44,7 +44,7 @@
 #: UI/GTK2/src/mainWindow.cc:978 UI/GTK2/src/mainWindow.cc:1287
 #: UI/GTK2/src/mainWindow.cc:2277 UI/GTK2/src/PinotSettings.cpp:323
 #: UI/GTK2/src/PinotSettings.cpp:1471 UI/GTK2/src/PinotSettings.cpp:1527
-#: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:1029
+#: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:1019
 msgid "My Documents"
 msgstr "????????"
 
@@ -862,7 +862,7 @@
 msgstr "??"
 
 #: UI/GTK2/src/statisticsDialog.cc:151 UI/GTK2/src/statisticsDialog.cc:169
-#: UI/GTK2/src/WorkerThreads.cpp:124
+#: UI/GTK2/src/WorkerThreads.cpp:125
 msgid "Unknown error"
 msgstr "??????"
 
@@ -903,86 +903,86 @@
 msgid "Errors"
 msgstr "???"
 
-#: UI/GTK2/src/WorkerThreads.cpp:91
+#: UI/GTK2/src/WorkerThreads.cpp:92
 msgid "Index error"
 msgstr "?????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:93
+#: UI/GTK2/src/WorkerThreads.cpp:94
 msgid "Couldn't index document"
 msgstr "?????????????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:95
+#: UI/GTK2/src/WorkerThreads.cpp:96
 msgid "Couldn't update document"
 msgstr "??????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:97
+#: UI/GTK2/src/WorkerThreads.cpp:98
 msgid "Couldn't unindex document(s)"
 msgstr "??????????????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:99
+#: UI/GTK2/src/WorkerThreads.cpp:100
 msgid "Couldn't run query on search engine"
 msgstr "???????????????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:101
+#: UI/GTK2/src/WorkerThreads.cpp:102
 msgid "Couldn't get history for search engine"
 msgstr "??????????????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:103
+#: UI/GTK2/src/WorkerThreads.cpp:104
 msgid "Couldn't retrieve document"
 msgstr "??????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:105
+#: UI/GTK2/src/WorkerThreads.cpp:106
 msgid "File monitor error"
 msgstr "???????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:107
+#: UI/GTK2/src/WorkerThreads.cpp:108
 msgid "Couldn't open directory"
 msgstr "????????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:109
+#: UI/GTK2/src/WorkerThreads.cpp:110
 #, fuzzy
 msgid "Index doesn't exist"
 msgstr "?????????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:111
+#: UI/GTK2/src/WorkerThreads.cpp:112
 msgid "Couldn't create search engine"
 msgstr "??????????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:113
+#: UI/GTK2/src/WorkerThreads.cpp:114
 msgid "Cannot index document type"
 msgstr "????????????????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:115
+#: UI/GTK2/src/WorkerThreads.cpp:116
 msgid "No downloader for this protocol"
 msgstr "????????????????????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:117
+#: UI/GTK2/src/WorkerThreads.cpp:118
 msgid "Robots META tag forbids indexing"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:119
+#: UI/GTK2/src/WorkerThreads.cpp:120
 msgid "No monitoring handler"
 msgstr "?????????????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:415
+#: UI/GTK2/src/WorkerThreads.cpp:416
 #, fuzzy
 msgid "Indexing was stopped"
 msgstr "???????????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:428
+#: UI/GTK2/src/WorkerThreads.cpp:429
 msgid "Can't index mail here"
 msgstr "??????????????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:449 UI/GTK2/src/WorkerThreads.cpp:725
+#: UI/GTK2/src/WorkerThreads.cpp:450 UI/GTK2/src/WorkerThreads.cpp:715
 #, fuzzy
 msgid "is already being indexed"
 msgstr "??????????????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:459
+#: UI/GTK2/src/WorkerThreads.cpp:460
 #, fuzzy
 msgid "is blacklisted"
 msgstr "?????????????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:982
+#: UI/GTK2/src/WorkerThreads.cpp:972
 msgid "No title"
 msgstr "??????"

Modified: trunk/po/nl.po
===================================================================
--- trunk/po/nl.po	2008-05-05 12:07:50 UTC (rev 1241)
+++ trunk/po/nl.po	2008-05-05 12:36:21 UTC (rev 1242)
@@ -4,9 +4,9 @@
 #
 msgid ""
 msgstr ""
-"Project-Id-Version: pinot 0.83\n"
+"Project-Id-Version: pinot 0.85\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2008-03-26 14:43+0800\n"
+"POT-Creation-Date: 2008-05-04 22:14+0800\n"
 "PO-Revision-Date: 2008-01-15 00:13+0000\n"
 "Last-Translator: JW <jw00000 at gmail.com>\n"
 "Language-Team: Dutch <nl at li.org>\n"
@@ -34,7 +34,7 @@
 #: UI/GTK2/src/mainWindow.cc:1562 UI/GTK2/src/mainWindow.cc:2273
 #: UI/GTK2/src/PinotSettings.cpp:322 UI/GTK2/src/PinotSettings.cpp:1470
 #: UI/GTK2/src/PinotSettings.cpp:1526 UI/GTK2/src/statisticsDialog.cc:79
-#: UI/GTK2/src/WorkerThreads.cpp:998
+#: UI/GTK2/src/WorkerThreads.cpp:1009
 msgid "My Web Pages"
 msgstr "Mijn webpagina's"
 
@@ -43,7 +43,7 @@
 #: UI/GTK2/src/mainWindow.cc:978 UI/GTK2/src/mainWindow.cc:1287
 #: UI/GTK2/src/mainWindow.cc:2277 UI/GTK2/src/PinotSettings.cpp:323
 #: UI/GTK2/src/PinotSettings.cpp:1471 UI/GTK2/src/PinotSettings.cpp:1527
-#: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:1008
+#: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:1019
 msgid "My Documents"
 msgstr "Mijn documenten"
 
@@ -491,67 +491,67 @@
 msgstr "Pinot"
 
 #. Localize language names
-#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:431
+#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:492
 msgid "Unknown"
 msgstr "Niet bekend"
 
-#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:432
+#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:493
 msgid "Danish"
 msgstr "Deens"
 
-#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:433
+#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:494
 msgid "Dutch"
 msgstr "Nederlands"
 
-#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:434
+#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:495
 msgid "English"
 msgstr "Engels"
 
-#: UI/GTK2/src/pinot.cc:240 UI/GTK2/src/pinot-dbus-daemon.cc:435
+#: UI/GTK2/src/pinot.cc:240 UI/GTK2/src/pinot-dbus-daemon.cc:496
 msgid "Finnish"
 msgstr "Fins"
 
-#: UI/GTK2/src/pinot.cc:241 UI/GTK2/src/pinot-dbus-daemon.cc:436
+#: UI/GTK2/src/pinot.cc:241 UI/GTK2/src/pinot-dbus-daemon.cc:497
 msgid "French"
 msgstr "Frans"
 
-#: UI/GTK2/src/pinot.cc:242 UI/GTK2/src/pinot-dbus-daemon.cc:437
+#: UI/GTK2/src/pinot.cc:242 UI/GTK2/src/pinot-dbus-daemon.cc:498
 msgid "German"
 msgstr "Duits"
 
-#: UI/GTK2/src/pinot.cc:243 UI/GTK2/src/pinot-dbus-daemon.cc:438
+#: UI/GTK2/src/pinot.cc:243 UI/GTK2/src/pinot-dbus-daemon.cc:499
 msgid "Hungarian"
 msgstr "Hongaars"
 
-#: UI/GTK2/src/pinot.cc:244 UI/GTK2/src/pinot-dbus-daemon.cc:439
+#: UI/GTK2/src/pinot.cc:244 UI/GTK2/src/pinot-dbus-daemon.cc:500
 msgid "Italian"
 msgstr "Italiaans"
 
-#: UI/GTK2/src/pinot.cc:245 UI/GTK2/src/pinot-dbus-daemon.cc:440
+#: UI/GTK2/src/pinot.cc:245 UI/GTK2/src/pinot-dbus-daemon.cc:501
 msgid "Norwegian"
 msgstr "Noors"
 
-#: UI/GTK2/src/pinot.cc:246 UI/GTK2/src/pinot-dbus-daemon.cc:441
+#: UI/GTK2/src/pinot.cc:246 UI/GTK2/src/pinot-dbus-daemon.cc:502
 msgid "Portuguese"
 msgstr "Portugees"
 
-#: UI/GTK2/src/pinot.cc:247 UI/GTK2/src/pinot-dbus-daemon.cc:442
+#: UI/GTK2/src/pinot.cc:247 UI/GTK2/src/pinot-dbus-daemon.cc:503
 msgid "Romanian"
 msgstr "Roemeens"
 
-#: UI/GTK2/src/pinot.cc:248 UI/GTK2/src/pinot-dbus-daemon.cc:443
+#: UI/GTK2/src/pinot.cc:248 UI/GTK2/src/pinot-dbus-daemon.cc:504
 msgid "Russian"
 msgstr "Russisch"
 
-#: UI/GTK2/src/pinot.cc:249 UI/GTK2/src/pinot-dbus-daemon.cc:444
+#: UI/GTK2/src/pinot.cc:249 UI/GTK2/src/pinot-dbus-daemon.cc:505
 msgid "Spanish"
 msgstr "Spaans"
 
-#: UI/GTK2/src/pinot.cc:250 UI/GTK2/src/pinot-dbus-daemon.cc:445
+#: UI/GTK2/src/pinot.cc:250 UI/GTK2/src/pinot-dbus-daemon.cc:506
 msgid "Swedish"
 msgstr "Zweeds"
 
-#: UI/GTK2/src/pinot.cc:251 UI/GTK2/src/pinot-dbus-daemon.cc:446
+#: UI/GTK2/src/pinot.cc:251 UI/GTK2/src/pinot-dbus-daemon.cc:507
 msgid "Turkish"
 msgstr "Turks"
 
@@ -844,7 +844,7 @@
 msgstr "documenten"
 
 #: UI/GTK2/src/statisticsDialog.cc:151 UI/GTK2/src/statisticsDialog.cc:169
-#: UI/GTK2/src/WorkerThreads.cpp:124
+#: UI/GTK2/src/WorkerThreads.cpp:125
 msgid "Unknown error"
 msgstr "Onbekende fout."
 
@@ -885,82 +885,82 @@
 msgid "Errors"
 msgstr "Fouten"
 
-#: UI/GTK2/src/WorkerThreads.cpp:91
+#: UI/GTK2/src/WorkerThreads.cpp:92
 msgid "Index error"
 msgstr "Indexfout"
 
-#: UI/GTK2/src/WorkerThreads.cpp:93
+#: UI/GTK2/src/WorkerThreads.cpp:94
 msgid "Couldn't index document"
 msgstr "Het document kon niet ge?ndexeerd worden"
 
-#: UI/GTK2/src/WorkerThreads.cpp:95
+#: UI/GTK2/src/WorkerThreads.cpp:96
 msgid "Couldn't update document"
 msgstr "Kan document niet actualiseren"
 
-#: UI/GTK2/src/WorkerThreads.cpp:97
+#: UI/GTK2/src/WorkerThreads.cpp:98
 msgid "Couldn't unindex document(s)"
 msgstr "Kan indexering van bestand(en) niet ongedaan maken"
 
-#: UI/GTK2/src/WorkerThreads.cpp:99
+#: UI/GTK2/src/WorkerThreads.cpp:100
 msgid "Couldn't run query on search engine"
 msgstr "Kon query niet uitvoeren op zoekmachine"
 
-#: UI/GTK2/src/WorkerThreads.cpp:101
+#: UI/GTK2/src/WorkerThreads.cpp:102
 msgid "Couldn't get history for search engine"
 msgstr "De geschiedenis voor de zoekmachine kon niet verkregen worden"
 
-#: UI/GTK2/src/WorkerThreads.cpp:103
+#: UI/GTK2/src/WorkerThreads.cpp:104
 msgid "Couldn't retrieve document"
 msgstr "Het document kon niet verkregen worden"
 
-#: UI/GTK2/src/WorkerThreads.cpp:105
+#: UI/GTK2/src/WorkerThreads.cpp:106
 msgid "File monitor error"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:107
+#: UI/GTK2/src/WorkerThreads.cpp:108
 msgid "Couldn't open directory"
 msgstr "De map kon niet geopend worden"
 
-#: UI/GTK2/src/WorkerThreads.cpp:109
+#: UI/GTK2/src/WorkerThreads.cpp:110
 msgid "Index doesn't exist"
 msgstr "De index bestaat niet"
 
-#: UI/GTK2/src/WorkerThreads.cpp:111
+#: UI/GTK2/src/WorkerThreads.cpp:112
 msgid "Couldn't create search engine"
 msgstr "Kon zoekmachine niet maken"
 
-#: UI/GTK2/src/WorkerThreads.cpp:113
+#: UI/GTK2/src/WorkerThreads.cpp:114
 msgid "Cannot index document type"
 msgstr "Kan documenttype niet indexeren"
 
-#: UI/GTK2/src/WorkerThreads.cpp:115
+#: UI/GTK2/src/WorkerThreads.cpp:116
 msgid "No downloader for this protocol"
 msgstr "Er is geen downloader voor dit protocol"
 
-#: UI/GTK2/src/WorkerThreads.cpp:117
+#: UI/GTK2/src/WorkerThreads.cpp:118
 msgid "Robots META tag forbids indexing"
 msgstr "Robots META taf verbiedt indexeren"
 
-#: UI/GTK2/src/WorkerThreads.cpp:119
+#: UI/GTK2/src/WorkerThreads.cpp:120
 msgid "No monitoring handler"
 msgstr "Geen monitoring handler"
 
-#: UI/GTK2/src/WorkerThreads.cpp:415
+#: UI/GTK2/src/WorkerThreads.cpp:416
 msgid "Indexing was stopped"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:428
+#: UI/GTK2/src/WorkerThreads.cpp:429
 msgid "Can't index mail here"
 msgstr "Kan mail hier niet indexeren"
 
-#: UI/GTK2/src/WorkerThreads.cpp:449 UI/GTK2/src/WorkerThreads.cpp:704
+#: UI/GTK2/src/WorkerThreads.cpp:450 UI/GTK2/src/WorkerThreads.cpp:715
 msgid "is already being indexed"
 msgstr "wordt al geindexeerd"
 
-#: UI/GTK2/src/WorkerThreads.cpp:459
+#: UI/GTK2/src/WorkerThreads.cpp:460
 msgid "is blacklisted"
 msgstr "staat op blacklist"
 
-#: UI/GTK2/src/WorkerThreads.cpp:961
+#: UI/GTK2/src/WorkerThreads.cpp:972
 msgid "No title"
 msgstr "Geen titel"

Modified: trunk/po/pt.po
===================================================================
--- trunk/po/pt.po	2008-05-05 12:07:50 UTC (rev 1241)
+++ trunk/po/pt.po	2008-05-05 12:36:21 UTC (rev 1242)
@@ -4,9 +4,9 @@
 #
 msgid ""
 msgstr ""
-"Project-Id-Version: pinot 0.83\n"
+"Project-Id-Version: pinot 0.85\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2008-03-26 14:43+0800\n"
+"POT-Creation-Date: 2008-05-04 22:14+0800\n"
 "PO-Revision-Date: 2008-01-15 00:12+0000\n"
 "Last-Translator: _PN_boy <pedro_nuno_pn at iol.pt>\n"
 "Language-Team: Portuguese <pt at li.org>\n"
@@ -35,7 +35,7 @@
 #: UI/GTK2/src/mainWindow.cc:1562 UI/GTK2/src/mainWindow.cc:2273
 #: UI/GTK2/src/PinotSettings.cpp:322 UI/GTK2/src/PinotSettings.cpp:1470
 #: UI/GTK2/src/PinotSettings.cpp:1526 UI/GTK2/src/statisticsDialog.cc:79
-#: UI/GTK2/src/WorkerThreads.cpp:998
+#: UI/GTK2/src/WorkerThreads.cpp:1009
 msgid "My Web Pages"
 msgstr "As minhas p?ginas Web"
 
@@ -44,7 +44,7 @@
 #: UI/GTK2/src/mainWindow.cc:978 UI/GTK2/src/mainWindow.cc:1287
 #: UI/GTK2/src/mainWindow.cc:2277 UI/GTK2/src/PinotSettings.cpp:323
 #: UI/GTK2/src/PinotSettings.cpp:1471 UI/GTK2/src/PinotSettings.cpp:1527
-#: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:1008
+#: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:1019
 msgid "My Documents"
 msgstr "Os Meus Documentos"
 
@@ -498,67 +498,67 @@
 msgstr "Pinot"
 
 #. Localize language names
-#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:431
+#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:492
 msgid "Unknown"
 msgstr "Desconhecido"
 
-#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:432
+#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:493
 msgid "Danish"
 msgstr "Dinamarqu?s"
 
-#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:433
+#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:494
 msgid "Dutch"
 msgstr "Holand?s"
 
-#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:434
+#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:495
 msgid "English"
 msgstr "Ingl?s"
 
-#: UI/GTK2/src/pinot.cc:240 UI/GTK2/src/pinot-dbus-daemon.cc:435
+#: UI/GTK2/src/pinot.cc:240 UI/GTK2/src/pinot-dbus-daemon.cc:496
 msgid "Finnish"
 msgstr "Finl?ndes"
 
-#: UI/GTK2/src/pinot.cc:241 UI/GTK2/src/pinot-dbus-daemon.cc:436
+#: UI/GTK2/src/pinot.cc:241 UI/GTK2/src/pinot-dbus-daemon.cc:497
 msgid "French"
 msgstr "Franc?s"
 
-#: UI/GTK2/src/pinot.cc:242 UI/GTK2/src/pinot-dbus-daemon.cc:437
+#: UI/GTK2/src/pinot.cc:242 UI/GTK2/src/pinot-dbus-daemon.cc:498
 msgid "German"
 msgstr "Alem?o"
 
-#: UI/GTK2/src/pinot.cc:243 UI/GTK2/src/pinot-dbus-daemon.cc:438
+#: UI/GTK2/src/pinot.cc:243 UI/GTK2/src/pinot-dbus-daemon.cc:499
 msgid "Hungarian"
 msgstr "H?ngaro"
 
-#: UI/GTK2/src/pinot.cc:244 UI/GTK2/src/pinot-dbus-daemon.cc:439
+#: UI/GTK2/src/pinot.cc:244 UI/GTK2/src/pinot-dbus-daemon.cc:500
 msgid "Italian"
 msgstr "Italiano"
 
-#: UI/GTK2/src/pinot.cc:245 UI/GTK2/src/pinot-dbus-daemon.cc:440
+#: UI/GTK2/src/pinot.cc:245 UI/GTK2/src/pinot-dbus-daemon.cc:501
 msgid "Norwegian"
 msgstr "Noruegu?s"
 
-#: UI/GTK2/src/pinot.cc:246 UI/GTK2/src/pinot-dbus-daemon.cc:441
+#: UI/GTK2/src/pinot.cc:246 UI/GTK2/src/pinot-dbus-daemon.cc:502
 msgid "Portuguese"
 msgstr "Portugu?s"
 
-#: UI/GTK2/src/pinot.cc:247 UI/GTK2/src/pinot-dbus-daemon.cc:442
+#: UI/GTK2/src/pinot.cc:247 UI/GTK2/src/pinot-dbus-daemon.cc:503
 msgid "Romanian"
 msgstr "Romeno"
 
-#: UI/GTK2/src/pinot.cc:248 UI/GTK2/src/pinot-dbus-daemon.cc:443
+#: UI/GTK2/src/pinot.cc:248 UI/GTK2/src/pinot-dbus-daemon.cc:504
 msgid "Russian"
 msgstr "Russo"
 
-#: UI/GTK2/src/pinot.cc:249 UI/GTK2/src/pinot-dbus-daemon.cc:444
+#: UI/GTK2/src/pinot.cc:249 UI/GTK2/src/pinot-dbus-daemon.cc:505
 msgid "Spanish"
 msgstr "Espanhol"
 
-#: UI/GTK2/src/pinot.cc:250 UI/GTK2/src/pinot-dbus-daemon.cc:445
+#: UI/GTK2/src/pinot.cc:250 UI/GTK2/src/pinot-dbus-daemon.cc:506
 msgid "Swedish"
 msgstr "Sueco"
 
-#: UI/GTK2/src/pinot.cc:251 UI/GTK2/src/pinot-dbus-daemon.cc:446
+#: UI/GTK2/src/pinot.cc:251 UI/GTK2/src/pinot-dbus-daemon.cc:507
 msgid "Turkish"
 msgstr "Turco"
 
@@ -854,7 +854,7 @@
 msgstr "documentos"
 
 #: UI/GTK2/src/statisticsDialog.cc:151 UI/GTK2/src/statisticsDialog.cc:169
-#: UI/GTK2/src/WorkerThreads.cpp:124
+#: UI/GTK2/src/WorkerThreads.cpp:125
 msgid "Unknown error"
 msgstr "Erro desconhecido"
 
@@ -895,89 +895,89 @@
 msgid "Errors"
 msgstr "Erros"
 
-#: UI/GTK2/src/WorkerThreads.cpp:91
+#: UI/GTK2/src/WorkerThreads.cpp:92
 #, fuzzy
 msgid "Index error"
 msgstr "Erro na indexa??o em"
 
-#: UI/GTK2/src/WorkerThreads.cpp:93
+#: UI/GTK2/src/WorkerThreads.cpp:94
 #, fuzzy
 msgid "Couldn't index document"
 msgstr "N?o foi poss?vel remover documento(s) do ?ndice"
 
-#: UI/GTK2/src/WorkerThreads.cpp:95
+#: UI/GTK2/src/WorkerThreads.cpp:96
 msgid "Couldn't update document"
 msgstr "N?o foi poss?vel actualizar o documento"
 
-#: UI/GTK2/src/WorkerThreads.cpp:97
+#: UI/GTK2/src/WorkerThreads.cpp:98
 msgid "Couldn't unindex document(s)"
 msgstr "N?o foi poss?vel remover documento(s) do ?ndice"
 
-#: UI/GTK2/src/WorkerThreads.cpp:99
+#: UI/GTK2/src/WorkerThreads.cpp:100
 msgid "Couldn't run query on search engine"
 msgstr "N?o foi poss?vel efectuar consulta no mecanismo de pesquisa"
 
-#: UI/GTK2/src/WorkerThreads.cpp:101
+#: UI/GTK2/src/WorkerThreads.cpp:102
 #, fuzzy
 msgid "Couldn't get history for search engine"
 msgstr "N?o foi poss?vel efectuar consulta no mecanismo de pesquisa"
 
-#: UI/GTK2/src/WorkerThreads.cpp:103
+#: UI/GTK2/src/WorkerThreads.cpp:104
 #, fuzzy
 msgid "Couldn't retrieve document"
 msgstr "N?o foi poss?vel actualizar o documento"
 
-#: UI/GTK2/src/WorkerThreads.cpp:105
+#: UI/GTK2/src/WorkerThreads.cpp:106
 msgid "File monitor error"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:107
+#: UI/GTK2/src/WorkerThreads.cpp:108
 #, fuzzy
 msgid "Couldn't open directory"
 msgstr "N?o foi poss?vel abrir o ?ndice"
 
-#: UI/GTK2/src/WorkerThreads.cpp:109
+#: UI/GTK2/src/WorkerThreads.cpp:110
 #, fuzzy
 msgid "Index doesn't exist"
 msgstr "n?o existe"
 
-#: UI/GTK2/src/WorkerThreads.cpp:111
+#: UI/GTK2/src/WorkerThreads.cpp:112
 msgid "Couldn't create search engine"
 msgstr "N?o foi poss?vel criar mecanismo de pesquisa"
 
-#: UI/GTK2/src/WorkerThreads.cpp:113
+#: UI/GTK2/src/WorkerThreads.cpp:114
 msgid "Cannot index document type"
 msgstr "Imposs?vel indexar tipo de ficheiro"
 
-#: UI/GTK2/src/WorkerThreads.cpp:115
+#: UI/GTK2/src/WorkerThreads.cpp:116
 #, fuzzy
 msgid "No downloader for this protocol"
 msgstr "N?o foi poss?vel obter fonte de transfer?ncia para o protocolo"
 
-#: UI/GTK2/src/WorkerThreads.cpp:117
+#: UI/GTK2/src/WorkerThreads.cpp:118
 msgid "Robots META tag forbids indexing"
 msgstr "Robots META tag n?o s?o permitidos no ?ndice"
 
-#: UI/GTK2/src/WorkerThreads.cpp:119
+#: UI/GTK2/src/WorkerThreads.cpp:120
 msgid "No monitoring handler"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:415
+#: UI/GTK2/src/WorkerThreads.cpp:416
 msgid "Indexing was stopped"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:428
+#: UI/GTK2/src/WorkerThreads.cpp:429
 msgid "Can't index mail here"
 msgstr "N?o foi poss?vel indexar o mail aqui"
 
-#: UI/GTK2/src/WorkerThreads.cpp:449 UI/GTK2/src/WorkerThreads.cpp:704
+#: UI/GTK2/src/WorkerThreads.cpp:450 UI/GTK2/src/WorkerThreads.cpp:715
 msgid "is already being indexed"
 msgstr "j? est? a ser indexado"
 
-#: UI/GTK2/src/WorkerThreads.cpp:459
+#: UI/GTK2/src/WorkerThreads.cpp:460
 msgid "is blacklisted"
 msgstr "est? na lista negra"
 
-#: UI/GTK2/src/WorkerThreads.cpp:961
+#: UI/GTK2/src/WorkerThreads.cpp:972
 msgid "No title"
 msgstr "Sem t?tulo"

Modified: trunk/po/pt_BR.po
===================================================================
--- trunk/po/pt_BR.po	2008-05-05 12:07:50 UTC (rev 1241)
+++ trunk/po/pt_BR.po	2008-05-05 12:36:21 UTC (rev 1242)
@@ -4,9 +4,9 @@
 #
 msgid ""
 msgstr ""
-"Project-Id-Version: pinot 0.83\n"
+"Project-Id-Version: pinot 0.85\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2008-03-26 14:43+0800\n"
+"POT-Creation-Date: 2008-05-04 22:14+0800\n"
 "PO-Revision-Date: 2008-01-15 00:15+0000\n"
 "Last-Translator: Leonardo Melo <leonardovazmelo at gmail.com>\n"
 "Language-Team: Portuguese (Brazil) <pt_BR at li.org>\n"
@@ -34,7 +34,7 @@
 #: UI/GTK2/src/mainWindow.cc:1562 UI/GTK2/src/mainWindow.cc:2273
 #: UI/GTK2/src/PinotSettings.cpp:322 UI/GTK2/src/PinotSettings.cpp:1470
 #: UI/GTK2/src/PinotSettings.cpp:1526 UI/GTK2/src/statisticsDialog.cc:79
-#: UI/GTK2/src/WorkerThreads.cpp:998
+#: UI/GTK2/src/WorkerThreads.cpp:1009
 msgid "My Web Pages"
 msgstr "Minhas P?ginas Web"
 
@@ -43,7 +43,7 @@
 #: UI/GTK2/src/mainWindow.cc:978 UI/GTK2/src/mainWindow.cc:1287
 #: UI/GTK2/src/mainWindow.cc:2277 UI/GTK2/src/PinotSettings.cpp:323
 #: UI/GTK2/src/PinotSettings.cpp:1471 UI/GTK2/src/PinotSettings.cpp:1527
-#: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:1008
+#: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:1019
 msgid "My Documents"
 msgstr "Meus Documentos"
 
@@ -498,67 +498,67 @@
 msgstr "Pino"
 
 #. Localize language names
-#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:431
+#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:492
 msgid "Unknown"
 msgstr "Desconhecido"
 
-#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:432
+#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:493
 msgid "Danish"
 msgstr "Danish"
 
-#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:433
+#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:494
 msgid "Dutch"
 msgstr "Dutch"
 
-#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:434
+#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:495
 msgid "English"
 msgstr "English"
 
-#: UI/GTK2/src/pinot.cc:240 UI/GTK2/src/pinot-dbus-daemon.cc:435
+#: UI/GTK2/src/pinot.cc:240 UI/GTK2/src/pinot-dbus-daemon.cc:496
 msgid "Finnish"
 msgstr "Terminar"
 
-#: UI/GTK2/src/pinot.cc:241 UI/GTK2/src/pinot-dbus-daemon.cc:436
+#: UI/GTK2/src/pinot.cc:241 UI/GTK2/src/pinot-dbus-daemon.cc:497
 msgid "French"
 msgstr "French"
 
-#: UI/GTK2/src/pinot.cc:242 UI/GTK2/src/pinot-dbus-daemon.cc:437
+#: UI/GTK2/src/pinot.cc:242 UI/GTK2/src/pinot-dbus-daemon.cc:498
 msgid "German"
 msgstr "German"
 
-#: UI/GTK2/src/pinot.cc:243 UI/GTK2/src/pinot-dbus-daemon.cc:438
+#: UI/GTK2/src/pinot.cc:243 UI/GTK2/src/pinot-dbus-daemon.cc:499
 msgid "Hungarian"
 msgstr ""
 
-#: UI/GTK2/src/pinot.cc:244 UI/GTK2/src/pinot-dbus-daemon.cc:439
+#: UI/GTK2/src/pinot.cc:244 UI/GTK2/src/pinot-dbus-daemon.cc:500
 msgid "Italian"
 msgstr "Italian"
 
-#: UI/GTK2/src/pinot.cc:245 UI/GTK2/src/pinot-dbus-daemon.cc:440
+#: UI/GTK2/src/pinot.cc:245 UI/GTK2/src/pinot-dbus-daemon.cc:501
 msgid "Norwegian"
 msgstr "Norwegian"
 
-#: UI/GTK2/src/pinot.cc:246 UI/GTK2/src/pinot-dbus-daemon.cc:441
+#: UI/GTK2/src/pinot.cc:246 UI/GTK2/src/pinot-dbus-daemon.cc:502
 msgid "Portuguese"
 msgstr "Portugu?s"
 
-#: UI/GTK2/src/pinot.cc:247 UI/GTK2/src/pinot-dbus-daemon.cc:442
+#: UI/GTK2/src/pinot.cc:247 UI/GTK2/src/pinot-dbus-daemon.cc:503
 msgid "Romanian"
 msgstr ""
 
-#: UI/GTK2/src/pinot.cc:248 UI/GTK2/src/pinot-dbus-daemon.cc:443
+#: UI/GTK2/src/pinot.cc:248 UI/GTK2/src/pinot-dbus-daemon.cc:504
 msgid "Russian"
 msgstr "Russian"
 
-#: UI/GTK2/src/pinot.cc:249 UI/GTK2/src/pinot-dbus-daemon.cc:444
+#: UI/GTK2/src/pinot.cc:249 UI/GTK2/src/pinot-dbus-daemon.cc:505
 msgid "Spanish"
 msgstr "Spanish"
 
-#: UI/GTK2/src/pinot.cc:250 UI/GTK2/src/pinot-dbus-daemon.cc:445
+#: UI/GTK2/src/pinot.cc:250 UI/GTK2/src/pinot-dbus-daemon.cc:506
 msgid "Swedish"
 msgstr "Swedish"
 
-#: UI/GTK2/src/pinot.cc:251 UI/GTK2/src/pinot-dbus-daemon.cc:446
+#: UI/GTK2/src/pinot.cc:251 UI/GTK2/src/pinot-dbus-daemon.cc:507
 msgid "Turkish"
 msgstr ""
 
@@ -861,7 +861,7 @@
 msgstr "Meus Documentos"
 
 #: UI/GTK2/src/statisticsDialog.cc:151 UI/GTK2/src/statisticsDialog.cc:169
-#: UI/GTK2/src/WorkerThreads.cpp:124
+#: UI/GTK2/src/WorkerThreads.cpp:125
 msgid "Unknown error"
 msgstr ""
 
@@ -905,88 +905,88 @@
 msgid "Errors"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:91
+#: UI/GTK2/src/WorkerThreads.cpp:92
 #, fuzzy
 msgid "Index error"
 msgstr "Erro no ?ndice no"
 
-#: UI/GTK2/src/WorkerThreads.cpp:93
+#: UI/GTK2/src/WorkerThreads.cpp:94
 #, fuzzy
 msgid "Couldn't index document"
 msgstr "N?o foi poss?vel remover documento(s) do ?ndice"
 
-#: UI/GTK2/src/WorkerThreads.cpp:95
+#: UI/GTK2/src/WorkerThreads.cpp:96
 msgid "Couldn't update document"
 msgstr "N?o foi poss?vel atualizar documento"
 
-#: UI/GTK2/src/WorkerThreads.cpp:97
+#: UI/GTK2/src/WorkerThreads.cpp:98
 msgid "Couldn't unindex document(s)"
 msgstr "N?o foi poss?vel remover documento(s) do ?ndice"
 
-#: UI/GTK2/src/WorkerThreads.cpp:99
+#: UI/GTK2/src/WorkerThreads.cpp:100
 msgid "Couldn't run query on search engine"
 msgstr "N?o foi poss?vel executar consulta no mecanismo de pesquisa"
 
-#: UI/GTK2/src/WorkerThreads.cpp:101
+#: UI/GTK2/src/WorkerThreads.cpp:102
 #, fuzzy
 msgid "Couldn't get history for search engine"
 msgstr "N?o foi poss?vel executar consulta no mecanismo de pesquisa"
 
-#: UI/GTK2/src/WorkerThreads.cpp:103
+#: UI/GTK2/src/WorkerThreads.cpp:104
 #, fuzzy
 msgid "Couldn't retrieve document"
 msgstr "N?o foi poss?vel atualizar documento"
 
-#: UI/GTK2/src/WorkerThreads.cpp:105
+#: UI/GTK2/src/WorkerThreads.cpp:106
 msgid "File monitor error"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:107
+#: UI/GTK2/src/WorkerThreads.cpp:108
 msgid "Couldn't open directory"
 msgstr "N?o foi poss?vel abrir diret?rio"
 
-#: UI/GTK2/src/WorkerThreads.cpp:109
+#: UI/GTK2/src/WorkerThreads.cpp:110
 #, fuzzy
 msgid "Index doesn't exist"
 msgstr "n?o existe"
 
-#: UI/GTK2/src/WorkerThreads.cpp:111
+#: UI/GTK2/src/WorkerThreads.cpp:112
 msgid "Couldn't create search engine"
 msgstr "N?o foi poss?vel criar mecanismo de pesquisa"
 
-#: UI/GTK2/src/WorkerThreads.cpp:113
+#: UI/GTK2/src/WorkerThreads.cpp:114
 msgid "Cannot index document type"
 msgstr "Imposs?vel indexar tipo de arquivo"
 
-#: UI/GTK2/src/WorkerThreads.cpp:115
+#: UI/GTK2/src/WorkerThreads.cpp:116
 #, fuzzy
 msgid "No downloader for this protocol"
 msgstr "N?o foi poss?vel obter fonte de download para o protocolo"
 
-#: UI/GTK2/src/WorkerThreads.cpp:117
+#: UI/GTK2/src/WorkerThreads.cpp:118
 msgid "Robots META tag forbids indexing"
 msgstr "Robots META tag n?o s?o permitidos no ?ndice"
 
-#: UI/GTK2/src/WorkerThreads.cpp:119
+#: UI/GTK2/src/WorkerThreads.cpp:120
 msgid "No monitoring handler"
 msgstr "Nenhum manipulador de monitoramento"
 
-#: UI/GTK2/src/WorkerThreads.cpp:415
+#: UI/GTK2/src/WorkerThreads.cpp:416
 msgid "Indexing was stopped"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:428
+#: UI/GTK2/src/WorkerThreads.cpp:429
 msgid "Can't index mail here"
 msgstr "N?o foi poss?vel indexar mail aqui"
 
-#: UI/GTK2/src/WorkerThreads.cpp:449 UI/GTK2/src/WorkerThreads.cpp:704
+#: UI/GTK2/src/WorkerThreads.cpp:450 UI/GTK2/src/WorkerThreads.cpp:715
 msgid "is already being indexed"
 msgstr "j? est? sendo indexado"
 
-#: UI/GTK2/src/WorkerThreads.cpp:459
+#: UI/GTK2/src/WorkerThreads.cpp:460
 msgid "is blacklisted"
 msgstr "est? na lista negra"
 
-#: UI/GTK2/src/WorkerThreads.cpp:961
+#: UI/GTK2/src/WorkerThreads.cpp:972
 msgid "No title"
 msgstr "Sem t?tulo"

Modified: trunk/po/ru.po
===================================================================
--- trunk/po/ru.po	2008-05-05 12:07:50 UTC (rev 1241)
+++ trunk/po/ru.po	2008-05-05 12:36:21 UTC (rev 1242)
@@ -4,9 +4,9 @@
 #
 msgid ""
 msgstr ""
-"Project-Id-Version: pinot 0.83\n"
+"Project-Id-Version: pinot 0.85\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2008-03-26 14:43+0800\n"
+"POT-Creation-Date: 2008-05-04 22:14+0800\n"
 "PO-Revision-Date: 2008-01-15 00:16+0000\n"
 "Last-Translator: Sergey Vostrikov <s.vostrikov at gmail.com>\n"
 "Language-Team: Russian <ru at li.org>\n"
@@ -34,7 +34,7 @@
 #: UI/GTK2/src/mainWindow.cc:1562 UI/GTK2/src/mainWindow.cc:2273
 #: UI/GTK2/src/PinotSettings.cpp:322 UI/GTK2/src/PinotSettings.cpp:1470
 #: UI/GTK2/src/PinotSettings.cpp:1526 UI/GTK2/src/statisticsDialog.cc:79
-#: UI/GTK2/src/WorkerThreads.cpp:998
+#: UI/GTK2/src/WorkerThreads.cpp:1009
 msgid "My Web Pages"
 msgstr "??? web-????????"
 
@@ -43,7 +43,7 @@
 #: UI/GTK2/src/mainWindow.cc:978 UI/GTK2/src/mainWindow.cc:1287
 #: UI/GTK2/src/mainWindow.cc:2277 UI/GTK2/src/PinotSettings.cpp:323
 #: UI/GTK2/src/PinotSettings.cpp:1471 UI/GTK2/src/PinotSettings.cpp:1527
-#: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:1008
+#: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:1019
 msgid "My Documents"
 msgstr "??? ?????????"
 
@@ -498,67 +498,67 @@
 msgstr "Pinot"
 
 #. Localize language names
-#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:431
+#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:492
 msgid "Unknown"
 msgstr "???????????"
 
-#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:432
+#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:493
 msgid "Danish"
 msgstr "???????"
 
-#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:433
+#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:494
 msgid "Dutch"
 msgstr "???????????"
 
-#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:434
+#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:495
 msgid "English"
 msgstr "??????????"
 
-#: UI/GTK2/src/pinot.cc:240 UI/GTK2/src/pinot-dbus-daemon.cc:435
+#: UI/GTK2/src/pinot.cc:240 UI/GTK2/src/pinot-dbus-daemon.cc:496
 msgid "Finnish"
 msgstr "???????"
 
-#: UI/GTK2/src/pinot.cc:241 UI/GTK2/src/pinot-dbus-daemon.cc:436
+#: UI/GTK2/src/pinot.cc:241 UI/GTK2/src/pinot-dbus-daemon.cc:497
 msgid "French"
 msgstr "???????????"
 
-#: UI/GTK2/src/pinot.cc:242 UI/GTK2/src/pinot-dbus-daemon.cc:437
+#: UI/GTK2/src/pinot.cc:242 UI/GTK2/src/pinot-dbus-daemon.cc:498
 msgid "German"
 msgstr "????????"
 
-#: UI/GTK2/src/pinot.cc:243 UI/GTK2/src/pinot-dbus-daemon.cc:438
+#: UI/GTK2/src/pinot.cc:243 UI/GTK2/src/pinot-dbus-daemon.cc:499
 msgid "Hungarian"
 msgstr ""
 
-#: UI/GTK2/src/pinot.cc:244 UI/GTK2/src/pinot-dbus-daemon.cc:439
+#: UI/GTK2/src/pinot.cc:244 UI/GTK2/src/pinot-dbus-daemon.cc:500
 msgid "Italian"
 msgstr "???????????"
 
-#: UI/GTK2/src/pinot.cc:245 UI/GTK2/src/pinot-dbus-daemon.cc:440
+#: UI/GTK2/src/pinot.cc:245 UI/GTK2/src/pinot-dbus-daemon.cc:501
 msgid "Norwegian"
 msgstr "??????????"
 
-#: UI/GTK2/src/pinot.cc:246 UI/GTK2/src/pinot-dbus-daemon.cc:441
+#: UI/GTK2/src/pinot.cc:246 UI/GTK2/src/pinot-dbus-daemon.cc:502
 msgid "Portuguese"
 msgstr "?????????????"
 
-#: UI/GTK2/src/pinot.cc:247 UI/GTK2/src/pinot-dbus-daemon.cc:442
+#: UI/GTK2/src/pinot.cc:247 UI/GTK2/src/pinot-dbus-daemon.cc:503
 msgid "Romanian"
 msgstr ""
 
-#: UI/GTK2/src/pinot.cc:248 UI/GTK2/src/pinot-dbus-daemon.cc:443
+#: UI/GTK2/src/pinot.cc:248 UI/GTK2/src/pinot-dbus-daemon.cc:504
 msgid "Russian"
 msgstr "???????"
 
-#: UI/GTK2/src/pinot.cc:249 UI/GTK2/src/pinot-dbus-daemon.cc:444
+#: UI/GTK2/src/pinot.cc:249 UI/GTK2/src/pinot-dbus-daemon.cc:505
 msgid "Spanish"
 msgstr "?????????"
 
-#: UI/GTK2/src/pinot.cc:250 UI/GTK2/src/pinot-dbus-daemon.cc:445
+#: UI/GTK2/src/pinot.cc:250 UI/GTK2/src/pinot-dbus-daemon.cc:506
 msgid "Swedish"
 msgstr "????????"
 
-#: UI/GTK2/src/pinot.cc:251 UI/GTK2/src/pinot-dbus-daemon.cc:446
+#: UI/GTK2/src/pinot.cc:251 UI/GTK2/src/pinot-dbus-daemon.cc:507
 msgid "Turkish"
 msgstr ""
 
@@ -857,7 +857,7 @@
 msgstr "??? ?????????"
 
 #: UI/GTK2/src/statisticsDialog.cc:151 UI/GTK2/src/statisticsDialog.cc:169
-#: UI/GTK2/src/WorkerThreads.cpp:124
+#: UI/GTK2/src/WorkerThreads.cpp:125
 msgid "Unknown error"
 msgstr ""
 
@@ -901,88 +901,88 @@
 msgid "Errors"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:91
+#: UI/GTK2/src/WorkerThreads.cpp:92
 #, fuzzy
 msgid "Index error"
 msgstr "?????? ??????? ??"
 
-#: UI/GTK2/src/WorkerThreads.cpp:93
+#: UI/GTK2/src/WorkerThreads.cpp:94
 #, fuzzy
 msgid "Couldn't index document"
 msgstr "?????????? ??????????????? ????????(?)"
 
-#: UI/GTK2/src/WorkerThreads.cpp:95
+#: UI/GTK2/src/WorkerThreads.cpp:96
 msgid "Couldn't update document"
 msgstr "?????????? ???????? ????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:97
+#: UI/GTK2/src/WorkerThreads.cpp:98
 msgid "Couldn't unindex document(s)"
 msgstr "?????????? ??????????????? ????????(?)"
 
-#: UI/GTK2/src/WorkerThreads.cpp:99
+#: UI/GTK2/src/WorkerThreads.cpp:100
 msgid "Couldn't run query on search engine"
 msgstr "?? ??????? ????????? ?????? ? ????????? ???????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:101
+#: UI/GTK2/src/WorkerThreads.cpp:102
 #, fuzzy
 msgid "Couldn't get history for search engine"
 msgstr "?? ??????? ????????? ?????? ? ????????? ???????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:103
+#: UI/GTK2/src/WorkerThreads.cpp:104
 #, fuzzy
 msgid "Couldn't retrieve document"
 msgstr "?????????? ???????? ????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:105
+#: UI/GTK2/src/WorkerThreads.cpp:106
 msgid "File monitor error"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:107
+#: UI/GTK2/src/WorkerThreads.cpp:108
 msgid "Couldn't open directory"
 msgstr "?????????? ??????? ???????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:109
+#: UI/GTK2/src/WorkerThreads.cpp:110
 #, fuzzy
 msgid "Index doesn't exist"
 msgstr "???"
 
-#: UI/GTK2/src/WorkerThreads.cpp:111
+#: UI/GTK2/src/WorkerThreads.cpp:112
 msgid "Couldn't create search engine"
 msgstr "?? ??????? ??????? ????????? ???????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:113
+#: UI/GTK2/src/WorkerThreads.cpp:114
 msgid "Cannot index document type"
 msgstr "?????????? ????????????? ?????? ??? ??????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:115
+#: UI/GTK2/src/WorkerThreads.cpp:116
 #, fuzzy
 msgid "No downloader for this protocol"
 msgstr "?? ??????? ???????? ????????? ??? ?????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:117
+#: UI/GTK2/src/WorkerThreads.cpp:118
 msgid "Robots META tag forbids indexing"
 msgstr "META-???? ??????? ????????? ??????????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:119
+#: UI/GTK2/src/WorkerThreads.cpp:120
 msgid "No monitoring handler"
 msgstr "??? ???????? ???????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:415
+#: UI/GTK2/src/WorkerThreads.cpp:416
 msgid "Indexing was stopped"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:428
+#: UI/GTK2/src/WorkerThreads.cpp:429
 msgid "Can't index mail here"
 msgstr "?????? ????????????? ????? ?????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:449 UI/GTK2/src/WorkerThreads.cpp:704
+#: UI/GTK2/src/WorkerThreads.cpp:450 UI/GTK2/src/WorkerThreads.cpp:715
 msgid "is already being indexed"
 msgstr "??? ??????????????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:459
+#: UI/GTK2/src/WorkerThreads.cpp:460
 msgid "is blacklisted"
 msgstr "??????????? ? ?????? ??????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:961
+#: UI/GTK2/src/WorkerThreads.cpp:972
 msgid "No title"
 msgstr "??? ????????"

Modified: trunk/po/sv.po
===================================================================
--- trunk/po/sv.po	2008-05-05 12:07:50 UTC (rev 1241)
+++ trunk/po/sv.po	2008-05-05 12:36:21 UTC (rev 1242)
@@ -5,9 +5,9 @@
 #
 msgid ""
 msgstr ""
-"Project-Id-Version: pinot 0.83\n"
+"Project-Id-Version: pinot 0.85\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2008-03-26 14:43+0800\n"
+"POT-Creation-Date: 2008-05-04 22:14+0800\n"
 "PO-Revision-Date: 2008-01-15 00:10+0000\n"
 "Last-Translator: Daniel Nylander <yeager at ubuntu.com>\n"
 "Language-Team: Swedish <tp-sv at listor.tp-sv.se>\n"
@@ -35,7 +35,7 @@
 #: UI/GTK2/src/mainWindow.cc:1562 UI/GTK2/src/mainWindow.cc:2273
 #: UI/GTK2/src/PinotSettings.cpp:322 UI/GTK2/src/PinotSettings.cpp:1470
 #: UI/GTK2/src/PinotSettings.cpp:1526 UI/GTK2/src/statisticsDialog.cc:79
-#: UI/GTK2/src/WorkerThreads.cpp:998
+#: UI/GTK2/src/WorkerThreads.cpp:1009
 msgid "My Web Pages"
 msgstr "Mina webbsidor"
 
@@ -44,7 +44,7 @@
 #: UI/GTK2/src/mainWindow.cc:978 UI/GTK2/src/mainWindow.cc:1287
 #: UI/GTK2/src/mainWindow.cc:2277 UI/GTK2/src/PinotSettings.cpp:323
 #: UI/GTK2/src/PinotSettings.cpp:1471 UI/GTK2/src/PinotSettings.cpp:1527
-#: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:1008
+#: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:1019
 msgid "My Documents"
 msgstr "Mina dokument"
 
@@ -490,67 +490,67 @@
 msgstr "Pinot"
 
 #. Localize language names
-#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:431
+#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:492
 msgid "Unknown"
 msgstr "Ok?nd"
 
-#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:432
+#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:493
 msgid "Danish"
 msgstr "Danska"
 
-#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:433
+#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:494
 msgid "Dutch"
 msgstr "Nederl?ndska"
 
-#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:434
+#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:495
 msgid "English"
 msgstr "Engelska"
 
-#: UI/GTK2/src/pinot.cc:240 UI/GTK2/src/pinot-dbus-daemon.cc:435
+#: UI/GTK2/src/pinot.cc:240 UI/GTK2/src/pinot-dbus-daemon.cc:496
 msgid "Finnish"
 msgstr "Finska"
 
-#: UI/GTK2/src/pinot.cc:241 UI/GTK2/src/pinot-dbus-daemon.cc:436
+#: UI/GTK2/src/pinot.cc:241 UI/GTK2/src/pinot-dbus-daemon.cc:497
 msgid "French"
 msgstr "Franska"
 
-#: UI/GTK2/src/pinot.cc:242 UI/GTK2/src/pinot-dbus-daemon.cc:437
+#: UI/GTK2/src/pinot.cc:242 UI/GTK2/src/pinot-dbus-daemon.cc:498
 msgid "German"
 msgstr "Tyska"
 
-#: UI/GTK2/src/pinot.cc:243 UI/GTK2/src/pinot-dbus-daemon.cc:438
+#: UI/GTK2/src/pinot.cc:243 UI/GTK2/src/pinot-dbus-daemon.cc:499
 msgid "Hungarian"
 msgstr "Ungerska"
 
-#: UI/GTK2/src/pinot.cc:244 UI/GTK2/src/pinot-dbus-daemon.cc:439
+#: UI/GTK2/src/pinot.cc:244 UI/GTK2/src/pinot-dbus-daemon.cc:500
 msgid "Italian"
 msgstr "Italienska"
 
-#: UI/GTK2/src/pinot.cc:245 UI/GTK2/src/pinot-dbus-daemon.cc:440
+#: UI/GTK2/src/pinot.cc:245 UI/GTK2/src/pinot-dbus-daemon.cc:501
 msgid "Norwegian"
 msgstr "Norska"
 
-#: UI/GTK2/src/pinot.cc:246 UI/GTK2/src/pinot-dbus-daemon.cc:441
+#: UI/GTK2/src/pinot.cc:246 UI/GTK2/src/pinot-dbus-daemon.cc:502
 msgid "Portuguese"
 msgstr "Portugisiska"
 
-#: UI/GTK2/src/pinot.cc:247 UI/GTK2/src/pinot-dbus-daemon.cc:442
+#: UI/GTK2/src/pinot.cc:247 UI/GTK2/src/pinot-dbus-daemon.cc:503
 msgid "Romanian"
 msgstr "Rum?nska"
 
-#: UI/GTK2/src/pinot.cc:248 UI/GTK2/src/pinot-dbus-daemon.cc:443
+#: UI/GTK2/src/pinot.cc:248 UI/GTK2/src/pinot-dbus-daemon.cc:504
 msgid "Russian"
 msgstr "Ryska"
 
-#: UI/GTK2/src/pinot.cc:249 UI/GTK2/src/pinot-dbus-daemon.cc:444
+#: UI/GTK2/src/pinot.cc:249 UI/GTK2/src/pinot-dbus-daemon.cc:505
 msgid "Spanish"
 msgstr "Spanska"
 
-#: UI/GTK2/src/pinot.cc:250 UI/GTK2/src/pinot-dbus-daemon.cc:445
+#: UI/GTK2/src/pinot.cc:250 UI/GTK2/src/pinot-dbus-daemon.cc:506
 msgid "Swedish"
 msgstr "Svenska"
 
-#: UI/GTK2/src/pinot.cc:251 UI/GTK2/src/pinot-dbus-daemon.cc:446
+#: UI/GTK2/src/pinot.cc:251 UI/GTK2/src/pinot-dbus-daemon.cc:507
 msgid "Turkish"
 msgstr "Turkiska"
 
@@ -842,7 +842,7 @@
 msgstr "dokument"
 
 #: UI/GTK2/src/statisticsDialog.cc:151 UI/GTK2/src/statisticsDialog.cc:169
-#: UI/GTK2/src/WorkerThreads.cpp:124
+#: UI/GTK2/src/WorkerThreads.cpp:125
 msgid "Unknown error"
 msgstr "Ok?nt fel"
 
@@ -883,82 +883,82 @@
 msgid "Errors"
 msgstr "Fel"
 
-#: UI/GTK2/src/WorkerThreads.cpp:91
+#: UI/GTK2/src/WorkerThreads.cpp:92
 msgid "Index error"
 msgstr "Indexfel"
 
-#: UI/GTK2/src/WorkerThreads.cpp:93
+#: UI/GTK2/src/WorkerThreads.cpp:94
 msgid "Couldn't index document"
 msgstr "Kunde inte indexera dokument"
 
-#: UI/GTK2/src/WorkerThreads.cpp:95
+#: UI/GTK2/src/WorkerThreads.cpp:96
 msgid "Couldn't update document"
 msgstr "Kunde inte uppdatera dokument"
 
-#: UI/GTK2/src/WorkerThreads.cpp:97
+#: UI/GTK2/src/WorkerThreads.cpp:98
 msgid "Couldn't unindex document(s)"
 msgstr "Kunde inte avindexera dokument"
 
-#: UI/GTK2/src/WorkerThreads.cpp:99
+#: UI/GTK2/src/WorkerThreads.cpp:100
 msgid "Couldn't run query on search engine"
 msgstr "Kunde inte k?ra fr?ga p? s?kmotor"
 
-#: UI/GTK2/src/WorkerThreads.cpp:101
+#: UI/GTK2/src/WorkerThreads.cpp:102
 msgid "Couldn't get history for search engine"
 msgstr "Kunde inte h?mta historik f?r s?kmotor"
 
-#: UI/GTK2/src/WorkerThreads.cpp:103
+#: UI/GTK2/src/WorkerThreads.cpp:104
 msgid "Couldn't retrieve document"
 msgstr "Kunde inte h?mta dokument"
 
-#: UI/GTK2/src/WorkerThreads.cpp:105
+#: UI/GTK2/src/WorkerThreads.cpp:106
 msgid "File monitor error"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:107
+#: UI/GTK2/src/WorkerThreads.cpp:108
 msgid "Couldn't open directory"
 msgstr "Kunde inte ?ppna katalog"
 
-#: UI/GTK2/src/WorkerThreads.cpp:109
+#: UI/GTK2/src/WorkerThreads.cpp:110
 msgid "Index doesn't exist"
 msgstr "Indexet finns inte"
 
-#: UI/GTK2/src/WorkerThreads.cpp:111
+#: UI/GTK2/src/WorkerThreads.cpp:112
 msgid "Couldn't create search engine"
 msgstr "Kunde inte skapa s?kmotor"
 
-#: UI/GTK2/src/WorkerThreads.cpp:113
+#: UI/GTK2/src/WorkerThreads.cpp:114
 msgid "Cannot index document type"
 msgstr "Kan inte indexera dokumenttyp"
 
-#: UI/GTK2/src/WorkerThreads.cpp:115
+#: UI/GTK2/src/WorkerThreads.cpp:116
 msgid "No downloader for this protocol"
 msgstr "Ingen h?mtare f?r detta protokoll"
 
-#: UI/GTK2/src/WorkerThreads.cpp:117
+#: UI/GTK2/src/WorkerThreads.cpp:118
 msgid "Robots META tag forbids indexing"
 msgstr "Robots META-tagg f?rbjuder indexering"
 
-#: UI/GTK2/src/WorkerThreads.cpp:119
+#: UI/GTK2/src/WorkerThreads.cpp:120
 msgid "No monitoring handler"
 msgstr "Ingen ?vervakningshanterare"
 
-#: UI/GTK2/src/WorkerThreads.cpp:415
+#: UI/GTK2/src/WorkerThreads.cpp:416
 msgid "Indexing was stopped"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:428
+#: UI/GTK2/src/WorkerThreads.cpp:429
 msgid "Can't index mail here"
 msgstr "Kan inte indexera post h?r"
 
-#: UI/GTK2/src/WorkerThreads.cpp:449 UI/GTK2/src/WorkerThreads.cpp:704
+#: UI/GTK2/src/WorkerThreads.cpp:450 UI/GTK2/src/WorkerThreads.cpp:715
 msgid "is already being indexed"
 msgstr "h?ller redan p? att bli indexerad"
 
-#: UI/GTK2/src/WorkerThreads.cpp:459
+#: UI/GTK2/src/WorkerThreads.cpp:460
 msgid "is blacklisted"
 msgstr "?r svartlistad"
 
-#: UI/GTK2/src/WorkerThreads.cpp:961
+#: UI/GTK2/src/WorkerThreads.cpp:972
 msgid "No title"
 msgstr "Ingen titel"

Modified: trunk/po/zh_CN.po
===================================================================
--- trunk/po/zh_CN.po	2008-05-05 12:07:50 UTC (rev 1241)
+++ trunk/po/zh_CN.po	2008-05-05 12:36:21 UTC (rev 1242)
@@ -4,9 +4,9 @@
 #
 msgid ""
 msgstr ""
-"Project-Id-Version: pinot 0.83\n"
+"Project-Id-Version: pinot 0.85\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2008-03-26 14:43+0800\n"
+"POT-Creation-Date: 2008-05-04 22:14+0800\n"
 "PO-Revision-Date: 2008-03-24 14:32+0800\n"
 "Last-Translator: Ashlee Ma <ashlee8310 at hotmail.com>\n"
 "MIME-Version: 1.0\n"
@@ -31,7 +31,7 @@
 #: UI/GTK2/src/mainWindow.cc:1562 UI/GTK2/src/mainWindow.cc:2273
 #: UI/GTK2/src/PinotSettings.cpp:322 UI/GTK2/src/PinotSettings.cpp:1470
 #: UI/GTK2/src/PinotSettings.cpp:1526 UI/GTK2/src/statisticsDialog.cc:79
-#: UI/GTK2/src/WorkerThreads.cpp:998
+#: UI/GTK2/src/WorkerThreads.cpp:1009
 msgid "My Web Pages"
 msgstr "????"
 
@@ -40,7 +40,7 @@
 #: UI/GTK2/src/mainWindow.cc:978 UI/GTK2/src/mainWindow.cc:1287
 #: UI/GTK2/src/mainWindow.cc:2277 UI/GTK2/src/PinotSettings.cpp:323
 #: UI/GTK2/src/PinotSettings.cpp:1471 UI/GTK2/src/PinotSettings.cpp:1527
-#: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:1008
+#: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:1019
 msgid "My Documents"
 msgstr "????"
 
@@ -492,67 +492,67 @@
 msgstr "Pinot"
 
 #. Localize language names
-#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:431
+#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:492
 msgid "Unknown"
 msgstr ""
 
-#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:432
+#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:493
 msgid "Danish"
 msgstr "???"
 
-#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:433
+#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:494
 msgid "Dutch"
 msgstr "???"
 
-#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:434
+#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:495
 msgid "English"
 msgstr "??"
 
-#: UI/GTK2/src/pinot.cc:240 UI/GTK2/src/pinot-dbus-daemon.cc:435
+#: UI/GTK2/src/pinot.cc:240 UI/GTK2/src/pinot-dbus-daemon.cc:496
 msgid "Finnish"
 msgstr "???"
 
-#: UI/GTK2/src/pinot.cc:241 UI/GTK2/src/pinot-dbus-daemon.cc:436
+#: UI/GTK2/src/pinot.cc:241 UI/GTK2/src/pinot-dbus-daemon.cc:497
 msgid "French"
 msgstr "??"
 
-#: UI/GTK2/src/pinot.cc:242 UI/GTK2/src/pinot-dbus-daemon.cc:437
+#: UI/GTK2/src/pinot.cc:242 UI/GTK2/src/pinot-dbus-daemon.cc:498
 msgid "German"
 msgstr "??"
 
-#: UI/GTK2/src/pinot.cc:243 UI/GTK2/src/pinot-dbus-daemon.cc:438
+#: UI/GTK2/src/pinot.cc:243 UI/GTK2/src/pinot-dbus-daemon.cc:499
 msgid "Hungarian"
 msgstr "????"
 
-#: UI/GTK2/src/pinot.cc:244 UI/GTK2/src/pinot-dbus-daemon.cc:439
+#: UI/GTK2/src/pinot.cc:244 UI/GTK2/src/pinot-dbus-daemon.cc:500
 msgid "Italian"
 msgstr "????"
 
-#: UI/GTK2/src/pinot.cc:245 UI/GTK2/src/pinot-dbus-daemon.cc:440
+#: UI/GTK2/src/pinot.cc:245 UI/GTK2/src/pinot-dbus-daemon.cc:501
 msgid "Norwegian"
 msgstr "???"
 
-#: UI/GTK2/src/pinot.cc:246 UI/GTK2/src/pinot-dbus-daemon.cc:441
+#: UI/GTK2/src/pinot.cc:246 UI/GTK2/src/pinot-dbus-daemon.cc:502
 msgid "Portuguese"
 msgstr "????"
 
-#: UI/GTK2/src/pinot.cc:247 UI/GTK2/src/pinot-dbus-daemon.cc:442
+#: UI/GTK2/src/pinot.cc:247 UI/GTK2/src/pinot-dbus-daemon.cc:503
 msgid "Romanian"
 msgstr "?????"
 
-#: UI/GTK2/src/pinot.cc:248 UI/GTK2/src/pinot-dbus-daemon.cc:443
+#: UI/GTK2/src/pinot.cc:248 UI/GTK2/src/pinot-dbus-daemon.cc:504
 msgid "Russian"
 msgstr "??"
 
-#: UI/GTK2/src/pinot.cc:249 UI/GTK2/src/pinot-dbus-daemon.cc:444
+#: UI/GTK2/src/pinot.cc:249 UI/GTK2/src/pinot-dbus-daemon.cc:505
 msgid "Spanish"
 msgstr "????"
 
-#: UI/GTK2/src/pinot.cc:250 UI/GTK2/src/pinot-dbus-daemon.cc:445
+#: UI/GTK2/src/pinot.cc:250 UI/GTK2/src/pinot-dbus-daemon.cc:506
 msgid "Swedish"
 msgstr "???"
 
-#: UI/GTK2/src/pinot.cc:251 UI/GTK2/src/pinot-dbus-daemon.cc:446
+#: UI/GTK2/src/pinot.cc:251 UI/GTK2/src/pinot-dbus-daemon.cc:507
 msgid "Turkish"
 msgstr "????"
 
@@ -848,7 +848,7 @@
 msgstr "??"
 
 #: UI/GTK2/src/statisticsDialog.cc:151 UI/GTK2/src/statisticsDialog.cc:169
-#: UI/GTK2/src/WorkerThreads.cpp:124
+#: UI/GTK2/src/WorkerThreads.cpp:125
 msgid "Unknown error"
 msgstr "???????"
 
@@ -889,88 +889,88 @@
 msgid "Errors"
 msgstr "??"
 
-#: UI/GTK2/src/WorkerThreads.cpp:91
+#: UI/GTK2/src/WorkerThreads.cpp:92
 #, fuzzy
 msgid "Index error"
 msgstr "?????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:93
+#: UI/GTK2/src/WorkerThreads.cpp:94
 #, fuzzy
 msgid "Couldn't index document"
 msgstr "?????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:95
+#: UI/GTK2/src/WorkerThreads.cpp:96
 msgid "Couldn't update document"
 msgstr "??????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:97
+#: UI/GTK2/src/WorkerThreads.cpp:98
 msgid "Couldn't unindex document(s)"
 msgstr "?????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:99
+#: UI/GTK2/src/WorkerThreads.cpp:100
 msgid "Couldn't run query on search engine"
 msgstr "??????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:101
+#: UI/GTK2/src/WorkerThreads.cpp:102
 #, fuzzy
 msgid "Couldn't get history for search engine"
 msgstr "??????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:103
+#: UI/GTK2/src/WorkerThreads.cpp:104
 #, fuzzy
 msgid "Couldn't retrieve document"
 msgstr "??????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:105
+#: UI/GTK2/src/WorkerThreads.cpp:106
 msgid "File monitor error"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:107
+#: UI/GTK2/src/WorkerThreads.cpp:108
 #, fuzzy
 msgid "Couldn't open directory"
 msgstr "??????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:109
+#: UI/GTK2/src/WorkerThreads.cpp:110
 #, fuzzy
 msgid "Index doesn't exist"
 msgstr "???"
 
-#: UI/GTK2/src/WorkerThreads.cpp:111
+#: UI/GTK2/src/WorkerThreads.cpp:112
 msgid "Couldn't create search engine"
 msgstr "????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:113
+#: UI/GTK2/src/WorkerThreads.cpp:114
 msgid "Cannot index document type"
 msgstr "????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:115
+#: UI/GTK2/src/WorkerThreads.cpp:116
 msgid "No downloader for this protocol"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:117
+#: UI/GTK2/src/WorkerThreads.cpp:118
 msgid "Robots META tag forbids indexing"
 msgstr "Robots?meta???????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:119
+#: UI/GTK2/src/WorkerThreads.cpp:120
 msgid "No monitoring handler"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:415
+#: UI/GTK2/src/WorkerThreads.cpp:416
 msgid "Indexing was stopped"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:428
+#: UI/GTK2/src/WorkerThreads.cpp:429
 msgid "Can't index mail here"
 msgstr "??????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:449 UI/GTK2/src/WorkerThreads.cpp:704
+#: UI/GTK2/src/WorkerThreads.cpp:450 UI/GTK2/src/WorkerThreads.cpp:715
 msgid "is already being indexed"
 msgstr "??????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:459
+#: UI/GTK2/src/WorkerThreads.cpp:460
 msgid "is blacklisted"
 msgstr "?????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:961
+#: UI/GTK2/src/WorkerThreads.cpp:972
 msgid "No title"
 msgstr "???"

Modified: trunk/po/zh_TW.po
===================================================================
--- trunk/po/zh_TW.po	2008-05-05 12:07:50 UTC (rev 1241)
+++ trunk/po/zh_TW.po	2008-05-05 12:36:21 UTC (rev 1242)
@@ -5,9 +5,9 @@
 #
 msgid ""
 msgstr ""
-"Project-Id-Version: pinot 0.83\n"
+"Project-Id-Version: pinot 0.85\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2008-03-26 14:43+0800\n"
+"POT-Creation-Date: 2008-05-04 22:14+0800\n"
 "PO-Revision-Date: 2008-01-15 00:13+0000\n"
 "Last-Translator: Yung-chung Lin <henearkrxern at gmail.com>\n"
 "Language-Team: Traditional Chinese <zh_TW at li.org>\n"
@@ -35,7 +35,7 @@
 #: UI/GTK2/src/mainWindow.cc:1562 UI/GTK2/src/mainWindow.cc:2273
 #: UI/GTK2/src/PinotSettings.cpp:322 UI/GTK2/src/PinotSettings.cpp:1470
 #: UI/GTK2/src/PinotSettings.cpp:1526 UI/GTK2/src/statisticsDialog.cc:79
-#: UI/GTK2/src/WorkerThreads.cpp:998
+#: UI/GTK2/src/WorkerThreads.cpp:1009
 msgid "My Web Pages"
 msgstr "????"
 
@@ -44,7 +44,7 @@
 #: UI/GTK2/src/mainWindow.cc:978 UI/GTK2/src/mainWindow.cc:1287
 #: UI/GTK2/src/mainWindow.cc:2277 UI/GTK2/src/PinotSettings.cpp:323
 #: UI/GTK2/src/PinotSettings.cpp:1471 UI/GTK2/src/PinotSettings.cpp:1527
-#: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:1008
+#: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:1019
 msgid "My Documents"
 msgstr "????"
 
@@ -496,67 +496,67 @@
 msgstr "Pinot"
 
 #. Localize language names
-#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:431
+#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:492
 msgid "Unknown"
 msgstr ""
 
-#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:432
+#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:493
 msgid "Danish"
 msgstr "???"
 
-#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:433
+#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:494
 msgid "Dutch"
 msgstr "???"
 
-#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:434
+#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:495
 msgid "English"
 msgstr "??"
 
-#: UI/GTK2/src/pinot.cc:240 UI/GTK2/src/pinot-dbus-daemon.cc:435
+#: UI/GTK2/src/pinot.cc:240 UI/GTK2/src/pinot-dbus-daemon.cc:496
 msgid "Finnish"
 msgstr "???"
 
-#: UI/GTK2/src/pinot.cc:241 UI/GTK2/src/pinot-dbus-daemon.cc:436
+#: UI/GTK2/src/pinot.cc:241 UI/GTK2/src/pinot-dbus-daemon.cc:497
 msgid "French"
 msgstr "??"
 
-#: UI/GTK2/src/pinot.cc:242 UI/GTK2/src/pinot-dbus-daemon.cc:437
+#: UI/GTK2/src/pinot.cc:242 UI/GTK2/src/pinot-dbus-daemon.cc:498
 msgid "German"
 msgstr "??"
 
-#: UI/GTK2/src/pinot.cc:243 UI/GTK2/src/pinot-dbus-daemon.cc:438
+#: UI/GTK2/src/pinot.cc:243 UI/GTK2/src/pinot-dbus-daemon.cc:499
 msgid "Hungarian"
 msgstr "????"
 
-#: UI/GTK2/src/pinot.cc:244 UI/GTK2/src/pinot-dbus-daemon.cc:439
+#: UI/GTK2/src/pinot.cc:244 UI/GTK2/src/pinot-dbus-daemon.cc:500
 msgid "Italian"
 msgstr "????"
 
-#: UI/GTK2/src/pinot.cc:245 UI/GTK2/src/pinot-dbus-daemon.cc:440
+#: UI/GTK2/src/pinot.cc:245 UI/GTK2/src/pinot-dbus-daemon.cc:501
 msgid "Norwegian"
 msgstr "???"
 
-#: UI/GTK2/src/pinot.cc:246 UI/GTK2/src/pinot-dbus-daemon.cc:441
+#: UI/GTK2/src/pinot.cc:246 UI/GTK2/src/pinot-dbus-daemon.cc:502
 msgid "Portuguese"
 msgstr "????"
 
-#: UI/GTK2/src/pinot.cc:247 UI/GTK2/src/pinot-dbus-daemon.cc:442
+#: UI/GTK2/src/pinot.cc:247 UI/GTK2/src/pinot-dbus-daemon.cc:503
 msgid "Romanian"
 msgstr "?????"
 
-#: UI/GTK2/src/pinot.cc:248 UI/GTK2/src/pinot-dbus-daemon.cc:443
+#: UI/GTK2/src/pinot.cc:248 UI/GTK2/src/pinot-dbus-daemon.cc:504
 msgid "Russian"
 msgstr "??"
 
-#: UI/GTK2/src/pinot.cc:249 UI/GTK2/src/pinot-dbus-daemon.cc:444
+#: UI/GTK2/src/pinot.cc:249 UI/GTK2/src/pinot-dbus-daemon.cc:505
 msgid "Spanish"
 msgstr "????"
 
-#: UI/GTK2/src/pinot.cc:250 UI/GTK2/src/pinot-dbus-daemon.cc:445
+#: UI/GTK2/src/pinot.cc:250 UI/GTK2/src/pinot-dbus-daemon.cc:506
 msgid "Swedish"
 msgstr "???"
 
-#: UI/GTK2/src/pinot.cc:251 UI/GTK2/src/pinot-dbus-daemon.cc:446
+#: UI/GTK2/src/pinot.cc:251 UI/GTK2/src/pinot-dbus-daemon.cc:507
 msgid "Turkish"
 msgstr "????"
 
@@ -852,7 +852,7 @@
 msgstr "??"
 
 #: UI/GTK2/src/statisticsDialog.cc:151 UI/GTK2/src/statisticsDialog.cc:169
-#: UI/GTK2/src/WorkerThreads.cpp:124
+#: UI/GTK2/src/WorkerThreads.cpp:125
 msgid "Unknown error"
 msgstr "???????"
 
@@ -893,88 +893,88 @@
 msgid "Errors"
 msgstr "??"
 
-#: UI/GTK2/src/WorkerThreads.cpp:91
+#: UI/GTK2/src/WorkerThreads.cpp:92
 #, fuzzy
 msgid "Index error"
 msgstr "?????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:93
+#: UI/GTK2/src/WorkerThreads.cpp:94
 #, fuzzy
 msgid "Couldn't index document"
 msgstr "?????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:95
+#: UI/GTK2/src/WorkerThreads.cpp:96
 msgid "Couldn't update document"
 msgstr "??????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:97
+#: UI/GTK2/src/WorkerThreads.cpp:98
 msgid "Couldn't unindex document(s)"
 msgstr "?????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:99
+#: UI/GTK2/src/WorkerThreads.cpp:100
 msgid "Couldn't run query on search engine"
 msgstr "??????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:101
+#: UI/GTK2/src/WorkerThreads.cpp:102
 #, fuzzy
 msgid "Couldn't get history for search engine"
 msgstr "??????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:103
+#: UI/GTK2/src/WorkerThreads.cpp:104
 #, fuzzy
 msgid "Couldn't retrieve document"
 msgstr "??????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:105
+#: UI/GTK2/src/WorkerThreads.cpp:106
 msgid "File monitor error"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:107
+#: UI/GTK2/src/WorkerThreads.cpp:108
 #, fuzzy
 msgid "Couldn't open directory"
 msgstr "??????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:109
+#: UI/GTK2/src/WorkerThreads.cpp:110
 #, fuzzy
 msgid "Index doesn't exist"
 msgstr "???"
 
-#: UI/GTK2/src/WorkerThreads.cpp:111
+#: UI/GTK2/src/WorkerThreads.cpp:112
 msgid "Couldn't create search engine"
 msgstr "????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:113
+#: UI/GTK2/src/WorkerThreads.cpp:114
 msgid "Cannot index document type"
 msgstr "????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:115
+#: UI/GTK2/src/WorkerThreads.cpp:116
 msgid "No downloader for this protocol"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:117
+#: UI/GTK2/src/WorkerThreads.cpp:118
 msgid "Robots META tag forbids indexing"
 msgstr "Robots?meta???????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:119
+#: UI/GTK2/src/WorkerThreads.cpp:120
 msgid "No monitoring handler"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:415
+#: UI/GTK2/src/WorkerThreads.cpp:416
 msgid "Indexing was stopped"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:428
+#: UI/GTK2/src/WorkerThreads.cpp:429
 msgid "Can't index mail here"
 msgstr "??????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:449 UI/GTK2/src/WorkerThreads.cpp:704
+#: UI/GTK2/src/WorkerThreads.cpp:450 UI/GTK2/src/WorkerThreads.cpp:715
 msgid "is already being indexed"
 msgstr "??????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:459
+#: UI/GTK2/src/WorkerThreads.cpp:460
 msgid "is blacklisted"
 msgstr "?????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:961
+#: UI/GTK2/src/WorkerThreads.cpp:972
 msgid "No title"
 msgstr "???"



From fabricecolin at mail.berlios.de  Tue May  6 16:56:48 2008
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 6 May 2008 16:56:48 +0200
Subject: [Pinot-svn] r1243 - in trunk: IndexSearch Tokenize
Message-ID: <200805061456.m46EumC2006189@sheep.berlios.de>

Author: fabricecolin
Date: 2008-05-06 16:56:48 +0200 (Tue, 06 May 2008)
New Revision: 1243

Modified:
   trunk/IndexSearch/FilterWrapper.cpp
   trunk/Tokenize/FilterUtils.cpp
   trunk/Tokenize/TextConverter.cpp
   trunk/Tokenize/TextConverter.h
Log:
Overloaded TextConverter::toUTF8(). FilterWrapper uses the new method
Filter::set_utf8_converter(). Some minor changes.


Modified: trunk/IndexSearch/FilterWrapper.cpp
===================================================================
--- trunk/IndexSearch/FilterWrapper.cpp	2008-05-05 12:36:21 UTC (rev 1242)
+++ trunk/IndexSearch/FilterWrapper.cpp	2008-05-06 14:56:48 UTC (rev 1243)
@@ -23,6 +23,7 @@
 #include "FilterFactory.h"
 #include "TextFilter.h"
 #include "FilterUtils.h"
+#include "TextConverter.h"
 #include "FilterWrapper.h"
 
 using std::cout;
@@ -31,6 +32,16 @@
 using std::set;
 using namespace Dijon;
 
+static string convertToUTF8(const char *pData, unsigned int dataLen, const string &charset)
+{
+	TextConverter converter(20);
+
+#ifdef DEBUG
+	cout << "FilterWrapper::filterDocument: filter requested conversion from " << charset << endl;
+#endif
+	return converter.toUTF8(pData, dataLen, charset);
+}
+
 FilterWrapper::FilterWrapper(IndexInterface *pIndex) :
 	m_pIndex(pIndex)
 {
@@ -89,6 +100,9 @@
 
 	if (pFilter != NULL)
 	{
+		// The filter may have to convert the content to UTF-8 itself
+    		pFilter->set_utf8_converter(convertToUTF8);
+
 		fedFilter = FilterUtils::feedFilter(doc, pFilter);
 	}
 	else

Modified: trunk/Tokenize/FilterUtils.cpp
===================================================================
--- trunk/Tokenize/FilterUtils.cpp	2008-05-05 12:36:21 UTC (rev 1242)
+++ trunk/Tokenize/FilterUtils.cpp	2008-05-06 14:56:48 UTC (rev 1243)
@@ -164,9 +164,6 @@
 	if (((dataLength > 0) && (pData != NULL)) &&
 		(pFilter->is_data_input_ok(Dijon::Filter::DOCUMENT_DATA) == true))
 	{
-#ifdef DEBUG
-		cout << "FilterUtils::feedFilter: feeding " << dataLength << " bytes of data from " << location << endl;
-#endif
 		fedInput = pFilter->set_document_data(pData, dataLength);
 	}
 	// ... to feeding the file
@@ -328,18 +325,14 @@
 	{
 		string utf8Data(converter.toUTF8(contentIter->second, charset));
 
-#ifdef DEBUG
-		cout << "FilterUtils::populateDocument: converting " << doc.getLocation()
-			<< " from " << charset << endl;
-#endif
 		if (converter.getErrorsCount() > 0)
 		{
 			cerr << doc.getLocation() << " may not have been fully converted to UTF-8" << endl;
 		}
 		doc.setData(utf8Data.c_str(), utf8Data.length());
 #ifdef DEBUG
-		cout << "FilterUtils::populateDocument: set " << utf8Data.length() << "/" << contentIter->second.size()
-			<< " characters of data" << endl;
+		cout << "FilterUtils::populateDocument: set " << utf8Data.length() << "/" << contentIter->second.length()
+			<< " bytes, converted from charset " << charset << endl;
 #endif
 	}
 	contentIter = metaData.find("title");

Modified: trunk/Tokenize/TextConverter.cpp
===================================================================
--- trunk/Tokenize/TextConverter.cpp	2008-05-05 12:36:21 UTC (rev 1242)
+++ trunk/Tokenize/TextConverter.cpp	2008-05-06 14:56:48 UTC (rev 1243)
@@ -19,6 +19,7 @@
 #include <errno.h>
 #include <iostream>
 #include <glibmm/convert.h>
+#include <glibmm/ustring.h>
 
 #include "StringManip.h"
 #include "TextConverter.h"
@@ -28,9 +29,6 @@
 using std::string;
 using namespace Glib;
 
-#define USE_GLIBMM_ICONV 1
-//#define USE_GLIBMM_FUNCS 1
-
 TextConverter::TextConverter(unsigned int maxErrors) :
 	m_utf8Locale(false),
 	m_maxErrors(maxErrors),
@@ -44,19 +42,28 @@
 {
 }
 
-ustring TextConverter::toUTF8(const string &text, const string &charset)
+string TextConverter::toUTF8(const string &text, const string &charset)
 {
+	unsigned int textLen = (unsigned int)text.length();
+
+	// Call overload
+	return toUTF8(text.c_str(), textLen, charset);
+}
+
+string TextConverter::toUTF8(const char *pText, unsigned int textLen, const string &charset)
+{
 	string textCharset(StringManip::toLowerCase(charset));
 	char outputBuffer[8192];
-	char *pInput = const_cast<char *>(text.c_str());
+	char *pInput = const_cast<char *>(pText);
 
 	m_conversionErrors = 0;
 
-	if ((text.empty() == true) ||
+	if ((pText == NULL) ||
+		(textLen == 0) ||
 		(textCharset == "utf-8"))
 	{
 		// No conversion necessary
-		return text;
+		return string(pText, textLen);
 	}
 
 	if (textCharset.empty() == true)
@@ -64,16 +71,15 @@
 		if (m_utf8Locale == true)
 		{
 			// The current locale uses UTF-8
-			return text;
+			return string(pText, textLen);
 		}
 
 		textCharset = m_localeCharset;
 	}
 
-#ifdef USE_GLIBMM_ICONV
 	IConv converter("UTF-8", textCharset);
 	string outputText;
-	gsize inputSize = text.length();
+	gsize inputSize = (gsize)textLen;
 	bool invalidSequence = false;
 
 	while (inputSize > 0)
@@ -90,13 +96,14 @@
 				// Conversion was only partially successful
 				++m_conversionErrors;
 #ifdef DEBUG
-				cout << "TextConverter::toUTF8: invalid sequence at " << pInput - text.c_str() << endl;
+				cout << "TextConverter::toUTF8: invalid sequence at " << pInput - pText << endl;
 #endif
 				if (m_conversionErrors >= m_maxErrors)
 				{
 					// Give up
-					return text; 
+					return string(pText, textLen);
 				}
+				converter.reset();
 
 				outputText.append(outputBuffer, 8192 - outputSize);
 				if (invalidSequence == false)
@@ -115,7 +122,7 @@
 #ifdef DEBUG
 				cout << "TextConverter::toUTF8: unknown error " << errorCode << endl;
 #endif
-				return text;
+				return string(pText, textLen);
 			}
 		}
 		else
@@ -131,38 +138,6 @@
 #endif
 
 	return outputText;
-#else
-#ifdef USE_GLIBMM_FUNCS
-	try
-	{
-		if (textCharset.empty() == false)
-		{
-			return convert_with_fallback(text, "UTF-8", textCharset, " ");
-		}
-		else
-		{
-			return locale_to_utf8(text);
-		}
-	}
-	catch (ConvertError &ce)
-	{
-#ifdef DEBUG
-		cout << "TextConverter::toUTF8: cannot convert from " << textCharset << ": " << ce.what() << endl;
-#endif
-		if (textCharset.empty() == false)
-		{
-#ifdef DEBUG
-			cout << "TextConverter::toUTF8: trying again" << endl;
-#endif
-			return TextConverter::toUTF8(text, "");
-		}
-	}
-
-	return "";
-#else
-	return text;
-#endif
-#endif
 }
 
 unsigned int TextConverter::getErrorsCount(void) const
@@ -170,7 +145,7 @@
 	return m_conversionErrors;
 }
 
-string TextConverter::fromUTF8(const ustring &text)
+string TextConverter::fromUTF8(const string &text)
 {
 	try
 	{

Modified: trunk/Tokenize/TextConverter.h
===================================================================
--- trunk/Tokenize/TextConverter.h	2008-05-05 12:36:21 UTC (rev 1242)
+++ trunk/Tokenize/TextConverter.h	2008-05-06 14:56:48 UTC (rev 1243)
@@ -20,7 +20,6 @@
 #define _TEXT_CONVERTER_H
 
 #include <string>
-#include <glibmm/ustring.h>
 
 class TextConverter
 {
@@ -29,13 +28,16 @@
 		virtual ~TextConverter();
 
 		/// Converts to UTF-8.
-		Glib::ustring toUTF8(const std::string &text, const std::string &charset);
+		std::string toUTF8(const std::string &text, const std::string &charset);
 
+		/// Converts to UTF-8.
+		std::string toUTF8(const char *pText, unsigned int textLen, const std::string &charset);
+
 		/// Gets the number of conversion errors for the previous toUTF8() call.
 		unsigned int getErrorsCount(void) const;
 
 		/// Converts from UTF-8.
-		std::string fromUTF8(const Glib::ustring &text);
+		std::string fromUTF8(const std::string &text);
 
 	protected:
 		std::string m_localeCharset;



From fabricecolin at mail.berlios.de  Tue May  6 16:57:52 2008
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 6 May 2008 16:57:52 +0200
Subject: [Pinot-svn] r1244 - trunk/UI/GTK2/src
Message-ID: <200805061457.m46Evqc3006344@sheep.berlios.de>

Author: fabricecolin
Date: 2008-05-06 16:57:51 +0200 (Tue, 06 May 2008)
New Revision: 1244

Modified:
   trunk/UI/GTK2/src/PinotSettings.cpp
Log:
If the global configuration file couldn't be open, don't assume a first run.


Modified: trunk/UI/GTK2/src/PinotSettings.cpp
===================================================================
--- trunk/UI/GTK2/src/PinotSettings.cpp	2008-05-06 14:56:48 UTC (rev 1243)
+++ trunk/UI/GTK2/src/PinotSettings.cpp	2008-05-06 14:57:51 UTC (rev 1244)
@@ -120,6 +120,7 @@
 		// No, create it then
 		if (mkdir(directoryName.c_str(), (mode_t)S_IRUSR|S_IWUSR|S_IXUSR|S_IRGRP|S_IWGRP|S_IXGRP|S_IROTH|S_IXOTH) == 0)
 		{
+			cerr << "Created directory " << directoryName << endl;
 			m_firstRun = true;
 		}
 		else
@@ -386,7 +387,10 @@
 		(!S_ISREG(fileStat.st_mode)))
 	{
 		cerr << "Couldn't open configuration file " << fileName << endl;
-		m_firstRun = true;
+		if (isGlobal == false)
+		{
+			m_firstRun = true;
+		}
 		return false;
 	}
 



From fabricecolin at mail.berlios.de  Thu May  8 14:20:56 2008
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Thu, 8 May 2008 14:20:56 +0200
Subject: [Pinot-svn] r1245 - in trunk/IndexSearch: . Xapian
Message-ID: <200805081220.m48CKuGr004984@sheep.berlios.de>

Author: fabricecolin
Date: 2008-05-08 14:20:55 +0200 (Thu, 08 May 2008)
New Revision: 1245

Modified:
   trunk/IndexSearch/QueryProperties.cpp
   trunk/IndexSearch/WebEngine.cpp
   trunk/IndexSearch/Xapian/AbstractGenerator.cpp
Log:
AbstractGenerator and WebEngine's TermHighlighter skip multi-character CJKV
terms to avoid repetition in extracts.
QueryProperties' FilterRemover does what the name implies and simply removes
filters and ranges from a query instead of trying to rebuild it one token at a
time.


Modified: trunk/IndexSearch/QueryProperties.cpp
===================================================================
--- trunk/IndexSearch/QueryProperties.cpp	2008-05-06 14:57:51 UTC (rev 1244)
+++ trunk/IndexSearch/QueryProperties.cpp	2008-05-08 12:20:55 UTC (rev 1245)
@@ -29,12 +29,9 @@
 class FilterRemover : public Dijon::CJKVTokenizer::TokensHandler
 {
         public:
-                FilterRemover(string &freeQueryWithoutFilters,
-			unsigned int nGramSize) :
+                FilterRemover(const string &freeQuery) :
 			Dijon::CJKVTokenizer::TokensHandler(),
-			m_freeQueryWithoutFilters(freeQueryWithoutFilters),
-			m_nGramSize(nGramSize),
-			m_nGramCount(0)
+			m_freeQuery(freeQuery)
 		{
 		}
 
@@ -52,46 +49,36 @@
 			// Is this CJKV ?
 			if (is_cjkv == false)
 			{
-				m_nGramCount = 0;
-
 				if ((tok.find(':') != string::npos) ||
 					(tok.find("..") != string::npos))
 				{
-					// It's a filter or a range
+					string::size_type tokPosStart = m_freeQuery.find(tok);
+
+					// It's a filter or a range, remove it
+					if (tokPosStart != string::npos)
+					{
+						string::size_type tokPosEnd = m_freeQuery.find(" ", tokPosStart);
+
+						if (tokPosEnd != string::npos)
+						{
+							m_freeQuery.erase(tokPosStart, tokPosEnd - tokPosStart);
+						}
+						else
+						{
+							m_freeQuery.erase(tokPosStart);
+						}
+					}
 #ifdef DEBUG
-					cout << "QueryProperties::getFreeQuery: ignoring filter '" << tok << "'" << endl;
+					cout << "QueryProperties::getFreeQuery: removed " << tok << "..." << endl;
 #endif
 					return true;
 				}
 			}
-			else
-			{
-				++m_nGramCount;
-				if (m_nGramCount % m_nGramSize != 0)
-				{
-#ifdef DEBUG
-					cout << "QueryProperties::getFreeQuery: ignoring " << m_nGramCount << " '" << tok << "'" << endl;
-#endif
-					return true;
-				}
-			}
-#ifdef DEBUG
-			cout << "QueryProperties::getFreeQuery: keeping '" << tok << "'" << endl;
-#endif
 
-			if (m_freeQueryWithoutFilters.empty() == false)
-			{
-				m_freeQueryWithoutFilters += " ";
-			}
-			m_freeQueryWithoutFilters += tok;
-
 			return true;
 		}
 
-	protected:
-		string &m_freeQueryWithoutFilters;
-		unsigned int m_nGramSize;
-		unsigned int m_nGramCount;
+		string m_freeQuery;
 
 };
 
@@ -214,9 +201,10 @@
 	}
 
 	Dijon::CJKVTokenizer tokenizer;
-	FilterRemover handler(m_freeQueryWithoutFilters, tokenizer.get_ngram_size());
+	FilterRemover handler(m_freeQuery);
 
 	tokenizer.tokenize(m_freeQuery, handler, true);
+	m_freeQueryWithoutFilters = handler.m_freeQuery;
 }
 
 /// Sets the name.

Modified: trunk/IndexSearch/WebEngine.cpp
===================================================================
--- trunk/IndexSearch/WebEngine.cpp	2008-05-06 14:57:51 UTC (rev 1244)
+++ trunk/IndexSearch/WebEngine.cpp	2008-05-08 12:20:55 UTC (rev 1245)
@@ -41,9 +41,12 @@
 class TermHighlighter : public Dijon::CJKVTokenizer::TokensHandler
 {
         public:
-                TermHighlighter(string &extract, set<string> &queryTerms) :
+                TermHighlighter(string &extract, set<string> &queryTerms,
+			unsigned int nGramSize) :
 			Dijon::CJKVTokenizer::TokensHandler(),
 			m_extract(extract),
+			m_nGramSize(nGramSize),
+			m_nGramCount(0),
 			m_queryTerms(queryTerms)
 		{
 		}
@@ -63,6 +66,23 @@
 				return false;
 			}
 
+			if (is_cjkv == false)
+			{
+				m_nGramCount = 0;
+			}
+			else
+			{
+				++m_nGramCount;
+				if (tok.length() > 4)
+				{
+					// Ignore multi-character tokens
+#ifdef DEBUG
+					cout << "WebEngine::processResult: ignoring " << tok << endl;
+#endif
+					return true;
+				}
+			}
+
 			pUTF8Token = g_locale_to_utf8(tok.c_str(), tok.length(),
 				NULL, &bytesWritten, NULL);
 			if (pUTF8Token != NULL)
@@ -75,6 +95,11 @@
 				return true;
 			}
 
+			if ((m_extract.empty() == false) &&
+				(m_nGramCount <= 1))
+			{
+				m_extract += " ";
+			}
 			// Is this a query term ?
 			if (m_queryTerms.find(StringManip::toLowerCase(tok)) == m_queryTerms.end())
 			{
@@ -86,13 +111,14 @@
 				m_extract += pEscToken;
 				m_extract += "</b>";
 			}
-			m_extract += " ";
 
 			g_free(pEscToken);
 		}
 
 	protected:
 		string &m_extract;
+		unsigned int m_nGramSize;
+		unsigned int m_nGramCount;
 		set<string> &m_queryTerms;
 
 };
@@ -242,7 +268,7 @@
 	}
 
 	Dijon::CJKVTokenizer tokenizer;
-	TermHighlighter handler(extract, m_queryTerms);
+	TermHighlighter handler(extract, m_queryTerms, tokenizer.get_ngram_size());
 
 	// Highlight query terms in the extract
 	extract.clear();

Modified: trunk/IndexSearch/Xapian/AbstractGenerator.cpp
===================================================================
--- trunk/IndexSearch/Xapian/AbstractGenerator.cpp	2008-05-06 14:57:51 UTC (rev 1244)
+++ trunk/IndexSearch/Xapian/AbstractGenerator.cpp	2008-05-08 12:20:55 UTC (rev 1245)
@@ -27,6 +27,7 @@
 
 #include "Timer.h"
 #include "AbstractGenerator.h"
+#include "CJKVTokenizer.h"
 
 using std::cout;
 using std::cerr;
@@ -35,6 +36,7 @@
 using std::vector;
 using std::map;
 using std::find;
+using namespace Dijon;
 
 unsigned int AbstractGenerator::m_maxSeedTerms = 5;
 unsigned int AbstractGenerator::m_minTermPositions = 10;
@@ -212,13 +214,30 @@
 	}
 
 	// Generate the abstract
+	CJKVTokenizer tokenizer;
+	bool wasCJKV = false;
 	for (map<Xapian::termpos, string>::iterator wordIter = wordsBuffer.begin();
 		wordIter != wordsBuffer.end(); ++wordIter)
 	{
 		gchar *pEscToken = NULL;
 		gchar *pUTF8Token = NULL;
 		gsize bytesWritten = 0;
+		bool isCJKV = false;
 
+		// Skip multi-character CJKV terms
+		if (tokenizer.has_cjkv(wordIter->second) == true)
+		{
+			isCJKV = true;
+
+			if (wordIter->second.length() > 4)
+			{
+#ifdef DEBUG
+				cout << "AbstractGenerator::generateAbstract: skipping " << wordIter->second << endl;
+#endif
+				continue;
+			}
+		}
+
 		pUTF8Token = g_locale_to_utf8(wordIter->second.c_str(), wordIter->second.length(),
 			NULL, &bytesWritten, NULL);
 		if (pUTF8Token != NULL)
@@ -231,6 +250,11 @@
 			continue;
 		}
 
+		if ((summary.empty() == false) &&
+			(wasCJKV != isCJKV))
+		{
+			summary += " ";
+		}
 		// Is this a seed term ?
 		if (find(seedTerms.begin(), seedTerms.end(), wordIter->second) != seedTerms.end())
 		{
@@ -242,8 +266,8 @@
 		{
 			summary += pEscToken;
 		}
-		summary += " ";
 
+		wasCJKV = isCJKV;
 		g_free(pEscToken);
 	}
 #ifdef DEBUG



From fabricecolin at mail.berlios.de  Thu May  8 18:36:05 2008
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Thu, 8 May 2008 18:36:05 +0200
Subject: [Pinot-svn] r1246 - in trunk/IndexSearch: . Xapian
Message-ID: <200805081636.m48Ga5TR009049@sheep.berlios.de>

Author: fabricecolin
Date: 2008-05-08 18:36:04 +0200 (Thu, 08 May 2008)
New Revision: 1246

Modified:
   trunk/IndexSearch/WebEngine.cpp
   trunk/IndexSearch/Xapian/AbstractGenerator.cpp
   trunk/IndexSearch/Xapian/XapianEngine.cpp
Log:
A fix for QueryModifier when the query is one CJKV character only.
AbstractGenerator needs to skip long n-grams early on when populating the
chosen window.
Cosmetic changes here and there.


Modified: trunk/IndexSearch/WebEngine.cpp
===================================================================
--- trunk/IndexSearch/WebEngine.cpp	2008-05-08 12:20:55 UTC (rev 1245)
+++ trunk/IndexSearch/WebEngine.cpp	2008-05-08 16:36:04 UTC (rev 1246)
@@ -75,9 +75,9 @@
 				++m_nGramCount;
 				if (tok.length() > 4)
 				{
-					// Ignore multi-character tokens
+					// Skip multi-character tokens
 #ifdef DEBUG
-					cout << "WebEngine::processResult: ignoring " << tok << endl;
+					cout << "WebEngine::processResult: skipping " << tok << endl;
 #endif
 					return true;
 				}

Modified: trunk/IndexSearch/Xapian/AbstractGenerator.cpp
===================================================================
--- trunk/IndexSearch/Xapian/AbstractGenerator.cpp	2008-05-08 12:20:55 UTC (rev 1245)
+++ trunk/IndexSearch/Xapian/AbstractGenerator.cpp	2008-05-08 16:36:04 UTC (rev 1246)
@@ -66,12 +66,14 @@
 string AbstractGenerator::generateAbstract(Xapian::docid docId,
 	const vector<string> &seedTerms)
 {
+	CJKVTokenizer tokenizer;
 	map<Xapian::termpos, PositionWindow> abstractWindows;
 	map<Xapian::termpos, string> wordsBuffer;
 	string summary;
 	Xapian::termpos bestPosition = 0, startPosition = 0;
 	unsigned int seedTermsCount = 0, bestWeight = 0;
 	bool topTerm = true;
+	bool wasCJKV = false;
 
 	if (m_pIndex == NULL)
 	{
@@ -190,6 +192,12 @@
 			{
 				continue;
 			}
+			// Skip multi-character CJKV terms
+			if ((tokenizer.has_cjkv(termName) == true) &&
+				(termName.length() > 4))
+			{
+				continue;
+			}
 
 			for (Xapian::PositionIterator positionIter = m_pIndex->positionlist_begin(docId, termName);
 				positionIter != m_pIndex->positionlist_end(docId, termName); ++positionIter)
@@ -214,30 +222,13 @@
 	}
 
 	// Generate the abstract
-	CJKVTokenizer tokenizer;
-	bool wasCJKV = false;
 	for (map<Xapian::termpos, string>::iterator wordIter = wordsBuffer.begin();
 		wordIter != wordsBuffer.end(); ++wordIter)
 	{
 		gchar *pEscToken = NULL;
 		gchar *pUTF8Token = NULL;
 		gsize bytesWritten = 0;
-		bool isCJKV = false;
 
-		// Skip multi-character CJKV terms
-		if (tokenizer.has_cjkv(wordIter->second) == true)
-		{
-			isCJKV = true;
-
-			if (wordIter->second.length() > 4)
-			{
-#ifdef DEBUG
-				cout << "AbstractGenerator::generateAbstract: skipping " << wordIter->second << endl;
-#endif
-				continue;
-			}
-		}
-
 		pUTF8Token = g_locale_to_utf8(wordIter->second.c_str(), wordIter->second.length(),
 			NULL, &bytesWritten, NULL);
 		if (pUTF8Token != NULL)
@@ -250,11 +241,13 @@
 			continue;
 		}
 
+		bool isCJKV = tokenizer.has_cjkv(wordIter->second);
 		if ((summary.empty() == false) &&
 			(wasCJKV != isCJKV))
 		{
 			summary += " ";
 		}
+
 		// Is this a seed term ?
 		if (find(seedTerms.begin(), seedTerms.end(), wordIter->second) != seedTerms.end())
 		{

Modified: trunk/IndexSearch/Xapian/XapianEngine.cpp
===================================================================
--- trunk/IndexSearch/Xapian/XapianEngine.cpp	2008-05-08 12:20:55 UTC (rev 1245)
+++ trunk/IndexSearch/Xapian/XapianEngine.cpp	2008-05-08 16:36:04 UTC (rev 1246)
@@ -232,7 +232,7 @@
 
 			// First n-gram ?
 #ifdef DEBUG
-			cout << "QueryModifier::handle_token: " << m_nGramCount << " n-gram" << endl;
+			cout << "QueryModifier::handle_token: n-gram " << m_nGramCount << endl;
 #endif
 			if (m_nGramCount == 0)
 			{
@@ -247,6 +247,7 @@
 				{
 					m_modifiedQuery += " " + m_query.substr(m_pos, tokPos - m_pos);
 				}
+				m_pos += tok.length();
 				switch (m_wrap)
 				{
 					case BRACKETS:
@@ -282,9 +283,12 @@
 
 		string get_modified_query(void)
 		{
-			if (m_pos < m_query.length())
+#ifdef DEBUG
+			cout << "QueryModifier::get_modified_query: " << m_pos << "/" << m_query.length() << endl;
+#endif
+			if (m_pos + 1 < m_query.length())
 			{
-				m_modifiedQuery += " " + m_query.substr(m_pos);
+				m_modifiedQuery += " " + m_query.substr(m_pos + 1);
 			}
 			wrapClose();
 #ifdef DEBUG



From fabricecolin at mail.berlios.de  Fri May  9 15:32:21 2008
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Fri, 9 May 2008 15:32:21 +0200
Subject: [Pinot-svn] r1247 - trunk/IndexSearch
Message-ID: <200805091332.m49DWLYX028193@sheep.berlios.de>

Author: fabricecolin
Date: 2008-05-09 15:32:20 +0200 (Fri, 09 May 2008)
New Revision: 1247

Modified:
   trunk/IndexSearch/FilterWrapper.cpp
Log:
Only set a default title if the document is not to passed to another filter.


Modified: trunk/IndexSearch/FilterWrapper.cpp
===================================================================
--- trunk/IndexSearch/FilterWrapper.cpp	2008-05-08 16:36:04 UTC (rev 1246)
+++ trunk/IndexSearch/FilterWrapper.cpp	2008-05-09 13:32:20 UTC (rev 1247)
@@ -133,6 +133,7 @@
 	{
 		string actualType(originalType);
 		bool isNested = false;
+		bool emptyTitle = false;
 
 		if (pFilter->next_document() == false)
 		{
@@ -170,19 +171,25 @@
 		}
 		else if (filteredDoc.getTitle().empty() == true)
 		{
-			Url urlObj(doc.getLocation());
-
-			// Default to the file name as title
-			filteredDoc.setTitle(urlObj.getFile());
-#ifdef DEBUG
-			cout << "FilterWrapper::filterDocument: set default title " << urlObj.getFile() << endl;
-#endif
+			emptyTitle = true;
 		}
 
 		// Pass it down to another filter ?
 		if ((filteredDoc.getType().length() >= 10) &&
 			(filteredDoc.getType().substr(0, 10) == "text/plain"))
 		{
+			// Do we need to set a default title ?
+			if (emptyTitle == true)
+			{
+				Url urlObj(doc.getLocation());
+
+				// Default to the file name as title
+				filteredDoc.setTitle(urlObj.getFile());
+#ifdef DEBUG
+				cout << "FilterWrapper::filterDocument: set default title " << urlObj.getFile() << endl;
+#endif
+			}
+
 			// No, it's been reduced to plain text
 			filteredDoc.setType(actualType);
 



From fabricecolin at mail.berlios.de  Fri May  9 15:33:06 2008
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Fri, 9 May 2008 15:33:06 +0200
Subject: [Pinot-svn] r1248 - trunk/IndexSearch/Xapian
Message-ID: <200805091333.m49DX6xp028252@sheep.berlios.de>

Author: fabricecolin
Date: 2008-05-09 15:33:05 +0200 (Fri, 09 May 2008)
New Revision: 1248

Modified:
   trunk/IndexSearch/Xapian/AbstractGenerator.cpp
Log:
Fix for previous checkin.


Modified: trunk/IndexSearch/Xapian/AbstractGenerator.cpp
===================================================================
--- trunk/IndexSearch/Xapian/AbstractGenerator.cpp	2008-05-09 13:32:20 UTC (rev 1247)
+++ trunk/IndexSearch/Xapian/AbstractGenerator.cpp	2008-05-09 13:33:05 UTC (rev 1248)
@@ -243,7 +243,7 @@
 
 		bool isCJKV = tokenizer.has_cjkv(wordIter->second);
 		if ((summary.empty() == false) &&
-			(wasCJKV != isCJKV))
+			((wasCJKV != isCJKV) || (isCJKV == false)))
 		{
 			summary += " ";
 		}



From fabricecolin at mail.berlios.de  Fri May  9 15:35:31 2008
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Fri, 9 May 2008 15:35:31 +0200
Subject: [Pinot-svn] r1249 - trunk/Utils/xdgmime
Message-ID: <200805091335.m49DZVW4028609@sheep.berlios.de>

Author: fabricecolin
Date: 2008-05-09 15:35:29 +0200 (Fri, 09 May 2008)
New Revision: 1249

Modified:
   trunk/Utils/xdgmime/ChangeLog
   trunk/Utils/xdgmime/xdgmime.c
   trunk/Utils/xdgmime/xdgmime.h
   trunk/Utils/xdgmime/xdgmimealias.h
   trunk/Utils/xdgmime/xdgmimecache.c
   trunk/Utils/xdgmime/xdgmimecache.h
   trunk/Utils/xdgmime/xdgmimemagic.c
   trunk/Utils/xdgmime/xdgmimemagic.h
   trunk/Utils/xdgmime/xdgmimeparent.h
Log:
Synced with current gtk+'s xdgmime.


Modified: trunk/Utils/xdgmime/ChangeLog
===================================================================
--- trunk/Utils/xdgmime/ChangeLog	2008-05-09 13:33:05 UTC (rev 1248)
+++ trunk/Utils/xdgmime/ChangeLog	2008-05-09 13:35:29 UTC (rev 1249)
@@ -1,3 +1,76 @@
+2008-04-16  Matthias Clasen  <mclasen at redhat.com>
+
+	* Sync xdgmime to the copy in gio.
+
+2008-04-16  Matthias Clasen  <mclasen at redhat.com>
+
+	Partically revert the last commit after realizing that
+	xdg_mime_media_type_equal doesn't have to init at all.
+
+	* xdgmime.h:
+	* xdgmime.c: Get rid of _xdg_mime_media_type_equal
+
+	* xdgmimecache.c: Use xdg_mime_media_type_equal
+
+2008-04-16  Matthias Clasen  <mclasen at redhat.com>
+
+	Avoid possible memory corruption in xdgmime, fd.o bug 12512,
+	reported by Joe Shaw and Federico Mena Quintero.
+
+	* xdgmime.c(_xdg_mime_media_type_equal): Implement.
+	(xdg_mime_media_type_equal): Turn into a wrapper around the
+	_-prefixed version.
+
+	* xdgmimecache.c: Use the _-prefixed versions of
+	comparison functions throughout.
+
+2008-02-16  Matthias Clasen  <mclasen at redhat.com>
+
+	* === Released 2.13.0 ===
+
+2007-10-16  Matthias Clasen <mclasen at redhat.com>
+
+	* === Released 2.12.1 ===
+
+2007-09-13  Matthias Clasen  <mclasen at redhat.com>
+
+	* === Released 2.12.0 ===
+
+2007-07-25  Alexander Larsson  <alexl at redhat.com>
+
+        * xdgmimealias.h:
+        * xdgmimecache.h:
+        * xdgmimeparent.h:
+	Mark more internal symbols for prefixing
+
+2007-07-21  Matthias Clasen  <mclasen at redhat.com>
+
+	* === Released 2.11.6 ===
+
+2007-07-02  Matthias Clasen  <mclasen at redhat.com>
+
+	* === Released 2.11.5 ===
+
+2007-06-19  Matthias Clasen <mclasen at redhat.com>
+
+	* === Released 2.11.4 ===
+
+2007-06-15  Matthias Clasen  <mclasen at redhat.com>
+
+	* === Released 2.11.3 ===
+
+2007-06-06  Matthias Clasen  <mclasen at redhat.com>
+
+	* === Released 2.11.2 ===
+
+2007-06-04  Matthias Clasen  <mclasen at redhat.com>
+
+	* === Released 2.11.1 ===
+
+2007-05-24   Matthias Clasen  <mclasen at redhat.com>
+
+	* === Released 2.11.0 ===
+
 2007-04-09  Matthias Clasen  <mclasen at redhat.com>
 
 	* xdgmimeglob.c (_xdg_glob_hash_insert_text): Duplicate the

Modified: trunk/Utils/xdgmime/xdgmime.c
===================================================================
--- trunk/Utils/xdgmime/xdgmime.c	2008-05-09 13:33:05 UTC (rev 1248)
+++ trunk/Utils/xdgmime/xdgmime.c	2008-05-09 13:35:29 UTC (rev 1249)
@@ -93,17 +93,26 @@
 typedef int (*XdgDirectoryFunc) (const char *directory,
 				 void       *user_data);
 
-static XdgDirTimeList *
-xdg_dir_time_list_new (void)
+static void
+xdg_dir_time_list_add (char   *file_name, 
+		       time_t  mtime)
 {
-  XdgDirTimeList *retval;
+  XdgDirTimeList *list;
 
-  retval = calloc (1, sizeof (XdgDirTimeList));
-  retval->checked = XDG_CHECKED_UNCHECKED;
-
-  return retval;
+  for (list = dir_time_list; list; list = list->next) 
+    {
+      if (strcmp (list->directory_name, file_name) == 0) 
+        return;
+    }
+  
+  list = calloc (1, sizeof (XdgDirTimeList));
+  list->checked = XDG_CHECKED_UNCHECKED;
+  list->directory_name = file_name;
+  list->mtime = mtime;
+  list->next = dir_time_list;
+  dir_time_list = list;
 }
-
+ 
 static void
 xdg_dir_time_list_free (XdgDirTimeList *list)
 {
@@ -123,7 +132,6 @@
 {
   char *file_name;
   struct stat st;
-  XdgDirTimeList *list;
 
   assert (directory != NULL);
 
@@ -135,11 +143,7 @@
 
       if (cache != NULL)
 	{
-	  list = xdg_dir_time_list_new ();
-	  list->directory_name = file_name;
-	  list->mtime = st.st_mtime;
-	  list->next = dir_time_list;
-	  dir_time_list = list;
+	  xdg_dir_time_list_add (file_name, st.st_mtime);
 
 	  _caches = realloc (_caches, sizeof (XdgMimeCache *) * (n_caches + 2));
 	  _caches[n_caches] = cache;
@@ -156,12 +160,7 @@
   if (stat (file_name, &st) == 0)
     {
       _xdg_mime_glob_read_from_file (global_hash, file_name);
-
-      list = xdg_dir_time_list_new ();
-      list->directory_name = file_name;
-      list->mtime = st.st_mtime;
-      list->next = dir_time_list;
-      dir_time_list = list;
+      xdg_dir_time_list_add (file_name, st.st_mtime);
     }
   else
     {
@@ -173,12 +172,7 @@
   if (stat (file_name, &st) == 0)
     {
       _xdg_mime_magic_read_from_file (global_magic, file_name);
-
-      list = xdg_dir_time_list_new ();
-      list->directory_name = file_name;
-      list->mtime = st.st_mtime;
-      list->next = dir_time_list;
-      dir_time_list = list;
+      xdg_dir_time_list_add (file_name, st.st_mtime);
     }
   else
     {
@@ -296,12 +290,11 @@
 
       for (list = dir_time_list; list; list = list->next)
 	{
-	  if (! strcmp (list->directory_name, file_path) &&
-	      st.st_mtime == list->mtime)
+	  if (! strcmp (list->directory_name, file_path))
 	    {
-	      if (list->checked == XDG_CHECKED_UNCHECKED)
+	      if (st.st_mtime == list->mtime)
 		list->checked = XDG_CHECKED_VALID;
-	      else if (list->checked == XDG_CHECKED_VALID)
+	      else 
 		list->checked = XDG_CHECKED_INVALID;
 
 	      return (list->checked != XDG_CHECKED_VALID);
@@ -440,16 +433,17 @@
 
 const char *
 xdg_mime_get_mime_type_for_data (const void *data,
-				 size_t      len)
+				 size_t      len,
+				 int        *result_prio)
 {
   const char *mime_type;
 
   xdg_mime_init ();
 
   if (_caches)
-    return _xdg_mime_cache_get_mime_type_for_data (data, len);
+    return _xdg_mime_cache_get_mime_type_for_data (data, len, result_prio);
 
-  mime_type = _xdg_mime_magic_lookup_data (global_magic, data, len, NULL, 0);
+  mime_type = _xdg_mime_magic_lookup_data (global_magic, data, len, result_prio, NULL, 0);
 
   if (mime_type)
     return mime_type;
@@ -524,7 +518,7 @@
       return XDG_MIME_TYPE_UNKNOWN;
     }
 
-  mime_type = _xdg_mime_magic_lookup_data (global_magic, data, bytes_read,
+  mime_type = _xdg_mime_magic_lookup_data (global_magic, data, bytes_read, NULL,
 					   mime_types, n);
 
   free (data);
@@ -553,6 +547,19 @@
 }
 
 int
+xdg_mime_get_mime_types_from_file_name (const char *file_name,
+					const char  *mime_types[],
+					int          n_mime_types)
+{
+  xdg_mime_init ();
+  
+  if (_caches)
+    return _xdg_mime_cache_get_mime_types_from_file_name (file_name, mime_types, n_mime_types);
+  
+  return _xdg_glob_hash_lookup_file_name (global_hash, file_name, mime_types, n_mime_types);
+}
+
+int
 xdg_mime_is_valid_mime_type (const char *mime_type)
 {
   /* FIXME: We should make this a better test
@@ -675,8 +682,6 @@
 {
   char *sep;
 
-  xdg_mime_init ();
-
   sep = strchr (mime_a, '/');
   
   if (sep && strncmp (mime_a, mime_b, sep - mime_a + 1) == 0)

Modified: trunk/Utils/xdgmime/xdgmime.h
===================================================================
--- trunk/Utils/xdgmime/xdgmime.h	2008-05-09 13:33:05 UTC (rev 1248)
+++ trunk/Utils/xdgmime/xdgmime.h	2008-05-09 13:35:29 UTC (rev 1249)
@@ -50,13 +50,17 @@
 #define xdg_mime_get_mime_type_for_data       XDG_ENTRY(get_mime_type_for_data)
 #define xdg_mime_get_mime_type_for_file       XDG_ENTRY(get_mime_type_for_file)
 #define xdg_mime_get_mime_type_from_file_name XDG_ENTRY(get_mime_type_from_file_name)
+#define xdg_mime_get_mime_types_from_file_name XDG_ENTRY(get_mime_types_from_file_name)
 #define xdg_mime_is_valid_mime_type           XDG_ENTRY(is_valid_mime_type)
 #define xdg_mime_mime_type_equal              XDG_ENTRY(mime_type_equal)
+#define _xdg_mime_mime_type_equal             XDG_ENTRY(mime_type_equal_p)
 #define xdg_mime_media_type_equal             XDG_ENTRY(media_type_equal)
 #define xdg_mime_mime_type_subclass           XDG_ENTRY(mime_type_subclass)
+#define _xdg_mime_mime_type_subclass          XDG_ENTRY(mime_type_subclass_p)
 #define xdg_mime_get_mime_parents             XDG_ENTRY(get_mime_parents)
 #define xdg_mime_list_mime_parents            XDG_ENTRY(list_mime_parents)
 #define xdg_mime_unalias_mime_type            XDG_ENTRY(unalias_mime_type)
+#define _xdg_mime_unalias_mime_type           XDG_ENTRY(unalias_mime_type_p)  
 #define xdg_mime_get_max_buffer_extents       XDG_ENTRY(get_max_buffer_extents)
 #define xdg_mime_shutdown                     XDG_ENTRY(shutdown)
 #define xdg_mime_dump                         XDG_ENTRY(dump)
@@ -69,10 +73,14 @@
 #define XDG_MIME_TYPE_UNKNOWN xdg_mime_type_unknown
 
 const char  *xdg_mime_get_mime_type_for_data       (const void *data,
-						    size_t      len);
+						    size_t      len,
+						    int        *result_prio);
 const char  *xdg_mime_get_mime_type_for_file       (const char *file_name,
                                                     struct stat *statbuf);
 const char  *xdg_mime_get_mime_type_from_file_name (const char *file_name);
+int          xdg_mime_get_mime_types_from_file_name(const char *file_name,
+						    const char *mime_types[],
+						    int         n_mime_types);
 int          xdg_mime_is_valid_mime_type           (const char *mime_type);
 int          xdg_mime_mime_type_equal              (const char *mime_a,
 						    const char *mime_b);
@@ -99,10 +107,9 @@
    /* Private versions of functions that don't call xdg_mime_init () */
 int          _xdg_mime_mime_type_equal             (const char *mime_a,
 						    const char *mime_b);
-int          _xdg_mime_media_type_equal            (const char *mime_a,
-						    const char *mime_b);
 int          _xdg_mime_mime_type_subclass          (const char *mime,
 						    const char *base);
+const char  *_xdg_mime_unalias_mime_type           (const char *mime);
 
 
 #ifdef __cplusplus

Modified: trunk/Utils/xdgmime/xdgmimealias.h
===================================================================
--- trunk/Utils/xdgmime/xdgmimealias.h	2008-05-09 13:33:05 UTC (rev 1248)
+++ trunk/Utils/xdgmime/xdgmimealias.h	2008-05-09 13:35:29 UTC (rev 1249)
@@ -37,6 +37,7 @@
 #define _xdg_mime_alias_list_new              XDG_ENTRY(alias_list_new)
 #define _xdg_mime_alias_list_free             XDG_ENTRY(alias_list_free)
 #define _xdg_mime_alias_list_lookup           XDG_ENTRY(alias_list_lookup)
+#define _xdg_mime_alias_list_dump             XDG_ENTRY(alias_list_dump)
 #endif
 
 void          _xdg_mime_alias_read_from_file (XdgAliasList *list,

Modified: trunk/Utils/xdgmime/xdgmimecache.c
===================================================================
--- trunk/Utils/xdgmime/xdgmimecache.c	2008-05-09 13:33:05 UTC (rev 1248)
+++ trunk/Utils/xdgmime/xdgmimecache.c	2008-05-09 13:35:29 UTC (rev 1249)
@@ -297,7 +297,7 @@
 	  for (n = 0; n < n_mime_types; n++)
 	    {
 	      if (mime_types[n] && 
-		  xdg_mime_mime_type_equal (mime_types[n], non_match))
+		  _xdg_mime_mime_type_equal (mime_types[n], non_match))
 		mime_types[n] = NULL;
 	    }
 	}
@@ -623,6 +623,7 @@
 static const char *
 cache_get_mime_type_for_data (const void *data,
 			      size_t      len,
+			      int        *result_prio,
 			      const char *mime_types[],
 			      int         n_mime_types)
 {
@@ -647,11 +648,15 @@
 	}
     }
 
+  if (result_prio)
+    *result_prio = priority;
+  
   if (priority > 0)
     return mime_type;
 
   for (n = 0; n < n_mime_types; n++)
     {
+      
       if (mime_types[n])
 	return mime_types[n];
     }
@@ -661,9 +666,10 @@
 
 const char *
 _xdg_mime_cache_get_mime_type_for_data (const void *data,
-					size_t      len)
+					size_t      len,
+					int        *result_prio)
 {
-  return cache_get_mime_type_for_data (data, len, NULL, 0);
+  return cache_get_mime_type_for_data (data, len, result_prio, NULL, 0);
 }
 
 const char *
@@ -726,7 +732,7 @@
       return XDG_MIME_TYPE_UNKNOWN;
     }
 
-  mime_type = cache_get_mime_type_for_data (data, bytes_read,
+  mime_type = cache_get_mime_type_for_data (data, bytes_read, NULL,
 					    mime_types, n);
 
   free (data);
@@ -746,6 +752,14 @@
     return XDG_MIME_TYPE_UNKNOWN;
 }
 
+int
+_xdg_mime_cache_get_mime_types_from_file_name (const char *file_name,
+					       const char  *mime_types[],
+					       int          n_mime_types)
+{
+  return cache_glob_lookup_file_name (file_name, mime_types, n_mime_types);
+}
+
 #if 1
 static int
 is_super_type (const char *mime)
@@ -851,7 +865,7 @@
 char **
 _xdg_mime_cache_list_mime_parents (const char *mime)
 {
-  int i, j, k, p;
+  int i, j, k, l, p;
   char *all_parents[128]; /* we'll stop at 128 */ 
   char **result;
 
@@ -878,14 +892,25 @@
 	      for (k = 0; k < n_parents && p < 127; k++)
 		{
 		  parent_mime_offset = GET_UINT32 (cache->buffer, parents_offset + 4 + 4 * k);
-		  all_parents[p++] = cache->buffer + parent_mime_offset;
+
+		  /* Don't add same parent multiple times.
+		   * This can happen for instance if the same type is listed in multiple directories
+		   */
+		  for (l = 0; l < p; l++)
+		    {
+		      if (strcmp (all_parents[l], cache->buffer + parent_mime_offset) == 0)
+			break;
+		    }
+
+		  if (l == p)
+		    all_parents[p++] = cache->buffer + parent_mime_offset;
 		}
 
 	      break;
 	    }
 	}
     }
-  all_parents[p++] = 0;
+  all_parents[p++] = NULL;
   
   result = (char **) malloc (p * sizeof (char *));
   memcpy (result, all_parents, p * sizeof (char *));

Modified: trunk/Utils/xdgmime/xdgmimecache.h
===================================================================
--- trunk/Utils/xdgmime/xdgmimecache.h	2008-05-09 13:33:05 UTC (rev 1248)
+++ trunk/Utils/xdgmime/xdgmimecache.h	2008-05-09 13:35:29 UTC (rev 1249)
@@ -32,9 +32,18 @@
 typedef struct _XdgMimeCache XdgMimeCache;
 
 #ifdef XDG_PREFIX
-#define _xdg_mime_cache_new_from_file        XDG_ENTRY(cache_new_from_file)
-#define _xdg_mime_cache_ref                  XDG_ENTRY(cache_ref)
-#define _xdg_mime_cache_unref                XDG_ENTRY(cache_unref)
+#define _xdg_mime_cache_new_from_file                 XDG_ENTRY(cache_new_from_file)
+#define _xdg_mime_cache_ref                           XDG_ENTRY(cache_ref)
+#define _xdg_mime_cache_unref                         XDG_ENTRY(cache_unref)
+#define _xdg_mime_cache_get_max_buffer_extents        XDG_ENTRY(cache_get_max_buffer_extents)
+#define _xdg_mime_cache_get_mime_type_for_data        XDG_ENTRY(cache_get_mime_type_for_data)
+#define _xdg_mime_cache_get_mime_type_for_file        XDG_ENTRY(cache_get_mime_type_for_file)
+#define _xdg_mime_cache_get_mime_type_from_file_name  XDG_ENTRY(cache_get_mime_type_from_file_name)
+#define _xdg_mime_cache_get_mime_types_from_file_name XDG_ENTRY(cache_get_mime_types_from_file_name)
+#define _xdg_mime_cache_list_mime_parents             XDG_ENTRY(cache_list_mime_parents)
+#define _xdg_mime_cache_mime_type_subclass            XDG_ENTRY(cache_mime_type_subclass)
+#define _xdg_mime_cache_unalias_mime_type             XDG_ENTRY(cache_unalias_mime_type)
+
 #endif
 
 extern XdgMimeCache **_caches;
@@ -45,9 +54,13 @@
 
 
 const char  *_xdg_mime_cache_get_mime_type_for_data       (const void *data,
-		 				           size_t      len);
+		 				           size_t      len,
+							   int        *result_prio);
 const char  *_xdg_mime_cache_get_mime_type_for_file       (const char  *file_name,
 							   struct stat *statbuf);
+int          _xdg_mime_cache_get_mime_types_from_file_name (const char *file_name,
+							    const char  *mime_types[],
+							    int          n_mime_types);
 const char  *_xdg_mime_cache_get_mime_type_from_file_name (const char *file_name);
 int          _xdg_mime_cache_is_valid_mime_type           (const char *mime_type);
 int          _xdg_mime_cache_mime_type_equal              (const char *mime_a,

Modified: trunk/Utils/xdgmime/xdgmimemagic.c
===================================================================
--- trunk/Utils/xdgmime/xdgmimemagic.c	2008-05-09 13:33:05 UTC (rev 1248)
+++ trunk/Utils/xdgmime/xdgmimemagic.c	2008-05-09 13:35:29 UTC (rev 1249)
@@ -656,21 +656,24 @@
 _xdg_mime_magic_lookup_data (XdgMimeMagic *mime_magic,
 			     const void   *data,
 			     size_t        len,
+			     int           *result_prio,
                              const char   *mime_types[],
                              int           n_mime_types)
 {
   XdgMimeMagicMatch *match;
   const char *mime_type;
   int n;
+  int prio;
 
+  prio = 0;
   mime_type = NULL;
   for (match = mime_magic->match_list; match; match = match->next)
     {
       if (_xdg_mime_magic_match_compare_to_data (match, data, len))
 	{
-	  if ((mime_type == NULL) || (_xdg_mime_mime_type_subclass (match->mime_type, mime_type))) {
-	    mime_type = match->mime_type;
-	  }
+	  prio = match->priority;
+	  mime_type = match->mime_type;
+	  break;
 	}
       else 
 	{
@@ -691,6 +694,9 @@
 	    mime_type = mime_types[n];
 	}
     }
+  
+  if (result_prio)
+    *result_prio = prio;
 
   return mime_type;
 }

Modified: trunk/Utils/xdgmime/xdgmimemagic.h
===================================================================
--- trunk/Utils/xdgmime/xdgmimemagic.h	2008-05-09 13:33:05 UTC (rev 1248)
+++ trunk/Utils/xdgmime/xdgmimemagic.h	2008-05-09 13:35:29 UTC (rev 1249)
@@ -50,6 +50,7 @@
 const char   *_xdg_mime_magic_lookup_data        (XdgMimeMagic *mime_magic,
 						  const void   *data,
 						  size_t        len,
+						  int          *result_prio,
 						  const char   *mime_types[],
 						  int           n_mime_types);
 

Modified: trunk/Utils/xdgmime/xdgmimeparent.h
===================================================================
--- trunk/Utils/xdgmime/xdgmimeparent.h	2008-05-09 13:33:05 UTC (rev 1248)
+++ trunk/Utils/xdgmime/xdgmimeparent.h	2008-05-09 13:35:29 UTC (rev 1249)
@@ -37,6 +37,7 @@
 #define _xdg_mime_parent_list_new              XDG_ENTRY(parent_list_new)
 #define _xdg_mime_parent_list_free             XDG_ENTRY(parent_list_free)
 #define _xdg_mime_parent_list_lookup           XDG_ENTRY(parent_list_lookup)
+#define _xdg_mime_parent_list_dump             XDG_ENTRY(parent_list_dump)
 #endif
 
 void          _xdg_mime_parent_read_from_file (XdgParentList *list,



From fabricecolin at mail.berlios.de  Sun May 11 04:16:19 2008
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sun, 11 May 2008 04:16:19 +0200
Subject: [Pinot-svn] r1250 - trunk/po
Message-ID: <200805110216.m4B2GJNM004584@sheep.berlios.de>

Author: fabricecolin
Date: 2008-05-11 04:16:14 +0200 (Sun, 11 May 2008)
New Revision: 1250

Modified:
   trunk/po/de.po
   trunk/po/es.po
   trunk/po/fr.po
   trunk/po/it.po
   trunk/po/ja.po
   trunk/po/nl.po
   trunk/po/pt.po
   trunk/po/pt_BR.po
   trunk/po/ru.po
   trunk/po/sv.po
   trunk/po/zh_CN.po
   trunk/po/zh_TW.po
Log:
Synced with latest changes.


Modified: trunk/po/de.po
===================================================================
--- trunk/po/de.po	2008-05-09 13:35:29 UTC (rev 1249)
+++ trunk/po/de.po	2008-05-11 02:16:14 UTC (rev 1250)
@@ -6,7 +6,7 @@
 msgstr ""
 "Project-Id-Version: pinot 0.85\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2008-05-04 22:14+0800\n"
+"POT-Creation-Date: 2008-05-06 22:58+0800\n"
 "PO-Revision-Date: 2008-01-15 00:16+0000\n"
 "Last-Translator: Christian Dywan <christian at twotoasts.de>\n"
 "Language-Team: German <de at li.org>\n"
@@ -32,8 +32,8 @@
 #: UI/GTK2/src/mainWindow.cc:984 UI/GTK2/src/mainWindow.cc:1283
 #: UI/GTK2/src/mainWindow.cc:1504 UI/GTK2/src/mainWindow.cc:1540
 #: UI/GTK2/src/mainWindow.cc:1562 UI/GTK2/src/mainWindow.cc:2273
-#: UI/GTK2/src/PinotSettings.cpp:322 UI/GTK2/src/PinotSettings.cpp:1470
-#: UI/GTK2/src/PinotSettings.cpp:1526 UI/GTK2/src/statisticsDialog.cc:79
+#: UI/GTK2/src/PinotSettings.cpp:323 UI/GTK2/src/PinotSettings.cpp:1474
+#: UI/GTK2/src/PinotSettings.cpp:1530 UI/GTK2/src/statisticsDialog.cc:79
 #: UI/GTK2/src/WorkerThreads.cpp:1009
 msgid "My Web Pages"
 msgstr "Meine Webseiten"
@@ -41,8 +41,8 @@
 #. Spawn new threads
 #: UI/GTK2/src/EnginesTree.cpp:338 UI/GTK2/src/mainWindow.cc:763
 #: UI/GTK2/src/mainWindow.cc:978 UI/GTK2/src/mainWindow.cc:1287
-#: UI/GTK2/src/mainWindow.cc:2277 UI/GTK2/src/PinotSettings.cpp:323
-#: UI/GTK2/src/PinotSettings.cpp:1471 UI/GTK2/src/PinotSettings.cpp:1527
+#: UI/GTK2/src/mainWindow.cc:2277 UI/GTK2/src/PinotSettings.cpp:324
+#: UI/GTK2/src/PinotSettings.cpp:1475 UI/GTK2/src/PinotSettings.cpp:1531
 #: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:1019
 msgid "My Documents"
 msgstr "Meine Dokumente"
@@ -575,23 +575,23 @@
 msgstr "Konnte Verlaufsdatenbank nicht anlegen"
 
 #. Add default labels
-#: UI/GTK2/src/PinotSettings.cpp:328
+#: UI/GTK2/src/PinotSettings.cpp:329
 msgid "Important"
 msgstr "Wichtig"
 
-#: UI/GTK2/src/PinotSettings.cpp:329
+#: UI/GTK2/src/PinotSettings.cpp:330
 msgid "New"
 msgstr "Neu"
 
-#: UI/GTK2/src/PinotSettings.cpp:330
+#: UI/GTK2/src/PinotSettings.cpp:331
 msgid "Personal"
 msgstr "Pers?nlich"
 
-#: UI/GTK2/src/PinotSettings.cpp:350
+#: UI/GTK2/src/PinotSettings.cpp:351
 msgid "Me"
 msgstr ""
 
-#: UI/GTK2/src/PinotSettings.cpp:1266
+#: UI/GTK2/src/PinotSettings.cpp:1270
 msgid "Unclassified"
 msgstr ""
 

Modified: trunk/po/es.po
===================================================================
--- trunk/po/es.po	2008-05-09 13:35:29 UTC (rev 1249)
+++ trunk/po/es.po	2008-05-11 02:16:14 UTC (rev 1250)
@@ -7,7 +7,7 @@
 msgstr ""
 "Project-Id-Version: pinot 0.85\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2008-05-04 22:14+0800\n"
+"POT-Creation-Date: 2008-05-06 22:58+0800\n"
 "PO-Revision-Date: 2008-04-05 23:03+0000\n"
 "Last-Translator: Jesus Tramullas <jesus at tramullas.com>\n"
 "Language-Team: es <fabricecolin at users.berlios.de>\n"
@@ -33,8 +33,8 @@
 #: UI/GTK2/src/mainWindow.cc:984 UI/GTK2/src/mainWindow.cc:1283
 #: UI/GTK2/src/mainWindow.cc:1504 UI/GTK2/src/mainWindow.cc:1540
 #: UI/GTK2/src/mainWindow.cc:1562 UI/GTK2/src/mainWindow.cc:2273
-#: UI/GTK2/src/PinotSettings.cpp:322 UI/GTK2/src/PinotSettings.cpp:1470
-#: UI/GTK2/src/PinotSettings.cpp:1526 UI/GTK2/src/statisticsDialog.cc:79
+#: UI/GTK2/src/PinotSettings.cpp:323 UI/GTK2/src/PinotSettings.cpp:1474
+#: UI/GTK2/src/PinotSettings.cpp:1530 UI/GTK2/src/statisticsDialog.cc:79
 #: UI/GTK2/src/WorkerThreads.cpp:1009
 msgid "My Web Pages"
 msgstr "Mis Paginas Web"
@@ -42,8 +42,8 @@
 #. Spawn new threads
 #: UI/GTK2/src/EnginesTree.cpp:338 UI/GTK2/src/mainWindow.cc:763
 #: UI/GTK2/src/mainWindow.cc:978 UI/GTK2/src/mainWindow.cc:1287
-#: UI/GTK2/src/mainWindow.cc:2277 UI/GTK2/src/PinotSettings.cpp:323
-#: UI/GTK2/src/PinotSettings.cpp:1471 UI/GTK2/src/PinotSettings.cpp:1527
+#: UI/GTK2/src/mainWindow.cc:2277 UI/GTK2/src/PinotSettings.cpp:324
+#: UI/GTK2/src/PinotSettings.cpp:1475 UI/GTK2/src/PinotSettings.cpp:1531
 #: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:1019
 msgid "My Documents"
 msgstr "Mis documentos"
@@ -563,23 +563,23 @@
 msgstr "No se pudo crear la base de datos del hist?rico"
 
 #. Add default labels
-#: UI/GTK2/src/PinotSettings.cpp:328
+#: UI/GTK2/src/PinotSettings.cpp:329
 msgid "Important"
 msgstr "Importante"
 
-#: UI/GTK2/src/PinotSettings.cpp:329
+#: UI/GTK2/src/PinotSettings.cpp:330
 msgid "New"
 msgstr "Nuevo"
 
-#: UI/GTK2/src/PinotSettings.cpp:330
+#: UI/GTK2/src/PinotSettings.cpp:331
 msgid "Personal"
 msgstr "Personal"
 
-#: UI/GTK2/src/PinotSettings.cpp:350
+#: UI/GTK2/src/PinotSettings.cpp:351
 msgid "Me"
 msgstr "Yo"
 
-#: UI/GTK2/src/PinotSettings.cpp:1266
+#: UI/GTK2/src/PinotSettings.cpp:1270
 msgid "Unclassified"
 msgstr "No clasificado"
 

Modified: trunk/po/fr.po
===================================================================
--- trunk/po/fr.po	2008-05-09 13:35:29 UTC (rev 1249)
+++ trunk/po/fr.po	2008-05-11 02:16:14 UTC (rev 1250)
@@ -7,7 +7,7 @@
 msgstr ""
 "Project-Id-Version: pinot 0.85\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2008-05-04 22:14+0800\n"
+"POT-Creation-Date: 2008-05-06 22:58+0800\n"
 "PO-Revision-Date: 2008-03-24 18:17+0800\n"
 "Last-Translator: Fabrice Colin <fabricecolin at users.berlios.de>\n"
 "Language-Team: fr <fabricecolin at users.berlios.de>\n"
@@ -33,8 +33,8 @@
 #: UI/GTK2/src/mainWindow.cc:984 UI/GTK2/src/mainWindow.cc:1283
 #: UI/GTK2/src/mainWindow.cc:1504 UI/GTK2/src/mainWindow.cc:1540
 #: UI/GTK2/src/mainWindow.cc:1562 UI/GTK2/src/mainWindow.cc:2273
-#: UI/GTK2/src/PinotSettings.cpp:322 UI/GTK2/src/PinotSettings.cpp:1470
-#: UI/GTK2/src/PinotSettings.cpp:1526 UI/GTK2/src/statisticsDialog.cc:79
+#: UI/GTK2/src/PinotSettings.cpp:323 UI/GTK2/src/PinotSettings.cpp:1474
+#: UI/GTK2/src/PinotSettings.cpp:1530 UI/GTK2/src/statisticsDialog.cc:79
 #: UI/GTK2/src/WorkerThreads.cpp:1009
 msgid "My Web Pages"
 msgstr "Mes Pages Web"
@@ -42,8 +42,8 @@
 #. Spawn new threads
 #: UI/GTK2/src/EnginesTree.cpp:338 UI/GTK2/src/mainWindow.cc:763
 #: UI/GTK2/src/mainWindow.cc:978 UI/GTK2/src/mainWindow.cc:1287
-#: UI/GTK2/src/mainWindow.cc:2277 UI/GTK2/src/PinotSettings.cpp:323
-#: UI/GTK2/src/PinotSettings.cpp:1471 UI/GTK2/src/PinotSettings.cpp:1527
+#: UI/GTK2/src/mainWindow.cc:2277 UI/GTK2/src/PinotSettings.cpp:324
+#: UI/GTK2/src/PinotSettings.cpp:1475 UI/GTK2/src/PinotSettings.cpp:1531
 #: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:1019
 msgid "My Documents"
 msgstr "Mes Documents"
@@ -564,23 +564,23 @@
 msgstr "N'a pas pu creer la base d'historiques"
 
 #. Add default labels
-#: UI/GTK2/src/PinotSettings.cpp:328
+#: UI/GTK2/src/PinotSettings.cpp:329
 msgid "Important"
 msgstr "Important"
 
-#: UI/GTK2/src/PinotSettings.cpp:329
+#: UI/GTK2/src/PinotSettings.cpp:330
 msgid "New"
 msgstr "Nouveau"
 
-#: UI/GTK2/src/PinotSettings.cpp:330
+#: UI/GTK2/src/PinotSettings.cpp:331
 msgid "Personal"
 msgstr "Personnel"
 
-#: UI/GTK2/src/PinotSettings.cpp:350
+#: UI/GTK2/src/PinotSettings.cpp:351
 msgid "Me"
 msgstr "Moi"
 
-#: UI/GTK2/src/PinotSettings.cpp:1266
+#: UI/GTK2/src/PinotSettings.cpp:1270
 msgid "Unclassified"
 msgstr "Sans classification"
 

Modified: trunk/po/it.po
===================================================================
--- trunk/po/it.po	2008-05-09 13:35:29 UTC (rev 1249)
+++ trunk/po/it.po	2008-05-11 02:16:14 UTC (rev 1250)
@@ -6,7 +6,7 @@
 msgstr ""
 "Project-Id-Version: pinot 0.85\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2008-05-04 22:14+0800\n"
+"POT-Creation-Date: 2008-05-06 22:58+0800\n"
 "PO-Revision-Date: 2008-01-15 00:09+0000\n"
 "Last-Translator: Marco Bazzani <visitors at libero.it>\n"
 "Language-Team: Italian <it at li.org>\n"
@@ -32,8 +32,8 @@
 #: UI/GTK2/src/mainWindow.cc:984 UI/GTK2/src/mainWindow.cc:1283
 #: UI/GTK2/src/mainWindow.cc:1504 UI/GTK2/src/mainWindow.cc:1540
 #: UI/GTK2/src/mainWindow.cc:1562 UI/GTK2/src/mainWindow.cc:2273
-#: UI/GTK2/src/PinotSettings.cpp:322 UI/GTK2/src/PinotSettings.cpp:1470
-#: UI/GTK2/src/PinotSettings.cpp:1526 UI/GTK2/src/statisticsDialog.cc:79
+#: UI/GTK2/src/PinotSettings.cpp:323 UI/GTK2/src/PinotSettings.cpp:1474
+#: UI/GTK2/src/PinotSettings.cpp:1530 UI/GTK2/src/statisticsDialog.cc:79
 #: UI/GTK2/src/WorkerThreads.cpp:1009
 msgid "My Web Pages"
 msgstr "Pagine web personali"
@@ -41,8 +41,8 @@
 #. Spawn new threads
 #: UI/GTK2/src/EnginesTree.cpp:338 UI/GTK2/src/mainWindow.cc:763
 #: UI/GTK2/src/mainWindow.cc:978 UI/GTK2/src/mainWindow.cc:1287
-#: UI/GTK2/src/mainWindow.cc:2277 UI/GTK2/src/PinotSettings.cpp:323
-#: UI/GTK2/src/PinotSettings.cpp:1471 UI/GTK2/src/PinotSettings.cpp:1527
+#: UI/GTK2/src/mainWindow.cc:2277 UI/GTK2/src/PinotSettings.cpp:324
+#: UI/GTK2/src/PinotSettings.cpp:1475 UI/GTK2/src/PinotSettings.cpp:1531
 #: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:1019
 msgid "My Documents"
 msgstr "Documenti personali"
@@ -570,23 +570,23 @@
 msgstr "Impossibile creare una cronologia del database"
 
 #. Add default labels
-#: UI/GTK2/src/PinotSettings.cpp:328
+#: UI/GTK2/src/PinotSettings.cpp:329
 msgid "Important"
 msgstr "Importante"
 
-#: UI/GTK2/src/PinotSettings.cpp:329
+#: UI/GTK2/src/PinotSettings.cpp:330
 msgid "New"
 msgstr "Nuovo"
 
-#: UI/GTK2/src/PinotSettings.cpp:330
+#: UI/GTK2/src/PinotSettings.cpp:331
 msgid "Personal"
 msgstr "Personale"
 
-#: UI/GTK2/src/PinotSettings.cpp:350
+#: UI/GTK2/src/PinotSettings.cpp:351
 msgid "Me"
 msgstr ""
 
-#: UI/GTK2/src/PinotSettings.cpp:1266
+#: UI/GTK2/src/PinotSettings.cpp:1270
 msgid "Unclassified"
 msgstr "Non classificato"
 

Modified: trunk/po/ja.po
===================================================================
--- trunk/po/ja.po	2008-05-09 13:35:29 UTC (rev 1249)
+++ trunk/po/ja.po	2008-05-11 02:16:14 UTC (rev 1250)
@@ -5,16 +5,16 @@
 #
 msgid ""
 msgstr ""
-"Project-Id-Version: pinot 0.85\n"
+"Project-Id-Version: pinot\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2008-05-04 22:14+0800\n"
-"PO-Revision-Date: 2008-04-14 04:25+0000\n"
+"POT-Creation-Date: 2008-05-06 22:58+0800\n"
+"PO-Revision-Date: 2008-05-08 02:15+0000\n"
 "Last-Translator: Takeo Mizuki <Unknown>\n"
 "Language-Team: Japanese <ja at li.org>\n"
 "MIME-Version: 1.0\n"
 "Content-Type: text/plain; charset=UTF-8\n"
 "Content-Transfer-Encoding: 8bit\n"
-"X-Launchpad-Export-Date: 2008-04-24 13:56+0000\n"
+"X-Launchpad-Export-Date: 2008-05-08 12:56+0000\n"
 "X-Generator: Launchpad (build Unknown)\n"
 
 #: UI/GTK2/src/EnginesTree.cpp:68 UI/GTK2/src/statisticsDialog.cc:89
@@ -33,8 +33,8 @@
 #: UI/GTK2/src/mainWindow.cc:984 UI/GTK2/src/mainWindow.cc:1283
 #: UI/GTK2/src/mainWindow.cc:1504 UI/GTK2/src/mainWindow.cc:1540
 #: UI/GTK2/src/mainWindow.cc:1562 UI/GTK2/src/mainWindow.cc:2273
-#: UI/GTK2/src/PinotSettings.cpp:322 UI/GTK2/src/PinotSettings.cpp:1470
-#: UI/GTK2/src/PinotSettings.cpp:1526 UI/GTK2/src/statisticsDialog.cc:79
+#: UI/GTK2/src/PinotSettings.cpp:323 UI/GTK2/src/PinotSettings.cpp:1474
+#: UI/GTK2/src/PinotSettings.cpp:1530 UI/GTK2/src/statisticsDialog.cc:79
 #: UI/GTK2/src/WorkerThreads.cpp:1009
 msgid "My Web Pages"
 msgstr "????????"
@@ -42,8 +42,8 @@
 #. Spawn new threads
 #: UI/GTK2/src/EnginesTree.cpp:338 UI/GTK2/src/mainWindow.cc:763
 #: UI/GTK2/src/mainWindow.cc:978 UI/GTK2/src/mainWindow.cc:1287
-#: UI/GTK2/src/mainWindow.cc:2277 UI/GTK2/src/PinotSettings.cpp:323
-#: UI/GTK2/src/PinotSettings.cpp:1471 UI/GTK2/src/PinotSettings.cpp:1527
+#: UI/GTK2/src/mainWindow.cc:2277 UI/GTK2/src/PinotSettings.cpp:324
+#: UI/GTK2/src/PinotSettings.cpp:1475 UI/GTK2/src/PinotSettings.cpp:1531
 #: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:1019
 msgid "My Documents"
 msgstr "????????"
@@ -187,7 +187,6 @@
 msgstr "????"
 
 #: UI/GTK2/src/mainWindow.cc:244
-#, fuzzy
 msgid "Updating all documents in My Web Pages is recommended"
 msgstr "?????????????????????????????"
 
@@ -236,11 +235,12 @@
 
 #: UI/GTK2/src/mainWindow.cc:1172
 msgid "of"
-msgstr ""
+msgstr "of"
 
 #: UI/GTK2/src/mainWindow.cc:1177
+#, fuzzy
 msgid "documents, starting at"
-msgstr ""
+msgstr "??????????:"
 
 #: UI/GTK2/src/mainWindow.cc:1219
 msgid "Query"
@@ -248,7 +248,7 @@
 
 #: UI/GTK2/src/mainWindow.cc:1223 UI/GTK2/src/mainWindow.cc:3259
 msgid "on"
-msgstr ""
+msgstr "on"
 
 #: UI/GTK2/src/mainWindow.cc:1227
 msgid "ended"
@@ -256,25 +256,22 @@
 
 #: UI/GTK2/src/mainWindow.cc:1233
 msgid "Corrected"
-msgstr ""
+msgstr "????"
 
 #: UI/GTK2/src/mainWindow.cc:1387
 msgid "More Like"
-msgstr ""
+msgstr "????????"
 
 #: UI/GTK2/src/mainWindow.cc:1430
-#, fuzzy
 msgid "Updated label(s)"
-msgstr "???????????"
+msgstr "????????"
 
 #. Yes, it did
 #: UI/GTK2/src/mainWindow.cc:1514 UI/GTK2/src/mainWindow.cc:1602
-#, fuzzy
 msgid "Updated document"
-msgstr "??????????"
+msgstr "???????"
 
 #: UI/GTK2/src/mainWindow.cc:1527
-#, fuzzy
 msgid "Indexed"
 msgstr "??????"
 
@@ -296,7 +293,6 @@
 msgstr "????????????????"
 
 #: UI/GTK2/src/mainWindow.cc:1690
-#, fuzzy
 msgid "Edited index"
 msgstr "?????????"
 
@@ -309,16 +305,14 @@
 msgstr "??????"
 
 #: UI/GTK2/src/mainWindow.cc:2294
-#, fuzzy
 msgid "doesn't exist"
-msgstr "??????"
+msgstr "????????"
 
 #: UI/GTK2/src/mainWindow.cc:2372
 msgid "Remove this document from the index ?"
 msgstr "????????????????????"
 
 #: UI/GTK2/src/mainWindow.cc:2391
-#, fuzzy
 msgid "Remove these documents from the index ?"
 msgstr "??????????????????????"
 
@@ -343,7 +337,6 @@
 msgstr "??????????????"
 
 #: UI/GTK2/src/mainWindow.cc:2515
-#, fuzzy
 msgid "Added new index"
 msgstr "???????????"
 
@@ -373,16 +366,14 @@
 msgstr "????????????"
 
 #: UI/GTK2/src/mainWindow.cc:3094
-#, fuzzy
 msgid "Edited query"
-msgstr "?????????"
+msgstr "???????"
 
 #: UI/GTK2/src/mainWindow.cc:3101
 msgid "Couldn't add query"
 msgstr "????????????"
 
 #: UI/GTK2/src/mainWindow.cc:3109
-#, fuzzy
 msgid "Added new query"
 msgstr "?????????"
 
@@ -415,7 +406,6 @@
 msgstr "??"
 
 #: UI/GTK2/src/mainWindow_glade.cc:142
-#, fuzzy
 msgid "Stored queries"
 msgstr "?????????"
 
@@ -438,7 +428,7 @@
 
 #: UI/GTK2/src/mainWindow_glade.cc:185
 msgid "Group By"
-msgstr ""
+msgstr "??????"
 
 #: UI/GTK2/src/mainWindow_glade.cc:191
 msgid "Clear List"
@@ -454,7 +444,7 @@
 
 #: UI/GTK2/src/mainWindow_glade.cc:203
 msgid "More Like This"
-msgstr ""
+msgstr "????????"
 
 #: UI/GTK2/src/mainWindow_glade.cc:206
 msgid "Search This For"
@@ -466,7 +456,7 @@
 
 #: UI/GTK2/src/mainWindow_glade.cc:212
 msgid "List Contents Of"
-msgstr ""
+msgstr "???????"
 
 #: UI/GTK2/src/mainWindow_glade.cc:221
 msgid "View"
@@ -531,7 +521,6 @@
 msgstr "????"
 
 #: UI/GTK2/src/pinot.cc:243 UI/GTK2/src/pinot-dbus-daemon.cc:499
-#, fuzzy
 msgid "Hungarian"
 msgstr "??????"
 
@@ -576,25 +565,23 @@
 msgstr "????????????????"
 
 #. Add default labels
-#: UI/GTK2/src/PinotSettings.cpp:328
+#: UI/GTK2/src/PinotSettings.cpp:329
 msgid "Important"
 msgstr "??"
 
-#: UI/GTK2/src/PinotSettings.cpp:329
-#, fuzzy
+#: UI/GTK2/src/PinotSettings.cpp:330
 msgid "New"
 msgstr "????"
 
-#: UI/GTK2/src/PinotSettings.cpp:330
-#, fuzzy
+#: UI/GTK2/src/PinotSettings.cpp:331
 msgid "Personal"
 msgstr "???"
 
-#: UI/GTK2/src/PinotSettings.cpp:350
+#: UI/GTK2/src/PinotSettings.cpp:351
 msgid "Me"
-msgstr ""
+msgstr "??"
 
-#: UI/GTK2/src/PinotSettings.cpp:1266
+#: UI/GTK2/src/PinotSettings.cpp:1270
 msgid "Unclassified"
 msgstr "???"
 
@@ -607,7 +594,6 @@
 msgstr "????"
 
 #: UI/GTK2/src/prefsDialog.cc:92
-#, fuzzy
 msgid "Location"
 msgstr "??"
 
@@ -628,7 +614,6 @@
 msgstr "?????"
 
 #: UI/GTK2/src/prefsDialog.cc:524
-#, fuzzy
 msgid "Directory to index"
 msgstr "??????????????????"
 
@@ -646,7 +631,7 @@
 
 #: UI/GTK2/src/prefsDialog_glade.cc:70
 msgid "Enable search terms suggestion"
-msgstr ""
+msgstr "??????????"
 
 #: UI/GTK2/src/prefsDialog_glade.cc:72
 msgid "Ignore robots.txt and Robots META tag"
@@ -674,7 +659,7 @@
 
 #: UI/GTK2/src/prefsDialog_glade.cc:93
 msgid "Labels are used to classify indexed documents:"
-msgstr ""
+msgstr "?????????????????????????"
 
 #: UI/GTK2/src/prefsDialog_glade.cc:98 UI/GTK2/src/prefsDialog_glade.cc:118
 #: UI/GTK2/src/prefsDialog_glade.cc:134
@@ -692,6 +677,7 @@
 #: UI/GTK2/src/prefsDialog_glade.cc:113
 msgid "These directories will be indexed and optionally monitored for changes:"
 msgstr ""
+"????????????????????????????????????"
 
 #: UI/GTK2/src/prefsDialog_glade.cc:126
 msgid "File patterns:"
@@ -703,9 +689,8 @@
 msgstr "??(_R)"
 
 #: UI/GTK2/src/prefsDialog_glade.cc:144
-#, fuzzy
 msgid "Indexing"
-msgstr "??????????"
+msgstr "??????"
 
 #: UI/GTK2/src/prefsDialog_glade.cc:512
 msgid "Preferences"
@@ -713,10 +698,9 @@
 
 #: UI/GTK2/src/propertiesDialog.cc:105
 msgid "Per document"
-msgstr ""
+msgstr "??"
 
 #: UI/GTK2/src/propertiesDialog.cc:365
-#, fuzzy
 msgid "Export Terms"
 msgstr "????????"
 
@@ -733,9 +717,8 @@
 msgstr "???:"
 
 #: UI/GTK2/src/propertiesDialog_glade.cc:67
-#, fuzzy
 msgid "Terms:"
-msgstr "??:"
+msgstr "??"
 
 #: UI/GTK2/src/propertiesDialog_glade.cc:77
 msgid "bytes"
@@ -789,7 +772,6 @@
 msgstr "??"
 
 #: UI/GTK2/src/queryDialog.cc:123
-#, fuzzy
 msgid "Time"
 msgstr "??"
 
@@ -800,14 +782,13 @@
 #. Sort order
 #: UI/GTK2/src/queryDialog.cc:128
 msgid "By relevance"
-msgstr ""
+msgstr "???"
 
 #: UI/GTK2/src/queryDialog.cc:129
 msgid "By date"
-msgstr ""
+msgstr "??"
 
 #: UI/GTK2/src/queryDialog_glade.cc:71
-#, fuzzy
 msgid "New filter or range:"
 msgstr "??????/??"
 
@@ -817,7 +798,7 @@
 
 #: UI/GTK2/src/queryDialog_glade.cc:82
 msgid "Index results with label"
-msgstr ""
+msgstr "???????????"
 
 #: UI/GTK2/src/queryDialog_glade.cc:85
 msgid "Number of results:"
@@ -829,7 +810,7 @@
 
 #: UI/GTK2/src/queryDialog_glade.cc:93
 msgid "Stemming:"
-msgstr ""
+msgstr "????"
 
 #: UI/GTK2/src/queryDialog_glade.cc:94
 #, fuzzy
@@ -897,7 +878,7 @@
 
 #: UI/GTK2/src/statisticsDialog.cc:213
 msgid "Currently not running"
-msgstr ""
+msgstr "?????"
 
 #: UI/GTK2/src/statisticsDialog.cc:243
 msgid "Errors"
@@ -940,7 +921,6 @@
 msgstr "????????????"
 
 #: UI/GTK2/src/WorkerThreads.cpp:110
-#, fuzzy
 msgid "Index doesn't exist"
 msgstr "?????????????"
 
@@ -958,14 +938,13 @@
 
 #: UI/GTK2/src/WorkerThreads.cpp:118
 msgid "Robots META tag forbids indexing"
-msgstr ""
+msgstr "????????????????????"
 
 #: UI/GTK2/src/WorkerThreads.cpp:120
 msgid "No monitoring handler"
 msgstr "?????????????????"
 
 #: UI/GTK2/src/WorkerThreads.cpp:416
-#, fuzzy
 msgid "Indexing was stopped"
 msgstr "???????????????"
 
@@ -974,12 +953,10 @@
 msgstr "??????????????????"
 
 #: UI/GTK2/src/WorkerThreads.cpp:450 UI/GTK2/src/WorkerThreads.cpp:715
-#, fuzzy
 msgid "is already being indexed"
 msgstr "??????????????????"
 
 #: UI/GTK2/src/WorkerThreads.cpp:460
-#, fuzzy
 msgid "is blacklisted"
 msgstr "?????????????????"
 

Modified: trunk/po/nl.po
===================================================================
--- trunk/po/nl.po	2008-05-09 13:35:29 UTC (rev 1249)
+++ trunk/po/nl.po	2008-05-11 02:16:14 UTC (rev 1250)
@@ -6,7 +6,7 @@
 msgstr ""
 "Project-Id-Version: pinot 0.85\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2008-05-04 22:14+0800\n"
+"POT-Creation-Date: 2008-05-06 22:58+0800\n"
 "PO-Revision-Date: 2008-01-15 00:13+0000\n"
 "Last-Translator: JW <jw00000 at gmail.com>\n"
 "Language-Team: Dutch <nl at li.org>\n"
@@ -32,8 +32,8 @@
 #: UI/GTK2/src/mainWindow.cc:984 UI/GTK2/src/mainWindow.cc:1283
 #: UI/GTK2/src/mainWindow.cc:1504 UI/GTK2/src/mainWindow.cc:1540
 #: UI/GTK2/src/mainWindow.cc:1562 UI/GTK2/src/mainWindow.cc:2273
-#: UI/GTK2/src/PinotSettings.cpp:322 UI/GTK2/src/PinotSettings.cpp:1470
-#: UI/GTK2/src/PinotSettings.cpp:1526 UI/GTK2/src/statisticsDialog.cc:79
+#: UI/GTK2/src/PinotSettings.cpp:323 UI/GTK2/src/PinotSettings.cpp:1474
+#: UI/GTK2/src/PinotSettings.cpp:1530 UI/GTK2/src/statisticsDialog.cc:79
 #: UI/GTK2/src/WorkerThreads.cpp:1009
 msgid "My Web Pages"
 msgstr "Mijn webpagina's"
@@ -41,8 +41,8 @@
 #. Spawn new threads
 #: UI/GTK2/src/EnginesTree.cpp:338 UI/GTK2/src/mainWindow.cc:763
 #: UI/GTK2/src/mainWindow.cc:978 UI/GTK2/src/mainWindow.cc:1287
-#: UI/GTK2/src/mainWindow.cc:2277 UI/GTK2/src/PinotSettings.cpp:323
-#: UI/GTK2/src/PinotSettings.cpp:1471 UI/GTK2/src/PinotSettings.cpp:1527
+#: UI/GTK2/src/mainWindow.cc:2277 UI/GTK2/src/PinotSettings.cpp:324
+#: UI/GTK2/src/PinotSettings.cpp:1475 UI/GTK2/src/PinotSettings.cpp:1531
 #: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:1019
 msgid "My Documents"
 msgstr "Mijn documenten"
@@ -564,23 +564,23 @@
 msgstr "Kon historische database niet maken"
 
 #. Add default labels
-#: UI/GTK2/src/PinotSettings.cpp:328
+#: UI/GTK2/src/PinotSettings.cpp:329
 msgid "Important"
 msgstr "Belangrijk"
 
-#: UI/GTK2/src/PinotSettings.cpp:329
+#: UI/GTK2/src/PinotSettings.cpp:330
 msgid "New"
 msgstr "Nieuw"
 
-#: UI/GTK2/src/PinotSettings.cpp:330
+#: UI/GTK2/src/PinotSettings.cpp:331
 msgid "Personal"
 msgstr "Persoonlijk"
 
-#: UI/GTK2/src/PinotSettings.cpp:350
+#: UI/GTK2/src/PinotSettings.cpp:351
 msgid "Me"
 msgstr "Ik"
 
-#: UI/GTK2/src/PinotSettings.cpp:1266
+#: UI/GTK2/src/PinotSettings.cpp:1270
 msgid "Unclassified"
 msgstr "Niet geclassificeerd"
 

Modified: trunk/po/pt.po
===================================================================
--- trunk/po/pt.po	2008-05-09 13:35:29 UTC (rev 1249)
+++ trunk/po/pt.po	2008-05-11 02:16:14 UTC (rev 1250)
@@ -6,7 +6,7 @@
 msgstr ""
 "Project-Id-Version: pinot 0.85\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2008-05-04 22:14+0800\n"
+"POT-Creation-Date: 2008-05-06 22:58+0800\n"
 "PO-Revision-Date: 2008-01-15 00:12+0000\n"
 "Last-Translator: _PN_boy <pedro_nuno_pn at iol.pt>\n"
 "Language-Team: Portuguese <pt at li.org>\n"
@@ -33,8 +33,8 @@
 #: UI/GTK2/src/mainWindow.cc:984 UI/GTK2/src/mainWindow.cc:1283
 #: UI/GTK2/src/mainWindow.cc:1504 UI/GTK2/src/mainWindow.cc:1540
 #: UI/GTK2/src/mainWindow.cc:1562 UI/GTK2/src/mainWindow.cc:2273
-#: UI/GTK2/src/PinotSettings.cpp:322 UI/GTK2/src/PinotSettings.cpp:1470
-#: UI/GTK2/src/PinotSettings.cpp:1526 UI/GTK2/src/statisticsDialog.cc:79
+#: UI/GTK2/src/PinotSettings.cpp:323 UI/GTK2/src/PinotSettings.cpp:1474
+#: UI/GTK2/src/PinotSettings.cpp:1530 UI/GTK2/src/statisticsDialog.cc:79
 #: UI/GTK2/src/WorkerThreads.cpp:1009
 msgid "My Web Pages"
 msgstr "As minhas p?ginas Web"
@@ -42,8 +42,8 @@
 #. Spawn new threads
 #: UI/GTK2/src/EnginesTree.cpp:338 UI/GTK2/src/mainWindow.cc:763
 #: UI/GTK2/src/mainWindow.cc:978 UI/GTK2/src/mainWindow.cc:1287
-#: UI/GTK2/src/mainWindow.cc:2277 UI/GTK2/src/PinotSettings.cpp:323
-#: UI/GTK2/src/PinotSettings.cpp:1471 UI/GTK2/src/PinotSettings.cpp:1527
+#: UI/GTK2/src/mainWindow.cc:2277 UI/GTK2/src/PinotSettings.cpp:324
+#: UI/GTK2/src/PinotSettings.cpp:1475 UI/GTK2/src/PinotSettings.cpp:1531
 #: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:1019
 msgid "My Documents"
 msgstr "Os Meus Documentos"
@@ -571,23 +571,23 @@
 msgstr "N?o foi poss?vel criar base de dados do hist?rico"
 
 #. Add default labels
-#: UI/GTK2/src/PinotSettings.cpp:328
+#: UI/GTK2/src/PinotSettings.cpp:329
 msgid "Important"
 msgstr "Importante"
 
-#: UI/GTK2/src/PinotSettings.cpp:329
+#: UI/GTK2/src/PinotSettings.cpp:330
 msgid "New"
 msgstr "Novo"
 
-#: UI/GTK2/src/PinotSettings.cpp:330
+#: UI/GTK2/src/PinotSettings.cpp:331
 msgid "Personal"
 msgstr "Pessoal"
 
-#: UI/GTK2/src/PinotSettings.cpp:350
+#: UI/GTK2/src/PinotSettings.cpp:351
 msgid "Me"
 msgstr ""
 
-#: UI/GTK2/src/PinotSettings.cpp:1266
+#: UI/GTK2/src/PinotSettings.cpp:1270
 msgid "Unclassified"
 msgstr "N?o classificado"
 

Modified: trunk/po/pt_BR.po
===================================================================
--- trunk/po/pt_BR.po	2008-05-09 13:35:29 UTC (rev 1249)
+++ trunk/po/pt_BR.po	2008-05-11 02:16:14 UTC (rev 1250)
@@ -6,7 +6,7 @@
 msgstr ""
 "Project-Id-Version: pinot 0.85\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2008-05-04 22:14+0800\n"
+"POT-Creation-Date: 2008-05-06 22:58+0800\n"
 "PO-Revision-Date: 2008-01-15 00:15+0000\n"
 "Last-Translator: Leonardo Melo <leonardovazmelo at gmail.com>\n"
 "Language-Team: Portuguese (Brazil) <pt_BR at li.org>\n"
@@ -32,8 +32,8 @@
 #: UI/GTK2/src/mainWindow.cc:984 UI/GTK2/src/mainWindow.cc:1283
 #: UI/GTK2/src/mainWindow.cc:1504 UI/GTK2/src/mainWindow.cc:1540
 #: UI/GTK2/src/mainWindow.cc:1562 UI/GTK2/src/mainWindow.cc:2273
-#: UI/GTK2/src/PinotSettings.cpp:322 UI/GTK2/src/PinotSettings.cpp:1470
-#: UI/GTK2/src/PinotSettings.cpp:1526 UI/GTK2/src/statisticsDialog.cc:79
+#: UI/GTK2/src/PinotSettings.cpp:323 UI/GTK2/src/PinotSettings.cpp:1474
+#: UI/GTK2/src/PinotSettings.cpp:1530 UI/GTK2/src/statisticsDialog.cc:79
 #: UI/GTK2/src/WorkerThreads.cpp:1009
 msgid "My Web Pages"
 msgstr "Minhas P?ginas Web"
@@ -41,8 +41,8 @@
 #. Spawn new threads
 #: UI/GTK2/src/EnginesTree.cpp:338 UI/GTK2/src/mainWindow.cc:763
 #: UI/GTK2/src/mainWindow.cc:978 UI/GTK2/src/mainWindow.cc:1287
-#: UI/GTK2/src/mainWindow.cc:2277 UI/GTK2/src/PinotSettings.cpp:323
-#: UI/GTK2/src/PinotSettings.cpp:1471 UI/GTK2/src/PinotSettings.cpp:1527
+#: UI/GTK2/src/mainWindow.cc:2277 UI/GTK2/src/PinotSettings.cpp:324
+#: UI/GTK2/src/PinotSettings.cpp:1475 UI/GTK2/src/PinotSettings.cpp:1531
 #: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:1019
 msgid "My Documents"
 msgstr "Meus Documentos"
@@ -571,23 +571,23 @@
 msgstr "N?o foi poss?vel criar base de hist?rico"
 
 #. Add default labels
-#: UI/GTK2/src/PinotSettings.cpp:328
+#: UI/GTK2/src/PinotSettings.cpp:329
 msgid "Important"
 msgstr "Importante"
 
-#: UI/GTK2/src/PinotSettings.cpp:329
+#: UI/GTK2/src/PinotSettings.cpp:330
 msgid "New"
 msgstr "Novo"
 
-#: UI/GTK2/src/PinotSettings.cpp:330
+#: UI/GTK2/src/PinotSettings.cpp:331
 msgid "Personal"
 msgstr "Pessoal"
 
-#: UI/GTK2/src/PinotSettings.cpp:350
+#: UI/GTK2/src/PinotSettings.cpp:351
 msgid "Me"
 msgstr ""
 
-#: UI/GTK2/src/PinotSettings.cpp:1266
+#: UI/GTK2/src/PinotSettings.cpp:1270
 msgid "Unclassified"
 msgstr "N?o classificado"
 

Modified: trunk/po/ru.po
===================================================================
--- trunk/po/ru.po	2008-05-09 13:35:29 UTC (rev 1249)
+++ trunk/po/ru.po	2008-05-11 02:16:14 UTC (rev 1250)
@@ -6,7 +6,7 @@
 msgstr ""
 "Project-Id-Version: pinot 0.85\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2008-05-04 22:14+0800\n"
+"POT-Creation-Date: 2008-05-06 22:58+0800\n"
 "PO-Revision-Date: 2008-01-15 00:16+0000\n"
 "Last-Translator: Sergey Vostrikov <s.vostrikov at gmail.com>\n"
 "Language-Team: Russian <ru at li.org>\n"
@@ -32,8 +32,8 @@
 #: UI/GTK2/src/mainWindow.cc:984 UI/GTK2/src/mainWindow.cc:1283
 #: UI/GTK2/src/mainWindow.cc:1504 UI/GTK2/src/mainWindow.cc:1540
 #: UI/GTK2/src/mainWindow.cc:1562 UI/GTK2/src/mainWindow.cc:2273
-#: UI/GTK2/src/PinotSettings.cpp:322 UI/GTK2/src/PinotSettings.cpp:1470
-#: UI/GTK2/src/PinotSettings.cpp:1526 UI/GTK2/src/statisticsDialog.cc:79
+#: UI/GTK2/src/PinotSettings.cpp:323 UI/GTK2/src/PinotSettings.cpp:1474
+#: UI/GTK2/src/PinotSettings.cpp:1530 UI/GTK2/src/statisticsDialog.cc:79
 #: UI/GTK2/src/WorkerThreads.cpp:1009
 msgid "My Web Pages"
 msgstr "??? web-????????"
@@ -41,8 +41,8 @@
 #. Spawn new threads
 #: UI/GTK2/src/EnginesTree.cpp:338 UI/GTK2/src/mainWindow.cc:763
 #: UI/GTK2/src/mainWindow.cc:978 UI/GTK2/src/mainWindow.cc:1287
-#: UI/GTK2/src/mainWindow.cc:2277 UI/GTK2/src/PinotSettings.cpp:323
-#: UI/GTK2/src/PinotSettings.cpp:1471 UI/GTK2/src/PinotSettings.cpp:1527
+#: UI/GTK2/src/mainWindow.cc:2277 UI/GTK2/src/PinotSettings.cpp:324
+#: UI/GTK2/src/PinotSettings.cpp:1475 UI/GTK2/src/PinotSettings.cpp:1531
 #: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:1019
 msgid "My Documents"
 msgstr "??? ?????????"
@@ -571,23 +571,23 @@
 msgstr "?? ??????? ??????? ???? ?????? ???????"
 
 #. Add default labels
-#: UI/GTK2/src/PinotSettings.cpp:328
+#: UI/GTK2/src/PinotSettings.cpp:329
 msgid "Important"
 msgstr "?????"
 
-#: UI/GTK2/src/PinotSettings.cpp:329
+#: UI/GTK2/src/PinotSettings.cpp:330
 msgid "New"
 msgstr "???????"
 
-#: UI/GTK2/src/PinotSettings.cpp:330
+#: UI/GTK2/src/PinotSettings.cpp:331
 msgid "Personal"
 msgstr "??????"
 
-#: UI/GTK2/src/PinotSettings.cpp:350
+#: UI/GTK2/src/PinotSettings.cpp:351
 msgid "Me"
 msgstr ""
 
-#: UI/GTK2/src/PinotSettings.cpp:1266
+#: UI/GTK2/src/PinotSettings.cpp:1270
 msgid "Unclassified"
 msgstr "??????????????"
 

Modified: trunk/po/sv.po
===================================================================
--- trunk/po/sv.po	2008-05-09 13:35:29 UTC (rev 1249)
+++ trunk/po/sv.po	2008-05-11 02:16:14 UTC (rev 1250)
@@ -7,7 +7,7 @@
 msgstr ""
 "Project-Id-Version: pinot 0.85\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2008-05-04 22:14+0800\n"
+"POT-Creation-Date: 2008-05-06 22:58+0800\n"
 "PO-Revision-Date: 2008-01-15 00:10+0000\n"
 "Last-Translator: Daniel Nylander <yeager at ubuntu.com>\n"
 "Language-Team: Swedish <tp-sv at listor.tp-sv.se>\n"
@@ -33,8 +33,8 @@
 #: UI/GTK2/src/mainWindow.cc:984 UI/GTK2/src/mainWindow.cc:1283
 #: UI/GTK2/src/mainWindow.cc:1504 UI/GTK2/src/mainWindow.cc:1540
 #: UI/GTK2/src/mainWindow.cc:1562 UI/GTK2/src/mainWindow.cc:2273
-#: UI/GTK2/src/PinotSettings.cpp:322 UI/GTK2/src/PinotSettings.cpp:1470
-#: UI/GTK2/src/PinotSettings.cpp:1526 UI/GTK2/src/statisticsDialog.cc:79
+#: UI/GTK2/src/PinotSettings.cpp:323 UI/GTK2/src/PinotSettings.cpp:1474
+#: UI/GTK2/src/PinotSettings.cpp:1530 UI/GTK2/src/statisticsDialog.cc:79
 #: UI/GTK2/src/WorkerThreads.cpp:1009
 msgid "My Web Pages"
 msgstr "Mina webbsidor"
@@ -42,8 +42,8 @@
 #. Spawn new threads
 #: UI/GTK2/src/EnginesTree.cpp:338 UI/GTK2/src/mainWindow.cc:763
 #: UI/GTK2/src/mainWindow.cc:978 UI/GTK2/src/mainWindow.cc:1287
-#: UI/GTK2/src/mainWindow.cc:2277 UI/GTK2/src/PinotSettings.cpp:323
-#: UI/GTK2/src/PinotSettings.cpp:1471 UI/GTK2/src/PinotSettings.cpp:1527
+#: UI/GTK2/src/mainWindow.cc:2277 UI/GTK2/src/PinotSettings.cpp:324
+#: UI/GTK2/src/PinotSettings.cpp:1475 UI/GTK2/src/PinotSettings.cpp:1531
 #: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:1019
 msgid "My Documents"
 msgstr "Mina dokument"
@@ -563,23 +563,23 @@
 msgstr "Kunde inte skapa historikdatabas"
 
 #. Add default labels
-#: UI/GTK2/src/PinotSettings.cpp:328
+#: UI/GTK2/src/PinotSettings.cpp:329
 msgid "Important"
 msgstr "Viktigt"
 
-#: UI/GTK2/src/PinotSettings.cpp:329
+#: UI/GTK2/src/PinotSettings.cpp:330
 msgid "New"
 msgstr "Ny"
 
-#: UI/GTK2/src/PinotSettings.cpp:330
+#: UI/GTK2/src/PinotSettings.cpp:331
 msgid "Personal"
 msgstr "Personlig"
 
-#: UI/GTK2/src/PinotSettings.cpp:350
+#: UI/GTK2/src/PinotSettings.cpp:351
 msgid "Me"
 msgstr "Jag"
 
-#: UI/GTK2/src/PinotSettings.cpp:1266
+#: UI/GTK2/src/PinotSettings.cpp:1270
 msgid "Unclassified"
 msgstr "Oklassificerad"
 

Modified: trunk/po/zh_CN.po
===================================================================
--- trunk/po/zh_CN.po	2008-05-09 13:35:29 UTC (rev 1249)
+++ trunk/po/zh_CN.po	2008-05-11 02:16:14 UTC (rev 1250)
@@ -6,7 +6,7 @@
 msgstr ""
 "Project-Id-Version: pinot 0.85\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2008-05-04 22:14+0800\n"
+"POT-Creation-Date: 2008-05-06 22:58+0800\n"
 "PO-Revision-Date: 2008-03-24 14:32+0800\n"
 "Last-Translator: Ashlee Ma <ashlee8310 at hotmail.com>\n"
 "MIME-Version: 1.0\n"
@@ -29,8 +29,8 @@
 #: UI/GTK2/src/mainWindow.cc:984 UI/GTK2/src/mainWindow.cc:1283
 #: UI/GTK2/src/mainWindow.cc:1504 UI/GTK2/src/mainWindow.cc:1540
 #: UI/GTK2/src/mainWindow.cc:1562 UI/GTK2/src/mainWindow.cc:2273
-#: UI/GTK2/src/PinotSettings.cpp:322 UI/GTK2/src/PinotSettings.cpp:1470
-#: UI/GTK2/src/PinotSettings.cpp:1526 UI/GTK2/src/statisticsDialog.cc:79
+#: UI/GTK2/src/PinotSettings.cpp:323 UI/GTK2/src/PinotSettings.cpp:1474
+#: UI/GTK2/src/PinotSettings.cpp:1530 UI/GTK2/src/statisticsDialog.cc:79
 #: UI/GTK2/src/WorkerThreads.cpp:1009
 msgid "My Web Pages"
 msgstr "????"
@@ -38,8 +38,8 @@
 #. Spawn new threads
 #: UI/GTK2/src/EnginesTree.cpp:338 UI/GTK2/src/mainWindow.cc:763
 #: UI/GTK2/src/mainWindow.cc:978 UI/GTK2/src/mainWindow.cc:1287
-#: UI/GTK2/src/mainWindow.cc:2277 UI/GTK2/src/PinotSettings.cpp:323
-#: UI/GTK2/src/PinotSettings.cpp:1471 UI/GTK2/src/PinotSettings.cpp:1527
+#: UI/GTK2/src/mainWindow.cc:2277 UI/GTK2/src/PinotSettings.cpp:324
+#: UI/GTK2/src/PinotSettings.cpp:1475 UI/GTK2/src/PinotSettings.cpp:1531
 #: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:1019
 msgid "My Documents"
 msgstr "????"
@@ -565,23 +565,23 @@
 msgstr "?????????"
 
 #. Add default labels
-#: UI/GTK2/src/PinotSettings.cpp:328
+#: UI/GTK2/src/PinotSettings.cpp:329
 msgid "Important"
 msgstr "???"
 
-#: UI/GTK2/src/PinotSettings.cpp:329
+#: UI/GTK2/src/PinotSettings.cpp:330
 msgid "New"
 msgstr "??"
 
-#: UI/GTK2/src/PinotSettings.cpp:330
+#: UI/GTK2/src/PinotSettings.cpp:331
 msgid "Personal"
 msgstr "????"
 
-#: UI/GTK2/src/PinotSettings.cpp:350
+#: UI/GTK2/src/PinotSettings.cpp:351
 msgid "Me"
 msgstr ""
 
-#: UI/GTK2/src/PinotSettings.cpp:1266
+#: UI/GTK2/src/PinotSettings.cpp:1270
 msgid "Unclassified"
 msgstr "????"
 

Modified: trunk/po/zh_TW.po
===================================================================
--- trunk/po/zh_TW.po	2008-05-09 13:35:29 UTC (rev 1249)
+++ trunk/po/zh_TW.po	2008-05-11 02:16:14 UTC (rev 1250)
@@ -7,7 +7,7 @@
 msgstr ""
 "Project-Id-Version: pinot 0.85\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2008-05-04 22:14+0800\n"
+"POT-Creation-Date: 2008-05-06 22:58+0800\n"
 "PO-Revision-Date: 2008-01-15 00:13+0000\n"
 "Last-Translator: Yung-chung Lin <henearkrxern at gmail.com>\n"
 "Language-Team: Traditional Chinese <zh_TW at li.org>\n"
@@ -33,8 +33,8 @@
 #: UI/GTK2/src/mainWindow.cc:984 UI/GTK2/src/mainWindow.cc:1283
 #: UI/GTK2/src/mainWindow.cc:1504 UI/GTK2/src/mainWindow.cc:1540
 #: UI/GTK2/src/mainWindow.cc:1562 UI/GTK2/src/mainWindow.cc:2273
-#: UI/GTK2/src/PinotSettings.cpp:322 UI/GTK2/src/PinotSettings.cpp:1470
-#: UI/GTK2/src/PinotSettings.cpp:1526 UI/GTK2/src/statisticsDialog.cc:79
+#: UI/GTK2/src/PinotSettings.cpp:323 UI/GTK2/src/PinotSettings.cpp:1474
+#: UI/GTK2/src/PinotSettings.cpp:1530 UI/GTK2/src/statisticsDialog.cc:79
 #: UI/GTK2/src/WorkerThreads.cpp:1009
 msgid "My Web Pages"
 msgstr "????"
@@ -42,8 +42,8 @@
 #. Spawn new threads
 #: UI/GTK2/src/EnginesTree.cpp:338 UI/GTK2/src/mainWindow.cc:763
 #: UI/GTK2/src/mainWindow.cc:978 UI/GTK2/src/mainWindow.cc:1287
-#: UI/GTK2/src/mainWindow.cc:2277 UI/GTK2/src/PinotSettings.cpp:323
-#: UI/GTK2/src/PinotSettings.cpp:1471 UI/GTK2/src/PinotSettings.cpp:1527
+#: UI/GTK2/src/mainWindow.cc:2277 UI/GTK2/src/PinotSettings.cpp:324
+#: UI/GTK2/src/PinotSettings.cpp:1475 UI/GTK2/src/PinotSettings.cpp:1531
 #: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/WorkerThreads.cpp:1019
 msgid "My Documents"
 msgstr "????"
@@ -569,23 +569,23 @@
 msgstr "?????????"
 
 #. Add default labels
-#: UI/GTK2/src/PinotSettings.cpp:328
+#: UI/GTK2/src/PinotSettings.cpp:329
 msgid "Important"
 msgstr "???"
 
-#: UI/GTK2/src/PinotSettings.cpp:329
+#: UI/GTK2/src/PinotSettings.cpp:330
 msgid "New"
 msgstr "??"
 
-#: UI/GTK2/src/PinotSettings.cpp:330
+#: UI/GTK2/src/PinotSettings.cpp:331
 msgid "Personal"
 msgstr "????"
 
-#: UI/GTK2/src/PinotSettings.cpp:350
+#: UI/GTK2/src/PinotSettings.cpp:351
 msgid "Me"
 msgstr ""
 
-#: UI/GTK2/src/PinotSettings.cpp:1266
+#: UI/GTK2/src/PinotSettings.cpp:1270
 msgid "Unclassified"
 msgstr "????"
 



From fabricecolin at mail.berlios.de  Sun May 11 04:17:11 2008
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sun, 11 May 2008 04:17:11 +0200
Subject: [Pinot-svn] r1251 - trunk
Message-ID: <200805110217.m4B2HBRa004787@sheep.berlios.de>

Author: fabricecolin
Date: 2008-05-11 04:17:10 +0200 (Sun, 11 May 2008)
New Revision: 1251

Modified:
   trunk/NEWS
Log:
List latest changes.


Modified: trunk/NEWS
===================================================================
--- trunk/NEWS	2008-05-11 02:16:14 UTC (rev 1250)
+++ trunk/NEWS	2008-05-11 02:17:10 UTC (rev 1251)
@@ -1,22 +1,27 @@
-2008/05/05 version_0_8_5
+2008/05/11 version_0_8_5
 Build :
  - removed reference to m4 directory
+General :
+ - synced with gtk+'s xdgmime
 Tokenize :
  - new libexif-based filter to extract image metadata
- - the mbox filter attempts to convert non UTF-8 text
+ - better conversion of mbox messages and HTML documents to UTF8
  - tweaks to the CJKV tokenizer
 SQL :
- - somewhat more abstract interface to databases
+ - more abstract database interface
 Search :
  - fixed CJKV queries on Web engines
+ - fixed repetition of CJKV characters in abstracts
 Xapian :
  - mixed CJKV queries should be processed correctly. See README.
+ - fixed repetition of CJKV characters in abstracts
  - if the document specifies a language, double check it's valid
 Daemon :
  - check whether there's already a daemon process running and exit if there is
  - fixed concurrency issues
  - fixed crawling and monitoring of new directories
 UI :
+ - if the global configuration file can't be open, don't reset the configuration
  - new Japanese translation by Takeo Mizuki
 
 2008/03/27 version_0_8_4



From fabricecolin at mail.berlios.de  Sun May 11 11:27:39 2008
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sun, 11 May 2008 11:27:39 +0200
Subject: [Pinot-svn] r1252 - trunk
Message-ID: <200805110927.m4B9RdZ9019085@sheep.berlios.de>

Author: fabricecolin
Date: 2008-05-11 11:27:37 +0200 (Sun, 11 May 2008)
New Revision: 1252

Modified:
   trunk/ChangeLog
   trunk/ChangeLog-dijon
Log:
Current ChangeLogs.


Modified: trunk/ChangeLog
===================================================================
--- trunk/ChangeLog	2008-05-11 02:17:10 UTC (rev 1251)
+++ trunk/ChangeLog	2008-05-11 09:27:37 UTC (rev 1252)
@@ -1,4 +1,281 @@
 ------------------------------------------------------------------------
+r1251 | fabricecolin | 2008-05-11 10:17:10 +0800 (Sun, 11 May 2008) | 2 lines
+Changed paths:
+   M /trunk/NEWS
+
+List latest changes.
+
+------------------------------------------------------------------------
+r1250 | fabricecolin | 2008-05-11 10:16:14 +0800 (Sun, 11 May 2008) | 2 lines
+Changed paths:
+   M /trunk/po/de.po
+   M /trunk/po/es.po
+   M /trunk/po/fr.po
+   M /trunk/po/it.po
+   M /trunk/po/ja.po
+   M /trunk/po/nl.po
+   M /trunk/po/pt.po
+   M /trunk/po/pt_BR.po
+   M /trunk/po/ru.po
+   M /trunk/po/sv.po
+   M /trunk/po/zh_CN.po
+   M /trunk/po/zh_TW.po
+
+Synced with latest changes.
+
+------------------------------------------------------------------------
+r1249 | fabricecolin | 2008-05-09 21:35:29 +0800 (Fri, 09 May 2008) | 2 lines
+Changed paths:
+   M /trunk/Utils/xdgmime/ChangeLog
+   M /trunk/Utils/xdgmime/xdgmime.c
+   M /trunk/Utils/xdgmime/xdgmime.h
+   M /trunk/Utils/xdgmime/xdgmimealias.h
+   M /trunk/Utils/xdgmime/xdgmimecache.c
+   M /trunk/Utils/xdgmime/xdgmimecache.h
+   M /trunk/Utils/xdgmime/xdgmimemagic.c
+   M /trunk/Utils/xdgmime/xdgmimemagic.h
+   M /trunk/Utils/xdgmime/xdgmimeparent.h
+
+Synced with current gtk+'s xdgmime.
+
+------------------------------------------------------------------------
+r1248 | fabricecolin | 2008-05-09 21:33:05 +0800 (Fri, 09 May 2008) | 2 lines
+Changed paths:
+   M /trunk/IndexSearch/Xapian/AbstractGenerator.cpp
+
+Fix for previous checkin.
+
+------------------------------------------------------------------------
+r1247 | fabricecolin | 2008-05-09 21:32:20 +0800 (Fri, 09 May 2008) | 2 lines
+Changed paths:
+   M /trunk/IndexSearch/FilterWrapper.cpp
+
+Only set a default title if the document is not to passed to another filter.
+
+------------------------------------------------------------------------
+r1246 | fabricecolin | 2008-05-09 00:36:04 +0800 (Fri, 09 May 2008) | 5 lines
+Changed paths:
+   M /trunk/IndexSearch/WebEngine.cpp
+   M /trunk/IndexSearch/Xapian/AbstractGenerator.cpp
+   M /trunk/IndexSearch/Xapian/XapianEngine.cpp
+
+A fix for QueryModifier when the query is one CJKV character only.
+AbstractGenerator needs to skip long n-grams early on when populating the
+chosen window.
+Cosmetic changes here and there.
+
+------------------------------------------------------------------------
+r1245 | fabricecolin | 2008-05-08 20:20:55 +0800 (Thu, 08 May 2008) | 6 lines
+Changed paths:
+   M /trunk/IndexSearch/QueryProperties.cpp
+   M /trunk/IndexSearch/WebEngine.cpp
+   M /trunk/IndexSearch/Xapian/AbstractGenerator.cpp
+
+AbstractGenerator and WebEngine's TermHighlighter skip multi-character CJKV
+terms to avoid repetition in extracts.
+QueryProperties' FilterRemover does what the name implies and simply removes
+filters and ranges from a query instead of trying to rebuild it one token at a
+time.
+
+------------------------------------------------------------------------
+r1244 | fabricecolin | 2008-05-06 22:57:51 +0800 (Tue, 06 May 2008) | 2 lines
+Changed paths:
+   M /trunk/UI/GTK2/src/PinotSettings.cpp
+
+If the global configuration file couldn't be open, don't assume a first run.
+
+------------------------------------------------------------------------
+r1243 | fabricecolin | 2008-05-06 22:56:48 +0800 (Tue, 06 May 2008) | 3 lines
+Changed paths:
+   M /trunk/IndexSearch/FilterWrapper.cpp
+   M /trunk/Tokenize/FilterUtils.cpp
+   M /trunk/Tokenize/TextConverter.cpp
+   M /trunk/Tokenize/TextConverter.h
+
+Overloaded TextConverter::toUTF8(). FilterWrapper uses the new method
+Filter::set_utf8_converter(). Some minor changes.
+
+------------------------------------------------------------------------
+r1242 | fabricecolin | 2008-05-05 20:36:21 +0800 (Mon, 05 May 2008) | 2 lines
+Changed paths:
+   M /trunk/IndexSearch/pinot-index.1
+   M /trunk/IndexSearch/pinot-label.1
+   M /trunk/IndexSearch/pinot-search.1
+   M /trunk/NEWS
+   M /trunk/UI/GTK2/src/pinot-dbus-daemon.1
+   M /trunk/UI/GTK2/src/pinot.1
+   M /trunk/configure.in
+   M /trunk/po/de.po
+   M /trunk/po/es.po
+   M /trunk/po/fr.po
+   M /trunk/po/it.po
+   M /trunk/po/ja.po
+   M /trunk/po/nl.po
+   M /trunk/po/pt.po
+   M /trunk/po/pt_BR.po
+   M /trunk/po/ru.po
+   M /trunk/po/sv.po
+   M /trunk/po/zh_CN.po
+   M /trunk/po/zh_TW.po
+
+Bumped version number to 0.85.
+
+------------------------------------------------------------------------
+r1241 | fabricecolin | 2008-05-05 20:07:50 +0800 (Mon, 05 May 2008) | 3 lines
+Changed paths:
+   M /trunk/UI/GTK2/src/PinotSettings.cpp
+   M /trunk/UI/GTK2/src/pinot-dbus-daemon.xml
+
+Removed JPEG from default blacklist.
+Cosmetic modifications to pinot-dbus-daemon.xml.
+
+------------------------------------------------------------------------
+r1240 | fabricecolin | 2008-05-04 22:09:28 +0800 (Sun, 04 May 2008) | 4 lines
+Changed paths:
+   M /trunk/UI/GTK2/src/WorkerThreads.cpp
+   M /trunk/UI/GTK2/src/WorkerThreads.h
+
+In MonitorThread::stop(), write to the control pipe after the stop flag is set
+by the call to the parent's method.
+Removed unused method.
+
+------------------------------------------------------------------------
+r1239 | fabricecolin | 2008-05-03 14:25:58 +0800 (Sat, 03 May 2008) | 3 lines
+Changed paths:
+   M /trunk/README
+
+Mention the limitation of mixed queries doesn't apply to 0.85 and newer and give
+an example.
+
+------------------------------------------------------------------------
+r1238 | fabricecolin | 2008-05-03 14:17:10 +0800 (Sat, 03 May 2008) | 3 lines
+Changed paths:
+   M /trunk/AUTHORS
+   M /trunk/README
+   M /trunk/pinot.spec.in
+
+New dependency on libexif.
+Added Mizuki-san to the AUTHORS file.
+
+------------------------------------------------------------------------
+r1237 | fabricecolin | 2008-05-03 14:13:44 +0800 (Sat, 03 May 2008) | 4 lines
+Changed paths:
+   M /trunk/IndexSearch/QueryProperties.cpp
+   M /trunk/IndexSearch/WebEngine.cpp
+   M /trunk/IndexSearch/Xapian/XapianEngine.cpp
+
+Rely on the CJKV TokensHandler interface to remove filters from queries and get
+sets of terms (QueryProperties), highlight terms (WebEngine) and tweak mixed
+CJKV queries (XapianEngine).
+
+------------------------------------------------------------------------
+r1236 | fabricecolin | 2008-05-03 14:10:08 +0800 (Sat, 03 May 2008) | 2 lines
+Changed paths:
+   M /trunk/Makefile.am
+
+David Paleino suggests removing the dependency on the m4 directory.
+
+------------------------------------------------------------------------
+r1235 | fabricecolin | 2008-05-03 14:06:48 +0800 (Sat, 03 May 2008) | 4 lines
+Changed paths:
+   M /trunk/IndexSearch/Makefile.am
+   M /trunk/IndexSearch/Xapian/Makefile.am
+   M /trunk/Tokenize/Makefile.am
+   M /trunk/configure.in
+   A /trunk/po/ja.po
+
+CJKVTokenizer is useful to code outside of the Xapian back-end and should be
+in libTokenize. The new Exif filter is also compiled.
+Adding Mizuki-san's Japanese translation.
+
+------------------------------------------------------------------------
+r1234 | fabricecolin | 2008-04-29 20:57:49 +0800 (Tue, 29 Apr 2008) | 7 lines
+Changed paths:
+   M /trunk/UI/GTK2/src/DaemonState.cpp
+   M /trunk/UI/GTK2/src/WorkerThreads.cpp
+   M /trunk/UI/GTK2/src/WorkerThreads.h
+
+We don't need to keep the Glib::Thread pointer around since all threads detach.
+Therefore entries can be inserted in the threads list before the new thread
+is started, and we get rid of a possible race condition between list insertion
+and thread exit.
+In ThreadsManager::get_thread(), the list should be locked in write mode since
+entries are removed.
+
+------------------------------------------------------------------------
+r1233 | fabricecolin | 2008-04-23 22:42:02 +0800 (Wed, 23 Apr 2008) | 3 lines
+Changed paths:
+   M /trunk/IndexSearch/Xapian/XapianIndex.cpp
+   M /trunk/IndexSearch/Xapian/XapianIndex.h
+
+If a language is already specified, don't use it blindly but see if it has a
+stemmer. If it doesn't, then scan the document.
+
+------------------------------------------------------------------------
+r1232 | fabricecolin | 2008-04-23 22:40:21 +0800 (Wed, 23 Apr 2008) | 5 lines
+Changed paths:
+   M /trunk/UI/GTK2/src/DaemonState.cpp
+   M /trunk/UI/GTK2/src/OnDiskHandler.cpp
+
+In DaemonState, if new directories are queued for crawling, if there's no
+DirectoryScanner thread running, they won't be picked up. Call start_crawling()
+after an addition to the queue, this will start a new crawler if necessary.
+OnDiskHandler wasn't able to get the source label of files.
+
+------------------------------------------------------------------------
+r1231 | fabricecolin | 2008-04-23 22:04:22 +0800 (Wed, 23 Apr 2008) | 3 lines
+Changed paths:
+   M /trunk/UI/GTK2/src/pinot-dbus-daemon.cc
+
+If the PID file is still there, open /proc/daemon_pid/cmdline and see whether
+the given process is pinot-dbus-daemon.
+
+------------------------------------------------------------------------
+r1230 | fabricecolin | 2008-04-12 16:36:39 +0800 (Sat, 12 Apr 2008) | 3 lines
+Changed paths:
+   M /trunk/SQL/ActionQueue.cpp
+   M /trunk/SQL/CrawlHistory.cpp
+   M /trunk/SQL/Makefile.am
+   M /trunk/SQL/QueryHistory.cpp
+   A /trunk/SQL/SQLDB.cpp
+   A /trunk/SQL/SQLDB.h
+   M /trunk/SQL/SQLiteBase.cpp
+   M /trunk/SQL/SQLiteBase.h
+   M /trunk/SQL/ViewHistory.cpp
+
+Moved generic code to SQLDB. This should allow implementing support for
+other databases, if there's ever a need to.
+
+------------------------------------------------------------------------
+r1229 | fabricecolin | 2008-04-11 23:40:10 +0800 (Fri, 11 Apr 2008) | 2 lines
+Changed paths:
+   M /trunk/SQL/CrawlHistory.cpp
+   M /trunk/SQL/CrawlHistory.h
+   M /trunk/SQL/QueryHistory.cpp
+   M /trunk/SQL/QueryHistory.h
+   M /trunk/SQL/SQLiteBase.cpp
+   M /trunk/SQL/SQLiteBase.h
+   M /trunk/SQL/ViewHistory.cpp
+   M /trunk/SQL/ViewHistory.h
+
+Mostly namespace related cleanups.
+
+------------------------------------------------------------------------
+r1228 | fabricecolin | 2008-04-03 21:07:15 +0800 (Thu, 03 Apr 2008) | 2 lines
+Changed paths:
+   M /trunk/UI/GTK2/src/pinot-dbus-daemon.cc
+
+Open the PID file, exit if that process is still running.
+
+------------------------------------------------------------------------
+r1226 | fabricecolin | 2008-03-27 16:32:05 +0800 (Thu, 27 Mar 2008) | 2 lines
+Changed paths:
+   M /trunk/ChangeLog
+   M /trunk/ChangeLog-dijon
+
+Current ChangeLogs.
+
+------------------------------------------------------------------------
 r1225 | fabricecolin | 2008-03-27 16:28:56 +0800 (Thu, 27 Mar 2008) | 2 lines
 Changed paths:
    M /trunk/NEWS

Modified: trunk/ChangeLog-dijon
===================================================================
--- trunk/ChangeLog-dijon	2008-05-11 02:17:10 UTC (rev 1251)
+++ trunk/ChangeLog-dijon	2008-05-11 09:27:37 UTC (rev 1252)
@@ -1,4 +1,73 @@
 ------------------------------------------------------------------------
+r99 | fabricecolin | 2008-05-11 17:16:45 +0800 (Sun, 11 May 2008) | 3 lines
+Changed paths:
+   M /trunk/filters/GMimeMboxFilter.cc
+   M /trunk/filters/GMimeMboxFilter.h
+
+Don't use charset filters but remember what the part's charset is and let the
+calling application handle conversion.
+
+------------------------------------------------------------------------
+r98 | fabricecolin | 2008-05-06 22:53:36 +0800 (Tue, 06 May 2008) | 5 lines
+Changed paths:
+   M /trunk/filters/Filter.cc
+   M /trunk/filters/Filter.h
+   M /trunk/filters/HtmlFilter.cc
+   M /trunk/filters/HtmlFilter.h
+
+Filters may need to convert text to UTF-8 before/while processing documents.
+For instance, libxml2 used by the HTML filter doesn't handle gb2312 (at least
+when built without iconv support ?) and yet produces UTF-8 output.
+Fixed confusion about what charset should be set to in the metadata map.
+
+------------------------------------------------------------------------
+r97 | fabricecolin | 2008-05-03 14:00:01 +0800 (Sat, 03 May 2008) | 2 lines
+Changed paths:
+   M /trunk/cjkv/CJKVTokenizer.cc
+
+When a switch from non-CJKV to CJKV is detected, don't consume the first byte.
+
+------------------------------------------------------------------------
+r96 | fabricecolin | 2008-04-29 20:27:41 +0800 (Tue, 29 Apr 2008) | 2 lines
+Changed paths:
+   M /trunk/filters/ExifImageFilter.cc
+
+Grab all tags.
+
+------------------------------------------------------------------------
+r95 | fabricecolin | 2008-04-26 14:51:35 +0800 (Sat, 26 Apr 2008) | 2 lines
+Changed paths:
+   M /trunk/cjkv/CJKVTokenizer.cc
+   M /trunk/cjkv/CJKVTokenizer.h
+
+Allow to break ASCII tokens only on space.
+
+------------------------------------------------------------------------
+r94 | fabricecolin | 2008-04-26 13:05:55 +0800 (Sat, 26 Apr 2008) | 2 lines
+Changed paths:
+   A /trunk/filters/ExifImageFilter.cc
+   A /trunk/filters/ExifImageFilter.h
+
+Experimental EXIF filter.
+
+------------------------------------------------------------------------
+r93 | fabricecolin | 2008-04-20 18:24:11 +0800 (Sun, 20 Apr 2008) | 3 lines
+Changed paths:
+   M /trunk/filters/GMimeMboxFilter.cc
+
+If a part has a charset specified, and it's not UTF-8, install a filter to
+convert to UTF-8.
+
+------------------------------------------------------------------------
+r92 | fabricecolin | 2008-04-11 23:47:33 +0800 (Fri, 11 Apr 2008) | 3 lines
+Changed paths:
+   M /trunk/filters/TagLibMusicFilter.cc
+   M /trunk/filters/TagLibMusicFilter.h
+
+TagLibMusicFilter only supports the input type DOCUMENT_FILE_NAME, contrary to
+what it advertised.
+
+------------------------------------------------------------------------
 r90 | fabricecolin | 2008-03-24 13:11:29 +0800 (Mon, 24 Mar 2008) | 2 lines
 Changed paths:
    M /trunk/filters/ExternalFilter.cc



From fabricecolin at mail.berlios.de  Sun May 11 13:01:47 2008
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sun, 11 May 2008 13:01:47 +0200
Subject: [Pinot-svn] r1253 - tags
Message-ID: <200805111101.m4BB1ln4002974@sheep.berlios.de>

Author: fabricecolin
Date: 2008-05-11 13:01:38 +0200 (Sun, 11 May 2008)
New Revision: 1253

Added:
   tags/version_0_8_5/
Log:
Releasing v0.85.


Copied: tags/version_0_8_5 (from rev 1252, trunk)



From fabricecolin at mail.berlios.de  Fri May 16 15:54:19 2008
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Fri, 16 May 2008 15:54:19 +0200
Subject: [Pinot-svn] r1254 - trunk/UI/GTK2/src
Message-ID: <200805161354.m4GDsJZo025259@sheep.berlios.de>

Author: fabricecolin
Date: 2008-05-16 15:54:18 +0200 (Fri, 16 May 2008)
New Revision: 1254

Modified:
   trunk/UI/GTK2/src/Notebook.cpp
   trunk/UI/GTK2/src/Notebook.h
Log:
Prettier, but still too big, buttons in notebook tabs when _USE_BUTTON_TAB is
defined.


Modified: trunk/UI/GTK2/src/Notebook.cpp
===================================================================
--- trunk/UI/GTK2/src/Notebook.cpp	2008-05-11 11:01:38 UTC (rev 1253)
+++ trunk/UI/GTK2/src/Notebook.cpp	2008-05-16 13:54:18 UTC (rev 1254)
@@ -93,22 +93,14 @@
 	m_tabLabel(NULL),
 	m_tabImage(NULL),
 #if _USE_BUTTON_TAB
-	m_tabImageBox(NULL),
 	m_tabButton(NULL)
 #else
 	m_tabEventBox(NULL)
 #endif
 {
-#if _USE_BUTTON_TAB
-	int width, height;
-
-	// Lookup the standard icon size
-	bool gotDimensions = IconSize::lookup(ICON_SIZE_MENU, width, height);
-#endif
 	m_tabLabel = manage(new Label(title));
 	m_tabImage = manage(new Image(StockID("gtk-close"), IconSize(ICON_SIZE_MENU)));
 #if _USE_BUTTON_TAB
-	m_tabImageBox = manage(new HBox());
 	m_tabButton = manage(new Button());
 #else
 	m_tabEventBox = manage(new EventBox);
@@ -126,13 +118,7 @@
 	m_tabButton->set_relief(RELIEF_NONE);
 	m_tabButton->set_border_width(0);
 	m_tabButton->set_alignment(0, 0);
-	// Resize the button
-	if (gotDimensions == true)
-	{
-		m_tabButton->set_size_request(width + 4, height + 4);
-	}
-	m_tabImageBox->pack_start(*m_tabImage, false, true);
-	m_tabButton->add(*m_tabImageBox);
+	m_tabButton->add(*m_tabImage);
 #else
 	m_tabEventBox->add(*m_tabImage);
 	m_tabEventBox->set_events(Gdk::BUTTON_PRESS_MASK);
@@ -148,7 +134,6 @@
 	m_tabLabel->show();
 	m_tabImage->show();
 #if _USE_BUTTON_TAB
-	m_tabImageBox->show();
 	m_tabButton->show();
 #else
 	m_tabEventBox->show();

Modified: trunk/UI/GTK2/src/Notebook.h
===================================================================
--- trunk/UI/GTK2/src/Notebook.h	2008-05-11 11:01:38 UTC (rev 1253)
+++ trunk/UI/GTK2/src/Notebook.h	2008-05-16 13:54:18 UTC (rev 1254)
@@ -88,7 +88,6 @@
 		Gtk::Label *m_tabLabel;
 		Gtk::Image *m_tabImage;
 #if _USE_BUTTON_TAB
-		Gtk::HBox *m_tabImageBox;
 		Gtk::Button *m_tabButton;
 #else
 		Gtk::EventBox *m_tabEventBox;



From fabricecolin at mail.berlios.de  Fri May 16 17:08:07 2008
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Fri, 16 May 2008 17:08:07 +0200
Subject: [Pinot-svn] r1255 - trunk/IndexSearch
Message-ID: <200805161508.m4GF87e9030772@sheep.berlios.de>

Author: fabricecolin
Date: 2008-05-16 17:08:07 +0200 (Fri, 16 May 2008)
New Revision: 1255

Modified:
   trunk/IndexSearch/DBusIndex.cpp
Log:
Don't serialize to DBus empty fields. Added extract to the mix.
Both getLabels() and getDocumentLabels() now always query the daemon and not
the index.


Modified: trunk/IndexSearch/DBusIndex.cpp
===================================================================
--- trunk/IndexSearch/DBusIndex.cpp	2008-05-16 13:54:18 UTC (rev 1254)
+++ trunk/IndexSearch/DBusIndex.cpp	2008-05-16 15:08:07 UTC (rev 1255)
@@ -30,7 +30,7 @@
 using std::map;
 using std::min;
 
-static const char *g_fieldNames[] = { "caption", "url", "type", "language", "modtime", "size", NULL };
+static const char *g_fieldNames[] = { "caption", "url", "type", "language", "modtime", "size", "extract", NULL };
 
 static DBusGConnection *getBusConnection(void)
 {
@@ -188,6 +188,10 @@
 		{
 			docInfo.setSize((off_t )atoi(pValue));
 		}
+		else if (fieldName == g_fieldNames[6])
+		{
+			docInfo.setExtract(pValue);
+		}
 	}
 	while (dbus_message_iter_next(&array_iter));
 
@@ -225,42 +229,53 @@
 
 	for (unsigned int fieldNum = 0; g_fieldNames[fieldNum] != NULL; ++fieldNum)
 	{
-		const char *pValue = NULL;
+		string value;
 		char sizeStr[64];
 
-		if (!dbus_message_iter_open_container(&array_iter,
-			DBUS_TYPE_STRUCT, NULL, &struct_iter))
-		{
-#ifdef DEBUG
-			cout << "DBusIndex::documentInfoToDBus: couldn't open struct container" << endl;
-#endif
-			return false;
-		}
-
-		dbus_message_iter_append_basic(&struct_iter, DBUS_TYPE_STRING, &g_fieldNames[fieldNum]);
 		switch (fieldNum)
 		{
 			case 0:
-				pValue = docInfo.getTitle().c_str();
+				value = docInfo.getTitle();
 				break;
 			case 1:
-				pValue = docInfo.getLocation().c_str();
+				value = docInfo.getLocation();
 				break;
 			case 2:
-				pValue = docInfo.getType().c_str();
+				value = docInfo.getType();
 				break;
 			case 3:
-				pValue = Languages::toEnglish(docInfo.getLanguage()).c_str();
+				value = Languages::toEnglish(docInfo.getLanguage());
 				break;
 			case 4:
-				pValue = docInfo.getTimestamp().c_str();
+				value = docInfo.getTimestamp();
 				break;
 			case 5:
-			default:
 				snprintf(sizeStr, 64, "%u", docInfo.getSize());
-				pValue = sizeStr;
+				value = sizeStr;
 				break;
+			case 6:
+				value = docInfo.getExtract();
+				break;
+			default:
+				break;
 		}
+
+		if (value.empty() == true)
+		{
+			continue;
+		}
+
+		if (!dbus_message_iter_open_container(&array_iter,
+			DBUS_TYPE_STRUCT, NULL, &struct_iter))
+		{
+#ifdef DEBUG
+			cout << "DBusIndex::documentInfoToDBus: couldn't open struct container" << endl;
+#endif
+			return false;
+		}
+
+		const char *pValue = value.c_str();
+		dbus_message_iter_append_basic(&struct_iter, DBUS_TYPE_STRING, &g_fieldNames[fieldNum]);
 		dbus_message_iter_append_basic(&struct_iter, DBUS_TYPE_STRING, &pValue);
 #ifdef DEBUG
 		cout << "DBusIndex::documentInfoToDBus: field " << g_fieldNames[fieldNum] << "=" << pValue << endl;
@@ -425,13 +440,6 @@
 {
 	bool gotLabels = false;
 
-	if (m_pROIndex != NULL)
-	{
-		reopen();
-
-		return m_pROIndex->getLabels(labels);
-	}
-
 	DBusGConnection *pBus = getBusConnection();
 	if (pBus == NULL)
 	{
@@ -631,13 +639,6 @@
 {
 	bool gotLabels = false;
 
-	if (m_pROIndex != NULL)
-	{
-		reopen();
-
-		return m_pROIndex->getDocumentLabels(docId, labels);
-	}
-
 	DBusGConnection *pBus = getBusConnection();
 	if (pBus == NULL)
 	{



From fabricecolin at mail.berlios.de  Fri May 16 17:22:47 2008
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Fri, 16 May 2008 17:22:47 +0200
Subject: [Pinot-svn] r1256 - trunk/UI/GTK2/src
Message-ID: <200805161522.m4GFMlIQ032034@sheep.berlios.de>

Author: fabricecolin
Date: 2008-05-16 17:22:46 +0200 (Fri, 16 May 2008)
New Revision: 1256

Modified:
   trunk/UI/GTK2/src/WorkerThreads.cpp
   trunk/UI/GTK2/src/WorkerThreads.h
   trunk/UI/GTK2/src/mainWindow.cc
Log:
Refresh index lists with browse_index() when LabelUpdateThread returns, if
necessary. When the query combox is updated, the change of selection will lead
to a call to browse_index().


Modified: trunk/UI/GTK2/src/WorkerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.cpp	2008-05-16 15:08:07 UTC (rev 1255)
+++ trunk/UI/GTK2/src/WorkerThreads.cpp	2008-05-16 15:22:46 UTC (rev 1256)
@@ -1274,6 +1274,16 @@
 	return "LabelUpdateThread";
 }
 
+bool LabelUpdateThread::modifiedDocsIndex(void) const
+{
+	return !m_docsIds.empty();
+}
+
+bool LabelUpdateThread::modifiedDaemonIndex(void) const
+{
+	return !m_daemonIds.empty();
+}
+
 void LabelUpdateThread::doWork(void)
 {
 	bool actOnDocuments = false;

Modified: trunk/UI/GTK2/src/WorkerThreads.h
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.h	2008-05-16 15:08:07 UTC (rev 1255)
+++ trunk/UI/GTK2/src/WorkerThreads.h	2008-05-16 15:22:46 UTC (rev 1256)
@@ -334,6 +334,10 @@
 
 		virtual std::string getType(void) const;
 
+		bool modifiedDocsIndex(void) const;
+
+		bool modifiedDaemonIndex(void) const;
+
 	protected:
 		std::set<std::string> m_labelsToAdd;
 		std::set<std::string> m_labelsToDelete;

Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2008-05-16 15:08:07 UTC (rev 1255)
+++ trunk/UI/GTK2/src/mainWindow.cc	2008-05-16 15:22:46 UTC (rev 1256)
@@ -832,7 +832,7 @@
 		// Connect to the edit document signal
 		pResultsTree->getDoubleClickSignal().connect(
 			sigc::mem_fun(*this, &mainWindow::on_showfromindex_activate));
-		// Connect to the label changed signal
+		// Connect to the query changed signal
 		pIndexPage->getQueryChangedSignal().connect(
 			sigc::mem_fun(*this, &mainWindow::on_query_changed));
 		// ...and to the buttons clicked signals
@@ -1006,9 +1006,6 @@
 		return;
 	}
 
-#ifdef DEBUG
-	cout << "mainWindow::on_query_changed: called on " << queryName << endl;
-#endif
 	browse_index(indexName, queryName, 0);
 }
 
@@ -1427,6 +1424,30 @@
 			return;
 		}
 
+		// Refresh index lists if necessary, as they may be filtered by labels
+		if (pLabelUpdateThread->modifiedDocsIndex() == true)
+		{
+			IndexPage *pIndexPage = dynamic_cast<IndexPage*>(get_page(_("My Web Pages"), NotebookPageBox::INDEX_PAGE));
+			if (pIndexPage != NULL)
+			{
+				browse_index(_("My Web Pages"), pIndexPage->getQueryName(), 0, false);
+#ifdef DEBUG
+				cout << "mainWindow::on_thread_end: refreshed My Web Pages" << endl;
+#endif
+			}
+		}
+		if (pLabelUpdateThread->modifiedDaemonIndex() == true)
+		{
+			IndexPage *pIndexPage = dynamic_cast<IndexPage*>(get_page(_("My Documents"), NotebookPageBox::INDEX_PAGE));
+			if (pIndexPage != NULL)
+			{
+				browse_index(_("My Documents"), pIndexPage->getQueryName(), 0, false);
+#ifdef DEBUG
+				cout << "mainWindow::on_thread_end: refreshed My Documents" << endl;
+#endif
+			}
+		}
+
 		status = _("Updated label(s)");
 		set_status(status);
 	}
@@ -2317,7 +2338,7 @@
 		return;
 	}
 
-	// Update all documents
+	// Update documents properties
 	for (vector<DocumentInfo>::iterator docIter = documentsList.begin();
 		docIter != documentsList.end(); ++docIter)
 	{
@@ -2333,7 +2354,7 @@
 		docIds.insert(docId);
 	}
 
-	// Now apply these labels to all the documents
+	// Apply labels
 	if (propertiesBox.changedLabels() == true)
 	{
 		LabelUpdateThread *pThread = NULL;
@@ -2353,13 +2374,6 @@
 		{
 			start_thread(pThread);
 		}
-
-		// Is the index list filtered with a query ?
-		if (queryName.empty() == false)
-		{
-			// The query may filter on a label, so refresh the list
-			browse_index(indexName, queryName, 0, 0);
-		}
 	}
 }
 
@@ -2718,13 +2732,8 @@
 					if (pIndexPage != NULL)
 					{
 						// Synchronize the queries list with the new list 
+						// This will trigger a list refresh
 						pIndexPage->populateQueryCombobox("");
-
-						// The current query was removed, refresh the list
-						if (queryName == pIndexPage->getQueryName())
-						{
-							browse_index(pIndexPage->getTitle(), "", 0, false);
-						}
 					}
 				}
 			}
@@ -3123,13 +3132,8 @@
 				if (pIndexPage != NULL)
 				{
 					// Synchronize the queries list with the new list
+					// This will trigger a list refresh
 					pIndexPage->populateQueryCombobox(pIndexPage->getQueryName());
-
-					// The current query may have changed, refresh the list
-					if (queryName == pIndexPage->getQueryName())
-					{
-						browse_index(pIndexPage->getTitle(), queryName, 0, false);
-					}
 				}
 			}
 		}
@@ -3273,6 +3277,9 @@
 void mainWindow::browse_index(const ustring &indexName, const ustring &queryName,
 	unsigned int startDoc, bool changePage)
 {
+#ifdef DEBUG
+	cout << "mainWindow::browse_index: called on " << indexName << ", " << queryName << endl;
+#endif
 	// Rudimentary lock
 	if (m_state.m_browsingIndex == true)
 	{



From fabricecolin at mail.berlios.de  Mon May 19 05:30:33 2008
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Mon, 19 May 2008 05:30:33 +0200
Subject: [Pinot-svn] r1257 - trunk/SQL
Message-ID: <200805190330.m4J3UXdl020361@sheep.berlios.de>

Author: fabricecolin
Date: 2008-05-19 05:30:29 +0200 (Mon, 19 May 2008)
New Revision: 1257

Modified:
   trunk/SQL/SQLDB.h
   trunk/SQL/SQLiteBase.cpp
   trunk/SQL/SQLiteBase.h
Log:
Utility method alterTable() to work-around SQLite's limited implementation of
ALTER TABLE.


Modified: trunk/SQL/SQLDB.h
===================================================================
--- trunk/SQL/SQLDB.h	2008-05-16 15:22:46 UTC (rev 1256)
+++ trunk/SQL/SQLDB.h	2008-05-19 03:30:29 UTC (rev 1257)
@@ -73,6 +73,10 @@
 
 		virtual bool isOpen(void) const = 0;
 
+		virtual bool alterTable(const std::string &tableName,
+			const std::string &columns,
+			const std::string &newDefinition) = 0;
+
 		virtual bool executeSimpleStatement(const std::string &sql) = 0;
 
 		virtual SQLResults *executeStatement(const char *sqlFormat, ...) = 0;

Modified: trunk/SQL/SQLiteBase.cpp
===================================================================
--- trunk/SQL/SQLiteBase.cpp	2008-05-16 15:22:46 UTC (rev 1256)
+++ trunk/SQL/SQLiteBase.cpp	2008-05-19 03:30:29 UTC (rev 1257)
@@ -213,6 +213,48 @@
 	return true;
 }
 
+bool SQLiteBase::alterTable(const string &tableName,
+	const string &columns, const string &newDefinition)
+{
+	if ((tableName.empty() == true) ||
+		(columns.empty() == true) ||
+		(newDefinition.empty() == true))
+	{
+		return false;
+	}
+
+	string sql("BEGIN TRANSACTION; CREATE TEMPORARY TABLE ");
+	sql += tableName;
+	sql += "_backup (";
+	sql += columns;
+	sql += "); INSERT INTO ";
+	sql += tableName;
+	sql += "_backup SELECT ";
+	sql += columns;
+	sql += " FROM ";
+	sql += tableName;
+	sql += "; DROP TABLE ";
+	sql += tableName;
+	sql += "; CREATE TABLE ";
+	sql += tableName;
+	sql += " (";
+	sql += newDefinition;
+	sql += "); INSERT INTO ";
+	sql += tableName;
+	sql += " SELECT ";
+	sql += columns;
+	sql += " FROM ";
+	sql += tableName;
+	sql += "_backup; DROP TABLE ";
+	sql += tableName;
+	sql += "_backup; COMMIT;";
+#ifdef DEBUG
+	cout << "SQLiteBase::alterTable: " << sql << endl;
+#endif
+
+	return executeSimpleStatement(sql);
+}
+
 bool SQLiteBase::executeSimpleStatement(const string &sql)
 {
 	char *errMsg = NULL;

Modified: trunk/SQL/SQLiteBase.h
===================================================================
--- trunk/SQL/SQLiteBase.h	2008-05-16 15:22:46 UTC (rev 1256)
+++ trunk/SQL/SQLiteBase.h	2008-05-19 03:30:29 UTC (rev 1257)
@@ -71,6 +71,10 @@
 
 		virtual bool isOpen(void) const;
 
+		virtual bool alterTable(const std::string &tableName,
+			const std::string &columns,
+			const std::string &newDefinition);
+
 		virtual bool executeSimpleStatement(const std::string &sql);
 
 		virtual SQLResults *executeStatement(const char *sqlFormat, ...);



From fabricecolin at mail.berlios.de  Mon May 19 05:33:02 2008
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Mon, 19 May 2008 05:33:02 +0200
Subject: [Pinot-svn] r1258 - trunk/scripts/python
Message-ID: <200805190333.m4J3X27u020563@sheep.berlios.de>

Author: fabricecolin
Date: 2008-05-19 05:33:01 +0200 (Mon, 19 May 2008)
New Revision: 1258

Modified:
   trunk/scripts/python/pinot-module.py
Log:
Support for snippets. I am not convinced this is useful considering the current
Deskbar interface, so this is disabled for now.


Modified: trunk/scripts/python/pinot-module.py
===================================================================
--- trunk/scripts/python/pinot-module.py	2008-05-19 03:30:29 UTC (rev 1257)
+++ trunk/scripts/python/pinot-module.py	2008-05-19 03:33:01 UTC (rev 1258)
@@ -16,6 +16,7 @@
 # Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
 #
 
+import cgi, re
 import gnome
 import deskbar
 from deskbar.handlers.actions.OpenFileAction import OpenFileAction
@@ -37,23 +38,38 @@
 	def __init__(self, fields, **args):
 		deskbar.interfaces.Match.__init__ (self)
 		self.result = fields
-		self.url = fields["url"]
+		if fields.has_key("url"):
+			self.url = fields["url"]
 		url_scheme = self.url[:self.url.index("://")]
 		# The mailbox scheme is specific to Pinot
 		if url_scheme == "mailbox":
 			mailbox_url = self.url
-			print "Mailbox hit: ", mailbox_url
+			print 'Mailbox hit: ', mailbox_url
 			self.url = "file://" + mailbox_url[len("mailbox://"):mailbox_url.index('?')]
 			url_scheme = "file"
 
 		self.result["url"] = self.url
-		print "Action: ", self.result["caption"], " ", self.result["url"]
+		print 'Action: ', self.result["caption"], " ", self.result["url"]
 
+		# Snippet
+		self.result["snippet"] = ""
+		if fields.has_key("extract"):
+			snippet = fields["extract"]
+			if snippet != None and snippet != "":
+				# Remove trailing whitespaces and escape '%'
+				snippet.strip().replace("%", "%%")
+				# Escape
+				tmp = re.sub(r"<.*?>", "", snippet)
+				tmp = re.sub(r"</.*?>", "", tmp)
+				print 'Extract ', tmp
+				self.result["snippet"] = "\n%s" % cgi.escape(tmp)
+        
 		if url_scheme == "file":
-			print "File hit"
+			print 'File hit'
+			#self.add_action(OpenFileAction(self.result["caption"] + self.result["snippet"], self.result["url"]))
 			self.add_action(OpenFileAction(self.result["caption"], self.result["url"]))
 		else:
-			print "Other hit"
+			print 'Other hit'
 			self.add_all_actions(get_actions_for_uri(self.result["url"]))
 
 	def get_hash(self, text=None):
@@ -163,7 +179,7 @@
 		try :
 			# Get the details of each hit
 			for doc_id in doc_ids:
-				print "Hit on document ", doc_id
+				print 'Hit on document ', doc_id
 				self.pinot_iface.GetDocumentInfo (dbus.UInt32(doc_id),
 					reply_handler=self.__receive_hits, error_handler=self.__receive_error)
 		except Exception, msg:
@@ -180,7 +196,7 @@
 			match_fields[field[0]] = field[1]
 
 		self.matches.append( PinotFileMatch(match_fields) )
-		print "Got hit ", len(self.matches)
+		print 'Got hit ', len(self.matches)
 		if len(self.matches) == self.matches_count:
 			self._emit_query_ready(self.query_string, self.matches)
 



From fabricecolin at mail.berlios.de  Mon May 19 05:40:27 2008
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Mon, 19 May 2008 05:40:27 +0200
Subject: [Pinot-svn] r1259 - trunk/UI/GTK2/src
Message-ID: <200805190340.m4J3eRrM021131@sheep.berlios.de>

Author: fabricecolin
Date: 2008-05-19 05:40:27 +0200 (Mon, 19 May 2008)
New Revision: 1259

Modified:
   trunk/UI/GTK2/src/pinot-dbus-daemon.xml
Log:
The DocumentInfo methods also handle the "extract" field.


Modified: trunk/UI/GTK2/src/pinot-dbus-daemon.xml
===================================================================
--- trunk/UI/GTK2/src/pinot-dbus-daemon.xml	2008-05-19 03:33:01 UTC (rev 1258)
+++ trunk/UI/GTK2/src/pinot-dbus-daemon.xml	2008-05-19 03:40:27 UTC (rev 1259)
@@ -124,7 +124,7 @@
 	Retrieves information about a document.
 	 docId: the document's ID
 	 fields : array of (s name, s value) structures with name one of
-	 "caption", "url", "type", "language", "modtime", "size"
+	 "caption", "url", "type", "language", "modtime", "size", "extract"
 	-->
     <method name="GetDocumentInfo">
       <annotation name="de.berlios.Pinot.GetDocumentInfo" value="pinotDBus"/>
@@ -135,7 +135,7 @@
 	Sets information about a document.
 	 docId: the document's ID
 	 fields : array of (s name, s value) structures with name one of
-	 "caption", "url", "type", "language", "modtime", "size"
+	 "caption", "url", "type", "language", "modtime", "size", "extract"
 	-->
     <method name="SetDocumentInfo">
       <annotation name="de.berlios.Pinot.SetDocumentInfo" value="pinotDBus"/>



From fabricecolin at mail.berlios.de  Mon May 19 05:45:31 2008
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Mon, 19 May 2008 05:45:31 +0200
Subject: [Pinot-svn] r1260 - trunk/UI/GTK2/src
Message-ID: <200805190345.m4J3jVYZ021921@sheep.berlios.de>

Author: fabricecolin
Date: 2008-05-19 05:45:29 +0200 (Mon, 19 May 2008)
New Revision: 1260

Modified:
   trunk/UI/GTK2/src/pinot-dbus-daemon.cc
Log:
In ignore-version mode, we'd better reset the index labels list too as
xapian-compact will <= 1.06 will have dropped it at the same time as the version
number.


Modified: trunk/UI/GTK2/src/pinot-dbus-daemon.cc
===================================================================
--- trunk/UI/GTK2/src/pinot-dbus-daemon.cc	2008-05-19 03:40:27 UTC (rev 1259)
+++ trunk/UI/GTK2/src/pinot-dbus-daemon.cc	2008-05-19 03:45:29 UTC (rev 1260)
@@ -641,9 +641,13 @@
 				{
 					indexVersion = "0.0";
 				}
-				if ((ignoreVersion == false) &&
-					(indexVersion < PINOT_INDEX_MIN_VERSION))
+				if (ignoreVersion == true)
 				{
+					// Better reset labels, they may have been lost too
+					resetLabels = true;
+				}
+				else if (indexVersion < PINOT_INDEX_MIN_VERSION)
+				{
 					cout << "Upgrading index from version " << indexVersion << " to " << VERSION << endl;
 
 					reindex = true;



From fabricecolin at mail.berlios.de  Mon May 19 09:37:42 2008
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Mon, 19 May 2008 09:37:42 +0200
Subject: [Pinot-svn] r1261 - trunk/UI/GTK2/src
Message-ID: <200805190737.m4J7bgk9024773@sheep.berlios.de>

Author: fabricecolin
Date: 2008-05-19 09:37:41 +0200 (Mon, 19 May 2008)
New Revision: 1261

Modified:
   trunk/UI/GTK2/src/DaemonState.cpp
   trunk/UI/GTK2/src/IndexPage.cpp
   trunk/UI/GTK2/src/ServerThreads.cpp
   trunk/UI/GTK2/src/ServerThreads.h
   trunk/UI/GTK2/src/WorkerThreads.cpp
   trunk/UI/GTK2/src/importDialog.cc
   trunk/UI/GTK2/src/statisticsDialog.cc
Log:
Name *History objects in a uniform manner to facilitate grepping the source.


Modified: trunk/UI/GTK2/src/DaemonState.cpp
===================================================================
--- trunk/UI/GTK2/src/DaemonState.cpp	2008-05-19 03:45:29 UTC (rev 1260)
+++ trunk/UI/GTK2/src/DaemonState.cpp	2008-05-19 07:37:41 UTC (rev 1261)
@@ -432,10 +432,10 @@
 		if ((errorNum > 0) &&
 			(indexedUrl.empty() == false))
 		{
-			CrawlHistory history(PinotSettings::getInstance().getHistoryDatabaseName());
+			CrawlHistory crawlHistory(PinotSettings::getInstance().getHistoryDatabaseName());
 
 			// An entry should already exist for this
-			history.updateItem(indexedUrl, CrawlHistory::ERROR, time(NULL), errorNum);
+			crawlHistory.updateItem(indexedUrl, CrawlHistory::ERROR, time(NULL), errorNum);
 		}
 	}
 	else if (type == "UnindexingThread")

Modified: trunk/UI/GTK2/src/IndexPage.cpp
===================================================================
--- trunk/UI/GTK2/src/IndexPage.cpp	2008-05-19 03:45:29 UTC (rev 1260)
+++ trunk/UI/GTK2/src/IndexPage.cpp	2008-05-19 07:37:41 UTC (rev 1261)
@@ -22,8 +22,6 @@
 #include <gtkmm/stock.h>
 #include <gtkmm/textbuffer.h>
 
-#include "QueryHistory.h"
-#include "ViewHistory.h"
 #include "config.h"
 #include "NLS.h"
 #include "PinotSettings.h"

Modified: trunk/UI/GTK2/src/ServerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/ServerThreads.cpp	2008-05-19 03:45:29 UTC (rev 1260)
+++ trunk/UI/GTK2/src/ServerThreads.cpp	2008-05-19 07:37:41 UTC (rev 1261)
@@ -118,15 +118,15 @@
 {
 	if (m_dirName.empty() == false)
 	{
-		CrawlHistory history(PinotSettings::getInstance().getHistoryDatabaseName());
+		CrawlHistory crawlHistory(PinotSettings::getInstance().getHistoryDatabaseName());
 
 		if (isSource == true)
 		{
 			// Does this source exist ?
-			if (history.hasSource("file://" + m_dirName, m_sourceId) == false)
+			if (crawlHistory.hasSource("file://" + m_dirName, m_sourceId) == false)
 			{
 				// Create it
-				m_sourceId = history.insertSource("file://" + m_dirName);
+				m_sourceId = crawlHistory.insertSource("file://" + m_dirName);
 			}
 		}
 		else
@@ -190,20 +190,20 @@
 }
 
 void DirectoryScannerThread::cacheUpdate(const string &location, time_t mTime,
-	CrawlHistory &history)
+	CrawlHistory &crawlHistory)
 {
 	m_updateCache[location] = mTime;
 
 	if (m_updateCache.size() > 500)
 	{
-		flushUpdates(history);
+		flushUpdates(crawlHistory);
 	}
 }
 
-void DirectoryScannerThread::flushUpdates(CrawlHistory &history)
+void DirectoryScannerThread::flushUpdates(CrawlHistory &crawlHistory)
 {
 	// Update these records
-	history.updateItems(m_updateCache, CrawlHistory::CRAWLED);
+	crawlHistory.updateItems(m_updateCache, CrawlHistory::CRAWLED);
 	m_updateCache.clear();
 
 #ifdef DEBUG
@@ -229,7 +229,7 @@
 	m_signalFileFound(docInfo, labelStream.str(), false);
 }
 
-bool DirectoryScannerThread::scanEntry(const string &entryName, CrawlHistory &history)
+bool DirectoryScannerThread::scanEntry(const string &entryName, CrawlHistory &crawlHistory)
 {
 	CrawlHistory::CrawlStatus status = CrawlHistory::UNKNOWN;
 	string location("file://" + entryName);
@@ -257,7 +257,7 @@
 	}
 
 	// Is this item in the database already ?
-	itemExists = history.hasItem(location, status, itemDate);
+	itemExists = crawlHistory.hasItem(location, status, itemDate);
 
 	if (m_followSymLinks == false)
 	{
@@ -343,7 +343,7 @@
 						subEntryName += pEntryName;
 
 						// Scan this entry
-						if (scanEntry(subEntryName, history) == false)
+						if (scanEntry(subEntryName, crawlHistory) == false)
 						{
 #ifdef DEBUG
 							cout << "DirectoryScannerThread::scanEntry: failed to open "
@@ -389,7 +389,7 @@
 		if (itemExists == false)
 		{
 			// Record it
-			history.insertItem(location, CrawlHistory::CRAWLED, m_sourceId, fileStat.st_mtime);
+			crawlHistory.insertItem(location, CrawlHistory::CRAWLED, m_sourceId, fileStat.st_mtime);
 			itemExists = true;
 #ifdef DEBUG
 			cout << "DirectoryScannerThread::scanEntry: reporting new file " << entryName << endl;
@@ -413,7 +413,7 @@
 #ifdef DEBUG
 				cout << "DirectoryScannerThread::scanEntry: updating " << entryName << endl;
 #endif
-				cacheUpdate(location, fileStat.st_mtime, history);
+				cacheUpdate(location, fileStat.st_mtime, crawlHistory);
 			}
 
 		}
@@ -446,11 +446,11 @@
 		// Record this error
 		if (itemExists == false)
 		{
-			history.insertItem(location, CrawlHistory::ERROR, m_sourceId, timeNow, entryStatus);
+			crawlHistory.insertItem(location, CrawlHistory::ERROR, m_sourceId, timeNow, entryStatus);
 		}
 		else
 		{
-			history.updateItem(location, CrawlHistory::ERROR, timeNow, entryStatus);
+			crawlHistory.updateItem(location, CrawlHistory::ERROR, timeNow, entryStatus);
 		}
 	}
 
@@ -459,7 +459,7 @@
 
 void DirectoryScannerThread::doWork(void)
 {
-	CrawlHistory history(PinotSettings::getInstance().getHistoryDatabaseName());
+	CrawlHistory crawlHistory(PinotSettings::getInstance().getHistoryDatabaseName());
 	set<string> deletedFiles;
 	Timer scanTimer;
 
@@ -474,17 +474,17 @@
 		cout << "Doing a full scan on " << m_dirName << endl;
 
 		// Update this source's items status so that we can detect files that have been deleted
-		history.updateItemsStatus(m_sourceId, CrawlHistory::CRAWLED, CrawlHistory::CRAWLING);
+		crawlHistory.updateItemsStatus(m_sourceId, CrawlHistory::CRAWLED, CrawlHistory::CRAWLING);
 	}
 	// Remove errors
-	history.deleteItems(m_sourceId, CrawlHistory::ERROR);
+	crawlHistory.deleteItems(m_sourceId, CrawlHistory::ERROR);
 
-	if (scanEntry(m_dirName, history) == false)
+	if (scanEntry(m_dirName, crawlHistory) == false)
 	{
 		m_errorNum = OPENDIR_FAILED;
 		m_errorParam = m_dirName;
 	}
-	flushUpdates(history);
+	flushUpdates(crawlHistory);
 
 	if (m_done == true)
 	{
@@ -499,7 +499,7 @@
 		// All files with status set to CRAWLING were not found in this crawl
 		// Chances are they were removed after the last full scan
 		if ((m_pHandler != NULL) &&
-			(history.getSourceItems(m_sourceId, CrawlHistory::CRAWLING, deletedFiles) > 0))
+			(crawlHistory.getSourceItems(m_sourceId, CrawlHistory::CRAWLING, deletedFiles) > 0))
 		{
 #ifdef DEBUG
 			cout << "DirectoryScannerThread::doWork: " << deletedFiles.size() << " files were deleted" << endl;
@@ -511,7 +511,7 @@
 				if (m_pHandler->fileDeleted(fileIter->substr(7)) == true)
 				{
 					// Delete this item
-					history.deleteItem(*fileIter);
+					crawlHistory.deleteItem(*fileIter);
 				}
 			}
 		}
@@ -664,8 +664,8 @@
 
 	if (dbus_message_is_method_call(m_pRequest, "de.berlios.Pinot", "GetStatistics") == TRUE)
 	{
-		CrawlHistory history(settings.getHistoryDatabaseName());
-		unsigned int crawledFilesCount = history.getItemsCount(CrawlHistory::CRAWLED);
+		CrawlHistory crawlHistory(settings.getHistoryDatabaseName());
+		unsigned int crawledFilesCount = crawlHistory.getItemsCount(CrawlHistory::CRAWLED);
 		unsigned int docsCount = pIndex->getDocumentsCount();
 
 #ifdef DEBUG

Modified: trunk/UI/GTK2/src/ServerThreads.h
===================================================================
--- trunk/UI/GTK2/src/ServerThreads.h	2008-05-19 03:45:29 UTC (rev 1260)
+++ trunk/UI/GTK2/src/ServerThreads.h	2008-05-19 07:37:41 UTC (rev 1261)
@@ -69,10 +69,10 @@
 		sigc::signal3<void, DocumentInfo, std::string, bool> m_signalFileFound;
 		std::map<std::string, time_t> m_updateCache;
 
-		void cacheUpdate(const std::string &location, time_t mTime, CrawlHistory &history);
-		void flushUpdates(CrawlHistory &history);
+		void cacheUpdate(const std::string &location, time_t mTime, CrawlHistory &crawlHistory);
+		void flushUpdates(CrawlHistory &crawlHistory);
 		void foundFile(const DocumentInfo &docInfo);
-		bool scanEntry(const std::string &entryName, CrawlHistory &history);
+		bool scanEntry(const std::string &entryName, CrawlHistory &crawlHistory);
 		virtual void doWork(void);
 
 	private:

Modified: trunk/UI/GTK2/src/WorkerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.cpp	2008-05-19 03:45:29 UTC (rev 1260)
+++ trunk/UI/GTK2/src/WorkerThreads.cpp	2008-05-19 07:37:41 UTC (rev 1261)
@@ -1163,9 +1163,9 @@
 
 void EngineHistoryThread::doWork(void)
 {
-	QueryHistory history(PinotSettings::getInstance().getHistoryDatabaseName());
+	QueryHistory queryHistory(PinotSettings::getInstance().getHistoryDatabaseName());
 
-	if (history.getItems(m_queryProps.getName(), m_engineDisplayableName,
+	if (queryHistory.getItems(m_queryProps.getName(), m_engineDisplayableName,
 		m_maxDocsCount, m_documentsList) == false)
 	{
 		m_errorNum = HISTORY_FAILED;
@@ -1174,7 +1174,7 @@
 	else if (m_documentsList.empty() == false)
 	{
 		// Get the first result's charset
-		history.getItemExtract(m_queryProps.getName(), m_engineDisplayableName,
+		queryHistory.getItemExtract(m_queryProps.getName(), m_engineDisplayableName,
 			m_documentsList.front().getLocation(), m_resultsCharset);
 	}
 }
@@ -1955,7 +1955,7 @@
 
 void MonitorThread::processEvents(void)
 {
-	CrawlHistory history(PinotSettings::getInstance().getHistoryDatabaseName());
+	CrawlHistory crawlHistory(PinotSettings::getInstance().getHistoryDatabaseName());
 	queue<MonitorEvent> events;
 
 #ifdef DEBUG
@@ -2031,7 +2031,7 @@
 				{
 					m_pHandler->fileModified(event.m_location);
 				}
-				else if (history.hasItem("file://" + event.m_location, status, itemDate) == true)
+				else if (crawlHistory.hasItem("file://" + event.m_location, status, itemDate) == true)
 				{
 					// Was the file actually modified ?
 					if ((stat(event.m_location.c_str(), &fileStat) == 0) &&

Modified: trunk/UI/GTK2/src/importDialog.cc
===================================================================
--- trunk/UI/GTK2/src/importDialog.cc	2008-05-19 03:45:29 UTC (rev 1260)
+++ trunk/UI/GTK2/src/importDialog.cc	2008-05-19 07:37:41 UTC (rev 1261)
@@ -156,9 +156,9 @@
 	m_locationLength = locationLength;
 
 	// Get 10 URLs like this one
-	QueryHistory history(PinotSettings::getInstance().getHistoryDatabaseName());
+	QueryHistory queryHistory(PinotSettings::getInstance().getHistoryDatabaseName());
 	set<string> suggestedUrls;
-	history.findUrlsLike(fileName, 10, suggestedUrls);
+	queryHistory.findUrlsLike(fileName, 10, suggestedUrls);
 	// Populate the list
 	for (set<string>::iterator urlIter = suggestedUrls.begin();
 		urlIter != suggestedUrls.end(); ++urlIter)

Modified: trunk/UI/GTK2/src/statisticsDialog.cc
===================================================================
--- trunk/UI/GTK2/src/statisticsDialog.cc	2008-05-19 03:45:29 UTC (rev 1260)
+++ trunk/UI/GTK2/src/statisticsDialog.cc	2008-05-19 07:37:41 UTC (rev 1261)
@@ -128,7 +128,7 @@
 
 bool statisticsDialog::on_activity_timeout(void)
 {
-	CrawlHistory crawlerHistory(PinotSettings::getInstance().getHistoryDatabaseName(true));
+	CrawlHistory crawlHistory(PinotSettings::getInstance().getHistoryDatabaseName(true));
 	ViewHistory viewHistory(PinotSettings::getInstance().getHistoryDatabaseName());
 	TreeModel::Row row;
 	std::map<unsigned int, string> sources;
@@ -176,7 +176,7 @@
 	row[m_statsColumns.m_name] = ustring(_("Viewed")) + " " + countStr + " " + _("results");
 
 	// Show crawler statistics
-	unsigned int crawledFilesCount = crawlerHistory.getItemsCount(CrawlHistory::CRAWLED);
+	unsigned int crawledFilesCount = crawlHistory.getItemsCount(CrawlHistory::CRAWLED);
 	snprintf(countStr, 64, "%u", crawledFilesCount);
 	row = *m_crawledStatIter;
 	row[m_statsColumns.m_name] = ustring(_("Crawled")) + " " + countStr + " " + _("files");
@@ -215,7 +215,7 @@
 	}
 
 	// Show errors
-	crawlerHistory.getSources(sources);
+	crawlHistory.getSources(sources);
 	for (std::map<unsigned int, string>::iterator sourceIter = sources.begin();
 		sourceIter != sources.end(); ++sourceIter)
 	{
@@ -230,7 +230,7 @@
 		}
 
 		// Did any error occur on this source ?
-		unsigned int errorCount = crawlerHistory.getSourceItems(sourceNum,
+		unsigned int errorCount = crawlHistory.getSourceItems(sourceNum,
 			CrawlHistory::ERROR, errors, latestErrorDate);
 		if ((errorCount > 0) &&
 			(errors.empty() == false))
@@ -252,7 +252,7 @@
 				string locationWithError(*errorIter);
 				TreeModel::iterator errIter;
 				time_t errorDate;
-				int errorNum = crawlerHistory.getErrorDetails(locationWithError, errorDate);
+				int errorNum = crawlHistory.getErrorDetails(locationWithError, errorDate);
 
 				if (errorDate > latestErrorDate)
 				{



From fabricecolin at mail.berlios.de  Mon May 19 12:05:33 2008
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Mon, 19 May 2008 12:05:33 +0200
Subject: [Pinot-svn] r1262 - trunk/IndexSearch
Message-ID: <200805191005.m4JA5XIg009829@sheep.berlios.de>

Author: fabricecolin
Date: 2008-05-19 12:05:32 +0200 (Mon, 19 May 2008)
New Revision: 1262

Modified:
   trunk/IndexSearch/QueryProperties.cpp
Log:
Trim spaces off query strings after removing filters to make sure we don't pass
strings consisting exclusively of spaces to Web engines.


Modified: trunk/IndexSearch/QueryProperties.cpp
===================================================================
--- trunk/IndexSearch/QueryProperties.cpp	2008-05-19 07:37:41 UTC (rev 1261)
+++ trunk/IndexSearch/QueryProperties.cpp	2008-05-19 10:05:32 UTC (rev 1262)
@@ -23,6 +23,7 @@
 #include <utility>
 
 #include "Document.h"
+#include "StringManip.h"
 #include "CJKVTokenizer.h"
 #include "QueryProperties.h"
 
@@ -68,9 +69,7 @@
 							m_freeQuery.erase(tokPosStart);
 						}
 					}
-#ifdef DEBUG
-					cout << "QueryProperties::getFreeQuery: removed " << tok << "..." << endl;
-#endif
+
 					return true;
 				}
 			}
@@ -205,6 +204,7 @@
 
 	tokenizer.tokenize(m_freeQuery, handler, true);
 	m_freeQueryWithoutFilters = handler.m_freeQuery;
+	StringManip::trimSpaces(m_freeQueryWithoutFilters);
 }
 
 /// Sets the name.



From fabricecolin at mail.berlios.de  Tue May 20 14:49:35 2008
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 20 May 2008 14:49:35 +0200
Subject: [Pinot-svn] r1263 - trunk/SQL
Message-ID: <200805201249.m4KCnZsA015666@sheep.berlios.de>

Author: fabricecolin
Date: 2008-05-20 14:49:34 +0200 (Tue, 20 May 2008)
New Revision: 1263

Modified:
   trunk/SQL/QueryHistory.cpp
   trunk/SQL/QueryHistory.h
Log:
Date is now part of the primary key so that we can have several snapshots of
query results.


Modified: trunk/SQL/QueryHistory.cpp
===================================================================
--- trunk/SQL/QueryHistory.cpp	2008-05-19 10:05:32 UTC (rev 1262)
+++ trunk/SQL/QueryHistory.cpp	2008-05-20 12:49:34 UTC (rev 1263)
@@ -23,7 +23,6 @@
 #include <cstdlib>
 
 #include "Url.h"
-#include "TimeConverter.h"
 #include "QueryHistory.h"
 
 using std::cout;
@@ -44,8 +43,6 @@
 /// Creates the QueryHistory table in the database.
 bool QueryHistory::create(const string &database)
 {
-	bool success = true;
-
 	// The specified path must be a file
 	if (SQLiteBase::check(database) == false)
 	{
@@ -53,24 +50,34 @@
 	}
 
 	SQLiteBase db(database);
+	string tableDefinition("QueryName VARCHAR(255), EngineName VARCHAR(255), HostName VARCHAR(255), \
+		Url VARCHAR(255), Title VARCHAR(255), Extract VARCHAR(255), Language VARCHAR(255), \
+		Score FLOAT, Date INTEGER, PRIMARY KEY(QueryName, EngineName, Url, Date)");
 
 	// Does QueryHistory exist ?
 	if (db.executeSimpleStatement("SELECT * FROM QueryHistory LIMIT 1;") == false)
 	{
-#ifdef DEBUG
-		cout << "QueryHistory::create: QueryHistory doesn't exist" << endl;
-#endif
 		// Create the table
-		if (db.executeSimpleStatement("CREATE TABLE QueryHistory (QueryName VARCHAR(255), \
-			EngineName VARCHAR(255), HostName VARCHAR(255), Url VARCHAR(255), Title VARCHAR(255), \
-			Extract VARCHAR(255), Language VARCHAR(255), Score FLOAT, PrevScore FLOAT, Date INTEGER, \
-			PRIMARY KEY(QueryName, EngineName, Url));") == false)
+		if (db.executeSimpleStatement("CREATE TABLE QueryHistory (" + tableDefinition + ");") == false)
 		{
-			success = false;
+			return false;
 		}
 	}
+	else
+	{
+		// Previous versions had a PrevScore field, so check for it
+		if (db.executeSimpleStatement("SELECT PrevScore FROM QueryHistory LIMIT 1;") == true)
+		{
+#ifdef DEBUG
+			cout << "QueryHistory::create: QueryHistory needs updating" << endl;
+#endif
+			db.alterTable("QueryHistory",
+				"QueryName, EngineName, HostName, Url, Title, Extract, Language, Score, Date",
+				tableDefinition);
+		}
+	}
 
-	return success;
+	return true;
 }
 
 /// Inserts an URL.
@@ -82,7 +89,7 @@
 	bool success = false;
 
 	SQLResults *results = executeStatement("INSERT INTO QueryHistory \
-		VALUES('%q', '%q', '%q', '%q', '%q', '%q', '%q', '%f', '0.0', '%d');",
+		VALUES('%q', '%q', '%q', '%q', '%q', '%q', '%q', '%f', '%d');",
 		queryName.c_str(), engineName.c_str(), hostName.c_str(),
 		Url::escapeUrl(url).c_str(), title.c_str(), extract.c_str(), charset.c_str(),
 		score, time(NULL));
@@ -101,18 +108,28 @@
 {
 	float score = 0;
 
-	SQLResults *results = executeStatement("SELECT Score, PrevScore FROM QueryHistory \
-		WHERE QueryName='%q' AND EngineName='%q' AND Url='%q';",
+	SQLResults *results = executeStatement("SELECT Score FROM QueryHistory \
+		WHERE QueryName='%q' AND EngineName='%q' AND Url='%q' ORDER BY Date DESC;",
 		queryName.c_str(), engineName.c_str(), Url::escapeUrl(url).c_str());
 	if (results != NULL)
 	{
+		previousScore = 0;
+
 		SQLRow *row = results->nextRow();
 		if (row != NULL)
 		{
 			score = (float)atof(row->getColumn(0).c_str());
-			previousScore = (float)atof(row->getColumn(1).c_str());
 
 			delete row;
+
+			// Get the score of the second last run
+			SQLRow *row = results->nextRow();
+			if (row != NULL)
+			{
+				previousScore = (float)atof(row->getColumn(0).c_str());
+
+				delete row;
+			}
 		}
 
 		delete results;
@@ -121,26 +138,6 @@
 	return score;
 }
 
-/// Updates an URL's details.
-bool QueryHistory::updateItem(const string &queryName, const string &engineName, const string &url,
-	const string &title, const string &extract, const string &charset, float score)
-{
-	bool success = false;
-
-	SQLResults *results = executeStatement("UPDATE QueryHistory SET PrevScore=Score, \
-		Score=%f, Date='%d', Title='%q', Extract='%q', Language='%q' \
-		WHERE QueryName='%q' AND EngineName='%q' AND Url='%q';",
-		score, time(NULL), title.c_str(), extract.c_str(), charset.c_str(),
-		queryName.c_str(), engineName.c_str(), Url::escapeUrl(url).c_str());
-	if (results != NULL)
-	{
-		success = true;
-		delete results;
-	}
-
-	return success;
-}
-
 /// Gets the list of engines the query was run on.
 bool QueryHistory::getEngines(const string &queryName, set<string> &enginesList)
 {
@@ -178,7 +175,7 @@
 	bool success = false;
 
 	SQLResults *results = executeStatement("SELECT Title, Url, Language, Extract, Score \
-		FROM QueryHistory WHERE QueryName='%q' AND EngineName='%q' ORDER BY Score DESC \
+		FROM QueryHistory WHERE QueryName='%q' AND EngineName='%q' ORDER BY Date, Score DESC \
 		LIMIT %u;", queryName.c_str(), engineName.c_str(), max);
 	if (results != NULL)
 	{
@@ -215,7 +212,7 @@
 	string extract;
 
 	SQLResults *results = executeStatement("SELECT Extract, Language FROM QueryHistory \
-		WHERE QueryName='%q' AND EngineName='%q' AND Url='%q';",
+		WHERE QueryName='%q' AND EngineName='%q' AND Url='%q' ORDER BY Date DESC;",
 		queryName.c_str(), engineName.c_str(), Url::escapeUrl(url).c_str());
 	if (results != NULL)
 	{
@@ -269,55 +266,69 @@
 	return success;
 }
 
-/// Gets a query's last run time.
-string QueryHistory::getLastRun(const string &queryName, const string &engineName)
+/// Gets a query's latest run times.
+bool QueryHistory::getLatestRuns(const string &queryName, const string &engineName,
+	unsigned int runCount, set<time_t> &runTimes)
 {
 	SQLResults *results = NULL;
-	string lastRun;
+	bool success = false;
 
 	if (queryName.empty() == true)
 	{
-		return "";
+		return false;
 	}
 
 	if (engineName.empty() == true)
 	{
-		results = executeStatement("SELECT MAX(Date) FROM QueryHistory \
-			WHERE QueryName='%q';", queryName.c_str());
+		results = executeStatement("SELECT Date FROM QueryHistory \
+			WHERE QueryName='%q' GROUP BY EngineName ORDER By Date DESC LIMIT %u;",
+			queryName.c_str(), runCount);
 	}
 	else
 	{
-		results = executeStatement("SELECT MAX(Date) FROM QueryHistory \
-			WHERE QueryName='%q' AND EngineName='%q';",
-			queryName.c_str(), engineName.c_str());
+		results = executeStatement("SELECT Date FROM QueryHistory \
+			WHERE QueryName='%q' AND EngineName='%q' GROUP BY Date ORDER By Date DESC LIMIT %u;",
+			queryName.c_str(), engineName.c_str(), runCount);
 	}
 
 	if (results != NULL)
 	{
-		SQLRow *row = results->nextRow();
-		if (row != NULL)
+		while (results->hasMoreRows() == true)
 		{
-			int latestDate = atoi(row->getColumn(0).c_str());
-			if (latestDate > 0)
+			SQLRow *row = results->nextRow();
+			if (row == NULL)
 			{
-				lastRun = TimeConverter::toTimestamp((time_t)latestDate);
+				break;
 			}
 
+			int runDate = atoi(row->getColumn(0).c_str());
+			if (runDate > 0)
+			{
+				runTimes.insert((time_t)runDate);
+			}
+			success = true;
+
 			delete row;
 		}
 
 		delete results;
 	}
 
-	return lastRun;
+	return success;
 }
 
 /// Deletes items at least as old as the given date.
 bool QueryHistory::deleteItems(const string &queryName, const string &engineName,
 	time_t cutOffDate)
 {
+	if (cutOffDate == 0)
+	{
+		// Nothing to delete
+		return true;
+	}
+
 	SQLResults *results = executeStatement("DELETE FROM QueryHistory \
-		WHERE QueryName='%q' AND EngineName='%q' AND Date<='%d';",
+		WHERE QueryName='%q' AND EngineName='%q' AND Date<'%d';",
 		queryName.c_str(), engineName.c_str(), cutOffDate);
 	if (results != NULL)
 	{
@@ -358,6 +369,12 @@
 /// Expires items older than the given date.
 bool QueryHistory::expireItems(time_t expiryDate)
 {
+	if (expiryDate == 0)
+	{
+		// Nothing to delete
+		return true;
+	}
+
 	SQLResults *results = executeStatement("DELETE FROM QueryHistory \
 		WHERE Date<'%d';", expiryDate);
 	if (results != NULL)

Modified: trunk/SQL/QueryHistory.h
===================================================================
--- trunk/SQL/QueryHistory.h	2008-05-19 10:05:32 UTC (rev 1262)
+++ trunk/SQL/QueryHistory.h	2008-05-20 12:49:34 UTC (rev 1263)
@@ -47,10 +47,6 @@
 		float hasItem(const std::string &queryName, const std::string &engineName, const std::string &url,
 			float &previousScore);
 
-		/// Updates an URL's details.
-		bool updateItem(const std::string &queryName, const std::string &engineName, const std::string &url,
-			const std::string &title, const std::string &extract, const std::string &charset, float score);
-
 		/// Gets the list of engines the query was run on.
 		bool getEngines(const std::string &queryName, std::set<std::string> &enginesList);
 
@@ -66,8 +62,9 @@
 		bool findUrlsLike(const std::string &url, unsigned int count,
 			std::set<std::string> &urls);
 
-		/// Gets a query's last run time.
-		std::string getLastRun(const std::string &queryName, const std::string &engineName = "");
+		/// Gets a query's latest run times.
+		bool getLatestRuns(const std::string &queryName, const std::string &engineName,
+			unsigned int runCount, std::set<time_t> &runTimes);
 
 		/// Deletes items at least as old as the given date.
 		bool deleteItems(const std::string &queryName, const std::string &engineName,



From fabricecolin at mail.berlios.de  Tue May 20 16:45:09 2008
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 20 May 2008 16:45:09 +0200
Subject: [Pinot-svn] r1264 - in trunk: SQL UI/GTK2/src
Message-ID: <200805201445.m4KEj9kP026956@sheep.berlios.de>

Author: fabricecolin
Date: 2008-05-20 16:45:08 +0200 (Tue, 20 May 2008)
New Revision: 1264

Modified:
   trunk/SQL/QueryHistory.cpp
   trunk/SQL/QueryHistory.h
   trunk/UI/GTK2/src/ResultsTree.cpp
   trunk/UI/GTK2/src/WorkerThreads.cpp
Log:
We might as well drop the Language column since it was used as charset and all
the fields stored in this table are converted to UTF-8 prior to insertion.


Modified: trunk/SQL/QueryHistory.cpp
===================================================================
--- trunk/SQL/QueryHistory.cpp	2008-05-20 12:49:34 UTC (rev 1263)
+++ trunk/SQL/QueryHistory.cpp	2008-05-20 14:45:08 UTC (rev 1264)
@@ -22,6 +22,7 @@
 #include <iostream>
 #include <cstdlib>
 
+#include "TimeConverter.h"
 #include "Url.h"
 #include "QueryHistory.h"
 
@@ -51,8 +52,8 @@
 
 	SQLiteBase db(database);
 	string tableDefinition("QueryName VARCHAR(255), EngineName VARCHAR(255), HostName VARCHAR(255), \
-		Url VARCHAR(255), Title VARCHAR(255), Extract VARCHAR(255), Language VARCHAR(255), \
-		Score FLOAT, Date INTEGER, PRIMARY KEY(QueryName, EngineName, Url, Date)");
+		Url VARCHAR(255), Title VARCHAR(255), Extract VARCHAR(255), Score FLOAT, Date INTEGER, \
+		PRIMARY KEY(QueryName, EngineName, Url, Date)");
 
 	// Does QueryHistory exist ?
 	if (db.executeSimpleStatement("SELECT * FROM QueryHistory LIMIT 1;") == false)
@@ -65,14 +66,14 @@
 	}
 	else
 	{
-		// Previous versions had a PrevScore field, so check for it
-		if (db.executeSimpleStatement("SELECT PrevScore FROM QueryHistory LIMIT 1;") == true)
+		// Previous versions had PrevScore and Language columns, so check for one of them
+		if (db.executeSimpleStatement("SELECT Language FROM QueryHistory LIMIT 1;") == true)
 		{
 #ifdef DEBUG
 			cout << "QueryHistory::create: QueryHistory needs updating" << endl;
 #endif
 			db.alterTable("QueryHistory",
-				"QueryName, EngineName, HostName, Url, Title, Extract, Language, Score, Date",
+				"QueryName, EngineName, HostName, Url, Title, Extract, Score, Date",
 				tableDefinition);
 		}
 	}
@@ -81,18 +82,19 @@
 }
 
 /// Inserts an URL.
-bool QueryHistory::insertItem(const string &queryName, const string &engineName, const string &url,
-	const string &title, const string &extract, const string &charset, float score)
+bool QueryHistory::insertItem(const string &queryName, const string &engineName,
+	const string &url, const string &title, const string &extract,
+	float score, const string &date)
 {
 	Url urlObj(url);
 	string hostName(urlObj.getHost());
 	bool success = false;
 
 	SQLResults *results = executeStatement("INSERT INTO QueryHistory \
-		VALUES('%q', '%q', '%q', '%q', '%q', '%q', '%q', '%f', '%d');",
+		VALUES('%q', '%q', '%q', '%q', '%q', '%q', '%f', '%d');",
 		queryName.c_str(), engineName.c_str(), hostName.c_str(),
-		Url::escapeUrl(url).c_str(), title.c_str(), extract.c_str(), charset.c_str(),
-		score, time(NULL));
+		Url::escapeUrl(url).c_str(), title.c_str(), extract.c_str(),
+		score, TimeConverter::fromTimestamp(date));
 	if (results != NULL)
 	{
 		success = true;
@@ -144,7 +146,7 @@
 	bool success = false;
 
 	SQLResults *results = executeStatement("SELECT EngineName FROM QueryHistory \
-		WHERE QueryName='%q' GROUP BY EngineName",
+		WHERE QueryName='%q' GROUP BY EngineName;",
 		queryName.c_str());
 	if (results != NULL)
 	{
@@ -174,7 +176,7 @@
 {
 	bool success = false;
 
-	SQLResults *results = executeStatement("SELECT Title, Url, Language, Extract, Score \
+	SQLResults *results = executeStatement("SELECT Title, Url, Extract, Score, Date \
 		FROM QueryHistory WHERE QueryName='%q' AND EngineName='%q' ORDER BY Date, Score DESC \
 		LIMIT %u;", queryName.c_str(), engineName.c_str(), max);
 	if (results != NULL)
@@ -189,9 +191,11 @@
 
 			DocumentInfo result(row->getColumn(0),
 				Url::unescapeUrl(row->getColumn(1)).c_str(),
-				"", row->getColumn(2));
-			result.setExtract(row->getColumn(3));
-			result.setScore((float)atof(row->getColumn(4).c_str()));
+				"", "");
+			result.setExtract(row->getColumn(2));
+			result.setScore((float)atof(row->getColumn(3).c_str()));
+			int runDate = atoi(row->getColumn(4).c_str());
+			result.setTimestamp(TimeConverter::toTimestamp((time_t)runDate));
 
 			resultsList.push_back(result);
 			success = true;
@@ -207,11 +211,11 @@
 
 /// Gets an item's extract.
 string QueryHistory::getItemExtract(const string &queryName, const string &engineName,
-	const string &url, string &charset)
+	const string &url)
 {
 	string extract;
 
-	SQLResults *results = executeStatement("SELECT Extract, Language FROM QueryHistory \
+	SQLResults *results = executeStatement("SELECT Extract FROM QueryHistory \
 		WHERE QueryName='%q' AND EngineName='%q' AND Url='%q' ORDER BY Date DESC;",
 		queryName.c_str(), engineName.c_str(), Url::escapeUrl(url).c_str());
 	if (results != NULL)
@@ -220,7 +224,6 @@
 		if (row != NULL)
 		{
 			extract = row->getColumn(0);
-			charset = row->getColumn(1);
 
 			delete row;
 		}
@@ -242,7 +245,7 @@
 	}
 
 	SQLResults *results = executeStatement("SELECT Url FROM QueryHistory \
-		WHERE Url LIKE '%q%%' ORDER BY Url LIMIT %u",
+		WHERE Url LIKE '%q%%' ORDER BY Url LIMIT %u;",
 		Url::escapeUrl(url).c_str(), count);
 	if (results != NULL)
 	{

Modified: trunk/SQL/QueryHistory.h
===================================================================
--- trunk/SQL/QueryHistory.h	2008-05-20 12:49:34 UTC (rev 1263)
+++ trunk/SQL/QueryHistory.h	2008-05-20 14:45:08 UTC (rev 1264)
@@ -37,8 +37,9 @@
 		static bool create(const std::string &database);
 
 		/// Inserts an URL.
-		bool insertItem(const std::string &queryName, const std::string &engineName, const std::string &url,
-			const std::string &title, const std::string &extract, const std::string &charset, float score);
+		bool insertItem(const std::string &queryName, const std::string &engineName,
+			const std::string &url, const std::string &title, const std::string &extract,
+			float score, const std::string &date);
 
 		/**
 		  * Checks if an URL is in the query's history.
@@ -56,7 +57,7 @@
 
 		/// Gets an item's extract.
 		std::string getItemExtract(const std::string &queryName, const std::string &engineName,
-			const std::string &url, std::string &charset);
+			const std::string &url);
 
 		/// Finds URLs.
 		bool findUrlsLike(const std::string &url, unsigned int count,

Modified: trunk/UI/GTK2/src/ResultsTree.cpp
===================================================================
--- trunk/UI/GTK2/src/ResultsTree.cpp	2008-05-20 12:49:34 UTC (rev 1263)
+++ trunk/UI/GTK2/src/ResultsTree.cpp	2008-05-20 14:45:08 UTC (rev 1264)
@@ -31,8 +31,8 @@
 #include "TimeConverter.h"
 #include "Url.h"
 #include "QueryHistory.h"
+#include "ViewHistory.h"
 #include "ResultsExporter.h"
-#include "ViewHistory.h"
 #include "config.h"
 #include "NLS.h"
 #include "PinotSettings.h"
@@ -475,50 +475,66 @@
 		rootType = ResultsModelColumns::ROW_HOST;
 	}
 
+	unsigned int indexId = 0;
+	unsigned int engineId = 0;
+
 	// Find out what the search engine ID is
-	unsigned int indexId = 0;
-	unsigned int engineId = m_settings.getEngineId(engineName);
-	if (engineId == 0)
+	if (engineName.empty() == false)
 	{
-		// Chances are this engine is an index
-		std::map<string, string>::const_iterator mapIter = m_settings.getIndexes().find(engineName);
-		if (mapIter != m_settings.getIndexes().end())
+		engineId = m_settings.getEngineId(engineName);
+		if (engineId == 0)
 		{
-			// Yes, it is
-			indexId = m_settings.getIndexIdByName(engineName);
-			engineId = m_settings.getEngineId(m_settings.m_defaultBackend);
+			// Chances are this engine is an index
+			std::map<string, string>::const_iterator mapIter = m_settings.getIndexes().find(engineName);
+			if (mapIter != m_settings.getIndexes().end())
+			{
+				// Yes, it is
+				indexId = m_settings.getIndexIdByName(engineName);
+				engineId = m_settings.getEngineId(m_settings.m_defaultBackend);
 #ifdef DEBUG
-			cout << "ResultsTree::addResults: engine is index " << engineName << " " << indexId << " " << engineId << endl;
+				cout << "ResultsTree::addResults: engine is index " << engineName << " " << indexId << " " << engineId << endl;
 #endif
+			}
+#ifdef DEBUG
+			else cout << "ResultsTree::addResults: " << engineName << " is not an index" <<  endl;
+#endif
 		}
 #ifdef DEBUG
-		else cout << "ResultsTree::addResults: " << engineName << " is not an index" <<  endl;
+		else cout << "ResultsTree::addResults: ID for engine " << engineName << " is " << engineId <<  endl;
 #endif
 	}
-#ifdef DEBUG
-	else cout << "ResultsTree::addResults: ID for engine " << engineName << " is " << engineId <<  endl;
-#endif
 
 	QueryHistory queryHistory(m_settings.getHistoryDatabaseName());
 	ViewHistory viewHistory(m_settings.getHistoryDatabaseName());
-	string lastRun(queryHistory.getLastRun(m_treeName, engineName));
-	time_t lastRunTime = 0;
+	set<time_t> latestRuns;
+	time_t secondLastRunTime = 0;
 	bool isNewQuery = false;
 
 	// Is this a new query ?
-	if (lastRun.empty() == true)
+	if ((queryHistory.getLatestRuns(m_treeName, engineName, 2, latestRuns) == false) ||
+		(latestRuns.empty() == true))
 	{
 		isNewQuery = true;
 	}
 	else
 	{
-		lastRunTime = TimeConverter::fromTimestamp(lastRun);
+		set<time_t>::const_iterator runIter = latestRuns.begin();
+
+		// We only need to keep the last two runs
+		if (runIter != latestRuns.end())
+		{
+			++runIter;
+			if (runIter != latestRuns.end())
+			{
+				secondLastRunTime = (*runIter);
+			}
+		}
 	}
+#ifdef DEBUG
+	cout << "ResultsTree::addResults: " << resultsList.size() << " results, second last run " << secondLastRunTime << endl;
+#endif
 
 	// Look at the results list
-#ifdef DEBUG
-	cout << "ResultsTree::addResults: " << resultsList.size() << " results, last run " << lastRun << endl;
-#endif
 	for (vector<DocumentInfo>::const_iterator resultIter = resultsList.begin();
 		resultIter != resultsList.end(); ++resultIter)
 	{
@@ -549,24 +565,17 @@
 			float oldestScore = 0;
 			float previousScore = queryHistory.hasItem(m_treeName, engineName,
 				location, oldestScore);
+#ifdef DEBUG
+			cout << "ResultsTree::addResults: " << location << " has scores "
+				<< previousScore << ", " << oldestScore << endl;
+#endif
 			if (previousScore > 0)
 			{
-				if (updateHistory == true)
-				{
-					// Update this result whatever the current and previous rankings were
-					queryHistory.updateItem(m_treeName, engineName, location,
-						title, extract, charset, currentScore);
-				}
+				// Yes, it has
 				rankDiff = (int)(currentScore - previousScore);
 			}
 			else
 			{
-				// No, this is a new result
-				if (updateHistory == true)
-				{
-					queryHistory.insertItem(m_treeName, engineName, location,
-						resultIter->getTitle(), extract, charset, currentScore);
-				}
 				// New results are displayed as such only if the query has already been run on the engine
 				if (isNewQuery == false)
 				{
@@ -574,6 +583,12 @@
 					rankDiff = 666;
 				}
 			}
+
+			if (updateHistory == true)
+			{
+				queryHistory.insertItem(m_treeName, engineName, location,
+					title, extract, currentScore, resultIter->getTimestamp());
+			}
 		}
 
 		++count;
@@ -617,9 +632,9 @@
 	{
 #ifdef DEBUG
 		cout << "ResultsTree::addResults: removing items for " << m_treeName
-			<< ", " << engineName << " older than " << lastRunTime << endl;
+			<< ", " << engineName << " older than " << secondLastRunTime << endl;
 #endif
-		queryHistory.deleteItems(m_treeName, engineName, lastRunTime);
+		queryHistory.deleteItems(m_treeName, engineName, secondLastRunTime);
 	}
 
 	if (count > 0)
@@ -1284,7 +1299,7 @@
 			set<string> engineNames, indexNames;
 			TreeModel::Row childRow = *childIter;
 			DocumentInfo result;
-			string engineName, charset, serial(from_utf8(childRow[m_resultsColumns.m_serial]));
+			string engineName, serial(from_utf8(childRow[m_resultsColumns.m_serial]));
 			unsigned int engineIds = childRow[m_resultsColumns.m_engines];
 			unsigned int indexIds = childRow[m_resultsColumns.m_indexes];
 
@@ -1310,7 +1325,7 @@
 			if (m_groupMode != FLAT)
 			{
 				result.setExtract(queryHistory.getItemExtract(from_utf8(m_treeName),
-					engineName, result.getLocation(), charset));
+					engineName, result.getLocation()));
 			}
 			result.setTimestamp(from_utf8(childRow[m_resultsColumns.m_timestamp]));
 
@@ -1528,7 +1543,7 @@
 	QueryHistory queryHistory(m_settings.getHistoryDatabaseName());
 	set<string> engineNames, indexNames;
 	string url(from_utf8(row[m_resultsColumns.m_url]));
-	string extract, charset;
+	string extract;
 	unsigned int engineIds = row[m_resultsColumns.m_engines];
 	unsigned int indexIds = row[m_resultsColumns.m_indexes];
 
@@ -1561,11 +1576,11 @@
 #ifdef DEBUG
 			cout << "ResultsTree::findResultsExtract: engine or index " << engineName << endl;
 #endif
-			extract = queryHistory.getItemExtract(from_utf8(m_treeName), engineName, url, charset);
+			extract = queryHistory.getItemExtract(from_utf8(m_treeName), engineName, url);
 			if (extract.empty() == false)
 			{
 				// Stop here
-				return to_utf8(extract, charset);
+				return extract;
 			}
 		}
 	}

Modified: trunk/UI/GTK2/src/WorkerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.cpp	2008-05-20 12:49:34 UTC (rev 1263)
+++ trunk/UI/GTK2/src/WorkerThreads.cpp	2008-05-20 14:45:08 UTC (rev 1264)
@@ -1154,6 +1154,8 @@
 #ifdef DEBUG
 	cout << "EngineHistoryThread::EngineHistoryThread: engine " << m_engineDisplayableName << endl;
 #endif
+	// Results are converted to UTF-8 prior to insertion in the history database
+	m_resultsCharset = "UTF-8";
 	m_isLive = false;
 }
 
@@ -1175,7 +1177,7 @@
 	{
 		// Get the first result's charset
 		queryHistory.getItemExtract(m_queryProps.getName(), m_engineDisplayableName,
-			m_documentsList.front().getLocation(), m_resultsCharset);
+			m_documentsList.front().getLocation());
 	}
 }
 



From fabricecolin at mail.berlios.de  Tue May 20 16:47:50 2008
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 20 May 2008 16:47:50 +0200
Subject: [Pinot-svn] r1265 - trunk/UI/GTK2/src
Message-ID: <200805201447.m4KEloHu027061@sheep.berlios.de>

Author: fabricecolin
Date: 2008-05-20 16:47:50 +0200 (Tue, 20 May 2008)
New Revision: 1265

Modified:
   trunk/UI/GTK2/src/mainWindow.cc
Log:
Synced with recent changes to QueryHistory.
Don't offer suggestions if the current live query term is a filter or a range.


Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2008-05-20 14:45:08 UTC (rev 1264)
+++ trunk/UI/GTK2/src/mainWindow.cc	2008-05-20 14:47:50 UTC (rev 1265)
@@ -291,7 +291,7 @@
 //
 void mainWindow::populate_queryTreeview(const string &selectedQueryName)
 {
-	QueryHistory history(m_settings.getHistoryDatabaseName());
+	QueryHistory queryHistory(m_settings.getHistoryDatabaseName());
 	const std::map<string, QueryProperties> &queries = m_settings.getQueries();
 
 	// Reset the whole tree
@@ -304,18 +304,25 @@
 	{
 		TreeModel::iterator iter = m_refQueryTree->append();
 		TreeModel::Row row = *iter;
-		string queryName = queryIter->first;
-		string lastRun = history.getLastRun(queryName);
+		set<time_t> latestRuns;
+		string queryName(queryIter->first);
+		string lastRun;
 		time_t lastRunTime = 0;
 
 		row[m_queryColumns.m_name] = to_utf8(queryName);
-		if (lastRun.empty() == true)
+		if ((queryHistory.getLatestRuns(queryName, "", 1, latestRuns) == false) ||
+			(latestRuns.empty() == true))
 		{
 			lastRun = _("N/A");
 		}
 		else
 		{
-			lastRunTime = TimeConverter::fromTimestamp(lastRun);
+			lastRunTime = *(latestRuns.begin());
+			lastRun = TimeConverter::toTimestamp(lastRunTime);
+#ifdef DEBUG
+			cout << "mainWindow::populate_queryTreeview: latest run of "
+				<< queryName << " is " << lastRun << "/" << lastRunTime << endl;
+#endif
 		}
 		row[m_queryColumns.m_lastRun] = to_utf8(lastRun);
 		row[m_queryColumns.m_lastRunTime] = lastRunTime;
@@ -2621,11 +2628,13 @@
 		term = liveQuery.substr(pos + 1);
 	}
 
-	// If characters are being deleted or if the term is too short, don't
-	// attempt to offer suggestions
+	// If characters are being deleted, if the term is too short or
+	// if it's a filter or a range, don't offer suggestions
 	if ((m_state.m_liveQueryLength > liveQueryLength) ||
 		(term.empty() == true) ||
-		(m_refLiveQueryCompletion->get_minimum_key_length() > term.length()))
+		(m_refLiveQueryCompletion->get_minimum_key_length() > term.length()) ||
+		(term.find(':') != string::npos) ||
+		(term.find("..") != string::npos))
 	{
 		m_state.m_liveQueryLength = liveQueryLength;
 		return;
@@ -2704,9 +2713,10 @@
 
 		if (m_settings.removeQuery(queryName) == true)
 		{
+			QueryHistory queryHistory(m_settings.getHistoryDatabaseName());
+
 			// Remove records from QueryHistory
-			QueryHistory history(m_settings.getHistoryDatabaseName());
-			history.deleteItems(queryName, true);
+			queryHistory.deleteItems(queryName, true);
 
 			// Select another row
 			queryTreeview->get_selection()->unselect(iter);
@@ -2752,13 +2762,13 @@
 	// Any query selected ?
 	if (queryIter)
 	{
-		QueryHistory history(m_settings.getHistoryDatabaseName());
+		QueryHistory queryHistory(m_settings.getHistoryDatabaseName());
 		TreeModel::Row queryRow = *queryIter;
 		set<string> engineNames;
 		QueryProperties queryProps = queryRow[m_queryColumns.m_properties];
 		ustring queryName(queryRow[m_queryColumns.m_name]);
 
-		if ((history.getEngines(queryName, engineNames) == false) ||
+		if ((queryHistory.getEngines(queryName, engineNames) == false) ||
 			(engineNames.empty() == true))
 		{
 			ustring statusText = _("No history for");
@@ -3079,10 +3089,10 @@
 		ustring newQueryName(queryProps.getName());
 		if (newQueryName != queryName)
 		{
-			QueryHistory history(m_settings.getHistoryDatabaseName());
+			QueryHistory queryHistory(m_settings.getHistoryDatabaseName());
 
 			// Remove records from QueryHistory
-			history.deleteItems(queryName, true);
+			queryHistory.deleteItems(queryName, true);
 		}
 
 		// Update the query properties



From fabricecolin at mail.berlios.de  Wed May 21 16:36:26 2008
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Wed, 21 May 2008 16:36:26 +0200
Subject: [Pinot-svn] r1266 - trunk/IndexSearch/Xapian
Message-ID: <200805211436.m4LEaQGH001351@sheep.berlios.de>

Author: fabricecolin
Date: 2008-05-21 16:36:25 +0200 (Wed, 21 May 2008)
New Revision: 1266

Modified:
   trunk/IndexSearch/Xapian/XapianIndex.cpp
Log:
Skip CJKV terms in getCloseTerms().


Modified: trunk/IndexSearch/Xapian/XapianIndex.cpp
===================================================================
--- trunk/IndexSearch/Xapian/XapianIndex.cpp	2008-05-20 14:47:50 UTC (rev 1265)
+++ trunk/IndexSearch/Xapian/XapianIndex.cpp	2008-05-21 14:36:25 UTC (rev 1266)
@@ -1632,6 +1632,14 @@
 /// Gets terms with the same root.
 unsigned int XapianIndex::getCloseTerms(const string &term, set<string> &suggestions)
 {
+	Dijon::CJKVTokenizer tokenizer;
+
+	// Only offer suggestions for non CJKV terms
+	if (tokenizer.has_cjkv(term) == true)
+	{
+		return 0;
+	}
+
 	XapianDatabase *pDatabase = XapianDatabaseFactory::getDatabase(m_databaseName);
 	if (pDatabase == NULL)
 	{
@@ -1658,12 +1666,9 @@
 				{
 					string suggestedTerm(*termIter);
 
+					// Does this term have the same root ?
 					if (suggestedTerm.find(baseTerm) != 0)
 					{
-						// This term doesn't have the same root
-#ifdef DEBUG
-						cout << "XapianIndex::getCloseTerms: not the same root" << endl;
-#endif
 						break;
 					}
 



From fabricecolin at mail.berlios.de  Wed May 21 16:37:19 2008
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Wed, 21 May 2008 16:37:19 +0200
Subject: [Pinot-svn] r1267 - trunk/IndexSearch
Message-ID: <200805211437.m4LEbJob001827@sheep.berlios.de>

Author: fabricecolin
Date: 2008-05-21 16:37:14 +0200 (Wed, 21 May 2008)
New Revision: 1267

Modified:
   trunk/IndexSearch/QueryProperties.cpp
Log:
We might as well trim spaces off the user-supplied query too.


Modified: trunk/IndexSearch/QueryProperties.cpp
===================================================================
--- trunk/IndexSearch/QueryProperties.cpp	2008-05-21 14:36:25 UTC (rev 1266)
+++ trunk/IndexSearch/QueryProperties.cpp	2008-05-21 14:37:14 UTC (rev 1267)
@@ -188,6 +188,7 @@
 {
 	m_freeQueryWithoutFilters.clear();
 
+	StringManip::trimSpaces(m_freeQuery);
 	if (m_freeQuery.empty() == true)
 	{
 		return;



From fabricecolin at mail.berlios.de  Thu May 22 14:47:19 2008
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Thu, 22 May 2008 14:47:19 +0200
Subject: [Pinot-svn] r1268 - trunk/UI/GTK2/src
Message-ID: <200805221247.m4MClJle015370@sheep.berlios.de>

Author: fabricecolin
Date: 2008-05-22 14:47:17 +0200 (Thu, 22 May 2008)
New Revision: 1268

Modified:
   trunk/UI/GTK2/src/IndexPage.cpp
   trunk/UI/GTK2/src/IndexPage.h
Log:
Disconnect the queries combobox's changed signal before populating it and
reconnect when done.


Modified: trunk/UI/GTK2/src/IndexPage.cpp
===================================================================
--- trunk/UI/GTK2/src/IndexPage.cpp	2008-05-21 14:37:14 UTC (rev 1267)
+++ trunk/UI/GTK2/src/IndexPage.cpp	2008-05-22 12:47:17 UTC (rev 1268)
@@ -106,8 +106,6 @@
 	populateQueryCombobox("");
 
 	// Connect the signals
-	m_pQueryCombobox->signal_changed().connect(
-		sigc::mem_fun(*this, &IndexPage::onQueryChanged));
 	m_pBackButton->signal_clicked().connect(
 		sigc::mem_fun(*this, &IndexPage::onBackClicked));
 	m_pForwardButton->signal_clicked().connect(
@@ -179,7 +177,11 @@
 //
 void IndexPage::populateQueryCombobox(const string &queryName)
 {
-	bool setActive = false;
+	// Disconnect the changed signal
+	if (m_queryChangedConnection.connected() == true)
+	{
+		m_queryChangedConnection.disconnect();
+	}
 
 	m_pQueryCombobox->clear_items();
 
@@ -190,18 +192,19 @@
 		queryIter != queries.end(); ++queryIter)
 	{
 		m_pQueryCombobox->append_text(to_utf8(queryIter->first));
-
-		if ((setActive == false) &&
-			(queryIter->first == queryName))
-		{
-			m_pQueryCombobox->set_active_text(queryName);
-			m_queryName = queryName;
-			setActive = true;
-		}
 	}
 
-	if (setActive == false)
+	// Reconnect the signal
+	m_queryChangedConnection = m_pQueryCombobox->signal_changed().connect(
+		sigc::mem_fun(*this, &IndexPage::onQueryChanged));
+
+	if (queryName.empty() == false)
 	{
+		m_pQueryCombobox->set_active_text(queryName);
+		m_queryName = queryName;
+	}
+	else
+	{
 		m_pQueryCombobox->set_active(0);
 		m_queryName.clear();
 	}

Modified: trunk/UI/GTK2/src/IndexPage.h
===================================================================
--- trunk/UI/GTK2/src/IndexPage.h	2008-05-21 14:37:14 UTC (rev 1267)
+++ trunk/UI/GTK2/src/IndexPage.h	2008-05-22 12:47:17 UTC (rev 1268)
@@ -90,6 +90,7 @@
 		sigc::signal2<void, Glib::ustring, Glib::ustring> m_signalQueryChanged;
 		sigc::signal1<void, Glib::ustring> m_signalBackClicked;
 		sigc::signal1<void, Glib::ustring> m_signalForwardClicked;
+		sigc::connection m_queryChangedConnection;
 
 		void onQueryChanged(void);
 



From fabricecolin at mail.berlios.de  Fri May 23 17:27:38 2008
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Fri, 23 May 2008 17:27:38 +0200
Subject: [Pinot-svn] r1269 - trunk/UI/GTK2/src
Message-ID: <200805231527.m4NFRcuT024547@sheep.berlios.de>

Author: fabricecolin
Date: 2008-05-23 17:27:37 +0200 (Fri, 23 May 2008)
New Revision: 1269

Modified:
   trunk/UI/GTK2/src/Notebook.cpp
   trunk/UI/GTK2/src/Notebook.h
Log:
Use a custom style for tab buttons, as used by gnome-terminal.


Modified: trunk/UI/GTK2/src/Notebook.cpp
===================================================================
--- trunk/UI/GTK2/src/Notebook.cpp	2008-05-22 12:47:17 UTC (rev 1268)
+++ trunk/UI/GTK2/src/Notebook.cpp	2008-05-23 15:27:37 UTC (rev 1269)
@@ -16,6 +16,12 @@
  *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
  */
 
+#if _USE_BUTTON_TAB
+#include <gtkmm/rc.h>
+#endif
+
+#include "config.h"
+#include "NLS.h"
 #include "Notebook.h"
 #include "PinotUtils.h"
 
@@ -86,6 +92,8 @@
 	return m_pTree;
 }
 
+bool NotebookTabBox::m_initialized = false;
+
 NotebookTabBox::NotebookTabBox(const Glib::ustring &title, NotebookPageBox::PageType type) :
 	HBox(),
 	m_title(title),
@@ -98,6 +106,23 @@
 	m_tabEventBox(NULL)
 #endif
 {
+	if (m_initialized == false)
+	{
+		m_initialized = true;
+
+#if _USE_BUTTON_TAB
+		// This was lifted from gnome-terminal's terminal-window.c
+		RC::parse_string("style \"pinot-tab-close-button-style\"\n"
+			"{\n"
+			"GtkWidget::focus-padding = 0\n"
+			"GtkWidget::focus-line-width = 0\n"
+			"xthickness = 0\n"
+			"ythickness = 0\n"
+			"}\n"
+			"widget \"*.pinot-tab-close-button\" style \"pinot-tab-close-button-style\"");
+#endif
+	}
+
 	m_tabLabel = manage(new Label(title));
 	m_tabImage = manage(new Image(StockID("gtk-close"), IconSize(ICON_SIZE_MENU)));
 #if _USE_BUTTON_TAB
@@ -117,6 +142,8 @@
 #if _USE_BUTTON_TAB
 	m_tabButton->set_relief(RELIEF_NONE);
 	m_tabButton->set_border_width(0);
+	m_tabButton->set_name("pinot-tab-close-button");
+	m_tabButton->set_tooltip_text(_("Close"));
 	m_tabButton->set_alignment(0, 0);
 	m_tabButton->add(*m_tabImage);
 #else

Modified: trunk/UI/GTK2/src/Notebook.h
===================================================================
--- trunk/UI/GTK2/src/Notebook.h	2008-05-22 12:47:17 UTC (rev 1268)
+++ trunk/UI/GTK2/src/Notebook.h	2008-05-23 15:27:37 UTC (rev 1269)
@@ -25,6 +25,7 @@
 #include <gtkmm/paned.h>
 #include <gtkmm/label.h>
 #include <gtkmm/image.h>
+#define _USE_BUTTON_TAB 1
 #if _USE_BUTTON_TAB
 #include <gtkmm/button.h>
 #else
@@ -83,6 +84,7 @@
 		sigc::signal2<void, Glib::ustring, NotebookPageBox::PageType>& getCloseSignal(void);
 
 	protected:
+		static bool m_initialized;
 		Glib::ustring m_title;
 		NotebookPageBox::PageType m_pageType;
 		Gtk::Label *m_tabLabel;



From fabricecolin at mail.berlios.de  Fri May 23 17:31:02 2008
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Fri, 23 May 2008 17:31:02 +0200
Subject: [Pinot-svn] r1270 - in trunk: SQL UI/GTK2/src
Message-ID: <200805231531.m4NFV2hm024955@sheep.berlios.de>

Author: fabricecolin
Date: 2008-05-23 17:31:01 +0200 (Fri, 23 May 2008)
New Revision: 1270

Modified:
   trunk/SQL/QueryHistory.cpp
   trunk/SQL/QueryHistory.h
   trunk/UI/GTK2/src/ResultsTree.cpp
Log:
We are actually interested in the date results are found and stored.


Modified: trunk/SQL/QueryHistory.cpp
===================================================================
--- trunk/SQL/QueryHistory.cpp	2008-05-23 15:27:37 UTC (rev 1269)
+++ trunk/SQL/QueryHistory.cpp	2008-05-23 15:31:01 UTC (rev 1270)
@@ -83,8 +83,7 @@
 
 /// Inserts an URL.
 bool QueryHistory::insertItem(const string &queryName, const string &engineName,
-	const string &url, const string &title, const string &extract,
-	float score, const string &date)
+	const string &url, const string &title, const string &extract, float score)
 {
 	Url urlObj(url);
 	string hostName(urlObj.getHost());
@@ -94,7 +93,7 @@
 		VALUES('%q', '%q', '%q', '%q', '%q', '%q', '%f', '%d');",
 		queryName.c_str(), engineName.c_str(), hostName.c_str(),
 		Url::escapeUrl(url).c_str(), title.c_str(), extract.c_str(),
-		score, TimeConverter::fromTimestamp(date));
+		score, time(NULL));
 	if (results != NULL)
 	{
 		success = true;
@@ -177,8 +176,9 @@
 	bool success = false;
 
 	SQLResults *results = executeStatement("SELECT Title, Url, Extract, Score, Date \
-		FROM QueryHistory WHERE QueryName='%q' AND EngineName='%q' ORDER BY Date, Score DESC \
-		LIMIT %u;", queryName.c_str(), engineName.c_str(), max);
+		FROM QueryHistory WHERE QueryName='%q' AND EngineName='%q' \
+		ORDER BY Date DESC, Score DESC LIMIT %u;",
+		queryName.c_str(), engineName.c_str(), max);
 	if (results != NULL)
 	{
 		while (results->hasMoreRows() == true)

Modified: trunk/SQL/QueryHistory.h
===================================================================
--- trunk/SQL/QueryHistory.h	2008-05-23 15:27:37 UTC (rev 1269)
+++ trunk/SQL/QueryHistory.h	2008-05-23 15:31:01 UTC (rev 1270)
@@ -38,8 +38,7 @@
 
 		/// Inserts an URL.
 		bool insertItem(const std::string &queryName, const std::string &engineName,
-			const std::string &url, const std::string &title, const std::string &extract,
-			float score, const std::string &date);
+			const std::string &url, const std::string &title, const std::string &extract, float score);
 
 		/**
 		  * Checks if an URL is in the query's history.

Modified: trunk/UI/GTK2/src/ResultsTree.cpp
===================================================================
--- trunk/UI/GTK2/src/ResultsTree.cpp	2008-05-23 15:27:37 UTC (rev 1269)
+++ trunk/UI/GTK2/src/ResultsTree.cpp	2008-05-23 15:31:01 UTC (rev 1270)
@@ -587,7 +587,7 @@
 			if (updateHistory == true)
 			{
 				queryHistory.insertItem(m_treeName, engineName, location,
-					title, extract, currentScore, resultIter->getTimestamp());
+					title, extract, currentScore);
 			}
 		}
 



From fabricecolin at mail.berlios.de  Wed May 28 16:26:26 2008
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Wed, 28 May 2008 16:26:26 +0200
Subject: [Pinot-svn] r1271 - trunk/Collect
Message-ID: <200805281426.m4SEQQsu017764@sheep.berlios.de>

Author: fabricecolin
Date: 2008-05-28 16:26:25 +0200 (Wed, 28 May 2008)
New Revision: 1271

Modified:
   trunk/Collect/CurlDownloader.cpp
   trunk/Collect/DownloaderInterface.cpp
   trunk/Collect/DownloaderInterface.h
   trunk/Collect/NeonDownloader.cpp
Log:
Both Neon and CurlDownloader look for a Last-Modified header and use that as
the document's timestamp.
In DownloaderInterface, the timeout is in seconds.


Modified: trunk/Collect/CurlDownloader.cpp
===================================================================
--- trunk/Collect/CurlDownloader.cpp	2008-05-23 15:31:01 UTC (rev 1270)
+++ trunk/Collect/CurlDownloader.cpp	2008-05-28 14:26:25 UTC (rev 1271)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2005,2006 Fabrice Colin
+ *  Copyright 2005-2008 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
@@ -34,6 +34,7 @@
 {
 	char *m_pContent;
 	size_t m_contentLen;
+	string m_lastModified;
 };
 
 size_t writeCallback(void *pData, size_t dataSize, size_t elementsCount, void *pStream)
@@ -43,13 +44,10 @@
 
 	if (pStream == NULL)
 	{
-#ifdef DEBUG
-		cout << "writeCallback: no stream" << endl;
-#endif
 		return 0;
 	}
+	pInfo = (ContentInfo *)pStream;
 
-	pInfo = (ContentInfo *)pStream;
 	char *pNewContent = (char*)realloc(pInfo->m_pContent, pInfo->m_contentLen + totalSize + 1);
 	if (pNewContent == NULL)
 	{
@@ -84,6 +82,33 @@
 	return totalSize;
 }
 
+size_t headerCallback(void *pData, size_t dataSize, size_t elementsCount, void *pStream)
+{
+	ContentInfo *pInfo = NULL;
+	size_t totalSize = elementsCount * dataSize;
+
+	if ((pStream == NULL) ||
+		(pData == NULL) ||
+		(totalSize == 0))
+	{
+		return 0;
+	}
+	pInfo = (ContentInfo *)pStream;
+
+	string header((const char*)pData, totalSize);
+	string::size_type pos = header.find("Last-Modified: ");
+
+	if (pos != string::npos)
+	{
+		pInfo->m_lastModified = header.substr(15);
+#ifdef DEBUG
+		cout << "headerCallback: Last-Modified " << pInfo->m_lastModified << endl;
+#endif
+	}
+
+	return totalSize;
+}
+
 unsigned int CurlDownloader::m_initialized = 0;
 
 CurlDownloader::CurlDownloader() :
@@ -187,6 +212,8 @@
 #endif
 		curl_easy_setopt(pCurlHandler, CURLOPT_WRITEFUNCTION, writeCallback);
 		curl_easy_setopt(pCurlHandler, CURLOPT_WRITEDATA, pContentInfo);
+		curl_easy_setopt(pCurlHandler, CURLOPT_HEADERFUNCTION, headerCallback);
+		curl_easy_setopt(pCurlHandler, CURLOPT_HEADERDATA, pContentInfo);
 #ifdef DEBUG
 		cout << "CurlDownloader::retrieveUrl: URL is " << url << endl;
 #endif
@@ -237,11 +264,20 @@
 					pDocument->setType(pContentType);
 				}
 
+				// The Last-Modified date ?
+				if (pContentInfo->m_lastModified.empty() == false)
+				{
+					pDocument->setTimestamp(pContentInfo->m_lastModified);
+				}
+			}
 #ifdef DEBUG
-				cout << "CurlDownloader::retrieveUrl: document size is " << pContentInfo->m_contentLen << endl;
+			else cout << "CurlDownloader::retrieveUrl: no content for " << url << endl;
 #endif
-			}
 		}
+		else
+		{
+			cerr << "Couldn't download " << url << ": " << curl_easy_strerror(res) << endl;
+		}
 
 		if (pContentInfo->m_pContent != NULL)
 		{

Modified: trunk/Collect/DownloaderInterface.cpp
===================================================================
--- trunk/Collect/DownloaderInterface.cpp	2008-05-23 15:31:01 UTC (rev 1270)
+++ trunk/Collect/DownloaderInterface.cpp	2008-05-28 14:26:25 UTC (rev 1271)
@@ -118,7 +118,7 @@
 }
 
 /// Sets timeout.
-void DownloaderInterface::setTimeout(unsigned int milliseconds)
+void DownloaderInterface::setTimeout(unsigned int seconds)
 {
-	m_timeout = milliseconds;
+	m_timeout = seconds;
 }

Modified: trunk/Collect/DownloaderInterface.h
===================================================================
--- trunk/Collect/DownloaderInterface.h	2008-05-23 15:31:01 UTC (rev 1270)
+++ trunk/Collect/DownloaderInterface.h	2008-05-28 14:26:25 UTC (rev 1271)
@@ -45,7 +45,7 @@
 		virtual bool setSetting(const std::string &name, const std::string &value);
 
 		/// Sets timeout.
-		virtual void setTimeout(unsigned int milliseconds);
+		virtual void setTimeout(unsigned int seconds);
 
 		/// Retrieves the specified document; NULL if error. Caller deletes.
 		virtual Document *retrieveUrl(const DocumentInfo &docInfo) = 0;

Modified: trunk/Collect/NeonDownloader.cpp
===================================================================
--- trunk/Collect/NeonDownloader.cpp	2008-05-23 15:31:01 UTC (rev 1270)
+++ trunk/Collect/NeonDownloader.cpp	2008-05-28 14:26:25 UTC (rev 1271)
@@ -1,5 +1,5 @@
 /*
- *  Copyright 2005,2006 Fabrice Colin
+ *  Copyright 2005-2008 Fabrice Colin
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
@@ -158,13 +158,12 @@
 		return NULL;
 	}
 	Url urlObj(url);
-	string protocol = urlObj.getProtocol();
-	string hostName = urlObj.getHost();
-	string location = urlObj.getLocation();
-	string file = urlObj.getFile();
-	string parameters = urlObj.getParameters();
-	string locationHeaderValue;
-	string contentTypeHeaderValue;
+	string protocol(urlObj.getProtocol());
+	string hostName(urlObj.getHost());
+	string location(urlObj.getLocation());
+	string file(urlObj.getFile());
+	string parameters(urlObj.getParameters());
+	string lastModifiedHeaderValue, locationHeaderValue, contentTypeHeaderValue;
 
 	// Create a session
 	ne_session *pSession = ne_session_create(protocol.c_str(), hostName.c_str(), 80); // urlObj.getPort());
@@ -223,6 +222,7 @@
 	int requestStatus = NE_RETRY;
 	while (requestStatus == NE_RETRY)
 	{
+		lastModifiedHeaderValue.clear();
 		locationHeaderValue.clear();
 		contentTypeHeaderValue.clear();
 
@@ -263,6 +263,11 @@
 			const char *pValue = ne_get_response_header(pRequest, "Last-Modified");
 			if (pValue != NULL)
 			{
+				lastModifiedHeaderValue = pValue;
+			}
+			pValue = ne_get_response_header(pRequest, "Location");
+			if (pValue != NULL)
+			{
 				locationHeaderValue = pValue;
 			}
 			pValue = ne_get_response_header(pRequest, "Content-Type");
@@ -372,6 +377,10 @@
 			pDocument->setData(pContent, contentLen);
 			pDocument->setLocation(url);
 			pDocument->setType(contentTypeHeaderValue);
+			if (lastModifiedHeaderValue.empty() == false)
+			{
+				pDocument->setTimestamp(lastModifiedHeaderValue);
+			}
 #ifdef DEBUG
 			cout << "NeonDownloader::retrieveUrl: document size is " << contentLen << endl;
 #endif
@@ -385,3 +394,4 @@
 
 	return pDocument;
 }
+



From fabricecolin at mail.berlios.de  Wed May 28 16:28:35 2008
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Wed, 28 May 2008 16:28:35 +0200
Subject: [Pinot-svn] r1272 - trunk/IndexSearch
Message-ID: <200805281428.m4SESZIf018162@sheep.berlios.de>

Author: fabricecolin
Date: 2008-05-28 16:28:35 +0200 (Wed, 28 May 2008)
New Revision: 1272

Modified:
   trunk/IndexSearch/PluginWebEngine.cpp
Log:
In DEBUG mode, prefix the name of the file output is saved to with the engine's
hostname.


Modified: trunk/IndexSearch/PluginWebEngine.cpp
===================================================================
--- trunk/IndexSearch/PluginWebEngine.cpp	2008-05-28 14:26:25 UTC (rev 1271)
+++ trunk/IndexSearch/PluginWebEngine.cpp	2008-05-28 14:28:35 UTC (rev 1272)
@@ -24,6 +24,7 @@
 #include "config.h"
 #include "Document.h"
 #include "StringManip.h"
+#include "Url.h"
 #include "OpenSearchParser.h"
 #ifdef HAVE_BOOST_SPIRIT
 #include "SherlockParser.h"
@@ -96,7 +97,10 @@
 		return false;
 	}
 #ifdef DEBUG
-	ofstream pageBackup("PluginWebEngine.html");
+	Url urlObj(formattedQuery);
+	string fileName(urlObj.getHost() + "_PluginWebEngine.html");
+
+	ofstream pageBackup(fileName.c_str());
 	pageBackup.write(pContent, contentLen);
 	pageBackup.close();
 #endif



