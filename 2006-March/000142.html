<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Pinot-svn] r143 - in trunk/UI/GTK2: . src
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/pinot-svn/2006-March/index.html" >
   <LINK REL="made" HREF="mailto:pinot-svn%40lists.berlios.de?Subject=Re%3A%20%5BPinot-svn%5D%20r143%20-%20in%20trunk/UI/GTK2%3A%20.%20src&In-Reply-To=%3C200603081410.k28EAFkH016063%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000141.html">
   <LINK REL="Next"  HREF="000143.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Pinot-svn] r143 - in trunk/UI/GTK2: . src</H1>
    <B>fabricecolin at BerliOS</B> 
    <A HREF="mailto:pinot-svn%40lists.berlios.de?Subject=Re%3A%20%5BPinot-svn%5D%20r143%20-%20in%20trunk/UI/GTK2%3A%20.%20src&In-Reply-To=%3C200603081410.k28EAFkH016063%40sheep.berlios.de%3E"
       TITLE="[Pinot-svn] r143 - in trunk/UI/GTK2: . src">fabricecolin at berlios.de
       </A><BR>
    <I>Wed Mar  8 15:10:15 CET 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000141.html">[Pinot-svn] r142 - trunk/Tokenize
</A></li>
        <LI>Next message: <A HREF="000143.html">[Pinot-svn] r144 - trunk
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#142">[ date ]</a>
              <a href="thread.html#142">[ thread ]</a>
              <a href="subject.html#142">[ subject ]</a>
              <a href="author.html#142">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: fabricecolin
Date: 2006-03-08 15:09:45 +0100 (Wed, 08 Mar 2006)
New Revision: 143

Modified:
   trunk/UI/GTK2/metase-gtk2.glade
   trunk/UI/GTK2/src/IndexPage.cpp
   trunk/UI/GTK2/src/ModelColumns.cpp
   trunk/UI/GTK2/src/ModelColumns.h
   trunk/UI/GTK2/src/PinotSettings.cpp
   trunk/UI/GTK2/src/PinotSettings.h
   trunk/UI/GTK2/src/WorkerThreads.cpp
   trunk/UI/GTK2/src/WorkerThreads.h
   trunk/UI/GTK2/src/importDialog.cc
   trunk/UI/GTK2/src/mainWindow.cc
   trunk/UI/GTK2/src/mainWindow.hh
   trunk/UI/GTK2/src/prefsDialog.cc
   trunk/UI/GTK2/src/prefsDialog.hh
   trunk/UI/GTK2/src/prefsDialog_glade.cc
   trunk/UI/GTK2/src/prefsDialog_glade.hh
   trunk/UI/GTK2/src/propertiesDialog.cc
   trunk/UI/GTK2/src/queryDialog.cc
   trunk/UI/GTK2/src/queryDialog.hh
Log:
Labels no longer have a colour.
In mainWindow, don't use the ThreadsManager lock to protect lists, this may
lead to deadlocks.


Modified: trunk/UI/GTK2/metase-gtk2.glade
===================================================================
--- trunk/UI/GTK2/metase-gtk2.glade	2006-03-08 13:14:24 UTC (rev 142)
+++ trunk/UI/GTK2/metase-gtk2.glade	2006-03-08 14:09:45 UTC (rev 143)
@@ -1384,83 +1384,6 @@
 		      &lt;/child&gt;
 
 		      &lt;child&gt;
-			&lt;widget class=&quot;GtkButton&quot; id=&quot;editLabelButton&quot;&gt;
-			  &lt;property name=&quot;border_width&quot;&gt;4&lt;/property&gt;
-			  &lt;property agent=&quot;glademm&quot; name=&quot;cxx_visibility&quot;&gt;protected&lt;/property&gt;
-			  &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-			  &lt;property name=&quot;can_default&quot;&gt;True&lt;/property&gt;
-			  &lt;property name=&quot;can_focus&quot;&gt;True&lt;/property&gt;
-			  &lt;property name=&quot;relief&quot;&gt;GTK_RELIEF_NORMAL&lt;/property&gt;
-			  &lt;property name=&quot;focus_on_click&quot;&gt;True&lt;/property&gt;
-			  &lt;signal name=&quot;clicked&quot; handler=&quot;on_editLabelButton_clicked&quot; last_modification_time=&quot;Wed, 28 Apr 2004 17:31:45 GMT&quot;/&gt;
-
-			  &lt;child&gt;
-			    &lt;widget class=&quot;GtkAlignment&quot; id=&quot;alignment19&quot;&gt;
-			      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-			      &lt;property name=&quot;xalign&quot;&gt;0.5&lt;/property&gt;
-			      &lt;property name=&quot;yalign&quot;&gt;0.5&lt;/property&gt;
-			      &lt;property name=&quot;xscale&quot;&gt;0&lt;/property&gt;
-			      &lt;property name=&quot;yscale&quot;&gt;0&lt;/property&gt;
-			      &lt;property name=&quot;top_padding&quot;&gt;0&lt;/property&gt;
-			      &lt;property name=&quot;bottom_padding&quot;&gt;0&lt;/property&gt;
-			      &lt;property name=&quot;left_padding&quot;&gt;0&lt;/property&gt;
-			      &lt;property name=&quot;right_padding&quot;&gt;0&lt;/property&gt;
-
-			      &lt;child&gt;
-				&lt;widget class=&quot;GtkHBox&quot; id=&quot;hbox31&quot;&gt;
-				  &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-				  &lt;property name=&quot;homogeneous&quot;&gt;False&lt;/property&gt;
-				  &lt;property name=&quot;spacing&quot;&gt;2&lt;/property&gt;
-
-				  &lt;child&gt;
-				    &lt;widget class=&quot;GtkImage&quot; id=&quot;image237&quot;&gt;
-				      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-				      &lt;property name=&quot;stock&quot;&gt;gtk-select-color&lt;/property&gt;
-				      &lt;property name=&quot;icon_size&quot;&gt;4&lt;/property&gt;
-				      &lt;property name=&quot;xalign&quot;&gt;0.5&lt;/property&gt;
-				      &lt;property name=&quot;yalign&quot;&gt;0.5&lt;/property&gt;
-				      &lt;property name=&quot;xpad&quot;&gt;0&lt;/property&gt;
-				      &lt;property name=&quot;ypad&quot;&gt;0&lt;/property&gt;
-				    &lt;/widget&gt;
-				    &lt;packing&gt;
-				      &lt;property name=&quot;padding&quot;&gt;0&lt;/property&gt;
-				      &lt;property name=&quot;expand&quot;&gt;False&lt;/property&gt;
-				      &lt;property name=&quot;fill&quot;&gt;False&lt;/property&gt;
-				    &lt;/packing&gt;
-				  &lt;/child&gt;
-
-				  &lt;child&gt;
-				    &lt;widget class=&quot;GtkLabel&quot; id=&quot;label37&quot;&gt;
-				      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-				      &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;Edit&lt;/property&gt;
-				      &lt;property name=&quot;use_underline&quot;&gt;True&lt;/property&gt;
-				      &lt;property name=&quot;use_markup&quot;&gt;False&lt;/property&gt;
-				      &lt;property name=&quot;justify&quot;&gt;GTK_JUSTIFY_LEFT&lt;/property&gt;
-				      &lt;property name=&quot;wrap&quot;&gt;False&lt;/property&gt;
-				      &lt;property name=&quot;selectable&quot;&gt;False&lt;/property&gt;
-				      &lt;property name=&quot;xalign&quot;&gt;0.5&lt;/property&gt;
-				      &lt;property name=&quot;yalign&quot;&gt;0.5&lt;/property&gt;
-				      &lt;property name=&quot;xpad&quot;&gt;0&lt;/property&gt;
-				      &lt;property name=&quot;ypad&quot;&gt;0&lt;/property&gt;
-				      &lt;property name=&quot;ellipsize&quot;&gt;PANGO_ELLIPSIZE_NONE&lt;/property&gt;
-				      &lt;property name=&quot;width_chars&quot;&gt;-1&lt;/property&gt;
-				      &lt;property name=&quot;single_line_mode&quot;&gt;False&lt;/property&gt;
-				      &lt;property name=&quot;angle&quot;&gt;0&lt;/property&gt;
-				    &lt;/widget&gt;
-				    &lt;packing&gt;
-				      &lt;property name=&quot;padding&quot;&gt;0&lt;/property&gt;
-				      &lt;property name=&quot;expand&quot;&gt;False&lt;/property&gt;
-				      &lt;property name=&quot;fill&quot;&gt;False&lt;/property&gt;
-				    &lt;/packing&gt;
-				  &lt;/child&gt;
-				&lt;/widget&gt;
-			      &lt;/child&gt;
-			    &lt;/widget&gt;
-			  &lt;/child&gt;
-			&lt;/widget&gt;
-		      &lt;/child&gt;
-
-		      &lt;child&gt;
 			&lt;widget class=&quot;GtkButton&quot; id=&quot;removeLabelButton&quot;&gt;
 			  &lt;property name=&quot;border_width&quot;&gt;4&lt;/property&gt;
 			  &lt;property agent=&quot;glademm&quot; name=&quot;cxx_visibility&quot;&gt;protected&lt;/property&gt;

Modified: trunk/UI/GTK2/src/IndexPage.cpp
===================================================================
--- trunk/UI/GTK2/src/IndexPage.cpp	2006-03-08 13:14:24 UTC (rev 142)
+++ trunk/UI/GTK2/src/IndexPage.cpp	2006-03-08 14:09:45 UTC (rev 143)
@@ -155,7 +155,7 @@
 #ifdef DEBUG
 		cout &lt;&lt; &quot;IndexPage::onLabelChanged: current label now &quot; &lt;&lt; m_labelName &lt;&lt; endl;
 #endif
-		if (m_labelName == _(&quot;None&quot;))
+		if (m_labelName == _(&quot;All labels&quot;))
 		{
 			m_labelName.clear();
 		}
@@ -201,12 +201,13 @@
 
 	iter = m_refLabelNameTree-&gt;append();
 	row = *iter;
-	row[m_labelNameColumns.m_name] = _(&quot;None&quot;);
+	row[m_labelNameColumns.m_name] = _(&quot;All labels&quot;);
 
-	for (set&lt;PinotSettings::Label&gt;::const_iterator labelIter = m_settings.m_labels.begin();
-		labelIter != m_settings.m_labels.end(); ++labelIter)
+	const set&lt;string&gt; &amp;labels = m_settings.getLabels();
+	for (set&lt;string&gt;::const_iterator labelIter = labels.begin();
+		labelIter != labels.end(); ++labelIter)
 	{
-		string labelName(labelIter-&gt;m_name);
+		string labelName(*labelIter);
 
 		iter = m_refLabelNameTree-&gt;append();
 		row = *iter;

Modified: trunk/UI/GTK2/src/ModelColumns.cpp
===================================================================
--- trunk/UI/GTK2/src/ModelColumns.cpp	2006-03-08 13:14:24 UTC (rev 142)
+++ trunk/UI/GTK2/src/ModelColumns.cpp	2006-03-08 14:09:45 UTC (rev 143)
@@ -101,7 +101,6 @@
 	add(m_enabled);
 	add(m_name);
 	add(m_oldName);
-	add(m_colour);
 }
 
 LabelModelColumns::~LabelModelColumns()

Modified: trunk/UI/GTK2/src/ModelColumns.h
===================================================================
--- trunk/UI/GTK2/src/ModelColumns.h	2006-03-08 13:14:24 UTC (rev 142)
+++ trunk/UI/GTK2/src/ModelColumns.h	2006-03-08 14:09:45 UTC (rev 143)
@@ -20,7 +20,6 @@
 #include &lt;time.h&gt;
 #include &lt;glibmm/refptr.h&gt;
 #include &lt;glibmm/ustring.h&gt;
-#include &lt;gdkmm/color.h&gt;
 #include &lt;gdkmm/event.h&gt;
 #include &lt;gtkmm/treemodel.h&gt;
 #include &lt;gtkmm/treemodelcolumn.h&gt;
@@ -132,7 +131,6 @@
 	Gtk::TreeModelColumn&lt;bool&gt; m_enabled;
 	Gtk::TreeModelColumn&lt;Glib::ustring&gt; m_name;
 	Gtk::TreeModelColumn&lt;Glib::ustring&gt; m_oldName;
-	Gtk::TreeModelColumn&lt;Gdk::Color&gt; m_colour;
 
 };
 

Modified: trunk/UI/GTK2/src/PinotSettings.cpp
===================================================================
--- trunk/UI/GTK2/src/PinotSettings.cpp	2006-03-08 13:14:24 UTC (rev 142)
+++ trunk/UI/GTK2/src/PinotSettings.cpp	2006-03-08 14:09:45 UTC (rev 143)
@@ -201,12 +201,9 @@
 	// Add default labels on the first run
 	if (m_firstRun == true)
 	{
-		ustring labelName =_(&quot;Red&quot;);
-		m_labels.insert(Label(labelName, 65535, 0, 0));
-		labelName =_(&quot;Blue&quot;);
-		m_labels.insert(Label(labelName, 0, 65535, 0));
-		labelName =_(&quot;Green&quot;);
-		m_labels.insert(Label(labelName, 0, 0, 65535));
+		m_labels.insert(_(&quot;Important&quot;));
+		m_labels.insert(_(&quot;New&quot;));
+		m_labels.insert(_(&quot;Personal&quot;));
 	}
 
 	// Some search engines are hardcoded
@@ -593,8 +590,6 @@
 		return false;
 	}
 
-	Label label;
-
 	// Load the label's properties
 	for (Node::NodeList::iterator iter = childNodes.begin(); iter != childNodes.end(); ++iter)
 	{
@@ -610,27 +605,11 @@
 
 		if (nodeName == &quot;name&quot;)
 		{
-			label.m_name = nodeContent;
+			m_labels.insert(nodeContent);
 		}
-		else if (nodeName == &quot;red&quot;)
-		{
-			label.m_red = (unsigned short)atoi(nodeContent.c_str());
-		}
-		else if (nodeName == &quot;green&quot;)
-		{
-			label.m_green = (unsigned short)atoi(nodeContent.c_str());
-		}
-		else if (nodeName == &quot;blue&quot;)
-		{
-			label.m_blue = (unsigned short)atoi(nodeContent.c_str());
-		}
+		// Labels used to have colours...
 	}
 
-	if (label.m_name.empty() == false)
-	{
-		m_labels.insert(label);
-	}
-
 	return true;
 }
 
@@ -828,20 +807,14 @@
 	addChildElement(pElem, &quot;viewmode&quot;, (m_browseResults ? &quot;BROWSE&quot; : &quot;SOURCE&quot;));
 	addChildElement(pElem, &quot;browser&quot;, m_browserCommand);
 	// Labels
-	for (set&lt;Label&gt;::iterator labelIter = m_labels.begin(); labelIter != m_labels.end(); ++labelIter)
+	for (set&lt;string&gt;::iterator labelIter = m_labels.begin(); labelIter != m_labels.end(); ++labelIter)
 	{
 		pElem = pRootElem-&gt;add_child(&quot;label&quot;);
 		if (pElem == NULL)
 		{
 			return false;
 		}
-		addChildElement(pElem, &quot;name&quot;, labelIter-&gt;m_name);
-		sprintf(numStr, &quot;%u&quot;, labelIter-&gt;m_red);
-		addChildElement(pElem, &quot;red&quot;, numStr);
-		sprintf(numStr, &quot;%u&quot;, labelIter-&gt;m_green);
-		addChildElement(pElem, &quot;green&quot;, numStr);
-		sprintf(numStr, &quot;%u&quot;, labelIter-&gt;m_blue);
-		addChildElement(pElem, &quot;blue&quot;, numStr);
+		addChildElement(pElem, &quot;name&quot;, *labelIter);
 	}
 	// Ignore robots directives
 	addChildElement(pRootElem, &quot;robots&quot;, (m_ignoreRobotsDirectives ? &quot;IGNORE&quot; : &quot;OBEY&quot;));
@@ -1107,63 +1080,51 @@
 	m_queries.clear();
 }
 
-PinotSettings::Engine::Engine()
+/// Returns the labels list.
+const set&lt;string&gt; &amp;PinotSettings::getLabels(void) const
 {
+	return m_labels;
 }
 
-PinotSettings::Engine::Engine(string name, string type, string option, string channel)
+/// Adds a new label.
+bool PinotSettings::addLabel(const string &amp;name)
 {
-	m_name = name;
-	m_type = type;
-	m_option = option;
-	m_channel = channel;
+	m_labels.insert(name);
 }
 
-PinotSettings::Engine::~Engine()
+/// Removes a label.
+bool PinotSettings::removeLabel(const string &amp;name)
 {
-}
-
-bool PinotSettings::Engine::operator&lt;(const PinotSettings::Engine &amp;other) const
-{
-	if (m_name &lt; other.m_name)
+	set&lt;string&gt;::iterator labelIter = m_labels.find(name);
+	if (labelIter != m_labels.end())
 	{
-		return true;
+		m_labels.erase(labelIter);
 	}
-
-	return false;
 }
 
-bool PinotSettings::Engine::operator==(const Engine &amp;other) const
+/// Clears the labels list.
+void PinotSettings::clearLabels(void)
 {
-	if (m_name == other.m_name)
-	{
-		return true;
-	}
-
-	return false;
+	m_labels.clear();
 }
 
-PinotSettings::Label::Label() :
-	m_red(0),
-	m_green(0),
-	m_blue(0)
+PinotSettings::Engine::Engine()
 {
 }
 
-PinotSettings::Label::Label(ustring &amp;name, unsigned short red,
-	unsigned short green, unsigned short blue) :
-	m_name(name),
-	m_red(red),
-	m_green(blue),
-	m_blue(green)
+PinotSettings::Engine::Engine(string name, string type, string option, string channel)
 {
+	m_name = name;
+	m_type = type;
+	m_option = option;
+	m_channel = channel;
 }
 
-PinotSettings::Label::~Label()
+PinotSettings::Engine::~Engine()
 {
 }
 
-bool PinotSettings::Label::operator&lt;(const PinotSettings::Label &amp;other) const
+bool PinotSettings::Engine::operator&lt;(const PinotSettings::Engine &amp;other) const
 {
 	if (m_name &lt; other.m_name)
 	{
@@ -1173,7 +1134,7 @@
 	return false;
 }
 
-bool PinotSettings::Label::operator==(const Label &amp;other) const
+bool PinotSettings::Engine::operator==(const Engine &amp;other) const
 {
 	if (m_name == other.m_name)
 	{

Modified: trunk/UI/GTK2/src/PinotSettings.h
===================================================================
--- trunk/UI/GTK2/src/PinotSettings.h	2006-03-08 13:14:24 UTC (rev 142)
+++ trunk/UI/GTK2/src/PinotSettings.h	2006-03-08 14:09:45 UTC (rev 143)
@@ -107,23 +107,18 @@
 		/// Clears the queries map.
 		void clearQueries(void);
 
-		class Label
-		{
-			public:
-				Label();
-				Label(Glib::ustring &amp;name, unsigned short red,
-					unsigned short green, unsigned short blue);
-				~Label();
+		/// Returns the labels list.
+		const std::set&lt;std::string&gt; &amp;getLabels(void) const;
 
-				bool operator&lt;(const Label &amp;other) const;
-				bool operator==(const Label &amp;other) const;
+		/// Adds a new label.
+		bool addLabel(const std::string &amp;name);
 
-				Glib::ustring m_name;
-				unsigned short m_red;
-				unsigned short m_green;
-				unsigned short m_blue;
-		};
+		/// Removes a label.
+		bool removeLabel(const std::string &amp;name);
 
+		/// Clears the labels list.
+		void clearLabels(void);
+
 		class MailAccount
 		{
 			public:
@@ -152,7 +147,6 @@
 		int m_width;
 		int m_height;
 		int m_panePos;
-		std::set&lt;Label&gt; m_labels;
 		bool m_ignoreRobotsDirectives;
 		std::set&lt;MailAccount&gt; m_mailAccounts;
 
@@ -165,6 +159,7 @@
 		std::map&lt;unsigned int, std::string&gt; m_engineIds;
 		std::set&lt;std::string&gt; m_engineChannels;
 		std::map&lt;std::string, QueryProperties&gt; m_queries;
+		std::set&lt;std::string&gt; m_labels;
 
 		PinotSettings();
 		bool loadConfiguration(const std::string &amp;fileName);

Modified: trunk/UI/GTK2/src/WorkerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.cpp	2006-03-08 13:14:24 UTC (rev 142)
+++ trunk/UI/GTK2/src/WorkerThreads.cpp	2006-03-08 14:09:45 UTC (rev 143)
@@ -177,26 +177,20 @@
 	pthread_rwlock_destroy(&amp;m_rwLock);
 }
 
-bool ThreadsManager::read_lock(unsigned int where)
+bool ThreadsManager::read_lock(void)
 {
 	if (pthread_rwlock_rdlock(&amp;m_rwLock) == 0)
 	{
-#ifdef DEBUG
-		cout &lt;&lt; &quot;ThreadsManager::read_lock &quot; &lt;&lt; where &lt;&lt; endl;
-#endif
 		return true;
 	}
 
 	return false;
 }
 
-bool ThreadsManager::write_lock(unsigned int where)
+bool ThreadsManager::write_lock(void)
 {
 	if (pthread_rwlock_wrlock(&amp;m_rwLock) == 0)
 	{
-#ifdef DEBUG
-		cout &lt;&lt; &quot;ThreadsManager::write_lock &quot; &lt;&lt; where &lt;&lt; endl;
-#endif
 		return true;
 	}
 
@@ -205,9 +199,6 @@
 
 void ThreadsManager::unlock(void)
 {
-#ifdef DEBUG
-	cout &lt;&lt; &quot;ThreadsManager::unlock&quot; &lt;&lt; endl;
-#endif
 	pthread_rwlock_unlock(&amp;m_rwLock);
 }
 
@@ -216,7 +207,7 @@
 	WorkerThread *pWorkerThread = NULL;
 
 	// Get the first thread that's finished
-	if (read_lock(1) == true)
+	if (read_lock() == true)
 	{
 		for (map&lt;WorkerThread *, Thread *&gt;::iterator threadIter = m_threads.begin();
 			threadIter != m_threads.end(); ++threadIter)
@@ -276,7 +267,7 @@
 	}
 
 	// Insert
-	if (write_lock(2) == true)
+	if (write_lock() == true)
 	{
 		m_threads[pWorkerThread] = pThread;
 
@@ -291,7 +282,7 @@
 {
 	int count = 0;
 
-	if (read_lock(3) == true)
+	if (read_lock() == true)
 	{
 		count = m_threads.size() - m_backgroundThreadsCount;
 
@@ -320,7 +311,7 @@
 {
 	if (m_threads.empty() == false)
 	{
-		if (read_lock(4) == true)
+		if (read_lock() == true)
 		{
 			for_each(m_threads.begin(), m_threads.end(), DeleteMapPointer());
 			m_threads.clear();

Modified: trunk/UI/GTK2/src/WorkerThreads.h
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.h	2006-03-08 13:14:24 UTC (rev 142)
+++ trunk/UI/GTK2/src/WorkerThreads.h	2006-03-08 14:09:45 UTC (rev 143)
@@ -93,10 +93,6 @@
 		ThreadsManager();
 		virtual ~ThreadsManager();
 
-		bool read_lock(unsigned int where);
-		bool write_lock(unsigned int where);
-		void unlock(void);
-
 		bool start_thread(WorkerThread *pWorkerThread, bool inBackground);
 
 		WorkerThread *on_thread_end(void);
@@ -117,6 +113,10 @@
 		unsigned int m_nextId;
 		unsigned int m_backgroundThreadsCount;
 
+		bool read_lock(void);
+		bool write_lock(void);
+		void unlock(void);
+
 	private:
 		ThreadsManager(const ThreadsManager &amp;other);
 		ThreadsManager &amp;operator=(const ThreadsManager &amp;other);

Modified: trunk/UI/GTK2/src/importDialog.cc
===================================================================
--- trunk/UI/GTK2/src/importDialog.cc	2006-03-08 13:14:24 UTC (rev 142)
+++ trunk/UI/GTK2/src/importDialog.cc	2006-03-08 14:09:45 UTC (rev 143)
@@ -148,10 +148,11 @@
 	row[m_labelNameColumns.m_name] = _(&quot;None&quot;);
 	labelNameCombobox-&gt;set_active(0);
 	// Add all labels
-	for (set&lt;PinotSettings::Label&gt;::const_iterator labelIter = PinotSettings::getInstance().m_labels.begin();
-		labelIter != PinotSettings::getInstance().m_labels.end(); ++labelIter)
+	const set&lt;string&gt; &amp;labels = PinotSettings::getInstance().getLabels();
+	for (set&lt;string&gt;::const_iterator labelIter = labels.begin();
+		labelIter != labels.end(); ++labelIter)
 	{
-		string labelName = labelIter-&gt;m_name;
+		string labelName(*labelIter);
 
 		iter = m_refLabelNameTree-&gt;append();
 		row = *iter;

Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2006-03-08 13:14:24 UTC (rev 142)
+++ trunk/UI/GTK2/src/mainWindow.cc	2006-03-08 14:09:45 UTC (rev 143)
@@ -70,12 +70,48 @@
 	m_browsingIndex(false),
 	m_pMainWindow(pWindow)
 {
+	pthread_rwlock_init(&amp;m_listsLock, NULL);
 }
 
 mainWindow::InternalState::~InternalState()
 {
+	pthread_rwlock_destroy(&amp;m_listsLock);
 }
 
+bool mainWindow::InternalState::read_lock_lists(unsigned int where)
+{
+	if (pthread_rwlock_rdlock(&amp;m_listsLock) == 0)
+	{
+#ifdef DEBUG
+		cout &lt;&lt; &quot;mainWindow::read_lock_lists: &quot; &lt;&lt; where &lt;&lt; endl;
+#endif
+		return true;
+	}
+
+	return false;
+}
+
+bool mainWindow::InternalState::write_lock_lists(unsigned int where)
+{
+	if (pthread_rwlock_wrlock(&amp;m_listsLock) == 0)
+	{
+#ifdef DEBUG
+		cout &lt;&lt; &quot;mainWindow::write_lock_lists: &quot; &lt;&lt; where &lt;&lt; endl;
+#endif
+		return true;
+	}
+
+	return false;
+}
+
+void mainWindow::InternalState::unlock_lists(void)
+{
+	pthread_rwlock_unlock(&amp;m_listsLock);
+#ifdef DEBUG
+	cout &lt;&lt; &quot;mainWindow::unlock_lists&quot; &lt;&lt; endl;
+#endif
+}
+
 void mainWindow::InternalState::connect(void)
 {
 	if (m_pMainWindow != NULL)
@@ -590,7 +626,7 @@
 			SigC::slot(*this, &amp;mainWindow::on_indexForwardButton_clicked));
 
 		// Append the page
-		if (m_state.write_lock(1) == true)
+		if (m_state.write_lock_lists(1) == true)
 		{
 			int pageNum = m_pNotebook-&gt;append_page(*pIndexPage, *pTab);
 			m_pNotebook-&gt;pages().back().set_tab_label_packing(false, true, Gtk::PACK_START);
@@ -599,7 +635,7 @@
 				foundPage = true;
 			}
 
-			m_state.unlock();
+			m_state.unlock_lists();
 		}
 	}
 
@@ -697,12 +733,12 @@
 				pPage-&gt;hide();
 			}
 		}
-		else if (m_state.write_lock(2) == true)
+		else if (m_state.write_lock_lists(2) == true)
 		{
 			// Remove the page
 			m_pNotebook-&gt;remove_page(pageNum);
 
-			m_state.unlock();
+			m_state.unlock_lists();
 		}
 	}
 }
@@ -856,12 +892,12 @@
 				SigC::slot(*this, &amp;mainWindow::on_resultsTreeviewSelection_changed));
 
 			// Append the page
-			if (m_state.write_lock(3) == true)
+			if (m_state.write_lock_lists(3) == true)
 			{
 				pageNum = m_pNotebook-&gt;append_page(*pResultsPage, *pTab);
 				m_pNotebook-&gt;pages().back().set_tab_label_packing(false, true, Gtk::PACK_START);
 
-				m_state.unlock();
+				m_state.unlock_lists();
 			}
 		}
 
@@ -1002,7 +1038,7 @@
 			status += to_utf8(url);
 
 			// Update the in-progress list
-			if (m_state.write_lock(4) == true)
+			if (m_state.write_lock_lists(4) == true)
 			{
 				set&lt;string&gt;::iterator urlIter = m_state.m_beingIndexed.find(url);
 				if (urlIter != m_state.m_beingIndexed.end())
@@ -1010,7 +1046,7 @@
 					m_state.m_beingIndexed.erase(urlIter);
 				}
 
-				m_state.unlock();
+				m_state.unlock_lists();
 			}
 
 			if (pIndexPage != NULL)
@@ -1268,7 +1304,7 @@
 	// FIXME: if mail accounts are configured, make sure the MonitorThread
 	// is running and knows about the new accounts
 
-	if (m_state.read_lock(5) == true)
+	if (m_state.read_lock_lists(5) == true)
 	{
 		for (int pageNum = 0; pageNum &lt; m_pNotebook-&gt;get_n_pages(); ++pageNum)
 		{
@@ -1286,7 +1322,7 @@
 			}
 		}
 
-		m_state.unlock();
+		m_state.unlock_lists();
 	}
 
 	// Do the changes affect the View tab ?
@@ -2394,7 +2430,7 @@
 {
 	NotebookPageBox *pNotebookPage = NULL;
 
-	if (m_state.read_lock(6) == true)
+	if (m_state.read_lock_lists(6) == true)
 	{
 		Widget *pPage = m_pNotebook-&gt;get_nth_page(m_pNotebook-&gt;get_current_page());
 		if (pPage != NULL)
@@ -2402,7 +2438,7 @@
 			pNotebookPage = dynamic_cast&lt;NotebookPageBox*&gt;(pPage);
 		}
 
-		m_state.unlock();
+		m_state.unlock_lists();
 	}
 
 	return pNotebookPage;
@@ -2415,7 +2451,7 @@
 {
 	NotebookPageBox *pNotebookPage = NULL;
 
-	if (m_state.read_lock(7) == true)
+	if (m_state.read_lock_lists(7) == true)
 	{
 		for (int pageNum = 0; pageNum &lt; m_pNotebook-&gt;get_n_pages(); ++pageNum)
 		{
@@ -2439,7 +2475,7 @@
 			}
 		}
 
-		m_state.unlock();
+		m_state.unlock_lists();
 	}
 
 	return pNotebookPage;
@@ -2452,7 +2488,7 @@
 {
 	int pageNumber = -1;
 
-	if (m_state.read_lock(8) == true)
+	if (m_state.read_lock_lists(8) == true)
 	{
 		for (int pageNum = 0; pageNum &lt; m_pNotebook-&gt;get_n_pages(); ++pageNum)
 		{
@@ -2476,7 +2512,7 @@
 			}
 		}
 
-		m_state.unlock();
+		m_state.unlock_lists();
 	}
 
 	return pageNumber;
@@ -2490,11 +2526,11 @@
 {
 	if (m_state.get_threads_count() &gt;= m_maxThreads)
 	{
-		if (m_state.write_lock(9) == true)
+		if (m_state.write_lock_lists(9) == true)
 		{
 			m_state.m_indexQueue[docInfo] = labelName;
 
-			m_state.unlock();
+			m_state.unlock_lists();
 		}
 
 		return true;
@@ -2791,7 +2827,7 @@
 			docId = index.hasDocument(url);
 		}
 		if ((docId == 0) &amp;&amp;
-			(m_state.write_lock(10) == true))
+			(m_state.write_lock_lists(10) == true))
 		{
 			if (m_state.m_beingIndexed.find(url) == m_state.m_beingIndexed.end())
 			{
@@ -2799,7 +2835,7 @@
 				isNewDocument = true;
 			}
 
-			m_state.unlock();
+			m_state.unlock_lists();
 		}
 
 		if (isNewDocument == true)
@@ -2904,12 +2940,12 @@
 				pViewPage = manage(new ViewPage(viewName, m_pHtmlView, m_settings));
 
 				// Append the page
-				if (m_state.write_lock(11) == true)
+				if (m_state.write_lock_lists(11) == true)
 				{
 					pageNum = m_pNotebook-&gt;append_page(*pViewPage, *pTab);
 					m_pNotebook-&gt;pages().back().set_tab_label_packing(false, true, Gtk::PACK_START);
 
-					m_state.unlock();
+					m_state.unlock_lists();
 				}
 			}
 
@@ -2983,7 +3019,7 @@
 	DocumentInfo docInfo;
 	string labelName;
 
-	if (m_state.write_lock(12) == true)
+	if (m_state.write_lock_lists(12) == true)
 	{
 		if (m_state.m_indexQueue.empty() == false)
 		{
@@ -2998,7 +3034,7 @@
 			}
 		}
 
-		m_state.unlock();
+		m_state.unlock_lists();
 	}
 
 	string location = docInfo.getLocation();

Modified: trunk/UI/GTK2/src/mainWindow.hh
===================================================================
--- trunk/UI/GTK2/src/mainWindow.hh	2006-03-08 13:14:24 UTC (rev 142)
+++ trunk/UI/GTK2/src/mainWindow.hh	2006-03-08 14:09:45 UTC (rev 143)
@@ -168,6 +168,9 @@
 			InternalState(mainWindow *pWindow);
 			~InternalState();
 
+			bool read_lock_lists(unsigned int where);
+			bool write_lock_lists(unsigned int where);
+			void unlock_lists(void);
 			void connect(void);
 
 			// Query
@@ -181,6 +184,7 @@
 			std::map&lt;DocumentInfo, string&gt; m_indexQueue;
 
 		protected:
+			pthread_rwlock_t m_listsLock;
 			mainWindow *m_pMainWindow;
 
 	} m_state;

Modified: trunk/UI/GTK2/src/prefsDialog.cc
===================================================================
--- trunk/UI/GTK2/src/prefsDialog.cc	2006-03-08 13:14:24 UTC (rev 142)
+++ trunk/UI/GTK2/src/prefsDialog.cc	2006-03-08 14:09:45 UTC (rev 143)
@@ -131,40 +131,36 @@
 	TreeModel::iterator iter;
 	TreeModel::Row row;
 
-	if (m_settings.m_labels.empty() == true)
+	const set&lt;string&gt; &amp;labels = m_settings.getLabels();
+	if (labels.empty() == true)
 	{
 		// These buttons will stay disabled until labels are added to the list
-		editLabelButton-&gt;set_sensitive(false);
 		removeLabelButton-&gt;set_sensitive(false);
 		return;
 	}
 
 	// Populate the tree
-	for (set&lt;PinotSettings::Label&gt;::iterator labelIter = m_settings.m_labels.begin();
-		labelIter != m_settings.m_labels.end();
+	for (set&lt;string&gt;::const_iterator labelIter = labels.begin();
+		labelIter != labels.end();
 		++labelIter)
 	{
 		// Create a new row
 		iter = m_refLabelsTree-&gt;append();
 		row = *iter;
-		// Set its name and colour
-		row[m_labelsColumns.m_name] = labelIter-&gt;m_name;
-		row[m_labelsColumns.m_oldName] = labelIter-&gt;m_name;
-		Color labelColour;
-		labelColour.set_rgb(labelIter-&gt;m_red, labelIter-&gt;m_green, labelIter-&gt;m_blue);
-		row[m_labelsColumns.m_colour] = labelColour;
+		// Set its name
+		row[m_labelsColumns.m_name] = *labelIter;
+		row[m_labelsColumns.m_oldName] = *labelIter;
 		// This allows to differentiate existing labels from new labels the user may create
 		row[m_labelsColumns.m_enabled] = true;
 	}
 
-	editLabelButton-&gt;set_sensitive(true);
 	removeLabelButton-&gt;set_sensitive(true);
 }
 
 bool prefsDialog::save_labelsTreeview()
 {
 	// Clear the current settings
-	m_settings.m_labels.clear();
+	m_settings.clearLabels();
 
 	// Go through the labels tree
 	TreeModel::Children children = m_refLabelsTree-&gt;children();
@@ -176,31 +172,26 @@
 			TreeModel::Row row = *iter;
 
 			// Add this new label to the settings
-			PinotSettings::Label label;
-			label.m_name = row[m_labelsColumns.m_name];
+			ustring labelName = row[m_labelsColumns.m_name];
 			ustring oldName = row[m_labelsColumns.m_oldName];
 			// Was this label renamed ?
 			if ((row[m_labelsColumns.m_enabled] == true) &amp;&amp;
-				(label.m_name != oldName))
+				(labelName != oldName))
 			{
 				// Yes, it was
-				m_renamedLabels[from_utf8(oldName)] = from_utf8(label.m_name);
+				m_renamedLabels[from_utf8(oldName)] = from_utf8(labelName);
 			}
 			// Check user didn't recreate this label after having deleted it
-			set&lt;string&gt;::iterator labelIter = m_deletedLabels.find(from_utf8(label.m_name));
+			set&lt;string&gt;::iterator labelIter = m_deletedLabels.find(from_utf8(labelName));
 			if (labelIter != m_deletedLabels.end())
 			{
 				m_deletedLabels.erase(labelIter);
 			}
 
-			Color labelColour = row[m_labelsColumns.m_colour];
-			label.m_red = labelColour.get_red();
-			label.m_green = labelColour.get_green();
-			label.m_blue = labelColour.get_blue();
 #ifdef DEBUG
-			cout &lt;&lt; &quot;prefsDialog::save_labelsTreeview: &quot; &lt;&lt; label.m_name &lt;&lt; endl;
+			cout &lt;&lt; &quot;prefsDialog::save_labelsTreeview: &quot; &lt;&lt; labelName &lt;&lt; endl;
 #endif
-			m_settings.m_labels.insert(label);
+			m_settings.addLabel(labelName);
 		}
 	}
 
@@ -343,51 +334,11 @@
 	row[m_labelsColumns.m_name] = to_utf8(_(&quot;New Label&quot;));
 	// This marks the label as new
 	row[m_labelsColumns.m_enabled] = false;
-	// FIXME: initialize the colour to something meaningful, depending on the current theme perhaps ?
-	Color labelColour;
-	labelColour.set_rgb(0, 0, 0);
-	row[m_labelsColumns.m_colour] = labelColour;
 
 	// Enable these buttons
-	editLabelButton-&gt;set_sensitive(true);
 	removeLabelButton-&gt;set_sensitive(true);
 }
 
-void prefsDialog::on_editLabelButton_clicked()
-{
-	// Get the selected label in the list
-	TreeModel::iterator iter = labelsTreeview-&gt;get_selection()-&gt;get_selected();
-	if (iter)
-	{
-		TreeModel::Row row = *iter;
-		ustring dialogTitle = row[m_labelsColumns.m_name];
-		dialogTitle += &quot; &quot;;
-		dialogTitle += _(&quot;Colour&quot;);
-		Color labelColour = row[m_labelsColumns.m_colour];
-
-		ColorSelectionDialog colorSelector(dialogTitle);
-		ColorSelection *colorSel = colorSelector.get_colorsel();
-		if (colorSel != NULL)
-		{
-			colorSel-&gt;set_has_opacity_control(false);
-			colorSel-&gt;set_current_color(labelColour);
-		}
-		colorSelector.set_transient_for(*this);
-		colorSelector.show();
-		int result = colorSelector.run();
-		if (result == RESPONSE_OK)
-		{
-			// Retrieve the chosen colour
-			labelColour = colorSel-&gt;get_current_color();
-#ifdef DEBUG
-			cout &lt;&lt; &quot;prefsDialog::on_editLabelButton_clicked: selected &quot; &lt;&lt; labelColour.get_red() &lt;&lt; &quot; &quot; &lt;&lt; labelColour.get_green() &lt;&lt; &quot; &quot; &lt;&lt; labelColour.get_blue() &lt;&lt; endl;
-#endif
-
-			row[m_labelsColumns.m_colour] = labelColour;
-		}
-	}
-}
-
 void prefsDialog::on_removeLabelButton_clicked()
 {
 	// Get the selected label in the list
@@ -409,7 +360,6 @@
 		if (children.empty() == true)
 		{
 			// Disable these buttons
-			editLabelButton-&gt;set_sensitive(false);
 			removeLabelButton-&gt;set_sensitive(false);
 		}
 	}

Modified: trunk/UI/GTK2/src/prefsDialog.hh
===================================================================
--- trunk/UI/GTK2/src/prefsDialog.hh	2006-03-08 13:14:24 UTC (rev 142)
+++ trunk/UI/GTK2/src/prefsDialog.hh	2006-03-08 14:09:45 UTC (rev 143)
@@ -45,7 +45,6 @@
 	virtual void on_viewCombobox_changed();
 	virtual void on_browserButton_clicked();
 	virtual void on_addLabelButton_clicked();
-	virtual void on_editLabelButton_clicked();
 	virtual void on_removeLabelButton_clicked();
 	virtual bool on_mailTreeview_button_press_event(GdkEventButton *ev);
 	virtual void on_addAccountButton_clicked();

Modified: trunk/UI/GTK2/src/prefsDialog_glade.cc
===================================================================
--- trunk/UI/GTK2/src/prefsDialog_glade.cc	2006-03-08 13:14:24 UTC (rev 142)
+++ trunk/UI/GTK2/src/prefsDialog_glade.cc	2006-03-08 14:09:45 UTC (rev 143)
@@ -1,4 +1,4 @@
-// generated 2006/1/5 9:17:18 SGT by <A HREF="https://lists.berlios.de/mailman/listinfo/pinot-svn">fabrice at thorgrim.dyndns.org.</A>(none)
+// generated 2006/3/7 21:04:59 SGT by <A HREF="https://lists.berlios.de/mailman/listinfo/pinot-svn">fabrice at amra.dyndns.org.</A>(none)
 // using glademm V2.6.0
 //
 // DO NOT EDIT THIS FILE ! It was created using
@@ -82,12 +82,6 @@
    Gtk::Alignment *alignment17 = Gtk::manage(new class Gtk::Alignment(0.5, 0.5, 0, 0));
    addLabelButton = Gtk::manage(new class Gtk::Button());
    
-   Gtk::Image *image237 = Gtk::manage(new class Gtk::Image(Gtk::StockID(&quot;gtk-select-color&quot;), Gtk::IconSize(4)));
-   Gtk::Label *label37 = Gtk::manage(new class Gtk::Label(_(&quot;Edit&quot;)));
-   Gtk::HBox *hbox31 = Gtk::manage(new class Gtk::HBox(false, 2));
-   Gtk::Alignment *alignment19 = Gtk::manage(new class Gtk::Alignment(0.5, 0.5, 0, 0));
-   editLabelButton = Gtk::manage(new class Gtk::Button());
-   
    Gtk::Image *image236 = Gtk::manage(new class Gtk::Image(Gtk::StockID(&quot;gtk-remove&quot;), Gtk::IconSize(4)));
    Gtk::Label *label36 = Gtk::manage(new class Gtk::Label(_(&quot;Remove&quot;)));
    Gtk::HBox *hbox30 = Gtk::manage(new class Gtk::HBox(false, 2));
@@ -216,22 +210,6 @@
    addLabelButton-&gt;set_border_width(4);
    addLabelButton-&gt;set_relief(Gtk::RELIEF_NORMAL);
    addLabelButton-&gt;add(*alignment17);
-   image237-&gt;set_alignment(0.5,0.5);
-   image237-&gt;set_padding(0,0);
-   label37-&gt;set_alignment(0.5,0.5);
-   label37-&gt;set_padding(0,0);
-   label37-&gt;set_justify(Gtk::JUSTIFY_LEFT);
-   label37-&gt;set_line_wrap(false);
-   label37-&gt;set_use_markup(false);
-   label37-&gt;set_selectable(false);
-   hbox31-&gt;pack_start(*image237, Gtk::PACK_SHRINK, 0);
-   hbox31-&gt;pack_start(*label37, Gtk::PACK_SHRINK, 0);
-   alignment19-&gt;add(*hbox31);
-   editLabelButton-&gt;set_flags(Gtk::CAN_FOCUS);
-   editLabelButton-&gt;set_flags(Gtk::CAN_DEFAULT);
-   editLabelButton-&gt;set_border_width(4);
-   editLabelButton-&gt;set_relief(Gtk::RELIEF_NORMAL);
-   editLabelButton-&gt;add(*alignment19);
    image236-&gt;set_alignment(0.5,0.5);
    image236-&gt;set_padding(0,0);
    label36-&gt;set_alignment(0.5,0.5);
@@ -249,7 +227,6 @@
    removeLabelButton-&gt;set_relief(Gtk::RELIEF_NORMAL);
    removeLabelButton-&gt;add(*alignment18);
    labelsVbuttonbox-&gt;pack_start(*addLabelButton);
-   labelsVbuttonbox-&gt;pack_start(*editLabelButton);
    labelsVbuttonbox-&gt;pack_start(*removeLabelButton);
    labelsHbox-&gt;pack_start(*labelsScrolledwindow);
    labelsHbox-&gt;pack_start(*labelsVbuttonbox, Gtk::PACK_SHRINK, 0);
@@ -359,11 +336,6 @@
    hbox29-&gt;show();
    alignment17-&gt;show();
    addLabelButton-&gt;show();
-   image237-&gt;show();
-   label37-&gt;show();
-   hbox31-&gt;show();
-   alignment19-&gt;show();
-   editLabelButton-&gt;show();
    image236-&gt;show();
    label36-&gt;show();
    hbox30-&gt;show();
@@ -393,7 +365,6 @@
    viewCombobox-&gt;signal_changed().connect(SigC::slot(*this, &amp;prefsDialog_glade::on_viewCombobox_changed), false);
    browserButton-&gt;signal_clicked().connect(SigC::slot(*this, &amp;prefsDialog_glade::on_browserButton_clicked), false);
    addLabelButton-&gt;signal_clicked().connect(SigC::slot(*this, &amp;prefsDialog_glade::on_addLabelButton_clicked), false);
-   editLabelButton-&gt;signal_clicked().connect(SigC::slot(*this, &amp;prefsDialog_glade::on_editLabelButton_clicked), false);
    removeLabelButton-&gt;signal_clicked().connect(SigC::slot(*this, &amp;prefsDialog_glade::on_removeLabelButton_clicked), false);
    mailTreeview-&gt;signal_button_press_event().connect(SigC::slot(*this, &amp;prefsDialog_glade::on_mailTreeview_button_press_event), false);
    addAccountButton-&gt;signal_clicked().connect(SigC::slot(*this, &amp;prefsDialog_glade::on_addAccountButton_clicked), false);

Modified: trunk/UI/GTK2/src/prefsDialog_glade.hh
===================================================================
--- trunk/UI/GTK2/src/prefsDialog_glade.hh	2006-03-08 13:14:24 UTC (rev 142)
+++ trunk/UI/GTK2/src/prefsDialog_glade.hh	2006-03-08 14:09:45 UTC (rev 143)
@@ -1,4 +1,4 @@
-// generated 2005/11/29 20:59:00 SGT by <A HREF="https://lists.berlios.de/mailman/listinfo/pinot-svn">fabrice at amra.dyndns.org.</A>(none)
+// generated 2006/3/7 21:04:59 SGT by <A HREF="https://lists.berlios.de/mailman/listinfo/pinot-svn">fabrice at amra.dyndns.org.</A>(none)
 // using glademm V2.6.0
 //
 // DO NOT EDIT THIS FILE ! It was created using
@@ -57,7 +57,6 @@
         class Gtk::Button * browserButton;
         class Gtk::TreeView * labelsTreeview;
         class Gtk::Button * addLabelButton;
-        class Gtk::Button * editLabelButton;
         class Gtk::Button * removeLabelButton;
         class Gtk::TreeView * mailTreeview;
         class Gtk::Button * addAccountButton;
@@ -73,7 +72,6 @@
         virtual void on_viewCombobox_changed() = 0;
         virtual void on_browserButton_clicked() = 0;
         virtual void on_addLabelButton_clicked() = 0;
-        virtual void on_editLabelButton_clicked() = 0;
         virtual void on_removeLabelButton_clicked() = 0;
         virtual bool on_mailTreeview_button_press_event(GdkEventButton *ev) = 0;
         virtual void on_addAccountButton_clicked() = 0;

Modified: trunk/UI/GTK2/src/propertiesDialog.cc
===================================================================
--- trunk/UI/GTK2/src/propertiesDialog.cc	2006-03-08 13:14:24 UTC (rev 142)
+++ trunk/UI/GTK2/src/propertiesDialog.cc	2006-03-08 14:09:45 UTC (rev 143)
@@ -79,15 +79,16 @@
 	TreeModel::Row row;
 
 	// Populate the tree
-	const set&lt;PinotSettings::Label&gt; &amp;sysLabels = PinotSettings::getInstance().m_labels;
-	for (set&lt;PinotSettings::Label&gt;::const_iterator labelIter = sysLabels.begin(); labelIter != sysLabels.end(); ++labelIter)
+	const set&lt;string&gt; &amp;sysLabels = PinotSettings::getInstance().getLabels();
+	for (set&lt;string&gt;::const_iterator labelIter = sysLabels.begin(); labelIter != sysLabels.end(); ++labelIter)
 	{
+		string labelName(*labelIter);
+
 		// Create a new row
 		iter = m_refLabelsTree-&gt;append();
 		row = *iter;
 
-		row[m_labelsColumns.m_name] = labelIter-&gt;m_name;
-		string labelName = from_utf8(labelIter-&gt;m_name);
+		row[m_labelsColumns.m_name] = labelName;
 		// Is it in the document labels list ?
 		set&lt;string&gt;::const_iterator iter = find(docLabels.begin(), docLabels.end(), labelName);
 		if (iter != docLabels.end())

Modified: trunk/UI/GTK2/src/queryDialog.cc
===================================================================
--- trunk/UI/GTK2/src/queryDialog.cc	2006-03-08 13:14:24 UTC (rev 142)
+++ trunk/UI/GTK2/src/queryDialog.cc	2006-03-08 14:09:45 UTC (rev 143)
@@ -33,7 +33,7 @@
 	queryDialog_glade(),
 	m_name(properties.getName()),
 	m_properties(properties),
-	m_labels(PinotSettings::getInstance().m_labels),
+	m_labels(PinotSettings::getInstance().getLabels()),
 	m_badName(true)
 {
 	string name = m_properties.getName();
@@ -97,9 +97,9 @@
 	labelFilterCombobox-&gt;set_active(0);
 
 	// Add all labels to both label combos and select the one defined for the query
-	for (set&lt;PinotSettings::Label&gt;::const_iterator labelIter = m_labels.begin(); labelIter != m_labels.end(); ++labelIter)
+	for (set&lt;string&gt;::const_iterator labelIter = m_labels.begin(); labelIter != m_labels.end(); ++labelIter)
 	{
-		string labelName = labelIter-&gt;m_name;
+		string labelName(*labelIter);
 
 		iter = m_refLabelNameTree-&gt;append();
 		row = *iter;

Modified: trunk/UI/GTK2/src/queryDialog.hh
===================================================================
--- trunk/UI/GTK2/src/queryDialog.hh	2006-03-08 13:14:24 UTC (rev 142)
+++ trunk/UI/GTK2/src/queryDialog.hh	2006-03-08 14:09:45 UTC (rev 143)
@@ -37,7 +37,7 @@
 protected:
 	std::string m_name;
 	QueryProperties&amp; m_properties;
-	const std::set&lt;PinotSettings::Label&gt; &amp;m_labels;
+	const std::set&lt;std::string&gt; &amp;m_labels;
 	ComboModelColumns m_labelNameColumns;
 	Glib::RefPtr&lt;Gtk::ListStore&gt; m_refLabelNameTree;
 	ComboModelColumns m_languageColumns;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000141.html">[Pinot-svn] r142 - trunk/Tokenize
</A></li>
	<LI>Next message: <A HREF="000143.html">[Pinot-svn] r144 - trunk
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#142">[ date ]</a>
              <a href="thread.html#142">[ thread ]</a>
              <a href="subject.html#142">[ subject ]</a>
              <a href="author.html#142">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/pinot-svn">More information about the Pinot-svn
mailing list</a><br>
</body></html>
