From fabricecolin at berlios.de  Fri Mar  3 15:31:15 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Fri, 3 Mar 2006 15:31:15 +0100
Subject: [Pinot-svn] r134 - in trunk: . Index Search
Message-ID: <200603031431.k23EVFvn022203@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-03 15:30:49 +0100 (Fri, 03 Mar 2006)
New Revision: 134

Removed:
   trunk/Index/Summarizer.cpp
   trunk/Index/Summarizer.h
Modified:
   trunk/Index/Makefile.am
   trunk/Index/XapianIndex.cpp
   trunk/Index/XapianIndex.h
   trunk/Makefile.am
   trunk/README
   trunk/Search/AbstractGenerator.cpp
   trunk/Search/AbstractGenerator.h
   trunk/Search/XapianEngine.cpp
   trunk/configure.in
   trunk/pinot.spec.in
Log:
Removed dependency on OTS. Summaries are now built at query time by
AbstractGenerator.


Modified: trunk/Index/Makefile.am
===================================================================
--- trunk/Index/Makefile.am	2006-02-27 15:30:23 UTC (rev 133)
+++ trunk/Index/Makefile.am	2006-03-03 14:30:49 UTC (rev 134)
@@ -3,14 +3,12 @@
 noinst_HEADERS = \
 	IndexInterface.h \
 	LanguageDetector.h \
-	Summarizer.h \
 	XapianIndex.h
 
 noinst_LTLIBRARIES = libIndex.la
 
 libIndex_la_SOURCES = \
 	LanguageDetector.cpp \
-	Summarizer.cpp \
 	XapianIndex.cpp
 
 AM_CXXFLAGS = -I../Utils -I../Tokenize @INDEX_CFLAGS@ 

Deleted: trunk/Index/Summarizer.cpp
===================================================================
--- trunk/Index/Summarizer.cpp	2006-02-27 15:30:23 UTC (rev 133)
+++ trunk/Index/Summarizer.cpp	2006-03-03 14:30:49 UTC (rev 134)
@@ -1,115 +0,0 @@
-/*
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU Library General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
- */
-
-#include <string.h>
-#include <sys/time.h>
-#include <map>
-#include <iostream>
-#include <utility>
-
-#include <ots/libots.h>
-
-#include "Languages.h"
-#include "StringManip.h"
-#include "Timer.h"
-#include "Summarizer.h"
-
-using std::cout;
-using std::cerr;
-using std::endl;
-using std::string;
-using std::map;
-using std::min;
-
-unsigned int Summarizer::m_maxTextSize = 50000;
-unsigned int Summarizer::m_maxSummarySize = 1000;
-
-Summarizer::Summarizer(const std::string &language, unsigned int wordsCount) :
-	m_wordsCount(wordsCount),
-	m_dictionaryCode("en")
-{
-	// Look up the language code
-	m_dictionaryCode = Languages::toCode(language);
-}
-
-Summarizer::~Summarizer()
-{
-}
-
-/// Attempts to summarize the document in wordsCount words.
-string Summarizer::summarize(const char *pText, unsigned int textLen)
-{
-	unsigned char *pSummary = NULL;
-	size_t outputLen = 0;
-
-	if ((pText == NULL) ||
-		(textLen == 0))
-	{
-		return NULL;
-	}
-
-	m_title.clear();
-
-#ifdef DEBUG
-	Timer timer;
-	timer.start();
-	cout << "Summarizer::summarize: starting" << endl;
-#endif
-	// Create a new article
-	OtsArticle *pArticle = ots_new_article();
-	if ((pArticle != NULL) &&
-		(ots_load_xml_dictionary(pArticle, m_dictionaryCode.c_str())))
-	{
-		// OTS may take too long with long documents
-		ots_parse_stream((const unsigned char*)pText,
-			min(textLen, m_maxTextSize), pArticle);
-
-		ots_grade_doc(pArticle);
-		ots_highlight_doc_words(pArticle, m_wordsCount);
-
-		// Summarize
-		pSummary = ots_get_doc_text(pArticle, &outputLen);
-#ifdef DEBUG
-		cout << "Summarizer::summarize: summarized to " << outputLen << " bytes in "
-			<< timer.stop()/1000 << " ms" << endl;
-#endif
-
-		// Get the title before freeing the article
-		if (pArticle->title != NULL)
-		{
-			m_title = pArticle->title;
-		}
-		ots_free_article(pArticle);
-	}
-
-	if (pSummary != NULL)
-	{
-		string sum((const char *)pSummary,
-			min(outputLen, m_maxSummarySize));
-
-		free(pSummary);
-
-		return sum;
-	}
-
-	return "";
-}
-
-/// Gets the document's title, as determined by summarize().
-string Summarizer::getTitle(void) const
-{
-	return m_title;
-}

Deleted: trunk/Index/Summarizer.h
===================================================================
--- trunk/Index/Summarizer.h	2006-02-27 15:30:23 UTC (rev 133)
+++ trunk/Index/Summarizer.h	2006-03-03 14:30:49 UTC (rev 134)
@@ -1,47 +0,0 @@
-/*
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU Library General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
- */
-
-#ifndef _SUMMARIZER_H
-#define _SUMMARIZER_H
-
-#include <string>
-
-class Summarizer
-{
-	public:
-		Summarizer(const std::string &language, unsigned int wordsCount);
-		virtual ~Summarizer();
-
-		/// Attempts to summarize the document in wordsCount words.
-		std::string summarize(const char *pText, unsigned int textLen);
-
-		/// Gets the document's title, as determined by summarize().
-		std::string getTitle(void) const;
-
-	protected:
-		static unsigned int m_maxTextSize;
-		static unsigned int m_maxSummarySize;
-		unsigned int m_wordsCount;
-		std::string m_dictionaryCode;
-		std::string m_title;
-
-	private:
-		Summarizer(const Summarizer &other);
-		Summarizer &operator=(const Summarizer &other);
-
-};
-
-#endif // _SUMMARIZER_H

Modified: trunk/Index/XapianIndex.cpp
===================================================================
--- trunk/Index/XapianIndex.cpp	2006-02-27 15:30:23 UTC (rev 133)
+++ trunk/Index/XapianIndex.cpp	2006-03-03 14:30:49 UTC (rev 134)
@@ -32,7 +32,6 @@
 #include "StringManip.h"
 #include "TimeConverter.h"
 #include "Url.h"
-#include "Summarizer.h"
 #include "LanguageDetector.h"
 #include "XapianDatabaseFactory.h"
 #include "XapianIndex.h"
@@ -164,7 +163,7 @@
 }
 
 bool XapianIndex::prepareDocument(const DocumentInfo &info, Xapian::Document &doc,
-	Xapian::termcount &termPos, const std::string &summary) const
+	Xapian::termcount &termPos) const
 {
 	string title(info.getTitle());
 	string location(info.getLocation());
@@ -209,17 +208,16 @@
 	// Finally, add the language code with prefix L
 	doc.add_term(string("L") + Languages::toCode(m_stemLanguage));
 
-	setDocumentData(doc, info, summary, m_stemLanguage);
+	setDocumentData(doc, info, m_stemLanguage);
 
 	return true;
 }
 
-string XapianIndex::scanDocument(const char *pData, unsigned int dataLength,
+void XapianIndex::scanDocument(const char *pData, unsigned int dataLength,
 	DocumentInfo &info)
 {
 	vector<string> candidates;
 	string language;
-	string summary;
 
 	// Try to determine the document's language
 	LanguageDetector lang;
@@ -253,21 +251,10 @@
 	cout << "XapianIndex::scanDocument: language now " << m_stemLanguage << endl;
 #endif
 
-	// Get a summary of the document
-	if (language.empty() == true)
-	{
-		// Fall back on English
-		language = "english";
-	}
-	Summarizer sum(language, 50);
-	summary = sum.summarize(pData, dataLength);
-
 	// Update the document's properties
 	string title = info.getTitle();
 	if (title.empty() == true)
 	{
-		// Use the title supplied by the summarizer
-		title = sum.getTitle();
 		// Remove heading spaces
 		while (isspace(title[0]))
 		{
@@ -276,11 +263,9 @@
 		info.setTitle(title);
 	}
 	info.setLanguage(m_stemLanguage);
-
-	return summary;
 }
 
-void XapianIndex::setDocumentData(Xapian::Document &doc, const DocumentInfo &info, const string &extract,
+void XapianIndex::setDocumentData(Xapian::Document &doc, const DocumentInfo &info,
 	const string &language) const
 {
 	string title(info.getTitle());
@@ -290,15 +275,8 @@
 	// Set the document data omindex-style
 	string record = "url=";
 	record += info.getLocation();
+	// The sample will be generated at query time
 	record += "\nsample=";
-	// Ignore the extract if it contains any of our field delimiters
-	if (badField(extract) == false)
-	{
-		record += extract;
-	}
-#ifdef DEBUG
-	else cout << "XapianIndex::setDocumentData: bad extract" << endl;
-#endif
 	record += "\ncaption=";
 	if (badField(title) == true)
 	{
@@ -382,7 +360,7 @@
 		docInfo.setTimestamp(pDocument->getTimestamp());
 		docInfo.setLocation(Url::canonicalizeUrl(docInfo.getLocation()));
 
-		string summary = scanDocument(pData, dataLength, docInfo);
+		scanDocument(pData, dataLength, docInfo);
 
 		Xapian::Document doc;
 		Xapian::termcount termPos = 0;
@@ -398,7 +376,7 @@
 		{
 			doc.add_term(limitTermLength(string("XLABEL:") + *labelIter));
 		}
-		if (prepareDocument(docInfo, doc, termPos, summary) == true)
+		if (prepareDocument(docInfo, doc, termPos) == true)
 		{
 			Xapian::WritableDatabase *pIndex = pDatabase->writeLock();
 			if (pIndex != NULL)
@@ -654,7 +632,7 @@
 	docInfo.setTimestamp(pDocument->getTimestamp());
 	docInfo.setLocation(Url::canonicalizeUrl(docInfo.getLocation()));
 
-	string summary = scanDocument(pData, dataLength, docInfo);
+	scanDocument(pData, dataLength, docInfo);
 
 	try
 	{
@@ -674,7 +652,7 @@
 				doc.add_term(limitTermLength(string("XLABEL:") + *labelIter));
 			}
 		}
-		if (prepareDocument(docInfo, doc, termPos, summary) == true)
+		if (prepareDocument(docInfo, doc, termPos) == true)
 		{
 			Xapian::WritableDatabase *pIndex = pDatabase->writeLock();
 			if (pIndex != NULL)
@@ -725,11 +703,10 @@
 
 			// Get the current document data
 			string record = doc.get_data();
-			string extract = StringManip::extractField(record, "sample=", "\n");
 			string language = StringManip::extractField(record, "language=", "");
 
-			// Update the document data with the current extract and language
-			setDocumentData(doc, docInfo, extract, language);
+			// Update the document data with the current language
+			setDocumentData(doc, docInfo, language);
 			pIndex->replace_document(docId, doc);
 			updated = true;
 		}

Modified: trunk/Index/XapianIndex.h
===================================================================
--- trunk/Index/XapianIndex.h	2006-02-27 15:30:23 UTC (rev 133)
+++ trunk/Index/XapianIndex.h	2006-03-03 14:30:49 UTC (rev 134)
@@ -102,13 +102,13 @@
 			const std::string &prefix, Xapian::termcount &termPos, StemmingMode mode) const;
 
 		bool prepareDocument(const DocumentInfo &info, Xapian::Document &doc,
-			Xapian::termcount &termPos, const std::string &summary) const;
+			Xapian::termcount &termPos) const;
 
-		std::string scanDocument(const char *pData, unsigned int dataLength,
+		void scanDocument(const char *pData, unsigned int dataLength,
 			DocumentInfo &info);
 
 		void setDocumentData(Xapian::Document &doc, const DocumentInfo &info,
-			const std::string &extract, const std::string &language) const;
+			const std::string &language) const;
 
 	private:
 		XapianIndex(const XapianIndex &other);

Modified: trunk/Makefile.am
===================================================================
--- trunk/Makefile.am	2006-02-27 15:30:23 UTC (rev 133)
+++ trunk/Makefile.am	2006-03-03 14:30:49 UTC (rev 134)
@@ -1,7 +1,8 @@
 # generated 2005/12/14 20:48:47 SGT by fabrice at amra.dyndns.org.(none)
 # using glademm V2.6.0
 
-SUBDIRS = po Utils Tokenize SQL Collect Search Index UI/RenderHTML UI/GTK2/src
+SUBDIRS = po Utils Tokenize SQL Collect Search \
+	Index UI/RenderHTML UI/GTK2/src
 
 EXTRA_DIST = ChangeLog TODO README mkinstalldirs pinot.spec \
 	Search/Plugins/*src Search/Plugins/*.xml \

Modified: trunk/README
===================================================================
--- trunk/README	2006-02-27 15:30:23 UTC (rev 133)
+++ trunk/README	2006-03-03 14:30:49 UTC (rev 134)
@@ -39,9 +39,6 @@
 
  libxml2						libxml2-devel-2.6.16-3
 
-ots							ots-devel-0.4.2-2
-http://libots.sourceforge.net/
-
 libtextcat						libtextcat-devel-2.2-1
 http://software.wise-guys.nl/libtextcat/
 

Modified: trunk/Search/AbstractGenerator.cpp
===================================================================
--- trunk/Search/AbstractGenerator.cpp	2006-02-27 15:30:23 UTC (rev 133)
+++ trunk/Search/AbstractGenerator.cpp	2006-03-03 14:30:49 UTC (rev 134)
@@ -20,8 +20,6 @@
 #include <iostream>
 #include <utility>
 
-#include <ots/libots.h>
-
 #include "Timer.h"
 #include "AbstractGenerator.h"
 
@@ -32,6 +30,7 @@
 using std::vector;
 using std::map;
 
+unsigned int AbstractGenerator::m_maxSeedTerms = 4;
 unsigned int AbstractGenerator::m_minTermPositions = 10;
 
 AbstractGenerator::PositionWindow::PositionWindow() :
@@ -56,18 +55,18 @@
 }
 
 /// Attempts to generate an abstract of wordsCount words.
-string AbstractGenerator::generateAbstract(const vector<string> &queryTerms,
+string AbstractGenerator::generateAbstract(const vector<string> &seedTerms,
 	Xapian::docid docId)
 {
 	map<Xapian::termpos, PositionWindow> abstractWindows;
 	map<Xapian::termpos, string> wordsBuffer;
 	string summary;
 	Xapian::termpos bestPosition = 0, startPosition =0;
-	unsigned int topTermCount = 0, bestWeight = 0;
+	unsigned int seedTermsCount = 0, bestWeight = 0;
 	bool topTerm = true;
 
 	if ((m_pIndex == NULL) ||
-		(queryTerms.empty() == true))
+		(seedTerms.empty() == true))
 	{
 		return "";
 	}
@@ -76,55 +75,71 @@
 	Timer timer;
 	timer.start();
 #endif
-	for (vector<string>::const_iterator termIter = queryTerms.begin();
-		termIter != queryTerms.end(); ++termIter)
+	for (vector<string>::const_iterator termIter = seedTerms.begin();
+		termIter != seedTerms.end(); ++termIter)
 	{
 		string termName(*termIter);
 
+		if (seedTermsCount >= m_maxSeedTerms)
+		{
+			// Enough terms
+			break;
+		}
+
 #ifdef DEBUG
 		cout << "AbstractGenerator::generateAbstract: term " << termName << endl;
 #endif
-		// Go through that term's position list in the document
-		for (Xapian::PositionIterator positionIter = m_pIndex->positionlist_begin(docId, termName);
-			positionIter != m_pIndex->positionlist_end(docId, termName); ++positionIter)
+		try
 		{
-			Xapian::termpos termPos = *positionIter;
-
-			// Take all the top term's positions into account, and some of 
-			// the other terms' too if the minimum number is not reached
-			if ((topTermCount < m_minTermPositions) ||
-				(topTerm == true))
+			// Go through that term's position list in the document
+			for (Xapian::PositionIterator positionIter = m_pIndex->positionlist_begin(docId, termName);
+				positionIter != m_pIndex->positionlist_end(docId, termName); ++positionIter)
 			{
-				abstractWindows[termPos] = PositionWindow();
-			}
+				Xapian::termpos termPos = *positionIter;
 
-			// Look for other terms close to that position
-			for (map<Xapian::termpos, PositionWindow>::iterator winIter = abstractWindows.begin();
-				winIter != abstractWindows.end(); ++winIter)
-			{
-				// Is this within the number of words we are interested in ?
-				if (winIter->first > termPos)
+				// Take all the top term's positions into account, and some of 
+				// the other terms' too if the minimum number is not reached
+				if ((m_minTermPositions > abstractWindows.size()) ||
+					(topTerm == true))
 				{
-					if (winIter->first - termPos <= m_wordsCount)
-					{
-						++winIter->second.m_backWeight;
-					}
+					abstractWindows[termPos] = PositionWindow();
 				}
-				else
+
+				// Look for other terms close to that position
+				for (map<Xapian::termpos, PositionWindow>::iterator winIter = abstractWindows.begin();
+					winIter != abstractWindows.end(); ++winIter)
 				{
-					if (termPos - winIter->first <= m_wordsCount)
+					// Is this within the number of words we are interested in ?
+					if (winIter->first > termPos)
 					{
-						++winIter->second.m_forwardWeight;
+						if (winIter->first - termPos <= m_wordsCount)
+						{
+							++winIter->second.m_backWeight;
+						}
 					}
+					else
+					{
+						if (termPos - winIter->first <= m_wordsCount)
+						{
+							++winIter->second.m_forwardWeight;
+						}
+					}
 				}
 			}
+
+			topTerm = false;
+			++seedTermsCount;
 		}
+		catch (const Xapian::Error &error)
+		{
+#ifdef DEBUG
+			cout << "AbstractGenerator::generateAbstract: " << error.get_msg() << endl;
+#endif
+		}
 
-		topTerm = false;
-		++topTermCount;
 #ifdef DEBUG
 		cout << "AbstractGenerator::generateAbstract: " << abstractWindows.size()
-			<< " positions, " << topTermCount << " terms" << endl;
+			<< " positions, " << seedTermsCount << " terms" << endl;
 #endif
 	}
 
@@ -175,7 +190,7 @@
 		summary += wordIter->second;
 	}
 #ifdef DEBUG
-	cout << "AbstractGenerator: done in " << timer.stop()/1000 << " ms" << endl;
+	cout << "AbstractGenerator::generateAbstract: summarized document " << docId << " in " << timer.stop()/1000 << " ms" << endl;
 #endif
 
 	return summary;

Modified: trunk/Search/AbstractGenerator.h
===================================================================
--- trunk/Search/AbstractGenerator.h	2006-02-27 15:30:23 UTC (rev 133)
+++ trunk/Search/AbstractGenerator.h	2006-03-03 14:30:49 UTC (rev 134)
@@ -29,10 +29,11 @@
 		virtual ~AbstractGenerator();
 
 		/// Attempts to generate an abstract of wordsCount words.
-		std::string generateAbstract(const std::vector<std::string> &queryTerms,
+		std::string generateAbstract(const std::vector<std::string> &seedTerms,
 			Xapian::docid docId);
 
 	protected:
+		static unsigned int m_maxSeedTerms;
 		static unsigned int m_minTermPositions;
 		const Xapian::Database *m_pIndex;
 		unsigned int m_wordsCount;

Modified: trunk/Search/XapianEngine.cpp
===================================================================
--- trunk/Search/XapianEngine.cpp	2006-02-27 15:30:23 UTC (rev 133)
+++ trunk/Search/XapianEngine.cpp	2006-03-03 14:30:49 UTC (rev 134)
@@ -26,9 +26,11 @@
 #include "Tokenizer.h"
 #include "Url.h"
 #include "XapianDatabaseFactory.h"
+#include "AbstractGenerator.h"
 #include "XapianEngine.h"
 
 using std::string;
+using std::multimap;
 using std::vector;
 using std::stack;
 using std::cout;
@@ -126,49 +128,82 @@
 
 			// Get the top results of the query
 			Xapian::MSet matches = enquire.get_mset(0, m_maxResultsCount);
+			if (matches.empty() == false)
+			{
+				multimap<Xapian::weight, string> queryTerms;
+				vector<string> seedTerms;
+				Xapian::weight maxWeight = matches.get_max_attained();
 
-			// Get the results
+				// Sort query terms by weight
+				for (Xapian::TermIterator termIter = query.get_terms_begin();
+					termIter != query.get_terms_end(); ++termIter)
+				{
+					string termName(*termIter);
+					Xapian::weight termWeight = maxWeight - matches.get_termweight(termName);
+
+					queryTerms.insert(pair<Xapian::weight, string>(termWeight, termName));
 #ifdef DEBUG
-			cout << "XapianEngine::queryDatabase: " << matches.get_matches_estimated() << "/" << m_maxResultsCount << " results found" << endl;
+					cout << "XapianEngine::queryDatabase: term " << termName
+						<< " has weight " << matches.get_termweight(termName) << "/" << maxWeight << endl;
 #endif
-			for (Xapian::MSetIterator mIter = matches.begin(); mIter != matches.end(); ++mIter)
-			{
-				// Get the document data
-				string record = mIter.get_document().get_data();
+				}
 
-				// Get the title
-				string title = StringManip::extractField(record, "caption=", "\n");
-#ifdef DEBUG
-				cout << "XapianEngine::queryDatabase: found omindex title " << title << endl;
-#endif
-				// Get the URL
-				string url = StringManip::extractField(record, "url=", "\n");
-				if (url.empty() == true)
+				for (multimap<Xapian::weight, string>::iterator weightIter = queryTerms.begin();
+					weightIter != queryTerms.end(); ++weightIter)
 				{
-					// Hmmm this shouldn't be empty...
-					// Use this instead, even though the document isn't cached in the index
-					url = buildUrl(m_databaseName, *mIter);
+					seedTerms.push_back(weightIter->second);
 				}
-				else
-				{
+
+				// Get the results
 #ifdef DEBUG
-					cout << "XapianEngine::queryDatabase: found omindex URL " << url << endl;
+				cout << "XapianEngine::queryDatabase: " << matches.get_matches_estimated() << "/" << m_maxResultsCount << " results found" << endl;
 #endif
-					url = Url::canonicalizeUrl(url);
-				}
+				for (Xapian::MSetIterator mIter = matches.begin(); mIter != matches.end(); ++mIter)
+				{
+					Xapian::docid docId = *mIter;
+					Xapian::Document doc(mIter.get_document());
+					string record = doc.get_data();
 
-				// Get the summary and the type
-				string summary = StringManip::extractField(record, "sample=", "\n");
+					// Get the title
+					string title = StringManip::extractField(record, "caption=", "\n");
 #ifdef DEBUG
-				cout << "XapianEngine::queryDatabase: found omindex summary " << summary << endl;
+					cout << "XapianEngine::queryDatabase: found omindex title " << title << endl;
 #endif
-				string type = StringManip::extractField(record, "type=", "\n");
-				// ...and finally the language, if available
-				string language = StringManip::extractField(record, "language=", "\n");
+					// Get the URL
+					string url = StringManip::extractField(record, "url=", "\n");
+					if (url.empty() == true)
+					{
+						// Hmmm this shouldn't be empty...
+						// Use this instead, even though the document isn't cached in the index
+						url = buildUrl(m_databaseName, *mIter);
+					}
+					else
+					{
+#ifdef DEBUG
+						cout << "XapianEngine::queryDatabase: found omindex URL " << url << endl;
+#endif
+						url = Url::canonicalizeUrl(url);
+					}
 
-				// Add this result
-				Result thisResult(url, title, summary, language, (float)mIter.get_percent());
-				m_resultsList.push_back(thisResult);
+					// Get the type
+					string type = StringManip::extractField(record, "type=", "\n");
+					// ...and the language, if available
+					string language = StringManip::extractField(record, "language=", "\n");
+
+					// Finally, get a summary
+					string summary = StringManip::extractField(record, "sample=", "\n");
+					if (summary.empty() == true)
+					{
+						AbstractGenerator abstractGen(pIndex, 50);
+
+						// Generate an abstract based on the query's terms
+						summary = abstractGen.generateAbstract(seedTerms, docId);
+					}
+
+					// Add this result
+					Result thisResult(url, title, summary, language, (float)mIter.get_percent());
+					m_resultsList.push_back(thisResult);
+				}
 			}
 
 			bStatus = true;

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2006-02-27 15:30:23 UTC (rev 133)
+++ trunk/configure.in	2006-03-03 14:30:49 UTC (rev 134)
@@ -75,9 +75,9 @@
 PKG_CHECK_MODULES(XML, libxml++-2.6 >= 2.12 )
 AC_SUBST(XML_CFLAGS)
 AC_SUBST(XML_LIBS)
-PKG_CHECK_MODULES(OTS, libots-1 >= 0.4.2 )
-INDEX_CFLAGS="$XAPIAN_CFLAGS $OTS_CFLAGS"
-INDEX_LIBS="$XAPIAN_LIBS $OTS_LIBS -ltextcat"
+dnl FIXME: check for libtextcat
+INDEX_CFLAGS="$XAPIAN_CFLAGS"
+INDEX_LIBS="$XAPIAN_LIBS -ltextcat"
 AC_SUBST(INDEX_CFLAGS)
 AC_SUBST(INDEX_LIBS)
 PKG_CHECK_MODULES(UI, mozilla-xpcom >= 1.4 mozilla-nss >= 1.4 mozilla-gtkmozembed >= 1.4 gtkmm-2.4 >= 2.6 )
@@ -98,6 +98,6 @@
 AC_CHECK_FUNCS(mmap)
 
 AC_OUTPUT( pinot.spec Makefile Utils/Makefile Tokenize/Makefile SQL/Makefile \
-	po/Makefile.in Collect/Makefile Search/Makefile Index/Makefile \
-	UI/RenderHTML/Makefile UI/GTK2/src/Makefile )
+	po/Makefile.in Collect/Makefile Search/Makefile Search/Google/Makefile \
+	Index/Makefile UI/RenderHTML/Makefile UI/GTK2/src/Makefile )
 

Modified: trunk/pinot.spec.in
===================================================================
--- trunk/pinot.spec.in	2006-02-27 15:30:23 UTC (rev 133)
+++ trunk/pinot.spec.in	2006-03-03 14:30:49 UTC (rev 134)
@@ -11,8 +11,8 @@
 Source: %{name}-%{version}.tar.gz
 URL: http://pinot.berlios.de/
 BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
-Requires: xapian-core-libs >= 0.9.4, neon >= 0.24, gtkmm24 >= 2.6, libxml++ >= 2.12, mozilla >= %{mozilla_ver}, sqlite >= 3.1.2, ots >= 0.4.2, libtextcat >= 2.2, fam >= 2.6.10, gmime >= 2.1, file
-BuildRequires: xapian-core-devel >= 0.9.4, neon-devel >= 0.24, gtkmm24-devel >= 2.6, libxml++-devel >= 2.12, mozilla-devel >= %{mozilla_ver}, sqlite-devel >= 3.1.2, ots-devel >= 0.4.2, libtextcat-devel >= 2.2, fam-devel >= 2.6.10, gmime-devel >= 2.1, file, boost-devel >= 1.32, desktop-file-utils
+Requires: xapian-core-libs >= 0.9.4, neon >= 0.24, gtkmm24 >= 2.6, libxml++ >= 2.12, mozilla >= %{mozilla_ver}, sqlite >= 3.1.2, libtextcat >= 2.2, fam >= 2.6.10, gmime >= 2.1, file
+BuildRequires: xapian-core-devel >= 0.9.4, neon-devel >= 0.24, gtkmm24-devel >= 2.6, libxml++-devel >= 2.12, mozilla-devel >= %{mozilla_ver}, sqlite-devel >= 3.1.2, libtextcat-devel >= 2.2, fam-devel >= 2.6.10, gmime-devel >= 2.1, file, boost-devel >= 1.32, desktop-file-utils
 
 %description
 Pinot is a metasearch tool for the Free Desktop. It enables one to query



From fabricecolin at berlios.de  Sat Mar  4 04:36:34 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Sat, 4 Mar 2006 04:36:34 +0100
Subject: [Pinot-svn] r135 - in trunk: Collect UI/GTK2/src
Message-ID: <200603040336.k243aYpH021257@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-04 04:33:34 +0100 (Sat, 04 Mar 2006)
New Revision: 135

Added:
   trunk/Collect/CurlDownloader.cpp
   trunk/Collect/CurlDownloader.h
Modified:
   trunk/Collect/DownloaderInterface.cpp
   trunk/Collect/DownloaderInterface.h
   trunk/Collect/Makefile.am
   trunk/Collect/NeonDownloader.cpp
   trunk/Collect/NeonDownloader.h
   trunk/Collect/dloadtest.cpp
   trunk/UI/GTK2/src/pinot.cc
Log:
Moved OpenSSL initialization to DownloaderInterface. New CurlDownloader class is
an alternative to NeonDownloader. Program dloadtest compiled as pinot_collect.


Added: trunk/Collect/CurlDownloader.cpp
===================================================================
--- trunk/Collect/CurlDownloader.cpp	2006-03-03 14:30:49 UTC (rev 134)
+++ trunk/Collect/CurlDownloader.cpp	2006-03-04 03:33:34 UTC (rev 135)
@@ -0,0 +1,206 @@
+/*
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU Library General Public License for more details.
+ *
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+ */
+
+#include <cstdio>
+#include <strings.h>
+#include <stdarg.h>
+#include <iostream>
+
+#include <curl/curl.h>
+
+#include "HtmlTokenizer.h"
+#include "HtmlDocument.h"
+#include "Url.h"
+#include "CurlDownloader.h"
+
+using namespace std;
+
+struct ContentInfo
+{
+	char *m_pContent;
+	size_t m_contentLen;
+};
+
+size_t writeCallback(void *pData, size_t dataSize, size_t elementsCount, void *pStream)
+{
+	ContentInfo *pInfo = NULL;
+	size_t totalSize = elementsCount * dataSize;
+
+	if (pStream == NULL)
+	{
+#ifdef DEBUG
+		cout << "writeCallback: no stream" << endl;
+#endif
+		return 0;
+	}
+
+	pInfo = (ContentInfo *)pStream;
+	char *pNewContent = (char*)realloc(pInfo->m_pContent, pInfo->m_contentLen + totalSize + 1);
+	if (pNewContent == NULL)
+	{
+#ifdef DEBUG
+		cout << "writeCallback: failed to enlarge buffer" << endl;
+#endif
+		if (pInfo->m_pContent != NULL)
+		{
+			free(pInfo->m_pContent);
+			pInfo->m_pContent = NULL;
+			pInfo->m_contentLen = 0;
+		}
+		return 0;
+	}
+
+	pInfo->m_pContent = pNewContent;
+	memcpy(pInfo->m_pContent + pInfo->m_contentLen, pData, totalSize);
+	pInfo->m_contentLen += totalSize;
+	pInfo->m_pContent[pInfo->m_contentLen] = '\0';
+#ifdef DEBUG
+	cout << "writeCallback: copied " << totalSize << " bytes into buffer" << endl;
+#endif
+
+	return totalSize;
+}
+
+unsigned int CurlDownloader::m_initialized = 0;
+
+CurlDownloader::CurlDownloader() :
+	DownloaderInterface()
+{
+	if (m_initialized == 0)
+	{
+		// Initialize
+		curl_global_init(CURL_GLOBAL_ALL);
+
+		++m_initialized;
+	}
+
+        // Pretend to be Mozilla
+	m_userAgent = "Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.7.3) Gecko/20041020";
+}
+
+CurlDownloader::~CurlDownloader()
+{
+	--m_initialized;
+	if (m_initialized == 0)
+	{
+		// Shutdown
+		curl_global_cleanup();
+	}
+}
+
+//
+// Implementation of DownloaderInterface
+//
+
+/// Sets a (name, value) setting; true if success.
+bool CurlDownloader::setSetting(const string &name, const string &value)
+{
+        bool goodSetting = true;
+
+        if (name == "User-Agent")
+        {
+                m_userAgent = value;
+        }
+        else
+        {
+                goodSetting = false;
+        }
+
+        return goodSetting;
+}
+
+/// Retrieves the specified document; NULL if error.
+Document *CurlDownloader::retrieveUrl(const DocumentInfo &docInfo)
+{
+	Document *pDocument = NULL;
+	string url(Url::escapeUrl(docInfo.getLocation()));
+	long maxRedirectionsCount = 10;
+
+	if (url.empty() == true)
+	{
+#ifdef DEBUG
+		cout << "CurlDownloader::retrieveUrl: no URL specified !" << endl;
+#endif
+		return NULL;
+	}
+
+	// Create a session
+	CURL *pCurlHandler = curl_easy_init();
+	if (pCurlHandler != NULL)
+	{
+		ContentInfo *pContentInfo = new ContentInfo;
+
+		pContentInfo->m_pContent = NULL;
+		pContentInfo->m_contentLen = 0;
+
+		curl_easy_setopt(pCurlHandler, CURLOPT_AUTOREFERER, 1);
+		curl_easy_setopt(pCurlHandler, CURLOPT_FOLLOWLOCATION, 1);
+		curl_easy_setopt(pCurlHandler, CURLOPT_MAXREDIRS, maxRedirectionsCount);
+		curl_easy_setopt(pCurlHandler, CURLOPT_USERAGENT, m_userAgent.c_str());
+		curl_easy_setopt(pCurlHandler, CURLOPT_NOSIGNAL, (long)1);
+		curl_easy_setopt(pCurlHandler, CURLOPT_TIMEOUT, (long)m_timeout);
+#ifndef DEBUG
+		curl_easy_setopt(pCurlHandler, CURLOPT_NOPROGRESS, 1);
+#endif
+		curl_easy_setopt(pCurlHandler, CURLOPT_WRITEFUNCTION, writeCallback);
+		curl_easy_setopt(pCurlHandler, CURLOPT_WRITEDATA, pContentInfo);
+#ifdef DEBUG
+		cout << "CurlDownloader::retrieveUrl: URL is " << url << endl;
+#endif
+		curl_easy_setopt(pCurlHandler, CURLOPT_URL, url.c_str());
+
+		CURLcode res = curl_easy_perform(pCurlHandler);
+		if (res == CURLE_OK)
+		{
+			if ((pContentInfo->m_pContent != NULL) &&
+				(pContentInfo->m_contentLen > 0))
+			{
+				char *pContentType = NULL;
+
+				// What's the Content-Type ?
+				res = curl_easy_getinfo(pCurlHandler, CURLINFO_CONTENT_TYPE, &pContentType);
+				if ((res == CURLE_OK) &&
+					(pContentType != NULL))
+				{
+					if (strstr(pContentType, "html") != NULL)
+					{
+						pDocument = new HtmlDocument(docInfo.getTitle(), url,
+							pContentType, docInfo.getLanguage());
+					}
+					else
+					{
+						pDocument = new Document(docInfo.getTitle(), url,
+							pContentType, docInfo.getLanguage());
+					}
+
+					// ...and copy the content into it
+					pDocument->setData(pContentInfo->m_pContent, pContentInfo->m_contentLen);
+
+#ifdef DEBUG
+					cout << "CurlDownloader::retrieveUrl: document size is " << pContentInfo->m_contentLen << endl;
+#endif
+				}
+			}
+		}
+
+		delete pContentInfo;
+
+		// Cleanup
+		curl_easy_cleanup(pCurlHandler);
+	}
+
+	return pDocument;
+}

Added: trunk/Collect/CurlDownloader.h
===================================================================
--- trunk/Collect/CurlDownloader.h	2006-03-03 14:30:49 UTC (rev 134)
+++ trunk/Collect/CurlDownloader.h	2006-03-04 03:33:34 UTC (rev 135)
@@ -0,0 +1,46 @@
+/*
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU Library General Public License for more details.
+ *
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+ */
+
+#ifndef _CURL_DOWNLOADER_H
+#define _CURL_DOWNLOADER_H
+
+#include <string>
+
+#include "DownloaderInterface.h"
+
+class CurlDownloader : public DownloaderInterface
+{
+	public:
+		CurlDownloader();
+		virtual ~CurlDownloader();
+
+		/// Sets a (name, value) setting; true if success.
+		virtual bool setSetting(const std::string &name, const std::string &value);
+
+		/// Retrieves the specified document; NULL if error. Caller deletes.
+		virtual Document *retrieveUrl(const DocumentInfo &docInfo);
+
+	protected:
+		static unsigned int m_initialized;
+		std::string m_userAgent;
+
+	private:
+		CurlDownloader(const CurlDownloader &other);
+		CurlDownloader &operator=(const CurlDownloader &other);
+
+};
+
+#endif // _CURL_DOWNLOADER_H


Property changes on: trunk/Collect/CurlDownloader.h
___________________________________________________________________
Name: svn:executable
   + *

Modified: trunk/Collect/DownloaderInterface.cpp
===================================================================
--- trunk/Collect/DownloaderInterface.cpp	2006-03-03 14:30:49 UTC (rev 134)
+++ trunk/Collect/DownloaderInterface.cpp	2006-03-04 03:33:34 UTC (rev 135)
@@ -14,11 +14,85 @@
  *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
  */
 
+#include <pthread.h>
+#include <iostream>
+
+#include <openssl/crypto.h>
+
 #include "HtmlTokenizer.h"
 #include "DownloaderInterface.h"
 
 using namespace std;
 
+// OpenSSL multi-thread support, required by Curl
+static pthread_mutex_t locksTable[CRYPTO_NUM_LOCKS];
+
+// OpenSSL locking functiom
+static void lockingCallback(int mode, int n, const char *file, int line)
+{
+        int status = 0;
+
+        if (mode & CRYPTO_LOCK)
+        {
+                status = pthread_mutex_lock(&(locksTable[n]));
+#ifdef DEBUG
+                if (status != 0)
+                {
+                        cout << "lockingCallback: failed to lock mutex " << n << endl;
+                }
+#endif
+        }
+        else
+        {
+                status = pthread_mutex_unlock(&(locksTable[n]));
+#ifdef DEBUG
+                if (status != 0)
+                {
+                        cout << "lockingCallback: failed to unlock mutex " << n << endl;
+                }
+#endif
+        }
+}
+
+static unsigned long idCallback(void)
+{
+        return (unsigned long)pthread_self();
+}
+
+/// Initialize downloaders.
+void DownloaderInterface::initialize(void)
+{
+	pthread_mutexattr_t mutexAttr;
+
+	pthread_mutexattr_init(&mutexAttr);
+	pthread_mutexattr_settype(&mutexAttr, PTHREAD_MUTEX_ERRORCHECK);
+
+	// Initialize the OpenSSL mutexes
+	for (unsigned int lockNum = 0; lockNum < CRYPTO_NUM_LOCKS; ++lockNum)
+	{
+		pthread_mutex_init(&(locksTable[lockNum]), &mutexAttr);
+	}
+	// Set the callbacks
+	CRYPTO_set_locking_callback(lockingCallback);
+	CRYPTO_set_id_callback(idCallback);
+
+	pthread_mutexattr_destroy(&mutexAttr);
+}
+
+/// Shutdown downloaders.
+void DownloaderInterface::shutdown(void)
+{
+	// Reset the OpenSSL callbacks
+	CRYPTO_set_id_callback(NULL);
+	CRYPTO_set_locking_callback(NULL);
+
+	// Free the mutexes
+	for (unsigned int lockNum = 0; lockNum < CRYPTO_NUM_LOCKS; ++lockNum)
+	{
+		pthread_mutex_destroy(&(locksTable[lockNum]));
+	}
+}
+
 DownloaderInterface::DownloaderInterface() :
 	m_timeout(60)
 {
@@ -39,9 +113,3 @@
 {
 	m_timeout = milliseconds;
 }
-
-/// Stops the current action.
-bool DownloaderInterface::stop(void)
-{
-	return false;
-}

Modified: trunk/Collect/DownloaderInterface.h
===================================================================
--- trunk/Collect/DownloaderInterface.h	2006-03-03 14:30:49 UTC (rev 134)
+++ trunk/Collect/DownloaderInterface.h	2006-03-04 03:33:34 UTC (rev 135)
@@ -27,6 +27,12 @@
 	public:
 		virtual ~DownloaderInterface();
 
+		/// Initializes downloaders.
+		static void initialize(void);
+
+		/// Shutdowns downloaders.
+		static void shutdown(void);
+
 		/// Sets a (name, value) setting; true if success.
 		virtual bool setSetting(const std::string &name, const std::string &value);
 
@@ -36,9 +42,6 @@
 		/// Retrieves the specified document; NULL if error. Caller deletes.
 		virtual Document *retrieveUrl(const DocumentInfo &docInfo) = 0;
 
-		/// Stops the current action.
-		virtual bool stop(void);
-
 	protected:
 		unsigned int m_timeout;
 

Modified: trunk/Collect/Makefile.am
===================================================================
--- trunk/Collect/Makefile.am	2006-03-03 14:30:49 UTC (rev 134)
+++ trunk/Collect/Makefile.am	2006-03-04 03:33:34 UTC (rev 135)
@@ -1,6 +1,7 @@
 # Process this file with automake to produce Makefile.in
 
 noinst_HEADERS = \
+	CurlDownloader.h \
 	DownloaderFactory.h \
 	DownloaderInterface.h \
 	FileCollector.h \
@@ -10,7 +11,17 @@
 
 noinst_LTLIBRARIES = libCollect.la
 
+bin_PROGRAMS = pinot_collect
+
+pinot_collect_SOURCES = \
+	dloadtest.cpp
+
+pinot_collect_LDADD = -L../Utils -L../Tokenize \
+	-lCollect -lTokenize -lUtils \
+	@INDEX_LIBS@ @XML_LIBS@ @MIME_LIBS@ @HTTP_LIBS@ @MISC_LIBS@
+
 libCollect_la_SOURCES = \
+	CurlDownloader.cpp \
 	DownloaderFactory.cpp \
 	DownloaderInterface.cpp \
 	FileCollector.cpp \
@@ -18,5 +29,6 @@
 	NeonDownloader.cpp \
 	XapianCollector.cpp
 
-AM_CXXFLAGS = -I../Utils -I../Tokenize @HTTP_CFLAGS@ @MIME_CFLAGS@
+AM_CXXFLAGS = -I../Utils -I../Tokenize \
+	@INDEX_CFLAGS@ @XML_CFLAGS@ @HTTP_CFLAGS@ @MIME_CFLAGS@
 

Modified: trunk/Collect/NeonDownloader.cpp
===================================================================
--- trunk/Collect/NeonDownloader.cpp	2006-03-03 14:30:49 UTC (rev 134)
+++ trunk/Collect/NeonDownloader.cpp	2006-03-04 03:33:34 UTC (rev 135)
@@ -20,11 +20,9 @@
 #include <pthread.h>
 #include <iostream>
 
+#include <neon/ne_socket.h>
 #include <neon/ne_session.h>
-// Does Neon have OpenSSL support ?
-#ifdef NE_SSL_H
-#include <openssl/crypto.h>
-#endif	// NE_SSL_H
+#include <neon/ne_request.h>
 
 #include "HtmlTokenizer.h"
 #include "HtmlDocument.h"
@@ -64,103 +62,33 @@
 	}
 }
 
-static pthread_mutex_t accessLock = PTHREAD_MUTEX_INITIALIZER;
-#ifdef NE_SSL_H
-// OpenSSL multi-thread support, required by Neon
-static pthread_mutex_t locksTable[CRYPTO_NUM_LOCKS];
+static pthread_mutex_t g_accessLock = PTHREAD_MUTEX_INITIALIZER;
 
-// OpenSSL locking functiom
-static void lockingCallback(int mode, int n, const char *file, int line)
-{
-	int status = 0;
+unsigned int NeonDownloader::m_initialized = 0;
 
-	if (mode & CRYPTO_LOCK)
-	{
-		status = pthread_mutex_lock(&(locksTable[n]));
-#ifdef DEBUG
-		if (status != 0)
-		{
-			cout << "lockingCallback: failed to lock mutex " << n << endl;
-		}
-#endif
-	}
-	else
-	{
-		status = pthread_mutex_unlock(&(locksTable[n]));
-#ifdef DEBUG
-		if (status != 0)
-		{
-			cout << "lockingCallback: failed to unlock mutex " << n << endl;
-		}
-#endif
-	}
-}
-
-static unsigned long idCallback(void)
+NeonDownloader::NeonDownloader() :
+	DownloaderInterface()
 {
-	return (unsigned long)pthread_self();
-}
-#endif // NE_SSL_H
-
-/// Initialize the downloader.
-void NeonDownloader::initialize(void)
-{
-#ifdef NE_SSL_H
-	pthread_mutexattr_t mutexAttr;
-
-	pthread_mutexattr_init(&mutexAttr);
-	pthread_mutexattr_settype(&mutexAttr, PTHREAD_MUTEX_ERRORCHECK);
-
-	// Initialize the OpenSSL mutexes
-	for (unsigned int lockNum = 0; lockNum < CRYPTO_NUM_LOCKS; ++lockNum)
+	if (m_initialized == 0)
 	{
-		pthread_mutex_init(&(locksTable[lockNum]), &mutexAttr);
-	}
-	// Set the callbacks
-	CRYPTO_set_locking_callback(lockingCallback);
-	CRYPTO_set_id_callback(idCallback);
+		// Initialize
+		ne_sock_init();
 
-	pthread_mutexattr_destroy(&mutexAttr);
-#endif	// NE_SSL_H
-	ne_sock_init();
-}
-
-/// Shutdown the downloader.
-void NeonDownloader::shutdown(void)
-{
-#ifdef NE_SSL_H
-	// Reset the OpenSSL callbacks
-	CRYPTO_set_id_callback(NULL);
-	CRYPTO_set_locking_callback(NULL);
-	// Free the mutexes
-	for (unsigned int lockNum = 0; lockNum < CRYPTO_NUM_LOCKS; ++lockNum)
-	{
-		pthread_mutex_destroy(&(locksTable[lockNum]));
+		++m_initialized;
 	}
-#endif	// NE_SSL_H
-	ne_sock_exit();
-}
 
-NeonDownloader::NeonDownloader() :
-	DownloaderInterface(),
-	m_pSession(NULL),
-	m_pRequest(NULL)
-{
 	// Pretend to be Mozilla
 	m_userAgent = "Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.7.3) Gecko/20041020";
 }
 
 NeonDownloader::~NeonDownloader()
 {
-	// Cleanup
-	if (m_pRequest != NULL)
+	--m_initialized;
+	if (m_initialized == 0)
 	{
-		ne_request_destroy(m_pRequest);
+		// Shutdown
+		ne_sock_exit();
 	}
-	if (m_pSession != NULL)
-	{
-		ne_session_destroy(m_pSession);
-	}
 }
 
 string NeonDownloader::handleRedirection(const char *pBody, unsigned int length)
@@ -220,9 +148,9 @@
 /// Retrieves the specified document; NULL if error.
 Document *NeonDownloader::retrieveUrl(const DocumentInfo &docInfo)
 {
-	Document *urlDocument = NULL;
+	Document *pDocument = NULL;
 	string url = Url::escapeUrl(docInfo.getLocation());
-	char *content = NULL;
+	char *pContent = NULL;
 	size_t contentLen = 0;
 	int statusCode = 200;
 	unsigned int redirectionsCount = 0;
@@ -241,25 +169,25 @@
 	string file = urlObj.getFile();
 	string parameters = urlObj.getParameters();
 
-	if (pthread_mutex_lock(&accessLock) != 0)
+	if (pthread_mutex_lock(&g_accessLock) != 0)
 	{
 		return NULL;
 	}
 
 	// Create a session
-	m_pSession = ne_session_create(protocol.c_str(), hostName.c_str(), 80); // urlObj.getPort());
-	if (m_pSession == NULL)
+	ne_session *pSession = ne_session_create(protocol.c_str(), hostName.c_str(), 80); // urlObj.getPort());
+	if (pSession == NULL)
 	{
 #ifdef DEBUG
 		cerr << "NeonDownloader::retrieveUrl: couldn't create session !" << endl;
 #endif
-		pthread_mutex_unlock(&accessLock);
+		pthread_mutex_unlock(&g_accessLock);
 		return NULL;
 	}
 	// Set the user agent
-	ne_set_useragent(m_pSession, m_userAgent.c_str());
+	ne_set_useragent(pSession, m_userAgent.c_str());
 	// ...and the timeout
-	ne_set_read_timeout(m_pSession, (int)m_timeout);
+	ne_set_read_timeout(pSession, (int)m_timeout);
 
 	string fullLocation = "/";
 	if (location.empty() == false)
@@ -281,15 +209,14 @@
 	}
 
 	// Create a request for this URL
-	m_pRequest = ne_request_create(m_pSession, "GET", fullLocation.c_str());
-	pthread_mutex_unlock(&accessLock);
-	if (m_pRequest == NULL)
+	ne_request *pRequest = ne_request_create(pSession, "GET", fullLocation.c_str());
+	pthread_mutex_unlock(&g_accessLock);
+	if (pRequest == NULL)
 	{
 #ifdef DEBUG
 		cerr << "NeonDownloader::retrieveUrl: couldn't create request !" << endl;
 #endif
-		ne_session_destroy(m_pSession);
-		m_pSession = NULL;
+		ne_session_destroy(pSession);
 		return NULL;
 	}
 #ifdef DEBUG
@@ -301,11 +228,11 @@
 	{
 		// FIXME: this is apparently the only way to get the value of an HTTP header
 		g_locationHeaderValue.clear();
-		ne_add_response_header_handler(m_pRequest, "Location", headerHandler, (void*)1);
-		ne_add_response_header_handler(m_pRequest, "Content-Type", headerHandler, (void*)2);
+		ne_add_response_header_handler(pRequest, "Location", headerHandler, (void*)1);
+		ne_add_response_header_handler(pRequest, "Content-Type", headerHandler, (void*)2);
 
 		// Begin the request
-		requestStatus = ne_begin_request(m_pRequest);
+		requestStatus = ne_begin_request(pRequest);
 #ifdef DEBUG
 		cout << "NeonDownloader::retrieveUrl: request begun with status " << requestStatus << endl;
 #endif
@@ -315,7 +242,7 @@
 			char buffer[1024];
 
 			// Get the status
-			const ne_status *pStatus = ne_get_status(m_pRequest);
+			const ne_status *pStatus = ne_get_status(pRequest);
 			if (pStatus != NULL)
 			{
 				statusCode = pStatus->code;
@@ -330,10 +257,10 @@
 			}
 
 			// Read the content
-			while ((bytesRead = ne_read_response_block(m_pRequest, buffer, 1024)) > 0)
+			while ((bytesRead = ne_read_response_block(pRequest, buffer, 1024)) > 0)
 			{
-				content = (char*)realloc(content, contentLen + bytesRead);
-				memcpy((void*)(content + contentLen), (const void*)buffer, bytesRead);
+				pContent = (char*)realloc(pContent, contentLen + bytesRead);
+				memcpy((void*)(pContent + contentLen), (const void*)buffer, bytesRead);
 				contentLen += bytesRead;
 			}
 
@@ -342,19 +269,19 @@
 				(statusCode < 400) &&
 				(redirectionsCount < 10))
 			{
-				ne_end_request(m_pRequest);
-				ne_request_destroy(m_pRequest);
-				m_pRequest = NULL;
+				ne_end_request(pRequest);
+				ne_request_destroy(pRequest);
+				pRequest = NULL;
 
-				string documentUrl = handleRedirection(content, contentLen);
+				string documentUrl = handleRedirection(pContent, contentLen);
 				if (documentUrl.empty() == true)
 				{
 					// Did we find a Location header ?
 					if (g_locationHeaderValue.empty() == true)
 					{
 						// Fail
-						free(content);
-						content = NULL;
+						free(pContent);
+						pContent = NULL;
 						contentLen = 0;
 						break;
 					}
@@ -375,17 +302,17 @@
 					hostName = urlObj.getHost();
 
 					// Create a new session
-					ne_session_destroy(m_pSession);
-					m_pSession = ne_session_create(protocol.c_str(), hostName.c_str(), 80); // urlObj.getPort());
-					if (m_pSession == NULL)
+					ne_session_destroy(pSession);
+					pSession = ne_session_create(protocol.c_str(), hostName.c_str(), 80); // urlObj.getPort());
+					if (pSession == NULL)
 					{
 #ifdef DEBUG
 						cerr << "NeonDownloader::retrieveUrl: couldn't create session !" << endl;
 #endif
 						return NULL;
 					}
-					ne_set_useragent(m_pSession, m_userAgent.c_str());
-					ne_set_read_timeout(m_pSession, (int)m_timeout);
+					ne_set_useragent(pSession, m_userAgent.c_str());
+					ne_set_read_timeout(pSession, (int)m_timeout);
 				}
 
 				// Try again
@@ -404,32 +331,31 @@
 #endif
 
 				// Create a new request for this URL
-				m_pRequest = ne_request_create(m_pSession, "GET", fullLocation.c_str());
-				if (m_pRequest == NULL)
+				pRequest = ne_request_create(pSession, "GET", fullLocation.c_str());
+				if (pRequest == NULL)
 				{
 #ifdef DEBUG
 					cerr << "NeonDownloader::retrieveUrl: couldn't create request !" << endl;
 #endif
-					ne_session_destroy(m_pSession);
-					m_pSession = NULL;
+					ne_session_destroy(pSession);
 					return NULL;
 				}
 				redirectionsCount++;
 				requestStatus = NE_RETRY;
 
 				// Discard whatever content we have already got
-				free(content);
-				content = NULL;
+				free(pContent);
+				pContent = NULL;
 				contentLen = 0;
 				continue;
 			}
 		}
 
 		// End the request
-		requestStatus = ne_end_request(m_pRequest);
+		requestStatus = ne_end_request(pRequest);
 	}
 
-	if ((content != NULL) &&
+	if ((pContent != NULL) &&
 		(contentLen > 0))
 	{
 		if (statusCode < 400)
@@ -437,34 +363,26 @@
 			// Is it an HTML type ?
 			if (g_contentTypeHeaderValue.find("html") != string::npos)
 			{
-				urlDocument = new HtmlDocument(docInfo.getTitle(), url,
+				pDocument = new HtmlDocument(docInfo.getTitle(), url,
 					g_contentTypeHeaderValue, docInfo.getLanguage());
 			}
 			else
 			{
-				urlDocument = new Document(docInfo.getTitle(), url,
+				pDocument = new Document(docInfo.getTitle(), url,
 					g_contentTypeHeaderValue, docInfo.getLanguage());
 			}
 			// ...and copy the content into it
-			urlDocument->setData(content, contentLen);
+			pDocument->setData(pContent, contentLen);
 #ifdef DEBUG
 			cout << "NeonDownloader::retrieveUrl: document size is " << contentLen << endl;
 #endif
 		}
-		free(content);
+		free(pContent);
 	}
 
-	return urlDocument;
-}
+	// Cleanup
+	ne_request_destroy(pRequest);
+	ne_session_destroy(pSession);
 
-/// Stops the current action.
-bool NeonDownloader::stop(void)
-{
-	if (m_pRequest != NULL)
-	{
-		// End the current request
-		ne_end_request(m_pRequest);
-	}
-
-	return true;
+	return pDocument;
 }

Modified: trunk/Collect/NeonDownloader.h
===================================================================
--- trunk/Collect/NeonDownloader.h	2006-03-03 14:30:49 UTC (rev 134)
+++ trunk/Collect/NeonDownloader.h	2006-03-04 03:33:34 UTC (rev 135)
@@ -19,10 +19,6 @@
 
 #include <string>
 
-#include <neon/ne_socket.h>
-#include <neon/ne_session.h>
-#include <neon/ne_request.h>
-
 #include "DownloaderInterface.h"
 
 class NeonDownloader : public DownloaderInterface
@@ -31,25 +27,15 @@
 		NeonDownloader();
 		virtual ~NeonDownloader();
 
-		/// Initializes the downloader.
-		static void initialize(void);
-
-		/// Shutdowns the downloader.
-		static void shutdown(void);
-
 		/// Sets a (name, value) setting; true if success.
 		virtual bool setSetting(const std::string &name, const std::string &value);
 
 		/// Retrieves the specified document; NULL if error. Caller deletes.
 		virtual Document *retrieveUrl(const DocumentInfo &docInfo);
 
-		/// Stops the current action.
-		virtual bool stop(void);
-
 	protected:
+		static unsigned int m_initialized;
 		std::string m_userAgent;
-		ne_session *m_pSession;
-		ne_request *m_pRequest;
 
 		std::string handleRedirection(const char *pBody, unsigned int length);
 

Modified: trunk/Collect/dloadtest.cpp
===================================================================
--- trunk/Collect/dloadtest.cpp	2006-03-03 14:30:49 UTC (rev 134)
+++ trunk/Collect/dloadtest.cpp	2006-03-04 03:33:34 UTC (rev 135)
@@ -23,7 +23,6 @@
 #include "HtmlTokenizer.h"
 #include "Url.h"
 #include "DownloaderFactory.h"
-#include "NeonDownloader.h"
 
 using namespace std;
 
@@ -35,7 +34,7 @@
 		return EXIT_FAILURE;
 	}
 
-	NeonDownloader::initialize();
+	DownloaderInterface::initialize();
 
 	string downloaderName = argv[1];
 	
@@ -47,13 +46,14 @@
 	cout << "Location: " << thisUrl.getLocation() << endl;
 	cout << "File: " << thisUrl.getFile() << endl;
 	cout << "Parameters: " << thisUrl.getParameters() << endl;
+	cout << "Escaped URL: " << Url::escapeUrl(argv[2]) << endl;
 
 	// Which Downloader ?
 	DownloaderInterface *myDownloader = DownloaderFactory::getDownloader(thisUrl.getProtocol(),
 		downloaderName);
 	if (myDownloader == NULL)
 	{
-		NeonDownloader::shutdown();
+		DownloaderInterface::shutdown();
 		cerr << "Couldn't obtain downloader instance (" << thisUrl.getProtocol() << "," << downloaderName << ")" << endl;
 		return EXIT_FAILURE;
 	}
@@ -109,7 +109,7 @@
 
 	delete myDownloader;
 
-	NeonDownloader::shutdown();
+	DownloaderInterface::shutdown();
 
 	return EXIT_SUCCESS;
 }

Modified: trunk/UI/GTK2/src/pinot.cc
===================================================================
--- trunk/UI/GTK2/src/pinot.cc	2006-03-03 14:30:49 UTC (rev 134)
+++ trunk/UI/GTK2/src/pinot.cc	2006-03-04 03:33:34 UTC (rev 135)
@@ -32,7 +32,7 @@
 #include "XapianDatabaseFactory.h"
 #include "QueryHistory.h"
 #include "ViewHistory.h"
-#include "NeonDownloader.h"
+#include "DownloaderInterface.h"
 #include "MozillaRenderer.h"
 #include "config.h"
 #include "NLS.h"
@@ -74,7 +74,7 @@
 	outputFile.close();
 
 	MozillaRenderer::shutdown();
-	NeonDownloader::shutdown();
+	DownloaderInterface::shutdown();
 }
 
 static void quitAll(int sigNum)
@@ -96,7 +96,7 @@
 	textdomain(GETTEXT_PACKAGE);
 #endif //ENABLE_NLS
 
-	NeonDownloader::initialize();
+	DownloaderInterface::initialize();
 	MozillaRenderer::initialize();
 	Glib::thread_init();
 	Gtk::Main m(&argc, &argv);



From fabricecolin at berlios.de  Sat Mar  4 06:44:22 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Sat, 4 Mar 2006 06:44:22 +0100
Subject: [Pinot-svn] r136 - in trunk: . Collect UI/GTK2/src Utils
Message-ID: <200603040544.k245iMEt024548@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-04 06:44:16 +0100 (Sat, 04 Mar 2006)
New Revision: 136

Modified:
   trunk/Collect/DownloaderFactory.cpp
   trunk/UI/GTK2/src/WorkerThreads.cpp
   trunk/UI/GTK2/src/WorkerThreads.h
   trunk/UI/GTK2/src/mainWindow.cc
   trunk/Utils/Url.cpp
   trunk/configure.in
Log:
We can now switch between curl and neon for HTTP collection and URL escaping
by running configure with --with-http=neon|curl. Neon is used by default.
Removed long obsolete ListenerThread. Cosmetic mods to worker threads.


Modified: trunk/Collect/DownloaderFactory.cpp
===================================================================
--- trunk/Collect/DownloaderFactory.cpp	2006-03-04 03:33:34 UTC (rev 135)
+++ trunk/Collect/DownloaderFactory.cpp	2006-03-04 05:44:16 UTC (rev 136)
@@ -15,7 +15,13 @@
  */
 
 #include "XapianCollector.h"
+#ifdef USE_NEON
 #include "NeonDownloader.h"
+#else
+#ifdef USE_CURL
+#include "CurlDownloader.h"
+#endif
+#endif
 #include "FileCollector.h"
 #include "MboxCollector.h"
 #include "DownloaderFactory.h"
@@ -23,25 +29,31 @@
 /// Returns a Downloader of the specified type; NULL if unavailable.
 DownloaderInterface *DownloaderFactory::getDownloader(string protocol, string type)
 {
-	DownloaderInterface *myDownloader = NULL;
+	DownloaderInterface *pDownloader = NULL;
 
 	// Choice by protocol
 	if (protocol == "http")
 	{
-		myDownloader = new NeonDownloader();
+#ifdef USE_NEON
+		pDownloader = new NeonDownloader();
+#else
+#ifdef USE_CURL
+		pDownloader = new CurlDownloader();
+#endif
+#endif
 	}
 	else if (protocol == "xapian")
 	{
-		myDownloader = new XapianCollector();
+		pDownloader = new XapianCollector();
 	}
 	else if (protocol == "file")
 	{
-		myDownloader = new FileCollector();
+		pDownloader = new FileCollector();
 	}
 	else if (protocol == "mailbox")
 	{
-		myDownloader = new MboxCollector();
+		pDownloader = new MboxCollector();
 	}
 
-	return myDownloader;
+	return pDownloader;
 }

Modified: trunk/UI/GTK2/src/WorkerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.cpp	2006-03-04 03:33:34 UTC (rev 135)
+++ trunk/UI/GTK2/src/WorkerThreads.cpp	2006-03-04 05:44:16 UTC (rev 136)
@@ -341,12 +341,12 @@
 
 IndexBrowserThread::IndexBrowserThread(const string &indexName,
 	unsigned int maxDocsCount, unsigned int startDoc) :
-	WorkerThread()
+	WorkerThread(),
+	m_indexName(indexName),
+	m_indexDocsCount(0),
+	m_maxDocsCount(maxDocsCount),
+	m_startDoc(startDoc)
 {
-	m_indexName = indexName;
-	m_indexDocsCount = 0;
-	m_maxDocsCount = maxDocsCount;
-	m_startDoc = startDoc;
 }
 
 IndexBrowserThread::~IndexBrowserThread()
@@ -462,11 +462,12 @@
 
 QueryingThread::QueryingThread(const string &engineName, const string &engineDisplayableName,
 	const string &engineOption, const QueryProperties &queryProps) :
-	m_queryProps(queryProps), WorkerThread()
+	WorkerThread(),
+	m_queryProps(queryProps),
+	m_engineName(engineName),
+	m_engineDisplayableName(engineDisplayableName),
+	m_engineOption(engineOption)
 {
-	m_engineName = engineName;
-	m_engineDisplayableName = engineDisplayableName;
-	m_engineOption = engineOption;
 }
 
 QueryingThread::~QueryingThread()
@@ -567,10 +568,10 @@
 }
 
 LabelQueryThread::LabelQueryThread(const string &indexName, const string &labelName) :
-	WorkerThread()
+	WorkerThread(),
+	m_indexName(indexName),
+	m_labelName(labelName)
 {
-	m_indexName = indexName;
-	m_labelName = labelName;
 }
 
 LabelQueryThread::~LabelQueryThread()
@@ -689,12 +690,12 @@
 }
 
 DownloadingThread::DownloadingThread(const string url, bool fromCache) :
-	WorkerThread()
+	WorkerThread(),
+	m_url(url),
+	m_fromCache(fromCache),
+	m_pDoc(NULL),
+	m_pDownloader(NULL)
 {
-	m_url = url;
-	m_fromCache = fromCache;
-	m_pDoc = NULL;
-	m_downloader = NULL;
 }
 
 DownloadingThread::~DownloadingThread()
@@ -703,9 +704,9 @@
 	{
 		delete m_pDoc;
 	}
-	if (m_downloader != NULL)
+	if (m_pDownloader != NULL)
 	{
-		delete m_downloader;
+		delete m_pDownloader;
 	}
 }
 
@@ -726,24 +727,20 @@
 
 bool DownloadingThread::stop(void)
 {
-	if (m_downloader->stop() == true)
-	{
-		m_done = true;
-		m_status = _("Stopped retrieval of");
-		m_status += " ";
-		m_status += m_url;
-		return true;
-	}
+	m_done = true;
+	m_status = _("Stopped retrieval of");
+	m_status += " ";
+	m_status += m_url;
 
-	return false;
+	return true;
 }
 
 void DownloadingThread::doWork(void)
 {
-	if (m_downloader != NULL)
+	if (m_pDownloader != NULL)
 	{
-		delete m_downloader;
-		m_downloader = NULL;
+		delete m_pDownloader;
+		m_pDownloader = NULL;
 	}
 
 	Url thisUrl(m_url);
@@ -762,8 +759,8 @@
 	else
 	{
 		// Get a Downloader, the default one will do
-		m_downloader = DownloaderFactory::getDownloader(thisUrl.getProtocol(), "");
-		if (m_downloader == NULL)
+		m_pDownloader = DownloaderFactory::getDownloader(thisUrl.getProtocol(), "");
+		if (m_pDownloader == NULL)
 		{
 			m_status = _("Couldn't obtain downloader for protocol");
 			m_status += " ";
@@ -773,7 +770,7 @@
 		{
 			DocumentInfo docInfo("", m_url, "", "");
 
-			m_pDoc = m_downloader->retrieveUrl(docInfo);
+			m_pDoc = m_pDownloader->retrieveUrl(docInfo);
 		}
 	}
 
@@ -1015,14 +1012,15 @@
 
 UnindexingThread::UnindexingThread(const set<unsigned int> &docIdList) :
 	WorkerThread(),
+	m_indexLocation(PinotSettings::getInstance().m_indexLocation),
 	m_docsCount(0)
 {
 	copy(docIdList.begin(), docIdList.end(), inserter(m_docIdList, m_docIdList.begin()));
-	m_indexLocation = PinotSettings::getInstance().m_indexLocation;
 }
 
 UnindexingThread::UnindexingThread(const set<string> &labelNames, const string &indexLocation) :
 	WorkerThread(),
+	m_indexLocation(indexLocation),
 	m_docsCount(0)
 {
 	copy(labelNames.begin(), labelNames.end(), inserter(m_labelNames, m_labelNames.begin()));
@@ -1030,10 +1028,6 @@
 	{
 		m_indexLocation = PinotSettings::getInstance().m_indexLocation;
 	}
-	else
-	{
-		m_indexLocation = indexLocation;
-	}
 }
 
 UnindexingThread::~UnindexingThread()
@@ -1128,11 +1122,11 @@
 
 UpdateDocumentThread::UpdateDocumentThread(const string &indexName,
 	unsigned int docId, const DocumentInfo &docInfo) :
-	WorkerThread()
+	WorkerThread(),
+	m_indexName(indexName),
+	m_docId(docId),
+	m_docInfo(docInfo)
 {
-	m_indexName = indexName;
-	m_docId = docId;
-	m_docInfo = docInfo;
 }
 
 UpdateDocumentThread::~UpdateDocumentThread()
@@ -1204,150 +1198,12 @@
 	}
 }
 
-ListenerThread::ListenerThread(const string &fifoFileName) :
-	WorkerThread(),
-	m_ctrlReadPipe(-1),
-	m_ctrlWritePipe(-1)
-{
-	int pipeFds[2];
-
-	if (pipe(pipeFds) == 0)
-	{
-		// This pipe will allow to stop select()
-		m_ctrlReadPipe = pipeFds[0];
-		m_ctrlWritePipe = pipeFds[1];
-	}
-	m_fifoFileName = fifoFileName;
-}
-
-ListenerThread::~ListenerThread()
-{
-	close(m_ctrlReadPipe);
-	close(m_ctrlWritePipe);
-}
-
-string ListenerThread::getType(void) const
-{
-	return "ListenerThread";
-}
-
-bool ListenerThread::stop(void)
-{
-	m_done = true;
-	write(m_ctrlWritePipe, "Stop", 4);
-	m_status = _("Stopped listening on");
-	m_status += " ";
-	m_status += m_fifoFileName;
-
-	return true;
-}
-
-Signal2<void, DocumentInfo, string>& ListenerThread::getReceptionSignal(void)
-{
-	return m_signalReception;
-}
-
-void ListenerThread::doWork(void)
-{
-	if (unlink(m_fifoFileName.c_str()) != 0)
-	{
-#ifdef DEBUG
-		cout << "ListenerThread::doWork: couldn't delete FIFO at " << m_fifoFileName << endl;
-#endif
-	}
-
-	if (mkfifo(m_fifoFileName.c_str(), S_IRUSR|S_IWUSR) != 0)
-	{
-#ifdef DEBUG
-		cout << "ListenerThread::doWork: couldn't create FIFO at " << m_fifoFileName << endl;
-#endif
-	}
-
-	// Ignore SIGPIPE
-	if (sigset(SIGPIPE, SIG_IGN) == SIG_ERR)
-	{
-#ifdef DEBUG
-		cout << "ListenerThread::doWork: couldn't ignore SIGPIPE" << endl;
-#endif
-	}
-
-	// Open the FIFO
-	int fd = open(m_fifoFileName.c_str(), O_RDWR);
-	if (fd != -1)
-	{
-		// Set the file in non-blocking mode
-		int flags = fcntl(fd, F_GETFL);
-		flags |= O_NONBLOCK;
-		fcntl(fd, F_SETFL, (long)flags);
-
-		fd_set listenSet;
-		FD_ZERO(&listenSet);
-		FD_SET(fd, &listenSet);
-		if (m_ctrlReadPipe >= 0)
-		{
-			FD_SET(m_ctrlReadPipe, &listenSet);
-		}
-
-		// Listen and wait for something to read
-		while (m_done == false)
-		{
-			int fdCount = select(max(fd, m_ctrlReadPipe) + 1, &listenSet, NULL, NULL, NULL);
-			if ((fdCount < 0) &&
-				(errno != EINTR))
-			{
-#ifdef DEBUG
-				cout << "ListenerThread::doWork: select() failed" << endl;
-#endif
-				break;
-			}
-			else if (FD_ISSET(fd, &listenSet))
-			{
-				string xmlMsg;
-				char buffer[1024];
-
-#ifdef DEBUG
-				cout << "ListenerThread::doWork: reading..." << endl;
-#endif
-				ssize_t bytes = read(fd, buffer, 1024);
-				while (bytes > 0)
-				{
-					xmlMsg += string(buffer, bytes);
-#ifdef DEBUG
-					cout << "ListenerThread::doWork: read " << bytes << " bytes" << endl;
-#endif
-					bytes = read(fd, buffer, 1024);
-				}
-
-				// FIXME: ensure the XML is valid, use libxml++ parser
-				string location = StringManip::extractField(xmlMsg, "<location>", "</location>");
-				Url urlObj(location);
-				DocumentInfo docInfo(StringManip::extractField(xmlMsg, "<title>", "</title>"),
-					location, MIMEScanner::scanUrl(urlObj), "");
-				string labelName = StringManip::extractField(xmlMsg, "<label>", "</label>");
-				string content = StringManip::extractField(xmlMsg, "<content>", "</content>");
-#ifdef DEBUG
-				cout << "ListenerThread::doWork: " << content.length() << " bytes of content" << endl;
-#endif
-
-				// Signal
-				m_signalReception(docInfo, labelName);
-			}
-		}
-
-		close(fd);
-	}
-	else
-	{
-		m_status = _("Couldn't read FIFO at");
-		m_status += " ";
-		m_status += m_fifoFileName;
-	}
-}
-
 MonitorThread::MonitorThread(MonitorHandler *pHandler) :
 	WorkerThread(),
 	m_ctrlReadPipe(-1),
-	m_ctrlWritePipe(-1)
+	m_ctrlWritePipe(-1),
+	m_pHandler(pHandler),
+	m_numCPUs(1)
 {
 	int pipeFds[2];
 
@@ -1357,7 +1213,6 @@
 		m_ctrlReadPipe = pipeFds[0];
 		m_ctrlWritePipe = pipeFds[1];
 	}
-	m_pHandler = pHandler;
 	m_numCPUs = sysconf(_SC_NPROCESSORS_ONLN);
 }
 
@@ -1422,9 +1277,6 @@
 			FD_SET(m_ctrlReadPipe, &listenSet);
 		}
 
-#ifdef DEBUG
-		cout << "MonitorThread::doWork: checking locations" << endl;
-#endif
 		if ((setLocationsToMonitor == true) &&
 			(m_pHandler->getFileSystemLocations(fsLocations) > 0) &&
 			(m_pHandler->hasNewLocations() == true))
@@ -1487,9 +1339,6 @@
 		}
 		setLocationsToMonitor = false;
 
-#ifdef DEBUG
-		cout << "MonitorThread::doWork: starting select()" << endl;
-#endif
 		int fdCount = select(max(famFd, m_ctrlReadPipe) + 1, &listenSet, NULL, NULL, &selectTimeout);
 		if ((fdCount < 0) &&
 			(errno != EINTR))

Modified: trunk/UI/GTK2/src/WorkerThreads.h
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.h	2006-03-04 03:33:34 UTC (rev 135)
+++ trunk/UI/GTK2/src/WorkerThreads.h	2006-03-04 05:44:16 UTC (rev 136)
@@ -258,7 +258,7 @@
 		std::string m_url;
 		bool m_fromCache;
 		Document *m_pDoc;
-		DownloaderInterface *m_downloader;
+		DownloaderInterface *m_pDownloader;
 
 		virtual void doWork(void);
 
@@ -361,32 +361,6 @@
 
 };
 
-class ListenerThread : public WorkerThread
-{
-	public:
-		ListenerThread(const std::string &fifoFileName);
-		virtual ~ListenerThread();
-
-		virtual std::string getType(void) const;
-
-		virtual bool stop(void);
-
-		SigC::Signal2<void, DocumentInfo, std::string>& getReceptionSignal(void);
-
-	protected:
-		int m_ctrlReadPipe;
-		int m_ctrlWritePipe;
-		std::string m_fifoFileName;
-		SigC::Signal2<void, DocumentInfo, std::string> m_signalReception;
-
-		virtual void doWork(void);
-
-	private:
-		ListenerThread(const ListenerThread &other);
-		ListenerThread &operator=(const ListenerThread &other);
-
-};
-
 class MonitorThread : public WorkerThread
 {
 	public:

Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2006-03-04 03:33:34 UTC (rev 135)
+++ trunk/UI/GTK2/src/mainWindow.cc	2006-03-04 05:44:16 UTC (rev 136)
@@ -214,13 +214,6 @@
 	m_state.connect();
 
 	// FIXME: delete all "ignored" threads when exiting !!!
-	// Fire up a listener thread
-	ListenerThread *pListenThread = new ListenerThread(PinotSettings::getConfigurationDirectory() + string("/fifo"));
-	// Connect to its reception signal
-	pListenThread->getReceptionSignal().connect(
-		SigC::slot(*this, &mainWindow::on_message_reception));
-	start_thread(pListenThread, true);
-
 	// Fire up the mail monitor thread
 	MboxHandler *pMbox = new MboxHandler();
 	// Connect to its update signal
@@ -381,9 +374,6 @@
 	TreeModel::Row row = *iter;
 
 	ustring match = row[m_liveQueryColumns.m_name];
-#ifdef DEBUG
-	cout << "mainWindow::on_queryCompletion_match: " << key << ", " << match << endl;
-#endif
 
 	return true;
 }
@@ -1062,6 +1052,9 @@
 		{
 			// Yes, it did
 			status = _("Updated document");
+			status += " ";
+			snprintf(docIdStr, 64, "%u", docId);
+			status += docIdStr;
 
 			if (pIndexTree != NULL)
 			{
@@ -1184,10 +1177,6 @@
 		status = _("Updated document");
 		set_status(status);
 	}
-	else if (type == "ListenerThread")
-	{
-		// FIXME: do something about this
-	}
 
 	// Delete the thread
 	delete pThread;;

Modified: trunk/Utils/Url.cpp
===================================================================
--- trunk/Utils/Url.cpp	2006-03-04 03:33:34 UTC (rev 135)
+++ trunk/Utils/Url.cpp	2006-03-04 05:44:16 UTC (rev 136)
@@ -14,7 +14,13 @@
  *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
  */
 
+#ifdef USE_NEON
 #include <neon/ne_uri.h>
+#else
+#ifdef USE_CURL
+#include <curl/curl.h>
+#endif
+#endif
 
 #include "StringManip.h"
 #include "Url.h"
@@ -194,7 +200,6 @@
 		{
 			canonicalUrl.replace(pos, host.length(), StringManip::toLowerCase(host));
 		}
-		canonicalUrl = escapeUrl(canonicalUrl);;
 	}
 
 	// Get rid of the last directory's slash
@@ -276,19 +281,70 @@
 /// Escapes an URL.
 string Url::escapeUrl(const string &url)
 {
-	string escapedUrlStr = "";
+	string escapedUrl(url);
 
 	if (url.empty() == false)
 	{
-		char *escapedUrl = ne_path_escape(url.c_str());
-		if (escapedUrl != NULL)
+#ifdef USE_NEON
+		char *pEscapedUrl = ne_path_escape(url.c_str());
+		if (pEscapedUrl != NULL)
 		{
-			escapedUrlStr = escapedUrl;
-			free(escapedUrl);
+			escapedUrl = pEscapedUrl;
+			free(pEscapedUrl);
 		}
+#else
+#ifdef USE_CURL
+		Url thisUrl(url);
+		string location(thisUrl.getLocation());
+		string file(thisUrl.getFile());
+		string params(thisUrl.getParameters());
+
+		if (location.empty() == false)
+		{
+			char *pEscapedUrl = curl_escape(location.c_str(), location.length());
+			if (pEscapedUrl != NULL)
+			{
+				string::size_type pos = escapedUrl.find(location.c_str());
+				if (pos != string::npos)
+				{
+					escapedUrl.replace(pos, location.length(), pEscapedUrl);
+				}
+				curl_free(pEscapedUrl);
+			}
+		}
+
+		if (file.empty() == false)
+		{
+			char *pEscapedUrl = curl_escape(file.c_str(), file.length());
+			if (pEscapedUrl != NULL)
+			{
+				string::size_type pos = escapedUrl.find(file.c_str());
+				if (pos != string::npos)
+				{
+					escapedUrl.replace(pos, file.length(), pEscapedUrl);
+				}
+				curl_free(pEscapedUrl);
+			}
+		}
+
+		if (params.empty() == false)
+		{
+			char *pEscapedUrl = curl_escape(params.c_str(), params.length());
+			if (pEscapedUrl != NULL)
+			{
+				string::size_type pos = escapedUrl.find(params.c_str());
+				if (pos != string::npos)
+				{
+					escapedUrl.replace(pos, params.length(), pEscapedUrl);
+				}
+				curl_free(pEscapedUrl);
+			}
+		}
+#endif
+#endif
 	}
 
-	return escapedUrlStr;
+	return escapedUrl;
 }
 
 /// Unescapes an URL.
@@ -298,11 +354,23 @@
 
 	if (escapedUrl.empty() == false)
 	{
+#ifdef USE_NEON
 		char *unescapedUrl = ne_path_unescape(escapedUrl.c_str());
+#else
+#ifdef USE_CURL
+		char *unescapedUrl = curl_unescape(escapedUrl.c_str(), escapedUrl.length());
+#endif
+#endif
 		if (unescapedUrl != NULL)
 		{
 			unescapedUrlStr = unescapedUrl;
+#ifdef USE_NEON
 			free(unescapedUrl);
+#else
+#ifdef USE_CURL
+			curl_free(unescapedUrl);
+#endif
+#endif
 		}
 	}
 

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2006-03-04 03:33:34 UTC (rev 135)
+++ trunk/configure.in	2006-03-04 05:44:16 UTC (rev 136)
@@ -48,6 +48,8 @@
 
 AC_LANG_CPLUSPLUS
 
+AC_PATH_PROG(PKG_CONFIG, pkg-config, no)
+
 dnl Xapian
 AC_PATH_PROG(XAPIAN_CONFIG, xapian-config, no)
 if test "$XAPIAN_CONFIG" = "no" ; then
@@ -57,16 +59,42 @@
 XAPIAN_CFLAGS=`$XAPIAN_CONFIG --cxxflags`
 XAPIAN_LIBS=`$XAPIAN_CONFIG --libs`
 
+dnl Neon or Curl ?
+AC_MSG_CHECKING(which HTTP library to use)
+AC_ARG_WITH(http, AS_HELP_STRING(--with-http@<:@=neon|curl@:>@,
+	which HTTP library to use (default: neon)))
+httplibrary=$with_http
+if test "x$httplibrary" = "x"; then
+	httplibrary="neon"
+fi
+AC_MSG_RESULT($httplibrary)
+
+case "$httplibrary" in
+neon)
+PKG_CHECK_MODULES(NEON, neon >= 0.24 )
+PKG_CHECK_MODULES(SSL, openssl >= 0.9.7 )
+HTTP_LIBRARY="USE_NEON"
+;;
+curl)
+AC_PATH_PROG(CURL_CONFIG, curl-config, no)
+if test "$CURL_CONFIG" = "no" ; then
+   AC_MSG_ERROR([Can't find curl-config in $PATH.])
+   exit 1
+fi
+CURL_CFLAGS=`$CURL_CONFIG --cflags`
+CURL_LIBS=`$CURL_CONFIG --libs`
+HTTP_LIBRARY="USE_CURL"
+;;
+esac
+
 dnl Other libraries
 MISC_LIBS="-lmagic -lcrypt"
 AC_SUBST(MISC_LIBS)
 PKG_CHECK_MODULES(SQL, sqlite3 >= 3.1 )
 AC_SUBST(SQL_CFLAGS)
 AC_SUBST(SQL_LIBS)
-PKG_CHECK_MODULES(NEON, neon >= 0.24 )
-PKG_CHECK_MODULES(SSL, openssl >= 0.9.7 )
-HTTP_CFLAGS="$NEON_CFLAGS $SSL_CFLAGS"
-HTTP_LIBS="$NEON_LIBS $SSL_LIBS"
+HTTP_CFLAGS="$NEON_CFLAGS $SSL_CFLAGS $CURL_CFLAGS -D$HTTP_LIBRARY"
+HTTP_LIBS="$NEON_LIBS $SSL_LIBS $CURL_LIBS"
 AC_SUBST(HTTP_CFLAGS)
 AC_SUBST(HTTP_LIBS)
 PKG_CHECK_MODULES(MIME, gmime-2.0 >= 2.0 )
@@ -98,6 +126,6 @@
 AC_CHECK_FUNCS(mmap)
 
 AC_OUTPUT( pinot.spec Makefile Utils/Makefile Tokenize/Makefile SQL/Makefile \
-	po/Makefile.in Collect/Makefile Search/Makefile Search/Google/Makefile \
+	po/Makefile.in Collect/Makefile Search/Makefile \
 	Index/Makefile UI/RenderHTML/Makefile UI/GTK2/src/Makefile )
 



From fabricecolin at berlios.de  Sat Mar  4 09:29:36 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Sat, 4 Mar 2006 09:29:36 +0100
Subject: [Pinot-svn] r137 - in trunk: Collect Search UI/GTK2/src Utils
Message-ID: <200603040829.k248TaDh026735@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-04 09:29:31 +0100 (Sat, 04 Mar 2006)
New Revision: 137

Modified:
   trunk/Collect/DownloaderFactory.cpp
   trunk/Collect/DownloaderFactory.h
   trunk/Collect/dloadtest.cpp
   trunk/Search/WebEngine.cpp
   trunk/UI/GTK2/src/WorkerThreads.cpp
   trunk/Utils/Url.cpp
Log:
Changed prototype of DownloaderFactory::getDownloader().
URL escaping functions no longer require curl or neon.


Modified: trunk/Collect/DownloaderFactory.cpp
===================================================================
--- trunk/Collect/DownloaderFactory.cpp	2006-03-04 05:44:16 UTC (rev 136)
+++ trunk/Collect/DownloaderFactory.cpp	2006-03-04 08:29:31 UTC (rev 137)
@@ -26,8 +26,10 @@
 #include "MboxCollector.h"
 #include "DownloaderFactory.h"
 
-/// Returns a Downloader of the specified type; NULL if unavailable.
-DownloaderInterface *DownloaderFactory::getDownloader(string protocol, string type)
+using std::string;
+
+/// Returns a Downloader; NULL if unavailable.
+DownloaderInterface *DownloaderFactory::getDownloader(const string &protocol)
 {
 	DownloaderInterface *pDownloader = NULL;
 

Modified: trunk/Collect/DownloaderFactory.h
===================================================================
--- trunk/Collect/DownloaderFactory.h	2006-03-04 05:44:16 UTC (rev 136)
+++ trunk/Collect/DownloaderFactory.h	2006-03-04 08:29:31 UTC (rev 137)
@@ -21,16 +21,14 @@
 
 #include "DownloaderInterface.h"
 
-using std::string;
-
 // Downloader factory class.
 class DownloaderFactory
 {
 	public:
 		virtual ~DownloaderFactory() {};
 
-		/// Returns a Downloader of the specified type; NULL if unavailable.
-		static DownloaderInterface *getDownloader(string protocol, string type);
+		/// Returns a Downloader; NULL if unavailable.
+		static DownloaderInterface *getDownloader(const std::string &protocol);
 
 	protected:
 		DownloaderFactory() {};

Modified: trunk/Collect/dloadtest.cpp
===================================================================
--- trunk/Collect/dloadtest.cpp	2006-03-04 05:44:16 UTC (rev 136)
+++ trunk/Collect/dloadtest.cpp	2006-03-04 08:29:31 UTC (rev 137)
@@ -20,7 +20,6 @@
 #include <iostream>
 #include <fstream>
 
-#include "HtmlTokenizer.h"
 #include "Url.h"
 #include "DownloaderFactory.h"
 
@@ -28,17 +27,16 @@
 
 int main(int argc, char **argv)
 {
-	if (argc < 3)
+	if (argc < 2)
 	{
-		cerr << "Usage: <downloader name> <URL> [STRIP]" << endl;
+		cerr << "Usage: <URL>" << endl;
 		return EXIT_FAILURE;
 	}
 
 	DownloaderInterface::initialize();
 
-	string downloaderName = argv[1];
-	
-	Url thisUrl(argv[2]);
+	string url(argv[1]);
+	Url thisUrl(url);
 	cout << "Protocol: " << thisUrl.getProtocol() << endl;
 	cout << "User: " << thisUrl.getUser() << endl;
 	cout << "Password: " << thisUrl.getPassword() << endl;
@@ -46,21 +44,19 @@
 	cout << "Location: " << thisUrl.getLocation() << endl;
 	cout << "File: " << thisUrl.getFile() << endl;
 	cout << "Parameters: " << thisUrl.getParameters() << endl;
-	cout << "Escaped URL: " << Url::escapeUrl(argv[2]) << endl;
 
 	// Which Downloader ?
-	DownloaderInterface *myDownloader = DownloaderFactory::getDownloader(thisUrl.getProtocol(),
-		downloaderName);
+	DownloaderInterface *myDownloader = DownloaderFactory::getDownloader(thisUrl.getProtocol());
 	if (myDownloader == NULL)
 	{
 		DownloaderInterface::shutdown();
-		cerr << "Couldn't obtain downloader instance (" << thisUrl.getProtocol() << "," << downloaderName << ")" << endl;
+		cerr << "Couldn't obtain downloader for protocol " << thisUrl.getProtocol() << endl;
 		return EXIT_FAILURE;
 	}
 
 	unsigned int urlContentLen;
 	string contentType;
-	DocumentInfo docInfo("Test", argv[2], "", "");
+	DocumentInfo docInfo("Test", url, "", "");
 	Document *urlDoc = myDownloader->retrieveUrl(docInfo);
 	if (urlDoc == NULL)
 	{
@@ -86,17 +82,7 @@
 			cout << "Saving " << urlContentLen << " bytes to " << fileName << endl;
 
 			ofstream outputFile(fileName.c_str());
-			//outputFile.open(fileName.c_str(), ofstream::out|ofstream::trunc);
-			// Strip tags ?
-			if ((argc >= 3) &&
-				(strncasecmp(argv[2], "STRIP", 5) == 0))
-			{
-				outputFile << HtmlTokenizer::stripTags(urlContent);
-			}
-			else
-			{
-				outputFile.write(urlContent, urlContentLen);
-			}
+			outputFile.write(urlContent, urlContentLen);
 			outputFile.close();
 		}
 		else

Modified: trunk/Search/WebEngine.cpp
===================================================================
--- trunk/Search/WebEngine.cpp	2006-03-04 05:44:16 UTC (rev 136)
+++ trunk/Search/WebEngine.cpp	2006-03-04 08:29:31 UTC (rev 137)
@@ -41,7 +41,7 @@
 	m_charset.clear();
 
 	// Any type of downloader will do...
-	DownloaderInterface *myDownloader = DownloaderFactory::getDownloader("http", "");
+	DownloaderInterface *myDownloader = DownloaderFactory::getDownloader("http");
 	if (myDownloader == NULL)
 	{
 		return NULL;

Modified: trunk/UI/GTK2/src/WorkerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.cpp	2006-03-04 05:44:16 UTC (rev 136)
+++ trunk/UI/GTK2/src/WorkerThreads.cpp	2006-03-04 08:29:31 UTC (rev 137)
@@ -759,7 +759,7 @@
 	else
 	{
 		// Get a Downloader, the default one will do
-		m_pDownloader = DownloaderFactory::getDownloader(thisUrl.getProtocol(), "");
+		m_pDownloader = DownloaderFactory::getDownloader(thisUrl.getProtocol());
 		if (m_pDownloader == NULL)
 		{
 			m_status = _("Couldn't obtain downloader for protocol");

Modified: trunk/Utils/Url.cpp
===================================================================
--- trunk/Utils/Url.cpp	2006-03-04 05:44:16 UTC (rev 136)
+++ trunk/Utils/Url.cpp	2006-03-04 08:29:31 UTC (rev 137)
@@ -14,19 +14,34 @@
  *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
  */
 
-#ifdef USE_NEON
-#include <neon/ne_uri.h>
-#else
-#ifdef USE_CURL
-#include <curl/curl.h>
-#endif
-#endif
+#include <iostream>
 
 #include "StringManip.h"
 #include "Url.h"
 
 using std::string;
+using std::cout;
+using std::endl;
 
+static const int g_rfc2396Encoded[] = {
+	1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,  /* 0x00 - 0x0f */
+	1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,  /* 0x10 - 0x1f */
+	1, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,  /*  ' ' - '/'  */
+	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0,  /*  '0' - '?'  */
+	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,  /*  '@' - 'O'  */
+	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0,  /*  'P' - '_'  */
+	1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,  /*  '`' - 'o'  */
+	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 1,  /*  'p' - 0x7f */
+	1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
+	1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
+	1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
+	1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
+	1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
+	1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
+	1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
+	1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1
+};
+
 Url::Url(const string &url)
 {
 	parse(url);
@@ -281,67 +296,31 @@
 /// Escapes an URL.
 string Url::escapeUrl(const string &url)
 {
-	string escapedUrl(url);
+	string escapedUrl;
 
-	if (url.empty() == false)
+	if (url.empty() == true)
 	{
-#ifdef USE_NEON
-		char *pEscapedUrl = ne_path_escape(url.c_str());
-		if (pEscapedUrl != NULL)
-		{
-			escapedUrl = pEscapedUrl;
-			free(pEscapedUrl);
-		}
-#else
-#ifdef USE_CURL
-		Url thisUrl(url);
-		string location(thisUrl.getLocation());
-		string file(thisUrl.getFile());
-		string params(thisUrl.getParameters());
+		return "";
+	}
 
-		if (location.empty() == false)
+	for (unsigned int pos = 0; pos < url.length(); ++pos)
+	{
+		// Encode this character ?
+		if (g_rfc2396Encoded[url[pos]] == 1)
 		{
-			char *pEscapedUrl = curl_escape(location.c_str(), location.length());
-			if (pEscapedUrl != NULL)
-			{
-				string::size_type pos = escapedUrl.find(location.c_str());
-				if (pos != string::npos)
-				{
-					escapedUrl.replace(pos, location.length(), pEscapedUrl);
-				}
-				curl_free(pEscapedUrl);
-			}
-		}
+			char currentChar = url[pos];
+			char encodedStr[4];
 
-		if (file.empty() == false)
-		{
-			char *pEscapedUrl = curl_escape(file.c_str(), file.length());
-			if (pEscapedUrl != NULL)
-			{
-				string::size_type pos = escapedUrl.find(file.c_str());
-				if (pos != string::npos)
-				{
-					escapedUrl.replace(pos, file.length(), pEscapedUrl);
-				}
-				curl_free(pEscapedUrl);
-			}
+			snprintf(encodedStr, 4, "%%%02x", (int)currentChar);
+#ifdef DEBUG
+			cout << "Url::escapeUrl: encoded " << currentChar << " as " << encodedStr << endl;
+#endif
+			escapedUrl += encodedStr;
 		}
-
-		if (params.empty() == false)
+		else
 		{
-			char *pEscapedUrl = curl_escape(params.c_str(), params.length());
-			if (pEscapedUrl != NULL)
-			{
-				string::size_type pos = escapedUrl.find(params.c_str());
-				if (pos != string::npos)
-				{
-					escapedUrl.replace(pos, params.length(), pEscapedUrl);
-				}
-				curl_free(pEscapedUrl);
-			}
+			escapedUrl += url[pos];
 		}
-#endif
-#endif
 	}
 
 	return escapedUrl;
@@ -350,31 +329,38 @@
 /// Unescapes an URL.
 string Url::unescapeUrl(const string &escapedUrl)
 {
-	string unescapedUrlStr = "";
+	string unescapedUrl;
+	unsigned int pos = 0;
 
-	if (escapedUrl.empty() == false)
+	if (escapedUrl.empty() == true)
 	{
-#ifdef USE_NEON
-		char *unescapedUrl = ne_path_unescape(escapedUrl.c_str());
-#else
-#ifdef USE_CURL
-		char *unescapedUrl = curl_unescape(escapedUrl.c_str(), escapedUrl.length());
-#endif
-#endif
-		if (unescapedUrl != NULL)
+		return "";
+	}
+
+	while (pos < escapedUrl.length())
+	{
+		if (escapedUrl[pos] == '%')
 		{
-			unescapedUrlStr = unescapedUrl;
-#ifdef USE_NEON
-			free(unescapedUrl);
-#else
-#ifdef USE_CURL
-			curl_free(unescapedUrl);
-#endif
-#endif
+			char numberStr[3];
+			unsigned int number;
+
+			numberStr[0] = escapedUrl[pos + 1];
+			numberStr[1] = escapedUrl[pos + 2];
+			numberStr[2] = '\0';
+			if (sscanf(numberStr, "%x", &number) == 1)
+			{
+				unescapedUrl += (char)(0x0ff & number);
+				pos += 3;
+			}
 		}
+		else
+		{
+			unescapedUrl += escapedUrl[pos];
+			++pos;
+		}
 	}
 
-	return unescapedUrlStr;
+	return unescapedUrl;
 }
 
 string Url::getProtocol(void) const



From fabricecolin at berlios.de  Mon Mar  6 16:45:30 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Mon, 6 Mar 2006 16:45:30 +0100
Subject: [Pinot-svn] r138 - trunk/Tokenize
Message-ID: <200603061545.k26FjUNs013050@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-06 16:45:28 +0100 (Mon, 06 Mar 2006)
New Revision: 138

Modified:
   trunk/Tokenize/Makefile.am
Log:
Try harder to build working tokenizers ! They were not linked against libUtils.


Modified: trunk/Tokenize/Makefile.am
===================================================================
--- trunk/Tokenize/Makefile.am	2006-03-04 08:29:31 UTC (rev 137)
+++ trunk/Tokenize/Makefile.am	2006-03-06 15:45:28 UTC (rev 138)
@@ -14,33 +14,25 @@
 noinst_LTLIBRARIES = libTokenize.la
 
 libpdftokenizer_la_SOURCES = \
-	../Utils/StringManip.cpp \
 	PdfTokenizer.cpp \
 	HtmlTokenizer.cpp \
 	Tokenizer.cpp
 
-libpdftokenizer_la_LDFLAGS =
+libpdftokenizer_la_LIBADD = -L../Utils -lUtils
 
-libpdftokenizer_la_LIBADD =
-
 librtftokenizer_la_SOURCES = \
-	../Utils/StringManip.cpp \
 	RtfTokenizer.cpp \
 	HtmlTokenizer.cpp \
 	Tokenizer.cpp
 
-librtftokenizer_la_LDFLAGS =
+librtftokenizer_la_LIBADD = -L../Utils -lUtils
 
-librtftokenizer_la_LIBADD =
-
 libwordtokenizer_la_SOURCES = \
 	WordTokenizer.cpp \
 	Tokenizer.cpp
 
-libwordtokenizer_la_LDFLAGS =
+libwordtokenizer_la_LIBADD = -L../Utils -lUtils
 
-libwordtokenizer_la_LIBADD =
-
 libTokenize_la_SOURCES = \
 	HtmlTokenizer.cpp \
 	Tokenizer.cpp \



From fabricecolin at berlios.de  Mon Mar  6 16:46:49 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Mon, 6 Mar 2006 16:46:49 +0100
Subject: [Pinot-svn] r139 - trunk/Index
Message-ID: <200603061546.k26FknrO013176@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-06 16:46:49 +0100 (Mon, 06 Mar 2006)
New Revision: 139

Modified:
   trunk/Index/IndexInterface.h
   trunk/Index/XapianIndex.cpp
   trunk/Index/XapianIndex.h
Log:
Method getDocumentsWithLabel() becomes listDocumentsWithLabel(), unified with
listDocuments().


Modified: trunk/Index/IndexInterface.h
===================================================================
--- trunk/Index/IndexInterface.h	2006-03-06 15:45:28 UTC (rev 138)
+++ trunk/Index/IndexInterface.h	2006-03-06 15:46:49 UTC (rev 139)
@@ -53,9 +53,6 @@
 		/// Returns a document's labels.
 		virtual bool getDocumentLabels(unsigned int docId, std::set<std::string> &labels) const = 0;
 
-		/// Returns documents that have a label.
-		virtual bool getDocumentsWithLabel(const std::string &name, std::set<unsigned int> &docIds) const = 0;
-
 		/// Updates the given document.
 		virtual bool updateDocument(unsigned int docId, Tokenizer &tokens) = 0;
 
@@ -94,6 +91,10 @@
 		virtual unsigned int listDocuments(std::set<unsigned int> &docIDList,
 			unsigned int maxDocsCount = 0, unsigned int startDoc = 0) const = 0;
 
+		/// Lists documents that have a label.
+		virtual bool listDocumentsWithLabel(const std::string &name, std::set<unsigned int> &docIds,
+			unsigned int maxDocsCount = 0, unsigned int startDoc = 0) const = 0;
+
 	protected:
 		StemmingMode m_stemMode;
 		bool m_goodIndex;

Modified: trunk/Index/XapianIndex.cpp
===================================================================
--- trunk/Index/XapianIndex.cpp	2006-03-06 15:45:28 UTC (rev 138)
+++ trunk/Index/XapianIndex.cpp	2006-03-06 15:46:49 UTC (rev 139)
@@ -310,6 +310,56 @@
 	doc.add_value(0, timeStr);
 }
 
+bool XapianIndex::listDocumentsWithTerm(const string &term, set<unsigned int> &docIds,
+	unsigned int maxDocsCount, unsigned int startDoc) const
+{
+	unsigned int docCount = 0;
+
+	XapianDatabase *pDatabase = XapianDatabaseFactory::getDatabase(m_databaseName, false);
+	if (pDatabase == NULL)
+	{
+		cerr << "Bad index " << m_databaseName << endl;
+		return 0;
+	}
+
+	docIds.clear();
+	try
+	{
+		Xapian::Database *pIndex = pDatabase->readLock();
+		if (pIndex != NULL)
+		{
+#ifdef DEBUG
+			cout << "XapianIndex::listDocumentsWithTerm: term " << term << endl;
+#endif
+			// Get a list of documents that have the term
+			for (Xapian::PostingIterator postingIter = pIndex->postlist_begin(term);
+				(postingIter != pIndex->postlist_end(term)) && (docIds.size() < maxDocsCount);
+				++postingIter)
+			{
+				Xapian::docid docId = *postingIter;
+
+				// We cannot use postingIter->skip_to() because startDoc isn't an ID
+				if (docCount >= startDoc)
+				{
+					docIds.insert(docId);
+				}
+				++docCount;
+			}
+		}
+	}
+	catch (const Xapian::Error &error)
+	{
+		cerr << "Couldn't get document list: " << error.get_msg() << endl;
+	}
+	catch (...)
+	{
+		cerr << "Couldn't get document list, unknown exception occured" << endl;
+	}
+	pDatabase->unlock();
+
+	return docIds.size();
+}
+
 //
 // Implementation of IndexInterface
 //
@@ -556,51 +606,6 @@
 	return gotLabels;
 }
 
-/// Returns documents that have a label.
-bool XapianIndex::getDocumentsWithLabel(const string &name, set<unsigned int> &docIds) const
-{
-	bool lookedForLabel = false;
-
-	XapianDatabase *pDatabase = XapianDatabaseFactory::getDatabase(m_databaseName, false);
-	if (pDatabase == NULL)
-	{
-		cerr << "Bad index " << m_databaseName << endl;
-		return false;
-	}
-
-	docIds.clear();
-	try
-	{
-		Xapian::WritableDatabase *pIndex = pDatabase->writeLock();
-		if (pIndex != NULL)
-		{
-			string term("XLABEL:");
-
-			// Get documents that have this label
-			term += name;
-			for (Xapian::PostingIterator postingIter = pIndex->postlist_begin(term);
-				postingIter != pIndex->postlist_end(term); ++postingIter)
-			{
-				Xapian::docid docId = *postingIter;
-
-				docIds.insert(docId);
-			}
-			lookedForLabel = true;
-		}
-	}
-	catch (const Xapian::Error &error)
-	{
-		cerr << "Couldn't get documents: " << error.get_msg() << endl;
-	}
-	catch (...)
-	{
-		cerr << "Couldn't get documents, unknown exception occured" << endl;
-	}
-	pDatabase->unlock();
-
-	return lookedForLabel;
-}
-
 /// Updates the given document; true if success.
 bool XapianIndex::updateDocument(unsigned int docId, Tokenizer &tokens)
 {
@@ -1147,46 +1152,17 @@
 unsigned int XapianIndex::listDocuments(set<unsigned int> &docIds,
 	unsigned int maxDocsCount, unsigned int startDoc) const
 {
-	unsigned int docCount = 0;
+	// Get documents that have the magic term
+	return listDocumentsWithTerm(MAGIC_TERM, docIds, maxDocsCount, startDoc);
+}
 
-	XapianDatabase *pDatabase = XapianDatabaseFactory::getDatabase(m_databaseName, false);
-	if (pDatabase == NULL)
-	{
-		cerr << "Bad index " << m_databaseName << endl;
-		return 0;
-	}
+/// Lists documents that have a label.
+bool XapianIndex::listDocumentsWithLabel(const string &name, set<unsigned int> &docIds,
+	unsigned int maxDocsCount, unsigned int startDoc) const
+{
+	string term("XLABEL:");
 
-	docIds.clear();
-	try
-	{
-		Xapian::Database *pIndex = pDatabase->readLock();
-		if (pIndex != NULL)
-		{
-			// Get a list of documents that have the magic term
-			for (Xapian::PostingIterator postingIter = pIndex->postlist_begin(MAGIC_TERM);
-				(postingIter != pIndex->postlist_end(MAGIC_TERM)) && (docIds.size() < maxDocsCount);
-				++postingIter)
-			{
-				Xapian::docid docId = *postingIter;
-
-				// We cannot use postingIter->skip_to() because startDoc isn't an ID
-				if (docCount >= startDoc)
-				{
-					docIds.insert(docId);
-				}
-				++docCount;
-			}
-		}
-	}
-	catch (const Xapian::Error &error)
-	{
-		cerr << "Couldn't get document list: " << error.get_msg() << endl;
-	}
-	catch (...)
-	{
-		cerr << "Couldn't get document list, unknown exception occured" << endl;
-	}
-	pDatabase->unlock();
-
-	return docIds.size();
+	// Get documents that have this label
+	term += name;
+	return listDocumentsWithTerm(term, docIds, maxDocsCount, startDoc);
 }

Modified: trunk/Index/XapianIndex.h
===================================================================
--- trunk/Index/XapianIndex.h	2006-03-06 15:45:28 UTC (rev 138)
+++ trunk/Index/XapianIndex.h	2006-03-06 15:46:49 UTC (rev 139)
@@ -47,9 +47,6 @@
 		/// Returns a document's labels.
 		virtual bool getDocumentLabels(unsigned int docId, std::set<std::string> &labels) const;
 
-		/// Returns documents that have a label.
-		virtual bool getDocumentsWithLabel(const std::string &name, std::set<unsigned int> &docIds) const;
-
 		/// Updates the given document.
 		virtual bool updateDocument(unsigned int docId, Tokenizer &tokens);
 
@@ -88,6 +85,10 @@
 		virtual unsigned int listDocuments(std::set<unsigned int> &docIds,
 			unsigned int maxDocsCount = 0, unsigned int startDoc = 0) const;
 
+		/// Lists documents that have a label.
+		virtual bool listDocumentsWithLabel(const std::string &name, std::set<unsigned int> &docIds,
+			unsigned int maxDocsCount = 0, unsigned int startDoc = 0) const;
+
 	protected:
 		static const unsigned int m_maxTermLength;
 		static const std::string MAGIC_TERM;
@@ -110,6 +111,9 @@
 		void setDocumentData(Xapian::Document &doc, const DocumentInfo &info,
 			const std::string &language) const;
 
+		bool listDocumentsWithTerm(const std::string &term, std::set<unsigned int> &docIds,
+			unsigned int maxDocsCount = 0, unsigned int startDoc = 0) const;
+
 	private:
 		XapianIndex(const XapianIndex &other);
 		XapianIndex &operator=(const XapianIndex &other);



From fabricecolin at berlios.de  Mon Mar  6 16:48:42 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Mon, 6 Mar 2006 16:48:42 +0100
Subject: [Pinot-svn] r140 - trunk/UI/GTK2/src
Message-ID: <200603061548.k26FmgoX013370@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-06 16:48:41 +0100 (Mon, 06 Mar 2006)
New Revision: 140

Modified:
   trunk/UI/GTK2/src/IndexTree.cpp
   trunk/UI/GTK2/src/IndexTree.h
   trunk/UI/GTK2/src/MonitorHandler.cpp
   trunk/UI/GTK2/src/WorkerThreads.cpp
   trunk/UI/GTK2/src/WorkerThreads.h
   trunk/UI/GTK2/src/mainWindow.cc
   trunk/UI/GTK2/src/mainWindow.hh
Log:
First shot at unifying index browsing and label querying. LabelQueryThread has
been dropped amongst other things.


Modified: trunk/UI/GTK2/src/IndexTree.cpp
===================================================================
--- trunk/UI/GTK2/src/IndexTree.cpp	2006-03-06 15:46:49 UTC (rev 139)
+++ trunk/UI/GTK2/src/IndexTree.cpp	2006-03-06 15:48:41 UTC (rev 140)
@@ -62,7 +62,7 @@
 
 	// The score column is used for status icons
 	TreeViewColumn *treeColumn = create_resizable_column_with_icon(_("Title"), m_indexColumns.m_text,
-		SigC::slot(*this, &IndexTree::renderLabel));
+		SigC::slot(*this, &IndexTree::renderColour));
 	if (treeColumn != NULL)
 	{
 		append_column(*manage(treeColumn));
@@ -94,8 +94,8 @@
 	// Initially, don't display the list of indexed documents
 	m_listingIndex = false;
 
-	// By default, no particular label is selected
-	setCurrentLabelColour(0, 0, 0, false);
+	// By default, no particular colour is selected
+	setCurrentBackgroundColour(0, 0, 0, false);
 
 	// Show all
 	m_pIndexScrolledwindow->show();
@@ -106,7 +106,7 @@
 {
 }
 
-void IndexTree::renderLabel(CellRenderer *renderer, const TreeModel::iterator &iter)
+void IndexTree::renderColour(CellRenderer *renderer, const TreeModel::iterator &iter)
 {
 	TreeModel::Row row = *iter;
 
@@ -118,7 +118,7 @@
 	CellRendererText *textRenderer = dynamic_cast<CellRendererText*>(renderer);
 	if (textRenderer != NULL)
 	{
-		if ((m_showingLabel == false) &&
+		if ((m_visibleColour == false) &&
 			(row[m_indexColumns.m_labeled] == true))
 		{
 			// Reset this
@@ -127,7 +127,7 @@
 		else if (row[m_indexColumns.m_labeled] == true)
 		{
 			// Change the row's background
-			textRenderer->property_background_gdk() = m_currentLabelColour;
+			textRenderer->property_background_gdk() = m_currentBackgroundColour;
 		}
 		else
 		{
@@ -200,7 +200,7 @@
 //
 // Appends a new row in the index tree.
 //
-bool IndexTree::appendDocument(const IndexedDocument &docInfo, bool labeled)
+bool IndexTree::appendDocument(const IndexedDocument &docInfo, bool withColour)
 {
 	TreeModel::iterator newRowIter = m_refStore->append();
 	TreeModel::Row childRow = *newRowIter;
@@ -219,7 +219,7 @@
 	childRow[m_indexColumns.m_type] = to_utf8(docInfo.getType());
 	childRow[m_indexColumns.m_language] = to_utf8(docInfo.getLanguage());
 	childRow[m_indexColumns.m_timestamp] = to_utf8(docInfo.getTimestamp());
-	childRow[m_indexColumns.m_labeled] = labeled;
+	childRow[m_indexColumns.m_labeled] = withColour;
 	childRow[m_indexColumns.m_id] = docInfo.getID();
 
 	// If the tree was empty, it is no longer
@@ -327,19 +327,19 @@
 }
 
 //
-// Sets the current label colour.
+// Sets the current background colour.
 //
-void IndexTree::setCurrentLabelColour(unsigned short red, unsigned short green, unsigned short blue,
-	bool showingLabel)
+void IndexTree::setCurrentBackgroundColour(unsigned short red, unsigned short green, unsigned short blue,
+	bool isVisible)
 {
-	m_currentLabelColour.set_rgb(red, green, blue);
-	m_showingLabel = showingLabel;
+	m_currentBackgroundColour.set_rgb(red, green, blue);
+	m_visibleColour = isVisible;
 }
 
 //
-// Sets the documents that match the current label.
+// Sets the documents that match the current background colour.
 //
-void IndexTree::setLabel(const set<unsigned int> &documentsList)
+void IndexTree::setColourDocuments(const set<unsigned int> &documentsList)
 {
 	// Unselect all
 	get_selection()->unselect_all();
@@ -348,7 +348,7 @@
 	TreeModel::Children children = m_refStore->children();
 	for (TreeModel::Children::iterator iter = children.begin(); iter != children.end(); ++iter)
 	{
-		// Does this document match the label ?
+		// Does this document match the colour ?
 		TreeModel::Row row = *iter;
 		unsigned int docId = row[m_indexColumns.m_id];
 
@@ -356,9 +356,6 @@
 		if (docIter != documentsList.end())
 		{
 			// Yes, it does !
-#ifdef DEBUG
-			cout << "IndexTree::setLabel: label is in document " << docId << endl;
-#endif
 			row[m_indexColumns.m_labeled] = true;
 		}
 		else
@@ -396,9 +393,9 @@
 }
 
 //
-// Marks a document as labeled.
+// Marks a document as coloured.
 //
-void IndexTree::setDocumentLabeledState(unsigned int docId, bool labeled)
+void IndexTree::setDocumentColourState(unsigned int docId, bool withColour)
 {
 	if (docId == 0)
 	{
@@ -413,7 +410,7 @@
 
 		if (docId == row[m_indexColumns.m_id])
 		{
-			row[m_indexColumns.m_labeled] = labeled;
+			row[m_indexColumns.m_labeled] = withColour;
 			break;
 		}
 	}
@@ -442,7 +439,7 @@
 		itemPath = selectedItems.begin();
 	}
 #ifdef DEBUG
-	cout << "IndexTree::setLabel: deleted " << selectedItems.size() << " documents" << endl;
+	cout << "IndexTree::deleteSelection: deleted " << selectedItems.size() << " documents" << endl;
 #endif
 
 	TreeModel::Children children = m_refStore->children();

Modified: trunk/UI/GTK2/src/IndexTree.h
===================================================================
--- trunk/UI/GTK2/src/IndexTree.h	2006-03-06 15:46:49 UTC (rev 139)
+++ trunk/UI/GTK2/src/IndexTree.h	2006-03-06 15:48:41 UTC (rev 140)
@@ -49,7 +49,7 @@
 		bool addDocuments(const std::vector<IndexedDocument> &documentsList);
 
 		/// Appends a new row in the index tree.
-		bool appendDocument(const IndexedDocument &docInfo, bool labeled);
+		bool appendDocument(const IndexedDocument &docInfo, bool withColour);
 
 		/// Gets the first selected item's URL.
 		Glib::ustring getFirstSelectionURL(void);
@@ -60,18 +60,18 @@
 		/// Gets a list of selected items.
 		bool getSelection(std::vector<IndexedDocument> &documentsList);
 
-		/// Sets the current label colour.
-		void setCurrentLabelColour(unsigned short red, unsigned short green, unsigned short blue,
-			bool showingLabel = true);
+		/// Sets the current background colour.
+		void setCurrentBackgroundColour(unsigned short red, unsigned short green, unsigned short blue,
+			bool isVisible = true);
 
-		/// Sets the documents that match the current label.
-		void setLabel(const std::set<unsigned int> &documentsList);
+		/// Sets the documents that match the current background colour.
+		void setColourDocuments(const std::set<unsigned int> &documentsList);
 
 		/// Updates a document's properties.
 		void updateDocumentInfo(unsigned int docId, const DocumentInfo &docInfo);
 
-		/// Marks a document as labeled.
-		void setDocumentLabeledState(unsigned int docId, bool labeled);
+		/// Marks a document as coloured.
+		void setDocumentColourState(unsigned int docId, bool withColour);
 
 		/**
 		  * Deletes the current selection.
@@ -106,11 +106,11 @@
 		SigC::Signal1<void, Glib::ustring> m_signalSelectionChanged;
 		PinotSettings &m_settings;
 		IndexModelColumns m_indexColumns;
-		Gdk::Color m_currentLabelColour;
-		bool m_showingLabel;
+		Gdk::Color m_currentBackgroundColour;
+		bool m_visibleColour;
 		bool m_listingIndex;
 
-		void renderLabel(Gtk::CellRenderer *renderer, const Gtk::TreeModel::iterator &iter);
+		void renderColour(Gtk::CellRenderer *renderer, const Gtk::TreeModel::iterator &iter);
 
 		void onButtonPressEvent(GdkEventButton *ev);
 

Modified: trunk/UI/GTK2/src/MonitorHandler.cpp
===================================================================
--- trunk/UI/GTK2/src/MonitorHandler.cpp	2006-03-06 15:46:49 UTC (rev 139)
+++ trunk/UI/GTK2/src/MonitorHandler.cpp	2006-03-06 15:48:41 UTC (rev 140)
@@ -234,7 +234,7 @@
 	}
 
 	// Unindex all documents labeled with this source label
-	if ((pIndex->getDocumentsWithLabel(sourceLabel, docIdList) == true) &&
+	if ((pIndex->listDocumentsWithLabel(sourceLabel, docIdList) == true) &&
 		(docIdList.empty() == false))
 	{
 #ifdef DEBUG

Modified: trunk/UI/GTK2/src/WorkerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.cpp	2006-03-06 15:46:49 UTC (rev 139)
+++ trunk/UI/GTK2/src/WorkerThreads.cpp	2006-03-06 15:48:41 UTC (rev 140)
@@ -340,9 +340,10 @@
 }
 
 IndexBrowserThread::IndexBrowserThread(const string &indexName,
-	unsigned int maxDocsCount, unsigned int startDoc) :
+	const string &labelName, unsigned int maxDocsCount, unsigned int startDoc) :
 	WorkerThread(),
 	m_indexName(indexName),
+	m_labelName(labelName),
 	m_indexDocsCount(0),
 	m_maxDocsCount(maxDocsCount),
 	m_startDoc(startDoc)
@@ -363,6 +364,11 @@
 	return m_indexName;
 }
 
+string IndexBrowserThread::getLabelName(void) const
+{
+	return m_labelName;
+}
+
 unsigned int IndexBrowserThread::getDocumentsCount(void) const
 {
 	return m_indexDocsCount;
@@ -423,7 +429,14 @@
 	cout << "IndexBrowserThread::doWork: " << m_maxDocsCount << " off " << m_indexDocsCount
 		<< " documents to browse, starting at " << m_startDoc << endl;
 #endif
-	index.listDocuments(docIDList, m_maxDocsCount, m_startDoc);
+	if (m_labelName.empty() == true)
+	{
+		index.listDocuments(docIDList, m_maxDocsCount, m_startDoc);
+	}
+	else
+	{
+		index.listDocumentsWithLabel(m_labelName, docIDList, m_maxDocsCount, m_startDoc);
+	}
 	for (set<unsigned int>::iterator iter = docIDList.begin(); iter != docIDList.end(); ++iter)
 	{
 		if (m_done == true)
@@ -567,71 +580,6 @@
 	delete engine;
 }
 
-LabelQueryThread::LabelQueryThread(const string &indexName, const string &labelName) :
-	WorkerThread(),
-	m_indexName(indexName),
-	m_labelName(labelName)
-{
-}
-
-LabelQueryThread::~LabelQueryThread()
-{
-}
-
-string LabelQueryThread::getType(void) const
-{
-	return "LabelQueryThread";
-}
-
-string LabelQueryThread::getIndexName(void) const
-{
-	return m_indexName;
-}
-
-string LabelQueryThread::getLabelName(void) const
-{
-	return m_labelName;
-}
-
-bool LabelQueryThread::stop(void)
-{
-	m_done = true;
-	m_status = _("Stopped querying index labels");
-	return true;
-}
-
-const set<unsigned int> &LabelQueryThread::getDocumentsList(void) const
-{
-	return m_documentsList;
-}
-
-void LabelQueryThread::doWork(void)
-{
-	const map<string, string> &indexesMap = PinotSettings::getInstance().getIndexes();
-
-	map<string, string>::const_iterator mapIter = indexesMap.find(m_indexName);
-	if (mapIter == indexesMap.end())
-	{
-		m_status = _("Index");
-		m_status += " ";
-		m_status += m_indexName;
-		m_status += " ";
-		m_status += _("doesn't exist");
-		return;
-	}
-
-	XapianIndex index(mapIter->second);
-	if (index.isGood() == false)
-	{
-		m_status = _("Index error on");
-		m_status += " ";
-		m_status += mapIter->second;
-		return;
-	}
-
-	index.getDocumentsWithLabel(m_labelName, m_documentsList);
-}
-
 LabelUpdateThread::LabelUpdateThread(const set<string> &labelsToDelete,
 	const map<string, string> &labelsToRename)
 {

Modified: trunk/UI/GTK2/src/WorkerThreads.h
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.h	2006-03-06 15:46:49 UTC (rev 139)
+++ trunk/UI/GTK2/src/WorkerThreads.h	2006-03-06 15:48:41 UTC (rev 140)
@@ -126,7 +126,7 @@
 class IndexBrowserThread : public WorkerThread
 {
 	public:
-		IndexBrowserThread(const std::string &indexName,
+		IndexBrowserThread(const std::string &indexName, const std::string &labelName,
 			unsigned int maxDocsCount, unsigned int startDoc);
 		~IndexBrowserThread();
 
@@ -134,6 +134,8 @@
 
 		std::string getIndexName(void) const;
 
+		std::string getLabelName(void) const;
+
 		unsigned int getDocumentsCount(void) const;
 
 		virtual bool stop(void);
@@ -142,6 +144,7 @@
 
 	protected:
 		std::string m_indexName;
+		std::string m_labelName;
 		unsigned int m_indexDocsCount;
 		unsigned int m_maxDocsCount;
 		unsigned int m_startDoc;
@@ -188,35 +191,6 @@
 
 };
 
-class LabelQueryThread : public WorkerThread
-{
-	public:
-		LabelQueryThread(const std::string &indexName, const std::string &labelName);
-		virtual ~LabelQueryThread();
-
-		virtual std::string getType(void) const;
-
-		std::string getIndexName(void) const;
-
-		std::string getLabelName(void) const;
-
-		virtual bool stop(void);
-
-		const std::set<unsigned int> &getDocumentsList(void) const;
-
-	protected:
-		std::string m_indexName;
-		std::string m_labelName;
-		std::set<unsigned int> m_documentsList;
-
-		virtual void doWork(void);
-
-	private:
-		LabelQueryThread(const LabelQueryThread &other);
-		LabelQueryThread &operator=(const LabelQueryThread &other);
-
-};
-
 class LabelUpdateThread : public WorkerThread
 {
 	public:

Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2006-03-06 15:46:49 UTC (rev 139)
+++ trunk/UI/GTK2/src/mainWindow.cc	2006-03-06 15:48:41 UTC (rev 140)
@@ -543,6 +543,7 @@
 {
 	IndexTree *pIndexTree = NULL;
 	IndexPage *pIndexPage = NULL;
+	ustring labelName;
 	bool foundPage = false;
 
 #ifdef DEBUG
@@ -559,6 +560,7 @@
 		{
 			pIndexTree->clear();
 		}
+		labelName = pIndexPage->getLabelName();
 		foundPage = true;
 	}
 
@@ -603,7 +605,7 @@
 
 	if (foundPage == true)
 	{
-		browse_index(indexName, 0);
+		browse_index(indexName, labelName, 0);
 	}
 }
 
@@ -626,16 +628,7 @@
 #ifdef DEBUG
 	cout << "mainWindow::on_label_changed: called on " << labelName << endl;
 #endif
-	pIndexTree->setCurrentLabelColour(0, 0, 0, false);
-	if (labelName.empty() == true)
-	{
-		// User selected no label
-		set_status(_("No label"));
-		return;
-	}
-
-	// Get the documents that match this label
-	start_thread(new LabelQueryThread(indexName, labelName));
+	browse_index(indexName, labelName, 0);
 }
 
 //
@@ -762,6 +755,7 @@
 		IndexPage *pIndexPage = NULL;
 		IndexTree *pIndexTree = NULL;
 		ustring indexName = to_utf8(pBrowseThread->getIndexName());
+		ustring labelName = to_utf8(pBrowseThread->getLabelName());
 
 		// Find the page for this index
 		pIndexPage = dynamic_cast<IndexPage*>(get_page(indexName, NotebookPageBox::INDEX_PAGE));
@@ -900,70 +894,6 @@
 			}
 		}
 	}
-	else if (type == "LabelQueryThread")
-	{
-		LabelQueryThread *pLabelQueryThread = dynamic_cast<LabelQueryThread *>(pThread);
-		if (pLabelQueryThread == NULL)
-		{
-			delete pThread;
-			return;
-		}
-		ustring indexName = to_utf8(pLabelQueryThread->getIndexName());
-
-		IndexPage *pIndexPage = dynamic_cast<IndexPage*>(get_page(indexName, NotebookPageBox::INDEX_PAGE));
-		if (pIndexPage == NULL)
-		{
-			return;
-		}
-		IndexTree *pIndexTree = pIndexPage->getTree();
-		if (pIndexTree == NULL)
-		{
-			return;
-		}
-
-		// Don't bother if the index is not being listed, or if the user
-		// changed the label in the meantime
-		ustring labelName = pIndexPage->getLabelName();
-		if ((pIndexTree->isEmpty() == false) &&
-			(labelName.empty() == false) &&
-			(labelName == to_utf8(pLabelQueryThread->getLabelName())))
-		{
-			const set<unsigned int> &documentsList = pLabelQueryThread->getDocumentsList();
-			char docsCountStr[64];
-			unsigned int docsCount = documentsList.size();
-
-			status = _("Label");
-			status += " ";
-			status += labelName;
-			status += " ";
-			status += _("matches");
-			status += " ";
-			snprintf(docsCountStr, 64, "%u", docsCount);
-			status += docsCountStr;
-			status += " ";
-			status += _("document(s)");
-			set_status(status);
-
-#ifdef DEBUG
-			cout << "mainWindow::on_thread_end: current label is " << labelName << endl;
-#endif
-			// Get the actual label colour from the settings
-			for (set<PinotSettings::Label>::iterator labelIter = m_settings.m_labels.begin();
-				labelIter != m_settings.m_labels.end(); ++labelIter)
-			{
-				if (labelName == labelIter->m_name)
-				{
-					// Display the selected label's colour in the index tree
-					pIndexTree->setCurrentLabelColour(labelIter->m_red, labelIter->m_green, labelIter->m_blue);
-					pIndexTree->setLabel(documentsList);
-
-					// Switch to the index page
-					m_pNotebook->set_current_page(get_page_number(indexName, NotebookPageBox::INDEX_PAGE));
-					break;
-				}
-			}
-		}
-	}
 	else if (type == "LabelUpdateThread")
 	{
 		LabelUpdateThread *pLabelUpdateThread = dynamic_cast<LabelUpdateThread *>(pThread);
@@ -1144,7 +1074,7 @@
 				if ((docsCount >= pIndexPage->getFirstDocument() + m_maxDocsCount))
 				{
 					// Refresh this page
-					browse_index(indexName, pIndexPage->getFirstDocument());
+					browse_index(indexName, pIndexPage->getLabelName(), pIndexPage->getFirstDocument());
 				}
 			}
 		}
@@ -1351,10 +1281,6 @@
 					IndexTree *pIndexTree = pIndexPage->getTree();
 
 					// Synchronize the labels list with the new settings
-					if (pIndexTree != NULL)
-					{
-						pIndexTree->setCurrentLabelColour(0, 0, 0, false);
-					}
 					pIndexPage->populateLabelCombobox();
 				}
 			}
@@ -1780,11 +1706,11 @@
 
 		// Is the index still being shown ?
 		IndexTree *pIndexTree = NULL;
-		NotebookPageBox *pPage = get_page(indexName, NotebookPageBox::INDEX_PAGE);
-		if (pPage != NULL)
+		IndexPage *pIndexPage = dynamic_cast<IndexPage*>(get_page(indexName, NotebookPageBox::INDEX_PAGE));
+		if (pIndexPage != NULL)
 		{
 			// Refresh
-			browse_index(indexName, 0);
+			browse_index(indexName, pIndexPage->getLabelName(), 0);
 		}
 	}
 }
@@ -1980,7 +1906,7 @@
 		if (matchesLabel != matchedLabel)
 		{
 			// Update this document to the index tree
-			pIndexTree->setDocumentLabeledState(docId, matchesLabel);
+			pIndexTree->setDocumentColourState(docId, matchesLabel);
 		}
 
 		// Did the title change ?
@@ -1999,7 +1925,7 @@
 		{
 			// The current label may have been applied to or removed from
 			// one or more of the selected documents, so refresh the list
-			start_thread(new LabelQueryThread(indexName, labelName));
+			start_thread(new IndexBrowserThread(indexName, labelName, 0, 0));
 		}
 	}
 }
@@ -2376,7 +2302,7 @@
 	{
 		if (pIndexPage->getFirstDocument() >= m_maxDocsCount)
 		{
-			browse_index(indexName, pIndexPage->getFirstDocument() - m_maxDocsCount);
+			browse_index(indexName, pIndexPage->getLabelName(), pIndexPage->getFirstDocument() - m_maxDocsCount);
 		}
 	}
 }
@@ -2394,14 +2320,14 @@
 #ifdef DEBUG
 			cout << "mainWindow::on_indexForwardButton_clicked: first" << endl;
 #endif
-			browse_index(indexName, 0);
+			browse_index(indexName, pIndexPage->getLabelName(), 0);
 		}
 		else if (pIndexPage->getDocumentsCount() >= pIndexPage->getFirstDocument() + m_maxDocsCount)
 		{
 #ifdef DEBUG
 			cout << "mainWindow::on_indexForwardButton_clicked: next" << endl;
 #endif
-			browse_index(indexName, pIndexPage->getFirstDocument() + m_maxDocsCount);
+			browse_index(indexName, pIndexPage->getLabelName(), pIndexPage->getFirstDocument() + m_maxDocsCount);
 		}
 #ifdef DEBUG
 		cout << "mainWindow::on_indexForwardButton_clicked: counts "
@@ -2797,7 +2723,8 @@
 //
 // Browse an index
 //
-void mainWindow::browse_index(const ustring &indexName, unsigned int startDoc)
+void mainWindow::browse_index(const ustring &indexName,
+	const ustring &labelName, unsigned int startDoc)
 {
 	// Rudimentary lock
 	if (m_state.m_browsingIndex == true)
@@ -2823,7 +2750,7 @@
 
 	// Spawn a new thread to browse the index
 	IndexBrowserThread *pBrowseThread = new IndexBrowserThread(
-		from_utf8(indexName), m_maxDocsCount, startDoc);
+		from_utf8(indexName), labelName, m_maxDocsCount, startDoc);
 	pBrowseThread->getUpdateSignal().connect(SigC::slot(*this,
 		&mainWindow::on_message_indexupdate));
 	start_thread(pBrowseThread);

Modified: trunk/UI/GTK2/src/mainWindow.hh
===================================================================
--- trunk/UI/GTK2/src/mainWindow.hh	2006-03-06 15:46:49 UTC (rev 139)
+++ trunk/UI/GTK2/src/mainWindow.hh	2006-03-06 15:48:41 UTC (rev 140)
@@ -126,7 +126,8 @@
 		unsigned int docId = 0);
 	void edit_query(QueryProperties &queryProps, bool newQuery);
 	void run_search(const QueryProperties &queryProps);
-	void browse_index(const Glib::ustring &indexName, unsigned int startDoc);
+	void browse_index(const Glib::ustring &indexName,
+		const Glib::ustring &labelName, unsigned int startDoc);
 	void index_document(const DocumentInfo &docInfo, const std::string &labelName,
 		unsigned int docId = 0);
 	bool view_document(const std::string &url, bool internalViewerOnly = false);



From fabricecolin at berlios.de  Mon Mar  6 16:55:43 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Mon, 6 Mar 2006 16:55:43 +0100
Subject: [Pinot-svn] r141 - trunk
Message-ID: <200603061555.k26FthS7014594@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-06 16:55:42 +0100 (Mon, 06 Mar 2006)
New Revision: 141

Modified:
   trunk/README
   trunk/configure.in
   trunk/pinot.spec.in
Log:
Curl is used by default in place of Neon. Updated RPM spec as well as
requirements and mini FAQ in README file.


Modified: trunk/README
===================================================================
--- trunk/README	2006-03-06 15:48:41 UTC (rev 140)
+++ trunk/README	2006-03-06 15:55:42 UTC (rev 141)
@@ -12,78 +12,89 @@
 Name			Location			Version used
 ----			--------			------------
 
-SQLite							sqlite-devel-3.1.2-1
+SQLite							3.1.2
 http://www.sqlite.org/
 
-xapian-core						xapian-core-devel-0.9.2-1
+xapian-core						0.9.4
 http://www.xapian.org/
 
-neon							neon-devel-0.24.7-4
+curl (1)						7.13.1
+http://curl.haxx.se/
+- OR -
+neon (1)						0.24.7
 http://www.webdav.org/neon/
 
-Google SOAP API (1)	Search/Google/googleapi		beta2
+Google SOAP API (2)	Search/Google/googleapi		beta2
 
  GSOAP			$GSOAP_HOME			2.6.2
  http://www.cs.fsu.edu/~engelen/soap.html
  eg GSOAP_HOME=/home/fabrice/Projects/gsoap-linux-2.6
 
-ObjectsSearch API (2)	Search/ObjectsSearch		beta
+ObjectsSearch API (3)	Search/ObjectsSearch		beta
 
  GSOAP			$GSOAP_HOME			2.6.2
 
-gtkmm							gtkmm24-devel-2.6.2-2
+gtkmm							2.6.2
 http://www.gtkmm.org/
 
-libxml++ (3)						libxml++-devel-2.12.0-2.fc4
+libxml++						2.12.0
 http://libxmlplusplus.sourceforge.net/
 
- libxml2						libxml2-devel-2.6.16-3
-
-libtextcat						libtextcat-devel-2.2-1
+libtextcat						2.2
 http://software.wise-guys.nl/libtextcat/
 
-fam							fam-devel-2.6.10-9.FC2
+fam							2.6.10
 http://oss.sgi.com/projects/fam/
 - OR -
-gamin (4)						gamin-0.1.1-3.FC4
+gamin							0.1.1
 http://www.gnome.org/~veillard/gamin/
 
-gmime							gmime-devel-2.1.9-3
+gmime							2.1.9
 http://spruce.sourceforge.net/gmime
 
-Mozilla with gtk-mozembed				mozilla-devel-1.6
+Mozilla with gtk-mozembed				1.6
 http://www.mozilla.org/
 
-boost (5)						boost-devel-1.32.0-1.fc3
+boost (4)						1.32.0
 http://www.boost.org/
 
-pdftohtml						pdftohtml-0.36-4
+pdftohtml						0.36
 http://pdftohtml.sourceforge.net/
 
-antiword						antiword-0.36.1-2
+antiword						0.36.1
 http://www.winfield.demon.nl/
 
-unrtf							unrtf-0.19.3-4
+unrtf							0.19.3
 http://www.gnu.org/software/unrtf/unrtf.html
 
-glademm (6)						glademm-2.6.0_cvs-SNAP
+glademm (5)						2.6.0_cvs-SNAP
 http://home.wtal.de/petig/Gtk/index.html
 
-(1) enabled with 'make HAS_GOOGLEAPI=yes'
-(2) enabled with 'make HAS_OSAPI=yes' (now defunct ?)
-(3) or libxml++ 0.26 if HAS_LIBXMLPP026 is defined
-(4) >= 0.1.6 and a recent kernel are required for the inotify backend
-(5) for building only
-(6) to optionally regenerate the GUI code
+(1) enabled with "./configure --with-http=neon|curl"
+(2) enabled with 'make HAS_GOOGLEAPI=yes'
+(3) enabled with 'make HAS_OSAPI=yes' (now defunct ?)
+(4) for building only
+(5) to optionally regenerate the GUI code
 
 FAQ :
 -----
 
 - When listing an index or indexing documents, Pinot complains of an
-  "index error". What's going on ?
-
+  "index error"
   This is likely because a previous instance didn't exit properly and one
   (or more) index is still locked. Quit Pinot and look for a "db_lock" file
   in "~/.pinot/index" and "~/.pinot/mail". If it's there, delete it and
   restart Pinot. This will be fixed in the future.
 
+- When compiling from source, you may run into linking problems related to
+  libstdc++.la. Try patching xapian-config as explained in this post
+  (http://lists.tartarus.org/pipermail/xapian-devel/2006-January/000293.html).
+
+- If you experience segfaults at startup and you are on Fedora, chances are
+  it's because of libxml++/libsigc++. See this Bugzilla entry:
+  https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=178592
+  The latest version seems to fix this issue.
+
+- If you have built Pinot from source, make sure you have done a "make install".
+  Pinot will fail to start if it can't find stuff it needs, its icon for instance.
+

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2006-03-06 15:48:41 UTC (rev 140)
+++ trunk/configure.in	2006-03-06 15:55:42 UTC (rev 141)
@@ -62,10 +62,10 @@
 dnl Neon or Curl ?
 AC_MSG_CHECKING(which HTTP library to use)
 AC_ARG_WITH(http, AS_HELP_STRING(--with-http@<:@=neon|curl@:>@,
-	which HTTP library to use (default: neon)))
+	which HTTP library to use (default: curl)))
 httplibrary=$with_http
 if test "x$httplibrary" = "x"; then
-	httplibrary="neon"
+	httplibrary="curl"
 fi
 AC_MSG_RESULT($httplibrary)
 

Modified: trunk/pinot.spec.in
===================================================================
--- trunk/pinot.spec.in	2006-03-06 15:48:41 UTC (rev 140)
+++ trunk/pinot.spec.in	2006-03-06 15:55:42 UTC (rev 141)
@@ -11,8 +11,8 @@
 Source: %{name}-%{version}.tar.gz
 URL: http://pinot.berlios.de/
 BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
-Requires: xapian-core-libs >= 0.9.4, neon >= 0.24, gtkmm24 >= 2.6, libxml++ >= 2.12, mozilla >= %{mozilla_ver}, sqlite >= 3.1.2, libtextcat >= 2.2, fam >= 2.6.10, gmime >= 2.1, file
-BuildRequires: xapian-core-devel >= 0.9.4, neon-devel >= 0.24, gtkmm24-devel >= 2.6, libxml++-devel >= 2.12, mozilla-devel >= %{mozilla_ver}, sqlite-devel >= 3.1.2, libtextcat-devel >= 2.2, fam-devel >= 2.6.10, gmime-devel >= 2.1, file, boost-devel >= 1.32, desktop-file-utils
+Requires: xapian-core-libs >= 0.9.4, curl >= 7.13, gtkmm24 >= 2.6, libxml++ >= 2.12, mozilla >= %{mozilla_ver}, sqlite >= 3.1.2, libtextcat >= 2.2, fam >= 2.6.10, gmime >= 2.1, file
+BuildRequires: xapian-core-devel >= 0.9.4, curl-devel >= 7.13, gtkmm24-devel >= 2.6, libxml++-devel >= 2.12, mozilla-devel >= %{mozilla_ver}, sqlite-devel >= 3.1.2, libtextcat-devel >= 2.2, fam-devel >= 2.6.10, gmime-devel >= 2.1, file, boost-devel >= 1.32, desktop-file-utils
 
 %description
 Pinot is a metasearch tool for the Free Desktop. It enables one to query



From fabricecolin at berlios.de  Wed Mar  8 14:14:27 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Wed, 8 Mar 2006 14:14:27 +0100
Subject: [Pinot-svn] r142 - trunk/Tokenize
Message-ID: <200603081314.k28DERsj018705@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-08 14:14:24 +0100 (Wed, 08 Mar 2006)
New Revision: 142

Modified:
   trunk/Tokenize/Makefile.am
Log:
Compile Utils objects in.


Modified: trunk/Tokenize/Makefile.am
===================================================================
--- trunk/Tokenize/Makefile.am	2006-03-06 15:55:42 UTC (rev 141)
+++ trunk/Tokenize/Makefile.am	2006-03-08 13:14:24 UTC (rev 142)
@@ -1,5 +1,12 @@
 # Process this file with automake to produce Makefile.in
 
+UTILS_OBJS = ../Utils/Document.o \
+	../Utils/HtmlDocument.o \
+	../Utils/StringManip.o \
+	../Utils/DocumentInfo.o \
+	../Utils/TimeConverter.o \
+	../Utils/Url.o
+
 noinst_HEADERS = \
 	HtmlTokenizer.h \
 	PdfTokenizer.h \
@@ -18,21 +25,27 @@
 	HtmlTokenizer.cpp \
 	Tokenizer.cpp
 
-libpdftokenizer_la_LIBADD = -L../Utils -lUtils
+libpdftokenizer_la_LDFLAGS = 
 
+libpdftokenizer_la_LIBADD = ${UTILS_OBJS} 
+
 librtftokenizer_la_SOURCES = \
 	RtfTokenizer.cpp \
 	HtmlTokenizer.cpp \
 	Tokenizer.cpp
 
-librtftokenizer_la_LIBADD = -L../Utils -lUtils
+librtftokenizer_la_LDFLAGS = 
 
+librtftokenizer_la_LIBADD = ${UTILS_OBJS}
+
 libwordtokenizer_la_SOURCES = \
 	WordTokenizer.cpp \
 	Tokenizer.cpp
 
-libwordtokenizer_la_LIBADD = -L../Utils -lUtils
+libwordtokenizer_la_LDFLAGS = 
 
+libwordtokenizer_la_LIBADD = ${UTILS_OBJS}
+
 libTokenize_la_SOURCES = \
 	HtmlTokenizer.cpp \
 	Tokenizer.cpp \



From fabricecolin at berlios.de  Wed Mar  8 15:10:15 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Wed, 8 Mar 2006 15:10:15 +0100
Subject: [Pinot-svn] r143 - in trunk/UI/GTK2: . src
Message-ID: <200603081410.k28EAFkH016063@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-08 15:09:45 +0100 (Wed, 08 Mar 2006)
New Revision: 143

Modified:
   trunk/UI/GTK2/metase-gtk2.glade
   trunk/UI/GTK2/src/IndexPage.cpp
   trunk/UI/GTK2/src/ModelColumns.cpp
   trunk/UI/GTK2/src/ModelColumns.h
   trunk/UI/GTK2/src/PinotSettings.cpp
   trunk/UI/GTK2/src/PinotSettings.h
   trunk/UI/GTK2/src/WorkerThreads.cpp
   trunk/UI/GTK2/src/WorkerThreads.h
   trunk/UI/GTK2/src/importDialog.cc
   trunk/UI/GTK2/src/mainWindow.cc
   trunk/UI/GTK2/src/mainWindow.hh
   trunk/UI/GTK2/src/prefsDialog.cc
   trunk/UI/GTK2/src/prefsDialog.hh
   trunk/UI/GTK2/src/prefsDialog_glade.cc
   trunk/UI/GTK2/src/prefsDialog_glade.hh
   trunk/UI/GTK2/src/propertiesDialog.cc
   trunk/UI/GTK2/src/queryDialog.cc
   trunk/UI/GTK2/src/queryDialog.hh
Log:
Labels no longer have a colour.
In mainWindow, don't use the ThreadsManager lock to protect lists, this may
lead to deadlocks.


Modified: trunk/UI/GTK2/metase-gtk2.glade
===================================================================
--- trunk/UI/GTK2/metase-gtk2.glade	2006-03-08 13:14:24 UTC (rev 142)
+++ trunk/UI/GTK2/metase-gtk2.glade	2006-03-08 14:09:45 UTC (rev 143)
@@ -1384,83 +1384,6 @@
 		      </child>
 
 		      <child>
-			<widget class="GtkButton" id="editLabelButton">
-			  <property name="border_width">4</property>
-			  <property agent="glademm" name="cxx_visibility">protected</property>
-			  <property name="visible">True</property>
-			  <property name="can_default">True</property>
-			  <property name="can_focus">True</property>
-			  <property name="relief">GTK_RELIEF_NORMAL</property>
-			  <property name="focus_on_click">True</property>
-			  <signal name="clicked" handler="on_editLabelButton_clicked" last_modification_time="Wed, 28 Apr 2004 17:31:45 GMT"/>
-
-			  <child>
-			    <widget class="GtkAlignment" id="alignment19">
-			      <property name="visible">True</property>
-			      <property name="xalign">0.5</property>
-			      <property name="yalign">0.5</property>
-			      <property name="xscale">0</property>
-			      <property name="yscale">0</property>
-			      <property name="top_padding">0</property>
-			      <property name="bottom_padding">0</property>
-			      <property name="left_padding">0</property>
-			      <property name="right_padding">0</property>
-
-			      <child>
-				<widget class="GtkHBox" id="hbox31">
-				  <property name="visible">True</property>
-				  <property name="homogeneous">False</property>
-				  <property name="spacing">2</property>
-
-				  <child>
-				    <widget class="GtkImage" id="image237">
-				      <property name="visible">True</property>
-				      <property name="stock">gtk-select-color</property>
-				      <property name="icon_size">4</property>
-				      <property name="xalign">0.5</property>
-				      <property name="yalign">0.5</property>
-				      <property name="xpad">0</property>
-				      <property name="ypad">0</property>
-				    </widget>
-				    <packing>
-				      <property name="padding">0</property>
-				      <property name="expand">False</property>
-				      <property name="fill">False</property>
-				    </packing>
-				  </child>
-
-				  <child>
-				    <widget class="GtkLabel" id="label37">
-				      <property name="visible">True</property>
-				      <property name="label" translatable="yes">Edit</property>
-				      <property name="use_underline">True</property>
-				      <property name="use_markup">False</property>
-				      <property name="justify">GTK_JUSTIFY_LEFT</property>
-				      <property name="wrap">False</property>
-				      <property name="selectable">False</property>
-				      <property name="xalign">0.5</property>
-				      <property name="yalign">0.5</property>
-				      <property name="xpad">0</property>
-				      <property name="ypad">0</property>
-				      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-				      <property name="width_chars">-1</property>
-				      <property name="single_line_mode">False</property>
-				      <property name="angle">0</property>
-				    </widget>
-				    <packing>
-				      <property name="padding">0</property>
-				      <property name="expand">False</property>
-				      <property name="fill">False</property>
-				    </packing>
-				  </child>
-				</widget>
-			      </child>
-			    </widget>
-			  </child>
-			</widget>
-		      </child>
-
-		      <child>
 			<widget class="GtkButton" id="removeLabelButton">
 			  <property name="border_width">4</property>
 			  <property agent="glademm" name="cxx_visibility">protected</property>

Modified: trunk/UI/GTK2/src/IndexPage.cpp
===================================================================
--- trunk/UI/GTK2/src/IndexPage.cpp	2006-03-08 13:14:24 UTC (rev 142)
+++ trunk/UI/GTK2/src/IndexPage.cpp	2006-03-08 14:09:45 UTC (rev 143)
@@ -155,7 +155,7 @@
 #ifdef DEBUG
 		cout << "IndexPage::onLabelChanged: current label now " << m_labelName << endl;
 #endif
-		if (m_labelName == _("None"))
+		if (m_labelName == _("All labels"))
 		{
 			m_labelName.clear();
 		}
@@ -201,12 +201,13 @@
 
 	iter = m_refLabelNameTree->append();
 	row = *iter;
-	row[m_labelNameColumns.m_name] = _("None");
+	row[m_labelNameColumns.m_name] = _("All labels");
 
-	for (set<PinotSettings::Label>::const_iterator labelIter = m_settings.m_labels.begin();
-		labelIter != m_settings.m_labels.end(); ++labelIter)
+	const set<string> &labels = m_settings.getLabels();
+	for (set<string>::const_iterator labelIter = labels.begin();
+		labelIter != labels.end(); ++labelIter)
 	{
-		string labelName(labelIter->m_name);
+		string labelName(*labelIter);
 
 		iter = m_refLabelNameTree->append();
 		row = *iter;

Modified: trunk/UI/GTK2/src/ModelColumns.cpp
===================================================================
--- trunk/UI/GTK2/src/ModelColumns.cpp	2006-03-08 13:14:24 UTC (rev 142)
+++ trunk/UI/GTK2/src/ModelColumns.cpp	2006-03-08 14:09:45 UTC (rev 143)
@@ -101,7 +101,6 @@
 	add(m_enabled);
 	add(m_name);
 	add(m_oldName);
-	add(m_colour);
 }
 
 LabelModelColumns::~LabelModelColumns()

Modified: trunk/UI/GTK2/src/ModelColumns.h
===================================================================
--- trunk/UI/GTK2/src/ModelColumns.h	2006-03-08 13:14:24 UTC (rev 142)
+++ trunk/UI/GTK2/src/ModelColumns.h	2006-03-08 14:09:45 UTC (rev 143)
@@ -20,7 +20,6 @@
 #include <time.h>
 #include <glibmm/refptr.h>
 #include <glibmm/ustring.h>
-#include <gdkmm/color.h>
 #include <gdkmm/event.h>
 #include <gtkmm/treemodel.h>
 #include <gtkmm/treemodelcolumn.h>
@@ -132,7 +131,6 @@
 	Gtk::TreeModelColumn<bool> m_enabled;
 	Gtk::TreeModelColumn<Glib::ustring> m_name;
 	Gtk::TreeModelColumn<Glib::ustring> m_oldName;
-	Gtk::TreeModelColumn<Gdk::Color> m_colour;
 
 };
 

Modified: trunk/UI/GTK2/src/PinotSettings.cpp
===================================================================
--- trunk/UI/GTK2/src/PinotSettings.cpp	2006-03-08 13:14:24 UTC (rev 142)
+++ trunk/UI/GTK2/src/PinotSettings.cpp	2006-03-08 14:09:45 UTC (rev 143)
@@ -201,12 +201,9 @@
 	// Add default labels on the first run
 	if (m_firstRun == true)
 	{
-		ustring labelName =_("Red");
-		m_labels.insert(Label(labelName, 65535, 0, 0));
-		labelName =_("Blue");
-		m_labels.insert(Label(labelName, 0, 65535, 0));
-		labelName =_("Green");
-		m_labels.insert(Label(labelName, 0, 0, 65535));
+		m_labels.insert(_("Important"));
+		m_labels.insert(_("New"));
+		m_labels.insert(_("Personal"));
 	}
 
 	// Some search engines are hardcoded
@@ -593,8 +590,6 @@
 		return false;
 	}
 
-	Label label;
-
 	// Load the label's properties
 	for (Node::NodeList::iterator iter = childNodes.begin(); iter != childNodes.end(); ++iter)
 	{
@@ -610,27 +605,11 @@
 
 		if (nodeName == "name")
 		{
-			label.m_name = nodeContent;
+			m_labels.insert(nodeContent);
 		}
-		else if (nodeName == "red")
-		{
-			label.m_red = (unsigned short)atoi(nodeContent.c_str());
-		}
-		else if (nodeName == "green")
-		{
-			label.m_green = (unsigned short)atoi(nodeContent.c_str());
-		}
-		else if (nodeName == "blue")
-		{
-			label.m_blue = (unsigned short)atoi(nodeContent.c_str());
-		}
+		// Labels used to have colours...
 	}
 
-	if (label.m_name.empty() == false)
-	{
-		m_labels.insert(label);
-	}
-
 	return true;
 }
 
@@ -828,20 +807,14 @@
 	addChildElement(pElem, "viewmode", (m_browseResults ? "BROWSE" : "SOURCE"));
 	addChildElement(pElem, "browser", m_browserCommand);
 	// Labels
-	for (set<Label>::iterator labelIter = m_labels.begin(); labelIter != m_labels.end(); ++labelIter)
+	for (set<string>::iterator labelIter = m_labels.begin(); labelIter != m_labels.end(); ++labelIter)
 	{
 		pElem = pRootElem->add_child("label");
 		if (pElem == NULL)
 		{
 			return false;
 		}
-		addChildElement(pElem, "name", labelIter->m_name);
-		sprintf(numStr, "%u", labelIter->m_red);
-		addChildElement(pElem, "red", numStr);
-		sprintf(numStr, "%u", labelIter->m_green);
-		addChildElement(pElem, "green", numStr);
-		sprintf(numStr, "%u", labelIter->m_blue);
-		addChildElement(pElem, "blue", numStr);
+		addChildElement(pElem, "name", *labelIter);
 	}
 	// Ignore robots directives
 	addChildElement(pRootElem, "robots", (m_ignoreRobotsDirectives ? "IGNORE" : "OBEY"));
@@ -1107,63 +1080,51 @@
 	m_queries.clear();
 }
 
-PinotSettings::Engine::Engine()
+/// Returns the labels list.
+const set<string> &PinotSettings::getLabels(void) const
 {
+	return m_labels;
 }
 
-PinotSettings::Engine::Engine(string name, string type, string option, string channel)
+/// Adds a new label.
+bool PinotSettings::addLabel(const string &name)
 {
-	m_name = name;
-	m_type = type;
-	m_option = option;
-	m_channel = channel;
+	m_labels.insert(name);
 }
 
-PinotSettings::Engine::~Engine()
+/// Removes a label.
+bool PinotSettings::removeLabel(const string &name)
 {
-}
-
-bool PinotSettings::Engine::operator<(const PinotSettings::Engine &other) const
-{
-	if (m_name < other.m_name)
+	set<string>::iterator labelIter = m_labels.find(name);
+	if (labelIter != m_labels.end())
 	{
-		return true;
+		m_labels.erase(labelIter);
 	}
-
-	return false;
 }
 
-bool PinotSettings::Engine::operator==(const Engine &other) const
+/// Clears the labels list.
+void PinotSettings::clearLabels(void)
 {
-	if (m_name == other.m_name)
-	{
-		return true;
-	}
-
-	return false;
+	m_labels.clear();
 }
 
-PinotSettings::Label::Label() :
-	m_red(0),
-	m_green(0),
-	m_blue(0)
+PinotSettings::Engine::Engine()
 {
 }
 
-PinotSettings::Label::Label(ustring &name, unsigned short red,
-	unsigned short green, unsigned short blue) :
-	m_name(name),
-	m_red(red),
-	m_green(blue),
-	m_blue(green)
+PinotSettings::Engine::Engine(string name, string type, string option, string channel)
 {
+	m_name = name;
+	m_type = type;
+	m_option = option;
+	m_channel = channel;
 }
 
-PinotSettings::Label::~Label()
+PinotSettings::Engine::~Engine()
 {
 }
 
-bool PinotSettings::Label::operator<(const PinotSettings::Label &other) const
+bool PinotSettings::Engine::operator<(const PinotSettings::Engine &other) const
 {
 	if (m_name < other.m_name)
 	{
@@ -1173,7 +1134,7 @@
 	return false;
 }
 
-bool PinotSettings::Label::operator==(const Label &other) const
+bool PinotSettings::Engine::operator==(const Engine &other) const
 {
 	if (m_name == other.m_name)
 	{

Modified: trunk/UI/GTK2/src/PinotSettings.h
===================================================================
--- trunk/UI/GTK2/src/PinotSettings.h	2006-03-08 13:14:24 UTC (rev 142)
+++ trunk/UI/GTK2/src/PinotSettings.h	2006-03-08 14:09:45 UTC (rev 143)
@@ -107,23 +107,18 @@
 		/// Clears the queries map.
 		void clearQueries(void);
 
-		class Label
-		{
-			public:
-				Label();
-				Label(Glib::ustring &name, unsigned short red,
-					unsigned short green, unsigned short blue);
-				~Label();
+		/// Returns the labels list.
+		const std::set<std::string> &getLabels(void) const;
 
-				bool operator<(const Label &other) const;
-				bool operator==(const Label &other) const;
+		/// Adds a new label.
+		bool addLabel(const std::string &name);
 
-				Glib::ustring m_name;
-				unsigned short m_red;
-				unsigned short m_green;
-				unsigned short m_blue;
-		};
+		/// Removes a label.
+		bool removeLabel(const std::string &name);
 
+		/// Clears the labels list.
+		void clearLabels(void);
+
 		class MailAccount
 		{
 			public:
@@ -152,7 +147,6 @@
 		int m_width;
 		int m_height;
 		int m_panePos;
-		std::set<Label> m_labels;
 		bool m_ignoreRobotsDirectives;
 		std::set<MailAccount> m_mailAccounts;
 
@@ -165,6 +159,7 @@
 		std::map<unsigned int, std::string> m_engineIds;
 		std::set<std::string> m_engineChannels;
 		std::map<std::string, QueryProperties> m_queries;
+		std::set<std::string> m_labels;
 
 		PinotSettings();
 		bool loadConfiguration(const std::string &fileName);

Modified: trunk/UI/GTK2/src/WorkerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.cpp	2006-03-08 13:14:24 UTC (rev 142)
+++ trunk/UI/GTK2/src/WorkerThreads.cpp	2006-03-08 14:09:45 UTC (rev 143)
@@ -177,26 +177,20 @@
 	pthread_rwlock_destroy(&m_rwLock);
 }
 
-bool ThreadsManager::read_lock(unsigned int where)
+bool ThreadsManager::read_lock(void)
 {
 	if (pthread_rwlock_rdlock(&m_rwLock) == 0)
 	{
-#ifdef DEBUG
-		cout << "ThreadsManager::read_lock " << where << endl;
-#endif
 		return true;
 	}
 
 	return false;
 }
 
-bool ThreadsManager::write_lock(unsigned int where)
+bool ThreadsManager::write_lock(void)
 {
 	if (pthread_rwlock_wrlock(&m_rwLock) == 0)
 	{
-#ifdef DEBUG
-		cout << "ThreadsManager::write_lock " << where << endl;
-#endif
 		return true;
 	}
 
@@ -205,9 +199,6 @@
 
 void ThreadsManager::unlock(void)
 {
-#ifdef DEBUG
-	cout << "ThreadsManager::unlock" << endl;
-#endif
 	pthread_rwlock_unlock(&m_rwLock);
 }
 
@@ -216,7 +207,7 @@
 	WorkerThread *pWorkerThread = NULL;
 
 	// Get the first thread that's finished
-	if (read_lock(1) == true)
+	if (read_lock() == true)
 	{
 		for (map<WorkerThread *, Thread *>::iterator threadIter = m_threads.begin();
 			threadIter != m_threads.end(); ++threadIter)
@@ -276,7 +267,7 @@
 	}
 
 	// Insert
-	if (write_lock(2) == true)
+	if (write_lock() == true)
 	{
 		m_threads[pWorkerThread] = pThread;
 
@@ -291,7 +282,7 @@
 {
 	int count = 0;
 
-	if (read_lock(3) == true)
+	if (read_lock() == true)
 	{
 		count = m_threads.size() - m_backgroundThreadsCount;
 
@@ -320,7 +311,7 @@
 {
 	if (m_threads.empty() == false)
 	{
-		if (read_lock(4) == true)
+		if (read_lock() == true)
 		{
 			for_each(m_threads.begin(), m_threads.end(), DeleteMapPointer());
 			m_threads.clear();

Modified: trunk/UI/GTK2/src/WorkerThreads.h
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.h	2006-03-08 13:14:24 UTC (rev 142)
+++ trunk/UI/GTK2/src/WorkerThreads.h	2006-03-08 14:09:45 UTC (rev 143)
@@ -93,10 +93,6 @@
 		ThreadsManager();
 		virtual ~ThreadsManager();
 
-		bool read_lock(unsigned int where);
-		bool write_lock(unsigned int where);
-		void unlock(void);
-
 		bool start_thread(WorkerThread *pWorkerThread, bool inBackground);
 
 		WorkerThread *on_thread_end(void);
@@ -117,6 +113,10 @@
 		unsigned int m_nextId;
 		unsigned int m_backgroundThreadsCount;
 
+		bool read_lock(void);
+		bool write_lock(void);
+		void unlock(void);
+
 	private:
 		ThreadsManager(const ThreadsManager &other);
 		ThreadsManager &operator=(const ThreadsManager &other);

Modified: trunk/UI/GTK2/src/importDialog.cc
===================================================================
--- trunk/UI/GTK2/src/importDialog.cc	2006-03-08 13:14:24 UTC (rev 142)
+++ trunk/UI/GTK2/src/importDialog.cc	2006-03-08 14:09:45 UTC (rev 143)
@@ -148,10 +148,11 @@
 	row[m_labelNameColumns.m_name] = _("None");
 	labelNameCombobox->set_active(0);
 	// Add all labels
-	for (set<PinotSettings::Label>::const_iterator labelIter = PinotSettings::getInstance().m_labels.begin();
-		labelIter != PinotSettings::getInstance().m_labels.end(); ++labelIter)
+	const set<string> &labels = PinotSettings::getInstance().getLabels();
+	for (set<string>::const_iterator labelIter = labels.begin();
+		labelIter != labels.end(); ++labelIter)
 	{
-		string labelName = labelIter->m_name;
+		string labelName(*labelIter);
 
 		iter = m_refLabelNameTree->append();
 		row = *iter;

Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2006-03-08 13:14:24 UTC (rev 142)
+++ trunk/UI/GTK2/src/mainWindow.cc	2006-03-08 14:09:45 UTC (rev 143)
@@ -70,12 +70,48 @@
 	m_browsingIndex(false),
 	m_pMainWindow(pWindow)
 {
+	pthread_rwlock_init(&m_listsLock, NULL);
 }
 
 mainWindow::InternalState::~InternalState()
 {
+	pthread_rwlock_destroy(&m_listsLock);
 }
 
+bool mainWindow::InternalState::read_lock_lists(unsigned int where)
+{
+	if (pthread_rwlock_rdlock(&m_listsLock) == 0)
+	{
+#ifdef DEBUG
+		cout << "mainWindow::read_lock_lists: " << where << endl;
+#endif
+		return true;
+	}
+
+	return false;
+}
+
+bool mainWindow::InternalState::write_lock_lists(unsigned int where)
+{
+	if (pthread_rwlock_wrlock(&m_listsLock) == 0)
+	{
+#ifdef DEBUG
+		cout << "mainWindow::write_lock_lists: " << where << endl;
+#endif
+		return true;
+	}
+
+	return false;
+}
+
+void mainWindow::InternalState::unlock_lists(void)
+{
+	pthread_rwlock_unlock(&m_listsLock);
+#ifdef DEBUG
+	cout << "mainWindow::unlock_lists" << endl;
+#endif
+}
+
 void mainWindow::InternalState::connect(void)
 {
 	if (m_pMainWindow != NULL)
@@ -590,7 +626,7 @@
 			SigC::slot(*this, &mainWindow::on_indexForwardButton_clicked));
 
 		// Append the page
-		if (m_state.write_lock(1) == true)
+		if (m_state.write_lock_lists(1) == true)
 		{
 			int pageNum = m_pNotebook->append_page(*pIndexPage, *pTab);
 			m_pNotebook->pages().back().set_tab_label_packing(false, true, Gtk::PACK_START);
@@ -599,7 +635,7 @@
 				foundPage = true;
 			}
 
-			m_state.unlock();
+			m_state.unlock_lists();
 		}
 	}
 
@@ -697,12 +733,12 @@
 				pPage->hide();
 			}
 		}
-		else if (m_state.write_lock(2) == true)
+		else if (m_state.write_lock_lists(2) == true)
 		{
 			// Remove the page
 			m_pNotebook->remove_page(pageNum);
 
-			m_state.unlock();
+			m_state.unlock_lists();
 		}
 	}
 }
@@ -856,12 +892,12 @@
 				SigC::slot(*this, &mainWindow::on_resultsTreeviewSelection_changed));
 
 			// Append the page
-			if (m_state.write_lock(3) == true)
+			if (m_state.write_lock_lists(3) == true)
 			{
 				pageNum = m_pNotebook->append_page(*pResultsPage, *pTab);
 				m_pNotebook->pages().back().set_tab_label_packing(false, true, Gtk::PACK_START);
 
-				m_state.unlock();
+				m_state.unlock_lists();
 			}
 		}
 
@@ -1002,7 +1038,7 @@
 			status += to_utf8(url);
 
 			// Update the in-progress list
-			if (m_state.write_lock(4) == true)
+			if (m_state.write_lock_lists(4) == true)
 			{
 				set<string>::iterator urlIter = m_state.m_beingIndexed.find(url);
 				if (urlIter != m_state.m_beingIndexed.end())
@@ -1010,7 +1046,7 @@
 					m_state.m_beingIndexed.erase(urlIter);
 				}
 
-				m_state.unlock();
+				m_state.unlock_lists();
 			}
 
 			if (pIndexPage != NULL)
@@ -1268,7 +1304,7 @@
 	// FIXME: if mail accounts are configured, make sure the MonitorThread
 	// is running and knows about the new accounts
 
-	if (m_state.read_lock(5) == true)
+	if (m_state.read_lock_lists(5) == true)
 	{
 		for (int pageNum = 0; pageNum < m_pNotebook->get_n_pages(); ++pageNum)
 		{
@@ -1286,7 +1322,7 @@
 			}
 		}
 
-		m_state.unlock();
+		m_state.unlock_lists();
 	}
 
 	// Do the changes affect the View tab ?
@@ -2394,7 +2430,7 @@
 {
 	NotebookPageBox *pNotebookPage = NULL;
 
-	if (m_state.read_lock(6) == true)
+	if (m_state.read_lock_lists(6) == true)
 	{
 		Widget *pPage = m_pNotebook->get_nth_page(m_pNotebook->get_current_page());
 		if (pPage != NULL)
@@ -2402,7 +2438,7 @@
 			pNotebookPage = dynamic_cast<NotebookPageBox*>(pPage);
 		}
 
-		m_state.unlock();
+		m_state.unlock_lists();
 	}
 
 	return pNotebookPage;
@@ -2415,7 +2451,7 @@
 {
 	NotebookPageBox *pNotebookPage = NULL;
 
-	if (m_state.read_lock(7) == true)
+	if (m_state.read_lock_lists(7) == true)
 	{
 		for (int pageNum = 0; pageNum < m_pNotebook->get_n_pages(); ++pageNum)
 		{
@@ -2439,7 +2475,7 @@
 			}
 		}
 
-		m_state.unlock();
+		m_state.unlock_lists();
 	}
 
 	return pNotebookPage;
@@ -2452,7 +2488,7 @@
 {
 	int pageNumber = -1;
 
-	if (m_state.read_lock(8) == true)
+	if (m_state.read_lock_lists(8) == true)
 	{
 		for (int pageNum = 0; pageNum < m_pNotebook->get_n_pages(); ++pageNum)
 		{
@@ -2476,7 +2512,7 @@
 			}
 		}
 
-		m_state.unlock();
+		m_state.unlock_lists();
 	}
 
 	return pageNumber;
@@ -2490,11 +2526,11 @@
 {
 	if (m_state.get_threads_count() >= m_maxThreads)
 	{
-		if (m_state.write_lock(9) == true)
+		if (m_state.write_lock_lists(9) == true)
 		{
 			m_state.m_indexQueue[docInfo] = labelName;
 
-			m_state.unlock();
+			m_state.unlock_lists();
 		}
 
 		return true;
@@ -2791,7 +2827,7 @@
 			docId = index.hasDocument(url);
 		}
 		if ((docId == 0) &&
-			(m_state.write_lock(10) == true))
+			(m_state.write_lock_lists(10) == true))
 		{
 			if (m_state.m_beingIndexed.find(url) == m_state.m_beingIndexed.end())
 			{
@@ -2799,7 +2835,7 @@
 				isNewDocument = true;
 			}
 
-			m_state.unlock();
+			m_state.unlock_lists();
 		}
 
 		if (isNewDocument == true)
@@ -2904,12 +2940,12 @@
 				pViewPage = manage(new ViewPage(viewName, m_pHtmlView, m_settings));
 
 				// Append the page
-				if (m_state.write_lock(11) == true)
+				if (m_state.write_lock_lists(11) == true)
 				{
 					pageNum = m_pNotebook->append_page(*pViewPage, *pTab);
 					m_pNotebook->pages().back().set_tab_label_packing(false, true, Gtk::PACK_START);
 
-					m_state.unlock();
+					m_state.unlock_lists();
 				}
 			}
 
@@ -2983,7 +3019,7 @@
 	DocumentInfo docInfo;
 	string labelName;
 
-	if (m_state.write_lock(12) == true)
+	if (m_state.write_lock_lists(12) == true)
 	{
 		if (m_state.m_indexQueue.empty() == false)
 		{
@@ -2998,7 +3034,7 @@
 			}
 		}
 
-		m_state.unlock();
+		m_state.unlock_lists();
 	}
 
 	string location = docInfo.getLocation();

Modified: trunk/UI/GTK2/src/mainWindow.hh
===================================================================
--- trunk/UI/GTK2/src/mainWindow.hh	2006-03-08 13:14:24 UTC (rev 142)
+++ trunk/UI/GTK2/src/mainWindow.hh	2006-03-08 14:09:45 UTC (rev 143)
@@ -168,6 +168,9 @@
 			InternalState(mainWindow *pWindow);
 			~InternalState();
 
+			bool read_lock_lists(unsigned int where);
+			bool write_lock_lists(unsigned int where);
+			void unlock_lists(void);
 			void connect(void);
 
 			// Query
@@ -181,6 +184,7 @@
 			std::map<DocumentInfo, string> m_indexQueue;
 
 		protected:
+			pthread_rwlock_t m_listsLock;
 			mainWindow *m_pMainWindow;
 
 	} m_state;

Modified: trunk/UI/GTK2/src/prefsDialog.cc
===================================================================
--- trunk/UI/GTK2/src/prefsDialog.cc	2006-03-08 13:14:24 UTC (rev 142)
+++ trunk/UI/GTK2/src/prefsDialog.cc	2006-03-08 14:09:45 UTC (rev 143)
@@ -131,40 +131,36 @@
 	TreeModel::iterator iter;
 	TreeModel::Row row;
 
-	if (m_settings.m_labels.empty() == true)
+	const set<string> &labels = m_settings.getLabels();
+	if (labels.empty() == true)
 	{
 		// These buttons will stay disabled until labels are added to the list
-		editLabelButton->set_sensitive(false);
 		removeLabelButton->set_sensitive(false);
 		return;
 	}
 
 	// Populate the tree
-	for (set<PinotSettings::Label>::iterator labelIter = m_settings.m_labels.begin();
-		labelIter != m_settings.m_labels.end();
+	for (set<string>::const_iterator labelIter = labels.begin();
+		labelIter != labels.end();
 		++labelIter)
 	{
 		// Create a new row
 		iter = m_refLabelsTree->append();
 		row = *iter;
-		// Set its name and colour
-		row[m_labelsColumns.m_name] = labelIter->m_name;
-		row[m_labelsColumns.m_oldName] = labelIter->m_name;
-		Color labelColour;
-		labelColour.set_rgb(labelIter->m_red, labelIter->m_green, labelIter->m_blue);
-		row[m_labelsColumns.m_colour] = labelColour;
+		// Set its name
+		row[m_labelsColumns.m_name] = *labelIter;
+		row[m_labelsColumns.m_oldName] = *labelIter;
 		// This allows to differentiate existing labels from new labels the user may create
 		row[m_labelsColumns.m_enabled] = true;
 	}
 
-	editLabelButton->set_sensitive(true);
 	removeLabelButton->set_sensitive(true);
 }
 
 bool prefsDialog::save_labelsTreeview()
 {
 	// Clear the current settings
-	m_settings.m_labels.clear();
+	m_settings.clearLabels();
 
 	// Go through the labels tree
 	TreeModel::Children children = m_refLabelsTree->children();
@@ -176,31 +172,26 @@
 			TreeModel::Row row = *iter;
 
 			// Add this new label to the settings
-			PinotSettings::Label label;
-			label.m_name = row[m_labelsColumns.m_name];
+			ustring labelName = row[m_labelsColumns.m_name];
 			ustring oldName = row[m_labelsColumns.m_oldName];
 			// Was this label renamed ?
 			if ((row[m_labelsColumns.m_enabled] == true) &&
-				(label.m_name != oldName))
+				(labelName != oldName))
 			{
 				// Yes, it was
-				m_renamedLabels[from_utf8(oldName)] = from_utf8(label.m_name);
+				m_renamedLabels[from_utf8(oldName)] = from_utf8(labelName);
 			}
 			// Check user didn't recreate this label after having deleted it
-			set<string>::iterator labelIter = m_deletedLabels.find(from_utf8(label.m_name));
+			set<string>::iterator labelIter = m_deletedLabels.find(from_utf8(labelName));
 			if (labelIter != m_deletedLabels.end())
 			{
 				m_deletedLabels.erase(labelIter);
 			}
 
-			Color labelColour = row[m_labelsColumns.m_colour];
-			label.m_red = labelColour.get_red();
-			label.m_green = labelColour.get_green();
-			label.m_blue = labelColour.get_blue();
 #ifdef DEBUG
-			cout << "prefsDialog::save_labelsTreeview: " << label.m_name << endl;
+			cout << "prefsDialog::save_labelsTreeview: " << labelName << endl;
 #endif
-			m_settings.m_labels.insert(label);
+			m_settings.addLabel(labelName);
 		}
 	}
 
@@ -343,51 +334,11 @@
 	row[m_labelsColumns.m_name] = to_utf8(_("New Label"));
 	// This marks the label as new
 	row[m_labelsColumns.m_enabled] = false;
-	// FIXME: initialize the colour to something meaningful, depending on the current theme perhaps ?
-	Color labelColour;
-	labelColour.set_rgb(0, 0, 0);
-	row[m_labelsColumns.m_colour] = labelColour;
 
 	// Enable these buttons
-	editLabelButton->set_sensitive(true);
 	removeLabelButton->set_sensitive(true);
 }
 
-void prefsDialog::on_editLabelButton_clicked()
-{
-	// Get the selected label in the list
-	TreeModel::iterator iter = labelsTreeview->get_selection()->get_selected();
-	if (iter)
-	{
-		TreeModel::Row row = *iter;
-		ustring dialogTitle = row[m_labelsColumns.m_name];
-		dialogTitle += " ";
-		dialogTitle += _("Colour");
-		Color labelColour = row[m_labelsColumns.m_colour];
-
-		ColorSelectionDialog colorSelector(dialogTitle);
-		ColorSelection *colorSel = colorSelector.get_colorsel();
-		if (colorSel != NULL)
-		{
-			colorSel->set_has_opacity_control(false);
-			colorSel->set_current_color(labelColour);
-		}
-		colorSelector.set_transient_for(*this);
-		colorSelector.show();
-		int result = colorSelector.run();
-		if (result == RESPONSE_OK)
-		{
-			// Retrieve the chosen colour
-			labelColour = colorSel->get_current_color();
-#ifdef DEBUG
-			cout << "prefsDialog::on_editLabelButton_clicked: selected " << labelColour.get_red() << " " << labelColour.get_green() << " " << labelColour.get_blue() << endl;
-#endif
-
-			row[m_labelsColumns.m_colour] = labelColour;
-		}
-	}
-}
-
 void prefsDialog::on_removeLabelButton_clicked()
 {
 	// Get the selected label in the list
@@ -409,7 +360,6 @@
 		if (children.empty() == true)
 		{
 			// Disable these buttons
-			editLabelButton->set_sensitive(false);
 			removeLabelButton->set_sensitive(false);
 		}
 	}

Modified: trunk/UI/GTK2/src/prefsDialog.hh
===================================================================
--- trunk/UI/GTK2/src/prefsDialog.hh	2006-03-08 13:14:24 UTC (rev 142)
+++ trunk/UI/GTK2/src/prefsDialog.hh	2006-03-08 14:09:45 UTC (rev 143)
@@ -45,7 +45,6 @@
 	virtual void on_viewCombobox_changed();
 	virtual void on_browserButton_clicked();
 	virtual void on_addLabelButton_clicked();
-	virtual void on_editLabelButton_clicked();
 	virtual void on_removeLabelButton_clicked();
 	virtual bool on_mailTreeview_button_press_event(GdkEventButton *ev);
 	virtual void on_addAccountButton_clicked();

Modified: trunk/UI/GTK2/src/prefsDialog_glade.cc
===================================================================
--- trunk/UI/GTK2/src/prefsDialog_glade.cc	2006-03-08 13:14:24 UTC (rev 142)
+++ trunk/UI/GTK2/src/prefsDialog_glade.cc	2006-03-08 14:09:45 UTC (rev 143)
@@ -1,4 +1,4 @@
-// generated 2006/1/5 9:17:18 SGT by fabrice at thorgrim.dyndns.org.(none)
+// generated 2006/3/7 21:04:59 SGT by fabrice at amra.dyndns.org.(none)
 // using glademm V2.6.0
 //
 // DO NOT EDIT THIS FILE ! It was created using
@@ -82,12 +82,6 @@
    Gtk::Alignment *alignment17 = Gtk::manage(new class Gtk::Alignment(0.5, 0.5, 0, 0));
    addLabelButton = Gtk::manage(new class Gtk::Button());
    
-   Gtk::Image *image237 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-select-color"), Gtk::IconSize(4)));
-   Gtk::Label *label37 = Gtk::manage(new class Gtk::Label(_("Edit")));
-   Gtk::HBox *hbox31 = Gtk::manage(new class Gtk::HBox(false, 2));
-   Gtk::Alignment *alignment19 = Gtk::manage(new class Gtk::Alignment(0.5, 0.5, 0, 0));
-   editLabelButton = Gtk::manage(new class Gtk::Button());
-   
    Gtk::Image *image236 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-remove"), Gtk::IconSize(4)));
    Gtk::Label *label36 = Gtk::manage(new class Gtk::Label(_("Remove")));
    Gtk::HBox *hbox30 = Gtk::manage(new class Gtk::HBox(false, 2));
@@ -216,22 +210,6 @@
    addLabelButton->set_border_width(4);
    addLabelButton->set_relief(Gtk::RELIEF_NORMAL);
    addLabelButton->add(*alignment17);
-   image237->set_alignment(0.5,0.5);
-   image237->set_padding(0,0);
-   label37->set_alignment(0.5,0.5);
-   label37->set_padding(0,0);
-   label37->set_justify(Gtk::JUSTIFY_LEFT);
-   label37->set_line_wrap(false);
-   label37->set_use_markup(false);
-   label37->set_selectable(false);
-   hbox31->pack_start(*image237, Gtk::PACK_SHRINK, 0);
-   hbox31->pack_start(*label37, Gtk::PACK_SHRINK, 0);
-   alignment19->add(*hbox31);
-   editLabelButton->set_flags(Gtk::CAN_FOCUS);
-   editLabelButton->set_flags(Gtk::CAN_DEFAULT);
-   editLabelButton->set_border_width(4);
-   editLabelButton->set_relief(Gtk::RELIEF_NORMAL);
-   editLabelButton->add(*alignment19);
    image236->set_alignment(0.5,0.5);
    image236->set_padding(0,0);
    label36->set_alignment(0.5,0.5);
@@ -249,7 +227,6 @@
    removeLabelButton->set_relief(Gtk::RELIEF_NORMAL);
    removeLabelButton->add(*alignment18);
    labelsVbuttonbox->pack_start(*addLabelButton);
-   labelsVbuttonbox->pack_start(*editLabelButton);
    labelsVbuttonbox->pack_start(*removeLabelButton);
    labelsHbox->pack_start(*labelsScrolledwindow);
    labelsHbox->pack_start(*labelsVbuttonbox, Gtk::PACK_SHRINK, 0);
@@ -359,11 +336,6 @@
    hbox29->show();
    alignment17->show();
    addLabelButton->show();
-   image237->show();
-   label37->show();
-   hbox31->show();
-   alignment19->show();
-   editLabelButton->show();
    image236->show();
    label36->show();
    hbox30->show();
@@ -393,7 +365,6 @@
    viewCombobox->signal_changed().connect(SigC::slot(*this, &prefsDialog_glade::on_viewCombobox_changed), false);
    browserButton->signal_clicked().connect(SigC::slot(*this, &prefsDialog_glade::on_browserButton_clicked), false);
    addLabelButton->signal_clicked().connect(SigC::slot(*this, &prefsDialog_glade::on_addLabelButton_clicked), false);
-   editLabelButton->signal_clicked().connect(SigC::slot(*this, &prefsDialog_glade::on_editLabelButton_clicked), false);
    removeLabelButton->signal_clicked().connect(SigC::slot(*this, &prefsDialog_glade::on_removeLabelButton_clicked), false);
    mailTreeview->signal_button_press_event().connect(SigC::slot(*this, &prefsDialog_glade::on_mailTreeview_button_press_event), false);
    addAccountButton->signal_clicked().connect(SigC::slot(*this, &prefsDialog_glade::on_addAccountButton_clicked), false);

Modified: trunk/UI/GTK2/src/prefsDialog_glade.hh
===================================================================
--- trunk/UI/GTK2/src/prefsDialog_glade.hh	2006-03-08 13:14:24 UTC (rev 142)
+++ trunk/UI/GTK2/src/prefsDialog_glade.hh	2006-03-08 14:09:45 UTC (rev 143)
@@ -1,4 +1,4 @@
-// generated 2005/11/29 20:59:00 SGT by fabrice at amra.dyndns.org.(none)
+// generated 2006/3/7 21:04:59 SGT by fabrice at amra.dyndns.org.(none)
 // using glademm V2.6.0
 //
 // DO NOT EDIT THIS FILE ! It was created using
@@ -57,7 +57,6 @@
         class Gtk::Button * browserButton;
         class Gtk::TreeView * labelsTreeview;
         class Gtk::Button * addLabelButton;
-        class Gtk::Button * editLabelButton;
         class Gtk::Button * removeLabelButton;
         class Gtk::TreeView * mailTreeview;
         class Gtk::Button * addAccountButton;
@@ -73,7 +72,6 @@
         virtual void on_viewCombobox_changed() = 0;
         virtual void on_browserButton_clicked() = 0;
         virtual void on_addLabelButton_clicked() = 0;
-        virtual void on_editLabelButton_clicked() = 0;
         virtual void on_removeLabelButton_clicked() = 0;
         virtual bool on_mailTreeview_button_press_event(GdkEventButton *ev) = 0;
         virtual void on_addAccountButton_clicked() = 0;

Modified: trunk/UI/GTK2/src/propertiesDialog.cc
===================================================================
--- trunk/UI/GTK2/src/propertiesDialog.cc	2006-03-08 13:14:24 UTC (rev 142)
+++ trunk/UI/GTK2/src/propertiesDialog.cc	2006-03-08 14:09:45 UTC (rev 143)
@@ -79,15 +79,16 @@
 	TreeModel::Row row;
 
 	// Populate the tree
-	const set<PinotSettings::Label> &sysLabels = PinotSettings::getInstance().m_labels;
-	for (set<PinotSettings::Label>::const_iterator labelIter = sysLabels.begin(); labelIter != sysLabels.end(); ++labelIter)
+	const set<string> &sysLabels = PinotSettings::getInstance().getLabels();
+	for (set<string>::const_iterator labelIter = sysLabels.begin(); labelIter != sysLabels.end(); ++labelIter)
 	{
+		string labelName(*labelIter);
+
 		// Create a new row
 		iter = m_refLabelsTree->append();
 		row = *iter;
 
-		row[m_labelsColumns.m_name] = labelIter->m_name;
-		string labelName = from_utf8(labelIter->m_name);
+		row[m_labelsColumns.m_name] = labelName;
 		// Is it in the document labels list ?
 		set<string>::const_iterator iter = find(docLabels.begin(), docLabels.end(), labelName);
 		if (iter != docLabels.end())

Modified: trunk/UI/GTK2/src/queryDialog.cc
===================================================================
--- trunk/UI/GTK2/src/queryDialog.cc	2006-03-08 13:14:24 UTC (rev 142)
+++ trunk/UI/GTK2/src/queryDialog.cc	2006-03-08 14:09:45 UTC (rev 143)
@@ -33,7 +33,7 @@
 	queryDialog_glade(),
 	m_name(properties.getName()),
 	m_properties(properties),
-	m_labels(PinotSettings::getInstance().m_labels),
+	m_labels(PinotSettings::getInstance().getLabels()),
 	m_badName(true)
 {
 	string name = m_properties.getName();
@@ -97,9 +97,9 @@
 	labelFilterCombobox->set_active(0);
 
 	// Add all labels to both label combos and select the one defined for the query
-	for (set<PinotSettings::Label>::const_iterator labelIter = m_labels.begin(); labelIter != m_labels.end(); ++labelIter)
+	for (set<string>::const_iterator labelIter = m_labels.begin(); labelIter != m_labels.end(); ++labelIter)
 	{
-		string labelName = labelIter->m_name;
+		string labelName(*labelIter);
 
 		iter = m_refLabelNameTree->append();
 		row = *iter;

Modified: trunk/UI/GTK2/src/queryDialog.hh
===================================================================
--- trunk/UI/GTK2/src/queryDialog.hh	2006-03-08 13:14:24 UTC (rev 142)
+++ trunk/UI/GTK2/src/queryDialog.hh	2006-03-08 14:09:45 UTC (rev 143)
@@ -37,7 +37,7 @@
 protected:
 	std::string m_name;
 	QueryProperties& m_properties;
-	const std::set<PinotSettings::Label> &m_labels;
+	const std::set<std::string> &m_labels;
 	ComboModelColumns m_labelNameColumns;
 	Glib::RefPtr<Gtk::ListStore> m_refLabelNameTree;
 	ComboModelColumns m_languageColumns;



From fabricecolin at berlios.de  Thu Mar  9 14:35:19 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Thu, 9 Mar 2006 14:35:19 +0100
Subject: [Pinot-svn] r144 - trunk
Message-ID: <200603091335.k29DZJWh007379@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-09 14:35:05 +0100 (Thu, 09 Mar 2006)
New Revision: 144

Removed:
   trunk/ChangeLog
Modified:
   trunk/NEWS
Log:
Put news in NEWS, not ChangeLog :-)


Deleted: trunk/ChangeLog
===================================================================
--- trunk/ChangeLog	2006-03-08 14:09:45 UTC (rev 143)
+++ trunk/ChangeLog	2006-03-09 13:35:05 UTC (rev 144)
@@ -1,77 +0,0 @@
-2006/02/25 version_0_4_3
-Build :
- - dropped patch for libxml++ v0.26 support
- - use autotools
-Search :
- - include pinot_search to query search engines from the command-line
- - better parsing of Sherlock plugins with foreign tags
- - URLs of results returned by Sherlock engines were incorrectly lower-cased
- - fix for Topix and Acoona
-Index :
- - Changed term prefixes to conform to conventions used by Omega and other
-  Xapian-based tools. Unfortunately, users will have to update documents and
-  reapply labels !
-UI :
- - UTF-8 fixes on stored queries dates, results extracts and locale catalogs;
-   the Spanish and French catalogs are usable now !
- - Better error handling in worker threads and at startup
-
-2006/01/31 version_0_4_2
-Search :
- - support for OpenSearch Description, Query and Response
- - replaced Koders and Omega Sherlock plugins with their OpenSearch equivalent
- - added MozDex
-Index :
- - queries on an index that cannot be locked no longer loop
-UI :
- - when no email boxes were being monitored, Pinot wouldn't exit right away
- - results extract field can be resized
- - Spanish translation by Jes?s Tramullas (jesus at tramullas dot com)
-
-2006/01/20 version_0_4_0
-UI and SQLite :
- - dropped ActionHistory
-Search :
- - fixed issues with documents and queries language
- - detect encoding of results pages
- - fixed AskJeeves source
-Index :
- - fixed issues with documents language
- - limit amount of text parsed by summarization and language guessing
- - limit terms length
- - canonicalize URLs
- - make sure index is always unlocked properly
-Tokenize :
- - modified tokenizer plugins interface
- - new RTF tokenizer (requires unrtf)
-UI :
- - standard About box
- - better documents importing
- - better charset conversion
- - completion on query field, based on terms in the documents index
- - all notebook tabs are open on a need-to basis and can be closed
- - fixed several UI inconsistencies
- - catch signals and signal threads to ensure clean exits
- - save language names in English, load in current locale
- - requires gtkmm v2.6
-
-2005/12/18 version_0_3_5
-Xapian + SQLite back-end :
- - dropped unnecessary tables, moved labels and properties into the index
-Neon downloader :
- - fail on HTTP errors
- - setup OpenSSL callbacks for multi-threading support
-Search :
- - can filter documents by label
- - multi-step index search : exact matches first, then with stemming, then with ignoring the operators
-HTML browser :
- - initialize NSS and NSPR to get rid of crash when visiting https sites
-UI :
- - on double clicks in the index tab, check a document is selected before opening the properties box
- - copy & paste should now work as expected
- - modified index browser
-Threads :
- - handle select() errors
-
-2005/12/08 version_0_3_0
- - first public release

Modified: trunk/NEWS
===================================================================
--- trunk/NEWS	2006-03-08 14:09:45 UTC (rev 143)
+++ trunk/NEWS	2006-03-09 13:35:05 UTC (rev 144)
@@ -0,0 +1,77 @@
+2006/02/25 version_0_4_3
+Build :
+ - dropped patch for libxml++ v0.26 support
+ - use autotools
+Search :
+ - include pinot_search to query search engines from the command-line
+ - better parsing of Sherlock plugins with foreign tags
+ - URLs of results returned by Sherlock engines were incorrectly lower-cased
+ - fix for Topix and Acoona
+Index :
+ - Changed term prefixes to conform to conventions used by Omega and other
+  Xapian-based tools. Unfortunately, users will have to update documents and
+  reapply labels !
+UI :
+ - UTF-8 fixes on stored queries dates, results extracts and locale catalogs;
+   the Spanish and French catalogs are usable now !
+ - Better error handling in worker threads and at startup
+
+2006/01/31 version_0_4_2
+Search :
+ - support for OpenSearch Description, Query and Response
+ - replaced Koders and Omega Sherlock plugins with their OpenSearch equivalent
+ - added MozDex
+Index :
+ - queries on an index that cannot be locked no longer loop
+UI :
+ - when no email boxes were being monitored, Pinot wouldn't exit right away
+ - results extract field can be resized
+ - Spanish translation by Jes?s Tramullas (jesus at tramullas dot com)
+
+2006/01/20 version_0_4_0
+UI and SQLite :
+ - dropped ActionHistory
+Search :
+ - fixed issues with documents and queries language
+ - detect encoding of results pages
+ - fixed AskJeeves source
+Index :
+ - fixed issues with documents language
+ - limit amount of text parsed by summarization and language guessing
+ - limit terms length
+ - canonicalize URLs
+ - make sure index is always unlocked properly
+Tokenize :
+ - modified tokenizer plugins interface
+ - new RTF tokenizer (requires unrtf)
+UI :
+ - standard About box
+ - better documents importing
+ - better charset conversion
+ - completion on query field, based on terms in the documents index
+ - all notebook tabs are open on a need-to basis and can be closed
+ - fixed several UI inconsistencies
+ - catch signals and signal threads to ensure clean exits
+ - save language names in English, load in current locale
+ - requires gtkmm v2.6
+
+2005/12/18 version_0_3_5
+Xapian + SQLite back-end :
+ - dropped unnecessary tables, moved labels and properties into the index
+Neon downloader :
+ - fail on HTTP errors
+ - setup OpenSSL callbacks for multi-threading support
+Search :
+ - can filter documents by label
+ - multi-step index search : exact matches first, then with stemming, then with ignoring the operators
+HTML browser :
+ - initialize NSS and NSPR to get rid of crash when visiting https sites
+UI :
+ - on double clicks in the index tab, check a document is selected before opening the properties box
+ - copy & paste should now work as expected
+ - modified index browser
+Threads :
+ - handle select() errors
+
+2005/12/08 version_0_3_0
+ - first public release



From fabricecolin at berlios.de  Thu Mar  9 14:42:46 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Thu, 9 Mar 2006 14:42:46 +0100
Subject: [Pinot-svn] r145 - trunk/Search/Plugins
Message-ID: <200603091342.k29DgkG2010713@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-09 14:42:43 +0100 (Thu, 09 Mar 2006)
New Revision: 145

Modified:
   trunk/Search/Plugins/Lycos.src
Log:
Fixed page browsing.


Modified: trunk/Search/Plugins/Lycos.src
===================================================================
--- trunk/Search/Plugins/Lycos.src	2006-03-09 13:35:05 UTC (rev 144)
+++ trunk/Search/Plugins/Lycos.src	2006-03-09 13:42:43 UTC (rev 145)
@@ -15,7 +15,7 @@
 <INPUT NAME="wfc" VALUE="3">
 <INPUT NAME="query" USER>
 <INPUT NAME="adf" VALUE="off">
-<INPUTNEXT NAME="first" FACTOR="10" VALUE="1">
+<INPUTNEXT NAME="p" FACTOR="1" VALUE="1">
 
 <INTERPRET
 resultListStart=""



From fabricecolin at berlios.de  Thu Mar  9 14:48:24 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Thu, 9 Mar 2006 14:48:24 +0100
Subject: [Pinot-svn] r146 - trunk
Message-ID: <200603091348.k29DmO7g011938@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-09 14:48:14 +0100 (Thu, 09 Mar 2006)
New Revision: 146

Modified:
   trunk/AUTHORS
   trunk/Makefile.am
   trunk/TODO
   trunk/configure.in
   trunk/pinot.spec.in
Log:
Distribute NEWS. Changed email address, bumped version number to v0.44.
+2 -1 items in TODO list.


Modified: trunk/AUTHORS
===================================================================
--- trunk/AUTHORS	2006-03-09 13:42:43 UTC (rev 145)
+++ trunk/AUTHORS	2006-03-09 13:48:14 UTC (rev 146)
@@ -1,6 +1,6 @@
 Pinot is written by :
 
-	Fabrice Colin <colinf at chez dot com>
+	Fabrice Colin <fabricecolin at users dot berlios dot de>
 
 Translations provided by :
 

Modified: trunk/Makefile.am
===================================================================
--- trunk/Makefile.am	2006-03-09 13:42:43 UTC (rev 145)
+++ trunk/Makefile.am	2006-03-09 13:48:14 UTC (rev 146)
@@ -4,7 +4,7 @@
 SUBDIRS = po Utils Tokenize SQL Collect Search \
 	Index UI/RenderHTML UI/GTK2/src
 
-EXTRA_DIST = ChangeLog TODO README mkinstalldirs pinot.spec \
+EXTRA_DIST = ChangeLog NEWS README TODO mkinstalldirs pinot.spec \
 	Search/Plugins/*src Search/Plugins/*.xml \
 	index.html UI/GTK2/xapian-powered.png UI/GTK2/pinot.png \
 	textcat_conf.txt UI/GTK2/metase-gtk2.glade UI/GTK2/metase-gtk2.gladep

Modified: trunk/TODO
===================================================================
--- trunk/TODO	2006-03-09 13:42:43 UTC (rev 145)
+++ trunk/TODO	2006-03-09 13:48:14 UTC (rev 146)
@@ -22,6 +22,7 @@
 - Add http://www.podzinger.com/
 - Implement AutoDiscovery of OpenSearch Description files (http://opensearch.a9.com/spec/1.1/description/)
 - Support for Google Buttons
+- If the results' domain match the search engine's, extract "<protocol>://(.*)&amp;" from the file part
 
 Collect
 - Comply with robot stuff defined at http://www.robotstxt.org/
@@ -47,7 +48,7 @@
 - Flush the index before searching not after modification
 - Hash document data to determine on updates whether documents have changed
 - Allow to monitor imported documents for changes
-- Allow to skip pages whose domain match the search engine's
+- With non local protocols, allow to skip pages whose domain match the search engine's
 
 Browser plugin
 - Write Firefox extension that searches Pinot indexes and indexes the cache
@@ -82,7 +83,6 @@
 - Automatic indexing of a query's results depending on type, source, size, language
 - Non modal status window to display log of operations
 - Display search engines icons (Gtk::IconSource::set_filename() and Gtk::Style::render_icon())
-- Only show documents that have the selected label, merge LabelQueryThread into IndexBrowser
 - Replace Combobox objects with ComboboxText's (glademm support required)
 - Replace glademm with libglademm ?
 - Show extract instead of URL in index list

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2006-03-09 13:42:43 UTC (rev 145)
+++ trunk/configure.in	2006-03-09 13:48:14 UTC (rev 146)
@@ -2,7 +2,7 @@
 # using glademm V2.6.0
 
 AC_PREREQ(2.50)
-AC_INIT(pinot, 0.43,[colinf at chez.com])
+AC_INIT(pinot, 0.44,[fabricecolin at users.berlios.de])
 AM_INIT_AUTOMAKE
 AC_CONFIG_HEADERS(config.h)
 

Modified: trunk/pinot.spec.in
===================================================================
--- trunk/pinot.spec.in	2006-03-09 13:42:43 UTC (rev 145)
+++ trunk/pinot.spec.in	2006-03-09 13:48:14 UTC (rev 146)
@@ -76,7 +76,7 @@
 
 %files
 %defattr(-, root, root, -)
-%doc ChangeLog COPYING README TODO
+%doc ChangeLog COPYING NEWS README TODO
 %{_bindir}/pinot
 %{_bindir}/pinot_search
 %{_datadir}/pinot/index.html



From fabricecolin at berlios.de  Sun Mar 12 07:52:52 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Sun, 12 Mar 2006 07:52:52 +0100
Subject: [Pinot-svn] r147 - in trunk: . po
Message-ID: <200603120652.k2C6qqs2026083@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-12 07:52:29 +0100 (Sun, 12 Mar 2006)
New Revision: 147

Modified:
   trunk/NEWS
   trunk/po/es.po
   trunk/po/fr.po
Log:
Updating translations and news.


Modified: trunk/NEWS
===================================================================
--- trunk/NEWS	2006-03-09 13:48:14 UTC (rev 146)
+++ trunk/NEWS	2006-03-12 06:52:29 UTC (rev 147)
@@ -1,3 +1,18 @@
+2006/03/12 version_0_4_4
+Build :
+ - fixed building of PDF, RTF and MS Word tokenizer libraries
+ - HTTP library can be selected with "./configure --with-http=curl|neon"
+Collect :
+ - added curl-based downloader, used by default instead of Neon
+Index :
+ - dropped dependency on OTS, abstracts are now generated at search time
+Search :
+ - fixed page browsing with Lycos plugin
+UI :
+ - fixed potential deadlock, eg between saving preferences and listing the index
+ - labels no longer have colours; selecting a label on an index only lists
+  those documents that have the label
+
 2006/02/25 version_0_4_3
 Build :
  - dropped patch for libxml++ v0.26 support

Modified: trunk/po/es.po
===================================================================
--- trunk/po/es.po	2006-03-09 13:48:14 UTC (rev 146)
+++ trunk/po/es.po	2006-03-12 06:52:29 UTC (rev 147)
@@ -8,7 +8,7 @@
 msgstr ""
 "Project-Id-Version: pinot 0.43\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2006-02-23 21:47+0800\n"
+"POT-Creation-Date: 2006-03-08 22:19+0800\n"
 "PO-Revision-Date: 2006-01-30 16:44+0800\n"
 "Last-Translator: Jes?s Tramullas <jesus at tramullas.com>\n"
 "Language-Team: es <jesus at tramullas.com>\n"
@@ -24,26 +24,19 @@
 msgid "Current User"
 msgstr "Usuario"
 
-#. Populate the submenu
-#. Bind the callback's parameter to the index name
-#. Enable these menu items, unless the index is not the documents index
-#. Internal indices
-#: UI/GTK2/src/EnginesTree.cpp:303 UI/GTK2/src/mainWindow.cc:343
-#: UI/GTK2/src/mainWindow.cc:346 UI/GTK2/src/mainWindow.cc:519
-#: UI/GTK2/src/mainWindow.cc:1054 UI/GTK2/src/mainWindow.cc:1138
-#: UI/GTK2/src/mainWindow.cc:1173 UI/GTK2/src/mainWindow.cc:1790
-#: UI/GTK2/src/PinotSettings.cpp:199 UI/GTK2/src/PinotSettings.cpp:881
-#: UI/GTK2/src/PinotSettings.cpp:937
+#: UI/GTK2/src/mainWindow.cc:375 UI/GTK2/src/mainWindow.cc:545
+#: UI/GTK2/src/mainWindow.cc:1010 UI/GTK2/src/mainWindow.cc:1097
+#: UI/GTK2/src/mainWindow.cc:1132 UI/GTK2/src/mainWindow.cc:1741
+#: UI/GTK2/src/PinotSettings.cpp:199 UI/GTK2/src/PinotSettings.cpp:854
+#: UI/GTK2/src/PinotSettings.cpp:910
 msgid "My Documents"
 msgstr "Mis documentos"
 
-#. Bind the callback's parameter to the index name
-#. Signal
-#: UI/GTK2/src/EnginesTree.cpp:307 UI/GTK2/src/mainWindow.cc:349
-#: UI/GTK2/src/mainWindow.cc:352 UI/GTK2/src/mainWindow.cc:523
+#: UI/GTK2/src/EnginesTree.cpp:307 UI/GTK2/src/mainWindow.cc:378
+#: UI/GTK2/src/mainWindow.cc:381 UI/GTK2/src/mainWindow.cc:549
 #: UI/GTK2/src/MonitorHandler.cpp:173 UI/GTK2/src/PinotSettings.cpp:200
-#: UI/GTK2/src/PinotSettings.cpp:882 UI/GTK2/src/PinotSettings.cpp:938
-#: UI/GTK2/src/prefsDialog_glade.cc:116
+#: UI/GTK2/src/PinotSettings.cpp:855 UI/GTK2/src/PinotSettings.cpp:911
+#: UI/GTK2/src/prefsDialog_glade.cc:110
 msgid "My Email"
 msgstr "Mi email"
 
@@ -63,18 +56,16 @@
 msgid "Directory"
 msgstr "Directorio"
 
-#. The last column is for the URL
 #: UI/GTK2/src/importDialog.cc:142 UI/GTK2/src/IndexTree.cpp:70
 #: UI/GTK2/src/ResultsTree.cpp:114
 msgid "URL"
 msgstr "URL"
 
-#: UI/GTK2/src/importDialog.cc:148 UI/GTK2/src/IndexPage.cpp:158
-#: UI/GTK2/src/IndexPage.cpp:204 UI/GTK2/src/queryDialog.cc:91
+#: UI/GTK2/src/importDialog.cc:148 UI/GTK2/src/queryDialog.cc:91
 msgid "None"
 msgstr "Ninguno"
 
-#: UI/GTK2/src/importDialog.cc:444
+#: UI/GTK2/src/importDialog.cc:445
 msgid "Document To Import"
 msgstr "Documento a importar"
 
@@ -136,8 +127,6 @@
 msgid "External index"
 msgstr "?ndice externo"
 
-#. The score column is used for status icons
-#. The title column is also used for status icons
 #: UI/GTK2/src/IndexTree.cpp:64 UI/GTK2/src/ResultsTree.cpp:96
 msgid "Title"
 msgstr "T?tulo"
@@ -154,251 +143,228 @@
 msgid "Show Next"
 msgstr "Mostrar siguientes"
 
-#: UI/GTK2/src/mainWindow.cc:144
+#: UI/GTK2/src/IndexPage.cpp:158 UI/GTK2/src/IndexPage.cpp:204
+msgid "All labels"
+msgstr "Todos etiquetas"
+
+#: UI/GTK2/src/mainWindow.cc:180
 msgid "Query Name"
 msgstr "Nombre de la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:149
+#: UI/GTK2/src/mainWindow.cc:185
 msgid "Last Run"
 msgstr "?ltima ejecuci?n"
 
-#: UI/GTK2/src/mainWindow.cc:150
+#: UI/GTK2/src/mainWindow.cc:186
 msgid "Summary"
 msgstr "Sumario"
 
-#. Set tooltips
-#: UI/GTK2/src/mainWindow.cc:210
+#: UI/GTK2/src/mainWindow.cc:246
 msgid "Add index"
 msgstr "A?adir ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:211
+#: UI/GTK2/src/mainWindow.cc:247
 msgid "Remove index"
 msgstr "Borrar ?ndice"
 
-#. The handler object will be deleted when the thread terminates
-#. Now we are ready
-#: UI/GTK2/src/mainWindow.cc:234
+#: UI/GTK2/src/mainWindow.cc:263
 msgid "Ready"
 msgstr "Listo"
 
-#. Stop in case we were loading a page
-#. Close the existing view page
-#: UI/GTK2/src/mainWindow.cc:248 UI/GTK2/src/mainWindow.cc:1011
-#: UI/GTK2/src/mainWindow.cc:1383 UI/GTK2/src/mainWindow.cc:2968
+#: UI/GTK2/src/mainWindow.cc:277 UI/GTK2/src/mainWindow.cc:967
+#: UI/GTK2/src/mainWindow.cc:1334 UI/GTK2/src/mainWindow.cc:2920
 #: UI/GTK2/src/mainWindow_glade.cc:207
 msgid "View"
 msgstr "Ver"
 
-#: UI/GTK2/src/mainWindow.cc:280
+#: UI/GTK2/src/mainWindow.cc:309
 msgid "N/A"
 msgstr "Desconocido"
 
-#: UI/GTK2/src/mainWindow.cc:290
+#: UI/GTK2/src/mainWindow.cc:319
 msgid "<undefined>"
 msgstr "<indefinido>"
 
-#. Show the URL in the status bar
-#: UI/GTK2/src/mainWindow.cc:481
+#: UI/GTK2/src/mainWindow.cc:507
 msgid "Result location is"
 msgstr "La localizaci?n del resultado es"
 
-#. Show the URL in the status bar
-#: UI/GTK2/src/mainWindow.cc:534
+#: UI/GTK2/src/mainWindow.cc:560
 msgid "Document location is"
 msgstr "La localizaci?n del documento es"
 
-#. User selected no label
-#: UI/GTK2/src/mainWindow.cc:643
-msgid "No label"
-msgstr "Sin etiqueta"
-
-#: UI/GTK2/src/mainWindow.cc:792
+#: UI/GTK2/src/mainWindow.cc:812
 msgid "Showing"
 msgstr "Mostrando"
 
-#: UI/GTK2/src/mainWindow.cc:797
+#: UI/GTK2/src/mainWindow.cc:817
 msgid "off"
 msgstr "desactivado"
 
-#: UI/GTK2/src/mainWindow.cc:802
+#: UI/GTK2/src/mainWindow.cc:822
 msgid "documents, starting at"
 msgstr "documentos comenzando en"
 
-#: UI/GTK2/src/mainWindow.cc:836
+#: UI/GTK2/src/mainWindow.cc:856
 msgid "Query"
 msgstr "B?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:840 UI/GTK2/src/mainWindow.cc:2797
+#: UI/GTK2/src/mainWindow.cc:860 UI/GTK2/src/mainWindow.cc:2748
 msgid "on"
 msgstr "en"
 
-#: UI/GTK2/src/mainWindow.cc:844
+#: UI/GTK2/src/mainWindow.cc:864
 msgid "ended"
 msgstr "finalizado"
 
-#: UI/GTK2/src/mainWindow.cc:945 UI/GTK2/src/propertiesDialog.cc:40
-msgid "Label"
-msgstr "Etiqueta"
-
-#: UI/GTK2/src/mainWindow.cc:949
-msgid "matches"
-msgstr "correspondencias"
-
-#: UI/GTK2/src/mainWindow.cc:954
-msgid "document(s)"
-msgstr "documento(s)"
-
-#: UI/GTK2/src/mainWindow.cc:986
+#: UI/GTK2/src/mainWindow.cc:942
 msgid "Updated label(s)"
 msgstr "Etiqueta(s) actualizada(s)"
 
-#. Yes, it did
-#: UI/GTK2/src/mainWindow.cc:1064 UI/GTK2/src/mainWindow.cc:1184
+#: UI/GTK2/src/mainWindow.cc:1020 UI/GTK2/src/mainWindow.cc:1143
 msgid "Updated document"
 msgstr "Documento actualizado"
 
-#: UI/GTK2/src/mainWindow.cc:1077
+#: UI/GTK2/src/mainWindow.cc:1036
 msgid "Indexed"
 msgstr "Indizado"
 
-#: UI/GTK2/src/mainWindow.cc:1139
+#: UI/GTK2/src/mainWindow.cc:1098
 msgid "Unindexed document(s)"
 msgstr "Documento(s) no indizado(s)"
 
-#: UI/GTK2/src/mainWindow.cc:1235
+#: UI/GTK2/src/mainWindow.cc:1190
 msgid "Couldn't rename index, name"
 msgstr "No se podu renombrar el ?ndice, nombre"
 
-#: UI/GTK2/src/mainWindow.cc:1239 UI/GTK2/src/mainWindow.cc:2144
-#: UI/GTK2/src/mainWindow.cc:2631
+#: UI/GTK2/src/mainWindow.cc:1194 UI/GTK2/src/mainWindow.cc:2095
+#: UI/GTK2/src/mainWindow.cc:2582
 msgid "is already in use"
 msgstr "ya est? en uso"
 
-#: UI/GTK2/src/mainWindow.cc:1252
+#: UI/GTK2/src/mainWindow.cc:1207
 msgid "Couldn't rename index"
 msgstr "No se pudo renombrar el ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:1265
+#: UI/GTK2/src/mainWindow.cc:1220
 msgid "Edited index"
 msgstr "?ndice editado"
 
-#: UI/GTK2/src/mainWindow.cc:1729 UI/GTK2/src/mainWindow.cc:1832
+#: UI/GTK2/src/mainWindow.cc:1680 UI/GTK2/src/mainWindow.cc:1783
 msgid "Please set a location for the index first"
 msgstr "Por favor, primero fije una localizaci?n para el ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:1756
+#: UI/GTK2/src/mainWindow.cc:1707
 msgid "Result location is unknown"
 msgstr "Se desconoce la localizaci?n del resultado"
 
-#: UI/GTK2/src/mainWindow.cc:1780
+#: UI/GTK2/src/mainWindow.cc:1731
 msgid "Import Document(s)"
 msgstr "Importar Documento(s)"
 
-#: UI/GTK2/src/mainWindow.cc:1910 UI/GTK2/src/WorkerThreads.cpp:395
-#: UI/GTK2/src/WorkerThreads.cpp:614 UI/GTK2/src/WorkerThreads.cpp:1175
+#: UI/GTK2/src/mainWindow.cc:1861 UI/GTK2/src/WorkerThreads.cpp:392
+#: UI/GTK2/src/WorkerThreads.cpp:1108
 msgid "Index"
 msgstr "?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:1914 UI/GTK2/src/WorkerThreads.cpp:399
-#: UI/GTK2/src/WorkerThreads.cpp:618 UI/GTK2/src/WorkerThreads.cpp:1179
+#: UI/GTK2/src/mainWindow.cc:1865 UI/GTK2/src/WorkerThreads.cpp:396
+#: UI/GTK2/src/WorkerThreads.cpp:1112
 msgid "doesn't exist"
 msgstr "no existe"
 
-#: UI/GTK2/src/mainWindow.cc:2024
+#: UI/GTK2/src/mainWindow.cc:1975
 msgid "Delete this document from the index ?"
 msgstr "Enlever ce document de l'index ?"
 
-#: UI/GTK2/src/mainWindow.cc:2043
+#: UI/GTK2/src/mainWindow.cc:1994
 msgid "Delete these documents from the index ?"
 msgstr "?Borrar este documento del ?ndice?"
 
-#: UI/GTK2/src/mainWindow.cc:2095
+#: UI/GTK2/src/mainWindow.cc:2046
 msgid "A metasearch tool for the Free Desktop"
 msgstr "Una herramienta metabuscador para el escritorio libre"
 
-#: UI/GTK2/src/mainWindow.cc:2096
+#: UI/GTK2/src/mainWindow.cc:2047
 msgid "(C) 2005-2006 Fabrice Colin"
 msgstr "(C) 2005-2006 Fabrice Colin"
 
-#: UI/GTK2/src/mainWindow.cc:2140
+#: UI/GTK2/src/mainWindow.cc:2091
 msgid "Index name"
 msgstr "Nombre del ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2155
+#: UI/GTK2/src/mainWindow.cc:2106
 msgid "Couldn't add index"
 msgstr "No se pudo a?adir el ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2169
+#: UI/GTK2/src/mainWindow.cc:2120
 msgid "Added new index"
 msgstr "A?adido un nuevo ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2204
+#: UI/GTK2/src/mainWindow.cc:2155
 msgid "Couldn't remove index"
 msgstr "No se pudo borrar el ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2293
-#, fuzzy
+#: UI/GTK2/src/mainWindow.cc:2244
 msgid "Live query"
 msgstr "B?squeda editada"
 
-#: UI/GTK2/src/mainWindow.cc:2446
+#: UI/GTK2/src/mainWindow.cc:2397
 msgid "At least one task hasn't completed yet. Quit now ?"
 msgstr "Al menos una tarea no ha finalizado. ?Parar ahora?"
 
-#: UI/GTK2/src/mainWindow.cc:2627
+#: UI/GTK2/src/mainWindow.cc:2578
 msgid "Query name"
 msgstr "Nombre la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:2654
+#: UI/GTK2/src/mainWindow.cc:2605
 msgid "Couldn't update query"
 msgstr "No se pudo actualizar la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:2662
+#: UI/GTK2/src/mainWindow.cc:2613
 msgid "Edited query"
 msgstr "B?squeda editada"
 
-#: UI/GTK2/src/mainWindow.cc:2669
+#: UI/GTK2/src/mainWindow.cc:2620
 msgid "Couldn't add query"
 msgstr "No se pudo a?adir la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:2677
+#: UI/GTK2/src/mainWindow.cc:2628
 msgid "Added new query"
 msgstr "A?adida una nueva b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:2691
+#: UI/GTK2/src/mainWindow.cc:2642
 msgid "Query is not set"
 msgstr "B?squeda no definida"
 
-#: UI/GTK2/src/mainWindow.cc:2702
+#: UI/GTK2/src/mainWindow.cc:2653
 msgid "No search engine selected"
 msgstr "Motor de b?squeda no seleccionado"
 
-#: UI/GTK2/src/mainWindow.cc:2784
+#: UI/GTK2/src/mainWindow.cc:2735
 msgid "Please set the Google API key first"
 msgstr "Por favor, primero configure el API de Google"
 
-#: UI/GTK2/src/mainWindow.cc:2793
+#: UI/GTK2/src/mainWindow.cc:2744
 msgid "Running query"
 msgstr "Ejecutando la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:2899
+#: UI/GTK2/src/mainWindow.cc:2851
 msgid "is already indexed or is being indexed"
 msgstr "ya ha sido indizado, o se est? indizando"
 
-#: UI/GTK2/src/mainWindow.cc:2926
+#: UI/GTK2/src/mainWindow.cc:2878
 msgid "No URL to browse"
 msgstr "No hay URL que mostrar"
 
-#: UI/GTK2/src/mainWindow.cc:2937
+#: UI/GTK2/src/mainWindow.cc:2889
 msgid "No browser configured to view results"
 msgstr "NO ha configurado un navegador para ver los resultados"
 
-#: UI/GTK2/src/mainWindow.cc:2949
+#: UI/GTK2/src/mainWindow.cc:2901
 msgid "Couldn't browse URL:"
 msgstr "No se pudo mostrar el URL:"
 
-#: UI/GTK2/src/mainWindow.cc:3008
-#, fuzzy
+#: UI/GTK2/src/mainWindow.cc:2960
 msgid "Viewing"
 msgstr "Ver"
 
@@ -406,7 +372,7 @@
 msgid "Query:"
 msgstr "B?squeda:"
 
-#: UI/GTK2/src/mainWindow_glade.cc:127 UI/GTK2/src/prefsDialog_glade.cc:86
+#: UI/GTK2/src/mainWindow_glade.cc:127
 msgid "Edit"
 msgstr "Editar"
 
@@ -492,7 +458,6 @@
 msgid "Couldn't save configuration file"
 msgstr "No se pudo guardar el fichero de configuraci?n"
 
-#. Localize language names
 #: UI/GTK2/src/pinot.cc:120
 msgid "Danish"
 msgstr "Dan?s"
@@ -560,46 +525,47 @@
 msgstr "Fallo en el fichero de configuraci?n"
 
 #: UI/GTK2/src/PinotSettings.cpp:204
-msgid "Red"
-msgstr "Rojo"
+#, fuzzy
+msgid "Important"
+msgstr "Importante"
 
+#: UI/GTK2/src/PinotSettings.cpp:205
+msgid "New"
+msgstr "Nuevo"
+
 #: UI/GTK2/src/PinotSettings.cpp:206
-msgid "Blue"
-msgstr "Azul"
+msgid "Personal"
+msgstr "Personal"
 
-#: UI/GTK2/src/PinotSettings.cpp:208
-msgid "Green"
-msgstr "Verde"
-
-#: UI/GTK2/src/PinotSettings.cpp:289
+#: UI/GTK2/src/PinotSettings.cpp:286
 msgid "Couldn't load ui block"
 msgstr "No se pudo cargar el bloque ui"
 
-#: UI/GTK2/src/PinotSettings.cpp:296
+#: UI/GTK2/src/PinotSettings.cpp:293
 msgid "Couldn't load extraindex block"
 msgstr "No se pudo cargar el bloque extraindex"
 
-#: UI/GTK2/src/PinotSettings.cpp:303
+#: UI/GTK2/src/PinotSettings.cpp:300
 msgid "Couldn't load storedquery block"
 msgstr "No se pudo cargar el bloque storedquery"
 
-#: UI/GTK2/src/PinotSettings.cpp:310
+#: UI/GTK2/src/PinotSettings.cpp:307
 msgid "Couldn't load results block"
 msgstr "o se pudo cargar el bloque results"
 
-#: UI/GTK2/src/PinotSettings.cpp:317
+#: UI/GTK2/src/PinotSettings.cpp:314
 msgid "Couldn't load label block"
 msgstr "o se pudo cargar el bloque label"
 
-#: UI/GTK2/src/PinotSettings.cpp:335
+#: UI/GTK2/src/PinotSettings.cpp:332
 msgid "Couldn't load mailaccount block"
 msgstr "No se pudo cargar el bloque mailaccount"
 
-#: UI/GTK2/src/PinotSettings.cpp:343
+#: UI/GTK2/src/PinotSettings.cpp:340
 msgid "Couldn't parse configuration file"
 msgstr "No se pudo procesar el fichero de configuraci?n"
 
-#: UI/GTK2/src/PinotSettings.cpp:732
+#: UI/GTK2/src/PinotSettings.cpp:711
 msgid "Unclassified"
 msgstr "No clasificado"
 
@@ -619,20 +585,15 @@
 msgid "In browser"
 msgstr "En el navegador"
 
-#: UI/GTK2/src/prefsDialog.cc:332
+#: UI/GTK2/src/prefsDialog.cc:323
 msgid "Browser location"
 msgstr "Mostrar la localizaci?n"
 
-#: UI/GTK2/src/prefsDialog.cc:343
+#: UI/GTK2/src/prefsDialog.cc:334
 msgid "New Label"
 msgstr "Nueva etiqueta"
 
-#: UI/GTK2/src/prefsDialog.cc:365
-msgid "Colour"
-msgstr "Color"
-
-#. Let the user edit the location
-#: UI/GTK2/src/prefsDialog.cc:436 UI/GTK2/src/prefsDialog.cc:470
+#: UI/GTK2/src/prefsDialog.cc:386 UI/GTK2/src/prefsDialog.cc:420
 msgid "Mbox File Location"
 msgstr "Localizaci?n del fichero mbox"
 
@@ -664,26 +625,30 @@
 msgid "Labels are used to classify indexed documents:"
 msgstr "Las etiquetas se usan para clasificar los documentos indizados:"
 
-#: UI/GTK2/src/prefsDialog_glade.cc:80 UI/GTK2/src/prefsDialog_glade.cc:106
+#: UI/GTK2/src/prefsDialog_glade.cc:80 UI/GTK2/src/prefsDialog_glade.cc:100
 msgid "Add"
 msgstr "A?adir"
 
-#: UI/GTK2/src/prefsDialog_glade.cc:92
+#: UI/GTK2/src/prefsDialog_glade.cc:86
 msgid "Remove"
 msgstr "Borrar"
 
-#: UI/GTK2/src/prefsDialog_glade.cc:100
+#: UI/GTK2/src/prefsDialog_glade.cc:94
 msgid "Labels"
 msgstr "Etiquetas"
 
-#: UI/GTK2/src/prefsDialog_glade.cc:101
+#: UI/GTK2/src/prefsDialog_glade.cc:95
 msgid "Mail boxes of type mbox can be monitored and indexed:"
 msgstr "Lo sbuzones de correo de tipo mbox pueden ser controlados e indizados"
 
-#: UI/GTK2/src/prefsDialog_glade.cc:332
+#: UI/GTK2/src/prefsDialog_glade.cc:309
 msgid "Preferences"
 msgstr "Preferencias"
 
+#: UI/GTK2/src/propertiesDialog.cc:40
+msgid "Label"
+msgstr "Etiqueta"
+
 #: UI/GTK2/src/propertiesDialog.cc:51
 msgid "Unknown"
 msgstr "Desconocido"
@@ -756,114 +721,131 @@
 msgid "Query properties"
 msgstr "Propriedades de la b?squeda"
 
-#: UI/GTK2/src/WorkerThreads.cpp:374
+#: UI/GTK2/src/WorkerThreads.cpp:371
 msgid "Stopped browsing"
 msgstr "Exploraci?n detenida"
 
-#: UI/GTK2/src/WorkerThreads.cpp:407 UI/GTK2/src/WorkerThreads.cpp:625
-#: UI/GTK2/src/WorkerThreads.cpp:662 UI/GTK2/src/WorkerThreads.cpp:671
-#: UI/GTK2/src/WorkerThreads.cpp:864 UI/GTK2/src/WorkerThreads.cpp:1068
-#: UI/GTK2/src/WorkerThreads.cpp:1187
+#: UI/GTK2/src/WorkerThreads.cpp:404 UI/GTK2/src/WorkerThreads.cpp:602
+#: UI/GTK2/src/WorkerThreads.cpp:611 UI/GTK2/src/WorkerThreads.cpp:800
+#: UI/GTK2/src/WorkerThreads.cpp:1001 UI/GTK2/src/WorkerThreads.cpp:1120
 msgid "Index error on"
 msgstr "Error en el ?ndice"
 
-#: UI/GTK2/src/WorkerThreads.cpp:504
+#: UI/GTK2/src/WorkerThreads.cpp:509
 msgid "Stopped querying"
 msgstr "B?squeda detenida"
 
-#: UI/GTK2/src/WorkerThreads.cpp:516
+#: UI/GTK2/src/WorkerThreads.cpp:521
 msgid "Couldn't create search engine"
 msgstr "No se pudo crear el motor de b?squeda"
 
-#: UI/GTK2/src/WorkerThreads.cpp:527
+#: UI/GTK2/src/WorkerThreads.cpp:532
 msgid "Couldn't run query on search engine"
 msgstr "No se pudo ejecutar la b?squeda contra el motor"
 
-#: UI/GTK2/src/WorkerThreads.cpp:543
+#: UI/GTK2/src/WorkerThreads.cpp:548
 msgid "No title"
 msgstr "Sin t?tulo"
 
-#: UI/GTK2/src/WorkerThreads.cpp:598 UI/GTK2/src/WorkerThreads.cpp:653
+#: UI/GTK2/src/WorkerThreads.cpp:593
 msgid "Stopped querying index labels"
 msgstr "Detenida la b?squeda de etiquetas de ?ndice"
 
-#: UI/GTK2/src/WorkerThreads.cpp:732
+#: UI/GTK2/src/WorkerThreads.cpp:670
 msgid "Stopped retrieval of"
 msgstr "Detenida la recuperaci?n de"
 
-#: UI/GTK2/src/WorkerThreads.cpp:768
+#: UI/GTK2/src/WorkerThreads.cpp:704
 msgid "Couldn't obtain downloader for protocol"
 msgstr "No se pudo usar un recuperador para el protocolo"
 
-#: UI/GTK2/src/WorkerThreads.cpp:782 UI/GTK2/src/WorkerThreads.cpp:877
+#: UI/GTK2/src/WorkerThreads.cpp:718 UI/GTK2/src/WorkerThreads.cpp:813
 msgid "Couldn't retrieve"
 msgstr "No se pudo descargar"
 
-#: UI/GTK2/src/WorkerThreads.cpp:849
+#: UI/GTK2/src/WorkerThreads.cpp:785
 msgid "Stopped indexing"
 msgstr "Detenida la indizaci?n"
 
-#: UI/GTK2/src/WorkerThreads.cpp:901
+#: UI/GTK2/src/WorkerThreads.cpp:837
 msgid "Cannot index document type"
 msgstr "No se pudo indizar el tipo de documento"
 
-#: UI/GTK2/src/WorkerThreads.cpp:905
+#: UI/GTK2/src/WorkerThreads.cpp:841
 msgid "at"
 msgstr "a"
 
-#: UI/GTK2/src/WorkerThreads.cpp:929
+#: UI/GTK2/src/WorkerThreads.cpp:865
 msgid "Couldn't tokenize"
 msgstr "No se pudo parcourir"
 
-#: UI/GTK2/src/WorkerThreads.cpp:949
+#: UI/GTK2/src/WorkerThreads.cpp:885
 msgid "Robots META tag forbids indexing"
 msgstr "La etiqueta META Robots proh?be la indizaci?n"
 
-#: UI/GTK2/src/WorkerThreads.cpp:998
+#: UI/GTK2/src/WorkerThreads.cpp:934
 msgid "Couldn't index"
 msgstr "No se pudo indizar"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1056
+#: UI/GTK2/src/WorkerThreads.cpp:989
 msgid "Stopped unindexing document(s)"
 msgstr "Detenida la desindizaci?n de documento(s)"
 
-#. Be pessimistic and assume something will go wrong ;-)
-#: UI/GTK2/src/WorkerThreads.cpp:1075
+#: UI/GTK2/src/WorkerThreads.cpp:1008
 msgid "Couldn't unindex document(s)"
 msgstr "No se pudo desindizar lo(s) documento(s)"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1160
+#: UI/GTK2/src/WorkerThreads.cpp:1093
 msgid "Stopped document update for"
 msgstr "Detenida la actualizaci?n del documento por"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1195
+#: UI/GTK2/src/WorkerThreads.cpp:1128
 msgid "Couldn't update document"
 msgstr "No se pudo actualizar el documento"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1238
-msgid "Stopped listening on"
-msgstr "Detenida la escucha en"
-
-#: UI/GTK2/src/WorkerThreads.cpp:1341
-msgid "Couldn't read FIFO at"
-msgstr "No se pudo leer FIFO en"
-
-#: UI/GTK2/src/WorkerThreads.cpp:1384
+#: UI/GTK2/src/WorkerThreads.cpp:1178
 msgid "Stopped monitoring"
 msgstr "Detenida la monitorizaci?n"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1405
+#: UI/GTK2/src/WorkerThreads.cpp:1199
 msgid "No monitoring handler"
 msgstr "No hay monitorizaci?n"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1451
+#: UI/GTK2/src/WorkerThreads.cpp:1242
 msgid "Couldn't open FAM connection"
 msgstr "No se pudo abrir la conexi?n FAM"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1653
+#: UI/GTK2/src/WorkerThreads.cpp:1441
 msgid "Stopped scanning"
 msgstr "Detenida la exploraci?n"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1811
+#: UI/GTK2/src/WorkerThreads.cpp:1599
 msgid "Couldn't open directory"
 msgstr "No se pudo abrir el directorio"
+
+#~ msgid "Red"
+#~ msgstr "Rojo"
+
+#~ msgid "Blue"
+#~ msgstr "Azul"
+
+#~ msgid "Green"
+#~ msgstr "Verde"
+
+#~ msgid "Colour"
+#~ msgstr "Color"
+
+#~ msgid "No label"
+#~ msgstr "Sin etiqueta"
+
+#~ msgid "matches"
+#~ msgstr "correspondencias"
+
+#~ msgid "document(s)"
+#~ msgstr "documento(s)"
+
+#~ msgid "Stopped listening on"
+#~ msgstr "Detenida la escucha en"
+
+#~ msgid "Couldn't read FIFO at"
+#~ msgstr "No se pudo leer FIFO en"

Modified: trunk/po/fr.po
===================================================================
--- trunk/po/fr.po	2006-03-09 13:48:14 UTC (rev 146)
+++ trunk/po/fr.po	2006-03-12 06:52:29 UTC (rev 147)
@@ -8,7 +8,7 @@
 msgstr ""
 "Project-Id-Version: pinot 0.43\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2006-02-23 21:47+0800\n"
+"POT-Creation-Date: 2006-03-08 22:19+0800\n"
 "PO-Revision-Date: 2006-01-20 19:44+0800\n"
 "Last-Translator: Fabrice Colin <colinf at chez.com>\n"
 "Language-Team: fr <colinf at chez.com>\n"
@@ -24,26 +24,20 @@
 msgid "Current User"
 msgstr "Utilisateur"
 
-#. Populate the submenu
-#. Bind the callback's parameter to the index name
-#. Enable these menu items, unless the index is not the documents index
-#. Internal indices
-#: UI/GTK2/src/EnginesTree.cpp:303 UI/GTK2/src/mainWindow.cc:343
-#: UI/GTK2/src/mainWindow.cc:346 UI/GTK2/src/mainWindow.cc:519
-#: UI/GTK2/src/mainWindow.cc:1054 UI/GTK2/src/mainWindow.cc:1138
-#: UI/GTK2/src/mainWindow.cc:1173 UI/GTK2/src/mainWindow.cc:1790
-#: UI/GTK2/src/PinotSettings.cpp:199 UI/GTK2/src/PinotSettings.cpp:881
-#: UI/GTK2/src/PinotSettings.cpp:937
+#: UI/GTK2/src/EnginesTree.cpp:303 UI/GTK2/src/mainWindow.cc:372
+#: UI/GTK2/src/mainWindow.cc:375 UI/GTK2/src/mainWindow.cc:545
+#: UI/GTK2/src/mainWindow.cc:1010 UI/GTK2/src/mainWindow.cc:1097
+#: UI/GTK2/src/mainWindow.cc:1132 UI/GTK2/src/mainWindow.cc:1741
+#: UI/GTK2/src/PinotSettings.cpp:199 UI/GTK2/src/PinotSettings.cpp:854
+#: UI/GTK2/src/PinotSettings.cpp:910
 msgid "My Documents"
 msgstr "Mes Documents"
 
-#. Bind the callback's parameter to the index name
-#. Signal
-#: UI/GTK2/src/EnginesTree.cpp:307 UI/GTK2/src/mainWindow.cc:349
-#: UI/GTK2/src/mainWindow.cc:352 UI/GTK2/src/mainWindow.cc:523
+#: UI/GTK2/src/EnginesTree.cpp:307 UI/GTK2/src/mainWindow.cc:378
+#: UI/GTK2/src/mainWindow.cc:381 UI/GTK2/src/mainWindow.cc:549
 #: UI/GTK2/src/MonitorHandler.cpp:173 UI/GTK2/src/PinotSettings.cpp:200
-#: UI/GTK2/src/PinotSettings.cpp:882 UI/GTK2/src/PinotSettings.cpp:938
-#: UI/GTK2/src/prefsDialog_glade.cc:116
+#: UI/GTK2/src/PinotSettings.cpp:855 UI/GTK2/src/PinotSettings.cpp:911
+#: UI/GTK2/src/prefsDialog_glade.cc:110
 msgid "My Email"
 msgstr "Mon Courrier"
 
@@ -63,18 +57,16 @@
 msgid "Directory"
 msgstr "Repertoire"
 
-#. The last column is for the URL
 #: UI/GTK2/src/importDialog.cc:142 UI/GTK2/src/IndexTree.cpp:70
 #: UI/GTK2/src/ResultsTree.cpp:114
 msgid "URL"
 msgstr "URL"
 
-#: UI/GTK2/src/importDialog.cc:148 UI/GTK2/src/IndexPage.cpp:158
-#: UI/GTK2/src/IndexPage.cpp:204 UI/GTK2/src/queryDialog.cc:91
+#: UI/GTK2/src/importDialog.cc:148 UI/GTK2/src/queryDialog.cc:91
 msgid "None"
 msgstr "Aucune"
 
-#: UI/GTK2/src/importDialog.cc:444
+#: UI/GTK2/src/importDialog.cc:445
 msgid "Document To Import"
 msgstr "Document A Importer"
 
@@ -136,8 +128,6 @@
 msgid "External index"
 msgstr "Index externe"
 
-#. The score column is used for status icons
-#. The title column is also used for status icons
 #: UI/GTK2/src/IndexTree.cpp:64 UI/GTK2/src/ResultsTree.cpp:96
 msgid "Title"
 msgstr "Titre"
@@ -154,251 +144,229 @@
 msgid "Show Next"
 msgstr "Suivants"
 
-#: UI/GTK2/src/mainWindow.cc:144
+#: UI/GTK2/src/IndexPage.cpp:158 UI/GTK2/src/IndexPage.cpp:204
+#, fuzzy
+msgid "All labels"
+msgstr "Toutes les etiquettes"
+
+#: UI/GTK2/src/mainWindow.cc:180
 msgid "Query Name"
 msgstr "Nom de la Recherche"
 
-#: UI/GTK2/src/mainWindow.cc:149
+#: UI/GTK2/src/mainWindow.cc:185
 msgid "Last Run"
 msgstr "Derniere Utilisation"
 
-#: UI/GTK2/src/mainWindow.cc:150
+#: UI/GTK2/src/mainWindow.cc:186
 msgid "Summary"
 msgstr "Sommaire"
 
-#. Set tooltips
-#: UI/GTK2/src/mainWindow.cc:210
+#: UI/GTK2/src/mainWindow.cc:246
 msgid "Add index"
 msgstr "Ajouter un index"
 
-#: UI/GTK2/src/mainWindow.cc:211
+#: UI/GTK2/src/mainWindow.cc:247
 msgid "Remove index"
 msgstr "Enlever un index"
 
-#. The handler object will be deleted when the thread terminates
-#. Now we are ready
-#: UI/GTK2/src/mainWindow.cc:234
+#: UI/GTK2/src/mainWindow.cc:263
 msgid "Ready"
 msgstr "Pret"
 
-#. Stop in case we were loading a page
-#. Close the existing view page
-#: UI/GTK2/src/mainWindow.cc:248 UI/GTK2/src/mainWindow.cc:1011
-#: UI/GTK2/src/mainWindow.cc:1383 UI/GTK2/src/mainWindow.cc:2968
+#: UI/GTK2/src/mainWindow.cc:277 UI/GTK2/src/mainWindow.cc:967
+#: UI/GTK2/src/mainWindow.cc:1334 UI/GTK2/src/mainWindow.cc:2920
 #: UI/GTK2/src/mainWindow_glade.cc:207
 msgid "View"
 msgstr "Voir"
 
-#: UI/GTK2/src/mainWindow.cc:280
+#: UI/GTK2/src/mainWindow.cc:309
 msgid "N/A"
 msgstr "Inconnue"
 
-#: UI/GTK2/src/mainWindow.cc:290
+#: UI/GTK2/src/mainWindow.cc:319
 msgid "<undefined>"
 msgstr "<inconnu>"
 
-#. Show the URL in the status bar
-#: UI/GTK2/src/mainWindow.cc:481
+#: UI/GTK2/src/mainWindow.cc:507
 msgid "Result location is"
 msgstr "La location du resultat est"
 
-#. Show the URL in the status bar
-#: UI/GTK2/src/mainWindow.cc:534
+#: UI/GTK2/src/mainWindow.cc:560
 msgid "Document location is"
 msgstr "La location du document is"
 
-#. User selected no label
-#: UI/GTK2/src/mainWindow.cc:643
-msgid "No label"
-msgstr "Pas d'etiquette"
-
-#: UI/GTK2/src/mainWindow.cc:792
+#: UI/GTK2/src/mainWindow.cc:812
 msgid "Showing"
 msgstr "Listant"
 
-#: UI/GTK2/src/mainWindow.cc:797
+#: UI/GTK2/src/mainWindow.cc:817
 msgid "off"
 msgstr "documents,"
 
-#: UI/GTK2/src/mainWindow.cc:802
+#: UI/GTK2/src/mainWindow.cc:822
 msgid "documents, starting at"
 msgstr "au total, a partir de"
 
-#: UI/GTK2/src/mainWindow.cc:836
+#: UI/GTK2/src/mainWindow.cc:856
 msgid "Query"
 msgstr "La recherche"
 
-#: UI/GTK2/src/mainWindow.cc:840 UI/GTK2/src/mainWindow.cc:2797
+#: UI/GTK2/src/mainWindow.cc:860 UI/GTK2/src/mainWindow.cc:2748
 msgid "on"
 msgstr "sur"
 
-#: UI/GTK2/src/mainWindow.cc:844
+#: UI/GTK2/src/mainWindow.cc:864
 msgid "ended"
 msgstr "est terminee"
 
-#: UI/GTK2/src/mainWindow.cc:945 UI/GTK2/src/propertiesDialog.cc:40
-msgid "Label"
-msgstr "L'etiquette"
-
-#: UI/GTK2/src/mainWindow.cc:949
-msgid "matches"
-msgstr "correspond a"
-
-#: UI/GTK2/src/mainWindow.cc:954
-msgid "document(s)"
-msgstr "document(s)"
-
-#: UI/GTK2/src/mainWindow.cc:986
+#: UI/GTK2/src/mainWindow.cc:942
 msgid "Updated label(s)"
 msgstr "Mis a jour l(es) etiquette(s)"
 
-#. Yes, it did
-#: UI/GTK2/src/mainWindow.cc:1064 UI/GTK2/src/mainWindow.cc:1184
+#: UI/GTK2/src/mainWindow.cc:1020 UI/GTK2/src/mainWindow.cc:1143
 msgid "Updated document"
 msgstr "Mis a jour le document"
 
-#: UI/GTK2/src/mainWindow.cc:1077
+#: UI/GTK2/src/mainWindow.cc:1036
 msgid "Indexed"
 msgstr "Indexe"
 
-#: UI/GTK2/src/mainWindow.cc:1139
+#: UI/GTK2/src/mainWindow.cc:1098
 msgid "Unindexed document(s)"
 msgstr "Desindexe le(s) document(s)"
 
-#: UI/GTK2/src/mainWindow.cc:1235
+#: UI/GTK2/src/mainWindow.cc:1190
 msgid "Couldn't rename index, name"
 msgstr "N'a pas pu renommer l'index, le nom"
 
-#: UI/GTK2/src/mainWindow.cc:1239 UI/GTK2/src/mainWindow.cc:2144
-#: UI/GTK2/src/mainWindow.cc:2631
+#: UI/GTK2/src/mainWindow.cc:1194 UI/GTK2/src/mainWindow.cc:2095
+#: UI/GTK2/src/mainWindow.cc:2582
 msgid "is already in use"
 msgstr "est deja utilise"
 
-#: UI/GTK2/src/mainWindow.cc:1252
+#: UI/GTK2/src/mainWindow.cc:1207
 msgid "Couldn't rename index"
 msgstr "N'a pas pu renommer l'index"
 
-#: UI/GTK2/src/mainWindow.cc:1265
+#: UI/GTK2/src/mainWindow.cc:1220
 msgid "Edited index"
 msgstr "Edite l'index"
 
-#: UI/GTK2/src/mainWindow.cc:1729 UI/GTK2/src/mainWindow.cc:1832
+#: UI/GTK2/src/mainWindow.cc:1680 UI/GTK2/src/mainWindow.cc:1783
 msgid "Please set a location for the index first"
 msgstr "Donnez une location a l'index"
 
-#: UI/GTK2/src/mainWindow.cc:1756
+#: UI/GTK2/src/mainWindow.cc:1707
 msgid "Result location is unknown"
 msgstr "La location du resultat est inconnue"
 
-#: UI/GTK2/src/mainWindow.cc:1780
+#: UI/GTK2/src/mainWindow.cc:1731
 msgid "Import Document(s)"
 msgstr "Import de Document(s)"
 
-#: UI/GTK2/src/mainWindow.cc:1910 UI/GTK2/src/WorkerThreads.cpp:395
-#: UI/GTK2/src/WorkerThreads.cpp:614 UI/GTK2/src/WorkerThreads.cpp:1175
+#: UI/GTK2/src/mainWindow.cc:1861 UI/GTK2/src/WorkerThreads.cpp:392
+#: UI/GTK2/src/WorkerThreads.cpp:1108
 msgid "Index"
 msgstr "L'index"
 
-#: UI/GTK2/src/mainWindow.cc:1914 UI/GTK2/src/WorkerThreads.cpp:399
-#: UI/GTK2/src/WorkerThreads.cpp:618 UI/GTK2/src/WorkerThreads.cpp:1179
+#: UI/GTK2/src/mainWindow.cc:1865 UI/GTK2/src/WorkerThreads.cpp:396
+#: UI/GTK2/src/WorkerThreads.cpp:1112
 msgid "doesn't exist"
 msgstr "n'existe pas"
 
-#: UI/GTK2/src/mainWindow.cc:2024
+#: UI/GTK2/src/mainWindow.cc:1975
 msgid "Delete this document from the index ?"
 msgstr "Enlever ce document de l'index ?"
 
-#: UI/GTK2/src/mainWindow.cc:2043
+#: UI/GTK2/src/mainWindow.cc:1994
 msgid "Delete these documents from the index ?"
 msgstr "Enlever ces documents de l'index ?"
 
-#: UI/GTK2/src/mainWindow.cc:2095
+#: UI/GTK2/src/mainWindow.cc:2046
 msgid "A metasearch tool for the Free Desktop"
 msgstr "Un outil de recherche pour le Bureau Libre"
 
-#: UI/GTK2/src/mainWindow.cc:2096
+#: UI/GTK2/src/mainWindow.cc:2047
 msgid "(C) 2005-2006 Fabrice Colin"
 msgstr "(C) 2005-2006 Fabrice Colin"
 
-#: UI/GTK2/src/mainWindow.cc:2140
+#: UI/GTK2/src/mainWindow.cc:2091
 msgid "Index name"
 msgstr "Nom de l'index"
 
-#: UI/GTK2/src/mainWindow.cc:2155
+#: UI/GTK2/src/mainWindow.cc:2106
 msgid "Couldn't add index"
 msgstr "N'a pas pu ajouter l'index"
 
-#: UI/GTK2/src/mainWindow.cc:2169
+#: UI/GTK2/src/mainWindow.cc:2120
 msgid "Added new index"
 msgstr "Ajoute un nouvel index"
 
-#: UI/GTK2/src/mainWindow.cc:2204
+#: UI/GTK2/src/mainWindow.cc:2155
 msgid "Couldn't remove index"
 msgstr "N'a pas pu enlever l'index"
 
-#: UI/GTK2/src/mainWindow.cc:2293
-#, fuzzy
+#: UI/GTK2/src/mainWindow.cc:2244
 msgid "Live query"
 msgstr "Recherche"
 
-#: UI/GTK2/src/mainWindow.cc:2446
+#: UI/GTK2/src/mainWindow.cc:2397
 msgid "At least one task hasn't completed yet. Quit now ?"
 msgstr "Au moins une tache n'est pas terminee. Quitter maintenant ?"
 
-#: UI/GTK2/src/mainWindow.cc:2627
+#: UI/GTK2/src/mainWindow.cc:2578
 msgid "Query name"
 msgstr "Nom de la recherche"
 
-#: UI/GTK2/src/mainWindow.cc:2654
+#: UI/GTK2/src/mainWindow.cc:2605
 msgid "Couldn't update query"
 msgstr "N'a pas pu mettre a jour la recherche"
 
-#: UI/GTK2/src/mainWindow.cc:2662
+#: UI/GTK2/src/mainWindow.cc:2613
 msgid "Edited query"
 msgstr "Edite la recherche"
 
-#: UI/GTK2/src/mainWindow.cc:2669
+#: UI/GTK2/src/mainWindow.cc:2620
 msgid "Couldn't add query"
 msgstr "N'a pas pu ajouter la recherche"
 
-#: UI/GTK2/src/mainWindow.cc:2677
+#: UI/GTK2/src/mainWindow.cc:2628
 msgid "Added new query"
 msgstr "Ajoute une nouvelle recherche"
 
-#: UI/GTK2/src/mainWindow.cc:2691
+#: UI/GTK2/src/mainWindow.cc:2642
 msgid "Query is not set"
 msgstr "Recherche indefinie"
 
-#: UI/GTK2/src/mainWindow.cc:2702
+#: UI/GTK2/src/mainWindow.cc:2653
 msgid "No search engine selected"
 msgstr "Pas de moteur selectionne"
 
-#: UI/GTK2/src/mainWindow.cc:2784
+#: UI/GTK2/src/mainWindow.cc:2735
 msgid "Please set the Google API key first"
 msgstr "Configurez la clef de l'API Google "
 
-#: UI/GTK2/src/mainWindow.cc:2793
+#: UI/GTK2/src/mainWindow.cc:2744
 msgid "Running query"
 msgstr "Recherche en cours"
 
-#: UI/GTK2/src/mainWindow.cc:2899
+#: UI/GTK2/src/mainWindow.cc:2851
 msgid "is already indexed or is being indexed"
 msgstr "est deja indexe ou est en cours d'indexation"
 
-#: UI/GTK2/src/mainWindow.cc:2926
+#: UI/GTK2/src/mainWindow.cc:2878
 msgid "No URL to browse"
 msgstr "Pas d'URL a brouter"
 
-#: UI/GTK2/src/mainWindow.cc:2937
+#: UI/GTK2/src/mainWindow.cc:2889
 msgid "No browser configured to view results"
 msgstr "Pas de brouter configure"
 
-#: UI/GTK2/src/mainWindow.cc:2949
+#: UI/GTK2/src/mainWindow.cc:2901
 msgid "Couldn't browse URL:"
 msgstr "N'a pas pu brouter l'URL"
 
-#: UI/GTK2/src/mainWindow.cc:3008
-#, fuzzy
+#: UI/GTK2/src/mainWindow.cc:2960
 msgid "Viewing"
 msgstr "Voir"
 
@@ -406,7 +374,7 @@
 msgid "Query:"
 msgstr "Recherche:"
 
-#: UI/GTK2/src/mainWindow_glade.cc:127 UI/GTK2/src/prefsDialog_glade.cc:86
+#: UI/GTK2/src/mainWindow_glade.cc:127
 msgid "Edit"
 msgstr "Editer"
 
@@ -492,7 +460,6 @@
 msgid "Couldn't save configuration file"
 msgstr "N'a pas pu sauve le fichier de configuration"
 
-#. Localize language names
 #: UI/GTK2/src/pinot.cc:120
 msgid "Danish"
 msgstr "Danois"
@@ -542,12 +509,10 @@
 msgstr "Suedois"
 
 #: UI/GTK2/src/pinot.cc:153 UI/GTK2/src/pinot.cc:161
-#, fuzzy
 msgid "Couldn't open index"
 msgstr "N'a pas pu ouvrir l'index"
 
 #: UI/GTK2/src/pinot.cc:171
-#, fuzzy
 msgid "Couldn't create history database"
 msgstr "N'a pas pu creer la base d'historiques"
 
@@ -560,46 +525,46 @@
 msgstr "N'a pas pu lire le fichier de configuration"
 
 #: UI/GTK2/src/PinotSettings.cpp:204
-msgid "Red"
-msgstr "Rouge"
+msgid "Important"
+msgstr "Important"
 
+#: UI/GTK2/src/PinotSettings.cpp:205
+msgid "New"
+msgstr "Nouveau"
+
 #: UI/GTK2/src/PinotSettings.cpp:206
-msgid "Blue"
-msgstr "Bleu"
+msgid "Personal"
+msgstr "Personnel"
 
-#: UI/GTK2/src/PinotSettings.cpp:208
-msgid "Green"
-msgstr "Vert"
-
-#: UI/GTK2/src/PinotSettings.cpp:289
+#: UI/GTK2/src/PinotSettings.cpp:286
 msgid "Couldn't load ui block"
 msgstr "N'a pas pu charger le bloc ui"
 
-#: UI/GTK2/src/PinotSettings.cpp:296
+#: UI/GTK2/src/PinotSettings.cpp:293
 msgid "Couldn't load extraindex block"
 msgstr "N'a pas pu charger le bloc extraindex"
 
-#: UI/GTK2/src/PinotSettings.cpp:303
+#: UI/GTK2/src/PinotSettings.cpp:300
 msgid "Couldn't load storedquery block"
 msgstr "N'a pas pu charger le bloc storedquery"
 
-#: UI/GTK2/src/PinotSettings.cpp:310
+#: UI/GTK2/src/PinotSettings.cpp:307
 msgid "Couldn't load results block"
 msgstr "N'a pas pu charger le bloc results"
 
-#: UI/GTK2/src/PinotSettings.cpp:317
+#: UI/GTK2/src/PinotSettings.cpp:314
 msgid "Couldn't load label block"
 msgstr "N'a pas pu charger le bloc label"
 
-#: UI/GTK2/src/PinotSettings.cpp:335
+#: UI/GTK2/src/PinotSettings.cpp:332
 msgid "Couldn't load mailaccount block"
 msgstr "N'a pas pu charger le bloc mailaccount"
 
-#: UI/GTK2/src/PinotSettings.cpp:343
+#: UI/GTK2/src/PinotSettings.cpp:340
 msgid "Couldn't parse configuration file"
 msgstr "N'a pas pu lire le fichier de configuration"
 
-#: UI/GTK2/src/PinotSettings.cpp:732
+#: UI/GTK2/src/PinotSettings.cpp:711
 msgid "Unclassified"
 msgstr "Sans classification"
 
@@ -619,20 +584,15 @@
 msgid "In browser"
 msgstr "Dans le brouteur"
 
-#: UI/GTK2/src/prefsDialog.cc:332
+#: UI/GTK2/src/prefsDialog.cc:323
 msgid "Browser location"
 msgstr "Location du brouteur"
 
-#: UI/GTK2/src/prefsDialog.cc:343
+#: UI/GTK2/src/prefsDialog.cc:334
 msgid "New Label"
 msgstr "Nouvelle Etiquette"
 
-#: UI/GTK2/src/prefsDialog.cc:365
-msgid "Colour"
-msgstr "Couleur"
-
-#. Let the user edit the location
-#: UI/GTK2/src/prefsDialog.cc:436 UI/GTK2/src/prefsDialog.cc:470
+#: UI/GTK2/src/prefsDialog.cc:386 UI/GTK2/src/prefsDialog.cc:420
 msgid "Mbox File Location"
 msgstr "Location du Fichier mbox"
 
@@ -664,26 +624,30 @@
 msgid "Labels are used to classify indexed documents:"
 msgstr "Les etiquettes servent a classer les documents:"
 
-#: UI/GTK2/src/prefsDialog_glade.cc:80 UI/GTK2/src/prefsDialog_glade.cc:106
+#: UI/GTK2/src/prefsDialog_glade.cc:80 UI/GTK2/src/prefsDialog_glade.cc:100
 msgid "Add"
 msgstr "Ajouter"
 
-#: UI/GTK2/src/prefsDialog_glade.cc:92
+#: UI/GTK2/src/prefsDialog_glade.cc:86
 msgid "Remove"
 msgstr "Enlever"
 
-#: UI/GTK2/src/prefsDialog_glade.cc:100
+#: UI/GTK2/src/prefsDialog_glade.cc:94
 msgid "Labels"
 msgstr "Etiquettes"
 
-#: UI/GTK2/src/prefsDialog_glade.cc:101
+#: UI/GTK2/src/prefsDialog_glade.cc:95
 msgid "Mail boxes of type mbox can be monitored and indexed:"
 msgstr "Les boites de type mbox peuvent etre indexees"
 
-#: UI/GTK2/src/prefsDialog_glade.cc:332
+#: UI/GTK2/src/prefsDialog_glade.cc:309
 msgid "Preferences"
 msgstr "Preferences"
 
+#: UI/GTK2/src/propertiesDialog.cc:40
+msgid "Label"
+msgstr "L'etiquette"
+
 #: UI/GTK2/src/propertiesDialog.cc:51
 msgid "Unknown"
 msgstr "Inconnu"
@@ -756,114 +720,104 @@
 msgid "Query properties"
 msgstr "Proprietes de la recherche"
 
-#: UI/GTK2/src/WorkerThreads.cpp:374
+#: UI/GTK2/src/WorkerThreads.cpp:371
 msgid "Stopped browsing"
 msgstr "Arrete de parcourir l'index"
 
-#: UI/GTK2/src/WorkerThreads.cpp:407 UI/GTK2/src/WorkerThreads.cpp:625
-#: UI/GTK2/src/WorkerThreads.cpp:662 UI/GTK2/src/WorkerThreads.cpp:671
-#: UI/GTK2/src/WorkerThreads.cpp:864 UI/GTK2/src/WorkerThreads.cpp:1068
-#: UI/GTK2/src/WorkerThreads.cpp:1187
+#: UI/GTK2/src/WorkerThreads.cpp:404 UI/GTK2/src/WorkerThreads.cpp:602
+#: UI/GTK2/src/WorkerThreads.cpp:611 UI/GTK2/src/WorkerThreads.cpp:800
+#: UI/GTK2/src/WorkerThreads.cpp:1001 UI/GTK2/src/WorkerThreads.cpp:1120
 msgid "Index error on"
 msgstr "Erreur sur l'index"
 
-#: UI/GTK2/src/WorkerThreads.cpp:504
+#: UI/GTK2/src/WorkerThreads.cpp:509
 msgid "Stopped querying"
 msgstr "Arrete la recherche"
 
-#: UI/GTK2/src/WorkerThreads.cpp:516
+#: UI/GTK2/src/WorkerThreads.cpp:521
 msgid "Couldn't create search engine"
 msgstr "N'a pas pu creer le moteur"
 
-#: UI/GTK2/src/WorkerThreads.cpp:527
+#: UI/GTK2/src/WorkerThreads.cpp:532
 msgid "Couldn't run query on search engine"
 msgstr "N'a pas pu lancer la recherche sur le moteur"
 
-#: UI/GTK2/src/WorkerThreads.cpp:543
+#: UI/GTK2/src/WorkerThreads.cpp:548
 msgid "No title"
 msgstr "Pas de titre"
 
-#: UI/GTK2/src/WorkerThreads.cpp:598 UI/GTK2/src/WorkerThreads.cpp:653
+#: UI/GTK2/src/WorkerThreads.cpp:593
 msgid "Stopped querying index labels"
 msgstr "Arrete la recherche d'etiquettes"
 
-#: UI/GTK2/src/WorkerThreads.cpp:732
+#: UI/GTK2/src/WorkerThreads.cpp:670
 msgid "Stopped retrieval of"
 msgstr "Arrete le telechargement de"
 
-#: UI/GTK2/src/WorkerThreads.cpp:768
+#: UI/GTK2/src/WorkerThreads.cpp:704
 msgid "Couldn't obtain downloader for protocol"
 msgstr "N'a pas pu obtenir un brouteur pour"
 
-#: UI/GTK2/src/WorkerThreads.cpp:782 UI/GTK2/src/WorkerThreads.cpp:877
+#: UI/GTK2/src/WorkerThreads.cpp:718 UI/GTK2/src/WorkerThreads.cpp:813
 msgid "Couldn't retrieve"
 msgstr "N'a pas pu telecharger"
 
-#: UI/GTK2/src/WorkerThreads.cpp:849
+#: UI/GTK2/src/WorkerThreads.cpp:785
 msgid "Stopped indexing"
 msgstr "Arrete l'indexation"
 
-#: UI/GTK2/src/WorkerThreads.cpp:901
+#: UI/GTK2/src/WorkerThreads.cpp:837
 msgid "Cannot index document type"
 msgstr "Impossible d'indexer ce type de documents"
 
-#: UI/GTK2/src/WorkerThreads.cpp:905
+#: UI/GTK2/src/WorkerThreads.cpp:841
 msgid "at"
 msgstr "a"
 
-#: UI/GTK2/src/WorkerThreads.cpp:929
+#: UI/GTK2/src/WorkerThreads.cpp:865
 msgid "Couldn't tokenize"
 msgstr "N'a pas pu parcourir"
 
-#: UI/GTK2/src/WorkerThreads.cpp:949
+#: UI/GTK2/src/WorkerThreads.cpp:885
 msgid "Robots META tag forbids indexing"
 msgstr "Le META tag Robots empeche d'indexer"
 
-#: UI/GTK2/src/WorkerThreads.cpp:998
+#: UI/GTK2/src/WorkerThreads.cpp:934
 msgid "Couldn't index"
 msgstr "N'a pas pu indexer"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1056
+#: UI/GTK2/src/WorkerThreads.cpp:989
 msgid "Stopped unindexing document(s)"
 msgstr "Arrete d'indexer les document(s)"
 
-#. Be pessimistic and assume something will go wrong ;-)
-#: UI/GTK2/src/WorkerThreads.cpp:1075
+#: UI/GTK2/src/WorkerThreads.cpp:1008
 msgid "Couldn't unindex document(s)"
 msgstr "N'a pas pu desindexer le(s) document(s)"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1160
+#: UI/GTK2/src/WorkerThreads.cpp:1093
 msgid "Stopped document update for"
 msgstr "Arrete la mise a jour pour"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1195
+#: UI/GTK2/src/WorkerThreads.cpp:1128
 msgid "Couldn't update document"
 msgstr "N'a pas pu mettre a jour le document"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1238
-msgid "Stopped listening on"
-msgstr "Arrete l'ecoute sur"
-
-#: UI/GTK2/src/WorkerThreads.cpp:1341
-msgid "Couldn't read FIFO at"
-msgstr "N'a pas pu lire la FIFO a"
-
-#: UI/GTK2/src/WorkerThreads.cpp:1384
+#: UI/GTK2/src/WorkerThreads.cpp:1178
 msgid "Stopped monitoring"
 msgstr "Arrete la surveillance"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1405
+#: UI/GTK2/src/WorkerThreads.cpp:1199
 msgid "No monitoring handler"
 msgstr "Pas de moniteur"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1451
+#: UI/GTK2/src/WorkerThreads.cpp:1242
 msgid "Couldn't open FAM connection"
 msgstr "N'a pas pu ouvrir la connection FAM"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1653
+#: UI/GTK2/src/WorkerThreads.cpp:1441
 msgid "Stopped scanning"
 msgstr "Arrete de scanner"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1811
+#: UI/GTK2/src/WorkerThreads.cpp:1599
 msgid "Couldn't open directory"
 msgstr "N'a pas pu ovrir le repertoire"



From fabricecolin at berlios.de  Sun Mar 12 07:56:17 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Sun, 12 Mar 2006 07:56:17 +0100
Subject: [Pinot-svn] r148 - tags
Message-ID: <200603120656.k2C6uHXA026702@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-12 07:55:57 +0100 (Sun, 12 Mar 2006)
New Revision: 148

Added:
   tags/version_0_4_4/
Log:
Releasing v0.44 today.


Copied: tags/version_0_4_4 (from rev 147, trunk)



From fabricecolin at berlios.de  Thu Mar 16 15:20:53 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Thu, 16 Mar 2006 15:20:53 +0100
Subject: [Pinot-svn] r149 - trunk/Search/Plugins
Message-ID: <200603161420.k2GEKrh4000564@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-16 15:20:37 +0100 (Thu, 16 Mar 2006)
New Revision: 149

Modified:
   trunk/Search/Plugins/Topix.src
Log:
Fixed results extraction.


Modified: trunk/Search/Plugins/Topix.src
===================================================================
--- trunk/Search/Plugins/Topix.src	2006-03-12 06:55:57 UTC (rev 148)
+++ trunk/Search/Plugins/Topix.src	2006-03-16 14:20:37 UTC (rev 149)
@@ -16,7 +16,7 @@
 <INTERPRET
 resultListStart=""
 resultListEnd=""
-resultItemStart='<div class="article">'
+resultItemStart='<div class="article"'
 resultItemEnd='</div> </div>'
 >
 



From fabricecolin at berlios.de  Thu Mar 16 15:37:57 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Thu, 16 Mar 2006 15:37:57 +0100
Subject: [Pinot-svn] r150 - in trunk: Collect Search
Message-ID: <200603161437.k2GEbvPJ009800@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-16 15:37:54 +0100 (Thu, 16 Mar 2006)
New Revision: 150

Modified:
   trunk/Collect/NeonDownloader.cpp
   trunk/Search/SherlockParser.cpp
   trunk/Search/SherlockParser.h
Log:
Lock parsing of Sherlock plugins rather downloading...


Modified: trunk/Collect/NeonDownloader.cpp
===================================================================
--- trunk/Collect/NeonDownloader.cpp	2006-03-16 14:20:37 UTC (rev 149)
+++ trunk/Collect/NeonDownloader.cpp	2006-03-16 14:37:54 UTC (rev 150)
@@ -62,8 +62,6 @@
 	}
 }
 
-static pthread_mutex_t g_accessLock = PTHREAD_MUTEX_INITIALIZER;
-
 unsigned int NeonDownloader::m_initialized = 0;
 
 NeonDownloader::NeonDownloader() :
@@ -169,11 +167,6 @@
 	string file = urlObj.getFile();
 	string parameters = urlObj.getParameters();
 
-	if (pthread_mutex_lock(&g_accessLock) != 0)
-	{
-		return NULL;
-	}
-
 	// Create a session
 	ne_session *pSession = ne_session_create(protocol.c_str(), hostName.c_str(), 80); // urlObj.getPort());
 	if (pSession == NULL)
@@ -181,7 +174,6 @@
 #ifdef DEBUG
 		cerr << "NeonDownloader::retrieveUrl: couldn't create session !" << endl;
 #endif
-		pthread_mutex_unlock(&g_accessLock);
 		return NULL;
 	}
 	// Set the user agent
@@ -210,7 +202,6 @@
 
 	// Create a request for this URL
 	ne_request *pRequest = ne_request_create(pSession, "GET", fullLocation.c_str());
-	pthread_mutex_unlock(&g_accessLock);
 	if (pRequest == NULL)
 	{
 #ifdef DEBUG

Modified: trunk/Search/SherlockParser.cpp
===================================================================
--- trunk/Search/SherlockParser.cpp	2006-03-16 14:20:37 UTC (rev 149)
+++ trunk/Search/SherlockParser.cpp	2006-03-16 14:37:54 UTC (rev 150)
@@ -462,6 +462,8 @@
 	return foundResult;
 }
 
+pthread_mutex_t SherlockParser::m_mutex = PTHREAD_MUTEX_INITIALIZER;
+
 SherlockParser::SherlockParser(const string &fileName) :
 	PluginParserInterface(fileName)
 {
@@ -500,28 +502,41 @@
 	map<string, string> searchParams, interpretParams, inputItems;
 	string userInput, nextInput, nextFactor, nextValue;
 	skip_grammar skip;
-	parse_info<> parseInfo;
+	bool fullParsing = false;
 
-	if (extractSearchParams == false)
+#ifdef DEBUG
+	cout << "SherlockParser::parse: starting" << endl;
+#endif
+	if (pthread_mutex_lock(&m_mutex) == 0)
 	{
-		plugin_grammar plugin(searchParams, interpretParams, inputItems,
-			userInput, nextInput, nextFactor, nextValue);
+		if (extractSearchParams == false)
+		{
+			plugin_grammar plugin(searchParams, interpretParams, inputItems,
+				userInput, nextInput, nextFactor, nextValue);
 
-		parseInfo = boost::spirit::parse(pData, plugin, skip);
-	}
-	else
-	{
-		plugin_min_grammar plugin(searchParams);
+			parse_info<> parseInfo = boost::spirit::parse(pData, plugin, skip);
+			fullParsing = parseInfo.full;
+		}
+		else
+		{
+			plugin_min_grammar plugin(searchParams);
 
-		parseInfo = boost::spirit::parse(pData, plugin, skip);
+			parse_info<> parseInfo = boost::spirit::parse(pData, plugin, skip);
+			fullParsing = parseInfo.full;
+		}
+
+		pthread_mutex_unlock(&m_mutex);
 	}
+#ifdef DEBUG
+	cout << "SherlockParser::parse: done" << endl;
+#endif
 
 	// We are done with the document
 	delete pPluginDoc;
 
 	SherlockResponseParser *pResponseParser = NULL;
 
-	if (parseInfo.full == true)
+	if (fullParsing == true)
 	{
 		map<string, string> lowSearchParams, lowInterpretParams, lowInputItems;
 

Modified: trunk/Search/SherlockParser.h
===================================================================
--- trunk/Search/SherlockParser.h	2006-03-16 14:20:37 UTC (rev 149)
+++ trunk/Search/SherlockParser.h	2006-03-16 14:37:54 UTC (rev 150)
@@ -17,6 +17,7 @@
 #ifndef _SHERLOCK_PARSER_H
 #define _SHERLOCK_PARSER_H
 
+#include <pthread.h>
 #include <string>
 
 #include "Document.h"
@@ -65,6 +66,9 @@
 		virtual ResponseParserInterface *parse(SearchPluginProperties &properties,
 			bool extractSearchParams = false);
 
+	protected:
+		static pthread_mutex_t m_mutex;
+
 	private:
 		SherlockParser(const SherlockParser &other);
 		SherlockParser& operator=(const SherlockParser& other);



From fabricecolin at berlios.de  Fri Mar 17 13:01:27 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Fri, 17 Mar 2006 13:01:27 +0100
Subject: [Pinot-svn] r151 - trunk/Search/Plugins
Message-ID: <200603171201.k2HC1Rda026296@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-17 13:01:24 +0100 (Fri, 17 Mar 2006)
New Revision: 151

Added:
   trunk/Search/Plugins/Ask.src
   trunk/Search/Plugins/RollYOTopNews.src
Removed:
   trunk/Search/Plugins/AskJeeves.src
   trunk/Search/Plugins/Teoma.src
Log:
Ask.com replaces Teoma and Ask Jeeves. Added RollYO's Top News source.


Copied: trunk/Search/Plugins/Ask.src (from rev 135, trunk/Search/Plugins/AskJeeves.src)
===================================================================
--- trunk/Search/Plugins/AskJeeves.src	2006-03-04 03:33:34 UTC (rev 135)
+++ trunk/Search/Plugins/Ask.src	2006-03-17 12:01:24 UTC (rev 151)
@@ -0,0 +1,24 @@
+# Ask Jeeves Search Plugin
+
+<SEARCH
+	version="1.0"
+	name="Ask"
+	description="Ask.com Ask Jeeves"
+	method="GET"
+	action="http://www.ask.com/web"
+	routeType="The Web"
+>
+
+<INPUT NAME="q" USER>
+<INPUT NAME="qsrc" VALUE="0">
+<INPUT NAME="o" VALUE="0">
+<INPUTNEXT NAME="page" FACTOR="1" VALUE="1">
+
+<INTERPRET
+resultListStart=""
+resultListEnd=""
+resultItemStart='<div class="m10_0_16">'
+resultItemEnd='_u" class="'
+>
+
+</SEARCH>

Deleted: trunk/Search/Plugins/AskJeeves.src
===================================================================
--- trunk/Search/Plugins/AskJeeves.src	2006-03-16 14:37:54 UTC (rev 150)
+++ trunk/Search/Plugins/AskJeeves.src	2006-03-17 12:01:24 UTC (rev 151)
@@ -1,24 +0,0 @@
-# Ask Jeeves Search Plugin
-
-<SEARCH
-	version="1.0"
-	name="Ask Jeeves"
-	description="Ask.com Ask Jeeves"
-	method="GET"
-	action="http://www.ask.com/web"
-	routeType="The Web"
->
-
-<INPUT NAME="q" USER>
-<INPUT NAME="qsrc" VALUE="0">
-<INPUT NAME="o" VALUE="0">
-<INPUTNEXT NAME="page" FACTOR="1" VALUE="1">
-
-<INTERPRET
-resultListStart=""
-resultListEnd=""
-resultItemStart='<div class="m10_0_16">'
-resultItemEnd='_u" class="'
->
-
-</SEARCH>

Added: trunk/Search/Plugins/RollYOTopNews.src
===================================================================
--- trunk/Search/Plugins/RollYOTopNews.src	2006-03-16 14:37:54 UTC (rev 150)
+++ trunk/Search/Plugins/RollYOTopNews.src	2006-03-17 12:01:24 UTC (rev 151)
@@ -0,0 +1,30 @@
+# Rollyo Search - Sherlock Plug-in
+
+<SEARCH
+  name="Rollyo Top News"
+  description = "Rollyo: Top News search"
+  method="GET"
+  action="http://rollyo.com/search.html"
+  update="http://rollyo.com/tools/mozsearch/src.html/rollyo-0-5628.src"
+  updateCheckDays="5"
+  routeType="News"
+>
+
+<INPUT NAME="q" user>
+<INPUT NAME="uid" VALUE="0">
+<INPUT NAME="sid" VALUE="5628">
+
+<INTERPRET
+ resultListStart=''
+ resultListEnd=''
+ resultItemStart='<dt class="top-title">'
+ resultItemEnd='</dt>'
+>
+
+</SEARCH>
+
+<BROWSER
+  update="http://rollyo.com/tools/mozsearch/src.html/rollyo-0-5628.src"
+  updateIcon="http://rollyo.com/tools/mozsearch/icon.html/rollyo-0-5628.png"
+  updateCheckDays="5"
+>

Deleted: trunk/Search/Plugins/Teoma.src
===================================================================
--- trunk/Search/Plugins/Teoma.src	2006-03-16 14:37:54 UTC (rev 150)
+++ trunk/Search/Plugins/Teoma.src	2006-03-17 12:01:24 UTC (rev 151)
@@ -1,27 +0,0 @@
-# Teoma Search Plugin
-
-<SEARCH
-	version="1.0"
-	name="Teoma"
-	description="Teoma.com"
-	method="GET"
-	action="http://s.teoma.com/search"
-	routeType="The Web"
->
-
-<INPUT NAME="q" USER>
-<INPUT NAME="qcat" VALUE="1">
-<INPUT NAME="qsrc" VALUE="0">
-<INPUT NAME="Search.x" VALUE="45">
-<INPUT NAME="Search.y" VALUE="13">
-<INPUT NAME="Search" VALUE="submitve_vt">
-<INPUTNEXT NAME="page" FACTOR="1">
-
-<INTERPRET
-resultListStart=''
-resultListEnd=''
-resultItemStart='<div id="result">'
-resultItemEnd='<br class="resultSpace" />'
->
-
-</SEARCH>



From fabricecolin at berlios.de  Fri Mar 17 13:03:09 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Fri, 17 Mar 2006 13:03:09 +0100
Subject: [Pinot-svn] r152 - trunk/Utils
Message-ID: <200603171203.k2HC39Dx026461@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-17 13:03:03 +0100 (Fri, 17 Mar 2006)
New Revision: 152

Modified:
   trunk/Utils/Url.cpp
Log:
Less DEBUG output.


Modified: trunk/Utils/Url.cpp
===================================================================
--- trunk/Utils/Url.cpp	2006-03-17 12:01:24 UTC (rev 151)
+++ trunk/Utils/Url.cpp	2006-03-17 12:03:03 UTC (rev 152)
@@ -14,14 +14,10 @@
  *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
  */
 
-#include <iostream>
-
 #include "StringManip.h"
 #include "Url.h"
 
 using std::string;
-using std::cout;
-using std::endl;
 
 static const int g_rfc2396Encoded[] = {
 	1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,  /* 0x00 - 0x0f */
@@ -312,9 +308,6 @@
 			char encodedStr[4];
 
 			snprintf(encodedStr, 4, "%%%02x", (int)currentChar);
-#ifdef DEBUG
-			cout << "Url::escapeUrl: encoded " << currentChar << " as " << encodedStr << endl;
-#endif
 			escapedUrl += encodedStr;
 		}
 		else



From fabricecolin at berlios.de  Fri Mar 17 13:16:44 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Fri, 17 Mar 2006 13:16:44 +0100
Subject: [Pinot-svn] r153 - trunk/SQL
Message-ID: <200603171216.k2HCGi1i031719@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-17 13:16:41 +0100 (Fri, 17 Mar 2006)
New Revision: 153

Modified:
   trunk/SQL/QueryHistory.cpp
   trunk/SQL/QueryHistory.h
   trunk/SQL/ViewHistory.cpp
   trunk/SQL/ViewHistory.h
Log:
ViewHistory now includes a Date column. The table is updated by create().
Items in both tables can be expired.


Modified: trunk/SQL/QueryHistory.cpp
===================================================================
--- trunk/SQL/QueryHistory.cpp	2006-03-17 12:03:03 UTC (rev 152)
+++ trunk/SQL/QueryHistory.cpp	2006-03-17 12:16:41 UTC (rev 153)
@@ -73,9 +73,6 @@
 	string escapedUrl = Url::escapeUrl(url);
 	bool success = false;
 
-#ifdef DEBUG
-	cout << "QueryHistory::insertItem: called" << endl;
-#endif
 	SQLiteResults *results = executeStatement("INSERT INTO QueryHistory \
 		VALUES('%q', '%q', '%q', '%q', '%q', '%q', '%q', '%f', '0.0', '%d');",
 		queryName.c_str(), engineName.c_str(), hostName.c_str(),
@@ -122,9 +119,6 @@
 {
 	bool success = false;
 
-#ifdef DEBUG
-	cout << "QueryHistory::updateItem: called on " << url << endl;
-#endif
 	SQLiteResults *results = executeStatement("UPDATE QueryHistory SET PrevScore=Score, \
 		Score=%f, Date='%d', Title='%q', Extract='%q', Language='%q' \
 		WHERE QueryName='%q' AND EngineName='%q' AND Url='%q';",
@@ -267,3 +261,18 @@
 
 	return false;
 }
+
+/// Expires items older than the given date.
+bool QueryHistory::expireItems(time_t expiryDate)
+{
+	SQLiteResults *results = executeStatement("DELETE FROM QueryHistory \
+		WHERE Date<'%d';", expiryDate);
+	if (results != NULL)
+	{
+		delete results;
+
+		return true;
+	}
+
+	return false;
+}

Modified: trunk/SQL/QueryHistory.h
===================================================================
--- trunk/SQL/QueryHistory.h	2006-03-17 12:03:03 UTC (rev 152)
+++ trunk/SQL/QueryHistory.h	2006-03-17 12:16:41 UTC (rev 153)
@@ -62,6 +62,9 @@
 		/// Deletes items.
 		bool deleteItems(const string &name, bool isQueryName);
 
+		/// Expires items older than the given date.
+		bool expireItems(time_t expiryDate);
+
 	private:
 		QueryHistory(const QueryHistory &other);
 		QueryHistory &operator=(const QueryHistory &other);

Modified: trunk/SQL/ViewHistory.cpp
===================================================================
--- trunk/SQL/ViewHistory.cpp	2006-03-17 12:03:03 UTC (rev 152)
+++ trunk/SQL/ViewHistory.cpp	2006-03-17 12:16:41 UTC (rev 153)
@@ -34,7 +34,7 @@
 /// Creates the ViewHistory table in the database.
 bool ViewHistory::create(const string &database)
 {
-	bool success = true;
+	bool createTable = false;
 
 	// The specified path must be a file
 	if (SQLiteBase::check(database) == false)
@@ -50,14 +50,35 @@
 #ifdef DEBUG
 		cout << "ViewHistory::create: ViewHistory doesn't exist" << endl;
 #endif
-		// Create the table
-		if (db.executeSimpleStatement("CREATE TABLE ViewHistory (Url VARCHAR(255) PRIMARY KEY, Status INT);") == false)
+		createTable = true;
+	}
+	else
+	{
+		// Previous versions didn't include a Date field, so check for it
+		if (db.executeSimpleStatement("SELECT Date FROM ViewHistory LIMIT 1;") == false)
 		{
-			success = false;
+#ifdef DEBUG
+			cout << "ViewHistory::create: ViewHistory needs updating" << endl;
+#endif
+			// Ideally, we would use ALTER TABLE but it's not supported by SQLite
+			if (db.executeSimpleStatement("DROP TABLE ViewHistory; VACUUM;") == true)
+			{
+				createTable = true;
+			}
 		}
 	}
 
-	return success;
+	// Create the table ?
+	if (createTable == true)
+	{
+		if (db.executeSimpleStatement("CREATE TABLE ViewHistory (Url VARCHAR(255) \
+			PRIMARY KEY, Status INTEGER, DATE INTEGER);") == false)
+		{
+			return false;
+		}
+	}
+
+	return true;
 }
 
 /// Inserts an URL.
@@ -66,7 +87,7 @@
 	bool success = false;
 
 	SQLiteResults *results = executeStatement("INSERT INTO ViewHistory \
-		VALUES('%q', '1');", Url::escapeUrl(url).c_str());
+		VALUES('%q', '1', '%d');", Url::escapeUrl(url).c_str(), time(NULL));
 	if (results != NULL)
 	{
 		success = true;
@@ -81,8 +102,8 @@
 {
 	bool success = false;
 
-	SQLiteResults *results = executeStatement("SELECT Url FROM ViewHistory WHERE Url='%q';",
-		Url::escapeUrl(url).c_str());
+	SQLiteResults *results = executeStatement("SELECT Url FROM ViewHistory \
+		WHERE Url='%q';", Url::escapeUrl(url).c_str());
 	if (results != NULL)
 	{
 		SQLiteRow *row = results->nextRow();
@@ -118,3 +139,19 @@
 
 	return success;
 }
+
+/// Expires items older than the given date.
+bool ViewHistory::expireItems(time_t expiryDate)
+{
+	bool success = false;
+
+	SQLiteResults *results = executeStatement("DELETE FROM ViewHistory \
+		WHERE Date<'%d';", expiryDate);
+	if (results != NULL)
+	{
+		success = true;
+		delete results;
+	}
+
+	return success;
+}

Modified: trunk/SQL/ViewHistory.h
===================================================================
--- trunk/SQL/ViewHistory.h	2006-03-17 12:03:03 UTC (rev 152)
+++ trunk/SQL/ViewHistory.h	2006-03-17 12:16:41 UTC (rev 153)
@@ -17,6 +17,7 @@
 #ifndef _VIEW_HISTORY_H
 #define _VIEW_HISTORY_H
 
+#include <time.h>
 #include <string>
 
 #include "SQLiteBase.h"
@@ -41,6 +42,9 @@
 		/// Deletes an URL.
 		bool deleteItem(const string &url);
 
+		/// Expires items older than the given date.
+		bool expireItems(time_t expiryDate);
+
 	private:
 		ViewHistory(const ViewHistory &other);
 		ViewHistory &operator=(const ViewHistory &other);



From fabricecolin at berlios.de  Sat Mar 18 12:33:57 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Sat, 18 Mar 2006 12:33:57 +0100
Subject: [Pinot-svn] r155 - trunk/UI/GTK2/src
Message-ID: <200603181133.k2IBXvmG022975@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-18 12:33:54 +0100 (Sat, 18 Mar 2006)
New Revision: 155

Modified:
   trunk/UI/GTK2/src/WorkerThreads.cpp
Log:
When browsing, get the right documents count.
Don't attempt to set an empty label on documents.


Modified: trunk/UI/GTK2/src/WorkerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.cpp	2006-03-18 11:32:16 UTC (rev 154)
+++ trunk/UI/GTK2/src/WorkerThreads.cpp	2006-03-18 11:33:54 UTC (rev 155)
@@ -407,7 +407,7 @@
 		return;
 	}
 
-	m_indexDocsCount = index.getDocumentsCount();
+	m_indexDocsCount = index.getDocumentsCount(m_labelName);
 	if (m_indexDocsCount == 0)
 	{
 #ifdef DEBUG
@@ -904,13 +904,16 @@
 				// Update the document
 				if (index.updateDocument(m_docId, *pTokens) == true)
 				{
-					// Add the label if it's a new one
-					if (labels.find(m_labelName) == labels.end())
+					if (m_labelName.empty() == false)
 					{
-						labels.clear();
-						labels.insert(m_labelName);
+						// Add the label if it's a new one
+						if (labels.find(m_labelName) == labels.end())
+						{
+							labels.clear();
+							labels.insert(m_labelName);
 
-						index.setDocumentLabels(m_docId, labels, false);
+							index.setDocumentLabels(m_docId, labels, false);
+						}
 					}
 					success = true;
 				}
@@ -919,7 +922,10 @@
 			{
 				unsigned int docId = 0;
 
-				labels.insert(m_labelName);
+				if (m_labelName.empty() == false)
+				{
+					labels.insert(m_labelName);
+				}
 
 				// Index the document
 				success = index.indexDocument(*pTokens, labels, docId);



From fabricecolin at berlios.de  Sat Mar 18 12:32:28 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Sat, 18 Mar 2006 12:32:28 +0100
Subject: [Pinot-svn] r154 - trunk/Index
Message-ID: <200603181132.k2IBWSwp022213@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-18 12:32:16 +0100 (Sat, 18 Mar 2006)
New Revision: 154

Modified:
   trunk/Index/IndexInterface.h
   trunk/Index/XapianIndex.cpp
   trunk/Index/XapianIndex.h
Log:
getDocumentsCount() can return the number of documents that have a label.
setDocumentLabels() skips empty labels.


Modified: trunk/Index/IndexInterface.h
===================================================================
--- trunk/Index/IndexInterface.h	2006-03-17 12:16:41 UTC (rev 153)
+++ trunk/Index/IndexInterface.h	2006-03-18 11:32:16 UTC (rev 154)
@@ -85,7 +85,7 @@
 		virtual bool flush(void) = 0;
 
 		/// Returns the number of documents.
-		virtual unsigned int getDocumentsCount(void) const = 0;
+		virtual unsigned int getDocumentsCount(const std::string &labelName = "") const = 0;
 
 		/// Lists document IDs.
 		virtual unsigned int listDocuments(std::set<unsigned int> &docIDList,

Modified: trunk/Index/XapianIndex.cpp
===================================================================
--- trunk/Index/XapianIndex.cpp	2006-03-17 12:16:41 UTC (rev 153)
+++ trunk/Index/XapianIndex.cpp	2006-03-18 11:32:16 UTC (rev 154)
@@ -771,7 +771,10 @@
 			for (set<string>::const_iterator labelIter = labels.begin(); labelIter != labels.end();
 				++labelIter)
 			{
-				doc.add_term(limitTermLength(string("XLABEL:") + *labelIter));
+				if (labelIter->empty() == false)
+				{
+					doc.add_term(limitTermLength(string("XLABEL:") + *labelIter));
+				}
 			}
 
 			pIndex->replace_document(docId, doc);
@@ -1116,7 +1119,7 @@
 }
 
 /// Returns the number of documents.
-unsigned int XapianIndex::getDocumentsCount(void) const
+unsigned int XapianIndex::getDocumentsCount(const string &labelName) const
 {
 	unsigned int docCount = 0;
 
@@ -1132,7 +1135,18 @@
 		Xapian::Database *pIndex = pDatabase->readLock();
 		if (pIndex != NULL)
 		{
-			docCount = pIndex->get_doccount();
+			if (labelName.empty() == true)
+			{
+				docCount = pIndex->get_doccount();
+			}
+			else
+			{
+				string term("XLABEL:");
+
+				// Each label appears only one per document so the collection frequency
+				// is the number of documents that have this label
+				docCount = pIndex->get_collection_freq(term + labelName);
+			}
 		}
 	}
 	catch (const Xapian::Error &error)

Modified: trunk/Index/XapianIndex.h
===================================================================
--- trunk/Index/XapianIndex.h	2006-03-17 12:16:41 UTC (rev 153)
+++ trunk/Index/XapianIndex.h	2006-03-18 11:32:16 UTC (rev 154)
@@ -79,7 +79,7 @@
 		virtual bool flush(void);
 
 		/// Returns the number of documents.
-		virtual unsigned int getDocumentsCount(void) const;
+		virtual unsigned int getDocumentsCount(const std::string &labelName = "") const;
 
 		/// Lists document IDs.
 		virtual unsigned int listDocuments(std::set<unsigned int> &docIds,



From fabricecolin at berlios.de  Sat Mar 18 14:11:42 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Sat, 18 Mar 2006 14:11:42 +0100
Subject: [Pinot-svn] r156 - in trunk/UI/GTK2: . src
Message-ID: <200603181311.k2IDBgGP001317@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-18 14:10:58 +0100 (Sat, 18 Mar 2006)
New Revision: 156

Modified:
   trunk/UI/GTK2/metase-gtk2.glade
   trunk/UI/GTK2/src/IndexTree.cpp
   trunk/UI/GTK2/src/IndexTree.h
   trunk/UI/GTK2/src/ModelColumns.cpp
   trunk/UI/GTK2/src/ModelColumns.h
   trunk/UI/GTK2/src/PinotSettings.cpp
   trunk/UI/GTK2/src/PinotSettings.h
   trunk/UI/GTK2/src/ResultsTree.cpp
   trunk/UI/GTK2/src/ResultsTree.h
   trunk/UI/GTK2/src/mainWindow.cc
   trunk/UI/GTK2/src/prefsDialog.cc
   trunk/UI/GTK2/src/prefsDialog_glade.cc
   trunk/UI/GTK2/src/prefsDialog_glade.hh
Log:
The background colour for new results and whether the live query field should
try to suggest terms from the index are now configurable through preferences.
Moved colour rendering code out of IndexTree and to ResultsTree.


Modified: trunk/UI/GTK2/metase-gtk2.glade
===================================================================
--- trunk/UI/GTK2/metase-gtk2.glade	2006-03-18 11:33:54 UTC (rev 155)
+++ trunk/UI/GTK2/metase-gtk2.glade	2006-03-18 13:10:58 UTC (rev 156)
@@ -960,7 +960,7 @@
 	  <child>
 	    <widget class="GtkTable" id="generalTable">
 	      <property name="visible">True</property>
-	      <property name="n_rows">4</property>
+	      <property name="n_rows">6</property>
 	      <property name="n_columns">2</property>
 	      <property name="homogeneous">False</property>
 	      <property name="row_spacing">0</property>
@@ -1072,8 +1072,8 @@
 		<packing>
 		  <property name="left_attach">0</property>
 		  <property name="right_attach">1</property>
-		  <property name="top_attach">3</property>
-		  <property name="bottom_attach">4</property>
+		  <property name="top_attach">5</property>
+		  <property name="bottom_attach">6</property>
 		  <property name="x_options">fill</property>
 		  <property name="y_options">fill</property>
 		</packing>
@@ -1095,8 +1095,8 @@
 		<packing>
 		  <property name="left_attach">1</property>
 		  <property name="right_attach">2</property>
-		  <property name="top_attach">3</property>
-		  <property name="bottom_attach">4</property>
+		  <property name="top_attach">5</property>
+		  <property name="bottom_attach">6</property>
 		  <property name="x_padding">4</property>
 		  <property name="y_padding">4</property>
 		  <property name="y_options">fill</property>
@@ -1201,6 +1201,105 @@
 		  <property name="y_options">fill</property>
 		</packing>
 	      </child>
+
+	      <child>
+		<widget class="GtkLabel" id="newResultsLabel">
+		  <property name="visible">True</property>
+		  <property name="label" translatable="yes">New results:</property>
+		  <property name="use_underline">False</property>
+		  <property name="use_markup">False</property>
+		  <property name="justify">GTK_JUSTIFY_LEFT</property>
+		  <property name="wrap">False</property>
+		  <property name="selectable">False</property>
+		  <property name="xalign">0</property>
+		  <property name="yalign">0.5</property>
+		  <property name="xpad">4</property>
+		  <property name="ypad">4</property>
+		  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+		  <property name="width_chars">-1</property>
+		  <property name="single_line_mode">False</property>
+		  <property name="angle">0</property>
+		</widget>
+		<packing>
+		  <property name="left_attach">0</property>
+		  <property name="right_attach">1</property>
+		  <property name="top_attach">3</property>
+		  <property name="bottom_attach">4</property>
+		  <property name="x_options">fill</property>
+		  <property name="y_options">fill</property>
+		</packing>
+	      </child>
+
+	      <child>
+		<widget class="GtkLabel" id="queriesLabel">
+		  <property name="visible">True</property>
+		  <property name="label" translatable="yes">Queries:</property>
+		  <property name="use_underline">False</property>
+		  <property name="use_markup">False</property>
+		  <property name="justify">GTK_JUSTIFY_LEFT</property>
+		  <property name="wrap">False</property>
+		  <property name="selectable">False</property>
+		  <property name="xalign">0</property>
+		  <property name="yalign">0.5</property>
+		  <property name="xpad">4</property>
+		  <property name="ypad">4</property>
+		  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+		  <property name="width_chars">-1</property>
+		  <property name="single_line_mode">False</property>
+		  <property name="angle">0</property>
+		</widget>
+		<packing>
+		  <property name="left_attach">0</property>
+		  <property name="right_attach">1</property>
+		  <property name="top_attach">4</property>
+		  <property name="bottom_attach">5</property>
+		  <property name="x_options">fill</property>
+		  <property name="y_options">fill</property>
+		</packing>
+	      </child>
+
+	      <child>
+		<widget class="GtkCheckButton" id="enableCompletionCheckbutton">
+		  <property agent="glademm" name="cxx_visibility">protected</property>
+		  <property name="visible">True</property>
+		  <property name="can_focus">True</property>
+		  <property name="label" translatable="yes">Enable search terms suggestion</property>
+		  <property name="use_underline">True</property>
+		  <property name="relief">GTK_RELIEF_NORMAL</property>
+		  <property name="focus_on_click">True</property>
+		  <property name="active">False</property>
+		  <property name="inconsistent">False</property>
+		  <property name="draw_indicator">True</property>
+		</widget>
+		<packing>
+		  <property name="left_attach">1</property>
+		  <property name="right_attach">2</property>
+		  <property name="top_attach">4</property>
+		  <property name="bottom_attach">5</property>
+		  <property name="x_padding">4</property>
+		  <property name="y_padding">4</property>
+		  <property name="y_options">fill</property>
+		</packing>
+	      </child>
+
+	      <child>
+		<widget class="GtkColorButton" id="newResultsColorbutton">
+		  <property agent="glademm" name="cxx_visibility">protected</property>
+		  <property name="visible">True</property>
+		  <property name="can_focus">True</property>
+		  <property name="use_alpha">False</property>
+		  <property name="focus_on_click">True</property>
+		</widget>
+		<packing>
+		  <property name="left_attach">1</property>
+		  <property name="right_attach">2</property>
+		  <property name="top_attach">3</property>
+		  <property name="bottom_attach">4</property>
+		  <property name="x_padding">4</property>
+		  <property name="y_padding">4</property>
+		  <property name="y_options">fill</property>
+		</packing>
+	      </child>
 	    </widget>
 	    <packing>
 	      <property name="tab_expand">False</property>

Modified: trunk/UI/GTK2/src/IndexTree.cpp
===================================================================
--- trunk/UI/GTK2/src/IndexTree.cpp	2006-03-18 11:33:54 UTC (rev 155)
+++ trunk/UI/GTK2/src/IndexTree.cpp	2006-03-18 13:10:58 UTC (rev 156)
@@ -61,8 +61,7 @@
 	set_model(m_refStore);
 
 	// The score column is used for status icons
-	TreeViewColumn *treeColumn = create_resizable_column_with_icon(_("Title"), m_indexColumns.m_text,
-		SigC::slot(*this, &IndexTree::renderColour));
+	TreeViewColumn *treeColumn = create_resizable_column(_("Title"), m_indexColumns.m_text);
 	if (treeColumn != NULL)
 	{
 		append_column(*manage(treeColumn));
@@ -94,9 +93,6 @@
 	// Initially, don't display the list of indexed documents
 	m_listingIndex = false;
 
-	// By default, no particular colour is selected
-	setCurrentBackgroundColour(0, 0, 0, false);
-
 	// Show all
 	m_pIndexScrolledwindow->show();
 	show();
@@ -106,36 +102,6 @@
 {
 }
 
-void IndexTree::renderColour(CellRenderer *renderer, const TreeModel::iterator &iter)
-{
-	TreeModel::Row row = *iter;
-
-	if (renderer == NULL)
-	{
-		return;
-	}
-
-	CellRendererText *textRenderer = dynamic_cast<CellRendererText*>(renderer);
-	if (textRenderer != NULL)
-	{
-		if ((m_visibleColour == false) &&
-			(row[m_indexColumns.m_labeled] == true))
-		{
-			// Reset this
-			row[m_indexColumns.m_labeled] = false;
-		}
-		else if (row[m_indexColumns.m_labeled] == true)
-		{
-			// Change the row's background
-			textRenderer->property_background_gdk() = m_currentBackgroundColour;
-		}
-		else
-		{
-			textRenderer->property_background_gdk().reset_value();
-		}
-	}
-}
-
 void IndexTree::onButtonPressEvent(GdkEventButton *ev)
 {
 	// Check for popup click
@@ -200,7 +166,7 @@
 //
 // Appends a new row in the index tree.
 //
-bool IndexTree::appendDocument(const IndexedDocument &docInfo, bool withColour)
+bool IndexTree::appendDocument(const IndexedDocument &docInfo)
 {
 	TreeModel::iterator newRowIter = m_refStore->append();
 	TreeModel::Row childRow = *newRowIter;
@@ -219,7 +185,6 @@
 	childRow[m_indexColumns.m_type] = to_utf8(docInfo.getType());
 	childRow[m_indexColumns.m_language] = to_utf8(docInfo.getLanguage());
 	childRow[m_indexColumns.m_timestamp] = to_utf8(docInfo.getTimestamp());
-	childRow[m_indexColumns.m_labeled] = withColour;
 	childRow[m_indexColumns.m_id] = docInfo.getID();
 
 	// If the tree was empty, it is no longer
@@ -228,7 +193,6 @@
 	return true;
 }
 
-
 //
 // Adds a set of documents.
 //
@@ -246,7 +210,7 @@
 		docIter != documentsList.end(); ++docIter)
 	{
 		// Add a row
-		if (appendDocument(*docIter, false) == true)
+		if (appendDocument(*docIter) == true)
 		{
 #ifdef DEBUG
 			cout << "IndexTree::addDocuments: added row for document " << count << endl;
@@ -327,45 +291,6 @@
 }
 
 //
-// Sets the current background colour.
-//
-void IndexTree::setCurrentBackgroundColour(unsigned short red, unsigned short green, unsigned short blue,
-	bool isVisible)
-{
-	m_currentBackgroundColour.set_rgb(red, green, blue);
-	m_visibleColour = isVisible;
-}
-
-//
-// Sets the documents that match the current background colour.
-//
-void IndexTree::setColourDocuments(const set<unsigned int> &documentsList)
-{
-	// Unselect all
-	get_selection()->unselect_all();
-
-	// Go through the list of indexed documents
-	TreeModel::Children children = m_refStore->children();
-	for (TreeModel::Children::iterator iter = children.begin(); iter != children.end(); ++iter)
-	{
-		// Does this document match the colour ?
-		TreeModel::Row row = *iter;
-		unsigned int docId = row[m_indexColumns.m_id];
-
-		set<unsigned int>::iterator docIter = documentsList.find(docId);
-		if (docIter != documentsList.end())
-		{
-			// Yes, it does !
-			row[m_indexColumns.m_labeled] = true;
-		}
-		else
-		{
-			row[m_indexColumns.m_labeled] = false;
-		}
-	}
-}
-
-//
 // Updates a document's properties.
 //
 void IndexTree::updateDocumentInfo(unsigned int docId, const DocumentInfo &docInfo)
@@ -393,30 +318,6 @@
 }
 
 //
-// Marks a document as coloured.
-//
-void IndexTree::setDocumentColourState(unsigned int docId, bool withColour)
-{
-	if (docId == 0)
-	{
-		return;
-	}
-
-	// Go through the list of indexed documents
-	TreeModel::Children children = m_refStore->children();
-	for (TreeModel::Children::iterator iter = children.begin(); iter != children.end(); ++iter)
-	{
-		TreeModel::Row row = *iter;
-
-		if (docId == row[m_indexColumns.m_id])
-		{
-			row[m_indexColumns.m_labeled] = withColour;
-			break;
-		}
-	}
-}
-
-//
 // Deletes the current selection.
 //
 bool IndexTree::deleteSelection(void)

Modified: trunk/UI/GTK2/src/IndexTree.h
===================================================================
--- trunk/UI/GTK2/src/IndexTree.h	2006-03-18 11:33:54 UTC (rev 155)
+++ trunk/UI/GTK2/src/IndexTree.h	2006-03-18 13:10:58 UTC (rev 156)
@@ -49,7 +49,7 @@
 		bool addDocuments(const std::vector<IndexedDocument> &documentsList);
 
 		/// Appends a new row in the index tree.
-		bool appendDocument(const IndexedDocument &docInfo, bool withColour);
+		bool appendDocument(const IndexedDocument &docInfo);
 
 		/// Gets the first selected item's URL.
 		Glib::ustring getFirstSelectionURL(void);
@@ -60,19 +60,9 @@
 		/// Gets a list of selected items.
 		bool getSelection(std::vector<IndexedDocument> &documentsList);
 
-		/// Sets the current background colour.
-		void setCurrentBackgroundColour(unsigned short red, unsigned short green, unsigned short blue,
-			bool isVisible = true);
-
-		/// Sets the documents that match the current background colour.
-		void setColourDocuments(const std::set<unsigned int> &documentsList);
-
 		/// Updates a document's properties.
 		void updateDocumentInfo(unsigned int docId, const DocumentInfo &docInfo);
 
-		/// Marks a document as coloured.
-		void setDocumentColourState(unsigned int docId, bool withColour);
-
 		/**
 		  * Deletes the current selection.
 		  * Returns true if the tree is then empty.
@@ -106,12 +96,8 @@
 		SigC::Signal1<void, Glib::ustring> m_signalSelectionChanged;
 		PinotSettings &m_settings;
 		IndexModelColumns m_indexColumns;
-		Gdk::Color m_currentBackgroundColour;
-		bool m_visibleColour;
 		bool m_listingIndex;
 
-		void renderColour(Gtk::CellRenderer *renderer, const Gtk::TreeModel::iterator &iter);
-
 		void onButtonPressEvent(GdkEventButton *ev);
 
 		void onSelectionChanged(void);

Modified: trunk/UI/GTK2/src/ModelColumns.cpp
===================================================================
--- trunk/UI/GTK2/src/ModelColumns.cpp	2006-03-18 11:33:54 UTC (rev 155)
+++ trunk/UI/GTK2/src/ModelColumns.cpp	2006-03-18 13:10:58 UTC (rev 156)
@@ -79,7 +79,6 @@
 	add(m_language);
 	add(m_id);
 	add(m_timestamp);
-	add(m_labeled);
 }
 
 IndexModelColumns::~IndexModelColumns()

Modified: trunk/UI/GTK2/src/ModelColumns.h
===================================================================
--- trunk/UI/GTK2/src/ModelColumns.h	2006-03-18 11:33:54 UTC (rev 155)
+++ trunk/UI/GTK2/src/ModelColumns.h	2006-03-18 13:10:58 UTC (rev 156)
@@ -104,7 +104,6 @@
 	Gtk::TreeModelColumn<Glib::ustring> m_language;
 	Gtk::TreeModelColumn<unsigned int> m_id;
 	Gtk::TreeModelColumn<Glib::ustring> m_timestamp;
-	Gtk::TreeModelColumn<bool> m_labeled;
 
 };
 

Modified: trunk/UI/GTK2/src/PinotSettings.cpp
===================================================================
--- trunk/UI/GTK2/src/PinotSettings.cpp	2006-03-18 11:33:54 UTC (rev 155)
+++ trunk/UI/GTK2/src/PinotSettings.cpp	2006-03-18 13:10:58 UTC (rev 156)
@@ -89,6 +89,8 @@
 	m_height(0),
 	m_panePos(-1),
 	m_ignoreRobotsDirectives(false),
+	m_suggestQueryTerms(true),
+	m_newResultsColour("red"),
 	m_firstRun(false)
 {
 	// Find out if there is a .pinot directory
@@ -281,38 +283,23 @@
 				}
 				else if (nodeName == "ui")
 				{
-					if (loadUi(pElem) == false)
-					{
-						cerr << _("Couldn't load ui block") << endl;
-					}
+					loadUi(pElem);
 				}
 				else if (nodeName == "extraindex")
 				{
-					if (loadIndexes(pElem) == false)
-					{
-						cerr << _("Couldn't load extraindex block") << endl;
-					}
+					loadIndexes(pElem);
 				}
 				else if (nodeName == "storedquery")
 				{
-					if (loadQueries(pElem) == false)
-					{
-						cerr << _("Couldn't load storedquery block") << endl;
-					}
+					loadQueries(pElem);
 				}
 				else if (nodeName == "results")
 				{
-					if (loadResults(pElem) == false)
-					{
-						cerr << _("Couldn't load results block") << endl;
-					}
+					loadResults(pElem);
 				}
 				else if (nodeName == "label")
 				{
-					if (loadLabels(pElem) == false)
-					{
-						cerr << _("Couldn't load label block") << endl;
-					}
+					loadLabels(pElem);
 				}
 				else if (nodeName == "robots")
 				{
@@ -325,13 +312,25 @@
 						m_ignoreRobotsDirectives = false;
 					}
 				}
-				else if (nodeName == "mailaccount")
+				else if (nodeName == "suggestterms")
 				{
-					if (loadMailAccounts(pElem) == false)
+					if (nodeContent == "YES")
 					{
-						cerr << _("Couldn't load mailaccount block") << endl;
+						m_suggestQueryTerms = true;
 					}
+					else
+					{
+						m_suggestQueryTerms = false;
+					}
 				}
+				else if (nodeName == "newresults")
+				{
+					loadColour(pElem);
+				}
+				else if (nodeName == "mailaccount")
+				{
+					loadMailAccounts(pElem);
+				}
 			}
 		}
 	}
@@ -613,6 +612,48 @@
 	return true;
 }
 
+bool PinotSettings::loadColour(const Element *pElem)
+{
+	if (pElem == NULL)
+	{
+		return false;
+	}
+
+	Node::NodeList childNodes = pElem->get_children();
+	if (childNodes.empty() == true)
+	{
+		return false;
+	}
+
+	// Load the colour RGB components
+	for (Node::NodeList::iterator iter = childNodes.begin(); iter != childNodes.end(); ++iter)
+	{
+		Node *pNode = (*iter);
+		Element *pElem = dynamic_cast<Element*>(pNode);
+		if (pElem == NULL)
+		{
+			continue;
+		}
+
+		string nodeName = pElem->get_name();
+		string nodeContent = getElementContent(pElem);
+		gushort value = (gushort)atoi(nodeContent.c_str());
+
+		if (nodeName == "red")
+		{
+			m_newResultsColour.set_red(value);
+		}
+		else if (nodeName == "green")
+		{
+			m_newResultsColour.set_green(value);
+		}
+		else if (nodeName == "blue")
+		{
+			m_newResultsColour.set_blue(value);
+		}
+	}
+}
+
 bool PinotSettings::loadMailAccounts(const Element *pElem)
 {
 	if (pElem == NULL)
@@ -818,6 +859,20 @@
 	}
 	// Ignore robots directives
 	addChildElement(pRootElem, "robots", (m_ignoreRobotsDirectives ? "IGNORE" : "OBEY"));
+	// New results colour
+	pElem = pRootElem->add_child("newresults");
+	if (pElem == NULL)
+	{
+		return false;
+	}
+	sprintf(numStr, "%u", m_newResultsColour.get_red());
+	addChildElement(pElem, "red", numStr);
+	sprintf(numStr, "%u", m_newResultsColour.get_green());
+	addChildElement(pElem, "green", numStr);
+	sprintf(numStr, "%u", m_newResultsColour.get_blue());
+	addChildElement(pElem, "blue", numStr);
+	// Enable terms suggestion
+	addChildElement(pRootElem, "suggestterms", (m_suggestQueryTerms ? "YES" : "NO"));
 	// Mail accounts
 	for (set<MailAccount>::iterator mailIter = m_mailAccounts.begin(); mailIter != m_mailAccounts.end(); ++mailIter)
 	{

Modified: trunk/UI/GTK2/src/PinotSettings.h
===================================================================
--- trunk/UI/GTK2/src/PinotSettings.h	2006-03-18 11:33:54 UTC (rev 155)
+++ trunk/UI/GTK2/src/PinotSettings.h	2006-03-18 13:10:58 UTC (rev 156)
@@ -23,6 +23,7 @@
 #include <set>
 #include <vector>
 #include <glibmm/ustring.h>
+#include <gdkmm/color.h>
 #include <libxml++/nodes/element.h>
 
 #include "QueryProperties.h"
@@ -148,6 +149,8 @@
 		int m_height;
 		int m_panePos;
 		bool m_ignoreRobotsDirectives;
+		bool m_suggestQueryTerms;
+		Gdk::Color m_newResultsColour;
 		std::set<MailAccount> m_mailAccounts;
 
 	protected:
@@ -168,6 +171,7 @@
 		bool loadQueries(const xmlpp::Element *pElem);
 		bool loadResults(const xmlpp::Element *pElem);
 		bool loadLabels(const xmlpp::Element *pElem);
+		bool loadColour(const xmlpp::Element *pElem);
 		bool loadMailAccounts(const xmlpp::Element *pElem);
 
 	private:

Modified: trunk/UI/GTK2/src/ResultsTree.cpp
===================================================================
--- trunk/UI/GTK2/src/ResultsTree.cpp	2006-03-18 11:33:54 UTC (rev 155)
+++ trunk/UI/GTK2/src/ResultsTree.cpp	2006-03-18 13:10:58 UTC (rev 156)
@@ -106,7 +106,12 @@
 	iconRenderer = new CellRendererPixbuf();
 	treeColumn->pack_start(*manage(iconRenderer), false);
 	treeColumn->set_cell_data_func(*iconRenderer, SigC::slot(*this, &ResultsTree::renderRanking));
-	treeColumn->pack_end(m_resultsColumns.m_text, false);
+	// And a last one for text
+	// ...followed by a text renderer
+	CellRendererText *textCellRenderer = new CellRendererText();
+	treeColumn->pack_start(*manage(textCellRenderer));
+	treeColumn->set_cell_data_func(*textCellRenderer, SigC::slot(*this, &ResultsTree::renderBackgroundColour));
+	treeColumn->add_attribute(textCellRenderer->property_text(), m_resultsColumns.m_text);
 	treeColumn->set_resizable(true);
 	append_column(*manage(treeColumn));
 
@@ -212,17 +217,15 @@
 	CellRendererPixbuf *iconRenderer = dynamic_cast<CellRendererPixbuf*>(renderer);
 	if (iconRenderer != NULL)
 	{
-		// Is this result new ?
-		if (row[m_resultsColumns.m_rankDiff] == 666)
+		int rankDiff = row[m_resultsColumns.m_rankDiff];
+
+		// Has this result's score changed ?
+		if ((rankDiff > 0) &&
+			(rankDiff != 666))
 		{
-			iconRenderer->property_pixbuf() = m_newIconPixbuf;
-		}
-		// Has its score changed ?
-		else if (row[m_resultsColumns.m_rankDiff] > 0)
-		{
 			iconRenderer->property_pixbuf() = m_upIconPixbuf;
 		}
-		else if (row[m_resultsColumns.m_rankDiff] < 0)
+		else if (rankDiff < 0)
 		{
 			iconRenderer->property_pixbuf() = m_downIconPixbuf;
 		}
@@ -233,6 +236,31 @@
 	}
 }
 
+void ResultsTree::renderBackgroundColour(CellRenderer *renderer, const TreeModel::iterator &iter)
+{
+	TreeModel::Row row = *iter;
+
+	if (renderer == NULL)
+	{
+		return;
+	}
+
+	CellRendererText *textRenderer = dynamic_cast<CellRendererText*>(renderer);
+	if (textRenderer != NULL)
+	{
+		// Is this result new ?
+		if (row[m_resultsColumns.m_rankDiff] == 666)
+		{
+			// Change the row's background
+			textRenderer->property_background_gdk() = m_settings.m_newResultsColour;
+		}
+		else
+		{
+			textRenderer->property_background_gdk().reset_value();
+		}
+	}
+}
+
 void ResultsTree::onButtonPressEvent(GdkEventButton *ev)
 {
 	// Check for popup click

Modified: trunk/UI/GTK2/src/ResultsTree.h
===================================================================
--- trunk/UI/GTK2/src/ResultsTree.h	2006-03-18 11:33:54 UTC (rev 155)
+++ trunk/UI/GTK2/src/ResultsTree.h	2006-03-18 13:10:58 UTC (rev 156)
@@ -117,6 +117,8 @@
 
 		void renderRanking(Gtk::CellRenderer *renderer, const Gtk::TreeModel::iterator &iter);
 
+		void renderBackgroundColour(Gtk::CellRenderer *renderer, const Gtk::TreeModel::iterator &iter);
+
 		void onButtonPressEvent(GdkEventButton *ev);
 
 		void onSelectionChanged(void);

Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2006-03-18 11:33:54 UTC (rev 155)
+++ trunk/UI/GTK2/src/mainWindow.cc	2006-03-18 13:10:58 UTC (rev 156)
@@ -1031,7 +1031,6 @@
 		else
 		{
 			string url = pIndexThread->getURL();
-			bool labeled = false;
 
 			status = _("Indexed");
 			status += " ";
@@ -1049,17 +1048,6 @@
 				m_state.unlock_lists();
 			}
 
-			if (pIndexPage != NULL)
-			{
-				// Was the current label applied to that document ?
-				ustring labelName = pIndexPage->getLabelName();
-				if ((labelName.empty() == false) &&
-					(labelName == to_utf8(pIndexThread->getLabelName())))
-				{
-					labeled = true;
-				}
-			}
-
 			if (pIndexTree != NULL)
 			{
 				unsigned int rowsCount = pIndexTree->getRowsCount();
@@ -1074,7 +1062,7 @@
 						docInfo.getLocation(), docInfo.getType(),
 						docInfo.getLanguage());
 					indexedDoc.setTimestamp(docInfo.getTimestamp());
-					pIndexTree->appendDocument(indexedDoc, labeled);
+					pIndexTree->appendDocument(indexedDoc);
 				}
 				pIndexPage->setDocumentsCount(pIndexPage->getDocumentsCount() + 1);
 				pIndexPage->updateButtonsState(m_maxDocsCount);
@@ -1263,25 +1251,8 @@
 	}
 	unsigned int rowsCount = pIndexTree->getRowsCount();
 
-	// Does that document have the current label ?
-	ustring labelName = pIndexPage->getLabelName();
-	if (labelName.empty() == false)
-	{
-		const std::map<string, string> &indexesMap = PinotSettings::getInstance().getIndexes();
-		std::map<string, string>::const_iterator mapIter = indexesMap.find(indexName);
-		if (mapIter != indexesMap.end())
-		{
-			XapianIndex index(mapIter->second);
-
-			if (index.isGood() == true)
-			{
-				hasLabel = index.hasLabel(docId, from_utf8(labelName));
-			}
-		}
-	}
-
 	// Add a row
-	pIndexTree->appendDocument(docInfo, hasLabel);
+	pIndexTree->appendDocument(docInfo);
 }
 
 //
@@ -1929,22 +1900,6 @@
 	if ((documentsList.size() == 1) &&
 		(docId > 0))
 	{
-		bool matchesLabel = false;
-
-		// Does the sole selected document match the current label now ?
-		if ((labelName.empty() == false) &&
-			(find(labels.begin(), labels.end(), labelName) != labels.end()))
-		{
-			matchesLabel = true;
-		}
-
-		// Was there any change ?
-		if (matchesLabel != matchedLabel)
-		{
-			// Update this document to the index tree
-			pIndexTree->setDocumentColourState(docId, matchesLabel);
-		}
-
 		// Did the title change ?
 		string newTitle = propertiesBox.getDocumentInfo().getTitle();
 		if (newTitle != docInfo.getTitle())
@@ -2173,6 +2128,12 @@
 //
 void mainWindow::on_liveQueryEntry_changed()
 {
+	if (m_settings.m_suggestQueryTerms == false)
+	{
+		// This functionality is disabled
+		return;
+	}
+
 	ustring prefix, term = liveQueryEntry->get_text();
 	unsigned int liveQueryLength = term.length();
 

Modified: trunk/UI/GTK2/src/prefsDialog.cc
===================================================================
--- trunk/UI/GTK2/src/prefsDialog.cc	2006-03-18 11:33:54 UTC (rev 155)
+++ trunk/UI/GTK2/src/prefsDialog.cc	2006-03-18 13:10:58 UTC (rev 156)
@@ -62,6 +62,10 @@
 	// Browser entry field and button
 	browserEntry->set_sensitive(m_settings.m_browseResults);
 	browserButton->set_sensitive(m_settings.m_browseResults);
+	// New results colour
+	newResultsColorbutton->set_color(m_settings.m_newResultsColour);
+	// Enable terms suggestion
+	enableCompletionCheckbutton->set_active(m_settings.m_suggestQueryTerms);
 
 	// Associate the columns model to the labels tree
 	m_refLabelsTree = ListStore::create(m_labelsColumns);
@@ -296,6 +300,8 @@
 		m_settings.m_browseResults = true;
 	}
 	m_settings.m_browserCommand = browserEntry->get_text();
+	m_settings.m_newResultsColour = newResultsColorbutton->get_color();
+	m_settings.m_suggestQueryTerms = enableCompletionCheckbutton->get_active();
 	m_settings.m_googleAPIKey = apiKeyEntry->get_text();
 
 	// Validate the current labels and mail accounts

Modified: trunk/UI/GTK2/src/prefsDialog_glade.cc
===================================================================
--- trunk/UI/GTK2/src/prefsDialog_glade.cc	2006-03-18 11:33:54 UTC (rev 155)
+++ trunk/UI/GTK2/src/prefsDialog_glade.cc	2006-03-18 13:10:58 UTC (rev 156)
@@ -1,4 +1,4 @@
-// generated 2006/3/7 21:04:59 SGT by fabrice at amra.dyndns.org.(none)
+// generated 2006/3/18 19:48:01 SGT by fabrice at amra.dyndns.org.(none)
 // using glademm V2.6.0
 //
 // DO NOT EDIT THIS FILE ! It was created using
@@ -70,6 +70,11 @@
    browserButton = Gtk::manage(new class Gtk::Button(_("...")));
    
    Gtk::HBox *browserHbox = Gtk::manage(new class Gtk::HBox(false, 4));
+   Gtk::Label *newResultsLabel = Gtk::manage(new class Gtk::Label(_("New results:")));
+   Gtk::Label *queriesLabel = Gtk::manage(new class Gtk::Label(_("Queries:")));
+   enableCompletionCheckbutton = Gtk::manage(new class Gtk::CheckButton(_("Enable search terms suggestion")));
+   newResultsColorbutton = Gtk::manage(new class Gtk::ColorButton());
+   
    Gtk::Table *generalTable = Gtk::manage(new class Gtk::Table(2, 2, false));
    Gtk::Label *generalLabel = Gtk::manage(new class Gtk::Label(_("General")));
    Gtk::Label *indexLabelsLabel = Gtk::manage(new class Gtk::Label(_("Labels are used to classify indexed documents:")));
@@ -161,16 +166,37 @@
    browserButton->set_relief(Gtk::RELIEF_NORMAL);
    browserHbox->pack_start(*browserEntry);
    browserHbox->pack_start(*browserButton, Gtk::PACK_SHRINK, 0);
+   newResultsLabel->set_alignment(0,0.5);
+   newResultsLabel->set_padding(4,4);
+   newResultsLabel->set_justify(Gtk::JUSTIFY_LEFT);
+   newResultsLabel->set_line_wrap(false);
+   newResultsLabel->set_use_markup(false);
+   newResultsLabel->set_selectable(false);
+   queriesLabel->set_alignment(0,0.5);
+   queriesLabel->set_padding(4,4);
+   queriesLabel->set_justify(Gtk::JUSTIFY_LEFT);
+   queriesLabel->set_line_wrap(false);
+   queriesLabel->set_use_markup(false);
+   queriesLabel->set_selectable(false);
+   enableCompletionCheckbutton->set_flags(Gtk::CAN_FOCUS);
+   enableCompletionCheckbutton->set_relief(Gtk::RELIEF_NORMAL);
+   enableCompletionCheckbutton->set_mode(true);
+   enableCompletionCheckbutton->set_active(false);
+   newResultsColorbutton->set_flags(Gtk::CAN_FOCUS);
    generalTable->set_row_spacings(0);
    generalTable->set_col_spacings(0);
    generalTable->attach(*robotsLabel, 0, 1, 0, 1, Gtk::FILL, Gtk::FILL, 0, 0);
    generalTable->attach(*viewLabel, 0, 1, 1, 2, Gtk::FILL, Gtk::FILL, 0, 0);
    generalTable->attach(*browserLabel, 0, 1, 2, 3, Gtk::FILL, Gtk::FILL, 0, 0);
-   generalTable->attach(*apiKeyLabel, 0, 1, 3, 4, Gtk::FILL, Gtk::FILL, 0, 0);
-   generalTable->attach(*apiKeyEntry, 1, 2, 3, 4, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
+   generalTable->attach(*apiKeyLabel, 0, 1, 5, 6, Gtk::FILL, Gtk::FILL, 0, 0);
+   generalTable->attach(*apiKeyEntry, 1, 2, 5, 6, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
    generalTable->attach(*viewCombobox, 1, 2, 1, 2, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
    generalTable->attach(*ignoreRobotsCheckbutton, 1, 2, 0, 1, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
    generalTable->attach(*browserHbox, 1, 2, 2, 3, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
+   generalTable->attach(*newResultsLabel, 0, 1, 3, 4, Gtk::FILL, Gtk::FILL, 0, 0);
+   generalTable->attach(*queriesLabel, 0, 1, 4, 5, Gtk::FILL, Gtk::FILL, 0, 0);
+   generalTable->attach(*enableCompletionCheckbutton, 1, 2, 4, 5, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
+   generalTable->attach(*newResultsColorbutton, 1, 2, 3, 4, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
    generalLabel->set_alignment(0.5,0.5);
    generalLabel->set_padding(0,0);
    generalLabel->set_justify(Gtk::JUSTIFY_LEFT);
@@ -326,6 +352,10 @@
    browserEntry->show();
    browserButton->show();
    browserHbox->show();
+   newResultsLabel->show();
+   queriesLabel->show();
+   enableCompletionCheckbutton->show();
+   newResultsColorbutton->show();
    generalTable->show();
    generalLabel->show();
    indexLabelsLabel->show();

Modified: trunk/UI/GTK2/src/prefsDialog_glade.hh
===================================================================
--- trunk/UI/GTK2/src/prefsDialog_glade.hh	2006-03-18 11:33:54 UTC (rev 155)
+++ trunk/UI/GTK2/src/prefsDialog_glade.hh	2006-03-18 13:10:58 UTC (rev 156)
@@ -1,4 +1,4 @@
-// generated 2006/3/7 21:04:59 SGT by fabrice at amra.dyndns.org.(none)
+// generated 2006/3/18 19:48:01 SGT by fabrice at amra.dyndns.org.(none)
 // using glademm V2.6.0
 //
 // DO NOT EDIT THIS FILE ! It was created using
@@ -37,6 +37,7 @@
 #include <gtkmm/entry.h>
 #include <gtkmm/combobox.h>
 #include <gtkmm/checkbutton.h>
+#include <gtkmm/colorbutton.h>
 #include <gtkmm/treeview.h>
 #include <gtkmm/notebook.h>
 
@@ -55,6 +56,8 @@
         class Gtk::CheckButton * ignoreRobotsCheckbutton;
         class Gtk::Entry * browserEntry;
         class Gtk::Button * browserButton;
+        class Gtk::CheckButton * enableCompletionCheckbutton;
+        class Gtk::ColorButton * newResultsColorbutton;
         class Gtk::TreeView * labelsTreeview;
         class Gtk::Button * addLabelButton;
         class Gtk::Button * removeLabelButton;



From fabricecolin at berlios.de  Sun Mar 19 06:29:50 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Sun, 19 Mar 2006 06:29:50 +0100
Subject: [Pinot-svn] r157 - trunk/Search/Plugins
Message-ID: <200603190529.k2J5To2S001967@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-19 06:29:49 +0100 (Sun, 19 Mar 2006)
New Revision: 157

Added:
   trunk/Search/Plugins/CreativeCommons.src
   trunk/Search/Plugins/Exalead.src
Removed:
   trunk/Search/Plugins/Altavista.src
   trunk/Search/Plugins/Lycos.src
Log:
Removed Altavista and Lycos since they are front-ends for Yahoo! and Ask.
Added Exalead and Yahoo! Creative Commons sources.


Deleted: trunk/Search/Plugins/Altavista.src
===================================================================
--- trunk/Search/Plugins/Altavista.src	2006-03-18 13:10:58 UTC (rev 156)
+++ trunk/Search/Plugins/Altavista.src	2006-03-19 05:29:49 UTC (rev 157)
@@ -1,36 +0,0 @@
-# Altavista Search Plugin
-
-<SEARCH
-	version="1.0"
-	name="Altavista"
-	description="Altavista.com"
-	method="GET"
-	action="http://www.altavista.com/web/results"
-	routeType="The Web"
->
-
-<INPUT NAME="pg" VALUE="aq">
-<INPUT NAME="aqmode" VALUE="s">
-<INPUT NAME="aqa" USER>
-<INPUT NAME="aqb" VALUE="">
-<INPUT NAME="kgs" VALUE="1">
-<INPUT NAME="kls" VALUE="0">
-<INPUT NAME="dt" VALUE="tmperiod">
-<INPUT NAME="d2" VALUE="0">
-<INPUT NAME="dfr%5Bd%5D" VALUE="1">
-<INPUT NAME="dfr%5Bm%5D" VALUE="1">
-<INPUT NAME="&dfr%5By%5D" VALUE="1980">
-<INPUT NAME="filetype" VALUE="">
-<INPUT NAME="rc" VALUE="dmn">
-<INPUT NAME="swd" VALUE="">
-<INPUT NAME="lh" VALUE="">
-<INPUTNEXT NAME="nbq" FACTOR="0">
-
-<INTERPRET
-resultListStart=""
-resultListEnd=""
-resultItemStart="<br class='lb'>"
-resultItemEnd="&nbsp;<br><br>"
->
-
-</SEARCH>

Added: trunk/Search/Plugins/CreativeCommons.src
===================================================================
--- trunk/Search/Plugins/CreativeCommons.src	2006-03-18 13:10:58 UTC (rev 156)
+++ trunk/Search/Plugins/CreativeCommons.src	2006-03-19 05:29:49 UTC (rev 157)
@@ -0,0 +1,26 @@
+# Yahoo! Creative Commons Search Plugin
+
+<SEARCH
+	version="1.0"
+	name="Creative Commons"
+	description="Yahoo.com Creative Commons Search"
+	method="GET"
+	action="http://search.yahoo.com/search"
+	routeType="The Web"
+>
+
+<INPUT NAME="ei" VALUE="UTF-8">
+<INPUT NAME="fr" VALUE="sfp-cc">
+<INPUT NAME="p" USER>
+<INPUT NAME="y" VALUE="Search+CC">
+<INPUT NAME="cc" VALUE="1">
+<INPUTNEXT NAME="b" FACTOR="10" VALUE="1">
+
+<INTERPRET
+resultListStart=""
+resultListEnd=""
+resultItemStart="<li><div>"
+resultItemEnd="</em> "
+>
+
+</SEARCH>

Added: trunk/Search/Plugins/Exalead.src
===================================================================
--- trunk/Search/Plugins/Exalead.src	2006-03-18 13:10:58 UTC (rev 156)
+++ trunk/Search/Plugins/Exalead.src	2006-03-19 05:29:49 UTC (rev 157)
@@ -0,0 +1,28 @@
+# Exalead Search Plugin
+
+<SEARCH
+	version="1.0"
+	name="Exalead"
+	description="Exalead.com"
+	method="GET"
+	action="http://www.exalead.com/search/C=0/"
+	routeType="The Web"
+>
+
+<INPUT NAME="U" VALUE="">
+<INPUT NAME="C" VALUE="0">
+<INPUT NAME="2q" VALUE="">
+<INPUT NAME="q" USER>
+<INPUT NAME="htarget.x" VALUE="37">
+<INPUT NAME="htarget.y" VALUE="22">
+<INPUT NAME="htarget" VALUE="0k">
+<INPUTNEXT NAME="2n" FACTOR="10" VALUE="0">
+
+<INTERPRET
+resultListStart=''
+resultListEnd=''
+resultItemStart='<td class="d1"'
+resultItemEnd='</td></tr>'
+>
+
+</SEARCH>

Deleted: trunk/Search/Plugins/Lycos.src
===================================================================
--- trunk/Search/Plugins/Lycos.src	2006-03-18 13:10:58 UTC (rev 156)
+++ trunk/Search/Plugins/Lycos.src	2006-03-19 05:29:49 UTC (rev 157)
@@ -1,27 +0,0 @@
-# Lycos Search Plugin
-
-<SEARCH
-	version="1.0"
-	name="Lycos"
-	description="Lycos.com"
-	method="GET"
-	action="http://search.lycos.com/default.asp"
-	routeType="The Web"
->
-
-<INPUT NAME="loc" VALUE="searchbox">
-<INPUT NAME="tab" VALUE="web">
-<INPUT NAME="adv" VALUE="1">
-<INPUT NAME="wfc" VALUE="3">
-<INPUT NAME="query" USER>
-<INPUT NAME="adf" VALUE="off">
-<INPUTNEXT NAME="p" FACTOR="1" VALUE="1">
-
-<INTERPRET
-resultListStart=""
-resultListEnd=""
-resultItemStart="<!-- IS -->"
-resultItemEnd="<!-- /IS -->"
->
-
-</SEARCH>



From fabricecolin at berlios.de  Sun Mar 19 06:31:50 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Sun, 19 Mar 2006 06:31:50 +0100
Subject: [Pinot-svn] r158 - trunk/UI/GTK2/src
Message-ID: <200603190531.k2J5Vo9p003950@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-19 06:31:45 +0100 (Sun, 19 Mar 2006)
New Revision: 158

Modified:
   trunk/UI/GTK2/src/ResultsTree.cpp
   trunk/UI/GTK2/src/ResultsTree.h
Log:
Icon for new results no longer required.


Modified: trunk/UI/GTK2/src/ResultsTree.cpp
===================================================================
--- trunk/UI/GTK2/src/ResultsTree.cpp	2006-03-19 05:29:49 UTC (rev 157)
+++ trunk/UI/GTK2/src/ResultsTree.cpp	2006-03-19 05:31:45 UTC (rev 158)
@@ -140,7 +140,6 @@
 	// Render the icons
 	m_indexedIconPixbuf = render_icon(Stock::INDEX, ICON_SIZE_MENU, "MetaSE-pinot");
 	m_viewededIconPixbuf = render_icon(Stock::YES, ICON_SIZE_MENU, "MetaSE-pinot");
-	m_newIconPixbuf = render_icon(Stock::NEW, ICON_SIZE_MENU, "MetaSE-pinot");
 	m_upIconPixbuf = render_icon(Stock::GO_UP, ICON_SIZE_MENU, "MetaSE-pinot");
 	m_downIconPixbuf = render_icon(Stock::GO_DOWN, ICON_SIZE_MENU, "MetaSE-pinot");
 
@@ -393,7 +392,6 @@
 	// FIXME: find better icons :-)
 	m_indexedIconPixbuf = render_icon(Stock::INDEX, ICON_SIZE_MENU, "MetaSE-pinot");
 	m_viewededIconPixbuf = render_icon(Stock::YES, ICON_SIZE_MENU, "MetaSE-pinot");
-	m_newIconPixbuf = render_icon(Stock::NEW, ICON_SIZE_MENU, "MetaSE-pinot");
 	m_upIconPixbuf = render_icon(Stock::GO_UP, ICON_SIZE_MENU, "MetaSE-pinot");
 	m_downIconPixbuf = render_icon(Stock::GO_DOWN, ICON_SIZE_MENU, "MetaSE-pinot");
 }

Modified: trunk/UI/GTK2/src/ResultsTree.h
===================================================================
--- trunk/UI/GTK2/src/ResultsTree.h	2006-03-19 05:29:49 UTC (rev 157)
+++ trunk/UI/GTK2/src/ResultsTree.h	2006-03-19 05:31:45 UTC (rev 158)
@@ -101,7 +101,6 @@
 		PinotSettings &m_settings;
 		Glib::RefPtr<Gdk::Pixbuf> m_indexedIconPixbuf;
 		Glib::RefPtr<Gdk::Pixbuf> m_viewededIconPixbuf;
-		Glib::RefPtr<Gdk::Pixbuf> m_newIconPixbuf;
 		Glib::RefPtr<Gdk::Pixbuf> m_upIconPixbuf;
 		Glib::RefPtr<Gdk::Pixbuf> m_downIconPixbuf;
 		std::map<std::string, Gtk::TreeModel::iterator> m_resultsGroups;



From fabricecolin at berlios.de  Sun Mar 19 06:34:40 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Sun, 19 Mar 2006 06:34:40 +0100
Subject: [Pinot-svn] r159 - in trunk: Search Search/Google Search/ObjectsSearch Utils
Message-ID: <200603190534.k2J5YeXH005970@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-19 06:34:05 +0100 (Sun, 19 Mar 2006)
New Revision: 159

Modified:
   trunk/Search/AbstractGenerator.cpp
   trunk/Search/Google/GoogleAPIEngine.cpp
   trunk/Search/ObjectsSearch/ObjectsSearchAPIEngine.cpp
   trunk/Search/PluginWebEngine.cpp
   trunk/Search/SearchEngineInterface.cpp
   trunk/Search/SearchEngineInterface.h
   trunk/Utils/Url.cpp
   trunk/Utils/Url.h
Log:
When a result's URL points to the same host name as the engine's, try to extract
the URL embedded in it if any.


Modified: trunk/Search/AbstractGenerator.cpp
===================================================================
--- trunk/Search/AbstractGenerator.cpp	2006-03-19 05:31:45 UTC (rev 158)
+++ trunk/Search/AbstractGenerator.cpp	2006-03-19 05:34:05 UTC (rev 159)
@@ -175,8 +175,8 @@
 			Xapian::termpos termPos = *positionIter;
 
 			// ...and get those that fall in the abstract window
-			if ((startPosition <= termPos) &&
-				(termPos <= startPosition + m_wordsCount))
+			if ((startPosition <= termPos + 1) &&
+				(termPos < startPosition + m_wordsCount))
 			{
 				wordsBuffer[termPos] = *termIter;
 			}
@@ -190,7 +190,8 @@
 		summary += wordIter->second;
 	}
 #ifdef DEBUG
-	cout << "AbstractGenerator::generateAbstract: summarized document " << docId << " in " << timer.stop()/1000 << " ms" << endl;
+	cout << "AbstractGenerator::generateAbstract: summarized document "
+		<< docId << " in " << timer.stop()/1000 << " ms" << endl;
 #endif
 
 	return summary;

Modified: trunk/Search/Google/GoogleAPIEngine.cpp
===================================================================
--- trunk/Search/Google/GoogleAPIEngine.cpp	2006-03-19 05:31:45 UTC (rev 158)
+++ trunk/Search/Google/GoogleAPIEngine.cpp	2006-03-19 05:34:05 UTC (rev 159)
@@ -123,7 +123,7 @@
 		struct gapi1__ResultElement *resultElement = searchResult->resultElements->__ptr[i];
 
 		string resultUrl(resultElement->URL);
-		if (processResult(resultUrl) == true)
+		if (processResult("http://www.google.com/", resultUrl) == true)
 		{
 			m_resultsList.push_back(Result(resultUrl, resultElement->title, resultElement->snippet, "", pseudoScore));
 			--pseudoScore;

Modified: trunk/Search/ObjectsSearch/ObjectsSearchAPIEngine.cpp
===================================================================
--- trunk/Search/ObjectsSearch/ObjectsSearchAPIEngine.cpp	2006-03-19 05:31:45 UTC (rev 158)
+++ trunk/Search/ObjectsSearch/ObjectsSearchAPIEngine.cpp	2006-03-19 05:34:05 UTC (rev 159)
@@ -82,7 +82,7 @@
 						cout << "ObjectsSearchAPIEngine::makeCall: " << *(pElem->title) << endl;
 
 						string resultUrl(*(pElem->URL));
-						if (processResult(resultUrl) == true)
+						if (processResult("http://www.objectssearch.com/", resultUrl) == true)
 						{
 							m_resultsList.push_back(Result(*(pElem->URL), *(pElem->title), *(pElem->summary), "", pseudoScore));
 							--pseudoScore;

Modified: trunk/Search/PluginWebEngine.cpp
===================================================================
--- trunk/Search/PluginWebEngine.cpp	2006-03-19 05:31:45 UTC (rev 158)
+++ trunk/Search/PluginWebEngine.cpp	2006-03-19 05:34:05 UTC (rev 159)
@@ -100,7 +100,7 @@
 	{
 		string url(resultIter->getLocation());
 
-		if (processResult(url) == false)
+		if (processResult(formattedQuery, url) == false)
 		{
 			// Remove this result
 			if (resultIter == m_resultsList.begin())
@@ -117,6 +117,8 @@
 		}
 		else
 		{
+			resultIter->setLocation(url);
+
 			// Next
 			++resultIter;
 		}

Modified: trunk/Search/SearchEngineInterface.cpp
===================================================================
--- trunk/Search/SearchEngineInterface.cpp	2006-03-19 05:31:45 UTC (rev 158)
+++ trunk/Search/SearchEngineInterface.cpp	2006-03-19 05:34:05 UTC (rev 159)
@@ -80,12 +80,13 @@
 	m_fileFilter = filter;
 }
 
-bool SearchEngineInterface::processResult(string &resultUrl)
+bool SearchEngineInterface::processResult(const string &queryUrl, string &resultUrl)
 {
-	Url urlObj(resultUrl);
+	Url queryUrlObj(queryUrl);
+	Url resultUrlObj(resultUrl);
 
 	if ((m_hostFilter.empty() == false) &&
-		(urlObj.getHost() != m_hostFilter))
+		(resultUrlObj.getHost() != m_hostFilter))
 	{
 #ifdef DEBUG
 		cout << "SearchEngineInterface::processResult: skipping " << resultUrl << endl;
@@ -94,7 +95,7 @@
 	}
 
 	if ((m_fileFilter.empty() == false) &&
-		(urlObj.getFile() != m_fileFilter))
+		(resultUrlObj.getFile() != m_fileFilter))
 	{
 #ifdef DEBUG
 		cout << "SearchEngineInterface::processResult: skipping " << resultUrl << endl;
@@ -102,8 +103,42 @@
 		return false;
 	}
 
+	// Is the result's host name the same as the search engine's ?
+	// FIXME: not all TLDs have leafs at level 2
+	if (Url::reduceHost(queryUrlObj.getHost(), 2) == Url::reduceHost(resultUrlObj.getHost(), 2))
+	{
+		string protocol(resultUrlObj.getProtocol());
+
+		if (protocol.empty() == false)
+		{
+			string embeddedUrl;
+
+			string::size_type startPos = resultUrl.find(protocol, protocol.length());
+			if (startPos != string::npos)
+			{
+				string::size_type endPos = resultUrl.find("&amp;", startPos);
+				if (endPos != string::npos)
+				{
+					embeddedUrl = resultUrl.substr(startPos, endPos - startPos);
+				}
+				else
+				{
+					embeddedUrl = resultUrl.substr(startPos);
+				}
+
+				resultUrl = Url::unescapeUrl(embeddedUrl);
+			}
+#ifdef DEBUG
+			else cout << "SearchEngineInterface::processResult: no embedded URL" << endl;
+#endif
+		}
+#ifdef DEBUG
+		else cout << "SearchEngineInterface::processResult: no protocol" << endl;
+#endif
+	}
+
 	// Remove trailing spaces at the end of the URL
-	string trimmedUrl = resultUrl;
+	string trimmedUrl(resultUrl);
 	string::size_type pos = trimmedUrl.find_last_of(" ");
 	while (pos != string::npos)
 	{

Modified: trunk/Search/SearchEngineInterface.h
===================================================================
--- trunk/Search/SearchEngineInterface.h	2006-03-19 05:31:45 UTC (rev 158)
+++ trunk/Search/SearchEngineInterface.h	2006-03-19 05:34:05 UTC (rev 159)
@@ -71,7 +71,7 @@
 
 		void setFileNameFilter(const string &filter);
 
-		virtual bool processResult(string &resultUrl);
+		virtual bool processResult(const string &queryUrl, string &resultUrl);
 
 };
 

Modified: trunk/Utils/Url.cpp
===================================================================
--- trunk/Utils/Url.cpp	2006-03-19 05:31:45 UTC (rev 158)
+++ trunk/Utils/Url.cpp	2006-03-19 05:34:05 UTC (rev 159)
@@ -289,6 +289,41 @@
 	return prettyUrl;
 }
 
+/// Reduces a host name to the given TLD level.
+string Url::reduceHost(const string &hostName, unsigned int level)
+{
+	string reducedHost;
+	unsigned int currentLevel = 0;
+
+	if (hostName.empty() == true)
+	{
+		return "";
+	}
+
+	string::size_type endPos = string::npos;
+	string::size_type pos = hostName.find_last_of(".");
+	while ((pos != string::npos) &&
+		(currentLevel < level))
+	{
+		if (endPos == string::npos)
+		{
+			reducedHost = hostName.substr(pos + 1);
+		}
+		else
+		{
+			string level(hostName.substr(pos + 1, endPos - pos));
+			level += reducedHost;
+			reducedHost = level;
+		}
+
+		// Next
+		pos = hostName.find_last_of(".", pos - 1);
+		++currentLevel;
+	}
+
+	return reducedHost;
+}
+
 /// Escapes an URL.
 string Url::escapeUrl(const string &url)
 {

Modified: trunk/Utils/Url.h
===================================================================
--- trunk/Utils/Url.h	2006-03-19 05:31:45 UTC (rev 158)
+++ trunk/Utils/Url.h	2006-03-19 05:34:05 UTC (rev 159)
@@ -32,6 +32,9 @@
 		/// Truncates an URL to the given length by discarding characters in the middle.
 		static std::string prettifyUrl(const std::string &url, unsigned int maxLen);
 
+		/// Reduces a host name to the given TLD level.
+		static std::string reduceHost(const std::string &hostName, unsigned int level);
+
 		/// Escapes an URL.
 		static std::string escapeUrl(const std::string &url);
 



From fabricecolin at berlios.de  Sun Mar 19 14:53:03 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Sun, 19 Mar 2006 14:53:03 +0100
Subject: [Pinot-svn] r160 - in trunk: Search UI/GTK2/src Utils
Message-ID: <200603191353.k2JDr30j017141@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-19 14:52:50 +0100 (Sun, 19 Mar 2006)
New Revision: 160

Modified:
   trunk/Search/SearchEngineInterface.cpp
   trunk/UI/GTK2/src/mainWindow.cc
   trunk/UI/GTK2/src/mainWindow.hh
   trunk/Utils/Url.cpp
Log:
Some fixes for the last couple of check-ins.


Modified: trunk/Search/SearchEngineInterface.cpp
===================================================================
--- trunk/Search/SearchEngineInterface.cpp	2006-03-19 05:34:05 UTC (rev 159)
+++ trunk/Search/SearchEngineInterface.cpp	2006-03-19 13:52:50 UTC (rev 160)
@@ -84,6 +84,7 @@
 {
 	Url queryUrlObj(queryUrl);
 	Url resultUrlObj(resultUrl);
+	string queryHost(Url::reduceHost(queryUrlObj.getHost(), 2));
 
 	if ((m_hostFilter.empty() == false) &&
 		(resultUrlObj.getHost() != m_hostFilter))
@@ -105,7 +106,7 @@
 
 	// Is the result's host name the same as the search engine's ?
 	// FIXME: not all TLDs have leafs at level 2
-	if (Url::reduceHost(queryUrlObj.getHost(), 2) == Url::reduceHost(resultUrlObj.getHost(), 2))
+	if (queryHost == Url::reduceHost(resultUrlObj.getHost(), 2))
 	{
 		string protocol(resultUrlObj.getProtocol());
 

Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2006-03-19 05:34:05 UTC (rev 159)
+++ trunk/UI/GTK2/src/mainWindow.cc	2006-03-19 13:52:50 UTC (rev 160)
@@ -45,7 +45,6 @@
 #include "XapianEngine.h"
 #include "config.h"
 #include "NLS.h"
-#include "IndexPage.h"
 #include "PinotUtils.h"
 #include "mainWindow.hh"
 #include "importDialog.hh"
@@ -1048,25 +1047,23 @@
 				m_state.unlock_lists();
 			}
 
-			if (pIndexTree != NULL)
+			unsigned int rowsCount = pIndexTree->getRowsCount();
+
+			// Ensure the last page is being displayed and is not full
+			if ((pIndexPage->getFirstDocument() + rowsCount == pIndexPage->getDocumentsCount()) &&
+				(rowsCount < m_maxDocsCount))
 			{
-				unsigned int rowsCount = pIndexTree->getRowsCount();
+				// Add a row to the index tree
+				IndexedDocument indexedDoc(docInfo.getTitle(),
+					XapianEngine::buildUrl(m_settings.m_indexLocation, docId),
+					docInfo.getLocation(), docInfo.getType(),
+					docInfo.getLanguage());
+				indexedDoc.setTimestamp(docInfo.getTimestamp());
 
-				// Ensure the last page is being displayed and is not full
-				if ((pIndexPage->getFirstDocument() + rowsCount == pIndexPage->getDocumentsCount()) &&
-					(rowsCount < m_maxDocsCount))
-				{
-					// Add a row to the index tree
-					IndexedDocument indexedDoc(docInfo.getTitle(),
-						XapianEngine::buildUrl(m_settings.m_indexLocation, docId),
-						docInfo.getLocation(), docInfo.getType(),
-						docInfo.getLanguage());
-					indexedDoc.setTimestamp(docInfo.getTimestamp());
-					pIndexTree->appendDocument(indexedDoc);
-				}
-				pIndexPage->setDocumentsCount(pIndexPage->getDocumentsCount() + 1);
-				pIndexPage->updateButtonsState(m_maxDocsCount);
+				append_document(pIndexPage, _("My Documents"), indexedDoc);
 			}
+			pIndexPage->setDocumentsCount(pIndexPage->getDocumentsCount() + 1);
+			pIndexPage->updateButtonsState(m_maxDocsCount);
 		}
 
 		set_status(status);
@@ -1230,12 +1227,8 @@
 //
 void mainWindow::on_message_indexupdate(IndexedDocument docInfo, unsigned int docId, string indexName)
 {
-	IndexPage *pIndexPage = NULL;
-	IndexTree *pIndexTree = NULL;
-	bool hasLabel = false;
-
 	// Find the page for this index
-	pIndexPage = dynamic_cast<IndexPage*>(get_page(to_utf8(indexName), NotebookPageBox::INDEX_PAGE));
+	IndexPage *pIndexPage = dynamic_cast<IndexPage*>(get_page(to_utf8(indexName), NotebookPageBox::INDEX_PAGE));
 	if (pIndexPage == NULL)
 	{
 		// It's probably been closed by the user
@@ -1244,15 +1237,8 @@
 #endif
 		return;
 	}
-	pIndexTree = pIndexPage->getTree();
-	if (pIndexTree == NULL)
-	{
-		return;
-	}
-	unsigned int rowsCount = pIndexTree->getRowsCount();
 
-	// Add a row
-	pIndexTree->appendDocument(docInfo);
+	append_document(pIndexPage, to_utf8(indexName), docInfo);
 }
 
 //
@@ -2937,6 +2923,52 @@
 }
 
 //
+// Append a document to the index tree.
+//
+bool mainWindow::append_document(IndexPage *pIndexPage, const ustring &indexName, const IndexedDocument &docInfo)
+{
+	bool appendToList = true;
+
+	if (pIndexPage == NULL)
+	{
+		return false;
+	}
+
+	IndexTree *pIndexTree = pIndexPage->getTree();
+	if (pIndexTree == NULL)
+	{
+		return false;
+	}
+
+	// Does that document have the current label ?
+	ustring labelName = pIndexPage->getLabelName();
+	if (labelName.empty() == false)
+	{
+		const std::map<string, string> &indexesMap = PinotSettings::getInstance().getIndexes();
+		std::map<string, string>::const_iterator mapIter = indexesMap.find(indexName);
+		if (mapIter != indexesMap.end())
+		{
+			XapianIndex index(mapIter->second);
+	
+			if (index.isGood() == true)
+			{
+				appendToList = index.hasLabel(docInfo.getID(), from_utf8(labelName));
+			}
+		}
+	}
+
+	if (appendToList == true)
+	{
+		// Add a row
+		pIndexTree->appendDocument(docInfo);
+
+		return true;
+	}
+
+	return false;
+}
+
+//
 // Start of worker thread
 //
 bool mainWindow::start_thread(WorkerThread *pNewThread, bool inBackground)

Modified: trunk/UI/GTK2/src/mainWindow.hh
===================================================================
--- trunk/UI/GTK2/src/mainWindow.hh	2006-03-19 05:34:05 UTC (rev 159)
+++ trunk/UI/GTK2/src/mainWindow.hh	2006-03-19 13:52:50 UTC (rev 160)
@@ -39,6 +39,7 @@
 #include "QueryProperties.h"
 #include "EnginesTree.h"
 #include "HtmlView.h"
+#include "IndexPage.h"
 #include "ModelColumns.h"
 #include "Notebook.h"
 #include "PinotSettings.h"
@@ -131,6 +132,8 @@
 	void index_document(const DocumentInfo &docInfo, const std::string &labelName,
 		unsigned int docId = 0);
 	bool view_document(const std::string &url, bool internalViewerOnly = false);
+	bool append_document(IndexPage *pIndexPage, const Glib::ustring &indexName,
+		const IndexedDocument &docInfo);
 	bool start_thread(WorkerThread *pNewThread, bool inBackground = false);
 	bool check_queue(void);
 

Modified: trunk/Utils/Url.cpp
===================================================================
--- trunk/Utils/Url.cpp	2006-03-19 05:34:05 UTC (rev 159)
+++ trunk/Utils/Url.cpp	2006-03-19 13:52:50 UTC (rev 160)
@@ -131,8 +131,12 @@
 		}
 		else
 		{
-			m_host = url.substr(pos1);
-			return;
+			if (url.find_first_of("?", pos1) == string::npos)
+			{
+				m_host = url.substr(pos1);
+				return;
+			}
+			pos2 = 0;
 		}
 		// FIXME: what about the port number ?
 	}



From fabricecolin at berlios.de  Sun Mar 19 14:56:49 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Sun, 19 Mar 2006 14:56:49 +0100
Subject: [Pinot-svn] r161 - trunk
Message-ID: <200603191356.k2JDunXY019900@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-19 14:56:37 +0100 (Sun, 19 Mar 2006)
New Revision: 161

Modified:
   trunk/pinot.spec.in
Log:
Synced engines list.


Modified: trunk/pinot.spec.in
===================================================================
--- trunk/pinot.spec.in	2006-03-19 13:52:50 UTC (rev 160)
+++ trunk/pinot.spec.in	2006-03-19 13:56:37 UTC (rev 161)
@@ -88,15 +88,15 @@
 %dir %{_datadir}/pinot/engines/
 %config(noreplace) %{_datadir}/pinot/engines/A9.src
 %config(noreplace) %{_datadir}/pinot/engines/Acoona.src
-%config(noreplace) %{_datadir}/pinot/engines/Altavista.src
-%config(noreplace) %{_datadir}/pinot/engines/AskJeeves.src
+%config(noreplace) %{_datadir}/pinot/engines/Ask.src
 %config(noreplace) %{_datadir}/pinot/engines/BitTorrent.src
 %config(noreplace) %{_datadir}/pinot/engines/Clusty.src
+%config(noreplace) %{_datadir}/pinot/engines/CreativeCommons.src
+%config(noreplace) %{_datadir}/pinot/engines/Exalead.src
 %config(noreplace) %{_datadir}/pinot/engines/Freshmeat.src
 %config(noreplace) %{_datadir}/pinot/engines/Google.src
-%config(noreplace) %{_datadir}/pinot/engines/Lycos.src
 %config(noreplace) %{_datadir}/pinot/engines/MSN.src
-%config(noreplace) %{_datadir}/pinot/engines/Teoma.src
+%config(noreplace) %{_datadir}/pinot/engines/RollYOTopNews.src
 %config(noreplace) %{_datadir}/pinot/engines/Topix.src
 %config(noreplace) %{_datadir}/pinot/engines/WiseNut.src
 %config(noreplace) %{_datadir}/pinot/engines/Yahoo.src



From fabricecolin at berlios.de  Mon Mar 20 13:19:34 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Mon, 20 Mar 2006 13:19:34 +0100
Subject: [Pinot-svn] r162 - trunk/Search/Plugins
Message-ID: <200603201219.k2KCJYoe010000@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-20 13:19:31 +0100 (Mon, 20 Mar 2006)
New Revision: 162

Added:
   trunk/Search/Plugins/Accoona.src
Removed:
   trunk/Search/Plugins/Acoona.src
Modified:
   trunk/Search/Plugins/BitTorrent.src
   trunk/Search/Plugins/CreativeCommons.src
Log:
Renamed Acoona to Accoona. Moved BitTorrent and Creative Commons to
"Content" channel :-)


Copied: trunk/Search/Plugins/Accoona.src (from rev 135, trunk/Search/Plugins/Acoona.src)
===================================================================
--- trunk/Search/Plugins/Acoona.src	2006-03-04 03:33:34 UTC (rev 135)
+++ trunk/Search/Plugins/Accoona.src	2006-03-20 12:19:31 UTC (rev 162)
@@ -0,0 +1,31 @@
+# Acoona Plugin
+
+<SEARCH
+	version="1.0"
+	name="Accoona"
+	description="Accoona.com"
+	method="GET"
+	action="http://www.accoona.com/search.jsp"
+	routeType="The Web"
+>
+
+<INPUT NAME="la" VALUE="en">
+<INPUT NAME="col" VALUE="">
+<INPUT NAME="qt" USER>
+<INPUTNEXT NAME="st" FACTOR="10" VALUE="1">
+
+<INTERPRET
+resultListStart=""
+resultListEnd=""
+resultItemStart='<td class="webtitle" valign="top">'
+resultItemEnd='</span></td></tr>'
+>
+
+</SEARCH>
+
+
+
+
+
+
+

Deleted: trunk/Search/Plugins/Acoona.src
===================================================================
--- trunk/Search/Plugins/Acoona.src	2006-03-19 13:56:37 UTC (rev 161)
+++ trunk/Search/Plugins/Acoona.src	2006-03-20 12:19:31 UTC (rev 162)
@@ -1,31 +0,0 @@
-# Acoona Plugin
-
-<SEARCH
-	version="1.0"
-	name="Acoona"
-	description="Acoona.com"
-	method="GET"
-	action="http://www.accoona.com/search.jsp"
-	routeType="The Web"
->
-
-<INPUT NAME="la" VALUE="en">
-<INPUT NAME="col" VALUE="">
-<INPUT NAME="qt" USER>
-<INPUTNEXT NAME="st" FACTOR="10" VALUE="1">
-
-<INTERPRET
-resultListStart=""
-resultListEnd=""
-resultItemStart='<td class="webtitle" valign="top">'
-resultItemEnd='</span></td></tr>'
->
-
-</SEARCH>
-
-
-
-
-
-
-

Modified: trunk/Search/Plugins/BitTorrent.src
===================================================================
--- trunk/Search/Plugins/BitTorrent.src	2006-03-19 13:56:37 UTC (rev 161)
+++ trunk/Search/Plugins/BitTorrent.src	2006-03-20 12:19:31 UTC (rev 162)
@@ -6,7 +6,7 @@
 	description="bittorrent.com"
 	method="GET"
 	action="http://search.bittorrent.com/search.jsp"
-	routeType="Media"
+	routeType="Content"
 >
 
 <INPUT NAME="hitsPerPage" VALUE="10">

Modified: trunk/Search/Plugins/CreativeCommons.src
===================================================================
--- trunk/Search/Plugins/CreativeCommons.src	2006-03-19 13:56:37 UTC (rev 161)
+++ trunk/Search/Plugins/CreativeCommons.src	2006-03-20 12:19:31 UTC (rev 162)
@@ -6,7 +6,7 @@
 	description="Yahoo.com Creative Commons Search"
 	method="GET"
 	action="http://search.yahoo.com/search"
-	routeType="The Web"
+	routeType="Content"
 >
 
 <INPUT NAME="ei" VALUE="UTF-8">



From fabricecolin at berlios.de  Mon Mar 20 13:21:35 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Mon, 20 Mar 2006 13:21:35 +0100
Subject: [Pinot-svn] r163 - trunk/Tokenize
Message-ID: <200603201221.k2KCLZBn010956@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-20 13:21:30 +0100 (Mon, 20 Mar 2006)
New Revision: 163

Modified:
   trunk/Tokenize/HtmlTokenizer.cpp
Log:
Add a space to text when stripping tags to avoid concatenating words.


Modified: trunk/Tokenize/HtmlTokenizer.cpp
===================================================================
--- trunk/Tokenize/HtmlTokenizer.cpp	2006-03-20 12:19:31 UTC (rev 162)
+++ trunk/Tokenize/HtmlTokenizer.cpp	2006-03-20 12:21:30 UTC (rev 163)
@@ -124,6 +124,7 @@
 			if (catText == true)
 			{
 				stripped += replaceEscapedCharacters(text);
+				stripped += " ";
 			}
 
 			// Is this part of the name of the last link we found ?



From fabricecolin at berlios.de  Mon Mar 20 14:36:15 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Mon, 20 Mar 2006 14:36:15 +0100
Subject: [Pinot-svn] r165 - trunk
Message-ID: <200603201336.k2KDaFmJ016154@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-20 14:36:14 +0100 (Mon, 20 Mar 2006)
New Revision: 165

Modified:
   trunk/NEWS
   trunk/TODO
Log:
Work done since the previous release.


Modified: trunk/NEWS
===================================================================
--- trunk/NEWS	2006-03-20 13:34:49 UTC (rev 164)
+++ trunk/NEWS	2006-03-20 13:36:14 UTC (rev 165)
@@ -1,3 +1,17 @@
+??? version_0_4_5
+Index :
+ - listing a label's documents displays the correct documents count in the status bar
+  and navigation buttons are enabled or disabled accordingly
+Search :
+ - identified and fixed cause of crash when searching several engines simultaneously
+ - Teoma and Ask Jeeves plugins replaced by Ask.com plugin
+ - dropped Altavista and Lycos
+ - added RollYO's Top News, Exalead and Creative Commons sources
+ - fixed results extraction with Topix
+UI :
+ - suggestion of query terms can be disabled
+ - new results are now shown with a background colour of the user's choice
+
 2006/03/12 version_0_4_4
 Build :
  - fixed building of PDF, RTF and MS Word tokenizer libraries

Modified: trunk/TODO
===================================================================
--- trunk/TODO	2006-03-20 13:34:49 UTC (rev 164)
+++ trunk/TODO	2006-03-20 13:36:14 UTC (rev 165)
@@ -16,13 +16,10 @@
 - With engines that provide a redirection URL for results (eg Acoona), it looks like
   the query hitory is not saved/checked correctly
 - Add Creative Commons (http://search.yahoo.com/cc)
-- Add http://beta.exalead.com/search
-- Add csourcesearch.net
 - Add http://www.patentcommons.org/commons/patentsearch.php
-- Add http://www.podzinger.com/
 - Implement AutoDiscovery of OpenSearch Description files (http://opensearch.a9.com/spec/1.1/description/)
 - Support for Google Buttons
-- If the results' domain match the search engine's, extract "<protocol>://(.*)&amp;" from the file part
+- Make sure Description files' SyndicationRight is not private or closed
 
 Collect
 - Comply with robot stuff defined at http://www.robotstxt.org/
@@ -85,17 +82,14 @@
 - Display search engines icons (Gtk::IconSource::set_filename() and Gtk::Style::render_icon())
 - Replace Combobox objects with ComboboxText's (glademm support required)
 - Replace glademm with libglademm ?
-- Show extract instead of URL in index list
 - Show activity when mail is being indexed
 - Update Last Run after the query has completed
 - Add a Recent Import section that relies on documents timestamps
 - Filter documents by language, similarly to how labels are shown
 - Save engines groups state in config file
-- Enable to save live queries
 - Clean up method names
 - Prefer ustring to string whenever possible
 - Closing when threads are running gives the impression Pinot has crashed; how do we tell the user
   we are waiting for something to finish ?
-- ViewHistory should have a Date field to allow expiration/cleanup
 - Try sizing the window optimally on the first startup
 



From fabricecolin at berlios.de  Mon Mar 20 14:34:52 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Mon, 20 Mar 2006 14:34:52 +0100
Subject: [Pinot-svn] r164 - trunk/po
Message-ID: <200603201334.k2KDYqxu014653@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-20 14:34:49 +0100 (Mon, 20 Mar 2006)
New Revision: 164

Added:
   trunk/po/en.po
Removed:
   trunk/po/en_GB.po
Modified:
   trunk/po/es.po
   trunk/po/fr.po
Log:
Updated translations (Spanish catalog not complete yet).


Copied: trunk/po/en.po (from rev 135, trunk/po/en_GB.po)

Deleted: trunk/po/en_GB.po
===================================================================
--- trunk/po/en_GB.po	2006-03-20 12:21:30 UTC (rev 163)
+++ trunk/po/en_GB.po	2006-03-20 13:34:49 UTC (rev 164)
@@ -1,841 +0,0 @@
-# en_GB PO file for pinot.
-# Copyright (C) 2005-2006 Fabrice Colin
-# This file is distributed under the same license as the pinot package.
-# Fabrice Colin <colinf at chez.com>, 2005-2006.
-#
-#, fuzzy
-msgid ""
-msgstr ""
-"Project-Id-Version: pinot 0.42\n"
-"Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2005-12-08 19:20+0800\n"
-"PO-Revision-Date: 2006-01-20 19:32+0800\n"
-"Last-Translator: Fabrice Colin <colinf at chez.com>\n"
-"Language-Team: en_GB <colinf at chez.com>\n"
-"MIME-Version: 1.0\n"
-"Content-Type: text/plain; charset=utf-8\n"
-"Content-Transfer-Encoding: 8bit\n"
-
-#: UI/GTK2/src/EnginesTree.cpp:67
-msgid "Search Engines"
-msgstr ""
-
-#: UI/GTK2/src/EnginesTree.cpp:291
-msgid "Current User"
-msgstr ""
-
-#: UI/GTK2/src/EnginesTree.cpp:303 UI/GTK2/src/mainWindow.cc:344
-#: UI/GTK2/src/mainWindow.cc:347 UI/GTK2/src/mainWindow.cc:520
-#: UI/GTK2/src/mainWindow.cc:1055 UI/GTK2/src/mainWindow.cc:1139
-#: UI/GTK2/src/mainWindow.cc:1174 UI/GTK2/src/mainWindow.cc:1787
-#: UI/GTK2/src/PinotSettings.cpp:199 UI/GTK2/src/PinotSettings.cpp:881
-#: UI/GTK2/src/PinotSettings.cpp:937
-msgid "My Documents"
-msgstr ""
-
-#: UI/GTK2/src/EnginesTree.cpp:307 UI/GTK2/src/mainWindow.cc:350
-#: UI/GTK2/src/mainWindow.cc:353 UI/GTK2/src/mainWindow.cc:524
-#: UI/GTK2/src/MonitorHandler.cpp:173 UI/GTK2/src/PinotSettings.cpp:200
-#: UI/GTK2/src/PinotSettings.cpp:882 UI/GTK2/src/PinotSettings.cpp:938
-#: UI/GTK2/src/prefsDialog_glade.cc:116
-msgid "My Email"
-msgstr ""
-
-#: UI/GTK2/src/importDialog.cc:108
-msgid "Enabled"
-msgstr ""
-
-#: UI/GTK2/src/importDialog.cc:109 UI/GTK2/src/prefsDialog.cc:78
-msgid "MIME Type"
-msgstr ""
-
-#: UI/GTK2/src/importDialog.cc:134
-msgid "File"
-msgstr ""
-
-#: UI/GTK2/src/importDialog.cc:137
-msgid "Directory"
-msgstr ""
-
-#: UI/GTK2/src/importDialog.cc:142 UI/GTK2/src/IndexTree.cpp:70
-#: UI/GTK2/src/ResultsTree.cpp:114
-msgid "URL"
-msgstr ""
-
-#: UI/GTK2/src/importDialog.cc:148 UI/GTK2/src/IndexPage.cpp:158
-#: UI/GTK2/src/IndexPage.cpp:204 UI/GTK2/src/queryDialog.cc:91
-msgid "None"
-msgstr ""
-
-#: UI/GTK2/src/importDialog.cc:444
-msgid "Document To Import"
-msgstr ""
-
-#: UI/GTK2/src/importDialog_glade.cc:66 UI/GTK2/src/indexDialog_glade.cc:68
-msgid "Location:"
-msgstr ""
-
-#: UI/GTK2/src/importDialog_glade.cc:67
-#: UI/GTK2/src/propertiesDialog_glade.cc:64
-msgid "Title:"
-msgstr ""
-
-#: UI/GTK2/src/importDialog_glade.cc:70 UI/GTK2/src/indexDialog_glade.cc:67
-msgid "Type:"
-msgstr ""
-
-#: UI/GTK2/src/importDialog_glade.cc:72 UI/GTK2/src/indexDialog_glade.cc:64
-#: UI/GTK2/src/prefsDialog_glade.cc:70
-msgid "..."
-msgstr ""
-
-#: UI/GTK2/src/importDialog_glade.cc:78
-msgid "Depth:"
-msgstr ""
-
-#: UI/GTK2/src/importDialog_glade.cc:79
-msgid "Symlinks:"
-msgstr ""
-
-#: UI/GTK2/src/importDialog_glade.cc:80
-msgid "Follow symlinks"
-msgstr ""
-
-#: UI/GTK2/src/importDialog_glade.cc:83
-msgid "Apply label:"
-msgstr ""
-
-#: UI/GTK2/src/importDialog_glade.cc:91 UI/GTK2/src/mainWindow_glade.cc:201
-msgid "Import"
-msgstr ""
-
-#: UI/GTK2/src/importDialog_glade.cc:211
-msgid "Import document"
-msgstr ""
-
-#: UI/GTK2/src/indexDialog.cc:221
-msgid "Index location"
-msgstr ""
-
-#: UI/GTK2/src/indexDialog_glade.cc:62 UI/GTK2/src/queryDialog_glade.cc:60
-msgid "Name:"
-msgstr ""
-
-#: UI/GTK2/src/indexDialog_glade.cc:69
-msgid "Port:"
-msgstr ""
-
-#: UI/GTK2/src/indexDialog_glade.cc:143
-msgid "External index"
-msgstr ""
-
-#: UI/GTK2/src/IndexTree.cpp:64 UI/GTK2/src/ResultsTree.cpp:96
-msgid "Title"
-msgstr ""
-
-#: UI/GTK2/src/IndexTree.cpp:75
-msgid "Timestamp"
-msgstr ""
-
-#: UI/GTK2/src/IndexPage.cpp:50
-msgid "Show Previous"
-msgstr ""
-
-#: UI/GTK2/src/IndexPage.cpp:56
-msgid "Show Next"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:148
-msgid "Query Name"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:153
-msgid "Last Run"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:154
-msgid "Summary"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:211
-msgid "Add index"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:212
-msgid "Remove index"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:235
-msgid "Ready"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:249 UI/GTK2/src/mainWindow.cc:1012
-#: UI/GTK2/src/mainWindow.cc:1384 UI/GTK2/src/mainWindow.cc:2956
-#: UI/GTK2/src/mainWindow_glade.cc:207
-msgid "View"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:281
-msgid "N/A"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:291
-msgid "<undefined>"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:482
-msgid "Result location is"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:535
-msgid "Document location is"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:644
-msgid "No label"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:793
-msgid "Showing"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:798
-msgid "off"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:803
-msgid "documents, starting at"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:837
-msgid "Query"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:841 UI/GTK2/src/mainWindow.cc:2786
-msgid "on"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:845
-msgid "ended"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:946 UI/GTK2/src/propertiesDialog.cc:40
-msgid "Label"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:950
-msgid "matches"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:955
-msgid "document(s)"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:987
-msgid "Updated label(s)"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:1065 UI/GTK2/src/mainWindow.cc:1185
-msgid "Updated document"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:1078
-msgid "Indexed"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:1140
-msgid "Unindexed document(s)"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:1236
-msgid "Couldn't rename index, name"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:1240 UI/GTK2/src/mainWindow.cc:2141
-#: UI/GTK2/src/mainWindow.cc:2620
-msgid "is already in use"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:1253
-msgid "Couldn't rename index"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:1266
-msgid "Edited index"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:1726 UI/GTK2/src/mainWindow.cc:1829
-msgid "Please set a location for the index first"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:1753
-msgid "Result location is unknown"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:1777
-msgid "Import Document(s)"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:1907 UI/GTK2/src/pinot.cc:148
-#: UI/GTK2/src/pinot.cc:153 UI/GTK2/src/WorkerThreads.cpp:371
-#: UI/GTK2/src/WorkerThreads.cpp:608 UI/GTK2/src/WorkerThreads.cpp:1221
-msgid "Index"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:1911 UI/GTK2/src/WorkerThreads.cpp:375
-#: UI/GTK2/src/WorkerThreads.cpp:612 UI/GTK2/src/WorkerThreads.cpp:1225
-msgid "doesn't exist"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:2021
-msgid "Delete this document from the index ?"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:2040
-msgid "Delete these documents from the index ?"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:2092
-msgid "A metasearch tool for the Free Desktop"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:2093
-msgid "(C) 2005-2006 Fabrice Colin"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:2137
-msgid "Index name"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:2152
-msgid "Couldn't add index"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:2166
-msgid "Added new index"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:2201
-msgid "Couldn't remove index"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:2435
-msgid "At least one task hasn't completed yet. Quit now ?"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:2616
-msgid "Query name"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:2643
-msgid "Couldn't update query"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:2651
-msgid "Edited query"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:2658
-msgid "Couldn't add query"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:2666
-msgid "Added new query"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:2680
-msgid "Query is not set"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:2691
-msgid "No search engine selected"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:2773
-msgid "Please set the Google API key first"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:2782
-msgid "Running query"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:2887
-msgid "is already indexed or is being indexed"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:2914
-msgid "No URL to browse"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:2925
-msgid "No browser configured to view results"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow.cc:2937
-msgid "Couldn't browse URL:"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow_glade.cc:115
-msgid "Query:"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow_glade.cc:127 UI/GTK2/src/prefsDialog_glade.cc:86
-msgid "Edit"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow_glade.cc:136
-msgid "Stored queries"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow_glade.cc:171
-msgid "Search Engine"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow_glade.cc:174
-msgid "Host Name"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow_glade.cc:177
-msgid "Clear List"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow_glade.cc:180
-msgid "Show Extract"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow_glade.cc:183
-msgid "Group By"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow_glade.cc:189
-msgid "Vie_w"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow_glade.cc:192
-msgid "View Cache"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow_glade.cc:195 UI/GTK2/src/mainWindow_glade.cc:231
-msgid "_Index"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow_glade.cc:198
-msgid "List Contents Of"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow_glade.cc:210
-msgid "Update"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow_glade.cc:213
-msgid "Unindex"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow_glade.cc:216
-#: UI/GTK2/src/propertiesDialog_glade.cc:171
-#: UI/GTK2/src/queryDialog_glade.cc:83
-msgid "Properties"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow_glade.cc:219
-msgid "_About"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow_glade.cc:222
-msgid "_Session"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow_glade.cc:225
-msgid "_Edit"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow_glade.cc:228
-msgid "_Results"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow_glade.cc:234
-msgid "_Help"
-msgstr ""
-
-#: UI/GTK2/src/mainWindow_glade.cc:356
-msgid "Pinot"
-msgstr ""
-
-#: UI/GTK2/src/pinot.cc:56
-msgid "Couldn't save configuration file"
-msgstr ""
-
-#: UI/GTK2/src/pinot.cc:117
-msgid "Danish"
-msgstr ""
-
-#: UI/GTK2/src/pinot.cc:118
-msgid "Dutch"
-msgstr ""
-
-#: UI/GTK2/src/pinot.cc:119
-msgid "English"
-msgstr ""
-
-#: UI/GTK2/src/pinot.cc:120
-msgid "Finnish"
-msgstr ""
-
-#: UI/GTK2/src/pinot.cc:121
-msgid "French"
-msgstr ""
-
-#: UI/GTK2/src/pinot.cc:122
-msgid "German"
-msgstr ""
-
-#: UI/GTK2/src/pinot.cc:123
-msgid "Italian"
-msgstr ""
-
-#: UI/GTK2/src/pinot.cc:124
-msgid "Norwegian"
-msgstr ""
-
-#: UI/GTK2/src/pinot.cc:125
-msgid "Portuguese"
-msgstr ""
-
-#: UI/GTK2/src/pinot.cc:126
-msgid "Russian"
-msgstr ""
-
-#: UI/GTK2/src/pinot.cc:127
-msgid "Spanish"
-msgstr ""
-
-#: UI/GTK2/src/pinot.cc:128
-msgid "Swedish"
-msgstr ""
-
-#: UI/GTK2/src/pinot.cc:149 UI/GTK2/src/pinot.cc:154
-msgid "is not valid, please check"
-msgstr ""
-
-#: UI/GTK2/src/pinot.cc:162
-msgid "History database"
-msgstr ""
-
-#: UI/GTK2/src/pinot.cc:163
-msgid "couldn't be created"
-msgstr ""
-
-#: UI/GTK2/src/PinotSettings.cpp:106
-msgid "Couldn't create pinot directory at"
-msgstr ""
-
-#: UI/GTK2/src/PinotSettings.cpp:195
-msgid "Failed to parse configuration file"
-msgstr ""
-
-#: UI/GTK2/src/PinotSettings.cpp:204
-msgid "Red"
-msgstr ""
-
-#: UI/GTK2/src/PinotSettings.cpp:206
-msgid "Blue"
-msgstr ""
-
-#: UI/GTK2/src/PinotSettings.cpp:208
-msgid "Green"
-msgstr ""
-
-#: UI/GTK2/src/PinotSettings.cpp:289
-msgid "Couldn't load ui block"
-msgstr ""
-
-#: UI/GTK2/src/PinotSettings.cpp:296
-msgid "Couldn't load extraindex block"
-msgstr ""
-
-#: UI/GTK2/src/PinotSettings.cpp:303
-msgid "Couldn't load storedquery block"
-msgstr ""
-
-#: UI/GTK2/src/PinotSettings.cpp:310
-msgid "Couldn't load results block"
-msgstr ""
-
-#: UI/GTK2/src/PinotSettings.cpp:317
-msgid "Couldn't load label block"
-msgstr ""
-
-#: UI/GTK2/src/PinotSettings.cpp:335
-msgid "Couldn't load mailaccount block"
-msgstr ""
-
-#: UI/GTK2/src/PinotSettings.cpp:343
-msgid "Couldn't parse configuration file"
-msgstr ""
-
-#: UI/GTK2/src/PinotSettings.cpp:732
-msgid "Unclassified"
-msgstr ""
-
-#: UI/GTK2/src/prefsDialog.cc:69
-msgid "Name"
-msgstr ""
-
-#: UI/GTK2/src/prefsDialog.cc:77
-msgid "Location"
-msgstr ""
-
-#: UI/GTK2/src/prefsDialog.cc:114
-msgid "In internal viewer"
-msgstr ""
-
-#: UI/GTK2/src/prefsDialog.cc:117
-msgid "In browser"
-msgstr ""
-
-#: UI/GTK2/src/prefsDialog.cc:332
-msgid "Browser location"
-msgstr ""
-
-#: UI/GTK2/src/prefsDialog.cc:343
-msgid "New Label"
-msgstr ""
-
-#: UI/GTK2/src/prefsDialog.cc:365
-msgid "Colour"
-msgstr ""
-
-#: UI/GTK2/src/prefsDialog.cc:436 UI/GTK2/src/prefsDialog.cc:470
-msgid "Mbox File Location"
-msgstr ""
-
-#: UI/GTK2/src/prefsDialog_glade.cc:62
-msgid "HTTP crawling:"
-msgstr ""
-
-#: UI/GTK2/src/prefsDialog_glade.cc:63
-msgid "View documents:"
-msgstr ""
-
-#: UI/GTK2/src/prefsDialog_glade.cc:64
-msgid "Browser:"
-msgstr ""
-
-#: UI/GTK2/src/prefsDialog_glade.cc:65
-msgid "Google API key:"
-msgstr ""
-
-#: UI/GTK2/src/prefsDialog_glade.cc:68
-msgid "Ignore robots.txt and Robots META tag"
-msgstr ""
-
-#: UI/GTK2/src/prefsDialog_glade.cc:74
-msgid "General"
-msgstr ""
-
-#: UI/GTK2/src/prefsDialog_glade.cc:75
-msgid "Labels are used to classify indexed documents:"
-msgstr ""
-
-#: UI/GTK2/src/prefsDialog_glade.cc:80 UI/GTK2/src/prefsDialog_glade.cc:106
-msgid "Add"
-msgstr ""
-
-#: UI/GTK2/src/prefsDialog_glade.cc:92
-msgid "Remove"
-msgstr ""
-
-#: UI/GTK2/src/prefsDialog_glade.cc:100
-msgid "Labels"
-msgstr ""
-
-#: UI/GTK2/src/prefsDialog_glade.cc:101
-msgid "Mail boxes of type mbox can be monitored and indexed:"
-msgstr ""
-
-#: UI/GTK2/src/prefsDialog_glade.cc:332
-msgid "Preferences"
-msgstr ""
-
-#: UI/GTK2/src/propertiesDialog.cc:51
-msgid "Unknown"
-msgstr ""
-
-#: UI/GTK2/src/propertiesDialog_glade.cc:65
-msgid "Extract:"
-msgstr ""
-
-#: UI/GTK2/src/propertiesDialog_glade.cc:66
-msgid "Language:"
-msgstr ""
-
-#: UI/GTK2/src/propertiesDialog_glade.cc:68
-msgid "MIME type:"
-msgstr ""
-
-#: UI/GTK2/src/queryDialog.cc:96 UI/GTK2/src/queryDialog.cc:125
-msgid "Any"
-msgstr ""
-
-#: UI/GTK2/src/queryDialog_glade.cc:70
-msgid "Index all results with label"
-msgstr ""
-
-#: UI/GTK2/src/queryDialog_glade.cc:72
-msgid "Any of the words:"
-msgstr ""
-
-#: UI/GTK2/src/queryDialog_glade.cc:73
-msgid "File name:"
-msgstr ""
-
-#: UI/GTK2/src/queryDialog_glade.cc:74
-msgid "Number of results:"
-msgstr ""
-
-#: UI/GTK2/src/queryDialog_glade.cc:77
-msgid "Host name:"
-msgstr ""
-
-#: UI/GTK2/src/queryDialog_glade.cc:78
-msgid "None of the words:"
-msgstr ""
-
-#: UI/GTK2/src/queryDialog_glade.cc:84
-msgid "Limit to documents that match"
-msgstr ""
-
-#: UI/GTK2/src/queryDialog_glade.cc:87
-msgid "the exact phrase:"
-msgstr ""
-
-#: UI/GTK2/src/queryDialog_glade.cc:88
-msgid "the language:"
-msgstr ""
-
-#: UI/GTK2/src/queryDialog_glade.cc:92
-msgid "all the words:"
-msgstr ""
-
-#: UI/GTK2/src/queryDialog_glade.cc:93
-msgid "the label:"
-msgstr ""
-
-#: UI/GTK2/src/queryDialog_glade.cc:98
-msgid "Advanced"
-msgstr ""
-
-#: UI/GTK2/src/queryDialog_glade.cc:283
-msgid "Query properties"
-msgstr ""
-
-#: UI/GTK2/src/WorkerThreads.cpp:350
-msgid "Stopped browsing"
-msgstr ""
-
-#: UI/GTK2/src/WorkerThreads.cpp:384 UI/GTK2/src/WorkerThreads.cpp:620
-#: UI/GTK2/src/WorkerThreads.cpp:665 UI/GTK2/src/WorkerThreads.cpp:675
-#: UI/GTK2/src/WorkerThreads.cpp:891 UI/GTK2/src/WorkerThreads.cpp:1106
-#: UI/GTK2/src/WorkerThreads.cpp:1234
-msgid "Index error on"
-msgstr ""
-
-#: UI/GTK2/src/WorkerThreads.cpp:490
-msgid "Stopped querying"
-msgstr ""
-
-#: UI/GTK2/src/WorkerThreads.cpp:502
-msgid "Couldn't create search engine"
-msgstr ""
-
-#: UI/GTK2/src/WorkerThreads.cpp:514
-msgid "Couldn't run query on search engine"
-msgstr ""
-
-#: UI/GTK2/src/WorkerThreads.cpp:530
-msgid "No title"
-msgstr ""
-
-#: UI/GTK2/src/WorkerThreads.cpp:592 UI/GTK2/src/WorkerThreads.cpp:656
-msgid "Stopped querying index labels"
-msgstr ""
-
-#: UI/GTK2/src/WorkerThreads.cpp:746
-msgid "Stopped retrieval of"
-msgstr ""
-
-#: UI/GTK2/src/WorkerThreads.cpp:782
-msgid "Couldn't obtain downloader for protocol"
-msgstr ""
-
-#: UI/GTK2/src/WorkerThreads.cpp:796 UI/GTK2/src/WorkerThreads.cpp:905
-msgid "Couldn't retrieve"
-msgstr ""
-
-#: UI/GTK2/src/WorkerThreads.cpp:876
-msgid "Stopped indexing"
-msgstr ""
-
-#: UI/GTK2/src/WorkerThreads.cpp:929
-msgid "Cannot index document type"
-msgstr ""
-
-#: UI/GTK2/src/WorkerThreads.cpp:933
-msgid "at"
-msgstr ""
-
-#: UI/GTK2/src/WorkerThreads.cpp:958
-msgid "Couldn't tokenize"
-msgstr ""
-
-#: UI/GTK2/src/WorkerThreads.cpp:979
-msgid "Robots META tag forbids indexing"
-msgstr ""
-
-#: UI/GTK2/src/WorkerThreads.cpp:1029
-msgid "Couldn't index"
-msgstr ""
-
-#: UI/GTK2/src/WorkerThreads.cpp:1094
-msgid "Stopped unindexing document(s)"
-msgstr ""
-
-#: UI/GTK2/src/WorkerThreads.cpp:1114
-msgid "Couldn't unindex document(s)"
-msgstr ""
-
-#: UI/GTK2/src/WorkerThreads.cpp:1206
-msgid "Stopped document update for "
-msgstr ""
-
-#: UI/GTK2/src/WorkerThreads.cpp:1243
-msgid "Couldn't update document"
-msgstr ""
-
-#: UI/GTK2/src/WorkerThreads.cpp:1293
-msgid "Stopped listening on"
-msgstr ""
-
-#: UI/GTK2/src/WorkerThreads.cpp:1396
-msgid "Couldn't read FIFO at"
-msgstr ""
-
-#: UI/GTK2/src/WorkerThreads.cpp:1446
-msgid "Stopped monitoring"
-msgstr ""
-
-#: UI/GTK2/src/WorkerThreads.cpp:1467
-msgid "No monitoring handler"
-msgstr ""
-
-#: UI/GTK2/src/WorkerThreads.cpp:1514
-msgid "Couldn't open FAM connection"
-msgstr ""
-
-#: UI/GTK2/src/WorkerThreads.cpp:1724
-msgid "Stopped scanning"
-msgstr ""
-
-#: UI/GTK2/src/WorkerThreads.cpp:1882
-msgid "Couldn't open directory"
-msgstr ""

Modified: trunk/po/es.po
===================================================================
--- trunk/po/es.po	2006-03-20 12:21:30 UTC (rev 163)
+++ trunk/po/es.po	2006-03-20 13:34:49 UTC (rev 164)
@@ -8,7 +8,7 @@
 msgstr ""
 "Project-Id-Version: pinot 0.43\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2006-03-08 22:19+0800\n"
+"POT-Creation-Date: 2006-03-20 21:33+0800\n"
 "PO-Revision-Date: 2006-01-30 16:44+0800\n"
 "Last-Translator: Jes?s Tramullas <jesus at tramullas.com>\n"
 "Language-Team: es <jesus at tramullas.com>\n"
@@ -24,19 +24,20 @@
 msgid "Current User"
 msgstr "Usuario"
 
-#: UI/GTK2/src/mainWindow.cc:375 UI/GTK2/src/mainWindow.cc:545
-#: UI/GTK2/src/mainWindow.cc:1010 UI/GTK2/src/mainWindow.cc:1097
-#: UI/GTK2/src/mainWindow.cc:1132 UI/GTK2/src/mainWindow.cc:1741
-#: UI/GTK2/src/PinotSettings.cpp:199 UI/GTK2/src/PinotSettings.cpp:854
-#: UI/GTK2/src/PinotSettings.cpp:910
+#: UI/GTK2/src/EnginesTree.cpp:303 UI/GTK2/src/mainWindow.cc:371
+#: UI/GTK2/src/mainWindow.cc:374 UI/GTK2/src/mainWindow.cc:544
+#: UI/GTK2/src/mainWindow.cc:1009 UI/GTK2/src/mainWindow.cc:1063
+#: UI/GTK2/src/mainWindow.cc:1082 UI/GTK2/src/mainWindow.cc:1117
+#: UI/GTK2/src/mainWindow.cc:1698 UI/GTK2/src/PinotSettings.cpp:201
+#: UI/GTK2/src/PinotSettings.cpp:909 UI/GTK2/src/PinotSettings.cpp:965
 msgid "My Documents"
 msgstr "Mis documentos"
 
-#: UI/GTK2/src/EnginesTree.cpp:307 UI/GTK2/src/mainWindow.cc:378
-#: UI/GTK2/src/mainWindow.cc:381 UI/GTK2/src/mainWindow.cc:549
-#: UI/GTK2/src/MonitorHandler.cpp:173 UI/GTK2/src/PinotSettings.cpp:200
-#: UI/GTK2/src/PinotSettings.cpp:855 UI/GTK2/src/PinotSettings.cpp:911
-#: UI/GTK2/src/prefsDialog_glade.cc:110
+#: UI/GTK2/src/EnginesTree.cpp:307 UI/GTK2/src/mainWindow.cc:377
+#: UI/GTK2/src/mainWindow.cc:380 UI/GTK2/src/mainWindow.cc:548
+#: UI/GTK2/src/MonitorHandler.cpp:173 UI/GTK2/src/PinotSettings.cpp:202
+#: UI/GTK2/src/PinotSettings.cpp:910 UI/GTK2/src/PinotSettings.cpp:966
+#: UI/GTK2/src/prefsDialog_glade.cc:115
 msgid "My Email"
 msgstr "Mi email"
 
@@ -44,7 +45,7 @@
 msgid "Enabled"
 msgstr "Activo"
 
-#: UI/GTK2/src/importDialog.cc:109 UI/GTK2/src/prefsDialog.cc:78
+#: UI/GTK2/src/importDialog.cc:109 UI/GTK2/src/prefsDialog.cc:82
 msgid "MIME Type"
 msgstr "Tipo MIME"
 
@@ -56,8 +57,8 @@
 msgid "Directory"
 msgstr "Directorio"
 
-#: UI/GTK2/src/importDialog.cc:142 UI/GTK2/src/IndexTree.cpp:70
-#: UI/GTK2/src/ResultsTree.cpp:114
+#: UI/GTK2/src/importDialog.cc:142 UI/GTK2/src/IndexTree.cpp:69
+#: UI/GTK2/src/ResultsTree.cpp:119
 msgid "URL"
 msgstr "URL"
 
@@ -131,7 +132,7 @@
 msgid "Title"
 msgstr "T?tulo"
 
-#: UI/GTK2/src/IndexTree.cpp:75
+#: UI/GTK2/src/IndexTree.cpp:74
 msgid "Timestamp"
 msgstr "Fecha"
 
@@ -147,224 +148,224 @@
 msgid "All labels"
 msgstr "Todos etiquetas"
 
-#: UI/GTK2/src/mainWindow.cc:180
+#: UI/GTK2/src/mainWindow.cc:179
 msgid "Query Name"
 msgstr "Nombre de la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:185
+#: UI/GTK2/src/mainWindow.cc:184
 msgid "Last Run"
 msgstr "?ltima ejecuci?n"
 
-#: UI/GTK2/src/mainWindow.cc:186
+#: UI/GTK2/src/mainWindow.cc:185
 msgid "Summary"
 msgstr "Sumario"
 
-#: UI/GTK2/src/mainWindow.cc:246
+#: UI/GTK2/src/mainWindow.cc:245
 msgid "Add index"
 msgstr "A?adir ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:247
+#: UI/GTK2/src/mainWindow.cc:246
 msgid "Remove index"
 msgstr "Borrar ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:263
+#: UI/GTK2/src/mainWindow.cc:262
 msgid "Ready"
 msgstr "Listo"
 
-#: UI/GTK2/src/mainWindow.cc:277 UI/GTK2/src/mainWindow.cc:967
-#: UI/GTK2/src/mainWindow.cc:1334 UI/GTK2/src/mainWindow.cc:2920
+#: UI/GTK2/src/mainWindow.cc:276 UI/GTK2/src/mainWindow.cc:966
+#: UI/GTK2/src/mainWindow.cc:1291 UI/GTK2/src/mainWindow.cc:2867
 #: UI/GTK2/src/mainWindow_glade.cc:207
 msgid "View"
 msgstr "Ver"
 
-#: UI/GTK2/src/mainWindow.cc:309
+#: UI/GTK2/src/mainWindow.cc:308
 msgid "N/A"
 msgstr "Desconocido"
 
-#: UI/GTK2/src/mainWindow.cc:319
+#: UI/GTK2/src/mainWindow.cc:318
 msgid "<undefined>"
 msgstr "<indefinido>"
 
-#: UI/GTK2/src/mainWindow.cc:507
+#: UI/GTK2/src/mainWindow.cc:506
 msgid "Result location is"
 msgstr "La localizaci?n del resultado es"
 
-#: UI/GTK2/src/mainWindow.cc:560
+#: UI/GTK2/src/mainWindow.cc:559
 msgid "Document location is"
 msgstr "La localizaci?n del documento es"
 
-#: UI/GTK2/src/mainWindow.cc:812
+#: UI/GTK2/src/mainWindow.cc:811
 msgid "Showing"
 msgstr "Mostrando"
 
-#: UI/GTK2/src/mainWindow.cc:817
+#: UI/GTK2/src/mainWindow.cc:816
 msgid "off"
 msgstr "desactivado"
 
-#: UI/GTK2/src/mainWindow.cc:822
+#: UI/GTK2/src/mainWindow.cc:821
 msgid "documents, starting at"
 msgstr "documentos comenzando en"
 
-#: UI/GTK2/src/mainWindow.cc:856
+#: UI/GTK2/src/mainWindow.cc:855
 msgid "Query"
 msgstr "B?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:860 UI/GTK2/src/mainWindow.cc:2748
+#: UI/GTK2/src/mainWindow.cc:859 UI/GTK2/src/mainWindow.cc:2695
 msgid "on"
 msgstr "en"
 
-#: UI/GTK2/src/mainWindow.cc:864
+#: UI/GTK2/src/mainWindow.cc:863
 msgid "ended"
 msgstr "finalizado"
 
-#: UI/GTK2/src/mainWindow.cc:942
+#: UI/GTK2/src/mainWindow.cc:941
 msgid "Updated label(s)"
 msgstr "Etiqueta(s) actualizada(s)"
 
-#: UI/GTK2/src/mainWindow.cc:1020 UI/GTK2/src/mainWindow.cc:1143
+#: UI/GTK2/src/mainWindow.cc:1019 UI/GTK2/src/mainWindow.cc:1128
 msgid "Updated document"
 msgstr "Documento actualizado"
 
-#: UI/GTK2/src/mainWindow.cc:1036
+#: UI/GTK2/src/mainWindow.cc:1034
 msgid "Indexed"
 msgstr "Indizado"
 
-#: UI/GTK2/src/mainWindow.cc:1098
+#: UI/GTK2/src/mainWindow.cc:1083
 msgid "Unindexed document(s)"
 msgstr "Documento(s) no indizado(s)"
 
-#: UI/GTK2/src/mainWindow.cc:1190
+#: UI/GTK2/src/mainWindow.cc:1175
 msgid "Couldn't rename index, name"
 msgstr "No se podu renombrar el ?ndice, nombre"
 
-#: UI/GTK2/src/mainWindow.cc:1194 UI/GTK2/src/mainWindow.cc:2095
-#: UI/GTK2/src/mainWindow.cc:2582
+#: UI/GTK2/src/mainWindow.cc:1179 UI/GTK2/src/mainWindow.cc:2036
+#: UI/GTK2/src/mainWindow.cc:2529
 msgid "is already in use"
 msgstr "ya est? en uso"
 
-#: UI/GTK2/src/mainWindow.cc:1207
+#: UI/GTK2/src/mainWindow.cc:1192
 msgid "Couldn't rename index"
 msgstr "No se pudo renombrar el ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:1220
+#: UI/GTK2/src/mainWindow.cc:1205
 msgid "Edited index"
 msgstr "?ndice editado"
 
-#: UI/GTK2/src/mainWindow.cc:1680 UI/GTK2/src/mainWindow.cc:1783
+#: UI/GTK2/src/mainWindow.cc:1637 UI/GTK2/src/mainWindow.cc:1740
 msgid "Please set a location for the index first"
 msgstr "Por favor, primero fije una localizaci?n para el ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:1707
+#: UI/GTK2/src/mainWindow.cc:1664
 msgid "Result location is unknown"
 msgstr "Se desconoce la localizaci?n del resultado"
 
-#: UI/GTK2/src/mainWindow.cc:1731
+#: UI/GTK2/src/mainWindow.cc:1688
 msgid "Import Document(s)"
 msgstr "Importar Documento(s)"
 
-#: UI/GTK2/src/mainWindow.cc:1861 UI/GTK2/src/WorkerThreads.cpp:392
-#: UI/GTK2/src/WorkerThreads.cpp:1108
+#: UI/GTK2/src/mainWindow.cc:1818 UI/GTK2/src/WorkerThreads.cpp:392
+#: UI/GTK2/src/WorkerThreads.cpp:1114
 msgid "Index"
 msgstr "?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:1865 UI/GTK2/src/WorkerThreads.cpp:396
-#: UI/GTK2/src/WorkerThreads.cpp:1112
+#: UI/GTK2/src/mainWindow.cc:1822 UI/GTK2/src/WorkerThreads.cpp:396
+#: UI/GTK2/src/WorkerThreads.cpp:1118
 msgid "doesn't exist"
 msgstr "no existe"
 
-#: UI/GTK2/src/mainWindow.cc:1975
+#: UI/GTK2/src/mainWindow.cc:1916
 msgid "Delete this document from the index ?"
 msgstr "Enlever ce document de l'index ?"
 
-#: UI/GTK2/src/mainWindow.cc:1994
+#: UI/GTK2/src/mainWindow.cc:1935
 msgid "Delete these documents from the index ?"
 msgstr "?Borrar este documento del ?ndice?"
 
-#: UI/GTK2/src/mainWindow.cc:2046
+#: UI/GTK2/src/mainWindow.cc:1987
 msgid "A metasearch tool for the Free Desktop"
 msgstr "Una herramienta metabuscador para el escritorio libre"
 
-#: UI/GTK2/src/mainWindow.cc:2047
+#: UI/GTK2/src/mainWindow.cc:1988
 msgid "(C) 2005-2006 Fabrice Colin"
 msgstr "(C) 2005-2006 Fabrice Colin"
 
-#: UI/GTK2/src/mainWindow.cc:2091
+#: UI/GTK2/src/mainWindow.cc:2032
 msgid "Index name"
 msgstr "Nombre del ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2106
+#: UI/GTK2/src/mainWindow.cc:2047
 msgid "Couldn't add index"
 msgstr "No se pudo a?adir el ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2120
+#: UI/GTK2/src/mainWindow.cc:2061
 msgid "Added new index"
 msgstr "A?adido un nuevo ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2155
+#: UI/GTK2/src/mainWindow.cc:2096
 msgid "Couldn't remove index"
 msgstr "No se pudo borrar el ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2244
+#: UI/GTK2/src/mainWindow.cc:2191
 msgid "Live query"
 msgstr "B?squeda editada"
 
-#: UI/GTK2/src/mainWindow.cc:2397
+#: UI/GTK2/src/mainWindow.cc:2344
 msgid "At least one task hasn't completed yet. Quit now ?"
 msgstr "Al menos una tarea no ha finalizado. ?Parar ahora?"
 
-#: UI/GTK2/src/mainWindow.cc:2578
+#: UI/GTK2/src/mainWindow.cc:2525
 msgid "Query name"
 msgstr "Nombre la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:2605
+#: UI/GTK2/src/mainWindow.cc:2552
 msgid "Couldn't update query"
 msgstr "No se pudo actualizar la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:2613
+#: UI/GTK2/src/mainWindow.cc:2560
 msgid "Edited query"
 msgstr "B?squeda editada"
 
-#: UI/GTK2/src/mainWindow.cc:2620
+#: UI/GTK2/src/mainWindow.cc:2567
 msgid "Couldn't add query"
 msgstr "No se pudo a?adir la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:2628
+#: UI/GTK2/src/mainWindow.cc:2575
 msgid "Added new query"
 msgstr "A?adida una nueva b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:2642
+#: UI/GTK2/src/mainWindow.cc:2589
 msgid "Query is not set"
 msgstr "B?squeda no definida"
 
-#: UI/GTK2/src/mainWindow.cc:2653
+#: UI/GTK2/src/mainWindow.cc:2600
 msgid "No search engine selected"
 msgstr "Motor de b?squeda no seleccionado"
 
-#: UI/GTK2/src/mainWindow.cc:2735
+#: UI/GTK2/src/mainWindow.cc:2682
 msgid "Please set the Google API key first"
 msgstr "Por favor, primero configure el API de Google"
 
-#: UI/GTK2/src/mainWindow.cc:2744
+#: UI/GTK2/src/mainWindow.cc:2691
 msgid "Running query"
 msgstr "Ejecutando la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:2851
+#: UI/GTK2/src/mainWindow.cc:2798
 msgid "is already indexed or is being indexed"
 msgstr "ya ha sido indizado, o se est? indizando"
 
-#: UI/GTK2/src/mainWindow.cc:2878
+#: UI/GTK2/src/mainWindow.cc:2825
 msgid "No URL to browse"
 msgstr "No hay URL que mostrar"
 
-#: UI/GTK2/src/mainWindow.cc:2889
+#: UI/GTK2/src/mainWindow.cc:2836
 msgid "No browser configured to view results"
 msgstr "NO ha configurado un navegador para ver los resultados"
 
-#: UI/GTK2/src/mainWindow.cc:2901
+#: UI/GTK2/src/mainWindow.cc:2848
 msgid "Couldn't browse URL:"
 msgstr "No se pudo mostrar el URL:"
 
-#: UI/GTK2/src/mainWindow.cc:2960
+#: UI/GTK2/src/mainWindow.cc:2907
 msgid "Viewing"
 msgstr "Ver"
 
@@ -516,84 +517,60 @@
 msgid "Couldn't create history database"
 msgstr "No se pudo crear un directorio pinot en"
 
-#: UI/GTK2/src/PinotSettings.cpp:106
+#: UI/GTK2/src/PinotSettings.cpp:108
 msgid "Couldn't create pinot directory at"
 msgstr "No se pudo crear un directorio pinot en"
 
-#: UI/GTK2/src/PinotSettings.cpp:195
+#: UI/GTK2/src/PinotSettings.cpp:197
 msgid "Failed to parse configuration file"
 msgstr "Fallo en el fichero de configuraci?n"
 
-#: UI/GTK2/src/PinotSettings.cpp:204
+#: UI/GTK2/src/PinotSettings.cpp:206
 #, fuzzy
 msgid "Important"
 msgstr "Importante"
 
-#: UI/GTK2/src/PinotSettings.cpp:205
+#: UI/GTK2/src/PinotSettings.cpp:207
 msgid "New"
 msgstr "Nuevo"
 
-#: UI/GTK2/src/PinotSettings.cpp:206
+#: UI/GTK2/src/PinotSettings.cpp:208
 msgid "Personal"
 msgstr "Personal"
 
-#: UI/GTK2/src/PinotSettings.cpp:286
-msgid "Couldn't load ui block"
-msgstr "No se pudo cargar el bloque ui"
-
-#: UI/GTK2/src/PinotSettings.cpp:293
-msgid "Couldn't load extraindex block"
-msgstr "No se pudo cargar el bloque extraindex"
-
-#: UI/GTK2/src/PinotSettings.cpp:300
-msgid "Couldn't load storedquery block"
-msgstr "No se pudo cargar el bloque storedquery"
-
-#: UI/GTK2/src/PinotSettings.cpp:307
-msgid "Couldn't load results block"
-msgstr "o se pudo cargar el bloque results"
-
-#: UI/GTK2/src/PinotSettings.cpp:314
-msgid "Couldn't load label block"
-msgstr "o se pudo cargar el bloque label"
-
-#: UI/GTK2/src/PinotSettings.cpp:332
-msgid "Couldn't load mailaccount block"
-msgstr "No se pudo cargar el bloque mailaccount"
-
-#: UI/GTK2/src/PinotSettings.cpp:340
+#: UI/GTK2/src/PinotSettings.cpp:339
 msgid "Couldn't parse configuration file"
 msgstr "No se pudo procesar el fichero de configuraci?n"
 
-#: UI/GTK2/src/PinotSettings.cpp:711
+#: UI/GTK2/src/PinotSettings.cpp:752
 msgid "Unclassified"
 msgstr "No clasificado"
 
-#: UI/GTK2/src/prefsDialog.cc:69
+#: UI/GTK2/src/prefsDialog.cc:73
 msgid "Name"
 msgstr "Nombre"
 
-#: UI/GTK2/src/prefsDialog.cc:77
+#: UI/GTK2/src/prefsDialog.cc:81
 msgid "Location"
 msgstr "Localizaci?n"
 
-#: UI/GTK2/src/prefsDialog.cc:114
+#: UI/GTK2/src/prefsDialog.cc:118
 msgid "In internal viewer"
 msgstr "En el visor interno"
 
-#: UI/GTK2/src/prefsDialog.cc:117
+#: UI/GTK2/src/prefsDialog.cc:121
 msgid "In browser"
 msgstr "En el navegador"
 
-#: UI/GTK2/src/prefsDialog.cc:323
+#: UI/GTK2/src/prefsDialog.cc:329
 msgid "Browser location"
 msgstr "Mostrar la localizaci?n"
 
-#: UI/GTK2/src/prefsDialog.cc:334
+#: UI/GTK2/src/prefsDialog.cc:340
 msgid "New Label"
 msgstr "Nueva etiqueta"
 
-#: UI/GTK2/src/prefsDialog.cc:386 UI/GTK2/src/prefsDialog.cc:420
+#: UI/GTK2/src/prefsDialog.cc:392 UI/GTK2/src/prefsDialog.cc:426
 msgid "Mbox File Location"
 msgstr "Localizaci?n del fichero mbox"
 
@@ -617,31 +594,45 @@
 msgid "Ignore robots.txt and Robots META tag"
 msgstr "Ignorar robots.txt y la etiqueta META Robots"
 
+#: UI/GTK2/src/prefsDialog_glade.cc:73
+#, fuzzy
+msgid "New results:"
+msgstr "Nuevos resultados:"
+
 #: UI/GTK2/src/prefsDialog_glade.cc:74
+#, fuzzy
+msgid "Queries:"
+msgstr "B?squeda:"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:75
+msgid "Enable search terms suggestion"
+msgstr ""
+
+#: UI/GTK2/src/prefsDialog_glade.cc:79
 msgid "General"
 msgstr "General"
 
-#: UI/GTK2/src/prefsDialog_glade.cc:75
+#: UI/GTK2/src/prefsDialog_glade.cc:80
 msgid "Labels are used to classify indexed documents:"
 msgstr "Las etiquetas se usan para clasificar los documentos indizados:"
 
-#: UI/GTK2/src/prefsDialog_glade.cc:80 UI/GTK2/src/prefsDialog_glade.cc:100
+#: UI/GTK2/src/prefsDialog_glade.cc:85 UI/GTK2/src/prefsDialog_glade.cc:105
 msgid "Add"
 msgstr "A?adir"
 
-#: UI/GTK2/src/prefsDialog_glade.cc:86
+#: UI/GTK2/src/prefsDialog_glade.cc:91
 msgid "Remove"
 msgstr "Borrar"
 
-#: UI/GTK2/src/prefsDialog_glade.cc:94
+#: UI/GTK2/src/prefsDialog_glade.cc:99
 msgid "Labels"
 msgstr "Etiquetas"
 
-#: UI/GTK2/src/prefsDialog_glade.cc:95
+#: UI/GTK2/src/prefsDialog_glade.cc:100
 msgid "Mail boxes of type mbox can be monitored and indexed:"
 msgstr "Lo sbuzones de correo de tipo mbox pueden ser controlados e indizados"
 
-#: UI/GTK2/src/prefsDialog_glade.cc:309
+#: UI/GTK2/src/prefsDialog_glade.cc:335
 msgid "Preferences"
 msgstr "Preferencias"
 
@@ -727,7 +718,7 @@
 
 #: UI/GTK2/src/WorkerThreads.cpp:404 UI/GTK2/src/WorkerThreads.cpp:602
 #: UI/GTK2/src/WorkerThreads.cpp:611 UI/GTK2/src/WorkerThreads.cpp:800
-#: UI/GTK2/src/WorkerThreads.cpp:1001 UI/GTK2/src/WorkerThreads.cpp:1120
+#: UI/GTK2/src/WorkerThreads.cpp:1007 UI/GTK2/src/WorkerThreads.cpp:1126
 msgid "Index error on"
 msgstr "Error en el ?ndice"
 
@@ -783,46 +774,64 @@
 msgid "Robots META tag forbids indexing"
 msgstr "La etiqueta META Robots proh?be la indizaci?n"
 
-#: UI/GTK2/src/WorkerThreads.cpp:934
+#: UI/GTK2/src/WorkerThreads.cpp:940
 msgid "Couldn't index"
 msgstr "No se pudo indizar"
 
-#: UI/GTK2/src/WorkerThreads.cpp:989
+#: UI/GTK2/src/WorkerThreads.cpp:995
 msgid "Stopped unindexing document(s)"
 msgstr "Detenida la desindizaci?n de documento(s)"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1008
+#: UI/GTK2/src/WorkerThreads.cpp:1014
 msgid "Couldn't unindex document(s)"
 msgstr "No se pudo desindizar lo(s) documento(s)"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1093
+#: UI/GTK2/src/WorkerThreads.cpp:1099
 msgid "Stopped document update for"
 msgstr "Detenida la actualizaci?n del documento por"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1128
+#: UI/GTK2/src/WorkerThreads.cpp:1134
 msgid "Couldn't update document"
 msgstr "No se pudo actualizar el documento"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1178
+#: UI/GTK2/src/WorkerThreads.cpp:1184
 msgid "Stopped monitoring"
 msgstr "Detenida la monitorizaci?n"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1199
+#: UI/GTK2/src/WorkerThreads.cpp:1205
 msgid "No monitoring handler"
 msgstr "No hay monitorizaci?n"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1242
+#: UI/GTK2/src/WorkerThreads.cpp:1248
 msgid "Couldn't open FAM connection"
 msgstr "No se pudo abrir la conexi?n FAM"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1441
+#: UI/GTK2/src/WorkerThreads.cpp:1447
 msgid "Stopped scanning"
 msgstr "Detenida la exploraci?n"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1599
+#: UI/GTK2/src/WorkerThreads.cpp:1605
 msgid "Couldn't open directory"
 msgstr "No se pudo abrir el directorio"
 
+#~ msgid "Couldn't load ui block"
+#~ msgstr "No se pudo cargar el bloque ui"
+
+#~ msgid "Couldn't load extraindex block"
+#~ msgstr "No se pudo cargar el bloque extraindex"
+
+#~ msgid "Couldn't load storedquery block"
+#~ msgstr "No se pudo cargar el bloque storedquery"
+
+#~ msgid "Couldn't load results block"
+#~ msgstr "o se pudo cargar el bloque results"
+
+#~ msgid "Couldn't load label block"
+#~ msgstr "o se pudo cargar el bloque label"
+
+#~ msgid "Couldn't load mailaccount block"
+#~ msgstr "No se pudo cargar el bloque mailaccount"
+
 #~ msgid "Red"
 #~ msgstr "Rojo"
 

Modified: trunk/po/fr.po
===================================================================
--- trunk/po/fr.po	2006-03-20 12:21:30 UTC (rev 163)
+++ trunk/po/fr.po	2006-03-20 13:34:49 UTC (rev 164)
@@ -8,7 +8,7 @@
 msgstr ""
 "Project-Id-Version: pinot 0.43\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2006-03-08 22:19+0800\n"
+"POT-Creation-Date: 2006-03-20 21:33+0800\n"
 "PO-Revision-Date: 2006-01-20 19:44+0800\n"
 "Last-Translator: Fabrice Colin <colinf at chez.com>\n"
 "Language-Team: fr <colinf at chez.com>\n"
@@ -24,20 +24,20 @@
 msgid "Current User"
 msgstr "Utilisateur"
 
-#: UI/GTK2/src/EnginesTree.cpp:303 UI/GTK2/src/mainWindow.cc:372
-#: UI/GTK2/src/mainWindow.cc:375 UI/GTK2/src/mainWindow.cc:545
-#: UI/GTK2/src/mainWindow.cc:1010 UI/GTK2/src/mainWindow.cc:1097
-#: UI/GTK2/src/mainWindow.cc:1132 UI/GTK2/src/mainWindow.cc:1741
-#: UI/GTK2/src/PinotSettings.cpp:199 UI/GTK2/src/PinotSettings.cpp:854
-#: UI/GTK2/src/PinotSettings.cpp:910
+#: UI/GTK2/src/EnginesTree.cpp:303 UI/GTK2/src/mainWindow.cc:371
+#: UI/GTK2/src/mainWindow.cc:374 UI/GTK2/src/mainWindow.cc:544
+#: UI/GTK2/src/mainWindow.cc:1009 UI/GTK2/src/mainWindow.cc:1063
+#: UI/GTK2/src/mainWindow.cc:1082 UI/GTK2/src/mainWindow.cc:1117
+#: UI/GTK2/src/mainWindow.cc:1698 UI/GTK2/src/PinotSettings.cpp:201
+#: UI/GTK2/src/PinotSettings.cpp:909 UI/GTK2/src/PinotSettings.cpp:965
 msgid "My Documents"
 msgstr "Mes Documents"
 
-#: UI/GTK2/src/EnginesTree.cpp:307 UI/GTK2/src/mainWindow.cc:378
-#: UI/GTK2/src/mainWindow.cc:381 UI/GTK2/src/mainWindow.cc:549
-#: UI/GTK2/src/MonitorHandler.cpp:173 UI/GTK2/src/PinotSettings.cpp:200
-#: UI/GTK2/src/PinotSettings.cpp:855 UI/GTK2/src/PinotSettings.cpp:911
-#: UI/GTK2/src/prefsDialog_glade.cc:110
+#: UI/GTK2/src/EnginesTree.cpp:307 UI/GTK2/src/mainWindow.cc:377
+#: UI/GTK2/src/mainWindow.cc:380 UI/GTK2/src/mainWindow.cc:548
+#: UI/GTK2/src/MonitorHandler.cpp:173 UI/GTK2/src/PinotSettings.cpp:202
+#: UI/GTK2/src/PinotSettings.cpp:910 UI/GTK2/src/PinotSettings.cpp:966
+#: UI/GTK2/src/prefsDialog_glade.cc:115
 msgid "My Email"
 msgstr "Mon Courrier"
 
@@ -45,7 +45,7 @@
 msgid "Enabled"
 msgstr "Active"
 
-#: UI/GTK2/src/importDialog.cc:109 UI/GTK2/src/prefsDialog.cc:78
+#: UI/GTK2/src/importDialog.cc:109 UI/GTK2/src/prefsDialog.cc:82
 msgid "MIME Type"
 msgstr "Type MIME"
 
@@ -57,8 +57,8 @@
 msgid "Directory"
 msgstr "Repertoire"
 
-#: UI/GTK2/src/importDialog.cc:142 UI/GTK2/src/IndexTree.cpp:70
-#: UI/GTK2/src/ResultsTree.cpp:114
+#: UI/GTK2/src/importDialog.cc:142 UI/GTK2/src/IndexTree.cpp:69
+#: UI/GTK2/src/ResultsTree.cpp:119
 msgid "URL"
 msgstr "URL"
 
@@ -72,7 +72,7 @@
 
 #: UI/GTK2/src/importDialog_glade.cc:66 UI/GTK2/src/indexDialog_glade.cc:68
 msgid "Location:"
-msgstr "Location:"
+msgstr "Chemin:"
 
 #: UI/GTK2/src/importDialog_glade.cc:67
 #: UI/GTK2/src/propertiesDialog_glade.cc:64
@@ -114,7 +114,7 @@
 
 #: UI/GTK2/src/indexDialog.cc:221
 msgid "Index location"
-msgstr "Location de l'index"
+msgstr "Chemin de l'index"
 
 #: UI/GTK2/src/indexDialog_glade.cc:62 UI/GTK2/src/queryDialog_glade.cc:60
 msgid "Name:"
@@ -132,7 +132,7 @@
 msgid "Title"
 msgstr "Titre"
 
-#: UI/GTK2/src/IndexTree.cpp:75
+#: UI/GTK2/src/IndexTree.cpp:74
 msgid "Timestamp"
 msgstr "Date"
 
@@ -149,224 +149,224 @@
 msgid "All labels"
 msgstr "Toutes les etiquettes"
 
-#: UI/GTK2/src/mainWindow.cc:180
+#: UI/GTK2/src/mainWindow.cc:179
 msgid "Query Name"
 msgstr "Nom de la Recherche"
 
-#: UI/GTK2/src/mainWindow.cc:185
+#: UI/GTK2/src/mainWindow.cc:184
 msgid "Last Run"
 msgstr "Derniere Utilisation"
 
-#: UI/GTK2/src/mainWindow.cc:186
+#: UI/GTK2/src/mainWindow.cc:185
 msgid "Summary"
 msgstr "Sommaire"
 
-#: UI/GTK2/src/mainWindow.cc:246
+#: UI/GTK2/src/mainWindow.cc:245
 msgid "Add index"
 msgstr "Ajouter un index"
 
-#: UI/GTK2/src/mainWindow.cc:247
+#: UI/GTK2/src/mainWindow.cc:246
 msgid "Remove index"
 msgstr "Enlever un index"
 
-#: UI/GTK2/src/mainWindow.cc:263
+#: UI/GTK2/src/mainWindow.cc:262
 msgid "Ready"
 msgstr "Pret"
 
-#: UI/GTK2/src/mainWindow.cc:277 UI/GTK2/src/mainWindow.cc:967
-#: UI/GTK2/src/mainWindow.cc:1334 UI/GTK2/src/mainWindow.cc:2920
+#: UI/GTK2/src/mainWindow.cc:276 UI/GTK2/src/mainWindow.cc:966
+#: UI/GTK2/src/mainWindow.cc:1291 UI/GTK2/src/mainWindow.cc:2867
 #: UI/GTK2/src/mainWindow_glade.cc:207
 msgid "View"
 msgstr "Voir"
 
-#: UI/GTK2/src/mainWindow.cc:309
+#: UI/GTK2/src/mainWindow.cc:308
 msgid "N/A"
 msgstr "Inconnue"
 
-#: UI/GTK2/src/mainWindow.cc:319
+#: UI/GTK2/src/mainWindow.cc:318
 msgid "<undefined>"
 msgstr "<inconnu>"
 
-#: UI/GTK2/src/mainWindow.cc:507
+#: UI/GTK2/src/mainWindow.cc:506
 msgid "Result location is"
-msgstr "La location du resultat est"
+msgstr "Le chemin du resultat est"
 
-#: UI/GTK2/src/mainWindow.cc:560
+#: UI/GTK2/src/mainWindow.cc:559
 msgid "Document location is"
-msgstr "La location du document is"
+msgstr "Le chemin du document is"
 
-#: UI/GTK2/src/mainWindow.cc:812
+#: UI/GTK2/src/mainWindow.cc:811
 msgid "Showing"
 msgstr "Listant"
 
-#: UI/GTK2/src/mainWindow.cc:817
+#: UI/GTK2/src/mainWindow.cc:816
 msgid "off"
 msgstr "documents,"
 
-#: UI/GTK2/src/mainWindow.cc:822
+#: UI/GTK2/src/mainWindow.cc:821
 msgid "documents, starting at"
 msgstr "au total, a partir de"
 
-#: UI/GTK2/src/mainWindow.cc:856
+#: UI/GTK2/src/mainWindow.cc:855
 msgid "Query"
 msgstr "La recherche"
 
-#: UI/GTK2/src/mainWindow.cc:860 UI/GTK2/src/mainWindow.cc:2748
+#: UI/GTK2/src/mainWindow.cc:859 UI/GTK2/src/mainWindow.cc:2695
 msgid "on"
 msgstr "sur"
 
-#: UI/GTK2/src/mainWindow.cc:864
+#: UI/GTK2/src/mainWindow.cc:863
 msgid "ended"
 msgstr "est terminee"
 
-#: UI/GTK2/src/mainWindow.cc:942
+#: UI/GTK2/src/mainWindow.cc:941
 msgid "Updated label(s)"
 msgstr "Mis a jour l(es) etiquette(s)"
 
-#: UI/GTK2/src/mainWindow.cc:1020 UI/GTK2/src/mainWindow.cc:1143
+#: UI/GTK2/src/mainWindow.cc:1019 UI/GTK2/src/mainWindow.cc:1128
 msgid "Updated document"
 msgstr "Mis a jour le document"
 
-#: UI/GTK2/src/mainWindow.cc:1036
+#: UI/GTK2/src/mainWindow.cc:1034
 msgid "Indexed"
 msgstr "Indexe"
 
-#: UI/GTK2/src/mainWindow.cc:1098
+#: UI/GTK2/src/mainWindow.cc:1083
 msgid "Unindexed document(s)"
 msgstr "Desindexe le(s) document(s)"
 
-#: UI/GTK2/src/mainWindow.cc:1190
+#: UI/GTK2/src/mainWindow.cc:1175
 msgid "Couldn't rename index, name"
 msgstr "N'a pas pu renommer l'index, le nom"
 
-#: UI/GTK2/src/mainWindow.cc:1194 UI/GTK2/src/mainWindow.cc:2095
-#: UI/GTK2/src/mainWindow.cc:2582
+#: UI/GTK2/src/mainWindow.cc:1179 UI/GTK2/src/mainWindow.cc:2036
+#: UI/GTK2/src/mainWindow.cc:2529
 msgid "is already in use"
 msgstr "est deja utilise"
 
-#: UI/GTK2/src/mainWindow.cc:1207
+#: UI/GTK2/src/mainWindow.cc:1192
 msgid "Couldn't rename index"
 msgstr "N'a pas pu renommer l'index"
 
-#: UI/GTK2/src/mainWindow.cc:1220
+#: UI/GTK2/src/mainWindow.cc:1205
 msgid "Edited index"
 msgstr "Edite l'index"
 
-#: UI/GTK2/src/mainWindow.cc:1680 UI/GTK2/src/mainWindow.cc:1783
+#: UI/GTK2/src/mainWindow.cc:1637 UI/GTK2/src/mainWindow.cc:1740
 msgid "Please set a location for the index first"
-msgstr "Donnez une location a l'index"
+msgstr "Donnez un chemin a l'index"
 
-#: UI/GTK2/src/mainWindow.cc:1707
+#: UI/GTK2/src/mainWindow.cc:1664
 msgid "Result location is unknown"
-msgstr "La location du resultat est inconnue"
+msgstr "Le chemin du resultat est inconnu"
 
-#: UI/GTK2/src/mainWindow.cc:1731
+#: UI/GTK2/src/mainWindow.cc:1688
 msgid "Import Document(s)"
 msgstr "Import de Document(s)"
 
-#: UI/GTK2/src/mainWindow.cc:1861 UI/GTK2/src/WorkerThreads.cpp:392
-#: UI/GTK2/src/WorkerThreads.cpp:1108
+#: UI/GTK2/src/mainWindow.cc:1818 UI/GTK2/src/WorkerThreads.cpp:392
+#: UI/GTK2/src/WorkerThreads.cpp:1114
 msgid "Index"
 msgstr "L'index"
 
-#: UI/GTK2/src/mainWindow.cc:1865 UI/GTK2/src/WorkerThreads.cpp:396
-#: UI/GTK2/src/WorkerThreads.cpp:1112
+#: UI/GTK2/src/mainWindow.cc:1822 UI/GTK2/src/WorkerThreads.cpp:396
+#: UI/GTK2/src/WorkerThreads.cpp:1118
 msgid "doesn't exist"
 msgstr "n'existe pas"
 
-#: UI/GTK2/src/mainWindow.cc:1975
+#: UI/GTK2/src/mainWindow.cc:1916
 msgid "Delete this document from the index ?"
 msgstr "Enlever ce document de l'index ?"
 
-#: UI/GTK2/src/mainWindow.cc:1994
+#: UI/GTK2/src/mainWindow.cc:1935
 msgid "Delete these documents from the index ?"
 msgstr "Enlever ces documents de l'index ?"
 
-#: UI/GTK2/src/mainWindow.cc:2046
+#: UI/GTK2/src/mainWindow.cc:1987
 msgid "A metasearch tool for the Free Desktop"
 msgstr "Un outil de recherche pour le Bureau Libre"
 
-#: UI/GTK2/src/mainWindow.cc:2047
+#: UI/GTK2/src/mainWindow.cc:1988
 msgid "(C) 2005-2006 Fabrice Colin"
 msgstr "(C) 2005-2006 Fabrice Colin"
 
-#: UI/GTK2/src/mainWindow.cc:2091
+#: UI/GTK2/src/mainWindow.cc:2032
 msgid "Index name"
 msgstr "Nom de l'index"
 
-#: UI/GTK2/src/mainWindow.cc:2106
+#: UI/GTK2/src/mainWindow.cc:2047
 msgid "Couldn't add index"
 msgstr "N'a pas pu ajouter l'index"
 
-#: UI/GTK2/src/mainWindow.cc:2120
+#: UI/GTK2/src/mainWindow.cc:2061
 msgid "Added new index"
 msgstr "Ajoute un nouvel index"
 
-#: UI/GTK2/src/mainWindow.cc:2155
+#: UI/GTK2/src/mainWindow.cc:2096
 msgid "Couldn't remove index"
 msgstr "N'a pas pu enlever l'index"
 
-#: UI/GTK2/src/mainWindow.cc:2244
+#: UI/GTK2/src/mainWindow.cc:2191
 msgid "Live query"
 msgstr "Recherche"
 
-#: UI/GTK2/src/mainWindow.cc:2397
+#: UI/GTK2/src/mainWindow.cc:2344
 msgid "At least one task hasn't completed yet. Quit now ?"
 msgstr "Au moins une tache n'est pas terminee. Quitter maintenant ?"
 
-#: UI/GTK2/src/mainWindow.cc:2578
+#: UI/GTK2/src/mainWindow.cc:2525
 msgid "Query name"
 msgstr "Nom de la recherche"
 
-#: UI/GTK2/src/mainWindow.cc:2605
+#: UI/GTK2/src/mainWindow.cc:2552
 msgid "Couldn't update query"
 msgstr "N'a pas pu mettre a jour la recherche"
 
-#: UI/GTK2/src/mainWindow.cc:2613
+#: UI/GTK2/src/mainWindow.cc:2560
 msgid "Edited query"
 msgstr "Edite la recherche"
 
-#: UI/GTK2/src/mainWindow.cc:2620
+#: UI/GTK2/src/mainWindow.cc:2567
 msgid "Couldn't add query"
 msgstr "N'a pas pu ajouter la recherche"
 
-#: UI/GTK2/src/mainWindow.cc:2628
+#: UI/GTK2/src/mainWindow.cc:2575
 msgid "Added new query"
 msgstr "Ajoute une nouvelle recherche"
 
-#: UI/GTK2/src/mainWindow.cc:2642
+#: UI/GTK2/src/mainWindow.cc:2589
 msgid "Query is not set"
 msgstr "Recherche indefinie"
 
-#: UI/GTK2/src/mainWindow.cc:2653
+#: UI/GTK2/src/mainWindow.cc:2600
 msgid "No search engine selected"
 msgstr "Pas de moteur selectionne"
 
-#: UI/GTK2/src/mainWindow.cc:2735
+#: UI/GTK2/src/mainWindow.cc:2682
 msgid "Please set the Google API key first"
 msgstr "Configurez la clef de l'API Google "
 
-#: UI/GTK2/src/mainWindow.cc:2744
+#: UI/GTK2/src/mainWindow.cc:2691
 msgid "Running query"
 msgstr "Recherche en cours"
 
-#: UI/GTK2/src/mainWindow.cc:2851
+#: UI/GTK2/src/mainWindow.cc:2798
 msgid "is already indexed or is being indexed"
 msgstr "est deja indexe ou est en cours d'indexation"
 
-#: UI/GTK2/src/mainWindow.cc:2878
+#: UI/GTK2/src/mainWindow.cc:2825
 msgid "No URL to browse"
 msgstr "Pas d'URL a brouter"
 
-#: UI/GTK2/src/mainWindow.cc:2889
+#: UI/GTK2/src/mainWindow.cc:2836
 msgid "No browser configured to view results"
 msgstr "Pas de brouter configure"
 
-#: UI/GTK2/src/mainWindow.cc:2901
+#: UI/GTK2/src/mainWindow.cc:2848
 msgid "Couldn't browse URL:"
 msgstr "N'a pas pu brouter l'URL"
 
-#: UI/GTK2/src/mainWindow.cc:2960
+#: UI/GTK2/src/mainWindow.cc:2907
 msgid "Viewing"
 msgstr "Voir"
 
@@ -516,85 +516,61 @@
 msgid "Couldn't create history database"
 msgstr "N'a pas pu creer la base d'historiques"
 
-#: UI/GTK2/src/PinotSettings.cpp:106
+#: UI/GTK2/src/PinotSettings.cpp:108
 msgid "Couldn't create pinot directory at"
 msgstr "N'a pas pu creer le repertoire a"
 
-#: UI/GTK2/src/PinotSettings.cpp:195
+#: UI/GTK2/src/PinotSettings.cpp:197
 msgid "Failed to parse configuration file"
 msgstr "N'a pas pu lire le fichier de configuration"
 
-#: UI/GTK2/src/PinotSettings.cpp:204
+#: UI/GTK2/src/PinotSettings.cpp:206
 msgid "Important"
 msgstr "Important"
 
-#: UI/GTK2/src/PinotSettings.cpp:205
+#: UI/GTK2/src/PinotSettings.cpp:207
 msgid "New"
 msgstr "Nouveau"
 
-#: UI/GTK2/src/PinotSettings.cpp:206
+#: UI/GTK2/src/PinotSettings.cpp:208
 msgid "Personal"
 msgstr "Personnel"
 
-#: UI/GTK2/src/PinotSettings.cpp:286
-msgid "Couldn't load ui block"
-msgstr "N'a pas pu charger le bloc ui"
-
-#: UI/GTK2/src/PinotSettings.cpp:293
-msgid "Couldn't load extraindex block"
-msgstr "N'a pas pu charger le bloc extraindex"
-
-#: UI/GTK2/src/PinotSettings.cpp:300
-msgid "Couldn't load storedquery block"
-msgstr "N'a pas pu charger le bloc storedquery"
-
-#: UI/GTK2/src/PinotSettings.cpp:307
-msgid "Couldn't load results block"
-msgstr "N'a pas pu charger le bloc results"
-
-#: UI/GTK2/src/PinotSettings.cpp:314
-msgid "Couldn't load label block"
-msgstr "N'a pas pu charger le bloc label"
-
-#: UI/GTK2/src/PinotSettings.cpp:332
-msgid "Couldn't load mailaccount block"
-msgstr "N'a pas pu charger le bloc mailaccount"
-
-#: UI/GTK2/src/PinotSettings.cpp:340
+#: UI/GTK2/src/PinotSettings.cpp:339
 msgid "Couldn't parse configuration file"
 msgstr "N'a pas pu lire le fichier de configuration"
 
-#: UI/GTK2/src/PinotSettings.cpp:711
+#: UI/GTK2/src/PinotSettings.cpp:752
 msgid "Unclassified"
 msgstr "Sans classification"
 
-#: UI/GTK2/src/prefsDialog.cc:69
+#: UI/GTK2/src/prefsDialog.cc:73
 msgid "Name"
 msgstr "Nom"
 
-#: UI/GTK2/src/prefsDialog.cc:77
+#: UI/GTK2/src/prefsDialog.cc:81
 msgid "Location"
-msgstr "Location"
+msgstr "Chemin"
 
-#: UI/GTK2/src/prefsDialog.cc:114
+#: UI/GTK2/src/prefsDialog.cc:118
 msgid "In internal viewer"
 msgstr "Dans le brouteur interne"
 
-#: UI/GTK2/src/prefsDialog.cc:117
+#: UI/GTK2/src/prefsDialog.cc:121
 msgid "In browser"
 msgstr "Dans le brouteur"
 
-#: UI/GTK2/src/prefsDialog.cc:323
+#: UI/GTK2/src/prefsDialog.cc:329
 msgid "Browser location"
-msgstr "Location du brouteur"
+msgstr "Chemin du brouteur"
 
-#: UI/GTK2/src/prefsDialog.cc:334
+#: UI/GTK2/src/prefsDialog.cc:340
 msgid "New Label"
 msgstr "Nouvelle Etiquette"
 
-#: UI/GTK2/src/prefsDialog.cc:386 UI/GTK2/src/prefsDialog.cc:420
+#: UI/GTK2/src/prefsDialog.cc:392 UI/GTK2/src/prefsDialog.cc:426
 msgid "Mbox File Location"
-msgstr "Location du Fichier mbox"
+msgstr "Chemin du Fichier mbox"
 
 #: UI/GTK2/src/prefsDialog_glade.cc:62
 msgid "HTTP crawling:"
@@ -616,31 +592,45 @@
 msgid "Ignore robots.txt and Robots META tag"
 msgstr "Ignorer robots.txt et le META tag Robots"
 
+#: UI/GTK2/src/prefsDialog_glade.cc:73
+#, fuzzy
+msgid "New results:"
+msgstr "Nouveaux resultats:"
+
 #: UI/GTK2/src/prefsDialog_glade.cc:74
+#, fuzzy
+msgid "Queries:"
+msgstr "Recherches:"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:75
+msgid "Enable search terms suggestion"
+msgstr "Suggerer des termes"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:79
 msgid "General"
 msgstr "General"
 
-#: UI/GTK2/src/prefsDialog_glade.cc:75
+#: UI/GTK2/src/prefsDialog_glade.cc:80
 msgid "Labels are used to classify indexed documents:"
 msgstr "Les etiquettes servent a classer les documents:"
 
-#: UI/GTK2/src/prefsDialog_glade.cc:80 UI/GTK2/src/prefsDialog_glade.cc:100
+#: UI/GTK2/src/prefsDialog_glade.cc:85 UI/GTK2/src/prefsDialog_glade.cc:105
 msgid "Add"
 msgstr "Ajouter"
 
-#: UI/GTK2/src/prefsDialog_glade.cc:86
+#: UI/GTK2/src/prefsDialog_glade.cc:91
 msgid "Remove"
 msgstr "Enlever"
 
-#: UI/GTK2/src/prefsDialog_glade.cc:94
+#: UI/GTK2/src/prefsDialog_glade.cc:99
 msgid "Labels"
 msgstr "Etiquettes"
 
-#: UI/GTK2/src/prefsDialog_glade.cc:95
+#: UI/GTK2/src/prefsDialog_glade.cc:100
 msgid "Mail boxes of type mbox can be monitored and indexed:"
 msgstr "Les boites de type mbox peuvent etre indexees"
 
-#: UI/GTK2/src/prefsDialog_glade.cc:309
+#: UI/GTK2/src/prefsDialog_glade.cc:335
 msgid "Preferences"
 msgstr "Preferences"
 
@@ -726,7 +716,7 @@
 
 #: UI/GTK2/src/WorkerThreads.cpp:404 UI/GTK2/src/WorkerThreads.cpp:602
 #: UI/GTK2/src/WorkerThreads.cpp:611 UI/GTK2/src/WorkerThreads.cpp:800
-#: UI/GTK2/src/WorkerThreads.cpp:1001 UI/GTK2/src/WorkerThreads.cpp:1120
+#: UI/GTK2/src/WorkerThreads.cpp:1007 UI/GTK2/src/WorkerThreads.cpp:1126
 msgid "Index error on"
 msgstr "Erreur sur l'index"
 
@@ -782,42 +772,60 @@
 msgid "Robots META tag forbids indexing"
 msgstr "Le META tag Robots empeche d'indexer"
 
-#: UI/GTK2/src/WorkerThreads.cpp:934
+#: UI/GTK2/src/WorkerThreads.cpp:940
 msgid "Couldn't index"
 msgstr "N'a pas pu indexer"
 
-#: UI/GTK2/src/WorkerThreads.cpp:989
+#: UI/GTK2/src/WorkerThreads.cpp:995
 msgid "Stopped unindexing document(s)"
 msgstr "Arrete d'indexer les document(s)"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1008
+#: UI/GTK2/src/WorkerThreads.cpp:1014
 msgid "Couldn't unindex document(s)"
 msgstr "N'a pas pu desindexer le(s) document(s)"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1093
+#: UI/GTK2/src/WorkerThreads.cpp:1099
 msgid "Stopped document update for"
 msgstr "Arrete la mise a jour pour"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1128
+#: UI/GTK2/src/WorkerThreads.cpp:1134
 msgid "Couldn't update document"
 msgstr "N'a pas pu mettre a jour le document"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1178
+#: UI/GTK2/src/WorkerThreads.cpp:1184
 msgid "Stopped monitoring"
 msgstr "Arrete la surveillance"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1199
+#: UI/GTK2/src/WorkerThreads.cpp:1205
 msgid "No monitoring handler"
 msgstr "Pas de moniteur"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1242
+#: UI/GTK2/src/WorkerThreads.cpp:1248
 msgid "Couldn't open FAM connection"
 msgstr "N'a pas pu ouvrir la connection FAM"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1441
+#: UI/GTK2/src/WorkerThreads.cpp:1447
 msgid "Stopped scanning"
 msgstr "Arrete de scanner"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1599
+#: UI/GTK2/src/WorkerThreads.cpp:1605
 msgid "Couldn't open directory"
 msgstr "N'a pas pu ovrir le repertoire"
+
+#~ msgid "Couldn't load ui block"
+#~ msgstr "N'a pas pu charger le bloc ui"
+
+#~ msgid "Couldn't load extraindex block"
+#~ msgstr "N'a pas pu charger le bloc extraindex"
+
+#~ msgid "Couldn't load storedquery block"
+#~ msgstr "N'a pas pu charger le bloc storedquery"
+
+#~ msgid "Couldn't load results block"
+#~ msgstr "N'a pas pu charger le bloc results"
+
+#~ msgid "Couldn't load label block"
+#~ msgstr "N'a pas pu charger le bloc label"
+
+#~ msgid "Couldn't load mailaccount block"
+#~ msgstr "N'a pas pu charger le bloc mailaccount"



From fabricecolin at berlios.de  Mon Mar 20 15:58:24 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Mon, 20 Mar 2006 15:58:24 +0100
Subject: [Pinot-svn] r166 - trunk/UI/GTK2/src
Message-ID: <200603201458.k2KEwOKu007618@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-20 15:58:23 +0100 (Mon, 20 Mar 2006)
New Revision: 166

Modified:
   trunk/UI/GTK2/src/WorkerThreads.cpp
Log:
Call FAMClose() only if FAMOpen() returned successfully. This prevents a exit
time crash on Ubuntu 5.10.


Modified: trunk/UI/GTK2/src/WorkerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.cpp	2006-03-20 13:36:14 UTC (rev 165)
+++ trunk/UI/GTK2/src/WorkerThreads.cpp	2006-03-20 14:58:23 UTC (rev 166)
@@ -1197,7 +1197,7 @@
 	struct stat fileStat;
 	bool setLocationsToMonitor = true;
 	bool firstTime = true;
-	bool resumeMonitor = false;
+	bool closeMonitor = false, resumeMonitor = false;
 	int famStatus = -1;
 
 	if (m_pHandler == NULL)
@@ -1248,6 +1248,7 @@
 				m_status = _("Couldn't open FAM connection");
 				return;
 			}
+			closeMonitor = true;
 
 			// Go through the locations map
 			for (map<unsigned long, string>::const_iterator fsIter = fsLocations.begin(); fsIter != fsLocations.end(); ++fsIter)
@@ -1409,9 +1410,12 @@
 		}
 	}
 
-	// Stop monitoring and close the connection
-	FAMCancelMonitor(&famConn, &famReq);
-	FAMClose(&famConn);
+	if (closeMonitor == true)
+	{
+		// Stop monitoring and close the connection
+		FAMCancelMonitor(&famConn, &famReq);
+		FAMClose(&famConn);
+	}
 }
 
 DirectoryScannerThread::DirectoryScannerThread(const string &dirName,



From fabricecolin at berlios.de  Tue Mar 21 13:41:50 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Tue, 21 Mar 2006 13:41:50 +0100
Subject: [Pinot-svn] r168 - trunk
Message-ID: <200603211241.k2LCfoIO031463@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-21 13:41:40 +0100 (Tue, 21 Mar 2006)
New Revision: 168

Modified:
   trunk/pinot.spec.in
Log:
Acoona.src was renamed.


Modified: trunk/pinot.spec.in
===================================================================
--- trunk/pinot.spec.in	2006-03-21 11:33:09 UTC (rev 167)
+++ trunk/pinot.spec.in	2006-03-21 12:41:40 UTC (rev 168)
@@ -87,7 +87,7 @@
 %{_datadir}/pinot/*.src
 %dir %{_datadir}/pinot/engines/
 %config(noreplace) %{_datadir}/pinot/engines/A9.src
-%config(noreplace) %{_datadir}/pinot/engines/Acoona.src
+%config(noreplace) %{_datadir}/pinot/engines/Accoona.src
 %config(noreplace) %{_datadir}/pinot/engines/Ask.src
 %config(noreplace) %{_datadir}/pinot/engines/BitTorrent.src
 %config(noreplace) %{_datadir}/pinot/engines/Clusty.src



From fabricecolin at berlios.de  Tue Mar 21 15:36:55 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Tue, 21 Mar 2006 15:36:55 +0100
Subject: [Pinot-svn] r169 - trunk/Search
Message-ID: <200603211436.k2LEatg4027054@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-21 15:36:42 +0100 (Tue, 21 Mar 2006)
New Revision: 169

Modified:
   trunk/Search/SherlockParser.cpp
Log:
Parsing may throw exceptions.


Modified: trunk/Search/SherlockParser.cpp
===================================================================
--- trunk/Search/SherlockParser.cpp	2006-03-21 12:41:40 UTC (rev 168)
+++ trunk/Search/SherlockParser.cpp	2006-03-21 14:36:42 UTC (rev 169)
@@ -501,35 +501,53 @@
 
 	map<string, string> searchParams, interpretParams, inputItems;
 	string userInput, nextInput, nextFactor, nextValue;
-	skip_grammar skip;
 	bool fullParsing = false;
 
+	if (pthread_mutex_lock(&m_mutex) == 0)
+	{
 #ifdef DEBUG
-	cout << "SherlockParser::parse: starting" << endl;
+		cout << "SherlockParser::parse: parsing" << endl;
 #endif
-	if (pthread_mutex_lock(&m_mutex) == 0)
-	{
-		if (extractSearchParams == false)
+		try
 		{
-			plugin_grammar plugin(searchParams, interpretParams, inputItems,
-				userInput, nextInput, nextFactor, nextValue);
+			if (extractSearchParams == false)
+			{
+				skip_grammar skip;
+				plugin_grammar plugin(searchParams, interpretParams, inputItems,
+					userInput, nextInput, nextFactor, nextValue);
 
-			parse_info<> parseInfo = boost::spirit::parse(pData, plugin, skip);
-			fullParsing = parseInfo.full;
+				parse_info<> parseInfo = boost::spirit::parse(pData, plugin, skip);
+				fullParsing = parseInfo.full;
+			}
+			else
+			{
+				skip_grammar skip;
+				plugin_min_grammar plugin(searchParams);
+
+				parse_info<> parseInfo = boost::spirit::parse(pData, plugin, skip);
+				fullParsing = parseInfo.full;
+			}
 		}
-		else
+		catch (const exception &e)
 		{
-			plugin_min_grammar plugin(searchParams);
-
-			parse_info<> parseInfo = boost::spirit::parse(pData, plugin, skip);
-			fullParsing = parseInfo.full;
+#ifdef DEBUG
+			cout << "SherlockParser::parse: caught exception ! " << e.what() << endl;
+#endif
+			fullParsing = false;
 		}
+		catch (...)
+		{
+#ifdef DEBUG
+			cout << "SherlockParser::parse: caught unknown exception !" << endl;
+#endif
+			fullParsing = false;
+		}
 
+#ifdef DEBUG
+		cout << "SherlockParser::parse: parsed" << endl;
+#endif
 		pthread_mutex_unlock(&m_mutex);
 	}
-#ifdef DEBUG
-	cout << "SherlockParser::parse: done" << endl;
-#endif
 
 	// We are done with the document
 	delete pPluginDoc;



From fabricecolin at berlios.de  Wed Mar 22 17:05:11 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Wed, 22 Mar 2006 17:05:11 +0100
Subject: [Pinot-svn] r170 - in trunk: . Collect Tokenize UI/RenderHTML Utils
Message-ID: <200603221605.k2MG5Bi3030581@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-22 17:05:10 +0100 (Wed, 22 Mar 2006)
New Revision: 170

Modified:
   trunk/Collect/Makefile.am
   trunk/Tokenize/Makefile.am
   trunk/UI/RenderHTML/MozillaRenderer.cpp
   trunk/Utils/Makefile.am
   trunk/configure.in
   trunk/pinot.spec.in
Log:
Various fixes for building on Fedora Core 5.


Modified: trunk/Collect/Makefile.am
===================================================================
--- trunk/Collect/Makefile.am	2006-03-21 14:36:42 UTC (rev 169)
+++ trunk/Collect/Makefile.am	2006-03-22 16:05:10 UTC (rev 170)
@@ -1,12 +1,11 @@
 # Process this file with automake to produce Makefile.in
 
 noinst_HEADERS = \
-	CurlDownloader.h \
+	@HTTP_DOWNLOADER at .h \
 	DownloaderFactory.h \
 	DownloaderInterface.h \
 	FileCollector.h \
 	MboxCollector.h \
-	NeonDownloader.h \
 	XapianCollector.h
 
 noinst_LTLIBRARIES = libCollect.la
@@ -21,12 +20,11 @@
 	@INDEX_LIBS@ @XML_LIBS@ @MIME_LIBS@ @HTTP_LIBS@ @MISC_LIBS@
 
 libCollect_la_SOURCES = \
-	CurlDownloader.cpp \
+	@HTTP_DOWNLOADER at .cpp \
 	DownloaderFactory.cpp \
 	DownloaderInterface.cpp \
 	FileCollector.cpp \
 	MboxCollector.cpp \
-	NeonDownloader.cpp \
 	XapianCollector.cpp
 
 AM_CXXFLAGS = -I../Utils -I../Tokenize \

Modified: trunk/Tokenize/Makefile.am
===================================================================
--- trunk/Tokenize/Makefile.am	2006-03-21 14:36:42 UTC (rev 169)
+++ trunk/Tokenize/Makefile.am	2006-03-22 16:05:10 UTC (rev 170)
@@ -52,5 +52,5 @@
 	TokenizerFactory.cpp \
 	UnknownTypeTokenizer.cpp
 
-AM_CXXFLAGS = -I../Utils
+AM_CXXFLAGS = -fPIC -I../Utils
 

Modified: trunk/UI/RenderHTML/MozillaRenderer.cpp
===================================================================
--- trunk/UI/RenderHTML/MozillaRenderer.cpp	2006-03-21 14:36:42 UTC (rev 169)
+++ trunk/UI/RenderHTML/MozillaRenderer.cpp	2006-03-22 16:05:10 UTC (rev 170)
@@ -15,9 +15,15 @@
  */
  
 #include <iostream>
+#ifdef HAS_MOZILLA_NSS
 #include <nspr/nspr.h>
 #include <nss/nss.h>
 #include <nss/ssl.h>
+#else
+#include <nspr.h>
+#include <nss.h>
+#include <ssl.h>
+#endif
 #include <gtkmozembed.h>
 
 #include "MozillaRenderer.h"

Modified: trunk/Utils/Makefile.am
===================================================================
--- trunk/Utils/Makefile.am	2006-03-21 14:36:42 UTC (rev 169)
+++ trunk/Utils/Makefile.am	2006-03-22 16:05:10 UTC (rev 170)
@@ -35,5 +35,5 @@
 	Url.cpp \
 	XapianDatabaseFactory.cpp
 
-AM_CXXFLAGS = @HTTP_CFLAGS@ @INDEX_CFLAGS@ @MIME_CFLAGS@
+AM_CXXFLAGS = -fPIC @HTTP_CFLAGS@ @INDEX_CFLAGS@ @MIME_CFLAGS@
 

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2006-03-21 14:36:42 UTC (rev 169)
+++ trunk/configure.in	2006-03-22 16:05:10 UTC (rev 170)
@@ -26,7 +26,7 @@
 
 dnl Add the languages which your application supports here.
 ALL_LINGUAS="fr es"
-AM_GNU_GETTEXT([external]) 
+#AM_GNU_GETTEXT([external]) 
 AM_GLIB_GNU_GETTEXT
 
 dnl Set PACKAGE_LOCALE_DIR in config.h.
@@ -74,6 +74,7 @@
 PKG_CHECK_MODULES(NEON, neon >= 0.24 )
 PKG_CHECK_MODULES(SSL, openssl >= 0.9.7 )
 HTTP_LIBRARY="USE_NEON"
+HTTP_DOWNLOADER="NeonDownloader"
 ;;
 curl)
 AC_PATH_PROG(CURL_CONFIG, curl-config, no)
@@ -84,9 +85,21 @@
 CURL_CFLAGS=`$CURL_CONFIG --cflags`
 CURL_LIBS=`$CURL_CONFIG --libs`
 HTTP_LIBRARY="USE_CURL"
+HTTP_DOWNLOADER="CurlDownloader"
 ;;
 esac
+AC_SUBST(HTTP_DOWNLOADER)
 
+dnl Mozilla NSS and NSPR
+AC_PATH_PROG(NSS_CONFIG, nss-config, no)
+if test "$NSS_CONFIG" = "no" ; then
+   PKG_CHECK_MODULES(MOZILLANS, mozilla-nss >= 1.4 mozilla-nspr >= 1.4)
+   MOZILLA_NS_DIR="HAS_MOZILLA_NSS"
+else
+   PKG_CHECK_MODULES(MOZILLANS, nss >= 1.4 nspr >= 1.4)
+   MOZILLA_NS_DIR="HAS_NSS"
+fi
+
 dnl Other libraries
 MISC_LIBS="-lmagic -lcrypt"
 AC_SUBST(MISC_LIBS)
@@ -108,15 +121,16 @@
 INDEX_LIBS="$XAPIAN_LIBS -ltextcat"
 AC_SUBST(INDEX_CFLAGS)
 AC_SUBST(INDEX_LIBS)
-PKG_CHECK_MODULES(UI, mozilla-xpcom >= 1.4 mozilla-nss >= 1.4 mozilla-gtkmozembed >= 1.4 gtkmm-2.4 >= 2.6 )
+PKG_CHECK_MODULES(UI, mozilla-xpcom >= 1.4 mozilla-gtkmozembed >= 1.4 gtkmm-2.4 >= 2.6 )
 dnl Location of Mozilla's library directory
 MOZILLA_GTKEMBED=`find /usr/lib*/mozilla* -name libgtkembedmoz.so | head -1`
 if test "$MOZILLA_GTKEMBED" = "" ; then
   MOZILLA_LIB_DIR=/usr/lib/mozilla
 else
-  MOZILLA_LIB_DIR=`dirname ${MOZILLA_GTKEMBED}`
+  MOZILLA_LIB_DIR=`dirname $MOZILLA_GTKEMBED`
 fi
-UI_LIBS="-lpthread -lfam -L${MOZILLA_LIB_DIR} -Xlinker -rpath -Xlinker ${MOZILLA_LIB_DIR} $UI_LIBS"
+UI_CFLAGS="$MOZILLANS_CFLAGS -D$MOZILLA_NS_DIR $UI_CFLAGS"
+UI_LIBS="-lpthread -lfam -L$MOZILLA_LIB_DIR -Xlinker -rpath -Xlinker $MOZILLA_LIB_DIR $UI_LIBS $MOZILLANS_LIBS"
 AC_SUBST(UI_CFLAGS)
 AC_SUBST(UI_LIBS)
 

Modified: trunk/pinot.spec.in
===================================================================
--- trunk/pinot.spec.in	2006-03-21 14:36:42 UTC (rev 169)
+++ trunk/pinot.spec.in	2006-03-22 16:05:10 UTC (rev 170)
@@ -1,6 +1,6 @@
 # @configure_input@
 # We need an explicit dependency on mozilla as the so files don't have a version number 
-%define mozilla_ver %(/usr/bin/mozilla-config --version)
+%define mozilla_ver %(pkg-config --modversion mozilla-gtkmozembed)
 
 Summary: Metasearch tool
 Name: @PACKAGE@
@@ -12,7 +12,7 @@
 URL: http://pinot.berlios.de/
 BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
 Requires: xapian-core-libs >= 0.9.4, curl >= 7.13, gtkmm24 >= 2.6, libxml++ >= 2.12, mozilla >= %{mozilla_ver}, sqlite >= 3.1.2, libtextcat >= 2.2, fam >= 2.6.10, gmime >= 2.1, file
-BuildRequires: xapian-core-devel >= 0.9.4, curl-devel >= 7.13, gtkmm24-devel >= 2.6, libxml++-devel >= 2.12, mozilla-devel >= %{mozilla_ver}, sqlite-devel >= 3.1.2, libtextcat-devel >= 2.2, fam-devel >= 2.6.10, gmime-devel >= 2.1, file, boost-devel >= 1.32, desktop-file-utils
+BuildRequires: xapian-core-devel >= 0.9.4, curl-devel >= 7.13, gtkmm24-devel >= 2.6, libxml++-devel >= 2.12, mozilla-devel >= %{mozilla_ver}, sqlite-devel >= 3.1.2, libtextcat-devel >= 2.2, fam-devel >= 2.6.10, gmime-devel >= 2.1, file, boost-devel >= 1.32, gettext-devel, desktop-file-utils
 
 %description
 Pinot is a metasearch tool for the Free Desktop. It enables one to query



From fabricecolin at berlios.de  Thu Mar 23 16:33:02 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Thu, 23 Mar 2006 16:33:02 +0100
Subject: [Pinot-svn] r171 - trunk
Message-ID: <200603231533.k2NFX222031743@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-23 16:33:02 +0100 (Thu, 23 Mar 2006)
New Revision: 171

Modified:
   trunk/NEWS
   trunk/TODO
   trunk/pinot.spec.in
Log:
Misc updates.
In the spec file, set a requirement on /usr/bin/pdftohtml as it is provided
by poppler-utils on FC5 and pdftohtml on FC4.


Modified: trunk/NEWS
===================================================================
--- trunk/NEWS	2006-03-22 16:05:10 UTC (rev 170)
+++ trunk/NEWS	2006-03-23 15:33:02 UTC (rev 171)
@@ -1,4 +1,6 @@
 ??? version_0_4_5
+Build :
+ - various fixes for building on Fedora Core 5
 Index :
  - listing a label's documents displays the correct documents count in the status bar
   and navigation buttons are enabled or disabled accordingly
@@ -9,6 +11,8 @@
  - added RollYO's Top News, Exalead and Creative Commons sources
  - fixed results extraction with Topix
 UI :
+ - when no email boxes were being monitored, Pinot could crash at exit time
+  depending on which version of FAM was used
  - suggestion of query terms can be disabled
  - new results are now shown with a background colour of the user's choice
 

Modified: trunk/TODO
===================================================================
--- trunk/TODO	2006-03-22 16:05:10 UTC (rev 170)
+++ trunk/TODO	2006-03-23 15:33:02 UTC (rev 171)
@@ -1,7 +1,7 @@
 General
 - Fix the FIXMEs
 - Get rid of dead code/classes/methods...
-- Advertise service via Rendezvous with Howl (http://www.porchdogsoft.com/products/howl/)
+- Advertise service via Rendezvous
 - Man page, see help2man (http://www.gnu.org/software/help2man/)
 - Logging should not be all (DEBUG) or nothing (release)
 - Check for leaks with valgrind (eg --tool=memcheck -v --leak-check=yes --show-reachable=yes ...)
@@ -45,7 +45,6 @@
 - Flush the index before searching not after modification
 - Hash document data to determine on updates whether documents have changed
 - Allow to monitor imported documents for changes
-- With non local protocols, allow to skip pages whose domain match the search engine's
 
 Browser plugin
 - Write Firefox extension that searches Pinot indexes and indexes the cache

Modified: trunk/pinot.spec.in
===================================================================
--- trunk/pinot.spec.in	2006-03-22 16:05:10 UTC (rev 170)
+++ trunk/pinot.spec.in	2006-03-23 15:33:02 UTC (rev 171)
@@ -23,7 +23,7 @@
 Summary: Tokenizers for Pinot that handle various text document formats
 Group: Applications/Internet
 Requires: %{name} = %{version}
-Requires: pdftohtml, antiword, unrtf
+Requires: /usr/bin/pdftohtml, antiword, unrtf
 Obsoletes: pinot-pdf, pinot-word
 
 %description text-docs 



From fabricecolin at berlios.de  Fri Mar 24 01:39:55 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Fri, 24 Mar 2006 01:39:55 +0100
Subject: [Pinot-svn] r172 - trunk/UI/GTK2/src
Message-ID: <200603240039.k2O0dtBR018753@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-24 01:39:39 +0100 (Fri, 24 Mar 2006)
New Revision: 172

Modified:
   trunk/UI/GTK2/src/ResultsTree.cpp
Log:
Put status icons in a separate column so that the "new result" colour applies
to the whole Title column.


Modified: trunk/UI/GTK2/src/ResultsTree.cpp
===================================================================
--- trunk/UI/GTK2/src/ResultsTree.cpp	2006-03-23 15:33:02 UTC (rev 171)
+++ trunk/UI/GTK2/src/ResultsTree.cpp	2006-03-24 00:39:39 UTC (rev 172)
@@ -92,8 +92,8 @@
 	m_refStore = TreeStore::create(m_resultsColumns);
 	set_model(m_refStore);
 
-	// The title column is also used for status icons
-	TreeViewColumn *treeColumn = new TreeViewColumn(_("Title"));
+	// The first column is for status icons
+	TreeViewColumn *treeColumn = new TreeViewColumn("");
 	// Pack an icon renderer for the viewed status
 	CellRendererPixbuf *iconRenderer = new CellRendererPixbuf();
 	treeColumn->pack_start(*manage(iconRenderer), false);
@@ -106,8 +106,11 @@
 	iconRenderer = new CellRendererPixbuf();
 	treeColumn->pack_start(*manage(iconRenderer), false);
 	treeColumn->set_cell_data_func(*iconRenderer, SigC::slot(*this, &ResultsTree::renderRanking));
-	// And a last one for text
-	// ...followed by a text renderer
+	treeColumn->set_resizable(true);
+	append_column(*manage(treeColumn));
+
+	// This is the title column
+	treeColumn = new TreeViewColumn(_("Title"));
 	CellRendererText *textCellRenderer = new CellRendererText();
 	treeColumn->pack_start(*manage(textCellRenderer));
 	treeColumn->set_cell_data_func(*textCellRenderer, SigC::slot(*this, &ResultsTree::renderBackgroundColour));



From fabricecolin at berlios.de  Fri Mar 24 13:10:40 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Fri, 24 Mar 2006 13:10:40 +0100
Subject: [Pinot-svn] r173 - in trunk: Index Search
Message-ID: <200603241210.k2OCAegF013199@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-24 13:10:00 +0100 (Fri, 24 Mar 2006)
New Revision: 173

Modified:
   trunk/Index/XapianIndex.cpp
   trunk/Search/AbstractGenerator.cpp
Log:
R-prefix terms that start with a capital letter and skip all prefixed terms
when generating the abstract.


Modified: trunk/Index/XapianIndex.cpp
===================================================================
--- trunk/Index/XapianIndex.cpp	2006-03-24 00:39:39 UTC (rev 172)
+++ trunk/Index/XapianIndex.cpp	2006-03-24 12:10:00 UTC (rev 173)
@@ -22,6 +22,7 @@
 #include <stdarg.h>
 #include <strings.h>
 #include <time.h>
+#include <ctype.h>
 #include <regex.h>
 #include <iostream>
 #include <fstream>
@@ -127,6 +128,12 @@
 		{
 			continue;
 		}
+		// Does it start with a capital letter ?
+		if (isupper((int)term[0]) != 0)
+		{
+			// R-prefix the raw term
+			doc.add_posting(string("R") + term, termPos);
+		}
 		// Lower case the term
 		term = StringManip::toLowerCase(term);
 

Modified: trunk/Search/AbstractGenerator.cpp
===================================================================
--- trunk/Search/AbstractGenerator.cpp	2006-03-24 00:39:39 UTC (rev 172)
+++ trunk/Search/AbstractGenerator.cpp	2006-03-24 12:10:00 UTC (rev 173)
@@ -15,6 +15,7 @@
  */
 
 #include <string.h>
+#include <ctype.h>
 #include <sys/time.h>
 #include <map>
 #include <iostream>
@@ -169,16 +170,27 @@
 	for (Xapian::TermIterator termIter = m_pIndex->termlist_begin(docId);
 		termIter != m_pIndex->termlist_end(docId); ++termIter)
 	{
-		for (Xapian::PositionIterator positionIter = m_pIndex->positionlist_begin(docId, *termIter);
-			positionIter != m_pIndex->positionlist_end(docId, *termIter); ++positionIter)
+		string termName(*termIter);
+
+		// Skip prefixed terms
+		if (isupper((int)termName[0]) != 0)
 		{
+#ifdef DEBUG
+			cout << "AbstractGenerator::generateAbstract: skipping " << termName << endl;
+#endif
+			continue;
+		}
+
+		for (Xapian::PositionIterator positionIter = m_pIndex->positionlist_begin(docId, termName);
+			positionIter != m_pIndex->positionlist_end(docId, termName); ++positionIter)
+		{
 			Xapian::termpos termPos = *positionIter;
 
 			// ...and get those that fall in the abstract window
 			if ((startPosition <= termPos + 1) &&
 				(termPos < startPosition + m_wordsCount))
 			{
-				wordsBuffer[termPos] = *termIter;
+				wordsBuffer[termPos] = termName;
 			}
 		}
 	}



From fabricecolin at berlios.de  Sat Mar 25 05:32:44 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Sat, 25 Mar 2006 05:32:44 +0100
Subject: [Pinot-svn] r174 - trunk/UI/GTK2/src
Message-ID: <200603250432.k2P4WiSQ010299@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-25 05:32:42 +0100 (Sat, 25 Mar 2006)
New Revision: 174

Modified:
   trunk/UI/GTK2/src/mainWindow.cc
Log:
When running a live query, we can use terms as andWords as index searches are
now multi-step. For search plugins, it won't make any difference.


Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2006-03-24 12:10:00 UTC (rev 173)
+++ trunk/UI/GTK2/src/mainWindow.cc	2006-03-25 04:32:42 UTC (rev 174)
@@ -2190,7 +2190,9 @@
 
 	queryProps.setName(_("Live query"));
 	// FIXME: parse the query string !
-	queryProps.setAnyWords(from_utf8(liveQueryEntry->get_text()));
+	// Since we perform multi-step searches on the index, we might as well start with ANDing terms
+	// For search plugins, this won't make a difference
+	queryProps.setAndWords(from_utf8(liveQueryEntry->get_text()));
 
 	run_search(queryProps);
 }
@@ -2200,6 +2202,8 @@
 //
 void mainWindow::on_addQueryButton_clicked()
 {
+	// Even though live queries terms are now ANDed together,
+	// use them as OR terms when creating a new stored query
 	QueryProperties queryProps = QueryProperties("", "", "", from_utf8(liveQueryEntry->get_text()), "");
 
 	edit_query(queryProps, true);



From fabricecolin at berlios.de  Sat Mar 25 05:41:51 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Sat, 25 Mar 2006 05:41:51 +0100
Subject: [Pinot-svn] r175 - in trunk: . po
Message-ID: <200603250441.k2P4fpsq013922@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-25 05:41:46 +0100 (Sat, 25 Mar 2006)
New Revision: 175

Modified:
   trunk/NEWS
   trunk/TODO
   trunk/configure.in
   trunk/pinot.spec.in
   trunk/po/es.po
   trunk/po/fr.po
Log:
Preparing for v0.45 release. Synced po files with source, updated new features
and todo lists.


Modified: trunk/NEWS
===================================================================
--- trunk/NEWS	2006-03-25 04:32:42 UTC (rev 174)
+++ trunk/NEWS	2006-03-25 04:41:46 UTC (rev 175)
@@ -1,4 +1,4 @@
-??? version_0_4_5
+2006/03/25 version_0_4_5
 Build :
  - various fixes for building on Fedora Core 5
 Index :
@@ -10,11 +10,15 @@
  - dropped Altavista and Lycos
  - added RollYO's Top News, Exalead and Creative Commons sources
  - fixed results extraction with Topix
+ - better URL extraction for those search engines that use redirectors, for
+  instance http://rds.yahoo.com/_ylt=.../**http%3a//some.website.com/here/index.html
+ - tweaked abstract generation
 UI :
  - when no email boxes were being monitored, Pinot could crash at exit time
   depending on which version of FAM was used
  - suggestion of query terms can be disabled
  - new results are now shown with a background colour of the user's choice
+ - since index searches are multi-stepped, live queries' terms are now ANDed together
 
 2006/03/12 version_0_4_4
 Build :

Modified: trunk/TODO
===================================================================
--- trunk/TODO	2006-03-25 04:32:42 UTC (rev 174)
+++ trunk/TODO	2006-03-25 04:41:46 UTC (rev 175)
@@ -45,6 +45,8 @@
 - Flush the index before searching not after modification
 - Hash document data to determine on updates whether documents have changed
 - Allow to monitor imported documents for changes
+- Flush after a properties update; not doing so seems to prevent abstract generation from working
+ correctly, as terms positions can't be obtained
 
 Browser plugin
 - Write Firefox extension that searches Pinot indexes and indexes the cache

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2006-03-25 04:32:42 UTC (rev 174)
+++ trunk/configure.in	2006-03-25 04:41:46 UTC (rev 175)
@@ -2,7 +2,7 @@
 # using glademm V2.6.0
 
 AC_PREREQ(2.50)
-AC_INIT(pinot, 0.44,[fabricecolin at users.berlios.de])
+AC_INIT(pinot, 0.45,[fabricecolin at users.berlios.de])
 AM_INIT_AUTOMAKE
 AC_CONFIG_HEADERS(config.h)
 

Modified: trunk/pinot.spec.in
===================================================================
--- trunk/pinot.spec.in	2006-03-25 04:32:42 UTC (rev 174)
+++ trunk/pinot.spec.in	2006-03-25 04:41:46 UTC (rev 175)
@@ -5,7 +5,7 @@
 Summary: Metasearch tool
 Name: @PACKAGE@
 Version: @VERSION@
-Release: 1
+Release: 1%{?dist}
 License: GPL
 Group: Applications/Internet 
 Source: %{name}-%{version}.tar.gz

Modified: trunk/po/es.po
===================================================================
--- trunk/po/es.po	2006-03-25 04:32:42 UTC (rev 174)
+++ trunk/po/es.po	2006-03-25 04:41:46 UTC (rev 175)
@@ -8,7 +8,7 @@
 msgstr ""
 "Project-Id-Version: pinot 0.43\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2006-03-21 19:33+0800\n"
+"POT-Creation-Date: 2006-03-25 12:40+0800\n"
 "PO-Revision-Date: 2006-01-30 16:44+0800\n"
 "Last-Translator: Jes?s Tramullas <jesus at tramullas.com>\n"
 "Language-Team: es <jesus at tramullas.com>\n"
@@ -58,7 +58,7 @@
 msgstr "Directorio"
 
 #: UI/GTK2/src/importDialog.cc:142 UI/GTK2/src/IndexTree.cpp:69
-#: UI/GTK2/src/ResultsTree.cpp:119
+#: UI/GTK2/src/ResultsTree.cpp:122
 msgid "URL"
 msgstr "URL"
 
@@ -128,7 +128,7 @@
 msgid "External index"
 msgstr "?ndice externo"
 
-#: UI/GTK2/src/IndexTree.cpp:64 UI/GTK2/src/ResultsTree.cpp:96
+#: UI/GTK2/src/IndexTree.cpp:64 UI/GTK2/src/ResultsTree.cpp:113
 msgid "Title"
 msgstr "T?tulo"
 
@@ -173,7 +173,7 @@
 msgstr "Listo"
 
 #: UI/GTK2/src/mainWindow.cc:276 UI/GTK2/src/mainWindow.cc:966
-#: UI/GTK2/src/mainWindow.cc:1291 UI/GTK2/src/mainWindow.cc:2867
+#: UI/GTK2/src/mainWindow.cc:1291 UI/GTK2/src/mainWindow.cc:2871
 #: UI/GTK2/src/mainWindow_glade.cc:207
 msgid "View"
 msgstr "Ver"
@@ -210,7 +210,7 @@
 msgid "Query"
 msgstr "B?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:859 UI/GTK2/src/mainWindow.cc:2695
+#: UI/GTK2/src/mainWindow.cc:859 UI/GTK2/src/mainWindow.cc:2699
 msgid "on"
 msgstr "en"
 
@@ -239,7 +239,7 @@
 msgstr "No se pudo renombrar ?ndice, nombre"
 
 #: UI/GTK2/src/mainWindow.cc:1179 UI/GTK2/src/mainWindow.cc:2036
-#: UI/GTK2/src/mainWindow.cc:2529
+#: UI/GTK2/src/mainWindow.cc:2533
 msgid "is already in use"
 msgstr "ya est? en uso"
 
@@ -309,63 +309,63 @@
 msgid "Live query"
 msgstr "B?squeda activa"
 
-#: UI/GTK2/src/mainWindow.cc:2344
+#: UI/GTK2/src/mainWindow.cc:2348
 msgid "At least one task hasn't completed yet. Quit now ?"
 msgstr "Al menos una tarea no ha finalizado. ?Parar ahora?"
 
-#: UI/GTK2/src/mainWindow.cc:2525
+#: UI/GTK2/src/mainWindow.cc:2529
 msgid "Query name"
 msgstr "Nombre la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:2552
+#: UI/GTK2/src/mainWindow.cc:2556
 msgid "Couldn't update query"
 msgstr "No se pudo actualizar la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:2560
+#: UI/GTK2/src/mainWindow.cc:2564
 msgid "Edited query"
 msgstr "B?squeda editada"
 
-#: UI/GTK2/src/mainWindow.cc:2567
+#: UI/GTK2/src/mainWindow.cc:2571
 msgid "Couldn't add query"
 msgstr "No se pudo a?adir la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:2575
+#: UI/GTK2/src/mainWindow.cc:2579
 msgid "Added new query"
 msgstr "A?adida una nueva b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:2589
+#: UI/GTK2/src/mainWindow.cc:2593
 msgid "Query is not set"
 msgstr "B?squeda no definida"
 
-#: UI/GTK2/src/mainWindow.cc:2600
+#: UI/GTK2/src/mainWindow.cc:2604
 msgid "No search engine selected"
 msgstr "Motor de b?squeda no seleccionado"
 
-#: UI/GTK2/src/mainWindow.cc:2682
+#: UI/GTK2/src/mainWindow.cc:2686
 msgid "Please set the Google API key first"
 msgstr "Por favor, primero configure el API de Google"
 
-#: UI/GTK2/src/mainWindow.cc:2691
+#: UI/GTK2/src/mainWindow.cc:2695
 msgid "Running query"
 msgstr "Ejecutando la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:2798
+#: UI/GTK2/src/mainWindow.cc:2802
 msgid "is already indexed or is being indexed"
 msgstr "ya ha sido indizado, o se est? indizando"
 
-#: UI/GTK2/src/mainWindow.cc:2825
+#: UI/GTK2/src/mainWindow.cc:2829
 msgid "No URL to browse"
 msgstr "No hay URL que mostrar"
 
-#: UI/GTK2/src/mainWindow.cc:2836
+#: UI/GTK2/src/mainWindow.cc:2840
 msgid "No browser configured to view results"
 msgstr "No ha configurado un navegador para ver los resultados"
 
-#: UI/GTK2/src/mainWindow.cc:2848
+#: UI/GTK2/src/mainWindow.cc:2852
 msgid "Couldn't browse URL:"
 msgstr "No se pudo mostrar el URL:"
 
-#: UI/GTK2/src/mainWindow.cc:2907
+#: UI/GTK2/src/mainWindow.cc:2911
 msgid "Viewing"
 msgstr "Ver"
 

Modified: trunk/po/fr.po
===================================================================
--- trunk/po/fr.po	2006-03-25 04:32:42 UTC (rev 174)
+++ trunk/po/fr.po	2006-03-25 04:41:46 UTC (rev 175)
@@ -8,7 +8,7 @@
 msgstr ""
 "Project-Id-Version: pinot 0.43\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2006-03-21 19:33+0800\n"
+"POT-Creation-Date: 2006-03-25 12:40+0800\n"
 "PO-Revision-Date: 2006-01-20 19:44+0800\n"
 "Last-Translator: Fabrice Colin <colinf at chez.com>\n"
 "Language-Team: fr <colinf at chez.com>\n"
@@ -58,7 +58,7 @@
 msgstr "Repertoire"
 
 #: UI/GTK2/src/importDialog.cc:142 UI/GTK2/src/IndexTree.cpp:69
-#: UI/GTK2/src/ResultsTree.cpp:119
+#: UI/GTK2/src/ResultsTree.cpp:122
 msgid "URL"
 msgstr "URL"
 
@@ -128,7 +128,7 @@
 msgid "External index"
 msgstr "Index externe"
 
-#: UI/GTK2/src/IndexTree.cpp:64 UI/GTK2/src/ResultsTree.cpp:96
+#: UI/GTK2/src/IndexTree.cpp:64 UI/GTK2/src/ResultsTree.cpp:113
 msgid "Title"
 msgstr "Titre"
 
@@ -173,7 +173,7 @@
 msgstr "Pret"
 
 #: UI/GTK2/src/mainWindow.cc:276 UI/GTK2/src/mainWindow.cc:966
-#: UI/GTK2/src/mainWindow.cc:1291 UI/GTK2/src/mainWindow.cc:2867
+#: UI/GTK2/src/mainWindow.cc:1291 UI/GTK2/src/mainWindow.cc:2871
 #: UI/GTK2/src/mainWindow_glade.cc:207
 msgid "View"
 msgstr "Voir"
@@ -210,7 +210,7 @@
 msgid "Query"
 msgstr "La recherche"
 
-#: UI/GTK2/src/mainWindow.cc:859 UI/GTK2/src/mainWindow.cc:2695
+#: UI/GTK2/src/mainWindow.cc:859 UI/GTK2/src/mainWindow.cc:2699
 msgid "on"
 msgstr "sur"
 
@@ -239,7 +239,7 @@
 msgstr "N'a pas pu renommer l'index, le nom"
 
 #: UI/GTK2/src/mainWindow.cc:1179 UI/GTK2/src/mainWindow.cc:2036
-#: UI/GTK2/src/mainWindow.cc:2529
+#: UI/GTK2/src/mainWindow.cc:2533
 msgid "is already in use"
 msgstr "est deja utilise"
 
@@ -309,63 +309,63 @@
 msgid "Live query"
 msgstr "Recherche"
 
-#: UI/GTK2/src/mainWindow.cc:2344
+#: UI/GTK2/src/mainWindow.cc:2348
 msgid "At least one task hasn't completed yet. Quit now ?"
 msgstr "Au moins une tache n'est pas terminee. Quitter maintenant ?"
 
-#: UI/GTK2/src/mainWindow.cc:2525
+#: UI/GTK2/src/mainWindow.cc:2529
 msgid "Query name"
 msgstr "Nom de la recherche"
 
-#: UI/GTK2/src/mainWindow.cc:2552
+#: UI/GTK2/src/mainWindow.cc:2556
 msgid "Couldn't update query"
 msgstr "N'a pas pu mettre a jour la recherche"
 
-#: UI/GTK2/src/mainWindow.cc:2560
+#: UI/GTK2/src/mainWindow.cc:2564
 msgid "Edited query"
 msgstr "Edite la recherche"
 
-#: UI/GTK2/src/mainWindow.cc:2567
+#: UI/GTK2/src/mainWindow.cc:2571
 msgid "Couldn't add query"
 msgstr "N'a pas pu ajouter la recherche"
 
-#: UI/GTK2/src/mainWindow.cc:2575
+#: UI/GTK2/src/mainWindow.cc:2579
 msgid "Added new query"
 msgstr "Ajoute une nouvelle recherche"
 
-#: UI/GTK2/src/mainWindow.cc:2589
+#: UI/GTK2/src/mainWindow.cc:2593
 msgid "Query is not set"
 msgstr "Recherche indefinie"
 
-#: UI/GTK2/src/mainWindow.cc:2600
+#: UI/GTK2/src/mainWindow.cc:2604
 msgid "No search engine selected"
 msgstr "Pas de moteur selectionne"
 
-#: UI/GTK2/src/mainWindow.cc:2682
+#: UI/GTK2/src/mainWindow.cc:2686
 msgid "Please set the Google API key first"
 msgstr "Configurez la clef de l'API Google "
 
-#: UI/GTK2/src/mainWindow.cc:2691
+#: UI/GTK2/src/mainWindow.cc:2695
 msgid "Running query"
 msgstr "Recherche en cours"
 
-#: UI/GTK2/src/mainWindow.cc:2798
+#: UI/GTK2/src/mainWindow.cc:2802
 msgid "is already indexed or is being indexed"
 msgstr "est deja indexe ou est en cours d'indexation"
 
-#: UI/GTK2/src/mainWindow.cc:2825
+#: UI/GTK2/src/mainWindow.cc:2829
 msgid "No URL to browse"
 msgstr "Pas d'URL a brouter"
 
-#: UI/GTK2/src/mainWindow.cc:2836
+#: UI/GTK2/src/mainWindow.cc:2840
 msgid "No browser configured to view results"
 msgstr "Pas de brouter configure"
 
-#: UI/GTK2/src/mainWindow.cc:2848
+#: UI/GTK2/src/mainWindow.cc:2852
 msgid "Couldn't browse URL:"
 msgstr "N'a pas pu brouter l'URL"
 
-#: UI/GTK2/src/mainWindow.cc:2907
+#: UI/GTK2/src/mainWindow.cc:2911
 msgid "Viewing"
 msgstr "Voir"
 



From fabricecolin at berlios.de  Sat Mar 25 06:25:04 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Sat, 25 Mar 2006 06:25:04 +0100
Subject: [Pinot-svn] r176 - tags
Message-ID: <200603250525.k2P5P4Cg023333@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-25 06:25:03 +0100 (Sat, 25 Mar 2006)
New Revision: 176

Added:
   tags/version_0_4_5/
Log:
Releasing v0.45 today.


Copied: tags/version_0_4_5 (from rev 175, trunk)



From fabricecolin at berlios.de  Tue Mar 28 17:05:53 2006
From: fabricecolin at berlios.de (fabricecolin at BerliOS)
Date: Tue, 28 Mar 2006 17:05:53 +0200
Subject: [Pinot-svn] r177 - trunk/Collect
Message-ID: <200603281505.k2SF5rYE019866@sheep.berlios.de>

Author: fabricecolin
Date: 2006-03-28 17:05:52 +0200 (Tue, 28 Mar 2006)
New Revision: 177

Modified:
   trunk/Collect/DownloaderFactory.cpp
   trunk/Collect/DownloaderFactory.h
Log:
Cosmetic changes.


Modified: trunk/Collect/DownloaderFactory.cpp
===================================================================
--- trunk/Collect/DownloaderFactory.cpp	2006-03-25 05:25:03 UTC (rev 176)
+++ trunk/Collect/DownloaderFactory.cpp	2006-03-28 15:05:52 UTC (rev 177)
@@ -28,6 +28,14 @@
 
 using std::string;
 
+DownloaderFactory::DownloaderFactory()
+{
+}
+
+DownloaderFactory::~DownloaderFactory()
+{
+}
+
 /// Returns a Downloader; NULL if unavailable.
 DownloaderInterface *DownloaderFactory::getDownloader(const string &protocol)
 {

Modified: trunk/Collect/DownloaderFactory.h
===================================================================
--- trunk/Collect/DownloaderFactory.h	2006-03-25 05:25:03 UTC (rev 176)
+++ trunk/Collect/DownloaderFactory.h	2006-03-28 15:05:52 UTC (rev 177)
@@ -25,13 +25,13 @@
 class DownloaderFactory
 {
 	public:
-		virtual ~DownloaderFactory() {};
+		virtual ~DownloaderFactory();
 
 		/// Returns a Downloader; NULL if unavailable.
 		static DownloaderInterface *getDownloader(const std::string &protocol);
 
 	protected:
-		DownloaderFactory() {};
+		DownloaderFactory();
 
 	private:
 		DownloaderFactory(const DownloaderFactory &other);



