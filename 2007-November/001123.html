<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Pinot-svn] r1129 - in trunk/UI/GTK2: . src
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/pinot-svn/2007-November/index.html" >
   <LINK REL="made" HREF="mailto:pinot-svn%40lists.berlios.de?Subject=Re%3A%20%5BPinot-svn%5D%20r1129%20-%20in%20trunk/UI/GTK2%3A%20.%20src&In-Reply-To=%3C200711291316.lATDGhOj029557%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001122.html">
   <LINK REL="Next"  HREF="001124.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Pinot-svn] r1129 - in trunk/UI/GTK2: . src</H1>
    <B>fabricecolin at BerliOS</B> 
    <A HREF="mailto:pinot-svn%40lists.berlios.de?Subject=Re%3A%20%5BPinot-svn%5D%20r1129%20-%20in%20trunk/UI/GTK2%3A%20.%20src&In-Reply-To=%3C200711291316.lATDGhOj029557%40sheep.berlios.de%3E"
       TITLE="[Pinot-svn] r1129 - in trunk/UI/GTK2: . src">fabricecolin at mail.berlios.de
       </A><BR>
    <I>Thu Nov 29 14:16:43 CET 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="001122.html">[Pinot-svn] r1128 - trunk/Search
</A></li>
        <LI>Next message: <A HREF="001124.html">[Pinot-svn] r1130 - trunk/UI/GTK2/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1123">[ date ]</a>
              <a href="thread.html#1123">[ thread ]</a>
              <a href="subject.html#1123">[ subject ]</a>
              <a href="author.html#1123">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: fabricecolin
Date: 2007-11-29 14:16:41 +0100 (Thu, 29 Nov 2007)
New Revision: 1129

Modified:
   trunk/UI/GTK2/metase-gtk2.glade
   trunk/UI/GTK2/src/importDialog.cc
   trunk/UI/GTK2/src/importDialog.hh
   trunk/UI/GTK2/src/importDialog_glade.cc
   trunk/UI/GTK2/src/importDialog_glade.hh
   trunk/UI/GTK2/src/mainWindow.cc
Log:
Defer importing to the main window.
When viewing any document, add it to the list of recently used files. This
requires gtkmm &gt;= 2.10.


Modified: trunk/UI/GTK2/metase-gtk2.glade
===================================================================
--- trunk/UI/GTK2/metase-gtk2.glade	2007-11-29 12:53:58 UTC (rev 1128)
+++ trunk/UI/GTK2/metase-gtk2.glade	2007-11-29 13:16:41 UTC (rev 1129)
@@ -3537,7 +3537,6 @@
   &lt;property name=&quot;focus_on_map&quot;&gt;True&lt;/property&gt;
   &lt;property name=&quot;urgency_hint&quot;&gt;False&lt;/property&gt;
   &lt;property name=&quot;has_separator&quot;&gt;True&lt;/property&gt;
-  &lt;signal name=&quot;response&quot; handler=&quot;on_importDialog_response&quot; last_modification_time=&quot;Tue, 10 Jan 2006 05:41:42 GMT&quot;/&gt;
 
   &lt;child internal-child=&quot;vbox&quot;&gt;
     &lt;widget class=&quot;GtkVBox&quot; id=&quot;dialog-vbox7&quot;&gt;
@@ -3551,15 +3550,30 @@
 	  &lt;property name=&quot;layout_style&quot;&gt;GTK_BUTTONBOX_END&lt;/property&gt;
 
 	  &lt;child&gt;
-	    &lt;widget class=&quot;GtkButton&quot; id=&quot;closeButton&quot;&gt;
+	    &lt;widget class=&quot;GtkButton&quot; id=&quot;cancelButton&quot;&gt;
 	      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
 	      &lt;property name=&quot;can_default&quot;&gt;True&lt;/property&gt;
 	      &lt;property name=&quot;can_focus&quot;&gt;True&lt;/property&gt;
-	      &lt;property name=&quot;label&quot;&gt;gtk-close&lt;/property&gt;
+	      &lt;property name=&quot;label&quot;&gt;gtk-cancel&lt;/property&gt;
 	      &lt;property name=&quot;use_stock&quot;&gt;True&lt;/property&gt;
 	      &lt;property name=&quot;relief&quot;&gt;GTK_RELIEF_NORMAL&lt;/property&gt;
 	      &lt;property name=&quot;focus_on_click&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;response_id&quot;&gt;-6&lt;/property&gt;
+	    &lt;/widget&gt;
+	  &lt;/child&gt;
+
+	  &lt;child&gt;
+	    &lt;widget class=&quot;GtkButton&quot; id=&quot;importButton&quot;&gt;
+	      &lt;property agent=&quot;glademm&quot; name=&quot;cxx_visibility&quot;&gt;protected&lt;/property&gt;
+	      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;can_default&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;can_focus&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;label&quot;&gt;gtk-ok&lt;/property&gt;
+	      &lt;property name=&quot;use_stock&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;relief&quot;&gt;GTK_RELIEF_NORMAL&lt;/property&gt;
+	      &lt;property name=&quot;focus_on_click&quot;&gt;True&lt;/property&gt;
 	      &lt;property name=&quot;response_id&quot;&gt;-5&lt;/property&gt;
+	      &lt;signal name=&quot;clicked&quot; handler=&quot;on_importButton_clicked&quot; last_modification_time=&quot;Thu, 29 Nov 2007 13:07:20 GMT&quot;/&gt;
 	    &lt;/widget&gt;
 	  &lt;/child&gt;
 	&lt;/widget&gt;
@@ -3572,287 +3586,164 @@
       &lt;/child&gt;
 
       &lt;child&gt;
-	&lt;widget class=&quot;GtkVBox&quot; id=&quot;importVbox&quot;&gt;
+	&lt;widget class=&quot;GtkTable&quot; id=&quot;docTable&quot;&gt;
+	  &lt;property agent=&quot;glademm&quot; name=&quot;cxx_visibility&quot;&gt;protected&lt;/property&gt;
 	  &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
+	  &lt;property name=&quot;n_rows&quot;&gt;3&lt;/property&gt;
+	  &lt;property name=&quot;n_columns&quot;&gt;2&lt;/property&gt;
 	  &lt;property name=&quot;homogeneous&quot;&gt;False&lt;/property&gt;
-	  &lt;property name=&quot;spacing&quot;&gt;0&lt;/property&gt;
+	  &lt;property name=&quot;row_spacing&quot;&gt;0&lt;/property&gt;
+	  &lt;property name=&quot;column_spacing&quot;&gt;0&lt;/property&gt;
 
 	  &lt;child&gt;
-	    &lt;widget class=&quot;GtkTable&quot; id=&quot;docTable&quot;&gt;
+	    &lt;widget class=&quot;GtkEntry&quot; id=&quot;titleEntry&quot;&gt;
 	      &lt;property agent=&quot;glademm&quot; name=&quot;cxx_visibility&quot;&gt;protected&lt;/property&gt;
 	      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-	      &lt;property name=&quot;n_rows&quot;&gt;3&lt;/property&gt;
-	      &lt;property name=&quot;n_columns&quot;&gt;2&lt;/property&gt;
-	      &lt;property name=&quot;homogeneous&quot;&gt;False&lt;/property&gt;
-	      &lt;property name=&quot;row_spacing&quot;&gt;0&lt;/property&gt;
-	      &lt;property name=&quot;column_spacing&quot;&gt;0&lt;/property&gt;
+	      &lt;property name=&quot;can_focus&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;editable&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;visibility&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;max_length&quot;&gt;0&lt;/property&gt;
+	      &lt;property name=&quot;text&quot; translatable=&quot;yes&quot;&gt;&lt;/property&gt;
+	      &lt;property name=&quot;has_frame&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;invisible_char&quot;&gt;*&lt;/property&gt;
+	      &lt;property name=&quot;activates_default&quot;&gt;False&lt;/property&gt;
+	    &lt;/widget&gt;
+	    &lt;packing&gt;
+	      &lt;property name=&quot;left_attach&quot;&gt;1&lt;/property&gt;
+	      &lt;property name=&quot;right_attach&quot;&gt;2&lt;/property&gt;
+	      &lt;property name=&quot;top_attach&quot;&gt;0&lt;/property&gt;
+	      &lt;property name=&quot;bottom_attach&quot;&gt;1&lt;/property&gt;
+	      &lt;property name=&quot;x_padding&quot;&gt;4&lt;/property&gt;
+	      &lt;property name=&quot;y_padding&quot;&gt;4&lt;/property&gt;
+	      &lt;property name=&quot;y_options&quot;&gt;fill&lt;/property&gt;
+	    &lt;/packing&gt;
+	  &lt;/child&gt;
 
-	      &lt;child&gt;
-		&lt;widget class=&quot;GtkEntry&quot; id=&quot;titleEntry&quot;&gt;
-		  &lt;property agent=&quot;glademm&quot; name=&quot;cxx_visibility&quot;&gt;protected&lt;/property&gt;
-		  &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-		  &lt;property name=&quot;can_focus&quot;&gt;True&lt;/property&gt;
-		  &lt;property name=&quot;editable&quot;&gt;True&lt;/property&gt;
-		  &lt;property name=&quot;visibility&quot;&gt;True&lt;/property&gt;
-		  &lt;property name=&quot;max_length&quot;&gt;0&lt;/property&gt;
-		  &lt;property name=&quot;text&quot; translatable=&quot;yes&quot;&gt;&lt;/property&gt;
-		  &lt;property name=&quot;has_frame&quot;&gt;True&lt;/property&gt;
-		  &lt;property name=&quot;invisible_char&quot;&gt;*&lt;/property&gt;
-		  &lt;property name=&quot;activates_default&quot;&gt;False&lt;/property&gt;
-		&lt;/widget&gt;
-		&lt;packing&gt;
-		  &lt;property name=&quot;left_attach&quot;&gt;1&lt;/property&gt;
-		  &lt;property name=&quot;right_attach&quot;&gt;2&lt;/property&gt;
-		  &lt;property name=&quot;top_attach&quot;&gt;0&lt;/property&gt;
-		  &lt;property name=&quot;bottom_attach&quot;&gt;1&lt;/property&gt;
-		  &lt;property name=&quot;x_padding&quot;&gt;4&lt;/property&gt;
-		  &lt;property name=&quot;y_padding&quot;&gt;4&lt;/property&gt;
-		  &lt;property name=&quot;y_options&quot;&gt;fill&lt;/property&gt;
-		&lt;/packing&gt;
-	      &lt;/child&gt;
+	  &lt;child&gt;
+	    &lt;widget class=&quot;GtkLabel&quot; id=&quot;locationLabel&quot;&gt;
+	      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;Location:&lt;/property&gt;
+	      &lt;property name=&quot;use_underline&quot;&gt;False&lt;/property&gt;
+	      &lt;property name=&quot;use_markup&quot;&gt;False&lt;/property&gt;
+	      &lt;property name=&quot;justify&quot;&gt;GTK_JUSTIFY_LEFT&lt;/property&gt;
+	      &lt;property name=&quot;wrap&quot;&gt;False&lt;/property&gt;
+	      &lt;property name=&quot;selectable&quot;&gt;False&lt;/property&gt;
+	      &lt;property name=&quot;xalign&quot;&gt;0&lt;/property&gt;
+	      &lt;property name=&quot;yalign&quot;&gt;0.5&lt;/property&gt;
+	      &lt;property name=&quot;xpad&quot;&gt;4&lt;/property&gt;
+	      &lt;property name=&quot;ypad&quot;&gt;4&lt;/property&gt;
+	      &lt;property name=&quot;ellipsize&quot;&gt;PANGO_ELLIPSIZE_NONE&lt;/property&gt;
+	      &lt;property name=&quot;width_chars&quot;&gt;-1&lt;/property&gt;
+	      &lt;property name=&quot;single_line_mode&quot;&gt;False&lt;/property&gt;
+	      &lt;property name=&quot;angle&quot;&gt;0&lt;/property&gt;
+	    &lt;/widget&gt;
+	    &lt;packing&gt;
+	      &lt;property name=&quot;left_attach&quot;&gt;0&lt;/property&gt;
+	      &lt;property name=&quot;right_attach&quot;&gt;1&lt;/property&gt;
+	      &lt;property name=&quot;top_attach&quot;&gt;1&lt;/property&gt;
+	      &lt;property name=&quot;bottom_attach&quot;&gt;2&lt;/property&gt;
+	      &lt;property name=&quot;x_options&quot;&gt;fill&lt;/property&gt;
+	      &lt;property name=&quot;y_options&quot;&gt;fill&lt;/property&gt;
+	    &lt;/packing&gt;
+	  &lt;/child&gt;
 
-	      &lt;child&gt;
-		&lt;widget class=&quot;GtkLabel&quot; id=&quot;locationLabel&quot;&gt;
-		  &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-		  &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;Location:&lt;/property&gt;
-		  &lt;property name=&quot;use_underline&quot;&gt;False&lt;/property&gt;
-		  &lt;property name=&quot;use_markup&quot;&gt;False&lt;/property&gt;
-		  &lt;property name=&quot;justify&quot;&gt;GTK_JUSTIFY_LEFT&lt;/property&gt;
-		  &lt;property name=&quot;wrap&quot;&gt;False&lt;/property&gt;
-		  &lt;property name=&quot;selectable&quot;&gt;False&lt;/property&gt;
-		  &lt;property name=&quot;xalign&quot;&gt;0&lt;/property&gt;
-		  &lt;property name=&quot;yalign&quot;&gt;0.5&lt;/property&gt;
-		  &lt;property name=&quot;xpad&quot;&gt;4&lt;/property&gt;
-		  &lt;property name=&quot;ypad&quot;&gt;4&lt;/property&gt;
-		  &lt;property name=&quot;ellipsize&quot;&gt;PANGO_ELLIPSIZE_NONE&lt;/property&gt;
-		  &lt;property name=&quot;width_chars&quot;&gt;-1&lt;/property&gt;
-		  &lt;property name=&quot;single_line_mode&quot;&gt;False&lt;/property&gt;
-		  &lt;property name=&quot;angle&quot;&gt;0&lt;/property&gt;
-		&lt;/widget&gt;
-		&lt;packing&gt;
-		  &lt;property name=&quot;left_attach&quot;&gt;0&lt;/property&gt;
-		  &lt;property name=&quot;right_attach&quot;&gt;1&lt;/property&gt;
-		  &lt;property name=&quot;top_attach&quot;&gt;1&lt;/property&gt;
-		  &lt;property name=&quot;bottom_attach&quot;&gt;2&lt;/property&gt;
-		  &lt;property name=&quot;x_options&quot;&gt;fill&lt;/property&gt;
-		  &lt;property name=&quot;y_options&quot;&gt;fill&lt;/property&gt;
-		&lt;/packing&gt;
-	      &lt;/child&gt;
+	  &lt;child&gt;
+	    &lt;widget class=&quot;GtkLabel&quot; id=&quot;titleLabel&quot;&gt;
+	      &lt;property agent=&quot;glademm&quot; name=&quot;cxx_visibility&quot;&gt;protected&lt;/property&gt;
+	      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;Title:&lt;/property&gt;
+	      &lt;property name=&quot;use_underline&quot;&gt;False&lt;/property&gt;
+	      &lt;property name=&quot;use_markup&quot;&gt;False&lt;/property&gt;
+	      &lt;property name=&quot;justify&quot;&gt;GTK_JUSTIFY_LEFT&lt;/property&gt;
+	      &lt;property name=&quot;wrap&quot;&gt;False&lt;/property&gt;
+	      &lt;property name=&quot;selectable&quot;&gt;False&lt;/property&gt;
+	      &lt;property name=&quot;xalign&quot;&gt;0&lt;/property&gt;
+	      &lt;property name=&quot;yalign&quot;&gt;0.5&lt;/property&gt;
+	      &lt;property name=&quot;xpad&quot;&gt;4&lt;/property&gt;
+	      &lt;property name=&quot;ypad&quot;&gt;4&lt;/property&gt;
+	      &lt;property name=&quot;ellipsize&quot;&gt;PANGO_ELLIPSIZE_NONE&lt;/property&gt;
+	      &lt;property name=&quot;width_chars&quot;&gt;-1&lt;/property&gt;
+	      &lt;property name=&quot;single_line_mode&quot;&gt;False&lt;/property&gt;
+	      &lt;property name=&quot;angle&quot;&gt;0&lt;/property&gt;
+	    &lt;/widget&gt;
+	    &lt;packing&gt;
+	      &lt;property name=&quot;left_attach&quot;&gt;0&lt;/property&gt;
+	      &lt;property name=&quot;right_attach&quot;&gt;1&lt;/property&gt;
+	      &lt;property name=&quot;top_attach&quot;&gt;0&lt;/property&gt;
+	      &lt;property name=&quot;bottom_attach&quot;&gt;1&lt;/property&gt;
+	      &lt;property name=&quot;x_options&quot;&gt;fill&lt;/property&gt;
+	      &lt;property name=&quot;y_options&quot;&gt;fill&lt;/property&gt;
+	    &lt;/packing&gt;
+	  &lt;/child&gt;
 
-	      &lt;child&gt;
-		&lt;widget class=&quot;GtkLabel&quot; id=&quot;titleLabel&quot;&gt;
-		  &lt;property agent=&quot;glademm&quot; name=&quot;cxx_visibility&quot;&gt;protected&lt;/property&gt;
-		  &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-		  &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;Title:&lt;/property&gt;
-		  &lt;property name=&quot;use_underline&quot;&gt;False&lt;/property&gt;
-		  &lt;property name=&quot;use_markup&quot;&gt;False&lt;/property&gt;
-		  &lt;property name=&quot;justify&quot;&gt;GTK_JUSTIFY_LEFT&lt;/property&gt;
-		  &lt;property name=&quot;wrap&quot;&gt;False&lt;/property&gt;
-		  &lt;property name=&quot;selectable&quot;&gt;False&lt;/property&gt;
-		  &lt;property name=&quot;xalign&quot;&gt;0&lt;/property&gt;
-		  &lt;property name=&quot;yalign&quot;&gt;0.5&lt;/property&gt;
-		  &lt;property name=&quot;xpad&quot;&gt;4&lt;/property&gt;
-		  &lt;property name=&quot;ypad&quot;&gt;4&lt;/property&gt;
-		  &lt;property name=&quot;ellipsize&quot;&gt;PANGO_ELLIPSIZE_NONE&lt;/property&gt;
-		  &lt;property name=&quot;width_chars&quot;&gt;-1&lt;/property&gt;
-		  &lt;property name=&quot;single_line_mode&quot;&gt;False&lt;/property&gt;
-		  &lt;property name=&quot;angle&quot;&gt;0&lt;/property&gt;
-		&lt;/widget&gt;
-		&lt;packing&gt;
-		  &lt;property name=&quot;left_attach&quot;&gt;0&lt;/property&gt;
-		  &lt;property name=&quot;right_attach&quot;&gt;1&lt;/property&gt;
-		  &lt;property name=&quot;top_attach&quot;&gt;0&lt;/property&gt;
-		  &lt;property name=&quot;bottom_attach&quot;&gt;1&lt;/property&gt;
-		  &lt;property name=&quot;x_options&quot;&gt;fill&lt;/property&gt;
-		  &lt;property name=&quot;y_options&quot;&gt;fill&lt;/property&gt;
-		&lt;/packing&gt;
-	      &lt;/child&gt;
-
-	      &lt;child&gt;
-		&lt;widget class=&quot;GtkComboBox&quot; id=&quot;labelNameCombobox&quot;&gt;
-		  &lt;property agent=&quot;glademm&quot; name=&quot;cxx_visibility&quot;&gt;protected&lt;/property&gt;
-		  &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-		  &lt;property name=&quot;add_tearoffs&quot;&gt;False&lt;/property&gt;
-		  &lt;property name=&quot;focus_on_click&quot;&gt;True&lt;/property&gt;
-		&lt;/widget&gt;
-		&lt;packing&gt;
-		  &lt;property name=&quot;left_attach&quot;&gt;1&lt;/property&gt;
-		  &lt;property name=&quot;right_attach&quot;&gt;2&lt;/property&gt;
-		  &lt;property name=&quot;top_attach&quot;&gt;2&lt;/property&gt;
-		  &lt;property name=&quot;bottom_attach&quot;&gt;3&lt;/property&gt;
-		  &lt;property name=&quot;x_padding&quot;&gt;4&lt;/property&gt;
-		  &lt;property name=&quot;y_padding&quot;&gt;4&lt;/property&gt;
-		  &lt;property name=&quot;y_options&quot;&gt;fill&lt;/property&gt;
-		&lt;/packing&gt;
-	      &lt;/child&gt;
-
-	      &lt;child&gt;
-		&lt;widget class=&quot;GtkLabel&quot; id=&quot;labelNameLabel&quot;&gt;
-		  &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-		  &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;Apply label:&lt;/property&gt;
-		  &lt;property name=&quot;use_underline&quot;&gt;False&lt;/property&gt;
-		  &lt;property name=&quot;use_markup&quot;&gt;False&lt;/property&gt;
-		  &lt;property name=&quot;justify&quot;&gt;GTK_JUSTIFY_LEFT&lt;/property&gt;
-		  &lt;property name=&quot;wrap&quot;&gt;False&lt;/property&gt;
-		  &lt;property name=&quot;selectable&quot;&gt;False&lt;/property&gt;
-		  &lt;property name=&quot;xalign&quot;&gt;0&lt;/property&gt;
-		  &lt;property name=&quot;yalign&quot;&gt;0.5&lt;/property&gt;
-		  &lt;property name=&quot;xpad&quot;&gt;4&lt;/property&gt;
-		  &lt;property name=&quot;ypad&quot;&gt;4&lt;/property&gt;
-		  &lt;property name=&quot;ellipsize&quot;&gt;PANGO_ELLIPSIZE_NONE&lt;/property&gt;
-		  &lt;property name=&quot;width_chars&quot;&gt;-1&lt;/property&gt;
-		  &lt;property name=&quot;single_line_mode&quot;&gt;False&lt;/property&gt;
-		  &lt;property name=&quot;angle&quot;&gt;0&lt;/property&gt;
-		&lt;/widget&gt;
-		&lt;packing&gt;
-		  &lt;property name=&quot;left_attach&quot;&gt;0&lt;/property&gt;
-		  &lt;property name=&quot;right_attach&quot;&gt;1&lt;/property&gt;
-		  &lt;property name=&quot;top_attach&quot;&gt;2&lt;/property&gt;
-		  &lt;property name=&quot;bottom_attach&quot;&gt;3&lt;/property&gt;
-		  &lt;property name=&quot;x_options&quot;&gt;fill&lt;/property&gt;
-		  &lt;property name=&quot;y_options&quot;&gt;&lt;/property&gt;
-		&lt;/packing&gt;
-	      &lt;/child&gt;
-
-	      &lt;child&gt;
-		&lt;widget class=&quot;GtkEntry&quot; id=&quot;locationEntry&quot;&gt;
-		  &lt;property agent=&quot;glademm&quot; name=&quot;cxx_visibility&quot;&gt;protected&lt;/property&gt;
-		  &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-		  &lt;property name=&quot;can_focus&quot;&gt;True&lt;/property&gt;
-		  &lt;property name=&quot;editable&quot;&gt;True&lt;/property&gt;
-		  &lt;property name=&quot;visibility&quot;&gt;True&lt;/property&gt;
-		  &lt;property name=&quot;max_length&quot;&gt;0&lt;/property&gt;
-		  &lt;property name=&quot;text&quot; translatable=&quot;yes&quot;&gt;&lt;/property&gt;
-		  &lt;property name=&quot;has_frame&quot;&gt;True&lt;/property&gt;
-		  &lt;property name=&quot;invisible_char&quot;&gt;*&lt;/property&gt;
-		  &lt;property name=&quot;activates_default&quot;&gt;False&lt;/property&gt;
-		  &lt;signal name=&quot;changed&quot; handler=&quot;on_locationEntry_changed&quot; last_modification_time=&quot;Sun, 18 Sep 2005 03:55:37 GMT&quot;/&gt;
-		&lt;/widget&gt;
-		&lt;packing&gt;
-		  &lt;property name=&quot;left_attach&quot;&gt;1&lt;/property&gt;
-		  &lt;property name=&quot;right_attach&quot;&gt;2&lt;/property&gt;
-		  &lt;property name=&quot;top_attach&quot;&gt;1&lt;/property&gt;
-		  &lt;property name=&quot;bottom_attach&quot;&gt;2&lt;/property&gt;
-		  &lt;property name=&quot;x_padding&quot;&gt;4&lt;/property&gt;
-		  &lt;property name=&quot;y_padding&quot;&gt;4&lt;/property&gt;
-		  &lt;property name=&quot;y_options&quot;&gt;fill&lt;/property&gt;
-		&lt;/packing&gt;
-	      &lt;/child&gt;
+	  &lt;child&gt;
+	    &lt;widget class=&quot;GtkComboBox&quot; id=&quot;labelNameCombobox&quot;&gt;
+	      &lt;property agent=&quot;glademm&quot; name=&quot;cxx_visibility&quot;&gt;protected&lt;/property&gt;
+	      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;add_tearoffs&quot;&gt;False&lt;/property&gt;
+	      &lt;property name=&quot;focus_on_click&quot;&gt;True&lt;/property&gt;
 	    &lt;/widget&gt;
 	    &lt;packing&gt;
-	      &lt;property name=&quot;padding&quot;&gt;0&lt;/property&gt;
-	      &lt;property name=&quot;expand&quot;&gt;False&lt;/property&gt;
-	      &lt;property name=&quot;fill&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;left_attach&quot;&gt;1&lt;/property&gt;
+	      &lt;property name=&quot;right_attach&quot;&gt;2&lt;/property&gt;
+	      &lt;property name=&quot;top_attach&quot;&gt;2&lt;/property&gt;
+	      &lt;property name=&quot;bottom_attach&quot;&gt;3&lt;/property&gt;
+	      &lt;property name=&quot;x_padding&quot;&gt;4&lt;/property&gt;
+	      &lt;property name=&quot;y_padding&quot;&gt;4&lt;/property&gt;
+	      &lt;property name=&quot;y_options&quot;&gt;fill&lt;/property&gt;
 	    &lt;/packing&gt;
 	  &lt;/child&gt;
 
 	  &lt;child&gt;
-	    &lt;widget class=&quot;GtkHBox&quot; id=&quot;importHbox&quot;&gt;
+	    &lt;widget class=&quot;GtkLabel&quot; id=&quot;labelNameLabel&quot;&gt;
 	      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-	      &lt;property name=&quot;homogeneous&quot;&gt;False&lt;/property&gt;
-	      &lt;property name=&quot;spacing&quot;&gt;4&lt;/property&gt;
+	      &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;Apply label:&lt;/property&gt;
+	      &lt;property name=&quot;use_underline&quot;&gt;False&lt;/property&gt;
+	      &lt;property name=&quot;use_markup&quot;&gt;False&lt;/property&gt;
+	      &lt;property name=&quot;justify&quot;&gt;GTK_JUSTIFY_LEFT&lt;/property&gt;
+	      &lt;property name=&quot;wrap&quot;&gt;False&lt;/property&gt;
+	      &lt;property name=&quot;selectable&quot;&gt;False&lt;/property&gt;
+	      &lt;property name=&quot;xalign&quot;&gt;0&lt;/property&gt;
+	      &lt;property name=&quot;yalign&quot;&gt;0.5&lt;/property&gt;
+	      &lt;property name=&quot;xpad&quot;&gt;4&lt;/property&gt;
+	      &lt;property name=&quot;ypad&quot;&gt;4&lt;/property&gt;
+	      &lt;property name=&quot;ellipsize&quot;&gt;PANGO_ELLIPSIZE_NONE&lt;/property&gt;
+	      &lt;property name=&quot;width_chars&quot;&gt;-1&lt;/property&gt;
+	      &lt;property name=&quot;single_line_mode&quot;&gt;False&lt;/property&gt;
+	      &lt;property name=&quot;angle&quot;&gt;0&lt;/property&gt;
+	    &lt;/widget&gt;
+	    &lt;packing&gt;
+	      &lt;property name=&quot;left_attach&quot;&gt;0&lt;/property&gt;
+	      &lt;property name=&quot;right_attach&quot;&gt;1&lt;/property&gt;
+	      &lt;property name=&quot;top_attach&quot;&gt;2&lt;/property&gt;
+	      &lt;property name=&quot;bottom_attach&quot;&gt;3&lt;/property&gt;
+	      &lt;property name=&quot;x_options&quot;&gt;fill&lt;/property&gt;
+	      &lt;property name=&quot;y_options&quot;&gt;&lt;/property&gt;
+	    &lt;/packing&gt;
+	  &lt;/child&gt;
 
-	      &lt;child&gt;
-		&lt;widget class=&quot;GtkProgressBar&quot; id=&quot;importProgressbar&quot;&gt;
-		  &lt;property agent=&quot;glademm&quot; name=&quot;cxx_visibility&quot;&gt;protected&lt;/property&gt;
-		  &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-		  &lt;property name=&quot;orientation&quot;&gt;GTK_PROGRESS_LEFT_TO_RIGHT&lt;/property&gt;
-		  &lt;property name=&quot;fraction&quot;&gt;0&lt;/property&gt;
-		  &lt;property name=&quot;pulse_step&quot;&gt;0.10000000149&lt;/property&gt;
-		  &lt;property name=&quot;ellipsize&quot;&gt;PANGO_ELLIPSIZE_END&lt;/property&gt;
-		&lt;/widget&gt;
-		&lt;packing&gt;
-		  &lt;property name=&quot;padding&quot;&gt;0&lt;/property&gt;
-		  &lt;property name=&quot;expand&quot;&gt;True&lt;/property&gt;
-		  &lt;property name=&quot;fill&quot;&gt;True&lt;/property&gt;
-		&lt;/packing&gt;
-	      &lt;/child&gt;
-
-	      &lt;child&gt;
-		&lt;widget class=&quot;GtkButton&quot; id=&quot;importButton&quot;&gt;
-		  &lt;property agent=&quot;glademm&quot; name=&quot;cxx_visibility&quot;&gt;protected&lt;/property&gt;
-		  &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-		  &lt;property name=&quot;can_default&quot;&gt;True&lt;/property&gt;
-		  &lt;property name=&quot;can_focus&quot;&gt;True&lt;/property&gt;
-		  &lt;property name=&quot;relief&quot;&gt;GTK_RELIEF_NORMAL&lt;/property&gt;
-		  &lt;property name=&quot;focus_on_click&quot;&gt;True&lt;/property&gt;
-		  &lt;signal name=&quot;clicked&quot; handler=&quot;on_importButton_clicked&quot; last_modification_time=&quot;Wed, 04 Jan 2006 23:11:30 GMT&quot;/&gt;
-
-		  &lt;child&gt;
-		    &lt;widget class=&quot;GtkAlignment&quot; id=&quot;alignment34&quot;&gt;
-		      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-		      &lt;property name=&quot;xalign&quot;&gt;0.5&lt;/property&gt;
-		      &lt;property name=&quot;yalign&quot;&gt;0.5&lt;/property&gt;
-		      &lt;property name=&quot;xscale&quot;&gt;0&lt;/property&gt;
-		      &lt;property name=&quot;yscale&quot;&gt;0&lt;/property&gt;
-		      &lt;property name=&quot;top_padding&quot;&gt;0&lt;/property&gt;
-		      &lt;property name=&quot;bottom_padding&quot;&gt;0&lt;/property&gt;
-		      &lt;property name=&quot;left_padding&quot;&gt;0&lt;/property&gt;
-		      &lt;property name=&quot;right_padding&quot;&gt;0&lt;/property&gt;
-
-		      &lt;child&gt;
-			&lt;widget class=&quot;GtkHBox&quot; id=&quot;hbox52&quot;&gt;
-			  &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-			  &lt;property name=&quot;homogeneous&quot;&gt;False&lt;/property&gt;
-			  &lt;property name=&quot;spacing&quot;&gt;2&lt;/property&gt;
-
-			  &lt;child&gt;
-			    &lt;widget class=&quot;GtkImage&quot; id=&quot;image575&quot;&gt;
-			      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-			      &lt;property name=&quot;stock&quot;&gt;gtk-open&lt;/property&gt;
-			      &lt;property name=&quot;icon_size&quot;&gt;4&lt;/property&gt;
-			      &lt;property name=&quot;xalign&quot;&gt;0.5&lt;/property&gt;
-			      &lt;property name=&quot;yalign&quot;&gt;0.5&lt;/property&gt;
-			      &lt;property name=&quot;xpad&quot;&gt;0&lt;/property&gt;
-			      &lt;property name=&quot;ypad&quot;&gt;0&lt;/property&gt;
-			    &lt;/widget&gt;
-			    &lt;packing&gt;
-			      &lt;property name=&quot;padding&quot;&gt;0&lt;/property&gt;
-			      &lt;property name=&quot;expand&quot;&gt;False&lt;/property&gt;
-			      &lt;property name=&quot;fill&quot;&gt;False&lt;/property&gt;
-			    &lt;/packing&gt;
-			  &lt;/child&gt;
-
-			  &lt;child&gt;
-			    &lt;widget class=&quot;GtkLabel&quot; id=&quot;label55&quot;&gt;
-			      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-			      &lt;property name=&quot;label&quot;&gt;Import&lt;/property&gt;
-			      &lt;property name=&quot;use_underline&quot;&gt;True&lt;/property&gt;
-			      &lt;property name=&quot;use_markup&quot;&gt;False&lt;/property&gt;
-			      &lt;property name=&quot;justify&quot;&gt;GTK_JUSTIFY_LEFT&lt;/property&gt;
-			      &lt;property name=&quot;wrap&quot;&gt;False&lt;/property&gt;
-			      &lt;property name=&quot;selectable&quot;&gt;False&lt;/property&gt;
-			      &lt;property name=&quot;xalign&quot;&gt;0.5&lt;/property&gt;
-			      &lt;property name=&quot;yalign&quot;&gt;0.5&lt;/property&gt;
-			      &lt;property name=&quot;xpad&quot;&gt;0&lt;/property&gt;
-			      &lt;property name=&quot;ypad&quot;&gt;0&lt;/property&gt;
-			      &lt;property name=&quot;ellipsize&quot;&gt;PANGO_ELLIPSIZE_NONE&lt;/property&gt;
-			      &lt;property name=&quot;width_chars&quot;&gt;-1&lt;/property&gt;
-			      &lt;property name=&quot;single_line_mode&quot;&gt;False&lt;/property&gt;
-			      &lt;property name=&quot;angle&quot;&gt;0&lt;/property&gt;
-			    &lt;/widget&gt;
-			    &lt;packing&gt;
-			      &lt;property name=&quot;padding&quot;&gt;0&lt;/property&gt;
-			      &lt;property name=&quot;expand&quot;&gt;False&lt;/property&gt;
-			      &lt;property name=&quot;fill&quot;&gt;False&lt;/property&gt;
-			    &lt;/packing&gt;
-			  &lt;/child&gt;
-			&lt;/widget&gt;
-		      &lt;/child&gt;
-		    &lt;/widget&gt;
-		  &lt;/child&gt;
-		&lt;/widget&gt;
-		&lt;packing&gt;
-		  &lt;property name=&quot;padding&quot;&gt;0&lt;/property&gt;
-		  &lt;property name=&quot;expand&quot;&gt;False&lt;/property&gt;
-		  &lt;property name=&quot;fill&quot;&gt;True&lt;/property&gt;
-		&lt;/packing&gt;
-	      &lt;/child&gt;
+	  &lt;child&gt;
+	    &lt;widget class=&quot;GtkEntry&quot; id=&quot;locationEntry&quot;&gt;
+	      &lt;property agent=&quot;glademm&quot; name=&quot;cxx_visibility&quot;&gt;protected&lt;/property&gt;
+	      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;can_focus&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;editable&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;visibility&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;max_length&quot;&gt;0&lt;/property&gt;
+	      &lt;property name=&quot;text&quot; translatable=&quot;yes&quot;&gt;&lt;/property&gt;
+	      &lt;property name=&quot;has_frame&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;invisible_char&quot;&gt;*&lt;/property&gt;
+	      &lt;property name=&quot;activates_default&quot;&gt;False&lt;/property&gt;
+	      &lt;signal name=&quot;changed&quot; handler=&quot;on_locationEntry_changed&quot; last_modification_time=&quot;Sun, 18 Sep 2005 03:55:37 GMT&quot;/&gt;
 	    &lt;/widget&gt;
 	    &lt;packing&gt;
-	      &lt;property name=&quot;padding&quot;&gt;4&lt;/property&gt;
-	      &lt;property name=&quot;expand&quot;&gt;False&lt;/property&gt;
-	      &lt;property name=&quot;fill&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;left_attach&quot;&gt;1&lt;/property&gt;
+	      &lt;property name=&quot;right_attach&quot;&gt;2&lt;/property&gt;
+	      &lt;property name=&quot;top_attach&quot;&gt;1&lt;/property&gt;
+	      &lt;property name=&quot;bottom_attach&quot;&gt;2&lt;/property&gt;
+	      &lt;property name=&quot;x_padding&quot;&gt;4&lt;/property&gt;
+	      &lt;property name=&quot;y_padding&quot;&gt;4&lt;/property&gt;
+	      &lt;property name=&quot;y_options&quot;&gt;fill&lt;/property&gt;
 	    &lt;/packing&gt;
 	  &lt;/child&gt;
 	&lt;/widget&gt;

Modified: trunk/UI/GTK2/src/importDialog.cc
===================================================================
--- trunk/UI/GTK2/src/importDialog.cc	2007-11-29 12:53:58 UTC (rev 1128)
+++ trunk/UI/GTK2/src/importDialog.cc	2007-11-29 13:16:41 UTC (rev 1129)
@@ -38,22 +38,9 @@
 using namespace Glib;
 using namespace Gtk;
 
-importDialog::InternalState::InternalState(unsigned int maxIndexThreads, importDialog *pWindow) :
-	ThreadsManager(PinotSettings::getInstance().m_docsIndexLocation, maxIndexThreads),
-	m_locationLength(0),
-	m_importing(false)
-{
-	m_onThreadEndSignal.connect(sigc::mem_fun(*pWindow, &amp;importDialog::on_thread_end));
-}
-
-importDialog::InternalState::~InternalState()
-{
-}
-
 importDialog::importDialog() :
 	importDialog_glade(),
-	m_docsCount(0),
-	m_state(10, this)
+	m_locationLength(0)
 {
 	// Enable completion on the location field
 	m_refLocationList = ListStore::create(m_locationColumns);
@@ -67,20 +54,20 @@
 	// Populate
 	populate_comboboxes();
 
-	// Connect to threads' finished signal
-	m_state.connect();
-
 	// Disable this button as long the location entry field is empty
 	// The title field may remain empty
 	importButton-&gt;set_sensitive(false);
-	importProgressbar-&gt;set_pulse_step(0.10);
 }
 
 importDialog::~importDialog()
 {
-	m_state.disconnect();
 }
 
+const DocumentInfo &amp;importDialog::getDocumentInfo(void) const
+{
+	return m_docInfo;
+}
+
 void importDialog::populate_comboboxes(void)
 {
 	labelNameCombobox-&gt;append_text(_(&quot;None&quot;));
@@ -95,18 +82,21 @@
 	}
 }
 
-bool importDialog::on_activity_timeout(void)
+void importDialog::on_importButton_clicked()
 {
-	importProgressbar-&gt;pulse();
+	string title(from_utf8(titleEntry-&gt;get_text()));
+	string location(from_utf8(locationEntry-&gt;get_text()));
+	string labelName;
 
-	return true;
-}
+	// Label
+	int chosenLabel = labelNameCombobox-&gt;get_active_row_number();
+	if (chosenLabel &gt; 0)
+	{
+		labelName = from_utf8(labelNameCombobox-&gt;get_active_text());
+	}
 
-void importDialog::import_url(const string &amp;title, const string &amp;location,
-	const string &amp;labelName)
-{
 	Url urlObj(location);
-	DocumentInfo docInfo(from_utf8(title), location, MIMEScanner::scanUrl(urlObj), &quot;&quot;);
+	m_docInfo = DocumentInfo(title, location, MIMEScanner::scanUrl(urlObj), &quot;&quot;);
 
 	// Any label ?
 	if (labelName.empty() == false)
@@ -114,91 +104,10 @@
 		set&lt;string&gt; labels;
 
 		labels.insert(labelName);
-		docInfo.setLabels(labels);
+		m_docInfo.setLabels(labels);
 	}
-
-	// Was the document queued for indexing ?
-	ustring status = m_state.queue_index(docInfo);
-	if (status.empty() == true)
-	{
-		m_timeoutConnection = Glib::signal_timeout().connect(sigc::mem_fun(*this,
-			&amp;importDialog::on_activity_timeout), 1000);
-	}
-	else
-	{
-		importProgressbar-&gt;set_text(status);
-	}
 }
 
-void importDialog::on_thread_end(WorkerThread *pThread)
-{
-	ustring status;
-	bool success = true;
-
-	if (pThread == NULL)
-	{
-		return;
-	}
-
-	// Any thread still running ?
-	if (m_state.has_threads() == false)
-	{
-#ifdef DEBUG
-		cout &lt;&lt; &quot;importDialog::on_thread_end: imported all&quot; &lt;&lt; endl;
-#endif
-		m_state.m_importing = false;
-	}
-
-	// Did the thread fail ?
-	status = pThread-&gt;getStatus();
-	if (status.empty() == false)
-	{
-#ifdef DEBUG
-		cout &lt;&lt; &quot;importDialog::on_thread_end: &quot; &lt;&lt; status &lt;&lt; endl;
-#endif
-		success = false;
-	}
-
-	// What type of thread was it ?
-	string type = pThread-&gt;getType();
-	if (type == &quot;IndexingThread&quot;)
-	{
-		// Did it succeed ?
-		if (success == true)
-		{
-			// Yes, it did
-			++m_docsCount;
-		}
-	}
-
-	// Delete the thread
-	delete pThread;
-
-	// We might be able to run a queued action
-	m_state.pop_queue();
-
-	if (m_state.m_importing == false)
-	{
-		double fractionFilled = 1.0;
-
-		m_timeoutConnection.block();
-		m_timeoutConnection.disconnect();
-
-		if (success == false)
-		{
-			importProgressbar-&gt;set_text(status);
-			fractionFilled = 0.0;
-		}
-		importProgressbar-&gt;set_fraction(fractionFilled);
-		importButton-&gt;set_sensitive(true);
-	}
-}
-
-unsigned int importDialog::getDocumentsCount(void)
-{
-	return m_docsCount;
-}
-
 void importDialog::on_locationEntry_changed()
 {
 	ustring fileName = from_utf8(locationEntry-&gt;get_text());
@@ -220,28 +129,26 @@
 		enableImport = false;
 	}
 
-	// Keep the button disabled as lon as we are importing
-	if (m_state.m_importing == true)
+	unsigned int locationLength = fileName.length();
+	if (locationLength &gt; 0)
 	{
-		enableImport = false;
+		// Enable the import button
+		importButton-&gt;set_sensitive(true);
 	}
-	importButton-&gt;set_sensitive(enableImport);
 
-	unsigned int locationLength = fileName.length();
-
 	// Reset the list
 	m_refLocationList-&gt;clear();
 
 	// If characters are being deleted or if the location is too short, don't
 	// attempt to offer suggestions
-	if ((m_state.m_locationLength &gt; locationLength) ||
+	if ((m_locationLength &gt; locationLength) ||
 		(fileName.empty() == true) ||
 		(m_refLocationCompletion-&gt;get_minimum_key_length() &gt; fileName.length()))
 	{
-		m_state.m_locationLength = locationLength;
+		m_locationLength = locationLength;
 		return;
 	}
-	m_state.m_locationLength = locationLength;
+	m_locationLength = locationLength;
 
 	// Get 10 URLs like this one
 	QueryHistory history(PinotSettings::getInstance().getHistoryDatabaseName());
@@ -258,43 +165,3 @@
 	}
 }
 
-void importDialog::on_importButton_clicked()
-{
-	string title(from_utf8(titleEntry-&gt;get_text()));
-	string location(from_utf8(locationEntry-&gt;get_text()));
-	string labelName;
-
-	// Rudimentary lock
-	if (m_state.m_importing == true)
-	{
-		return;
-	}
-	m_state.m_importing = true;
-
-	importProgressbar-&gt;set_text(&quot;&quot;);
-	importProgressbar-&gt;set_fraction(0.0);
-	// Disable the import button
-	importButton-&gt;set_sensitive(false);
-
-	// Label
-	int chosenLabel = labelNameCombobox-&gt;get_active_row_number();
-	if (chosenLabel &gt; 0)
-	{
-		labelName = from_utf8(labelNameCombobox-&gt;get_active_text());
-	}
-
-	import_url(title, location, labelName);
-}
-
-void importDialog::on_importDialog_response(int response_id)
-{
-	if (m_timeoutConnection.connected() == true)
-	{
-		m_timeoutConnection.block();
-		m_timeoutConnection.disconnect();
-	}
-
-	// Closing the window should stop everything
-	m_state.disconnect();
-	m_state.stop_threads();
-}

Modified: trunk/UI/GTK2/src/importDialog.hh
===================================================================
--- trunk/UI/GTK2/src/importDialog.hh	2007-11-29 12:53:58 UTC (rev 1128)
+++ trunk/UI/GTK2/src/importDialog.hh	2007-11-29 13:16:41 UTC (rev 1129)
@@ -26,8 +26,8 @@
 #include &lt;gtkmm/liststore.h&gt;
 #include &lt;glibmm/ustring.h&gt;
 
+#include &quot;DocumentInfo.h&quot;
 #include &quot;ModelColumns.h&quot;
-#include &quot;WorkerThreads.h&quot;
 #include &quot;importDialog_glade.hh&quot;
 
 class importDialog : public importDialog_glade
@@ -36,40 +36,19 @@
 	importDialog();
 	virtual ~importDialog();
 
-	void setHeight(int maxHeight);
+	const DocumentInfo &amp;getDocumentInfo(void) const;
 
-	unsigned int getDocumentsCount(void);
-
 protected:
-	void populate_comboboxes(void);
-
-	bool on_activity_timeout(void);
-	void import_url(const std::string &amp;title, const std::string &amp;location,
-		const std::string &amp;labelName);
-	void on_thread_end(WorkerThread *pThread);
-
-private:
 	ComboModelColumns m_locationColumns;
 	Glib::RefPtr&lt;Gtk::ListStore&gt; m_refLocationList;
 	Glib::RefPtr&lt;Gtk::EntryCompletion&gt; m_refLocationCompletion;
-	unsigned int m_docsCount;
-	// Activity timeout
-	sigc::connection m_timeoutConnection;
-	// Internal state
-	class InternalState : public ThreadsManager
-	{
-		public:
-			InternalState(unsigned int maxIndexThreads, importDialog *pWindow);
-			~InternalState();
+	unsigned int m_locationLength;
+	DocumentInfo m_docInfo;
 
-			unsigned int m_locationLength;
-			bool m_importing;
+	void populate_comboboxes(void);
 
-	} m_state;
-
-	virtual void on_locationEntry_changed();
 	virtual void on_importButton_clicked();
-	virtual void on_importDialog_response(int response_id);
+	virtual void on_locationEntry_changed();
 
 };
 

Modified: trunk/UI/GTK2/src/importDialog_glade.cc
===================================================================
--- trunk/UI/GTK2/src/importDialog_glade.cc	2007-11-29 12:53:58 UTC (rev 1128)
+++ trunk/UI/GTK2/src/importDialog_glade.cc	2007-11-29 13:16:41 UTC (rev 1129)
@@ -1,9 +1,9 @@
-// generated 2006/8/20 15:34:18 SGT by <A HREF="https://lists.berlios.de/mailman/listinfo/pinot-svn">fabrice at amra.dyndns.org.</A>(none)
+// generated 2007/11/29 21:04:06 SGT by <A HREF="https://lists.berlios.de/mailman/listinfo/pinot-svn">fabrice at amra.dyndns.org.</A>(none)
 // using glademm V2.12.1
 //
 // DO NOT EDIT THIS FILE ! It was created using
 // glade-- /home/fabrice/Projects/MetaSE/pinot/UI/GTK2/metase-gtk2.glade
-// for gtk 2.8.20 and gtkmm 2.8.8
+// for gtk 2.12.1 and gtkmm 2.12.0
 //
 // Please modify the corresponding derived classes in ./src/importDialog.cc
 
@@ -39,9 +39,7 @@
 #include &lt;gtkmm/button.h&gt;
 #include &lt;gtkmm/buttonbox.h&gt;
 #include &lt;gtkmm/label.h&gt;
-#include &lt;gtkmm/image.h&gt;
 #include &lt;gtkmm/box.h&gt;
-#include &lt;gtkmm/alignment.h&gt;
 #ifndef ENABLE_NLS
 #  define textdomain(String) (String)
 #  define gettext(String) (String)
@@ -60,7 +58,8 @@
    Gtk::Dialog *importDialog = this;
    gmm_data = new GlademmData(get_accel_group());
    
-   Gtk::Button *closeButton = Gtk::manage(new class Gtk::Button(Gtk::StockID(&quot;gtk-close&quot;)));
+   Gtk::Button *cancelButton = Gtk::manage(new class Gtk::Button(Gtk::StockID(&quot;gtk-cancel&quot;)));
+   importButton = Gtk::manage(new class Gtk::Button(Gtk::StockID(&quot;gtk-ok&quot;)));
    titleEntry = Gtk::manage(new class Gtk::Entry());
    
    Gtk::Label *locationLabel = Gtk::manage(new class Gtk::Label(_(&quot;Location:&quot;)));
@@ -70,19 +69,12 @@
    Gtk::Label *labelNameLabel = Gtk::manage(new class Gtk::Label(_(&quot;Apply label:&quot;)));
    locationEntry = Gtk::manage(new class Gtk::Entry());
    docTable = Gtk::manage(new class Gtk::Table(2, 2, false));
-   importProgressbar = Gtk::manage(new class Gtk::ProgressBar());
-   
-   Gtk::Image *image575 = Gtk::manage(new class Gtk::Image(Gtk::StockID(&quot;gtk-open&quot;), Gtk::IconSize(4)));
-   Gtk::Label *label55 = Gtk::manage(new class Gtk::Label(_(&quot;Import&quot;)));
-   Gtk::HBox *hbox52 = Gtk::manage(new class Gtk::HBox(false, 2));
-   Gtk::Alignment *alignment34 = Gtk::manage(new class Gtk::Alignment(0.5, 0.5, 0, 0));
-   importButton = Gtk::manage(new class Gtk::Button());
-   
-   Gtk::HBox *importHbox = Gtk::manage(new class Gtk::HBox(false, 4));
-   Gtk::VBox *importVbox = Gtk::manage(new class Gtk::VBox(false, 0));
-   closeButton-&gt;set_flags(Gtk::CAN_FOCUS);
-   closeButton-&gt;set_flags(Gtk::CAN_DEFAULT);
-   closeButton-&gt;set_relief(Gtk::RELIEF_NORMAL);
+   cancelButton-&gt;set_flags(Gtk::CAN_FOCUS);
+   cancelButton-&gt;set_flags(Gtk::CAN_DEFAULT);
+   cancelButton-&gt;set_relief(Gtk::RELIEF_NORMAL);
+   importButton-&gt;set_flags(Gtk::CAN_FOCUS);
+   importButton-&gt;set_flags(Gtk::CAN_DEFAULT);
+   importButton-&gt;set_relief(Gtk::RELIEF_NORMAL);
    importDialog-&gt;get_action_area()-&gt;property_layout_style().set_value(Gtk::BUTTONBOX_END);
    titleEntry-&gt;set_flags(Gtk::CAN_FOCUS);
    titleEntry-&gt;set_visibility(true);
@@ -96,18 +88,30 @@
    locationLabel-&gt;set_line_wrap(false);
    locationLabel-&gt;set_use_markup(false);
    locationLabel-&gt;set_selectable(false);
+   locationLabel-&gt;set_ellipsize(Pango::ELLIPSIZE_NONE);
+   locationLabel-&gt;set_width_chars(-1);
+   locationLabel-&gt;set_angle(0);
+   locationLabel-&gt;set_single_line_mode(false);
    titleLabel-&gt;set_alignment(0,0.5);
    titleLabel-&gt;set_padding(4,4);
    titleLabel-&gt;set_justify(Gtk::JUSTIFY_LEFT);
    titleLabel-&gt;set_line_wrap(false);
    titleLabel-&gt;set_use_markup(false);
    titleLabel-&gt;set_selectable(false);
+   titleLabel-&gt;set_ellipsize(Pango::ELLIPSIZE_NONE);
+   titleLabel-&gt;set_width_chars(-1);
+   titleLabel-&gt;set_angle(0);
+   titleLabel-&gt;set_single_line_mode(false);
    labelNameLabel-&gt;set_alignment(0,0.5);
    labelNameLabel-&gt;set_padding(4,4);
    labelNameLabel-&gt;set_justify(Gtk::JUSTIFY_LEFT);
    labelNameLabel-&gt;set_line_wrap(false);
    labelNameLabel-&gt;set_use_markup(false);
    labelNameLabel-&gt;set_selectable(false);
+   labelNameLabel-&gt;set_ellipsize(Pango::ELLIPSIZE_NONE);
+   labelNameLabel-&gt;set_width_chars(-1);
+   labelNameLabel-&gt;set_angle(0);
+   labelNameLabel-&gt;set_single_line_mode(false);
    locationEntry-&gt;set_flags(Gtk::CAN_FOCUS);
    locationEntry-&gt;set_visibility(true);
    locationEntry-&gt;set_editable(true);
@@ -122,36 +126,19 @@
    docTable-&gt;attach(*labelNameCombobox, 1, 2, 2, 3, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
    docTable-&gt;attach(*labelNameLabel, 0, 1, 2, 3, Gtk::FILL, Gtk::AttachOptions(), 0, 0);
    docTable-&gt;attach(*locationEntry, 1, 2, 1, 2, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
-   image575-&gt;set_alignment(0.5,0.5);
-   image575-&gt;set_padding(0,0);
-   label55-&gt;set_alignment(0.5,0.5);
-   label55-&gt;set_padding(0,0);
-   label55-&gt;set_justify(Gtk::JUSTIFY_LEFT);
-   label55-&gt;set_line_wrap(false);
-   label55-&gt;set_use_markup(false);
-   label55-&gt;set_selectable(false);
-   hbox52-&gt;pack_start(*image575, Gtk::PACK_SHRINK, 0);
-   hbox52-&gt;pack_start(*label55, Gtk::PACK_SHRINK, 0);
-   alignment34-&gt;add(*hbox52);
-   importButton-&gt;set_flags(Gtk::CAN_FOCUS);
-   importButton-&gt;set_flags(Gtk::CAN_DEFAULT);
-   importButton-&gt;set_relief(Gtk::RELIEF_NORMAL);
-   importButton-&gt;add(*alignment34);
-   importHbox-&gt;pack_start(*importProgressbar);
-   importHbox-&gt;pack_start(*importButton, Gtk::PACK_SHRINK, 0);
-   importVbox-&gt;pack_start(*docTable, Gtk::PACK_SHRINK, 0);
-   importVbox-&gt;pack_start(*importHbox, Gtk::PACK_SHRINK, 4);
    importDialog-&gt;get_vbox()-&gt;set_homogeneous(false);
    importDialog-&gt;get_vbox()-&gt;set_spacing(0);
-   importDialog-&gt;get_vbox()-&gt;pack_start(*importVbox);
+   importDialog-&gt;get_vbox()-&gt;pack_start(*docTable);
    importDialog-&gt;set_title(_(&quot;Import URL&quot;));
    importDialog-&gt;set_modal(false);
    importDialog-&gt;property_window_position().set_value(Gtk::WIN_POS_NONE);
    importDialog-&gt;set_resizable(true);
    importDialog-&gt;property_destroy_with_parent().set_value(false);
    importDialog-&gt;set_has_separator(true);
-   importDialog-&gt;add_action_widget(*closeButton, -5);
-   closeButton-&gt;show();
+   importDialog-&gt;add_action_widget(*cancelButton, -6);
+   importDialog-&gt;add_action_widget(*importButton, -5);
+   cancelButton-&gt;show();
+   importButton-&gt;show();
    titleEntry-&gt;show();
    locationLabel-&gt;show();
    titleLabel-&gt;show();
@@ -159,17 +146,8 @@
    labelNameLabel-&gt;show();
    locationEntry-&gt;show();
    docTable-&gt;show();
-   importProgressbar-&gt;show();
-   image575-&gt;show();
-   label55-&gt;show();
-   hbox52-&gt;show();
-   alignment34-&gt;show();
-   importButton-&gt;show();
-   importHbox-&gt;show();
-   importVbox-&gt;show();
-   locationEntry-&gt;signal_changed().connect(sigc::mem_fun(*this, &amp;importDialog_glade::on_locationEntry_changed), false);
    importButton-&gt;signal_clicked().connect(sigc::mem_fun(*this, &amp;importDialog_glade::on_importButton_clicked), false);
-   importDialog-&gt;signal_response().connect(sigc::mem_fun(*this, &amp;importDialog_glade::on_importDialog_response), false);
+   locationEntry-&gt;signal_changed().connect(sigc::mem_fun(*this, &amp;importDialog_glade::on_locationEntry_changed), false);
 }
 
 importDialog_glade::~importDialog_glade()

Modified: trunk/UI/GTK2/src/importDialog_glade.hh
===================================================================
--- trunk/UI/GTK2/src/importDialog_glade.hh	2007-11-29 12:53:58 UTC (rev 1128)
+++ trunk/UI/GTK2/src/importDialog_glade.hh	2007-11-29 13:16:41 UTC (rev 1129)
@@ -1,9 +1,9 @@
-// generated 2006/8/20 15:32:26 SGT by <A HREF="https://lists.berlios.de/mailman/listinfo/pinot-svn">fabrice at amra.dyndns.org.</A>(none)
+// generated 2007/11/29 21:04:06 SGT by <A HREF="https://lists.berlios.de/mailman/listinfo/pinot-svn">fabrice at amra.dyndns.org.</A>(none)
 // using glademm V2.12.1
 //
 // DO NOT EDIT THIS FILE ! It was created using
 // glade-- /home/fabrice/Projects/MetaSE/pinot/UI/GTK2/metase-gtk2.glade
-// for gtk 2.8.20 and gtkmm 2.8.8
+// for gtk 2.12.1 and gtkmm 2.12.0
 //
 // Please modify the corresponding derived classes in ./src/importDialog.hh and./src/importDialog.cc
 
@@ -32,32 +32,29 @@
 #endif //GLADEMM_DATA
 
 #include &lt;gtkmm/dialog.h&gt;
+#include &lt;gtkmm/button.h&gt;
 #include &lt;gtkmm/entry.h&gt;
 #include &lt;gtkmm/label.h&gt;
 #include &lt;gtkmm/comboboxtext.h&gt;
 #include &lt;gtkmm/table.h&gt;
-#include &lt;gtkmm/progressbar.h&gt;
-#include &lt;gtkmm/button.h&gt;
 
 class importDialog_glade : public Gtk::Dialog
 {  
         
         GlademmData *gmm_data;
 protected:
+        class Gtk::Button * importButton;
         class Gtk::Entry * titleEntry;
         class Gtk::Label * titleLabel;
         class Gtk::ComboBoxText * labelNameCombobox;
         class Gtk::Entry * locationEntry;
         class Gtk::Table * docTable;
-        class Gtk::ProgressBar * importProgressbar;
-        class Gtk::Button * importButton;
         
         importDialog_glade();
         
         ~importDialog_glade();
 private:
-        virtual void on_locationEntry_changed() = 0;
         virtual void on_importButton_clicked() = 0;
-        virtual void on_importDialog_response(int response_id) = 0;
+        virtual void on_locationEntry_changed() = 0;
 };
 #endif

Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2007-11-29 12:53:58 UTC (rev 1128)
+++ trunk/UI/GTK2/src/mainWindow.cc	2007-11-29 13:16:41 UTC (rev 1129)
@@ -32,6 +32,7 @@
 #include &lt;gtkmm/messagedialog.h&gt;
 #include &lt;gtkmm/scrolledwindow.h&gt;
 #include &lt;gtkmm/clipboard.h&gt;
+#include &lt;gtkmm/recentmanager.h&gt;
 #include &lt;gtkmm/main.h&gt;
 
 #include &quot;CommandLine.h&quot;
@@ -2105,25 +2106,19 @@
 //
 void mainWindow::on_import_activate()
 {
-	m_state.disconnect();
+	importDialog importBox;
 
-	importDialog importBox;
 	importBox.show();
 	importBox.run();
 
-	m_state.connect();
-
-	// Was anything imported ?
-	if (importBox.getDocumentsCount() &gt; 0)
+	// Anything to import ?
+	const DocumentInfo &amp;docInfo = importBox.getDocumentInfo();
+	if (docInfo.getLocation().empty() == false)
 	{
-		ustring indexName(_(&quot;My Web Pages&quot;));
-
-		// Is the index still being shown ?
-		IndexPage *pIndexPage = dynamic_cast&lt;IndexPage*&gt;(get_page(indexName, NotebookPageBox::INDEX_PAGE));
-		if (pIndexPage != NULL)
+		ustring status = m_state.queue_index(docInfo);
+		if (status.empty() == false)
 		{
-			// Refresh
-			browse_index(indexName, pIndexPage-&gt;getQueryName(), 0);
+			set_status(status);
 		}
 	}
 }
@@ -3290,6 +3285,7 @@
 void mainWindow::view_documents(vector&lt;DocumentInfo&gt; &amp;documentsList)
 {
 	ViewHistory viewHistory(m_settings.getHistoryDatabaseName());
+	RefPtr&lt;RecentManager&gt; recentManager = RecentManager::get_default();
 	multimap&lt;string, string&gt; locationsByType;
 
 	for (vector&lt;DocumentInfo&gt;::iterator docIter = documentsList.begin();
@@ -3444,6 +3440,21 @@
 		if (viewHistory.hasItem(url) == false)
 		{
 			viewHistory.insertItem(url);
+
+			// ...as well as in the recently used files list
+			RecentManager::Data itemData;
+			for (vector&lt;DocumentInfo&gt;::iterator docIter = documentsList.begin();
+				docIter != documentsList.end(); ++docIter)
+			{
+				if (docIter-&gt;getLocation() == url)
+				{
+					itemData.display_name = docIter-&gt;getTitle();
+					break;
+				}
+			}
+			itemData.mime_type = type;
+			itemData.is_private = false;
+			recentManager-&gt;add_item(url, itemData);
 		}
 	}
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001122.html">[Pinot-svn] r1128 - trunk/Search
</A></li>
	<LI>Next message: <A HREF="001124.html">[Pinot-svn] r1130 - trunk/UI/GTK2/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1123">[ date ]</a>
              <a href="thread.html#1123">[ thread ]</a>
              <a href="subject.html#1123">[ subject ]</a>
              <a href="author.html#1123">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/pinot-svn">More information about the Pinot-svn
mailing list</a><br>
</body></html>
