From fabricecolin at mail.berlios.de  Sun May  6 04:15:54 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sun, 6 May 2007 04:15:54 +0200
Subject: [Pinot-svn] r829 - trunk/UI/GTK2/src
Message-ID: <200705060215.l462FsiB018253@sheep.berlios.de>

Author: fabricecolin
Date: 2007-05-06 04:15:53 +0200 (Sun, 06 May 2007)
New Revision: 829

Modified:
   trunk/UI/GTK2/src/prefsDialog.cc
Log:
The Indexing tab has moved to fourth position.


Modified: trunk/UI/GTK2/src/prefsDialog.cc
===================================================================
--- trunk/UI/GTK2/src/prefsDialog.cc	2007-04-28 02:36:10 UTC (rev 828)
+++ trunk/UI/GTK2/src/prefsDialog.cc	2007-05-06 02:15:53 UTC (rev 829)
@@ -119,9 +119,9 @@
 	// Show The Indexing tab on first run
 	if ((m_settings.isFirstRun() == true) &&
 		(prefsNotebook != NULL) &&
-		(prefsNotebook->get_n_pages() > 2))
+		(prefsNotebook->get_n_pages() > 3))
 	{
-		prefsNotebook->set_current_page(2);
+		prefsNotebook->set_current_page(3);
 	}
 }
 



From fabricecolin at mail.berlios.de  Sun May  6 04:58:50 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sun, 6 May 2007 04:58:50 +0200
Subject: [Pinot-svn] r830 - trunk/UI/GTK2/src
Message-ID: <200705060258.l462wov8020690@sheep.berlios.de>

Author: fabricecolin
Date: 2007-05-06 04:58:49 +0200 (Sun, 06 May 2007)
New Revision: 830

Modified:
   trunk/UI/GTK2/src/ResultsTree.cpp
Log:
In flat mode, don't attempt updating the parent group, there isn't any. This
fixes a crash when unindexing documents.
This bug was reported by Marco <visik7 at tin dot it>.


Modified: trunk/UI/GTK2/src/ResultsTree.cpp
===================================================================
--- trunk/UI/GTK2/src/ResultsTree.cpp	2007-05-06 02:15:53 UTC (rev 829)
+++ trunk/UI/GTK2/src/ResultsTree.cpp	2007-05-06 02:58:49 UTC (rev 830)
@@ -848,6 +848,7 @@
 	list<TreeModel::Path>::iterator itemPath = selectedItems.begin();
 	TreeModel::iterator iter = m_refStore->get_iter(*itemPath);
 	TreeModel::Row row = *iter;
+
 	return row[m_resultsColumns.m_url];
 }
 
@@ -869,7 +870,8 @@
 		TreeModel::iterator iter = m_refStore->get_iter(*itemPath);
 		TreeModel::Row row = *iter;
 
-		if (row[m_resultsColumns.m_resultType] != ResultsModelColumns::ROW_RESULT)
+		ResultsModelColumns::RowType type = row[m_resultsColumns.m_resultType];
+		if (type != ResultsModelColumns::ROW_RESULT)
 		{
 			continue;
 		}
@@ -929,8 +931,9 @@
 	{
 		TreeModel::iterator iter = m_refStore->get_iter(*itemPath);
 		TreeModel::Row row = *iter;
-
-		if (row[m_resultsColumns.m_resultType] != ResultsModelColumns::ROW_RESULT)
+  
+		ResultsModelColumns::RowType type = row[m_resultsColumns.m_resultType];
+		if (type != ResultsModelColumns::ROW_RESULT)
 		{
 			continue;
 		}
@@ -992,7 +995,8 @@
 		bool updateParent = false;
 
 		// This could be a group that's in the map and should be removed first
-		if (row[m_resultsColumns.m_resultType] != ResultsModelColumns::ROW_RESULT)
+		ResultsModelColumns::RowType type = row[m_resultsColumns.m_resultType];
+		if (type != ResultsModelColumns::ROW_RESULT)
 		{
 			string groupName(from_utf8(row[m_resultsColumns.m_text]));
 			std::map<string, TreeModel::iterator>::iterator mapIter = m_resultsGroups.find(groupName);
@@ -1004,7 +1008,7 @@
 #endif
 			}
 		}
-		else
+		else if (m_groupMode != FLAT)
 		{
 			// This item is a result
 			parentIter = row.parent();
@@ -1061,8 +1065,9 @@
 	{
 		TreeModel::Row row = *parentIter;
 
-		if ((row[m_resultsColumns.m_resultType] != ResultsModelColumns::ROW_ENGINE) &&
-			(row[m_resultsColumns.m_resultType] != ResultsModelColumns::ROW_HOST))
+		ResultsModelColumns::RowType type = row[m_resultsColumns.m_resultType];
+		if ((type != ResultsModelColumns::ROW_ENGINE) &&
+			(type != ResultsModelColumns::ROW_HOST))
 		{
 			continue;
 		}
@@ -1073,7 +1078,8 @@
 		{
 			row = *iter;
 
-			if ((row[m_resultsColumns.m_resultType] == ResultsModelColumns::ROW_RESULT) &&
+			type = row[m_resultsColumns.m_resultType];
+			if ((type == ResultsModelColumns::ROW_RESULT) &&
 				(row[m_resultsColumns.m_engines] == engineId) &&
 				(row[m_resultsColumns.m_indexes] == indexId))
 			{
@@ -1407,7 +1413,8 @@
 	int averageScore = 0;
 
 	// Check the iterator doesn't point to a result
-	if (groupRow[m_resultsColumns.m_resultType] == ResultsModelColumns::ROW_RESULT)
+	ResultsModelColumns::RowType type = groupRow[m_resultsColumns.m_resultType];
+	if (type == ResultsModelColumns::ROW_RESULT)
 	{
 		return;
 	}



From fabricecolin at mail.berlios.de  Sun May  6 04:59:59 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sun, 6 May 2007 04:59:59 +0200
Subject: [Pinot-svn] r831 - trunk/UI/GTK2/src
Message-ID: <200705060259.l462xxMq020748@sheep.berlios.de>

Author: fabricecolin
Date: 2007-05-06 04:59:59 +0200 (Sun, 06 May 2007)
New Revision: 831

Modified:
   trunk/UI/GTK2/src/pinot.cc
Log:
Recommend updating documents in My Web Pages only if that index is not empty.


Modified: trunk/UI/GTK2/src/pinot.cc
===================================================================
--- trunk/UI/GTK2/src/pinot.cc	2007-05-06 02:58:49 UTC (rev 830)
+++ trunk/UI/GTK2/src/pinot.cc	2007-05-06 02:59:59 UTC (rev 831)
@@ -298,17 +298,22 @@
 
 	// What version of the UI is this ?
 	double uiVersion = atof(VERSION);
-	// What version is the index at ?
-	XapianIndex docsIndex(settings.m_docsIndexLocation);
-	double indexVersion = docsIndex.getVersion();
-	// Is an upgrade necessary ?
-	if (indexVersion <= 0.70)
+	if (uiVersion > 0)
 	{
-		// Yes, it is
-		// FIXME: use a popup ! 
-		errorMsg = _("Updating all documents in My Web Pages is recommended");
+		// What version is the index at ?
+		XapianIndex docsIndex(settings.m_docsIndexLocation);
+		double indexVersion = docsIndex.getVersion();
+
+		// Is an upgrade necessary ?
+		if ((indexVersion <= 0.70) &&
+			(docsIndex.getDocumentsCount() > 0))
+		{
+			// Yes, it is
+			// FIXME: use a popup ! 
+			errorMsg = _("Updating all documents in My Web Pages is recommended");
+		}
+		docsIndex.setVersion(uiVersion);
 	}
-	docsIndex.setVersion(uiVersion);
 
 	try
 	{



From fabricecolin at mail.berlios.de  Mon May  7 15:54:46 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Mon, 7 May 2007 15:54:46 +0200
Subject: [Pinot-svn] r832 - trunk
Message-ID: <200705071354.l47Dsk2i002959@sheep.berlios.de>

Author: fabricecolin
Date: 2007-05-07 15:54:45 +0200 (Mon, 07 May 2007)
New Revision: 832

Modified:
   trunk/configure.in
Log:
Define PINOT_INDEX_MIN_VERSION, the version number below which an index upgrade
should be performed.


Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2007-05-06 02:59:59 UTC (rev 831)
+++ trunk/configure.in	2007-05-07 13:54:45 UTC (rev 832)
@@ -15,10 +15,11 @@
 AC_PROG_CXXCPP
 AM_PROG_LIBTOOL
 
-dnl *************************************************
+dnl An index with a version older than this should be upgraded
+AC_DEFINE_UNQUOTED(PINOT_INDEX_MIN_VERSION,0.72,
+    [Minimum index version])
+
 dnl gettext support
-dnl *************************************************
-
 GETTEXT_PACKAGE=pinot
 AC_SUBST(GETTEXT_PACKAGE)
 AC_DEFINE_UNQUOTED(GETTEXT_PACKAGE,"$GETTEXT_PACKAGE",



From fabricecolin at mail.berlios.de  Sat May 12 05:46:51 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 12 May 2007 05:46:51 +0200
Subject: [Pinot-svn] r833 - trunk/Index
Message-ID: <200705120346.l4C3kpVc013447@sheep.berlios.de>

Author: fabricecolin
Date: 2007-05-12 05:46:50 +0200 (Sat, 12 May 2007)
New Revision: 833

Modified:
   trunk/Index/XapianIndex.cpp
Log:
Preparing for Xapian 1.0 : get_errno() is deprecated and stem_word() is gone.


Modified: trunk/Index/XapianIndex.cpp
===================================================================
--- trunk/Index/XapianIndex.cpp	2007-05-07 13:54:45 UTC (rev 832)
+++ trunk/Index/XapianIndex.cpp	2007-05-12 03:46:50 UTC (rev 833)
@@ -68,7 +68,7 @@
 		{
 			// This posting may have been removed already
 #ifdef DEBUG
-			cout << "XapianIndex::removeFirstPosting: " << error.get_errno() << " " << error.get_msg() << endl;
+			cout << "XapianIndex::removeFirstPosting: " << error.get_msg() << endl;
 #endif
 		}
 	}
@@ -153,7 +153,7 @@
 	}
 	catch (const Xapian::Error &error)
 	{
-		cerr << "Couldn't get document list: " << error.get_type() << ": " << error.get_errno() << " " << error.get_msg() << endl;
+		cerr << "Couldn't get document list: " << error.get_type() << ": " << error.get_msg() << endl;
 	}
 	catch (...)
 	{
@@ -206,13 +206,21 @@
 		}
 		else if (mode == STORE_STEM)
 		{
-			string stemmedTerm = pStemmer->stem_word(term);
+#if XAPIAN_MAJOR_VERSION==0
+			string stemmedTerm(pStemmer->stem_word(term));
+#else
+			string stemmedTerm((*pStemmer)(term));
+#endif
 
 			doc.add_posting(prefix + XapianDatabase::limitTermLength(stemmedTerm), termPos);
 		}
 		else if (mode == STORE_BOTH)
 		{
-			string stemmedTerm = pStemmer->stem_word(term);
+#if XAPIAN_MAJOR_VERSION==0
+			string stemmedTerm(pStemmer->stem_word(term));
+#else
+			string stemmedTerm((*pStemmer)(term));
+#endif
 
 			// Add both at the same position
 			doc.add_posting(prefix + XapianDatabase::limitTermLength(term), termPos);
@@ -278,11 +286,21 @@
 		}
 		else if (mode == STORE_STEM)
 		{
-			removeFirstPosting(doc, termListIter, prefix + XapianDatabase::limitTermLength(pStemmer->stem_word(term)));
+#if XAPIAN_MAJOR_VERSION==0
+			string stemmedTerm(pStemmer->stem_word(term));
+#else
+			string stemmedTerm((*pStemmer)(term));
+#endif
+
+			removeFirstPosting(doc, termListIter, prefix + XapianDatabase::limitTermLength(stemmedTerm));
 		}
 		else if (mode == STORE_BOTH)
 		{
-			string stemmedTerm = pStemmer->stem_word(term);
+#if XAPIAN_MAJOR_VERSION==0
+			string stemmedTerm(pStemmer->stem_word(term));
+#else
+			string stemmedTerm((*pStemmer)(term));
+#endif
 
 			removeFirstPosting(doc, termListIter, prefix + XapianDatabase::limitTermLength(term));
 			if (stemmedTerm != term)
@@ -513,7 +531,7 @@
 		catch (const Xapian::Error &error)
 		{
 #ifdef DEBUG
-			cout << "XapianIndex::removeCommonTerms: " << error.get_errno() << " " << error.get_msg() << endl;
+			cout << "XapianIndex::removeCommonTerms: " << error.get_msg() << endl;
 #endif
 		}
 	}
@@ -543,7 +561,7 @@
 		}
 		catch (const Xapian::Error &error)
 		{
-			cerr << "XapianIndex::scanDocument: " << error.get_type() << ": " << error.get_errno() << " " << error.get_msg() << endl;
+			cerr << "XapianIndex::scanDocument: " << error.get_type() << ": " << error.get_msg() << endl;
 			continue;
 		}
 
@@ -606,7 +624,7 @@
 	}
 	catch (const Xapian::Error &error)
 	{
-		cerr << "Couldn't unindex documents: " << error.get_type() << ": " << error.get_errno() << " " << error.get_msg() << endl;
+		cerr << "Couldn't unindex documents: " << error.get_type() << ": " << error.get_msg() << endl;
 	}
 	catch (...)
 	{
@@ -728,7 +746,7 @@
 	}
 	catch (const Xapian::Error &error)
 	{
-		cerr << "Couldn't get document properties: " << error.get_type() << ": " << error.get_errno() << " " << error.get_msg() << endl;
+		cerr << "Couldn't get document properties: " << error.get_type() << ": " << error.get_msg() << endl;
 	}
 	catch (...)
 	{
@@ -766,7 +784,7 @@
 	}
 	catch (const Xapian::Error &error)
 	{
-		cerr << "Couldn't get document terms count: " << error.get_type() << ": " << error.get_errno() << " " << error.get_msg() << endl;
+		cerr << "Couldn't get document terms count: " << error.get_type() << ": " << error.get_msg() << endl;
 	}
 	catch (...)
 	{
@@ -814,7 +832,7 @@
 	}
 	catch (const Xapian::Error &error)
 	{
-		cerr << "Couldn't check document labels: " << error.get_type() << ": " << error.get_errno() << " " << error.get_msg() << endl;
+		cerr << "Couldn't check document labels: " << error.get_type() << ": " << error.get_msg() << endl;
 	}
 	catch (...)
 	{
@@ -866,7 +884,7 @@
 	}
 	catch (const Xapian::Error &error)
 	{
-		cerr << "Couldn't get document's labels: " << error.get_type() << ": " << error.get_errno() << " " << error.get_msg() << endl;
+		cerr << "Couldn't get document's labels: " << error.get_type() << ": " << error.get_msg() << endl;
 	}
 	catch (...)
 	{
@@ -912,7 +930,7 @@
 	}
 	catch (const Xapian::Error &error)
 	{
-		cerr << "Couldn't look for document: " << error.get_type() << ": " << error.get_errno() << " " << error.get_msg() << endl;
+		cerr << "Couldn't look for document: " << error.get_type() << ": " << error.get_msg() << endl;
 	}
 	catch (...)
 	{
@@ -993,7 +1011,7 @@
 	}
 	catch (const Xapian::Error &error)
 	{
-		cerr << "Couldn't get terms: " << error.get_type() << ": " << error.get_errno() << " " << error.get_msg() << endl;
+		cerr << "Couldn't get terms: " << error.get_type() << ": " << error.get_msg() << endl;
 	}
 	catch (...)
 	{
@@ -1026,7 +1044,7 @@
 	}
 	catch (const Xapian::Error &error)
 	{
-		cerr << "Couldn't get last document ID: " << error.get_type() << ": " << error.get_errno() << " " << error.get_msg() << endl;
+		cerr << "Couldn't get last document ID: " << error.get_type() << ": " << error.get_msg() << endl;
 	}
 	catch (...)
 	{
@@ -1071,7 +1089,7 @@
 	}
 	catch (const Xapian::Error &error)
 	{
-		cerr << "Couldn't count documents: " << error.get_type() << ": " << error.get_errno() << " " << error.get_msg() << endl;
+		cerr << "Couldn't count documents: " << error.get_type() << ": " << error.get_msg() << endl;
 	}
 	catch (...)
 	{
@@ -1174,7 +1192,7 @@
 	}
 	catch (const Xapian::Error &error)
 	{
-		cerr << "Couldn't index document: " << error.get_type() << ": " << error.get_errno() << " " << error.get_msg() << endl;
+		cerr << "Couldn't index document: " << error.get_type() << ": " << error.get_msg() << endl;
 	}
 	catch (...)
 	{
@@ -1255,7 +1273,7 @@
 	}
 	catch (const Xapian::Error &error)
 	{
-		cerr << "Couldn't update document: " << error.get_type() << ": " << error.get_errno() << " " << error.get_msg() << endl;
+		cerr << "Couldn't update document: " << error.get_type() << ": " << error.get_msg() << endl;
 	}
 	catch (...)
 	{
@@ -1303,7 +1321,7 @@
 	}
 	catch (const Xapian::Error &error)
 	{
-		cerr << "Couldn't update document properties: " << error.get_type() << ": " << error.get_errno() << " " << error.get_msg() << endl;
+		cerr << "Couldn't update document properties: " << error.get_type() << ": " << error.get_msg() << endl;
 	}
 	catch (...)
 	{
@@ -1384,7 +1402,7 @@
 		}
 		catch (const Xapian::Error &error)
 		{
-			cerr << "Couldn't update document's labels: " << error.get_type() << ": " << error.get_errno() << " " << error.get_msg() << endl;
+			cerr << "Couldn't update document's labels: " << error.get_type() << ": " << error.get_msg() << endl;
 		}
 		catch (...)
 		{
@@ -1426,7 +1444,7 @@
 	}
 	catch (const Xapian::Error &error)
 	{
-		cerr << "Couldn't unindex document: " << error.get_type() << ": " << error.get_errno() << " " << error.get_msg() << endl;
+		cerr << "Couldn't unindex document: " << error.get_type() << ": " << error.get_msg() << endl;
 	}
 	catch (...)
 	{
@@ -1510,7 +1528,7 @@
 	}
 	catch (const Xapian::Error &error)
 	{
-		cerr << "Couldn't delete label: " << error.get_type() << ": " << error.get_errno() << " " << error.get_msg() << endl;
+		cerr << "Couldn't delete label: " << error.get_type() << ": " << error.get_msg() << endl;
 	}
 	catch (...)
 	{
@@ -1559,7 +1577,7 @@
 	}
 	catch (const Xapian::Error &error)
 	{
-		cerr << "Couldn't delete label: " << error.get_type() << ": " << error.get_errno() << " " << error.get_msg() << endl;
+		cerr << "Couldn't delete label: " << error.get_type() << ": " << error.get_msg() << endl;
 	}
 	catch (...)
 	{
@@ -1593,7 +1611,7 @@
 	}
 	catch (const Xapian::Error &error)
 	{
-		cerr << "Couldn't flush database: " << error.get_type() << ": " << error.get_errno() << " " << error.get_msg() << endl;
+		cerr << "Couldn't flush database: " << error.get_type() << ": " << error.get_msg() << endl;
 	}
 	catch (...)
 	{



From fabricecolin at mail.berlios.de  Sat May 12 05:49:34 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 12 May 2007 05:49:34 +0200
Subject: [Pinot-svn] r834 - trunk/Index
Message-ID: <200705120349.l4C3nYVU013598@sheep.berlios.de>

Author: fabricecolin
Date: 2007-05-12 05:49:33 +0200 (Sat, 12 May 2007)
New Revision: 834

Modified:
   trunk/Index/XapianDatabase.cpp
   trunk/Index/XapianDatabase.h
   trunk/Index/XapianDatabaseFactory.cpp
   trunk/Index/XapianDatabaseFactory.h
Log:
Allow overwriting the index.
Preparing for Xapian 1.0 : upon DatabaseVersionError, overwrite the database
and let the app know so that it can do a full reindexing.


Modified: trunk/Index/XapianDatabase.cpp
===================================================================
--- trunk/Index/XapianDatabase.cpp	2007-05-12 03:46:50 UTC (rev 833)
+++ trunk/Index/XapianDatabase.cpp	2007-05-12 03:49:33 UTC (rev 834)
@@ -38,9 +38,12 @@
 // This puts a limit to terms length.
 const unsigned int XapianDatabase::m_maxTermLength = 230;
 
-XapianDatabase::XapianDatabase(const string &databaseName, bool readOnly) :
+XapianDatabase::XapianDatabase(const string &databaseName,
+	bool readOnly, bool overwrite) :
 	m_databaseName(databaseName),
 	m_readOnly(readOnly),
+	m_overwrite(overwrite),
+	m_obsoleteFormat(false),
 	m_pDatabase(NULL),
 	m_isOpen(false),
 	m_merge(false),
@@ -55,6 +58,8 @@
 	XapianDatabase *pFirst, XapianDatabase *pSecond) :
 	m_databaseName(databaseName),
 	m_readOnly(true),
+	m_overwrite(false),
+	m_obsoleteFormat(false),
 	m_pDatabase(NULL),
 	m_isOpen(pFirst->m_isOpen),
 	m_merge(true),
@@ -67,6 +72,8 @@
 XapianDatabase::XapianDatabase(const XapianDatabase &other) :
 	m_databaseName(other.m_databaseName),
 	m_readOnly(other.m_readOnly),
+	m_overwrite(other.m_overwrite),
+	m_obsoleteFormat(other.m_obsoleteFormat),
 	m_pDatabase(NULL),
 	m_isOpen(other.m_isOpen),
 	m_merge(other.m_merge),
@@ -95,6 +102,8 @@
 	{
 		m_databaseName = other.m_databaseName;
 		m_readOnly = other.m_readOnly;
+		m_overwrite = other.m_overwrite;
+		m_obsoleteFormat = other.m_obsoleteFormat;
 		if (m_pDatabase != NULL)
 		{
 			delete m_pDatabase;
@@ -199,8 +208,8 @@
 			}
 			catch (const Xapian::Error &error)
 			{
-				cerr << "XapianDatabase::openDatabase: couldn't open remote database: "
-					<< error.get_msg() << endl;
+				cerr << "XapianDatabase::openDatabase: " << error.get_type()
+					<< ": " << error.get_msg() << endl;
 			}
 		}
 #ifdef DEBUG
@@ -252,7 +261,15 @@
 		}
 		else
 		{
-			m_pDatabase = new Xapian::WritableDatabase(m_databaseName, Xapian::DB_CREATE_OR_OPEN);
+			int openAction = Xapian::DB_CREATE_OR_OPEN;
+
+			if (m_overwrite == true)
+			{
+				// An existing database will be overwritten
+				openAction = Xapian::DB_CREATE_OR_OVERWRITE;
+			}
+
+			m_pDatabase = new Xapian::WritableDatabase(m_databaseName, openAction);
 		}
 #ifdef DEBUG
 		cout << "XapianDatabase::openDatabase: opened " << m_databaseName << endl;
@@ -261,10 +278,26 @@
 
 		return;
 	}
+#if XAPIAN_MAJOR_VERSION>0
+	catch (const Xapian::DatabaseVersionError &error)
+	{
+		// The format of the index is not understood
+		if (m_obsoleteFormat == false)
+		{
+			cerr << "XapianDatabase::openDatabase: " << error.get_type()
+				<< ": " << error.get_msg() << "; trying again" << endl;
+
+			// Try once more
+			m_overwrite = true;
+			m_obsoleteFormat = true;
+			openDatabase();
+		}
+	}
+#endif
 	catch (const Xapian::Error &error)
 	{
-		cerr << "XapianDatabase::openDatabase: couldn't open database: "
-			<< error.get_msg() << endl;
+		cerr << "XapianDatabase::openDatabase: " << error.get_type()
+			<< ": " << error.get_msg() << endl;
 	}
 }
 
@@ -274,6 +307,12 @@
 	return m_isOpen;
 }
 
+/// Returns false if the database was of an obsolete format.
+bool XapianDatabase::wasObsoleteFormat(void) const
+{
+	return m_obsoleteFormat;
+}
+
 /// Reopens the database.
 void XapianDatabase::reopen(void)
 {

Modified: trunk/Index/XapianDatabase.h
===================================================================
--- trunk/Index/XapianDatabase.h	2007-05-12 03:46:50 UTC (rev 833)
+++ trunk/Index/XapianDatabase.h	2007-05-12 03:49:33 UTC (rev 834)
@@ -30,8 +30,9 @@
 class XapianDatabase
 {
 	public:
-		XapianDatabase(const std::string &databaseName, bool readOnly = true);
 		XapianDatabase(const std::string &databaseName,
+			bool readOnly = true, bool overwrite = false);
+		XapianDatabase(const std::string &databaseName,
 			XapianDatabase *pFirst, XapianDatabase *pSecond);
 		XapianDatabase(const XapianDatabase &other);
 		virtual ~XapianDatabase();
@@ -41,6 +42,9 @@
 		/// Returns false if the database couldn't be opened.
 		bool isOpen(void) const;
 
+		/// Returns false if the database was of an obsolete format.
+		bool wasObsoleteFormat(void) const;
+
 		/// Reopens the database.
 		void reopen(void);
 
@@ -69,6 +73,8 @@
 		static const unsigned int m_maxTermLength;
 		std::string m_databaseName;
 		bool m_readOnly;
+		bool m_overwrite;
+		bool m_obsoleteFormat;
 		pthread_mutex_t m_rwLock;
 		Xapian::Database *m_pDatabase;
 		bool m_isOpen;

Modified: trunk/Index/XapianDatabaseFactory.cpp
===================================================================
--- trunk/Index/XapianDatabaseFactory.cpp	2007-05-12 03:46:50 UTC (rev 833)
+++ trunk/Index/XapianDatabaseFactory.cpp	2007-05-12 03:49:33 UTC (rev 834)
@@ -65,7 +65,8 @@
 }
 
 /// Returns a XapianDatabase pointer; NULL if unavailable.
-XapianDatabase *XapianDatabaseFactory::getDatabase(const string &location, bool readOnly)
+XapianDatabase *XapianDatabaseFactory::getDatabase(const string &location,
+	bool readOnly, bool overwrite)
 {
 	XapianDatabase *pDb = NULL;
 
@@ -88,7 +89,7 @@
 	else
 	{
 		// Create a new instance
-		pDb = new XapianDatabase(location, readOnly);
+		pDb = new XapianDatabase(location, readOnly, overwrite);
 		// Insert it into the map
 		pair<map<string, XapianDatabase *>::iterator, bool> insertPair = m_databases.insert(pair<string, XapianDatabase *>(location, pDb));
 		// Was it inserted ?

Modified: trunk/Index/XapianDatabaseFactory.h
===================================================================
--- trunk/Index/XapianDatabaseFactory.h	2007-05-12 03:46:50 UTC (rev 833)
+++ trunk/Index/XapianDatabaseFactory.h	2007-05-12 03:49:33 UTC (rev 834)
@@ -36,7 +36,8 @@
 			XapianDatabase *pFirst, XapianDatabase *pSecond);
 
 		/// Returns a XapianDatabase pointer; NULL if unavailable.
-		static XapianDatabase *getDatabase(const std::string &location, bool readOnly = true);
+		static XapianDatabase *getDatabase(const std::string &location,
+			bool readOnly = true, bool overwrite = false);
 
 		/// Closes all databases.
 		static void closeAll(void);



From fabricecolin at mail.berlios.de  Fri May 18 15:42:48 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Fri, 18 May 2007 15:42:48 +0200
Subject: [Pinot-svn] r835 - trunk/Index
Message-ID: <200705181342.l4IDgm4l015528@sheep.berlios.de>

Author: fabricecolin
Date: 2007-05-18 15:42:48 +0200 (Fri, 18 May 2007)
New Revision: 835

Modified:
   trunk/Index/XapianDatabase.cpp
Log:
Minor change.


Modified: trunk/Index/XapianDatabase.cpp
===================================================================
--- trunk/Index/XapianDatabase.cpp	2007-05-12 03:49:33 UTC (rev 834)
+++ trunk/Index/XapianDatabase.cpp	2007-05-18 13:42:48 UTC (rev 835)
@@ -126,6 +126,7 @@
 {
 	struct stat dbStat;
 	bool createDatabase = false;
+	bool tryAgain = false;
 
 	if (m_databaseName.empty() == true)
 	{
@@ -281,16 +282,13 @@
 #if XAPIAN_MAJOR_VERSION>0
 	catch (const Xapian::DatabaseVersionError &error)
 	{
-		// The format of the index is not understood
+		cerr << "XapianDatabase::openDatabase: " << error.get_type()
+			<< ": " << error.get_msg() << endl;
+
+		// This format is no longer supported
 		if (m_obsoleteFormat == false)
 		{
-			cerr << "XapianDatabase::openDatabase: " << error.get_type()
-				<< ": " << error.get_msg() << "; trying again" << endl;
-
-			// Try once more
-			m_overwrite = true;
-			m_obsoleteFormat = true;
-			openDatabase();
+			tryAgain = true;
 		}
 	}
 #endif
@@ -299,6 +297,16 @@
 		cerr << "XapianDatabase::openDatabase: " << error.get_type()
 			<< ": " << error.get_msg() << endl;
 	}
+
+	// Give it another try ?
+	if (tryAgain == true)
+	{
+		cout << "XapianDatabase::openDatabase: trying again" << endl;
+
+		m_overwrite = true;
+		m_obsoleteFormat = true;
+		openDatabase();
+	}
 }
 
 /// Returns false if the database couldn't be opened.



From fabricecolin at mail.berlios.de  Fri May 18 15:45:35 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Fri, 18 May 2007 15:45:35 +0200
Subject: [Pinot-svn] r836 - trunk/SQL
Message-ID: <200705181345.l4IDjZgU015891@sheep.berlios.de>

Author: fabricecolin
Date: 2007-05-18 15:45:32 +0200 (Fri, 18 May 2007)
New Revision: 836

Modified:
   trunk/SQL/ActionQueue.cpp
   trunk/SQL/ActionQueue.h
   trunk/SQL/CrawlHistory.cpp
   trunk/SQL/CrawlHistory.h
   trunk/SQL/QueryHistory.cpp
   trunk/SQL/QueryHistory.h
   trunk/SQL/SQLiteBase.cpp
   trunk/SQL/SQLiteBase.h
   trunk/SQL/ViewHistory.cpp
   trunk/SQL/ViewHistory.h
Log:
Let the sub-class decide when to open the database.
New method CrawlHistory::updateItems().


Modified: trunk/SQL/ActionQueue.cpp
===================================================================
--- trunk/SQL/ActionQueue.cpp	2007-05-18 13:42:48 UTC (rev 835)
+++ trunk/SQL/ActionQueue.cpp	2007-05-18 13:45:32 UTC (rev 836)
@@ -211,7 +211,7 @@
 	return success;
 }
 
-bool ActionQueue::getOldestItem(ActionType &type, DocumentInfo &docInfo) const
+bool ActionQueue::getOldestItem(ActionType &type, DocumentInfo &docInfo)
 {
 	bool success = false;
 

Modified: trunk/SQL/ActionQueue.h
===================================================================
--- trunk/SQL/ActionQueue.h	2007-05-18 13:42:48 UTC (rev 835)
+++ trunk/SQL/ActionQueue.h	2007-05-18 13:45:32 UTC (rev 836)
@@ -49,7 +49,7 @@
         protected:
 		std::string m_queueId;
 
-		bool getOldestItem(ActionType &type, DocumentInfo &docInfo) const;
+		bool getOldestItem(ActionType &type, DocumentInfo &docInfo);
 
 		static std::string typeToText(ActionType type);
 

Modified: trunk/SQL/CrawlHistory.cpp
===================================================================
--- trunk/SQL/CrawlHistory.cpp	2007-05-18 13:42:48 UTC (rev 835)
+++ trunk/SQL/CrawlHistory.cpp	2007-05-18 13:45:32 UTC (rev 836)
@@ -25,7 +25,7 @@
 #include "CrawlHistory.h"
 
 CrawlHistory::CrawlHistory(const string &database) :
-	SQLiteBase(database)
+	SQLiteBase(database, false)
 {
 }
 
@@ -168,7 +168,7 @@
 }
 
 /// Returns sources.
-unsigned int CrawlHistory::getSources(map<unsigned int, string> &sources) const
+unsigned int CrawlHistory::getSources(map<unsigned int, string> &sources)
 {
 	unsigned int count = 0;
 
@@ -230,7 +230,7 @@
 }
 
 /// Checks if an URL is in the history.
-bool CrawlHistory::hasItem(const string &url, CrawlStatus &status, time_t &date) const
+bool CrawlHistory::hasItem(const string &url, CrawlStatus &status, time_t &date)
 {
 	bool success = false;
 
@@ -272,6 +272,25 @@
 	return success;
 }
 
+/// Updates URLs.
+bool CrawlHistory::updateItems(const map<string, time_t> urls, CrawlStatus status)
+{
+	string statusText(statusToText(status));
+
+	for (map<string, time_t>::const_iterator updateIter = urls.begin();
+		updateIter != urls.end(); ++updateIter)
+	{
+		SQLiteResults *results = executeStatement("UPDATE CrawlHistory \
+			SET Status='%q', Date='%d' WHERE Url='%q';",
+			statusText.c_str(), (updateIter->second == 0 ? time(NULL) : updateIter->second),
+			Url::escapeUrl(updateIter->first).c_str());
+		if (results != NULL)
+		{
+			delete results;
+		}
+	}
+}
+
 /// Updates the status of items en masse.
 bool CrawlHistory::updateItemsStatus(unsigned int sourceId, CrawlStatus currentStatus, CrawlStatus newStatus)
 {
@@ -292,7 +311,7 @@
 
 /// Returns items that belong to a source.
 unsigned int CrawlHistory::getSourceItems(unsigned int sourceId, CrawlStatus status,
-	set<string> &urls, time_t minDate) const
+	set<string> &urls, time_t minDate)
 {
 	SQLiteResults *results = NULL;
 	unsigned int count = 0;
@@ -334,7 +353,7 @@
 }
 
 /// Returns the number of URLs.
-unsigned int CrawlHistory::getItemsCount(CrawlStatus status) const
+unsigned int CrawlHistory::getItemsCount(CrawlStatus status)
 {
 	unsigned int count = 0;
 

Modified: trunk/SQL/CrawlHistory.h
===================================================================
--- trunk/SQL/CrawlHistory.h	2007-05-18 13:42:48 UTC (rev 835)
+++ trunk/SQL/CrawlHistory.h	2007-05-18 13:45:32 UTC (rev 836)
@@ -47,7 +47,7 @@
 		bool hasSource(const string &url, unsigned int &sourceId);
 
 		/// Returns sources.
-		unsigned int getSources(map<unsigned int, string> &sources) const;
+		unsigned int getSources(map<unsigned int, string> &sources);
 
 		/// Deletes a source.
 		bool deleteSource(unsigned int sourceId);
@@ -56,20 +56,23 @@
 		bool insertItem(const string &url, CrawlStatus status, unsigned int sourceId, time_t date);
 
 		/// Checks if an URL is in the history.
-		bool hasItem(const string &url, CrawlStatus &status, time_t &date) const;
+		bool hasItem(const string &url, CrawlStatus &status, time_t &date);
 
 		/// Updates an URL.
 		bool updateItem(const string &url, CrawlStatus status, time_t date);
 
+		/// Updates URLs.
+		bool updateItems(const map<string, time_t> urls, CrawlStatus status);
+
 		/// Updates the status of items en masse.
 		bool updateItemsStatus(unsigned int sourceId, CrawlStatus currentStatus, CrawlStatus newStatus);
 
 		/// Returns items that belong to a source.
 		unsigned int getSourceItems(unsigned int sourceId, CrawlStatus status,
-			set<string> &urls, time_t minDate = 0) const;
+			set<string> &urls, time_t minDate = 0);
 
 		/// Returns the number of URLs.
-		unsigned int getItemsCount(CrawlStatus status) const;
+		unsigned int getItemsCount(CrawlStatus status);
 
 		/// Deletes an URL.
 		bool deleteItem(const string &url);

Modified: trunk/SQL/QueryHistory.cpp
===================================================================
--- trunk/SQL/QueryHistory.cpp	2007-05-18 13:42:48 UTC (rev 835)
+++ trunk/SQL/QueryHistory.cpp	2007-05-18 13:45:32 UTC (rev 836)
@@ -91,7 +91,7 @@
 
 /// Checks if an URL is in the history; returns its current score or 0 if not found.
 float QueryHistory::hasItem(const string &queryName, const string &engineName, const string &url,
-	float &previousScore) const
+	float &previousScore)
 {
 	float score = 0;
 
@@ -137,7 +137,7 @@
 
 /// Gets the first max items for the given query, engine pair.
 bool QueryHistory::getItems(const string &queryName, const string &engineName,
-	unsigned int max, vector<DocumentInfo> &resultsList) const
+	unsigned int max, vector<DocumentInfo> &resultsList)
 {
 	bool success = false;
 
@@ -174,7 +174,7 @@
 
 /// Gets an item's extract.
 string QueryHistory::getItemExtract(const string &queryName, const string &engineName,
-	const string &url, string &charset) const
+	const string &url, string &charset)
 {
 	string extract;
 
@@ -199,7 +199,7 @@
 }
 
 /// Gets a query's last run time.
-string QueryHistory::getLastRun(const string &queryName, const string &engineName) const
+string QueryHistory::getLastRun(const string &queryName, const string &engineName)
 {
 	SQLiteResults *results = NULL;
 	string lastRun;

Modified: trunk/SQL/QueryHistory.h
===================================================================
--- trunk/SQL/QueryHistory.h	2007-05-18 13:42:48 UTC (rev 835)
+++ trunk/SQL/QueryHistory.h	2007-05-18 13:45:32 UTC (rev 836)
@@ -46,7 +46,7 @@
 		  * If it is, it returns the current and previous scores; returns 0 if not found.
 		  */
 		float hasItem(const string &queryName, const string &engineName, const string &url,
-			float &previousScore) const;
+			float &previousScore);
 
 		/// Updates an URL's details.
 		bool updateItem(const string &queryName, const string &engineName, const string &url,
@@ -54,14 +54,14 @@
 
 		/// Gets the first max items for the given query, engine pair.
 		bool getItems(const string &queryName, const string &engineName,
-			unsigned int max, vector<DocumentInfo> &resultsList) const;
+			unsigned int max, vector<DocumentInfo> &resultsList);
 
 		/// Gets an item's extract.
 		string getItemExtract(const string &queryName, const string &engineName,
-			const string &url, string &charset) const;
+			const string &url, string &charset);
 
 		/// Gets a query's last run time.
-		string getLastRun(const string &queryName, const string &engineName = "") const;
+		string getLastRun(const string &queryName, const string &engineName = "");
 
 		/// Deletes items.
 		bool deleteItems(const string &name, bool isQueryName);

Modified: trunk/SQL/SQLiteBase.cpp
===================================================================
--- trunk/SQL/SQLiteBase.cpp	2007-05-18 13:42:48 UTC (rev 835)
+++ trunk/SQL/SQLiteBase.cpp	2007-05-18 13:45:32 UTC (rev 836)
@@ -160,14 +160,23 @@
 	return true;
 }
 
-SQLiteBase::SQLiteBase(const string &database) :
-	m_databaseName("")
+SQLiteBase::SQLiteBase(const string &database, bool onDemand) :
+	m_databaseName(database),
+	m_onDemand(onDemand),
+	m_pDatabase(NULL)
 {
-	m_databaseName = database;
+	if (m_onDemand == false)
+	{
+		open(m_databaseName);
+	}
 }
 
 SQLiteBase::~SQLiteBase()
 {
+	if (m_onDemand == false)
+	{
+		close();
+	}
 }
 
 bool SQLiteBase::check(const string &database)
@@ -186,43 +195,39 @@
 	return true;
 }
 
-sqlite3 *SQLiteBase::open(const string &database) const
+void SQLiteBase::open(const string &database)
 {
-	sqlite3 *pDatabase = NULL;
-
 	// Open the new database
-	if (sqlite3_open(database.c_str(), &pDatabase) != SQLITE_OK)
+	if (sqlite3_open(database.c_str(), &m_pDatabase) != SQLITE_OK)
 	{
 		// An handle is returned even when an error occurs !
-		if (pDatabase != NULL)
+		if (m_pDatabase != NULL)
 		{
-			cerr << "SQLiteBase::open: " << sqlite3_errmsg(pDatabase) << endl;
-			close(pDatabase);
-			pDatabase = NULL;
+			cerr << "SQLiteBase::open: " << sqlite3_errmsg(m_pDatabase) << endl;
+			close();
+			m_pDatabase = NULL;
 		}
 	}
-	else if (pDatabase == NULL)
+	else if (m_pDatabase == NULL)
 	{
 		cerr << "SQLiteBase::open: couldn't open " << database << endl;
 	}
 	else
 	{
 		// Set up a busy handler
-		sqlite3_busy_handler(pDatabase, busyHandler, NULL);
+		sqlite3_busy_handler(m_pDatabase, busyHandler, NULL);
 	}
-
-	return pDatabase;
 }
 
-void SQLiteBase::close(sqlite3 *pDatabase) const
+void SQLiteBase::close(void)
 {
-	if (pDatabase != NULL)
+	if (m_pDatabase != NULL)
 	{
-		sqlite3_close(pDatabase);
+		sqlite3_close(m_pDatabase);
 	}
 }
 
-bool SQLiteBase::executeSimpleStatement(const string &sql) const
+bool SQLiteBase::executeSimpleStatement(const string &sql)
 {
 	char *errMsg = NULL;
 	bool success = true;
@@ -232,13 +237,16 @@
 		return false;
 	}
 
-	sqlite3 *pDatabase = open(m_databaseName);
-	if (pDatabase == NULL)
+	if (m_onDemand == true)
 	{
+		open(m_databaseName);
+	}
+	if (m_pDatabase == NULL)
+	{
 		return false;
 	}
 
-	if (sqlite3_exec(pDatabase,
+	if (sqlite3_exec(m_pDatabase,
 		sql.c_str(), 
 		NULL, NULL, // No callback
 		&errMsg) != SQLITE_OK)
@@ -252,12 +260,15 @@
 
 		success = false;
 	}
-	close(pDatabase);
+	if (m_onDemand == true)
+	{
+		close();
+	}
 
 	return success;
 }
 
-SQLiteResults *SQLiteBase::executeStatement(const char *sqlFormat, ...) const
+SQLiteResults *SQLiteBase::executeStatement(const char *sqlFormat, ...)
 {
 	SQLiteResults *pResults = NULL;
 #ifdef _USE_VSNPRINTF
@@ -270,9 +281,12 @@
 		return NULL;
 	}
 
-	sqlite3 *pDatabase = open(m_databaseName);
-	if (pDatabase == NULL)
+	if (m_onDemand == true)
 	{
+		open(m_databaseName);
+	}
+	if (m_pDatabase == NULL)
+	{
 		return NULL;
 	}
 
@@ -284,7 +298,10 @@
 #ifdef DEBUG
 		cout << "SQLiteBase::executeStatement: couldn't format statement" << endl;
 #endif
-		close(pDatabase);
+		if (m_onDemand == true)
+		{
+			close();
+		}
 		return NULL;
 	}
 	if (numChars >= 2048)
@@ -293,7 +310,10 @@
 #ifdef DEBUG
 		cout << "SQLiteBase::executeStatement: not enough space (" << numChars << ")" << endl;
 #endif
-		close(pDatabase);
+		if (m_onDemand == true)
+		{
+			close();
+		}
 		return NULL;
 	}
 	stringBuff[numChars] = '\0';
@@ -304,7 +324,10 @@
 #ifdef DEBUG
 		cout << "SQLiteBase::executeStatement: couldn't format statement" << endl;
 #endif
-		close(pDatabase);
+		if (m_onDemand == true)
+		{
+			close();
+		}
 		return NULL;
 	}
 #endif
@@ -312,7 +335,7 @@
 	char **results;
 	char *errMsg;
 	int nRows, nColumns;
-	if (sqlite3_get_table(pDatabase,
+	if (sqlite3_get_table(m_pDatabase,
 			stringBuff,
 			&results,
 			&nRows,
@@ -334,7 +357,10 @@
 #ifndef _USE_VSNPRINTF
 	sqlite3_free(stringBuff);
 #endif
-	close(pDatabase);
+	if (m_onDemand == true)
+	{
+		close();
+	}
 
 	return pResults;
 }

Modified: trunk/SQL/SQLiteBase.h
===================================================================
--- trunk/SQL/SQLiteBase.h	2007-05-18 13:42:48 UTC (rev 835)
+++ trunk/SQL/SQLiteBase.h	2007-05-18 13:45:32 UTC (rev 836)
@@ -74,19 +74,21 @@
 class SQLiteBase
 {
 	public:
-		SQLiteBase(const string &database);
+		SQLiteBase(const string &database, bool onDemand = true);
 		virtual ~SQLiteBase();
 
 		static bool check(const string &database);
 
-		bool executeSimpleStatement(const string &sql) const;
-		SQLiteResults *executeStatement(const char *sqlFormat, ...) const;
+		bool executeSimpleStatement(const string &sql);
+		SQLiteResults *executeStatement(const char *sqlFormat, ...);
 
 	protected:
 		string m_databaseName;
+		bool m_onDemand;
+		sqlite3 *m_pDatabase;
 
-		sqlite3 *open(const string &database) const;
-		void close(sqlite3 *pDatabase) const;
+		void open(const string &database);
+		void close(void);
 
 	private:
 		SQLiteBase(const SQLiteBase &other);

Modified: trunk/SQL/ViewHistory.cpp
===================================================================
--- trunk/SQL/ViewHistory.cpp	2007-05-18 13:42:48 UTC (rev 835)
+++ trunk/SQL/ViewHistory.cpp	2007-05-18 13:45:32 UTC (rev 836)
@@ -100,7 +100,7 @@
 }
 
 /// Checks if an URL is in the history.
-bool ViewHistory::hasItem(const string &url) const
+bool ViewHistory::hasItem(const string &url)
 {
 	bool success = false;
 
@@ -127,7 +127,7 @@
 }
 
 /// Returns the number of items.
-unsigned int ViewHistory::getItemsCount(void) const
+unsigned int ViewHistory::getItemsCount(void)
 {
 	unsigned int count = 0;
 

Modified: trunk/SQL/ViewHistory.h
===================================================================
--- trunk/SQL/ViewHistory.h	2007-05-18 13:42:48 UTC (rev 835)
+++ trunk/SQL/ViewHistory.h	2007-05-18 13:45:32 UTC (rev 836)
@@ -40,10 +40,10 @@
 		bool insertItem(const string &url);
 
 		/// Checks if an URL is in the history.
-		bool hasItem(const string &url) const;
+		bool hasItem(const string &url);
 
 		/// Returns the number of items.
-		unsigned int getItemsCount(void) const;
+		unsigned int getItemsCount(void);
 
 		/// Deletes an URL.
 		bool deleteItem(const string &url);



From fabricecolin at mail.berlios.de  Fri May 18 15:50:26 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Fri, 18 May 2007 15:50:26 +0200
Subject: [Pinot-svn] r837 - trunk/UI/GTK2/src
Message-ID: <200705181350.l4IDoQij016400@sheep.berlios.de>

Author: fabricecolin
Date: 2007-05-18 15:50:26 +0200 (Fri, 18 May 2007)
New Revision: 837

Modified:
   trunk/UI/GTK2/src/DaemonState.cpp
   trunk/UI/GTK2/src/DaemonState.h
   trunk/UI/GTK2/src/pinot-dbus-daemon.cc
Log:
When the index has to be replaced, close and overwrite it instead of deleting
all documents.
Do an upgrade if the index is older than PINOT_INDEX_MIN_VERSION or its format
has been obsoleted.


Modified: trunk/UI/GTK2/src/DaemonState.cpp
===================================================================
--- trunk/UI/GTK2/src/DaemonState.cpp	2007-05-18 13:45:32 UTC (rev 836)
+++ trunk/UI/GTK2/src/DaemonState.cpp	2007-05-18 13:50:26 UTC (rev 837)
@@ -76,12 +76,12 @@
 		// Monitoring is not necessary, but we still have to pass the handler
 		// so that we can act on documents that have been deleted
 		pScannerThread = new DirectoryScannerThread(locationToCrawl, isSource,
-			0, true, NULL, m_pDiskHandler);
+			NULL, m_pDiskHandler);
 	}
 	else
 	{
 		pScannerThread = new DirectoryScannerThread(locationToCrawl, isSource,
-			0, true, m_pDiskMonitor, m_pDiskHandler);
+			m_pDiskMonitor, m_pDiskHandler);
 	}
 	pScannerThread->getFileFoundSignal().connect(SigC::slot(*this, &DaemonState::on_message_filefound));
 
@@ -95,32 +95,11 @@
 	return false;
 }
 
-void DaemonState::start(bool doUpgrade)
+void DaemonState::start(void)
 {
 	// Disable implicit flushing after a change
 	WorkerThread::immediateFlush(false);
 
-	// Reset the index ?
-	if (doUpgrade == true)
-	{
-		XapianIndex daemonIndex(PinotSettings::getInstance().m_daemonIndexLocation);
-
-		if (daemonIndex.unindexAllDocuments() == true)
-		{
-			CrawlHistory history(PinotSettings::getInstance().m_historyDatabase);
-			map<unsigned int, string> sources;
-
-			// ...and the history
-			history.getSources(sources);
-			for (std::map<unsigned int, string>::iterator sourceIter = sources.begin();
-				sourceIter != sources.end(); ++sourceIter)
-			{
-				history.deleteItems(sourceIter->first);
-				history.deleteSource(sourceIter->first);
-			}
-		}
-	}
-
 	// Fire up the mail monitor thread now
 	m_pMailHandler = new MboxHandler();
 	MonitorThread *pMailMonitorThread = new MonitorThread(m_pMailMonitor, m_pMailHandler);

Modified: trunk/UI/GTK2/src/DaemonState.h
===================================================================
--- trunk/UI/GTK2/src/DaemonState.h	2007-05-18 13:45:32 UTC (rev 836)
+++ trunk/UI/GTK2/src/DaemonState.h	2007-05-18 13:50:26 UTC (rev 837)
@@ -33,7 +33,7 @@
 		DaemonState();
 		virtual ~DaemonState();
 
-		void start(bool doUpgrade);
+		void start(void);
 
 		void signal_scanner(void);
 

Modified: trunk/UI/GTK2/src/pinot-dbus-daemon.cc
===================================================================
--- trunk/UI/GTK2/src/pinot-dbus-daemon.cc	2007-05-18 13:45:32 UTC (rev 836)
+++ trunk/UI/GTK2/src/pinot-dbus-daemon.cc	2007-05-18 13:50:26 UTC (rev 837)
@@ -171,7 +171,8 @@
 	string prefixDir(PREFIX);
 	struct sigaction newAction;
 	int longOptionIndex = 0, priority = 15;
-	bool doUpgrade = false;
+	bool overwriteIndex = false;
+	bool upgradeIndex = false;
 
 	// Look at the options
 	int optionChar = getopt_long(argc, argv, "hpv", g_longOptions, &longOptionIndex);
@@ -329,6 +330,7 @@
 		cerr << "Couldn't open index " << settings.m_daemonIndexLocation << endl;
 		return EXIT_FAILURE;
 	}
+	upgradeIndex = pDb->wasObsoleteFormat();
 
 	// Do the same for the history database
 	if ((settings.m_historyDatabase.empty() == true) ||
@@ -371,12 +373,13 @@
 		double indexVersion = daemonIndex.getVersion();
 
 		// Is an upgrade necessary ?
-		if (indexVersion < 0.72)
+		if ((indexVersion < PINOT_INDEX_MIN_VERSION) &&
+			(daemonIndex.getDocumentsCount() > 0))
 		{
 			cout << "Upgrading index from version " << indexVersion << " to " << daemonVersion << endl;
 
 			// Yes, it is
-			doUpgrade = true;
+			overwriteIndex = upgradeIndex = true;
 		}
 		daemonIndex.setVersion(daemonVersion);
 	}
@@ -425,8 +428,30 @@
 			// Connect to threads' finished signal
 			server.connect();
 
-			server.start(doUpgrade);
+			if (overwriteIndex == true)
+			{
+				// Close and overwrite the index
+				XapianDatabaseFactory::closeAll();
+				XapianDatabaseFactory::getDatabase(settings.m_daemonIndexLocation, false, true);
+			}
 
+			if (upgradeIndex == true)
+			{
+				CrawlHistory history(PinotSettings::getInstance().m_historyDatabase);
+				map<unsigned int, string> sources;
+
+				// Reset the history
+				history.getSources(sources);
+				for (std::map<unsigned int, string>::iterator sourceIter = sources.begin();
+					sourceIter != sources.end(); ++sourceIter)
+				{
+					history.deleteItems(sourceIter->first);
+					history.deleteSource(sourceIter->first);
+				}
+			}
+
+			server.start();
+
 			// Run the main loop
 			g_refMainLoop->run();
 



From fabricecolin at mail.berlios.de  Fri May 18 15:52:23 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Fri, 18 May 2007 15:52:23 +0200
Subject: [Pinot-svn] r838 - trunk/UI/GTK2/src
Message-ID: <200705181352.l4IDqN8J016698@sheep.berlios.de>

Author: fabricecolin
Date: 2007-05-18 15:52:23 +0200 (Fri, 18 May 2007)
New Revision: 838

Modified:
   trunk/UI/GTK2/src/pinot.cc
Log:
Recommend updating My Web Pages is the index's format is obsolete or it's older
than PINOT_INDEX_MIN_VERSION.


Modified: trunk/UI/GTK2/src/pinot.cc
===================================================================
--- trunk/UI/GTK2/src/pinot.cc	2007-05-18 13:50:26 UTC (rev 837)
+++ trunk/UI/GTK2/src/pinot.cc	2007-05-18 13:52:23 UTC (rev 838)
@@ -112,6 +112,7 @@
 	Glib::ustring errorMsg;
 	struct sigaction newAction;
 	int longOptionIndex = 0;
+	bool upgradeIndex = false;
 
 	// Look at the options
 	int optionChar = getopt_long(argc, argv, "hv", g_longOptions, &longOptionIndex);
@@ -264,6 +265,10 @@
 		errorMsg += " ";
 		errorMsg += settings.m_docsIndexLocation;
 	}
+	else
+	{
+		upgradeIndex = pFirstDb->wasObsoleteFormat();
+	}
 	// ...and the daemon index in read-only mode
 	// If it can't be open, it just means the daemon has not yet created it
 	XapianDatabase *pSecondDb = XapianDatabaseFactory::getDatabase(settings.m_daemonIndexLocation);
@@ -305,16 +310,21 @@
 		double indexVersion = docsIndex.getVersion();
 
 		// Is an upgrade necessary ?
-		if ((indexVersion <= 0.70) &&
+		if ((indexVersion < PINOT_INDEX_MIN_VERSION) &&
 			(docsIndex.getDocumentsCount() > 0))
 		{
 			// Yes, it is
-			// FIXME: use a popup ! 
-			errorMsg = _("Updating all documents in My Web Pages is recommended");
+			upgradeIndex = true;
 		}
 		docsIndex.setVersion(uiVersion);
 	}
 
+	if ((upgradeIndex == true) &&
+		(errorMsg.empty() == true))
+	{
+		errorMsg = _("Updating all documents in My Web Pages is recommended");
+	}
+
 	try
 	{
 		// Set an icon for all windows
@@ -324,6 +334,7 @@
 		mainWindow mainBox;
 		if (errorMsg.empty() == false)
 		{
+			// FIXME: use a popup ! 
 			mainBox.set_status(errorMsg);
 		}
 		m.run(mainBox);



From fabricecolin at mail.berlios.de  Sat May 19 12:54:08 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 19 May 2007 12:54:08 +0200
Subject: [Pinot-svn] r839 - trunk/UI/GTK2/src
Message-ID: <200705191054.l4JAs8j2014482@sheep.berlios.de>

Author: fabricecolin
Date: 2007-05-19 12:54:06 +0200 (Sat, 19 May 2007)
New Revision: 839

Modified:
   trunk/UI/GTK2/src/DaemonState.cpp
   trunk/UI/GTK2/src/DaemonState.h
   trunk/UI/GTK2/src/ServerThreads.cpp
   trunk/UI/GTK2/src/ServerThreads.h
Log:
Only full scans check for files that have been deleted while the daemon wasn't
running, and they should now happen roughly one time out of three.
Refactored DBusServletThread a bit, added method runQuery().


Modified: trunk/UI/GTK2/src/DaemonState.cpp
===================================================================
--- trunk/UI/GTK2/src/DaemonState.cpp	2007-05-18 13:52:23 UTC (rev 838)
+++ trunk/UI/GTK2/src/DaemonState.cpp	2007-05-19 10:54:06 UTC (rev 839)
@@ -16,6 +16,7 @@
  *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
  */
 
+#include <stdlib.h>
 #include <iostream>
 #include <sigc++/class_slot.h>
 #include <sigc++/compatibility.h>
@@ -24,6 +25,7 @@
 #include <glibmm/stringutils.h>
 #include <glibmm/convert.h>
 #include <glibmm/thread.h>
+#include <glibmm/random.h>
 
 #include "Url.h"
 #include "MonitorFactory.h"
@@ -40,6 +42,7 @@
 
 DaemonState::DaemonState() :
 	ThreadsManager(PinotSettings::getInstance().m_daemonIndexLocation, 20),
+	m_fullScan(false),
 	m_pMailMonitor(MonitorFactory::getMonitor()),
 	m_pDiskMonitor(MonitorFactory::getMonitor()),
 	m_pMailHandler(NULL),
@@ -75,12 +78,12 @@
 	{
 		// Monitoring is not necessary, but we still have to pass the handler
 		// so that we can act on documents that have been deleted
-		pScannerThread = new DirectoryScannerThread(locationToCrawl, isSource,
+		pScannerThread = new DirectoryScannerThread(locationToCrawl, isSource, m_fullScan,
 			NULL, m_pDiskHandler);
 	}
 	else
 	{
-		pScannerThread = new DirectoryScannerThread(locationToCrawl, isSource,
+		pScannerThread = new DirectoryScannerThread(locationToCrawl, isSource, m_fullScan,
 			m_pDiskMonitor, m_pDiskHandler);
 	}
 	pScannerThread->getFileFoundSignal().connect(SigC::slot(*this, &DaemonState::on_message_filefound));
@@ -97,9 +100,21 @@
 
 void DaemonState::start(void)
 {
+	Rand randomStuff;
+
 	// Disable implicit flushing after a change
 	WorkerThread::immediateFlush(false);
 
+	// Do full scans ?
+	int randomNum = randomStuff.get_int_range(0, 10);
+	if (randomNum >= 7)
+	{
+		m_fullScan = true;
+	}
+#ifdef DEBUG
+	cout << "DaemonState::start: picked " << randomNum << endl;
+#endif
+
 	// Fire up the mail monitor thread now
 	m_pMailHandler = new MboxHandler();
 	MonitorThread *pMailMonitorThread = new MonitorThread(m_pMailMonitor, m_pMailHandler);

Modified: trunk/UI/GTK2/src/DaemonState.h
===================================================================
--- trunk/UI/GTK2/src/DaemonState.h	2007-05-18 13:52:23 UTC (rev 838)
+++ trunk/UI/GTK2/src/DaemonState.h	2007-05-19 10:54:06 UTC (rev 839)
@@ -45,6 +45,7 @@
 		SigC::Signal1<void, int>& getQuitSignal(void);
 
 	protected:
+		bool m_fullScan;
 		MonitorInterface *m_pMailMonitor;
 		MonitorInterface *m_pDiskMonitor;
 		MonitorHandler *m_pMailHandler;

Modified: trunk/UI/GTK2/src/ServerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/ServerThreads.cpp	2007-05-18 13:52:23 UTC (rev 838)
+++ trunk/UI/GTK2/src/ServerThreads.cpp	2007-05-19 10:54:06 UTC (rev 839)
@@ -35,6 +35,7 @@
 
 #include "Languages.h"
 #include "TimeConverter.h"
+#include "Timer.h"
 #include "Url.h"
 #include "DBusXapianIndex.h"
 #include "XapianIndex.h"
@@ -351,16 +352,17 @@
 }
 
 DirectoryScannerThread::DirectoryScannerThread(const string &dirName, bool isSource,
-	unsigned int maxLevel, bool followSymLinks,
-	MonitorInterface *pMonitor, MonitorHandler *pHandler) :
+	bool fullScan, MonitorInterface *pMonitor, MonitorHandler *pHandler,
+	unsigned int maxLevel, bool followSymLinks) :
 	WorkerThread(),
 	m_dirName(dirName),
-	m_maxLevel(maxLevel),
-	m_followSymLinks(followSymLinks),
+	m_fullScan(fullScan),
 	m_pMonitor(pMonitor),
 	m_pHandler(pHandler),
+	m_sourceId(0),
 	m_currentLevel(0),
-	m_sourceId(0)
+	m_maxLevel(maxLevel),
+	m_followSymLinks(followSymLinks)
 {
 	if (m_dirName.empty() == false)
 	{
@@ -437,6 +439,28 @@
 	return m_signalFileFound;
 }
 
+void DirectoryScannerThread::cacheUpdate(const string &location, time_t mTime,
+	CrawlHistory &history)
+{
+	m_updateCache[location] = mTime;
+
+	if (m_updateCache.size() > 500)
+	{
+		flushUpdates(history);
+	}
+}
+
+void DirectoryScannerThread::flushUpdates(CrawlHistory &history)
+{
+	// Update these records
+	history.updateItems(m_updateCache, CrawlHistory::CRAWLED);
+	m_updateCache.clear();
+
+#ifdef DEBUG
+	cout << "DirectoryScannerThread::flushUpdates: flushed updates" << endl;
+#endif
+}
+
 void DirectoryScannerThread::foundFile(const DocumentInfo &docInfo)
 {
 	char labelStr[64];
@@ -460,7 +484,7 @@
 	time_t itemDate;
 	struct stat fileStat;
 	int statSuccess = 0;
-	bool scanSuccess = true, reportFile = false;
+	bool scanSuccess = true, reportFile = false, itemExists = false;
 
 	if (entryName.empty() == true)
 	{
@@ -491,7 +515,7 @@
 	}
 
 	// Is this item in the database already ?
-	bool itemExists = history.hasItem(location, status, itemDate);
+	itemExists = history.hasItem(location, status, itemDate);
 
 	if (statSuccess == -1)
 	{
@@ -626,18 +650,25 @@
 		}
 		else
 		{
-			// Update the record
-			history.updateItem(location, CrawlHistory::CRAWLED, fileStat.st_mtime);
-
-			// Was it last crawled after it was modified ?
+			// Was it modified after the last crawl ?
 			if (itemDate >= fileStat.st_mtime)
 			{
-				// Yes, it was
+				// No, it wasn't
 				reportFile = false;
 			}
+
+			// History of modified files, especially the timestamp, is always updated
+			// Others' are updated only if we are doing a full scan because
+			// the status has to be reset to CRAWLED, so that they are not unindexed
+			if ((reportFile == true) ||
+				(m_fullScan == true))
+			{
 #ifdef DEBUG
-			else cout << "DirectoryScannerThread::scanEntry: reporting modified file " << entryName << endl;
+				cout << "DirectoryScannerThread::scanEntry: updating " << entryName << endl;
 #endif
+				cacheUpdate(location, fileStat.st_mtime, history);
+			}
+
 		}
 
 		if (reportFile == true)
@@ -664,14 +695,21 @@
 {
 	CrawlHistory history(PinotSettings::getInstance().m_historyDatabase);
 	set<string> deletedFiles;
+	Timer scanTimer;
 
 	if (m_dirName.empty() == true)
 	{
 		return;
 	}
+	scanTimer.start();
 
-	// Update this source's items status
-	history.updateItemsStatus(m_sourceId, CrawlHistory::CRAWLED, CrawlHistory::CRAWLING);
+	if (m_fullScan == true)
+	{
+		cout << "Doing a full scan on " << m_dirName << endl;
+
+		// Update this source's items status so that we can detect files that have been deleted
+		history.updateItemsStatus(m_sourceId, CrawlHistory::CRAWLED, CrawlHistory::CRAWLING);
+	}
 	// Remove errors
 	history.deleteItems(m_sourceId, CrawlHistory::ERROR);
 
@@ -681,6 +719,7 @@
 		m_status += " ";
 		m_status += m_dirName;
 	}
+	flushUpdates(history);
 
 	if (m_done == true)
 	{
@@ -690,28 +729,29 @@
 		return;
 	}
 
-	// All files with status set to CRAWLING were not found in this crawl
-	// Chances are they were removed after the previous crawl
-	if ((m_pHandler != NULL) &&
-		(history.getSourceItems(m_sourceId, CrawlHistory::CRAWLING, deletedFiles) > 0))
+	if (m_fullScan == true)
 	{
+		// All files with status set to CRAWLING were not found in this crawl
+		// Chances are they were removed after the last full scan
+		if ((m_pHandler != NULL) &&
+			(history.getSourceItems(m_sourceId, CrawlHistory::CRAWLING, deletedFiles) > 0))
+		{
 #ifdef DEBUG
-		cout << "DirectoryScannerThread::doWork: " << deletedFiles.size() << " files were deleted" << endl;
+			cout << "DirectoryScannerThread::doWork: " << deletedFiles.size() << " files were deleted" << endl;
 #endif
-		for(set<string>::const_iterator fileIter = deletedFiles.begin();
-			fileIter != deletedFiles.end(); ++fileIter)
-		{
-			// Inform the MonitorHandler
-			if (m_pHandler->fileDeleted(fileIter->substr(7)) == true)
+			for(set<string>::const_iterator fileIter = deletedFiles.begin();
+				fileIter != deletedFiles.end(); ++fileIter)
 			{
-				// Delete this item
-				history.deleteItem(*fileIter);
+				// Inform the MonitorHandler
+				if (m_pHandler->fileDeleted(fileIter->substr(7)) == true)
+				{
+					// Delete this item
+					history.deleteItem(*fileIter);
+				}
 			}
 		}
 	}
-#ifdef DEBUG
-	cout << "DirectoryScannerThread::doWork: done crawling " << m_dirName << endl;
-#endif
+	cout << "Scanned " << m_dirName << " in " << scanTimer.stop()/1000 << " ms" << endl;
 }
 
 DBusServletThread::DBusServletThread(DaemonState *pServer, DBusConnection *pConnection, DBusMessage *pRequest) :
@@ -768,11 +808,44 @@
 	return m_mustQuit;
 }
 
+bool DBusServletThread::runQuery(QueryProperties &queryProps, unsigned int maxHits,
+	vector<string> &docIds)
+{
+	XapianEngine engine(PinotSettings::getInstance().m_daemonIndexLocation);
+
+	// Run the query
+	engine.setMaxResultsCount(maxHits);
+	if (engine.runQuery(queryProps) == false)
+	{
+		return false;
+	}
+
+	docIds.clear();
+
+	const vector<DocumentInfo> &resultsList = engine.getResults();
+	for (vector<DocumentInfo>::const_iterator resultIter = resultsList.begin();
+		resultIter != resultsList.end(); ++resultIter)
+	{
+		unsigned int indexId = 0;
+		unsigned int docId = resultIter->getIsIndexed(indexId);
+
+		// We only need the document ID
+		if (docId > 0)
+		{
+			char docIdStr[64];
+
+			snprintf(docIdStr, 64, "%u", docId);
+			docIds.push_back(docIdStr);
+		}
+	}
+
+	return true;
+}
+
 void DBusServletThread::doWork(void)
 {
 	XapianIndex index(PinotSettings::getInstance().m_daemonIndexLocation);
 	DBusError error;
-	const char *pSender = dbus_message_get_sender(m_pRequest);
 	bool processedMessage = true, flushIndex = false;
 
 	if ((m_pServer == NULL) ||
@@ -785,6 +858,7 @@
 	dbus_error_init(&error);
 
 #ifdef DEBUG
+	const char *pSender = dbus_message_get_sender(m_pRequest);
 	if (pSender != NULL)
 	{
 		cout << "DBusServletThread::doWork: called by " << pSender << endl;
@@ -1087,7 +1161,6 @@
 			DBUS_TYPE_UINT32, &maxHits,
 			DBUS_TYPE_INVALID) == TRUE)
 		{
-			XapianEngine engine(PinotSettings::getInstance().m_daemonIndexLocation);
 			bool replyWithError = true;
 
 #ifdef DEBUG
@@ -1096,33 +1169,19 @@
 			if (pSearchText != NULL)
 			{
 				QueryProperties queryProps("DBUS", pSearchText);
+				vector<string> docIds;
 
 				// Run the query
-				engine.setMaxResultsCount(maxHits);
-				if (engine.runQuery(queryProps) == true)
+				if (runQuery(queryProps, maxHits, docIds) == true)
 				{
-					const vector<DocumentInfo> &resultsList = engine.getResults();
-					vector<string> docIds;
 					m_pArray = g_ptr_array_new();
 
-					for (vector<DocumentInfo>::const_iterator resultIter = resultsList.begin();
-						resultIter != resultsList.end(); ++resultIter)
-					{
-						// We only need the document ID
-						unsigned int docId = index.hasDocument(resultIter->getLocation());
-						if (docId > 0)
-						{
-							char docIdStr[64];
-							snprintf(docIdStr, 64, "%u", docId);
-							docIds.push_back(docIdStr);
-						}
-					}
-
 					for (vector<string>::const_iterator docIter = docIds.begin();
 						docIter != docIds.end(); ++docIter)
 					{
 #ifdef DEBUG
-						cout << "DBusServletThread::doWork: adding result " << m_pArray->len << " " << *docIter << endl;
+						cout << "DBusServletThread::doWork: adding result "
+							<< m_pArray->len << " " << *docIter << endl;
 #endif
 						g_ptr_array_add(m_pArray, const_cast<char*>(docIter->c_str()));
 					}

Modified: trunk/UI/GTK2/src/ServerThreads.h
===================================================================
--- trunk/UI/GTK2/src/ServerThreads.h	2007-05-18 13:52:23 UTC (rev 838)
+++ trunk/UI/GTK2/src/ServerThreads.h	2007-05-19 10:54:06 UTC (rev 839)
@@ -20,6 +20,7 @@
 #define _SERVERTHREADS_HH
 
 #include <string>
+#include <vector>
 extern "C"
 {
 #define DBUS_API_SUBJECT_TO_CHANGE
@@ -36,6 +37,8 @@
 #include "CrawlHistory.h"
 #include "MonitorInterface.h"
 #include "MonitorHandler.h"
+#include "QueryProperties.h"
+#include "DaemonState.h"
 #include "WorkerThreads.h"
 
 class MonitorThread : public WorkerThread
@@ -70,8 +73,8 @@
 {
 	public:
 		DirectoryScannerThread(const std::string &dirName, bool isSource,
-			unsigned int maxLevel, bool followSymLinks,
-			MonitorInterface *pMonitor, MonitorHandler *pHandler);
+			bool fullScan, MonitorInterface *pMonitor, MonitorHandler *pHandler,
+			unsigned int maxLevel = 0, bool followSymLinks = true);
 		virtual ~DirectoryScannerThread();
 
 		virtual std::string getType(void) const;
@@ -84,14 +87,18 @@
 
 	protected:
 		std::string m_dirName;
-		unsigned int m_maxLevel;
-		bool m_followSymLinks;
+		bool m_fullScan;
 		MonitorInterface *m_pMonitor;
 		MonitorHandler *m_pHandler;
+		unsigned int m_sourceId;
 		unsigned int m_currentLevel;
-		unsigned int m_sourceId;
+		unsigned int m_maxLevel;
+		bool m_followSymLinks;
 		SigC::Signal3<void, const DocumentInfo&, const std::string&, bool> m_signalFileFound;
+		std::map<std::string, time_t> m_updateCache;
 
+		void cacheUpdate(const std::string &location, time_t mTime, CrawlHistory &history);
+		void flushUpdates(CrawlHistory &history);
 		void foundFile(const DocumentInfo &docInfo);
 		bool scanEntry(const std::string &entryName, CrawlHistory &history);
 		virtual void doWork(void);
@@ -126,6 +133,9 @@
 		GPtrArray *m_pArray;
 		bool m_mustQuit;
 
+		bool runQuery(QueryProperties &queryProps, unsigned int maxHits,
+			std::vector<std::string> &docIds);
+
 		virtual void doWork(void);
 
 	private:



From fabricecolin at mail.berlios.de  Tue May 22 13:13:47 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 22 May 2007 13:13:47 +0200
Subject: [Pinot-svn] r840 - trunk/UI/GTK2/src
Message-ID: <200705221113.l4MBDlJL010717@sheep.berlios.de>

Author: fabricecolin
Date: 2007-05-22 13:13:46 +0200 (Tue, 22 May 2007)
New Revision: 840

Modified:
   trunk/UI/GTK2/src/WorkerThreads.cpp
Log:
Look out for ultra-rare case when SQLite fails to delete an item and
ActionQueue::popItem() returns the same thing repeatedly. The root cause is
unknown.


Modified: trunk/UI/GTK2/src/WorkerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.cpp	2007-05-19 10:54:06 UTC (rev 839)
+++ trunk/UI/GTK2/src/WorkerThreads.cpp	2007-05-22 11:13:46 UTC (rev 840)
@@ -536,20 +536,36 @@
 			ActionQueue queue(PinotSettings::getInstance().m_historyDatabase, get_application_name());
 			ActionQueue::ActionType type;
 			DocumentInfo docInfo;
+			string previousLocation;
 
 			while (queue.popItem(type, docInfo) == true)
 			{
+				ustring status;
+
 				if (type != ActionQueue::INDEX)
 				{
 					continue;
 				}
 
-				ustring status = index_document(docInfo);
+				if (docInfo.getLocation() == previousLocation)
+				{
+					// Something dodgy is going on, we got the same item twice !
+					status = previousLocation;
+					status += " ";
+					status += _("is already being indexed");
+				}
+				else
+				{
+					status = index_document(docInfo);
+				}
+
 				if (status.empty() == true)
 				{
 					foundItem = true;
 					break;
 				}
+
+				previousLocation = docInfo.getLocation();
 			}
 		}
 	}



From fabricecolin at mail.berlios.de  Tue May 22 13:16:04 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 22 May 2007 13:16:04 +0200
Subject: [Pinot-svn] r841 - trunk/Search
Message-ID: <200705221116.l4MBG4Tp014342@sheep.berlios.de>

Author: fabricecolin
Date: 2007-05-22 13:16:03 +0200 (Tue, 22 May 2007)
New Revision: 841

Modified:
   trunk/Search/XapianEngine.cpp
Log:
Stemming strategy was messed up.
Set FLAG_PURE_NOT if Xapian >= 1.0.


Modified: trunk/Search/XapianEngine.cpp
===================================================================
--- trunk/Search/XapianEngine.cpp	2007-05-22 11:13:46 UTC (rev 840)
+++ trunk/Search/XapianEngine.cpp	2007-05-22 11:16:03 UTC (rev 841)
@@ -205,13 +205,13 @@
 	if (stemLanguage.empty() == false)
 	{
 		stemmer = Xapian::Stem(StringManip::toLowerCase(stemLanguage));
-		parser.set_stemming_strategy(Xapian::QueryParser::STEM_NONE);
+		parser.set_stemming_strategy(Xapian::QueryParser::STEM_ALL);
+		parser.set_stemmer(stemmer);
 	}
 	else
 	{
-		parser.set_stemming_strategy(Xapian::QueryParser::STEM_ALL);
+		parser.set_stemming_strategy(Xapian::QueryParser::STEM_NONE);
 	}
-	parser.set_stemmer(stemmer);
 	if (followOperators == true)
 	{
 		parser.set_default_op(Xapian::Query::OP_AND);
@@ -293,7 +293,14 @@
 
 	// Activate all options and parse
 	Xapian::Query parsedQuery = parser.parse_query(freeQuery,
-		Xapian::QueryParser::FLAG_BOOLEAN|Xapian::QueryParser::FLAG_PHRASE|Xapian::QueryParser::FLAG_LOVEHATE|Xapian::QueryParser::FLAG_BOOLEAN_ANY_CASE|Xapian::QueryParser::FLAG_WILDCARD);
+		Xapian::QueryParser::FLAG_BOOLEAN|Xapian::QueryParser::FLAG_PHRASE|
+		Xapian::QueryParser::FLAG_LOVEHATE|Xapian::QueryParser::FLAG_BOOLEAN_ANY_CASE|
+#if XAPIAN_MAJOR_VERSION==0
+		Xapian::QueryParser::FLAG_WILDCARD
+#else
+		Xapian::QueryParser::FLAG_WILDCARD|Xapian::QueryParser::FLAG_PURE_NOT
+#endif
+		);
 	// Apply a date range ?
 	bool enableMin = queryProps.getMinimumDate(minDay, minMonth, minYear);
 	bool enableMax = queryProps.getMaximumDate(maxDay, maxMonth, maxYear);



From fabricecolin at mail.berlios.de  Tue May 22 13:18:16 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 22 May 2007 13:18:16 +0200
Subject: [Pinot-svn] r842 - trunk
Message-ID: <200705221118.l4MBIGep020514@sheep.berlios.de>

Author: fabricecolin
Date: 2007-05-22 13:18:08 +0200 (Tue, 22 May 2007)
New Revision: 842

Modified:
   trunk/TODO
Log:
-3 +3 items.


Modified: trunk/TODO
===================================================================
--- trunk/TODO	2007-05-22 11:16:03 UTC (rev 841)
+++ trunk/TODO	2007-05-22 11:18:08 UTC (rev 842)
@@ -48,8 +48,6 @@
 - Implement AutoDiscovery of OpenSearch Description files (http://opensearch.a9.com/spec/1.1/description/)
 - Make sure Description files' SyndicationRight is not private or closed
 - Support for Google Buttons
-- Export search results as OpenSearch Response or CSV
-- Nested queries
 - Get hold of stopwords lists for the languages supported by Xapian's stemmers
  and remove stopwords from queries as first step of search
 - Make multi-step index search optional
@@ -69,7 +67,7 @@
 - XapianIndex could do with some common code refactoring
 - With Xapian 1.0, all indexes can be browsed with the new global posting list, ie
   Xapian::Database::postlist_begin("")
-- Use Xapian new TextSplitter class
+- Use Xapian's new TermGenerator class
 - Index Nautilus metadata (http://linuxboxadmin.com/articles/nautilus.php)
 - Automatically categorize documents based on MIME type and source into picture, video, etc...
 - Does updateDocumentInfo sometimes fail to remove terms from the old title ?
@@ -100,6 +98,7 @@
 - Allow notifications when configuration should be reloaded
 - Implement Xesam draft(s)
 - SimpleQuery to switch multi-step search on
+- Enable to deactivate D-Bus interface
 
 UI
 - When sorting results by host name, give better score to results that appear
@@ -117,7 +116,6 @@
  Viewed icon
 - Set results' indexed status after IndexingThread returns
 - Show date ranges in queries summary
-- Add Group By None to show all results at the same level
 - Make use of GTKmm 2.10 StatusIcon
 - Query expansion should be interactive
 - UI doesn't show documents indexed by the daemon the very first time it's run,
@@ -135,3 +133,6 @@
 - Add less than, equal to, greater than filters on size for stored queries
 - Allow filtering index lists with a stored query instead of just labels
 - Show with icons which stored queries are fully, partially or not at all Web friendly
+- Show document IDs in properties window
+- List viewed URLs
+



From fabricecolin at mail.berlios.de  Tue May 22 13:53:42 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 22 May 2007 13:53:42 +0200
Subject: [Pinot-svn] r843 - in trunk: . po
Message-ID: <200705221153.l4MBrgbW004147@sheep.berlios.de>

Author: fabricecolin
Date: 2007-05-22 13:53:33 +0200 (Tue, 22 May 2007)
New Revision: 843

Modified:
   trunk/AUTHORS
   trunk/NEWS
   trunk/README
   trunk/configure.in
   trunk/po/de.po
   trunk/po/es.po
   trunk/po/fr.po
   trunk/po/it.po
   trunk/po/nl.po
   trunk/po/pt.po
   trunk/po/pt_BR.po
   trunk/po/ru.po
   trunk/po/sv.po
Log:
0.73 release is close...


Modified: trunk/AUTHORS
===================================================================
--- trunk/AUTHORS	2007-05-22 11:18:08 UTC (rev 842)
+++ trunk/AUTHORS	2007-05-22 11:53:33 UTC (rev 843)
@@ -14,6 +14,7 @@
 	Gabriel C <nix dot or dot die at googlemail dot com> 
 	Roger Mason <rmason at esd dot mun dot ca>
 	Reuben Thomas <rrt at sc3d dot org> 
+	Marco Bazzani <visik7 at tin dot it>
 
 The file Monitor/linux-inotify-syscalls.h is originally from libinotify
 (Copyright ? 2005 Ryan Lortie <desrt at desrt dot ca>).
@@ -27,10 +28,12 @@
 Translations provided by :
 
 	Dutch - Tikkel <???>
+		& JW <jw00000 at gmail.com>
 	French - Nicolas Velin <nsv at fr dot st>
 	German - Christian Dywan <christian at twotoasts dot de>
 	Italian - Michele Angrisano <darksun1988 at gmail dot com>
 		& Vincenzo Consales <aquarius987 at gmail dot com>>
+		& Marco Bazzani <visik7 at tin dot it>
 	Portuguese - _PN_boy <pedro_nuno_pn at iol dot pt>
 	Portuguese (Brazil) - Leonardo Melo <leonardovazmelo at gmail dot com>
 	Russian - Sergey Vostrikov <memphis at jabber dot snc dot ru>

Modified: trunk/NEWS
===================================================================
--- trunk/NEWS	2007-05-22 11:18:08 UTC (rev 842)
+++ trunk/NEWS	2007-05-22 11:53:33 UTC (rev 843)
@@ -1,3 +1,19 @@
+??? version_0_7_3
+Tokenize :
+ - mbox filter was broken in previous release
+ - TagLib filter returns the file's name as title if no tag is found
+SQL :
+ - don't force opening and closing the database on every request
+Index :
+ - support for Xapian 1.0 API
+ - overwrite index on upgrades, it's faster than deleting all its documents
+Search :
+ - stemming wasn't activated when a language is set
+UI :
+ - fixed crash when unindexing documents
+ - updated Dutch translation by JW 
+ - updated Italian translation by Marco Bazzani
+
 2007/04/28 version_0_7_2
 General :
  - synced with gtk+'s xdgmime

Modified: trunk/README
===================================================================
--- trunk/README	2007-05-22 11:18:08 UTC (rev 842)
+++ trunk/README	2007-05-22 11:53:33 UTC (rev 843)
@@ -376,7 +376,7 @@
 SQLite							3.1.2
 http://www.sqlite.org/
 
-xapian-core						0.9.6
+xapian-core						0.9.9
 http://www.xapian.org/
 
 curl (1)						7.13.1

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2007-05-22 11:18:08 UTC (rev 842)
+++ trunk/configure.in	2007-05-22 11:53:33 UTC (rev 843)
@@ -2,7 +2,7 @@
 # using glademm V2.6.0
 
 AC_PREREQ(2.50)
-AC_INIT(pinot, 0.72,[fabricecolin at users.berlios.de])
+AC_INIT(pinot, 0.73,[fabricecolin at users.berlios.de])
 AM_INIT_AUTOMAKE
 AC_CONFIG_HEADERS(config.h)
 

Modified: trunk/po/de.po
===================================================================
--- trunk/po/de.po	2007-05-22 11:18:08 UTC (rev 842)
+++ trunk/po/de.po	2007-05-22 11:53:33 UTC (rev 843)
@@ -5,9 +5,9 @@
 #, fuzzy
 msgid ""
 msgstr ""
-"Project-Id-Version: pinot 0.72\n"
+"Project-Id-Version: pinot 0.73\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2007-04-27 23:44+0800\n"
+"POT-Creation-Date: 2007-05-19 19:02+0800\n"
 "PO-Revision-Date: 2007-04-13 15:30+0000\n"
 "Last-Translator: Christian Dywan <christian at twotoasts.de>\n"
 "Language-Team: German <de at li.org>\n"
@@ -24,6 +24,9 @@
 msgid "Current User"
 msgstr "Aktueller Benutzer"
 
+#. Bind the callback's parameter to the index name
+#. Enable these menu items unless it is not the documents index
+#. Internal indices
 #: UI/GTK2/src/EnginesTree.cpp:339 UI/GTK2/src/mainWindow.cc:324
 #: UI/GTK2/src/mainWindow.cc:327 UI/GTK2/src/mainWindow.cc:540
 #: UI/GTK2/src/mainWindow.cc:1027 UI/GTK2/src/mainWindow.cc:1198
@@ -31,18 +34,21 @@
 #: UI/GTK2/src/mainWindow.cc:1293 UI/GTK2/src/mainWindow.cc:1930
 #: UI/GTK2/src/PinotSettings.cpp:243 UI/GTK2/src/PinotSettings.cpp:1344
 #: UI/GTK2/src/PinotSettings.cpp:1400 UI/GTK2/src/statisticsDialog.cc:77
-#: UI/GTK2/src/WorkerThreads.cpp:811 UI/GTK2/src/WorkerThreads.cpp:870
+#: UI/GTK2/src/WorkerThreads.cpp:827 UI/GTK2/src/WorkerThreads.cpp:886
 msgid "My Web Pages"
 msgstr "Meine Webseiten"
 
+#. Populate the submenu
+#. Bind the callback's parameter to the index name
 #: UI/GTK2/src/EnginesTree.cpp:340 UI/GTK2/src/mainWindow.cc:318
 #: UI/GTK2/src/mainWindow.cc:321 UI/GTK2/src/mainWindow.cc:1034
 #: UI/GTK2/src/PinotSettings.cpp:244 UI/GTK2/src/PinotSettings.cpp:1345
 #: UI/GTK2/src/PinotSettings.cpp:1401 UI/GTK2/src/statisticsDialog.cc:82
-#: UI/GTK2/src/WorkerThreads.cpp:816 UI/GTK2/src/WorkerThreads.cpp:880
+#: UI/GTK2/src/WorkerThreads.cpp:832 UI/GTK2/src/WorkerThreads.cpp:896
 msgid "My Documents"
 msgstr "Meine Dokumente"
 
+#. The last column is for the timestamp
 #: UI/GTK2/src/dateDialog_glade.cc:76 UI/GTK2/src/queryDialog_glade.cc:91
 #: UI/GTK2/src/queryDialog_glade.cc:92 UI/GTK2/src/ResultsTree.cpp:151
 msgid "Date"
@@ -150,6 +156,7 @@
 msgid "Summary"
 msgstr ""
 
+#. Set tooltips
 #: UI/GTK2/src/mainWindow.cc:183
 msgid "Show all search engines"
 msgstr "Alle Suchmaschinen anzeigen"
@@ -162,6 +169,7 @@
 msgid "Remove index"
 msgstr "Index entfernen"
 
+#. Now we are ready
 #: UI/GTK2/src/mainWindow.cc:191
 msgid "Ready"
 msgstr "Bereit"
@@ -174,10 +182,12 @@
 msgid "Undefined"
 msgstr "Unbestimmt"
 
+#. Show the URL of the first result in the status bar
 #: UI/GTK2/src/mainWindow.cc:475
 msgid "Result location is"
 msgstr ""
 
+#. Show the URL in the status bar
 #: UI/GTK2/src/mainWindow.cc:550
 msgid "Document location is"
 msgstr ""
@@ -215,6 +225,7 @@
 msgid "Updated label(s)"
 msgstr ""
 
+#. Yes, it did
 #: UI/GTK2/src/mainWindow.cc:1208
 msgid "Updated document"
 msgstr "Dokument aktualisiert"
@@ -254,6 +265,7 @@
 msgid "Export Results"
 msgstr "Ergebnisse"
 
+#. Find this query
 #: UI/GTK2/src/mainWindow.cc:1827 UI/GTK2/src/mainWindow.cc:2491
 msgid "Live query"
 msgstr ""
@@ -262,13 +274,13 @@
 msgid "Couldn't find query"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:2045 UI/GTK2/src/WorkerThreads.cpp:628
-#: UI/GTK2/src/WorkerThreads.cpp:1623
+#: UI/GTK2/src/mainWindow.cc:2045 UI/GTK2/src/WorkerThreads.cpp:644
+#: UI/GTK2/src/WorkerThreads.cpp:1639
 msgid "Index"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:2049 UI/GTK2/src/WorkerThreads.cpp:632
-#: UI/GTK2/src/WorkerThreads.cpp:1627
+#: UI/GTK2/src/mainWindow.cc:2049 UI/GTK2/src/WorkerThreads.cpp:648
+#: UI/GTK2/src/WorkerThreads.cpp:1643
 msgid "doesn't exist"
 msgstr ""
 
@@ -450,71 +462,73 @@
 msgid "Pinot"
 msgstr ""
 
-#: UI/GTK2/src/pinot.cc:226 UI/GTK2/src/pinot-dbus-daemon.cc:294
+#. Localize language names
+#: UI/GTK2/src/pinot.cc:227 UI/GTK2/src/pinot-dbus-daemon.cc:295
 #: UI/GTK2/src/propertiesDialog.cc:60 UI/GTK2/src/propertiesDialog.cc:69
 msgid "Unknown"
 msgstr ""
 
-#: UI/GTK2/src/pinot.cc:227 UI/GTK2/src/pinot-dbus-daemon.cc:295
+#: UI/GTK2/src/pinot.cc:228 UI/GTK2/src/pinot-dbus-daemon.cc:296
 msgid "Danish"
 msgstr ""
 
-#: UI/GTK2/src/pinot.cc:228 UI/GTK2/src/pinot-dbus-daemon.cc:296
+#: UI/GTK2/src/pinot.cc:229 UI/GTK2/src/pinot-dbus-daemon.cc:297
 msgid "Dutch"
 msgstr ""
 
-#: UI/GTK2/src/pinot.cc:229 UI/GTK2/src/pinot-dbus-daemon.cc:297
+#: UI/GTK2/src/pinot.cc:230 UI/GTK2/src/pinot-dbus-daemon.cc:298
 msgid "English"
 msgstr "Englisch"
 
-#: UI/GTK2/src/pinot.cc:230 UI/GTK2/src/pinot-dbus-daemon.cc:298
+#: UI/GTK2/src/pinot.cc:231 UI/GTK2/src/pinot-dbus-daemon.cc:299
 msgid "Finnish"
 msgstr "Finnisch"
 
-#: UI/GTK2/src/pinot.cc:231 UI/GTK2/src/pinot-dbus-daemon.cc:299
+#: UI/GTK2/src/pinot.cc:232 UI/GTK2/src/pinot-dbus-daemon.cc:300
 msgid "French"
 msgstr "Franz?sisch"
 
-#: UI/GTK2/src/pinot.cc:232 UI/GTK2/src/pinot-dbus-daemon.cc:300
+#: UI/GTK2/src/pinot.cc:233 UI/GTK2/src/pinot-dbus-daemon.cc:301
 msgid "German"
 msgstr "Deutsch"
 
-#: UI/GTK2/src/pinot.cc:233 UI/GTK2/src/pinot-dbus-daemon.cc:301
+#: UI/GTK2/src/pinot.cc:234 UI/GTK2/src/pinot-dbus-daemon.cc:302
 msgid "Italian"
 msgstr "Italienisch"
 
-#: UI/GTK2/src/pinot.cc:234 UI/GTK2/src/pinot-dbus-daemon.cc:302
+#: UI/GTK2/src/pinot.cc:235 UI/GTK2/src/pinot-dbus-daemon.cc:303
 msgid "Norwegian"
 msgstr "Norwegisch"
 
-#: UI/GTK2/src/pinot.cc:235 UI/GTK2/src/pinot-dbus-daemon.cc:303
+#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:304
 msgid "Portuguese"
 msgstr "Portugiesisch"
 
-#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:304
+#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:305
 msgid "Russian"
 msgstr "Russisch"
 
-#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:305
+#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:306
 msgid "Spanish"
 msgstr "Spanisch"
 
-#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:306
+#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:307
 msgid "Swedish"
 msgstr "Schwedisch"
 
-#: UI/GTK2/src/pinot.cc:263
+#: UI/GTK2/src/pinot.cc:264
 msgid "Couldn't open index"
 msgstr "Konnte Index nicht ?ffnen"
 
-#: UI/GTK2/src/pinot.cc:279
+#: UI/GTK2/src/pinot.cc:284
 msgid "Couldn't create history database"
 msgstr ""
 
-#: UI/GTK2/src/pinot.cc:309
+#: UI/GTK2/src/pinot.cc:325
 msgid "Updating all documents in My Web Pages is recommended"
 msgstr ""
 
+#. Add default labels
 #: UI/GTK2/src/PinotSettings.cpp:249
 msgid "Important"
 msgstr "Wichtig"
@@ -663,6 +677,7 @@
 msgid "Terms:"
 msgstr ""
 
+#. All supported filters
 #: UI/GTK2/src/queryDialog.cc:119
 msgid "Host name"
 msgstr "Rechnername"
@@ -675,10 +690,12 @@
 msgid "File extension"
 msgstr "Dateiendung"
 
+#. This is the title column
 #: UI/GTK2/src/queryDialog.cc:122 UI/GTK2/src/ResultsTree.cpp:133
 msgid "Title"
 msgstr ""
 
+#. URL
 #: UI/GTK2/src/queryDialog.cc:123 UI/GTK2/src/ResultsTree.cpp:143
 msgid "URL"
 msgstr "URL"
@@ -731,6 +748,7 @@
 msgid "Query parameters"
 msgstr ""
 
+#. This is the score column
 #: UI/GTK2/src/ResultsTree.cpp:122
 #, fuzzy
 msgid "Score"
@@ -771,6 +789,7 @@
 msgid "results"
 msgstr "Ergebnisse"
 
+#. FIXME: check whether it's actually running !
 #: UI/GTK2/src/statisticsDialog.cc:171
 msgid "Running under PID"
 msgstr ""
@@ -795,7 +814,7 @@
 msgid "Can't index mail here"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:322
+#: UI/GTK2/src/WorkerThreads.cpp:322 UI/GTK2/src/WorkerThreads.cpp:555
 msgid "is already being indexed"
 msgstr ""
 
@@ -803,53 +822,55 @@
 msgid "is blacklisted"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:641 UI/GTK2/src/WorkerThreads.cpp:953
-#: UI/GTK2/src/WorkerThreads.cpp:1038 UI/GTK2/src/WorkerThreads.cpp:1047
-#: UI/GTK2/src/WorkerThreads.cpp:1233 UI/GTK2/src/WorkerThreads.cpp:1503
-#: UI/GTK2/src/WorkerThreads.cpp:1636
+#: UI/GTK2/src/WorkerThreads.cpp:657 UI/GTK2/src/WorkerThreads.cpp:969
+#: UI/GTK2/src/WorkerThreads.cpp:1054 UI/GTK2/src/WorkerThreads.cpp:1063
+#: UI/GTK2/src/WorkerThreads.cpp:1249 UI/GTK2/src/WorkerThreads.cpp:1519
+#: UI/GTK2/src/WorkerThreads.cpp:1652
 msgid "Index error on"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:763 UI/GTK2/src/WorkerThreads.cpp:974
+#: UI/GTK2/src/WorkerThreads.cpp:779 UI/GTK2/src/WorkerThreads.cpp:990
 msgid "Couldn't create search engine"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:789 UI/GTK2/src/WorkerThreads.cpp:988
+#: UI/GTK2/src/WorkerThreads.cpp:805 UI/GTK2/src/WorkerThreads.cpp:1004
 msgid "Couldn't run query on search engine"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:833
+#: UI/GTK2/src/WorkerThreads.cpp:849
 msgid "No title"
 msgstr "Kein Titel"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1141
+#: UI/GTK2/src/WorkerThreads.cpp:1157
 msgid "Couldn't obtain downloader for protocol"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:1166
+#: UI/GTK2/src/WorkerThreads.cpp:1182
 msgid "Couldn't retrieve"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:1263 UI/GTK2/src/WorkerThreads.cpp:1342
+#: UI/GTK2/src/WorkerThreads.cpp:1279 UI/GTK2/src/WorkerThreads.cpp:1358
 msgid "Cannot index document type"
 msgstr "Kann Dokumenttyp nicht indizieren"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1267 UI/GTK2/src/WorkerThreads.cpp:1346
+#: UI/GTK2/src/WorkerThreads.cpp:1283 UI/GTK2/src/WorkerThreads.cpp:1362
 msgid "at"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:1378
+#. No, it isn't
+#: UI/GTK2/src/WorkerThreads.cpp:1394
 msgid "Robots META tag forbids indexing"
 msgstr "Robots META-Tag verbietet das Indizieren"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1432
+#: UI/GTK2/src/WorkerThreads.cpp:1448
 msgid "Couldn't index"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:1514
+#. Be pessimistic and assume something will go wrong ;-)
+#: UI/GTK2/src/WorkerThreads.cpp:1530
 msgid "Couldn't unindex document(s)"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:1648
+#: UI/GTK2/src/WorkerThreads.cpp:1664
 msgid "Couldn't update document"
 msgstr "Dokument konnte nicht aktualisiert werden"

Modified: trunk/po/es.po
===================================================================
--- trunk/po/es.po	2007-05-22 11:18:08 UTC (rev 842)
+++ trunk/po/es.po	2007-05-22 11:53:33 UTC (rev 843)
@@ -1,4 +1,4 @@
-# Spanish translation for pinot
+# es PO file for pinot.
 # Copyright (C) 2006 Fabrice Colin, Jes?s Tramullas
 # This file is distributed under the same license as the pinot package.
 # Jes?s Tramullas <jesus at tramullas.com>, 2006.
@@ -6,16 +6,16 @@
 #, fuzzy
 msgid ""
 msgstr ""
-"Project-Id-Version: pinot 0.72\n"
+"Project-Id-Version: pinot 0.73\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2007-04-27 23:44+0800\n"
+"POT-Creation-Date: 2007-05-19 19:02+0800\n"
 "PO-Revision-Date: 2007-02-21 00:02+0000\n"
 "Last-Translator: Gar Bage <garbage at openfutura.com>\n"
 "Language-Team: es <fabricecolin at users.berlios.de>\n"
 "MIME-Version: 1.0\n"
 "Content-Type: text/plain; charset=utf-8\n"
 "Content-Transfer-Encoding: 8bit\n"
-"X-Rosetta-Export-Date: 2007-02-25 07:48+0000\n"
+"X-Rosetta-Export-Date: 2007-05-22 11:38:06+0000\n"
 
 #: UI/GTK2/src/EnginesTree.cpp:70
 msgid "Search Engines"
@@ -25,6 +25,9 @@
 msgid "Current User"
 msgstr "Usuario"
 
+#. Bind the callback's parameter to the index name
+#. Enable these menu items unless it is not the documents index
+#. Internal indices
 #: UI/GTK2/src/EnginesTree.cpp:339 UI/GTK2/src/mainWindow.cc:324
 #: UI/GTK2/src/mainWindow.cc:327 UI/GTK2/src/mainWindow.cc:540
 #: UI/GTK2/src/mainWindow.cc:1027 UI/GTK2/src/mainWindow.cc:1198
@@ -32,18 +35,21 @@
 #: UI/GTK2/src/mainWindow.cc:1293 UI/GTK2/src/mainWindow.cc:1930
 #: UI/GTK2/src/PinotSettings.cpp:243 UI/GTK2/src/PinotSettings.cpp:1344
 #: UI/GTK2/src/PinotSettings.cpp:1400 UI/GTK2/src/statisticsDialog.cc:77
-#: UI/GTK2/src/WorkerThreads.cpp:811 UI/GTK2/src/WorkerThreads.cpp:870
+#: UI/GTK2/src/WorkerThreads.cpp:827 UI/GTK2/src/WorkerThreads.cpp:886
 msgid "My Web Pages"
 msgstr "Mis Paginas Web"
 
+#. Populate the submenu
+#. Bind the callback's parameter to the index name
 #: UI/GTK2/src/EnginesTree.cpp:340 UI/GTK2/src/mainWindow.cc:318
 #: UI/GTK2/src/mainWindow.cc:321 UI/GTK2/src/mainWindow.cc:1034
 #: UI/GTK2/src/PinotSettings.cpp:244 UI/GTK2/src/PinotSettings.cpp:1345
 #: UI/GTK2/src/PinotSettings.cpp:1401 UI/GTK2/src/statisticsDialog.cc:82
-#: UI/GTK2/src/WorkerThreads.cpp:816 UI/GTK2/src/WorkerThreads.cpp:880
+#: UI/GTK2/src/WorkerThreads.cpp:832 UI/GTK2/src/WorkerThreads.cpp:896
 msgid "My Documents"
 msgstr "Mis documentos"
 
+#. The last column is for the timestamp
 #: UI/GTK2/src/dateDialog_glade.cc:76 UI/GTK2/src/queryDialog_glade.cc:91
 #: UI/GTK2/src/queryDialog_glade.cc:92 UI/GTK2/src/ResultsTree.cpp:151
 msgid "Date"
@@ -149,6 +155,7 @@
 msgid "Summary"
 msgstr "Sumario"
 
+#. Set tooltips
 #: UI/GTK2/src/mainWindow.cc:183
 msgid "Show all search engines"
 msgstr "Mostrar todos los motores de b?squeda"
@@ -161,6 +168,7 @@
 msgid "Remove index"
 msgstr "Borrar ?ndice"
 
+#. Now we are ready
 #: UI/GTK2/src/mainWindow.cc:191
 msgid "Ready"
 msgstr "Listo"
@@ -173,10 +181,12 @@
 msgid "Undefined"
 msgstr "Indefinido"
 
+#. Show the URL of the first result in the status bar
 #: UI/GTK2/src/mainWindow.cc:475
 msgid "Result location is"
 msgstr "La localizaci?n del resultado es"
 
+#. Show the URL in the status bar
 #: UI/GTK2/src/mainWindow.cc:550
 msgid "Document location is"
 msgstr "La localizaci?n del documento es"
@@ -213,6 +223,7 @@
 msgid "Updated label(s)"
 msgstr "Etiqueta(s) actualizada(s)"
 
+#. Yes, it did
 #: UI/GTK2/src/mainWindow.cc:1208
 msgid "Updated document"
 msgstr "Documento actualizado"
@@ -251,6 +262,7 @@
 msgid "Export Results"
 msgstr "resultados"
 
+#. Find this query
 #: UI/GTK2/src/mainWindow.cc:1827 UI/GTK2/src/mainWindow.cc:2491
 msgid "Live query"
 msgstr "B?squeda activa"
@@ -259,13 +271,13 @@
 msgid "Couldn't find query"
 msgstr "No se pudo a?adir la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:2045 UI/GTK2/src/WorkerThreads.cpp:628
-#: UI/GTK2/src/WorkerThreads.cpp:1623
+#: UI/GTK2/src/mainWindow.cc:2045 UI/GTK2/src/WorkerThreads.cpp:644
+#: UI/GTK2/src/WorkerThreads.cpp:1639
 msgid "Index"
 msgstr "?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2049 UI/GTK2/src/WorkerThreads.cpp:632
-#: UI/GTK2/src/WorkerThreads.cpp:1627
+#: UI/GTK2/src/mainWindow.cc:2049 UI/GTK2/src/WorkerThreads.cpp:648
+#: UI/GTK2/src/WorkerThreads.cpp:1643
 msgid "doesn't exist"
 msgstr "no existe"
 
@@ -447,71 +459,73 @@
 msgid "Pinot"
 msgstr "Pinot"
 
-#: UI/GTK2/src/pinot.cc:226 UI/GTK2/src/pinot-dbus-daemon.cc:294
+#. Localize language names
+#: UI/GTK2/src/pinot.cc:227 UI/GTK2/src/pinot-dbus-daemon.cc:295
 #: UI/GTK2/src/propertiesDialog.cc:60 UI/GTK2/src/propertiesDialog.cc:69
 msgid "Unknown"
 msgstr "Desconocido"
 
-#: UI/GTK2/src/pinot.cc:227 UI/GTK2/src/pinot-dbus-daemon.cc:295
+#: UI/GTK2/src/pinot.cc:228 UI/GTK2/src/pinot-dbus-daemon.cc:296
 msgid "Danish"
 msgstr "Dan?s"
 
-#: UI/GTK2/src/pinot.cc:228 UI/GTK2/src/pinot-dbus-daemon.cc:296
+#: UI/GTK2/src/pinot.cc:229 UI/GTK2/src/pinot-dbus-daemon.cc:297
 msgid "Dutch"
 msgstr "Holand?s"
 
-#: UI/GTK2/src/pinot.cc:229 UI/GTK2/src/pinot-dbus-daemon.cc:297
+#: UI/GTK2/src/pinot.cc:230 UI/GTK2/src/pinot-dbus-daemon.cc:298
 msgid "English"
 msgstr "Ingl?s"
 
-#: UI/GTK2/src/pinot.cc:230 UI/GTK2/src/pinot-dbus-daemon.cc:298
+#: UI/GTK2/src/pinot.cc:231 UI/GTK2/src/pinot-dbus-daemon.cc:299
 msgid "Finnish"
 msgstr "Finland?s"
 
-#: UI/GTK2/src/pinot.cc:231 UI/GTK2/src/pinot-dbus-daemon.cc:299
+#: UI/GTK2/src/pinot.cc:232 UI/GTK2/src/pinot-dbus-daemon.cc:300
 msgid "French"
 msgstr "Franc?s"
 
-#: UI/GTK2/src/pinot.cc:232 UI/GTK2/src/pinot-dbus-daemon.cc:300
+#: UI/GTK2/src/pinot.cc:233 UI/GTK2/src/pinot-dbus-daemon.cc:301
 msgid "German"
 msgstr "Alem?n"
 
-#: UI/GTK2/src/pinot.cc:233 UI/GTK2/src/pinot-dbus-daemon.cc:301
+#: UI/GTK2/src/pinot.cc:234 UI/GTK2/src/pinot-dbus-daemon.cc:302
 msgid "Italian"
 msgstr "Italiano"
 
-#: UI/GTK2/src/pinot.cc:234 UI/GTK2/src/pinot-dbus-daemon.cc:302
+#: UI/GTK2/src/pinot.cc:235 UI/GTK2/src/pinot-dbus-daemon.cc:303
 msgid "Norwegian"
 msgstr "Noruego"
 
-#: UI/GTK2/src/pinot.cc:235 UI/GTK2/src/pinot-dbus-daemon.cc:303
+#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:304
 msgid "Portuguese"
 msgstr "Portugu?s"
 
-#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:304
+#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:305
 msgid "Russian"
 msgstr "Ruso"
 
-#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:305
+#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:306
 msgid "Spanish"
 msgstr "Espa?ol"
 
-#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:306
+#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:307
 msgid "Swedish"
 msgstr "Sueco"
 
-#: UI/GTK2/src/pinot.cc:263
+#: UI/GTK2/src/pinot.cc:264
 msgid "Couldn't open index"
 msgstr "No se pudo abrir el ?ndice"
 
-#: UI/GTK2/src/pinot.cc:279
+#: UI/GTK2/src/pinot.cc:284
 msgid "Couldn't create history database"
 msgstr "No se pudo crear la base de datos del hist?rico"
 
-#: UI/GTK2/src/pinot.cc:309
+#: UI/GTK2/src/pinot.cc:325
 msgid "Updating all documents in My Web Pages is recommended"
 msgstr ""
 
+#. Add default labels
 #: UI/GTK2/src/PinotSettings.cpp:249
 msgid "Important"
 msgstr "Importante"
@@ -657,6 +671,7 @@
 msgid "Terms:"
 msgstr "T?rminos:"
 
+#. All supported filters
 #: UI/GTK2/src/queryDialog.cc:119
 msgid "Host name"
 msgstr "Nombre de servidor"
@@ -669,10 +684,12 @@
 msgid "File extension"
 msgstr "Extensi?n del archivo"
 
+#. This is the title column
 #: UI/GTK2/src/queryDialog.cc:122 UI/GTK2/src/ResultsTree.cpp:133
 msgid "Title"
 msgstr "T?tulo"
 
+#. URL
 #: UI/GTK2/src/queryDialog.cc:123 UI/GTK2/src/ResultsTree.cpp:143
 msgid "URL"
 msgstr "URL"
@@ -725,6 +742,7 @@
 msgid "Query parameters"
 msgstr "Par?metros de b?squeda"
 
+#. This is the score column
 #: UI/GTK2/src/ResultsTree.cpp:122
 msgid "Score"
 msgstr "Cuenta"
@@ -752,9 +770,8 @@
 msgstr "documentos"
 
 #: UI/GTK2/src/statisticsDialog.cc:132 UI/GTK2/src/statisticsDialog.cc:147
-#, fuzzy
 msgid "Unknown error"
-msgstr "Desconocido"
+msgstr ""
 
 #: UI/GTK2/src/statisticsDialog.cc:154
 msgid "Viewed"
@@ -764,6 +781,7 @@
 msgid "results"
 msgstr "resultados"
 
+#. FIXME: check whether it's actually running !
 #: UI/GTK2/src/statisticsDialog.cc:171
 #, fuzzy
 msgid "Running under PID"
@@ -789,7 +807,7 @@
 msgid "Can't index mail here"
 msgstr "No se pudo indizar el buzon de correo"
 
-#: UI/GTK2/src/WorkerThreads.cpp:322
+#: UI/GTK2/src/WorkerThreads.cpp:322 UI/GTK2/src/WorkerThreads.cpp:555
 msgid "is already being indexed"
 msgstr "ya est? indizado"
 
@@ -797,53 +815,55 @@
 msgid "is blacklisted"
 msgstr "ya excluido"
 
-#: UI/GTK2/src/WorkerThreads.cpp:641 UI/GTK2/src/WorkerThreads.cpp:953
-#: UI/GTK2/src/WorkerThreads.cpp:1038 UI/GTK2/src/WorkerThreads.cpp:1047
-#: UI/GTK2/src/WorkerThreads.cpp:1233 UI/GTK2/src/WorkerThreads.cpp:1503
-#: UI/GTK2/src/WorkerThreads.cpp:1636
+#: UI/GTK2/src/WorkerThreads.cpp:657 UI/GTK2/src/WorkerThreads.cpp:969
+#: UI/GTK2/src/WorkerThreads.cpp:1054 UI/GTK2/src/WorkerThreads.cpp:1063
+#: UI/GTK2/src/WorkerThreads.cpp:1249 UI/GTK2/src/WorkerThreads.cpp:1519
+#: UI/GTK2/src/WorkerThreads.cpp:1652
 msgid "Index error on"
 msgstr "Error en el ?ndice"
 
-#: UI/GTK2/src/WorkerThreads.cpp:763 UI/GTK2/src/WorkerThreads.cpp:974
+#: UI/GTK2/src/WorkerThreads.cpp:779 UI/GTK2/src/WorkerThreads.cpp:990
 msgid "Couldn't create search engine"
 msgstr "No se pudo crear el motor de b?squeda"
 
-#: UI/GTK2/src/WorkerThreads.cpp:789 UI/GTK2/src/WorkerThreads.cpp:988
+#: UI/GTK2/src/WorkerThreads.cpp:805 UI/GTK2/src/WorkerThreads.cpp:1004
 msgid "Couldn't run query on search engine"
 msgstr "No se pudo ejecutar la b?squeda contra el motor"
 
-#: UI/GTK2/src/WorkerThreads.cpp:833
+#: UI/GTK2/src/WorkerThreads.cpp:849
 msgid "No title"
 msgstr "Sin t?tulo"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1141
+#: UI/GTK2/src/WorkerThreads.cpp:1157
 msgid "Couldn't obtain downloader for protocol"
 msgstr "No se pudo usar un recuperador para el protocolo"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1166
+#: UI/GTK2/src/WorkerThreads.cpp:1182
 msgid "Couldn't retrieve"
 msgstr "No se pudo descargar"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1263 UI/GTK2/src/WorkerThreads.cpp:1342
+#: UI/GTK2/src/WorkerThreads.cpp:1279 UI/GTK2/src/WorkerThreads.cpp:1358
 msgid "Cannot index document type"
 msgstr "No se pudo indizar el tipo de documento"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1267 UI/GTK2/src/WorkerThreads.cpp:1346
+#: UI/GTK2/src/WorkerThreads.cpp:1283 UI/GTK2/src/WorkerThreads.cpp:1362
 msgid "at"
 msgstr "a"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1378
+#. No, it isn't
+#: UI/GTK2/src/WorkerThreads.cpp:1394
 msgid "Robots META tag forbids indexing"
 msgstr "La etiqueta META Robots proh?be la indizaci?n"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1432
+#: UI/GTK2/src/WorkerThreads.cpp:1448
 msgid "Couldn't index"
 msgstr "No se pudo indizar"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1514
+#. Be pessimistic and assume something will go wrong ;-)
+#: UI/GTK2/src/WorkerThreads.cpp:1530
 msgid "Couldn't unindex document(s)"
 msgstr "No se pudo des-indizar lo(s) documento(s)"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1648
+#: UI/GTK2/src/WorkerThreads.cpp:1664
 msgid "Couldn't update document"
 msgstr "No se pudo actualizar el documento"

Modified: trunk/po/fr.po
===================================================================
--- trunk/po/fr.po	2007-05-22 11:18:08 UTC (rev 842)
+++ trunk/po/fr.po	2007-05-22 11:53:33 UTC (rev 843)
@@ -6,16 +6,16 @@
 #, fuzzy
 msgid ""
 msgstr ""
-"Project-Id-Version: pinot 0.72\n"
+"Project-Id-Version: pinot 0.73\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2007-04-27 23:44+0800\n"
-"PO-Revision-Date: 2007-02-17 17:34+0800\n"
+"POT-Creation-Date: 2007-05-19 19:02+0800\n"
+"PO-Revision-Date: 2007-04-03 04:46+0000\n"
 "Last-Translator: Fabrice Colin <fabricecolin at users.berlios.de>\n"
 "Language-Team: fr <fabricecolin at users.berlios.de>\n"
 "MIME-Version: 1.0\n"
 "Content-Type: text/plain; charset=utf-8\n"
 "Content-Transfer-Encoding: 8bit\n"
-"X-Rosetta-Export-Date: 2006-12-03 15:18+0000\n"
+"X-Rosetta-Export-Date: 2007-05-22 11:38:08+0000\n"
 
 #: UI/GTK2/src/EnginesTree.cpp:70
 msgid "Search Engines"
@@ -25,6 +25,9 @@
 msgid "Current User"
 msgstr "Utilisateur"
 
+#. Bind the callback's parameter to the index name
+#. Enable these menu items unless it is not the documents index
+#. Internal indices
 #: UI/GTK2/src/EnginesTree.cpp:339 UI/GTK2/src/mainWindow.cc:324
 #: UI/GTK2/src/mainWindow.cc:327 UI/GTK2/src/mainWindow.cc:540
 #: UI/GTK2/src/mainWindow.cc:1027 UI/GTK2/src/mainWindow.cc:1198
@@ -32,18 +35,21 @@
 #: UI/GTK2/src/mainWindow.cc:1293 UI/GTK2/src/mainWindow.cc:1930
 #: UI/GTK2/src/PinotSettings.cpp:243 UI/GTK2/src/PinotSettings.cpp:1344
 #: UI/GTK2/src/PinotSettings.cpp:1400 UI/GTK2/src/statisticsDialog.cc:77
-#: UI/GTK2/src/WorkerThreads.cpp:811 UI/GTK2/src/WorkerThreads.cpp:870
+#: UI/GTK2/src/WorkerThreads.cpp:827 UI/GTK2/src/WorkerThreads.cpp:886
 msgid "My Web Pages"
 msgstr "Mes Pages Web"
 
+#. Populate the submenu
+#. Bind the callback's parameter to the index name
 #: UI/GTK2/src/EnginesTree.cpp:340 UI/GTK2/src/mainWindow.cc:318
 #: UI/GTK2/src/mainWindow.cc:321 UI/GTK2/src/mainWindow.cc:1034
 #: UI/GTK2/src/PinotSettings.cpp:244 UI/GTK2/src/PinotSettings.cpp:1345
 #: UI/GTK2/src/PinotSettings.cpp:1401 UI/GTK2/src/statisticsDialog.cc:82
-#: UI/GTK2/src/WorkerThreads.cpp:816 UI/GTK2/src/WorkerThreads.cpp:880
+#: UI/GTK2/src/WorkerThreads.cpp:832 UI/GTK2/src/WorkerThreads.cpp:896
 msgid "My Documents"
 msgstr "Mes Documents"
 
+#. The last column is for the timestamp
 #: UI/GTK2/src/dateDialog_glade.cc:76 UI/GTK2/src/queryDialog_glade.cc:91
 #: UI/GTK2/src/queryDialog_glade.cc:92 UI/GTK2/src/ResultsTree.cpp:151
 msgid "Date"
@@ -150,6 +156,7 @@
 msgid "Summary"
 msgstr "Sommaire"
 
+#. Set tooltips
 #: UI/GTK2/src/mainWindow.cc:183
 msgid "Show all search engines"
 msgstr "Montrer tous les moteurs"
@@ -162,6 +169,7 @@
 msgid "Remove index"
 msgstr "Enlever un index"
 
+#. Now we are ready
 #: UI/GTK2/src/mainWindow.cc:191
 msgid "Ready"
 msgstr "Pret"
@@ -174,17 +182,20 @@
 msgid "Undefined"
 msgstr "Indefini"
 
+#. Show the URL of the first result in the status bar
 #: UI/GTK2/src/mainWindow.cc:475
 msgid "Result location is"
 msgstr "Le chemin du resultat est"
 
+#. Show the URL in the status bar
 #: UI/GTK2/src/mainWindow.cc:550
 msgid "Document location is"
 msgstr "Le chemin du document is"
 
 #: UI/GTK2/src/mainWindow.cc:884
+#, fuzzy
 msgid "Showing"
-msgstr ""
+msgstr "Montrant"
 
 #: UI/GTK2/src/mainWindow.cc:889
 msgid "of"
@@ -214,6 +225,7 @@
 msgid "Updated label(s)"
 msgstr "Mis a jour l(es) etiquette(s)"
 
+#. Yes, it did
 #: UI/GTK2/src/mainWindow.cc:1208
 msgid "Updated document"
 msgstr "Mis a jour le document"
@@ -252,6 +264,7 @@
 msgid "Export Results"
 msgstr "resultats"
 
+#. Find this query
 #: UI/GTK2/src/mainWindow.cc:1827 UI/GTK2/src/mainWindow.cc:2491
 msgid "Live query"
 msgstr "Recherche"
@@ -260,13 +273,13 @@
 msgid "Couldn't find query"
 msgstr "N'a pas pu trouver"
 
-#: UI/GTK2/src/mainWindow.cc:2045 UI/GTK2/src/WorkerThreads.cpp:628
-#: UI/GTK2/src/WorkerThreads.cpp:1623
+#: UI/GTK2/src/mainWindow.cc:2045 UI/GTK2/src/WorkerThreads.cpp:644
+#: UI/GTK2/src/WorkerThreads.cpp:1639
 msgid "Index"
 msgstr "L'index"
 
-#: UI/GTK2/src/mainWindow.cc:2049 UI/GTK2/src/WorkerThreads.cpp:632
-#: UI/GTK2/src/WorkerThreads.cpp:1627
+#: UI/GTK2/src/mainWindow.cc:2049 UI/GTK2/src/WorkerThreads.cpp:648
+#: UI/GTK2/src/WorkerThreads.cpp:1643
 msgid "doesn't exist"
 msgstr "n'existe pas"
 
@@ -448,71 +461,73 @@
 msgid "Pinot"
 msgstr "Pinot"
 
-#: UI/GTK2/src/pinot.cc:226 UI/GTK2/src/pinot-dbus-daemon.cc:294
+#. Localize language names
+#: UI/GTK2/src/pinot.cc:227 UI/GTK2/src/pinot-dbus-daemon.cc:295
 #: UI/GTK2/src/propertiesDialog.cc:60 UI/GTK2/src/propertiesDialog.cc:69
 msgid "Unknown"
 msgstr "Inconnu"
 
-#: UI/GTK2/src/pinot.cc:227 UI/GTK2/src/pinot-dbus-daemon.cc:295
+#: UI/GTK2/src/pinot.cc:228 UI/GTK2/src/pinot-dbus-daemon.cc:296
 msgid "Danish"
 msgstr "Danois"
 
-#: UI/GTK2/src/pinot.cc:228 UI/GTK2/src/pinot-dbus-daemon.cc:296
+#: UI/GTK2/src/pinot.cc:229 UI/GTK2/src/pinot-dbus-daemon.cc:297
 msgid "Dutch"
 msgstr "Hollandais"
 
-#: UI/GTK2/src/pinot.cc:229 UI/GTK2/src/pinot-dbus-daemon.cc:297
+#: UI/GTK2/src/pinot.cc:230 UI/GTK2/src/pinot-dbus-daemon.cc:298
 msgid "English"
 msgstr "Anglais"
 
-#: UI/GTK2/src/pinot.cc:230 UI/GTK2/src/pinot-dbus-daemon.cc:298
+#: UI/GTK2/src/pinot.cc:231 UI/GTK2/src/pinot-dbus-daemon.cc:299
 msgid "Finnish"
 msgstr "Finlandais"
 
-#: UI/GTK2/src/pinot.cc:231 UI/GTK2/src/pinot-dbus-daemon.cc:299
+#: UI/GTK2/src/pinot.cc:232 UI/GTK2/src/pinot-dbus-daemon.cc:300
 msgid "French"
 msgstr "Francais"
 
-#: UI/GTK2/src/pinot.cc:232 UI/GTK2/src/pinot-dbus-daemon.cc:300
+#: UI/GTK2/src/pinot.cc:233 UI/GTK2/src/pinot-dbus-daemon.cc:301
 msgid "German"
 msgstr "Allemand"
 
-#: UI/GTK2/src/pinot.cc:233 UI/GTK2/src/pinot-dbus-daemon.cc:301
+#: UI/GTK2/src/pinot.cc:234 UI/GTK2/src/pinot-dbus-daemon.cc:302
 msgid "Italian"
 msgstr "Italien"
 
-#: UI/GTK2/src/pinot.cc:234 UI/GTK2/src/pinot-dbus-daemon.cc:302
+#: UI/GTK2/src/pinot.cc:235 UI/GTK2/src/pinot-dbus-daemon.cc:303
 msgid "Norwegian"
 msgstr "Norvegien"
 
-#: UI/GTK2/src/pinot.cc:235 UI/GTK2/src/pinot-dbus-daemon.cc:303
+#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:304
 msgid "Portuguese"
 msgstr "Portugais"
 
-#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:304
+#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:305
 msgid "Russian"
 msgstr "Russe"
 
-#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:305
+#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:306
 msgid "Spanish"
 msgstr "Espagnol"
 
-#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:306
+#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:307
 msgid "Swedish"
 msgstr "Suedois"
 
-#: UI/GTK2/src/pinot.cc:263
+#: UI/GTK2/src/pinot.cc:264
 msgid "Couldn't open index"
 msgstr "N'a pas pu ouvrir l'index"
 
-#: UI/GTK2/src/pinot.cc:279
+#: UI/GTK2/src/pinot.cc:284
 msgid "Couldn't create history database"
 msgstr "N'a pas pu creer la base d'historiques"
 
-#: UI/GTK2/src/pinot.cc:309
+#: UI/GTK2/src/pinot.cc:325
 msgid "Updating all documents in My Web Pages is recommended"
 msgstr "Il est recommende de mettre a jour tous les documents de Mes Pages Web"
 
+#. Add default labels
 #: UI/GTK2/src/PinotSettings.cpp:249
 msgid "Important"
 msgstr "Important"
@@ -658,6 +673,7 @@
 msgid "Terms:"
 msgstr "Termes:"
 
+#. All supported filters
 #: UI/GTK2/src/queryDialog.cc:119
 msgid "Host name"
 msgstr "Nom de machine"
@@ -670,10 +686,12 @@
 msgid "File extension"
 msgstr "Extension de fichier"
 
+#. This is the title column
 #: UI/GTK2/src/queryDialog.cc:122 UI/GTK2/src/ResultsTree.cpp:133
 msgid "Title"
 msgstr "Titre"
 
+#. URL
 #: UI/GTK2/src/queryDialog.cc:123 UI/GTK2/src/ResultsTree.cpp:143
 msgid "URL"
 msgstr "URL"
@@ -726,6 +744,7 @@
 msgid "Query parameters"
 msgstr "Parametres de la recherche"
 
+#. This is the score column
 #: UI/GTK2/src/ResultsTree.cpp:122
 msgid "Score"
 msgstr "Score"
@@ -763,6 +782,7 @@
 msgid "results"
 msgstr "resultats"
 
+#. FIXME: check whether it's actually running !
 #: UI/GTK2/src/statisticsDialog.cc:171
 msgid "Running under PID"
 msgstr "PID"
@@ -787,7 +807,7 @@
 msgid "Can't index mail here"
 msgstr "Ne peut pas indexer le courrier ici"
 
-#: UI/GTK2/src/WorkerThreads.cpp:322
+#: UI/GTK2/src/WorkerThreads.cpp:322 UI/GTK2/src/WorkerThreads.cpp:555
 msgid "is already being indexed"
 msgstr "est deja indexe"
 
@@ -795,53 +815,55 @@
 msgid "is blacklisted"
 msgstr "est exclus"
 
-#: UI/GTK2/src/WorkerThreads.cpp:641 UI/GTK2/src/WorkerThreads.cpp:953
-#: UI/GTK2/src/WorkerThreads.cpp:1038 UI/GTK2/src/WorkerThreads.cpp:1047
-#: UI/GTK2/src/WorkerThreads.cpp:1233 UI/GTK2/src/WorkerThreads.cpp:1503
-#: UI/GTK2/src/WorkerThreads.cpp:1636
+#: UI/GTK2/src/WorkerThreads.cpp:657 UI/GTK2/src/WorkerThreads.cpp:969
+#: UI/GTK2/src/WorkerThreads.cpp:1054 UI/GTK2/src/WorkerThreads.cpp:1063
+#: UI/GTK2/src/WorkerThreads.cpp:1249 UI/GTK2/src/WorkerThreads.cpp:1519
+#: UI/GTK2/src/WorkerThreads.cpp:1652
 msgid "Index error on"
 msgstr "Erreur sur l'index"
 
-#: UI/GTK2/src/WorkerThreads.cpp:763 UI/GTK2/src/WorkerThreads.cpp:974
+#: UI/GTK2/src/WorkerThreads.cpp:779 UI/GTK2/src/WorkerThreads.cpp:990
 msgid "Couldn't create search engine"
 msgstr "N'a pas pu creer le moteur"
 
-#: UI/GTK2/src/WorkerThreads.cpp:789 UI/GTK2/src/WorkerThreads.cpp:988
+#: UI/GTK2/src/WorkerThreads.cpp:805 UI/GTK2/src/WorkerThreads.cpp:1004
 msgid "Couldn't run query on search engine"
 msgstr "N'a pas pu lancer la recherche sur le moteur"
 
-#: UI/GTK2/src/WorkerThreads.cpp:833
+#: UI/GTK2/src/WorkerThreads.cpp:849
 msgid "No title"
 msgstr "Pas de titre"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1141
+#: UI/GTK2/src/WorkerThreads.cpp:1157
 msgid "Couldn't obtain downloader for protocol"
 msgstr "N'a pas pu obtenir un brouteur pour"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1166
+#: UI/GTK2/src/WorkerThreads.cpp:1182
 msgid "Couldn't retrieve"
 msgstr "N'a pas pu telecharger"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1263 UI/GTK2/src/WorkerThreads.cpp:1342
+#: UI/GTK2/src/WorkerThreads.cpp:1279 UI/GTK2/src/WorkerThreads.cpp:1358
 msgid "Cannot index document type"
 msgstr "Impossible d'indexer ce type de documents"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1267 UI/GTK2/src/WorkerThreads.cpp:1346
+#: UI/GTK2/src/WorkerThreads.cpp:1283 UI/GTK2/src/WorkerThreads.cpp:1362
 msgid "at"
 msgstr "a"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1378
+#. No, it isn't
+#: UI/GTK2/src/WorkerThreads.cpp:1394
 msgid "Robots META tag forbids indexing"
 msgstr "Le META tag Robots interdit d'indexer"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1432
+#: UI/GTK2/src/WorkerThreads.cpp:1448
 msgid "Couldn't index"
 msgstr "N'a pas pu indexer"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1514
+#. Be pessimistic and assume something will go wrong ;-)
+#: UI/GTK2/src/WorkerThreads.cpp:1530
 msgid "Couldn't unindex document(s)"
 msgstr "N'a pas pu desindexer le(s) document(s)"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1648
+#: UI/GTK2/src/WorkerThreads.cpp:1664
 msgid "Couldn't update document"
 msgstr "N'a pas pu mettre a jour le document"

Modified: trunk/po/it.po
===================================================================
--- trunk/po/it.po	2007-05-22 11:18:08 UTC (rev 842)
+++ trunk/po/it.po	2007-05-22 11:53:33 UTC (rev 843)
@@ -5,16 +5,16 @@
 #, fuzzy
 msgid ""
 msgstr ""
-"Project-Id-Version: pinot 0.72\n"
+"Project-Id-Version: pinot 0.73\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2007-04-27 23:44+0800\n"
-"PO-Revision-Date: 2007-04-25 10:40+0000\n"
-"Last-Translator: Vincenzo Consales <aquarius987 at gmail.com>\n"
+"POT-Creation-Date: 2007-05-19 19:02+0800\n"
+"PO-Revision-Date: 2007-05-07 20:27+0000\n"
+"Last-Translator: Marco Bazzani <visitors at libero.it>\n"
 "Language-Team: Italian <it at li.org>\n"
 "MIME-Version: 1.0\n"
 "Content-Type: text/plain; charset=UTF-8\n"
 "Content-Transfer-Encoding: 8bit\n"
-"X-Rosetta-Export-Date: 2007-04-26 10:58:09+0000\n"
+"X-Rosetta-Export-Date: 2007-05-10 14:58:08+0000\n"
 
 #: UI/GTK2/src/EnginesTree.cpp:70
 msgid "Search Engines"
@@ -22,8 +22,11 @@
 
 #: UI/GTK2/src/EnginesTree.cpp:328
 msgid "Current User"
-msgstr "Utente attuale"
+msgstr "Utente attual"
 
+#. Bind the callback's parameter to the index name
+#. Enable these menu items unless it is not the documents index
+#. Internal indices
 #: UI/GTK2/src/EnginesTree.cpp:339 UI/GTK2/src/mainWindow.cc:324
 #: UI/GTK2/src/mainWindow.cc:327 UI/GTK2/src/mainWindow.cc:540
 #: UI/GTK2/src/mainWindow.cc:1027 UI/GTK2/src/mainWindow.cc:1198
@@ -31,32 +34,33 @@
 #: UI/GTK2/src/mainWindow.cc:1293 UI/GTK2/src/mainWindow.cc:1930
 #: UI/GTK2/src/PinotSettings.cpp:243 UI/GTK2/src/PinotSettings.cpp:1344
 #: UI/GTK2/src/PinotSettings.cpp:1400 UI/GTK2/src/statisticsDialog.cc:77
-#: UI/GTK2/src/WorkerThreads.cpp:811 UI/GTK2/src/WorkerThreads.cpp:870
-#, fuzzy
+#: UI/GTK2/src/WorkerThreads.cpp:827 UI/GTK2/src/WorkerThreads.cpp:886
 msgid "My Web Pages"
 msgstr "Pagine web personali"
 
+#. Populate the submenu
+#. Bind the callback's parameter to the index name
 #: UI/GTK2/src/EnginesTree.cpp:340 UI/GTK2/src/mainWindow.cc:318
 #: UI/GTK2/src/mainWindow.cc:321 UI/GTK2/src/mainWindow.cc:1034
 #: UI/GTK2/src/PinotSettings.cpp:244 UI/GTK2/src/PinotSettings.cpp:1345
 #: UI/GTK2/src/PinotSettings.cpp:1401 UI/GTK2/src/statisticsDialog.cc:82
-#: UI/GTK2/src/WorkerThreads.cpp:816 UI/GTK2/src/WorkerThreads.cpp:880
-#, fuzzy
+#: UI/GTK2/src/WorkerThreads.cpp:832 UI/GTK2/src/WorkerThreads.cpp:896
 msgid "My Documents"
 msgstr "Documenti personali"
 
+#. The last column is for the timestamp
 #: UI/GTK2/src/dateDialog_glade.cc:76 UI/GTK2/src/queryDialog_glade.cc:91
 #: UI/GTK2/src/queryDialog_glade.cc:92 UI/GTK2/src/ResultsTree.cpp:151
 msgid "Date"
-msgstr ""
+msgstr "Data"
 
 #: UI/GTK2/src/indexDialog.cc:122
 msgid "Served by"
-msgstr ""
+msgstr "Fornito da"
 
 #: UI/GTK2/src/indexDialog.cc:124
 msgid "Local"
-msgstr ""
+msgstr "Locale"
 
 #: UI/GTK2/src/indexDialog.cc:286
 msgid "Index location"
@@ -109,7 +113,7 @@
 
 #: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:221
 msgid "Import URL"
-msgstr "Importare URL"
+msgstr "Importa URL"
 
 #: UI/GTK2/src/IndexPage.cpp:51
 msgid "Show Previous"
@@ -117,7 +121,7 @@
 
 #: UI/GTK2/src/IndexPage.cpp:57
 msgid "Show Next"
-msgstr "Prossima dimostrazione"
+msgstr "Mostra Seguente"
 
 #: UI/GTK2/src/IndexPage.cpp:150 UI/GTK2/src/IndexPage.cpp:188
 msgid "All labels"
@@ -128,14 +132,16 @@
 "There is no helper application defined for this document's type.\n"
 "Please enter the command to open this document."
 msgstr ""
+"Non esiste un'applicazione configurata per aprire questo tipo di documento\n"
+"Prego immettere il comando per aprire questo documento."
 
 #: UI/GTK2/src/launcherDialog_glade.cc:67
 msgid "Use this command for other documents of the same type."
-msgstr ""
+msgstr "Usa questo comando per aprire altri documenti dello stesso tipo"
 
 #: UI/GTK2/src/launcherDialog_glade.cc:99
 msgid "Helper application"
-msgstr ""
+msgstr "Applicazione associata"
 
 #: UI/GTK2/src/mainWindow.cc:140
 msgid "Query Name"
@@ -143,47 +149,51 @@
 
 #: UI/GTK2/src/mainWindow.cc:145
 msgid "Last Run"
-msgstr "Prossima corsa"
+msgstr "Ultimo Eseguito"
 
 #: UI/GTK2/src/mainWindow.cc:150
 msgid "Summary"
 msgstr "Sommario"
 
+#. Set tooltips
 #: UI/GTK2/src/mainWindow.cc:183
 msgid "Show all search engines"
 msgstr "Mostrare tutti i motori di ricerca"
 
 #: UI/GTK2/src/mainWindow.cc:184
 msgid "Add index"
-msgstr "Indice da aggiungere"
+msgstr "Aggiungi Indice"
 
 #: UI/GTK2/src/mainWindow.cc:185
 msgid "Remove index"
-msgstr "Rimuovere indice"
+msgstr "Rimuovi indice"
 
+#. Now we are ready
 #: UI/GTK2/src/mainWindow.cc:191
 msgid "Ready"
 msgstr "Pronto"
 
 #: UI/GTK2/src/mainWindow.cc:242
 msgid "N/A"
-msgstr "N/A"
+msgstr "N/D"
 
 #: UI/GTK2/src/mainWindow.cc:257
 msgid "Undefined"
-msgstr ""
+msgstr "Non Definito"
 
+#. Show the URL of the first result in the status bar
 #: UI/GTK2/src/mainWindow.cc:475
 msgid "Result location is"
-msgstr "Il risultato della posizione ?"
+msgstr "la posizione del risultato ?"
 
+#. Show the URL in the status bar
 #: UI/GTK2/src/mainWindow.cc:550
 msgid "Document location is"
-msgstr "La posizione Document ?"
+msgstr "La posizione Documento ?"
 
 #: UI/GTK2/src/mainWindow.cc:884
 msgid "Showing"
-msgstr "Dimostrazione"
+msgstr "Mostrando"
 
 #: UI/GTK2/src/mainWindow.cc:889
 msgid "of"
@@ -195,7 +205,7 @@
 
 #: UI/GTK2/src/mainWindow.cc:927
 msgid "Query"
-msgstr "Query"
+msgstr "Richiesta"
 
 #: UI/GTK2/src/mainWindow.cc:931 UI/GTK2/src/mainWindow.cc:3003
 msgid "on"
@@ -213,17 +223,18 @@
 msgid "Updated label(s)"
 msgstr "Descrizione(i) aggiornata"
 
+#. Yes, it did
 #: UI/GTK2/src/mainWindow.cc:1208
 msgid "Updated document"
 msgstr "Documento aggiornato"
 
 #: UI/GTK2/src/mainWindow.cc:1221
 msgid "Indexed"
-msgstr "Indice"
+msgstr "Indicizzato"
 
 #: UI/GTK2/src/mainWindow.cc:1263
 msgid "Unindexed document(s)"
-msgstr ""
+msgstr "Documento/i non Indicizzato/i"
 
 #: UI/GTK2/src/mainWindow.cc:1303
 msgid "Updated document properties"
@@ -236,7 +247,7 @@
 #: UI/GTK2/src/mainWindow.cc:1360 UI/GTK2/src/mainWindow.cc:2321
 #: UI/GTK2/src/mainWindow.cc:2833
 msgid "is already in use"
-msgstr "? ora in uso"
+msgstr "? gi? in uso"
 
 #: UI/GTK2/src/mainWindow.cc:1373
 msgid "Couldn't rename index"
@@ -249,23 +260,24 @@
 #: UI/GTK2/src/mainWindow.cc:1738
 #, fuzzy
 msgid "Export Results"
-msgstr "_Risultati"
+msgstr "risultati"
 
+#. Find this query
 #: UI/GTK2/src/mainWindow.cc:1827 UI/GTK2/src/mainWindow.cc:2491
 msgid "Live query"
-msgstr ""
+msgstr "Live Query"
 
 #: UI/GTK2/src/mainWindow.cc:1853
 msgid "Couldn't find query"
-msgstr ""
+msgstr "Impossibile trovare la query"
 
-#: UI/GTK2/src/mainWindow.cc:2045 UI/GTK2/src/WorkerThreads.cpp:628
-#: UI/GTK2/src/WorkerThreads.cpp:1623
+#: UI/GTK2/src/mainWindow.cc:2045 UI/GTK2/src/WorkerThreads.cpp:644
+#: UI/GTK2/src/WorkerThreads.cpp:1639
 msgid "Index"
 msgstr "Indice"
 
-#: UI/GTK2/src/mainWindow.cc:2049 UI/GTK2/src/WorkerThreads.cpp:632
-#: UI/GTK2/src/WorkerThreads.cpp:1627
+#: UI/GTK2/src/mainWindow.cc:2049 UI/GTK2/src/WorkerThreads.cpp:648
+#: UI/GTK2/src/WorkerThreads.cpp:1643
 msgid "doesn't exist"
 msgstr "non esiste"
 
@@ -279,15 +291,15 @@
 
 #: UI/GTK2/src/mainWindow.cc:2271
 msgid "A metasearch tool for the Free Desktop"
-msgstr "Un tool metasearch per il Free Desktop"
+msgstr "Un tool di ricerca per il Desktop Libero"
 
 #: UI/GTK2/src/mainWindow.cc:2272
 msgid "Search the Web and your documents !"
-msgstr ""
+msgstr "Cerca nel Web e nei documenti !"
 
 #: UI/GTK2/src/mainWindow.cc:2273
 msgid "(C) 2005 Fabrice Colin"
-msgstr ""
+msgstr "(C) 2005 Fabrice Colin"
 
 #: UI/GTK2/src/mainWindow.cc:2317
 msgid "Index name"
@@ -307,7 +319,7 @@
 
 #: UI/GTK2/src/mainWindow.cc:2646
 msgid "At least one task hasn't completed yet. Quit now ?"
-msgstr ""
+msgstr "Nessuna operazione completata. Uscire comunque ?"
 
 #: UI/GTK2/src/mainWindow.cc:2829
 msgid "Query name"
@@ -315,23 +327,23 @@
 
 #: UI/GTK2/src/mainWindow.cc:2856
 msgid "Couldn't update query"
-msgstr "Impossibile aggiornare il query"
+msgstr "Impossibile aggiornare la query"
 
 #: UI/GTK2/src/mainWindow.cc:2864
 msgid "Edited query"
-msgstr "Query modificato"
+msgstr "Query modificata"
 
 #: UI/GTK2/src/mainWindow.cc:2871
 msgid "Couldn't add query"
-msgstr "Impossibile aggiungere il query"
+msgstr "Impossibile aggiungere la query"
 
 #: UI/GTK2/src/mainWindow.cc:2879
 msgid "Added new query"
-msgstr "Nuovo query aggiunto"
+msgstr "Nuova query aggiunto"
 
 #: UI/GTK2/src/mainWindow.cc:2892
 msgid "Query is not set"
-msgstr ""
+msgstr "Query non configurata"
 
 #: UI/GTK2/src/mainWindow.cc:2903
 msgid "No search engine selected"
@@ -339,11 +351,11 @@
 
 #: UI/GTK2/src/mainWindow.cc:2990
 msgid "Please set the Google API key first"
-msgstr ""
+msgstr "Prima inserisci la tua Google API key"
 
 #: UI/GTK2/src/mainWindow.cc:2999
 msgid "Running query"
-msgstr "Avviare query"
+msgstr "Query in esecuzione"
 
 #: UI/GTK2/src/mainWindow.cc:3183
 msgid "No default application defined for type"
@@ -364,7 +376,7 @@
 #: UI/GTK2/src/mainWindow_glade.cc:164 UI/GTK2/src/statisticsDialog.cc:50
 #: UI/GTK2/src/statisticsDialog_glade.cc:87
 msgid "Status"
-msgstr ""
+msgstr "Stato"
 
 #: UI/GTK2/src/mainWindow_glade.cc:185
 msgid "Search Engine"
@@ -376,27 +388,27 @@
 
 #: UI/GTK2/src/mainWindow_glade.cc:191
 msgid "Show Extract"
-msgstr "Mostrare l'estratto"
+msgstr "Mostrare un estratto"
 
 #: UI/GTK2/src/mainWindow_glade.cc:194
 msgid "Group By"
-msgstr "Gruppo da"
+msgstr "Raggruppa Per"
 
 #: UI/GTK2/src/mainWindow_glade.cc:200
 msgid "Clear List"
-msgstr "Cancellare lista"
+msgstr "Pulisci llista"
 
 #: UI/GTK2/src/mainWindow_glade.cc:206
 msgid "Vie_w"
-msgstr "Vedere"
+msgstr "Visualizza"
 
 #: UI/GTK2/src/mainWindow_glade.cc:209
 msgid "View Cache"
-msgstr "Vedere Cache"
+msgstr "Guarda Cache"
 
 #: UI/GTK2/src/mainWindow_glade.cc:212
 msgid "More Like This"
-msgstr ""
+msgstr "Altri risultati"
 
 #: UI/GTK2/src/mainWindow_glade.cc:215 UI/GTK2/src/mainWindow_glade.cc:251
 msgid "_Index"
@@ -408,15 +420,15 @@
 
 #: UI/GTK2/src/mainWindow_glade.cc:227
 msgid "View"
-msgstr "Vedere"
+msgstr "Vedi"
 
 #: UI/GTK2/src/mainWindow_glade.cc:230
 msgid "Update"
-msgstr "Aggiornare"
+msgstr "Aggiorna"
 
 #: UI/GTK2/src/mainWindow_glade.cc:233
 msgid "Unindex"
-msgstr ""
+msgstr "Rimuovi dall'indice"
 
 #: UI/GTK2/src/mainWindow_glade.cc:236
 #: UI/GTK2/src/propertiesDialog_glade.cc:177
@@ -447,71 +459,73 @@
 msgid "Pinot"
 msgstr "Pinot"
 
-#: UI/GTK2/src/pinot.cc:226 UI/GTK2/src/pinot-dbus-daemon.cc:294
+#. Localize language names
+#: UI/GTK2/src/pinot.cc:227 UI/GTK2/src/pinot-dbus-daemon.cc:295
 #: UI/GTK2/src/propertiesDialog.cc:60 UI/GTK2/src/propertiesDialog.cc:69
 msgid "Unknown"
 msgstr "Sconosciuto"
 
-#: UI/GTK2/src/pinot.cc:227 UI/GTK2/src/pinot-dbus-daemon.cc:295
+#: UI/GTK2/src/pinot.cc:228 UI/GTK2/src/pinot-dbus-daemon.cc:296
 msgid "Danish"
 msgstr "Danese"
 
-#: UI/GTK2/src/pinot.cc:228 UI/GTK2/src/pinot-dbus-daemon.cc:296
+#: UI/GTK2/src/pinot.cc:229 UI/GTK2/src/pinot-dbus-daemon.cc:297
 msgid "Dutch"
 msgstr "Olandese"
 
-#: UI/GTK2/src/pinot.cc:229 UI/GTK2/src/pinot-dbus-daemon.cc:297
+#: UI/GTK2/src/pinot.cc:230 UI/GTK2/src/pinot-dbus-daemon.cc:298
 msgid "English"
 msgstr "Inglese"
 
-#: UI/GTK2/src/pinot.cc:230 UI/GTK2/src/pinot-dbus-daemon.cc:298
+#: UI/GTK2/src/pinot.cc:231 UI/GTK2/src/pinot-dbus-daemon.cc:299
 msgid "Finnish"
 msgstr "Finlandese"
 
-#: UI/GTK2/src/pinot.cc:231 UI/GTK2/src/pinot-dbus-daemon.cc:299
+#: UI/GTK2/src/pinot.cc:232 UI/GTK2/src/pinot-dbus-daemon.cc:300
 msgid "French"
 msgstr "Francese"
 
-#: UI/GTK2/src/pinot.cc:232 UI/GTK2/src/pinot-dbus-daemon.cc:300
+#: UI/GTK2/src/pinot.cc:233 UI/GTK2/src/pinot-dbus-daemon.cc:301
 msgid "German"
 msgstr "Tedesco"
 
-#: UI/GTK2/src/pinot.cc:233 UI/GTK2/src/pinot-dbus-daemon.cc:301
+#: UI/GTK2/src/pinot.cc:234 UI/GTK2/src/pinot-dbus-daemon.cc:302
 msgid "Italian"
 msgstr "Italiano"
 
-#: UI/GTK2/src/pinot.cc:234 UI/GTK2/src/pinot-dbus-daemon.cc:302
+#: UI/GTK2/src/pinot.cc:235 UI/GTK2/src/pinot-dbus-daemon.cc:303
 msgid "Norwegian"
 msgstr "Norvegese"
 
-#: UI/GTK2/src/pinot.cc:235 UI/GTK2/src/pinot-dbus-daemon.cc:303
+#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:304
 msgid "Portuguese"
 msgstr "Portoghese"
 
-#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:304
+#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:305
 msgid "Russian"
 msgstr "Russo"
 
-#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:305
+#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:306
 msgid "Spanish"
 msgstr "Spagnolo"
 
-#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:306
+#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:307
 msgid "Swedish"
 msgstr "Svedese"
 
-#: UI/GTK2/src/pinot.cc:263
+#: UI/GTK2/src/pinot.cc:264
 msgid "Couldn't open index"
 msgstr "Impossibile aprire l'indice"
 
-#: UI/GTK2/src/pinot.cc:279
+#: UI/GTK2/src/pinot.cc:284
 msgid "Couldn't create history database"
-msgstr "Impossibile creare un history del database"
+msgstr "Impossibile creare una cronologia del database"
 
-#: UI/GTK2/src/pinot.cc:309
+#: UI/GTK2/src/pinot.cc:325
 msgid "Updating all documents in My Web Pages is recommended"
-msgstr ""
+msgstr "E' consigliato aggiornare tutti le pagine web personali"
 
+#. Add default labels
 #: UI/GTK2/src/PinotSettings.cpp:249
 msgid "Important"
 msgstr "Importante"
@@ -542,7 +556,7 @@
 
 #: UI/GTK2/src/prefsDialog.cc:107
 msgid "Pattern"
-msgstr "Motivo"
+msgstr "Espressione"
 
 #: UI/GTK2/src/prefsDialog.cc:471
 msgid "New Label"
@@ -550,11 +564,11 @@
 
 #: UI/GTK2/src/prefsDialog.cc:512
 msgid "Directory to index"
-msgstr "Directory per l'indice"
+msgstr "Directory da indicizzare"
 
 #: UI/GTK2/src/prefsDialog.cc:570
 msgid "Mbox File Location"
-msgstr "Mbox File Locationc"
+msgstr "Posizione dei File Mbox"
 
 #: UI/GTK2/src/prefsDialog_glade.cc:66
 msgid "Google API key:"
@@ -566,19 +580,19 @@
 
 #: UI/GTK2/src/prefsDialog_glade.cc:70
 msgid "Queries:"
-msgstr "Queries:"
+msgstr "Richieste:"
 
 #: UI/GTK2/src/prefsDialog_glade.cc:71
 msgid "Enable search terms suggestion"
-msgstr ""
+msgstr "Abilita suggerimenti per ricerca"
 
 #: UI/GTK2/src/prefsDialog_glade.cc:73
 msgid "Ignore robots.txt and Robots META tag"
-msgstr ""
+msgstr "Ignora robots.txt e Robots META tag"
 
 #: UI/GTK2/src/prefsDialog_glade.cc:74
 msgid "HTTP crawling:"
-msgstr ""
+msgstr "HTTP crawling:"
 
 #: UI/GTK2/src/prefsDialog_glade.cc:77
 msgid "General"
@@ -586,15 +600,15 @@
 
 #: UI/GTK2/src/prefsDialog_glade.cc:79
 msgid "Direct connection to the Internet"
-msgstr ""
+msgstr "Connesso direttamente a Internet"
 
 #: UI/GTK2/src/prefsDialog_glade.cc:80
 msgid "Manual proxy configuration:"
-msgstr ""
+msgstr "Configurazione manuale del proxy:"
 
 #: UI/GTK2/src/prefsDialog_glade.cc:93
 msgid "Network"
-msgstr ""
+msgstr "Rete"
 
 #: UI/GTK2/src/prefsDialog_glade.cc:94
 msgid "Labels are used to classify indexed documents:"
@@ -603,11 +617,11 @@
 #: UI/GTK2/src/prefsDialog_glade.cc:99 UI/GTK2/src/prefsDialog_glade.cc:119
 #: UI/GTK2/src/prefsDialog_glade.cc:132 UI/GTK2/src/prefsDialog_glade.cc:145
 msgid "Add"
-msgstr "Aggiungere"
+msgstr "aggiungi"
 
 #: UI/GTK2/src/prefsDialog_glade.cc:105
 msgid "Remove"
-msgstr "Rimuovere"
+msgstr "Rimuovi"
 
 #: UI/GTK2/src/prefsDialog_glade.cc:113
 msgid "Labels"
@@ -616,17 +630,17 @@
 #: UI/GTK2/src/prefsDialog_glade.cc:114
 msgid "These directories will be indexed and optionally monitored for changes:"
 msgstr ""
-"Queste directories devono essere indicizzate e opzionalmente monitorate per "
+"Queste directory devono essere indicizzate e opzionalmente monitorate per "
 "cambiamenti:"
 
 #: UI/GTK2/src/prefsDialog_glade.cc:127
 msgid "Mail boxes of type mbox can be monitored and indexed:"
 msgstr ""
-"Le boxe delle Mail di tipo mbox possono essere monitorate e indicizzate:"
+"Le caselle postali di tipo mbox possono essere monitorate e indicizzate:"
 
 #: UI/GTK2/src/prefsDialog_glade.cc:140
 msgid "Specify any file pattern you wish to exclude from indexing:"
-msgstr ""
+msgstr "Specifica una espressione che escluda file dall'indicizzazione"
 
 #: UI/GTK2/src/prefsDialog_glade.cc:154
 msgid "Indexing"
@@ -654,12 +668,13 @@
 
 #: UI/GTK2/src/propertiesDialog_glade.cc:70
 msgid "Size:"
-msgstr ""
+msgstr "Dimesione"
 
 #: UI/GTK2/src/propertiesDialog_glade.cc:73
 msgid "Terms:"
-msgstr ""
+msgstr "Termini:"
 
+#. All supported filters
 #: UI/GTK2/src/queryDialog.cc:119
 msgid "Host name"
 msgstr "Nome host"
@@ -670,12 +685,14 @@
 
 #: UI/GTK2/src/queryDialog.cc:121
 msgid "File extension"
-msgstr ""
+msgstr "Estensione file"
 
+#. This is the title column
 #: UI/GTK2/src/queryDialog.cc:122 UI/GTK2/src/ResultsTree.cpp:133
 msgid "Title"
 msgstr "Titolo"
 
+#. URL
 #: UI/GTK2/src/queryDialog.cc:123 UI/GTK2/src/ResultsTree.cpp:143
 msgid "URL"
 msgstr "URL"
@@ -694,11 +711,11 @@
 
 #: UI/GTK2/src/queryDialog.cc:246
 msgid "Start date"
-msgstr ""
+msgstr "Data iniziale"
 
 #: UI/GTK2/src/queryDialog.cc:261
 msgid "End date"
-msgstr ""
+msgstr "Data finale"
 
 #: UI/GTK2/src/queryDialog_glade.cc:72
 msgid "New filter:"
@@ -710,7 +727,7 @@
 
 #: UI/GTK2/src/queryDialog_glade.cc:83
 msgid "Index results with label"
-msgstr ""
+msgstr "Indice risultati con descrizione"
 
 #: UI/GTK2/src/queryDialog_glade.cc:86
 msgid "Number of results:"
@@ -718,131 +735,135 @@
 
 #: UI/GTK2/src/queryDialog_glade.cc:89
 msgid "Start date:"
-msgstr ""
+msgstr "Data di inizio:"
 
 #: UI/GTK2/src/queryDialog_glade.cc:90
 msgid "End date:"
-msgstr ""
+msgstr "Data di fine:"
 
 #: UI/GTK2/src/queryDialog_glade.cc:201
 msgid "Query parameters"
-msgstr "Parametri Querys"
+msgstr "Parametri di Ricerca"
 
+#. This is the score column
 #: UI/GTK2/src/ResultsTree.cpp:122
 msgid "Score"
-msgstr "Valutazione"
+msgstr "Punteggio"
 
 #: UI/GTK2/src/ResultsTree.cpp:180
 msgid "Extract"
-msgstr "Estrarre"
+msgstr "Estrai"
 
 #: UI/GTK2/src/statisticsDialog.cc:72
 msgid "Indexes"
-msgstr ""
+msgstr "Indici"
 
 #: UI/GTK2/src/statisticsDialog.cc:87
 msgid "History"
-msgstr ""
+msgstr "Cronologia"
 
 #: UI/GTK2/src/statisticsDialog.cc:92
 msgid "Daemon"
-msgstr ""
+msgstr "Demone"
 
 #: UI/GTK2/src/statisticsDialog.cc:128 UI/GTK2/src/statisticsDialog.cc:143
 msgid "documents"
-msgstr ""
+msgstr "documenti"
 
 #: UI/GTK2/src/statisticsDialog.cc:132 UI/GTK2/src/statisticsDialog.cc:147
 msgid "Unknown error"
-msgstr ""
+msgstr "errore Sconosciuto"
 
 #: UI/GTK2/src/statisticsDialog.cc:154
 msgid "Viewed"
-msgstr ""
+msgstr "Visti"
 
 #: UI/GTK2/src/statisticsDialog.cc:154
 msgid "results"
-msgstr ""
+msgstr "risultati"
 
+#. FIXME: check whether it's actually running !
 #: UI/GTK2/src/statisticsDialog.cc:171
 msgid "Running under PID"
-msgstr ""
+msgstr "Avviato con PID"
 
 #: UI/GTK2/src/statisticsDialog.cc:175
 msgid "Currently not running"
-msgstr ""
+msgstr "Attualmente non in esecuzione"
 
 #: UI/GTK2/src/statisticsDialog.cc:182
 msgid "Crawled"
-msgstr ""
+msgstr "Analizzati"
 
 #: UI/GTK2/src/statisticsDialog.cc:182
 msgid "files"
-msgstr ""
+msgstr "files"
 
 #: UI/GTK2/src/statisticsDialog.cc:205
 msgid "Errors"
-msgstr ""
+msgstr "Errori"
 
 #: UI/GTK2/src/WorkerThreads.cpp:301
 msgid "Can't index mail here"
 msgstr "Impossibile indicizzare la mail qui"
 
-#: UI/GTK2/src/WorkerThreads.cpp:322
+#: UI/GTK2/src/WorkerThreads.cpp:322 UI/GTK2/src/WorkerThreads.cpp:555
 msgid "is already being indexed"
-msgstr "? ora stato indicizzato"
+msgstr "? gia' stato indicizzato"
 
 #: UI/GTK2/src/WorkerThreads.cpp:332
 msgid "is blacklisted"
-msgstr ""
+msgstr "e' blacklistato"
 
-#: UI/GTK2/src/WorkerThreads.cpp:641 UI/GTK2/src/WorkerThreads.cpp:953
-#: UI/GTK2/src/WorkerThreads.cpp:1038 UI/GTK2/src/WorkerThreads.cpp:1047
-#: UI/GTK2/src/WorkerThreads.cpp:1233 UI/GTK2/src/WorkerThreads.cpp:1503
-#: UI/GTK2/src/WorkerThreads.cpp:1636
+#: UI/GTK2/src/WorkerThreads.cpp:657 UI/GTK2/src/WorkerThreads.cpp:969
+#: UI/GTK2/src/WorkerThreads.cpp:1054 UI/GTK2/src/WorkerThreads.cpp:1063
+#: UI/GTK2/src/WorkerThreads.cpp:1249 UI/GTK2/src/WorkerThreads.cpp:1519
+#: UI/GTK2/src/WorkerThreads.cpp:1652
 msgid "Index error on"
-msgstr "Indice errori su"
+msgstr "Errori indice su"
 
-#: UI/GTK2/src/WorkerThreads.cpp:763 UI/GTK2/src/WorkerThreads.cpp:974
+#: UI/GTK2/src/WorkerThreads.cpp:779 UI/GTK2/src/WorkerThreads.cpp:990
 msgid "Couldn't create search engine"
 msgstr "Impossibile creare un motore di ricerca"
 
-#: UI/GTK2/src/WorkerThreads.cpp:789 UI/GTK2/src/WorkerThreads.cpp:988
+#: UI/GTK2/src/WorkerThreads.cpp:805 UI/GTK2/src/WorkerThreads.cpp:1004
 msgid "Couldn't run query on search engine"
 msgstr "Impossibile avviare un query sul motore di ricerca"
 
-#: UI/GTK2/src/WorkerThreads.cpp:833
+#: UI/GTK2/src/WorkerThreads.cpp:849
 msgid "No title"
 msgstr "Nessun titolo"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1141
+#: UI/GTK2/src/WorkerThreads.cpp:1157
 msgid "Couldn't obtain downloader for protocol"
-msgstr "Impossibile ottenere download per protocollo"
+msgstr "Impossibile ottenere un downloader per il protocollo"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1166
+#: UI/GTK2/src/WorkerThreads.cpp:1182
 msgid "Couldn't retrieve"
-msgstr "Impossibile ritrovare"
+msgstr "Impossibile recuperare"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1263 UI/GTK2/src/WorkerThreads.cpp:1342
+#: UI/GTK2/src/WorkerThreads.cpp:1279 UI/GTK2/src/WorkerThreads.cpp:1358
 msgid "Cannot index document type"
-msgstr ""
+msgstr "Impossibile indicizzare tipo di documento"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1267 UI/GTK2/src/WorkerThreads.cpp:1346
+#: UI/GTK2/src/WorkerThreads.cpp:1283 UI/GTK2/src/WorkerThreads.cpp:1362
 msgid "at"
-msgstr ""
+msgstr "a"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1378
+#. No, it isn't
+#: UI/GTK2/src/WorkerThreads.cpp:1394
 msgid "Robots META tag forbids indexing"
-msgstr ""
+msgstr "il Robots META tag vieta l'indicizzazione"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1432
+#: UI/GTK2/src/WorkerThreads.cpp:1448
 msgid "Couldn't index"
 msgstr "Impossibile indicizzare"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1514
+#. Be pessimistic and assume something will go wrong ;-)
+#: UI/GTK2/src/WorkerThreads.cpp:1530
 msgid "Couldn't unindex document(s)"
-msgstr ""
+msgstr "Impossiible rimuovere i(l) documento/i dall'indice"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1648
+#: UI/GTK2/src/WorkerThreads.cpp:1664
 msgid "Couldn't update document"
 msgstr "Impossibile aggiornare il documento"

Modified: trunk/po/nl.po
===================================================================
--- trunk/po/nl.po	2007-05-22 11:18:08 UTC (rev 842)
+++ trunk/po/nl.po	2007-05-22 11:53:33 UTC (rev 843)
@@ -5,16 +5,16 @@
 #, fuzzy
 msgid ""
 msgstr ""
-"Project-Id-Version: pinot 0.72\n"
+"Project-Id-Version: pinot 0.73\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2007-04-27 23:44+0800\n"
-"PO-Revision-Date: 2007-02-17 17:34+0800\n"
-"Last-Translator: Fabrice Colin <fabricecolin at users.berlios.de>\n"
+"POT-Creation-Date: 2007-05-19 19:02+0800\n"
+"PO-Revision-Date: 2007-05-03 16:48+0000\n"
+"Last-Translator: JW <jw00000 at gmail.com>\n"
 "Language-Team: Dutch <nl at li.org>\n"
 "MIME-Version: 1.0\n"
 "Content-Type: text/plain; charset=UTF-8\n"
 "Content-Transfer-Encoding: 8bit\n"
-"X-Rosetta-Export-Date: 2006-12-03 15:18+0000\n"
+"X-Rosetta-Export-Date: 2007-05-06 00:38:08+0000\n"
 
 #: UI/GTK2/src/EnginesTree.cpp:70
 msgid "Search Engines"
@@ -24,6 +24,9 @@
 msgid "Current User"
 msgstr "Huidige gebruiker"
 
+#. Bind the callback's parameter to the index name
+#. Enable these menu items unless it is not the documents index
+#. Internal indices
 #: UI/GTK2/src/EnginesTree.cpp:339 UI/GTK2/src/mainWindow.cc:324
 #: UI/GTK2/src/mainWindow.cc:327 UI/GTK2/src/mainWindow.cc:540
 #: UI/GTK2/src/mainWindow.cc:1027 UI/GTK2/src/mainWindow.cc:1198
@@ -31,18 +34,21 @@
 #: UI/GTK2/src/mainWindow.cc:1293 UI/GTK2/src/mainWindow.cc:1930
 #: UI/GTK2/src/PinotSettings.cpp:243 UI/GTK2/src/PinotSettings.cpp:1344
 #: UI/GTK2/src/PinotSettings.cpp:1400 UI/GTK2/src/statisticsDialog.cc:77
-#: UI/GTK2/src/WorkerThreads.cpp:811 UI/GTK2/src/WorkerThreads.cpp:870
+#: UI/GTK2/src/WorkerThreads.cpp:827 UI/GTK2/src/WorkerThreads.cpp:886
 msgid "My Web Pages"
 msgstr "Mijn webpagina's"
 
+#. Populate the submenu
+#. Bind the callback's parameter to the index name
 #: UI/GTK2/src/EnginesTree.cpp:340 UI/GTK2/src/mainWindow.cc:318
 #: UI/GTK2/src/mainWindow.cc:321 UI/GTK2/src/mainWindow.cc:1034
 #: UI/GTK2/src/PinotSettings.cpp:244 UI/GTK2/src/PinotSettings.cpp:1345
 #: UI/GTK2/src/PinotSettings.cpp:1401 UI/GTK2/src/statisticsDialog.cc:82
-#: UI/GTK2/src/WorkerThreads.cpp:816 UI/GTK2/src/WorkerThreads.cpp:880
+#: UI/GTK2/src/WorkerThreads.cpp:832 UI/GTK2/src/WorkerThreads.cpp:896
 msgid "My Documents"
 msgstr "Mijn documenten"
 
+#. The last column is for the timestamp
 #: UI/GTK2/src/dateDialog_glade.cc:76 UI/GTK2/src/queryDialog_glade.cc:91
 #: UI/GTK2/src/queryDialog_glade.cc:92 UI/GTK2/src/ResultsTree.cpp:151
 #, fuzzy
@@ -84,7 +90,7 @@
 
 #: UI/GTK2/src/indexDialog_glade.cc:79 UI/GTK2/src/prefsDialog_glade.cc:82
 msgid "Address:"
-msgstr ""
+msgstr "Adres:"
 
 #: UI/GTK2/src/indexDialog_glade.cc:183
 msgid "External index"
@@ -131,7 +137,7 @@
 
 #: UI/GTK2/src/launcherDialog_glade.cc:67
 msgid "Use this command for other documents of the same type."
-msgstr ""
+msgstr "Gebruik dit commando voor andere documenten van hetzelfde type."
 
 #: UI/GTK2/src/launcherDialog_glade.cc:99
 msgid "Helper application"
@@ -150,6 +156,7 @@
 msgid "Summary"
 msgstr "Samenvatting"
 
+#. Set tooltips
 #: UI/GTK2/src/mainWindow.cc:183
 msgid "Show all search engines"
 msgstr "Toon alle zoekmachines"
@@ -162,6 +169,7 @@
 msgid "Remove index"
 msgstr "Verwijderen index"
 
+#. Now we are ready
 #: UI/GTK2/src/mainWindow.cc:191
 msgid "Ready"
 msgstr "Gereed"
@@ -175,10 +183,12 @@
 msgid "Undefined"
 msgstr "<niet gedefinieerd>"
 
+#. Show the URL of the first result in the status bar
 #: UI/GTK2/src/mainWindow.cc:475
 msgid "Result location is"
 msgstr "Uitvoerlocatie is"
 
+#. Show the URL in the status bar
 #: UI/GTK2/src/mainWindow.cc:550
 msgid "Document location is"
 msgstr "Documentlocatie is"
@@ -215,6 +225,7 @@
 msgid "Updated label(s)"
 msgstr "Vernieuwde na(a)m(en)"
 
+#. Yes, it did
 #: UI/GTK2/src/mainWindow.cc:1208
 msgid "Updated document"
 msgstr "Vernieuwd document"
@@ -253,6 +264,7 @@
 msgid "Export Results"
 msgstr "_Resultaten"
 
+#. Find this query
 #: UI/GTK2/src/mainWindow.cc:1827 UI/GTK2/src/mainWindow.cc:2491
 msgid "Live query"
 msgstr "Rechtstreekse query"
@@ -261,13 +273,13 @@
 msgid "Couldn't find query"
 msgstr "Kon query niet vinden"
 
-#: UI/GTK2/src/mainWindow.cc:2045 UI/GTK2/src/WorkerThreads.cpp:628
-#: UI/GTK2/src/WorkerThreads.cpp:1623
+#: UI/GTK2/src/mainWindow.cc:2045 UI/GTK2/src/WorkerThreads.cpp:644
+#: UI/GTK2/src/WorkerThreads.cpp:1639
 msgid "Index"
 msgstr "Inhoudsopgave"
 
-#: UI/GTK2/src/mainWindow.cc:2049 UI/GTK2/src/WorkerThreads.cpp:632
-#: UI/GTK2/src/WorkerThreads.cpp:1627
+#: UI/GTK2/src/mainWindow.cc:2049 UI/GTK2/src/WorkerThreads.cpp:648
+#: UI/GTK2/src/WorkerThreads.cpp:1643
 msgid "doesn't exist"
 msgstr "bestaat niet"
 
@@ -285,7 +297,7 @@
 
 #: UI/GTK2/src/mainWindow.cc:2272
 msgid "Search the Web and your documents !"
-msgstr ""
+msgstr "Zoek het web en uw documenten!"
 
 #: UI/GTK2/src/mainWindow.cc:2273
 #, fuzzy
@@ -368,7 +380,7 @@
 #: UI/GTK2/src/mainWindow_glade.cc:164 UI/GTK2/src/statisticsDialog.cc:50
 #: UI/GTK2/src/statisticsDialog_glade.cc:87
 msgid "Status"
-msgstr ""
+msgstr "Status"
 
 #: UI/GTK2/src/mainWindow_glade.cc:185
 msgid "Search Engine"
@@ -451,71 +463,74 @@
 msgid "Pinot"
 msgstr "Pinot"
 
-#: UI/GTK2/src/pinot.cc:226 UI/GTK2/src/pinot-dbus-daemon.cc:294
+#. Localize language names
+#: UI/GTK2/src/pinot.cc:227 UI/GTK2/src/pinot-dbus-daemon.cc:295
 #: UI/GTK2/src/propertiesDialog.cc:60 UI/GTK2/src/propertiesDialog.cc:69
 msgid "Unknown"
 msgstr "Niet bekend"
 
-#: UI/GTK2/src/pinot.cc:227 UI/GTK2/src/pinot-dbus-daemon.cc:295
+#: UI/GTK2/src/pinot.cc:228 UI/GTK2/src/pinot-dbus-daemon.cc:296
 msgid "Danish"
 msgstr "Deens"
 
-#: UI/GTK2/src/pinot.cc:228 UI/GTK2/src/pinot-dbus-daemon.cc:296
+#: UI/GTK2/src/pinot.cc:229 UI/GTK2/src/pinot-dbus-daemon.cc:297
 msgid "Dutch"
 msgstr "Nederlands"
 
-#: UI/GTK2/src/pinot.cc:229 UI/GTK2/src/pinot-dbus-daemon.cc:297
+#: UI/GTK2/src/pinot.cc:230 UI/GTK2/src/pinot-dbus-daemon.cc:298
 msgid "English"
 msgstr "Engels"
 
-#: UI/GTK2/src/pinot.cc:230 UI/GTK2/src/pinot-dbus-daemon.cc:298
+#: UI/GTK2/src/pinot.cc:231 UI/GTK2/src/pinot-dbus-daemon.cc:299
 msgid "Finnish"
 msgstr "Fins"
 
-#: UI/GTK2/src/pinot.cc:231 UI/GTK2/src/pinot-dbus-daemon.cc:299
+#: UI/GTK2/src/pinot.cc:232 UI/GTK2/src/pinot-dbus-daemon.cc:300
 msgid "French"
 msgstr "Frans"
 
-#: UI/GTK2/src/pinot.cc:232 UI/GTK2/src/pinot-dbus-daemon.cc:300
+#: UI/GTK2/src/pinot.cc:233 UI/GTK2/src/pinot-dbus-daemon.cc:301
 msgid "German"
 msgstr "Duits"
 
-#: UI/GTK2/src/pinot.cc:233 UI/GTK2/src/pinot-dbus-daemon.cc:301
+#: UI/GTK2/src/pinot.cc:234 UI/GTK2/src/pinot-dbus-daemon.cc:302
 msgid "Italian"
 msgstr "Italiaans"
 
-#: UI/GTK2/src/pinot.cc:234 UI/GTK2/src/pinot-dbus-daemon.cc:302
+#: UI/GTK2/src/pinot.cc:235 UI/GTK2/src/pinot-dbus-daemon.cc:303
 msgid "Norwegian"
 msgstr "Noors"
 
-#: UI/GTK2/src/pinot.cc:235 UI/GTK2/src/pinot-dbus-daemon.cc:303
+#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:304
 msgid "Portuguese"
 msgstr "Portugees"
 
-#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:304
+#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:305
 msgid "Russian"
 msgstr "Russisch"
 
-#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:305
+#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:306
 msgid "Spanish"
 msgstr "Spaans"
 
-#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:306
+#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:307
 msgid "Swedish"
 msgstr "Zweeds"
 
-#: UI/GTK2/src/pinot.cc:263
+#: UI/GTK2/src/pinot.cc:264
 msgid "Couldn't open index"
 msgstr "Kan index niet openen"
 
-#: UI/GTK2/src/pinot.cc:279
+#: UI/GTK2/src/pinot.cc:284
 msgid "Couldn't create history database"
 msgstr "Kon historische database niet maken"
 
-#: UI/GTK2/src/pinot.cc:309
+#: UI/GTK2/src/pinot.cc:325
 msgid "Updating all documents in My Web Pages is recommended"
 msgstr ""
+"Het is aangeraden alle documenten in \"Mijn webpagina's\" te vernieuwen"
 
+#. Add default labels
 #: UI/GTK2/src/PinotSettings.cpp:249
 msgid "Important"
 msgstr "Belangrijk"
@@ -530,7 +545,7 @@
 
 #: UI/GTK2/src/PinotSettings.cpp:1140
 msgid "Unclassified"
-msgstr "Niet geklassificeerd"
+msgstr "Niet geclassificeerd"
 
 #: UI/GTK2/src/prefsDialog.cc:82
 msgid "Name"
@@ -591,15 +606,15 @@
 
 #: UI/GTK2/src/prefsDialog_glade.cc:79
 msgid "Direct connection to the Internet"
-msgstr ""
+msgstr "Directe verbinding met het internet"
 
 #: UI/GTK2/src/prefsDialog_glade.cc:80
 msgid "Manual proxy configuration:"
-msgstr ""
+msgstr "Manuele proxy-configuratie:"
 
 #: UI/GTK2/src/prefsDialog_glade.cc:93
 msgid "Network"
-msgstr ""
+msgstr "Netwerk"
 
 #: UI/GTK2/src/prefsDialog_glade.cc:94
 msgid "Labels are used to classify indexed documents:"
@@ -659,12 +674,13 @@
 
 #: UI/GTK2/src/propertiesDialog_glade.cc:70
 msgid "Size:"
-msgstr ""
+msgstr "Grootte:"
 
 #: UI/GTK2/src/propertiesDialog_glade.cc:73
 msgid "Terms:"
-msgstr ""
+msgstr "Termen:"
 
+#. All supported filters
 #: UI/GTK2/src/queryDialog.cc:119
 msgid "Host name"
 msgstr "Hostnaam"
@@ -678,10 +694,12 @@
 msgid "File extension"
 msgstr "Bestandssuffix"
 
+#. This is the title column
 #: UI/GTK2/src/queryDialog.cc:122 UI/GTK2/src/ResultsTree.cpp:133
 msgid "Title"
 msgstr "Titel"
 
+#. URL
 #: UI/GTK2/src/queryDialog.cc:123 UI/GTK2/src/ResultsTree.cpp:143
 msgid "URL"
 msgstr "URL"
@@ -700,11 +718,11 @@
 
 #: UI/GTK2/src/queryDialog.cc:246
 msgid "Start date"
-msgstr ""
+msgstr "Begindatum"
 
 #: UI/GTK2/src/queryDialog.cc:261
 msgid "End date"
-msgstr ""
+msgstr "Einddatum"
 
 #: UI/GTK2/src/queryDialog_glade.cc:72
 msgid "New filter:"
@@ -725,16 +743,17 @@
 
 #: UI/GTK2/src/queryDialog_glade.cc:89
 msgid "Start date:"
-msgstr ""
+msgstr "Begindatum:"
 
 #: UI/GTK2/src/queryDialog_glade.cc:90
 msgid "End date:"
-msgstr ""
+msgstr "Einddatum:"
 
 #: UI/GTK2/src/queryDialog_glade.cc:201
 msgid "Query parameters"
 msgstr "Queryparameters"
 
+#. This is the score column
 #: UI/GTK2/src/ResultsTree.cpp:122
 msgid "Score"
 msgstr "Score"
@@ -755,7 +774,7 @@
 
 #: UI/GTK2/src/statisticsDialog.cc:92
 msgid "Daemon"
-msgstr ""
+msgstr "Daemon"
 
 #: UI/GTK2/src/statisticsDialog.cc:128 UI/GTK2/src/statisticsDialog.cc:143
 #, fuzzy
@@ -763,9 +782,8 @@
 msgstr "Mijn documenten"
 
 #: UI/GTK2/src/statisticsDialog.cc:132 UI/GTK2/src/statisticsDialog.cc:147
-#, fuzzy
 msgid "Unknown error"
-msgstr "Niet bekend"
+msgstr "Onbekende fout."
 
 #: UI/GTK2/src/statisticsDialog.cc:154
 #, fuzzy
@@ -777,6 +795,7 @@
 msgid "results"
 msgstr "_Resultaten"
 
+#. FIXME: check whether it's actually running !
 #: UI/GTK2/src/statisticsDialog.cc:171
 #, fuzzy
 msgid "Running under PID"
@@ -784,7 +803,7 @@
 
 #: UI/GTK2/src/statisticsDialog.cc:175
 msgid "Currently not running"
-msgstr ""
+msgstr "Wordt momenteel niet uitgevoerd"
 
 #: UI/GTK2/src/statisticsDialog.cc:182
 msgid "Crawled"
@@ -792,17 +811,17 @@
 
 #: UI/GTK2/src/statisticsDialog.cc:182
 msgid "files"
-msgstr ""
+msgstr "bestanden"
 
 #: UI/GTK2/src/statisticsDialog.cc:205
 msgid "Errors"
-msgstr ""
+msgstr "Fouten"
 
 #: UI/GTK2/src/WorkerThreads.cpp:301
 msgid "Can't index mail here"
 msgstr "Kan mail hier niet indexeren"
 
-#: UI/GTK2/src/WorkerThreads.cpp:322
+#: UI/GTK2/src/WorkerThreads.cpp:322 UI/GTK2/src/WorkerThreads.cpp:555
 msgid "is already being indexed"
 msgstr "wordt al geindexeerd"
 
@@ -810,53 +829,55 @@
 msgid "is blacklisted"
 msgstr "staat op blacklist"
 
-#: UI/GTK2/src/WorkerThreads.cpp:641 UI/GTK2/src/WorkerThreads.cpp:953
-#: UI/GTK2/src/WorkerThreads.cpp:1038 UI/GTK2/src/WorkerThreads.cpp:1047
-#: UI/GTK2/src/WorkerThreads.cpp:1233 UI/GTK2/src/WorkerThreads.cpp:1503
-#: UI/GTK2/src/WorkerThreads.cpp:1636
+#: UI/GTK2/src/WorkerThreads.cpp:657 UI/GTK2/src/WorkerThreads.cpp:969
+#: UI/GTK2/src/WorkerThreads.cpp:1054 UI/GTK2/src/WorkerThreads.cpp:1063
+#: UI/GTK2/src/WorkerThreads.cpp:1249 UI/GTK2/src/WorkerThreads.cpp:1519
+#: UI/GTK2/src/WorkerThreads.cpp:1652
 msgid "Index error on"
 msgstr "Indexeringsfout op"
 
-#: UI/GTK2/src/WorkerThreads.cpp:763 UI/GTK2/src/WorkerThreads.cpp:974
+#: UI/GTK2/src/WorkerThreads.cpp:779 UI/GTK2/src/WorkerThreads.cpp:990
 msgid "Couldn't create search engine"
 msgstr "Kon zoekmachine niet maken"
 
-#: UI/GTK2/src/WorkerThreads.cpp:789 UI/GTK2/src/WorkerThreads.cpp:988
+#: UI/GTK2/src/WorkerThreads.cpp:805 UI/GTK2/src/WorkerThreads.cpp:1004
 msgid "Couldn't run query on search engine"
 msgstr "Kon query niet uitvoeren op zoekmachine"
 
-#: UI/GTK2/src/WorkerThreads.cpp:833
+#: UI/GTK2/src/WorkerThreads.cpp:849
 msgid "No title"
 msgstr "Geen titel"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1141
+#: UI/GTK2/src/WorkerThreads.cpp:1157
 msgid "Couldn't obtain downloader for protocol"
 msgstr "Kon geen downloader verkrijgen voor protocol"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1166
+#: UI/GTK2/src/WorkerThreads.cpp:1182
 msgid "Couldn't retrieve"
 msgstr "Kon niet opzoeken"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1263 UI/GTK2/src/WorkerThreads.cpp:1342
+#: UI/GTK2/src/WorkerThreads.cpp:1279 UI/GTK2/src/WorkerThreads.cpp:1358
 msgid "Cannot index document type"
 msgstr "Kan documenttype niet indexeren"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1267 UI/GTK2/src/WorkerThreads.cpp:1346
+#: UI/GTK2/src/WorkerThreads.cpp:1283 UI/GTK2/src/WorkerThreads.cpp:1362
 msgid "at"
 msgstr "bij"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1378
+#. No, it isn't
+#: UI/GTK2/src/WorkerThreads.cpp:1394
 msgid "Robots META tag forbids indexing"
 msgstr "Robots META taf verbiedt indexeren"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1432
+#: UI/GTK2/src/WorkerThreads.cpp:1448
 msgid "Couldn't index"
 msgstr "Kon niet indexeren"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1514
+#. Be pessimistic and assume something will go wrong ;-)
+#: UI/GTK2/src/WorkerThreads.cpp:1530
 msgid "Couldn't unindex document(s)"
 msgstr "Kan indexering van bestand(en) niet ongedaan maken"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1648
+#: UI/GTK2/src/WorkerThreads.cpp:1664
 msgid "Couldn't update document"
 msgstr "Kan document niet actualiseren"

Modified: trunk/po/pt.po
===================================================================
--- trunk/po/pt.po	2007-05-22 11:18:08 UTC (rev 842)
+++ trunk/po/pt.po	2007-05-22 11:53:33 UTC (rev 843)
@@ -5,16 +5,16 @@
 #, fuzzy
 msgid ""
 msgstr ""
-"Project-Id-Version: pinot 0.72\n"
+"Project-Id-Version: pinot 0.73\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2007-04-27 23:44+0800\n"
+"POT-Creation-Date: 2007-05-19 19:02+0800\n"
 "PO-Revision-Date: 2007-03-11 10:32+0000\n"
 "Last-Translator: _PN_boy <pedro_nuno_pn at iol.pt>\n"
 "Language-Team: Portuguese <pt at li.org>\n"
 "MIME-Version: 1.0\n"
 "Content-Type: text/plain; charset=UTF-8\n"
 "Content-Transfer-Encoding: 8bit\n"
-"X-Rosetta-Export-Date: 2007-03-24 04:08+0000\n"
+"X-Rosetta-Export-Date: 2007-05-22 11:38:06+0000\n"
 
 #: UI/GTK2/src/EnginesTree.cpp:70
 msgid "Search Engines"
@@ -25,6 +25,9 @@
 msgid "Current User"
 msgstr "Utilizador corrente"
 
+#. Bind the callback's parameter to the index name
+#. Enable these menu items unless it is not the documents index
+#. Internal indices
 #: UI/GTK2/src/EnginesTree.cpp:339 UI/GTK2/src/mainWindow.cc:324
 #: UI/GTK2/src/mainWindow.cc:327 UI/GTK2/src/mainWindow.cc:540
 #: UI/GTK2/src/mainWindow.cc:1027 UI/GTK2/src/mainWindow.cc:1198
@@ -32,18 +35,21 @@
 #: UI/GTK2/src/mainWindow.cc:1293 UI/GTK2/src/mainWindow.cc:1930
 #: UI/GTK2/src/PinotSettings.cpp:243 UI/GTK2/src/PinotSettings.cpp:1344
 #: UI/GTK2/src/PinotSettings.cpp:1400 UI/GTK2/src/statisticsDialog.cc:77
-#: UI/GTK2/src/WorkerThreads.cpp:811 UI/GTK2/src/WorkerThreads.cpp:870
+#: UI/GTK2/src/WorkerThreads.cpp:827 UI/GTK2/src/WorkerThreads.cpp:886
 msgid "My Web Pages"
 msgstr "As minhas p?ginas Web"
 
+#. Populate the submenu
+#. Bind the callback's parameter to the index name
 #: UI/GTK2/src/EnginesTree.cpp:340 UI/GTK2/src/mainWindow.cc:318
 #: UI/GTK2/src/mainWindow.cc:321 UI/GTK2/src/mainWindow.cc:1034
 #: UI/GTK2/src/PinotSettings.cpp:244 UI/GTK2/src/PinotSettings.cpp:1345
 #: UI/GTK2/src/PinotSettings.cpp:1401 UI/GTK2/src/statisticsDialog.cc:82
-#: UI/GTK2/src/WorkerThreads.cpp:816 UI/GTK2/src/WorkerThreads.cpp:880
+#: UI/GTK2/src/WorkerThreads.cpp:832 UI/GTK2/src/WorkerThreads.cpp:896
 msgid "My Documents"
 msgstr "Os Meus Documentos"
 
+#. The last column is for the timestamp
 #: UI/GTK2/src/dateDialog_glade.cc:76 UI/GTK2/src/queryDialog_glade.cc:91
 #: UI/GTK2/src/queryDialog_glade.cc:92 UI/GTK2/src/ResultsTree.cpp:151
 msgid "Date"
@@ -148,6 +154,7 @@
 msgid "Summary"
 msgstr "Resumo"
 
+#. Set tooltips
 #: UI/GTK2/src/mainWindow.cc:183
 msgid "Show all search engines"
 msgstr "Mostrar todos os motores de pesquisa"
@@ -160,6 +167,7 @@
 msgid "Remove index"
 msgstr "Remover index"
 
+#. Now we are ready
 #: UI/GTK2/src/mainWindow.cc:191
 msgid "Ready"
 msgstr "Pronto"
@@ -172,10 +180,12 @@
 msgid "Undefined"
 msgstr "Indefinido"
 
+#. Show the URL of the first result in the status bar
 #: UI/GTK2/src/mainWindow.cc:475
 msgid "Result location is"
 msgstr "A localiza??o do resultado ?"
 
+#. Show the URL in the status bar
 #: UI/GTK2/src/mainWindow.cc:550
 msgid "Document location is"
 msgstr "A localiza??o do documento ?"
@@ -212,6 +222,7 @@
 msgid "Updated label(s)"
 msgstr ""
 
+#. Yes, it did
 #: UI/GTK2/src/mainWindow.cc:1208
 msgid "Updated document"
 msgstr ""
@@ -250,6 +261,7 @@
 msgid "Export Results"
 msgstr "resultados"
 
+#. Find this query
 #: UI/GTK2/src/mainWindow.cc:1827 UI/GTK2/src/mainWindow.cc:2491
 msgid "Live query"
 msgstr ""
@@ -258,13 +270,13 @@
 msgid "Couldn't find query"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:2045 UI/GTK2/src/WorkerThreads.cpp:628
-#: UI/GTK2/src/WorkerThreads.cpp:1623
+#: UI/GTK2/src/mainWindow.cc:2045 UI/GTK2/src/WorkerThreads.cpp:644
+#: UI/GTK2/src/WorkerThreads.cpp:1639
 msgid "Index"
 msgstr "?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2049 UI/GTK2/src/WorkerThreads.cpp:632
-#: UI/GTK2/src/WorkerThreads.cpp:1627
+#: UI/GTK2/src/mainWindow.cc:2049 UI/GTK2/src/WorkerThreads.cpp:648
+#: UI/GTK2/src/WorkerThreads.cpp:1643
 msgid "doesn't exist"
 msgstr "n?o existe"
 
@@ -446,71 +458,73 @@
 msgid "Pinot"
 msgstr "Pinot"
 
-#: UI/GTK2/src/pinot.cc:226 UI/GTK2/src/pinot-dbus-daemon.cc:294
+#. Localize language names
+#: UI/GTK2/src/pinot.cc:227 UI/GTK2/src/pinot-dbus-daemon.cc:295
 #: UI/GTK2/src/propertiesDialog.cc:60 UI/GTK2/src/propertiesDialog.cc:69
 msgid "Unknown"
 msgstr "Desconhecido"
 
-#: UI/GTK2/src/pinot.cc:227 UI/GTK2/src/pinot-dbus-daemon.cc:295
+#: UI/GTK2/src/pinot.cc:228 UI/GTK2/src/pinot-dbus-daemon.cc:296
 msgid "Danish"
 msgstr "Dinamarqu?s"
 
-#: UI/GTK2/src/pinot.cc:228 UI/GTK2/src/pinot-dbus-daemon.cc:296
+#: UI/GTK2/src/pinot.cc:229 UI/GTK2/src/pinot-dbus-daemon.cc:297
 msgid "Dutch"
 msgstr "Holand?s"
 
-#: UI/GTK2/src/pinot.cc:229 UI/GTK2/src/pinot-dbus-daemon.cc:297
+#: UI/GTK2/src/pinot.cc:230 UI/GTK2/src/pinot-dbus-daemon.cc:298
 msgid "English"
 msgstr "Ingl?s"
 
-#: UI/GTK2/src/pinot.cc:230 UI/GTK2/src/pinot-dbus-daemon.cc:298
+#: UI/GTK2/src/pinot.cc:231 UI/GTK2/src/pinot-dbus-daemon.cc:299
 msgid "Finnish"
 msgstr "Finl?ndes"
 
-#: UI/GTK2/src/pinot.cc:231 UI/GTK2/src/pinot-dbus-daemon.cc:299
+#: UI/GTK2/src/pinot.cc:232 UI/GTK2/src/pinot-dbus-daemon.cc:300
 msgid "French"
 msgstr "Franc?s"
 
-#: UI/GTK2/src/pinot.cc:232 UI/GTK2/src/pinot-dbus-daemon.cc:300
+#: UI/GTK2/src/pinot.cc:233 UI/GTK2/src/pinot-dbus-daemon.cc:301
 msgid "German"
 msgstr "Alem?o"
 
-#: UI/GTK2/src/pinot.cc:233 UI/GTK2/src/pinot-dbus-daemon.cc:301
+#: UI/GTK2/src/pinot.cc:234 UI/GTK2/src/pinot-dbus-daemon.cc:302
 msgid "Italian"
 msgstr "Italiano"
 
-#: UI/GTK2/src/pinot.cc:234 UI/GTK2/src/pinot-dbus-daemon.cc:302
+#: UI/GTK2/src/pinot.cc:235 UI/GTK2/src/pinot-dbus-daemon.cc:303
 msgid "Norwegian"
 msgstr "Noruegu?s"
 
-#: UI/GTK2/src/pinot.cc:235 UI/GTK2/src/pinot-dbus-daemon.cc:303
+#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:304
 msgid "Portuguese"
 msgstr "Portugu?s"
 
-#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:304
+#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:305
 msgid "Russian"
 msgstr "Russo"
 
-#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:305
+#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:306
 msgid "Spanish"
 msgstr "Espanhol"
 
-#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:306
+#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:307
 msgid "Swedish"
 msgstr "Sueco"
 
-#: UI/GTK2/src/pinot.cc:263
+#: UI/GTK2/src/pinot.cc:264
 msgid "Couldn't open index"
 msgstr ""
 
-#: UI/GTK2/src/pinot.cc:279
+#: UI/GTK2/src/pinot.cc:284
 msgid "Couldn't create history database"
 msgstr ""
 
-#: UI/GTK2/src/pinot.cc:309
+#: UI/GTK2/src/pinot.cc:325
 msgid "Updating all documents in My Web Pages is recommended"
 msgstr ""
 
+#. Add default labels
 #: UI/GTK2/src/PinotSettings.cpp:249
 msgid "Important"
 msgstr "Importante"
@@ -656,6 +670,7 @@
 msgid "Terms:"
 msgstr "Termos:"
 
+#. All supported filters
 #: UI/GTK2/src/queryDialog.cc:119
 msgid "Host name"
 msgstr "Nome da m?quina"
@@ -668,10 +683,12 @@
 msgid "File extension"
 msgstr "Extens?o do ficheiro"
 
+#. This is the title column
 #: UI/GTK2/src/queryDialog.cc:122 UI/GTK2/src/ResultsTree.cpp:133
 msgid "Title"
 msgstr "Titulo"
 
+#. URL
 #: UI/GTK2/src/queryDialog.cc:123 UI/GTK2/src/ResultsTree.cpp:143
 msgid "URL"
 msgstr "URL"
@@ -724,6 +741,7 @@
 msgid "Query parameters"
 msgstr ""
 
+#. This is the score column
 #: UI/GTK2/src/ResultsTree.cpp:122
 msgid "Score"
 msgstr ""
@@ -749,9 +767,8 @@
 msgstr "documentos"
 
 #: UI/GTK2/src/statisticsDialog.cc:132 UI/GTK2/src/statisticsDialog.cc:147
-#, fuzzy
 msgid "Unknown error"
-msgstr "Desconhecido"
+msgstr ""
 
 #: UI/GTK2/src/statisticsDialog.cc:154
 msgid "Viewed"
@@ -761,6 +778,7 @@
 msgid "results"
 msgstr "resultados"
 
+#. FIXME: check whether it's actually running !
 #: UI/GTK2/src/statisticsDialog.cc:171
 msgid "Running under PID"
 msgstr "A correr com o PID"
@@ -785,7 +803,7 @@
 msgid "Can't index mail here"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:322
+#: UI/GTK2/src/WorkerThreads.cpp:322 UI/GTK2/src/WorkerThreads.cpp:555
 msgid "is already being indexed"
 msgstr ""
 
@@ -793,53 +811,55 @@
 msgid "is blacklisted"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:641 UI/GTK2/src/WorkerThreads.cpp:953
-#: UI/GTK2/src/WorkerThreads.cpp:1038 UI/GTK2/src/WorkerThreads.cpp:1047
-#: UI/GTK2/src/WorkerThreads.cpp:1233 UI/GTK2/src/WorkerThreads.cpp:1503
-#: UI/GTK2/src/WorkerThreads.cpp:1636
+#: UI/GTK2/src/WorkerThreads.cpp:657 UI/GTK2/src/WorkerThreads.cpp:969
+#: UI/GTK2/src/WorkerThreads.cpp:1054 UI/GTK2/src/WorkerThreads.cpp:1063
+#: UI/GTK2/src/WorkerThreads.cpp:1249 UI/GTK2/src/WorkerThreads.cpp:1519
+#: UI/GTK2/src/WorkerThreads.cpp:1652
 msgid "Index error on"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:763 UI/GTK2/src/WorkerThreads.cpp:974
+#: UI/GTK2/src/WorkerThreads.cpp:779 UI/GTK2/src/WorkerThreads.cpp:990
 msgid "Couldn't create search engine"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:789 UI/GTK2/src/WorkerThreads.cpp:988
+#: UI/GTK2/src/WorkerThreads.cpp:805 UI/GTK2/src/WorkerThreads.cpp:1004
 msgid "Couldn't run query on search engine"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:833
+#: UI/GTK2/src/WorkerThreads.cpp:849
 msgid "No title"
 msgstr "Sem t?tulo"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1141
+#: UI/GTK2/src/WorkerThreads.cpp:1157
 msgid "Couldn't obtain downloader for protocol"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:1166
+#: UI/GTK2/src/WorkerThreads.cpp:1182
 msgid "Couldn't retrieve"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:1263 UI/GTK2/src/WorkerThreads.cpp:1342
+#: UI/GTK2/src/WorkerThreads.cpp:1279 UI/GTK2/src/WorkerThreads.cpp:1358
 msgid "Cannot index document type"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:1267 UI/GTK2/src/WorkerThreads.cpp:1346
+#: UI/GTK2/src/WorkerThreads.cpp:1283 UI/GTK2/src/WorkerThreads.cpp:1362
 msgid "at"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:1378
+#. No, it isn't
+#: UI/GTK2/src/WorkerThreads.cpp:1394
 msgid "Robots META tag forbids indexing"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:1432
+#: UI/GTK2/src/WorkerThreads.cpp:1448
 msgid "Couldn't index"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:1514
+#. Be pessimistic and assume something will go wrong ;-)
+#: UI/GTK2/src/WorkerThreads.cpp:1530
 msgid "Couldn't unindex document(s)"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:1648
+#: UI/GTK2/src/WorkerThreads.cpp:1664
 msgid "Couldn't update document"
 msgstr ""

Modified: trunk/po/pt_BR.po
===================================================================
--- trunk/po/pt_BR.po	2007-05-22 11:18:08 UTC (rev 842)
+++ trunk/po/pt_BR.po	2007-05-22 11:53:33 UTC (rev 843)
@@ -5,16 +5,16 @@
 #, fuzzy
 msgid ""
 msgstr ""
-"Project-Id-Version: pinot 0.72\n"
+"Project-Id-Version: pinot 0.73\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2007-04-27 23:44+0800\n"
-"PO-Revision-Date: 2007-02-17 17:34+0800\n"
+"POT-Creation-Date: 2007-05-19 19:02+0800\n"
+"PO-Revision-Date: 2007-02-20 08:01+0000\n"
 "Last-Translator: Leonardo Melo <leonardovazmelo at gmail.com>\n"
 "Language-Team: Portuguese (Brazil) <pt_BR at li.org>\n"
 "MIME-Version: 1.0\n"
 "Content-Type: text/plain; charset=UTF-8\n"
 "Content-Transfer-Encoding: 8bit\n"
-"X-Rosetta-Export-Date: 2006-12-10 07:28+0000\n"
+"X-Rosetta-Export-Date: 2007-05-22 11:38:07+0000\n"
 
 #: UI/GTK2/src/EnginesTree.cpp:70
 msgid "Search Engines"
@@ -24,6 +24,9 @@
 msgid "Current User"
 msgstr "Usu?rio atual"
 
+#. Bind the callback's parameter to the index name
+#. Enable these menu items unless it is not the documents index
+#. Internal indices
 #: UI/GTK2/src/EnginesTree.cpp:339 UI/GTK2/src/mainWindow.cc:324
 #: UI/GTK2/src/mainWindow.cc:327 UI/GTK2/src/mainWindow.cc:540
 #: UI/GTK2/src/mainWindow.cc:1027 UI/GTK2/src/mainWindow.cc:1198
@@ -31,18 +34,21 @@
 #: UI/GTK2/src/mainWindow.cc:1293 UI/GTK2/src/mainWindow.cc:1930
 #: UI/GTK2/src/PinotSettings.cpp:243 UI/GTK2/src/PinotSettings.cpp:1344
 #: UI/GTK2/src/PinotSettings.cpp:1400 UI/GTK2/src/statisticsDialog.cc:77
-#: UI/GTK2/src/WorkerThreads.cpp:811 UI/GTK2/src/WorkerThreads.cpp:870
+#: UI/GTK2/src/WorkerThreads.cpp:827 UI/GTK2/src/WorkerThreads.cpp:886
 msgid "My Web Pages"
 msgstr "Minhas P?ginas Web"
 
+#. Populate the submenu
+#. Bind the callback's parameter to the index name
 #: UI/GTK2/src/EnginesTree.cpp:340 UI/GTK2/src/mainWindow.cc:318
 #: UI/GTK2/src/mainWindow.cc:321 UI/GTK2/src/mainWindow.cc:1034
 #: UI/GTK2/src/PinotSettings.cpp:244 UI/GTK2/src/PinotSettings.cpp:1345
 #: UI/GTK2/src/PinotSettings.cpp:1401 UI/GTK2/src/statisticsDialog.cc:82
-#: UI/GTK2/src/WorkerThreads.cpp:816 UI/GTK2/src/WorkerThreads.cpp:880
+#: UI/GTK2/src/WorkerThreads.cpp:832 UI/GTK2/src/WorkerThreads.cpp:896
 msgid "My Documents"
 msgstr "Meus Documentos"
 
+#. The last column is for the timestamp
 #: UI/GTK2/src/dateDialog_glade.cc:76 UI/GTK2/src/queryDialog_glade.cc:91
 #: UI/GTK2/src/queryDialog_glade.cc:92 UI/GTK2/src/ResultsTree.cpp:151
 #, fuzzy
@@ -149,6 +155,7 @@
 msgid "Summary"
 msgstr "Resumo"
 
+#. Set tooltips
 #: UI/GTK2/src/mainWindow.cc:183
 msgid "Show all search engines"
 msgstr "Mostrar todos mecanimos de pesquisa"
@@ -161,6 +168,7 @@
 msgid "Remove index"
 msgstr "Remover ?ndice"
 
+#. Now we are ready
 #: UI/GTK2/src/mainWindow.cc:191
 msgid "Ready"
 msgstr "Pronto"
@@ -174,10 +182,12 @@
 msgid "Undefined"
 msgstr "<indefinido>"
 
+#. Show the URL of the first result in the status bar
 #: UI/GTK2/src/mainWindow.cc:475
 msgid "Result location is"
 msgstr "Local resultante ?"
 
+#. Show the URL in the status bar
 #: UI/GTK2/src/mainWindow.cc:550
 msgid "Document location is"
 msgstr "Localiza??o do documento ?"
@@ -214,6 +224,7 @@
 msgid "Updated label(s)"
 msgstr "T?tulo(s) atualizado(s)"
 
+#. Yes, it did
 #: UI/GTK2/src/mainWindow.cc:1208
 msgid "Updated document"
 msgstr "Documento atualizado"
@@ -252,6 +263,7 @@
 msgid "Export Results"
 msgstr "_Resultados"
 
+#. Find this query
 #: UI/GTK2/src/mainWindow.cc:1827 UI/GTK2/src/mainWindow.cc:2491
 msgid "Live query"
 msgstr "Query ativa"
@@ -260,13 +272,13 @@
 msgid "Couldn't find query"
 msgstr "N?o foi poss?vel encontrar consulta"
 
-#: UI/GTK2/src/mainWindow.cc:2045 UI/GTK2/src/WorkerThreads.cpp:628
-#: UI/GTK2/src/WorkerThreads.cpp:1623
+#: UI/GTK2/src/mainWindow.cc:2045 UI/GTK2/src/WorkerThreads.cpp:644
+#: UI/GTK2/src/WorkerThreads.cpp:1639
 msgid "Index"
 msgstr "?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2049 UI/GTK2/src/WorkerThreads.cpp:632
-#: UI/GTK2/src/WorkerThreads.cpp:1627
+#: UI/GTK2/src/mainWindow.cc:2049 UI/GTK2/src/WorkerThreads.cpp:648
+#: UI/GTK2/src/WorkerThreads.cpp:1643
 msgid "doesn't exist"
 msgstr "n?o existe"
 
@@ -448,71 +460,73 @@
 msgid "Pinot"
 msgstr "Pino"
 
-#: UI/GTK2/src/pinot.cc:226 UI/GTK2/src/pinot-dbus-daemon.cc:294
+#. Localize language names
+#: UI/GTK2/src/pinot.cc:227 UI/GTK2/src/pinot-dbus-daemon.cc:295
 #: UI/GTK2/src/propertiesDialog.cc:60 UI/GTK2/src/propertiesDialog.cc:69
 msgid "Unknown"
 msgstr "Desconhecido"
 
-#: UI/GTK2/src/pinot.cc:227 UI/GTK2/src/pinot-dbus-daemon.cc:295
+#: UI/GTK2/src/pinot.cc:228 UI/GTK2/src/pinot-dbus-daemon.cc:296
 msgid "Danish"
 msgstr "Danish"
 
-#: UI/GTK2/src/pinot.cc:228 UI/GTK2/src/pinot-dbus-daemon.cc:296
+#: UI/GTK2/src/pinot.cc:229 UI/GTK2/src/pinot-dbus-daemon.cc:297
 msgid "Dutch"
 msgstr "Dutch"
 
-#: UI/GTK2/src/pinot.cc:229 UI/GTK2/src/pinot-dbus-daemon.cc:297
+#: UI/GTK2/src/pinot.cc:230 UI/GTK2/src/pinot-dbus-daemon.cc:298
 msgid "English"
 msgstr "English"
 
-#: UI/GTK2/src/pinot.cc:230 UI/GTK2/src/pinot-dbus-daemon.cc:298
+#: UI/GTK2/src/pinot.cc:231 UI/GTK2/src/pinot-dbus-daemon.cc:299
 msgid "Finnish"
 msgstr "Terminar"
 
-#: UI/GTK2/src/pinot.cc:231 UI/GTK2/src/pinot-dbus-daemon.cc:299
+#: UI/GTK2/src/pinot.cc:232 UI/GTK2/src/pinot-dbus-daemon.cc:300
 msgid "French"
 msgstr "French"
 
-#: UI/GTK2/src/pinot.cc:232 UI/GTK2/src/pinot-dbus-daemon.cc:300
+#: UI/GTK2/src/pinot.cc:233 UI/GTK2/src/pinot-dbus-daemon.cc:301
 msgid "German"
 msgstr "German"
 
-#: UI/GTK2/src/pinot.cc:233 UI/GTK2/src/pinot-dbus-daemon.cc:301
+#: UI/GTK2/src/pinot.cc:234 UI/GTK2/src/pinot-dbus-daemon.cc:302
 msgid "Italian"
 msgstr "Italian"
 
-#: UI/GTK2/src/pinot.cc:234 UI/GTK2/src/pinot-dbus-daemon.cc:302
+#: UI/GTK2/src/pinot.cc:235 UI/GTK2/src/pinot-dbus-daemon.cc:303
 msgid "Norwegian"
 msgstr "Norwegian"
 
-#: UI/GTK2/src/pinot.cc:235 UI/GTK2/src/pinot-dbus-daemon.cc:303
+#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:304
 msgid "Portuguese"
 msgstr "Portugu?s"
 
-#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:304
+#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:305
 msgid "Russian"
 msgstr "Russian"
 
-#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:305
+#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:306
 msgid "Spanish"
 msgstr "Spanish"
 
-#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:306
+#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:307
 msgid "Swedish"
 msgstr "Swedish"
 
-#: UI/GTK2/src/pinot.cc:263
+#: UI/GTK2/src/pinot.cc:264
 msgid "Couldn't open index"
 msgstr "N?o foi poss?vel abrir ?ndice"
 
-#: UI/GTK2/src/pinot.cc:279
+#: UI/GTK2/src/pinot.cc:284
 msgid "Couldn't create history database"
 msgstr "N?o foi poss?vel criar base de hist?rico"
 
-#: UI/GTK2/src/pinot.cc:309
+#: UI/GTK2/src/pinot.cc:325
 msgid "Updating all documents in My Web Pages is recommended"
 msgstr ""
 
+#. Add default labels
 #: UI/GTK2/src/PinotSettings.cpp:249
 msgid "Important"
 msgstr "Importante"
@@ -666,6 +680,7 @@
 msgid "Terms:"
 msgstr ""
 
+#. All supported filters
 #: UI/GTK2/src/queryDialog.cc:119
 msgid "Host name"
 msgstr "Nome do host"
@@ -678,10 +693,12 @@
 msgid "File extension"
 msgstr "Extens?o do arquivo"
 
+#. This is the title column
 #: UI/GTK2/src/queryDialog.cc:122 UI/GTK2/src/ResultsTree.cpp:133
 msgid "Title"
 msgstr "T?tulo"
 
+#. URL
 #: UI/GTK2/src/queryDialog.cc:123 UI/GTK2/src/ResultsTree.cpp:143
 msgid "URL"
 msgstr "URL"
@@ -735,6 +752,7 @@
 msgid "Query parameters"
 msgstr "Par?metros da consulta"
 
+#. This is the score column
 #: UI/GTK2/src/ResultsTree.cpp:122
 msgid "Score"
 msgstr "Pontua??o"
@@ -763,9 +781,8 @@
 msgstr "Meus Documentos"
 
 #: UI/GTK2/src/statisticsDialog.cc:132 UI/GTK2/src/statisticsDialog.cc:147
-#, fuzzy
 msgid "Unknown error"
-msgstr "Desconhecido"
+msgstr ""
 
 #: UI/GTK2/src/statisticsDialog.cc:154
 #, fuzzy
@@ -777,6 +794,7 @@
 msgid "results"
 msgstr "_Resultados"
 
+#. FIXME: check whether it's actually running !
 #: UI/GTK2/src/statisticsDialog.cc:171
 #, fuzzy
 msgid "Running under PID"
@@ -802,7 +820,7 @@
 msgid "Can't index mail here"
 msgstr "N?o foi poss?vel indexar mail aqui"
 
-#: UI/GTK2/src/WorkerThreads.cpp:322
+#: UI/GTK2/src/WorkerThreads.cpp:322 UI/GTK2/src/WorkerThreads.cpp:555
 msgid "is already being indexed"
 msgstr "j? est? sendo indexado"
 
@@ -810,53 +828,55 @@
 msgid "is blacklisted"
 msgstr "est? na lista negra"
 
-#: UI/GTK2/src/WorkerThreads.cpp:641 UI/GTK2/src/WorkerThreads.cpp:953
-#: UI/GTK2/src/WorkerThreads.cpp:1038 UI/GTK2/src/WorkerThreads.cpp:1047
-#: UI/GTK2/src/WorkerThreads.cpp:1233 UI/GTK2/src/WorkerThreads.cpp:1503
-#: UI/GTK2/src/WorkerThreads.cpp:1636
+#: UI/GTK2/src/WorkerThreads.cpp:657 UI/GTK2/src/WorkerThreads.cpp:969
+#: UI/GTK2/src/WorkerThreads.cpp:1054 UI/GTK2/src/WorkerThreads.cpp:1063
+#: UI/GTK2/src/WorkerThreads.cpp:1249 UI/GTK2/src/WorkerThreads.cpp:1519
+#: UI/GTK2/src/WorkerThreads.cpp:1652
 msgid "Index error on"
 msgstr "Erro no ?ndice no"
 
-#: UI/GTK2/src/WorkerThreads.cpp:763 UI/GTK2/src/WorkerThreads.cpp:974
+#: UI/GTK2/src/WorkerThreads.cpp:779 UI/GTK2/src/WorkerThreads.cpp:990
 msgid "Couldn't create search engine"
 msgstr "N?o foi poss?vel criar mecanismo de pesquisa"
 
-#: UI/GTK2/src/WorkerThreads.cpp:789 UI/GTK2/src/WorkerThreads.cpp:988
+#: UI/GTK2/src/WorkerThreads.cpp:805 UI/GTK2/src/WorkerThreads.cpp:1004
 msgid "Couldn't run query on search engine"
 msgstr "N?o foi poss?vel executar consulta no mecanismo de pesquisa"
 
-#: UI/GTK2/src/WorkerThreads.cpp:833
+#: UI/GTK2/src/WorkerThreads.cpp:849
 msgid "No title"
 msgstr "Sem t?tulo"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1141
+#: UI/GTK2/src/WorkerThreads.cpp:1157
 msgid "Couldn't obtain downloader for protocol"
 msgstr "N?o foi poss?vel obter fonte de download para o protocolo"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1166
+#: UI/GTK2/src/WorkerThreads.cpp:1182
 msgid "Couldn't retrieve"
 msgstr "N?o foi poss?vel carregar"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1263 UI/GTK2/src/WorkerThreads.cpp:1342
+#: UI/GTK2/src/WorkerThreads.cpp:1279 UI/GTK2/src/WorkerThreads.cpp:1358
 msgid "Cannot index document type"
 msgstr "Imposs?vel indexar tipo de arquivo"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1267 UI/GTK2/src/WorkerThreads.cpp:1346
+#: UI/GTK2/src/WorkerThreads.cpp:1283 UI/GTK2/src/WorkerThreads.cpp:1362
 msgid "at"
 msgstr "no"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1378
+#. No, it isn't
+#: UI/GTK2/src/WorkerThreads.cpp:1394
 msgid "Robots META tag forbids indexing"
 msgstr "Robots META tag n?o s?o permitidos no ?ndice"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1432
+#: UI/GTK2/src/WorkerThreads.cpp:1448
 msgid "Couldn't index"
 msgstr "N?o foi poss?vel indexar"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1514
+#. Be pessimistic and assume something will go wrong ;-)
+#: UI/GTK2/src/WorkerThreads.cpp:1530
 msgid "Couldn't unindex document(s)"
 msgstr "N?o foi poss?vel remover documento(s) do ?ndice"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1648
+#: UI/GTK2/src/WorkerThreads.cpp:1664
 msgid "Couldn't update document"
 msgstr "N?o foi poss?vel atualizar documento"

Modified: trunk/po/ru.po
===================================================================
--- trunk/po/ru.po	2007-05-22 11:18:08 UTC (rev 842)
+++ trunk/po/ru.po	2007-05-22 11:53:33 UTC (rev 843)
@@ -5,16 +5,16 @@
 #, fuzzy
 msgid ""
 msgstr ""
-"Project-Id-Version: pinot 0.72\n"
+"Project-Id-Version: pinot 0.73\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2007-04-27 23:44+0800\n"
-"PO-Revision-Date: 2007-02-17 17:34+0800\n"
+"POT-Creation-Date: 2007-05-19 19:02+0800\n"
+"PO-Revision-Date: 2007-02-20 08:01+0000\n"
 "Last-Translator: Sergey Vostrikov <s.vostrikov at gmail.com>\n"
 "Language-Team: Russian <ru at li.org>\n"
 "MIME-Version: 1.0\n"
 "Content-Type: text/plain; charset=UTF-8\n"
 "Content-Transfer-Encoding: 8bit\n"
-"X-Rosetta-Export-Date: 2007-01-09 13:08+0000\n"
+"X-Rosetta-Export-Date: 2007-05-22 11:38:08+0000\n"
 
 #: UI/GTK2/src/EnginesTree.cpp:70
 msgid "Search Engines"
@@ -24,6 +24,9 @@
 msgid "Current User"
 msgstr "??????? ????????????"
 
+#. Bind the callback's parameter to the index name
+#. Enable these menu items unless it is not the documents index
+#. Internal indices
 #: UI/GTK2/src/EnginesTree.cpp:339 UI/GTK2/src/mainWindow.cc:324
 #: UI/GTK2/src/mainWindow.cc:327 UI/GTK2/src/mainWindow.cc:540
 #: UI/GTK2/src/mainWindow.cc:1027 UI/GTK2/src/mainWindow.cc:1198
@@ -31,18 +34,21 @@
 #: UI/GTK2/src/mainWindow.cc:1293 UI/GTK2/src/mainWindow.cc:1930
 #: UI/GTK2/src/PinotSettings.cpp:243 UI/GTK2/src/PinotSettings.cpp:1344
 #: UI/GTK2/src/PinotSettings.cpp:1400 UI/GTK2/src/statisticsDialog.cc:77
-#: UI/GTK2/src/WorkerThreads.cpp:811 UI/GTK2/src/WorkerThreads.cpp:870
+#: UI/GTK2/src/WorkerThreads.cpp:827 UI/GTK2/src/WorkerThreads.cpp:886
 msgid "My Web Pages"
 msgstr "??? web-????????"
 
+#. Populate the submenu
+#. Bind the callback's parameter to the index name
 #: UI/GTK2/src/EnginesTree.cpp:340 UI/GTK2/src/mainWindow.cc:318
 #: UI/GTK2/src/mainWindow.cc:321 UI/GTK2/src/mainWindow.cc:1034
 #: UI/GTK2/src/PinotSettings.cpp:244 UI/GTK2/src/PinotSettings.cpp:1345
 #: UI/GTK2/src/PinotSettings.cpp:1401 UI/GTK2/src/statisticsDialog.cc:82
-#: UI/GTK2/src/WorkerThreads.cpp:816 UI/GTK2/src/WorkerThreads.cpp:880
+#: UI/GTK2/src/WorkerThreads.cpp:832 UI/GTK2/src/WorkerThreads.cpp:896
 msgid "My Documents"
 msgstr "??? ?????????"
 
+#. The last column is for the timestamp
 #: UI/GTK2/src/dateDialog_glade.cc:76 UI/GTK2/src/queryDialog_glade.cc:91
 #: UI/GTK2/src/queryDialog_glade.cc:92 UI/GTK2/src/ResultsTree.cpp:151
 #, fuzzy
@@ -149,6 +155,7 @@
 msgid "Summary"
 msgstr "??????"
 
+#. Set tooltips
 #: UI/GTK2/src/mainWindow.cc:183
 msgid "Show all search engines"
 msgstr "??? ????????? ???????"
@@ -161,6 +168,7 @@
 msgid "Remove index"
 msgstr "??????? ??????"
 
+#. Now we are ready
 #: UI/GTK2/src/mainWindow.cc:191
 msgid "Ready"
 msgstr "?????"
@@ -174,10 +182,12 @@
 msgid "Undefined"
 msgstr "<??????????????>"
 
+#. Show the URL of the first result in the status bar
 #: UI/GTK2/src/mainWindow.cc:475
 msgid "Result location is"
 msgstr "??????? ?"
 
+#. Show the URL in the status bar
 #: UI/GTK2/src/mainWindow.cc:550
 msgid "Document location is"
 msgstr "???????????? ?????????"
@@ -214,6 +224,7 @@
 msgid "Updated label(s)"
 msgstr "????????? ????? (??)"
 
+#. Yes, it did
 #: UI/GTK2/src/mainWindow.cc:1208
 msgid "Updated document"
 msgstr "??????????? ????????"
@@ -252,6 +263,7 @@
 msgid "Export Results"
 msgstr "_?????????"
 
+#. Find this query
 #: UI/GTK2/src/mainWindow.cc:1827 UI/GTK2/src/mainWindow.cc:2491
 msgid "Live query"
 msgstr "???????? ??????"
@@ -260,13 +272,13 @@
 msgid "Couldn't find query"
 msgstr "?????????? ????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:2045 UI/GTK2/src/WorkerThreads.cpp:628
-#: UI/GTK2/src/WorkerThreads.cpp:1623
+#: UI/GTK2/src/mainWindow.cc:2045 UI/GTK2/src/WorkerThreads.cpp:644
+#: UI/GTK2/src/WorkerThreads.cpp:1639
 msgid "Index"
 msgstr "??????"
 
-#: UI/GTK2/src/mainWindow.cc:2049 UI/GTK2/src/WorkerThreads.cpp:632
-#: UI/GTK2/src/WorkerThreads.cpp:1627
+#: UI/GTK2/src/mainWindow.cc:2049 UI/GTK2/src/WorkerThreads.cpp:648
+#: UI/GTK2/src/WorkerThreads.cpp:1643
 msgid "doesn't exist"
 msgstr "???"
 
@@ -448,71 +460,73 @@
 msgid "Pinot"
 msgstr "Pinot"
 
-#: UI/GTK2/src/pinot.cc:226 UI/GTK2/src/pinot-dbus-daemon.cc:294
+#. Localize language names
+#: UI/GTK2/src/pinot.cc:227 UI/GTK2/src/pinot-dbus-daemon.cc:295
 #: UI/GTK2/src/propertiesDialog.cc:60 UI/GTK2/src/propertiesDialog.cc:69
 msgid "Unknown"
 msgstr "???????????"
 
-#: UI/GTK2/src/pinot.cc:227 UI/GTK2/src/pinot-dbus-daemon.cc:295
+#: UI/GTK2/src/pinot.cc:228 UI/GTK2/src/pinot-dbus-daemon.cc:296
 msgid "Danish"
 msgstr "???????"
 
-#: UI/GTK2/src/pinot.cc:228 UI/GTK2/src/pinot-dbus-daemon.cc:296
+#: UI/GTK2/src/pinot.cc:229 UI/GTK2/src/pinot-dbus-daemon.cc:297
 msgid "Dutch"
 msgstr "???????????"
 
-#: UI/GTK2/src/pinot.cc:229 UI/GTK2/src/pinot-dbus-daemon.cc:297
+#: UI/GTK2/src/pinot.cc:230 UI/GTK2/src/pinot-dbus-daemon.cc:298
 msgid "English"
 msgstr "??????????"
 
-#: UI/GTK2/src/pinot.cc:230 UI/GTK2/src/pinot-dbus-daemon.cc:298
+#: UI/GTK2/src/pinot.cc:231 UI/GTK2/src/pinot-dbus-daemon.cc:299
 msgid "Finnish"
 msgstr "???????"
 
-#: UI/GTK2/src/pinot.cc:231 UI/GTK2/src/pinot-dbus-daemon.cc:299
+#: UI/GTK2/src/pinot.cc:232 UI/GTK2/src/pinot-dbus-daemon.cc:300
 msgid "French"
 msgstr "???????????"
 
-#: UI/GTK2/src/pinot.cc:232 UI/GTK2/src/pinot-dbus-daemon.cc:300
+#: UI/GTK2/src/pinot.cc:233 UI/GTK2/src/pinot-dbus-daemon.cc:301
 msgid "German"
 msgstr "????????"
 
-#: UI/GTK2/src/pinot.cc:233 UI/GTK2/src/pinot-dbus-daemon.cc:301
+#: UI/GTK2/src/pinot.cc:234 UI/GTK2/src/pinot-dbus-daemon.cc:302
 msgid "Italian"
 msgstr "???????????"
 
-#: UI/GTK2/src/pinot.cc:234 UI/GTK2/src/pinot-dbus-daemon.cc:302
+#: UI/GTK2/src/pinot.cc:235 UI/GTK2/src/pinot-dbus-daemon.cc:303
 msgid "Norwegian"
 msgstr "??????????"
 
-#: UI/GTK2/src/pinot.cc:235 UI/GTK2/src/pinot-dbus-daemon.cc:303
+#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:304
 msgid "Portuguese"
 msgstr "?????????????"
 
-#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:304
+#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:305
 msgid "Russian"
 msgstr "???????"
 
-#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:305
+#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:306
 msgid "Spanish"
 msgstr "?????????"
 
-#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:306
+#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:307
 msgid "Swedish"
 msgstr "????????"
 
-#: UI/GTK2/src/pinot.cc:263
+#: UI/GTK2/src/pinot.cc:264
 msgid "Couldn't open index"
 msgstr "?????????? ??????? ??????"
 
-#: UI/GTK2/src/pinot.cc:279
+#: UI/GTK2/src/pinot.cc:284
 msgid "Couldn't create history database"
 msgstr "?? ??????? ??????? ???? ?????? ???????"
 
-#: UI/GTK2/src/pinot.cc:309
+#: UI/GTK2/src/pinot.cc:325
 msgid "Updating all documents in My Web Pages is recommended"
 msgstr ""
 
+#. Add default labels
 #: UI/GTK2/src/PinotSettings.cpp:249
 msgid "Important"
 msgstr "?????"
@@ -659,6 +673,7 @@
 msgid "Terms:"
 msgstr ""
 
+#. All supported filters
 #: UI/GTK2/src/queryDialog.cc:119
 msgid "Host name"
 msgstr "??? ????"
@@ -671,10 +686,12 @@
 msgid "File extension"
 msgstr "?????????? ?????"
 
+#. This is the title column
 #: UI/GTK2/src/queryDialog.cc:122 UI/GTK2/src/ResultsTree.cpp:133
 msgid "Title"
 msgstr "????????"
 
+#. URL
 #: UI/GTK2/src/queryDialog.cc:123 UI/GTK2/src/ResultsTree.cpp:143
 msgid "URL"
 msgstr "URL"
@@ -728,6 +745,7 @@
 msgid "Query parameters"
 msgstr "????????? ???????"
 
+#. This is the score column
 #: UI/GTK2/src/ResultsTree.cpp:122
 msgid "Score"
 msgstr "????"
@@ -756,9 +774,8 @@
 msgstr "??? ?????????"
 
 #: UI/GTK2/src/statisticsDialog.cc:132 UI/GTK2/src/statisticsDialog.cc:147
-#, fuzzy
 msgid "Unknown error"
-msgstr "???????????"
+msgstr ""
 
 #: UI/GTK2/src/statisticsDialog.cc:154
 #, fuzzy
@@ -770,6 +787,7 @@
 msgid "results"
 msgstr "_?????????"
 
+#. FIXME: check whether it's actually running !
 #: UI/GTK2/src/statisticsDialog.cc:171
 #, fuzzy
 msgid "Running under PID"
@@ -795,7 +813,7 @@
 msgid "Can't index mail here"
 msgstr "?????? ????????????? ????? ?????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:322
+#: UI/GTK2/src/WorkerThreads.cpp:322 UI/GTK2/src/WorkerThreads.cpp:555
 msgid "is already being indexed"
 msgstr "??? ??????????????????"
 
@@ -803,53 +821,55 @@
 msgid "is blacklisted"
 msgstr "??????????? ? ?????? ??????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:641 UI/GTK2/src/WorkerThreads.cpp:953
-#: UI/GTK2/src/WorkerThreads.cpp:1038 UI/GTK2/src/WorkerThreads.cpp:1047
-#: UI/GTK2/src/WorkerThreads.cpp:1233 UI/GTK2/src/WorkerThreads.cpp:1503
-#: UI/GTK2/src/WorkerThreads.cpp:1636
+#: UI/GTK2/src/WorkerThreads.cpp:657 UI/GTK2/src/WorkerThreads.cpp:969
+#: UI/GTK2/src/WorkerThreads.cpp:1054 UI/GTK2/src/WorkerThreads.cpp:1063
+#: UI/GTK2/src/WorkerThreads.cpp:1249 UI/GTK2/src/WorkerThreads.cpp:1519
+#: UI/GTK2/src/WorkerThreads.cpp:1652
 msgid "Index error on"
 msgstr "?????? ??????? ??"
 
-#: UI/GTK2/src/WorkerThreads.cpp:763 UI/GTK2/src/WorkerThreads.cpp:974
+#: UI/GTK2/src/WorkerThreads.cpp:779 UI/GTK2/src/WorkerThreads.cpp:990
 msgid "Couldn't create search engine"
 msgstr "?? ??????? ??????? ????????? ???????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:789 UI/GTK2/src/WorkerThreads.cpp:988
+#: UI/GTK2/src/WorkerThreads.cpp:805 UI/GTK2/src/WorkerThreads.cpp:1004
 msgid "Couldn't run query on search engine"
 msgstr "?? ??????? ????????? ?????? ? ????????? ???????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:833
+#: UI/GTK2/src/WorkerThreads.cpp:849
 msgid "No title"
 msgstr "??? ????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1141
+#: UI/GTK2/src/WorkerThreads.cpp:1157
 msgid "Couldn't obtain downloader for protocol"
 msgstr "?? ??????? ???????? ????????? ??? ?????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1166
+#: UI/GTK2/src/WorkerThreads.cpp:1182
 msgid "Couldn't retrieve"
 msgstr "?? ??????? ???????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1263 UI/GTK2/src/WorkerThreads.cpp:1342
+#: UI/GTK2/src/WorkerThreads.cpp:1279 UI/GTK2/src/WorkerThreads.cpp:1358
 msgid "Cannot index document type"
 msgstr "?????????? ????????????? ?????? ??? ??????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1267 UI/GTK2/src/WorkerThreads.cpp:1346
+#: UI/GTK2/src/WorkerThreads.cpp:1283 UI/GTK2/src/WorkerThreads.cpp:1362
 msgid "at"
 msgstr "?"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1378
+#. No, it isn't
+#: UI/GTK2/src/WorkerThreads.cpp:1394
 msgid "Robots META tag forbids indexing"
 msgstr "META-???? ??????? ????????? ??????????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1432
+#: UI/GTK2/src/WorkerThreads.cpp:1448
 msgid "Couldn't index"
 msgstr "?????????? ????????? ??????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1514
+#. Be pessimistic and assume something will go wrong ;-)
+#: UI/GTK2/src/WorkerThreads.cpp:1530
 msgid "Couldn't unindex document(s)"
 msgstr "?????????? ??????????????? ????????(?)"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1648
+#: UI/GTK2/src/WorkerThreads.cpp:1664
 msgid "Couldn't update document"
 msgstr "?????????? ???????? ????????"

Modified: trunk/po/sv.po
===================================================================
--- trunk/po/sv.po	2007-05-22 11:18:08 UTC (rev 842)
+++ trunk/po/sv.po	2007-05-22 11:53:33 UTC (rev 843)
@@ -5,16 +5,16 @@
 #, fuzzy
 msgid ""
 msgstr ""
-"Project-Id-Version: pinot 0.72\n"
+"Project-Id-Version: pinot 0.73\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2007-04-27 23:44+0800\n"
-"PO-Revision-Date: 2007-02-20 13:13+0800\n"
-"Last-Translator: Daniel Nylander <po at danielnylander.se>\n"
+"POT-Creation-Date: 2007-05-19 19:02+0800\n"
+"PO-Revision-Date: 2007-02-20 08:00+0000\n"
+"Last-Translator: Daniel Nylander <yeager at ubuntu.com>\n"
 "Language-Team: Swedish <sv at li.org>\n"
 "MIME-Version: 1.0\n"
 "Content-Type: text/plain; charset=UTF-8\n"
 "Content-Transfer-Encoding: 8bit\n"
-"X-Rosetta-Export-Date: 2007-02-20 05:58+0000\n"
+"X-Rosetta-Export-Date: 2007-05-22 11:38:09+0000\n"
 
 #: UI/GTK2/src/EnginesTree.cpp:70
 msgid "Search Engines"
@@ -24,6 +24,9 @@
 msgid "Current User"
 msgstr "Aktuell anv?ndare"
 
+#. Bind the callback's parameter to the index name
+#. Enable these menu items unless it is not the documents index
+#. Internal indices
 #: UI/GTK2/src/EnginesTree.cpp:339 UI/GTK2/src/mainWindow.cc:324
 #: UI/GTK2/src/mainWindow.cc:327 UI/GTK2/src/mainWindow.cc:540
 #: UI/GTK2/src/mainWindow.cc:1027 UI/GTK2/src/mainWindow.cc:1198
@@ -31,18 +34,21 @@
 #: UI/GTK2/src/mainWindow.cc:1293 UI/GTK2/src/mainWindow.cc:1930
 #: UI/GTK2/src/PinotSettings.cpp:243 UI/GTK2/src/PinotSettings.cpp:1344
 #: UI/GTK2/src/PinotSettings.cpp:1400 UI/GTK2/src/statisticsDialog.cc:77
-#: UI/GTK2/src/WorkerThreads.cpp:811 UI/GTK2/src/WorkerThreads.cpp:870
+#: UI/GTK2/src/WorkerThreads.cpp:827 UI/GTK2/src/WorkerThreads.cpp:886
 msgid "My Web Pages"
 msgstr "Mina webbsidor"
 
+#. Populate the submenu
+#. Bind the callback's parameter to the index name
 #: UI/GTK2/src/EnginesTree.cpp:340 UI/GTK2/src/mainWindow.cc:318
 #: UI/GTK2/src/mainWindow.cc:321 UI/GTK2/src/mainWindow.cc:1034
 #: UI/GTK2/src/PinotSettings.cpp:244 UI/GTK2/src/PinotSettings.cpp:1345
 #: UI/GTK2/src/PinotSettings.cpp:1401 UI/GTK2/src/statisticsDialog.cc:82
-#: UI/GTK2/src/WorkerThreads.cpp:816 UI/GTK2/src/WorkerThreads.cpp:880
+#: UI/GTK2/src/WorkerThreads.cpp:832 UI/GTK2/src/WorkerThreads.cpp:896
 msgid "My Documents"
 msgstr "Mina dokument"
 
+#. The last column is for the timestamp
 #: UI/GTK2/src/dateDialog_glade.cc:76 UI/GTK2/src/queryDialog_glade.cc:91
 #: UI/GTK2/src/queryDialog_glade.cc:92 UI/GTK2/src/ResultsTree.cpp:151
 #, fuzzy
@@ -148,6 +154,7 @@
 msgid "Summary"
 msgstr "Sammandrag"
 
+#. Set tooltips
 #: UI/GTK2/src/mainWindow.cc:183
 msgid "Show all search engines"
 msgstr "Visa alla s?kmotorer"
@@ -160,6 +167,7 @@
 msgid "Remove index"
 msgstr "Ta bort index"
 
+#. Now we are ready
 #: UI/GTK2/src/mainWindow.cc:191
 msgid "Ready"
 msgstr "Redo"
@@ -173,10 +181,12 @@
 msgid "Undefined"
 msgstr "<odefinierad>"
 
+#. Show the URL of the first result in the status bar
 #: UI/GTK2/src/mainWindow.cc:475
 msgid "Result location is"
 msgstr "Resultatplatsen ?r"
 
+#. Show the URL in the status bar
 #: UI/GTK2/src/mainWindow.cc:550
 msgid "Document location is"
 msgstr "Dokumentplatsen ?r"
@@ -213,6 +223,7 @@
 msgid "Updated label(s)"
 msgstr "Uppdaterade etikett(er)"
 
+#. Yes, it did
 #: UI/GTK2/src/mainWindow.cc:1208
 msgid "Updated document"
 msgstr "Uppdaterade dokument"
@@ -251,6 +262,7 @@
 msgid "Export Results"
 msgstr "_Resultat"
 
+#. Find this query
 #: UI/GTK2/src/mainWindow.cc:1827 UI/GTK2/src/mainWindow.cc:2491
 msgid "Live query"
 msgstr "Levande fr?ga"
@@ -259,13 +271,13 @@
 msgid "Couldn't find query"
 msgstr "Kunde inte hitta fr?ga"
 
-#: UI/GTK2/src/mainWindow.cc:2045 UI/GTK2/src/WorkerThreads.cpp:628
-#: UI/GTK2/src/WorkerThreads.cpp:1623
+#: UI/GTK2/src/mainWindow.cc:2045 UI/GTK2/src/WorkerThreads.cpp:644
+#: UI/GTK2/src/WorkerThreads.cpp:1639
 msgid "Index"
 msgstr "Index"
 
-#: UI/GTK2/src/mainWindow.cc:2049 UI/GTK2/src/WorkerThreads.cpp:632
-#: UI/GTK2/src/WorkerThreads.cpp:1627
+#: UI/GTK2/src/mainWindow.cc:2049 UI/GTK2/src/WorkerThreads.cpp:648
+#: UI/GTK2/src/WorkerThreads.cpp:1643
 msgid "doesn't exist"
 msgstr "finns inte"
 
@@ -448,71 +460,73 @@
 msgid "Pinot"
 msgstr "Pinot"
 
-#: UI/GTK2/src/pinot.cc:226 UI/GTK2/src/pinot-dbus-daemon.cc:294
+#. Localize language names
+#: UI/GTK2/src/pinot.cc:227 UI/GTK2/src/pinot-dbus-daemon.cc:295
 #: UI/GTK2/src/propertiesDialog.cc:60 UI/GTK2/src/propertiesDialog.cc:69
 msgid "Unknown"
 msgstr "Ok?nd"
 
-#: UI/GTK2/src/pinot.cc:227 UI/GTK2/src/pinot-dbus-daemon.cc:295
+#: UI/GTK2/src/pinot.cc:228 UI/GTK2/src/pinot-dbus-daemon.cc:296
 msgid "Danish"
 msgstr "Danska"
 
-#: UI/GTK2/src/pinot.cc:228 UI/GTK2/src/pinot-dbus-daemon.cc:296
+#: UI/GTK2/src/pinot.cc:229 UI/GTK2/src/pinot-dbus-daemon.cc:297
 msgid "Dutch"
 msgstr "Nederl?ndska"
 
-#: UI/GTK2/src/pinot.cc:229 UI/GTK2/src/pinot-dbus-daemon.cc:297
+#: UI/GTK2/src/pinot.cc:230 UI/GTK2/src/pinot-dbus-daemon.cc:298
 msgid "English"
 msgstr "Engelska"
 
-#: UI/GTK2/src/pinot.cc:230 UI/GTK2/src/pinot-dbus-daemon.cc:298
+#: UI/GTK2/src/pinot.cc:231 UI/GTK2/src/pinot-dbus-daemon.cc:299
 msgid "Finnish"
 msgstr "Finska"
 
-#: UI/GTK2/src/pinot.cc:231 UI/GTK2/src/pinot-dbus-daemon.cc:299
+#: UI/GTK2/src/pinot.cc:232 UI/GTK2/src/pinot-dbus-daemon.cc:300
 msgid "French"
 msgstr "Franska"
 
-#: UI/GTK2/src/pinot.cc:232 UI/GTK2/src/pinot-dbus-daemon.cc:300
+#: UI/GTK2/src/pinot.cc:233 UI/GTK2/src/pinot-dbus-daemon.cc:301
 msgid "German"
 msgstr "Tyska"
 
-#: UI/GTK2/src/pinot.cc:233 UI/GTK2/src/pinot-dbus-daemon.cc:301
+#: UI/GTK2/src/pinot.cc:234 UI/GTK2/src/pinot-dbus-daemon.cc:302
 msgid "Italian"
 msgstr "Italienska"
 
-#: UI/GTK2/src/pinot.cc:234 UI/GTK2/src/pinot-dbus-daemon.cc:302
+#: UI/GTK2/src/pinot.cc:235 UI/GTK2/src/pinot-dbus-daemon.cc:303
 msgid "Norwegian"
 msgstr "Norska"
 
-#: UI/GTK2/src/pinot.cc:235 UI/GTK2/src/pinot-dbus-daemon.cc:303
+#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:304
 msgid "Portuguese"
 msgstr "Portugisiska"
 
-#: UI/GTK2/src/pinot.cc:236 UI/GTK2/src/pinot-dbus-daemon.cc:304
+#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:305
 msgid "Russian"
 msgstr "Ryska"
 
-#: UI/GTK2/src/pinot.cc:237 UI/GTK2/src/pinot-dbus-daemon.cc:305
+#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:306
 msgid "Spanish"
 msgstr "Spanska"
 
-#: UI/GTK2/src/pinot.cc:238 UI/GTK2/src/pinot-dbus-daemon.cc:306
+#: UI/GTK2/src/pinot.cc:239 UI/GTK2/src/pinot-dbus-daemon.cc:307
 msgid "Swedish"
 msgstr "Svenska"
 
-#: UI/GTK2/src/pinot.cc:263
+#: UI/GTK2/src/pinot.cc:264
 msgid "Couldn't open index"
 msgstr "Kunde inte ?ppna index"
 
-#: UI/GTK2/src/pinot.cc:279
+#: UI/GTK2/src/pinot.cc:284
 msgid "Couldn't create history database"
 msgstr "Kunde inte skapa historikdatabas"
 
-#: UI/GTK2/src/pinot.cc:309
+#: UI/GTK2/src/pinot.cc:325
 msgid "Updating all documents in My Web Pages is recommended"
 msgstr ""
 
+#. Add default labels
 #: UI/GTK2/src/PinotSettings.cpp:249
 msgid "Important"
 msgstr "Viktigt"
@@ -660,6 +674,7 @@
 msgid "Terms:"
 msgstr ""
 
+#. All supported filters
 #: UI/GTK2/src/queryDialog.cc:119
 msgid "Host name"
 msgstr "V?rdnamn"
@@ -672,10 +687,12 @@
 msgid "File extension"
 msgstr "Fil?ndelse"
 
+#. This is the title column
 #: UI/GTK2/src/queryDialog.cc:122 UI/GTK2/src/ResultsTree.cpp:133
 msgid "Title"
 msgstr "Titel"
 
+#. URL
 #: UI/GTK2/src/queryDialog.cc:123 UI/GTK2/src/ResultsTree.cpp:143
 msgid "URL"
 msgstr "Url"
@@ -729,6 +746,7 @@
 msgid "Query parameters"
 msgstr "Fr?geparametrar"
 
+#. This is the score column
 #: UI/GTK2/src/ResultsTree.cpp:122
 msgid "Score"
 msgstr "Betyg"
@@ -755,9 +773,8 @@
 msgstr "dokument"
 
 #: UI/GTK2/src/statisticsDialog.cc:132 UI/GTK2/src/statisticsDialog.cc:147
-#, fuzzy
 msgid "Unknown error"
-msgstr "Ok?nd"
+msgstr ""
 
 #: UI/GTK2/src/statisticsDialog.cc:154
 #, fuzzy
@@ -769,6 +786,7 @@
 msgid "results"
 msgstr "_Resultat"
 
+#. FIXME: check whether it's actually running !
 #: UI/GTK2/src/statisticsDialog.cc:171
 #, fuzzy
 msgid "Running under PID"
@@ -795,7 +813,7 @@
 msgid "Can't index mail here"
 msgstr "Kan inte indexera post h?r"
 
-#: UI/GTK2/src/WorkerThreads.cpp:322
+#: UI/GTK2/src/WorkerThreads.cpp:322 UI/GTK2/src/WorkerThreads.cpp:555
 msgid "is already being indexed"
 msgstr "h?ller redan p? att bli indexerad"
 
@@ -803,53 +821,55 @@
 msgid "is blacklisted"
 msgstr "?r svartlistad"
 
-#: UI/GTK2/src/WorkerThreads.cpp:641 UI/GTK2/src/WorkerThreads.cpp:953
-#: UI/GTK2/src/WorkerThreads.cpp:1038 UI/GTK2/src/WorkerThreads.cpp:1047
-#: UI/GTK2/src/WorkerThreads.cpp:1233 UI/GTK2/src/WorkerThreads.cpp:1503
-#: UI/GTK2/src/WorkerThreads.cpp:1636
+#: UI/GTK2/src/WorkerThreads.cpp:657 UI/GTK2/src/WorkerThreads.cpp:969
+#: UI/GTK2/src/WorkerThreads.cpp:1054 UI/GTK2/src/WorkerThreads.cpp:1063
+#: UI/GTK2/src/WorkerThreads.cpp:1249 UI/GTK2/src/WorkerThreads.cpp:1519
+#: UI/GTK2/src/WorkerThreads.cpp:1652
 msgid "Index error on"
 msgstr "Indexfel p?"
 
-#: UI/GTK2/src/WorkerThreads.cpp:763 UI/GTK2/src/WorkerThreads.cpp:974
+#: UI/GTK2/src/WorkerThreads.cpp:779 UI/GTK2/src/WorkerThreads.cpp:990
 msgid "Couldn't create search engine"
 msgstr "Kunde inte skapa s?kmotor"
 
-#: UI/GTK2/src/WorkerThreads.cpp:789 UI/GTK2/src/WorkerThreads.cpp:988
+#: UI/GTK2/src/WorkerThreads.cpp:805 UI/GTK2/src/WorkerThreads.cpp:1004
 msgid "Couldn't run query on search engine"
 msgstr "Kunde inte k?ra fr?ga p? s?kmotor"
 
-#: UI/GTK2/src/WorkerThreads.cpp:833
+#: UI/GTK2/src/WorkerThreads.cpp:849
 msgid "No title"
 msgstr "Ingen titel"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1141
+#: UI/GTK2/src/WorkerThreads.cpp:1157
 msgid "Couldn't obtain downloader for protocol"
 msgstr "Kunde inte f? protokollh?mtare"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1166
+#: UI/GTK2/src/WorkerThreads.cpp:1182
 msgid "Couldn't retrieve"
 msgstr "Kunde inte h?mta"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1263 UI/GTK2/src/WorkerThreads.cpp:1342
+#: UI/GTK2/src/WorkerThreads.cpp:1279 UI/GTK2/src/WorkerThreads.cpp:1358
 msgid "Cannot index document type"
 msgstr "Kan inte indexera dokumenttyp"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1267 UI/GTK2/src/WorkerThreads.cpp:1346
+#: UI/GTK2/src/WorkerThreads.cpp:1283 UI/GTK2/src/WorkerThreads.cpp:1362
 msgid "at"
 msgstr "p?"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1378
+#. No, it isn't
+#: UI/GTK2/src/WorkerThreads.cpp:1394
 msgid "Robots META tag forbids indexing"
 msgstr "Robots META-tagg f?rbjuder indexering"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1432
+#: UI/GTK2/src/WorkerThreads.cpp:1448
 msgid "Couldn't index"
 msgstr "Kunde inte indexera"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1514
+#. Be pessimistic and assume something will go wrong ;-)
+#: UI/GTK2/src/WorkerThreads.cpp:1530
 msgid "Couldn't unindex document(s)"
 msgstr "Kunde inte avindexera dokument"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1648
+#: UI/GTK2/src/WorkerThreads.cpp:1664
 msgid "Couldn't update document"
 msgstr "Kunde inte uppdatera dokument"



From fabricecolin at mail.berlios.de  Wed May 23 15:25:29 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Wed, 23 May 2007 15:25:29 +0200
Subject: [Pinot-svn] r844 - in trunk: . Index Search UI/GTK2/src
Message-ID: <200705231325.l4NDPTWt004200@sheep.berlios.de>

Author: fabricecolin
Date: 2007-05-23 15:25:28 +0200 (Wed, 23 May 2007)
New Revision: 844

Modified:
   trunk/Index/pinot-index.1
   trunk/NEWS
   trunk/Search/pinot-search.1
   trunk/TODO
   trunk/UI/GTK2/src/pinot-dbus-daemon.1
   trunk/UI/GTK2/src/pinot.1
Log:
Releasing 0.73.


Modified: trunk/Index/pinot-index.1
===================================================================
--- trunk/Index/pinot-index.1	2007-05-22 11:53:33 UTC (rev 843)
+++ trunk/Index/pinot-index.1	2007-05-23 13:25:28 UTC (rev 844)
@@ -1,5 +1,5 @@
 .\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.36.
-.TH PINOT-INDEX "1" "April 2007" "pinot-index - pinot 0.72" "User Commands"
+.TH PINOT-INDEX "1" "May 2007" "pinot-index - pinot 0.73" "User Commands"
 .SH NAME
 pinot-index \- Index documents from the command-line
 .SH SYNOPSIS

Modified: trunk/NEWS
===================================================================
--- trunk/NEWS	2007-05-22 11:53:33 UTC (rev 843)
+++ trunk/NEWS	2007-05-23 13:25:28 UTC (rev 844)
@@ -1,4 +1,4 @@
-??? version_0_7_3
+2007/05/23 version_0_7_3
 Tokenize :
  - mbox filter was broken in previous release
  - TagLib filter returns the file's name as title if no tag is found

Modified: trunk/Search/pinot-search.1
===================================================================
--- trunk/Search/pinot-search.1	2007-05-22 11:53:33 UTC (rev 843)
+++ trunk/Search/pinot-search.1	2007-05-23 13:25:28 UTC (rev 844)
@@ -1,5 +1,5 @@
 .\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.36.
-.TH PINOT-SEARCH "1" "April 2007" "pinot-search - pinot 0.72" "User Commands"
+.TH PINOT-SEARCH "1" "May 2007" "pinot-search - pinot 0.73" "User Commands"
 .SH NAME
 pinot-search \- Query search engines from the command-line
 .SH SYNOPSIS

Modified: trunk/TODO
===================================================================
--- trunk/TODO	2007-05-22 11:53:33 UTC (rev 843)
+++ trunk/TODO	2007-05-23 13:25:28 UTC (rev 844)
@@ -29,6 +29,7 @@
 - Filters should have a version number so that new versions force reindexing documents of the
  given type
 - Distribute filters' ChangeLog
+- Redo XML filter with the TextReader interface
 
 Monitor
 - Implement support for Solaris FEM

Modified: trunk/UI/GTK2/src/pinot-dbus-daemon.1
===================================================================
--- trunk/UI/GTK2/src/pinot-dbus-daemon.1	2007-05-22 11:53:33 UTC (rev 843)
+++ trunk/UI/GTK2/src/pinot-dbus-daemon.1	2007-05-23 13:25:28 UTC (rev 844)
@@ -1,5 +1,5 @@
 .\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.36.
-.TH PINOT-DBUS-DAEMON "1" "April 2007" "pinot-dbus-daemon - pinot 0.72" "User Commands"
+.TH PINOT-DBUS-DAEMON "1" "May 2007" "pinot-dbus-daemon - pinot 0.73" "User Commands"
 .SH NAME
 pinot-dbus-daemon \- D-Bus search and index daemon
 .SH SYNOPSIS

Modified: trunk/UI/GTK2/src/pinot.1
===================================================================
--- trunk/UI/GTK2/src/pinot.1	2007-05-22 11:53:33 UTC (rev 843)
+++ trunk/UI/GTK2/src/pinot.1	2007-05-23 13:25:28 UTC (rev 844)
@@ -1,5 +1,5 @@
 .\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.36.
-.TH PINOT "1" "April 2007" "pinot - pinot 0.72" "User Commands"
+.TH PINOT "1" "May 2007" "pinot - pinot 0.73" "User Commands"
 .SH NAME
 pinot \- A metasearch tool for the Free Desktop
 .SH SYNOPSIS



From fabricecolin at mail.berlios.de  Wed May 23 15:31:05 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Wed, 23 May 2007 15:31:05 +0200
Subject: [Pinot-svn] r845 - trunk
Message-ID: <200705231331.l4NDV51n005045@sheep.berlios.de>

Author: fabricecolin
Date: 2007-05-23 15:31:04 +0200 (Wed, 23 May 2007)
New Revision: 845

Modified:
   trunk/NEWS
Log:
Forgot to mention a few things.


Modified: trunk/NEWS
===================================================================
--- trunk/NEWS	2007-05-23 13:25:28 UTC (rev 844)
+++ trunk/NEWS	2007-05-23 13:31:04 UTC (rev 845)
@@ -5,10 +5,13 @@
 SQL :
  - don't force opening and closing the database on every request
 Index :
+ - overwrite index on upgrades, it's faster than deleting all its documents
  - support for Xapian 1.0 API
- - overwrite index on upgrades, it's faster than deleting all its documents
 Search :
  - stemming wasn't activated when a language is set
+ - support for Xapian 1.0 API
+Daemon :
+ - don't scan for deleted files on every run
 UI :
  - fixed crash when unindexing documents
  - updated Dutch translation by JW 



From fabricecolin at mail.berlios.de  Wed May 23 18:40:33 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Wed, 23 May 2007 18:40:33 +0200
Subject: [Pinot-svn] r846 - tags
Message-ID: <200705231640.l4NGeXUX010689@sheep.berlios.de>

Author: fabricecolin
Date: 2007-05-23 18:40:24 +0200 (Wed, 23 May 2007)
New Revision: 846

Added:
   tags/version_0_7_3/
Log:
Released 0.73.


Copied: tags/version_0_7_3 (from rev 845, trunk)



From fabricecolin at mail.berlios.de  Sat May 26 06:21:20 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 26 May 2007 06:21:20 +0200
Subject: [Pinot-svn] r847 - in trunk/Search: . Google
Message-ID: <200705260421.l4Q4LK7p012615@sheep.berlios.de>

Author: fabricecolin
Date: 2007-05-26 06:21:17 +0200 (Sat, 26 May 2007)
New Revision: 847

Modified:
   trunk/Search/Google/GoogleAPIEngine.cpp
   trunk/Search/Google/GoogleAPIEngine.h
   trunk/Search/PluginWebEngine.cpp
   trunk/Search/PluginWebEngine.h
   trunk/Search/SearchEngineInterface.cpp
   trunk/Search/SearchEngineInterface.h
   trunk/Search/WebEngine.cpp
   trunk/Search/XapianEngine.cpp
   trunk/Search/XapianEngine.h
   trunk/Search/pinot-search.cpp
Log:
A start document can be passed to runQuery().
Support for total number of results estimates.
Removed some cruft.


Modified: trunk/Search/Google/GoogleAPIEngine.cpp
===================================================================
--- trunk/Search/Google/GoogleAPIEngine.cpp	2007-05-23 16:40:24 UTC (rev 846)
+++ trunk/Search/Google/GoogleAPIEngine.cpp	2007-05-26 04:21:17 UTC (rev 847)
@@ -36,7 +36,6 @@
 
 GoogleAPIEngine::~GoogleAPIEngine()
 {
-	m_resultsList.clear();
 }
 
 /// Retrieves the specified URL from the cache; NULL if error. Caller deletes.
@@ -83,10 +82,15 @@
 //
 
 /// Runs a query; true if success.
-bool GoogleAPIEngine::runQuery(QueryProperties& queryProps)
+bool GoogleAPIEngine::runQuery(QueryProperties& queryProps,
+	unsigned int startDoc)
 {
 	string queryString(queryProps.getFreeQuery(true));
+	unsigned int maxResultsCount = queryProps.getMaximumResultsCount();
 
+	m_resultsList.clear();
+	m_resultsCountEstimate = 0;
+
 	setHostNameFilter(queryProps.getHostFilter());
 	setFileNameFilter(queryProps.getFileFilter());
 	setQuery(queryProps);
@@ -112,7 +116,7 @@
 	struct gapi1__doGoogleSearchResponse queryOut;
 
 	// No filter, no safe search
-	int soapStatus = soapProxy.gapi1__doGoogleSearch(m_key, queryString, 0, (int)(m_maxResultsCount > 10 ? 10 : m_maxResultsCount),
+	int soapStatus = soapProxy.gapi1__doGoogleSearch(m_key, queryString, 0, (int)(maxResultsCount > 10 ? 10 : maxResultsCount),
 		false, "", false, "", "utf-8", "utf-8", queryOut);
 	if (soapStatus != SOAP_OK)
 	{
@@ -127,6 +131,8 @@
 	{
 		float pseudoScore = 100;
 
+		m_resultsCountEstimate = searchResult->estimatedTotalResultsCount;
+
 		for (int i = 0; i < searchResult->resultElements->__size; ++i)
 		{
 			struct gapi1__ResultElement *resultElement = searchResult->resultElements->__ptr[i];

Modified: trunk/Search/Google/GoogleAPIEngine.h
===================================================================
--- trunk/Search/Google/GoogleAPIEngine.h	2007-05-23 16:40:24 UTC (rev 846)
+++ trunk/Search/Google/GoogleAPIEngine.h	2007-05-26 04:21:17 UTC (rev 847)
@@ -34,7 +34,8 @@
 		virtual ~GoogleAPIEngine();
 
 		/// Runs a query; true if success.
-		virtual bool runQuery(QueryProperties& queryProps);
+		virtual bool runQuery(QueryProperties& queryProps,
+			unsigned int startDoc = 0);
 
 		/// Retrieves the specified URL from the cache; NULL if error. Caller deletes.
 		Document *retrieveCachedUrl(const string &url);

Modified: trunk/Search/PluginWebEngine.cpp
===================================================================
--- trunk/Search/PluginWebEngine.cpp	2007-05-23 16:40:24 UTC (rev 846)
+++ trunk/Search/PluginWebEngine.cpp	2007-05-26 04:21:17 UTC (rev 847)
@@ -65,7 +65,7 @@
 	delete pParser;
 }
 
-bool PluginWebEngine::getPage(const string &formattedQuery)
+bool PluginWebEngine::getPage(const string &formattedQuery, unsigned int maxResultsCount)
 {
 	if ((m_pResponseParser == NULL) ||
 		(formattedQuery.empty() == true))
@@ -101,7 +101,7 @@
 #endif
 
 	bool success = m_pResponseParser->parse(pResponseDoc, m_resultsList,
-		m_maxResultsCount, m_properties.m_nextBase);
+		maxResultsCount, m_properties.m_nextBase);
 	vector<DocumentInfo>::iterator resultIter = m_resultsList.begin();
 	while (resultIter != m_resultsList.end())
 	{
@@ -210,13 +210,16 @@
 //
 
 /// Runs a query; true if success.
-bool PluginWebEngine::runQuery(QueryProperties& queryProps)
+bool PluginWebEngine::runQuery(QueryProperties& queryProps,
+	unsigned int startDoc)
 {
 	string queryString(queryProps.getFreeQuery(true));
 	char countStr[64];
+	unsigned int maxResultsCount(queryProps.getMaximumResultsCount());
 	unsigned int currentIncrement = 0, count = 0;
 
 	m_resultsList.clear();
+	m_resultsCountEstimate = 0;
 
 	if (queryString.empty() == true)
 	{
@@ -255,7 +258,7 @@
 	cout << "PluginWebEngine::runQuery: querying "
 		<< m_properties.m_name << endl;
 #endif
-	while (count < m_maxResultsCount)
+	while (count < maxResultsCount)
 	{
 		string pageQuery(formattedQuery);
 
@@ -269,7 +272,7 @@
 				pageQuery += "&";
 				pageQuery += paramIter->second;
 				pageQuery += "=";
-				snprintf(countStr, 64, "%u", m_maxResultsCount);
+				snprintf(countStr, 64, "%u", maxResultsCount);
 				pageQuery += countStr;
 			}
 
@@ -298,7 +301,7 @@
 			}
 		}
 
-		if (getPage(pageQuery) == false)
+		if (getPage(pageQuery, queryProps.getMaximumResultsCount()) == false)
 		{
 			break;
 		}

Modified: trunk/Search/PluginWebEngine.h
===================================================================
--- trunk/Search/PluginWebEngine.h	2007-05-23 16:40:24 UTC (rev 846)
+++ trunk/Search/PluginWebEngine.h	2007-05-26 04:21:17 UTC (rev 847)
@@ -36,7 +36,8 @@
 		static bool getDetails(const std::string &fileName, std::string &name, std::string &channel);
 
 		/// Runs a query; true if success.
-		virtual bool runQuery(QueryProperties& queryProps);
+		virtual bool runQuery(QueryProperties& queryProps,
+			unsigned int startDoc = 0);
 
 	protected:
 		SearchPluginProperties m_properties;
@@ -44,7 +45,7 @@
 
 		void load(const std::string &fileName);
 
-		bool getPage(const std::string &formattedQuery);
+		bool getPage(const std::string &formattedQuery, unsigned int maxResultsCount);
 
 		static PluginParserInterface *getPluginParser(const std::string &fileName);
 

Modified: trunk/Search/SearchEngineInterface.cpp
===================================================================
--- trunk/Search/SearchEngineInterface.cpp	2007-05-23 16:40:24 UTC (rev 846)
+++ trunk/Search/SearchEngineInterface.cpp	2007-05-26 04:21:17 UTC (rev 847)
@@ -29,7 +29,7 @@
 SearchEngineInterface::SearchEngineInterface() :
 	m_callsCount(0),
 	m_startTime(time(NULL)),
-	m_maxResultsCount(10)
+	m_resultsCountEstimate(0)
 {
 }
 
@@ -50,12 +50,6 @@
 	m_startTime = startTime;
 }
 
-/// Sets the maximum number of results to return.
-void SearchEngineInterface::setMaxResultsCount(unsigned int count)
-{
-	m_maxResultsCount = count;
-}
-
 /// Sets whether the query should be expanded.
 bool SearchEngineInterface::setQueryExpansion(set<unsigned int> &relevantDocuments)
 {
@@ -75,6 +69,12 @@
 	return m_resultsList;
 }
 
+/// Returns an estimate of the total number of results for the previous query.
+unsigned int SearchEngineInterface::getResultsCountEstimate(void) const
+{
+	return m_resultsCountEstimate;
+}
+
 /// Returns the charset for the previous query's results.
 string SearchEngineInterface::getResultsCharset(void) const
 {

Modified: trunk/Search/SearchEngineInterface.h
===================================================================
--- trunk/Search/SearchEngineInterface.h	2007-05-23 16:40:24 UTC (rev 846)
+++ trunk/Search/SearchEngineInterface.h	2007-05-26 04:21:17 UTC (rev 847)
@@ -42,9 +42,6 @@
 		/// Sets the number of calls issued since start time.
 		virtual void setCallsCount(unsigned int count, time_t startTime);
 
-		/// Sets the maximum number of results to return.
-		virtual void setMaxResultsCount(unsigned int count);
-
 		/// Sets whether the query should be expanded.
 		virtual bool setQueryExpansion(set<unsigned int> &relevantDocuments);
 
@@ -52,11 +49,15 @@
 		virtual DownloaderInterface *getDownloader(void);
 
 		/// Runs a query; true if success.
-		virtual bool runQuery(QueryProperties& queryProps) = 0;
+		virtual bool runQuery(QueryProperties& queryProps,
+			unsigned int startDoc = 0) = 0;
 
 		/// Returns the results for the previous query.
 		virtual const vector<DocumentInfo> &getResults(void) const;
 
+		/// Returns an estimate of the total number of results for the previous query.
+		virtual unsigned int getResultsCountEstimate(void) const;
+
 		/// Returns the charset for the previous query's results.
 		virtual string getResultsCharset(void) const;
 
@@ -67,9 +68,9 @@
 		string m_key;
 		unsigned int m_callsCount;
 		time_t m_startTime;
-		unsigned int m_maxResultsCount;
 		bool m_expandQueries;
 		vector<DocumentInfo> m_resultsList;
+		unsigned int m_resultsCountEstimate;
 		string m_charset;
 		set<string> m_expandTerms;
 

Modified: trunk/Search/WebEngine.cpp
===================================================================
--- trunk/Search/WebEngine.cpp	2007-05-23 16:40:24 UTC (rev 846)
+++ trunk/Search/WebEngine.cpp	2007-05-26 04:21:17 UTC (rev 847)
@@ -61,7 +61,6 @@
 
 WebEngine::~WebEngine()
 {
-	m_resultsList.clear();
 	if (m_pDownloader != NULL)
 	{
 		delete m_pDownloader;

Modified: trunk/Search/XapianEngine.cpp
===================================================================
--- trunk/Search/XapianEngine.cpp	2007-05-23 16:40:24 UTC (rev 846)
+++ trunk/Search/XapianEngine.cpp	2007-05-26 04:21:17 UTC (rev 847)
@@ -102,15 +102,10 @@
 	{
 		m_databaseName = database;
 	}
-
-	// SearchEngineInterface members
-	m_maxResultsCount = 10;
-	m_resultsList.clear();
 }
 
 XapianEngine::~XapianEngine()
 {
-	m_resultsList.clear();
 }
 
 Xapian::Query XapianEngine::dateFilter(unsigned int minDay, unsigned int minMonth, unsigned int minYear,
@@ -385,7 +380,8 @@
 	return goodQuery;
 }
 
-bool XapianEngine::queryDatabase(Xapian::Database *pIndex, Xapian::Query &query)
+bool XapianEngine::queryDatabase(Xapian::Database *pIndex, Xapian::Query &query,
+	unsigned int startDoc, unsigned int maxResultsCount)
 {
 	bool completedQuery = false;
 
@@ -406,14 +402,16 @@
 		enquire.set_query(query);
 
 		// Get the top results of the query
-		Xapian::MSet matches = enquire.get_mset(0, m_maxResultsCount);
+		Xapian::MSet matches = enquire.get_mset(startDoc, maxResultsCount);
 		if (matches.empty() == false)
 		{
-			// Get the results
+			m_resultsCountEstimate = matches.get_matches_estimated();
 #ifdef DEBUG
-			cout << "XapianEngine::queryDatabase: " << matches.get_matches_estimated()
-				<< "/" << m_maxResultsCount << " results found" << endl;
+			cout << "XapianEngine::queryDatabase: " << m_resultsCountEstimate << "/"
+				<< maxResultsCount << " results found from position " << startDoc << endl;
 #endif
+
+			// Get the results
 			for (Xapian::MSetIterator mIter = matches.begin(); mIter != matches.end(); ++mIter)
 			{
 				Xapian::docid docId = *mIter;
@@ -517,10 +515,12 @@
 }
 
 /// Runs a query; true if success.
-bool XapianEngine::runQuery(QueryProperties& queryProps)
+bool XapianEngine::runQuery(QueryProperties& queryProps,
+	unsigned int startDoc)
 {
 	// Clear the results list
 	m_resultsList.clear();
+	m_resultsCountEstimate = 0;
 
 	XapianDatabase *pDatabase = XapianDatabaseFactory::getDatabase(m_databaseName, true);
 	if (pDatabase == NULL)
@@ -550,7 +550,8 @@
 			cout << "XapianEngine::runQuery: " << fullQuery.get_description() << endl;
 #endif
 			// Query the database
-			if (queryDatabase(pIndex, fullQuery) == false)
+			if (queryDatabase(pIndex, fullQuery, startDoc,
+				queryProps.getMaximumResultsCount()) == false)
 			{
 				break;
 			}

Modified: trunk/Search/XapianEngine.h
===================================================================
--- trunk/Search/XapianEngine.h	2007-05-23 16:40:24 UTC (rev 846)
+++ trunk/Search/XapianEngine.h	2007-05-26 04:21:17 UTC (rev 847)
@@ -43,13 +43,15 @@
 		bool setQueryExpansion(std::set<unsigned int> &relevantDocuments);
 
 		/// Runs a query; true if success.
-		virtual bool runQuery(QueryProperties& queryProps);
+		virtual bool runQuery(QueryProperties& queryProps,
+			unsigned int startDoc = 0);
 
 	protected:
 		std::string m_databaseName;
 		std::set<unsigned int> m_relevantDocuments;
 
-		bool queryDatabase(Xapian::Database *pIndex, Xapian::Query &query);
+		bool queryDatabase(Xapian::Database *pIndex, Xapian::Query &query,
+			unsigned int startDoc, unsigned int maxResultsCount);
 
 		static Xapian::Query dateFilter(unsigned int minDay, unsigned int minMonth, unsigned int minYear,
 		        unsigned int maxDay, unsigned int maxMonth, unsigned int maxYear);

Modified: trunk/Search/pinot-search.cpp
===================================================================
--- trunk/Search/pinot-search.cpp	2007-05-23 16:40:24 UTC (rev 846)
+++ trunk/Search/pinot-search.cpp	2007-05-26 04:21:17 UTC (rev 847)
@@ -179,9 +179,6 @@
 		return EXIT_FAILURE;
 	}
 
-	// How many results ?
-	pEngine->setMaxResultsCount(maxResultsCount);
-
 	// Set up the proxy
 	DownloaderInterface *pDownloader = pEngine->getDownloader();
 	if ((pDownloader != NULL) &&
@@ -193,7 +190,9 @@
 		pDownloader->setSetting("proxytype", proxyType);
 	}
 
-	QueryProperties queryProps("senginetest", pQuery);
+	QueryProperties queryProps("pinot-search", pQuery);
+
+	queryProps.setMaximumResultsCount(maxResultsCount);
 	if (pEngine->runQuery(queryProps) == true)
 	{
 		string resultsPage;



From fabricecolin at mail.berlios.de  Sat May 26 06:53:11 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 26 May 2007 06:53:11 +0200
Subject: [Pinot-svn] r848 - trunk/UI/GTK2/src
Message-ID: <200705260453.l4Q4rBra016180@sheep.berlios.de>

Author: fabricecolin
Date: 2007-05-26 06:53:07 +0200 (Sat, 26 May 2007)
New Revision: 848

Modified:
   trunk/UI/GTK2/src/IndexPage.cpp
   trunk/UI/GTK2/src/IndexPage.h
   trunk/UI/GTK2/src/ServerThreads.cpp
   trunk/UI/GTK2/src/ServerThreads.h
   trunk/UI/GTK2/src/WorkerThreads.cpp
   trunk/UI/GTK2/src/WorkerThreads.h
   trunk/UI/GTK2/src/mainWindow.cc
   trunk/UI/GTK2/src/mainWindow.hh
Log:
Both IndexBrowser and Querying threads can be used to populate index lists, the
latter relies on the search engine's total number of results estimate.
In IndexPage, the combo now shows all stored queries. They can be applied to the
current index just like labels could previously. Stored queries maximum number
of results is then ignored.
Synced with changes made to Search.


Modified: trunk/UI/GTK2/src/IndexPage.cpp
===================================================================
--- trunk/UI/GTK2/src/IndexPage.cpp	2007-05-26 04:21:17 UTC (rev 847)
+++ trunk/UI/GTK2/src/IndexPage.cpp	2007-05-26 04:53:07 UTC (rev 848)
@@ -39,13 +39,13 @@
 	PinotSettings &settings) :
 	NotebookPageBox(indexName, NotebookPageBox::INDEX_PAGE, settings),
 	m_pTree(pTree),
-	m_pLabelCombobox(NULL),
+	m_pQueryCombobox(NULL),
 	m_pBackButton(NULL),
 	m_pForwardButton(NULL),
 	m_docsCount(0),
 	m_firstDoc(0)
 {
-	m_pLabelCombobox = manage(new ComboBoxText());
+	m_pQueryCombobox = manage(new ComboBoxText());
 
 	Image *image521 = manage(new Image(StockID("gtk-media-rewind"), IconSize(4)));
 	Label *label52 = manage(new Label(_("Show Previous")));
@@ -97,7 +97,7 @@
 	// Position everything
 	indexHbuttonbox->pack_start(*m_pBackButton);
 	indexHbuttonbox->pack_start(*m_pForwardButton);
-	indexButtonsHbox->pack_start(*m_pLabelCombobox, Gtk::PACK_SHRINK, 4);
+	indexButtonsHbox->pack_start(*m_pQueryCombobox, Gtk::PACK_SHRINK, 4);
 	indexButtonsHbox->pack_start(*indexHbuttonbox, Gtk::PACK_EXPAND_WIDGET, 4);
 	pack_start(*indexButtonsHbox, Gtk::PACK_SHRINK, 4);
 	if (pTree != NULL)
@@ -106,11 +106,11 @@
 	}
 
 	// Populate
-	populateLabelCombobox();
+	populateQueryCombobox("");
 
 	// Connect the signals
-	m_pLabelCombobox->signal_changed().connect(
-		SigC::slot(*this, &IndexPage::onLabelChanged));
+	m_pQueryCombobox->signal_changed().connect(
+		SigC::slot(*this, &IndexPage::onQueryChanged));
 	m_pBackButton->signal_clicked().connect(
 		SigC::slot(*this, &IndexPage::onBackClicked));
 	m_pForwardButton->signal_clicked().connect(
@@ -121,7 +121,7 @@
 	m_pForwardButton->set_sensitive(false);
 
 	// Show all
-	m_pLabelCombobox->show();
+	m_pQueryCombobox->show();
 	image521->show();
 	label52->show();
 	hbox45->show();
@@ -141,17 +141,17 @@
 {
 }
 
-void IndexPage::onLabelChanged(void)
+void IndexPage::onQueryChanged(void)
 {
-	m_labelName = m_pLabelCombobox->get_active_text();
+	m_queryName = m_pQueryCombobox->get_active_text();
 #ifdef DEBUG
-	cout << "IndexPage::onLabelChanged: current label now " << m_labelName << endl;
+	cout << "IndexPage::onQueryChanged: current query now " << m_queryName << endl;
 #endif
-	if (m_labelName == _("All labels"))
+	if (m_queryName == _("None"))
 	{
-		m_labelName.clear();
+		m_queryName.clear();
 	}
-	m_signalLabelChanged(m_title, m_labelName);
+	m_signalQueryChanged(m_title, m_queryName);
 }
 
 void IndexPage::onBackClicked(void)
@@ -173,29 +173,44 @@
 }
 
 //
-// Returns the name of the current label.
+// Returns the name of the current query.
 //
-ustring IndexPage::getLabelName(void) const
+ustring IndexPage::getQueryName(void) const
 {
-	return m_labelName;
+	return m_queryName;
 }
 
 //
-// Populates the labels list.
+// Populates the queries list.
 //
-void IndexPage::populateLabelCombobox(void)
+void IndexPage::populateQueryCombobox(const string &queryName)
 {
-	m_pLabelCombobox->append_text(_("All labels"));
+	bool setActive = false;
 
-	const set<string> &labels = m_settings.getLabels();
-	for (set<string>::const_iterator labelIter = labels.begin();
-		labelIter != labels.end(); ++labelIter)
+	m_pQueryCombobox->clear_items();
+
+	m_pQueryCombobox->append_text(_("None"));
+
+	const std::map<string, QueryProperties> &queries = m_settings.getQueries();
+	for (std::map<string, QueryProperties>::const_iterator queryIter = queries.begin();
+		queryIter != queries.end(); ++queryIter)
 	{
-		m_pLabelCombobox->append_text(to_utf8(*labelIter));
+		m_pQueryCombobox->append_text(to_utf8(queryIter->first));
+
+		if ((setActive == false) &&
+			(queryIter->first == queryName))
+		{
+			m_pQueryCombobox->set_active_text(queryName);
+			m_queryName = queryName;
+			setActive = true;
+		}
 	}
 
-	m_pLabelCombobox->set_active(0);
-	m_labelName.clear();
+	if (setActive == false)
+	{
+		m_pQueryCombobox->set_active(0);
+		m_queryName.clear();
+	}
 }
 
 //
@@ -258,11 +273,11 @@
 }
 
 //
-// Returns the changed label signal.
+// Returns the changed query signal.
 //
-Signal2<void, ustring, ustring>& IndexPage::getLabelChangedSignal(void)
+Signal2<void, ustring, ustring>& IndexPage::getQueryChangedSignal(void)
 {
-	return m_signalLabelChanged;
+	return m_signalQueryChanged;
 }
 
 //

Modified: trunk/UI/GTK2/src/IndexPage.h
===================================================================
--- trunk/UI/GTK2/src/IndexPage.h	2007-05-26 04:21:17 UTC (rev 847)
+++ trunk/UI/GTK2/src/IndexPage.h	2007-05-26 04:53:07 UTC (rev 848)
@@ -48,11 +48,11 @@
 		/// Returns the page's tree.
 		virtual ResultsTree *getTree(void) const;
 
-		/// Returns the name of the current label.
-		Glib::ustring getLabelName(void) const;
+		/// Returns the name of the current query.
+		Glib::ustring getQueryName(void) const;
 
-		/// Populates the labels list.
-		void populateLabelCombobox(void);
+		/// Populates the queries list.
+		void populateQueryCombobox(const std::string &queryName);
 
 		/// Updates the state of the index buttons.
 		void updateButtonsState(unsigned int maxDocsCount);
@@ -69,8 +69,8 @@
 		/// Sets the first document.
 		void setFirstDocument(unsigned int startDoc);
 
-		/// Returns the changed label signal.
-		SigC::Signal2<void, Glib::ustring, Glib::ustring>& getLabelChangedSignal(void);
+		/// Returns the changed query signal.
+		SigC::Signal2<void, Glib::ustring, Glib::ustring>& getQueryChangedSignal(void);
 
 		/// Returns the back button clicked signal.
 		SigC::Signal1<void, Glib::ustring>& getBackClickedSignal(void);
@@ -80,18 +80,18 @@
 
 	protected:
 		Glib::ustring m_indexName;
-		Glib::ustring m_labelName;
+		Glib::ustring m_queryName;
 		ResultsTree *m_pTree;
-		Gtk::ComboBoxText *m_pLabelCombobox;
+		Gtk::ComboBoxText *m_pQueryCombobox;
 		Gtk::Button *m_pBackButton;
 		Gtk::Button *m_pForwardButton;
 		unsigned int m_docsCount;
 		unsigned int m_firstDoc;
-		SigC::Signal2<void, Glib::ustring, Glib::ustring> m_signalLabelChanged;
+		SigC::Signal2<void, Glib::ustring, Glib::ustring> m_signalQueryChanged;
 		SigC::Signal1<void, Glib::ustring> m_signalBackClicked;
 		SigC::Signal1<void, Glib::ustring> m_signalForwardClicked;
 
-		void onLabelChanged(void);
+		void onQueryChanged(void);
 
 		void onBackClicked(void);
 

Modified: trunk/UI/GTK2/src/ServerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/ServerThreads.cpp	2007-05-26 04:21:17 UTC (rev 847)
+++ trunk/UI/GTK2/src/ServerThreads.cpp	2007-05-26 04:53:07 UTC (rev 848)
@@ -808,13 +808,11 @@
 	return m_mustQuit;
 }
 
-bool DBusServletThread::runQuery(QueryProperties &queryProps, unsigned int maxHits,
-	vector<string> &docIds)
+bool DBusServletThread::runQuery(QueryProperties &queryProps, vector<string> &docIds)
 {
 	XapianEngine engine(PinotSettings::getInstance().m_daemonIndexLocation);
 
 	// Run the query
-	engine.setMaxResultsCount(maxHits);
 	if (engine.runQuery(queryProps) == false)
 	{
 		return false;
@@ -1172,7 +1170,8 @@
 				vector<string> docIds;
 
 				// Run the query
-				if (runQuery(queryProps, maxHits, docIds) == true)
+				queryProps.setMaximumResultsCount(maxHits);
+				if (runQuery(queryProps, docIds) == true)
 				{
 					m_pArray = g_ptr_array_new();
 

Modified: trunk/UI/GTK2/src/ServerThreads.h
===================================================================
--- trunk/UI/GTK2/src/ServerThreads.h	2007-05-26 04:21:17 UTC (rev 847)
+++ trunk/UI/GTK2/src/ServerThreads.h	2007-05-26 04:53:07 UTC (rev 848)
@@ -133,8 +133,7 @@
 		GPtrArray *m_pArray;
 		bool m_mustQuit;
 
-		bool runQuery(QueryProperties &queryProps, unsigned int maxHits,
-			std::vector<std::string> &docIds);
+		bool runQuery(QueryProperties &queryProps, std::vector<std::string> &docIds);
 
 		virtual void doWork(void);
 

Modified: trunk/UI/GTK2/src/WorkerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.cpp	2007-05-26 04:21:17 UTC (rev 847)
+++ trunk/UI/GTK2/src/WorkerThreads.cpp	2007-05-26 04:53:07 UTC (rev 848)
@@ -585,46 +585,54 @@
 	}
 }
 
-IndexBrowserThread::IndexBrowserThread(const string &indexName,
-	const string &labelName, unsigned int maxDocsCount, unsigned int startDoc) :
+ListerThread::ListerThread(const string &indexName, unsigned int startDoc) :
 	WorkerThread(),
 	m_indexName(indexName),
-	m_labelName(labelName),
-	m_indexDocsCount(0),
-	m_maxDocsCount(maxDocsCount),
-	m_startDoc(startDoc)
+	m_startDoc(startDoc),
+	m_documentsCount(0)
 {
 }
 
-IndexBrowserThread::~IndexBrowserThread()
+ListerThread::~ListerThread()
 {
 }
 
-string IndexBrowserThread::getType(void) const
+string ListerThread::getType(void) const
 {
-	return "IndexBrowserThread";
+	return "ListerThread";
 }
 
-string IndexBrowserThread::getIndexName(void) const
+string ListerThread::getIndexName(void) const
 {
 	return m_indexName;
 }
 
-string IndexBrowserThread::getLabelName(void) const
+unsigned int ListerThread::getStartDoc(void) const
 {
-	return m_labelName;
+	return m_startDoc;
 }
 
-unsigned int IndexBrowserThread::getDocumentsCount(void) const
+const vector<DocumentInfo> &ListerThread::getDocuments(void) const
 {
-	return m_indexDocsCount;
+	return m_documentsList;
 }
 
-const vector<DocumentInfo> &IndexBrowserThread::getDocuments(void) const
+unsigned int ListerThread::getDocumentsCount(void) const
 {
-	return m_documentsList;
+	return m_documentsCount;
 }
 
+IndexBrowserThread::IndexBrowserThread(const string &indexName,
+	unsigned int maxDocsCount, unsigned int startDoc) :
+	ListerThread(indexName, startDoc),
+	m_maxDocsCount(maxDocsCount)
+{
+}
+
+IndexBrowserThread::~IndexBrowserThread()
+{
+}
+
 bool IndexBrowserThread::stop(void)
 {
 	m_done = true;
@@ -664,8 +672,8 @@
 		return;
 	}
 
-	m_indexDocsCount = pIndex->getDocumentsCount(m_labelName);
-	if (m_indexDocsCount == 0)
+	m_documentsCount = pIndex->getDocumentsCount();
+	if (m_documentsCount == 0)
 	{
 #ifdef DEBUG
 		cout << "IndexBrowserThread::doWork: no documents" << endl;
@@ -674,19 +682,14 @@
 	}
 
 #ifdef DEBUG
-	cout << "IndexBrowserThread::doWork: " << m_maxDocsCount << " off " << m_indexDocsCount
-		<< " documents to browse, starting at " << m_startDoc << endl;
+	cout << "IndexBrowserThread::doWork: " << m_maxDocsCount << " off " << m_documentsCount
+		<< " documents to browse, starting at position " << m_startDoc << endl;
 #endif
-	if (m_labelName.empty() == true)
-	{
-		pIndex->listDocuments(docIDList, m_maxDocsCount, m_startDoc);
-	}
-	else
-	{
-		pIndex->listDocumentsWithLabel(m_labelName, docIDList, m_maxDocsCount, m_startDoc);
-	}
+	pIndex->listDocuments(docIDList, m_maxDocsCount, m_startDoc);
 
+	m_documentsList.clear();
 	m_documentsList.reserve(m_maxDocsCount);
+
 	for (set<unsigned int>::iterator iter = docIDList.begin(); iter != docIDList.end(); ++iter)
 	{
 		if (m_done == true)
@@ -724,13 +727,19 @@
 }
 
 QueryingThread::QueryingThread(const string &engineName, const string &engineDisplayableName,
-	const string &engineOption, const QueryProperties &queryProps) :
-	WorkerThread(),
+	const string &engineOption, const QueryProperties &queryProps,
+	unsigned int startDoc, bool listingIndex) :
+	ListerThread(engineDisplayableName, startDoc),
 	m_engineName(engineName),
 	m_engineDisplayableName(engineDisplayableName),
 	m_engineOption(engineOption),
-	m_queryProps(queryProps)
+	m_queryProps(queryProps),
+	m_listingIndex(listingIndex)
 {
+#ifdef DEBUG
+	cout << "QueryingThread::QueryingThread: engine " << m_engineName << ", " << engineOption
+		<< ", mode " << m_listingIndex << endl;
+#endif
 }
 
 QueryingThread::~QueryingThread()
@@ -739,6 +748,11 @@
 
 string QueryingThread::getType(void) const
 {
+	if (m_listingIndex == true)
+	{
+		return ListerThread::getType();
+	}
+
 	return "QueryingThread";
 }
 
@@ -752,14 +766,9 @@
 	return m_queryProps;
 }
 
-const vector<DocumentInfo> &QueryingThread::getResults(string &charset) const
+string QueryingThread::getCharset(void) const
 {
-	charset = m_resultsCharset;
-#ifdef DEBUG
-	cout << "QueryingThread::getResults: charset for " << m_engineDisplayableName << " is " << charset << endl;
-#endif
-
-	return m_resultsList;
+	return m_resultsCharset;
 }
 
 bool QueryingThread::stop(void)
@@ -768,6 +777,117 @@
 	return true;
 }
 
+void QueryingThread::processResults(const vector<DocumentInfo> &resultsList)
+{
+	PinotSettings &settings = PinotSettings::getInstance();
+	IndexInterface *pDocsIndex = NULL;
+	IndexInterface *pDaemonIndex = NULL;
+	unsigned int indexId = 0;
+	bool isIndexQuery = false;
+
+	// Are we querying an index ?
+	if (m_engineName == "xapian")
+	{
+		// Internal index ?
+		if (m_engineOption == settings.m_docsIndexLocation)
+		{
+			indexId = settings.getIndexId(_("My Web Pages"));
+			isIndexQuery = true;
+		}
+		else if (m_engineOption == settings.m_daemonIndexLocation)
+		{
+			indexId = settings.getIndexId(_("My Documents"));
+			isIndexQuery = true;
+		}
+	}
+
+	// Will we have to query internal indices ?
+	if (isIndexQuery == false)
+	{
+		pDocsIndex = settings.getIndex(settings.m_docsIndexLocation);
+		pDaemonIndex = settings.getIndex(settings.m_daemonIndexLocation);
+	}
+
+	// Copy the results list
+	for (vector<DocumentInfo>::const_iterator resultIter = resultsList.begin();
+		resultIter != resultsList.end(); ++resultIter)
+	{
+		DocumentInfo current(*resultIter);
+		string title(_("No title"));
+		string location(current.getLocation());
+		string language(current.getLanguage());
+		unsigned int docId = 0;
+
+		// The title may contain formatting
+		if (current.getTitle().empty() == false)
+		{
+			title = FilterUtils::stripMarkup(current.getTitle());
+		}
+		current.setTitle(title);
+#ifdef DEBUG
+		cout << "QueryingThread::doWork: title is " << title << endl;
+#endif
+
+		// Use the query's language if the result's is unknown
+		if (language.empty() == true)
+		{
+			language = m_queryProps.getLanguage();
+		}
+		current.setLanguage(language);
+
+		if (isIndexQuery == true)
+		{
+			unsigned int tmpId = 0;
+
+			// The index engine should have set this
+			docId = current.getIsIndexed(tmpId);
+		}
+
+		// Is this in one of the indexes ?
+		if ((pDocsIndex != NULL) &&
+			(pDocsIndex->isGood() == true))
+		{
+			docId = pDocsIndex->hasDocument(location);
+			if (docId > 0)
+			{
+				indexId = settings.getIndexId(_("My Web Pages"));
+			}
+		}
+		if ((pDaemonIndex != NULL) &&
+			(pDaemonIndex->isGood() == true) &&
+			(docId == 0))
+		{
+			docId = pDaemonIndex->hasDocument(location);
+			if (docId > 0)
+			{
+				indexId = settings.getIndexId(_("My Documents"));
+			}
+		}
+
+		if (docId > 0)
+		{
+			current.setIsIndexed(indexId, docId);
+#ifdef DEBUG
+			cout << "QueryingThread::doWork: found in index " << indexId << endl;
+#endif
+		}
+#ifdef DEBUG
+		else cout << "QueryingThread::doWork: not found in any index" << endl;
+#endif
+
+		m_documentsList.push_back(current);
+	}
+
+	if (pDocsIndex != NULL)
+	{
+		delete pDocsIndex;
+	}
+	if (pDaemonIndex != NULL)
+	{
+		delete pDaemonIndex;
+	}
+}
+
 void QueryingThread::doWork(void)
 {
 	PinotSettings &settings = PinotSettings::getInstance();
@@ -782,9 +902,6 @@
 		return;
 	}
 
-	// Set the maximum number of results
-	pEngine->setMaxResultsCount(m_queryProps.getMaximumResultsCount());
-
 	// Set up the proxy
 	DownloaderInterface *pDownloader = pEngine->getDownloader();
 	if ((pDownloader != NULL) &&
@@ -800,7 +917,7 @@
 	}
 
 	// Run the query
-	if (pEngine->runQuery(m_queryProps) == false)
+	if (pEngine->runQuery(m_queryProps, m_startDoc) == false)
 	{
 		m_status = _("Couldn't run query on search engine");
 		m_status += " ";
@@ -808,116 +925,25 @@
 	}
 	else
 	{
-		IndexInterface *pDocsIndex = NULL;
-		IndexInterface *pDaemonIndex = NULL;
 		const vector<DocumentInfo> &resultsList = pEngine->getResults();
-		unsigned int indexId = 0;
-		bool isIndexQuery = false;
 
-		m_resultsList.clear();
-		m_resultsList.reserve(resultsList.size());
-		m_resultsCharset = pEngine->getResultsCharset();
-
-		// Are we querying an index ?
-		if (m_engineName == "xapian")
-		{
-			// Internal index ?
-			if (m_engineOption == settings.m_docsIndexLocation)
-			{
-				indexId = settings.getIndexId(_("My Web Pages"));
-				isIndexQuery = true;
-			}
-			else if (m_engineOption == settings.m_daemonIndexLocation)
-			{
-				indexId = settings.getIndexId(_("My Documents"));
-				isIndexQuery = true;
-			}
-		}
-
-		// Will we have to query internal indices ?
-		if (isIndexQuery == false)
-		{
-			pDocsIndex = settings.getIndex(settings.m_docsIndexLocation);
-			pDaemonIndex = settings.getIndex(settings.m_daemonIndexLocation);
-		}
-
-		// Copy the results list
-		for (vector<DocumentInfo>::const_iterator resultIter = resultsList.begin();
-			resultIter != resultsList.end(); ++resultIter)
-		{
-			DocumentInfo current(*resultIter);
-			string title(_("No title"));
-			string location(current.getLocation());
-			string language(current.getLanguage());
-			unsigned int docId = 0;
-
-			// The title may contain formatting
-			if (current.getTitle().empty() == false)
-			{
-				title = FilterUtils::stripMarkup(current.getTitle());
-			}
-			current.setTitle(title);
+		m_documentsList.clear();
+		m_documentsList.reserve(resultsList.size());
+		m_documentsCount = pEngine->getResultsCountEstimate();
 #ifdef DEBUG
-			cout << "QueryingThread::doWork: title is " << title << endl;
+		cout << "QueryingThread::doWork: " << resultsList.size() << " off " << m_documentsCount
+			<< " results to process, starting at position " << m_startDoc << endl;
 #endif
 
-			// Use the query's language if the result's is unknown
-			if (language.empty() == true)
-			{
-				language = m_queryProps.getLanguage();
-			}
-			current.setLanguage(language);
-
-			if (isIndexQuery == true)
-			{
-				unsigned int tmpId = 0;
-
-				// The index engine should have set this
-				docId = current.getIsIndexed(tmpId);
-			}
-
-			// Is this in one of the indexes ?
-			if ((pDocsIndex != NULL) &&
-				(pDocsIndex->isGood() == true))
-			{
-				docId = pDocsIndex->hasDocument(location);
-				if (docId > 0)
-				{
-					indexId = settings.getIndexId(_("My Web Pages"));
-				}
-			}
-			if ((pDaemonIndex != NULL) &&
-				(pDaemonIndex->isGood() == true) &&
-				(docId == 0))
-			{
-				docId = pDaemonIndex->hasDocument(location);
-				if (docId > 0)
-				{
-					indexId = settings.getIndexId(_("My Documents"));
-				}
-			}
-
-			if (docId > 0)
-			{
-				current.setIsIndexed(indexId, docId);
-#ifdef DEBUG
-				cout << "QueryingThread::doWork: found in index " << indexId << endl;
-#endif
-			}
-#ifdef DEBUG
-			else cout << "QueryingThread::doWork: not found in any index" << endl;
-#endif
-
-			m_resultsList.push_back(current);
-		}
-
-		if (pDocsIndex != NULL)
+		m_resultsCharset = pEngine->getResultsCharset();
+		if (m_listingIndex == true)
 		{
-			delete pDocsIndex;
+			copy(resultsList.begin(), resultsList.end(),
+				back_inserter(m_documentsList));
 		}
-		if (pDaemonIndex != NULL)
+		else
 		{
-			delete pDaemonIndex;
+			processResults(resultsList);
 		}
 	}
 
@@ -993,8 +1019,6 @@
 		return;
 	}
 
-	// Set the maximum number of results
-	pEngine->setMaxResultsCount(m_queryProps.getMaximumResultsCount());
 	// Set whether to expand the query
 	pEngine->setQueryExpansion(relevantDocIds);
 

Modified: trunk/UI/GTK2/src/WorkerThreads.h
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.h	2007-05-26 04:21:17 UTC (rev 847)
+++ trunk/UI/GTK2/src/WorkerThreads.h	2007-05-26 04:53:07 UTC (rev 848)
@@ -147,33 +147,48 @@
 
 };
 
-class IndexBrowserThread : public WorkerThread
+class ListerThread : public WorkerThread
 {
 	public:
-		IndexBrowserThread(const std::string &indexName, const std::string &labelName,
-			unsigned int maxDocsCount, unsigned int startDoc);
-		~IndexBrowserThread();
+		ListerThread(const std::string &indexName, unsigned int startDoc);
+		~ListerThread();
 
 		std::string getType(void) const;
 
 		std::string getIndexName(void) const;
 
-		std::string getLabelName(void) const;
+		unsigned int getStartDoc(void) const;
 
-		unsigned int getDocumentsCount(void) const;
-
 		const std::vector<DocumentInfo> &getDocuments(void) const;
 
-		virtual bool stop(void);
+		unsigned int getDocumentsCount(void) const;
 
 	protected:
 		std::string m_indexName;
-		std::string m_labelName;
-		unsigned int m_indexDocsCount;
-		unsigned int m_maxDocsCount;
 		unsigned int m_startDoc;
 		std::vector<DocumentInfo> m_documentsList;
+		unsigned int m_documentsCount;
 
+	private:
+		ListerThread(const ListerThread &other);
+		ListerThread &operator=(const ListerThread &other);
+
+};
+
+class IndexBrowserThread : public ListerThread
+{
+	public:
+		IndexBrowserThread(const std::string &indexName, unsigned int maxDocsCount,
+			unsigned int startDoc = 0);
+		~IndexBrowserThread();
+
+		std::string getLabelName(void) const;
+
+		virtual bool stop(void);
+
+	protected:
+		unsigned int m_maxDocsCount;
+
 		virtual void doWork(void);
 
 	private:
@@ -182,20 +197,23 @@
 
 };
 
-class QueryingThread : public WorkerThread
+class QueryingThread : public ListerThread
 {
 	public:
 		QueryingThread(const std::string &engineName, const std::string &engineDisplayableName,
-			const std::string &engineOption, const QueryProperties &queryProps);
+			const std::string &engineOption, const QueryProperties &queryProps,
+			unsigned int startDoc = 0, bool listingIndex = false);
 		virtual ~QueryingThread();
 
 		virtual std::string getType(void) const;
 
 		std::string getEngineName(void) const;
 
+		bool isListingIndex(void) const;
+
 		QueryProperties getQuery(void) const;
 
-		const std::vector<DocumentInfo> &getResults(std::string &charset) const;
+		std::string getCharset(void) const;
 
 		virtual bool stop(void);
 
@@ -203,11 +221,12 @@
 		std::string m_engineName;
 		std::string m_engineDisplayableName;
 		std::string m_engineOption;
+		bool m_listingIndex;
 		QueryProperties m_queryProps;
-		std::vector<DocumentInfo> m_resultsList;
 		std::string m_resultsCharset;
-		std::set<std::string> m_expandTerms;
 
+		virtual void processResults(const std::vector<DocumentInfo> &resultsList);
+
 		virtual void doWork(void);
 
 	private:

Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2007-05-26 04:21:17 UTC (rev 847)
+++ trunk/UI/GTK2/src/mainWindow.cc	2007-05-26 04:53:07 UTC (rev 848)
@@ -570,7 +570,7 @@
 {
 	ResultsTree *pResultsTree = NULL;
 	IndexPage *pIndexPage = NULL;
-	ustring labelName;
+	ustring queryName;
 	bool foundPage = false;
 
 #ifdef DEBUG
@@ -587,7 +587,7 @@
 		{
 			pResultsTree->clear();
 		}
-		labelName = pIndexPage->getLabelName();
+		queryName = pIndexPage->getQueryName();
 		foundPage = true;
 	}
 
@@ -609,8 +609,8 @@
 		pResultsTree->getDoubleClickSignal().connect(
 			SigC::slot(*this, &mainWindow::on_showfromindex_activate));
 		// Connect to the label changed signal
-		pIndexPage->getLabelChangedSignal().connect(
-			SigC::slot(*this, &mainWindow::on_label_changed));
+		pIndexPage->getQueryChangedSignal().connect(
+			SigC::slot(*this, &mainWindow::on_query_changed));
 		// ...and to the buttons clicked signals
 		pIndexPage->getBackClickedSignal().connect(
 			SigC::slot(*this, &mainWindow::on_indexBackButton_clicked));
@@ -633,7 +633,7 @@
 
 	if (foundPage == true)
 	{
-		browse_index(indexName, labelName, 0);
+		browse_index(indexName, queryName, 0);
 	}
 }
 
@@ -716,9 +716,9 @@
 
 
 //
-// Index labels combo selection changed
+// Index queries combo selection changed
 //
-void mainWindow::on_label_changed(ustring indexName, ustring labelName)
+void mainWindow::on_query_changed(ustring indexName, ustring queryName)
 {
 	IndexPage *pIndexPage = dynamic_cast<IndexPage*>(get_page(indexName, NotebookPageBox::INDEX_PAGE));
 	if (pIndexPage == NULL)
@@ -732,9 +732,9 @@
 	}
 
 #ifdef DEBUG
-	cout << "mainWindow::on_label_changed: called on " << labelName << endl;
+	cout << "mainWindow::on_query_changed: called on " << queryName << endl;
 #endif
-	browse_index(indexName, labelName, 0);
+	browse_index(indexName, queryName, 0);
 }
 
 //
@@ -849,12 +849,12 @@
 		}
 	}
 	// Based on type, take the appropriate action...
-	else if (type == "IndexBrowserThread")
+	else if (type == "ListerThread")
 	{
 		char docsCountStr[64];
 
-		IndexBrowserThread *pBrowseThread = dynamic_cast<IndexBrowserThread *>(pThread);
-		if (pBrowseThread == NULL)
+		ListerThread *pListThread = dynamic_cast<ListerThread *>(pThread);
+		if (pListThread == NULL)
 		{
 			delete pThread;
 			return;
@@ -862,8 +862,7 @@
 
 		IndexPage *pIndexPage = NULL;
 		ResultsTree *pResultsTree = NULL;
-		ustring indexName = to_utf8(pBrowseThread->getIndexName());
-		ustring labelName = to_utf8(pBrowseThread->getLabelName());
+		ustring indexName = to_utf8(pListThread->getIndexName());
 
 		// Find the page for this index
 		// It may have been closed by the user
@@ -873,12 +872,12 @@
 			pResultsTree = pIndexPage->getTree();
 			if (pResultsTree != NULL)
 			{
-				const vector<DocumentInfo> &docsList = pBrowseThread->getDocuments();
+				const vector<DocumentInfo> &docsList = pListThread->getDocuments();
 
 				// Add the documents to the tree
 				pResultsTree->addResults("", docsList, "");
 
-				pIndexPage->setDocumentsCount(pBrowseThread->getDocumentsCount());
+				pIndexPage->setDocumentsCount(pListThread->getDocumentsCount());
 				pIndexPage->updateButtonsState(m_maxDocsCount);
 
 				status = _("Showing");
@@ -918,11 +917,11 @@
 			return;
 		}
 
-		QueryProperties queryProps = pQueryThread->getQuery();
+		QueryProperties queryProps(pQueryThread->getQuery());
 		ustring queryName = to_utf8(queryProps.getName());
 		ustring engineName = to_utf8(pQueryThread->getEngineName());
-		string resultsCharset;
-		const vector<DocumentInfo> &resultsList = pQueryThread->getResults(resultsCharset);
+		string resultsCharset(pQueryThread->getCharset());
+		const vector<DocumentInfo> &resultsList = pQueryThread->getDocuments();
 
 		status = _("Query");
 		status += " ";
@@ -1275,7 +1274,7 @@
 				if ((docsCount >= pIndexPage->getFirstDocument() + m_maxDocsCount))
 				{
 					// Refresh this page
-					browse_index(indexName, pIndexPage->getLabelName(), pIndexPage->getFirstDocument());
+					browse_index(indexName, pIndexPage->getQueryName(), pIndexPage->getFirstDocument());
 				}
 			}
 		}
@@ -1411,32 +1410,6 @@
 	cout << "mainWindow::on_configure_activate: settings changed" << endl;
 #endif
 
-	if (m_state.read_lock_lists() == true)
-	{
-		for (int pageNum = 0; pageNum < m_pNotebook->get_n_pages(); ++pageNum)
-		{
-			Widget *pPage = m_pNotebook->get_nth_page(pageNum);
-			if (pPage != NULL)
-			{
-				IndexPage *pIndexPage = dynamic_cast<IndexPage*>(pPage);
-				if (pIndexPage != NULL)
-				{
-					// Synchronize the labels list with the new settings
-					pIndexPage->populateLabelCombobox();
-
-					NotebookPageBox *pNotebookPage = dynamic_cast<NotebookPageBox*>(pPage);
-					if (pNotebookPage != NULL)
-					{
-						// The current label may have changed, refresh the list
-						browse_index(pNotebookPage->getTitle(), pIndexPage->getLabelName(), 0, false);
-					}
-				}
-			}
-		}
-
-		m_state.unlock_lists();
-	}
-
 	// Is starting the daemon necessary ?
 	if (prefsBox.startDaemon() == true)
 	{
@@ -1934,7 +1907,7 @@
 		if (pIndexPage != NULL)
 		{
 			// Refresh
-			browse_index(indexName, pIndexPage->getLabelName(), 0);
+			browse_index(indexName, pIndexPage->getQueryName(), 0);
 		}
 	}
 }
@@ -2020,11 +1993,11 @@
 {
 	vector<DocumentInfo> documentsList;
 	set<string> docLabels;
-	string indexName, labelName;
+	string indexName, queryName;
 	DocumentInfo docInfo;
 	unsigned int docId = 0, termsCount = 0;
 	int width, height;
-	bool matchedLabel = false, editDocument = false;
+	bool editDocument = false;
 
 #ifdef DEBUG
 	cout << "mainWindow::on_showfromindex_activate: called" << endl;
@@ -2034,12 +2007,12 @@
 	if (pIndexPage != NULL)
 	{
 		indexName = from_utf8(pIndexPage->getTitle());
-		labelName = from_utf8(pIndexPage->getLabelName());
+		queryName = from_utf8(pIndexPage->getQueryName());
 		pResultsTree = pIndexPage->getTree();
 	}
 
 	const std::map<string, string> &indexesMap = m_settings.getIndexes();
-	std::map<string, string>::const_iterator mapIter = indexesMap.find(indexName);	
+	std::map<string, string>::const_iterator mapIter = indexesMap.find(indexName);
 	if (mapIter == indexesMap.end())
 	{
 		ustring statusText = _("Index");
@@ -2086,13 +2059,6 @@
 		pIndex->getDocumentLabels(docId, docLabels);
 		termsCount = pIndex->getDocumentTermsCount(docId);
 
-		// Does it match the current label ?
-		if ((labelName.empty() == false) &&
-			(find(docLabels.begin(), docLabels.end(), labelName) != docLabels.end()))
-		{
-			matchedLabel = true;
-		}
-
 		editDocument = true;
 	}
 	else
@@ -2186,11 +2152,11 @@
 			}
 		}
 
-		if (labelName.empty() == false)
+		if (queryName.empty() == false)
 		{
 			// The current label may have been applied to or removed from
 			// one or more of the selected documents, so refresh the list
-			browse_index(indexName, labelName, 0, 0);
+			browse_index(indexName, queryName, 0, 0);
 		}
 	}
 
@@ -2553,6 +2519,31 @@
 
 			queryTreeview->columns_autosize();
 		}
+
+		if (m_state.read_lock_lists() == true)
+		{
+			for (int pageNum = 0; pageNum < m_pNotebook->get_n_pages(); ++pageNum)
+			{
+				Widget *pPage = m_pNotebook->get_nth_page(pageNum);
+				if (pPage != NULL)
+				{
+					IndexPage *pIndexPage = dynamic_cast<IndexPage*>(pPage);
+					if (pIndexPage != NULL)
+					{
+						// Synchronize the queries list with the new list 
+						pIndexPage->populateQueryCombobox("");
+					}
+
+					// The current query was removed, refresh the list
+					if (queryName == pIndexPage->getQueryName())
+					{
+						browse_index(pIndexPage->getTitle(), "", 0, false);
+					}
+				}
+			}
+
+			m_state.unlock_lists();
+		}
 	}
 }
 
@@ -2587,7 +2578,7 @@
 	{
 		if (pIndexPage->getFirstDocument() >= m_maxDocsCount)
 		{
-			browse_index(indexName, pIndexPage->getLabelName(), pIndexPage->getFirstDocument() - m_maxDocsCount);
+			browse_index(indexName, pIndexPage->getQueryName(), pIndexPage->getFirstDocument() - m_maxDocsCount);
 		}
 	}
 }
@@ -2605,14 +2596,14 @@
 #ifdef DEBUG
 			cout << "mainWindow::on_indexForwardButton_clicked: first" << endl;
 #endif
-			browse_index(indexName, pIndexPage->getLabelName(), 0);
+			browse_index(indexName, pIndexPage->getQueryName(), 0);
 		}
 		else if (pIndexPage->getDocumentsCount() >= pIndexPage->getFirstDocument() + m_maxDocsCount)
 		{
 #ifdef DEBUG
 			cout << "mainWindow::on_indexForwardButton_clicked: next" << endl;
 #endif
-			browse_index(indexName, pIndexPage->getLabelName(), pIndexPage->getFirstDocument() + m_maxDocsCount);
+			browse_index(indexName, pIndexPage->getQueryName(), pIndexPage->getFirstDocument() + m_maxDocsCount);
 		}
 #ifdef DEBUG
 		cout << "mainWindow::on_indexForwardButton_clicked: counts "
@@ -2880,6 +2871,31 @@
 	}
 
 	populate_queryTreeview(queryProps.getName());
+
+	if (m_state.read_lock_lists() == true)
+	{
+		for (int pageNum = 0; pageNum < m_pNotebook->get_n_pages(); ++pageNum)
+		{
+			Widget *pPage = m_pNotebook->get_nth_page(pageNum);
+			if (pPage != NULL)
+			{
+				IndexPage *pIndexPage = dynamic_cast<IndexPage*>(pPage);
+				if (pIndexPage != NULL)
+				{
+					// Synchronize the queries list with the new list
+					pIndexPage->populateQueryCombobox(pIndexPage->getQueryName());
+
+					// The current query may have changed, refresh the list
+					if (queryName == pIndexPage->getQueryName())
+					{
+						browse_index(pIndexPage->getTitle(), queryName, 0, false);
+					}
+				}
+			}
+		}
+
+		m_state.unlock_lists();
+	}
 }
 
 //
@@ -3014,7 +3030,7 @@
 //
 // Browse an index
 //
-void mainWindow::browse_index(const ustring &indexName, const ustring &labelName,
+void mainWindow::browse_index(const ustring &indexName, const ustring &queryName,
 	unsigned int startDoc, bool changePage)
 {
 	// Rudimentary lock
@@ -3043,9 +3059,38 @@
 	}
 
 	// Spawn a new thread to browse the index
-	IndexBrowserThread *pBrowseThread = new IndexBrowserThread(
-		from_utf8(indexName), labelName, m_maxDocsCount, startDoc);
-	start_thread(pBrowseThread);
+	if (queryName.empty() == true)
+	{
+		start_thread(new IndexBrowserThread(from_utf8(indexName), m_maxDocsCount, startDoc));
+	}
+	else
+	{
+		// Find the query
+		const std::map<string, QueryProperties> &queriesMap = m_settings.getQueries();
+		std::map<string, QueryProperties>::const_iterator queryIter = queriesMap.find(queryName);
+		if (queryIter != queriesMap.end())
+		{
+			QueryProperties queryProps(queryIter->second);
+
+			// Override the query's default number of results
+			queryProps.setMaximumResultsCount(m_maxDocsCount);
+
+			// ... and the index
+			const std::map<string, string> &indexesMap = m_settings.getIndexes();
+			std::map<string, string>::const_iterator mapIter = indexesMap.find(indexName);
+			if (mapIter != indexesMap.end())
+			{
+				start_thread(new QueryingThread("xapian", from_utf8(indexName),
+					mapIter->second, queryProps, startDoc, true));
+			}
+#ifdef DEBUG
+			else cout << "mainWindow::browse_index: couldn't find index " << indexName << endl;
+#endif
+		}
+#ifdef DEBUG
+		else cout << "mainWindow::browse_index: couldn't find query " << queryName << endl;
+#endif
+	}
 }
 
 //
@@ -3241,25 +3286,12 @@
 		return false;
 	}
 
-	// Does that document have the current label ?
-	ustring labelName = pIndexPage->getLabelName();
-	if (labelName.empty() == false)
+	// Is a query defined ?
+	ustring queryName = pIndexPage->getQueryName();
+	if (queryName.empty() == false)
 	{
-		const std::map<string, string> &indexesMap = m_settings.getIndexes();
-		std::map<string, string>::const_iterator mapIter = indexesMap.find(indexName);
-		if (mapIter != indexesMap.end())
-		{
-			IndexInterface *pIndex = m_settings.getIndex(mapIter->second);
-	
-			if (pIndex != NULL)
-			{
-				unsigned int indexId = 0;
-
-				appendToList = pIndex->hasLabel(docInfo.getIsIndexed(indexId), from_utf8(labelName));
-			}
-
-			delete pIndex;
-		}
+		// FIXME: run th document through the query
+		appendToList = false;
 	}
 
 	if (appendToList == true)

Modified: trunk/UI/GTK2/src/mainWindow.hh
===================================================================
--- trunk/UI/GTK2/src/mainWindow.hh	2007-05-26 04:21:17 UTC (rev 847)
+++ trunk/UI/GTK2/src/mainWindow.hh	2007-05-26 04:53:07 UTC (rev 848)
@@ -68,7 +68,7 @@
 	void on_indexTreeviewSelection_changed(Glib::ustring indexName);
 	void on_index_changed(Glib::ustring indexName);
 	void on_cache_changed(PinotSettings::CacheProvider cacheProvider);
-	void on_label_changed(Glib::ustring indexName, Glib::ustring labelName);
+	void on_query_changed(Glib::ustring indexName, Glib::ustring queryName);
 	void on_switch_page(GtkNotebookPage *p0, guint p1);
 	void on_close_page(Glib::ustring title, NotebookPageBox::PageType type);
 	void on_thread_end(WorkerThread *pThread);



From fabricecolin at mail.berlios.de  Sat May 26 14:26:07 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 26 May 2007 14:26:07 +0200
Subject: [Pinot-svn] r849 - trunk/Search
Message-ID: <200705261226.l4QCQ7sZ000355@sheep.berlios.de>

Author: fabricecolin
Date: 2007-05-26 14:26:07 +0200 (Sat, 26 May 2007)
New Revision: 849

Modified:
   trunk/Search/SherlockParser.cpp
   trunk/Search/SherlockParser.h
Log:
Minor cleanup.


Modified: trunk/Search/SherlockParser.cpp
===================================================================
--- trunk/Search/SherlockParser.cpp	2007-05-26 04:53:07 UTC (rev 848)
+++ trunk/Search/SherlockParser.cpp	2007-05-26 12:26:07 UTC (rev 849)
@@ -17,6 +17,8 @@
  */
 
 #include <stdlib.h>
+#include <map>
+#include <set>
 #include <iostream>
 #include <boost/spirit/core.hpp>
 #include <boost/spirit/actor/push_back_actor.hpp>
@@ -34,8 +36,13 @@
 using std::cout;
 using std::endl;
 using std::string;
+using std::vector;
 using std::map;
+using std::set;
+using std::exception;
 
+using namespace boost::spirit;
+
 // A function object to lower case map keys with for_each()
 struct LowerAndCopy
 {
@@ -54,9 +61,6 @@
 
 };
 
-using namespace std;
-using namespace boost::spirit;
-
 struct skip_grammar : public grammar<skip_grammar>
 {
 	template <typename ScannerT>
@@ -370,7 +374,6 @@
 			{
 				unsigned int endOfFirstLink = 0, startOfSecondLink = 0, endOfSecondLink = 0, startOfThirdLink = 0;
 
-
 				// The result's URL and title should be given by the first link
 				for (set<Dijon::Link>::iterator linkIter = chunkLinks.begin(); linkIter != chunkLinks.end(); ++linkIter)
 				{

Modified: trunk/Search/SherlockParser.h
===================================================================
--- trunk/Search/SherlockParser.h	2007-05-26 04:53:07 UTC (rev 848)
+++ trunk/Search/SherlockParser.h	2007-05-26 12:26:07 UTC (rev 849)
@@ -21,6 +21,7 @@
 
 #include <pthread.h>
 #include <string>
+#include <vector>
 
 #include "Document.h"
 #include "PluginParsers.h"



From fabricecolin at mail.berlios.de  Sun May 27 09:34:58 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sun, 27 May 2007 09:34:58 +0200
Subject: [Pinot-svn] r850 - trunk/UI/GTK2/src
Message-ID: <200705270734.l4R7Yww9007953@sheep.berlios.de>

Author: fabricecolin
Date: 2007-05-27 09:34:57 +0200 (Sun, 27 May 2007)
New Revision: 850

Modified:
   trunk/UI/GTK2/src/WorkerThreads.cpp
   trunk/UI/GTK2/src/WorkerThreads.h
   trunk/UI/GTK2/src/mainWindow.cc
Log:
Set the index ID on results , when in listing mode, to ensure their properties
can be shown and edited properly.


Modified: trunk/UI/GTK2/src/WorkerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.cpp	2007-05-26 12:26:07 UTC (rev 849)
+++ trunk/UI/GTK2/src/WorkerThreads.cpp	2007-05-27 07:34:57 UTC (rev 850)
@@ -888,6 +888,25 @@
 	}
 }
 
+void QueryingThread::processResults(const vector<DocumentInfo> &resultsList,
+	unsigned int indexId)
+{
+	unsigned int zeroId = 0;
+
+	// Copy the results list
+	for (vector<DocumentInfo>::const_iterator resultIter = resultsList.begin();
+		resultIter != resultsList.end(); ++resultIter)
+	{
+		DocumentInfo current(*resultIter);
+
+		// The engine has no notion of index IDs
+		unsigned int docId = current.getIsIndexed(zeroId);
+		current.setIsIndexed(indexId, docId);
+
+		m_documentsList.push_back(current);
+	}
+}
+
 void QueryingThread::doWork(void)
 {
 	PinotSettings &settings = PinotSettings::getInstance();
@@ -936,14 +955,14 @@
 #endif
 
 		m_resultsCharset = pEngine->getResultsCharset();
-		if (m_listingIndex == true)
+		if (m_listingIndex == false)
 		{
-			copy(resultsList.begin(), resultsList.end(),
-				back_inserter(m_documentsList));
+			processResults(resultsList);
 		}
 		else
 		{
-			processResults(resultsList);
+			processResults(resultsList,
+				PinotSettings::getInstance().getIndexId(m_engineDisplayableName));
 		}
 	}
 

Modified: trunk/UI/GTK2/src/WorkerThreads.h
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.h	2007-05-26 12:26:07 UTC (rev 849)
+++ trunk/UI/GTK2/src/WorkerThreads.h	2007-05-27 07:34:57 UTC (rev 850)
@@ -227,6 +227,9 @@
 
 		virtual void processResults(const std::vector<DocumentInfo> &resultsList);
 
+		virtual void processResults(const std::vector<DocumentInfo> &resultsList,
+			unsigned int indexId);
+
 		virtual void doWork(void);
 
 	private:

Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2007-05-26 12:26:07 UTC (rev 849)
+++ trunk/UI/GTK2/src/mainWindow.cc	2007-05-27 07:34:57 UTC (rev 850)
@@ -2052,14 +2052,18 @@
 
 		// Get the document ID
 		docId = docIter->getIsIndexed(indexId);
-
-		// Get the properties from the index because they have been altered
-		// by the tree for display purposes
-		pIndex->getDocumentInfo(docId, docInfo);
-		pIndex->getDocumentLabels(docId, docLabels);
-		termsCount = pIndex->getDocumentTermsCount(docId);
-
-		editDocument = true;
+#ifdef DEBUG
+		cout << "mainWindow::on_showfromindex_activate: document " << docId << " in index " << indexId << endl;
+#endif
+		if (docId > 0)
+		{
+			// Get the properties from the index because they have been altered
+			// by the tree for display purposes
+			pIndex->getDocumentInfo(docId, docInfo);
+			pIndex->getDocumentLabels(docId, docLabels);
+			termsCount = pIndex->getDocumentTermsCount(docId);
+			editDocument = true;
+		}
 	}
 	else
 	{



From fabricecolin at mail.berlios.de  Tue May 29 13:10:55 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 29 May 2007 13:10:55 +0200
Subject: [Pinot-svn] r851 - trunk/UI/GTK2/src
Message-ID: <200705291110.l4TBAtpv020762@sheep.berlios.de>

Author: fabricecolin
Date: 2007-05-29 13:10:54 +0200 (Tue, 29 May 2007)
New Revision: 851

Modified:
   trunk/UI/GTK2/src/mainWindow.cc
Log:
Fixed previous check-in.


Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2007-05-27 07:34:57 UTC (rev 850)
+++ trunk/UI/GTK2/src/mainWindow.cc	2007-05-29 11:10:54 UTC (rev 851)
@@ -2536,12 +2536,12 @@
 					{
 						// Synchronize the queries list with the new list 
 						pIndexPage->populateQueryCombobox("");
-					}
 
-					// The current query was removed, refresh the list
-					if (queryName == pIndexPage->getQueryName())
-					{
-						browse_index(pIndexPage->getTitle(), "", 0, false);
+						// The current query was removed, refresh the list
+						if (queryName == pIndexPage->getQueryName())
+						{
+							browse_index(pIndexPage->getTitle(), "", 0, false);
+						}
 					}
 				}
 			}



From fabricecolin at mail.berlios.de  Tue May 29 13:35:47 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 29 May 2007 13:35:47 +0200
Subject: [Pinot-svn] r852 - trunk
Message-ID: <200705291135.l4TBZlIO015108@sheep.berlios.de>

Author: fabricecolin
Date: 2007-05-29 13:35:47 +0200 (Tue, 29 May 2007)
New Revision: 852

Modified:
   trunk/README
Log:
Specify that gsoap is optional, just like the Google SOAP API.
As for openssh-askpass, it's only needed if _SSH_TUNNEL is defined.


Modified: trunk/README
===================================================================
--- trunk/README	2007-05-29 11:10:54 UTC (rev 851)
+++ trunk/README	2007-05-29 11:35:47 UTC (rev 852)
@@ -387,7 +387,7 @@
 
 Google SOAP API (2)	Search/Google/googleapi		beta2
 
- gSOAP							2.7.8c
+ gSOAP (2)						2.7.8c
  http://www.cs.fsu.edu/~engelen/soap.html
 
 gtkmm							2.6.2
@@ -430,7 +430,7 @@
 TagLib							1.4
 http://ktown.kde.org/~wheeler/taglib/
 
-openssh-askpass						4.3
+openssh-askpass (4)					4.3
 http://www.openssh.com/portable.html
 
 ---------------------------------------------------------------
@@ -438,6 +438,7 @@
 (1) enabled with "./configure --with-http=neon|curl"
 (2) enabled with "./configure --with-soap=yes"
 (3) for building only
+(4) experimental - required only if _SSH_TUNNEL is set
 ---------------------------------------------------------------
 
 



From fabricecolin at mail.berlios.de  Thu May 31 09:10:54 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Thu, 31 May 2007 09:10:54 +0200
Subject: [Pinot-svn] r853 - trunk
Message-ID: <200705310710.l4V7AsPE018593@sheep.berlios.de>

Author: fabricecolin
Date: 2007-05-31 09:10:54 +0200 (Thu, 31 May 2007)
New Revision: 853

Modified:
   trunk/Makefile.am
Log:
Added uninstall-local target to remove files installed by install-data-local.
This omission was reported by Christian Dywan on May 14th.


Modified: trunk/Makefile.am
===================================================================
--- trunk/Makefile.am	2007-05-29 11:35:47 UTC (rev 852)
+++ trunk/Makefile.am	2007-05-31 07:10:54 UTC (rev 853)
@@ -55,5 +55,19 @@
 	$(mkinstalldirs) $(DESTDIR)$(libdir)/deskbar-applet/handlers/
 	$(INSTALL_DATA) scripts/python/pinot-live.py $(DESTDIR)$(libdir)/deskbar-applet/handlers/
 
+uninstall-local:
+	@rm -rf $(DESTDIR)$(sysconfdir)/pinot
+	@rm -rf $(DESTDIR)$(datadir)/pinot
+	@rm -rf $(DESTDIR)$(datadir)/dbus-1/services/de.berlios.Pinot.service
+	@rm -rf $(DESTDIR)$(libdir)/pinot
+	@rm -rf $(DESTDIR)$(datadir)/icons/hicolor/48x48/apps/pinot.png
+	@rm -rf $(DESTDIR)$(datadir)/icons/hicolor/32x32/apps/pinot.png
+	@rm -rf $(DESTDIR)$(datadir)/icons/hicolor/24x24/apps/pinot.png
+	@rm -rf $(DESTDIR)$(datadir)/icons/hicolor/22x22/apps/pinot.png
+	@rm -rf $(DESTDIR)$(datadir)/icons/hicolor/16x16/apps/pinot.png
+	@rm -rf $(DESTDIR)$(datadir)/applications/pinot.desktop
+	@rm -rf $(DESTDIR)${sysconfdir}/xdg/autostart/pinot-dbus-daemon.desktop
+	@rm -rf $(DESTDIR)$(libdir)/deskbar-applet/handlers/pinot-live.py*
+
 ACLOCAL_AMFLAGS = -I m4
 



From fabricecolin at mail.berlios.de  Thu May 31 09:45:03 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Thu, 31 May 2007 09:45:03 +0200
Subject: [Pinot-svn] r854 - trunk/UI/GTK2/src
Message-ID: <200705310745.l4V7j3lu021081@sheep.berlios.de>

Author: fabricecolin
Date: 2007-05-31 09:45:02 +0200 (Thu, 31 May 2007)
New Revision: 854

Modified:
   trunk/UI/GTK2/src/mainWindow.cc
   trunk/UI/GTK2/src/propertiesDialog.cc
Log:
The properties dialog shows the document ID in the title bar.


Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2007-05-31 07:10:54 UTC (rev 853)
+++ trunk/UI/GTK2/src/mainWindow.cc	2007-05-31 07:45:02 UTC (rev 854)
@@ -2061,6 +2061,7 @@
 			// by the tree for display purposes
 			pIndex->getDocumentInfo(docId, docInfo);
 			pIndex->getDocumentLabels(docId, docLabels);
+			docInfo.setIsIndexed(indexId, docId);
 			termsCount = pIndex->getDocumentTermsCount(docId);
 			editDocument = true;
 		}

Modified: trunk/UI/GTK2/src/propertiesDialog.cc
===================================================================
--- trunk/UI/GTK2/src/propertiesDialog.cc	2007-05-31 07:10:54 UTC (rev 853)
+++ trunk/UI/GTK2/src/propertiesDialog.cc	2007-05-31 07:45:02 UTC (rev 854)
@@ -38,8 +38,21 @@
 	m_docInfo(docInfo)
 {
 	string language(docInfo.getLanguage());
+	char numStr[128];
+	unsigned int indexId = 0;
 	bool notALanguageName = false;
 
+	// Get the document ID
+	unsigned int docId = docInfo.getIsIndexed(indexId);
+#ifdef DEBUG
+	cout << "propertiesDialog: document " << docId << endl;
+#endif
+	if (docId > 0)
+	{
+		snprintf(numStr, 128, "%u", docId);
+		set_title(get_title() + " (ID " + numStr + ")");
+	}
+
 	// Associate the columns model to the labels tree
 	m_refLabelsTree = ListStore::create(m_labelsColumns);
 	labelsTreeview->set_model(m_refLabelsTree);
@@ -51,7 +64,6 @@
 	if (m_editDocument == true)
 	{
 		unsigned int size = docInfo.getSize();
-		char numStr[128];
 
 		titleEntry->set_text(to_utf8(docInfo.getTitle()));
 		typeEntry->set_text(to_utf8(docInfo.getType()));



From fabricecolin at mail.berlios.de  Thu May 31 09:49:39 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Thu, 31 May 2007 09:49:39 +0200
Subject: [Pinot-svn] r855 - in trunk: . Index Search UI/GTK2/src Utils
Message-ID: <200705310749.l4V7ndLP021386@sheep.berlios.de>

Author: fabricecolin
Date: 2007-05-31 09:49:38 +0200 (Thu, 31 May 2007)
New Revision: 855

Modified:
   trunk/Index/XapianIndex.cpp
   trunk/Search/XapianEngine.cpp
   trunk/UI/GTK2/src/pinot-dbus-daemon.cc
   trunk/UI/GTK2/src/pinot.cc
   trunk/Utils/Languages.cpp
   trunk/textcat_conf.txt
Log:
Hungarian, Romanian and Turkish are supported by Xapian 1.0's stemmers.
Libtextcat 2.2 has Language Models for them but not 3.0 yet.
Xapian::Stem is supposed to throw an exception for languages it doesn't know
about, so this change should be backward-compatible with Xapian < 1.0.


Modified: trunk/Index/XapianIndex.cpp
===================================================================
--- trunk/Index/XapianIndex.cpp	2007-05-31 07:45:02 UTC (rev 854)
+++ trunk/Index/XapianIndex.cpp	2007-05-31 07:49:38 UTC (rev 855)
@@ -174,7 +174,14 @@
 	// Do we know what language to use for stemming ?
 	if (m_stemLanguage.empty() == false)
 	{
-		pStemmer = new Xapian::Stem(StringManip::toLowerCase(m_stemLanguage));
+		try
+		{
+			pStemmer = new Xapian::Stem(StringManip::toLowerCase(m_stemLanguage));
+		}
+		catch (const Xapian::Error &error)
+		{
+			cerr << "Couldn't create stemmer: " << error.get_type() << ": " << error.get_msg() << endl;
+		}
 	}
 
 	// Terms starting with a capital letter are R-prefixed, unless a prefix is already defined
@@ -254,7 +261,14 @@
 	// Do we know what language to use for stemming ?
 	if (language.empty() == false)
 	{
-		pStemmer = new Xapian::Stem(StringManip::toLowerCase(language));
+		try
+		{
+			pStemmer = new Xapian::Stem(StringManip::toLowerCase(m_stemLanguage));
+		}
+		catch (const Xapian::Error &error)
+		{
+			cerr << "Couldn't create stemmer: " << error.get_type() << ": " << error.get_msg() << endl;
+		}
 	}
 
 	// Terms starting with a capital letter are R-prefixed, unless a prefix is already defined
@@ -561,7 +575,7 @@
 		}
 		catch (const Xapian::Error &error)
 		{
-			cerr << "XapianIndex::scanDocument: " << error.get_type() << ": " << error.get_msg() << endl;
+			cerr << "Couldn't create stemmer: " << error.get_type() << ": " << error.get_msg() << endl;
 			continue;
 		}
 

Modified: trunk/Search/XapianEngine.cpp
===================================================================
--- trunk/Search/XapianEngine.cpp	2007-05-31 07:45:02 UTC (rev 854)
+++ trunk/Search/XapianEngine.cpp	2007-05-31 07:49:38 UTC (rev 855)
@@ -199,7 +199,14 @@
 	// Set things up
 	if (stemLanguage.empty() == false)
 	{
-		stemmer = Xapian::Stem(StringManip::toLowerCase(stemLanguage));
+		try
+		{
+			stemmer = Xapian::Stem(StringManip::toLowerCase(stemLanguage));
+		}
+		catch (const Xapian::Error &error)
+		{
+			cerr << "Couldn't create stemmer: " << error.get_type() << ": " << error.get_msg() << endl;
+		}
 		parser.set_stemming_strategy(Xapian::QueryParser::STEM_ALL);
 		parser.set_stemmer(stemmer);
 	}

Modified: trunk/UI/GTK2/src/pinot-dbus-daemon.cc
===================================================================
--- trunk/UI/GTK2/src/pinot-dbus-daemon.cc	2007-05-31 07:45:02 UTC (rev 854)
+++ trunk/UI/GTK2/src/pinot-dbus-daemon.cc	2007-05-31 07:49:38 UTC (rev 855)
@@ -299,12 +299,15 @@
 	Languages::setIntlName(4, _("Finnish"));
 	Languages::setIntlName(5, _("French"));
 	Languages::setIntlName(6, _("German"));
-	Languages::setIntlName(7, _("Italian"));
-	Languages::setIntlName(8, _("Norwegian"));
-	Languages::setIntlName(9, _("Portuguese"));
-	Languages::setIntlName(10, _("Russian"));
-	Languages::setIntlName(11, _("Spanish"));
-	Languages::setIntlName(12, _("Swedish"));
+	Languages::setIntlName(7, _("Hungarian"));
+	Languages::setIntlName(8, _("Italian"));
+	Languages::setIntlName(9, _("Norwegian"));
+	Languages::setIntlName(10, _("Portuguese"));
+	Languages::setIntlName(11, _("Romanian"));
+	Languages::setIntlName(12, _("Russian"));
+	Languages::setIntlName(13, _("Spanish"));
+	Languages::setIntlName(14, _("Swedish"));
+	Languages::setIntlName(15, _("Turkish"));
 
 	// Load tokenizer libraries, if any
 	Dijon::HtmlFilter::initialize();

Modified: trunk/UI/GTK2/src/pinot.cc
===================================================================
--- trunk/UI/GTK2/src/pinot.cc	2007-05-31 07:45:02 UTC (rev 854)
+++ trunk/UI/GTK2/src/pinot.cc	2007-05-31 07:49:38 UTC (rev 855)
@@ -231,12 +231,15 @@
 	Languages::setIntlName(4, _("Finnish"));
 	Languages::setIntlName(5, _("French"));
 	Languages::setIntlName(6, _("German"));
-	Languages::setIntlName(7, _("Italian"));
-	Languages::setIntlName(8, _("Norwegian"));
-	Languages::setIntlName(9, _("Portuguese"));
-	Languages::setIntlName(10, _("Russian"));
-	Languages::setIntlName(11, _("Spanish"));
-	Languages::setIntlName(12, _("Swedish"));
+	Languages::setIntlName(7, _("Hungarian"));
+	Languages::setIntlName(8, _("Italian"));
+	Languages::setIntlName(9, _("Norwegian"));
+	Languages::setIntlName(10, _("Portuguese"));
+	Languages::setIntlName(11, _("Romanian"));
+	Languages::setIntlName(12, _("Russian"));
+	Languages::setIntlName(13, _("Spanish"));
+	Languages::setIntlName(14, _("Swedish"));
+	Languages::setIntlName(15, _("Turkish"));
 
 	// Load search engines
 	settings.loadSearchEngines(prefixDir + "/share/pinot/engines");

Modified: trunk/Utils/Languages.cpp
===================================================================
--- trunk/Utils/Languages.cpp	2007-05-31 07:45:02 UTC (rev 854)
+++ trunk/Utils/Languages.cpp	2007-05-31 07:49:38 UTC (rev 855)
@@ -26,14 +26,14 @@
 using std::pair;
 using std::min;
 
-unsigned int Languages::m_count = 13;
+unsigned int Languages::m_count = 16;
 
 char *Languages::m_names[] = { "Unknown", "Danish", "Dutch", "English",
-	"Finnish", "French", "German", "Italian", "Norwegian", "Portuguese",
-	"Russian", "Spanish", "Swedish" };
+	"Finnish", "French", "German", "Hungarian", "Italian", "Norwegian",
+	"Portuguese", "Romanian", "Russian", "Spanish", "Swedish", "Turkish" };
 
-char *Languages::m_codes[] = { "", "da", "nl", "en", "fi", "fr", "de", \
-	"it", "nn", "pt", "ru", "es", "sv" };
+char *Languages::m_codes[] = { "", "da", "nl", "en", "fi", "fr", "de", "hu", \
+	"it", "nn", "pt", "ro", "ru", "es", "sv", "tr" };
 
 map<unsigned int, string> Languages::m_intlNames;
 

Modified: trunk/textcat_conf.txt
===================================================================
--- trunk/textcat_conf.txt	2007-05-31 07:45:02 UTC (rev 854)
+++ trunk/textcat_conf.txt	2007-05-31 07:49:38 UTC (rev 855)
@@ -3,17 +3,20 @@
 # The following languages are supported by Xapian::Stem
 # Languages names MUST be in English
 #
-/usr/share/libtextcat/LM/english.lm                     english
-/usr/share/libtextcat/LM/spanish.lm                     spanish
-/usr/share/libtextcat/LM/french.lm                      french
-/usr/share/libtextcat/LM/german.lm                      german
 /usr/share/libtextcat/LM/danish.lm			danish
 /usr/share/libtextcat/LM/dutch.lm			dutch
+/usr/share/libtextcat/LM/english.lm			english
 /usr/share/libtextcat/LM/finnish.lm			finnish
+/usr/share/libtextcat/LM/french.lm			french
+/usr/share/libtextcat/LM/german.lm			german
+/usr/share/libtextcat/LM/hungarian.lm			hungarian
 /usr/share/libtextcat/LM/italian.lm			italian
 /usr/share/libtextcat/LM/norwegian.lm			norwegian
 /usr/share/libtextcat/LM/portuguese.lm			portuguese
+/usr/share/libtextcat/LM/romanian.lm			romanian
 /usr/share/libtextcat/LM/russian-iso8859_5.lm		russian-iso8859_5
 /usr/share/libtextcat/LM/russian-koi8_r.lm		russian-koi8_r
 /usr/share/libtextcat/LM/russian-windows1251.lm		russian-windows1251
+/usr/share/libtextcat/LM/spanish.lm			spanish
 /usr/share/libtextcat/LM/swedish.lm			swedish
+/usr/share/libtextcat/LM/turkish.lm			turkish



