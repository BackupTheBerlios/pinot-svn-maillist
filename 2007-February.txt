From fabricecolin at mail.berlios.de  Thu Feb  8 16:28:52 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Thu, 8 Feb 2007 16:28:52 +0100
Subject: [Pinot-svn] r706 - in trunk: . Collect Index Monitor Search
	Search/Google Tokenize UI/GTK2/src Utils
Message-ID: <200702081528.l18FSq5Z030601@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-08 16:28:51 +0100 (Thu, 08 Feb 2007)
New Revision: 706

Modified:
   trunk/Collect/Makefile.am
   trunk/Index/Makefile.am
   trunk/Makefile.am
   trunk/Monitor/Makefile.am
   trunk/Search/Google/Makefile.am
   trunk/Search/Makefile.am
   trunk/Tokenize/Makefile.am
   trunk/UI/GTK2/src/Makefile.am
   trunk/Utils/Makefile.am
   trunk/configure.in
Log:
Added Tokenize/filters to build. Renamed gmime variables.


Modified: trunk/Collect/Makefile.am
===================================================================
--- trunk/Collect/Makefile.am	2007-01-31 13:53:44 UTC (rev 705)
+++ trunk/Collect/Makefile.am	2007-02-08 15:28:51 UTC (rev 706)
@@ -26,8 +26,8 @@
 
 pinot_collect_LDADD = -L../Utils -L../Tokenize \
 	-lCollect -lTokenize -lUtils -lBasicUtils \
-	@GLIBMM_LIBS@ @INDEX_LIBS@ @XML_LIBS@ @MIME_LIBS@ @HTTP_LIBS@ @MISC_LIBS@
+	@GLIBMM_LIBS@ @INDEX_LIBS@ @XML_LIBS@ @GMIME_LIBS@ @HTTP_LIBS@ @MISC_LIBS@
 
-AM_CXXFLAGS = -I$(srcdir)/../Utils -I$(srcdir)/../Tokenize \
-	@INDEX_CFLAGS@ @XML_CFLAGS@ @HTTP_CFLAGS@ @MIME_CFLAGS@ @GLIBMM_CFLAGS@
+AM_CXXFLAGS = -I$(srcdir)/../Utils -I$(srcdir)/../Tokenize -I$(srcdir)/../Tokenize/filters \
+	@INDEX_CFLAGS@ @XML_CFLAGS@ @HTTP_CFLAGS@ @GMIME_CFLAGS@ @GLIBMM_CFLAGS@
 

Modified: trunk/Index/Makefile.am
===================================================================
--- trunk/Index/Makefile.am	2007-01-31 13:53:44 UTC (rev 705)
+++ trunk/Index/Makefile.am	2007-02-08 15:28:51 UTC (rev 706)
@@ -2,6 +2,7 @@
 
 noinst_HEADERS = \
 	DBusXapianIndex.h \
+	FilterWrapper.h \
 	IndexFactory.h \
 	IndexInterface.h \
 	LanguageDetector.h \
@@ -15,6 +16,7 @@
 
 libIndex_la_SOURCES = \
 	DBusXapianIndex.cpp \
+	FilterWrapper.cc \
 	IndexFactory.cpp \
 	LanguageDetector.cpp \
 	XapianDatabase.cpp \
@@ -26,10 +28,10 @@
 
 pinot_index_LDADD = -L../Utils -L../Tokenize -L../Collect \
 	-lIndex -lCollect -lTokenize -lBasicUtils -lUtils \
-	@GLIBMM_LIBS@ @INDEX_LIBS@ @DBUS_LIBS@ @XML_LIBS@ @MIME_LIBS@ @HTTP_LIBS@ @MISC_LIBS@
+	@GLIBMM_LIBS@ @INDEX_LIBS@ @DBUS_LIBS@ @XML_LIBS@ @GMIME_LIBS@ @HTTP_LIBS@ @MISC_LIBS@
 
-AM_CXXFLAGS = -I$(srcdir)/../Utils -I$(srcdir)/../Tokenize -I$(srcdir)/../Collect \
-	@HTTP_CFLAGS@ @MIME_CFLAGS@ @XML_CFLAGS@ @DBUS_CFLAGS@ @INDEX_CFLAGS@
+AM_CXXFLAGS = -I$(srcdir)/../Utils -I$(srcdir)/../Tokenize -I$(srcdir)/../Tokenize/filters \
+	-I$(srcdir)/../Collect @HTTP_CFLAGS@ @GMIME_CFLAGS@ @XML_CFLAGS@ @DBUS_CFLAGS@ @INDEX_CFLAGS@
 if HAVE_TEXTCAT_CAT
 AM_CXXFLAGS += -DHAVE_TEXTCAT_CAT
 endif

Modified: trunk/Makefile.am
===================================================================
--- trunk/Makefile.am	2007-01-31 13:53:44 UTC (rev 705)
+++ trunk/Makefile.am	2007-02-08 15:28:51 UTC (rev 706)
@@ -1,8 +1,5 @@
-# generated 2005/12/14 20:48:47 SGT by fabrice at amra.dyndns.org.(none)
-# using glademm V2.6.0
 
-SUBDIRS = po Utils Tokenize SQL Collect Index @SOAP_SUBDIRS@ \
-	Search Monitor UI/GTK2/src
+SUBDIRS = po Utils Tokenize SQL Collect Index @SOAP_SUBDIRS@ Search Monitor UI/GTK2/src
 
 EXTRA_DIST = ChangeLog NEWS README TODO mkinstalldirs \
 	globalconfig.xml textcat_conf.txt textcat3_conf.txt \

Modified: trunk/Monitor/Makefile.am
===================================================================
--- trunk/Monitor/Makefile.am	2007-01-31 13:53:44 UTC (rev 705)
+++ trunk/Monitor/Makefile.am	2007-02-08 15:28:51 UTC (rev 706)
@@ -18,9 +18,9 @@
 libMonitor_la_SOURCES += INotifyMonitor.cpp
 endif
 
-AM_CXXFLAGS = -I$(srcdir)/../Utils -I$(srcdir)/../Tokenize -I$(srcdir)/../SQL \
-	-I$(srcdir)/../Collect -I$(srcdir)/../Index -I$(srcdir)/../Search \
-	@HTTP_CFLAGS@ @XML_CFLAGS@ @INDEX_CFLAGS@ @SOAP_CFLAGS@ @MIME_CFLAGS@ @SIGCPP_CFLAGS@
+AM_CXXFLAGS = -I$(srcdir)/../Utils -I$(srcdir)/../Tokenize -I$(srcdir)/../Tokenize/filters \
+	-I$(srcdir)/../SQL -I$(srcdir)/../Collect -I$(srcdir)/../Index -I$(srcdir)/../Search \
+	@HTTP_CFLAGS@ @XML_CFLAGS@ @INDEX_CFLAGS@ @SOAP_CFLAGS@ @GMIME_CFLAGS@ @SIGCPP_CFLAGS@
 if HAVE_LINUX_INOTIFY
 AM_CXXFLAGS += -DHAVE_LINUX_INOTIFY
 endif

Modified: trunk/Search/Google/Makefile.am
===================================================================
--- trunk/Search/Google/Makefile.am	2007-01-31 13:53:44 UTC (rev 705)
+++ trunk/Search/Google/Makefile.am	2007-02-08 15:28:51 UTC (rev 706)
@@ -22,6 +22,7 @@
 GAPIClientLib.cpp : GoogleSearch.h
 	soapcpp2 -n -pGAPI -I /usr/include/gsoap/import GoogleSearch.h
 
-AM_CXXFLAGS = -I../../Utils -I../../Tokenize -I../../Collect -I../../Index -I.. \
-	@HTTP_CFLAGS@ @XML_CFLAGS@ @SOAP_CFLAGS@ @INDEX_CFLAGS@ @MIME_CFLAGS@
+AM_CXXFLAGS = -I$(srcdir)/../../Utils -I$(srcdir)/../../Tokenize
+	-I$(srcdir)/../../Tokenize/filters -I../../Collect -I../../Index -I.. \
+	@HTTP_CFLAGS@ @XML_CFLAGS@ @SOAP_CFLAGS@ @INDEX_CFLAGS@ @GMIME_CFLAGS@
 

Modified: trunk/Search/Makefile.am
===================================================================
--- trunk/Search/Makefile.am	2007-01-31 13:53:44 UTC (rev 705)
+++ trunk/Search/Makefile.am	2007-02-08 15:28:51 UTC (rev 706)
@@ -45,13 +45,14 @@
 
 pinot_search_LDADD = -L../Utils -L../Tokenize -L../Collect -L../Index -LGoogle \
 	@SEARCH_LIBS@ -lIndex -lCollect -lTokenize -lUtils -lBasicUtils \
-	@GLIBMM_LIBS@ @INDEX_LIBS@ @SOAP_LIBS@ @XML_LIBS@ @MIME_LIBS@ @HTTP_LIBS@ @MISC_LIBS@
+	@GLIBMM_LIBS@ @INDEX_LIBS@ @SOAP_LIBS@ @XML_LIBS@ @GMIME_LIBS@ @HTTP_LIBS@ @MISC_LIBS@
 
 SOAPEnvC.cpp : SOAPEnv.h
 	soapcpp2 -pSOAPEnv SOAPEnv.h
 
-AM_CXXFLAGS = -I$(srcdir)/../Utils -I$(srcdir)/../Tokenize -I$(srcdir)/../Collect -I$(srcdir)/../Index -IGoogle \
-	@HTTP_CFLAGS@ @XML_CFLAGS@ @INDEX_CFLAGS@ @SOAP_CFLAGS@ @MIME_CFLAGS@ @GLIBMM_CFLAGS@
+AM_CXXFLAGS = -I$(srcdir)/../Utils -I$(srcdir)/../Tokenize -I$(srcdir)/../Tokenize/filters \
+	-I$(srcdir)/../Collect -I$(srcdir)/../Index -IGoogle \
+	@HTTP_CFLAGS@ @XML_CFLAGS@ @INDEX_CFLAGS@ @SOAP_CFLAGS@ @GMIME_CFLAGS@ @GLIBMM_CFLAGS@
 if HAVE_BOOST_SPIRIT
 AM_CXXFLAGS += -DHAVE_BOOST_SPIRIT
 endif

Modified: trunk/Tokenize/Makefile.am
===================================================================
--- trunk/Tokenize/Makefile.am	2007-01-31 13:53:44 UTC (rev 705)
+++ trunk/Tokenize/Makefile.am	2007-02-08 15:28:51 UTC (rev 706)
@@ -1,71 +1,50 @@
 # Process this file with automake to produce Makefile.in
 
 noinst_HEADERS = \
-	HtmlTokenizer.h \
-	OpenDocumentTokenizer.h \
-	PdfTokenizer.h \
-	RtfTokenizer.h \
-	TagLibTokenizer.h \
 	Tokenizer.h \
-	TokenizerFactory.h \
-	UnknownTypeTokenizer.h \
-	WordTokenizer.h \
-	XmlTokenizer.h
+	filters/ExternalFilter.h \
+	filters/HtmlFilter.h \
+	filters/GMimeMboxFilter.h \
+	filters/TagLibMusicFilter.h \
+	filters/TextFilter.h \
+	filters/Filter.h \
+	filters/FilterFactory.h \
+	filters/GMimeMboxFilter.h \
+	filters/XmlFilter.h
 
-lib_LTLIBRARIES = libopendocumenttokenizer.la libpdftokenizer.la librtftokenizer.la \
-	libwordtokenizer.la libtaglibtokenizer.la
+lib_LTLIBRARIES = libexternalfilter.la libmboxfilter.la libtaglibfilter.la
 
 noinst_LTLIBRARIES = libTokenize.la
 
-libopendocumenttokenizer_la_SOURCES = \
-	OpenDocumentTokenizer.cpp \
-	XmlTokenizer.cpp \
-	Tokenizer.cpp
+libexternalfilter_la_SOURCES = \
+	filters/ExternalFilter.cc
 
-libopendocumenttokenizer_la_LDFLAGS = -module
+libexternalfilter_la_LDFLAGS = -module @XML_CFLAGS@
 
-libopendocumenttokenizer_la_LIBADD = -L../Utils -lBasicUtils
+libexternalfilter_la_LIBADD = -L../Utils -lBasicUtils
 
-libpdftokenizer_la_SOURCES = \
-	PdfTokenizer.cpp \
-	HtmlTokenizer.cpp \
-	Tokenizer.cpp
+libmboxfilter_la_SOURCES = \
+	filters/GMimeMboxFilter.cc
 
-libpdftokenizer_la_LDFLAGS = -module
+libmboxfilter_la_LDFLAGS = -module @GMIME_CFLAGS@
 
-libpdftokenizer_la_LIBADD = -L../Utils -lBasicUtils
+libmboxfilter_la_LIBADD = -L../Utils -lBasicUtils
 
-librtftokenizer_la_SOURCES = \
-	RtfTokenizer.cpp \
-	HtmlTokenizer.cpp \
-	Tokenizer.cpp
+libtaglibfilter_la_SOURCES = \
+	filters/TagLibMusicFilter.cc
 
-librtftokenizer_la_LDFLAGS = -module
+libtaglibfilter_la_LDFLAGS = -module @TAGLIB_LIBS@
 
-librtftokenizer_la_LIBADD = -L../Utils -lBasicUtils
+libtaglibfilter_la_LIBADD = -L../Utils -lBasicUtils
 
-libwordtokenizer_la_SOURCES = \
-	WordTokenizer.cpp \
-	Tokenizer.cpp
-
-libwordtokenizer_la_LDFLAGS = -module
-
-libwordtokenizer_la_LIBADD = -L../Utils -lBasicUtils
-
-libtaglibtokenizer_la_SOURCES = \
-	TagLibTokenizer.cpp \
-	Tokenizer.cpp
-
-libtaglibtokenizer_la_LDFLAGS = -module @TAGLIB_LIBS@
-
-libtaglibtokenizer_la_LIBADD = -L../Utils -lBasicUtils
-
 libTokenize_la_SOURCES = \
-	HtmlTokenizer.cpp \
 	Tokenizer.cpp \
-	TokenizerFactory.cpp \
-	UnknownTypeTokenizer.cpp \
-	XmlTokenizer.cpp
+	filters/FilterFactory.cc \
+	filters/HtmlFilter.cc \
+	filters/TextFilter.cc \
+	filters/XmlFilter.cc
 
-AM_CXXFLAGS = -fPIC -I$(srcdir)/../Utils @XML_CFLAGS@ @TAGLIB_CFLAGS@
+AM_CXXFLAGS = -fPIC -I$(srcdir)/../Utils \
+	@GMIME_CFLAGS@ @XML_CFLAGS@ @TAGLIB_CFLAGS@ -D_DYNAMIC_DIJON_FILTERS \
+	-D_DIJON_EXTERNALFILTER_CONFFILE=\"$(sysconfdir)/pinot/external-filters.xml\"
 

Modified: trunk/UI/GTK2/src/Makefile.am
===================================================================
--- trunk/UI/GTK2/src/Makefile.am	2007-01-31 13:53:44 UTC (rev 705)
+++ trunk/UI/GTK2/src/Makefile.am	2007-02-08 15:28:51 UTC (rev 706)
@@ -75,19 +75,19 @@
 
 bin_PROGRAMS = pinot pinot-dbus-daemon
 
-AM_CXXFLAGS = -I$(top_srcdir)/Utils -I$(top_srcdir)/Tokenize -I$(top_srcdir)/SQL \
-	-I$(top_srcdir)/Monitor -I$(top_srcdir)/Collect -I$(top_srcdir)/Index \
-	-I$(top_srcdir)/Search -I$(top_srcdir)/Search/Google \
+AM_CXXFLAGS = -I$(top_srcdir)/Utils -I$(top_srcdir)/Tokenize -I$(top_srcdir)/Tokenize/filters \
+	-I$(top_srcdir)/SQL -I$(top_srcdir)/Monitor -I$(top_srcdir)/Collect \
+	-I$(top_srcdir)/Index -I$(top_srcdir)/Search -I$(top_srcdir)/Search/Google \
 	-DDBUS_GLIB_VERSION=@DBUS_GLIB_VERSION@ \
-	@SQL_CFLAGS@ @HTTP_CFLAGS@ @MIME_CFLAGS@ @XML_CFLAGS@ @SOAP_CFLAGS@ @DBUS_CFLAGS@ @INDEX_CFLAGS@ @UI_CFLAGS@
+	@SQL_CFLAGS@ @HTTP_CFLAGS@ @GMIME_CFLAGS@ @XML_CFLAGS@ @SOAP_CFLAGS@ @DBUS_CFLAGS@ @INDEX_CFLAGS@ @UI_CFLAGS@
 
 pinot_LDADD = -L$(top_srcdir)/Utils -L$(top_srcdir)/Tokenize -L$(top_srcdir)/SQL -L$(top_srcdir)/Monitor \
 	-L$(top_srcdir)/Collect -L$(top_srcdir)/Index -L$(top_srcdir)/Search -L$(top_srcdir)/Search/Google \
 	@SEARCH_LIBS@ -lIndex -lMonitor -lCollect -lSQL -lTokenize -lUtils -lBasicUtils \
-	@LIBS@ @UI_LIBS@ @INDEX_LIBS@ @DBUS_LIBS@ @SOAP_LIBS@ @XML_LIBS@ @MIME_LIBS@ @HTTP_LIBS@ @SQL_LIBS@ @MISC_LIBS@
+	@LIBS@ @UI_LIBS@ @INDEX_LIBS@ @DBUS_LIBS@ @SOAP_LIBS@ @XML_LIBS@ @GMIME_LIBS@ @HTTP_LIBS@ @SQL_LIBS@ @MISC_LIBS@
 
 pinot_dbus_daemon_LDADD = -L$(top_srcdir)/Utils -L$(top_srcdir)/Tokenize -L$(top_srcdir)/SQL -L$(top_srcdir)/Monitor \
 	-L$(top_srcdir)/Collect -L$(top_srcdir)/Index -L$(top_srcdir)/Search -L$(top_srcdir)/Search/Google \
 	@SEARCH_LIBS@ -lIndex -lMonitor -lCollect -lSQL -lTokenize -lUtils -lBasicUtils \
-	@LIBS@ @GLIBMM_LIBS@ @INDEX_LIBS@ @DBUS_LIBS@ @SOAP_LIBS@ @XML_LIBS@ @MIME_LIBS@ @HTTP_LIBS@ @SQL_LIBS@ @MISC_LIBS@
+	@LIBS@ @GLIBMM_LIBS@ @INDEX_LIBS@ @DBUS_LIBS@ @SOAP_LIBS@ @XML_LIBS@ @GMIME_LIBS@ @HTTP_LIBS@ @SQL_LIBS@ @MISC_LIBS@
 

Modified: trunk/Utils/Makefile.am
===================================================================
--- trunk/Utils/Makefile.am	2007-01-31 13:53:44 UTC (rev 705)
+++ trunk/Utils/Makefile.am	2007-02-08 15:28:51 UTC (rev 706)
@@ -48,5 +48,5 @@
 	xdgmime/xdgmimeparent.c
 
 AM_CFLAGS = -fPIC -DXDG_PREFIX=pinot_xdg
-AM_CXXFLAGS = -fPIC @HTTP_CFLAGS@ @INDEX_CFLAGS@ @MIME_CFLAGS@ @GLIBMM_CFLAGS@ -DXDG_PREFIX=pinot_xdg
+AM_CXXFLAGS = -fPIC @HTTP_CFLAGS@ @INDEX_CFLAGS@ @GMIME_CFLAGS@ @GLIBMM_CFLAGS@ -DXDG_PREFIX=pinot_xdg
 

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2007-01-31 13:53:44 UTC (rev 705)
+++ trunk/configure.in	2007-02-08 15:28:51 UTC (rev 706)
@@ -25,7 +25,7 @@
 		[the gettext domain])
 
 dnl Add the languages which your application supports here.
-ALL_LINGUAS="fr es nl sv"
+ALL_LINGUAS="fr es nl pt_BR ru sv"
 #AM_GNU_GETTEXT([external]) 
 AM_GLIB_GNU_GETTEXT
 
@@ -227,9 +227,9 @@
 HTTP_LIBS="$NEON_LIBS $SSL_LIBS $CURL_LIBS"
 AC_SUBST(HTTP_CFLAGS)
 AC_SUBST(HTTP_LIBS)
-PKG_CHECK_MODULES(MIME, gmime-2.0 >= 2.0 )
-AC_SUBST(MIME_CFLAGS)
-AC_SUBST(MIME_LIBS)
+PKG_CHECK_MODULES(GMIME, gmime-2.0 >= 2.0 )
+AC_SUBST(GMIME_CFLAGS)
+AC_SUBST(GMIME_LIBS)
 PKG_CHECK_MODULES(XML, libxml++-2.6 >= 2.12 )
 AC_SUBST(XML_CFLAGS)
 AC_SUBST(XML_LIBS)
@@ -259,8 +259,7 @@
 AC_CHECK_FUNCS(mmap)
 
 AC_OUTPUT( pinot.spec UI/GTK2/src/de.berlios.Pinot.service Makefile \
-	Utils/Makefile Tokenize/Makefile SQL/Makefile po/Makefile.in \
-	Collect/Makefile )
+	Utils/Makefile Tokenize/Makefile SQL/Makefile po/Makefile.in Collect/Makefile )
 if test "$SOAP_SUBDIRS" != "" ; then
 AC_OUTPUT( Search/Google/Makefile )
 fi



From fabricecolin at mail.berlios.de  Fri Feb  9 15:02:38 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Fri, 9 Feb 2007 15:02:38 +0100
Subject: [Pinot-svn] r707 - in trunk/Tokenize: . filters
Message-ID: <200702091402.l19E2c5I027556@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-09 15:02:37 +0100 (Fri, 09 Feb 2007)
New Revision: 707

Added:
   trunk/Tokenize/filters/
   trunk/Tokenize/filters/README
Removed:
   trunk/Tokenize/HtmlTokenizer.cpp
   trunk/Tokenize/HtmlTokenizer.h
   trunk/Tokenize/OpenDocumentTokenizer.cpp
   trunk/Tokenize/OpenDocumentTokenizer.h
   trunk/Tokenize/PdfTokenizer.cpp
   trunk/Tokenize/PdfTokenizer.h
   trunk/Tokenize/RtfTokenizer.cpp
   trunk/Tokenize/RtfTokenizer.h
   trunk/Tokenize/TagLibTokenizer.cpp
   trunk/Tokenize/TagLibTokenizer.h
   trunk/Tokenize/TokenizerFactory.cpp
   trunk/Tokenize/TokenizerFactory.h
   trunk/Tokenize/UnknownTypeTokenizer.cpp
   trunk/Tokenize/UnknownTypeTokenizer.h
   trunk/Tokenize/WordTokenizer.cpp
   trunk/Tokenize/WordTokenizer.h
   trunk/Tokenize/XmlTokenizer.cpp
   trunk/Tokenize/XmlTokenizer.h
Log:
Specialized tokenizers are replaced by Dijon's filters.


Deleted: trunk/Tokenize/HtmlTokenizer.cpp
===================================================================
--- trunk/Tokenize/HtmlTokenizer.cpp	2007-02-08 15:28:51 UTC (rev 706)
+++ trunk/Tokenize/HtmlTokenizer.cpp	2007-02-09 14:02:37 UTC (rev 707)
@@ -1,679 +0,0 @@
-/*
- *  Copyright 2005,2006 Fabrice Colin
- *
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU Library General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
- */
-
-#include <string.h>
-#include <strings.h>
-#include <sys/types.h>
-#include <libxml/xmlerror.h>
-#include <libxml/HTMLparser.h>
-#include <iostream>
-
-#include "StringManip.h"
-#include "Url.h"
-#include "XmlTokenizer.h"
-#include "HtmlTokenizer.h"
-
-using std::cout;
-using std::cerr;
-using std::endl;
-using std::string;
-using std::map;
-using std::set;
-
-static bool getInBetweenLinksText(HtmlTokenizer::ParserState *pState,
-	unsigned int currentLinkIndex)
-{
-	if (pState == NULL)
-	{
-		return false;
-	}
-
-	if ((pState->m_links.empty() == true) ||
-		(pState->m_currentLink.m_index == 0))
-	{
-		string abstract(pState->m_text);
-
-		StringManip::trimSpaces(abstract);
-
-		pState->m_abstract = abstract;
-
-		return true;
-	}
-
-	// Get the text between the current link and the previous one
-	for (set<Link>::const_iterator linkIter = pState->m_links.begin();
-		linkIter != pState->m_links.end(); ++linkIter)
-	{
-		// Is this the previous link ?
-		if (linkIter->m_index == currentLinkIndex - 1)
-		{
-			// Is there text in between ?
-			if (linkIter->m_endPos + 1 < pState->m_textPos)
-			{
-				unsigned int abstractLen = pState->m_textPos - linkIter->m_endPos - 1;
-				string abstract(pState->m_text.substr(linkIter->m_endPos, abstractLen));
-
-				StringManip::trimSpaces(abstract);
-
-				// The longer, the better
-				if (abstract.length() > pState->m_abstract.length())
-				{
-					pState->m_abstract = abstract;
-#ifdef DEBUG
-					cout << "HtmlTokenizer::getInBetweenLinksText: abstract after link "
-						<< linkIter->m_index << endl;
-#endif
-
-					return true;
-				}
-			}
-
-			break;
-		}
-	}
-
-	return false;
-}
-
-static void startHandler(void *pData, const char *pElementName, const char **pAttributes)
-{
-	if ((pData == NULL) ||
-		(pElementName == NULL) ||
-		(strlen(pElementName) == 0))
-	{
-		return;
-	}
-
-	HtmlTokenizer::ParserState *pState = (HtmlTokenizer::ParserState *)pData;
-	if (pState == NULL)
-	{
-		return;
-	}
-
-	// Reset the text hash
-	pState->m_lastHash.clear();
-
-	// What tag is this ?
-	string tagName(StringManip::toLowerCase(pElementName));
-	if ((pState->m_foundHead == false) &&
-		(tagName == "head"))
-	{
-		// Expect to find META tags and a title
-		pState->m_inHead = true;
-		// One head is enough :-)
-		pState->m_foundHead = true;
-	}
-	else if ((pState->m_inHead == true) &&
-		(tagName == "meta") &&
-		(pAttributes != NULL))
-	{
-		string metaName, metaContent;
-
-		// Get the META tag's name and content
-		for (unsigned int attrNum = 0;
-			(pAttributes[attrNum] != NULL) && (pAttributes[attrNum + 1]); attrNum += 2)
-		{
-			if (strncasecmp(pAttributes[attrNum], "name", 4) == 0)
-			{
-				metaName = pAttributes[attrNum + 1];
-			}
-			else if (strncasecmp(pAttributes[attrNum], "content", 7) == 0)
-			{
-				metaContent = pAttributes[attrNum + 1];
-			}
-			else if (strncasecmp(pAttributes[attrNum], "http-equiv", 10) == 0)
-			{
-				metaName = pAttributes[attrNum + 1];
-			}
-		}
-
-		if ((metaName.empty() == false) &&
-			(metaContent.empty() == false))
-		{
-			// Store this META tag
-			pState->m_metaTags[StringManip::toLowerCase(metaName)] = metaContent;
-		}
-	}
-	else if ((pState->m_inHead == true) &&
-		(tagName == "title"))
-	{
-		// Extract title
-		pState->m_appendToTitle = true;
-	}
-	else if (tagName == "body")
-	{
-		// Index text
-		pState->m_appendToText = true;
-	}
-	else if ((tagName == "a") &&
-		(pAttributes != NULL))
-	{
-		pState->m_currentLink.m_url.clear();
-		pState->m_currentLink.m_name.clear();
-
-		// Get the href
-		for (unsigned int attrNum = 0;
-			(pAttributes[attrNum] != NULL) && (pAttributes[attrNum + 1]); attrNum += 2)
-		{
-			if (strncasecmp(pAttributes[attrNum], "href", 4) == 0)
-			{
-				pState->m_currentLink.m_url = pAttributes[attrNum + 1];
-				break;
-			}
-		}
-
-		if (pState->m_currentLink.m_url.empty() == false)
-		{
-			// FIXME: get the NodeInfo to find out the position of this link
-			pState->m_currentLink.m_startPos = pState->m_textPos;
-
-			// Find abstract ?
-			if (pState->m_findAbstract == true)
-			{
-				getInBetweenLinksText(pState, pState->m_currentLink.m_index);
-			}
-
-			// Extract link
-			pState->m_appendToLink = true;
-		}
-	}
-	else if ((tagName == "frame") &&
-		(pAttributes != NULL))
-	{
-		Link frame;
-
-		// Get the name and source
-		for (unsigned int attrNum = 0;
-			(pAttributes[attrNum] != NULL) && (pAttributes[attrNum + 1]); attrNum += 2)
-		{
-			if (strncasecmp(pAttributes[attrNum], "name", 4) == 0)
-			{
-				frame.m_name = pAttributes[attrNum + 1];
-			}
-			else if (strncasecmp(pAttributes[attrNum], "src", 3) == 0)
-			{
-				frame.m_url = pAttributes[attrNum + 1];
-			}
-		}
-
-		if (frame.m_url.empty() == false)
-		{
-			// Store this frame
-			pState->m_frames.insert(frame);
-		}
-	}
-	else if ((tagName == "frameset") ||
-		(tagName == "script") ||
-		(tagName == "style"))
-	{
-		// Skip
-		++pState->m_skip;
-	}
-}
-
-static void endHandler(void *pData, const char *pElementName)
-{
-	if ((pData == NULL) ||
-		(pElementName == NULL) ||
-		(strlen(pElementName) == 0))
-	{
-		return;
-	}
-
-	HtmlTokenizer::ParserState *pState = (HtmlTokenizer::ParserState *)pData;
-	if (pState == NULL)
-	{
-		return;
-	}
-
-	// Reset state
-	string tagName(StringManip::toLowerCase(pElementName));
-	if (tagName == "head")
-	{
-		pState->m_inHead = false;
-	}
-	else if (tagName == "title")
-	{
-		StringManip::trimSpaces(pState->m_title);
-		StringManip::removeCharacters(pState->m_title, "\r\n");
-#ifdef DEBUG
-		cout << "HtmlTokenizer::endHandler: title is " << pState->m_title << endl;
-#endif
-		pState->m_appendToTitle = false;
-	}
-	else if (tagName == "body")
-	{
-		pState->m_appendToText = false;
-	}
-	else if (tagName == "a")
-	{
-		if (pState->m_currentLink.m_url.empty() == false)
-		{
-			StringManip::trimSpaces(pState->m_currentLink.m_name);
-			StringManip::removeCharacters(pState->m_currentLink.m_name, "\r\n");
-
-			pState->m_currentLink.m_endPos = pState->m_textPos;
-
-			// Store this link
-			pState->m_links.insert(pState->m_currentLink);
-			++pState->m_currentLink.m_index;
-		}
-
-		pState->m_appendToLink = false;
-	}
-	else if ((tagName == "frameset") ||
-		(tagName == "script") ||
-		(tagName == "style"))
-	{
-		--pState->m_skip;
-	}
-}
-
-static void charactersHandler(void *pData, const char *pText, int textLen)
-{
-	if ((pData == NULL) ||
-		(pText == NULL) ||
-		(textLen == 0))
-	{
-		return;
-	}
-
-	HtmlTokenizer::ParserState *pState = (HtmlTokenizer::ParserState *)pData;
-	if (pState == NULL)
-	{
-		return;
-	}
-
-	if (pState->m_skip > 0)
-	{
-		// Skip this
-		return;
-	}
-
-	string text(pText, textLen);
-
-	// For some reason, this handler might be called twice for the same text !
-	// See http://mail.gnome.org/archives/xml/2002-September/msg00089.html
-	string textHash(StringManip::hashString(text));
-	if (pState->m_lastHash == textHash)
-	{
-		// Ignore this
-		return;
-	}
-	pState->m_lastHash = textHash;
-
-	// Append current text
-	// FIXME: convert to UTF-8 or Latin 1 ?
-	if (pState->m_appendToTitle == true)
-	{
-		pState->m_title += text;
-	}
-	else
-	{
-		if (pState->m_appendToText == true)
-		{
-			pState->m_text += text;
-			pState->m_textPos += textLen;
-		}
-
-		// Appending to text and to link are not mutually exclusive operations
-		if (pState->m_appendToLink == true)
-		{
-			pState->m_currentLink.m_name += text;
-		}
-	}
-}
-
-static void cDataHandler(void *pData, const char *pText, int textLen)
-{
-	// Nothing to do
-}
-
-static void whitespaceHandler(void *pData, const xmlChar *pText, int txtLen)
-{
-	if (pData == NULL)
-	{
-		return;
-	}
-
-	HtmlTokenizer::ParserState *pState = (HtmlTokenizer::ParserState *)pData;
-	if (pState == NULL)
-	{
-		return;
-	}
-
-	if (pState->m_skip > 0)
-	{
-		// Skip this
-		return;
-	}
-
-	// Append a single space
-	if (pState->m_appendToTitle == true)
-	{
-		pState->m_title += " ";
-	}
-	else
-	{
-		if (pState->m_appendToText == true)
-		{
-			pState->m_text += " ";
-		}
-
-		// Appending to text and to link are not mutually exclusive operations
-		if (pState->m_appendToLink == true)
-		{
-			pState->m_currentLink.m_name += " ";
-		}
-	}
-}
-
-static void commentHandler(void *pData, const char *pText)
-{
-	// FIXME: take comments into account, eg on terms position ?
-}
-
-static void errorHandler(void *pData, const char *pMsg, ...)
-{
-	if (pData == NULL)
-	{
-		return;
-	}
-
-	HtmlTokenizer::ParserState *pState = (HtmlTokenizer::ParserState *)pData;
-	if (pState == NULL)
-	{
-		return;
-	}
-
-	va_list args;
-	char pErr[1000];
-
-	va_start(args, pMsg);
-	vsnprintf(pErr, 1000, pMsg, args );
-	va_end(args);
-#ifdef DEBUG
-	cout << "HtmlTokenizer::errorHandler: " << pErr << endl;
-#endif
-
-	// Be lenient as much as possible
-	xmlResetLastError();
-	// ...but remember the document had errors
-	pState->m_isValid = false;
-}
-
-static void warningHandler(void *pData, const char *pMsg, ...)
-{
-	va_list args;
-	char pErr[1000];
-
-	va_start(args, pMsg);
-	vsnprintf(pErr, 1000, pMsg, args );
-	va_end(args);
-#ifdef DEBUG
-	cout << "HtmlTokenizer::warningHandler: " << pErr << endl;
-#endif
-}
-
-Link::Link() :
-	m_index(0),
-	m_startPos(0),
-	m_endPos(0)
-{
-}
-
-Link::Link(const Link &other) :
-	m_url(other.m_url),
-	m_name(other.m_name),
-	m_index(other.m_index),
-	m_startPos(other.m_startPos),
-	m_endPos(other.m_endPos)
-{
-}
-
-Link::~Link()
-{
-}
-
-Link& Link::operator=(const Link& other)
-{
-	if (this != &other)
-	{
-		m_url = other.m_url;
-		m_name = other.m_name;
-		m_index = other.m_index;
-		m_startPos = other.m_startPos;
-		m_endPos = other.m_endPos;
-	}
-
-	return *this;
-}
-
-bool Link::operator==(const Link &other) const
-{
-	return m_url == other.m_url;
-}
-
-bool Link::operator<(const Link &other) const
-{
-	return m_index < other.m_index;
-}
-
-HtmlTokenizer::ParserState::ParserState() :
-	m_isValid(true),
-	m_findAbstract(false),
-	m_textPos(0),
-	m_inHead(false),
-	m_foundHead(false),
-	m_appendToTitle(false),
-	m_appendToText(false),
-	m_appendToLink(false),
-	m_skip(0)
-{
-}
-
-HtmlTokenizer::ParserState::~ParserState()
-{
-}
-
-HtmlTokenizer::HtmlTokenizer(const Document *pDocument,
-	bool validateOnly, bool findAbstract) :
-	Tokenizer(NULL),
-	m_pStrippedDocument(NULL)
-{
-	if (validateOnly == true)
-	{
-		// This will ensure text is skipped
-		++m_state.m_skip;
-	}
-	else
-	{
-		// Attempt to find an abstract ?
-		m_state.m_findAbstract = findAbstract;
-	}
-
-	if (parseHTML(pDocument) == true)
-	{
-		// Did we find a title ?
-		if (m_state.m_title.empty() == true)
-		{
-			m_state.m_title = pDocument->getTitle();
-		}
-
-		// Pass the result to the parent class
-		m_pStrippedDocument = new Document(m_state.m_title,
-			pDocument->getLocation(), pDocument->getType(),
-			pDocument->getLanguage());
-		m_pStrippedDocument->setData(m_state.m_text.c_str(), m_state.m_text.length());
-		m_pStrippedDocument->setTimestamp(pDocument->getTimestamp());
-		m_pStrippedDocument->setSize(pDocument->getSize());
-
-		setDocument(m_pStrippedDocument);
-	}
-}
-
-HtmlTokenizer::~HtmlTokenizer()
-{
-	if (m_pStrippedDocument != NULL)
-	{
-		delete m_pStrippedDocument;
-	}
-}
-
-void HtmlTokenizer::initialize(void)
-{
-	xmlInitParser();
-}
-
-void HtmlTokenizer::shutdown(void)
-{
-	xmlCleanupParser();
-}
-
-bool HtmlTokenizer::parseHTML(const Document *pDocument)
-{
-	if (pDocument == NULL)
-	{
-		return false;
-	}
-
-	unsigned int dataLength = 0;
-	const char *pData = pDocument->getData(dataLength);
-	if ((pData == NULL) ||
-		(dataLength == 0))
-	{
-#ifdef DEBUG
-		cout << "HtmlTokenizer::parseHTML: no input" << endl;
-#endif
-		return false;
-	}
-
-	string htmlChunk(pData, dataLength);
-	htmlSAXHandler saxHandler;
-
-	// Setup the SAX handler
-	memset((void*)&saxHandler, 0, sizeof(htmlSAXHandler));
-	saxHandler.startElement = (startElementSAXFunc)&startHandler;
-	saxHandler.endElement = (endElementSAXFunc)&endHandler;
-	saxHandler.characters = (charactersSAXFunc)&charactersHandler;
-	saxHandler.cdataBlock = (charactersSAXFunc)&cDataHandler;
-	saxHandler.ignorableWhitespace = (ignorableWhitespaceSAXFunc)&whitespaceHandler;
-	saxHandler.comment = (commentSAXFunc)&commentHandler;
-	saxHandler.fatalError = (fatalErrorSAXFunc)&errorHandler;
-	saxHandler.error = (errorSAXFunc)&errorHandler;
-	saxHandler.warning = (warningSAXFunc)&warningHandler;
-
-	// Try to cope with pages that have scripts or other rubbish prepended
-	string::size_type htmlPos = htmlChunk.find("<!DOCTYPE");
-	if (htmlPos == string::npos)
-	{
-		htmlPos = htmlChunk.find("<!doctype");
-	}
-	if ((htmlPos != string::npos) &&
-		(htmlPos > 0))
-	{
-		htmlChunk.erase(0, htmlPos);
-#ifdef DEBUG
-		cout << "HtmlTokenizer::parseHTML: removed " << htmlPos << " characters" << endl;
-#endif
-	}
-
-#if 1
-#ifdef DEBUG
-	cout << "HtmlTokenizer::parseHTML: " << pDocument->getLocation() << endl;
-#endif
-	htmlParserCtxtPtr pContext = htmlCreatePushParserCtxt(&saxHandler, (void*)&m_state,
-		htmlChunk.c_str(), (int)htmlChunk.length(), "", XML_CHAR_ENCODING_NONE);
-	if (pContext != NULL)
-	{
-		xmlCtxtUseOptions(pContext, 0);
-
-		// Parse
-		htmlParseChunk(pContext, htmlChunk.c_str(), (int)htmlChunk.length(), 0);
-
-		// Free
-		htmlParseChunk(pContext, htmlChunk.c_str(), 0, 1);
-		xmlDocPtr pDoc = pContext->myDoc;
-		int ret = pContext->wellFormed;
-		xmlFreeParserCtxt(pContext);
-		if (!ret)
-		{
-#ifdef DEBUG
-			cout << "HtmlTokenizer::parseHTML: freeing document" << endl;
-#endif
-			xmlFreeDoc(pDoc);
-		}
-	}
-#else
-	htmlDocPtr pDoc = htmlSAXParseDoc((xmlChar *)htmlChunk.c_str(), "", &saxHandler, (void*)&m_state);
-	if (pDoc != NULL)
-	{
-		xmlFreeDoc(pDoc);
-	}
-#endif
-	else
-	{
-		cerr << "Couldn't create HTML parser" << endl;
-	}
-
-	// The text after the last link might make a good abstract
-	if (m_state.m_findAbstract == true)
-	{
-		getInBetweenLinksText(&m_state, m_state.m_currentLink.m_index);
-	}
-
-	// Append META keywords, if any were found
-	m_state.m_text += getMetaTag("keywords");
-
-	return true;
-}
-
-/// Determines whether the document is properly formed.
-bool HtmlTokenizer::isDocumentValid(void) const
-{
-	return m_state.m_isValid;
-}
-
-/// Gets the specified META tag content.
-string HtmlTokenizer::getMetaTag(const string &name) const
-{
-	if (name.empty() == true)
-	{
-		return "";
-	}
-
-	map<string, string>::const_iterator iter = m_state.m_metaTags.find(StringManip::toLowerCase(name));
-	if (iter != m_state.m_metaTags.end())
-	{
-		return iter->second;
-	}
-
-	return "";
-}
-
-/// Gets the links map.
-set<Link> &HtmlTokenizer::getLinks(void)
-{
-	return m_state.m_links;
-}
-
-/// Gets the abstract.
-std::string HtmlTokenizer::getAbstract(void) const
-{
-	return m_state.m_abstract;
-}

Deleted: trunk/Tokenize/HtmlTokenizer.h
===================================================================
--- trunk/Tokenize/HtmlTokenizer.h	2007-02-08 15:28:51 UTC (rev 706)
+++ trunk/Tokenize/HtmlTokenizer.h	2007-02-09 14:02:37 UTC (rev 707)
@@ -1,109 +0,0 @@
-/*
- *  Copyright 2005,2006 Fabrice Colin
- *
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU Library General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
- */
-
-#ifndef _HTML_TOKENIZER_H
-#define _HTML_TOKENIZER_H
-
-#include <string>
-#include <map>
-#include <utility>
-#include <set>
-
-#include "Document.h"
-#include "Tokenizer.h"
-
-/// A link in an HTML page.
-class Link
-{
-	public:
-		Link();
-		Link(const Link &other);
-		~Link();
-
-		Link& operator=(const Link& other);
-		bool operator==(const Link &other) const;
-		bool operator<(const Link &other) const;
-
-		std::string m_url;
-		std::string m_name;
-		unsigned int m_index;
-		unsigned int m_startPos;
-		unsigned int m_endPos;
-
-};
-
-/// Tokenizer for HTML.
-class HtmlTokenizer : public Tokenizer
-{
-	public:
-		HtmlTokenizer(const Document *pDocument,
-			bool validateOnly, bool findAbstract = false);
-		virtual ~HtmlTokenizer();
-
-		/// Initializes the HTML tokenizer.
-		static void initialize(void);
-
-		/// Shutdowns the HTML tokenizer.
-		static void shutdown(void);
-
-		/// Determines whether the document is properly formed.
-		bool isDocumentValid(void) const;
-
-		/// Gets the specified META tag content; an empty string if it wasn't found.
-		std::string getMetaTag(const std::string &name) const;
-
-		/// Gets the links map.
-		std::set<Link> &getLinks(void);
-
-		/// Gets the abstract.
-		std::string getAbstract(void) const;
-
-		class ParserState
-		{
-			public:
-				ParserState();
-				~ParserState();
-
-				bool m_isValid;
-				bool m_findAbstract;
-				unsigned int m_textPos;
-				std::string m_lastHash;
-				bool m_inHead;
-				bool m_foundHead;
-				bool m_appendToTitle;
-				bool m_appendToText;
-				bool m_appendToLink;
-				unsigned int m_skip;
-				std::string m_title;
-				std::string m_text;
-				std::string m_abstract;
-				Link m_currentLink;
-				std::set<Link> m_links;
-				std::set<Link> m_frames;
-				std::map<std::string, std::string> m_metaTags;
-		};
-
-	protected:
-		ParserState m_state;
-		Document *m_pStrippedDocument;
-
-		bool parseHTML(const Document *pDocument);
-
-};
-
-#endif // _HTML_TOKENIZER_H

Deleted: trunk/Tokenize/OpenDocumentTokenizer.cpp
===================================================================
--- trunk/Tokenize/OpenDocumentTokenizer.cpp	2007-02-08 15:28:51 UTC (rev 706)
+++ trunk/Tokenize/OpenDocumentTokenizer.cpp	2007-02-09 14:02:37 UTC (rev 707)
@@ -1,105 +0,0 @@
-/*
- *  Copyright 2005,2006 Fabrice Colin
- *
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU Library General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
- */
-
-#include <string.h>
-#include <iostream>
-
-#include "OpenDocumentTokenizer.h"
-
-using std::string;
-using std::set;
-
-/// This returns the MIME types supported by the library's tokenizer.
-bool getTokenizerTypes(set<string> &types)
-{
-	types.clear();
-	types.insert("application/vnd.sun.xml.writer");
-	types.insert("application/vnd.sun.xml.writer.template");
-	types.insert("application/vnd.sun.xml.calc");
-	types.insert("application/vnd.sun.xml.calc.template");
-	types.insert("application/vnd.sun.xml.draw");
-	types.insert("application/vnd.sun.xml.draw.template");
-	types.insert("application/vnd.sun.xml.impress");
-	types.insert("application/vnd.sun.xml.impress.template");
-	types.insert("application/vnd.sun.xml.writer.global");
-	types.insert("application/vnd.sun.xml.math");
-	types.insert("application/vnd.oasis.opendocument.chart");
-	types.insert("application/vnd.oasis.opendocument.database");
-	types.insert("application/vnd.oasis.opendocument.formula");
-	types.insert("application/vnd.oasis.opendocument.graphics");
-	types.insert("application/vnd.oasis.opendocument.graphics-template");
-	types.insert("application/vnd.oasis.opendocument.image");
-	types.insert("application/vnd.oasis.opendocument.presentation");
-	types.insert("application/vnd.oasis.opendocument.presentation-template");
-	types.insert("application/vnd.oasis.opendocument.spreadsheet");
-	types.insert("application/vnd.oasis.opendocument.spreadsheet-template");
-	types.insert("application/vnd.oasis.opendocument.text");
-	types.insert("application/vnd.oasis.opendocument.text-master");
-	types.insert("application/vnd.oasis.opendocument.text-template");
-	types.insert("application/vnd.oasis.opendocument.text-web");
-
-	return true;
-}
-
-/// This returns the data needs of the provided Tokenizer(s).
-int getTokenizerDataNeeds(void)
-{
-	return Tokenizer::ALL_BUT_FILES;
-}
-
-/// This returns a pointer to a Tokenizer, allocated with new.
-Tokenizer *getTokenizer(const Document *pDocument)
-{
-	return new OpenDocumentTokenizer(pDocument);
-}
-
-OpenDocumentTokenizer::OpenDocumentTokenizer(const Document *pDocument) :
-	XmlTokenizer(NULL)
-{
-	Document *pXmlDocument = runHelperProgram(pDocument, "unzip -p", "content.xml");
-	if (pXmlDocument != NULL)
-	{
-		unsigned int length = 0;
-		const char *data = pXmlDocument->getData(length);
-
-		if ((data != NULL) &&
-			(length > 0))
-		{
-			// Remove XML tags
-			string strippedData = parseXML(data);
-
-			// Pass the result to the parent class
-			m_pStrippedDocument = new Document(pDocument->getTitle(),
-				pDocument->getLocation(), pDocument->getType(),
-				pDocument->getLanguage());
-			m_pStrippedDocument->setData(strippedData.c_str(), strippedData.length());
-			m_pStrippedDocument->setTimestamp(pDocument->getTimestamp());
-			m_pStrippedDocument->setSize(pDocument->getSize());
-
-			setDocument(m_pStrippedDocument);
-		}
-
-		delete pXmlDocument;
-	}
-	// FIXME: unzip meta.xml and extract document information
-}
-
-OpenDocumentTokenizer::~OpenDocumentTokenizer()
-{
-	// ~XmlTokenizer will delete m_pStrippedDocument
-}

Deleted: trunk/Tokenize/OpenDocumentTokenizer.h
===================================================================
--- trunk/Tokenize/OpenDocumentTokenizer.h	2007-02-08 15:28:51 UTC (rev 706)
+++ trunk/Tokenize/OpenDocumentTokenizer.h	2007-02-09 14:02:37 UTC (rev 707)
@@ -1,48 +0,0 @@
-/*
- *  Copyright 2005,2006 Fabrice Colin
- *
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU Library General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
- */
-
-#ifndef _OPENDOCUMENT_TOKENIZER_H
-#define _OPENDOCUMENT_TOKENIZER_H
-
-#include <string>
-#include <set>
-
-#include "Document.h"
-#include "XmlTokenizer.h"
-
-/// This returns the MIME types supported by the library's tokenizer.
-bool getTokenizerTypes(std::set<std::string> &types);
-/// This returns the data needs of the provided Tokenizer(s).
-int getTokenizerDataNeeds(void);
-/// This returns a pointer to a Tokenizer, allocated with new.
-Tokenizer *getTokenizer(const Document *pDocument);
-
-/// A tokenizer for OpenDocument and other OpenOffice.org file formats.
-class OpenDocumentTokenizer : public XmlTokenizer
-{
-	public:
-		OpenDocumentTokenizer(const Document *pDocument);
-		virtual ~OpenDocumentTokenizer();
-
-	private:
-		OpenDocumentTokenizer(const OpenDocumentTokenizer &other);
-		OpenDocumentTokenizer& operator=(const OpenDocumentTokenizer& other);
-
-};
-
-#endif // _OPENDOCUMENT_TOKENIZER_H

Deleted: trunk/Tokenize/PdfTokenizer.cpp
===================================================================
--- trunk/Tokenize/PdfTokenizer.cpp	2007-02-08 15:28:51 UTC (rev 706)
+++ trunk/Tokenize/PdfTokenizer.cpp	2007-02-09 14:02:37 UTC (rev 707)
@@ -1,74 +0,0 @@
-/*
- *  Copyright 2005,2006 Fabrice Colin
- *
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU Library General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
- */
-
-#include <string.h>
-#include <iostream>
-
-#include "PdfTokenizer.h"
-
-using std::string;
-using std::set;
-
-/// This returns the MIME types supported by the library's tokenizer.
-bool getTokenizerTypes(set<string> &types)
-{
-	types.clear();
-	types.insert("application/pdf");
-
-	return true;
-}
-
-/// This returns the data needs of the provided Tokenizer(s).
-int getTokenizerDataNeeds(void)
-{
-	return Tokenizer::ALL_BUT_FILES;
-}
-
-/// This returns a pointer to a Tokenizer, allocated with new.
-Tokenizer *getTokenizer(const Document *pDocument)
-{
-	return new PdfTokenizer(pDocument);
-}
-
-PdfTokenizer::PdfTokenizer(const Document *pDocument) :
-	HtmlTokenizer(NULL, false)
-{
-	Document *pHtmlDocument = runHelperProgram(pDocument, "pdftotext -htmlmeta", "-");
-	if (pHtmlDocument != NULL)
-	{
-		if (parseHTML(pHtmlDocument) == true)
-		{
-			// Pass the result to the parent class
-			m_pStrippedDocument = new Document(pHtmlDocument->getTitle(),
-				pHtmlDocument->getLocation(), pHtmlDocument->getType(),
-				pHtmlDocument->getLanguage());
-			m_pStrippedDocument->setData(m_state.m_text.c_str(), m_state.m_text.length());
-			m_pStrippedDocument->setTimestamp(pHtmlDocument->getTimestamp());
-			m_pStrippedDocument->setSize(pHtmlDocument->getSize());
-
-			setDocument(m_pStrippedDocument);
-		}
-
-		delete pHtmlDocument;
-	}
-}
-
-PdfTokenizer::~PdfTokenizer()
-{
-	// ~HtmlTokenizer will delete m_pStrippedDocument
-}

Deleted: trunk/Tokenize/PdfTokenizer.h
===================================================================
--- trunk/Tokenize/PdfTokenizer.h	2007-02-08 15:28:51 UTC (rev 706)
+++ trunk/Tokenize/PdfTokenizer.h	2007-02-09 14:02:37 UTC (rev 707)
@@ -1,48 +0,0 @@
-/*
- *  Copyright 2005,2006 Fabrice Colin
- *
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU Library General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
- */
-
-#ifndef _PDF_TOKENIZER_H
-#define _PDF_TOKENIZER_H
-
-#include <string>
-#include <set>
-
-#include "Document.h"
-#include "HtmlTokenizer.h"
-
-/// This returns the MIME types supported by the library's tokenizer.
-bool getTokenizerTypes(std::set<std::string> &types);
-/// This returns the data needs of the provided Tokenizer(s).
-int getTokenizerDataNeeds(void);
-/// This returns a pointer to a Tokenizer, allocated with new.
-Tokenizer *getTokenizer(const Document *pDocument);
-
-/// PDF tokenizer.
-class PdfTokenizer : public HtmlTokenizer
-{
-	public:
-		PdfTokenizer(const Document *pDocument);
-		virtual ~PdfTokenizer();
-
-	private:
-		PdfTokenizer(const PdfTokenizer &other);
-		PdfTokenizer& operator=(const PdfTokenizer& other);
-
-};
-
-#endif // _PDF_TOKENIZER_H

Deleted: trunk/Tokenize/RtfTokenizer.cpp
===================================================================
--- trunk/Tokenize/RtfTokenizer.cpp	2007-02-08 15:28:51 UTC (rev 706)
+++ trunk/Tokenize/RtfTokenizer.cpp	2007-02-09 14:02:37 UTC (rev 707)
@@ -1,75 +0,0 @@
-/*
- *  Copyright 2005,2006 Fabrice Colin
- *
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU Library General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
- */
-
-#include <string.h>
-#include <iostream>
-
-#include "RtfTokenizer.h"
-
-using std::string;
-using std::set;
-
-/// This returns the MIME types supported by the library's tokenizer.
-bool getTokenizerTypes(set<string> &types)
-{
-	types.clear();
-	types.insert("text/rtf");
-	types.insert("application/rtf");
-
-	return true;
-}
-
-/// This returns the data needs of the provided Tokenizer(s).
-int getTokenizerDataNeeds(void)
-{
-	return Tokenizer::ALL_BUT_FILES;
-}
-
-/// This returns a pointer to a Tokenizer, allocated with new.
-Tokenizer *getTokenizer(const Document *pDocument)
-{
-	return new RtfTokenizer(pDocument);
-}
-
-RtfTokenizer::RtfTokenizer(const Document *pDocument) :
-	HtmlTokenizer(NULL, false)
-{
-	Document *pHtmlDocument = runHelperProgram(pDocument, "unrtf --nopict --html");
-	if (pHtmlDocument != NULL)
-	{
-		if (parseHTML(pHtmlDocument) == true)
-		{
-			// Pass the result to the parent class
-			m_pStrippedDocument = new Document(pHtmlDocument->getTitle(),
-				pHtmlDocument->getLocation(), pHtmlDocument->getType(),
-				pHtmlDocument->getLanguage());
-			m_pStrippedDocument->setData(m_state.m_text.c_str(), m_state.m_text.length());
-			m_pStrippedDocument->setTimestamp(pHtmlDocument->getTimestamp());
-			m_pStrippedDocument->setSize(pHtmlDocument->getSize());
-
-			setDocument(m_pStrippedDocument);
-		}
-
-		delete pHtmlDocument;
-	}
-}
-
-RtfTokenizer::~RtfTokenizer()
-{
-	// ~HtmlTokenizer will delete m_pStrippedDocument
-}

Deleted: trunk/Tokenize/RtfTokenizer.h
===================================================================
--- trunk/Tokenize/RtfTokenizer.h	2007-02-08 15:28:51 UTC (rev 706)
+++ trunk/Tokenize/RtfTokenizer.h	2007-02-09 14:02:37 UTC (rev 707)
@@ -1,49 +0,0 @@
-/*
- *  Copyright 2005,2006 Fabrice Colin
- *
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU Library General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
- */
-
-#ifndef _RTF_TOKENIZER_H
-#define _RTF_TOKENIZER_H
-
-#include <string>
-#include <set>
-
-#include "Document.h"
-#include "HtmlTokenizer.h"
-
-/// This returns the MIME types supported by the library's tokenizer.
-bool getTokenizerTypes(std::set<std::string> &types);
-/// This returns the data needs of the provided Tokenizer(s).
-int getTokenizerDataNeeds(void);
-/// This returns a pointer to a Tokenizer, allocated with new.
-Tokenizer *getTokenizer(const Document *pDocument);
-
-/// Rich Text Format tokenizer.
-class RtfTokenizer : public HtmlTokenizer
-{
-	public:
-		RtfTokenizer(const Document *pDocument);
-		virtual ~RtfTokenizer();
-
-	protected:
-		RtfTokenizer();
-		RtfTokenizer(const RtfTokenizer &other);
-		RtfTokenizer& operator=(const RtfTokenizer& other);
-
-};
-
-#endif // _RTF_TOKENIZER_H

Deleted: trunk/Tokenize/TagLibTokenizer.cpp
===================================================================
--- trunk/Tokenize/TagLibTokenizer.cpp	2007-02-08 15:28:51 UTC (rev 706)
+++ trunk/Tokenize/TagLibTokenizer.cpp	2007-02-09 14:02:37 UTC (rev 707)
@@ -1,151 +0,0 @@
-/*
- *  Copyright 2005,2006 Fabrice Colin
- *
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU Library General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
- */
-
-#include <string.h>
-#include <iostream>
-
-#include <fileref.h>
-#include <tfile.h>
-#include <tag.h>
-
-#include "Url.h"
-#include "TagLibTokenizer.h"
-
-using std::string;
-using std::set;
-
-/// This returns the MIME types supported by the library's tokenizer.
-bool getTokenizerTypes(set<string> &types)
-{
-	types.clear();
-	types.insert("audio/mpeg");
-	types.insert("audio/x-mp3");
-	types.insert("application/ogg");
-	types.insert("audio/x-flac+ogg");
-	types.insert("audio/x-flac");
-
-	return true;
-}
-
-/// This returns the data needs of the provided Tokenizer(s).
-int getTokenizerDataNeeds(void)
-{
-	return Tokenizer::ALL_BUT_FILES;
-}
-
-/// This returns a pointer to a Tokenizer, allocated with new.
-Tokenizer *getTokenizer(const Document *pDocument)
-{
-	return new TagLibTokenizer(pDocument);
-}
-
-TagLibTokenizer::TagLibTokenizer(const Document *pDocument) :
-	Tokenizer(NULL),
-	m_pTagDocument(NULL)
-{
-	if (pDocument != NULL)
-	{
-		Url urlObj(pDocument->getLocation());
-		string location;
-		unsigned int dataLength = 0;
-		const char *pData = pDocument->getData(dataLength);
-		char inTemplate[15] = "/tmp/tokXXXXXX";
-		bool deleteInFile = false;
-
-		// Is this a file ?
-		if ((urlObj.getProtocol() == "file") &&
-			(urlObj.getFile().empty() == false))
-		{
-			location = urlObj.getLocation();
-			location += "/";
-			location += urlObj.getFile();
-		}
-		else
-		{
-			int inFd = mkstemp(inTemplate);
-			if (inFd != -1)
-			{
-				// Save the data into a temporary file
-				if (write(inFd, (const void*)pData, dataLength) != -1)
-				{
-					location = inTemplate;
-				}
-
-				deleteInFile = true;
-				close(inFd);
-			}
-		}
-
-		if (location.empty() == false)
-		{
-			TagLib::FileRef fileRef(location.c_str(), false);
-			string trackTitle, pseudoContent;
-
-			if (fileRef.isNull() == false)
-			{
-				TagLib::Tag *pTag = fileRef.tag();
-				if ((pTag != NULL) &&
-					(pTag->isEmpty() == false))
-				{
-					char yearStr[64];
-
-					trackTitle = pTag->title().to8Bit(); 
-					trackTitle += " ";
-					trackTitle += pTag->artist().to8Bit();
-
-					pseudoContent = trackTitle;
-					pseudoContent += " ";
-					pseudoContent += pTag->album().to8Bit();
-					pseudoContent += " ";
-					pseudoContent += pTag->comment().to8Bit();
-					pseudoContent += " ";
-					pseudoContent += pTag->genre().to8Bit();
-					snprintf(yearStr, 64, " %u", pTag->year());
-					pseudoContent += yearStr;
-				}
-			}
-			else
-			{
-				trackTitle = pseudoContent = pDocument->getTitle();
-			}
-
-			m_pTagDocument = new Document(trackTitle, pDocument->getLocation(),
-				pDocument->getType(), pDocument->getLanguage());
-			m_pTagDocument->setData(pseudoContent.c_str(), pseudoContent.length());
-			m_pTagDocument->setTimestamp(pDocument->getTimestamp());
-			m_pTagDocument->setSize(pDocument->getSize());
-
-			// Give the result to the parent class
-			setDocument(m_pTagDocument);
-		}
-
-		// Delete the temporary file ?
-		if (deleteInFile == true)
-		{
-			unlink(inTemplate);
-		}
-	}
-}
-
-TagLibTokenizer::~TagLibTokenizer()
-{
-	if (m_pTagDocument != NULL)
-	{
-		delete m_pTagDocument;
-	}
-}

Deleted: trunk/Tokenize/TagLibTokenizer.h
===================================================================
--- trunk/Tokenize/TagLibTokenizer.h	2007-02-08 15:28:51 UTC (rev 706)
+++ trunk/Tokenize/TagLibTokenizer.h	2007-02-09 14:02:37 UTC (rev 707)
@@ -1,51 +0,0 @@
-/*
- *  Copyright 2005,2006 Fabrice Colin
- *
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU Library General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
- */
-
-#ifndef _TAGLIB_TOKENIZER_H
-#define _TAGLIB_TOKENIZER_H
-
-#include <string>
-#include <set>
-
-#include "Document.h"
-#include "Tokenizer.h"
-
-/// This returns the MIME types supported by the library's tokenizer.
-bool getTokenizerTypes(std::set<std::string> &types);
-/// This returns the data needs of the provided Tokenizer(s).
-int getTokenizerDataNeeds(void);
-/// This returns a pointer to a Tokenizer, allocated with new.
-Tokenizer *getTokenizer(const Document *pDocument);
-
-/// Taglib-based tokenizer for MP3, OOgg Vorbis etc...
-class TagLibTokenizer : public Tokenizer
-{
-	public:
-		TagLibTokenizer(const Document *pDocument);
-		virtual ~TagLibTokenizer();
-
-	protected:
-		Document *m_pTagDocument;
-
-	private:
-		TagLibTokenizer(const TagLibTokenizer &other);
-		TagLibTokenizer& operator=(const TagLibTokenizer& other);
-
-};
-
-#endif // _TAGLIB_TOKENIZER_H

Deleted: trunk/Tokenize/TokenizerFactory.cpp
===================================================================
--- trunk/Tokenize/TokenizerFactory.cpp	2007-02-08 15:28:51 UTC (rev 706)
+++ trunk/Tokenize/TokenizerFactory.cpp	2007-02-09 14:02:37 UTC (rev 707)
@@ -1,354 +0,0 @@
-/*
- *  Copyright 2005,2006 Fabrice Colin
- *
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU Library General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
- */
-
-#include <ctype.h>
-#include <sys/types.h>
-#include <sys/stat.h>
-#include <dirent.h>
-#include <stdlib.h>
-#include <unistd.h>
-#include <strings.h>
-#include <dlfcn.h>
-#include <iostream>
-
-#include "MIMEScanner.h"
-#include "Tokenizer.h"
-#include "HtmlTokenizer.h"
-#include "UnknownTypeTokenizer.h"
-#include "XmlTokenizer.h"
-#include "Url.h"
-#include "TokenizerFactory.h"
-
-#ifdef __CYGWIN__
-#define DLOPEN_FLAGS RTLD_LAZY
-#else
-#define DLOPEN_FLAGS (RTLD_LAZY|RTLD_LOCAL)
-#endif
-
-#define GETTOKENIZERTYPES	"_Z17getTokenizerTypesRSt3setISsSt4lessISsESaISsEE"
-#define GETTOKENIZERDATANEEDS	"_Z21getTokenizerDataNeedsv"
-#define GETTOKENIZER		"_Z12getTokenizerPK8Document"
-
-using std::cout;
-using std::cerr;
-using std::endl;
-using std::string;
-using std::map;
-using std::set;
-
-map<string, string> TokenizerFactory::m_types;
-map<string, void *> TokenizerFactory::m_handles;
-map<string, Tokenizer::DataNeeds> TokenizerFactory::m_dataNeeds;
-
-TokenizerFactory::TokenizerFactory()
-{
-}
-
-TokenizerFactory::~TokenizerFactory()
-{
-}
-
-Tokenizer *TokenizerFactory::getLibraryTokenizer(const string &type, const Document *pDocument)
-{
-	void *pHandle = NULL;
-
-	if (m_handles.empty() == true)
-	{
-#ifdef DEBUG
-		cout << "TokenizerFactory::getLibraryTokenizer: no libraries" << endl;
-#endif
-		return NULL;
-	}
-
-	map<string, string>::iterator typeIter = m_types.find(type);
-	if (typeIter == m_types.end())
-	{
-		// We don't know about this type
-		return NULL;
-	}
-	map<string, void *>::iterator handleIter = m_handles.find(typeIter->second);
-	if (handleIter == m_handles.end())
-	{
-		// We don't know about this library
-		return NULL;
-	}
-	pHandle = handleIter->second;
-	if (pHandle == NULL)
-	{
-		return NULL;
-	}
-
-	// Get a tokenizer object then
-	getTokenizerFunc *pFunc = (getTokenizerFunc *)dlsym(pHandle,
-		GETTOKENIZER);
-	if (pFunc != NULL)
-	{
-		return (*pFunc)(pDocument);
-	}
-#ifdef DEBUG
-	cout << "TokenizerFactory::getLibraryTokenizer: couldn't find export getTokenizer" << endl;
-#endif
-
-	return NULL;
-}
-
-/// Loads the tokenizer libraries in the given directory.
-unsigned int TokenizerFactory::loadTokenizers(const string &dirName)
-{
-	struct stat fileStat;
-	unsigned int count = 0;
-
-	if (dirName.empty() == true)
-	{
-		return 0;
-	}
-
-	if (stat(dirName.c_str(), &fileStat) == -1)
-	{
-		cerr << "TokenizerFactory::loadTokenizers: " << dirName << " doesn't exist" << endl;
-		return 0;
-	}
-
-	// Is it a file or a directory ?
-	if (S_ISDIR(fileStat.st_mode))
-	{
-		// A directory : scan it
-		DIR *pDir = opendir(dirName.c_str());
-		if (pDir == NULL)
-		{
-			return 0;
-		}
-
-		// Iterate through this directory's entries
-		struct dirent *pDirEntry = readdir(pDir);
-		while (pDirEntry != NULL)
-		{
-			char *pEntryName = pDirEntry->d_name;
-			if (pEntryName != NULL)
-			{
-				string fileName = pEntryName;
-				string::size_type extPos = fileName.find_last_of(".");
-
-				if ((extPos == string::npos) ||
-					(fileName.substr(extPos) != ".so"))
-				{
-					// Next entry
-					pDirEntry = readdir(pDir);
-					continue;
-				}
-
-				fileName = dirName;
-				fileName += "/";
-				fileName += pEntryName;
-
-				// Check this entry
-				if ((stat(fileName.c_str(), &fileStat) == 0) &&
-					(S_ISREG(fileStat.st_mode)))
-				{
-					void *pHandle = dlopen(fileName.c_str(), DLOPEN_FLAGS);
-					if (pHandle != NULL)
-					{
-						Tokenizer::DataNeeds dataNeeds = Tokenizer::ALL_DOCUMENTS;
-
-						// What documents's data does it need ?
-						getTokenizerDataNeedsFunc *pDataFunc = (getTokenizerDataNeedsFunc *)dlsym(pHandle,
-							GETTOKENIZERDATANEEDS);
-						if (pDataFunc != NULL)
-						{
-							dataNeeds = (Tokenizer::DataNeeds )(*pDataFunc)();
-						}
-
-						// What type(s) does this support ?
-						getTokenizerTypesFunc *pTypesFunc = (getTokenizerTypesFunc *)dlsym(pHandle,
-								GETTOKENIZERTYPES);
-						if (pTypesFunc != NULL)
-						{
-							set<string> types;
-							bool tokenizerOkay = (*pTypesFunc)(types);
-
-							if (tokenizerOkay == true)
-							{
-								for (set<string>::iterator typeIter = types.begin();
-									typeIter != types.end(); ++typeIter)
-								{
-									// Add a record for this tokenizer
-									m_types[*typeIter] = fileName;
-#ifdef DEBUG
-									cout << "TokenizerFactory::loadTokenizers: type "
-										<< *typeIter << ", " << dataNeeds
-										<< " is supported by " << pEntryName << endl;
-#endif
-								}
-
-								m_handles[fileName] = pHandle;
-								m_dataNeeds[fileName] = dataNeeds;
-							}
-						}
-						else cerr << "TokenizerFactory::loadTokenizers: " << dlerror() << endl;
-					}
-					else cerr << "TokenizerFactory::loadTokenizers: " << dlerror() << endl;
-				}
-#ifdef DEBUG
-				else cout << "TokenizerFactory::loadTokenizers: "
-					<< pEntryName << " is not a file" << endl;
-#endif
-			}
-
-			// Next entry
-			pDirEntry = readdir(pDir);
-		}
-
-		closedir(pDir);
-	}
-	else cerr << "TokenizerFactory::loadTokenizers: " << dirName << " is not a directory" << endl;
-
-	return count;
-}
-
-/// Unloads all tokenizer libraries.
-void TokenizerFactory::unloadTokenizers(void)
-{
-	for (map<string, void*>::iterator iter = m_handles.begin(); iter != m_handles.end(); ++iter)
-	{
-		if (dlclose(iter->second) != 0)
-		{
-#ifdef DEBUG
-			cout << "TokenizerFactory::unloadTokenizers: failed on " << iter->first << endl;
-#endif
-		}
-	}
-
-	m_types.clear();
-	m_handles.clear();
-}
-
-/// Returns a Tokenizer that handles the given file's type; NULL if unavailable.
-Tokenizer *TokenizerFactory::getTokenizer(const string &fileName, const Document *pDocument)
-{
-	string type = MIMEScanner::scanFile(fileName);
-
-	return getTokenizerByType(type, pDocument);
-}
-
-/// Returns a Tokenizer that handles the given MIME type; NULL if unavailable.
-Tokenizer *TokenizerFactory::getTokenizerByType(const string &type, const Document *pDocument)
-{
-	string typeOnly = type;
-	string::size_type semiColonPos = type.find(";");
-
-	// Remove the charset, if any
-	if (semiColonPos != string::npos)
-	{
-		typeOnly = type.substr(0, semiColonPos);
-	}
-#ifdef DEBUG
-	cout << "TokenizerFactory::getTokenizerByType: file type is " << typeOnly << endl;
-#endif
-
-	if (typeOnly == "text/html")
-	{
-		return new HtmlTokenizer(pDocument, false);
-	}
-	else if (typeOnly == "text/plain")
-	{
-		return new Tokenizer(pDocument);
-	}
-	else if ((typeOnly == "text/xml") ||
-		(typeOnly == "application/xml"))
-	{
-		return new XmlTokenizer(pDocument);
-	}
-
-	Tokenizer *pTokenizer = getLibraryTokenizer(typeOnly, pDocument);
-	if (pTokenizer == NULL)
-	{
-		if (strncasecmp(typeOnly.c_str(), "text", 4) == 0)
-		{
-			// Use this by default for text documents
-			return new Tokenizer(pDocument);
-		}
-
-#ifdef DEBUG
-		cout << "TokenizerFactory::getTokenizerByType: unknown file type" << endl;
-#endif
-		return new UnknownTypeTokenizer(pDocument);
-	}
-
-	return pTokenizer;
-}
-
-void TokenizerFactory::getSupportedTypes(set<string> &types)
-{
-	types.clear();
-
-	// List supported types
-	types.insert("text/plain");
-	types.insert("text/html");
-	types.insert("text/xml");
-	types.insert("application/xml");
-	for (map<string, string>::iterator iter = m_types.begin(); iter != m_types.end(); ++iter)
-	{
-		types.insert(iter->first);
-	}
-}
-
-bool TokenizerFactory::isSupportedType(const string &type, Tokenizer::DataNeeds &dataNeeds)
-{
-	string typeOnly = type;
-	string::size_type semiColonPos = type.find(";");
-
-	dataNeeds = Tokenizer::ALL_DOCUMENTS;
-
-	// Remove the charset, if any
-	if (semiColonPos != string::npos)
-	{
-		typeOnly = type.substr(0, semiColonPos);
-	}
-
-	// Is it a built-in type ?
-	if ((typeOnly == "text/html") ||
-		(typeOnly == "text/xml") ||
-		(typeOnly == "application/xml") ||
-		(strncasecmp(typeOnly.c_str(), "text", 4) == 0))
-	{
-		return true;
-	}
-
-	// Is it a type supported by a library ?
-	map<string, string>::iterator typeIter = m_types.find(typeOnly);
-	if (typeIter != m_types.end())
-	{
-		// What does it need ?
-		map<string, Tokenizer::DataNeeds>::iterator dataNeedsIter = m_dataNeeds.find(typeIter->second);
-		if (dataNeedsIter != m_dataNeeds.end())
-		{
-			dataNeeds = dataNeedsIter->second;
-		}
-#ifdef DEBUG
-		cout << "TokenizerFactory::isSupportedType: library-handled type "
-			<< typeOnly << " " << dataNeeds << endl;
-#endif
-
-		return true;
-	}
-
-	// This type is not supported, so don't bother loading anything
-	dataNeeds = Tokenizer::NO_DOCUMENTS;
-
-	return false;
-}

Deleted: trunk/Tokenize/TokenizerFactory.h
===================================================================
--- trunk/Tokenize/TokenizerFactory.h	2007-02-08 15:28:51 UTC (rev 706)
+++ trunk/Tokenize/TokenizerFactory.h	2007-02-09 14:02:37 UTC (rev 707)
@@ -1,77 +0,0 @@
-/*
- *  Copyright 2005,2006 Fabrice Colin
- *
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU Library General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
- */
-
-#ifndef _TOKENIZER_FACTORY_H
-#define _TOKENIZER_FACTORY_H
-
-#include <string>
-#include <map>
-#include <set>
-
-#include "Tokenizer.h"
-
-/// Factory for tokenizers with related utility methods.
-class TokenizerFactory
-{
-	public:
-		virtual ~TokenizerFactory();
-
-		/**
-		  * This returns the MIME type supported by the library's tokenizer.
-		  * The character string is allocated with new[].
-		  */
-		typedef bool (getTokenizerTypesFunc)(std::set<std::string> &);
-		/// This returns the data needs of the provided Tokenizer(s).
-		typedef int (getTokenizerDataNeedsFunc)(void);
-		/// This returns a pointer to a Tokenizer, allocated with new.
-		typedef Tokenizer *(getTokenizerFunc)(const Document *);
-
-		/// Loads the tokenizer libraries in the given directory.
-		static unsigned int loadTokenizers(const std::string &dirName);
-
-		/// Returns a Tokenizer that handles the given file's type; NULL if unavailable.
-		static Tokenizer *getTokenizer(const std::string &fileName, const Document *pDocument);
-
-		/// Returns a Tokenizer that handles the given MIME type; NULL if unavailable.
-		static Tokenizer *getTokenizerByType(const std::string &type, const Document *pDocument);
-
-		/// Returns all supported MIME types.
-		static void getSupportedTypes(std::set<std::string> &types);
-
-		/// Indicates whether a MIME type is supported or not.
-		static bool isSupportedType(const std::string &type, Tokenizer::DataNeeds &dataNeeds);
-
-		/// Unloads all tokenizer libraries.
-		static void unloadTokenizers(void);
-
-	protected:
-		static std::map<std::string, std::string> m_types;
-		static std::map<std::string, void *> m_handles;
-		static std::map<std::string, Tokenizer::DataNeeds> m_dataNeeds;
-
-		TokenizerFactory();
-
-		static Tokenizer *getLibraryTokenizer(const std::string &type, const Document *pDocument);
-
-	private:
-		TokenizerFactory(const TokenizerFactory &other);
-		TokenizerFactory& operator=(const TokenizerFactory& other);
-
-};
-
-#endif // _TOKENIZER_FACTORY_H

Deleted: trunk/Tokenize/UnknownTypeTokenizer.cpp
===================================================================
--- trunk/Tokenize/UnknownTypeTokenizer.cpp	2007-02-08 15:28:51 UTC (rev 706)
+++ trunk/Tokenize/UnknownTypeTokenizer.cpp	2007-02-09 14:02:37 UTC (rev 707)
@@ -1,44 +0,0 @@
-/*
- *  Copyright 2005,2006 Fabrice Colin
- *
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU Library General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
- */
-
-#include <iostream>
-
-#include "UnknownTypeTokenizer.h"
-
-using namespace std;
-
-UnknownTypeTokenizer::UnknownTypeTokenizer(const Document *pDocument) :
-	Tokenizer(NULL),
-	m_pStrippedDocument(NULL)
-{
-	// Run strings
-	m_pStrippedDocument = runHelperProgram(pDocument, "strings --bytes=6");
-	if (m_pStrippedDocument != NULL)
-	{
-		// Give the result to the parent class
-		setDocument(m_pStrippedDocument);
-	}
-}
-
-UnknownTypeTokenizer::~UnknownTypeTokenizer()
-{
-	if (m_pStrippedDocument != NULL)
-	{
-		delete m_pStrippedDocument;
-	}
-}

Deleted: trunk/Tokenize/UnknownTypeTokenizer.h
===================================================================
--- trunk/Tokenize/UnknownTypeTokenizer.h	2007-02-08 15:28:51 UTC (rev 706)
+++ trunk/Tokenize/UnknownTypeTokenizer.h	2007-02-09 14:02:37 UTC (rev 707)
@@ -1,41 +0,0 @@
-/*
- *  Copyright 2005,2006 Fabrice Colin
- *
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU Library General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
- */
-
-#ifndef _UNKNOWN_TYPE_TOKENIZER_H
-#define _UNKNOWN_TYPE_TOKENIZER_H
-
-#include "Document.h"
-#include "Tokenizer.h"
-
-/// Tokenizer for unknown types.
-class UnknownTypeTokenizer : public Tokenizer
-{
-	public:
-		UnknownTypeTokenizer(const Document *pDocument);
-		virtual ~UnknownTypeTokenizer();
-
-	protected:
-		Document *m_pStrippedDocument;
-
-	private:
-		UnknownTypeTokenizer(const UnknownTypeTokenizer &other);
-		UnknownTypeTokenizer& operator=(const UnknownTypeTokenizer& other);
-
-};
-
-#endif // _UNKNOWN_TYPE_TOKENIZER_H

Deleted: trunk/Tokenize/WordTokenizer.cpp
===================================================================
--- trunk/Tokenize/WordTokenizer.cpp	2007-02-08 15:28:51 UTC (rev 706)
+++ trunk/Tokenize/WordTokenizer.cpp	2007-02-09 14:02:37 UTC (rev 707)
@@ -1,67 +0,0 @@
-/*
- *  Copyright 2005,2006 Fabrice Colin
- *
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU Library General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
- */
-
-#include <string.h>
-#include <iostream>
-
-#include "WordTokenizer.h"
-
-using std::string;
-using std::set;
-
-/// This returns the MIME types supported by the library's tokenizer.
-bool getTokenizerTypes(set<string> &types)
-{
-	types.clear();
-	types.insert("application/msword");
-
-	return true;
-}
-
-/// This returns the data needs of the provided Tokenizer(s).
-int getTokenizerDataNeeds(void)
-{
-	return Tokenizer::ALL_BUT_FILES;
-}
-
-/// This returns a pointer to a Tokenizer, allocated with new.
-Tokenizer *getTokenizer(const Document *pDocument)
-{
-	return new WordTokenizer(pDocument);
-}
-
-WordTokenizer::WordTokenizer(const Document *pDocument) :
-	Tokenizer(NULL),
-	m_pStrippedDocument(NULL)
-{
-	// Run antiword
-	m_pStrippedDocument = runHelperProgram(pDocument, "antiword");
-	if (m_pStrippedDocument != NULL)
-	{
-		// Give the result to the parent class
-		setDocument(m_pStrippedDocument);
-	}
-}
-
-WordTokenizer::~WordTokenizer()
-{
-	if (m_pStrippedDocument != NULL)
-	{
-		delete m_pStrippedDocument;
-	}
-}

Deleted: trunk/Tokenize/WordTokenizer.h
===================================================================
--- trunk/Tokenize/WordTokenizer.h	2007-02-08 15:28:51 UTC (rev 706)
+++ trunk/Tokenize/WordTokenizer.h	2007-02-09 14:02:37 UTC (rev 707)
@@ -1,51 +0,0 @@
-/*
- *  Copyright 2005,2006 Fabrice Colin
- *
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU Library General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
- */
-
-#ifndef _WORD_TOKENIZER_H
-#define _WORD_TOKENIZER_H
-
-#include <string>
-#include <set>
-
-#include "Document.h"
-#include "Tokenizer.h"
-
-/// This returns the MIME types supported by the library's tokenizer.
-bool getTokenizerTypes(std::set<std::string> &types);
-/// This returns the data needs of the provided Tokenizer(s).
-int getTokenizerDataNeeds(void);
-/// This returns a pointer to a Tokenizer, allocated with new.
-Tokenizer *getTokenizer(const Document *pDocument);
-
-/// Tokenizer for MS Word documents.
-class WordTokenizer : public Tokenizer
-{
-	public:
-		WordTokenizer(const Document *pDocument);
-		virtual ~WordTokenizer();
-
-	protected:
-		Document *m_pStrippedDocument;
-
-	private:
-		WordTokenizer(const WordTokenizer &other);
-		WordTokenizer& operator=(const WordTokenizer& other);
-
-};
-
-#endif // _WORD_TOKENIZER_H

Deleted: trunk/Tokenize/XmlTokenizer.cpp
===================================================================
--- trunk/Tokenize/XmlTokenizer.cpp	2007-02-08 15:28:51 UTC (rev 706)
+++ trunk/Tokenize/XmlTokenizer.cpp	2007-02-09 14:02:37 UTC (rev 707)
@@ -1,112 +0,0 @@
-/*
- *  Copyright 2005,2006 Fabrice Colin
- *
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU Library General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
- */
-
-#include <string.h>
-#include <strings.h>
-#include <sys/types.h>
-#include <iostream>
-
-#include "StringManip.h"
-#include "XmlTokenizer.h"
-
-//#define DEBUG_TOKENIZER
-
-using std::string;
-
-XmlTokenizer::XmlTokenizer(const Document *pDocument) :
-	Tokenizer(NULL),
-	m_pStrippedDocument(NULL)
-{
-	if (pDocument != NULL)
-	{
-		unsigned int length = 0;
-		const char *data = pDocument->getData(length);
-
-		if ((data != NULL) &&
-			(length > 0))
-		{
-			// Remove XML tags
-			string strippedData = parseXML(data);
-
-			// Pass the result to the parent class
-			m_pStrippedDocument = new Document(pDocument->getTitle(),
-				pDocument->getLocation(), pDocument->getType(),
-				pDocument->getLanguage());
-			m_pStrippedDocument->setData(strippedData.c_str(), strippedData.length());
-			m_pStrippedDocument->setTimestamp(pDocument->getTimestamp());
-			m_pStrippedDocument->setSize(pDocument->getSize());
-
-			setDocument(m_pStrippedDocument);
-		}
-	}
-}
-
-XmlTokenizer::~XmlTokenizer()
-{
-	if (m_pStrippedDocument != NULL)
-	{
-		delete m_pStrippedDocument;
-	}
-}
-
-/// Parses XML; the string without tags.
-string XmlTokenizer::parseXML(const string &str)
-{
-	if (str.empty() == true)
-	{
-		return "";
-	}
-
-	string stripped(StringManip::replaceEntities(str));
-
-	// Tag start
-	string::size_type startPos = stripped.find("<");
-	while (startPos != string::npos)
-	{
-		string::size_type endPos = stripped.find(">", startPos);
-		if (endPos == string::npos)
-		{
-			break;
-		}
-
-		stripped.erase(startPos, endPos - startPos + 1);
-
-		// Next
-		startPos = stripped.find("<");
-	}
-
-	// The input may contain partial tags, eg "a>...</a><b>...</b>...<c"
-	string::size_type pos = stripped.find(">");
-	if (pos != string::npos)
-	{
-		stripped.erase(0, pos + 1);
-	}
-	pos = stripped.find("<");
-	if (pos != string::npos)
-	{
-		stripped.erase(pos);
-	}
-
-	return stripped;
-}
-
-/// Utility method that strips XML tags off; the string without tags.
-string XmlTokenizer::stripTags(const string &str)
-{
-	return parseXML(str);
-}

Deleted: trunk/Tokenize/XmlTokenizer.h
===================================================================
--- trunk/Tokenize/XmlTokenizer.h	2007-02-08 15:28:51 UTC (rev 706)
+++ trunk/Tokenize/XmlTokenizer.h	2007-02-09 14:02:37 UTC (rev 707)
@@ -1,45 +0,0 @@
-/*
- *  Copyright 2005,2006 Fabrice Colin
- *
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU Library General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
- */
-
-#ifndef _XML_TOKENIZER_H
-#define _XML_TOKENIZER_H
-
-#include <string>
-
-#include "Document.h"
-#include "Tokenizer.h"
-
-/// XML tokenizer that strips all tags and only preserves text.
-class XmlTokenizer : public Tokenizer
-{
-	public:
-		XmlTokenizer(const Document *pDocument);
-		virtual ~XmlTokenizer();
-
-		/// Utility method that strips XML tags off; the string without tags.
-		static std::string stripTags(const std::string &str);
-
-	protected:
-		Document *m_pStrippedDocument;
-
-		/// Parses XML; the string without tags.
-		static std::string parseXML(const std::string &str);
-
-};
-
-#endif // _XML_TOKENIZER_H

Added: trunk/Tokenize/filters/README
===================================================================
--- trunk/Tokenize/filters/README	2007-02-08 15:28:51 UTC (rev 706)
+++ trunk/Tokenize/filters/README	2007-02-09 14:02:37 UTC (rev 707)
@@ -0,0 +1,5 @@
+Here go the filters from the Dijon project (http://dijon.berlios.de/).
+
+Check out svn://svn.berlios.de/svnroot/repos/dijon/branches/pinot
+and copy the contents of filters here.
+



From fabricecolin at mail.berlios.de  Fri Feb  9 15:14:02 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Fri, 9 Feb 2007 15:14:02 +0100
Subject: [Pinot-svn] r708 - in trunk: Index Search UI/GTK2/src
Message-ID: <200702091414.l19EE2Jf027900@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-09 15:14:01 +0100 (Fri, 09 Feb 2007)
New Revision: 708

Added:
   trunk/Index/FilterWrapper.cpp
   trunk/Index/FilterWrapper.h
Modified:
   trunk/Search/SherlockParser.cpp
   trunk/Search/WebEngine.cpp
   trunk/UI/GTK2/src/MboxHandler.cpp
   trunk/UI/GTK2/src/OnDiskHandler.cpp
   trunk/UI/GTK2/src/WorkerThreads.cpp
Log:
FilterWrapper provides a couple of useful methods to filter documents or index
their content.
Replaced specialized tokenizers with Dijon filters.


Added: trunk/Index/FilterWrapper.cpp
===================================================================
--- trunk/Index/FilterWrapper.cpp	2007-02-09 14:02:37 UTC (rev 707)
+++ trunk/Index/FilterWrapper.cpp	2007-02-09 14:14:01 UTC (rev 708)
@@ -0,0 +1,265 @@
+/*
+ *  Copyright 2007 Fabrice Colin
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU Library General Public License for more details.
+ *
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+ */
+
+#include <iostream>
+#include <map>
+
+#include "Url.h"
+#include "FilterFactory.h"
+#include "FilterWrapper.h"
+
+using std::cout;
+using std::cerr;
+using std::endl;
+using std::string;
+using std::set;
+using std::map;
+using namespace Dijon;
+
+FilterWrapper::FilterWrapper()
+{
+}
+
+FilterWrapper::~FilterWrapper()
+{
+}
+
+bool FilterWrapper::feedFilter(const Document &doc, Dijon::Filter *pFilter)
+{
+	string location(doc.getLocation());
+	Url urlObj(location);
+	string fileName;
+	unsigned int dataLength = 0;
+	const char *pData = doc.getData(dataLength);
+	bool fedInput = false, success = false;
+
+	if (pFilter == NULL)
+	{
+		return false;
+	}
+
+	if ((urlObj.getProtocol() == "file") &&
+		(location .length() > 7))
+	{
+		fileName = location.substr(7);
+	}
+
+	// Prefer feeding the data
+	if (((dataLength > 0) && (pData != NULL)) &&
+		(pFilter->is_data_input_ok(Filter::DOCUMENT_DATA) == true))
+	{
+#ifdef DEBUG
+		cout << "FilterWrapper::getFilter: feeding data" << endl;
+#endif
+		fedInput = pFilter->set_document_data(pData, dataLength);
+	}
+	// ... to feeding the file
+	if ((fedInput == false) &&
+		(fileName.empty() == false))
+	{ 
+		if (pFilter->is_data_input_ok(Filter::DOCUMENT_FILE_NAME) == true)
+		{
+#ifdef DEBUG
+			cout << "FilterWrapper::getFilter: feeding file " << fileName << endl;
+#endif
+			fedInput = pFilter->set_document_file(fileName);
+		}
+		// ...and to feeding the file's contents
+		if ((fedInput == false) &&
+			(pFilter->is_data_input_ok(Filter::DOCUMENT_DATA) == true))
+		{
+			Document docCopy(doc);
+
+			if (docCopy.setDataFromFile(fileName) == false)
+			{
+				cerr << "Couldn't load " << fileName << endl;
+
+				return false;
+			}
+#ifdef DEBUG
+			cout << "FilterWrapper::getFilter: feeding contents of file " << fileName << endl;
+#endif
+
+			pData = docCopy.getData(dataLength);
+			if ((dataLength > 0) &&
+				(pData != NULL))
+			{
+				fedInput = pFilter->set_document_data(pData, dataLength);
+			}
+		}
+	}
+
+	if (fedInput == false)
+	{
+		cerr << "Couldn't feed filter for " << doc.getLocation() << endl;
+
+		return false;
+	}
+
+	return true;
+}
+
+string FilterWrapper::stripMarkup(const string &text)
+{
+	Dijon::Filter *pFilter = Dijon::FilterFactory::getFilter("text/xml");
+	string strippedText;
+
+	if (pFilter == NULL)
+	{
+		return "";
+	}
+
+	Document doc;
+	doc.setData(text.c_str(), text.length());
+	if (feedFilter(doc, pFilter) == true)
+	{
+		const map<string, string> &metaData = pFilter->get_meta_data();
+		map<string, string>::const_iterator contentIter = metaData.find("content");
+		if (contentIter != metaData.end())
+		{
+			strippedText = contentIter->second;
+		}
+	}
+
+	delete pFilter;
+
+	return strippedText;
+}
+
+bool FilterWrapper::indexDocument(IndexInterface &index, const Document &doc,
+	const set<string> &labels, unsigned int &docId)
+{
+	Document docCopy(doc);
+
+	return filterDocument(index, docCopy, 0, labels, docId, false);
+}
+
+/// Updates the given document.
+bool FilterWrapper::updateDocument(unsigned int docId, IndexInterface &index, const Document &doc)
+{
+	Document docCopy(doc);
+	set<string> labels;
+
+	return filterDocument(index, docCopy, 0, labels, docId, true);
+}
+
+bool FilterWrapper::filterDocument(IndexInterface &index, Document &doc,
+	unsigned int count, const set<string> &labels, unsigned int &docId,
+	bool doUpdate)
+{
+	Filter *pFilter = FilterFactory::getFilter(doc.getType());
+	bool success = false;
+
+	if (pFilter == NULL)
+	{
+		return false;
+	}
+
+	if (feedFilter(doc, pFilter) == false)
+	{
+		delete pFilter;
+
+		return false;
+	}
+
+	while (pFilter->has_documents() == true)
+	{
+		Document filteredDoc(doc.getTitle(), doc.getLocation(), "text/plain", doc.getLanguage());
+		string uri, ipath;
+		unsigned int dataLength = 0;
+
+		if (pFilter->next_document() == false)
+		{
+			break;
+		}
+		cout << "##### Document " << ++count << endl;
+
+		const map<string, string> &metaData = pFilter->get_meta_data();
+		for (map<string, string>::const_iterator metaIter = metaData.begin();
+			metaIter != metaData.end(); ++metaIter)
+		{
+			if (metaIter->first == "content")
+			{
+				filteredDoc.setData(metaIter->second.c_str(), metaIter->second.length());
+
+				cout << "Set " << metaIter->second.length() << " characters of data" << endl;
+			}
+			else if (metaIter->first == "ipath")
+			{
+				ipath = metaIter->second;
+			}
+			else if (metaIter->first == "language")
+			{
+				filteredDoc.setLanguage(metaIter->second);
+			}
+			else if (metaIter->first == "mimetype")
+			{
+				filteredDoc.setType(metaIter->second);
+			}
+			else if (metaIter->first == "size")
+			{
+				filteredDoc.setSize((off_t)atoi(metaIter->second.c_str()));
+			}
+			else if (metaIter->first == "title")
+			{
+				filteredDoc.setTitle(metaIter->second);
+			}
+			else if (metaIter->first == "uri")
+			{
+				uri = metaIter->second;
+			}
+		}
+
+		if (uri.empty() == false)
+		{
+			filteredDoc.setLocation(uri);
+		}
+		if (ipath.empty() == false)
+		{
+			filteredDoc.setLocation(filteredDoc.getLocation() + "?" + ipath);
+		}
+		cout << "Location: " << filteredDoc.getLocation() << endl;
+		cout << "MIME type: " << filteredDoc.getType() << endl;
+
+		// Pass it down to another filter ?
+		if (filteredDoc.getType() != "text/plain")
+		{
+			cout << "Passing down to another filter" << endl;
+
+			filterDocument(index, filteredDoc, count, labels, docId, doUpdate);
+		}
+		else
+		{
+			Tokenizer tokens(&filteredDoc);
+
+			if (doUpdate == false)
+			{
+				success = index.indexDocument(tokens, labels, docId);
+			}
+			else
+			{
+				success = index.updateDocument(docId, tokens);
+			}
+		}
+	}
+
+	delete pFilter;
+
+	return success;
+}
+

Added: trunk/Index/FilterWrapper.h
===================================================================
--- trunk/Index/FilterWrapper.h	2007-02-09 14:02:37 UTC (rev 707)
+++ trunk/Index/FilterWrapper.h	2007-02-09 14:14:01 UTC (rev 708)
@@ -0,0 +1,62 @@
+/*
+ *  Copyright 2007 Fabrice Colin
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU Library General Public License for more details.
+ *
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+ */
+
+#ifndef _FILTER_WRAPPER_H
+#define _FILTER_WRAPPER_H
+
+#include <string>
+#include <set>
+
+#include "Document.h"
+#include "Filter.h"
+#include "IndexInterface.h"
+
+/// A wrapper around Dijon filters.
+class FilterWrapper
+{
+	public:
+		virtual ~FilterWrapper();
+
+		/// Feeds a document's data to a filter.
+		static bool feedFilter(const Document &doc, Dijon::Filter *pFilter);
+
+		/// Strips markup from a piece of text.
+		static std::string stripMarkup(const std::string &text);
+
+		/// Indexes the given data.
+		static bool indexDocument(IndexInterface &index, const Document &doc,
+			const std::set<std::string> &labels, unsigned int &docId);
+
+		/// Updates the given document.
+		static bool updateDocument(unsigned int docId, IndexInterface &index,
+			const Document &doc);
+
+	protected:
+		FilterWrapper();
+
+		static bool filterDocument(IndexInterface &index, Document &doc,
+			unsigned int count, const std::set<std::string> &labels, unsigned int &docId,
+			bool doUpdate);
+
+	private:
+		FilterWrapper(const FilterWrapper &other);
+		FilterWrapper &operator=(const FilterWrapper &other);
+
+};
+
+#endif // _FILTER_WRAPPER_H

Modified: trunk/Search/SherlockParser.cpp
===================================================================
--- trunk/Search/SherlockParser.cpp	2007-02-09 14:02:37 UTC (rev 707)
+++ trunk/Search/SherlockParser.cpp	2007-02-09 14:14:01 UTC (rev 708)
@@ -25,9 +25,10 @@
 
 #include "StringManip.h"
 #include "Url.h"
-#include "HtmlTokenizer.h"
-#include "XmlTokenizer.h"
+#include "HtmlFilter.h"
+#include "FilterFactory.h"
 #include "FileCollector.h"
+#include "FilterWrapper.h"
 #include "SherlockParser.h"
 
 using std::cout;
@@ -360,41 +361,53 @@
 #endif
 			chunkDoc.setData(dummyHtml.c_str(), dummyHtml.length());
 
-			HtmlTokenizer chunkTokens(&chunkDoc, false, true);
-			set<Link> &chunkLinks = chunkTokens.getLinks();
-			unsigned int endOfFirstLink = 0, startOfSecondLink = 0, endOfSecondLink = 0, startOfThirdLink = 0;
+			// Feed this chunk to the filter
+			Dijon::HtmlFilter chunkFilter("text/html");
+			if ((FilterWrapper::feedFilter(chunkDoc, &chunkFilter) == true) &&
+				(chunkFilter.next_document() == true))
+			{
+				set<Dijon::Link> chunkLinks;
+				unsigned int endOfFirstLink = 0, startOfSecondLink = 0, endOfSecondLink = 0, startOfThirdLink = 0;
 
-			// The result's URL and title should be given by the first link
-			for (set<Link>::iterator linkIter = chunkLinks.begin(); linkIter != chunkLinks.end(); ++linkIter)
-			{
-				if (linkIter->m_index == 0)
+				chunkFilter.get_links(chunkLinks);
+
+				// The result's URL and title should be given by the first link
+				for (set<Dijon::Link>::iterator linkIter = chunkLinks.begin(); linkIter != chunkLinks.end(); ++linkIter)
 				{
-					url = linkIter->m_url;
-					name = linkIter->m_name;
+					if (linkIter->m_index == 0)
+					{
+						url = linkIter->m_url;
+						name = linkIter->m_name;
 #ifdef DEBUG
-					cout << "SherlockResponseParser::parse: first link in chunk is "
-						<< url << endl;
+						cout << "SherlockResponseParser::parse: first link in chunk is "
+							<< url << endl;
 #endif
-					endOfFirstLink = linkIter->m_endPos;
+						endOfFirstLink = linkIter->m_endPos;
+					}
+					else if (linkIter->m_index == 1)
+					{
+						startOfSecondLink = linkIter->m_startPos;
+						endOfSecondLink = linkIter->m_endPos;
+					}
+					else if (linkIter->m_index == 2)
+					{
+						startOfThirdLink = linkIter->m_startPos;
+					}
 				}
-				else if (linkIter->m_index == 1)
+
+				// Any extract ?
+				const map<string, string> &metaData = chunkFilter.get_meta_data();
+				map<string, string>::const_iterator abstractIter = metaData.find("abstract");
+				if (abstractIter == metaData.end())
 				{
-					startOfSecondLink = linkIter->m_startPos;
-					endOfSecondLink = linkIter->m_endPos;
+					extract = FilterWrapper::stripMarkup(resultItem);
+					StringManip::trimSpaces(extract);
 				}
-				else if (linkIter->m_index == 2)
+				else
 				{
-					startOfThirdLink = linkIter->m_startPos;
+					extract = abstractIter->second;
 				}
 			}
-
-			// Any extract ?
-			extract = chunkTokens.getAbstract();
-			if (extract.empty() == true)
-			{
-				extract = XmlTokenizer::stripTags(resultItem);
-				StringManip::trimSpaces(extract);
-			}
 		}
 		else
 		{

Modified: trunk/Search/WebEngine.cpp
===================================================================
--- trunk/Search/WebEngine.cpp	2007-02-09 14:02:37 UTC (rev 707)
+++ trunk/Search/WebEngine.cpp	2007-02-09 14:14:01 UTC (rev 708)
@@ -25,8 +25,9 @@
 
 #include "StringManip.h"
 #include "Url.h"
-#include "HtmlTokenizer.h"
+#include "HtmlFilter.h"
 #include "DownloaderFactory.h"
+#include "FilterWrapper.h"
 #include "WebEngine.h"
 
 using std::cout;
@@ -81,15 +82,24 @@
 		m_charset = getCharset(contentType);
 		if (m_charset.empty() == true)
 		{
-			HtmlTokenizer tokens(pDoc, true);
+			Dijon::HtmlFilter htmlFilter("text/html");
 
-			// Content-Type might be specified as a META tag 
-			contentType = tokens.getMetaTag("Content-Type");
-			m_charset = getCharset(contentType);
-			if (m_charset.empty() == false)
+			if (FilterWrapper::feedFilter(*pDoc, &htmlFilter) == true)
 			{
-				// Reset the document's type
-				pDoc->setType(contentType);
+				// Content-Type might be specified as a META tag
+				const map<string, string> &metaData = htmlFilter.get_meta_data();
+				map<string, string>::const_iterator typeIter = metaData.find("Content-Type");
+
+				if (typeIter != metaData.end())
+				{
+					contentType = typeIter->second;
+					m_charset = getCharset(contentType);
+					if (m_charset.empty() == false)
+					{
+						// Reset the document's type
+						pDoc->setType(contentType);
+					}
+				}
 			}
 		}
 	}

Modified: trunk/UI/GTK2/src/MboxHandler.cpp
===================================================================
--- trunk/UI/GTK2/src/MboxHandler.cpp	2007-02-09 14:02:37 UTC (rev 707)
+++ trunk/UI/GTK2/src/MboxHandler.cpp	2007-02-09 14:14:01 UTC (rev 708)
@@ -29,8 +29,8 @@
 #include "Timer.h"
 #include "TimeConverter.h"
 #include "Url.h"
+#include "FilterWrapper.h"
 #include "XapianDatabase.h"
-#include "TokenizerFactory.h"
 #include "MboxHandler.h"
 
 using namespace std;
@@ -167,26 +167,14 @@
 		{
 			m_index.setStemmingMode(IndexInterface::STORE_BOTH);
 
-			// Get an ad hoc tokenizer for the message
-			Tokenizer *pTokenizer = TokenizerFactory::getTokenizerByType(pMessage->getType(), pMessage);
-			if (pTokenizer == NULL)
-			{
-#ifdef DEBUG
-				cout << "MboxHandler::parseMailAccount: no tokenizer for message " << docNum << endl;
-#endif
-				break;	
-			}
-
 			unsigned int docId = 0;
-			indexedFile = m_index.indexDocument(*pTokenizer, labels, docId);
+			indexedFile = FilterWrapper::indexDocument(m_index, *pMessage, labels, docId);
 #ifdef DEBUG
 			if (indexedFile == false)
 			{
 				cout << "MboxHandler::parseMailAccount: couldn't index message " << docNum << endl;
 			}
 #endif
-
-			delete pTokenizer;
 		}
 		else
 		{

Modified: trunk/UI/GTK2/src/OnDiskHandler.cpp
===================================================================
--- trunk/UI/GTK2/src/OnDiskHandler.cpp	2007-02-09 14:02:37 UTC (rev 707)
+++ trunk/UI/GTK2/src/OnDiskHandler.cpp	2007-02-09 14:14:01 UTC (rev 708)
@@ -28,8 +28,8 @@
 #include "MIMEScanner.h"
 #include "StringManip.h"
 #include "Url.h"
+#include "FilterWrapper.h"
 #include "XapianDatabase.h"
-#include "TokenizerFactory.h"
 #include "FileCollector.h"
 #include "PinotSettings.h"
 #include "OnDiskHandler.h"
@@ -117,24 +117,14 @@
 	}
 
 	// Get an ad hoc tokenizer for the message
-	Tokenizer *pTokenizer = TokenizerFactory::getTokenizerByType(docInfo.getType(), pDoc);
-	if (pTokenizer == NULL)
-	{
-#ifdef DEBUG
-		cout << "OnDiskHandler::indexFile: no tokenizer for type " << docInfo.getType() << endl;
-#endif
-		delete pDoc;
-		return false;
-	}
-
 	// Index or update ?
 	if (docId == 0)
 	{
-		indexedFile = m_index.indexDocument(*pTokenizer, labels, docId);
+		indexedFile = FilterWrapper::indexDocument(m_index, *pDoc, labels, docId);
 	}
 	else
 	{
-		indexedFile = m_index.updateDocument(docId, *pTokenizer);
+		indexedFile = FilterWrapper::updateDocument(docId, m_index, *pDoc);
 	}
 
 #ifdef DEBUG
@@ -144,7 +134,6 @@
 	}
 #endif
 
-	delete pTokenizer;
 	delete pDoc;
 
 	return indexedFile;

Modified: trunk/UI/GTK2/src/WorkerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.cpp	2007-02-09 14:02:37 UTC (rev 707)
+++ trunk/UI/GTK2/src/WorkerThreads.cpp	2007-02-09 14:14:01 UTC (rev 708)
@@ -30,13 +30,13 @@
 #include <sigc++/slot.h>
 #include <glibmm/miscutils.h>
 
-#include "HtmlTokenizer.h"
-#include "XmlTokenizer.h"
 #include "MIMEScanner.h"
-#include "TokenizerFactory.h"
 #include "StringManip.h"
 #include "TimeConverter.h"
 #include "Url.h"
+#include "HtmlFilter.h"
+#include "FilterFactory.h"
+#include "FilterWrapper.h"
 #include "XapianDatabase.h"
 #include "ActionQueue.h"
 #include "QueryHistory.h"
@@ -835,7 +835,7 @@
 			// The title may contain formatting
 			if (resultIter->getTitle().empty() == false)
 			{
-				title = XmlTokenizer::stripTags(resultIter->getTitle());
+				title = FilterWrapper::stripMarkup(resultIter->getTitle());
 			}
 #ifdef DEBUG
 			cout << "QueryingThread::doWork: title is " << title << endl;
@@ -1128,7 +1128,6 @@
 {
 	IndexInterface *pIndex = PinotSettings::getInstance().getIndex(m_indexLocation);
 	Url thisUrl(m_docInfo.getLocation());
-	Tokenizer::DataNeeds dataNeeds;
 	bool doDownload = true;
 
 	// First things first, get the index
@@ -1152,7 +1151,7 @@
 		m_docInfo.setType(MIMEScanner::scanUrl(thisUrl));
 	}
 
-	if (TokenizerFactory::isSupportedType(m_docInfo.getType(), dataNeeds) == false)
+	if (Dijon::FilterFactory::isSupportedType(m_docInfo.getType()) == false)
 	{
 		// Skip unsupported types ?
 		if (m_allowAllMIMETypes == false)
@@ -1168,6 +1167,7 @@
 		}
 	}
 
+#if 0
 	if ((dataNeeds == Tokenizer::ALL_BUT_FILES) &&
 		(thisUrl.getProtocol() == "file"))
 	{
@@ -1177,6 +1177,7 @@
 	{
 		doDownload = false;
 	}
+#endif
 
 	if (doDownload == true)
 	{
@@ -1195,7 +1196,6 @@
 
 	if (m_pDoc != NULL)
 	{
-		Tokenizer *pTokens = NULL;
 		string docType(m_pDoc->getType());
 		bool success = false;
 
@@ -1224,7 +1224,7 @@
 #endif
 
 		// Check again as the downloader may have altered the MIME type
-		if (TokenizerFactory::isSupportedType(m_docInfo.getType(), dataNeeds) == false)
+		if (Dijon::FilterFactory::isSupportedType(m_docInfo.getType()) == false)
 		{
 			// Skip unsupported types ?
 			if (m_allowAllMIMETypes == false)
@@ -1245,42 +1245,33 @@
 			// Create an empty document so that the file's details are indexed but not its content
 			delete m_pDoc;
 			m_pDoc = new Document(m_docInfo);
-			// A simple text tokenizer will do the job
-			pTokens = new Tokenizer(m_pDoc);
+			m_pDoc->setType("text/plain");
 		}
+#if 0
 		else
 		{
-			pTokens = TokenizerFactory::getTokenizerByType(m_docInfo.getType(), m_pDoc);
-		}
-
-		if (pTokens == NULL)
-                {
-                        m_status = _("Couldn't tokenize");
-                        m_status += " ";
-                        m_status += m_docInfo.getLocation();
-                        return;
-                }
-
-		// Is indexing allowed ?
-		HtmlTokenizer *pHtmlTokens = dynamic_cast<HtmlTokenizer*>(pTokens);
-		if ((m_ignoreRobotsDirectives == false) &&
-			(pHtmlTokens != NULL))
-		{
-			// See if the document has a ROBOTS META tag
-			string robotsDirectives = pHtmlTokens->getMetaTag("robots");
-			string::size_type pos1 = robotsDirectives.find("none");
-			string::size_type pos2 = robotsDirectives.find("noindex");
-			if ((pos1 != string::npos) ||
-				(pos2 != string::npos))
+			// Is indexing allowed ?
+			HtmlFilter *pHtmlFilter = dynamic_cast<HtmlFilter*>(pFilter);
+			if ((m_ignoreRobotsDirectives == false) &&
+				(pHtmlTokens != NULL))
 			{
-				// No, it's not
-				delete pTokens;
-				m_status = _("Robots META tag forbids indexing");
-				m_status += " ";
-				m_status += m_docInfo.getLocation();
-				return;
+		// See if the document has a ROBOTS META tag
+		string robotsDirectives = pHtmlTokens->getMetaTag("robots");
+		string::size_type pos1 = robotsDirectives.find("none");
+		string::size_type pos2 = robotsDirectives.find("noindex");
+		if ((pos1 != string::npos) ||
+			(pos2 != string::npos))
+		{
+			// No, it's not
+			delete pTokens;
+			m_status = _("Robots META tag forbids indexing");
+			m_status += " ";
+			m_status += m_docInfo.getLocation();
+			return;
+		}
 			}
 		}
+#endif
 
 		if (m_done == false)
 		{
@@ -1290,7 +1281,7 @@
 			if (m_update == true)
 			{
 				// Update the document
-				if (pIndex->updateDocument(m_docId, *pTokens) == true)
+				if (FilterWrapper::updateDocument(m_docId, *pIndex, *m_pDoc) == true)
 				{
 #ifdef DEBUG
 					cout << "IndexingThread::doWork: updated " << m_pDoc->getLocation()
@@ -1308,7 +1299,7 @@
 				unsigned int docId = 0;
 
 				// Index the document
-				success = pIndex->indexDocument(*pTokens, labels, docId);
+				success = FilterWrapper::indexDocument(*pIndex, *m_pDoc, labels, docId);
 				if (success == true)
 				{
 					m_docId = docId;
@@ -1340,8 +1331,6 @@
 				pIndex->getDocumentInfo(m_docId, m_docInfo);
 			}
 		}
-
-		delete pTokens;
 	}
 
 	delete pIndex;



From fabricecolin at mail.berlios.de  Fri Feb  9 15:25:11 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Fri, 9 Feb 2007 15:25:11 +0100
Subject: [Pinot-svn] r709 - in trunk: Index Search UI/GTK2/src
Message-ID: <200702091425.l19EPBGN028413@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-09 15:25:09 +0100 (Fri, 09 Feb 2007)
New Revision: 709

Modified:
   trunk/Index/pinot-index.cpp
   trunk/Search/pinot-search.cpp
   trunk/UI/GTK2/src/pinot-dbus-daemon.cc
   trunk/UI/GTK2/src/pinot.cc
Log:
Replaced specialized tokenizers with Dijon filters.
Pinot-index takes --db to specify the path to the index; the index type is
hardcoded to xapian.
Pinot-search takes --max to specify the maximum number of results.
Pinot sets SSH_ASKPASS.


Modified: trunk/Index/pinot-index.cpp
===================================================================
--- trunk/Index/pinot-index.cpp	2007-02-09 14:14:01 UTC (rev 708)
+++ trunk/Index/pinot-index.cpp	2007-02-09 14:25:09 UTC (rev 709)
@@ -25,10 +25,10 @@
 
 #include "MIMEScanner.h"
 #include "Url.h"
-#include "HtmlTokenizer.h"
+#include "FilterFactory.h"
 #include "XapianDatabaseFactory.h"
-#include "TokenizerFactory.h"
 #include "DownloaderFactory.h"
+#include "FilterWrapper.h"
 #include "IndexFactory.h"
 #include "config.h"
 
@@ -36,6 +36,7 @@
 
 static struct option g_longOptions[] = {
 	{"check", 1, 0, 'c'},
+	{"db", 1, 0, 'd'},
 	{"help", 0, 0, 'h'},
 	{"index", 1, 0, 'i'},
 	{"showinfo", 0, 0, 's'},
@@ -46,13 +47,13 @@
 int main(int argc, char **argv)
 {
 	string type, option;
-	string urlToCheck, urlToIndex;
+	string databaseName, urlToCheck, urlToIndex;
 	int longOptionIndex = 0;
 	unsigned int docId = 0;
 	bool checkDocument = false, indexDocument = false, showInfo = false, success = false;
 
 	// Look at the options
-	int optionChar = getopt_long(argc, argv, "c:hi:sv", g_longOptions, &longOptionIndex);
+	int optionChar = getopt_long(argc, argv, "c:d:hi:sv", g_longOptions, &longOptionIndex);
 	while (optionChar != -1)
 	{
 		set<string> engines;
@@ -66,12 +67,20 @@
 				}
 				checkDocument = true;
 				break;
+			case 'd':
+				if (optarg != NULL)
+				{
+					databaseName = optarg;
+				}
+				checkDocument = true;
+				break;
 			case 'h':
 				// Help
 				cout << "pinot-index - Index documents from the command-line\n\n"
-					<< "Usage: pinot-index [OPTIONS] INDEXTYPE INDEXLOCATION\n\n"
+					<< "Usage: pinot-index [OPTIONS]\n\n"
 					<< "Options:\n"
 					<< "  -c, --check               check whether the given URL is in the index\n"
+					<< "  -d, --db                  path to index to use (mandatory)\n"
 					<< "  -h, --help                display this help and exit\n"
 					<< "  -i, --index               index the given URL\n"
 					<< "  -s, --showinfo            show information about the document\n"
@@ -79,8 +88,8 @@
 				// Don't mention type dbus here as it doesn't support indexing and
 				// is identical to xapian when checking for URLs
 				cout << "Examples:\n"
-					<< "pinot-index --check file:///home/fabrice/Documents/Bozo.txt --showinfo xapian ~/.pinot/daemon\n\n"
-					<< "pinot-index --index http://pinot.berlios.de/ xapian ~/.pinot/index\n\n"
+					<< "pinot-index --check file:///home/fabrice/Documents/Bozo.txt --showinfo --db ~/.pinot/daemon\n\n"
+					<< "pinot-index --index http://pinot.berlios.de/ --db ~/.pinot/index\n\n"
 					<< "Report bugs to " << PACKAGE_BUGREPORT << endl;
 				return EXIT_SUCCESS;
 			case 'i':
@@ -104,46 +113,43 @@
 		}
 
 		// Next option
-		optionChar = getopt_long(argc, argv, "c:hi:sv", g_longOptions, &longOptionIndex);
+		optionChar = getopt_long(argc, argv, "c:d:hi:sv", g_longOptions, &longOptionIndex);
 	}
 
-	if ((argc < 3) ||
-		(optind >= argc) ||
-		(optind + 2 != argc) ||
-		((indexDocument == false) && (checkDocument == false)))
+	if (((indexDocument == false) &&
+		(checkDocument == false)) ||
+		(databaseName.empty() == true))
 	{
 		cerr << "Incorrect parameters" << endl;
 		return EXIT_FAILURE;
 	}
 
 	MIMEScanner::initialize();
-	HtmlTokenizer::initialize();
 	DownloaderInterface::initialize();
-	TokenizerFactory::loadTokenizers(string(LIBDIR) + string("/pinot/tokenizers"));
+	Dijon::FilterFactory::loadFilters(string(LIBDIR) + string("/pinot/filters"));
 
 	// Make sure the index is open in the correct mode
-	XapianDatabase *pDb = XapianDatabaseFactory::getDatabase(argv[optind + 1], (indexDocument ? false : true));
+	XapianDatabase *pDb = XapianDatabaseFactory::getDatabase(databaseName, (indexDocument ? false : true));
 	if (pDb == NULL)
 	{
-		cerr << "Couldn't open index " << argv[optind + 1] << endl;
+		cerr << "Couldn't open index " << databaseName << endl;
 
+		Dijon::FilterFactory::unloadFilters();
 		DownloaderInterface::shutdown();
-		HtmlTokenizer::shutdown();
 		MIMEScanner::shutdown();
 
 		return EXIT_FAILURE;
 	}
 
 	// Get a read-write index of the given type
-	IndexInterface *pIndex = IndexFactory::getIndex(argv[optind], argv[optind + 1]);
+	IndexInterface *pIndex = IndexFactory::getIndex("xapian", databaseName);
 	if (pIndex == NULL)
 	{
-		cerr << "Couldn't obtain index of type " << argv[optind] << endl;
+		cerr << "Couldn't obtain index for " << databaseName << endl;
 
 		XapianDatabaseFactory::closeAll();
-		TokenizerFactory::unloadTokenizers();
+		Dijon::FilterFactory::unloadFilters();
 		DownloaderInterface::shutdown();
-		HtmlTokenizer::shutdown();
 		MIMEScanner::shutdown();
 
 		return EXIT_FAILURE;
@@ -172,9 +178,8 @@
 			cerr << "Couldn't obtain downloader for protocol " << thisUrl.getProtocol() << endl;
 
 			XapianDatabaseFactory::closeAll();
-			TokenizerFactory::unloadTokenizers();
+			Dijon::FilterFactory::unloadFilters();
 			DownloaderInterface::shutdown();
-			HtmlTokenizer::shutdown();
 			MIMEScanner::shutdown();
 
 			return EXIT_FAILURE;
@@ -188,37 +193,30 @@
 		}
 		else
 		{
-			// Tokenize this document
-			Tokenizer *pTokens = TokenizerFactory::getTokenizerByType(docInfo.getType(), pDoc);
-			if (pTokens != NULL)
-			{
-				set<string> labels;
+			set<string> labels;
 
-				pIndex->setStemmingMode(IndexInterface::STORE_BOTH);
+			pIndex->setStemmingMode(IndexInterface::STORE_BOTH);
 
-				// Update an existing document or add to the index ?
-				docId = pIndex->hasDocument(urlToIndex);
-				if (docId > 0)
+			// Update an existing document or add to the index ?
+			docId = pIndex->hasDocument(urlToIndex);
+			if (docId > 0)
+			{
+				// Update the document
+				if (FilterWrapper::updateDocument(docId, *pIndex, *pDoc) == true)
 				{
-					// Update the document
-					if (pIndex->updateDocument(docId, *pTokens) == true)
-					{
-						success = true;
-					}
+					success = true;
 				}
-				else
-				{
-					// Index the document
-					success = pIndex->indexDocument(*pTokens, labels, docId);
-				}
+			}
+			else
+			{
+				// Index the document
+				success = FilterWrapper::indexDocument(*pIndex, *pDoc, labels, docId);
+			}
 
-				if (success == true)
-				{
-					// Flush the index
-					pIndex->flush();
-				}
-
-				delete pTokens;
+			if (success == true)
+			{
+				// Flush the index
+				pIndex->flush();
 			}
 
 			delete pDoc;
@@ -255,9 +253,8 @@
 	delete pIndex;
 
 	XapianDatabaseFactory::closeAll();
-	TokenizerFactory::unloadTokenizers();
+	Dijon::FilterFactory::unloadFilters();
 	DownloaderInterface::shutdown();
-	HtmlTokenizer::shutdown();
 	MIMEScanner::shutdown();
 
 	// Did whatever operation we carried out succeed ?

Modified: trunk/Search/pinot-search.cpp
===================================================================
--- trunk/Search/pinot-search.cpp	2007-02-09 14:14:01 UTC (rev 708)
+++ trunk/Search/pinot-search.cpp	2007-02-09 14:25:09 UTC (rev 709)
@@ -16,9 +16,9 @@
  *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
  */
 
+#include <stdlib.h>
+#include <stdio.h>
 #include <getopt.h>
-#include <cstdlib>
-#include <cstdio>
 #include <iostream>
 #include <string>
 #include <fstream>
@@ -26,8 +26,7 @@
 #include "MIMEScanner.h"
 #include "Url.h"
 #include "XapianDatabaseFactory.h"
-#include "HtmlTokenizer.h"
-#include "XmlTokenizer.h"
+#include "FilterWrapper.h"
 #include "SearchEngineFactory.h"
 #include "DownloaderFactory.h"
 #include "config.h"
@@ -36,6 +35,7 @@
 
 static struct option g_longOptions[] = {
 	{"help", 0, 0, 'h'},
+	{"max", 1, 0, 'm'},
 	{"version", 0, 0, 'v'},
 	{0, 0, 0, 0}
 };
@@ -43,10 +43,11 @@
 int main(int argc, char **argv)
 {
 	string type, option;
+	unsigned int count = 10; 
 	int longOptionIndex = 0;
 
 	// Look at the options
-	int optionChar = getopt_long(argc, argv, "hv", g_longOptions, &longOptionIndex);
+	int optionChar = getopt_long(argc, argv, "hm:v", g_longOptions, &longOptionIndex);
 	while (optionChar != -1)
 	{
 		set<string> engines;
@@ -57,9 +58,10 @@
 				// Help
 				SearchEngineFactory::getSupportedEngines(engines);
 				cout << "pinot-search - Query search engines from the command-line\n\n"
-					<< "Usage: pinot-search [OPTIONS] SEARCHENGINETYPE SEARCHENGINENAME|SEARCHENGINEOPTION QUERYSTRING MAXRESULTSCOUNT\n\n"
+					<< "Usage: pinot-search [OPTIONS] SEARCHENGINETYPE SEARCHENGINENAME|SEARCHENGINEOPTION QUERYSTRING\n\n"
 					<< "Options:\n"
 					<< "  -h, --help		display this help and exit\n"
+					<< "  -m, --max			maximum number of results (default: 10)\n"
 					<< "  -v, --version		output version information and exit\n\n"
 					<< "Supported search engine types are";
 				for (set<string>::iterator engineIter = engines.begin(); engineIter != engines.end(); ++engineIter)
@@ -70,12 +72,18 @@
 #ifdef HAVE_GOOGLEAPI
 					<< "pinot-search googleapi mygoogleapikey \"clowns\" 10\n\n"
 #endif
-					<< "pinot-search opensearch " << PREFIX << "/share/pinot/engines/KrustyDescription.xml \"clowns\" 10\n\n"
-					<< "pinot-search sherlock " << PREFIX << "/share/pinot/engines/Bozo.src \"clowns\" 10\n\n"
-					<< "pinot-search xapian ~/.pinot/index \"clowns\" 10\n\n"
+					<< "pinot-search opensearch " << PREFIX << "/share/pinot/engines/KrustyDescription.xml \"clowns\"\n\n"
+					<< "pinot-search --max 20 sherlock " << PREFIX << "/share/pinot/engines/Bozo.src \"clowns\"\n\n"
+					<< "pinot-search --max 10 xapian ~/.pinot/index \"clowns\"\n\n"
 					<< "pinot-search xapian somehostname:12345 \"clowns\" 10\n\n"
 					<< "Report bugs to " << PACKAGE_BUGREPORT << endl;
 				return EXIT_SUCCESS;
+			case 'm':
+				if (optarg != NULL)
+				{
+					count = (unsigned int )atoi(optarg);
+				}
+				break;
 			case 'v':
 				cout << "pinot-search - " << PACKAGE_STRING << "\n\n"
 					<< "This is free software.  You may redistribute copies of it under the terms of\n"
@@ -87,39 +95,37 @@
 		}
 
 		// Next option
-		optionChar = getopt_long(argc, argv, "hv", g_longOptions, &longOptionIndex);
+		optionChar = getopt_long(argc, argv, "hm:v", g_longOptions, &longOptionIndex);
 	}
 
-	if (argc < 5)
+	if ((argc < 4) ||
+		(argc - optind != 3))
 	{
 		cerr << "Not enough parameters" << endl;
 		return EXIT_FAILURE;
 	}
 
 	MIMEScanner::initialize();
-	HtmlTokenizer::initialize();
 	DownloaderInterface::initialize();
 
 	// Which SearchEngine ?
-	type = argv[1];
-	option = argv[2];
+	type = argv[optind];
+	option = argv[optind + 1];
 	SearchEngineInterface *pEngine = SearchEngineFactory::getSearchEngine(type, option);
 	if (pEngine == NULL)
 	{
 		cerr << "Couldn't obtain search engine instance" << endl;
 
 		DownloaderInterface::shutdown();
-		HtmlTokenizer::shutdown();
 		MIMEScanner::shutdown();
 
 		return EXIT_FAILURE;
 	}
 
 	// How many results ?
-	unsigned int count = atoi(argv[4]);
 	pEngine->setMaxResultsCount(count);
 
-	QueryProperties queryProps("senginetest", argv[3]);
+	QueryProperties queryProps("senginetest", argv[optind + 2]);
 	if (pEngine->runQuery(queryProps) == true)
 	{
 		string resultsPage;
@@ -143,7 +149,7 @@
 				cout << count << " Host     : " << thisUrl.getHost() << endl;
 				cout << count << " Location : " << thisUrl.getLocation() << "/" << thisUrl.getFile() << endl;
 				cout << count << " Title    : " << resultIter->getTitle() << endl;
-				cout << count << " Extract  : " << XmlTokenizer::stripTags(resultIter->getExtract()) << endl;
+				cout << count << " Extract  : " << FilterWrapper::stripMarkup(resultIter->getExtract()) << endl;
 				cout << count << " Score    : " << resultIter->getScore() << endl;
 				count++;
 
@@ -158,14 +164,13 @@
 	}
 	else
 	{
-		cerr << "Couldn't run query on search engine " << argv[1] << endl;
+		cerr << "Couldn't run query on search engine " << type << endl;
 	}
 
 	delete pEngine;
 
 	XapianDatabaseFactory::closeAll();
 	DownloaderInterface::shutdown();
-	HtmlTokenizer::shutdown();
 	MIMEScanner::shutdown();
 
 	return EXIT_SUCCESS;

Modified: trunk/UI/GTK2/src/pinot-dbus-daemon.cc
===================================================================
--- trunk/UI/GTK2/src/pinot-dbus-daemon.cc	2007-02-09 14:14:01 UTC (rev 708)
+++ trunk/UI/GTK2/src/pinot-dbus-daemon.cc	2007-02-09 14:25:09 UTC (rev 709)
@@ -33,12 +33,11 @@
 #include <glibmm/object.h>
 #include <glibmm/main.h>
 
-#include "TokenizerFactory.h"
+#include "FilterFactory.h"
 #include "Languages.h"
 #include "MIMEScanner.h"
 #include "XapianDatabase.h"
 #include "XapianDatabaseFactory.h"
-#include "HtmlTokenizer.h"
 #include "ActionQueue.h"
 #include "CrawlHistory.h"
 #include "QueryHistory.h"
@@ -82,7 +81,7 @@
 	XapianDatabaseFactory::closeAll();
 
 	// Close the tokenizer libraries
-	TokenizerFactory::unloadTokenizers();
+	Dijon::FilterFactory::unloadFilters();
 
 	// Restore the stream buffers
 	if (g_coutBuf != NULL)
@@ -96,7 +95,6 @@
 	g_outputFile.close();
 
 	DownloaderInterface::shutdown();
-	HtmlTokenizer::shutdown();
 	MIMEScanner::shutdown();
 }
 
@@ -218,7 +216,6 @@
 	Glib::setenv("XAPIAN_PREFER_FLINT", "1");
 
 	MIMEScanner::initialize();
-	HtmlTokenizer::initialize();
 	DownloaderInterface::initialize();
 	if (Glib::thread_supported() == false)
 	{
@@ -285,10 +282,10 @@
 	Languages::setIntlName(12, _("Swedish"));
 
 	// Load tokenizer libraries, if any
-	TokenizerFactory::loadTokenizers(string(LIBDIR) + string("/pinot/tokenizers"));
-	TokenizerFactory::loadTokenizers(confDirectory + string("/tokenizers"));
+	Dijon::FilterFactory::loadFilters(string(LIBDIR) + "/pinot/filters");
+	Dijon::FilterFactory::loadFilters(confDirectory + "/filters");
 	// Load the settings
-	settings.loadGlobal(string(SYSCONFDIR) + string("/pinot/globalconfig.xml"));
+	settings.loadGlobal(string(SYSCONFDIR) + "/pinot/globalconfig.xml");
 	settings.load();
 
 	// Catch interrupts

Modified: trunk/UI/GTK2/src/pinot.cc
===================================================================
--- trunk/UI/GTK2/src/pinot.cc	2007-02-09 14:14:01 UTC (rev 708)
+++ trunk/UI/GTK2/src/pinot.cc	2007-02-09 14:25:09 UTC (rev 709)
@@ -37,12 +37,11 @@
 }
 #include <gtkmm/main.h>
 
-#include "TokenizerFactory.h"
+#include "FilterFactory.h"
 #include "Languages.h"
 #include "MIMEScanner.h"
 #include "XapianDatabase.h"
 #include "XapianDatabaseFactory.h"
-#include "HtmlTokenizer.h"
 #include "ActionQueue.h"
 #include "QueryHistory.h"
 #include "ViewHistory.h"
@@ -78,7 +77,7 @@
 	XapianDatabaseFactory::closeAll();
 
 	// Close the tokenizer libraries
-	TokenizerFactory::unloadTokenizers();
+	Dijon::FilterFactory::unloadFilters();
 
 	// Restore the stream buffers
 	if (g_coutBuf != NULL)
@@ -92,7 +91,6 @@
 	g_outputFile.close();
 
 	DownloaderInterface::shutdown();
-	HtmlTokenizer::shutdown();
 	MIMEScanner::shutdown();
 }
 
@@ -147,9 +145,10 @@
 
 	// This should make Xapian use Flint rather than Quartz
 	Glib::setenv("XAPIAN_PREFER_FLINT", "1");
+	// This will be useful for indexes served by xapian-progsrv+ssh
+	Glib::setenv("SSH_ASKPASS", prefixDir + "/libexec/openssh/ssh-askpass");
 
 	MIMEScanner::initialize();
-	HtmlTokenizer::initialize();
 	DownloaderInterface::initialize();
 	if (Glib::thread_supported() == false)
 	{
@@ -216,13 +215,13 @@
 	Languages::setIntlName(12, _("Swedish"));
 
 	// Load search engines
-	settings.loadSearchEngines(prefixDir + string("/share/pinot/engines"));
-	settings.loadSearchEngines(confDirectory + string("/engines"));
+	settings.loadSearchEngines(prefixDir + "/share/pinot/engines");
+	settings.loadSearchEngines(confDirectory + "/engines");
 	// Load tokenizer libraries, if any
-	TokenizerFactory::loadTokenizers(string(LIBDIR) + string("/pinot/tokenizers"));
-	TokenizerFactory::loadTokenizers(confDirectory + string("/tokenizers"));
+	Dijon::FilterFactory::loadFilters(string(LIBDIR) + "/pinot/filters");
+	Dijon::FilterFactory::loadFilters(confDirectory + "/filters");
 	// Load the settings
-	settings.loadGlobal(string(SYSCONFDIR) + string("/pinot/globalconfig.xml"));
+	settings.loadGlobal(string(SYSCONFDIR) + "/pinot/globalconfig.xml");
 	settings.load();
 
 	// Catch interrupts
@@ -280,7 +279,7 @@
 	try
 	{
 		// Set an icon for all windows
-		Gtk::Window::set_default_icon_from_file(prefixDir + string("/share/icons/hicolor/48x48/apps/pinot.png"));
+		Gtk::Window::set_default_icon_from_file(prefixDir + "/share/icons/hicolor/48x48/apps/pinot.png");
 
 		// Create and open the main dialog box
 		mainWindow mainBox;



From fabricecolin at mail.berlios.de  Fri Feb  9 15:25:43 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Fri, 9 Feb 2007 15:25:43 +0100
Subject: [Pinot-svn] r710 - trunk/Utils
Message-ID: <200702091425.l19EPhm5028459@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-09 15:25:43 +0100 (Fri, 09 Feb 2007)
New Revision: 710

Modified:
   trunk/Utils/DocumentInfo.h
Log:
Type declaration.


Modified: trunk/Utils/DocumentInfo.h
===================================================================
--- trunk/Utils/DocumentInfo.h	2007-02-09 14:25:09 UTC (rev 709)
+++ trunk/Utils/DocumentInfo.h	2007-02-09 14:25:43 UTC (rev 710)
@@ -19,6 +19,7 @@
 #ifndef _DOCUMENT_INFO_H
 #define _DOCUMENT_INFO_H
 
+#include <sys/types.h>
 #include <string>
 #include <set>
 



From fabricecolin at mail.berlios.de  Fri Feb  9 16:09:46 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Fri, 9 Feb 2007 16:09:46 +0100
Subject: [Pinot-svn] r711 - in trunk: . Index Search/Google
Message-ID: <200702091509.l19F9kc9030654@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-09 16:09:44 +0100 (Fri, 09 Feb 2007)
New Revision: 711

Modified:
   trunk/Index/Makefile.am
   trunk/Makefile.am
   trunk/README
   trunk/Search/Google/Makefile.am
   trunk/pinot.spec.in
Log:
Install the new catalogs and the AUTHORS file.
New dependency on openssh-askpass.
Makefile typo fixes.


Modified: trunk/Index/Makefile.am
===================================================================
--- trunk/Index/Makefile.am	2007-02-09 14:25:43 UTC (rev 710)
+++ trunk/Index/Makefile.am	2007-02-09 15:09:44 UTC (rev 711)
@@ -16,7 +16,7 @@
 
 libIndex_la_SOURCES = \
 	DBusXapianIndex.cpp \
-	FilterWrapper.cc \
+	FilterWrapper.cpp \
 	IndexFactory.cpp \
 	LanguageDetector.cpp \
 	XapianDatabase.cpp \

Modified: trunk/Makefile.am
===================================================================
--- trunk/Makefile.am	2007-02-09 14:25:43 UTC (rev 710)
+++ trunk/Makefile.am	2007-02-09 15:09:44 UTC (rev 711)
@@ -1,7 +1,7 @@
 
 SUBDIRS = po Utils Tokenize SQL Collect Index @SOAP_SUBDIRS@ Search Monitor UI/GTK2/src
 
-EXTRA_DIST = ChangeLog NEWS README TODO mkinstalldirs \
+EXTRA_DIST = AUTHORS ChangeLog NEWS README TODO mkinstalldirs \
 	globalconfig.xml textcat_conf.txt textcat3_conf.txt \
 	pinot.desktop pinot-dbus-daemon.desktop pinot.spec \
 	Search/Plugins/*src Search/Plugins/*.xml \
@@ -30,9 +30,9 @@
 	$(INSTALL_DATA) Search/Plugins/*.src $(DESTDIR)$(datadir)/pinot/engines/
 	@mv $(DESTDIR)$(datadir)/pinot/engines/AmazonAPI.src $(DESTDIR)$(datadir)/pinot/
 	$(INSTALL_DATA) Search/Plugins/*.xml $(DESTDIR)$(datadir)/pinot/engines/
-	$(mkinstalldirs) $(DESTDIR)$(libdir)/pinot/tokenizers
-	@rm $(DESTDIR)$(libdir)/lib*tokenizer.a $(DESTDIR)$(libdir)/lib*tokenizer.la
-	@mv $(DESTDIR)$(libdir)/lib*tokenizer* $(DESTDIR)$(libdir)/pinot/tokenizers/
+	$(mkinstalldirs) $(DESTDIR)$(libdir)/pinot/filters
+	@rm $(DESTDIR)$(libdir)/lib*filter.a $(DESTDIR)$(libdir)/lib*filter.la
+	@mv $(DESTDIR)$(libdir)/lib*filter* $(DESTDIR)$(libdir)/pinot/filters/
 	$(mkinstalldirs) $(DESTDIR)$(datadir)/icons/hicolor/48x48/apps/
 	$(INSTALL_DATA) UI/GTK2/pinot.png $(DESTDIR)$(datadir)/icons/hicolor/48x48/apps/pinot.png
 	$(mkinstalldirs) $(DESTDIR)$(datadir)/applications

Modified: trunk/README
===================================================================
--- trunk/README	2007-02-09 14:25:43 UTC (rev 710)
+++ trunk/README	2007-02-09 15:09:44 UTC (rev 711)
@@ -364,6 +364,10 @@
 
 TagLib							1.4
 http://ktown.kde.org/~wheeler/taglib/
+
+openssh-askpass						4.3
+http://www.openssh.com/portable.html
+
 ---------------------------------------------------------------
 Notes :
 (1) enabled with "./configure --with-http=neon|curl"

Modified: trunk/Search/Google/Makefile.am
===================================================================
--- trunk/Search/Google/Makefile.am	2007-02-09 14:25:43 UTC (rev 710)
+++ trunk/Search/Google/Makefile.am	2007-02-09 15:09:44 UTC (rev 711)
@@ -22,7 +22,7 @@
 GAPIClientLib.cpp : GoogleSearch.h
 	soapcpp2 -n -pGAPI -I /usr/include/gsoap/import GoogleSearch.h
 
-AM_CXXFLAGS = -I$(srcdir)/../../Utils -I$(srcdir)/../../Tokenize
+AM_CXXFLAGS = -I$(srcdir)/../../Utils -I$(srcdir)/../../Tokenize \
 	-I$(srcdir)/../../Tokenize/filters -I../../Collect -I../../Index -I.. \
 	@HTTP_CFLAGS@ @XML_CFLAGS@ @SOAP_CFLAGS@ @INDEX_CFLAGS@ @GMIME_CFLAGS@
 

Modified: trunk/pinot.spec.in
===================================================================
--- trunk/pinot.spec.in	2007-02-09 14:25:43 UTC (rev 710)
+++ trunk/pinot.spec.in	2007-02-09 15:09:44 UTC (rev 711)
@@ -26,7 +26,7 @@
 BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
 Requires: xapian-core-libs >= 0.9.7, libtextcat >= 2.2, sqlite >= 3.1.2, curl >= 7.13, gmime >= 2.1
 Requires: gtkmm24 >= 2.6, libxml++ >= 2.12, %{dbus_pkg} >= 0.60, shared-mime-info
-Requires: unzip, antiword, unrtf, %{pftotext_pkg}
+Requires: unzip, antiword, unrtf, %{pftotext_pkg}, openssh-askpass
 BuildRequires: xapian-core-devel >= 0.9.7, libtextcat-devel >= 2.2, sqlite-devel >= 3.1.2, curl-devel >= 7.13, gmime-devel >= 2.1, boost-devel >= 1.32
 BuildRequires: gtkmm24-devel >= 2.6, libxml++-devel >= 2.12, %{dbus_dev_pkg} >= 0.60, gettext-devel, desktop-file-utils
 BuildRequires: taglib-devel >= 1.4
@@ -47,7 +47,7 @@
 Requires: taglib >= 1.4
 
 %description audio-docs 
-The included tokenizer adds support for OGG, MP3 and FLAC files.
+The included filter adds support for OGG, MP3 and FLAC files.
 
 %package omega 
 Summary: Xapian Omega plugin for Pinot
@@ -86,7 +86,7 @@
 
 %files
 %defattr(-, root, root, -)
-%doc ChangeLog COPYING NEWS README TODO
+%doc AUTHORS ChangeLog COPYING NEWS README TODO
 %config(noreplace) %{_sysconfdir}/pinot/globalconfig.xml
 %config(noreplace) %{_sysconfdir}/pinot/textcat_conf.txt
 %config(noreplace) %{_sysconfdir}/pinot/textcat3_conf.txt
@@ -95,10 +95,8 @@
 %{_bindir}/pinot-dbus-daemon
 %{_bindir}/pinot-index
 %{_bindir}/pinot-search
-%{_libdir}/pinot/tokenizers/libopendocumenttokenizer.so*
-%{_libdir}/pinot/tokenizers/libpdftokenizer.so*
-%{_libdir}/pinot/tokenizers/librtftokenizer.so*
-%{_libdir}/pinot/tokenizers/libwordtokenizer.so*
+%{_libdir}/pinot/filters/libexternalfilter.so*
+%{_libdir}/pinot/filters/libmboxfilter.so*
 %{_datadir}/pinot/xapian-powered.png
 %{_datadir}/pinot/metase-gtk2.glade
 %{_datadir}/pinot/metase-gtk2.gladep
@@ -128,6 +126,8 @@
 %{_datadir}/locale/fr/LC_MESSAGES/pinot.mo
 %{_datadir}/locale/es/LC_MESSAGES/pinot.mo
 %{_datadir}/locale/nl/LC_MESSAGES/pinot.mo
+%{_datadir}/locale/pt_BR/LC_MESSAGES/pinot.mo
+%{_datadir}/locale/ru/LC_MESSAGES/pinot.mo
 %{_datadir}/locale/sv/LC_MESSAGES/pinot.mo
 %{_datadir}/icons/hicolor/48x48/apps/pinot.png
 %{_sysconfdir}/xdg/autostart/*.desktop
@@ -140,7 +140,7 @@
 
 %files audio-docs 
 %defattr(-, root, root, -)
-%{_libdir}/pinot/tokenizers/libtaglibtokenizer.so*
+%{_libdir}/pinot/filters/libtaglibfilter.so*
 
 %files omega
 %defattr(-, root, root, -)



From fabricecolin at mail.berlios.de  Sat Feb 10 07:11:31 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 10 Feb 2007 07:11:31 +0100
Subject: [Pinot-svn] r712 - trunk
Message-ID: <200702100611.l1A6BV8Y004351@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-10 07:11:30 +0100 (Sat, 10 Feb 2007)
New Revision: 712

Modified:
   trunk/Makefile.am
   trunk/pinot.spec.in
Log:
Distribute and install external-filters.xml.


Modified: trunk/Makefile.am
===================================================================
--- trunk/Makefile.am	2007-02-09 15:09:44 UTC (rev 711)
+++ trunk/Makefile.am	2007-02-10 06:11:30 UTC (rev 712)
@@ -2,7 +2,8 @@
 SUBDIRS = po Utils Tokenize SQL Collect Index @SOAP_SUBDIRS@ Search Monitor UI/GTK2/src
 
 EXTRA_DIST = AUTHORS ChangeLog NEWS README TODO mkinstalldirs \
-	globalconfig.xml textcat_conf.txt textcat3_conf.txt \
+	Tokenize/filters/external-filters.xml globalconfig.xml \
+	textcat_conf.txt textcat3_conf.txt \
 	pinot.desktop pinot-dbus-daemon.desktop pinot.spec \
 	Search/Plugins/*src Search/Plugins/*.xml \
 	Collect/pinot-collect.1 Index/pinot-index.1 Search/pinot-search.1 \
@@ -17,6 +18,7 @@
 
 install-data-local:
 	$(mkinstalldirs) $(DESTDIR)$(sysconfdir)/pinot
+	$(INSTALL_DATA) Tokenize/filters/external-filters.xml $(DESTDIR)$(sysconfdir)/pinot/external-filters.xml
 	$(INSTALL_DATA) globalconfig.xml $(DESTDIR)$(sysconfdir)/pinot/globalconfig.xml
 	$(INSTALL_DATA) textcat_conf.txt $(DESTDIR)$(sysconfdir)/pinot/textcat_conf.txt
 	$(INSTALL_DATA) textcat3_conf.txt $(DESTDIR)$(sysconfdir)/pinot/textcat3_conf.txt

Modified: trunk/pinot.spec.in
===================================================================
--- trunk/pinot.spec.in	2007-02-09 15:09:44 UTC (rev 711)
+++ trunk/pinot.spec.in	2007-02-10 06:11:30 UTC (rev 712)
@@ -87,6 +87,7 @@
 %files
 %defattr(-, root, root, -)
 %doc AUTHORS ChangeLog COPYING NEWS README TODO
+%config(noreplace) %{_sysconfdir}/pinot/external-filters.xml
 %config(noreplace) %{_sysconfdir}/pinot/globalconfig.xml
 %config(noreplace) %{_sysconfdir}/pinot/textcat_conf.txt
 %config(noreplace) %{_sysconfdir}/pinot/textcat3_conf.txt



From fabricecolin at mail.berlios.de  Fri Feb 16 16:02:14 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Fri, 16 Feb 2007 16:02:14 +0100
Subject: [Pinot-svn] r713 - in trunk: Collect Index Tokenize UI/GTK2/src
	Utils
Message-ID: <200702161502.l1GF2EKQ006541@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-16 16:02:12 +0100 (Fri, 16 Feb 2007)
New Revision: 713

Added:
   trunk/Tokenize/FilterUtils.cpp
   trunk/Tokenize/FilterUtils.h
Removed:
   trunk/Utils/MboxParser.cpp
   trunk/Utils/MboxParser.h
Modified:
   trunk/Collect/MboxCollector.cpp
   trunk/Index/FilterWrapper.cpp
   trunk/Index/FilterWrapper.h
   trunk/Tokenize/Makefile.am
   trunk/UI/GTK2/src/MboxHandler.cpp
   trunk/UI/GTK2/src/MboxHandler.h
   trunk/Utils/Makefile.am
Log:
Moved FilterWrapper's non-indexing related methods to FilterUtils.
The mbox filter obsoletes MboxParser. Updated MboxCollector and MboxHandler.


Modified: trunk/Collect/MboxCollector.cpp
===================================================================
--- trunk/Collect/MboxCollector.cpp	2007-02-10 06:11:30 UTC (rev 712)
+++ trunk/Collect/MboxCollector.cpp	2007-02-16 15:02:12 UTC (rev 713)
@@ -19,9 +19,10 @@
 #include <iostream>
 #include <algorithm>
 
-#include "MboxParser.h"
 #include "StringManip.h"
 #include "Url.h"
+#include "FilterFactory.h"
+#include "FilterUtils.h"
 #include "MboxCollector.h"
 
 using namespace std;
@@ -43,9 +44,8 @@
 Document *MboxCollector::retrieveUrl(const DocumentInfo &docInfo)
 {
 	Url thisUrl(docInfo.getLocation());
-	string protocol = thisUrl.getProtocol();
-	off_t messageOffset = 0;
-	int partNum = 0;
+	string protocol(thisUrl.getProtocol());
+	string parameters(thisUrl.getParameters());
 
 	if (protocol != "mailbox")
 	{
@@ -53,36 +53,35 @@
 		return NULL;
 	}
 
-	// Extract the offset
-	string offset = StringManip::extractField(thisUrl.getParameters(), "o=", "&p=");
-	if (offset.empty() == true)
+	// Is there an offset and part number ?
+	if ((parameters.find("o=") == string::npos) ||
+		(parameters.find("p=") == string::npos))
 	{
 		return NULL;
 	}
-	messageOffset = (off_t)atol(offset.c_str());
-	// ...and the part number
-	string number = StringManip::extractField(thisUrl.getParameters(), "p=", "");
-	if (number.empty() == false)
+
+	// Get the mbox filter
+	Dijon::Filter *pFilter = Dijon::FilterFactory::getFilter("application/mbox");
+	if (pFilter == NULL)
 	{
-		partNum = atoi(number.c_str());
+		return NULL;
 	}
 
-	string directoryName = thisUrl.getLocation();
-	string fileName = thisUrl.getFile();
-	string fileLocation = directoryName;
-	fileLocation += "/";
-	fileLocation += fileName;
+	Document *pMessage = new Document(docInfo);
+	if ((FilterUtils::feedFilter(*pMessage, pFilter) == false) ||
+		(pFilter->skip_to_document(parameters) == false))
+	{
+		delete pFilter;
+		return NULL;
+	}
 
-	// Get a parser
-	MboxParser boxParser(fileLocation, messageOffset, partNum);
 	// The first document should be the message we are interested in
-	// FIXME: don't ignore the part number (p=...)
-	const Document *pMessage = boxParser.getDocument();
-	if (pMessage == NULL)
+	if (pFilter->has_documents() == true)
 	{
-		return NULL;
+		FilterUtils::populateDocument(*pMessage, pFilter);
 	}
 
-	// Copy the message
-	return new Document(*pMessage);
+	delete pFilter;
+
+	return pMessage;
 }

Modified: trunk/Index/FilterWrapper.cpp
===================================================================
--- trunk/Index/FilterWrapper.cpp	2007-02-10 06:11:30 UTC (rev 712)
+++ trunk/Index/FilterWrapper.cpp	2007-02-16 15:02:12 UTC (rev 713)
@@ -17,10 +17,10 @@
  */
 
 #include <iostream>
-#include <map>
 
 #include "Url.h"
 #include "FilterFactory.h"
+#include "FilterUtils.h"
 #include "FilterWrapper.h"
 
 using std::cout;
@@ -28,7 +28,6 @@
 using std::endl;
 using std::string;
 using std::set;
-using std::map;
 using namespace Dijon;
 
 FilterWrapper::FilterWrapper()
@@ -39,108 +38,6 @@
 {
 }
 
-bool FilterWrapper::feedFilter(const Document &doc, Dijon::Filter *pFilter)
-{
-	string location(doc.getLocation());
-	Url urlObj(location);
-	string fileName;
-	unsigned int dataLength = 0;
-	const char *pData = doc.getData(dataLength);
-	bool fedInput = false, success = false;
-
-	if (pFilter == NULL)
-	{
-		return false;
-	}
-
-	if ((urlObj.getProtocol() == "file") &&
-		(location .length() > 7))
-	{
-		fileName = location.substr(7);
-	}
-
-	// Prefer feeding the data
-	if (((dataLength > 0) && (pData != NULL)) &&
-		(pFilter->is_data_input_ok(Filter::DOCUMENT_DATA) == true))
-	{
-#ifdef DEBUG
-		cout << "FilterWrapper::getFilter: feeding data" << endl;
-#endif
-		fedInput = pFilter->set_document_data(pData, dataLength);
-	}
-	// ... to feeding the file
-	if ((fedInput == false) &&
-		(fileName.empty() == false))
-	{ 
-		if (pFilter->is_data_input_ok(Filter::DOCUMENT_FILE_NAME) == true)
-		{
-#ifdef DEBUG
-			cout << "FilterWrapper::getFilter: feeding file " << fileName << endl;
-#endif
-			fedInput = pFilter->set_document_file(fileName);
-		}
-		// ...and to feeding the file's contents
-		if ((fedInput == false) &&
-			(pFilter->is_data_input_ok(Filter::DOCUMENT_DATA) == true))
-		{
-			Document docCopy(doc);
-
-			if (docCopy.setDataFromFile(fileName) == false)
-			{
-				cerr << "Couldn't load " << fileName << endl;
-
-				return false;
-			}
-#ifdef DEBUG
-			cout << "FilterWrapper::getFilter: feeding contents of file " << fileName << endl;
-#endif
-
-			pData = docCopy.getData(dataLength);
-			if ((dataLength > 0) &&
-				(pData != NULL))
-			{
-				fedInput = pFilter->set_document_data(pData, dataLength);
-			}
-		}
-	}
-
-	if (fedInput == false)
-	{
-		cerr << "Couldn't feed filter for " << doc.getLocation() << endl;
-
-		return false;
-	}
-
-	return true;
-}
-
-string FilterWrapper::stripMarkup(const string &text)
-{
-	Dijon::Filter *pFilter = Dijon::FilterFactory::getFilter("text/xml");
-	string strippedText;
-
-	if (pFilter == NULL)
-	{
-		return "";
-	}
-
-	Document doc;
-	doc.setData(text.c_str(), text.length());
-	if (feedFilter(doc, pFilter) == true)
-	{
-		const map<string, string> &metaData = pFilter->get_meta_data();
-		map<string, string>::const_iterator contentIter = metaData.find("content");
-		if (contentIter != metaData.end())
-		{
-			strippedText = contentIter->second;
-		}
-	}
-
-	delete pFilter;
-
-	return strippedText;
-}
-
 bool FilterWrapper::indexDocument(IndexInterface &index, const Document &doc,
 	const set<string> &labels, unsigned int &docId)
 {
@@ -149,7 +46,6 @@
 	return filterDocument(index, docCopy, 0, labels, docId, false);
 }
 
-/// Updates the given document.
 bool FilterWrapper::updateDocument(unsigned int docId, IndexInterface &index, const Document &doc)
 {
 	Document docCopy(doc);
@@ -170,7 +66,7 @@
 		return false;
 	}
 
-	if (feedFilter(doc, pFilter) == false)
+	if (FilterUtils::feedFilter(doc, pFilter) == false)
 	{
 		delete pFilter;
 
@@ -180,67 +76,20 @@
 	while (pFilter->has_documents() == true)
 	{
 		Document filteredDoc(doc.getTitle(), doc.getLocation(), "text/plain", doc.getLanguage());
-		string uri, ipath;
-		unsigned int dataLength = 0;
 
 		if (pFilter->next_document() == false)
 		{
 			break;
 		}
-		cout << "##### Document " << ++count << endl;
 
-		const map<string, string> &metaData = pFilter->get_meta_data();
-		for (map<string, string>::const_iterator metaIter = metaData.begin();
-			metaIter != metaData.end(); ++metaIter)
+		if (FilterUtils::populateDocument(filteredDoc, pFilter) == false)
 		{
-			if (metaIter->first == "content")
-			{
-				filteredDoc.setData(metaIter->second.c_str(), metaIter->second.length());
-
-				cout << "Set " << metaIter->second.length() << " characters of data" << endl;
-			}
-			else if (metaIter->first == "ipath")
-			{
-				ipath = metaIter->second;
-			}
-			else if (metaIter->first == "language")
-			{
-				filteredDoc.setLanguage(metaIter->second);
-			}
-			else if (metaIter->first == "mimetype")
-			{
-				filteredDoc.setType(metaIter->second);
-			}
-			else if (metaIter->first == "size")
-			{
-				filteredDoc.setSize((off_t)atoi(metaIter->second.c_str()));
-			}
-			else if (metaIter->first == "title")
-			{
-				filteredDoc.setTitle(metaIter->second);
-			}
-			else if (metaIter->first == "uri")
-			{
-				uri = metaIter->second;
-			}
+			continue;
 		}
 
-		if (uri.empty() == false)
-		{
-			filteredDoc.setLocation(uri);
-		}
-		if (ipath.empty() == false)
-		{
-			filteredDoc.setLocation(filteredDoc.getLocation() + "?" + ipath);
-		}
-		cout << "Location: " << filteredDoc.getLocation() << endl;
-		cout << "MIME type: " << filteredDoc.getType() << endl;
-
 		// Pass it down to another filter ?
 		if (filteredDoc.getType() != "text/plain")
 		{
-			cout << "Passing down to another filter" << endl;
-
 			filterDocument(index, filteredDoc, count, labels, docId, doUpdate);
 		}
 		else
@@ -262,4 +111,3 @@
 
 	return success;
 }
-

Modified: trunk/Index/FilterWrapper.h
===================================================================
--- trunk/Index/FilterWrapper.h	2007-02-10 06:11:30 UTC (rev 712)
+++ trunk/Index/FilterWrapper.h	2007-02-16 15:02:12 UTC (rev 713)
@@ -32,12 +32,6 @@
 	public:
 		virtual ~FilterWrapper();
 
-		/// Feeds a document's data to a filter.
-		static bool feedFilter(const Document &doc, Dijon::Filter *pFilter);
-
-		/// Strips markup from a piece of text.
-		static std::string stripMarkup(const std::string &text);
-
 		/// Indexes the given data.
 		static bool indexDocument(IndexInterface &index, const Document &doc,
 			const std::set<std::string> &labels, unsigned int &docId);

Added: trunk/Tokenize/FilterUtils.cpp
===================================================================
--- trunk/Tokenize/FilterUtils.cpp	2007-02-10 06:11:30 UTC (rev 712)
+++ trunk/Tokenize/FilterUtils.cpp	2007-02-16 15:02:12 UTC (rev 713)
@@ -0,0 +1,212 @@
+/*
+ *  Copyright 2007 Fabrice Colin
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU Library General Public License for more details.
+ *
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+ */
+
+#include <iostream>
+#include <map>
+
+#include "Url.h"
+#include "FilterFactory.h"
+#include "FilterUtils.h"
+
+using std::cout;
+using std::cerr;
+using std::endl;
+using std::string;
+using std::set;
+using std::map;
+using namespace Dijon;
+
+FilterUtils::FilterUtils()
+{
+}
+
+FilterUtils::~FilterUtils()
+{
+}
+
+bool FilterUtils::feedFilter(const Document &doc, Dijon::Filter *pFilter)
+{
+	string location(doc.getLocation());
+	Url urlObj(location);
+	string fileName;
+	unsigned int dataLength = 0;
+	const char *pData = doc.getData(dataLength);
+	bool fedInput = false, success = false;
+
+	if (pFilter == NULL)
+	{
+		return false;
+	}
+
+	if ((urlObj.getProtocol() == "file") &&
+		(location .length() > 7))
+	{
+		fileName = location.substr(7);
+	}
+	else if ((urlObj.getProtocol() == "mailbox") &&
+		(location .length() > 10))
+	{
+		fileName = location.substr(10);
+		string::size_type pos = fileName.find("?");
+		if (pos != string::npos)
+		{
+			fileName.resize(pos);
+		}
+	}
+
+	// Prefer feeding the data
+	if (((dataLength > 0) && (pData != NULL)) &&
+		(pFilter->is_data_input_ok(Filter::DOCUMENT_DATA) == true))
+	{
+#ifdef DEBUG
+		cout << "FilterUtils::getFilter: feeding data" << endl;
+#endif
+		fedInput = pFilter->set_document_data(pData, dataLength);
+	}
+	// ... to feeding the file
+	if ((fedInput == false) &&
+		(fileName.empty() == false))
+	{ 
+		if (pFilter->is_data_input_ok(Filter::DOCUMENT_FILE_NAME) == true)
+		{
+#ifdef DEBUG
+			cout << "FilterUtils::getFilter: feeding file " << fileName << endl;
+#endif
+			fedInput = pFilter->set_document_file(fileName);
+		}
+		// ...and to feeding the file's contents
+		if ((fedInput == false) &&
+			(pFilter->is_data_input_ok(Filter::DOCUMENT_DATA) == true))
+		{
+			Document docCopy(doc);
+
+			if (docCopy.setDataFromFile(fileName) == false)
+			{
+				cerr << "Couldn't load " << fileName << endl;
+
+				return false;
+			}
+#ifdef DEBUG
+			cout << "FilterUtils::getFilter: feeding contents of file " << fileName << endl;
+#endif
+
+			pData = docCopy.getData(dataLength);
+			if ((dataLength > 0) &&
+				(pData != NULL))
+			{
+				fedInput = pFilter->set_document_data(pData, dataLength);
+			}
+		}
+	}
+
+	if (fedInput == false)
+	{
+		cerr << "Couldn't feed filter for " << doc.getLocation() << endl;
+
+		return false;
+	}
+
+	return true;
+}
+
+bool FilterUtils::populateDocument(Document &doc, Dijon::Filter *pFilter)
+{
+	string uri, ipath;
+
+	if (pFilter == NULL)
+	{
+		return false;
+	}
+
+	const map<string, string> &metaData = pFilter->get_meta_data();
+	for (map<string, string>::const_iterator metaIter = metaData.begin();
+		metaIter != metaData.end(); ++metaIter)
+	{
+		if (metaIter->first == "content")
+		{
+			doc.setData(metaIter->second.c_str(), metaIter->second.length());
+#ifdef DEBUG
+			cout << "FilterUtils:populateDocument: set " << metaIter->second.length()
+				<< " characters of data" << endl;
+#endif
+		}
+		else if (metaIter->first == "ipath")
+		{
+			ipath = metaIter->second;
+		}
+		else if (metaIter->first == "language")
+		{
+			doc.setLanguage(metaIter->second);
+		}
+		else if (metaIter->first == "mimetype")
+		{
+			doc.setType(metaIter->second);
+		}
+		else if (metaIter->first == "size")
+		{
+			doc.setSize((off_t)atoi(metaIter->second.c_str()));
+		}
+		else if (metaIter->first == "title")
+		{
+			doc.setTitle(metaIter->second);
+		}
+		else if (metaIter->first == "uri")
+		{
+			uri = metaIter->second;
+		}
+	}
+
+	if (uri.empty() == false)
+	{
+		doc.setLocation(uri);
+	}
+	if (ipath.empty() == false)
+	{
+		doc.setLocation(doc.getLocation() + "?" + ipath);
+	}
+
+	return true;
+}
+
+string FilterUtils::stripMarkup(const string &text)
+{
+	Dijon::Filter *pFilter = Dijon::FilterFactory::getFilter("text/xml");
+	string strippedText;
+
+	if (pFilter == NULL)
+	{
+		return "";
+	}
+
+	Document doc;
+	doc.setData(text.c_str(), text.length());
+	if ((feedFilter(doc, pFilter) == true) &&
+		(pFilter->next_document() == true))
+	{
+		const map<string, string> &metaData = pFilter->get_meta_data();
+		map<string, string>::const_iterator contentIter = metaData.find("content");
+		if (contentIter != metaData.end())
+		{
+			strippedText = contentIter->second;
+		}
+	}
+
+	delete pFilter;
+
+	return strippedText;
+}

Added: trunk/Tokenize/FilterUtils.h
===================================================================
--- trunk/Tokenize/FilterUtils.h	2007-02-10 06:11:30 UTC (rev 712)
+++ trunk/Tokenize/FilterUtils.h	2007-02-16 15:02:12 UTC (rev 713)
@@ -0,0 +1,52 @@
+/*
+ *  Copyright 2007 Fabrice Colin
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU Library General Public License for more details.
+ *
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+ */
+
+#ifndef _FILTER_UTILS_H
+#define _FILTER_UTILS_H
+
+#include <string>
+#include <set>
+
+#include "Document.h"
+#include "Filter.h"
+
+/// Utility functions for dealing with Dijon filters.
+class FilterUtils
+{
+	public:
+		virtual ~FilterUtils();
+
+		/// Feeds a document's data to a filter.
+		static bool feedFilter(const Document &doc, Dijon::Filter *pFilter);
+
+		/// Populates a document based on metadata extracted by the filter.
+		static bool populateDocument(Document &doc, Dijon::Filter *pFilter);
+
+		/// Strips markup from a piece of text.
+		static std::string stripMarkup(const std::string &text);
+
+	protected:
+		FilterUtils();
+
+	private:
+		FilterUtils(const FilterUtils &other);
+		FilterUtils &operator=(const FilterUtils &other);
+
+};
+
+#endif // _FILTER_UTILS_H

Modified: trunk/Tokenize/Makefile.am
===================================================================
--- trunk/Tokenize/Makefile.am	2007-02-10 06:11:30 UTC (rev 712)
+++ trunk/Tokenize/Makefile.am	2007-02-16 15:02:12 UTC (rev 713)
@@ -1,6 +1,7 @@
 # Process this file with automake to produce Makefile.in
 
 noinst_HEADERS = \
+	FilterUtils.h \
 	Tokenizer.h \
 	filters/ExternalFilter.h \
 	filters/HtmlFilter.h \
@@ -38,13 +39,14 @@
 libtaglibfilter_la_LIBADD = -L../Utils -lBasicUtils
 
 libTokenize_la_SOURCES = \
+	FilterUtils.cpp \
 	Tokenizer.cpp \
 	filters/FilterFactory.cc \
 	filters/HtmlFilter.cc \
 	filters/TextFilter.cc \
 	filters/XmlFilter.cc
 
-AM_CXXFLAGS = -fPIC -I$(srcdir)/../Utils \
+AM_CXXFLAGS = -fPIC -I$(srcdir)/../Utils -Ifilters \
 	@GMIME_CFLAGS@ @XML_CFLAGS@ @TAGLIB_CFLAGS@ -D_DYNAMIC_DIJON_FILTERS \
 	-D_DIJON_EXTERNALFILTER_CONFFILE=\"$(sysconfdir)/pinot/external-filters.xml\"
 

Modified: trunk/UI/GTK2/src/MboxHandler.cpp
===================================================================
--- trunk/UI/GTK2/src/MboxHandler.cpp	2007-02-10 06:11:30 UTC (rev 712)
+++ trunk/UI/GTK2/src/MboxHandler.cpp	2007-02-16 15:02:12 UTC (rev 713)
@@ -29,6 +29,8 @@
 #include "Timer.h"
 #include "TimeConverter.h"
 #include "Url.h"
+#include "FilterFactory.h"
+#include "FilterUtils.h"
 #include "FilterWrapper.h"
 #include "XapianDatabase.h"
 #include "MboxHandler.h"
@@ -123,11 +125,25 @@
 		return false;
 	}
 
-	// Get a parser
-	MboxParser boxParser(fileName, mboxOffset);
+	// Get the mbox filter
+	Dijon::Filter *pFilter = Dijon::FilterFactory::getFilter("application/mbox");
+	if (pFilter == NULL)
+	{
+		return false;
+	}
 
-	bool indexedFile = parseMailAccount(boxParser, sourceLabel);
+	Document emptyDoc;
+	emptyDoc.setLocation(string("file://") + fileName);
+	if (FilterUtils::feedFilter(emptyDoc, pFilter) == false)
+	{
+		delete pFilter;
+		return false;
+	}
 
+	bool indexedFile = parseMailAccount(pFilter, sourceLabel);
+
+	delete pFilter;
+
 	// Flush the index
 	m_index.flush();
 
@@ -137,11 +153,10 @@
 	return indexedFile;
 }
 
-bool MboxHandler::parseMailAccount(MboxParser &boxParser, const string &sourceLabel)
+bool MboxHandler::parseMailAccount(Dijon::Filter *pFilter, const string &sourceLabel)
 {
 	set<unsigned int> docIdList;
 	set<string> labels;
-	const Document *pMessage = boxParser.getDocument();
 	char sourceStr[64];
 	unsigned int docNum = 0;
 	bool indexedFile = false;
@@ -159,16 +174,20 @@
 	labels.insert(sourceLabel);
 
 	// Parse the mbox file
-	while (pMessage != NULL)
+	while (pFilter->next_document() == true)
 	{
+		Document currentMessage;
+
+		FilterUtils::populateDocument(currentMessage, pFilter);
+
 		// Has this message already been indexed ?
-		unsigned int docId = m_index.hasDocument(pMessage->getLocation());
+		unsigned int docId = m_index.hasDocument(currentMessage.getLocation());
 		if (docId == 0)
 		{
 			m_index.setStemmingMode(IndexInterface::STORE_BOTH);
 
 			unsigned int docId = 0;
-			indexedFile = FilterWrapper::indexDocument(m_index, *pMessage, labels, docId);
+			indexedFile = FilterWrapper::indexDocument(m_index, currentMessage, labels, docId);
 #ifdef DEBUG
 			if (indexedFile == false)
 			{
@@ -190,15 +209,6 @@
 			}
 		}
 
-		// More messages ?
-		if (boxParser.nextMessage() == false)
-		{
-#ifdef DEBUG
-			cout << "MboxHandler::parseMailAccount: no more messages from parser" << endl;
-#endif
-			break;
-		}
-		pMessage = boxParser.getDocument();
 		++docNum;
 	}
 #ifdef DEBUG

Modified: trunk/UI/GTK2/src/MboxHandler.h
===================================================================
--- trunk/UI/GTK2/src/MboxHandler.h	2007-02-10 06:11:30 UTC (rev 712)
+++ trunk/UI/GTK2/src/MboxHandler.h	2007-02-16 15:02:12 UTC (rev 713)
@@ -25,7 +25,7 @@
 #include <sigc++/slot.h>
 
 #include "IndexedDocument.h"
-#include "MboxParser.h"
+#include "Filter.h"
 #include "CrawlHistory.h"
 #include "MonitorHandler.h"
 #include "XapianIndex.h"
@@ -76,7 +76,7 @@
 		bool indexMessages(const std::string &fileName, PinotSettings::TimestampedItem &mailAccount,
 			off_t mboxOffset);
 
-		bool parseMailAccount(MboxParser &boxParser, const std::string &sourceLabel);
+		bool parseMailAccount(Dijon::Filter *pFilter, const std::string &sourceLabel);
 
 		bool deleteMessages(std::set<unsigned int> &docIdList);
 

Modified: trunk/Utils/Makefile.am
===================================================================
--- trunk/Utils/Makefile.am	2007-02-10 06:11:30 UTC (rev 712)
+++ trunk/Utils/Makefile.am	2007-02-16 15:02:12 UTC (rev 713)
@@ -6,7 +6,6 @@
 	DocumentInfo.h \
 	IndexedDocument.h \
 	Languages.h \
-	MboxParser.h \
 	MIMEScanner.h \
 	NLS.h \
 	Result.h \
@@ -35,7 +34,6 @@
 libUtils_la_SOURCES = \
 	IndexedDocument.cpp \
 	Languages.cpp \
-	MboxParser.cpp \
 	MIMEScanner.cpp \
 	Result.cpp \
 	Timer.cpp \

Deleted: trunk/Utils/MboxParser.cpp
===================================================================
--- trunk/Utils/MboxParser.cpp	2007-02-10 06:11:30 UTC (rev 712)
+++ trunk/Utils/MboxParser.cpp	2007-02-16 15:02:12 UTC (rev 713)
@@ -1,401 +0,0 @@
-/*
- *  Copyright 2005,2006 Fabrice Colin
- *
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU Library General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
- */
-
-#include <string.h>
-#include <sys/types.h>
-#include <sys/stat.h>
-#include <fcntl.h>
-#include <regex.h>
-#include <iostream>
-#include <algorithm>
-
-#include <gmime/gmime.h>
-
-#include "TimeConverter.h"
-#include "Url.h"
-#include "MboxParser.h"
-
-using std::cout;
-using std::endl;
-
-MboxParser::MboxParser(const string &fileName, off_t mboxOffset, int partNum) :
-	m_fileName(fileName),
-	m_fd(-1),
-	m_pMboxStream(NULL),
-	m_pParser(NULL),
-	m_pMimeMessage(NULL),
-	m_partsCount(-1),
-	m_partNum(partNum),
-	m_messageStart(mboxOffset),
-	m_pCurrentDocument(NULL)
-{
-	if (initialize() == true)
-	{
-		DocumentInfo docInfo;
-
-		// Extract the first message
-		extractMessage("");
-	}
-}
-
-MboxParser::~MboxParser()
-{
-	if (m_pMimeMessage != NULL)
-	{
-		g_mime_object_unref(GMIME_OBJECT(m_pMimeMessage));
-	}
-	if (m_pCurrentDocument != NULL)
-	{
-		delete m_pCurrentDocument;
-	}
-
-	finalize();
-}
-
-bool MboxParser::initialize(void)
-{
-	// Open the mbox file
-	m_fd = open(m_fileName.c_str(), O_RDONLY);
-	if (m_fd < 0)
-	{
-		return false;
-	}
-
-	// Initialize gmime
-	g_mime_init(GMIME_INIT_FLAG_UTF8);
-
-	// Create a stream
-	if (m_messageStart > 0)
-	{
-		struct stat fileStat;
-
-		if ((fstat(m_fd, &fileStat) == 0) &&
-			(!S_ISREG(fileStat.st_mode)))
-		{
-			// This is not a file !
-			return false;
-		}
-
-		if (m_messageStart > fileStat.st_size)
-		{
-			// This offset doesn't make sense !
-			m_messageStart = 0;
-		}
-
-		m_pMboxStream = g_mime_stream_fs_new_with_bounds(m_fd, m_messageStart, fileStat.st_size);
-#ifdef DEBUG
-		cout << "MboxParser::initialize: stream starts at offset " << m_messageStart << endl;
-#endif
-	}
-	else
-	{
-		m_pMboxStream = g_mime_stream_fs_new(m_fd);
-	}
-
-	// And a parser
-	m_pParser = g_mime_parser_new();
-	if ((m_pMboxStream != NULL) &&
-		(m_pParser != NULL))
-	{
-		g_mime_parser_init_with_stream(m_pParser, m_pMboxStream);
-		g_mime_parser_set_respect_content_length(m_pParser, TRUE);
-		// Scan for mbox From-lines
-		g_mime_parser_set_scan_from(m_pParser, TRUE);
-
-		return true;
-	}
-
-	return false;
-}
-
-void MboxParser::finalize(void)
-{
-	if (m_pParser != NULL)
-	{
-		// FIXME: does the parser close the stream ?
-		g_object_unref(G_OBJECT(m_pParser));
-	}
-	else if (m_pMboxStream != NULL)
-	{
-		g_object_unref(G_OBJECT(m_pMboxStream));
-	}
-	if (m_fd >= 0)
-	{
-		close(m_fd);
-	}
-	g_mime_shutdown();
-}
-
-char *MboxParser::extractPart(GMimeObject *part, string &contentType, ssize_t &partLen)
-{
-	char *pBuffer = NULL;
-
-	if (part == NULL)
-	{
-		return NULL;
-	}
-
-	// Message parts may be nested
-	while (GMIME_IS_MESSAGE_PART(part))
-	{
-#ifdef DEBUG
-		cout << "MboxParser::extractPart: nested message part" << endl;
-#endif
-		GMimeMessage *partMessage = g_mime_message_part_get_message(GMIME_MESSAGE_PART(part));
-		part = g_mime_message_get_mime_part(partMessage);
-		g_mime_object_unref(GMIME_OBJECT(partMessage));
-	}
-
-	// Is this a multipart ?
-	if (GMIME_IS_MULTIPART(part))
-	{
-		m_partsCount = g_mime_multipart_get_number(GMIME_MULTIPART(part));
-#ifdef DEBUG
-		cout << "MboxParser::extractPart: message has " << m_partsCount << " parts" << endl;
-#endif
-		for (int partNum = max(m_partNum, 0); partNum < m_partsCount; ++partNum)
-		{
-#ifdef DEBUG
-			cout << "MboxParser::extractPart: extracting part " << partNum << endl;
-#endif
-			
-			GMimeObject *multiMimePart = g_mime_multipart_get_part(GMIME_MULTIPART(part), partNum);
-			if (multiMimePart == NULL)
-			{
-				continue;
-			}
-
-			char *pPart = extractPart(multiMimePart, contentType, partLen);
-			g_mime_object_unref(multiMimePart);
-			if (pPart != NULL)
-			{
-				m_partNum = ++partNum;
-				return pPart;
-			}
-		}
-
-		// None of the parts were suitable
-		m_partsCount = m_partNum = -1;
-	}
-
-	if (!GMIME_IS_PART(part))
-	{
-#ifdef DEBUG
-		cout << "MboxParser::extractPart: not a part" << endl;
-#endif
-		return NULL;
-	}
-	GMimePart *mimePart = GMIME_PART(part);
-
-	// Check the content type
-	const GMimeContentType *mimeType = g_mime_part_get_content_type(mimePart);
-	// Set this for caller
-	char *partType = g_mime_content_type_to_string(mimeType);
-	if (partType != NULL)
-	{
-#ifdef DEBUG
-		cout << "MboxParser::extractPart: type is " << partType << endl;
-#endif
-		contentType = partType;
-		g_free(partType);
-	}
-
-	GMimePartEncodingType encodingType = g_mime_part_get_encoding(mimePart);
-#ifdef DEBUG
-	cout << "MboxParser::extractPart: encoding is " << encodingType << endl;
-#endif
-
-	// Write the part to memory
-	g_mime_part_set_encoding(mimePart, GMIME_PART_ENCODING_QUOTEDPRINTABLE);
-	GMimeStream *memStream = g_mime_stream_mem_new();
-	GMimeDataWrapper *dataWrapper = g_mime_part_get_content_object(mimePart);
-	if (dataWrapper != NULL)
-	{
-		ssize_t writeLen = g_mime_data_wrapper_write_to_stream(dataWrapper, memStream);
-#ifdef DEBUG
-		cout << "MboxParser::extractPart: wrote " << writeLen << " bytes" << endl;
-#endif
-		g_object_unref(dataWrapper);
-	}
-	g_mime_stream_flush(memStream);
-	partLen = g_mime_stream_length(memStream);
-#ifdef DEBUG
-	cout << "MboxParser::extractPart: part is " << partLen << " bytes long" << endl;
-#endif
-
-	pBuffer = (char*)malloc(partLen + 1);
-	pBuffer[partLen] = '\0';
-	g_mime_stream_reset(memStream);
-	ssize_t readLen = g_mime_stream_read(memStream, pBuffer, partLen);
-#ifdef DEBUG
-	cout << "MboxParser::extractPart: read " << readLen << " bytes" << endl;
-#endif
-	g_mime_stream_unref(memStream);
-
-	return pBuffer;
-}
-
-bool MboxParser::extractMessage(const string &subject)
-{
-	string msgSubject(subject), contentType;
-	char *pPart = NULL;
-	ssize_t partLength = 0;
-
-	while (g_mime_stream_eos(m_pMboxStream) == FALSE)
-	{
-		// Does the previous message have parts left to parse ?
-		if (m_partsCount == -1)
-		{
-			// No, it doesn't
-			if (m_pMimeMessage != NULL)
-			{
-				g_mime_object_unref(GMIME_OBJECT(m_pMimeMessage));
-				m_pMimeMessage = NULL;
-			}
-
-			// Get the next message
-			m_pMimeMessage = g_mime_parser_construct_message(m_pParser);
-
-			m_messageStart = g_mime_parser_get_from_offset(m_pParser);
-			off_t messageEnd = g_mime_parser_tell(m_pParser);
-#ifdef DEBUG
-			cout << "MboxParser::extractMessage: message between offsets " << m_messageStart
-				<< " and " << messageEnd << endl;
-#endif
-			if (messageEnd > m_messageStart)
-			{
-				// FIXME: this only applies to Mozilla
-				const char *pMozStatus = g_mime_message_get_header(m_pMimeMessage, "X-Mozilla-Status");
-				if (pMozStatus != NULL)
-				{
-					long int mozStatus = strtol(pMozStatus, NULL, 16);
-					// Watch out for Mozilla specific flags :
-					// MSG_FLAG_EXPUNGED, MSG_FLAG_EXPIRED
-					// They are defined in mailnews/MailNewsTypes.h and msgbase/nsMsgMessageFlags.h
-					if ((mozStatus & 0x0008) ||
-						(mozStatus & 0x0040))
-					{
-#ifdef DEBUG
-						cout << "MboxParser::extractMessage: flagged by Mozilla" << endl;
-#endif
-						continue;
-					}
-				}
-
-				// How old is this message ?
-				const char *pDate = g_mime_message_get_header(m_pMimeMessage, "Date");
-				if (pDate != NULL)
-				{
-					m_messageDate = pDate;
-				}
-				else
-				{
-					m_messageDate = TimeConverter::toTimestamp(time(NULL));
-				}
-#ifdef DEBUG
-				cout << "MboxParser::extractMessage: message date is " << m_messageDate << endl;
-#endif
-
-				// Extract the subject
-				const char *pSubject = g_mime_message_get_header(m_pMimeMessage, "Subject");
-				if (pSubject != NULL)
-				{
-					msgSubject = pSubject;
-				}
-			}
-		}
-#ifdef DEBUG
-		cout << "MboxParser::extractMessage: message subject is " << msgSubject << endl;
-#endif
-
-		if (m_pMimeMessage != NULL)
-		{
-			// Get the top-level MIME part in the message
-			GMimeObject *pMimePart = g_mime_message_get_mime_part(m_pMimeMessage);
-			if (pMimePart != NULL)
-			{
-				// Extract the part's text
-				pPart = extractPart(pMimePart, contentType, partLength);
-				if (pPart != NULL)
-				{
-					string location;
-					char posStr[64];
-
-					// New location
-					// FIXME: use the same scheme as Mozilla
-					location = "mailbox://";
-					location += m_fileName;
-					location += "?o=";
-					snprintf(posStr, 64, "%d", m_messageStart);
-					location += posStr;
-					location += "&p=";
-					snprintf(posStr, 64, "%d", max(m_partNum, 0));
-					location += posStr;
-#ifdef DEBUG
-					cout << "MboxParser::extractMessage: message location is " << location << endl;
-#endif
-
-					// New document
-					m_pCurrentDocument = new Document(msgSubject, location, contentType, "");
-					m_pCurrentDocument->setData(pPart, (unsigned int)partLength);
-					m_pCurrentDocument->setTimestamp(m_messageDate);
-					m_pCurrentDocument->setSize((off_t )partLength);
-
-					free(pPart);
-					g_mime_object_unref(pMimePart);
-
-					return true;
-				}
-
-				g_mime_object_unref(pMimePart);
-			}
-
-			g_mime_object_unref(GMIME_OBJECT(m_pMimeMessage));
-			m_pMimeMessage = NULL;
-		}
-
-		// If we get there, no suitable parts were found
-		m_partsCount = m_partNum = -1;
-	}
-
-	return false;
-}
-
-/// Jumps to the next message.
-bool MboxParser::nextMessage(void)
-{
-	string subject;
-
-	if (m_pCurrentDocument != NULL)
-	{
-		subject = m_pCurrentDocument->getTitle();
-
-		delete m_pCurrentDocument;
-		m_pCurrentDocument = NULL;
-	}
-
-	return extractMessage(subject);
-}
-
-/// Returns a pointer to the current message's document.
-const Document *MboxParser::getDocument(void)
-{
-	// FIXME: this object can be invalidated by nextMessage() at any time;
-	// use auto_ptr all the way ?
-	return m_pCurrentDocument;
-}

Deleted: trunk/Utils/MboxParser.h
===================================================================
--- trunk/Utils/MboxParser.h	2007-02-10 06:11:30 UTC (rev 712)
+++ trunk/Utils/MboxParser.h	2007-02-16 15:02:12 UTC (rev 713)
@@ -1,79 +0,0 @@
-/*
- *  Copyright 2005,2006 Fabrice Colin
- *
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU Library General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
- */
-
-#ifndef _MBOX_PARSER_H
-#define _MBOX_PARSER_H
-
-#include <string>
-#include <map>
-#include <utility>
-#include <set>
-
-#include <gmime/gmime-object.h>
-#include <gmime/gmime-stream.h>
-#include <gmime/gmime-parser.h>
-
-#include "Document.h"
-
-using namespace std;
-
-/** A parser for mbox files. Each message is extracted and
-  * returned in a separate document by getDocument(). The value
-  * returned by getDocumentIncrement() enables to determine a new
-  * message has been extracted and is ready to be tokenized.
-  * See http://en.wikipedia.org/wiki/Mbox for details about the format.
-  */
-class MboxParser
-{
-	public:
-		MboxParser(const string &fileName, off_t mboxOffset = 0, int partNum = -1);
-		virtual ~MboxParser();
-
-		/// Jumps to the next message.
-		bool nextMessage(void);
-
-		/// Returns a pointer to the current message's document.
-		virtual const Document *getDocument(void);
-
-	protected:
-		string m_fileName;
-		int m_fd;
-		GMimeStream *m_pMboxStream;
-		GMimeParser *m_pParser;
-		GMimeMessage *m_pMimeMessage;
-		int m_partsCount;
-		int m_partNum;
-		off_t m_messageStart;
-		Document *m_pCurrentDocument;
-		string m_messageDate;
-
-		bool initialize(void);
-
-		void finalize(void);
-
-		bool extractMessage(const string &subject);
-
-		char *extractPart(GMimeObject *mimeObject, string &contentType, ssize_t &partLen);
-
-	private:
-		MboxParser(const MboxParser &other);
-		MboxParser& operator=(const MboxParser& other);
-
-};
-
-#endif // _MBOX_PARSER_H



From fabricecolin at mail.berlios.de  Fri Feb 16 16:03:37 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Fri, 16 Feb 2007 16:03:37 +0100
Subject: [Pinot-svn] r714 - trunk/Search
Message-ID: <200702161503.l1GF3bZB006617@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-16 16:03:36 +0100 (Fri, 16 Feb 2007)
New Revision: 714

Modified:
   trunk/Search/SherlockParser.cpp
   trunk/Search/WebEngine.cpp
   trunk/Search/pinot-search.cpp
Log:
Use FilterUtils.


Modified: trunk/Search/SherlockParser.cpp
===================================================================
--- trunk/Search/SherlockParser.cpp	2007-02-16 15:02:12 UTC (rev 713)
+++ trunk/Search/SherlockParser.cpp	2007-02-16 15:03:36 UTC (rev 714)
@@ -28,7 +28,7 @@
 #include "HtmlFilter.h"
 #include "FilterFactory.h"
 #include "FileCollector.h"
-#include "FilterWrapper.h"
+#include "FilterUtils.h"
 #include "SherlockParser.h"
 
 using std::cout;
@@ -363,7 +363,7 @@
 
 			// Feed this chunk to the filter
 			Dijon::HtmlFilter chunkFilter("text/html");
-			if ((FilterWrapper::feedFilter(chunkDoc, &chunkFilter) == true) &&
+			if ((FilterUtils::feedFilter(chunkDoc, &chunkFilter) == true) &&
 				(chunkFilter.next_document() == true))
 			{
 				set<Dijon::Link> chunkLinks;
@@ -400,7 +400,7 @@
 				map<string, string>::const_iterator abstractIter = metaData.find("abstract");
 				if (abstractIter == metaData.end())
 				{
-					extract = FilterWrapper::stripMarkup(resultItem);
+					extract = FilterUtils::stripMarkup(resultItem);
 					StringManip::trimSpaces(extract);
 				}
 				else

Modified: trunk/Search/WebEngine.cpp
===================================================================
--- trunk/Search/WebEngine.cpp	2007-02-16 15:02:12 UTC (rev 713)
+++ trunk/Search/WebEngine.cpp	2007-02-16 15:03:36 UTC (rev 714)
@@ -27,7 +27,8 @@
 #include "Url.h"
 #include "HtmlFilter.h"
 #include "DownloaderFactory.h"
-#include "FilterWrapper.h"
+#include "FilterUtils.h"
+#include "Tokenizer.h"
 #include "WebEngine.h"
 
 using std::cout;
@@ -84,7 +85,7 @@
 		{
 			Dijon::HtmlFilter htmlFilter("text/html");
 
-			if (FilterWrapper::feedFilter(*pDoc, &htmlFilter) == true)
+			if (FilterUtils::feedFilter(*pDoc, &htmlFilter) == true)
 			{
 				// Content-Type might be specified as a META tag
 				const map<string, string> &metaData = htmlFilter.get_meta_data();

Modified: trunk/Search/pinot-search.cpp
===================================================================
--- trunk/Search/pinot-search.cpp	2007-02-16 15:02:12 UTC (rev 713)
+++ trunk/Search/pinot-search.cpp	2007-02-16 15:03:36 UTC (rev 714)
@@ -26,7 +26,7 @@
 #include "MIMEScanner.h"
 #include "Url.h"
 #include "XapianDatabaseFactory.h"
-#include "FilterWrapper.h"
+#include "FilterUtils.h"
 #include "SearchEngineFactory.h"
 #include "DownloaderFactory.h"
 #include "config.h"
@@ -149,7 +149,7 @@
 				cout << count << " Host     : " << thisUrl.getHost() << endl;
 				cout << count << " Location : " << thisUrl.getLocation() << "/" << thisUrl.getFile() << endl;
 				cout << count << " Title    : " << resultIter->getTitle() << endl;
-				cout << count << " Extract  : " << FilterWrapper::stripMarkup(resultIter->getExtract()) << endl;
+				cout << count << " Extract  : " << FilterUtils::stripMarkup(resultIter->getExtract()) << endl;
 				cout << count << " Score    : " << resultIter->getScore() << endl;
 				count++;
 



From fabricecolin at mail.berlios.de  Sat Feb 17 05:17:08 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 17 Feb 2007 05:17:08 +0100
Subject: [Pinot-svn] r715 - in trunk: Search Tokenize
Message-ID: <200702170417.l1H4H8Cl016157@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-17 05:17:08 +0100 (Sat, 17 Feb 2007)
New Revision: 715

Modified:
   trunk/Search/SherlockParser.cpp
   trunk/Tokenize/FilterUtils.cpp
Log:
Fixed link and abstract extraction, both broken following the move to Filter.


Modified: trunk/Search/SherlockParser.cpp
===================================================================
--- trunk/Search/SherlockParser.cpp	2007-02-16 15:03:36 UTC (rev 714)
+++ trunk/Search/SherlockParser.cpp	2007-02-17 04:17:08 UTC (rev 715)
@@ -363,13 +363,13 @@
 
 			// Feed this chunk to the filter
 			Dijon::HtmlFilter chunkFilter("text/html");
+			set<Dijon::Link> chunkLinks;
 			if ((FilterUtils::feedFilter(chunkDoc, &chunkFilter) == true) &&
+				(chunkFilter.get_links(chunkLinks) == true) &&
 				(chunkFilter.next_document() == true))
 			{
-				set<Dijon::Link> chunkLinks;
 				unsigned int endOfFirstLink = 0, startOfSecondLink = 0, endOfSecondLink = 0, startOfThirdLink = 0;
 
-				chunkFilter.get_links(chunkLinks);
 
 				// The result's URL and title should be given by the first link
 				for (set<Dijon::Link>::iterator linkIter = chunkLinks.begin(); linkIter != chunkLinks.end(); ++linkIter)

Modified: trunk/Tokenize/FilterUtils.cpp
===================================================================
--- trunk/Tokenize/FilterUtils.cpp	2007-02-16 15:03:36 UTC (rev 714)
+++ trunk/Tokenize/FilterUtils.cpp	2007-02-17 04:17:08 UTC (rev 715)
@@ -74,7 +74,7 @@
 		(pFilter->is_data_input_ok(Filter::DOCUMENT_DATA) == true))
 	{
 #ifdef DEBUG
-		cout << "FilterUtils::getFilter: feeding data" << endl;
+		cout << "FilterUtils::feedFilter: feeding data" << endl;
 #endif
 		fedInput = pFilter->set_document_data(pData, dataLength);
 	}
@@ -85,7 +85,7 @@
 		if (pFilter->is_data_input_ok(Filter::DOCUMENT_FILE_NAME) == true)
 		{
 #ifdef DEBUG
-			cout << "FilterUtils::getFilter: feeding file " << fileName << endl;
+			cout << "FilterUtils::feedFilter: feeding file " << fileName << endl;
 #endif
 			fedInput = pFilter->set_document_file(fileName);
 		}
@@ -102,7 +102,7 @@
 				return false;
 			}
 #ifdef DEBUG
-			cout << "FilterUtils::getFilter: feeding contents of file " << fileName << endl;
+			cout << "FilterUtils::feedFilter: feeding contents of file " << fileName << endl;
 #endif
 
 			pData = docCopy.getData(dataLength);
@@ -185,8 +185,12 @@
 
 string FilterUtils::stripMarkup(const string &text)
 {
+	if (text.empty() == true)
+	{
+		return "";
+	}
+
 	Dijon::Filter *pFilter = Dijon::FilterFactory::getFilter("text/xml");
-	string strippedText;
 
 	if (pFilter == NULL)
 	{
@@ -194,6 +198,8 @@
 	}
 
 	Document doc;
+	string strippedText;
+
 	doc.setData(text.c_str(), text.length());
 	if ((feedFilter(doc, pFilter) == true) &&
 		(pFilter->next_document() == true))



From fabricecolin at mail.berlios.de  Sat Feb 17 10:23:09 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 17 Feb 2007 10:23:09 +0100
Subject: [Pinot-svn] r716 - trunk/Tokenize
Message-ID: <200702170923.l1H9N9Nc002857@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-17 10:23:09 +0100 (Sat, 17 Feb 2007)
New Revision: 716

Modified:
   trunk/Tokenize/Tokenizer.cpp
   trunk/Tokenize/Tokenizer.h
Log:
Removed now unused method.


Modified: trunk/Tokenize/Tokenizer.cpp
===================================================================
--- trunk/Tokenize/Tokenizer.cpp	2007-02-17 04:17:08 UTC (rev 715)
+++ trunk/Tokenize/Tokenizer.cpp	2007-02-17 09:23:09 UTC (rev 716)
@@ -17,7 +17,6 @@
  */
 
 #include <sys/types.h>
-#include <sys/stat.h>
 #include <ctype.h>
 #include <unistd.h>
 #include <iostream>
@@ -44,95 +43,6 @@
 	// The document is owned by the caller
 }
 
-Document *Tokenizer::runHelperProgram(const Document *pDocument,
-	const string &programName, const string &arguments)
-{
-	Document *pOutputDocument = NULL;
-	char inTemplate[15] = "/tmp/tokXXXXXX";
-	bool deleteInFile = false;
-
-	if ((pDocument == NULL) ||
-		(programName.empty() == true))
-	{
-		return NULL;
-	}
-
-	string cmdLine(programName);
-	string output;
-	unsigned int dataLength = 0;
-	const char *pData = pDocument->getData(dataLength);
-
-	cmdLine += " ";
-	if (pData == NULL)
-	{
-		Url urlObj(pDocument->getLocation());
-
-		if (urlObj.getProtocol() != "file")
-		{
-			// Not much we can do I am afraid
-			return NULL;
-		}
-
-		// Point the helper program to the actual file
-		string fileName(urlObj.getLocation());
-		fileName += "/";
-		fileName += urlObj.getFile();
-		cmdLine += CommandLine::quote(fileName);
-	}
-	else
-	{
-		int inFd = mkstemp(inTemplate);
-
-		if (inFd != -1)
-		{
-			// Save the data into a temporary file
-			if (write(inFd, (const void*)pData, dataLength) != -1)
-			{
-				cmdLine += inTemplate;
-			}
-
-			deleteInFile = true;
-			close(inFd);
-		}
-	}
-
-	// Any argument ?
-	if (arguments.empty() == false)
-	{
-		cmdLine += " ";
-		cmdLine += arguments;
-		cmdLine += " ";
-	}
-
-	// Run the helper program
-	if ((CommandLine::runSync(cmdLine, output) == true) &&
-		(output.empty() == false))
-	{
-		// Pass the result to the parent class
-		pOutputDocument = new Document(pDocument->getTitle(),
-			pDocument->getLocation(), pDocument->getType(),
-			pDocument->getLanguage());
-		pOutputDocument->setData(output.c_str(), output.length());
-		pOutputDocument->setTimestamp(pDocument->getTimestamp());
-		pOutputDocument->setSize(pDocument->getSize());
-
-#ifdef DEBUG_TOKENIZER
-		cout << "Tokenizer::runHelperProgram: set " << output.length()
-			<< " bytes of data" << endl;
-#endif
-	}
-
-	if ((deleteInFile == true) &&
-		(unlink(inTemplate) != 0))
-	{
-#ifdef DEBUG_TOKENIZER
-		cout << "Tokenizer::runHelperProgram: couldn't delete temporary file" << endl;
-#endif
-	}
-
-	return pOutputDocument;
-}
-
 void Tokenizer::setDocument(const Document *pDocument)
 {
 	m_pDocument = pDocument;

Modified: trunk/Tokenize/Tokenizer.h
===================================================================
--- trunk/Tokenize/Tokenizer.h	2007-02-17 04:17:08 UTC (rev 715)
+++ trunk/Tokenize/Tokenizer.h	2007-02-17 09:23:09 UTC (rev 716)
@@ -34,10 +34,6 @@
 
 		typedef enum { ALL_DOCUMENTS = 0, ALL_BUT_FILES, NO_DOCUMENTS } DataNeeds;
 
-		/// Converts a document using an helper program.
-		static Document *runHelperProgram(const Document *pDocument,
-			const std::string &programName, const std::string &arguments = "");
-
 		/// Returns a pointer to the document being tokenized.
 		virtual const Document *getDocument(void);
 



From fabricecolin at mail.berlios.de  Sat Feb 17 10:29:24 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 17 Feb 2007 10:29:24 +0100
Subject: [Pinot-svn] r717 - in trunk: UI/GTK2/src Utils
Message-ID: <200702170929.l1H9TOGO003066@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-17 10:29:23 +0100 (Sat, 17 Feb 2007)
New Revision: 717

Modified:
   trunk/UI/GTK2/src/ModelColumns.cpp
   trunk/UI/GTK2/src/ModelColumns.h
   trunk/UI/GTK2/src/ResultsTree.cpp
   trunk/UI/GTK2/src/ResultsTree.h
   trunk/UI/GTK2/src/WorkerThreads.cpp
   trunk/UI/GTK2/src/WorkerThreads.h
   trunk/UI/GTK2/src/mainWindow.cc
   trunk/Utils/Result.cpp
   trunk/Utils/Result.h
Log:
Avoid peeking at the indexes from the main UI thread.
- IndexingThread determines whether the document should be updated.
- QueryingThread finds which results are in one of the indexes.
- ExpandQueryThread gets the document IDs of the relevant documents.
- LabelUpdateThread can set labels on documents.


Modified: trunk/UI/GTK2/src/ModelColumns.cpp
===================================================================
--- trunk/UI/GTK2/src/ModelColumns.cpp	2007-02-17 09:23:09 UTC (rev 716)
+++ trunk/UI/GTK2/src/ModelColumns.cpp	2007-02-17 09:29:23 UTC (rev 717)
@@ -65,6 +65,7 @@
 	add(m_scoreText);
 	add(m_engines);
 	add(m_indexes);
+	add(m_docId);
 	add(m_type);
 }
 

Modified: trunk/UI/GTK2/src/ModelColumns.h
===================================================================
--- trunk/UI/GTK2/src/ModelColumns.h	2007-02-17 09:23:09 UTC (rev 716)
+++ trunk/UI/GTK2/src/ModelColumns.h	2007-02-17 09:29:23 UTC (rev 717)
@@ -88,6 +88,7 @@
 	Gtk::TreeModelColumn<Glib::ustring> m_scoreText;
 	Gtk::TreeModelColumn<unsigned int> m_engines;
 	Gtk::TreeModelColumn<unsigned int> m_indexes;
+	Gtk::TreeModelColumn<unsigned int> m_docId;
 	typedef enum { RESULT_ROOT = 0, RESULT_TITLE, RESULT_HOST, RESULT_OTHER } ResultType;
 	Gtk::TreeModelColumn<ResultType> m_type;
 

Modified: trunk/UI/GTK2/src/ResultsTree.cpp
===================================================================
--- trunk/UI/GTK2/src/ResultsTree.cpp	2007-02-17 09:23:09 UTC (rev 716)
+++ trunk/UI/GTK2/src/ResultsTree.cpp	2007-02-17 09:29:23 UTC (rev 717)
@@ -475,7 +475,7 @@
 			indexId = m_settings.getIndexId(engineName);
 			engineId = m_settings.getEngineId("Xapian");
 #ifdef DEBUG
-			cout << "ResultsTree::addResults: engine is index " << engineName << endl;
+			cout << "ResultsTree::addResults: engine is index " << engineName << " " << indexId << endl;
 #endif
 		}
 #ifdef DEBUG
@@ -550,11 +550,21 @@
 			}
 
 			++count;
-			if (appendResult(title, location, (int)currentScore, rankDiff,
-				engineId, indexId, titleIter, &(*groupIter), true) == true)
+
+			unsigned int docId = resultIter->getIsIndexed(indexId);
+			bool isIndexed = false;
+
+			if (docId > 0)
 			{
+				isIndexed = true;
+			}
+
+			if (appendResult(title, location, (int)currentScore, rankDiff, isIndexed,
+				docId, engineId, indexId, titleIter, &(*groupIter), true) == true)
+			{
 #ifdef DEBUG
-				cout << "ResultsTree::addResults: added row for result " << count << ", " << currentScore << endl;
+				cout << "ResultsTree::addResults: added row for result " << count
+					<< ", " << currentScore << ", " << isIndexed << " " << indexId << endl;
 #endif
 
 				// Update this map, so that we know which groups need updating
@@ -682,7 +692,10 @@
 							childRow[m_resultsColumns.m_url],
 							childRow[m_resultsColumns.m_score],
 							childRow[m_resultsColumns.m_rankDiff],
-							engineIds, indexIds, newIter, &(*groupIter), true);
+							childRow[m_resultsColumns.m_indexed],
+							childRow[m_resultsColumns.m_docId],
+							engineIds, indexIds,
+							newIter, &(*groupIter), true);
 					}
 				}
 				else
@@ -693,7 +706,7 @@
 					if (engineNames.empty() == false)
 					{
 #ifdef DEBUG
-						cout << "ResultsTree::setGroupMode: row is for " << engineNames.size() << endl;
+						cout << "ResultsTree::setGroupMode: row is for " << engineNames.size() << " engine(s)" << endl;
 #endif
 						// Are there indexes in the list ?
 						set<string>::iterator xapianIter = engineNames.find("Xapian");
@@ -702,6 +715,9 @@
 						{
 							// Erase this
 							engineNames.erase(xapianIter);
+#ifdef DEBUG
+							cout << "ResultsTree::setGroupMode: row is for index(es)" << indexIds << endl;
+#endif
 
 							// Add entries for each index name so that we can loop once on engine names
 							set<string> indexNames;
@@ -730,7 +746,13 @@
 								{
 									engineId = m_settings.getEngineId("Xapian");
 								}
+#ifdef DEBUG
+								cout << "ResultsTree::setGroupMode: index " << indexId << endl;
+#endif
 							}
+#ifdef DEBUG
+							else cout << "ResultsTree::setGroupMode: no index" << endl;
+#endif
 
 							// Add group
 							if (appendGroup(engineName, newType, groupIter) == true)
@@ -740,6 +762,8 @@
 									childRow[m_resultsColumns.m_url],
 									childRow[m_resultsColumns.m_score],
 									childRow[m_resultsColumns.m_rankDiff],
+									childRow[m_resultsColumns.m_indexed],
+									childRow[m_resultsColumns.m_docId],
 									engineId, indexId,
 									newIter, &(*groupIter), true);
 #ifdef DEBUG
@@ -818,6 +842,58 @@
 }
 
 //
+// Gets a list of selected items.
+//
+bool ResultsTree::getSelection(vector<Result> &resultsList)
+{
+	list<TreeModel::Path> selectedItems = get_selection()->get_selected_rows();
+	if (selectedItems.empty() == true)
+	{
+		return false;
+	}
+
+	// Go through selected items
+	for (list<TreeModel::Path>::iterator itemPath = selectedItems.begin();
+		itemPath != selectedItems.end(); ++itemPath)
+	{
+		TreeModel::iterator iter = m_refStore->get_iter(*itemPath);
+		TreeModel::Row row = *iter;
+
+		if (row[m_resultsColumns.m_type] == ResultsModelColumns::RESULT_TITLE)
+		{
+			bool isIndexed = row[m_resultsColumns.m_indexed];
+
+			Result current(from_utf8(row[m_resultsColumns.m_text]),
+				from_utf8(row[m_resultsColumns.m_url]), "", "");
+
+			if (isIndexed == true)
+			{
+				set<string> indexNames;
+				unsigned int indexIds = row[m_resultsColumns.m_indexes];
+
+				m_settings.getIndexNames(indexIds, indexNames);
+				// Any internal index in there ?
+				for (set<string>::iterator indexIter = indexNames.begin(); indexIter != indexNames.end(); ++indexIter)
+				{
+					if  (m_settings.isInternalIndex(*indexIter) == true)
+					{
+						current.setIsIndexed(m_settings.getIndexId(*indexIter), row[m_resultsColumns.m_docId]);
+						break;
+					}
+				}
+			}
+
+			resultsList.push_back(current);
+		}
+	}
+#ifdef DEBUG
+	cout << "ResultsTree::getSelection: " << resultsList.size() << " results selected" << endl;
+#endif
+
+	return true;
+}
+
+//
 // Sets the selected items' state.
 //
 void ResultsTree::setSelectionState(bool viewed, bool indexed)
@@ -1064,7 +1140,8 @@
 // Adds a new row in the results tree.
 //
 bool ResultsTree::appendResult(const ustring &text, const ustring &url,
-	int score, int rankDiff, unsigned int engineId, unsigned int indexId,
+	int score, int rankDiff, bool isIndexed, unsigned int docId,
+	unsigned int engineId, unsigned int indexId,
 	TreeModel::iterator &newRowIter, const TreeModel::Row *parentRow, bool noDuplicates)
 {
 	if (parentRow == NULL)
@@ -1103,27 +1180,13 @@
 		newRowIter = m_refStore->append(parentRow->children());
 	}
 
-	IndexInterface *pIndex = m_settings.getIndex("MERGED");
+	// Has it been already viewed ?
 	ViewHistory viewHistory(m_settings.m_historyDatabase);
-	bool isIndexed = false;
-
-	// Is this document indexed ?
-	if (pIndex != NULL)
-	{
-		if (pIndex->hasDocument(url) > 0)
-		{
-			isIndexed = true;
-		}
-
-		delete pIndex;
-	}
-
-	// Has it been already viewed ?
 	bool wasViewed = viewHistory.hasItem(url);
 
 	TreeModel::Row childRow = *newRowIter;
 	updateRow(childRow, text, url, score, engineId, indexId,
-		ResultsModelColumns::RESULT_TITLE, isIndexed,
+		docId, ResultsModelColumns::RESULT_TITLE, isIndexed,
 		wasViewed, rankDiff);
 
 	return true;
@@ -1145,7 +1208,7 @@
 		groupIter = m_refStore->append();
 		TreeModel::Row groupRow = *groupIter;
 		updateRow(groupRow, to_utf8(groupName),
-			"", 0, 0, 0, groupType,
+			"", 0, 0, 0, 0, groupType,
 			false, false, false);
 
 		// Update the map
@@ -1212,8 +1275,9 @@
 // Updates a row.
 //
 void ResultsTree::updateRow(TreeModel::Row &row, const ustring &text,
-	const ustring &url, int score, unsigned int engineId,  unsigned int indexId,
-	ResultsModelColumns::ResultType type, bool indexed, bool viewed, int rankDiff)
+	const ustring &url, int score, unsigned int engineId, unsigned int indexId,
+	unsigned int docId, ResultsModelColumns::ResultType type,
+	bool indexed, bool viewed, int rankDiff)
 {
 	try
 	{
@@ -1223,6 +1287,7 @@
 		row[m_resultsColumns.m_scoreText] = "";
 		row[m_resultsColumns.m_engines] = engineId;
 		row[m_resultsColumns.m_indexes] = indexId;
+		row[m_resultsColumns.m_docId] = docId;
 		row[m_resultsColumns.m_type] = type;
 
 		row[m_resultsColumns.m_indexed] = indexed;

Modified: trunk/UI/GTK2/src/ResultsTree.h
===================================================================
--- trunk/UI/GTK2/src/ResultsTree.h	2007-02-17 09:23:09 UTC (rev 716)
+++ trunk/UI/GTK2/src/ResultsTree.h	2007-02-17 09:29:23 UTC (rev 717)
@@ -73,6 +73,9 @@
 		/// Gets a list of selected items.
 		bool getSelection(std::vector<DocumentInfo> &resultsList, bool skipIndexed = false);
 
+		/// Gets a list of selected items.
+		bool getSelection(std::vector<Result> &resultsList);
+
 		/// Sets the selected items' state.
 		void setSelectionState(bool viewed, bool indexed);
 
@@ -148,9 +151,10 @@
 
 		/// Adds a new row in the results tree.
 		bool appendResult(const Glib::ustring &text, const Glib::ustring &url,
-			int score, int rankDiff, unsigned int engineId, unsigned int indexId,
-			Gtk::TreeModel::iterator &newRowIter,
-			const Gtk::TreeModel::Row *parentRow = NULL, bool noDuplicates = false);
+			int score, int rankDiff, bool isIndexed, unsigned int docId,
+			unsigned int engineId, unsigned int indexId,
+			Gtk::TreeModel::iterator &newRowIter, const Gtk::TreeModel::Row *parentRow = NULL,
+			bool noDuplicates = false);
 
 		/// Updates a results group.
 		void updateGroup(Gtk::TreeModel::iterator &groupIter);
@@ -158,7 +162,8 @@
 		/// Updates a row.
 		void updateRow(Gtk::TreeModel::Row &row, const Glib::ustring &text,
 			const Glib::ustring &url, int score, unsigned int engineId, unsigned int indexId,
-			ResultsModelColumns::ResultType type, bool indexed, bool viewed, int rankDiff);
+			unsigned int indexId, ResultsModelColumns::ResultType type,
+			bool indexed, bool viewed, int rankDiff);
 
 		/// Retrieves the extract to show for the given row.
 		Glib::ustring findResultsExtract(const Gtk::TreeModel::Row &row);

Modified: trunk/UI/GTK2/src/WorkerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.cpp	2007-02-17 09:23:09 UTC (rev 716)
+++ trunk/UI/GTK2/src/WorkerThreads.cpp	2007-02-17 09:29:23 UTC (rev 717)
@@ -36,6 +36,7 @@
 #include "Url.h"
 #include "HtmlFilter.h"
 #include "FilterFactory.h"
+#include "FilterUtils.h"
 #include "FilterWrapper.h"
 #include "XapianDatabase.h"
 #include "ActionQueue.h"
@@ -352,29 +353,8 @@
 		return status;
 	}
 
-	// Is it an update ?
-	IndexInterface *pIndex = PinotSettings::getInstance().getIndex(m_defaultIndexLocation);
-	if (pIndex == NULL)
-	{
-		ustring status = _("Index error on");
-		status += " ";
-		status += m_defaultIndexLocation;
-		return status;
-	}
+	start_thread(new IndexingThread(docInfo, m_defaultIndexLocation));
 
-	unsigned int docId = pIndex->hasDocument(docInfo.getLocation());
-	if (docId > 0)
-	{
-		// Yes, it is
-		start_thread(new IndexingThread(docInfo, docId, m_defaultIndexLocation));
-	}
-	else
-	{
-		// This is a new document
-		start_thread(new IndexingThread(docInfo, docId, m_defaultIndexLocation));
-	}
-	delete pIndex;
-
 	return "";
 }
 
@@ -820,22 +800,42 @@
 	else
 	{
 		const vector<Result> &resultsList = pEngine->getResults();
+		PinotSettings &settings = PinotSettings::getInstance();
 
 		m_resultsList.clear();
 		m_resultsList.reserve(resultsList.size());
 		m_resultsCharset = pEngine->getResultsCharset();
 
+		IndexInterface *pDocsIndex = settings.getIndex(settings.m_docsIndexLocation);
+		if ((pDocsIndex != NULL) &&
+			(pDocsIndex->isGood() == false))
+		{
+			delete pDocsIndex;
+			pDocsIndex = NULL;
+		}
+
+		IndexInterface *pDaemonIndex = settings.getIndex(settings.m_daemonIndexLocation);
+		if ((pDaemonIndex != NULL) &&
+			(pDaemonIndex->isGood() == false))
+		{
+			delete pDaemonIndex;
+			pDaemonIndex = NULL;
+		}
+
+
 		// Copy the results list
 		for (vector<Result>::const_iterator resultIter = resultsList.begin();
 			resultIter != resultsList.end(); ++resultIter)
 		{
 			string title(_("No title"));
+			string location(resultIter->getLocation());
 			string language(resultIter->getLanguage());
+			unsigned int indexId = 0, docId = 0;
 
 			// The title may contain formatting
 			if (resultIter->getTitle().empty() == false)
 			{
-				title = FilterWrapper::stripMarkup(resultIter->getTitle());
+				title = FilterUtils::stripMarkup(resultIter->getTitle());
 			}
 #ifdef DEBUG
 			cout << "QueryingThread::doWork: title is " << title << endl;
@@ -847,23 +847,53 @@
 				language = m_queryProps.getLanguage();
 			}
 
-			m_resultsList.push_back(Result(resultIter->getLocation(),
-				title,
-				resultIter->getExtract(),
-				language,
-				resultIter->getScore()));
+			Result current(location, title, resultIter->getExtract(),
+				language, resultIter->getScore());
+
+			// Is this in one of the indexes ?
+			if (pDocsIndex != NULL)
+			{
+				docId = pDocsIndex->hasDocument(location);
+				if (docId > 0)
+				{
+					indexId = settings.getIndexId(_("My Web Pages"));
+				}
+			}
+			if (pDaemonIndex != NULL)
+			{
+				docId = pDaemonIndex->hasDocument(location);
+				if (docId > 0)
+				{
+					indexId = settings.getIndexId(_("My Documents"));
+				}
+			}
+			if (docId > 0)
+			{
+				current.setIsIndexed(indexId, docId);
+#ifdef DEBUG
+				cout << "QueryingThread::doWork: found in index " << indexId << endl;
+#endif
+			}
+
+			m_resultsList.push_back(current);
 		}
+
+		if (pDocsIndex != NULL)
+		{
+			delete pDocsIndex;
+		}
+		if (pDaemonIndex != NULL)
+		{
+			delete pDaemonIndex;
+		}
 	}
 
 	delete pEngine;
 }
 
-ExpandQueryThread::ExpandQueryThread(const string &engineName,
-	const string &engineOption, const QueryProperties &queryProps,
-	const set<unsigned int> &relevantDocs) :
+ExpandQueryThread::ExpandQueryThread(const QueryProperties &queryProps,
+	const set<string> &relevantDocs) :
 	WorkerThread(),
-	m_engineName(engineName),
-	m_engineOption(engineOption),
 	m_queryProps(queryProps)
 {
 	copy(relevantDocs.begin(), relevantDocs.end(),
@@ -897,8 +927,31 @@
 
 void ExpandQueryThread::doWork(void)
 {
+	IndexInterface *pIndex = PinotSettings::getInstance().getIndex("MERGED");
+	set<unsigned int> relevantDocIds;
+
+	if ((pIndex == NULL) ||
+		(pIndex->isGood() == false))
+	{
+		m_status = _("Index error on");
+		m_status += " MERGED";
+		if (pIndex != NULL)
+		{
+			delete pIndex;
+		}
+		return;
+	}
+
+	for (set<string>::iterator locationIter = m_relevantDocs.begin();
+		locationIter != m_relevantDocs.end(); ++locationIter)
+	{
+		relevantDocIds.insert(pIndex->hasDocument(*locationIter));
+	}
+
+	delete pIndex;
+
 	// Get the SearchEngine
-	SearchEngineInterface *pEngine = SearchEngineFactory::getSearchEngine(m_engineName, m_engineOption);
+	SearchEngineInterface *pEngine = SearchEngineFactory::getSearchEngine("xapian", "MERGED");
 	if (pEngine == NULL)
 	{
 		m_status = _("Couldn't create search engine");
@@ -910,14 +963,13 @@
 	// Set the maximum number of results
 	pEngine->setMaxResultsCount(m_queryProps.getMaximumResultsCount());
 	// Set whether to expand the query
-	pEngine->setQueryExpansion(m_relevantDocs);
+	pEngine->setQueryExpansion(relevantDocIds);
 
 	// Run the query
 	if (pEngine->runQuery(m_queryProps) == false)
 	{
 		m_status = _("Couldn't run query on search engine");
-		m_status += " ";
-		m_status += m_engineName;
+		m_status += " xapian";
 	}
 	else
 	{
@@ -931,12 +983,22 @@
 }
 
 LabelUpdateThread::LabelUpdateThread(const set<string> &labelsToDelete,
-	const map<string, string> &labelsToRename)
+	const map<string, string> &labelsToRename) :
+	WorkerThread()
 {
 	copy(labelsToDelete.begin(), labelsToDelete.end(), inserter(m_labelsToDelete, m_labelsToDelete.begin()));
 	copy(labelsToRename.begin(), labelsToRename.end(), inserter(m_labelsToRename, m_labelsToRename.begin()));
 }
 
+LabelUpdateThread::LabelUpdateThread(const string &labelName,
+	const set<unsigned int> &docsIds, const set<unsigned int> &daemonIds) :
+	WorkerThread(),
+	m_labelName(labelName)
+{
+	copy(docsIds.begin(), docsIds.end(), inserter(m_docsIds, m_docsIds.begin()));
+	copy(daemonIds.begin(), daemonIds.end(), inserter(m_daemonIds, m_daemonIds.begin()));
+}
+
 LabelUpdateThread::~LabelUpdateThread()
 {
 }
@@ -973,6 +1035,21 @@
 		return;
 	}
 
+	// Apply the new label to existing documents
+	if (m_labelName.empty() == false)
+	{
+		set<string> labels;
+
+		labels.insert(m_labelName);
+		if (m_docsIds.empty() == false)
+		{
+			pDocsIndex->setDocumentsLabels(m_docsIds, labels, false);
+		}
+		if (m_daemonIds.empty() == false)
+		{
+			pDaemonIndex->setDocumentsLabels(m_daemonIds, labels, false);
+		}
+	}
 	// Delete labels
 	for (set<string>::iterator iter = m_labelsToDelete.begin(); iter != m_labelsToDelete.end(); ++iter)
 	{
@@ -1062,26 +1139,15 @@
 	}
 }
 
-IndexingThread::IndexingThread(const DocumentInfo &docInfo, unsigned int docId,
-	const string &indexLocation, bool allowAllMIMETypes) :
+IndexingThread::IndexingThread(const DocumentInfo &docInfo, const string &indexLocation,
+	bool allowAllMIMETypes) :
 	DownloadingThread(docInfo),
 	m_docInfo(docInfo),
-	m_docId(docId),
+	m_docId(0),
 	m_indexLocation(indexLocation),
-	m_allowAllMIMETypes(allowAllMIMETypes)
+	m_allowAllMIMETypes(allowAllMIMETypes),
+	m_update(false)
 {
-	if (m_docId > 0)
-	{
-		// Ignore robots directives on updates
-		m_ignoreRobotsDirectives = true;
-		m_update = true;
-	}
-	else
-	{
-		m_ignoreRobotsDirectives = PinotSettings::getInstance().m_ignoreRobotsDirectives;
-		// This is not an update
-		m_update = false;
-	}
 }
 
 IndexingThread::~IndexingThread()
@@ -1144,6 +1210,14 @@
 		return;
 	}
 
+	// Is it an update ?
+	m_docId = pIndex->hasDocument(m_docInfo.getLocation());
+	if (m_docId > 0)
+	{
+		// Ignore robots directives on updates
+		m_update = true;
+	}
+
 	// We may not have to download the document
 	// If coming from a crawl, this will be empty
 	if (m_docInfo.getType().empty() == true)
@@ -1189,6 +1263,9 @@
 	else
 	{
 		m_pDoc = new Document(m_docInfo);
+
+		m_pDoc->setTimestamp(m_docInfo.getTimestamp());
+		m_pDoc->setSize(m_docInfo.getSize());
 #ifdef DEBUG
 		cout << "IndexingThread::doWork: skipped download of " << m_docInfo.getLocation() << endl;
 #endif
@@ -1252,7 +1329,7 @@
 		{
 			// Is indexing allowed ?
 			HtmlFilter *pHtmlFilter = dynamic_cast<HtmlFilter*>(pFilter);
-			if ((m_ignoreRobotsDirectives == false) &&
+			if ((m_update == false) &&
 				(pHtmlTokens != NULL))
 			{
 		// See if the document has a ROBOTS META tag

Modified: trunk/UI/GTK2/src/WorkerThreads.h
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.h	2007-02-17 09:23:09 UTC (rev 716)
+++ trunk/UI/GTK2/src/WorkerThreads.h	2007-02-17 09:29:23 UTC (rev 717)
@@ -222,8 +222,8 @@
 class ExpandQueryThread : public WorkerThread
 {
 	public:
-		ExpandQueryThread(const std::string &engineName, const std::string &engineOption,
-			const QueryProperties &queryProps, const std::set<unsigned int> &relevantDocs);
+		ExpandQueryThread(const QueryProperties &queryProps,
+			const std::set<std::string> &relevantDocs);
 		virtual ~ExpandQueryThread();
 
 		virtual std::string getType(void) const;
@@ -235,10 +235,8 @@
 		virtual bool stop(void);
 
 	protected:
-		std::string m_engineName;
-		std::string m_engineOption;
 		QueryProperties m_queryProps;
-		std::set<unsigned int> m_relevantDocs;
+		std::set<std::string> m_relevantDocs;
 		std::set<std::string> m_expandTerms;
 
 		virtual void doWork(void);
@@ -254,6 +252,10 @@
 	public:
 		LabelUpdateThread(const std::set<std::string> &labelsToDelete,
 			const std::map<std::string, std::string> &labelsToRename);
+		LabelUpdateThread(const std::string &labelName,
+			const std::set<unsigned int> &docsIds,
+			const std::set<unsigned int> &daemonIds);
+
 		virtual ~LabelUpdateThread();
 
 		virtual std::string getType(void) const;
@@ -263,6 +265,9 @@
 	protected:
 		std::set<std::string> m_labelsToDelete;
 		std::map<std::string, std::string> m_labelsToRename;
+		std::string m_labelName;
+		std::set<unsigned int> m_docsIds;
+		std::set<unsigned int> m_daemonIds;
 
 		virtual void doWork(void);
 
@@ -302,8 +307,8 @@
 class IndexingThread : public DownloadingThread
 {
 	public:
-		IndexingThread(const DocumentInfo &docInfo, unsigned int docId,
-			const std::string &indexLocation, bool allowAllMIMETypes = true);
+		IndexingThread(const DocumentInfo &docInfo, const std::string &indexLocation,
+			bool allowAllMIMETypes = true);
 		virtual ~IndexingThread();
 
 		virtual std::string getType(void) const;
@@ -323,7 +328,6 @@
 		unsigned int m_docId;
 		std::string m_indexLocation;
 		bool m_allowAllMIMETypes;
-		bool m_ignoreRobotsDirectives;
 		bool m_update;
 
 		virtual void doWork(void);

Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2007-02-17 09:23:09 UTC (rev 716)
+++ trunk/UI/GTK2/src/mainWindow.cc	2007-02-17 09:29:23 UTC (rev 717)
@@ -437,7 +437,7 @@
 //
 void mainWindow::on_resultsTreeviewSelection_changed(ustring queryName)
 {
-	vector<DocumentInfo> resultsList;
+	vector<Result> resultsList;
 	string url;
 	bool hasSelection = false;
 
@@ -458,10 +458,9 @@
 	if ((hasSelection == true) &&
 		(resultsList.empty() == false))
 	{
-		IndexInterface *pIndex = m_settings.getIndex("MERGED");
 		bool firstResult = true, isViewable = true, isCached = false, isIndexed = false, isIndexable = true;
 
-		for (vector<DocumentInfo>::iterator resultIter = resultsList.begin();
+		for (vector<Result>::iterator resultIter = resultsList.begin();
 			resultIter != resultsList.end(); ++resultIter)
 		{
 			string url(resultIter->getLocation());
@@ -495,14 +494,7 @@
 					isCached = true;
 				}
 
-				if ((pIndex != NULL) &&
-					(pIndex->isGood() == true))
-				{
-					if (pIndex->hasDocument(url) > 0)
-					{
-						isIndexed = true;
-					}
-				}
+				isIndexed = resultIter->getIsIndexed();
 			}
 		}
 
@@ -511,11 +503,6 @@
 		viewcache1->set_sensitive(isCached);
 		morelikethis1->set_sensitive(isIndexed);
 		indexresults1->set_sensitive(isIndexable);
-
-		if (pIndex != NULL)
-		{
-			delete pIndex;
-		}
 	}
 	else
 	{
@@ -997,15 +984,13 @@
 		if ((queryProps.getIndexResults() == true) &&
 			(resultsList.empty() == false))
 		{
-			IndexInterface *pDocsIndex = m_settings.getIndex(m_settings.m_docsIndexLocation);
-			IndexInterface *pDaemonIndex = m_settings.getIndex(m_settings.m_daemonIndexLocation);
 			set<string> labels;
 			set<unsigned int> docsIds, daemonIds;
 			string labelName(queryProps.getLabelName());
 
+			// Set the list of labels
 			if (labelName.empty() == false)
 			{
-				// Queue this
 				labels.insert(labelName);
 			}
 
@@ -1015,50 +1000,40 @@
 			for (vector<Result>::const_iterator resultIter = resultsList.begin();
 				resultIter != resultsList.end(); ++resultIter)
 			{
-				unsigned int docId = 0;
+				unsigned int indexId;
+				unsigned int docId = resultIter->getIsIndexed(indexId);
 
-				if ((pDocsIndex != NULL) &&
-					(pDocsIndex->isGood() == true) &&
-					((docId = pDocsIndex->hasDocument(resultIter->getLocation())) > 0))
+				if (docId == 0)
 				{
+					DocumentInfo docInfo(resultIter->getTitle(), resultIter->getLocation(),
+						resultIter->getType(), resultIter->getLanguage());
+
+					// Set/reset labels
+					docInfo.setLabels(labels);
+
+					// This document is not in either index
+					m_state.queue_index(docInfo);
+				}
+				else if (indexId == m_settings.getIndexId(m_settings.m_docsIndexLocation))
+				{
 					if (labelName.empty() == false)
 					{
 						docsIds.insert(docId);
 					}
 				}
-				// Is this a document the daemon indexed ?
-				else if ((pDaemonIndex != NULL) &&
-					(pDaemonIndex->isGood() == true) &&
-					((docId = pDaemonIndex->hasDocument(resultIter->getLocation())) > 0))
+				else if (indexId == m_settings.getIndexId(m_settings.m_daemonIndexLocation))
 				{
 					if (labelName.empty() == false)
 					{
 						daemonIds.insert(docId);
 					}
 				}
-				else
-				{
-					DocumentInfo docInfo(resultIter->getTitle(), resultIter->getLocation(),
-						resultIter->getType(), resultIter->getLanguage());
-
-					docInfo.setLabels(labels);
-
-					// No, this is a new document not found in either index
-					m_state.queue_index(docInfo);
-				}
 			}
 
-			// Apply the new label to existing documents
 			if (labelName.empty() == false)
 			{
-				if (pDocsIndex != NULL)
-				{
-					pDocsIndex->setDocumentsLabels(docsIds, labels, false);
-				}
-				if (pDaemonIndex != NULL)
-				{
-					pDaemonIndex->setDocumentsLabels(daemonIds, labels, false);
-				}
+				// Apply the new label to existing documents
+				start_thread(new LabelUpdateThread(labelName, docsIds, daemonIds));
 			}
 		}
 	}
@@ -1755,7 +1730,7 @@
 void mainWindow::on_morelikethis_activate()
 {
 	QueryProperties queryProps;
-	vector<DocumentInfo> resultsList;
+	vector<Result> resultsList;
 	string queryName;
 
 	NotebookPageBox *pNotebookPage = get_current_page();
@@ -1809,29 +1784,20 @@
 		}
 	}
 
-	IndexInterface *pIndex = m_settings.getIndex("MERGED");
-        if (pIndex != NULL)
+	set<string> locations;
+	for (vector<Result>::const_iterator docIter = resultsList.begin();
+		docIter != resultsList.end(); ++docIter)
 	{
-       	set<unsigned int> docIdList;
-
-		if (pIndex->isGood() == true)
+		if (docIter->getIsIndexed() == true)
 		{
-			for (vector<DocumentInfo>::const_iterator docIter = resultsList.begin();
-				docIter != resultsList.end(); ++docIter)
-			{
-				unsigned int docId = pIndex->hasDocument(docIter->getLocation());
-				if (docId > 0)
-				{
-					docIdList.insert(docId);
-				}
-			}
-
-			// Spawn a new thread
-			start_thread(new ExpandQueryThread("xapian", "MERGED",
-				queryProps, docIdList));
+			locations.insert(docIter->getLocation());
 		}
+	}
 
-		delete pIndex;
+	if (locations.empty() == false)
+	{
+		// Spawn a new thread
+		start_thread(new ExpandQueryThread(queryProps, locations));
 	}
 }
 
@@ -2002,7 +1968,7 @@
 		pIndexTree = pIndexPage->getTree();
 	}
 
-	const std::map<string, string> &indexesMap = PinotSettings::getInstance().getIndexes();
+	const std::map<string, string> &indexesMap = m_settings.getIndexes();
 	std::map<string, string>::const_iterator mapIter = indexesMap.find(indexName);	
 	if (mapIter == indexesMap.end())
 	{
@@ -3198,7 +3164,7 @@
 	ustring labelName = pIndexPage->getLabelName();
 	if (labelName.empty() == false)
 	{
-		const std::map<string, string> &indexesMap = PinotSettings::getInstance().getIndexes();
+		const std::map<string, string> &indexesMap = m_settings.getIndexes();
 		std::map<string, string>::const_iterator mapIter = indexesMap.find(indexName);
 		if (mapIter != indexesMap.end())
 		{

Modified: trunk/Utils/Result.cpp
===================================================================
--- trunk/Utils/Result.cpp	2007-02-17 09:23:09 UTC (rev 716)
+++ trunk/Utils/Result.cpp	2007-02-17 09:29:23 UTC (rev 717)
@@ -31,7 +31,9 @@
 Result::Result(const Result &other) :
 	DocumentInfo(other),
 	m_extract(other.m_extract),
-	m_score(other.m_score)
+	m_score(other.m_score),
+	m_indexId(other.m_indexId),
+	m_docId(other.m_docId)
 {
 }
 
@@ -46,6 +48,8 @@
 		DocumentInfo::operator=(other);
 		m_extract = other.m_extract;
 		m_score = other.m_score;
+		m_indexId = other.m_indexId;
+		m_docId = other.m_docId;
 	}
 
 	return *this;
@@ -78,8 +82,41 @@
 	return m_extract;
 }
 
-/// Returns the result score.
+/// Gets the result score.
 float Result::getScore(void) const
 {
 	return m_score;
 }
+
+/// Sets that the result is indexed.
+void Result::setIsIndexed(unsigned int indexId, unsigned int docId)
+{
+	m_indexId = indexId;
+	m_docId = docId;
+}
+
+/// Sets that the result is not indexed.
+void Result::setIsNotIndexed(void)
+{
+	m_indexId = 0;
+	m_docId = 0;
+}
+
+/// Gets whether the result is indexed.
+bool Result::getIsIndexed(void) const
+{
+	if (m_docId > 0)
+	{
+		return true;
+	}
+
+	return false;
+}
+
+/// Gets whether the result is indexed.
+unsigned int Result::getIsIndexed(unsigned int &indexId) const
+{
+	indexId = m_indexId;
+
+	return m_docId;
+}

Modified: trunk/Utils/Result.h
===================================================================
--- trunk/Utils/Result.h	2007-02-17 09:23:09 UTC (rev 716)
+++ trunk/Utils/Result.h	2007-02-17 09:29:23 UTC (rev 717)
@@ -43,12 +43,26 @@
 		/// Gets the result extract.
 		std::string getExtract(void) const;
 
-		/// Returns the result score.
+		/// Gets the result score.
 		float getScore(void) const;
 
+		/// Sets that the result is indexed.
+		void setIsIndexed(unsigned int indexId, unsigned int docId);
+
+		/// Sets that the result is not indexed.
+		void setIsNotIndexed(void);
+
+		/// Gets whether the result is indexed.
+		bool getIsIndexed(void) const;
+
+		/// Gets whether the result is indexed.
+		unsigned int getIsIndexed(unsigned int &indexId) const;
+
 	protected:
 		std::string m_extract;
 		float m_score;
+		unsigned int m_indexId;
+		unsigned int m_docId;
 
 };
 



From fabricecolin at mail.berlios.de  Sat Feb 17 11:11:43 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 17 Feb 2007 11:11:43 +0100
Subject: [Pinot-svn] r718 - in trunk: UI/GTK2/src Utils
Message-ID: <200702171011.l1HABhuP004810@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-17 11:11:43 +0100 (Sat, 17 Feb 2007)
New Revision: 718

Modified:
   trunk/UI/GTK2/src/WorkerThreads.cpp
   trunk/Utils/Result.cpp
Log:
Fixes for previous commit.


Modified: trunk/UI/GTK2/src/WorkerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.cpp	2007-02-17 09:29:23 UTC (rev 717)
+++ trunk/UI/GTK2/src/WorkerThreads.cpp	2007-02-17 10:11:43 UTC (rev 718)
@@ -859,7 +859,8 @@
 					indexId = settings.getIndexId(_("My Web Pages"));
 				}
 			}
-			if (pDaemonIndex != NULL)
+			if ((pDaemonIndex != NULL) &&
+				(docId == 0))
 			{
 				docId = pDaemonIndex->hasDocument(location);
 				if (docId > 0)
@@ -874,6 +875,9 @@
 				cout << "QueryingThread::doWork: found in index " << indexId << endl;
 #endif
 			}
+#ifdef DEBUG
+			else cout << "QueryingThread::doWork: not found in any index" << endl;
+#endif
 
 			m_resultsList.push_back(current);
 		}

Modified: trunk/Utils/Result.cpp
===================================================================
--- trunk/Utils/Result.cpp	2007-02-17 09:29:23 UTC (rev 717)
+++ trunk/Utils/Result.cpp	2007-02-17 10:11:43 UTC (rev 718)
@@ -24,7 +24,9 @@
 	const string &language, float percentageScore) :
 	DocumentInfo(title, location, "", language),
 	m_extract(extract),
-	m_score(percentageScore)
+	m_score(percentageScore),
+	m_indexId(0),
+	m_docId(0)
 {
 }
 



From fabricecolin at mail.berlios.de  Sat Feb 17 11:13:26 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 17 Feb 2007 11:13:26 +0100
Subject: [Pinot-svn] r719 - trunk/UI/GTK2/src
Message-ID: <200702171013.l1HADQhC004903@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-17 11:13:25 +0100 (Sat, 17 Feb 2007)
New Revision: 719

Modified:
   trunk/UI/GTK2/src/pinot-dbus-daemon.cc
   trunk/UI/GTK2/src/statisticsDialog.cc
Log:
Daemon logs its PID, shown by the Status window.
In the Status window, don't add an Errors row if no error was logged.


Modified: trunk/UI/GTK2/src/pinot-dbus-daemon.cc
===================================================================
--- trunk/UI/GTK2/src/pinot-dbus-daemon.cc	2007-02-17 10:11:43 UTC (rev 718)
+++ trunk/UI/GTK2/src/pinot-dbus-daemon.cc	2007-02-17 10:13:25 UTC (rev 719)
@@ -18,11 +18,12 @@
 
 #include <stdlib.h>
 #include <signal.h>
-#include <unistd.h>
 #include <libintl.h>
 #include <getopt.h>
 #include <sys/time.h>
 #include <sys/resource.h>
+#include <sys/types.h>
+#include <unistd.h>
 #include <iostream>
 #include <fstream>
 #include <glibmm.h>
@@ -54,6 +55,7 @@
 using namespace std;
 
 static ofstream g_outputFile;
+static string g_pidFileName;
 static streambuf *g_coutBuf = NULL;
 static streambuf *g_cerrBuf = NULL;
 static struct option g_longOptions[] = {
@@ -93,6 +95,10 @@
 		cerr.rdbuf(g_cerrBuf);
 	}
 	g_outputFile.close();
+	if (g_pidFileName.empty() == false)
+	{
+		unlink(g_pidFileName.c_str());
+	}
 
 	DownloaderInterface::shutdown();
 	MIMEScanner::shutdown();
@@ -256,14 +262,22 @@
 	string confDirectory = PinotSettings::getConfigurationDirectory();
 	if (chdir(confDirectory.c_str()) == 0)
 	{
+		ofstream pidFile;
+		string fileName(confDirectory);
+
 		// Redirect cout and cerr to a file
-		string logFileName = confDirectory;
-		logFileName += "/pinot-dbus-daemon.log";
-		g_outputFile.open(logFileName.c_str());
+		fileName += "/pinot-dbus-daemon.log";
+		g_outputFile.open(fileName.c_str());
 		g_coutBuf = cout.rdbuf();
 		g_cerrBuf = cerr.rdbuf();
 		cout.rdbuf(g_outputFile.rdbuf());
 		cerr.rdbuf(g_outputFile.rdbuf());
+
+		// Save the PID to file
+		g_pidFileName = confDirectory + "/pinot-dbus-daemon.pid";
+		pidFile.open(g_pidFileName.c_str());
+		pidFile << getpid() << endl;
+		pidFile.close();
 	}
 
 	// Localize language names

Modified: trunk/UI/GTK2/src/statisticsDialog.cc
===================================================================
--- trunk/UI/GTK2/src/statisticsDialog.cc	2007-02-17 10:11:43 UTC (rev 718)
+++ trunk/UI/GTK2/src/statisticsDialog.cc	2007-02-17 10:13:25 UTC (rev 719)
@@ -16,6 +16,7 @@
  *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
  */
 
+#include <fstream>
 #include <iostream>
 #include <string>
 #include <map>
@@ -109,8 +110,31 @@
 
 	folderIter = m_refStore->append();
 	row = *folderIter;
-	row[m_statsColumns.m_name] = _("Crawler");
+	row[m_statsColumns.m_name] = _("Daemon");
 
+	// Is the daemon still running ?
+	string pidFileName(PinotSettings::getInstance().getConfigurationDirectory() + "/pinot-dbus-daemon.pid");
+	pid_t daemonPID = 0;
+	ifstream pidFile;
+	pidFile.open(pidFileName.c_str());
+	if (pidFile.is_open() == true)
+	{
+		pidFile >> daemonPID;
+		pidFile.close();
+	}
+	snprintf(countStr, 64, "%u", daemonPID);
+	statIter = m_refStore->append(folderIter->children());
+	row = *statIter;
+	if (daemonPID > 0)
+	{
+		// FIXME: check whether it's actually running !
+		row[m_statsColumns.m_name] = ustring(_("Running under PID")) + " " + countStr;
+	}
+	else
+	{
+		row[m_statsColumns.m_name] = ustring(_("Currently not running"));
+	}
+
 	// Show crawler statistics
 	unsigned int crawledFilesCount = crawlerHistory.getItemsCount(CrawlHistory::CRAWLED);
 	snprintf(countStr, 64, "%u", crawledFilesCount);
@@ -118,9 +142,7 @@
 	row = *statIter;
 	row[m_statsColumns.m_name] = ustring(_("Crawled")) + " " + countStr + " " + _("files");
 
-	TreeModel::iterator errIter = m_refStore->append(folderIter->children());
-	row = *errIter;
-	row[m_statsColumns.m_name] = _("Errors");
+	TreeModel::iterator errIter;
 
 	crawlerHistory.getSources(sources);
 	for (std::map<unsigned int, string>::iterator sourceIter = sources.begin();
@@ -130,11 +152,22 @@
 
 		// Did any error occur on this source ?
 		unsigned int errorCount = crawlerHistory.getSourceItems(sourceIter->first, CrawlHistory::ERROR, errors);
-		if (errorCount > 0)
+		if ((errorCount > 0) &&
+			(errors.empty() == false))
 		{
 			Url urlObj(sourceIter->second);
 			ustring sourceName(urlObj.getLocation());
 
+			if (hasErrors == false)
+			{
+				// Add an errors row
+				errIter  = m_refStore->append(folderIter->children());
+				row = *errIter;
+				row[m_statsColumns.m_name] = _("Errors");
+
+				hasErrors = true;
+			}
+
 			// Add the source
 			TreeModel::iterator srcIter = m_refStore->append(errIter->children());
 			row = *srcIter;
@@ -153,23 +186,17 @@
 				row = *statIter;
 				row[m_statsColumns.m_name] = (*errorIter);
 			}
-
-			hasErrors = true;
 		}
 	}
 
-	if (hasErrors == false)
+	// Expand everything except errors
+	statisticsTreeview->expand_all();
+	if (hasErrors == true)
 	{
-		statIter = m_refStore->append(errIter->children());
-		row = *statIter;
-		row[m_statsColumns.m_name] = _("None");
+		TreeModel::Path errPath = m_refStore->get_path(errIter);
+		statisticsTreeview->collapse_row(errPath);
 	}
 
-	// Expand everything except errors
-	statisticsTreeview->expand_all();
-	TreeModel::Path errPath = m_refStore->get_path(errIter);
-	statisticsTreeview->collapse_row(errPath);
-
 	Adjustment *pAdjustement = statisticsScrolledwindow->get_hadjustment();
 #ifdef DEBUG
 	cout << "statisticsDialog: " << pAdjustement->get_value() << " "



From fabricecolin at mail.berlios.de  Sat Feb 17 11:27:57 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 17 Feb 2007 11:27:57 +0100
Subject: [Pinot-svn] r720 - trunk/po
Message-ID: <200702171027.l1HARvFk005542@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-17 11:27:53 +0100 (Sat, 17 Feb 2007)
New Revision: 720

Modified:
   trunk/po/es.po
   trunk/po/fr.po
   trunk/po/nl.po
   trunk/po/pt_BR.po
   trunk/po/ru.po
   trunk/po/sv.po
Log:
Synced po files.


Modified: trunk/po/es.po
===================================================================
--- trunk/po/es.po	2007-02-17 10:13:25 UTC (rev 719)
+++ trunk/po/es.po	2007-02-17 10:27:53 UTC (rev 720)
@@ -6,10 +6,10 @@
 #, fuzzy
 msgid ""
 msgstr ""
-"Project-Id-Version: pinot 0.65\n"
+"Project-Id-Version: pinot 0.70\n"
 "Report-Msgid-Bugs-To: \n"
 "POT-Creation-Date: 2006-12-03 15:05+0000\n"
-"PO-Revision-Date: 2006-12-20 21:10+0800\n"
+"PO-Revision-Date: 2007-02-17 17:34+0800\n"
 "Last-Translator: Fabrice Colin <fabricecolin at users.berlios.de>\n"
 "Language-Team: es <fabricecolin at users.berlios.de>\n"
 "MIME-Version: 1.0\n"
@@ -25,76 +25,96 @@
 msgid "Current User"
 msgstr "Usuario"
 
-#: UI/GTK2/src/EnginesTree.cpp:339 UI/GTK2/src/mainWindow.cc:322
-#: UI/GTK2/src/mainWindow.cc:325 UI/GTK2/src/mainWindow.cc:551
-#: UI/GTK2/src/mainWindow.cc:1205 UI/GTK2/src/mainWindow.cc:1248
-#: UI/GTK2/src/mainWindow.cc:1268 UI/GTK2/src/mainWindow.cc:1299
-#: UI/GTK2/src/mainWindow.cc:1869 UI/GTK2/src/PinotSettings.cpp:240
-#: UI/GTK2/src/PinotSettings.cpp:1230 UI/GTK2/src/PinotSettings.cpp:1286
+#: UI/GTK2/src/EnginesTree.cpp:339 UI/GTK2/src/mainWindow.cc:325
+#: UI/GTK2/src/mainWindow.cc:328 UI/GTK2/src/mainWindow.cc:541
+#: UI/GTK2/src/mainWindow.cc:1186 UI/GTK2/src/mainWindow.cc:1229
+#: UI/GTK2/src/mainWindow.cc:1249 UI/GTK2/src/mainWindow.cc:1280
+#: UI/GTK2/src/mainWindow.cc:1859 UI/GTK2/src/PinotSettings.cpp:241
+#: UI/GTK2/src/PinotSettings.cpp:1281 UI/GTK2/src/PinotSettings.cpp:1337
+#: UI/GTK2/src/statisticsDialog.cc:88 UI/GTK2/src/WorkerThreads.cpp:859
 msgid "My Web Pages"
 msgstr "Mis Paginas Web"
 
-#: UI/GTK2/src/EnginesTree.cpp:340 UI/GTK2/src/mainWindow.cc:316
-#: UI/GTK2/src/mainWindow.cc:319 UI/GTK2/src/PinotSettings.cpp:241
-#: UI/GTK2/src/PinotSettings.cpp:1231 UI/GTK2/src/PinotSettings.cpp:1287
+#: UI/GTK2/src/EnginesTree.cpp:340 UI/GTK2/src/mainWindow.cc:319
+#: UI/GTK2/src/mainWindow.cc:322 UI/GTK2/src/PinotSettings.cpp:242
+#: UI/GTK2/src/PinotSettings.cpp:1282 UI/GTK2/src/PinotSettings.cpp:1338
+#: UI/GTK2/src/statisticsDialog.cc:74 UI/GTK2/src/WorkerThreads.cpp:867
 msgid "My Documents"
 msgstr "Mis documentos"
 
-#: UI/GTK2/src/importDialog.cc:83 UI/GTK2/src/queryDialog.cc:81
-msgid "None"
-msgstr "Ninguno"
+#: UI/GTK2/src/dateDialog_glade.cc:76 UI/GTK2/src/queryDialog_glade.cc:91
+#: UI/GTK2/src/queryDialog_glade.cc:92
+msgid "Date"
+msgstr "Date"
 
-#: UI/GTK2/src/importDialog_glade.cc:67 UI/GTK2/src/indexDialog_glade.cc:68
-msgid "Location:"
-msgstr "Localizaci?n:"
+#: UI/GTK2/src/indexDialog.cc:130
+msgid "Served by"
+msgstr ""
 
-#: UI/GTK2/src/importDialog_glade.cc:68
-#: UI/GTK2/src/propertiesDialog_glade.cc:65
-msgid "Title:"
-msgstr "T?tulo:"
+#: UI/GTK2/src/indexDialog.cc:134
+#, fuzzy
+msgid "Local"
+msgstr "Localizaci?n"
 
-#: UI/GTK2/src/importDialog_glade.cc:71
-msgid "Apply label:"
-msgstr "Etiqueta aplicada:"
-
-#: UI/GTK2/src/importDialog_glade.cc:77
-msgid "Import"
-msgstr "Importar"
-
-#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:213
-msgid "Import URL"
-msgstr "Importar una URL"
-
-#: UI/GTK2/src/indexDialog.cc:225
+#: UI/GTK2/src/indexDialog.cc:300
 msgid "Index location"
 msgstr "Localizaci?n del ?ndice"
 
-#: UI/GTK2/src/indexDialog_glade.cc:62 UI/GTK2/src/queryDialog_glade.cc:68
+#: UI/GTK2/src/indexDialog_glade.cc:65 UI/GTK2/src/queryDialog_glade.cc:68
 msgid "Name:"
 msgstr "Nombre:"
 
-#: UI/GTK2/src/indexDialog_glade.cc:64
+#: UI/GTK2/src/indexDialog_glade.cc:67
 msgid "..."
 msgstr "..."
 
-#: UI/GTK2/src/indexDialog_glade.cc:67
+#: UI/GTK2/src/indexDialog_glade.cc:70
 msgid "Type:"
 msgstr "Tipo:"
 
-#: UI/GTK2/src/indexDialog_glade.cc:69
+#: UI/GTK2/src/indexDialog_glade.cc:71 UI/GTK2/src/importDialog_glade.cc:67
+msgid "Location:"
+msgstr "Localizaci?n:"
+
+#: UI/GTK2/src/indexDialog_glade.cc:72
 msgid "Port:"
 msgstr "Puerto:"
 
-#: UI/GTK2/src/indexDialog_glade.cc:143
+#: UI/GTK2/src/indexDialog_glade.cc:79
+msgid "Host name:"
+msgstr "Nombre de servidor:"
+
+#: UI/GTK2/src/indexDialog_glade.cc:163
 msgid "External index"
 msgstr "?ndice externo"
 
-#: UI/GTK2/src/IndexTree.cpp:68 UI/GTK2/src/queryDialog.cc:112
+#: UI/GTK2/src/importDialog.cc:82 UI/GTK2/src/queryDialog.cc:108
+msgid "None"
+msgstr "Ninguno"
+
+#: UI/GTK2/src/importDialog_glade.cc:68
+#: UI/GTK2/src/propertiesDialog_glade.cc:67
+msgid "Title:"
+msgstr "T?tulo:"
+
+#: UI/GTK2/src/importDialog_glade.cc:71
+msgid "Apply label:"
+msgstr "Etiqueta aplicada:"
+
+#: UI/GTK2/src/importDialog_glade.cc:77
+msgid "Import"
+msgstr "Importar"
+
+#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:221
+msgid "Import URL"
+msgstr "Importar una URL"
+
+#: UI/GTK2/src/IndexTree.cpp:68 UI/GTK2/src/queryDialog.cc:139
 #: UI/GTK2/src/ResultsTree.cpp:126
 msgid "Title"
 msgstr "T?tulo"
 
-#: UI/GTK2/src/IndexTree.cpp:73 UI/GTK2/src/queryDialog.cc:115
+#: UI/GTK2/src/IndexTree.cpp:73 UI/GTK2/src/queryDialog.cc:142
 #: UI/GTK2/src/ResultsTree.cpp:136
 msgid "URL"
 msgstr "URL"
@@ -115,379 +135,399 @@
 msgid "All labels"
 msgstr "Todas las etiquetas"
 
-#: UI/GTK2/src/mainWindow.cc:138
+#: UI/GTK2/src/launcherDialog_glade.cc:64
+msgid ""
+"There is no helper application defined for this document's type.\n"
+"Please enter the command to open this document."
+msgstr ""
+
+#: UI/GTK2/src/launcherDialog_glade.cc:67
+msgid "Use this command for other documents of the same type."
+msgstr ""
+
+#: UI/GTK2/src/launcherDialog_glade.cc:99
+msgid "Helper application"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:141
 msgid "Query Name"
 msgstr "Nombre de la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:143
+#: UI/GTK2/src/mainWindow.cc:146
 msgid "Last Run"
 msgstr "?ltima ejecuci?n"
 
-#: UI/GTK2/src/mainWindow.cc:148
+#: UI/GTK2/src/mainWindow.cc:151
 msgid "Summary"
 msgstr "Sumario"
 
-#: UI/GTK2/src/mainWindow.cc:181
+#: UI/GTK2/src/mainWindow.cc:184
 msgid "Show all search engines"
 msgstr "Mostrar todos los motores de b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:182
+#: UI/GTK2/src/mainWindow.cc:185
 msgid "Add index"
 msgstr "A?adir ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:183
+#: UI/GTK2/src/mainWindow.cc:186
 msgid "Remove index"
 msgstr "Borrar ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:189
+#: UI/GTK2/src/mainWindow.cc:192
 msgid "Ready"
 msgstr "Listo"
 
-#: UI/GTK2/src/mainWindow.cc:240
+#: UI/GTK2/src/mainWindow.cc:243
 msgid "N/A"
 msgstr "Desconocido"
 
-#: UI/GTK2/src/mainWindow.cc:255
-msgid "<undefined>"
-msgstr "<indefinido>"
+#: UI/GTK2/src/mainWindow.cc:258
+msgid "Undefined"
+msgstr "Indefinido"
 
-#: UI/GTK2/src/mainWindow.cc:474
+#: UI/GTK2/src/mainWindow.cc:476
 msgid "Result location is"
 msgstr "La localizaci?n del resultado es"
 
-#: UI/GTK2/src/mainWindow.cc:561
+#: UI/GTK2/src/mainWindow.cc:551
 msgid "Document location is"
 msgstr "La localizaci?n del documento es"
 
-#: UI/GTK2/src/mainWindow.cc:884
+#: UI/GTK2/src/mainWindow.cc:877
 msgid "Showing"
 msgstr "Mostrando"
 
-#: UI/GTK2/src/mainWindow.cc:889
+#: UI/GTK2/src/mainWindow.cc:882
 msgid "of"
 msgstr "documentos"
 
-#: UI/GTK2/src/mainWindow.cc:894
+#: UI/GTK2/src/mainWindow.cc:887
 msgid "documents, starting at"
 msgstr "documentos comenzando en"
 
-#: UI/GTK2/src/mainWindow.cc:927
+#: UI/GTK2/src/mainWindow.cc:920
 msgid "Query"
 msgstr "B?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:931 UI/GTK2/src/mainWindow.cc:2937
+#: UI/GTK2/src/mainWindow.cc:924 UI/GTK2/src/mainWindow.cc:2922
 msgid "on"
 msgstr "en"
 
-#: UI/GTK2/src/mainWindow.cc:935
+#: UI/GTK2/src/mainWindow.cc:928
 msgid "ended"
 msgstr "finalizado"
 
-#: UI/GTK2/src/mainWindow.cc:1070
+#: UI/GTK2/src/mainWindow.cc:1051
 msgid "More Like"
 msgstr "M?s como"
 
-#: UI/GTK2/src/mainWindow.cc:1131
+#: UI/GTK2/src/mainWindow.cc:1112
 msgid "Updated label(s)"
 msgstr "Etiqueta(s) actualizada(s)"
 
-#: UI/GTK2/src/mainWindow.cc:1215
+#: UI/GTK2/src/mainWindow.cc:1196
 msgid "Updated document"
 msgstr "Documento actualizado"
 
-#: UI/GTK2/src/mainWindow.cc:1228
+#: UI/GTK2/src/mainWindow.cc:1209
 msgid "Indexed"
 msgstr "Indizado"
 
-#: UI/GTK2/src/mainWindow.cc:1269
+#: UI/GTK2/src/mainWindow.cc:1250
 msgid "Unindexed document(s)"
 msgstr "Documento(s) no indizado(s)"
 
-#: UI/GTK2/src/mainWindow.cc:1310
+#: UI/GTK2/src/mainWindow.cc:1291
 msgid "Updated document properties"
 msgstr "Propiedades del documento actualizadas"
 
-#: UI/GTK2/src/mainWindow.cc:1357
+#: UI/GTK2/src/mainWindow.cc:1338
 msgid "Couldn't rename index, name"
 msgstr "No se pudo renombrar ?ndice, nombre"
 
-#: UI/GTK2/src/mainWindow.cc:1361 UI/GTK2/src/mainWindow.cc:2261
-#: UI/GTK2/src/mainWindow.cc:2772
+#: UI/GTK2/src/mainWindow.cc:1342 UI/GTK2/src/mainWindow.cc:2246
+#: UI/GTK2/src/mainWindow.cc:2757
 msgid "is already in use"
 msgstr "ya est? en uso"
 
-#: UI/GTK2/src/mainWindow.cc:1374
+#: UI/GTK2/src/mainWindow.cc:1355
 msgid "Couldn't rename index"
 msgstr "No se pudo renombrar el ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:1387
+#: UI/GTK2/src/mainWindow.cc:1368
 msgid "Edited index"
 msgstr "?ndice editado"
 
-#: UI/GTK2/src/mainWindow.cc:1747 UI/GTK2/src/mainWindow.cc:2431
+#: UI/GTK2/src/mainWindow.cc:1753 UI/GTK2/src/mainWindow.cc:2416
 msgid "Live query"
 msgstr "B?squeda activa"
 
-#: UI/GTK2/src/mainWindow.cc:1773
+#: UI/GTK2/src/mainWindow.cc:1779
 msgid "Couldn't find query"
 msgstr "No se pudo a?adir la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:1817 UI/GTK2/src/mainWindow.cc:1913
-msgid "Please set a location for the index first"
-msgstr "Por favor, primero fije una localizaci?n para el ?ndice"
-
-#: UI/GTK2/src/mainWindow.cc:1992 UI/GTK2/src/WorkerThreads.cpp:671
-#: UI/GTK2/src/WorkerThreads.cpp:1518
+#: UI/GTK2/src/mainWindow.cc:1975 UI/GTK2/src/WorkerThreads.cpp:650
+#: UI/GTK2/src/WorkerThreads.cpp:1583
 msgid "Index"
 msgstr "?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:1996 UI/GTK2/src/WorkerThreads.cpp:675
-#: UI/GTK2/src/WorkerThreads.cpp:1522
+#: UI/GTK2/src/mainWindow.cc:1979 UI/GTK2/src/WorkerThreads.cpp:654
+#: UI/GTK2/src/WorkerThreads.cpp:1587
 msgid "doesn't exist"
 msgstr "no existe"
 
-#: UI/GTK2/src/mainWindow.cc:2149
+#: UI/GTK2/src/mainWindow.cc:2133
 msgid "Remove this document from the index ?"
 msgstr "?Borrar este documento del ?ndice?"
 
-#: UI/GTK2/src/mainWindow.cc:2168
+#: UI/GTK2/src/mainWindow.cc:2152
 msgid "Remove these documents from the index ?"
 msgstr "?Borrar este documento del ?ndice?"
 
-#: UI/GTK2/src/mainWindow.cc:2212
+#: UI/GTK2/src/mainWindow.cc:2196
 msgid "A metasearch tool for the Free Desktop"
 msgstr "Una herramienta metabuscador para el escritorio libre"
 
-#: UI/GTK2/src/mainWindow.cc:2213
-msgid "(C) 2005-2006 Fabrice Colin"
-msgstr "(C) 2005-2006 Fabrice Colin"
+#: UI/GTK2/src/mainWindow.cc:2197
+msgid "Search the Web and your documents !"
+msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:2257
+#: UI/GTK2/src/mainWindow.cc:2198
+msgid "(C) 2005 Fabrice Colin"
+msgstr "(C) 2005 Fabrice Colin"
+
+#: UI/GTK2/src/mainWindow.cc:2242
 msgid "Index name"
 msgstr "Nombre del ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2272
+#: UI/GTK2/src/mainWindow.cc:2257
 msgid "Couldn't add index"
 msgstr "No se pudo a?adir el ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2286
+#: UI/GTK2/src/mainWindow.cc:2271
 msgid "Added new index"
 msgstr "A?adido un nuevo ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2321
+#: UI/GTK2/src/mainWindow.cc:2306
 msgid "Couldn't remove index"
 msgstr "No se pudo borrar el ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2586
+#: UI/GTK2/src/mainWindow.cc:2571
 msgid "At least one task hasn't completed yet. Quit now ?"
 msgstr "Al menos una tarea no ha finalizado. ?Parar ahora?"
 
-#: UI/GTK2/src/mainWindow.cc:2768
+#: UI/GTK2/src/mainWindow.cc:2753
 msgid "Query name"
 msgstr "Nombre la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:2795
+#: UI/GTK2/src/mainWindow.cc:2780
 msgid "Couldn't update query"
 msgstr "No se pudo actualizar la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:2803
+#: UI/GTK2/src/mainWindow.cc:2788
 msgid "Edited query"
 msgstr "B?squeda editada"
 
-#: UI/GTK2/src/mainWindow.cc:2810
+#: UI/GTK2/src/mainWindow.cc:2795
 msgid "Couldn't add query"
 msgstr "No se pudo a?adir la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:2818
+#: UI/GTK2/src/mainWindow.cc:2803
 msgid "Added new query"
 msgstr "A?adida una nueva b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:2831
+#: UI/GTK2/src/mainWindow.cc:2816
 msgid "Query is not set"
 msgstr "B?squeda no definida"
 
-#: UI/GTK2/src/mainWindow.cc:2842
+#: UI/GTK2/src/mainWindow.cc:2827
 msgid "No search engine selected"
 msgstr "Motor de b?squeda no seleccionado"
 
-#: UI/GTK2/src/mainWindow.cc:2924
+#: UI/GTK2/src/mainWindow.cc:2909
 msgid "Please set the Google API key first"
 msgstr "Por favor, primero configure el API de Google"
 
-#: UI/GTK2/src/mainWindow.cc:2933
+#: UI/GTK2/src/mainWindow.cc:2918
 msgid "Running query"
 msgstr "Ejecutando la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:3105
+#: UI/GTK2/src/mainWindow.cc:3102
 msgid "No default application defined for type"
 msgstr "No hay aplicaci?n predefinida para el tipo"
 
-#: UI/GTK2/src/mainWindow_glade.cc:124
+#: UI/GTK2/src/mainWindow_glade.cc:126
 msgid "Query:"
 msgstr "B?squeda:"
 
-#: UI/GTK2/src/mainWindow_glade.cc:136
+#: UI/GTK2/src/mainWindow_glade.cc:138
 msgid "Edit"
 msgstr "Editar"
 
-#: UI/GTK2/src/mainWindow_glade.cc:145
+#: UI/GTK2/src/mainWindow_glade.cc:147
 msgid "Stored queries"
 msgstr "B?squedas guardadas"
 
-#: UI/GTK2/src/mainWindow_glade.cc:180
+#: UI/GTK2/src/mainWindow_glade.cc:161 UI/GTK2/src/statisticsDialog.cc:46
+#: UI/GTK2/src/statisticsDialog_glade.cc:87
+msgid "Status"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow_glade.cc:188
 msgid "Search Engine"
 msgstr "Motor de b?squeda"
 
-#: UI/GTK2/src/mainWindow_glade.cc:183
+#: UI/GTK2/src/mainWindow_glade.cc:191
 msgid "Host Name"
 msgstr "Nombre del servidor"
 
-#: UI/GTK2/src/mainWindow_glade.cc:186
+#: UI/GTK2/src/mainWindow_glade.cc:194
 msgid "Show Extract"
 msgstr "Mostrar extra?dos"
 
-#: UI/GTK2/src/mainWindow_glade.cc:189
+#: UI/GTK2/src/mainWindow_glade.cc:197
 msgid "Group By"
 msgstr "Agrupar por"
 
-#: UI/GTK2/src/mainWindow_glade.cc:192
+#: UI/GTK2/src/mainWindow_glade.cc:200
 msgid "Clear List"
 msgstr "Limpiar la lista"
 
-#: UI/GTK2/src/mainWindow_glade.cc:198
+#: UI/GTK2/src/mainWindow_glade.cc:206
 msgid "Vie_w"
 msgstr "Ver"
 
-#: UI/GTK2/src/mainWindow_glade.cc:201
+#: UI/GTK2/src/mainWindow_glade.cc:209
 msgid "View Cache"
 msgstr "Ver la cache"
 
-#: UI/GTK2/src/mainWindow_glade.cc:204
+#: UI/GTK2/src/mainWindow_glade.cc:212
 msgid "More Like This"
 msgstr "Documentos similares"
 
-#: UI/GTK2/src/mainWindow_glade.cc:207 UI/GTK2/src/mainWindow_glade.cc:243
+#: UI/GTK2/src/mainWindow_glade.cc:215 UI/GTK2/src/mainWindow_glade.cc:251
 msgid "_Index"
 msgstr "?ndice"
 
-#: UI/GTK2/src/mainWindow_glade.cc:210
+#: UI/GTK2/src/mainWindow_glade.cc:218
 msgid "List Contents Of"
 msgstr "Listar el contenido de"
 
-#: UI/GTK2/src/mainWindow_glade.cc:219
+#: UI/GTK2/src/mainWindow_glade.cc:227
 msgid "View"
 msgstr "Ver"
 
-#: UI/GTK2/src/mainWindow_glade.cc:222
+#: UI/GTK2/src/mainWindow_glade.cc:230
 msgid "Update"
 msgstr "Actualizar"
 
-#: UI/GTK2/src/mainWindow_glade.cc:225
+#: UI/GTK2/src/mainWindow_glade.cc:233
 msgid "Unindex"
 msgstr "Des-indizar"
 
-#: UI/GTK2/src/mainWindow_glade.cc:228
-#: UI/GTK2/src/propertiesDialog_glade.cc:146
+#: UI/GTK2/src/mainWindow_glade.cc:236
+#: UI/GTK2/src/propertiesDialog_glade.cc:177
 msgid "Properties"
 msgstr "Propiedades"
 
-#: UI/GTK2/src/mainWindow_glade.cc:231
+#: UI/GTK2/src/mainWindow_glade.cc:239
 msgid "_About"
 msgstr "Sobre"
 
-#: UI/GTK2/src/mainWindow_glade.cc:234
+#: UI/GTK2/src/mainWindow_glade.cc:242
 msgid "_Session"
 msgstr "Sesi?n"
 
-#: UI/GTK2/src/mainWindow_glade.cc:237
+#: UI/GTK2/src/mainWindow_glade.cc:245
 msgid "_Edit"
 msgstr "Editar"
 
-#: UI/GTK2/src/mainWindow_glade.cc:240
+#: UI/GTK2/src/mainWindow_glade.cc:248
 msgid "_Results"
 msgstr "Resultados"
 
-#: UI/GTK2/src/mainWindow_glade.cc:246
+#: UI/GTK2/src/mainWindow_glade.cc:254
 msgid "_Help"
 msgstr "Ayuda"
 
-#: UI/GTK2/src/mainWindow_glade.cc:383
+#: UI/GTK2/src/mainWindow_glade.cc:391
 msgid "Pinot"
 msgstr "Pinot"
 
-#: UI/GTK2/src/pinot.cc:204 UI/GTK2/src/pinot-dbus-daemon.cc:273
+#: UI/GTK2/src/pinot.cc:203 UI/GTK2/src/pinot-dbus-daemon.cc:284
+#: UI/GTK2/src/propertiesDialog.cc:65 UI/GTK2/src/propertiesDialog.cc:74
 msgid "Unknown"
 msgstr "Desconocido"
 
-#: UI/GTK2/src/pinot.cc:205 UI/GTK2/src/pinot-dbus-daemon.cc:274
+#: UI/GTK2/src/pinot.cc:204 UI/GTK2/src/pinot-dbus-daemon.cc:285
 msgid "Danish"
 msgstr "Dan?s"
 
-#: UI/GTK2/src/pinot.cc:206 UI/GTK2/src/pinot-dbus-daemon.cc:275
+#: UI/GTK2/src/pinot.cc:205 UI/GTK2/src/pinot-dbus-daemon.cc:286
 msgid "Dutch"
 msgstr "Holand?s"
 
-#: UI/GTK2/src/pinot.cc:207 UI/GTK2/src/pinot-dbus-daemon.cc:276
+#: UI/GTK2/src/pinot.cc:206 UI/GTK2/src/pinot-dbus-daemon.cc:287
 msgid "English"
 msgstr "Ingl?s"
 
-#: UI/GTK2/src/pinot.cc:208 UI/GTK2/src/pinot-dbus-daemon.cc:277
+#: UI/GTK2/src/pinot.cc:207 UI/GTK2/src/pinot-dbus-daemon.cc:288
 msgid "Finnish"
 msgstr "Finland?s"
 
-#: UI/GTK2/src/pinot.cc:209 UI/GTK2/src/pinot-dbus-daemon.cc:278
+#: UI/GTK2/src/pinot.cc:208 UI/GTK2/src/pinot-dbus-daemon.cc:289
 msgid "French"
 msgstr "Franc?s"
 
-#: UI/GTK2/src/pinot.cc:210 UI/GTK2/src/pinot-dbus-daemon.cc:279
+#: UI/GTK2/src/pinot.cc:209 UI/GTK2/src/pinot-dbus-daemon.cc:290
 msgid "German"
 msgstr "Alem?n"
 
-#: UI/GTK2/src/pinot.cc:211 UI/GTK2/src/pinot-dbus-daemon.cc:280
+#: UI/GTK2/src/pinot.cc:210 UI/GTK2/src/pinot-dbus-daemon.cc:291
 msgid "Italian"
 msgstr "Italiano"
 
-#: UI/GTK2/src/pinot.cc:212 UI/GTK2/src/pinot-dbus-daemon.cc:281
+#: UI/GTK2/src/pinot.cc:211 UI/GTK2/src/pinot-dbus-daemon.cc:292
 msgid "Norwegian"
 msgstr "Noruego"
 
-#: UI/GTK2/src/pinot.cc:213 UI/GTK2/src/pinot-dbus-daemon.cc:282
+#: UI/GTK2/src/pinot.cc:212 UI/GTK2/src/pinot-dbus-daemon.cc:293
 msgid "Portuguese"
 msgstr "Portugu?s"
 
-#: UI/GTK2/src/pinot.cc:214 UI/GTK2/src/pinot-dbus-daemon.cc:283
+#: UI/GTK2/src/pinot.cc:213 UI/GTK2/src/pinot-dbus-daemon.cc:294
 msgid "Russian"
 msgstr "Ruso"
 
-#: UI/GTK2/src/pinot.cc:215 UI/GTK2/src/pinot-dbus-daemon.cc:284
+#: UI/GTK2/src/pinot.cc:214 UI/GTK2/src/pinot-dbus-daemon.cc:295
 msgid "Spanish"
 msgstr "Espa?ol"
 
-#: UI/GTK2/src/pinot.cc:216 UI/GTK2/src/pinot-dbus-daemon.cc:285
+#: UI/GTK2/src/pinot.cc:215 UI/GTK2/src/pinot-dbus-daemon.cc:296
 msgid "Swedish"
 msgstr "Sueco"
 
-#: UI/GTK2/src/pinot.cc:240
+#: UI/GTK2/src/pinot.cc:239
 msgid "Couldn't open index"
 msgstr "No se pudo abrir el ?ndice"
 
-#: UI/GTK2/src/pinot.cc:256
+#: UI/GTK2/src/pinot.cc:255
 msgid "Couldn't create history database"
 msgstr "No se pudo crear la base de datos del hist?rico"
 
-#: UI/GTK2/src/PinotSettings.cpp:246
+#: UI/GTK2/src/PinotSettings.cpp:247
 msgid "Important"
 msgstr "Importante"
 
-#: UI/GTK2/src/PinotSettings.cpp:247
+#: UI/GTK2/src/PinotSettings.cpp:248
 msgid "New"
 msgstr "Nuevo"
 
-#: UI/GTK2/src/PinotSettings.cpp:248
+#: UI/GTK2/src/PinotSettings.cpp:249
 msgid "Personal"
 msgstr "Personal"
 
-#: UI/GTK2/src/PinotSettings.cpp:1055
+#: UI/GTK2/src/PinotSettings.cpp:1085
 msgid "Unclassified"
 msgstr "No clasificado"
 
@@ -507,15 +547,15 @@
 msgid "Pattern"
 msgstr "Patron"
 
-#: UI/GTK2/src/prefsDialog.cc:426
+#: UI/GTK2/src/prefsDialog.cc:423
 msgid "New Label"
 msgstr "Nueva etiqueta"
 
-#: UI/GTK2/src/prefsDialog.cc:467
+#: UI/GTK2/src/prefsDialog.cc:464
 msgid "Directory to index"
 msgstr "Carpeta a indexar"
 
-#: UI/GTK2/src/prefsDialog.cc:525
+#: UI/GTK2/src/prefsDialog.cc:522
 msgid "Mbox File Location"
 msgstr "Localizaci?n del fichero mbox"
 
@@ -584,46 +624,62 @@
 msgid "Preferences"
 msgstr "Preferencias"
 
-#: UI/GTK2/src/propertiesDialog.cc:51 UI/GTK2/src/queryDialog.cc:127
+#: UI/GTK2/src/propertiesDialog.cc:52 UI/GTK2/src/queryDialog.cc:154
 msgid "Label"
 msgstr "Etiqueta"
 
-#: UI/GTK2/src/propertiesDialog.cc:64
+#: UI/GTK2/src/propertiesDialog.cc:86
 msgid "Per document"
 msgstr "Documento"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:66
+#: UI/GTK2/src/propertiesDialog_glade.cc:68
 msgid "Language:"
 msgstr "Idioma:"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:67
+#: UI/GTK2/src/propertiesDialog_glade.cc:69
 msgid "MIME type:"
 msgstr "Tipo MIME:"
 
-#: UI/GTK2/src/queryDialog.cc:103
+#: UI/GTK2/src/propertiesDialog_glade.cc:70
+msgid "Size:"
+msgstr ""
+
+#: UI/GTK2/src/propertiesDialog_glade.cc:73
+msgid "Terms:"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog.cc:130
 msgid "Host name"
 msgstr "Nombre de servidor"
 
-#: UI/GTK2/src/queryDialog.cc:106
+#: UI/GTK2/src/queryDialog.cc:133
 msgid "File name"
 msgstr "Nombre de archivo"
 
-#: UI/GTK2/src/queryDialog.cc:109
+#: UI/GTK2/src/queryDialog.cc:136
 msgid "File extension"
 msgstr "Extensi?n del archivo"
 
-#: UI/GTK2/src/queryDialog.cc:118
+#: UI/GTK2/src/queryDialog.cc:145
 msgid "Directory"
 msgstr "Carpeta"
 
-#: UI/GTK2/src/queryDialog.cc:121
+#: UI/GTK2/src/queryDialog.cc:148
 msgid "Language code"
 msgstr "Codigo de idioma"
 
-#: UI/GTK2/src/queryDialog.cc:124
+#: UI/GTK2/src/queryDialog.cc:151
 msgid "MIME type"
 msgstr "Tipo MIME"
 
+#: UI/GTK2/src/queryDialog.cc:271
+msgid "Start date"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog.cc:286
+msgid "End date"
+msgstr ""
+
 #: UI/GTK2/src/queryDialog_glade.cc:72
 msgid "New filter:"
 msgstr "Nuevo filtro:"
@@ -633,14 +689,22 @@
 msgstr "B?squeda"
 
 #: UI/GTK2/src/queryDialog_glade.cc:83
-msgid "Index all results with label"
+msgid "Index results with label"
 msgstr "Indizar todos los resultados con la etiqueta"
 
 #: UI/GTK2/src/queryDialog_glade.cc:86
 msgid "Number of results:"
 msgstr "N?mero de resultados:"
 
-#: UI/GTK2/src/queryDialog_glade.cc:182
+#: UI/GTK2/src/queryDialog_glade.cc:89
+msgid "Start date:"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog_glade.cc:90
+msgid "End date:"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog_glade.cc:201
 msgid "Query parameters"
 msgstr "Par?metros de b?squeda"
 
@@ -652,6 +716,53 @@
 msgid "Extract"
 msgstr "Extra?dos"
 
+#: UI/GTK2/src/statisticsDialog.cc:69
+#, fuzzy
+msgid "Indexes"
+msgstr "Indizado"
+
+#: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/statisticsDialog.cc:97
+msgid "documents"
+msgstr "documentos"
+
+#: UI/GTK2/src/statisticsDialog.cc:102
+#, fuzzy
+msgid "History"
+msgstr "Carpeta"
+
+#: UI/GTK2/src/statisticsDialog.cc:109
+msgid "Viewed"
+msgstr "Ver"
+
+#: UI/GTK2/src/statisticsDialog.cc:109
+msgid "results"
+msgstr "resultados"
+
+#: UI/GTK2/src/statisticsDialog.cc:113
+msgid "Daemon"
+msgstr "Daemon"
+
+#: UI/GTK2/src/statisticsDialog.cc:131
+#, fuzzy
+msgid "Running under PID"
+msgstr "PID"
+
+#: UI/GTK2/src/statisticsDialog.cc:135
+msgid "Currently not running"
+msgstr ""
+
+#: UI/GTK2/src/statisticsDialog.cc:143
+msgid "Crawled"
+msgstr ""
+
+#: UI/GTK2/src/statisticsDialog.cc:143
+msgid "files"
+msgstr ""
+
+#: UI/GTK2/src/statisticsDialog.cc:166
+msgid "Errors"
+msgstr ""
+
 #: UI/GTK2/src/WorkerThreads.cpp:321
 msgid "Can't index mail here"
 msgstr "No se pudo indizar el buzon de correo"
@@ -664,57 +775,53 @@
 msgid "is blacklisted"
 msgstr "ya excluido"
 
-#: UI/GTK2/src/WorkerThreads.cpp:360 UI/GTK2/src/WorkerThreads.cpp:684
-#: UI/GTK2/src/WorkerThreads.cpp:961 UI/GTK2/src/WorkerThreads.cpp:970
-#: UI/GTK2/src/WorkerThreads.cpp:1139 UI/GTK2/src/WorkerThreads.cpp:1398
-#: UI/GTK2/src/WorkerThreads.cpp:1531
+#: UI/GTK2/src/WorkerThreads.cpp:663 UI/GTK2/src/WorkerThreads.cpp:936
+#: UI/GTK2/src/WorkerThreads.cpp:1022 UI/GTK2/src/WorkerThreads.cpp:1031
+#: UI/GTK2/src/WorkerThreads.cpp:1203 UI/GTK2/src/WorkerThreads.cpp:1463
+#: UI/GTK2/src/WorkerThreads.cpp:1596
 msgid "Index error on"
 msgstr "Error en el ?ndice"
 
-#: UI/GTK2/src/WorkerThreads.cpp:805 UI/GTK2/src/WorkerThreads.cpp:905
+#: UI/GTK2/src/WorkerThreads.cpp:784 UI/GTK2/src/WorkerThreads.cpp:957
 msgid "Couldn't create search engine"
 msgstr "No se pudo crear el motor de b?squeda"
 
-#: UI/GTK2/src/WorkerThreads.cpp:817 UI/GTK2/src/WorkerThreads.cpp:919
+#: UI/GTK2/src/WorkerThreads.cpp:796 UI/GTK2/src/WorkerThreads.cpp:971
 msgid "Couldn't run query on search engine"
 msgstr "No se pudo ejecutar la b?squeda contra el motor"
 
-#: UI/GTK2/src/WorkerThreads.cpp:833
+#: UI/GTK2/src/WorkerThreads.cpp:830
 msgid "No title"
 msgstr "Sin t?tulo"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1049
+#: UI/GTK2/src/WorkerThreads.cpp:1125
 msgid "Couldn't obtain downloader for protocol"
 msgstr "No se pudo usar un recuperador para el protocolo"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1060
+#: UI/GTK2/src/WorkerThreads.cpp:1136
 msgid "Couldn't retrieve"
 msgstr "No se pudo descargar"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1161 UI/GTK2/src/WorkerThreads.cpp:1233
+#: UI/GTK2/src/WorkerThreads.cpp:1233 UI/GTK2/src/WorkerThreads.cpp:1309
 msgid "Cannot index document type"
 msgstr "No se pudo indizar el tipo de documento"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1165 UI/GTK2/src/WorkerThreads.cpp:1237
+#: UI/GTK2/src/WorkerThreads.cpp:1237 UI/GTK2/src/WorkerThreads.cpp:1313
 msgid "at"
 msgstr "a"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1259
-msgid "Couldn't tokenize"
-msgstr "No se pudo extraer cadenas"
-
-#: UI/GTK2/src/WorkerThreads.cpp:1279
+#: UI/GTK2/src/WorkerThreads.cpp:1344
 msgid "Robots META tag forbids indexing"
 msgstr "La etiqueta META Robots proh?be la indizaci?n"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1328
+#: UI/GTK2/src/WorkerThreads.cpp:1395
 msgid "Couldn't index"
 msgstr "No se pudo indizar"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1409
+#: UI/GTK2/src/WorkerThreads.cpp:1474
 msgid "Couldn't unindex document(s)"
 msgstr "No se pudo des-indizar lo(s) documento(s)"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1543
+#: UI/GTK2/src/WorkerThreads.cpp:1608
 msgid "Couldn't update document"
 msgstr "No se pudo actualizar el documento"

Modified: trunk/po/fr.po
===================================================================
--- trunk/po/fr.po	2007-02-17 10:13:25 UTC (rev 719)
+++ trunk/po/fr.po	2007-02-17 10:27:53 UTC (rev 720)
@@ -6,10 +6,10 @@
 #, fuzzy
 msgid ""
 msgstr ""
-"Project-Id-Version: pinot 0.65\n"
+"Project-Id-Version: pinot 0.70\n"
 "Report-Msgid-Bugs-To: \n"
 "POT-Creation-Date: 2006-11-29 15:09+0000\n"
-"PO-Revision-Date: 2007-01-27 20:02+0800\n"
+"PO-Revision-Date: 2007-02-17 17:34+0800\n"
 "Last-Translator: Fabrice Colin <fabricecolin at users.berlios.de>\n"
 "Language-Team: fr <fabricecolin at users.berlios.de>\n"
 "MIME-Version: 1.0\n"
@@ -26,25 +26,24 @@
 msgstr "Utilisateur"
 
 #: UI/GTK2/src/EnginesTree.cpp:339 UI/GTK2/src/mainWindow.cc:325
-#: UI/GTK2/src/mainWindow.cc:328 UI/GTK2/src/mainWindow.cc:554
-#: UI/GTK2/src/mainWindow.cc:1211 UI/GTK2/src/mainWindow.cc:1254
-#: UI/GTK2/src/mainWindow.cc:1274 UI/GTK2/src/mainWindow.cc:1305
-#: UI/GTK2/src/mainWindow.cc:1892 UI/GTK2/src/PinotSettings.cpp:241
-#: UI/GTK2/src/PinotSettings.cpp:1283 UI/GTK2/src/PinotSettings.cpp:1339
-#: UI/GTK2/src/statisticsDialog.cc:86
+#: UI/GTK2/src/mainWindow.cc:328 UI/GTK2/src/mainWindow.cc:541
+#: UI/GTK2/src/mainWindow.cc:1186 UI/GTK2/src/mainWindow.cc:1229
+#: UI/GTK2/src/mainWindow.cc:1249 UI/GTK2/src/mainWindow.cc:1280
+#: UI/GTK2/src/mainWindow.cc:1859 UI/GTK2/src/PinotSettings.cpp:241
+#: UI/GTK2/src/PinotSettings.cpp:1281 UI/GTK2/src/PinotSettings.cpp:1337
+#: UI/GTK2/src/statisticsDialog.cc:88 UI/GTK2/src/WorkerThreads.cpp:859
 msgid "My Web Pages"
 msgstr "Mes Pages Web"
 
 #: UI/GTK2/src/EnginesTree.cpp:340 UI/GTK2/src/mainWindow.cc:319
 #: UI/GTK2/src/mainWindow.cc:322 UI/GTK2/src/PinotSettings.cpp:242
-#: UI/GTK2/src/PinotSettings.cpp:1284 UI/GTK2/src/PinotSettings.cpp:1340
-#: UI/GTK2/src/statisticsDialog.cc:72
+#: UI/GTK2/src/PinotSettings.cpp:1282 UI/GTK2/src/PinotSettings.cpp:1338
+#: UI/GTK2/src/statisticsDialog.cc:74 UI/GTK2/src/WorkerThreads.cpp:867
 msgid "My Documents"
 msgstr "Mes Documents"
 
 #: UI/GTK2/src/dateDialog_glade.cc:76 UI/GTK2/src/queryDialog_glade.cc:91
 #: UI/GTK2/src/queryDialog_glade.cc:92
-#, fuzzy
 msgid "Date"
 msgstr "Date"
 
@@ -89,7 +88,6 @@
 msgstr "Index externe"
 
 #: UI/GTK2/src/importDialog.cc:82 UI/GTK2/src/queryDialog.cc:108
-#: UI/GTK2/src/statisticsDialog.cc:164
 msgid "None"
 msgstr "Aucune"
 
@@ -188,174 +186,174 @@
 msgid "Undefined"
 msgstr "Indefini"
 
-#: UI/GTK2/src/mainWindow.cc:477
+#: UI/GTK2/src/mainWindow.cc:476
 msgid "Result location is"
 msgstr "Le chemin du resultat est"
 
-#: UI/GTK2/src/mainWindow.cc:564
+#: UI/GTK2/src/mainWindow.cc:551
 msgid "Document location is"
 msgstr "Le chemin du document is"
 
-#: UI/GTK2/src/mainWindow.cc:890
+#: UI/GTK2/src/mainWindow.cc:877
 msgid "Showing"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:895
+#: UI/GTK2/src/mainWindow.cc:882
 msgid "of"
 msgstr "documents,"
 
-#: UI/GTK2/src/mainWindow.cc:900
+#: UI/GTK2/src/mainWindow.cc:887
 msgid "documents, starting at"
 msgstr "au total, a partir de"
 
-#: UI/GTK2/src/mainWindow.cc:933
+#: UI/GTK2/src/mainWindow.cc:920
 msgid "Query"
 msgstr "La recherche"
 
-#: UI/GTK2/src/mainWindow.cc:937 UI/GTK2/src/mainWindow.cc:2955
+#: UI/GTK2/src/mainWindow.cc:924 UI/GTK2/src/mainWindow.cc:2922
 msgid "on"
 msgstr "sur"
 
-#: UI/GTK2/src/mainWindow.cc:941
+#: UI/GTK2/src/mainWindow.cc:928
 msgid "ended"
 msgstr "est terminee"
 
-#: UI/GTK2/src/mainWindow.cc:1076
+#: UI/GTK2/src/mainWindow.cc:1051
 msgid "More Like"
 msgstr "Similaire a"
 
-#: UI/GTK2/src/mainWindow.cc:1137
+#: UI/GTK2/src/mainWindow.cc:1112
 msgid "Updated label(s)"
 msgstr "Mis a jour l(es) etiquette(s)"
 
-#: UI/GTK2/src/mainWindow.cc:1221
+#: UI/GTK2/src/mainWindow.cc:1196
 msgid "Updated document"
 msgstr "Mis a jour le document"
 
-#: UI/GTK2/src/mainWindow.cc:1234
+#: UI/GTK2/src/mainWindow.cc:1209
 msgid "Indexed"
 msgstr "Indexe"
 
-#: UI/GTK2/src/mainWindow.cc:1275
+#: UI/GTK2/src/mainWindow.cc:1250
 msgid "Unindexed document(s)"
 msgstr "Desindexe le(s) document(s)"
 
-#: UI/GTK2/src/mainWindow.cc:1316
+#: UI/GTK2/src/mainWindow.cc:1291
 msgid "Updated document properties"
 msgstr "Mis a jour les proprietes du document"
 
-#: UI/GTK2/src/mainWindow.cc:1363
+#: UI/GTK2/src/mainWindow.cc:1338
 msgid "Couldn't rename index, name"
 msgstr "N'a pas pu renommer l'index, le nom"
 
-#: UI/GTK2/src/mainWindow.cc:1367 UI/GTK2/src/mainWindow.cc:2279
-#: UI/GTK2/src/mainWindow.cc:2790
+#: UI/GTK2/src/mainWindow.cc:1342 UI/GTK2/src/mainWindow.cc:2246
+#: UI/GTK2/src/mainWindow.cc:2757
 msgid "is already in use"
 msgstr "est deja utilise"
 
-#: UI/GTK2/src/mainWindow.cc:1380
+#: UI/GTK2/src/mainWindow.cc:1355
 msgid "Couldn't rename index"
 msgstr "N'a pas pu renommer l'index"
 
-#: UI/GTK2/src/mainWindow.cc:1393
+#: UI/GTK2/src/mainWindow.cc:1368
 msgid "Edited index"
 msgstr "Edite l'index"
 
-#: UI/GTK2/src/mainWindow.cc:1777 UI/GTK2/src/mainWindow.cc:2449
+#: UI/GTK2/src/mainWindow.cc:1753 UI/GTK2/src/mainWindow.cc:2416
 msgid "Live query"
 msgstr "Recherche"
 
-#: UI/GTK2/src/mainWindow.cc:1803
+#: UI/GTK2/src/mainWindow.cc:1779
 msgid "Couldn't find query"
 msgstr "N'a pas pu trouver"
 
-#: UI/GTK2/src/mainWindow.cc:2008 UI/GTK2/src/WorkerThreads.cpp:670
-#: UI/GTK2/src/WorkerThreads.cpp:1517
+#: UI/GTK2/src/mainWindow.cc:1975 UI/GTK2/src/WorkerThreads.cpp:650
+#: UI/GTK2/src/WorkerThreads.cpp:1583
 msgid "Index"
 msgstr "L'index"
 
-#: UI/GTK2/src/mainWindow.cc:2012 UI/GTK2/src/WorkerThreads.cpp:674
-#: UI/GTK2/src/WorkerThreads.cpp:1521
+#: UI/GTK2/src/mainWindow.cc:1979 UI/GTK2/src/WorkerThreads.cpp:654
+#: UI/GTK2/src/WorkerThreads.cpp:1587
 msgid "doesn't exist"
 msgstr "n'existe pas"
 
-#: UI/GTK2/src/mainWindow.cc:2166
+#: UI/GTK2/src/mainWindow.cc:2133
 msgid "Remove this document from the index ?"
 msgstr "Enlever ce document de l'index ?"
 
-#: UI/GTK2/src/mainWindow.cc:2185
+#: UI/GTK2/src/mainWindow.cc:2152
 msgid "Remove these documents from the index ?"
 msgstr "Enlever ces documents de l'index ?"
 
-#: UI/GTK2/src/mainWindow.cc:2229
+#: UI/GTK2/src/mainWindow.cc:2196
 msgid "A metasearch tool for the Free Desktop"
 msgstr "Un outil de recherche pour le Bureau Libre"
 
-#: UI/GTK2/src/mainWindow.cc:2230
+#: UI/GTK2/src/mainWindow.cc:2197
 msgid "Search the Web and your documents !"
 msgstr "Cherche le Web et vos documents"
 
-#: UI/GTK2/src/mainWindow.cc:2231
+#: UI/GTK2/src/mainWindow.cc:2198
 msgid "(C) 2005 Fabrice Colin"
 msgstr "(C) 2005 Fabrice Colin"
 
-#: UI/GTK2/src/mainWindow.cc:2275
+#: UI/GTK2/src/mainWindow.cc:2242
 msgid "Index name"
 msgstr "Nom de l'index"
 
-#: UI/GTK2/src/mainWindow.cc:2290
+#: UI/GTK2/src/mainWindow.cc:2257
 msgid "Couldn't add index"
 msgstr "N'a pas pu ajouter l'index"
 
-#: UI/GTK2/src/mainWindow.cc:2304
+#: UI/GTK2/src/mainWindow.cc:2271
 msgid "Added new index"
 msgstr "Ajoute un nouvel index"
 
-#: UI/GTK2/src/mainWindow.cc:2339
+#: UI/GTK2/src/mainWindow.cc:2306
 msgid "Couldn't remove index"
 msgstr "N'a pas pu enlever l'index"
 
-#: UI/GTK2/src/mainWindow.cc:2604
+#: UI/GTK2/src/mainWindow.cc:2571
 msgid "At least one task hasn't completed yet. Quit now ?"
 msgstr "Au moins une tache n'est pas terminee. Quitter maintenant ?"
 
-#: UI/GTK2/src/mainWindow.cc:2786
+#: UI/GTK2/src/mainWindow.cc:2753
 msgid "Query name"
 msgstr "Nom de la recherche"
 
-#: UI/GTK2/src/mainWindow.cc:2813
+#: UI/GTK2/src/mainWindow.cc:2780
 msgid "Couldn't update query"
 msgstr "N'a pas pu mettre a jour la recherche"
 
-#: UI/GTK2/src/mainWindow.cc:2821
+#: UI/GTK2/src/mainWindow.cc:2788
 msgid "Edited query"
 msgstr "Edite la recherche"
 
-#: UI/GTK2/src/mainWindow.cc:2828
+#: UI/GTK2/src/mainWindow.cc:2795
 msgid "Couldn't add query"
 msgstr "N'a pas pu ajouter la recherche"
 
-#: UI/GTK2/src/mainWindow.cc:2836
+#: UI/GTK2/src/mainWindow.cc:2803
 msgid "Added new query"
 msgstr "Ajoute une nouvelle recherche"
 
-#: UI/GTK2/src/mainWindow.cc:2849
+#: UI/GTK2/src/mainWindow.cc:2816
 msgid "Query is not set"
 msgstr "Recherche indefinie"
 
-#: UI/GTK2/src/mainWindow.cc:2860
+#: UI/GTK2/src/mainWindow.cc:2827
 msgid "No search engine selected"
 msgstr "Pas de moteur selectionne"
 
-#: UI/GTK2/src/mainWindow.cc:2942
+#: UI/GTK2/src/mainWindow.cc:2909
 msgid "Please set the Google API key first"
 msgstr "Configurez la clef de l'API Google"
 
-#: UI/GTK2/src/mainWindow.cc:2951
+#: UI/GTK2/src/mainWindow.cc:2918
 msgid "Running query"
 msgstr "Recherche en cours"
 
-#: UI/GTK2/src/mainWindow.cc:3135
+#: UI/GTK2/src/mainWindow.cc:3102
 msgid "No default application defined for type"
 msgstr "Pas d'application definie pour le type"
 
@@ -371,7 +369,7 @@
 msgid "Stored queries"
 msgstr "Recherches sauvegardees"
 
-#: UI/GTK2/src/mainWindow_glade.cc:161 UI/GTK2/src/statisticsDialog.cc:45
+#: UI/GTK2/src/mainWindow_glade.cc:161 UI/GTK2/src/statisticsDialog.cc:46
 #: UI/GTK2/src/statisticsDialog_glade.cc:87
 msgid "Status"
 msgstr "Statistiques"
@@ -457,64 +455,64 @@
 msgid "Pinot"
 msgstr "Pinot"
 
-#: UI/GTK2/src/pinot.cc:206 UI/GTK2/src/pinot-dbus-daemon.cc:273
+#: UI/GTK2/src/pinot.cc:203 UI/GTK2/src/pinot-dbus-daemon.cc:284
 #: UI/GTK2/src/propertiesDialog.cc:65 UI/GTK2/src/propertiesDialog.cc:74
 msgid "Unknown"
 msgstr "Inconnu"
 
-#: UI/GTK2/src/pinot.cc:207 UI/GTK2/src/pinot-dbus-daemon.cc:274
+#: UI/GTK2/src/pinot.cc:204 UI/GTK2/src/pinot-dbus-daemon.cc:285
 msgid "Danish"
 msgstr "Danois"
 
-#: UI/GTK2/src/pinot.cc:208 UI/GTK2/src/pinot-dbus-daemon.cc:275
+#: UI/GTK2/src/pinot.cc:205 UI/GTK2/src/pinot-dbus-daemon.cc:286
 msgid "Dutch"
 msgstr "Hollandais"
 
-#: UI/GTK2/src/pinot.cc:209 UI/GTK2/src/pinot-dbus-daemon.cc:276
+#: UI/GTK2/src/pinot.cc:206 UI/GTK2/src/pinot-dbus-daemon.cc:287
 msgid "English"
 msgstr "Anglais"
 
-#: UI/GTK2/src/pinot.cc:210 UI/GTK2/src/pinot-dbus-daemon.cc:277
+#: UI/GTK2/src/pinot.cc:207 UI/GTK2/src/pinot-dbus-daemon.cc:288
 msgid "Finnish"
 msgstr "Finlandais"
 
-#: UI/GTK2/src/pinot.cc:211 UI/GTK2/src/pinot-dbus-daemon.cc:278
+#: UI/GTK2/src/pinot.cc:208 UI/GTK2/src/pinot-dbus-daemon.cc:289
 msgid "French"
 msgstr "Francais"
 
-#: UI/GTK2/src/pinot.cc:212 UI/GTK2/src/pinot-dbus-daemon.cc:279
+#: UI/GTK2/src/pinot.cc:209 UI/GTK2/src/pinot-dbus-daemon.cc:290
 msgid "German"
 msgstr "Allemand"
 
-#: UI/GTK2/src/pinot.cc:213 UI/GTK2/src/pinot-dbus-daemon.cc:280
+#: UI/GTK2/src/pinot.cc:210 UI/GTK2/src/pinot-dbus-daemon.cc:291
 msgid "Italian"
 msgstr "Italien"
 
-#: UI/GTK2/src/pinot.cc:214 UI/GTK2/src/pinot-dbus-daemon.cc:281
+#: UI/GTK2/src/pinot.cc:211 UI/GTK2/src/pinot-dbus-daemon.cc:292
 msgid "Norwegian"
 msgstr "Norvegien"
 
-#: UI/GTK2/src/pinot.cc:215 UI/GTK2/src/pinot-dbus-daemon.cc:282
+#: UI/GTK2/src/pinot.cc:212 UI/GTK2/src/pinot-dbus-daemon.cc:293
 msgid "Portuguese"
 msgstr "Portugais"
 
-#: UI/GTK2/src/pinot.cc:216 UI/GTK2/src/pinot-dbus-daemon.cc:283
+#: UI/GTK2/src/pinot.cc:213 UI/GTK2/src/pinot-dbus-daemon.cc:294
 msgid "Russian"
 msgstr "Russe"
 
-#: UI/GTK2/src/pinot.cc:217 UI/GTK2/src/pinot-dbus-daemon.cc:284
+#: UI/GTK2/src/pinot.cc:214 UI/GTK2/src/pinot-dbus-daemon.cc:295
 msgid "Spanish"
 msgstr "Espagnol"
 
-#: UI/GTK2/src/pinot.cc:218 UI/GTK2/src/pinot-dbus-daemon.cc:285
+#: UI/GTK2/src/pinot.cc:215 UI/GTK2/src/pinot-dbus-daemon.cc:296
 msgid "Swedish"
 msgstr "Suedois"
 
-#: UI/GTK2/src/pinot.cc:242
+#: UI/GTK2/src/pinot.cc:239
 msgid "Couldn't open index"
 msgstr "N'a pas pu ouvrir l'index"
 
-#: UI/GTK2/src/pinot.cc:258
+#: UI/GTK2/src/pinot.cc:255
 msgid "Couldn't create history database"
 msgstr "N'a pas pu creer la base d'historiques"
 
@@ -530,7 +528,7 @@
 msgid "Personal"
 msgstr "Personnel"
 
-#: UI/GTK2/src/PinotSettings.cpp:1087
+#: UI/GTK2/src/PinotSettings.cpp:1085
 msgid "Unclassified"
 msgstr "Sans classification"
 
@@ -719,97 +717,109 @@
 msgid "Extract"
 msgstr "Extrait"
 
-#: UI/GTK2/src/statisticsDialog.cc:68
+#: UI/GTK2/src/statisticsDialog.cc:69
 msgid "Indexes"
 msgstr "Indexes"
 
-#: UI/GTK2/src/statisticsDialog.cc:81 UI/GTK2/src/statisticsDialog.cc:95
+#: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/statisticsDialog.cc:97
 msgid "documents"
 msgstr "documents"
 
-#: UI/GTK2/src/statisticsDialog.cc:100
+#: UI/GTK2/src/statisticsDialog.cc:102
 msgid "History"
 msgstr "Historique"
 
-#: UI/GTK2/src/statisticsDialog.cc:107
-msgid "results were viewed"
-msgstr "resultats ont ete visites"
+#: UI/GTK2/src/statisticsDialog.cc:109
+msgid "Viewed"
+msgstr "Visualise"
 
-#: UI/GTK2/src/statisticsDialog.cc:111
-msgid "Crawler"
-msgstr "Rampeur"
+#: UI/GTK2/src/statisticsDialog.cc:109
+msgid "results"
+msgstr "resultats"
 
-#: UI/GTK2/src/statisticsDialog.cc:118
-msgid "files were crawled"
-msgstr "fichiers sont passe a la moulinette"
+#: UI/GTK2/src/statisticsDialog.cc:113
+msgid "Daemon"
+msgstr "Daemon"
 
-#: UI/GTK2/src/statisticsDialog.cc:122
+#: UI/GTK2/src/statisticsDialog.cc:131
+msgid "Running under PID"
+msgstr "PID"
+
+#: UI/GTK2/src/statisticsDialog.cc:135
+msgid "Currently not running"
+msgstr "Arrete"
+
+#: UI/GTK2/src/statisticsDialog.cc:143
+msgid "Crawled"
+msgstr "Parcouru"
+
+#: UI/GTK2/src/statisticsDialog.cc:143
+msgid "files"
+msgstr "fichiers"
+
+#: UI/GTK2/src/statisticsDialog.cc:166
 msgid "Errors"
 msgstr "Erreurs"
 
-#: UI/GTK2/src/WorkerThreads.cpp:320
+#: UI/GTK2/src/WorkerThreads.cpp:321
 msgid "Can't index mail here"
 msgstr "Ne peut pas indexer le courrier ici"
 
-#: UI/GTK2/src/WorkerThreads.cpp:341
+#: UI/GTK2/src/WorkerThreads.cpp:342
 msgid "is already being indexed"
 msgstr "est deja indexe"
 
-#: UI/GTK2/src/WorkerThreads.cpp:351
+#: UI/GTK2/src/WorkerThreads.cpp:352
 msgid "is blacklisted"
 msgstr "est exclus"
 
-#: UI/GTK2/src/WorkerThreads.cpp:359 UI/GTK2/src/WorkerThreads.cpp:683
-#: UI/GTK2/src/WorkerThreads.cpp:960 UI/GTK2/src/WorkerThreads.cpp:969
-#: UI/GTK2/src/WorkerThreads.cpp:1138 UI/GTK2/src/WorkerThreads.cpp:1397
-#: UI/GTK2/src/WorkerThreads.cpp:1530
+#: UI/GTK2/src/WorkerThreads.cpp:663 UI/GTK2/src/WorkerThreads.cpp:936
+#: UI/GTK2/src/WorkerThreads.cpp:1022 UI/GTK2/src/WorkerThreads.cpp:1031
+#: UI/GTK2/src/WorkerThreads.cpp:1203 UI/GTK2/src/WorkerThreads.cpp:1463
+#: UI/GTK2/src/WorkerThreads.cpp:1596
 msgid "Index error on"
 msgstr "Erreur sur l'index"
 
-#: UI/GTK2/src/WorkerThreads.cpp:804 UI/GTK2/src/WorkerThreads.cpp:904
+#: UI/GTK2/src/WorkerThreads.cpp:784 UI/GTK2/src/WorkerThreads.cpp:957
 msgid "Couldn't create search engine"
 msgstr "N'a pas pu creer le moteur"
 
-#: UI/GTK2/src/WorkerThreads.cpp:816 UI/GTK2/src/WorkerThreads.cpp:918
+#: UI/GTK2/src/WorkerThreads.cpp:796 UI/GTK2/src/WorkerThreads.cpp:971
 msgid "Couldn't run query on search engine"
 msgstr "N'a pas pu lancer la recherche sur le moteur"
 
-#: UI/GTK2/src/WorkerThreads.cpp:832
+#: UI/GTK2/src/WorkerThreads.cpp:830
 msgid "No title"
 msgstr "Pas de titre"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1048
+#: UI/GTK2/src/WorkerThreads.cpp:1125
 msgid "Couldn't obtain downloader for protocol"
 msgstr "N'a pas pu obtenir un brouteur pour"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1059
+#: UI/GTK2/src/WorkerThreads.cpp:1136
 msgid "Couldn't retrieve"
 msgstr "N'a pas pu telecharger"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1160 UI/GTK2/src/WorkerThreads.cpp:1232
+#: UI/GTK2/src/WorkerThreads.cpp:1233 UI/GTK2/src/WorkerThreads.cpp:1309
 msgid "Cannot index document type"
 msgstr "Impossible d'indexer ce type de documents"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1164 UI/GTK2/src/WorkerThreads.cpp:1236
+#: UI/GTK2/src/WorkerThreads.cpp:1237 UI/GTK2/src/WorkerThreads.cpp:1313
 msgid "at"
 msgstr "a"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1258
-msgid "Couldn't tokenize"
-msgstr "N'a pas pu extraire les termes de"
-
-#: UI/GTK2/src/WorkerThreads.cpp:1278
+#: UI/GTK2/src/WorkerThreads.cpp:1344
 msgid "Robots META tag forbids indexing"
 msgstr "Le META tag Robots interdit d'indexer"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1327
+#: UI/GTK2/src/WorkerThreads.cpp:1395
 msgid "Couldn't index"
 msgstr "N'a pas pu indexer"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1408
+#: UI/GTK2/src/WorkerThreads.cpp:1474
 msgid "Couldn't unindex document(s)"
 msgstr "N'a pas pu desindexer le(s) document(s)"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1542
+#: UI/GTK2/src/WorkerThreads.cpp:1608
 msgid "Couldn't update document"
 msgstr "N'a pas pu mettre a jour le document"

Modified: trunk/po/nl.po
===================================================================
--- trunk/po/nl.po	2007-02-17 10:13:25 UTC (rev 719)
+++ trunk/po/nl.po	2007-02-17 10:27:53 UTC (rev 720)
@@ -6,10 +6,10 @@
 #, fuzzy
 msgid ""
 msgstr ""
-"Project-Id-Version: pinot 0.65\n"
+"Project-Id-Version: pinot 0.70\n"
 "Report-Msgid-Bugs-To: \n"
 "POT-Creation-Date: 2006-12-03 15:13+0000\n"
-"PO-Revision-Date: 2006-12-20 21:10+0800\n"
+"PO-Revision-Date: 2007-02-17 17:34+0800\n"
 "Last-Translator: Fabrice Colin <fabricecolin at users.berlios.de>\n"
 "Language-Team: Dutch <nl at li.org>\n"
 "MIME-Version: 1.0\n"
@@ -25,76 +25,98 @@
 msgid "Current User"
 msgstr "Huidige gebruiker"
 
-#: UI/GTK2/src/EnginesTree.cpp:339 UI/GTK2/src/mainWindow.cc:322
-#: UI/GTK2/src/mainWindow.cc:325 UI/GTK2/src/mainWindow.cc:551
-#: UI/GTK2/src/mainWindow.cc:1205 UI/GTK2/src/mainWindow.cc:1248
-#: UI/GTK2/src/mainWindow.cc:1268 UI/GTK2/src/mainWindow.cc:1299
-#: UI/GTK2/src/mainWindow.cc:1869 UI/GTK2/src/PinotSettings.cpp:240
-#: UI/GTK2/src/PinotSettings.cpp:1230 UI/GTK2/src/PinotSettings.cpp:1286
+#: UI/GTK2/src/EnginesTree.cpp:339 UI/GTK2/src/mainWindow.cc:325
+#: UI/GTK2/src/mainWindow.cc:328 UI/GTK2/src/mainWindow.cc:541
+#: UI/GTK2/src/mainWindow.cc:1186 UI/GTK2/src/mainWindow.cc:1229
+#: UI/GTK2/src/mainWindow.cc:1249 UI/GTK2/src/mainWindow.cc:1280
+#: UI/GTK2/src/mainWindow.cc:1859 UI/GTK2/src/PinotSettings.cpp:241
+#: UI/GTK2/src/PinotSettings.cpp:1281 UI/GTK2/src/PinotSettings.cpp:1337
+#: UI/GTK2/src/statisticsDialog.cc:88 UI/GTK2/src/WorkerThreads.cpp:859
 msgid "My Web Pages"
 msgstr "Mijn webpagina's"
 
-#: UI/GTK2/src/EnginesTree.cpp:340 UI/GTK2/src/mainWindow.cc:316
-#: UI/GTK2/src/mainWindow.cc:319 UI/GTK2/src/PinotSettings.cpp:241
-#: UI/GTK2/src/PinotSettings.cpp:1231 UI/GTK2/src/PinotSettings.cpp:1287
+#: UI/GTK2/src/EnginesTree.cpp:340 UI/GTK2/src/mainWindow.cc:319
+#: UI/GTK2/src/mainWindow.cc:322 UI/GTK2/src/PinotSettings.cpp:242
+#: UI/GTK2/src/PinotSettings.cpp:1282 UI/GTK2/src/PinotSettings.cpp:1338
+#: UI/GTK2/src/statisticsDialog.cc:74 UI/GTK2/src/WorkerThreads.cpp:867
 msgid "My Documents"
 msgstr "Mijn documenten"
 
-#: UI/GTK2/src/importDialog.cc:83 UI/GTK2/src/queryDialog.cc:81
-msgid "None"
-msgstr "Geen"
+#: UI/GTK2/src/dateDialog_glade.cc:76 UI/GTK2/src/queryDialog_glade.cc:91
+#: UI/GTK2/src/queryDialog_glade.cc:92
+#, fuzzy
+msgid "Date"
+msgstr "bij"
 
-#: UI/GTK2/src/importDialog_glade.cc:67 UI/GTK2/src/indexDialog_glade.cc:68
-msgid "Location:"
+#: UI/GTK2/src/indexDialog.cc:130
+msgid "Served by"
+msgstr ""
+
+#: UI/GTK2/src/indexDialog.cc:134
+#, fuzzy
+msgid "Local"
 msgstr "Locatie"
 
-#: UI/GTK2/src/importDialog_glade.cc:68
-#: UI/GTK2/src/propertiesDialog_glade.cc:65
-msgid "Title:"
-msgstr "Titel"
-
-#: UI/GTK2/src/importDialog_glade.cc:71
-msgid "Apply label:"
-msgstr "Naam toepassen"
-
-#: UI/GTK2/src/importDialog_glade.cc:77
-msgid "Import"
-msgstr "Importeren"
-
-#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:213
-msgid "Import URL"
-msgstr "Importeren URL"
-
-#: UI/GTK2/src/indexDialog.cc:225
+#: UI/GTK2/src/indexDialog.cc:300
 msgid "Index location"
 msgstr "Index locatie"
 
-#: UI/GTK2/src/indexDialog_glade.cc:62 UI/GTK2/src/queryDialog_glade.cc:68
+#: UI/GTK2/src/indexDialog_glade.cc:65 UI/GTK2/src/queryDialog_glade.cc:68
 msgid "Name:"
 msgstr "Naam:"
 
-#: UI/GTK2/src/indexDialog_glade.cc:64
+#: UI/GTK2/src/indexDialog_glade.cc:67
 msgid "..."
 msgstr "..."
 
-#: UI/GTK2/src/indexDialog_glade.cc:67
+#: UI/GTK2/src/indexDialog_glade.cc:70
 msgid "Type:"
 msgstr "Type:"
 
-#: UI/GTK2/src/indexDialog_glade.cc:69
+#: UI/GTK2/src/indexDialog_glade.cc:71 UI/GTK2/src/importDialog_glade.cc:67
+msgid "Location:"
+msgstr "Locatie"
+
+#: UI/GTK2/src/indexDialog_glade.cc:72
 msgid "Port:"
 msgstr "Poort:"
 
-#: UI/GTK2/src/indexDialog_glade.cc:143
+#: UI/GTK2/src/indexDialog_glade.cc:79
+#, fuzzy
+msgid "Host name:"
+msgstr "Hostnaam"
+
+#: UI/GTK2/src/indexDialog_glade.cc:163
 msgid "External index"
 msgstr "Externe index"
 
-#: UI/GTK2/src/IndexTree.cpp:68 UI/GTK2/src/queryDialog.cc:112
+#: UI/GTK2/src/importDialog.cc:82 UI/GTK2/src/queryDialog.cc:108
+msgid "None"
+msgstr "Geen"
+
+#: UI/GTK2/src/importDialog_glade.cc:68
+#: UI/GTK2/src/propertiesDialog_glade.cc:67
+msgid "Title:"
+msgstr "Titel"
+
+#: UI/GTK2/src/importDialog_glade.cc:71
+msgid "Apply label:"
+msgstr "Naam toepassen"
+
+#: UI/GTK2/src/importDialog_glade.cc:77
+msgid "Import"
+msgstr "Importeren"
+
+#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:221
+msgid "Import URL"
+msgstr "Importeren URL"
+
+#: UI/GTK2/src/IndexTree.cpp:68 UI/GTK2/src/queryDialog.cc:139
 #: UI/GTK2/src/ResultsTree.cpp:126
 msgid "Title"
 msgstr "Titel"
 
-#: UI/GTK2/src/IndexTree.cpp:73 UI/GTK2/src/queryDialog.cc:115
+#: UI/GTK2/src/IndexTree.cpp:73 UI/GTK2/src/queryDialog.cc:142
 #: UI/GTK2/src/ResultsTree.cpp:136
 msgid "URL"
 msgstr "URL"
@@ -115,381 +137,403 @@
 msgid "All labels"
 msgstr "Alle namen"
 
-#: UI/GTK2/src/mainWindow.cc:138
+#: UI/GTK2/src/launcherDialog_glade.cc:64
+msgid ""
+"There is no helper application defined for this document's type.\n"
+"Please enter the command to open this document."
+msgstr ""
+
+#: UI/GTK2/src/launcherDialog_glade.cc:67
+msgid "Use this command for other documents of the same type."
+msgstr ""
+
+#: UI/GTK2/src/launcherDialog_glade.cc:99
+msgid "Helper application"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:141
 #, fuzzy
 msgid "Query Name"
 msgstr "Query naam"
 
-#: UI/GTK2/src/mainWindow.cc:143
+#: UI/GTK2/src/mainWindow.cc:146
 msgid "Last Run"
 msgstr "Laatst geopend"
 
-#: UI/GTK2/src/mainWindow.cc:148
+#: UI/GTK2/src/mainWindow.cc:151
 msgid "Summary"
 msgstr "Samenvatting"
 
-#: UI/GTK2/src/mainWindow.cc:181
+#: UI/GTK2/src/mainWindow.cc:184
 msgid "Show all search engines"
 msgstr "Toon alle zoekmachines"
 
-#: UI/GTK2/src/mainWindow.cc:182
+#: UI/GTK2/src/mainWindow.cc:185
 msgid "Add index"
 msgstr "Toevoegen index"
 
-#: UI/GTK2/src/mainWindow.cc:183
+#: UI/GTK2/src/mainWindow.cc:186
 msgid "Remove index"
 msgstr "Verwijderen index"
 
-#: UI/GTK2/src/mainWindow.cc:189
+#: UI/GTK2/src/mainWindow.cc:192
 msgid "Ready"
 msgstr "Gereed"
 
-#: UI/GTK2/src/mainWindow.cc:240
+#: UI/GTK2/src/mainWindow.cc:243
 msgid "N/A"
 msgstr "NVT"
 
-#: UI/GTK2/src/mainWindow.cc:255
-msgid "<undefined>"
+#: UI/GTK2/src/mainWindow.cc:258
+#, fuzzy
+msgid "Undefined"
 msgstr "<niet gedefinieerd>"
 
-#: UI/GTK2/src/mainWindow.cc:474
+#: UI/GTK2/src/mainWindow.cc:476
 msgid "Result location is"
 msgstr "Uitvoerlocatie is"
 
-#: UI/GTK2/src/mainWindow.cc:561
+#: UI/GTK2/src/mainWindow.cc:551
 msgid "Document location is"
 msgstr "Documentlocatie is"
 
-#: UI/GTK2/src/mainWindow.cc:884
+#: UI/GTK2/src/mainWindow.cc:877
 msgid "Showing"
 msgstr "Aan het tonen"
 
-#: UI/GTK2/src/mainWindow.cc:889
+#: UI/GTK2/src/mainWindow.cc:882
 msgid "of"
 msgstr "van"
 
-#: UI/GTK2/src/mainWindow.cc:894
+#: UI/GTK2/src/mainWindow.cc:887
 msgid "documents, starting at"
 msgstr "documenten, beginnend bij"
 
-#: UI/GTK2/src/mainWindow.cc:927
+#: UI/GTK2/src/mainWindow.cc:920
 msgid "Query"
 msgstr "Query"
 
-#: UI/GTK2/src/mainWindow.cc:931 UI/GTK2/src/mainWindow.cc:2937
+#: UI/GTK2/src/mainWindow.cc:924 UI/GTK2/src/mainWindow.cc:2922
 msgid "on"
 msgstr "op"
 
-#: UI/GTK2/src/mainWindow.cc:935
+#: UI/GTK2/src/mainWindow.cc:928
 msgid "ended"
 msgstr "Beeindigd"
 
-#: UI/GTK2/src/mainWindow.cc:1070
+#: UI/GTK2/src/mainWindow.cc:1051
 msgid "More Like"
 msgstr "Meer zoals"
 
-#: UI/GTK2/src/mainWindow.cc:1131
+#: UI/GTK2/src/mainWindow.cc:1112
 msgid "Updated label(s)"
 msgstr "Vernieuwde na(a)m(en)"
 
-#: UI/GTK2/src/mainWindow.cc:1215
+#: UI/GTK2/src/mainWindow.cc:1196
 msgid "Updated document"
 msgstr "Vernieuwd document"
 
-#: UI/GTK2/src/mainWindow.cc:1228
+#: UI/GTK2/src/mainWindow.cc:1209
 msgid "Indexed"
 msgstr "Geindexeerd"
 
-#: UI/GTK2/src/mainWindow.cc:1269
+#: UI/GTK2/src/mainWindow.cc:1250
 msgid "Unindexed document(s)"
 msgstr "Niet geindexeerd(e) document(en)"
 
-#: UI/GTK2/src/mainWindow.cc:1310
+#: UI/GTK2/src/mainWindow.cc:1291
 msgid "Updated document properties"
 msgstr "Vernieuwde documenteigenschappen"
 
-#: UI/GTK2/src/mainWindow.cc:1357
+#: UI/GTK2/src/mainWindow.cc:1338
 msgid "Couldn't rename index, name"
 msgstr "Kon index niet hernoemen, naam"
 
-#: UI/GTK2/src/mainWindow.cc:1361 UI/GTK2/src/mainWindow.cc:2261
-#: UI/GTK2/src/mainWindow.cc:2772
+#: UI/GTK2/src/mainWindow.cc:1342 UI/GTK2/src/mainWindow.cc:2246
+#: UI/GTK2/src/mainWindow.cc:2757
 msgid "is already in use"
 msgstr "is reeds in gebruik"
 
-#: UI/GTK2/src/mainWindow.cc:1374
+#: UI/GTK2/src/mainWindow.cc:1355
 msgid "Couldn't rename index"
 msgstr "Kon index niet hernoemen"
 
-#: UI/GTK2/src/mainWindow.cc:1387
+#: UI/GTK2/src/mainWindow.cc:1368
 msgid "Edited index"
 msgstr "Bewerkte index"
 
-#: UI/GTK2/src/mainWindow.cc:1747 UI/GTK2/src/mainWindow.cc:2431
+#: UI/GTK2/src/mainWindow.cc:1753 UI/GTK2/src/mainWindow.cc:2416
 msgid "Live query"
 msgstr "Rechtstreekse query"
 
-#: UI/GTK2/src/mainWindow.cc:1773
+#: UI/GTK2/src/mainWindow.cc:1779
 msgid "Couldn't find query"
 msgstr "Kon query niet vinden"
 
-#: UI/GTK2/src/mainWindow.cc:1817 UI/GTK2/src/mainWindow.cc:1913
-msgid "Please set a location for the index first"
-msgstr "Geef aub eerst een bestemming voor de inhoudsopgave"
-
-#: UI/GTK2/src/mainWindow.cc:1992 UI/GTK2/src/WorkerThreads.cpp:671
-#: UI/GTK2/src/WorkerThreads.cpp:1518
+#: UI/GTK2/src/mainWindow.cc:1975 UI/GTK2/src/WorkerThreads.cpp:650
+#: UI/GTK2/src/WorkerThreads.cpp:1583
 msgid "Index"
 msgstr "Inhoudsopgave"
 
-#: UI/GTK2/src/mainWindow.cc:1996 UI/GTK2/src/WorkerThreads.cpp:675
-#: UI/GTK2/src/WorkerThreads.cpp:1522
+#: UI/GTK2/src/mainWindow.cc:1979 UI/GTK2/src/WorkerThreads.cpp:654
+#: UI/GTK2/src/WorkerThreads.cpp:1587
 msgid "doesn't exist"
 msgstr "bestaat niet"
 
-#: UI/GTK2/src/mainWindow.cc:2149
+#: UI/GTK2/src/mainWindow.cc:2133
 msgid "Remove this document from the index ?"
 msgstr "Verwijder dit document uit de inhoudsopgave"
 
-#: UI/GTK2/src/mainWindow.cc:2168
+#: UI/GTK2/src/mainWindow.cc:2152
 msgid "Remove these documents from the index ?"
 msgstr "Verwijder deze documenten uit de inhoudsopgave"
 
-#: UI/GTK2/src/mainWindow.cc:2212
+#: UI/GTK2/src/mainWindow.cc:2196
 msgid "A metasearch tool for the Free Desktop"
 msgstr "Een metazoek tool voor de Free Desktop"
 
-#: UI/GTK2/src/mainWindow.cc:2213
-msgid "(C) 2005-2006 Fabrice Colin"
+#: UI/GTK2/src/mainWindow.cc:2197
+msgid "Search the Web and your documents !"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:2198
+#, fuzzy
+msgid "(C) 2005 Fabrice Colin"
 msgstr "(C) 2005-2006 Fabrice Colin"
 
-#: UI/GTK2/src/mainWindow.cc:2257
+#: UI/GTK2/src/mainWindow.cc:2242
 msgid "Index name"
 msgstr "Naam inhoudsopgave"
 
-#: UI/GTK2/src/mainWindow.cc:2272
+#: UI/GTK2/src/mainWindow.cc:2257
 msgid "Couldn't add index"
 msgstr "Kon inhoudsopgave niet toevoegen"
 
-#: UI/GTK2/src/mainWindow.cc:2286
+#: UI/GTK2/src/mainWindow.cc:2271
 msgid "Added new index"
 msgstr "Nieuwe inhoudsopgave toegevoegd"
 
-#: UI/GTK2/src/mainWindow.cc:2321
+#: UI/GTK2/src/mainWindow.cc:2306
 msgid "Couldn't remove index"
 msgstr "Kon inhoudsopgave niet verwijderen"
 
-#: UI/GTK2/src/mainWindow.cc:2586
+#: UI/GTK2/src/mainWindow.cc:2571
 msgid "At least one task hasn't completed yet. Quit now ?"
 msgstr "Tenminste een taak is nog niet gereed. Nu stoppen?"
 
-#: UI/GTK2/src/mainWindow.cc:2768
+#: UI/GTK2/src/mainWindow.cc:2753
 msgid "Query name"
 msgstr "Naam query"
 
-#: UI/GTK2/src/mainWindow.cc:2795
+#: UI/GTK2/src/mainWindow.cc:2780
 msgid "Couldn't update query"
 msgstr "Kon query niet actualiseren"
 
-#: UI/GTK2/src/mainWindow.cc:2803
+#: UI/GTK2/src/mainWindow.cc:2788
 msgid "Edited query"
 msgstr "Bewerkte query"
 
-#: UI/GTK2/src/mainWindow.cc:2810
+#: UI/GTK2/src/mainWindow.cc:2795
 msgid "Couldn't add query"
 msgstr "Kon query niet toevoegen"
 
-#: UI/GTK2/src/mainWindow.cc:2818
+#: UI/GTK2/src/mainWindow.cc:2803
 msgid "Added new query"
 msgstr "Nieuwe query toegevoegd"
 
-#: UI/GTK2/src/mainWindow.cc:2831
+#: UI/GTK2/src/mainWindow.cc:2816
 #, fuzzy
 msgid "Query is not set"
 msgstr "Query niet vastgelegd"
 
-#: UI/GTK2/src/mainWindow.cc:2842
+#: UI/GTK2/src/mainWindow.cc:2827
 msgid "No search engine selected"
 msgstr "Geen zoekmachine geselecteerd"
 
-#: UI/GTK2/src/mainWindow.cc:2924
+#: UI/GTK2/src/mainWindow.cc:2909
 msgid "Please set the Google API key first"
 msgstr "Geef eerst de Google API sleutel in"
 
-#: UI/GTK2/src/mainWindow.cc:2933
+#: UI/GTK2/src/mainWindow.cc:2918
 msgid "Running query"
 msgstr "Lopende query"
 
-#: UI/GTK2/src/mainWindow.cc:3105
+#: UI/GTK2/src/mainWindow.cc:3102
 msgid "No default application defined for type"
 msgstr "Geen standaard toepassing gedefinieerd voor het type"
 
-#: UI/GTK2/src/mainWindow_glade.cc:124
+#: UI/GTK2/src/mainWindow_glade.cc:126
 msgid "Query:"
 msgstr "Query:"
 
-#: UI/GTK2/src/mainWindow_glade.cc:136
+#: UI/GTK2/src/mainWindow_glade.cc:138
 msgid "Edit"
 msgstr "Bewerken"
 
-#: UI/GTK2/src/mainWindow_glade.cc:145
+#: UI/GTK2/src/mainWindow_glade.cc:147
 msgid "Stored queries"
 msgstr "Opgeslagen queries"
 
-#: UI/GTK2/src/mainWindow_glade.cc:180
+#: UI/GTK2/src/mainWindow_glade.cc:161 UI/GTK2/src/statisticsDialog.cc:46
+#: UI/GTK2/src/statisticsDialog_glade.cc:87
+msgid "Status"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow_glade.cc:188
 msgid "Search Engine"
 msgstr "Zoekmachine"
 
-#: UI/GTK2/src/mainWindow_glade.cc:183
+#: UI/GTK2/src/mainWindow_glade.cc:191
 msgid "Host Name"
 msgstr "Naam host"
 
-#: UI/GTK2/src/mainWindow_glade.cc:186
+#: UI/GTK2/src/mainWindow_glade.cc:194
 msgid "Show Extract"
 msgstr "Toon uittreksel"
 
-#: UI/GTK2/src/mainWindow_glade.cc:189
+#: UI/GTK2/src/mainWindow_glade.cc:197
 msgid "Group By"
 msgstr "Groeperen op"
 
-#: UI/GTK2/src/mainWindow_glade.cc:192
+#: UI/GTK2/src/mainWindow_glade.cc:200
 msgid "Clear List"
 msgstr "Lijst opschonen"
 
-#: UI/GTK2/src/mainWindow_glade.cc:198
+#: UI/GTK2/src/mainWindow_glade.cc:206
 msgid "Vie_w"
 msgstr "_Toon"
 
-#: UI/GTK2/src/mainWindow_glade.cc:201
+#: UI/GTK2/src/mainWindow_glade.cc:209
 msgid "View Cache"
 msgstr "Toon cache"
 
-#: UI/GTK2/src/mainWindow_glade.cc:204
+#: UI/GTK2/src/mainWindow_glade.cc:212
 msgid "More Like This"
 msgstr "Meer zoals deze"
 
-#: UI/GTK2/src/mainWindow_glade.cc:207 UI/GTK2/src/mainWindow_glade.cc:243
+#: UI/GTK2/src/mainWindow_glade.cc:215 UI/GTK2/src/mainWindow_glade.cc:251
 msgid "_Index"
 msgstr "_Index"
 
-#: UI/GTK2/src/mainWindow_glade.cc:210
+#: UI/GTK2/src/mainWindow_glade.cc:218
 msgid "List Contents Of"
 msgstr "Lijstinhoud van"
 
-#: UI/GTK2/src/mainWindow_glade.cc:219
+#: UI/GTK2/src/mainWindow_glade.cc:227
 msgid "View"
 msgstr "Toon"
 
-#: UI/GTK2/src/mainWindow_glade.cc:222
+#: UI/GTK2/src/mainWindow_glade.cc:230
 msgid "Update"
 msgstr "Verversen"
 
-#: UI/GTK2/src/mainWindow_glade.cc:225
+#: UI/GTK2/src/mainWindow_glade.cc:233
 msgid "Unindex"
 msgstr "De-indexeren"
 
-#: UI/GTK2/src/mainWindow_glade.cc:228
-#: UI/GTK2/src/propertiesDialog_glade.cc:146
+#: UI/GTK2/src/mainWindow_glade.cc:236
+#: UI/GTK2/src/propertiesDialog_glade.cc:177
 msgid "Properties"
 msgstr "Eigenschappen"
 
-#: UI/GTK2/src/mainWindow_glade.cc:231
+#: UI/GTK2/src/mainWindow_glade.cc:239
 msgid "_About"
 msgstr "_Over"
 
-#: UI/GTK2/src/mainWindow_glade.cc:234
+#: UI/GTK2/src/mainWindow_glade.cc:242
 msgid "_Session"
 msgstr "_Sessie"
 
-#: UI/GTK2/src/mainWindow_glade.cc:237
+#: UI/GTK2/src/mainWindow_glade.cc:245
 msgid "_Edit"
 msgstr "_Bewerken"
 
-#: UI/GTK2/src/mainWindow_glade.cc:240
+#: UI/GTK2/src/mainWindow_glade.cc:248
 msgid "_Results"
 msgstr "_Resultaten"
 
-#: UI/GTK2/src/mainWindow_glade.cc:246
+#: UI/GTK2/src/mainWindow_glade.cc:254
 msgid "_Help"
 msgstr "_Help"
 
-#: UI/GTK2/src/mainWindow_glade.cc:383
+#: UI/GTK2/src/mainWindow_glade.cc:391
 msgid "Pinot"
 msgstr "Pinot"
 
-#: UI/GTK2/src/pinot.cc:204 UI/GTK2/src/pinot-dbus-daemon.cc:273
+#: UI/GTK2/src/pinot.cc:203 UI/GTK2/src/pinot-dbus-daemon.cc:284
+#: UI/GTK2/src/propertiesDialog.cc:65 UI/GTK2/src/propertiesDialog.cc:74
 msgid "Unknown"
 msgstr "Niet bekend"
 
-#: UI/GTK2/src/pinot.cc:205 UI/GTK2/src/pinot-dbus-daemon.cc:274
+#: UI/GTK2/src/pinot.cc:204 UI/GTK2/src/pinot-dbus-daemon.cc:285
 msgid "Danish"
 msgstr "Deens"
 
-#: UI/GTK2/src/pinot.cc:206 UI/GTK2/src/pinot-dbus-daemon.cc:275
+#: UI/GTK2/src/pinot.cc:205 UI/GTK2/src/pinot-dbus-daemon.cc:286
 msgid "Dutch"
 msgstr "Nederlands"
 
-#: UI/GTK2/src/pinot.cc:207 UI/GTK2/src/pinot-dbus-daemon.cc:276
+#: UI/GTK2/src/pinot.cc:206 UI/GTK2/src/pinot-dbus-daemon.cc:287
 msgid "English"
 msgstr "Engels"
 
-#: UI/GTK2/src/pinot.cc:208 UI/GTK2/src/pinot-dbus-daemon.cc:277
+#: UI/GTK2/src/pinot.cc:207 UI/GTK2/src/pinot-dbus-daemon.cc:288
 msgid "Finnish"
 msgstr "Fins"
 
-#: UI/GTK2/src/pinot.cc:209 UI/GTK2/src/pinot-dbus-daemon.cc:278
+#: UI/GTK2/src/pinot.cc:208 UI/GTK2/src/pinot-dbus-daemon.cc:289
 msgid "French"
 msgstr "Frans"
 
-#: UI/GTK2/src/pinot.cc:210 UI/GTK2/src/pinot-dbus-daemon.cc:279
+#: UI/GTK2/src/pinot.cc:209 UI/GTK2/src/pinot-dbus-daemon.cc:290
 msgid "German"
 msgstr "Duits"
 
-#: UI/GTK2/src/pinot.cc:211 UI/GTK2/src/pinot-dbus-daemon.cc:280
+#: UI/GTK2/src/pinot.cc:210 UI/GTK2/src/pinot-dbus-daemon.cc:291
 msgid "Italian"
 msgstr "Italiaans"
 
-#: UI/GTK2/src/pinot.cc:212 UI/GTK2/src/pinot-dbus-daemon.cc:281
+#: UI/GTK2/src/pinot.cc:211 UI/GTK2/src/pinot-dbus-daemon.cc:292
 msgid "Norwegian"
 msgstr "Noors"
 
-#: UI/GTK2/src/pinot.cc:213 UI/GTK2/src/pinot-dbus-daemon.cc:282
+#: UI/GTK2/src/pinot.cc:212 UI/GTK2/src/pinot-dbus-daemon.cc:293
 msgid "Portuguese"
 msgstr "Portugees"
 
-#: UI/GTK2/src/pinot.cc:214 UI/GTK2/src/pinot-dbus-daemon.cc:283
+#: UI/GTK2/src/pinot.cc:213 UI/GTK2/src/pinot-dbus-daemon.cc:294
 msgid "Russian"
 msgstr "Russisch"
 
-#: UI/GTK2/src/pinot.cc:215 UI/GTK2/src/pinot-dbus-daemon.cc:284
+#: UI/GTK2/src/pinot.cc:214 UI/GTK2/src/pinot-dbus-daemon.cc:295
 msgid "Spanish"
 msgstr "Spaans"
 
-#: UI/GTK2/src/pinot.cc:216 UI/GTK2/src/pinot-dbus-daemon.cc:285
+#: UI/GTK2/src/pinot.cc:215 UI/GTK2/src/pinot-dbus-daemon.cc:296
 msgid "Swedish"
 msgstr "Zweeds"
 
-#: UI/GTK2/src/pinot.cc:240
+#: UI/GTK2/src/pinot.cc:239
 msgid "Couldn't open index"
 msgstr "Kan index niet openen"
 
-#: UI/GTK2/src/pinot.cc:256
+#: UI/GTK2/src/pinot.cc:255
 msgid "Couldn't create history database"
 msgstr "Kon historische database niet maken"
 
-#: UI/GTK2/src/PinotSettings.cpp:246
+#: UI/GTK2/src/PinotSettings.cpp:247
 msgid "Important"
 msgstr "Belangrijk"
 
-#: UI/GTK2/src/PinotSettings.cpp:247
+#: UI/GTK2/src/PinotSettings.cpp:248
 msgid "New"
 msgstr "Nieuw"
 
-#: UI/GTK2/src/PinotSettings.cpp:248
+#: UI/GTK2/src/PinotSettings.cpp:249
 msgid "Personal"
 msgstr "Persoonlijk"
 
-#: UI/GTK2/src/PinotSettings.cpp:1055
+#: UI/GTK2/src/PinotSettings.cpp:1085
 msgid "Unclassified"
 msgstr "Niet geklassificeerd"
 
@@ -510,15 +554,15 @@
 msgid "Pattern"
 msgstr "Patroon"
 
-#: UI/GTK2/src/prefsDialog.cc:426
+#: UI/GTK2/src/prefsDialog.cc:423
 msgid "New Label"
 msgstr "Nieuwe naam"
 
-#: UI/GTK2/src/prefsDialog.cc:467
+#: UI/GTK2/src/prefsDialog.cc:464
 msgid "Directory to index"
 msgstr "Directory naar inhoudsopgave"
 
-#: UI/GTK2/src/prefsDialog.cc:525
+#: UI/GTK2/src/prefsDialog.cc:522
 msgid "Mbox File Location"
 msgstr "Mbox bestandslocatie"
 
@@ -552,7 +596,8 @@
 
 #: UI/GTK2/src/prefsDialog_glade.cc:77
 msgid "Labels are used to classify indexed documents:"
-msgstr "Bijschriften worden gebruikt om geindexeerde documenten te klassificeren:"
+msgstr ""
+"Bijschriften worden gebruikt om geindexeerde documenten te klassificeren:"
 
 #: UI/GTK2/src/prefsDialog_glade.cc:82 UI/GTK2/src/prefsDialog_glade.cc:102
 #: UI/GTK2/src/prefsDialog_glade.cc:115 UI/GTK2/src/prefsDialog_glade.cc:128
@@ -589,47 +634,63 @@
 msgid "Preferences"
 msgstr "Voorkeuren"
 
-#: UI/GTK2/src/propertiesDialog.cc:51 UI/GTK2/src/queryDialog.cc:127
+#: UI/GTK2/src/propertiesDialog.cc:52 UI/GTK2/src/queryDialog.cc:154
 msgid "Label"
 msgstr "Bijschrift"
 
-#: UI/GTK2/src/propertiesDialog.cc:64
+#: UI/GTK2/src/propertiesDialog.cc:86
 msgid "Per document"
 msgstr "Per document"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:66
+#: UI/GTK2/src/propertiesDialog_glade.cc:68
 msgid "Language:"
 msgstr "Taal:"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:67
+#: UI/GTK2/src/propertiesDialog_glade.cc:69
 msgid "MIME type:"
 msgstr "MIME type:"
 
-#: UI/GTK2/src/queryDialog.cc:103
+#: UI/GTK2/src/propertiesDialog_glade.cc:70
+msgid "Size:"
+msgstr ""
+
+#: UI/GTK2/src/propertiesDialog_glade.cc:73
+msgid "Terms:"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog.cc:130
 msgid "Host name"
 msgstr "Hostnaam"
 
-#: UI/GTK2/src/queryDialog.cc:106
+#: UI/GTK2/src/queryDialog.cc:133
 msgid "File name"
 msgstr "Bestandsnaam"
 
-#: UI/GTK2/src/queryDialog.cc:109
+#: UI/GTK2/src/queryDialog.cc:136
 #, fuzzy
 msgid "File extension"
 msgstr "Bestandssuffix"
 
-#: UI/GTK2/src/queryDialog.cc:118
+#: UI/GTK2/src/queryDialog.cc:145
 msgid "Directory"
 msgstr "Map"
 
-#: UI/GTK2/src/queryDialog.cc:121
+#: UI/GTK2/src/queryDialog.cc:148
 msgid "Language code"
 msgstr "Taal code"
 
-#: UI/GTK2/src/queryDialog.cc:124
+#: UI/GTK2/src/queryDialog.cc:151
 msgid "MIME type"
 msgstr "MIME type"
 
+#: UI/GTK2/src/queryDialog.cc:271
+msgid "Start date"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog.cc:286
+msgid "End date"
+msgstr ""
+
 #: UI/GTK2/src/queryDialog_glade.cc:72
 msgid "New filter:"
 msgstr "Nieuw filter:"
@@ -639,14 +700,23 @@
 msgstr "Query tekst"
 
 #: UI/GTK2/src/queryDialog_glade.cc:83
-msgid "Index all results with label"
+#, fuzzy
+msgid "Index results with label"
 msgstr "Indexeer alle resultaten met label"
 
 #: UI/GTK2/src/queryDialog_glade.cc:86
 msgid "Number of results:"
 msgstr "Aantal resultaten:"
 
-#: UI/GTK2/src/queryDialog_glade.cc:182
+#: UI/GTK2/src/queryDialog_glade.cc:89
+msgid "Start date:"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog_glade.cc:90
+msgid "End date:"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog_glade.cc:201
 msgid "Query parameters"
 msgstr "Queryparameters"
 
@@ -658,6 +728,56 @@
 msgid "Extract"
 msgstr "Uitpakken"
 
+#: UI/GTK2/src/statisticsDialog.cc:69
+#, fuzzy
+msgid "Indexes"
+msgstr "Geindexeerd"
+
+#: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/statisticsDialog.cc:97
+#, fuzzy
+msgid "documents"
+msgstr "Mijn documenten"
+
+#: UI/GTK2/src/statisticsDialog.cc:102
+#, fuzzy
+msgid "History"
+msgstr "Map"
+
+#: UI/GTK2/src/statisticsDialog.cc:109
+#, fuzzy
+msgid "Viewed"
+msgstr "Toon"
+
+#: UI/GTK2/src/statisticsDialog.cc:109
+#, fuzzy
+msgid "results"
+msgstr "_Resultaten"
+
+#: UI/GTK2/src/statisticsDialog.cc:113
+msgid "Daemon"
+msgstr ""
+
+#: UI/GTK2/src/statisticsDialog.cc:131
+#, fuzzy
+msgid "Running under PID"
+msgstr "Lopende query"
+
+#: UI/GTK2/src/statisticsDialog.cc:135
+msgid "Currently not running"
+msgstr ""
+
+#: UI/GTK2/src/statisticsDialog.cc:143
+msgid "Crawled"
+msgstr ""
+
+#: UI/GTK2/src/statisticsDialog.cc:143
+msgid "files"
+msgstr ""
+
+#: UI/GTK2/src/statisticsDialog.cc:166
+msgid "Errors"
+msgstr ""
+
 #: UI/GTK2/src/WorkerThreads.cpp:321
 msgid "Can't index mail here"
 msgstr "Kan mail hier niet indexeren"
@@ -670,58 +790,53 @@
 msgid "is blacklisted"
 msgstr "staat op blacklist"
 
-#: UI/GTK2/src/WorkerThreads.cpp:360 UI/GTK2/src/WorkerThreads.cpp:684
-#: UI/GTK2/src/WorkerThreads.cpp:961 UI/GTK2/src/WorkerThreads.cpp:970
-#: UI/GTK2/src/WorkerThreads.cpp:1139 UI/GTK2/src/WorkerThreads.cpp:1398
-#: UI/GTK2/src/WorkerThreads.cpp:1531
+#: UI/GTK2/src/WorkerThreads.cpp:663 UI/GTK2/src/WorkerThreads.cpp:936
+#: UI/GTK2/src/WorkerThreads.cpp:1022 UI/GTK2/src/WorkerThreads.cpp:1031
+#: UI/GTK2/src/WorkerThreads.cpp:1203 UI/GTK2/src/WorkerThreads.cpp:1463
+#: UI/GTK2/src/WorkerThreads.cpp:1596
 msgid "Index error on"
 msgstr "Indexeringsfout op"
 
-#: UI/GTK2/src/WorkerThreads.cpp:805 UI/GTK2/src/WorkerThreads.cpp:905
+#: UI/GTK2/src/WorkerThreads.cpp:784 UI/GTK2/src/WorkerThreads.cpp:957
 msgid "Couldn't create search engine"
 msgstr "Kon zoekmachine niet maken"
 
-#: UI/GTK2/src/WorkerThreads.cpp:817 UI/GTK2/src/WorkerThreads.cpp:919
+#: UI/GTK2/src/WorkerThreads.cpp:796 UI/GTK2/src/WorkerThreads.cpp:971
 msgid "Couldn't run query on search engine"
 msgstr "Kon query niet uitvoeren op zoekmachine"
 
-#: UI/GTK2/src/WorkerThreads.cpp:833
+#: UI/GTK2/src/WorkerThreads.cpp:830
 msgid "No title"
 msgstr "Geen titel"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1049
+#: UI/GTK2/src/WorkerThreads.cpp:1125
 msgid "Couldn't obtain downloader for protocol"
 msgstr "Kon geen downloader verkrijgen voor protocol"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1060
+#: UI/GTK2/src/WorkerThreads.cpp:1136
 msgid "Couldn't retrieve"
 msgstr "Kon niet opzoeken"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1161 UI/GTK2/src/WorkerThreads.cpp:1233
+#: UI/GTK2/src/WorkerThreads.cpp:1233 UI/GTK2/src/WorkerThreads.cpp:1309
 msgid "Cannot index document type"
 msgstr "Kan documenttype niet indexeren"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1165 UI/GTK2/src/WorkerThreads.cpp:1237
+#: UI/GTK2/src/WorkerThreads.cpp:1237 UI/GTK2/src/WorkerThreads.cpp:1313
 msgid "at"
 msgstr "bij"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1259
-#, fuzzy
-msgid "Couldn't tokenize"
-msgstr "Kon tokens niet toepassen"
-
-#: UI/GTK2/src/WorkerThreads.cpp:1279
+#: UI/GTK2/src/WorkerThreads.cpp:1344
 msgid "Robots META tag forbids indexing"
 msgstr "Robots META taf verbiedt indexeren"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1328
+#: UI/GTK2/src/WorkerThreads.cpp:1395
 msgid "Couldn't index"
 msgstr "Kon niet indexeren"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1409
+#: UI/GTK2/src/WorkerThreads.cpp:1474
 msgid "Couldn't unindex document(s)"
 msgstr "Kan indexering van bestand(en) niet ongedaan maken"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1543
+#: UI/GTK2/src/WorkerThreads.cpp:1608
 msgid "Couldn't update document"
 msgstr "Kan document niet actualiseren"

Modified: trunk/po/pt_BR.po
===================================================================
--- trunk/po/pt_BR.po	2007-02-17 10:13:25 UTC (rev 719)
+++ trunk/po/pt_BR.po	2007-02-17 10:27:53 UTC (rev 720)
@@ -6,10 +6,10 @@
 #, fuzzy
 msgid ""
 msgstr ""
-"Project-Id-Version: pinot\n"
+"Project-Id-Version: pinot 0.70\n"
 "Report-Msgid-Bugs-To: \n"
 "POT-Creation-Date: 2007-01-09 21:19+0800\n"
-"PO-Revision-Date: 2006-12-05 11:43+0000\n"
+"PO-Revision-Date: 2007-02-17 17:34+0800\n"
 "Last-Translator: Leonardo Melo <leonardovazmelo at gmail.com>\n"
 "Language-Team: Portuguese (Brazil) <pt_BR at li.org>\n"
 "MIME-Version: 1.0\n"
@@ -25,49 +25,29 @@
 msgid "Current User"
 msgstr "Usu?rio atual"
 
-#: UI/GTK2/src/EnginesTree.cpp:339 UI/GTK2/src/mainWindow.cc:323
-#: UI/GTK2/src/mainWindow.cc:326 UI/GTK2/src/mainWindow.cc:552
-#: UI/GTK2/src/mainWindow.cc:1206 UI/GTK2/src/mainWindow.cc:1249
-#: UI/GTK2/src/mainWindow.cc:1269 UI/GTK2/src/mainWindow.cc:1300
-#: UI/GTK2/src/mainWindow.cc:1880 UI/GTK2/src/PinotSettings.cpp:240
-#: UI/GTK2/src/PinotSettings.cpp:1230 UI/GTK2/src/PinotSettings.cpp:1286
-#: UI/GTK2/src/statisticsDialog.cc:83
+#: UI/GTK2/src/EnginesTree.cpp:339 UI/GTK2/src/mainWindow.cc:325
+#: UI/GTK2/src/mainWindow.cc:328 UI/GTK2/src/mainWindow.cc:541
+#: UI/GTK2/src/mainWindow.cc:1186 UI/GTK2/src/mainWindow.cc:1229
+#: UI/GTK2/src/mainWindow.cc:1249 UI/GTK2/src/mainWindow.cc:1280
+#: UI/GTK2/src/mainWindow.cc:1859 UI/GTK2/src/PinotSettings.cpp:241
+#: UI/GTK2/src/PinotSettings.cpp:1281 UI/GTK2/src/PinotSettings.cpp:1337
+#: UI/GTK2/src/statisticsDialog.cc:88 UI/GTK2/src/WorkerThreads.cpp:859
 msgid "My Web Pages"
 msgstr "Minhas P?ginas Web"
 
-#: UI/GTK2/src/EnginesTree.cpp:340 UI/GTK2/src/mainWindow.cc:317
-#: UI/GTK2/src/mainWindow.cc:320 UI/GTK2/src/PinotSettings.cpp:241
-#: UI/GTK2/src/PinotSettings.cpp:1231 UI/GTK2/src/PinotSettings.cpp:1287
-#: UI/GTK2/src/statisticsDialog.cc:69
+#: UI/GTK2/src/EnginesTree.cpp:340 UI/GTK2/src/mainWindow.cc:319
+#: UI/GTK2/src/mainWindow.cc:322 UI/GTK2/src/PinotSettings.cpp:242
+#: UI/GTK2/src/PinotSettings.cpp:1282 UI/GTK2/src/PinotSettings.cpp:1338
+#: UI/GTK2/src/statisticsDialog.cc:74 UI/GTK2/src/WorkerThreads.cpp:867
 msgid "My Documents"
 msgstr "Meus Documentos"
 
-#: UI/GTK2/src/importDialog.cc:82 UI/GTK2/src/queryDialog.cc:81
-#: UI/GTK2/src/statisticsDialog.cc:155
-msgid "None"
-msgstr "Nenhum"
+#: UI/GTK2/src/dateDialog_glade.cc:76 UI/GTK2/src/queryDialog_glade.cc:91
+#: UI/GTK2/src/queryDialog_glade.cc:92
+#, fuzzy
+msgid "Date"
+msgstr "no"
 
-#: UI/GTK2/src/importDialog_glade.cc:67 UI/GTK2/src/indexDialog_glade.cc:71
-msgid "Location:"
-msgstr "Localiza??o:"
-
-#: UI/GTK2/src/importDialog_glade.cc:68
-#: UI/GTK2/src/propertiesDialog_glade.cc:65
-msgid "Title:"
-msgstr "T?tulo:"
-
-#: UI/GTK2/src/importDialog_glade.cc:71
-msgid "Apply label:"
-msgstr "Aplicar t?tulo:"
-
-#: UI/GTK2/src/importDialog_glade.cc:77
-msgid "Import"
-msgstr "Importar"
-
-#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:221
-msgid "Import URL"
-msgstr "Importar URL"
-
 #: UI/GTK2/src/indexDialog.cc:130
 msgid "Served by"
 msgstr ""
@@ -93,6 +73,10 @@
 msgid "Type:"
 msgstr "Tipo:"
 
+#: UI/GTK2/src/indexDialog_glade.cc:71 UI/GTK2/src/importDialog_glade.cc:67
+msgid "Location:"
+msgstr "Localiza??o:"
+
 #: UI/GTK2/src/indexDialog_glade.cc:72
 msgid "Port:"
 msgstr "Porta:"
@@ -106,12 +90,33 @@
 msgid "External index"
 msgstr "?ndice externo"
 
-#: UI/GTK2/src/IndexTree.cpp:68 UI/GTK2/src/queryDialog.cc:112
+#: UI/GTK2/src/importDialog.cc:82 UI/GTK2/src/queryDialog.cc:108
+msgid "None"
+msgstr "Nenhum"
+
+#: UI/GTK2/src/importDialog_glade.cc:68
+#: UI/GTK2/src/propertiesDialog_glade.cc:67
+msgid "Title:"
+msgstr "T?tulo:"
+
+#: UI/GTK2/src/importDialog_glade.cc:71
+msgid "Apply label:"
+msgstr "Aplicar t?tulo:"
+
+#: UI/GTK2/src/importDialog_glade.cc:77
+msgid "Import"
+msgstr "Importar"
+
+#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:221
+msgid "Import URL"
+msgstr "Importar URL"
+
+#: UI/GTK2/src/IndexTree.cpp:68 UI/GTK2/src/queryDialog.cc:139
 #: UI/GTK2/src/ResultsTree.cpp:126
 msgid "Title"
 msgstr "T?tulo"
 
-#: UI/GTK2/src/IndexTree.cpp:73 UI/GTK2/src/queryDialog.cc:115
+#: UI/GTK2/src/IndexTree.cpp:73 UI/GTK2/src/queryDialog.cc:142
 #: UI/GTK2/src/ResultsTree.cpp:136
 msgid "URL"
 msgstr "URL"
@@ -132,214 +137,225 @@
 msgid "All labels"
 msgstr "Todos t?tulos"
 
-#: UI/GTK2/src/mainWindow.cc:139
+#: UI/GTK2/src/launcherDialog_glade.cc:64
+msgid ""
+"There is no helper application defined for this document's type.\n"
+"Please enter the command to open this document."
+msgstr ""
+
+#: UI/GTK2/src/launcherDialog_glade.cc:67
+msgid "Use this command for other documents of the same type."
+msgstr ""
+
+#: UI/GTK2/src/launcherDialog_glade.cc:99
+msgid "Helper application"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:141
 msgid "Query Name"
 msgstr "Nome da consulta"
 
-#: UI/GTK2/src/mainWindow.cc:144
+#: UI/GTK2/src/mainWindow.cc:146
 msgid "Last Run"
 msgstr "?ltimo executado"
 
-#: UI/GTK2/src/mainWindow.cc:149
+#: UI/GTK2/src/mainWindow.cc:151
 msgid "Summary"
 msgstr "Resumo"
 
-#: UI/GTK2/src/mainWindow.cc:182
+#: UI/GTK2/src/mainWindow.cc:184
 msgid "Show all search engines"
 msgstr "Mostrar todos mecanimos de pesquisa"
 
-#: UI/GTK2/src/mainWindow.cc:183
+#: UI/GTK2/src/mainWindow.cc:185
 msgid "Add index"
 msgstr "Adicionar ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:184
+#: UI/GTK2/src/mainWindow.cc:186
 msgid "Remove index"
 msgstr "Remover ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:190
+#: UI/GTK2/src/mainWindow.cc:192
 msgid "Ready"
 msgstr "Pronto"
 
-#: UI/GTK2/src/mainWindow.cc:241
+#: UI/GTK2/src/mainWindow.cc:243
 msgid "N/A"
 msgstr "N/A"
 
-#: UI/GTK2/src/mainWindow.cc:256
-msgid "<undefined>"
+#: UI/GTK2/src/mainWindow.cc:258
+#, fuzzy
+msgid "Undefined"
 msgstr "<indefinido>"
 
-#: UI/GTK2/src/mainWindow.cc:475
+#: UI/GTK2/src/mainWindow.cc:476
 msgid "Result location is"
 msgstr "Local resultante ?"
 
-#: UI/GTK2/src/mainWindow.cc:562
+#: UI/GTK2/src/mainWindow.cc:551
 msgid "Document location is"
 msgstr "Localiza??o do documento ?"
 
-#: UI/GTK2/src/mainWindow.cc:885
+#: UI/GTK2/src/mainWindow.cc:877
 msgid "Showing"
 msgstr "Exibindo"
 
-#: UI/GTK2/src/mainWindow.cc:890
+#: UI/GTK2/src/mainWindow.cc:882
 msgid "of"
 msgstr "de"
 
-#: UI/GTK2/src/mainWindow.cc:895
+#: UI/GTK2/src/mainWindow.cc:887
 msgid "documents, starting at"
 msgstr "documentos, come?am no"
 
-#: UI/GTK2/src/mainWindow.cc:928
+#: UI/GTK2/src/mainWindow.cc:920
 msgid "Query"
 msgstr "Consulta"
 
-#: UI/GTK2/src/mainWindow.cc:932 UI/GTK2/src/mainWindow.cc:2949
+#: UI/GTK2/src/mainWindow.cc:924 UI/GTK2/src/mainWindow.cc:2922
 msgid "on"
 msgstr "no"
 
-#: UI/GTK2/src/mainWindow.cc:936
+#: UI/GTK2/src/mainWindow.cc:928
 msgid "ended"
 msgstr "finalizada"
 
-#: UI/GTK2/src/mainWindow.cc:1071
+#: UI/GTK2/src/mainWindow.cc:1051
 msgid "More Like"
 msgstr "Mais pr?xima"
 
-#: UI/GTK2/src/mainWindow.cc:1132
+#: UI/GTK2/src/mainWindow.cc:1112
 msgid "Updated label(s)"
 msgstr "T?tulo(s) atualizado(s)"
 
-#: UI/GTK2/src/mainWindow.cc:1216
+#: UI/GTK2/src/mainWindow.cc:1196
 msgid "Updated document"
 msgstr "Documento atualizado"
 
-#: UI/GTK2/src/mainWindow.cc:1229
+#: UI/GTK2/src/mainWindow.cc:1209
 msgid "Indexed"
 msgstr "Indexado"
 
-#: UI/GTK2/src/mainWindow.cc:1270
+#: UI/GTK2/src/mainWindow.cc:1250
 msgid "Unindexed document(s)"
 msgstr "Documento(s) n?o indexidado(s)"
 
-#: UI/GTK2/src/mainWindow.cc:1311
+#: UI/GTK2/src/mainWindow.cc:1291
 msgid "Updated document properties"
 msgstr "Propriedade de documentos atualizados"
 
-#: UI/GTK2/src/mainWindow.cc:1358
+#: UI/GTK2/src/mainWindow.cc:1338
 msgid "Couldn't rename index, name"
 msgstr "N?o foi poss?vel renomear ?ndice, nome"
 
-#: UI/GTK2/src/mainWindow.cc:1362 UI/GTK2/src/mainWindow.cc:2273
-#: UI/GTK2/src/mainWindow.cc:2784
+#: UI/GTK2/src/mainWindow.cc:1342 UI/GTK2/src/mainWindow.cc:2246
+#: UI/GTK2/src/mainWindow.cc:2757
 msgid "is already in use"
 msgstr "j? est? em uso"
 
-#: UI/GTK2/src/mainWindow.cc:1375
+#: UI/GTK2/src/mainWindow.cc:1355
 msgid "Couldn't rename index"
 msgstr "N?o foi poss?vel renomear ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:1388
+#: UI/GTK2/src/mainWindow.cc:1368
 msgid "Edited index"
 msgstr "?ndice editado"
 
-#: UI/GTK2/src/mainWindow.cc:1758 UI/GTK2/src/mainWindow.cc:2443
+#: UI/GTK2/src/mainWindow.cc:1753 UI/GTK2/src/mainWindow.cc:2416
 msgid "Live query"
 msgstr "Query ativa"
 
-#: UI/GTK2/src/mainWindow.cc:1784
+#: UI/GTK2/src/mainWindow.cc:1779
 msgid "Couldn't find query"
 msgstr "N?o foi poss?vel encontrar consulta"
 
-#: UI/GTK2/src/mainWindow.cc:1828 UI/GTK2/src/mainWindow.cc:1924
-msgid "Please set a location for the index first"
-msgstr "Primeiro selecione local do ?ndice"
-
-#: UI/GTK2/src/mainWindow.cc:2003 UI/GTK2/src/WorkerThreads.cpp:670
-#: UI/GTK2/src/WorkerThreads.cpp:1517
+#: UI/GTK2/src/mainWindow.cc:1975 UI/GTK2/src/WorkerThreads.cpp:650
+#: UI/GTK2/src/WorkerThreads.cpp:1583
 msgid "Index"
 msgstr "?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2007 UI/GTK2/src/WorkerThreads.cpp:674
-#: UI/GTK2/src/WorkerThreads.cpp:1521
+#: UI/GTK2/src/mainWindow.cc:1979 UI/GTK2/src/WorkerThreads.cpp:654
+#: UI/GTK2/src/WorkerThreads.cpp:1587
 msgid "doesn't exist"
 msgstr "n?o existe"
 
-#: UI/GTK2/src/mainWindow.cc:2160
+#: UI/GTK2/src/mainWindow.cc:2133
 msgid "Remove this document from the index ?"
 msgstr "Remover documento do ?ndice?"
 
-#: UI/GTK2/src/mainWindow.cc:2179
+#: UI/GTK2/src/mainWindow.cc:2152
 msgid "Remove these documents from the index ?"
 msgstr "Remover documentos do ?ndice?"
 
-#: UI/GTK2/src/mainWindow.cc:2223
+#: UI/GTK2/src/mainWindow.cc:2196
 msgid "A metasearch tool for the Free Desktop"
 msgstr "Um mecanismo de metabusca gr?tis para Desktop"
 
-#: UI/GTK2/src/mainWindow.cc:2224
+#: UI/GTK2/src/mainWindow.cc:2197
 msgid "Search the Web and your documents !"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:2225
+#: UI/GTK2/src/mainWindow.cc:2198
 msgid "(C) 2005 Fabrice Colin"
 msgstr "(C) 2005 Fabrice Colin"
 
-#: UI/GTK2/src/mainWindow.cc:2269
+#: UI/GTK2/src/mainWindow.cc:2242
 msgid "Index name"
 msgstr "Nome do ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2284
+#: UI/GTK2/src/mainWindow.cc:2257
 msgid "Couldn't add index"
 msgstr "N?o foi poss?vel adicionar ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2298
+#: UI/GTK2/src/mainWindow.cc:2271
 msgid "Added new index"
 msgstr "Adicionar novo ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2333
+#: UI/GTK2/src/mainWindow.cc:2306
 msgid "Couldn't remove index"
 msgstr "N?o foi poss?vel remover ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2598
+#: UI/GTK2/src/mainWindow.cc:2571
 msgid "At least one task hasn't completed yet. Quit now ?"
 msgstr "Pelo menos uma tarefa n?o terminou ainda. Sair assim mesmo?"
 
-#: UI/GTK2/src/mainWindow.cc:2780
+#: UI/GTK2/src/mainWindow.cc:2753
 msgid "Query name"
 msgstr "Nome da consulta"
 
-#: UI/GTK2/src/mainWindow.cc:2807
+#: UI/GTK2/src/mainWindow.cc:2780
 msgid "Couldn't update query"
 msgstr "N?o foi poss?vel atualizar consulta"
 
-#: UI/GTK2/src/mainWindow.cc:2815
+#: UI/GTK2/src/mainWindow.cc:2788
 msgid "Edited query"
 msgstr "Consulta editada"
 
-#: UI/GTK2/src/mainWindow.cc:2822
+#: UI/GTK2/src/mainWindow.cc:2795
 msgid "Couldn't add query"
 msgstr "N?o foi poss?vel adicionar consulta"
 
-#: UI/GTK2/src/mainWindow.cc:2830
+#: UI/GTK2/src/mainWindow.cc:2803
 msgid "Added new query"
 msgstr "Adicionar nova consulta"
 
-#: UI/GTK2/src/mainWindow.cc:2843
+#: UI/GTK2/src/mainWindow.cc:2816
 msgid "Query is not set"
 msgstr "Consulta n?o foi atualizada"
 
-#: UI/GTK2/src/mainWindow.cc:2854
+#: UI/GTK2/src/mainWindow.cc:2827
 msgid "No search engine selected"
 msgstr "Nenhum mecanismo de pesquisa selecionado"
 
-#: UI/GTK2/src/mainWindow.cc:2936
+#: UI/GTK2/src/mainWindow.cc:2909
 msgid "Please set the Google API key first"
 msgstr "Primeiro informe a tecla para Google API"
 
-#: UI/GTK2/src/mainWindow.cc:2945
+#: UI/GTK2/src/mainWindow.cc:2918
 msgid "Running query"
 msgstr "Executando consulta"
 
-#: UI/GTK2/src/mainWindow.cc:3117
+#: UI/GTK2/src/mainWindow.cc:3102
 msgid "No default application defined for type"
 msgstr "Aplica??o associada ao tipo n?o definida"
 
@@ -355,9 +371,9 @@
 msgid "Stored queries"
 msgstr "Consultas armazenadas"
 
-#: UI/GTK2/src/mainWindow_glade.cc:161 UI/GTK2/src/statisticsDialog.cc:43
+#: UI/GTK2/src/mainWindow_glade.cc:161 UI/GTK2/src/statisticsDialog.cc:46
 #: UI/GTK2/src/statisticsDialog_glade.cc:87
-msgid "Statistics"
+msgid "Status"
 msgstr ""
 
 #: UI/GTK2/src/mainWindow_glade.cc:188
@@ -413,7 +429,7 @@
 msgstr "Retirar do ?ndice"
 
 #: UI/GTK2/src/mainWindow_glade.cc:236
-#: UI/GTK2/src/propertiesDialog_glade.cc:146
+#: UI/GTK2/src/propertiesDialog_glade.cc:177
 msgid "Properties"
 msgstr "Propriedades"
 
@@ -441,79 +457,80 @@
 msgid "Pinot"
 msgstr "Pino"
 
-#: UI/GTK2/src/pinot.cc:206 UI/GTK2/src/pinot-dbus-daemon.cc:273
+#: UI/GTK2/src/pinot.cc:203 UI/GTK2/src/pinot-dbus-daemon.cc:284
+#: UI/GTK2/src/propertiesDialog.cc:65 UI/GTK2/src/propertiesDialog.cc:74
 msgid "Unknown"
 msgstr "Desconhecido"
 
-#: UI/GTK2/src/pinot.cc:207 UI/GTK2/src/pinot-dbus-daemon.cc:274
+#: UI/GTK2/src/pinot.cc:204 UI/GTK2/src/pinot-dbus-daemon.cc:285
 msgid "Danish"
 msgstr "Danish"
 
-#: UI/GTK2/src/pinot.cc:208 UI/GTK2/src/pinot-dbus-daemon.cc:275
+#: UI/GTK2/src/pinot.cc:205 UI/GTK2/src/pinot-dbus-daemon.cc:286
 msgid "Dutch"
 msgstr "Dutch"
 
-#: UI/GTK2/src/pinot.cc:209 UI/GTK2/src/pinot-dbus-daemon.cc:276
+#: UI/GTK2/src/pinot.cc:206 UI/GTK2/src/pinot-dbus-daemon.cc:287
 msgid "English"
 msgstr "English"
 
-#: UI/GTK2/src/pinot.cc:210 UI/GTK2/src/pinot-dbus-daemon.cc:277
+#: UI/GTK2/src/pinot.cc:207 UI/GTK2/src/pinot-dbus-daemon.cc:288
 msgid "Finnish"
 msgstr "Terminar"
 
-#: UI/GTK2/src/pinot.cc:211 UI/GTK2/src/pinot-dbus-daemon.cc:278
+#: UI/GTK2/src/pinot.cc:208 UI/GTK2/src/pinot-dbus-daemon.cc:289
 msgid "French"
 msgstr "French"
 
-#: UI/GTK2/src/pinot.cc:212 UI/GTK2/src/pinot-dbus-daemon.cc:279
+#: UI/GTK2/src/pinot.cc:209 UI/GTK2/src/pinot-dbus-daemon.cc:290
 msgid "German"
 msgstr "German"
 
-#: UI/GTK2/src/pinot.cc:213 UI/GTK2/src/pinot-dbus-daemon.cc:280
+#: UI/GTK2/src/pinot.cc:210 UI/GTK2/src/pinot-dbus-daemon.cc:291
 msgid "Italian"
 msgstr "Italian"
 
-#: UI/GTK2/src/pinot.cc:214 UI/GTK2/src/pinot-dbus-daemon.cc:281
+#: UI/GTK2/src/pinot.cc:211 UI/GTK2/src/pinot-dbus-daemon.cc:292
 msgid "Norwegian"
 msgstr "Norwegian"
 
-#: UI/GTK2/src/pinot.cc:215 UI/GTK2/src/pinot-dbus-daemon.cc:282
+#: UI/GTK2/src/pinot.cc:212 UI/GTK2/src/pinot-dbus-daemon.cc:293
 msgid "Portuguese"
 msgstr "Portugu?s"
 
-#: UI/GTK2/src/pinot.cc:216 UI/GTK2/src/pinot-dbus-daemon.cc:283
+#: UI/GTK2/src/pinot.cc:213 UI/GTK2/src/pinot-dbus-daemon.cc:294
 msgid "Russian"
 msgstr "Russian"
 
-#: UI/GTK2/src/pinot.cc:217 UI/GTK2/src/pinot-dbus-daemon.cc:284
+#: UI/GTK2/src/pinot.cc:214 UI/GTK2/src/pinot-dbus-daemon.cc:295
 msgid "Spanish"
 msgstr "Spanish"
 
-#: UI/GTK2/src/pinot.cc:218 UI/GTK2/src/pinot-dbus-daemon.cc:285
+#: UI/GTK2/src/pinot.cc:215 UI/GTK2/src/pinot-dbus-daemon.cc:296
 msgid "Swedish"
 msgstr "Swedish"
 
-#: UI/GTK2/src/pinot.cc:242
+#: UI/GTK2/src/pinot.cc:239
 msgid "Couldn't open index"
 msgstr "N?o foi poss?vel abrir ?ndice"
 
-#: UI/GTK2/src/pinot.cc:258
+#: UI/GTK2/src/pinot.cc:255
 msgid "Couldn't create history database"
 msgstr "N?o foi poss?vel criar base de hist?rico"
 
-#: UI/GTK2/src/PinotSettings.cpp:246
+#: UI/GTK2/src/PinotSettings.cpp:247
 msgid "Important"
 msgstr "Importante"
 
-#: UI/GTK2/src/PinotSettings.cpp:247
+#: UI/GTK2/src/PinotSettings.cpp:248
 msgid "New"
 msgstr "Novo"
 
-#: UI/GTK2/src/PinotSettings.cpp:248
+#: UI/GTK2/src/PinotSettings.cpp:249
 msgid "Personal"
 msgstr "Pessoal"
 
-#: UI/GTK2/src/PinotSettings.cpp:1055
+#: UI/GTK2/src/PinotSettings.cpp:1085
 msgid "Unclassified"
 msgstr "N?o classificado"
 
@@ -533,15 +550,15 @@
 msgid "Pattern"
 msgstr "Conjunto"
 
-#: UI/GTK2/src/prefsDialog.cc:426
+#: UI/GTK2/src/prefsDialog.cc:423
 msgid "New Label"
 msgstr "Novo t?tulo"
 
-#: UI/GTK2/src/prefsDialog.cc:467
+#: UI/GTK2/src/prefsDialog.cc:464
 msgid "Directory to index"
 msgstr "Diret?rio do ?ndice"
 
-#: UI/GTK2/src/prefsDialog.cc:525
+#: UI/GTK2/src/prefsDialog.cc:522
 msgid "Mbox File Location"
 msgstr "Mbox localiza??o do arquivo"
 
@@ -618,46 +635,62 @@
 msgid "Preferences"
 msgstr "Prefer?ncias"
 
-#: UI/GTK2/src/propertiesDialog.cc:51 UI/GTK2/src/queryDialog.cc:127
+#: UI/GTK2/src/propertiesDialog.cc:52 UI/GTK2/src/queryDialog.cc:154
 msgid "Label"
 msgstr "T?tulo"
 
-#: UI/GTK2/src/propertiesDialog.cc:64
+#: UI/GTK2/src/propertiesDialog.cc:86
 msgid "Per document"
 msgstr "Por documento"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:66
+#: UI/GTK2/src/propertiesDialog_glade.cc:68
 msgid "Language:"
 msgstr "L?ngua:"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:67
+#: UI/GTK2/src/propertiesDialog_glade.cc:69
 msgid "MIME type:"
 msgstr "Tipo MIME:"
 
-#: UI/GTK2/src/queryDialog.cc:103
+#: UI/GTK2/src/propertiesDialog_glade.cc:70
+msgid "Size:"
+msgstr ""
+
+#: UI/GTK2/src/propertiesDialog_glade.cc:73
+msgid "Terms:"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog.cc:130
 msgid "Host name"
 msgstr "Nome do host"
 
-#: UI/GTK2/src/queryDialog.cc:106
+#: UI/GTK2/src/queryDialog.cc:133
 msgid "File name"
 msgstr "Nome do arquivo"
 
-#: UI/GTK2/src/queryDialog.cc:109
+#: UI/GTK2/src/queryDialog.cc:136
 msgid "File extension"
 msgstr "Extens?o do arquivo"
 
-#: UI/GTK2/src/queryDialog.cc:118
+#: UI/GTK2/src/queryDialog.cc:145
 msgid "Directory"
 msgstr "Diret?rio"
 
-#: UI/GTK2/src/queryDialog.cc:121
+#: UI/GTK2/src/queryDialog.cc:148
 msgid "Language code"
 msgstr "C?digo da l?ngua"
 
-#: UI/GTK2/src/queryDialog.cc:124
+#: UI/GTK2/src/queryDialog.cc:151
 msgid "MIME type"
 msgstr "Tipo MIME"
 
+#: UI/GTK2/src/queryDialog.cc:271
+msgid "Start date"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog.cc:286
+msgid "End date"
+msgstr ""
+
 #: UI/GTK2/src/queryDialog_glade.cc:72
 msgid "New filter:"
 msgstr "Novo filtro:"
@@ -667,14 +700,23 @@
 msgstr "Texto da consulta"
 
 #: UI/GTK2/src/queryDialog_glade.cc:83
-msgid "Index all results with label"
+#, fuzzy
+msgid "Index results with label"
 msgstr "Indexar todos resultados com t?tulo"
 
 #: UI/GTK2/src/queryDialog_glade.cc:86
 msgid "Number of results:"
 msgstr "N?mero de resultados:"
 
-#: UI/GTK2/src/queryDialog_glade.cc:181
+#: UI/GTK2/src/queryDialog_glade.cc:89
+msgid "Start date:"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog_glade.cc:90
+msgid "End date:"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog_glade.cc:201
 msgid "Query parameters"
 msgstr "Par?metros da consulta"
 
@@ -686,96 +728,115 @@
 msgid "Extract"
 msgstr "Extrair"
 
-#: UI/GTK2/src/statisticsDialog.cc:65
+#: UI/GTK2/src/statisticsDialog.cc:69
 #, fuzzy
 msgid "Indexes"
 msgstr "Indexado"
 
-#: UI/GTK2/src/statisticsDialog.cc:78 UI/GTK2/src/statisticsDialog.cc:92
+#: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/statisticsDialog.cc:97
 #, fuzzy
 msgid "documents"
 msgstr "Meus Documentos"
 
-#: UI/GTK2/src/statisticsDialog.cc:97
-msgid "Crawler"
+#: UI/GTK2/src/statisticsDialog.cc:102
+#, fuzzy
+msgid "History"
+msgstr "Diret?rio"
+
+#: UI/GTK2/src/statisticsDialog.cc:109
+#, fuzzy
+msgid "Viewed"
+msgstr "Visualizar"
+
+#: UI/GTK2/src/statisticsDialog.cc:109
+#, fuzzy
+msgid "results"
+msgstr "_Resultados"
+
+#: UI/GTK2/src/statisticsDialog.cc:113
+msgid "Daemon"
 msgstr ""
 
-#: UI/GTK2/src/statisticsDialog.cc:104
-msgid "crawled files"
+#: UI/GTK2/src/statisticsDialog.cc:131
+#, fuzzy
+msgid "Running under PID"
+msgstr "Executando consulta"
+
+#: UI/GTK2/src/statisticsDialog.cc:135
+msgid "Currently not running"
 msgstr ""
 
-#: UI/GTK2/src/statisticsDialog.cc:109
-msgid "files being crawled"
+#: UI/GTK2/src/statisticsDialog.cc:143
+msgid "Crawled"
 msgstr ""
 
-#: UI/GTK2/src/statisticsDialog.cc:113
+#: UI/GTK2/src/statisticsDialog.cc:143
+msgid "files"
+msgstr ""
+
+#: UI/GTK2/src/statisticsDialog.cc:166
 msgid "Errors"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:320
+#: UI/GTK2/src/WorkerThreads.cpp:321
 msgid "Can't index mail here"
 msgstr "N?o foi poss?vel indexar mail aqui"
 
-#: UI/GTK2/src/WorkerThreads.cpp:341
+#: UI/GTK2/src/WorkerThreads.cpp:342
 msgid "is already being indexed"
 msgstr "j? est? sendo indexado"
 
-#: UI/GTK2/src/WorkerThreads.cpp:351
+#: UI/GTK2/src/WorkerThreads.cpp:352
 msgid "is blacklisted"
 msgstr "est? na lista negra"
 
-#: UI/GTK2/src/WorkerThreads.cpp:359 UI/GTK2/src/WorkerThreads.cpp:683
-#: UI/GTK2/src/WorkerThreads.cpp:960 UI/GTK2/src/WorkerThreads.cpp:969
-#: UI/GTK2/src/WorkerThreads.cpp:1138 UI/GTK2/src/WorkerThreads.cpp:1397
-#: UI/GTK2/src/WorkerThreads.cpp:1530
+#: UI/GTK2/src/WorkerThreads.cpp:663 UI/GTK2/src/WorkerThreads.cpp:936
+#: UI/GTK2/src/WorkerThreads.cpp:1022 UI/GTK2/src/WorkerThreads.cpp:1031
+#: UI/GTK2/src/WorkerThreads.cpp:1203 UI/GTK2/src/WorkerThreads.cpp:1463
+#: UI/GTK2/src/WorkerThreads.cpp:1596
 msgid "Index error on"
 msgstr "Erro no ?ndice no"
 
-#: UI/GTK2/src/WorkerThreads.cpp:804 UI/GTK2/src/WorkerThreads.cpp:904
+#: UI/GTK2/src/WorkerThreads.cpp:784 UI/GTK2/src/WorkerThreads.cpp:957
 msgid "Couldn't create search engine"
 msgstr "N?o foi poss?vel criar mecanismo de pesquisa"
 
-#: UI/GTK2/src/WorkerThreads.cpp:816 UI/GTK2/src/WorkerThreads.cpp:918
+#: UI/GTK2/src/WorkerThreads.cpp:796 UI/GTK2/src/WorkerThreads.cpp:971
 msgid "Couldn't run query on search engine"
 msgstr "N?o foi poss?vel executar consulta no mecanismo de pesquisa"
 
-#: UI/GTK2/src/WorkerThreads.cpp:832
+#: UI/GTK2/src/WorkerThreads.cpp:830
 msgid "No title"
 msgstr "Sem t?tulo"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1048
+#: UI/GTK2/src/WorkerThreads.cpp:1125
 msgid "Couldn't obtain downloader for protocol"
 msgstr "N?o foi poss?vel obter fonte de download para o protocolo"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1059
+#: UI/GTK2/src/WorkerThreads.cpp:1136
 msgid "Couldn't retrieve"
 msgstr "N?o foi poss?vel carregar"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1160 UI/GTK2/src/WorkerThreads.cpp:1232
+#: UI/GTK2/src/WorkerThreads.cpp:1233 UI/GTK2/src/WorkerThreads.cpp:1309
 msgid "Cannot index document type"
 msgstr "Imposs?vel indexar tipo de arquivo"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1164 UI/GTK2/src/WorkerThreads.cpp:1236
+#: UI/GTK2/src/WorkerThreads.cpp:1237 UI/GTK2/src/WorkerThreads.cpp:1313
 msgid "at"
 msgstr "no"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1258
-#, fuzzy
-msgid "Couldn't tokenize"
-msgstr "N?o foi poss?vel TOKENIZE"
-
-#: UI/GTK2/src/WorkerThreads.cpp:1278
+#: UI/GTK2/src/WorkerThreads.cpp:1344
 msgid "Robots META tag forbids indexing"
 msgstr "Robots META tag n?o s?o permitidos no ?ndice"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1327
+#: UI/GTK2/src/WorkerThreads.cpp:1395
 msgid "Couldn't index"
 msgstr "N?o foi poss?vel indexar"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1408
+#: UI/GTK2/src/WorkerThreads.cpp:1474
 msgid "Couldn't unindex document(s)"
 msgstr "N?o foi poss?vel remover documento(s) do ?ndice"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1542
+#: UI/GTK2/src/WorkerThreads.cpp:1608
 msgid "Couldn't update document"
 msgstr "N?o foi poss?vel atualizar documento"

Modified: trunk/po/ru.po
===================================================================
--- trunk/po/ru.po	2007-02-17 10:13:25 UTC (rev 719)
+++ trunk/po/ru.po	2007-02-17 10:27:53 UTC (rev 720)
@@ -6,10 +6,10 @@
 #, fuzzy
 msgid ""
 msgstr ""
-"Project-Id-Version: pinot\n"
+"Project-Id-Version: pinot 0.70\n"
 "Report-Msgid-Bugs-To: \n"
 "POT-Creation-Date: 2007-01-09 21:19+0800\n"
-"PO-Revision-Date: 2006-12-29 11:28+0000\n"
+"PO-Revision-Date: 2007-02-17 17:34+0800\n"
 "Last-Translator: Sergey Vostrikov <s.vostrikov at gmail.com>\n"
 "Language-Team: Russian <ru at li.org>\n"
 "MIME-Version: 1.0\n"
@@ -25,49 +25,29 @@
 msgid "Current User"
 msgstr "??????? ????????????"
 
-#: UI/GTK2/src/EnginesTree.cpp:339 UI/GTK2/src/mainWindow.cc:323
-#: UI/GTK2/src/mainWindow.cc:326 UI/GTK2/src/mainWindow.cc:552
-#: UI/GTK2/src/mainWindow.cc:1206 UI/GTK2/src/mainWindow.cc:1249
-#: UI/GTK2/src/mainWindow.cc:1269 UI/GTK2/src/mainWindow.cc:1300
-#: UI/GTK2/src/mainWindow.cc:1880 UI/GTK2/src/PinotSettings.cpp:240
-#: UI/GTK2/src/PinotSettings.cpp:1230 UI/GTK2/src/PinotSettings.cpp:1286
-#: UI/GTK2/src/statisticsDialog.cc:83
+#: UI/GTK2/src/EnginesTree.cpp:339 UI/GTK2/src/mainWindow.cc:325
+#: UI/GTK2/src/mainWindow.cc:328 UI/GTK2/src/mainWindow.cc:541
+#: UI/GTK2/src/mainWindow.cc:1186 UI/GTK2/src/mainWindow.cc:1229
+#: UI/GTK2/src/mainWindow.cc:1249 UI/GTK2/src/mainWindow.cc:1280
+#: UI/GTK2/src/mainWindow.cc:1859 UI/GTK2/src/PinotSettings.cpp:241
+#: UI/GTK2/src/PinotSettings.cpp:1281 UI/GTK2/src/PinotSettings.cpp:1337
+#: UI/GTK2/src/statisticsDialog.cc:88 UI/GTK2/src/WorkerThreads.cpp:859
 msgid "My Web Pages"
 msgstr "??? web-????????"
 
-#: UI/GTK2/src/EnginesTree.cpp:340 UI/GTK2/src/mainWindow.cc:317
-#: UI/GTK2/src/mainWindow.cc:320 UI/GTK2/src/PinotSettings.cpp:241
-#: UI/GTK2/src/PinotSettings.cpp:1231 UI/GTK2/src/PinotSettings.cpp:1287
-#: UI/GTK2/src/statisticsDialog.cc:69
+#: UI/GTK2/src/EnginesTree.cpp:340 UI/GTK2/src/mainWindow.cc:319
+#: UI/GTK2/src/mainWindow.cc:322 UI/GTK2/src/PinotSettings.cpp:242
+#: UI/GTK2/src/PinotSettings.cpp:1282 UI/GTK2/src/PinotSettings.cpp:1338
+#: UI/GTK2/src/statisticsDialog.cc:74 UI/GTK2/src/WorkerThreads.cpp:867
 msgid "My Documents"
 msgstr "??? ?????????"
 
-#: UI/GTK2/src/importDialog.cc:82 UI/GTK2/src/queryDialog.cc:81
-#: UI/GTK2/src/statisticsDialog.cc:155
-msgid "None"
-msgstr "???"
+#: UI/GTK2/src/dateDialog_glade.cc:76 UI/GTK2/src/queryDialog_glade.cc:91
+#: UI/GTK2/src/queryDialog_glade.cc:92
+#, fuzzy
+msgid "Date"
+msgstr "?"
 
-#: UI/GTK2/src/importDialog_glade.cc:67 UI/GTK2/src/indexDialog_glade.cc:71
-msgid "Location:"
-msgstr "??????????:"
-
-#: UI/GTK2/src/importDialog_glade.cc:68
-#: UI/GTK2/src/propertiesDialog_glade.cc:65
-msgid "Title:"
-msgstr "????????:"
-
-#: UI/GTK2/src/importDialog_glade.cc:71
-msgid "Apply label:"
-msgstr "????????? ?????:"
-
-#: UI/GTK2/src/importDialog_glade.cc:77
-msgid "Import"
-msgstr "??????"
-
-#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:221
-msgid "Import URL"
-msgstr "?????? URL"
-
 #: UI/GTK2/src/indexDialog.cc:130
 msgid "Served by"
 msgstr ""
@@ -93,6 +73,10 @@
 msgid "Type:"
 msgstr "???:"
 
+#: UI/GTK2/src/indexDialog_glade.cc:71 UI/GTK2/src/importDialog_glade.cc:67
+msgid "Location:"
+msgstr "??????????:"
+
 #: UI/GTK2/src/indexDialog_glade.cc:72
 msgid "Port:"
 msgstr "????:"
@@ -106,12 +90,33 @@
 msgid "External index"
 msgstr "??????? ??????"
 
-#: UI/GTK2/src/IndexTree.cpp:68 UI/GTK2/src/queryDialog.cc:112
+#: UI/GTK2/src/importDialog.cc:82 UI/GTK2/src/queryDialog.cc:108
+msgid "None"
+msgstr "???"
+
+#: UI/GTK2/src/importDialog_glade.cc:68
+#: UI/GTK2/src/propertiesDialog_glade.cc:67
+msgid "Title:"
+msgstr "????????:"
+
+#: UI/GTK2/src/importDialog_glade.cc:71
+msgid "Apply label:"
+msgstr "????????? ?????:"
+
+#: UI/GTK2/src/importDialog_glade.cc:77
+msgid "Import"
+msgstr "??????"
+
+#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:221
+msgid "Import URL"
+msgstr "?????? URL"
+
+#: UI/GTK2/src/IndexTree.cpp:68 UI/GTK2/src/queryDialog.cc:139
 #: UI/GTK2/src/ResultsTree.cpp:126
 msgid "Title"
 msgstr "????????"
 
-#: UI/GTK2/src/IndexTree.cpp:73 UI/GTK2/src/queryDialog.cc:115
+#: UI/GTK2/src/IndexTree.cpp:73 UI/GTK2/src/queryDialog.cc:142
 #: UI/GTK2/src/ResultsTree.cpp:136
 msgid "URL"
 msgstr "URL"
@@ -132,214 +137,225 @@
 msgid "All labels"
 msgstr "??? ?????"
 
-#: UI/GTK2/src/mainWindow.cc:139
+#: UI/GTK2/src/launcherDialog_glade.cc:64
+msgid ""
+"There is no helper application defined for this document's type.\n"
+"Please enter the command to open this document."
+msgstr ""
+
+#: UI/GTK2/src/launcherDialog_glade.cc:67
+msgid "Use this command for other documents of the same type."
+msgstr ""
+
+#: UI/GTK2/src/launcherDialog_glade.cc:99
+msgid "Helper application"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:141
 msgid "Query Name"
 msgstr "??????"
 
-#: UI/GTK2/src/mainWindow.cc:144
+#: UI/GTK2/src/mainWindow.cc:146
 msgid "Last Run"
 msgstr "????????? ?????????"
 
-#: UI/GTK2/src/mainWindow.cc:149
+#: UI/GTK2/src/mainWindow.cc:151
 msgid "Summary"
 msgstr "??????"
 
-#: UI/GTK2/src/mainWindow.cc:182
+#: UI/GTK2/src/mainWindow.cc:184
 msgid "Show all search engines"
 msgstr "??? ????????? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:183
+#: UI/GTK2/src/mainWindow.cc:185
 msgid "Add index"
 msgstr "???????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:184
+#: UI/GTK2/src/mainWindow.cc:186
 msgid "Remove index"
 msgstr "??????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:190
+#: UI/GTK2/src/mainWindow.cc:192
 msgid "Ready"
 msgstr "?????"
 
-#: UI/GTK2/src/mainWindow.cc:241
+#: UI/GTK2/src/mainWindow.cc:243
 msgid "N/A"
 msgstr "N/A"
 
-#: UI/GTK2/src/mainWindow.cc:256
-msgid "<undefined>"
+#: UI/GTK2/src/mainWindow.cc:258
+#, fuzzy
+msgid "Undefined"
 msgstr "<??????????????>"
 
-#: UI/GTK2/src/mainWindow.cc:475
+#: UI/GTK2/src/mainWindow.cc:476
 msgid "Result location is"
 msgstr "??????? ?"
 
-#: UI/GTK2/src/mainWindow.cc:562
+#: UI/GTK2/src/mainWindow.cc:551
 msgid "Document location is"
 msgstr "???????????? ?????????"
 
-#: UI/GTK2/src/mainWindow.cc:885
+#: UI/GTK2/src/mainWindow.cc:877
 msgid "Showing"
 msgstr "????????"
 
-#: UI/GTK2/src/mainWindow.cc:890
+#: UI/GTK2/src/mainWindow.cc:882
 msgid "of"
 msgstr "??"
 
-#: UI/GTK2/src/mainWindow.cc:895
+#: UI/GTK2/src/mainWindow.cc:887
 msgid "documents, starting at"
 msgstr "??????????, ??????? ?"
 
-#: UI/GTK2/src/mainWindow.cc:928
+#: UI/GTK2/src/mainWindow.cc:920
 msgid "Query"
 msgstr "??????"
 
-#: UI/GTK2/src/mainWindow.cc:932 UI/GTK2/src/mainWindow.cc:2949
+#: UI/GTK2/src/mainWindow.cc:924 UI/GTK2/src/mainWindow.cc:2922
 msgid "on"
 msgstr "??"
 
-#: UI/GTK2/src/mainWindow.cc:936
+#: UI/GTK2/src/mainWindow.cc:928
 msgid "ended"
 msgstr "?????????????"
 
-#: UI/GTK2/src/mainWindow.cc:1071
+#: UI/GTK2/src/mainWindow.cc:1051
 msgid "More Like"
 msgstr "????? ????????"
 
-#: UI/GTK2/src/mainWindow.cc:1132
+#: UI/GTK2/src/mainWindow.cc:1112
 msgid "Updated label(s)"
 msgstr "????????? ????? (??)"
 
-#: UI/GTK2/src/mainWindow.cc:1216
+#: UI/GTK2/src/mainWindow.cc:1196
 msgid "Updated document"
 msgstr "??????????? ????????"
 
-#: UI/GTK2/src/mainWindow.cc:1229
+#: UI/GTK2/src/mainWindow.cc:1209
 msgid "Indexed"
 msgstr "?????????????"
 
-#: UI/GTK2/src/mainWindow.cc:1270
+#: UI/GTK2/src/mainWindow.cc:1250
 msgid "Unindexed document(s)"
 msgstr "?? ????????????? ??????????"
 
-#: UI/GTK2/src/mainWindow.cc:1311
+#: UI/GTK2/src/mainWindow.cc:1291
 msgid "Updated document properties"
 msgstr "?????????? ??????? ?????????"
 
-#: UI/GTK2/src/mainWindow.cc:1358
+#: UI/GTK2/src/mainWindow.cc:1338
 msgid "Couldn't rename index, name"
 msgstr "?????????? ????????????? ??????, ????????"
 
-#: UI/GTK2/src/mainWindow.cc:1362 UI/GTK2/src/mainWindow.cc:2273
-#: UI/GTK2/src/mainWindow.cc:2784
+#: UI/GTK2/src/mainWindow.cc:1342 UI/GTK2/src/mainWindow.cc:2246
+#: UI/GTK2/src/mainWindow.cc:2757
 msgid "is already in use"
 msgstr "??? ????????????"
 
-#: UI/GTK2/src/mainWindow.cc:1375
+#: UI/GTK2/src/mainWindow.cc:1355
 msgid "Couldn't rename index"
 msgstr "?????????? ????????????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:1388
+#: UI/GTK2/src/mainWindow.cc:1368
 msgid "Edited index"
 msgstr "?????????????? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:1758 UI/GTK2/src/mainWindow.cc:2443
+#: UI/GTK2/src/mainWindow.cc:1753 UI/GTK2/src/mainWindow.cc:2416
 msgid "Live query"
 msgstr "???????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:1784
+#: UI/GTK2/src/mainWindow.cc:1779
 msgid "Couldn't find query"
 msgstr "?????????? ????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:1828 UI/GTK2/src/mainWindow.cc:1924
-msgid "Please set a location for the index first"
-msgstr "??????? ?????????????? ??????? ???????"
-
-#: UI/GTK2/src/mainWindow.cc:2003 UI/GTK2/src/WorkerThreads.cpp:670
-#: UI/GTK2/src/WorkerThreads.cpp:1517
+#: UI/GTK2/src/mainWindow.cc:1975 UI/GTK2/src/WorkerThreads.cpp:650
+#: UI/GTK2/src/WorkerThreads.cpp:1583
 msgid "Index"
 msgstr "??????"
 
-#: UI/GTK2/src/mainWindow.cc:2007 UI/GTK2/src/WorkerThreads.cpp:674
-#: UI/GTK2/src/WorkerThreads.cpp:1521
+#: UI/GTK2/src/mainWindow.cc:1979 UI/GTK2/src/WorkerThreads.cpp:654
+#: UI/GTK2/src/WorkerThreads.cpp:1587
 msgid "doesn't exist"
 msgstr "???"
 
-#: UI/GTK2/src/mainWindow.cc:2160
+#: UI/GTK2/src/mainWindow.cc:2133
 msgid "Remove this document from the index ?"
 msgstr "??????? ???????? ?? ??????? ?"
 
-#: UI/GTK2/src/mainWindow.cc:2179
+#: UI/GTK2/src/mainWindow.cc:2152
 msgid "Remove these documents from the index ?"
 msgstr "??????? ??? ????????? ?? ????????"
 
-#: UI/GTK2/src/mainWindow.cc:2223
+#: UI/GTK2/src/mainWindow.cc:2196
 msgid "A metasearch tool for the Free Desktop"
 msgstr "?????????? ?????????? ??? ?????????? ????????"
 
-#: UI/GTK2/src/mainWindow.cc:2224
+#: UI/GTK2/src/mainWindow.cc:2197
 msgid "Search the Web and your documents !"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:2225
+#: UI/GTK2/src/mainWindow.cc:2198
 msgid "(C) 2005 Fabrice Colin"
 msgstr "(C) 2005 Fabrice Colin"
 
-#: UI/GTK2/src/mainWindow.cc:2269
+#: UI/GTK2/src/mainWindow.cc:2242
 msgid "Index name"
 msgstr "???????? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:2284
+#: UI/GTK2/src/mainWindow.cc:2257
 msgid "Couldn't add index"
 msgstr "?????????? ???????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:2298
+#: UI/GTK2/src/mainWindow.cc:2271
 msgid "Added new index"
 msgstr "???????? ????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:2333
+#: UI/GTK2/src/mainWindow.cc:2306
 msgid "Couldn't remove index"
 msgstr "?????????? ??????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:2598
+#: UI/GTK2/src/mainWindow.cc:2571
 msgid "At least one task hasn't completed yet. Quit now ?"
 msgstr "?? ??????? ???? ???? ?????? ??? ?? ?????????. ????? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:2780
+#: UI/GTK2/src/mainWindow.cc:2753
 msgid "Query name"
 msgstr "???????? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:2807
+#: UI/GTK2/src/mainWindow.cc:2780
 msgid "Couldn't update query"
 msgstr "?????????? ???????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:2815
+#: UI/GTK2/src/mainWindow.cc:2788
 msgid "Edited query"
 msgstr "?????? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:2822
+#: UI/GTK2/src/mainWindow.cc:2795
 msgid "Couldn't add query"
 msgstr "?????????? ???????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:2830
+#: UI/GTK2/src/mainWindow.cc:2803
 msgid "Added new query"
 msgstr "???????? ????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:2843
+#: UI/GTK2/src/mainWindow.cc:2816
 msgid "Query is not set"
 msgstr "?????? ?? ??????????"
 
-#: UI/GTK2/src/mainWindow.cc:2854
+#: UI/GTK2/src/mainWindow.cc:2827
 msgid "No search engine selected"
 msgstr "?? ???? ????????? ??????? ?? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:2936
+#: UI/GTK2/src/mainWindow.cc:2909
 msgid "Please set the Google API key first"
 msgstr "??????????, ??????? ????????????? ???? Google API"
 
-#: UI/GTK2/src/mainWindow.cc:2945
+#: UI/GTK2/src/mainWindow.cc:2918
 msgid "Running query"
 msgstr "?????? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:3117
+#: UI/GTK2/src/mainWindow.cc:3102
 msgid "No default application defined for type"
 msgstr "?? ???? ?????????? ?? ????????? ?? ?????????? ??? ???? ??????????"
 
@@ -355,9 +371,9 @@
 msgid "Stored queries"
 msgstr "??????????? ???????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:161 UI/GTK2/src/statisticsDialog.cc:43
+#: UI/GTK2/src/mainWindow_glade.cc:161 UI/GTK2/src/statisticsDialog.cc:46
 #: UI/GTK2/src/statisticsDialog_glade.cc:87
-msgid "Statistics"
+msgid "Status"
 msgstr ""
 
 #: UI/GTK2/src/mainWindow_glade.cc:188
@@ -413,7 +429,7 @@
 msgstr "????? ??????"
 
 #: UI/GTK2/src/mainWindow_glade.cc:236
-#: UI/GTK2/src/propertiesDialog_glade.cc:146
+#: UI/GTK2/src/propertiesDialog_glade.cc:177
 msgid "Properties"
 msgstr "????????"
 
@@ -441,79 +457,80 @@
 msgid "Pinot"
 msgstr "Pinot"
 
-#: UI/GTK2/src/pinot.cc:206 UI/GTK2/src/pinot-dbus-daemon.cc:273
+#: UI/GTK2/src/pinot.cc:203 UI/GTK2/src/pinot-dbus-daemon.cc:284
+#: UI/GTK2/src/propertiesDialog.cc:65 UI/GTK2/src/propertiesDialog.cc:74
 msgid "Unknown"
 msgstr "???????????"
 
-#: UI/GTK2/src/pinot.cc:207 UI/GTK2/src/pinot-dbus-daemon.cc:274
+#: UI/GTK2/src/pinot.cc:204 UI/GTK2/src/pinot-dbus-daemon.cc:285
 msgid "Danish"
 msgstr "???????"
 
-#: UI/GTK2/src/pinot.cc:208 UI/GTK2/src/pinot-dbus-daemon.cc:275
+#: UI/GTK2/src/pinot.cc:205 UI/GTK2/src/pinot-dbus-daemon.cc:286
 msgid "Dutch"
 msgstr "???????????"
 
-#: UI/GTK2/src/pinot.cc:209 UI/GTK2/src/pinot-dbus-daemon.cc:276
+#: UI/GTK2/src/pinot.cc:206 UI/GTK2/src/pinot-dbus-daemon.cc:287
 msgid "English"
 msgstr "??????????"
 
-#: UI/GTK2/src/pinot.cc:210 UI/GTK2/src/pinot-dbus-daemon.cc:277
+#: UI/GTK2/src/pinot.cc:207 UI/GTK2/src/pinot-dbus-daemon.cc:288
 msgid "Finnish"
 msgstr "???????"
 
-#: UI/GTK2/src/pinot.cc:211 UI/GTK2/src/pinot-dbus-daemon.cc:278
+#: UI/GTK2/src/pinot.cc:208 UI/GTK2/src/pinot-dbus-daemon.cc:289
 msgid "French"
 msgstr "???????????"
 
-#: UI/GTK2/src/pinot.cc:212 UI/GTK2/src/pinot-dbus-daemon.cc:279
+#: UI/GTK2/src/pinot.cc:209 UI/GTK2/src/pinot-dbus-daemon.cc:290
 msgid "German"
 msgstr "????????"
 
-#: UI/GTK2/src/pinot.cc:213 UI/GTK2/src/pinot-dbus-daemon.cc:280
+#: UI/GTK2/src/pinot.cc:210 UI/GTK2/src/pinot-dbus-daemon.cc:291
 msgid "Italian"
 msgstr "???????????"
 
-#: UI/GTK2/src/pinot.cc:214 UI/GTK2/src/pinot-dbus-daemon.cc:281
+#: UI/GTK2/src/pinot.cc:211 UI/GTK2/src/pinot-dbus-daemon.cc:292
 msgid "Norwegian"
 msgstr "??????????"
 
-#: UI/GTK2/src/pinot.cc:215 UI/GTK2/src/pinot-dbus-daemon.cc:282
+#: UI/GTK2/src/pinot.cc:212 UI/GTK2/src/pinot-dbus-daemon.cc:293
 msgid "Portuguese"
 msgstr "?????????????"
 
-#: UI/GTK2/src/pinot.cc:216 UI/GTK2/src/pinot-dbus-daemon.cc:283
+#: UI/GTK2/src/pinot.cc:213 UI/GTK2/src/pinot-dbus-daemon.cc:294
 msgid "Russian"
 msgstr "???????"
 
-#: UI/GTK2/src/pinot.cc:217 UI/GTK2/src/pinot-dbus-daemon.cc:284
+#: UI/GTK2/src/pinot.cc:214 UI/GTK2/src/pinot-dbus-daemon.cc:295
 msgid "Spanish"
 msgstr "?????????"
 
-#: UI/GTK2/src/pinot.cc:218 UI/GTK2/src/pinot-dbus-daemon.cc:285
+#: UI/GTK2/src/pinot.cc:215 UI/GTK2/src/pinot-dbus-daemon.cc:296
 msgid "Swedish"
 msgstr "????????"
 
-#: UI/GTK2/src/pinot.cc:242
+#: UI/GTK2/src/pinot.cc:239
 msgid "Couldn't open index"
 msgstr "?????????? ??????? ??????"
 
-#: UI/GTK2/src/pinot.cc:258
+#: UI/GTK2/src/pinot.cc:255
 msgid "Couldn't create history database"
 msgstr "?? ??????? ??????? ???? ?????? ???????"
 
-#: UI/GTK2/src/PinotSettings.cpp:246
+#: UI/GTK2/src/PinotSettings.cpp:247
 msgid "Important"
 msgstr "?????"
 
-#: UI/GTK2/src/PinotSettings.cpp:247
+#: UI/GTK2/src/PinotSettings.cpp:248
 msgid "New"
 msgstr "???????"
 
-#: UI/GTK2/src/PinotSettings.cpp:248
+#: UI/GTK2/src/PinotSettings.cpp:249
 msgid "Personal"
 msgstr "??????"
 
-#: UI/GTK2/src/PinotSettings.cpp:1055
+#: UI/GTK2/src/PinotSettings.cpp:1085
 msgid "Unclassified"
 msgstr "??????????????"
 
@@ -533,15 +550,15 @@
 msgid "Pattern"
 msgstr "???????"
 
-#: UI/GTK2/src/prefsDialog.cc:426
+#: UI/GTK2/src/prefsDialog.cc:423
 msgid "New Label"
 msgstr "????? ?????"
 
-#: UI/GTK2/src/prefsDialog.cc:467
+#: UI/GTK2/src/prefsDialog.cc:464
 msgid "Directory to index"
 msgstr "????? ??? ??????????????"
 
-#: UI/GTK2/src/prefsDialog.cc:525
+#: UI/GTK2/src/prefsDialog.cc:522
 msgid "Mbox File Location"
 msgstr "?????????????? ????? Mbox"
 
@@ -611,46 +628,62 @@
 msgid "Preferences"
 msgstr "?????????"
 
-#: UI/GTK2/src/propertiesDialog.cc:51 UI/GTK2/src/queryDialog.cc:127
+#: UI/GTK2/src/propertiesDialog.cc:52 UI/GTK2/src/queryDialog.cc:154
 msgid "Label"
 msgstr "?????"
 
-#: UI/GTK2/src/propertiesDialog.cc:64
+#: UI/GTK2/src/propertiesDialog.cc:86
 msgid "Per document"
 msgstr "??? ?????????? ?????????"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:66
+#: UI/GTK2/src/propertiesDialog_glade.cc:68
 msgid "Language:"
 msgstr "????:"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:67
+#: UI/GTK2/src/propertiesDialog_glade.cc:69
 msgid "MIME type:"
 msgstr "??? MIME:"
 
-#: UI/GTK2/src/queryDialog.cc:103
+#: UI/GTK2/src/propertiesDialog_glade.cc:70
+msgid "Size:"
+msgstr ""
+
+#: UI/GTK2/src/propertiesDialog_glade.cc:73
+msgid "Terms:"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog.cc:130
 msgid "Host name"
 msgstr "??? ????"
 
-#: UI/GTK2/src/queryDialog.cc:106
+#: UI/GTK2/src/queryDialog.cc:133
 msgid "File name"
 msgstr "????"
 
-#: UI/GTK2/src/queryDialog.cc:109
+#: UI/GTK2/src/queryDialog.cc:136
 msgid "File extension"
 msgstr "?????????? ?????"
 
-#: UI/GTK2/src/queryDialog.cc:118
+#: UI/GTK2/src/queryDialog.cc:145
 msgid "Directory"
 msgstr "???????? ??????????"
 
-#: UI/GTK2/src/queryDialog.cc:121
+#: UI/GTK2/src/queryDialog.cc:148
 msgid "Language code"
 msgstr "??? ?????"
 
-#: UI/GTK2/src/queryDialog.cc:124
+#: UI/GTK2/src/queryDialog.cc:151
 msgid "MIME type"
 msgstr "??? MIME"
 
+#: UI/GTK2/src/queryDialog.cc:271
+msgid "Start date"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog.cc:286
+msgid "End date"
+msgstr ""
+
 #: UI/GTK2/src/queryDialog_glade.cc:72
 msgid "New filter:"
 msgstr "????? ??????:"
@@ -660,14 +693,23 @@
 msgstr "????? ???????"
 
 #: UI/GTK2/src/queryDialog_glade.cc:83
-msgid "Index all results with label"
+#, fuzzy
+msgid "Index results with label"
 msgstr "????????????? ??? ?????????? ? ??????"
 
 #: UI/GTK2/src/queryDialog_glade.cc:86
 msgid "Number of results:"
 msgstr "?????????? ???????????:"
 
-#: UI/GTK2/src/queryDialog_glade.cc:181
+#: UI/GTK2/src/queryDialog_glade.cc:89
+msgid "Start date:"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog_glade.cc:90
+msgid "End date:"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog_glade.cc:201
 msgid "Query parameters"
 msgstr "????????? ???????"
 
@@ -679,95 +721,115 @@
 msgid "Extract"
 msgstr "??????????"
 
-#: UI/GTK2/src/statisticsDialog.cc:65
+#: UI/GTK2/src/statisticsDialog.cc:69
 #, fuzzy
 msgid "Indexes"
 msgstr "?????????????"
 
-#: UI/GTK2/src/statisticsDialog.cc:78 UI/GTK2/src/statisticsDialog.cc:92
+#: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/statisticsDialog.cc:97
 #, fuzzy
 msgid "documents"
 msgstr "??? ?????????"
 
-#: UI/GTK2/src/statisticsDialog.cc:97
-msgid "Crawler"
+#: UI/GTK2/src/statisticsDialog.cc:102
+#, fuzzy
+msgid "History"
+msgstr "???????? ??????????"
+
+#: UI/GTK2/src/statisticsDialog.cc:109
+#, fuzzy
+msgid "Viewed"
+msgstr "???"
+
+#: UI/GTK2/src/statisticsDialog.cc:109
+#, fuzzy
+msgid "results"
+msgstr "_?????????"
+
+#: UI/GTK2/src/statisticsDialog.cc:113
+msgid "Daemon"
 msgstr ""
 
-#: UI/GTK2/src/statisticsDialog.cc:104
-msgid "crawled files"
+#: UI/GTK2/src/statisticsDialog.cc:131
+#, fuzzy
+msgid "Running under PID"
+msgstr "?????? ???????"
+
+#: UI/GTK2/src/statisticsDialog.cc:135
+msgid "Currently not running"
 msgstr ""
 
-#: UI/GTK2/src/statisticsDialog.cc:109
-msgid "files being crawled"
+#: UI/GTK2/src/statisticsDialog.cc:143
+msgid "Crawled"
 msgstr ""
 
-#: UI/GTK2/src/statisticsDialog.cc:113
+#: UI/GTK2/src/statisticsDialog.cc:143
+msgid "files"
+msgstr ""
+
+#: UI/GTK2/src/statisticsDialog.cc:166
 msgid "Errors"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:320
+#: UI/GTK2/src/WorkerThreads.cpp:321
 msgid "Can't index mail here"
 msgstr "?????? ????????????? ????? ?????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:341
+#: UI/GTK2/src/WorkerThreads.cpp:342
 msgid "is already being indexed"
 msgstr "??? ??????????????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:351
+#: UI/GTK2/src/WorkerThreads.cpp:352
 msgid "is blacklisted"
 msgstr "??????????? ? ?????? ??????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:359 UI/GTK2/src/WorkerThreads.cpp:683
-#: UI/GTK2/src/WorkerThreads.cpp:960 UI/GTK2/src/WorkerThreads.cpp:969
-#: UI/GTK2/src/WorkerThreads.cpp:1138 UI/GTK2/src/WorkerThreads.cpp:1397
-#: UI/GTK2/src/WorkerThreads.cpp:1530
+#: UI/GTK2/src/WorkerThreads.cpp:663 UI/GTK2/src/WorkerThreads.cpp:936
+#: UI/GTK2/src/WorkerThreads.cpp:1022 UI/GTK2/src/WorkerThreads.cpp:1031
+#: UI/GTK2/src/WorkerThreads.cpp:1203 UI/GTK2/src/WorkerThreads.cpp:1463
+#: UI/GTK2/src/WorkerThreads.cpp:1596
 msgid "Index error on"
 msgstr "?????? ??????? ??"
 
-#: UI/GTK2/src/WorkerThreads.cpp:804 UI/GTK2/src/WorkerThreads.cpp:904
+#: UI/GTK2/src/WorkerThreads.cpp:784 UI/GTK2/src/WorkerThreads.cpp:957
 msgid "Couldn't create search engine"
 msgstr "?? ??????? ??????? ????????? ???????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:816 UI/GTK2/src/WorkerThreads.cpp:918
+#: UI/GTK2/src/WorkerThreads.cpp:796 UI/GTK2/src/WorkerThreads.cpp:971
 msgid "Couldn't run query on search engine"
 msgstr "?? ??????? ????????? ?????? ? ????????? ???????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:832
+#: UI/GTK2/src/WorkerThreads.cpp:830
 msgid "No title"
 msgstr "??? ????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1048
+#: UI/GTK2/src/WorkerThreads.cpp:1125
 msgid "Couldn't obtain downloader for protocol"
 msgstr "?? ??????? ???????? ????????? ??? ?????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1059
+#: UI/GTK2/src/WorkerThreads.cpp:1136
 msgid "Couldn't retrieve"
 msgstr "?? ??????? ???????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1160 UI/GTK2/src/WorkerThreads.cpp:1232
+#: UI/GTK2/src/WorkerThreads.cpp:1233 UI/GTK2/src/WorkerThreads.cpp:1309
 msgid "Cannot index document type"
 msgstr "?????????? ????????????? ?????? ??? ??????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1164 UI/GTK2/src/WorkerThreads.cpp:1236
+#: UI/GTK2/src/WorkerThreads.cpp:1237 UI/GTK2/src/WorkerThreads.cpp:1313
 msgid "at"
 msgstr "?"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1258
-msgid "Couldn't tokenize"
-msgstr "?????????? ????????"
-
-#: UI/GTK2/src/WorkerThreads.cpp:1278
+#: UI/GTK2/src/WorkerThreads.cpp:1344
 msgid "Robots META tag forbids indexing"
 msgstr "META-???? ??????? ????????? ??????????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1327
+#: UI/GTK2/src/WorkerThreads.cpp:1395
 msgid "Couldn't index"
 msgstr "?????????? ????????? ??????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1408
+#: UI/GTK2/src/WorkerThreads.cpp:1474
 msgid "Couldn't unindex document(s)"
 msgstr "?????????? ??????????????? ????????(?)"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1542
+#: UI/GTK2/src/WorkerThreads.cpp:1608
 msgid "Couldn't update document"
 msgstr "?????????? ???????? ????????"

Modified: trunk/po/sv.po
===================================================================
--- trunk/po/sv.po	2007-02-17 10:13:25 UTC (rev 719)
+++ trunk/po/sv.po	2007-02-17 10:27:53 UTC (rev 720)
@@ -6,10 +6,10 @@
 #, fuzzy
 msgid ""
 msgstr ""
-"Project-Id-Version: pinot 0.65\n"
+"Project-Id-Version: pinot 0.70\n"
 "Report-Msgid-Bugs-To: \n"
 "POT-Creation-Date: 2006-12-03 16:44+0000\n"
-"PO-Revision-Date: 2006-12-20 21:10+0800\n"
+"PO-Revision-Date: 2007-02-17 17:34+0800\n"
 "Last-Translator: Daniel Nylander <po at danielnylander.se>\n"
 "Language-Team: Swedish <sv at li.org>\n"
 "MIME-Version: 1.0\n"
@@ -25,76 +25,98 @@
 msgid "Current User"
 msgstr "Aktuell anv?ndare"
 
-#: UI/GTK2/src/EnginesTree.cpp:339 UI/GTK2/src/mainWindow.cc:322
-#: UI/GTK2/src/mainWindow.cc:325 UI/GTK2/src/mainWindow.cc:551
-#: UI/GTK2/src/mainWindow.cc:1205 UI/GTK2/src/mainWindow.cc:1248
-#: UI/GTK2/src/mainWindow.cc:1268 UI/GTK2/src/mainWindow.cc:1299
-#: UI/GTK2/src/mainWindow.cc:1869 UI/GTK2/src/PinotSettings.cpp:240
-#: UI/GTK2/src/PinotSettings.cpp:1230 UI/GTK2/src/PinotSettings.cpp:1286
+#: UI/GTK2/src/EnginesTree.cpp:339 UI/GTK2/src/mainWindow.cc:325
+#: UI/GTK2/src/mainWindow.cc:328 UI/GTK2/src/mainWindow.cc:541
+#: UI/GTK2/src/mainWindow.cc:1186 UI/GTK2/src/mainWindow.cc:1229
+#: UI/GTK2/src/mainWindow.cc:1249 UI/GTK2/src/mainWindow.cc:1280
+#: UI/GTK2/src/mainWindow.cc:1859 UI/GTK2/src/PinotSettings.cpp:241
+#: UI/GTK2/src/PinotSettings.cpp:1281 UI/GTK2/src/PinotSettings.cpp:1337
+#: UI/GTK2/src/statisticsDialog.cc:88 UI/GTK2/src/WorkerThreads.cpp:859
 msgid "My Web Pages"
 msgstr "Mina webbsidor"
 
-#: UI/GTK2/src/EnginesTree.cpp:340 UI/GTK2/src/mainWindow.cc:316
-#: UI/GTK2/src/mainWindow.cc:319 UI/GTK2/src/PinotSettings.cpp:241
-#: UI/GTK2/src/PinotSettings.cpp:1231 UI/GTK2/src/PinotSettings.cpp:1287
+#: UI/GTK2/src/EnginesTree.cpp:340 UI/GTK2/src/mainWindow.cc:319
+#: UI/GTK2/src/mainWindow.cc:322 UI/GTK2/src/PinotSettings.cpp:242
+#: UI/GTK2/src/PinotSettings.cpp:1282 UI/GTK2/src/PinotSettings.cpp:1338
+#: UI/GTK2/src/statisticsDialog.cc:74 UI/GTK2/src/WorkerThreads.cpp:867
 msgid "My Documents"
 msgstr "Mina dokument"
 
-#: UI/GTK2/src/importDialog.cc:83 UI/GTK2/src/queryDialog.cc:81
-msgid "None"
-msgstr "Ingen"
+#: UI/GTK2/src/dateDialog_glade.cc:76 UI/GTK2/src/queryDialog_glade.cc:91
+#: UI/GTK2/src/queryDialog_glade.cc:92
+#, fuzzy
+msgid "Date"
+msgstr "p?"
 
-#: UI/GTK2/src/importDialog_glade.cc:67 UI/GTK2/src/indexDialog_glade.cc:68
-msgid "Location:"
-msgstr "Plats:"
+#: UI/GTK2/src/indexDialog.cc:130
+msgid "Served by"
+msgstr ""
 
-#: UI/GTK2/src/importDialog_glade.cc:68
-#: UI/GTK2/src/propertiesDialog_glade.cc:65
-msgid "Title:"
-msgstr "Titel:"
+#: UI/GTK2/src/indexDialog.cc:134
+#, fuzzy
+msgid "Local"
+msgstr "Plats"
 
-#: UI/GTK2/src/importDialog_glade.cc:71
-msgid "Apply label:"
-msgstr "L?gg p? etikett:"
-
-#: UI/GTK2/src/importDialog_glade.cc:77
-msgid "Import"
-msgstr "Importera"
-
-#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:213
-msgid "Import URL"
-msgstr "Importera url"
-
-#: UI/GTK2/src/indexDialog.cc:225
+#: UI/GTK2/src/indexDialog.cc:300
 msgid "Index location"
 msgstr "Indexplats"
 
-#: UI/GTK2/src/indexDialog_glade.cc:62 UI/GTK2/src/queryDialog_glade.cc:68
+#: UI/GTK2/src/indexDialog_glade.cc:65 UI/GTK2/src/queryDialog_glade.cc:68
 msgid "Name:"
 msgstr "Namn:"
 
-#: UI/GTK2/src/indexDialog_glade.cc:64
+#: UI/GTK2/src/indexDialog_glade.cc:67
 msgid "..."
 msgstr "..."
 
-#: UI/GTK2/src/indexDialog_glade.cc:67
+#: UI/GTK2/src/indexDialog_glade.cc:70
 msgid "Type:"
 msgstr "Typ:"
 
-#: UI/GTK2/src/indexDialog_glade.cc:69
+#: UI/GTK2/src/indexDialog_glade.cc:71 UI/GTK2/src/importDialog_glade.cc:67
+msgid "Location:"
+msgstr "Plats:"
+
+#: UI/GTK2/src/indexDialog_glade.cc:72
 msgid "Port:"
 msgstr "Port:"
 
-#: UI/GTK2/src/indexDialog_glade.cc:143
+#: UI/GTK2/src/indexDialog_glade.cc:79
+#, fuzzy
+msgid "Host name:"
+msgstr "V?rdnamn"
+
+#: UI/GTK2/src/indexDialog_glade.cc:163
 msgid "External index"
 msgstr "Externt index"
 
-#: UI/GTK2/src/IndexTree.cpp:68 UI/GTK2/src/queryDialog.cc:112
+#: UI/GTK2/src/importDialog.cc:82 UI/GTK2/src/queryDialog.cc:108
+msgid "None"
+msgstr "Ingen"
+
+#: UI/GTK2/src/importDialog_glade.cc:68
+#: UI/GTK2/src/propertiesDialog_glade.cc:67
+msgid "Title:"
+msgstr "Titel:"
+
+#: UI/GTK2/src/importDialog_glade.cc:71
+msgid "Apply label:"
+msgstr "L?gg p? etikett:"
+
+#: UI/GTK2/src/importDialog_glade.cc:77
+msgid "Import"
+msgstr "Importera"
+
+#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:221
+msgid "Import URL"
+msgstr "Importera url"
+
+#: UI/GTK2/src/IndexTree.cpp:68 UI/GTK2/src/queryDialog.cc:139
 #: UI/GTK2/src/ResultsTree.cpp:126
 msgid "Title"
 msgstr "Titel"
 
-#: UI/GTK2/src/IndexTree.cpp:73 UI/GTK2/src/queryDialog.cc:115
+#: UI/GTK2/src/IndexTree.cpp:73 UI/GTK2/src/queryDialog.cc:142
 #: UI/GTK2/src/ResultsTree.cpp:136
 msgid "URL"
 msgstr "Url"
@@ -115,379 +137,401 @@
 msgid "All labels"
 msgstr "Alla etiketter"
 
-#: UI/GTK2/src/mainWindow.cc:138
+#: UI/GTK2/src/launcherDialog_glade.cc:64
+msgid ""
+"There is no helper application defined for this document's type.\n"
+"Please enter the command to open this document."
+msgstr ""
+
+#: UI/GTK2/src/launcherDialog_glade.cc:67
+msgid "Use this command for other documents of the same type."
+msgstr ""
+
+#: UI/GTK2/src/launcherDialog_glade.cc:99
+msgid "Helper application"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:141
 msgid "Query Name"
 msgstr "Fr?genamn"
 
-#: UI/GTK2/src/mainWindow.cc:143
+#: UI/GTK2/src/mainWindow.cc:146
 msgid "Last Run"
 msgstr "Senaste k?rning"
 
-#: UI/GTK2/src/mainWindow.cc:148
+#: UI/GTK2/src/mainWindow.cc:151
 msgid "Summary"
 msgstr "Sammandrag"
 
-#: UI/GTK2/src/mainWindow.cc:181
+#: UI/GTK2/src/mainWindow.cc:184
 msgid "Show all search engines"
 msgstr "Visa alla s?kmotorer"
 
-#: UI/GTK2/src/mainWindow.cc:182
+#: UI/GTK2/src/mainWindow.cc:185
 msgid "Add index"
 msgstr "L?gg till index"
 
-#: UI/GTK2/src/mainWindow.cc:183
+#: UI/GTK2/src/mainWindow.cc:186
 msgid "Remove index"
 msgstr "Ta bort index"
 
-#: UI/GTK2/src/mainWindow.cc:189
+#: UI/GTK2/src/mainWindow.cc:192
 msgid "Ready"
 msgstr "Redo"
 
-#: UI/GTK2/src/mainWindow.cc:240
+#: UI/GTK2/src/mainWindow.cc:243
 msgid "N/A"
 msgstr "-"
 
-#: UI/GTK2/src/mainWindow.cc:255
-msgid "<undefined>"
+#: UI/GTK2/src/mainWindow.cc:258
+#, fuzzy
+msgid "Undefined"
 msgstr "<odefinierad>"
 
-#: UI/GTK2/src/mainWindow.cc:474
+#: UI/GTK2/src/mainWindow.cc:476
 msgid "Result location is"
 msgstr "Resultatplatsen ?r"
 
-#: UI/GTK2/src/mainWindow.cc:561
+#: UI/GTK2/src/mainWindow.cc:551
 msgid "Document location is"
 msgstr "Dokumentplatsen ?r"
 
-#: UI/GTK2/src/mainWindow.cc:884
+#: UI/GTK2/src/mainWindow.cc:877
 msgid "Showing"
 msgstr "Visar"
 
-#: UI/GTK2/src/mainWindow.cc:889
+#: UI/GTK2/src/mainWindow.cc:882
 msgid "of"
 msgstr "av"
 
-#: UI/GTK2/src/mainWindow.cc:894
+#: UI/GTK2/src/mainWindow.cc:887
 msgid "documents, starting at"
 msgstr "dokument, b?rjar med"
 
-#: UI/GTK2/src/mainWindow.cc:927
+#: UI/GTK2/src/mainWindow.cc:920
 msgid "Query"
 msgstr "Fr?ga"
 
-#: UI/GTK2/src/mainWindow.cc:931 UI/GTK2/src/mainWindow.cc:2937
+#: UI/GTK2/src/mainWindow.cc:924 UI/GTK2/src/mainWindow.cc:2922
 msgid "on"
 msgstr "p?"
 
-#: UI/GTK2/src/mainWindow.cc:935
+#: UI/GTK2/src/mainWindow.cc:928
 msgid "ended"
 msgstr "slutade"
 
-#: UI/GTK2/src/mainWindow.cc:1070
+#: UI/GTK2/src/mainWindow.cc:1051
 msgid "More Like"
 msgstr "Kanske mer som"
 
-#: UI/GTK2/src/mainWindow.cc:1131
+#: UI/GTK2/src/mainWindow.cc:1112
 msgid "Updated label(s)"
 msgstr "Uppdaterade etikett(er)"
 
-#: UI/GTK2/src/mainWindow.cc:1215
+#: UI/GTK2/src/mainWindow.cc:1196
 msgid "Updated document"
 msgstr "Uppdaterade dokument"
 
-#: UI/GTK2/src/mainWindow.cc:1228
+#: UI/GTK2/src/mainWindow.cc:1209
 msgid "Indexed"
 msgstr "Indexerade"
 
-#: UI/GTK2/src/mainWindow.cc:1269
+#: UI/GTK2/src/mainWindow.cc:1250
 msgid "Unindexed document(s)"
 msgstr "Ej indexerade dokument"
 
-#: UI/GTK2/src/mainWindow.cc:1310
+#: UI/GTK2/src/mainWindow.cc:1291
 msgid "Updated document properties"
 msgstr "Egenskaper f?r uppdaterade dokument"
 
-#: UI/GTK2/src/mainWindow.cc:1357
+#: UI/GTK2/src/mainWindow.cc:1338
 msgid "Couldn't rename index, name"
 msgstr "Kunde inte byta namn p? index, namn"
 
-#: UI/GTK2/src/mainWindow.cc:1361 UI/GTK2/src/mainWindow.cc:2261
-#: UI/GTK2/src/mainWindow.cc:2772
+#: UI/GTK2/src/mainWindow.cc:1342 UI/GTK2/src/mainWindow.cc:2246
+#: UI/GTK2/src/mainWindow.cc:2757
 msgid "is already in use"
 msgstr "anv?nds redan"
 
-#: UI/GTK2/src/mainWindow.cc:1374
+#: UI/GTK2/src/mainWindow.cc:1355
 msgid "Couldn't rename index"
 msgstr "Kunde inte byta namn p? index"
 
-#: UI/GTK2/src/mainWindow.cc:1387
+#: UI/GTK2/src/mainWindow.cc:1368
 msgid "Edited index"
 msgstr "Redigerade index"
 
-#: UI/GTK2/src/mainWindow.cc:1747 UI/GTK2/src/mainWindow.cc:2431
+#: UI/GTK2/src/mainWindow.cc:1753 UI/GTK2/src/mainWindow.cc:2416
 msgid "Live query"
 msgstr "Levande fr?ga"
 
-#: UI/GTK2/src/mainWindow.cc:1773
+#: UI/GTK2/src/mainWindow.cc:1779
 msgid "Couldn't find query"
 msgstr "Kunde inte hitta fr?ga"
 
-#: UI/GTK2/src/mainWindow.cc:1817 UI/GTK2/src/mainWindow.cc:1913
-msgid "Please set a location for the index first"
-msgstr "St?ll in en plats f?r indexet f?rst"
-
-#: UI/GTK2/src/mainWindow.cc:1992 UI/GTK2/src/WorkerThreads.cpp:671
-#: UI/GTK2/src/WorkerThreads.cpp:1518
+#: UI/GTK2/src/mainWindow.cc:1975 UI/GTK2/src/WorkerThreads.cpp:650
+#: UI/GTK2/src/WorkerThreads.cpp:1583
 msgid "Index"
 msgstr "Index"
 
-#: UI/GTK2/src/mainWindow.cc:1996 UI/GTK2/src/WorkerThreads.cpp:675
-#: UI/GTK2/src/WorkerThreads.cpp:1522
+#: UI/GTK2/src/mainWindow.cc:1979 UI/GTK2/src/WorkerThreads.cpp:654
+#: UI/GTK2/src/WorkerThreads.cpp:1587
 msgid "doesn't exist"
 msgstr "finns inte"
 
-#: UI/GTK2/src/mainWindow.cc:2149
+#: UI/GTK2/src/mainWindow.cc:2133
 msgid "Remove this document from the index ?"
 msgstr "Ta bort detta dokument fr?n indexet?"
 
-#: UI/GTK2/src/mainWindow.cc:2168
+#: UI/GTK2/src/mainWindow.cc:2152
 msgid "Remove these documents from the index ?"
 msgstr "Ta bort dessa dokument fr?n indexet?"
 
-#: UI/GTK2/src/mainWindow.cc:2212
+#: UI/GTK2/src/mainWindow.cc:2196
 msgid "A metasearch tool for the Free Desktop"
 msgstr "Ett metas?kningsverktyg f?r Free Desktop"
 
-#: UI/GTK2/src/mainWindow.cc:2213
-msgid "(C) 2005-2006 Fabrice Colin"
+#: UI/GTK2/src/mainWindow.cc:2197
+msgid "Search the Web and your documents !"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:2198
+#, fuzzy
+msgid "(C) 2005 Fabrice Colin"
 msgstr "? 2005-2006 Fabrice Colin"
 
-#: UI/GTK2/src/mainWindow.cc:2257
+#: UI/GTK2/src/mainWindow.cc:2242
 msgid "Index name"
 msgstr "Indexnamn"
 
-#: UI/GTK2/src/mainWindow.cc:2272
+#: UI/GTK2/src/mainWindow.cc:2257
 msgid "Couldn't add index"
 msgstr "Kunde inte l?gga till index"
 
-#: UI/GTK2/src/mainWindow.cc:2286
+#: UI/GTK2/src/mainWindow.cc:2271
 msgid "Added new index"
 msgstr "Lade till nytt index"
 
-#: UI/GTK2/src/mainWindow.cc:2321
+#: UI/GTK2/src/mainWindow.cc:2306
 msgid "Couldn't remove index"
 msgstr "Kunde inte ta bort index"
 
-#: UI/GTK2/src/mainWindow.cc:2586
+#: UI/GTK2/src/mainWindow.cc:2571
 msgid "At least one task hasn't completed yet. Quit now ?"
 msgstr "?tminstone en uppgift har inte f?rdigst?llts ?n. Avsluta nu?"
 
-#: UI/GTK2/src/mainWindow.cc:2768
+#: UI/GTK2/src/mainWindow.cc:2753
 msgid "Query name"
 msgstr "Fr?genamn"
 
-#: UI/GTK2/src/mainWindow.cc:2795
+#: UI/GTK2/src/mainWindow.cc:2780
 msgid "Couldn't update query"
 msgstr "Kunde inte uppdatera fr?ga"
 
-#: UI/GTK2/src/mainWindow.cc:2803
+#: UI/GTK2/src/mainWindow.cc:2788
 msgid "Edited query"
 msgstr "Redigerade fr?ga"
 
-#: UI/GTK2/src/mainWindow.cc:2810
+#: UI/GTK2/src/mainWindow.cc:2795
 msgid "Couldn't add query"
 msgstr "Kunde inte l?gga till fr?ga"
 
-#: UI/GTK2/src/mainWindow.cc:2818
+#: UI/GTK2/src/mainWindow.cc:2803
 msgid "Added new query"
 msgstr "Lade till ny fr?ga"
 
-#: UI/GTK2/src/mainWindow.cc:2831
+#: UI/GTK2/src/mainWindow.cc:2816
 msgid "Query is not set"
 msgstr "Fr?gan ?r inte inst?lld"
 
-#: UI/GTK2/src/mainWindow.cc:2842
+#: UI/GTK2/src/mainWindow.cc:2827
 msgid "No search engine selected"
 msgstr "Ingen s?kmotor vald"
 
-#: UI/GTK2/src/mainWindow.cc:2924
+#: UI/GTK2/src/mainWindow.cc:2909
 msgid "Please set the Google API key first"
 msgstr "St?ll in Google API-nyckeln f?rst"
 
-#: UI/GTK2/src/mainWindow.cc:2933
+#: UI/GTK2/src/mainWindow.cc:2918
 msgid "Running query"
 msgstr "K?r fr?ga"
 
-#: UI/GTK2/src/mainWindow.cc:3105
+#: UI/GTK2/src/mainWindow.cc:3102
 msgid "No default application defined for type"
 msgstr "Inget standardprogram definierat f?r typen"
 
-#: UI/GTK2/src/mainWindow_glade.cc:124
+#: UI/GTK2/src/mainWindow_glade.cc:126
 msgid "Query:"
 msgstr "Fr?ga:"
 
-#: UI/GTK2/src/mainWindow_glade.cc:136
+#: UI/GTK2/src/mainWindow_glade.cc:138
 msgid "Edit"
 msgstr "Redigera"
 
-#: UI/GTK2/src/mainWindow_glade.cc:145
+#: UI/GTK2/src/mainWindow_glade.cc:147
 msgid "Stored queries"
 msgstr "Lagrade fr?gor"
 
-#: UI/GTK2/src/mainWindow_glade.cc:180
+#: UI/GTK2/src/mainWindow_glade.cc:161 UI/GTK2/src/statisticsDialog.cc:46
+#: UI/GTK2/src/statisticsDialog_glade.cc:87
+msgid "Status"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow_glade.cc:188
 msgid "Search Engine"
 msgstr "S?kmotor"
 
-#: UI/GTK2/src/mainWindow_glade.cc:183
+#: UI/GTK2/src/mainWindow_glade.cc:191
 msgid "Host Name"
 msgstr "V?rdnamn"
 
-#: UI/GTK2/src/mainWindow_glade.cc:186
+#: UI/GTK2/src/mainWindow_glade.cc:194
 msgid "Show Extract"
 msgstr "Visa utdrag"
 
-#: UI/GTK2/src/mainWindow_glade.cc:189
+#: UI/GTK2/src/mainWindow_glade.cc:197
 msgid "Group By"
 msgstr "Gruppera efter"
 
-#: UI/GTK2/src/mainWindow_glade.cc:192
+#: UI/GTK2/src/mainWindow_glade.cc:200
 msgid "Clear List"
 msgstr "T?m lista"
 
-#: UI/GTK2/src/mainWindow_glade.cc:198
+#: UI/GTK2/src/mainWindow_glade.cc:206
 msgid "Vie_w"
 msgstr "Vi_sa"
 
-#: UI/GTK2/src/mainWindow_glade.cc:201
+#: UI/GTK2/src/mainWindow_glade.cc:209
 msgid "View Cache"
 msgstr "Visa cache"
 
-#: UI/GTK2/src/mainWindow_glade.cc:204
+#: UI/GTK2/src/mainWindow_glade.cc:212
 msgid "More Like This"
 msgstr "Mer som det h?r"
 
-#: UI/GTK2/src/mainWindow_glade.cc:207 UI/GTK2/src/mainWindow_glade.cc:243
+#: UI/GTK2/src/mainWindow_glade.cc:215 UI/GTK2/src/mainWindow_glade.cc:251
 msgid "_Index"
 msgstr "_Index"
 
-#: UI/GTK2/src/mainWindow_glade.cc:210
+#: UI/GTK2/src/mainWindow_glade.cc:218
 msgid "List Contents Of"
 msgstr "Lista inneh?ll f?r"
 
-#: UI/GTK2/src/mainWindow_glade.cc:219
+#: UI/GTK2/src/mainWindow_glade.cc:227
 msgid "View"
 msgstr "Visa"
 
-#: UI/GTK2/src/mainWindow_glade.cc:222
+#: UI/GTK2/src/mainWindow_glade.cc:230
 msgid "Update"
 msgstr "Uppdatera"
 
-#: UI/GTK2/src/mainWindow_glade.cc:225
+#: UI/GTK2/src/mainWindow_glade.cc:233
 msgid "Unindex"
 msgstr "Avindexera"
 
-#: UI/GTK2/src/mainWindow_glade.cc:228
-#: UI/GTK2/src/propertiesDialog_glade.cc:146
+#: UI/GTK2/src/mainWindow_glade.cc:236
+#: UI/GTK2/src/propertiesDialog_glade.cc:177
 msgid "Properties"
 msgstr "Egenskaper"
 
-#: UI/GTK2/src/mainWindow_glade.cc:231
+#: UI/GTK2/src/mainWindow_glade.cc:239
 msgid "_About"
 msgstr "_Om"
 
-#: UI/GTK2/src/mainWindow_glade.cc:234
+#: UI/GTK2/src/mainWindow_glade.cc:242
 msgid "_Session"
 msgstr "_Session"
 
-#: UI/GTK2/src/mainWindow_glade.cc:237
+#: UI/GTK2/src/mainWindow_glade.cc:245
 msgid "_Edit"
 msgstr "R_edigera"
 
-#: UI/GTK2/src/mainWindow_glade.cc:240
+#: UI/GTK2/src/mainWindow_glade.cc:248
 msgid "_Results"
 msgstr "_Resultat"
 
-#: UI/GTK2/src/mainWindow_glade.cc:246
+#: UI/GTK2/src/mainWindow_glade.cc:254
 msgid "_Help"
 msgstr "_Hj?lp"
 
-#: UI/GTK2/src/mainWindow_glade.cc:383
+#: UI/GTK2/src/mainWindow_glade.cc:391
 msgid "Pinot"
 msgstr "Pinot"
 
-#: UI/GTK2/src/pinot.cc:204 UI/GTK2/src/pinot-dbus-daemon.cc:273
+#: UI/GTK2/src/pinot.cc:203 UI/GTK2/src/pinot-dbus-daemon.cc:284
+#: UI/GTK2/src/propertiesDialog.cc:65 UI/GTK2/src/propertiesDialog.cc:74
 msgid "Unknown"
 msgstr "Ok?nd"
 
-#: UI/GTK2/src/pinot.cc:205 UI/GTK2/src/pinot-dbus-daemon.cc:274
+#: UI/GTK2/src/pinot.cc:204 UI/GTK2/src/pinot-dbus-daemon.cc:285
 msgid "Danish"
 msgstr "Danska"
 
-#: UI/GTK2/src/pinot.cc:206 UI/GTK2/src/pinot-dbus-daemon.cc:275
+#: UI/GTK2/src/pinot.cc:205 UI/GTK2/src/pinot-dbus-daemon.cc:286
 msgid "Dutch"
 msgstr "Nederl?ndska"
 
-#: UI/GTK2/src/pinot.cc:207 UI/GTK2/src/pinot-dbus-daemon.cc:276
+#: UI/GTK2/src/pinot.cc:206 UI/GTK2/src/pinot-dbus-daemon.cc:287
 msgid "English"
 msgstr "Engelska"
 
-#: UI/GTK2/src/pinot.cc:208 UI/GTK2/src/pinot-dbus-daemon.cc:277
+#: UI/GTK2/src/pinot.cc:207 UI/GTK2/src/pinot-dbus-daemon.cc:288
 msgid "Finnish"
 msgstr "Finska"
 
-#: UI/GTK2/src/pinot.cc:209 UI/GTK2/src/pinot-dbus-daemon.cc:278
+#: UI/GTK2/src/pinot.cc:208 UI/GTK2/src/pinot-dbus-daemon.cc:289
 msgid "French"
 msgstr "Franska"
 
-#: UI/GTK2/src/pinot.cc:210 UI/GTK2/src/pinot-dbus-daemon.cc:279
+#: UI/GTK2/src/pinot.cc:209 UI/GTK2/src/pinot-dbus-daemon.cc:290
 msgid "German"
 msgstr "Tyska"
 
-#: UI/GTK2/src/pinot.cc:211 UI/GTK2/src/pinot-dbus-daemon.cc:280
+#: UI/GTK2/src/pinot.cc:210 UI/GTK2/src/pinot-dbus-daemon.cc:291
 msgid "Italian"
 msgstr "Italienska"
 
-#: UI/GTK2/src/pinot.cc:212 UI/GTK2/src/pinot-dbus-daemon.cc:281
+#: UI/GTK2/src/pinot.cc:211 UI/GTK2/src/pinot-dbus-daemon.cc:292
 msgid "Norwegian"
 msgstr "Norska"
 
-#: UI/GTK2/src/pinot.cc:213 UI/GTK2/src/pinot-dbus-daemon.cc:282
+#: UI/GTK2/src/pinot.cc:212 UI/GTK2/src/pinot-dbus-daemon.cc:293
 msgid "Portuguese"
 msgstr "Portugisiska"
 
-#: UI/GTK2/src/pinot.cc:214 UI/GTK2/src/pinot-dbus-daemon.cc:283
+#: UI/GTK2/src/pinot.cc:213 UI/GTK2/src/pinot-dbus-daemon.cc:294
 msgid "Russian"
 msgstr "Ryska"
 
-#: UI/GTK2/src/pinot.cc:215 UI/GTK2/src/pinot-dbus-daemon.cc:284
+#: UI/GTK2/src/pinot.cc:214 UI/GTK2/src/pinot-dbus-daemon.cc:295
 msgid "Spanish"
 msgstr "Spanska"
 
-#: UI/GTK2/src/pinot.cc:216 UI/GTK2/src/pinot-dbus-daemon.cc:285
+#: UI/GTK2/src/pinot.cc:215 UI/GTK2/src/pinot-dbus-daemon.cc:296
 msgid "Swedish"
 msgstr "Svenska"
 
-#: UI/GTK2/src/pinot.cc:240
+#: UI/GTK2/src/pinot.cc:239
 msgid "Couldn't open index"
 msgstr "Kunde inte ?ppna index"
 
-#: UI/GTK2/src/pinot.cc:256
+#: UI/GTK2/src/pinot.cc:255
 msgid "Couldn't create history database"
 msgstr "Kunde inte skapa historikdatabas"
 
-#: UI/GTK2/src/PinotSettings.cpp:246
+#: UI/GTK2/src/PinotSettings.cpp:247
 msgid "Important"
 msgstr "Viktigt"
 
-#: UI/GTK2/src/PinotSettings.cpp:247
+#: UI/GTK2/src/PinotSettings.cpp:248
 msgid "New"
 msgstr "Ny"
 
-#: UI/GTK2/src/PinotSettings.cpp:248
+#: UI/GTK2/src/PinotSettings.cpp:249
 msgid "Personal"
 msgstr "Personlig"
 
-#: UI/GTK2/src/PinotSettings.cpp:1055
+#: UI/GTK2/src/PinotSettings.cpp:1085
 msgid "Unclassified"
 msgstr "Oklassificerad"
 
@@ -507,15 +551,15 @@
 msgid "Pattern"
 msgstr "M?nster"
 
-#: UI/GTK2/src/prefsDialog.cc:426
+#: UI/GTK2/src/prefsDialog.cc:423
 msgid "New Label"
 msgstr "Ny etikett"
 
-#: UI/GTK2/src/prefsDialog.cc:467
+#: UI/GTK2/src/prefsDialog.cc:464
 msgid "Directory to index"
 msgstr "Katalog f?r index"
 
-#: UI/GTK2/src/prefsDialog.cc:525
+#: UI/GTK2/src/prefsDialog.cc:522
 msgid "Mbox File Location"
 msgstr "Plats f?r mbox-fil"
 
@@ -586,46 +630,62 @@
 msgid "Preferences"
 msgstr "Inst?llningar"
 
-#: UI/GTK2/src/propertiesDialog.cc:51 UI/GTK2/src/queryDialog.cc:127
+#: UI/GTK2/src/propertiesDialog.cc:52 UI/GTK2/src/queryDialog.cc:154
 msgid "Label"
 msgstr "Etikett"
 
-#: UI/GTK2/src/propertiesDialog.cc:64
+#: UI/GTK2/src/propertiesDialog.cc:86
 msgid "Per document"
 msgstr "Per dokument"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:66
+#: UI/GTK2/src/propertiesDialog_glade.cc:68
 msgid "Language:"
 msgstr "Spr?k:"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:67
+#: UI/GTK2/src/propertiesDialog_glade.cc:69
 msgid "MIME type:"
 msgstr "MIME-typ:"
 
-#: UI/GTK2/src/queryDialog.cc:103
+#: UI/GTK2/src/propertiesDialog_glade.cc:70
+msgid "Size:"
+msgstr ""
+
+#: UI/GTK2/src/propertiesDialog_glade.cc:73
+msgid "Terms:"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog.cc:130
 msgid "Host name"
 msgstr "V?rdnamn"
 
-#: UI/GTK2/src/queryDialog.cc:106
+#: UI/GTK2/src/queryDialog.cc:133
 msgid "File name"
 msgstr "Filnamn"
 
-#: UI/GTK2/src/queryDialog.cc:109
+#: UI/GTK2/src/queryDialog.cc:136
 msgid "File extension"
 msgstr "Fil?ndelse"
 
-#: UI/GTK2/src/queryDialog.cc:118
+#: UI/GTK2/src/queryDialog.cc:145
 msgid "Directory"
 msgstr "Katalog"
 
-#: UI/GTK2/src/queryDialog.cc:121
+#: UI/GTK2/src/queryDialog.cc:148
 msgid "Language code"
 msgstr "Spr?kkod"
 
-#: UI/GTK2/src/queryDialog.cc:124
+#: UI/GTK2/src/queryDialog.cc:151
 msgid "MIME type"
 msgstr "MIME-typ"
 
+#: UI/GTK2/src/queryDialog.cc:271
+msgid "Start date"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog.cc:286
+msgid "End date"
+msgstr ""
+
 #: UI/GTK2/src/queryDialog_glade.cc:72
 msgid "New filter:"
 msgstr "Nytt filter:"
@@ -635,14 +695,23 @@
 msgstr "Fr?getext"
 
 #: UI/GTK2/src/queryDialog_glade.cc:83
-msgid "Index all results with label"
+#, fuzzy
+msgid "Index results with label"
 msgstr "Indexera alla resultat med etiketten"
 
 #: UI/GTK2/src/queryDialog_glade.cc:86
 msgid "Number of results:"
 msgstr "Antal resultat:"
 
-#: UI/GTK2/src/queryDialog_glade.cc:182
+#: UI/GTK2/src/queryDialog_glade.cc:89
+msgid "Start date:"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog_glade.cc:90
+msgid "End date:"
+msgstr ""
+
+#: UI/GTK2/src/queryDialog_glade.cc:201
 msgid "Query parameters"
 msgstr "Fr?geparametrar"
 
@@ -654,6 +723,56 @@
 msgid "Extract"
 msgstr "Utdrag"
 
+#: UI/GTK2/src/statisticsDialog.cc:69
+#, fuzzy
+msgid "Indexes"
+msgstr "Indexerade"
+
+#: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/statisticsDialog.cc:97
+#, fuzzy
+msgid "documents"
+msgstr "Mina dokument"
+
+#: UI/GTK2/src/statisticsDialog.cc:102
+#, fuzzy
+msgid "History"
+msgstr "Katalog"
+
+#: UI/GTK2/src/statisticsDialog.cc:109
+#, fuzzy
+msgid "Viewed"
+msgstr "Visa"
+
+#: UI/GTK2/src/statisticsDialog.cc:109
+#, fuzzy
+msgid "results"
+msgstr "_Resultat"
+
+#: UI/GTK2/src/statisticsDialog.cc:113
+msgid "Daemon"
+msgstr ""
+
+#: UI/GTK2/src/statisticsDialog.cc:131
+#, fuzzy
+msgid "Running under PID"
+msgstr "K?r fr?ga"
+
+#: UI/GTK2/src/statisticsDialog.cc:135
+msgid "Currently not running"
+msgstr ""
+
+#: UI/GTK2/src/statisticsDialog.cc:143
+msgid "Crawled"
+msgstr ""
+
+#: UI/GTK2/src/statisticsDialog.cc:143
+msgid "files"
+msgstr ""
+
+#: UI/GTK2/src/statisticsDialog.cc:166
+msgid "Errors"
+msgstr ""
+
 #: UI/GTK2/src/WorkerThreads.cpp:321
 msgid "Can't index mail here"
 msgstr "Kan inte indexera post h?r"
@@ -666,57 +785,53 @@
 msgid "is blacklisted"
 msgstr "?r svartlistad"
 
-#: UI/GTK2/src/WorkerThreads.cpp:360 UI/GTK2/src/WorkerThreads.cpp:684
-#: UI/GTK2/src/WorkerThreads.cpp:961 UI/GTK2/src/WorkerThreads.cpp:970
-#: UI/GTK2/src/WorkerThreads.cpp:1139 UI/GTK2/src/WorkerThreads.cpp:1398
-#: UI/GTK2/src/WorkerThreads.cpp:1531
+#: UI/GTK2/src/WorkerThreads.cpp:663 UI/GTK2/src/WorkerThreads.cpp:936
+#: UI/GTK2/src/WorkerThreads.cpp:1022 UI/GTK2/src/WorkerThreads.cpp:1031
+#: UI/GTK2/src/WorkerThreads.cpp:1203 UI/GTK2/src/WorkerThreads.cpp:1463
+#: UI/GTK2/src/WorkerThreads.cpp:1596
 msgid "Index error on"
 msgstr "Indexfel p?"
 
-#: UI/GTK2/src/WorkerThreads.cpp:805 UI/GTK2/src/WorkerThreads.cpp:905
+#: UI/GTK2/src/WorkerThreads.cpp:784 UI/GTK2/src/WorkerThreads.cpp:957
 msgid "Couldn't create search engine"
 msgstr "Kunde inte skapa s?kmotor"
 
-#: UI/GTK2/src/WorkerThreads.cpp:817 UI/GTK2/src/WorkerThreads.cpp:919
+#: UI/GTK2/src/WorkerThreads.cpp:796 UI/GTK2/src/WorkerThreads.cpp:971
 msgid "Couldn't run query on search engine"
 msgstr "Kunde inte k?ra fr?ga p? s?kmotor"
 
-#: UI/GTK2/src/WorkerThreads.cpp:833
+#: UI/GTK2/src/WorkerThreads.cpp:830
 msgid "No title"
 msgstr "Ingen titel"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1049
+#: UI/GTK2/src/WorkerThreads.cpp:1125
 msgid "Couldn't obtain downloader for protocol"
 msgstr "Kunde inte f? protokollh?mtare"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1060
+#: UI/GTK2/src/WorkerThreads.cpp:1136
 msgid "Couldn't retrieve"
 msgstr "Kunde inte h?mta"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1161 UI/GTK2/src/WorkerThreads.cpp:1233
+#: UI/GTK2/src/WorkerThreads.cpp:1233 UI/GTK2/src/WorkerThreads.cpp:1309
 msgid "Cannot index document type"
 msgstr "Kan inte indexera dokumenttyp"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1165 UI/GTK2/src/WorkerThreads.cpp:1237
+#: UI/GTK2/src/WorkerThreads.cpp:1237 UI/GTK2/src/WorkerThreads.cpp:1313
 msgid "at"
 msgstr "p?"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1259
-msgid "Couldn't tokenize"
-msgstr "Kunde inte g?ra token"
-
-#: UI/GTK2/src/WorkerThreads.cpp:1279
+#: UI/GTK2/src/WorkerThreads.cpp:1344
 msgid "Robots META tag forbids indexing"
 msgstr "Robots META-tagg f?rbjuder indexering"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1328
+#: UI/GTK2/src/WorkerThreads.cpp:1395
 msgid "Couldn't index"
 msgstr "Kunde inte indexera"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1409
+#: UI/GTK2/src/WorkerThreads.cpp:1474
 msgid "Couldn't unindex document(s)"
 msgstr "Kunde inte avindexera dokument"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1543
+#: UI/GTK2/src/WorkerThreads.cpp:1608
 msgid "Couldn't update document"
 msgstr "Kunde inte uppdatera dokument"



From fabricecolin at mail.berlios.de  Sat Feb 17 13:58:59 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 17 Feb 2007 13:58:59 +0100
Subject: [Pinot-svn] r721 - trunk/Search
Message-ID: <200702171258.l1HCwxpg024347@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-17 13:58:58 +0100 (Sat, 17 Feb 2007)
New Revision: 721

Modified:
   trunk/Search/XapianEngine.cpp
Log:
Method queryDatabase() handles exceptions more gracefully.


Modified: trunk/Search/XapianEngine.cpp
===================================================================
--- trunk/Search/XapianEngine.cpp	2007-02-17 10:27:53 UTC (rev 720)
+++ trunk/Search/XapianEngine.cpp	2007-02-17 12:58:58 UTC (rev 721)
@@ -288,131 +288,139 @@
 
 bool XapianEngine::queryDatabase(Xapian::Database *pIndex, Xapian::Query &query)
 {
-	bool bStatus = false;
+	if (pIndex == NULL)
+	{
+		return false;
+	}
 
-	if (pIndex != NULL)
+	// Start an enquire session on the database
+	Xapian::Enquire enquire(*pIndex);
+
+	try
 	{
-		try
+		// Give the query object to the enquire session
+		enquire.set_query(query);
+
+		// Get the top results of the query
+		Xapian::MSet matches = enquire.get_mset(0, m_maxResultsCount);
+		if (matches.empty() == false)
 		{
-			// Start an enquire session on the database
-			Xapian::Enquire enquire(*pIndex);
+			multimap<Xapian::weight, string> queryTerms;
+			vector<string> seedTerms;
+			Xapian::weight maxWeight = matches.get_max_attained();
 
-			// Give the query object to the enquire session
-			enquire.set_query(query);
-
-			// Get the top results of the query
-			Xapian::MSet matches = enquire.get_mset(0, m_maxResultsCount);
-			if (matches.empty() == false)
+			// Sort query terms by weight
+			for (Xapian::TermIterator termIter = query.get_terms_begin();
+				termIter != query.get_terms_end(); ++termIter)
 			{
-				multimap<Xapian::weight, string> queryTerms;
-				vector<string> seedTerms;
-				Xapian::weight maxWeight = matches.get_max_attained();
+				string termName(*termIter);
+				Xapian::weight termWeight = matches.get_termweight(termName);
 
-				// Sort query terms by weight
-				for (Xapian::TermIterator termIter = query.get_terms_begin();
-					termIter != query.get_terms_end(); ++termIter)
+				if (termWeight > 0)
 				{
-					string termName(*termIter);
-					Xapian::weight termWeight = matches.get_termweight(termName);
-
-					if (termWeight > 0)
-					{
-						queryTerms.insert(pair<Xapian::weight, string>(maxWeight - termWeight, termName));
+					queryTerms.insert(pair<Xapian::weight, string>(maxWeight - termWeight, termName));
 #ifdef DEBUG
-						cout << "XapianEngine::queryDatabase: term " << termName
-							<< " has weight " << termWeight << "/" << maxWeight << endl;
+					cout << "XapianEngine::queryDatabase: term " << termName
+						<< " has weight " << termWeight << "/" << maxWeight << endl;
 #endif
-					}
 				}
+			}
 
-				for (multimap<Xapian::weight, string>::iterator weightIter = queryTerms.begin();
-					weightIter != queryTerms.end(); ++weightIter)
-				{
-					seedTerms.push_back(weightIter->second);
-				}
+			for (multimap<Xapian::weight, string>::iterator weightIter = queryTerms.begin();
+				weightIter != queryTerms.end(); ++weightIter)
+			{
+				seedTerms.push_back(weightIter->second);
+			}
 
-				// Get the results
+			// Get the results
 #ifdef DEBUG
-				cout << "XapianEngine::queryDatabase: " << matches.get_matches_estimated() << "/" << m_maxResultsCount << " results found" << endl;
+			cout << "XapianEngine::queryDatabase: " << matches.get_matches_estimated() << "/" << m_maxResultsCount << " results found" << endl;
 #endif
-				for (Xapian::MSetIterator mIter = matches.begin(); mIter != matches.end(); ++mIter)
-				{
-					Xapian::docid docId = *mIter;
-					Xapian::Document doc(mIter.get_document());
-					AbstractGenerator abstractGen(pIndex, 50);
-					string record = doc.get_data();
+			for (Xapian::MSetIterator mIter = matches.begin(); mIter != matches.end(); ++mIter)
+			{
+				Xapian::docid docId = *mIter;
+				Xapian::Document doc(mIter.get_document());
+				AbstractGenerator abstractGen(pIndex, 50);
+				string record = doc.get_data();
 
-					// Get the title
-					string title = StringManip::extractField(record, "caption=", "\n");
 #ifdef DEBUG
-					cout << "XapianEngine::queryDatabase: found omindex title " << title << endl;
+				cout << "XapianEngine::queryDatabase: found document ID " << docId << endl;
 #endif
-					// Get the URL
-					string url = StringManip::extractField(record, "url=", "\n");
-					if (url.empty() == true)
-					{
-						// Hmmm this shouldn't be empty...
-						// Use this instead, even though the document isn't cached in the index
-						url = XapianDatabase::buildUrl(m_databaseName, *mIter);
-					}
-					else
-					{
-#ifdef DEBUG
-						cout << "XapianEngine::queryDatabase: found omindex URL " << url << endl;
-#endif
-						url = Url::canonicalizeUrl(url);
-					}
+				// Get the title
+				string title = StringManip::extractField(record, "caption=", "\n");
+				// Get the URL
+				string url = StringManip::extractField(record, "url=", "\n");
+				if (url.empty() == true)
+				{
+					// Hmmm this shouldn't be empty...
+					// Use this instead, even though the document isn't cached in the index
+					url = XapianDatabase::buildUrl(m_databaseName, *mIter);
+				}
+				else
+				{
+					url = Url::canonicalizeUrl(url);
+				}
 
-					// Get the type
-					string type = StringManip::extractField(record, "type=", "\n");
-					// ...and the language, if available
-					string language = StringManip::extractField(record, "language=", "\n");
+				// Get the type
+				string type = StringManip::extractField(record, "type=", "\n");
+				// ...and the language, if available
+				string language = StringManip::extractField(record, "language=", "\n");
 
-					// Generate an abstract based on the query's terms
-					string summary = abstractGen.generateAbstract(docId, seedTerms);
+				// Generate an abstract based on the query's terms
+				string summary = abstractGen.generateAbstract(docId, seedTerms);
 
-					// Add this result
-					Result thisResult(url, title, summary, language, (float)mIter.get_percent());
-					m_resultsList.push_back(thisResult);
-				}
+				// Add this result
+				Result thisResult(url, title, summary, language, (float)mIter.get_percent());
+				m_resultsList.push_back(thisResult);
 			}
+		}
+	}
+	catch (const Xapian::Error &error)
+	{
+		cerr << "XapianEngine::queryDatabase: " << error.get_type() << ": " << error.get_msg() << endl;
+	}
 
-			m_expandTerms.clear();
+	try
+	{
+		m_expandTerms.clear();
 
-			// Expand the query ?
-			if (m_relevantDocuments.empty() == false)
+		// Expand the query ?
+		if (m_relevantDocuments.empty() == false)
+		{
+			Xapian::RSet relevantDocs;
+			unsigned int count = 0;
+
+			for (set<unsigned int>::const_iterator docIter = m_relevantDocuments.begin();
+				docIter != m_relevantDocuments.end(); ++docIter)
 			{
-				Xapian::RSet relevantDocs;
-				unsigned int count = 0;
+				relevantDocs.add_document(*docIter);
+			}
 
-				for (set<unsigned int>::const_iterator docIter = m_relevantDocuments.begin();
-					docIter != m_relevantDocuments.end(); ++docIter)
+			// Get 10 non-prefixed terms
+			Xapian::ESet expandTerms = enquire.get_eset(20, relevantDocs);
+			for (Xapian::ESetIterator termIter = expandTerms.begin();
+				(termIter != expandTerms.end()) && (count < 10); ++termIter)
+			{
+				if (isupper((int)((*termIter)[0])) == 0)
 				{
-					relevantDocs.add_document(*docIter);
+					m_expandTerms.insert(*termIter);
+					++count;
 				}
-
-				// Get 10 non-prefixed terms
-				Xapian::ESet expandTerms = enquire.get_eset(20, relevantDocs);
-				for (Xapian::ESetIterator termIter = expandTerms.begin();
-					(termIter != expandTerms.end()) && (count < 10); ++termIter)
-				{
-					if (isupper((int)((*termIter)[0])) == 0)
-					{
-						m_expandTerms.insert(*termIter);
-						++count;
-					}
-				}
 			}
-
-			bStatus = true;
 		}
-		catch (const Xapian::Error &error)
-		{
-			cerr << "XapianEngine::queryDatabase: " << error.get_type() << ": " << error.get_msg() << endl;
-		}
 	}
+	catch (const Xapian::Error &error)
+	{
+		cerr << "XapianEngine::queryDatabase: " << error.get_type() << ": " << error.get_msg() << endl;
+	}
 
-	return bStatus;
+	// Be tolerant of errors as long as we got some results
+	if (m_resultsList.empty() == false)
+	{
+		return true;
+	}
+
+	return false;
 }
 
 //



From fabricecolin at mail.berlios.de  Sat Feb 17 14:00:48 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 17 Feb 2007 14:00:48 +0100
Subject: [Pinot-svn] r722 - in trunk/UI/GTK2: . src
Message-ID: <200702171300.l1HD0mbA024538@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-17 14:00:43 +0100 (Sat, 17 Feb 2007)
New Revision: 722

Modified:
   trunk/UI/GTK2/metase-gtk2.glade
   trunk/UI/GTK2/src/mainWindow_glade.cc
   trunk/UI/GTK2/src/mainWindow_glade.hh
Log:
Moved Preferences menuitem back to Session, with Status.


Modified: trunk/UI/GTK2/metase-gtk2.glade
===================================================================
--- trunk/UI/GTK2/metase-gtk2.glade	2007-02-17 12:58:58 UTC (rev 721)
+++ trunk/UI/GTK2/metase-gtk2.glade	2007-02-17 13:00:43 UTC (rev 722)
@@ -46,6 +46,16 @@
 		<widget class="GtkMenu" id="sessionMenuitem_menu">
 
 		  <child>
+		    <widget class="GtkImageMenuItem" id="configure1">
+		      <property agent="glademm" name="cxx_visibility">protected</property>
+		      <property name="visible">True</property>
+		      <property name="label">gtk-preferences</property>
+		      <property name="use_stock">True</property>
+		      <signal name="activate" handler="on_configure_activate" last_modification_time="Fri, 20 Feb 2004 18:58:55 GMT"/>
+		    </widget>
+		  </child>
+
+		  <child>
 		    <widget class="GtkMenuItem" id="statistics1">
 		      <property name="visible">True</property>
 		      <property name="label" translatable="yes">Status</property>
@@ -124,22 +134,6 @@
 		      <signal name="activate" handler="on_delete_activate" last_modification_time="Mon, 12 Apr 2004 09:32:03 GMT"/>
 		    </widget>
 		  </child>
-
-		  <child>
-		    <widget class="GtkSeparatorMenuItem" id="separator4">
-		      <property name="visible">True</property>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkImageMenuItem" id="configure1">
-		      <property agent="glademm" name="cxx_visibility">protected</property>
-		      <property name="visible">True</property>
-		      <property name="label">gtk-preferences</property>
-		      <property name="use_stock">True</property>
-		      <signal name="activate" handler="on_configure_activate" last_modification_time="Fri, 20 Feb 2004 18:58:55 GMT"/>
-		    </widget>
-		  </child>
 		</widget>
 	      </child>
 	    </widget>
@@ -193,7 +187,7 @@
 			      <property name="visible">True</property>
 			      <property name="label" translatable="yes">Host Name</property>
 			      <property name="use_underline">True</property>
-			      <property name="active">False</property>
+			      <property name="active">True</property>
 			      <property name="group">searchenginegroup1</property>
 			    </widget>
 			  </child>
@@ -211,7 +205,7 @@
 		      <signal name="activate" handler="on_clearresults_activate" last_modification_time="Wed, 03 Mar 2004 19:51:48 GMT"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image659">
+			<widget class="GtkImage" id="image669">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-clear</property>
 			  <property name="icon_size">1</property>
@@ -258,7 +252,7 @@
 		      <signal name="activate" handler="on_morelikethis_activate" last_modification_time="Sun, 18 Jun 2006 10:50:56 GMT"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image660">
+			<widget class="GtkImage" id="image670">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-find</property>
 			  <property name="icon_size">1</property>
@@ -313,7 +307,7 @@
 		      <signal name="activate" handler="on_import_activate" last_modification_time="Tue, 02 Mar 2004 22:13:44 GMT"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image661">
+			<widget class="GtkImage" id="image671">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-open</property>
 			  <property name="icon_size">1</property>
@@ -351,7 +345,7 @@
 		      <signal name="activate" handler="on_refreshindex_activate" last_modification_time="Fri, 20 Feb 2004 18:57:09 GMT"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image662">
+			<widget class="GtkImage" id="image672">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-refresh</property>
 			  <property name="icon_size">1</property>
@@ -373,7 +367,7 @@
 		      <signal name="activate" handler="on_unindex_activate" last_modification_time="Thu, 28 Jul 2005 12:42:23 GMT"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image663">
+			<widget class="GtkImage" id="image673">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-delete</property>
 			  <property name="icon_size">1</property>
@@ -395,7 +389,7 @@
 		      <signal name="activate" handler="on_showfromindex_activate" last_modification_time="Sun, 06 Nov 2005 08:43:05 GMT"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image664">
+			<widget class="GtkImage" id="image674">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-properties</property>
 			  <property name="icon_size">1</property>

Modified: trunk/UI/GTK2/src/mainWindow_glade.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow_glade.cc	2007-02-17 12:58:58 UTC (rev 721)
+++ trunk/UI/GTK2/src/mainWindow_glade.cc	2007-02-17 13:00:43 UTC (rev 722)
@@ -1,9 +1,9 @@
-// generated 2007/1/1 9:58:40 SGT by fabrice at thorgrim.dyndns.org.(none)
+// generated 2007/2/17 18:49:42 SGT by fabrice at amra.dyndns.org.(none)
 // using glademm V2.12.1
 //
 // DO NOT EDIT THIS FILE ! It was created using
 // glade-- /home/fabrice/Projects/MetaSE/pinot/UI/GTK2/metase-gtk2.glade
-// for gtk 2.10.4 and gtkmm 2.10.5
+// for gtk 2.10.8 and gtkmm 2.10.7
 //
 // Please modify the corresponding derived classes in ./src/mainWindow.cc
 
@@ -37,8 +37,8 @@
 #include "mainWindow_glade.hh"
 #include <gdk/gdkkeysyms.h>
 #include <gtkmm/accelgroup.h>
-#include <gtkmm/menuitem.h>
 #include <gtk/gtkimagemenuitem.h>
+#include <gtkmm/menuitem.h>
 #include <gtkmm/menu.h>
 #include <gtkmm/image.h>
 #include <gtkmm/menubar.h>
@@ -62,6 +62,7 @@
 ) : Gtk::Window(Gtk::WINDOW_TOPLEVEL)
 {  mainWindow = this;
    gmm_data = new GlademmData(get_accel_group());
+   configure1 = NULL;
    
    Gtk::MenuItem *statistics1 = NULL;
    separatormenuitem1 = NULL;
@@ -72,8 +73,6 @@
    copy1 = NULL;
    paste1 = NULL;
    delete1 = NULL;
-   Gtk::MenuItem *separator4 = NULL;
-   configure1 = NULL;
    Gtk::Menu *editMenuitem_menu = Gtk::manage(new class Gtk::Menu());
    editMenuitem = NULL;
    showextract1 = NULL;
@@ -82,26 +81,26 @@
    hostnamegroup1 = NULL;
    Gtk::Menu *groupresults1_menu = Gtk::manage(new class Gtk::Menu());
    groupresults1 = NULL;
-   Gtk::Image *image659 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-clear"), Gtk::IconSize(1)));
+   Gtk::Image *image669 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-clear"), Gtk::IconSize(1)));
    clearresults1 = NULL;
    Gtk::MenuItem *separator1 = NULL;
    viewresults1 = NULL;
    viewcache1 = NULL;
-   Gtk::Image *image660 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-find"), Gtk::IconSize(1)));
+   Gtk::Image *image670 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-find"), Gtk::IconSize(1)));
    morelikethis1 = NULL;
    indexresults1 = NULL;
    Gtk::Menu *resultsMenuitem_menu = Gtk::manage(new class Gtk::Menu());
    resultsMenuitem = NULL;
    list1 = NULL;
-   Gtk::Image *image661 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-open"), Gtk::IconSize(1)));
+   Gtk::Image *image671 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-open"), Gtk::IconSize(1)));
    import1 = NULL;
    Gtk::MenuItem *separator3 = NULL;
    viewfromindex1 = NULL;
-   Gtk::Image *image662 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-refresh"), Gtk::IconSize(1)));
+   Gtk::Image *image672 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-refresh"), Gtk::IconSize(1)));
    refreshindex1 = NULL;
-   Gtk::Image *image663 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-delete"), Gtk::IconSize(1)));
+   Gtk::Image *image673 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-delete"), Gtk::IconSize(1)));
    unindex1 = NULL;
-   Gtk::Image *image664 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-properties"), Gtk::IconSize(1)));
+   Gtk::Image *image674 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-properties"), Gtk::IconSize(1)));
    showfromindex1 = NULL;
    Gtk::Menu *indexMenuitem_menu = Gtk::manage(new class Gtk::Menu());
    indexMenuitem = NULL;
@@ -158,6 +157,9 @@
    Gtk::HBox *mainHbox = Gtk::manage(new class Gtk::HBox(false, 0));
    Gtk::VBox *mainVbox = Gtk::manage(new class Gtk::VBox(false, 0));
    
+   sessionMenuitem_menu->items().push_back(Gtk::Menu_Helpers::StockMenuElem(Gtk::StockID("gtk-preferences")));
+   configure1 = (Gtk::ImageMenuItem *)&sessionMenuitem_menu->items().back();
+   
    sessionMenuitem_menu->items().push_back(Gtk::Menu_Helpers::MenuElem(_("Status")));
    statistics1 = (Gtk::MenuItem *)&sessionMenuitem_menu->items().back();
    
@@ -179,12 +181,6 @@
    editMenuitem_menu->items().push_back(Gtk::Menu_Helpers::StockMenuElem(Gtk::StockID("gtk-delete")));
    delete1 = (Gtk::ImageMenuItem *)&editMenuitem_menu->items().back();
    
-   editMenuitem_menu->items().push_back(Gtk::Menu_Helpers::SeparatorElem());
-   separator4 = (Gtk::MenuItem *)&editMenuitem_menu->items().back();
-   
-   editMenuitem_menu->items().push_back(Gtk::Menu_Helpers::StockMenuElem(Gtk::StockID("gtk-preferences")));
-   configure1 = (Gtk::ImageMenuItem *)&editMenuitem_menu->items().back();
-   
    groupresults1_menu->items().push_back(Gtk::Menu_Helpers::RadioMenuElem(_RadioMIGroup_searchenginegroup1, _("Search Engine")));
    searchenginegroup1 = (Gtk::RadioMenuItem *)&groupresults1_menu->items().back();
    
@@ -197,7 +193,7 @@
    resultsMenuitem_menu->items().push_back(Gtk::Menu_Helpers::MenuElem(_("Group By"), *groupresults1_menu));
    groupresults1 = (Gtk::MenuItem *)&resultsMenuitem_menu->items().back();
    
-   resultsMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("Clear List"), *image659));
+   resultsMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("Clear List"), *image669));
    clearresults1 = (Gtk::ImageMenuItem *)&resultsMenuitem_menu->items().back();
    
    resultsMenuitem_menu->items().push_back(Gtk::Menu_Helpers::SeparatorElem());
@@ -209,7 +205,7 @@
    resultsMenuitem_menu->items().push_back(Gtk::Menu_Helpers::MenuElem(_("View Cache")));
    viewcache1 = (Gtk::MenuItem *)&resultsMenuitem_menu->items().back();
    
-   resultsMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("More Like This"), *image660));
+   resultsMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("More Like This"), *image670));
    morelikethis1 = (Gtk::ImageMenuItem *)&resultsMenuitem_menu->items().back();
    
    resultsMenuitem_menu->items().push_back(Gtk::Menu_Helpers::MenuElem(_("_Index")));
@@ -218,7 +214,7 @@
    indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::MenuElem(_("List Contents Of")));
    list1 = (Gtk::MenuItem *)&indexMenuitem_menu->items().back();
    
-   indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("Import URL"), *image661));
+   indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("Import URL"), *image671));
    import1 = (Gtk::ImageMenuItem *)&indexMenuitem_menu->items().back();
    
    indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::SeparatorElem());
@@ -227,13 +223,13 @@
    indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::MenuElem(_("View")));
    viewfromindex1 = (Gtk::MenuItem *)&indexMenuitem_menu->items().back();
    
-   indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("Update"), *image662));
+   indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("Update"), *image672));
    refreshindex1 = (Gtk::ImageMenuItem *)&indexMenuitem_menu->items().back();
    
-   indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("Unindex"), *image663));
+   indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("Unindex"), *image673));
    unindex1 = (Gtk::ImageMenuItem *)&indexMenuitem_menu->items().back();
    
-   indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("Properties"), *image664));
+   indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("Properties"), *image674));
    showfromindex1 = (Gtk::ImageMenuItem *)&indexMenuitem_menu->items().back();
    
    helpMenuitem_menu->items().push_back(Gtk::Menu_Helpers::MenuElem(_("_About")));
@@ -256,18 +252,18 @@
    showextract1->set_active(true);
    searchenginegroup1->set_active(true);
    hostnamegroup1->set_active(false);
-   image659->set_alignment(0.5,0.5);
-   image659->set_padding(0,0);
-   image660->set_alignment(0.5,0.5);
-   image660->set_padding(0,0);
-   image661->set_alignment(0.5,0.5);
-   image661->set_padding(0,0);
-   image662->set_alignment(0.5,0.5);
-   image662->set_padding(0,0);
-   image663->set_alignment(0.5,0.5);
-   image663->set_padding(0,0);
-   image664->set_alignment(0.5,0.5);
-   image664->set_padding(0,0);
+   image669->set_alignment(0.5,0.5);
+   image669->set_padding(0,0);
+   image670->set_alignment(0.5,0.5);
+   image670->set_padding(0,0);
+   image671->set_alignment(0.5,0.5);
+   image671->set_padding(0,0);
+   image672->set_alignment(0.5,0.5);
+   image672->set_padding(0,0);
+   image673->set_alignment(0.5,0.5);
+   image673->set_padding(0,0);
+   image674->set_alignment(0.5,0.5);
+   image674->set_padding(0,0);
    image439->set_alignment(0.5,0.5);
    image439->set_padding(0,0);
    addIndexButton->set_flags(Gtk::CAN_FOCUS);
@@ -395,6 +391,7 @@
    mainWindow->set_resizable(true);
    mainWindow->property_destroy_with_parent().set_value(false);
    mainWindow->add(*mainVbox);
+   configure1->show();
    statistics1->show();
    separatormenuitem1->show();
    quit1->show();
@@ -403,32 +400,30 @@
    copy1->show();
    paste1->show();
    delete1->show();
-   separator4->show();
-   configure1->show();
    editMenuitem->show();
    showextract1->show();
    searchenginegroup1->show();
    hostnamegroup1->show();
    groupresults1->show();
-   image659->show();
+   image669->show();
    clearresults1->show();
    separator1->show();
    viewresults1->show();
    viewcache1->show();
-   image660->show();
+   image670->show();
    morelikethis1->show();
    indexresults1->show();
    resultsMenuitem->show();
    list1->show();
-   image661->show();
+   image671->show();
    import1->show();
    separator3->show();
    viewfromindex1->show();
-   image662->show();
+   image672->show();
    refreshindex1->show();
-   image663->show();
+   image673->show();
    unindex1->show();
-   image664->show();
+   image674->show();
    showfromindex1->show();
    indexMenuitem->show();
    about1->show();
@@ -467,13 +462,13 @@
    mainStatusbar->show();
    mainHbox->show();
    mainVbox->show();
+   configure1->signal_activate().connect(SigC::slot(*this, &mainWindow_glade::on_configure_activate), false);
    statistics1->signal_activate().connect(SigC::slot(*this, &mainWindow_glade::on_statistics_activate), false);
    quit1->signal_activate().connect(SigC::slot(*this, &mainWindow_glade::on_quit_activate), false);
    cut1->signal_activate().connect(SigC::slot(*this, &mainWindow_glade::on_cut_activate), false);
    copy1->signal_activate().connect(SigC::slot(*this, &mainWindow_glade::on_copy_activate), false);
    paste1->signal_activate().connect(SigC::slot(*this, &mainWindow_glade::on_paste_activate), false);
    delete1->signal_activate().connect(SigC::slot(*this, &mainWindow_glade::on_delete_activate), false);
-   configure1->signal_activate().connect(SigC::slot(*this, &mainWindow_glade::on_configure_activate), false);
    showextract1->signal_activate().connect(SigC::slot(*this, &mainWindow_glade::on_showextract_activate), false);
    searchenginegroup1->signal_activate().connect(SigC::slot(*this, &mainWindow_glade::on_groupresults_activate), false);
    clearresults1->signal_activate().connect(SigC::slot(*this, &mainWindow_glade::on_clearresults_activate), false);

Modified: trunk/UI/GTK2/src/mainWindow_glade.hh
===================================================================
--- trunk/UI/GTK2/src/mainWindow_glade.hh	2007-02-17 12:58:58 UTC (rev 721)
+++ trunk/UI/GTK2/src/mainWindow_glade.hh	2007-02-17 13:00:43 UTC (rev 722)
@@ -1,9 +1,9 @@
-// generated 2007/1/1 9:58:40 SGT by fabrice at thorgrim.dyndns.org.(none)
+// generated 2007/2/17 18:49:42 SGT by fabrice at amra.dyndns.org.(none)
 // using glademm V2.12.1
 //
 // DO NOT EDIT THIS FILE ! It was created using
 // glade-- /home/fabrice/Projects/MetaSE/pinot/UI/GTK2/metase-gtk2.glade
-// for gtk 2.10.4 and gtkmm 2.10.5
+// for gtk 2.10.8 and gtkmm 2.10.7
 //
 // Please modify the corresponding derived classes in ./src/mainWindow.hh and./src/mainWindow.cc
 
@@ -32,8 +32,8 @@
 #endif //GLADEMM_DATA
 
 #include <gtkmm/window.h>
+#include <gtkmm/imagemenuitem.h>
 #include <gtkmm/menuitem.h>
-#include <gtkmm/imagemenuitem.h>
 #include <gtkmm/checkmenuitem.h>
 #include <gtkmm/radiomenuitem.h>
 #include <gtkmm/box.h>
@@ -57,6 +57,7 @@
 public:
         class Gtk::Window * mainWindow;
 protected:
+        class Gtk::ImageMenuItem * configure1;
         class Gtk::MenuItem * separatormenuitem1;
         class Gtk::ImageMenuItem * quit1;
         class Gtk::MenuItem * sessionMenuitem;
@@ -64,7 +65,6 @@
         class Gtk::ImageMenuItem * copy1;
         class Gtk::ImageMenuItem * paste1;
         class Gtk::ImageMenuItem * delete1;
-        class Gtk::ImageMenuItem * configure1;
         class Gtk::MenuItem * editMenuitem;
         class Gtk::CheckMenuItem * showextract1;
         class Gtk::RadioMenuItem * searchenginegroup1;
@@ -111,13 +111,13 @@
         
         ~mainWindow_glade();
 private:
+        virtual void on_configure_activate() = 0;
         virtual void on_statistics_activate() = 0;
         virtual void on_quit_activate() = 0;
         virtual void on_cut_activate() = 0;
         virtual void on_copy_activate() = 0;
         virtual void on_paste_activate() = 0;
         virtual void on_delete_activate() = 0;
-        virtual void on_configure_activate() = 0;
         virtual void on_showextract_activate() = 0;
         virtual void on_groupresults_activate() = 0;
         virtual void on_clearresults_activate() = 0;



From fabricecolin at mail.berlios.de  Sun Feb 18 12:40:49 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sun, 18 Feb 2007 12:40:49 +0100
Subject: [Pinot-svn] r723 - trunk/UI/GTK2/src
Message-ID: <200702181140.l1IBenaR030800@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-18 12:40:47 +0100 (Sun, 18 Feb 2007)
New Revision: 723

Modified:
   trunk/UI/GTK2/src/WorkerThreads.cpp
   trunk/UI/GTK2/src/WorkerThreads.h
   trunk/UI/GTK2/src/mainWindow.cc
Log:
Let a thread start the daemon.
Give (slight) priority to internal engines when running a query.


Modified: trunk/UI/GTK2/src/WorkerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.cpp	2007-02-17 13:00:43 UTC (rev 722)
+++ trunk/UI/GTK2/src/WorkerThreads.cpp	2007-02-18 11:40:47 UTC (rev 723)
@@ -38,6 +38,7 @@
 #include "FilterFactory.h"
 #include "FilterUtils.h"
 #include "FilterWrapper.h"
+#include "DBusXapianIndex.h"
 #include "XapianDatabase.h"
 #include "ActionQueue.h"
 #include "QueryHistory.h"
@@ -973,7 +974,6 @@
 	if (pEngine->runQuery(m_queryProps) == false)
 	{
 		m_status = _("Couldn't run query on search engine");
-		m_status += " xapian";
 	}
 	else
 	{
@@ -1627,3 +1627,40 @@
 	}
 }
 
+StartDaemonThread::StartDaemonThread() :
+	WorkerThread()
+{
+}
+
+StartDaemonThread::~StartDaemonThread()
+{
+}
+
+string StartDaemonThread::getType(void) const
+{
+	return "StartDaemonThread";
+}
+
+bool StartDaemonThread::stop(void)
+{
+	m_done = true;
+	return true;
+}
+
+void StartDaemonThread::doWork(void)
+{
+	unsigned int crawledCount = 0, docsCount = 0;
+
+	if (m_done == false)
+        {
+		// ... and let D-Bus activate the service if necessary
+		// If it was already running, changes will take effect when it's restarted
+		DBusXapianIndex::getStatistics(crawledCount, docsCount);
+
+#ifdef DEBUG
+		cout << "StartDaemonThread::doWork: crawled " << crawledCount
+			<< ", indexed " << docsCount << endl;
+#endif
+	}
+}
+

Modified: trunk/UI/GTK2/src/WorkerThreads.h
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.h	2007-02-17 13:00:43 UTC (rev 722)
+++ trunk/UI/GTK2/src/WorkerThreads.h	2007-02-18 11:40:47 UTC (rev 723)
@@ -396,4 +396,24 @@
 
 };
 
+class StartDaemonThread : public WorkerThread
+{
+	public:
+		// Start the daemon
+		StartDaemonThread();
+		virtual ~StartDaemonThread();
+
+		virtual std::string getType(void) const;
+
+		virtual bool stop(void);
+
+	protected:
+		virtual void doWork(void);
+
+	private:
+		StartDaemonThread(const StartDaemonThread &other);
+		StartDaemonThread &operator=(const StartDaemonThread &other);
+
+};
+
 #endif // _WORKERTHREADS_HH

Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2007-02-17 13:00:43 UTC (rev 722)
+++ trunk/UI/GTK2/src/mainWindow.cc	2007-02-18 11:40:47 UTC (rev 723)
@@ -22,6 +22,7 @@
 #include <string>
 #include <iostream>
 #include <fstream>
+#include <list>
 #include <sigc++/class_slot.h>
 #include <glibmm/ustring.h>
 #include <glibmm/stringutils.h>
@@ -40,7 +41,6 @@
 #include "TimeConverter.h"
 #include "MIMEScanner.h"
 #include "Url.h"
-#include "DBusXapianIndex.h"
 #include "XapianDatabase.h"
 #include "QueryHistory.h"
 #include "ViewHistory.h"
@@ -1291,6 +1291,12 @@
 		status = _("Updated document properties");
 		set_status(status);
 	}
+	else if (type == "StartDaemonThread")
+	{
+#ifdef DEBUG
+		cout << "mainWindow::on_thread_end: started daemon" << endl;
+#endif
+	}
 
 	// Delete the thread
 	delete pThread;;
@@ -1422,16 +1428,7 @@
 	// Is starting the daemon necessary ?
 	if (prefsBox.startDaemon() == true)
 	{
-		unsigned int crawledCount = 0, docsCount = 0;
-
-		// ... and let D-Bus activate the service if necessary
-		// If it was already running, changes will take effect when it's restarted
-		// FIXME: put this in a thread
-		DBusXapianIndex::getStatistics(crawledCount, docsCount);
-#ifdef DEBUG
-		cout << "mainWindow::on_configure_activate: crawled " << crawledCount
-			<< ", indexed " << docsCount << endl;
-#endif
+		start_thread(new StartDaemonThread());
 	}
 
 	// Any labels to delete or rename ?
@@ -2829,7 +2826,7 @@
 	}
 
 	// Go through the tree and check selected nodes
-	vector<TreeModel::iterator> engineIters;
+	list<TreeModel::iterator> engineIters;
 	EnginesModelColumns &engineColumns = m_pEnginesTree->getColumnRecord();
 	for (list<TreeModel::Path>::iterator enginePath = selectedEngines.begin();
 		enginePath != selectedEngines.end(); ++enginePath)
@@ -2863,6 +2860,11 @@
 				engineIters.push_back(folderEngineIter);
 			}
 		}
+		else if (engineType == EnginesModelColumns::INTERNAL_INDEX_ENGINE)
+		{
+			// Push this at the beginning of the list
+			engineIters.push_front(engineIter);
+		}
 		else
 		{
 			engineIters.push_back(engineIter);
@@ -2875,7 +2877,7 @@
 
 	// Now go through the selected search engines
 	set<ustring> engineDisplayableNames;
-	for (vector<TreeModel::iterator>::iterator iter = engineIters.begin();
+	for (list<TreeModel::iterator>::iterator iter = engineIters.begin();
 		iter != engineIters.end(); ++iter)
 	{
 		TreeModel::Row engineRow = **iter;



From fabricecolin at mail.berlios.de  Mon Feb 19 15:15:19 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Mon, 19 Feb 2007 15:15:19 +0100
Subject: [Pinot-svn] r724 - trunk/Index
Message-ID: <200702191415.l1JEFJ3r010296@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-19 15:15:18 +0100 (Mon, 19 Feb 2007)
New Revision: 724

Modified:
   trunk/Index/XapianDatabase.cpp
   trunk/Index/XapianDatabase.h
   trunk/Index/XapianIndex.cpp
   trunk/Index/XapianIndex.h
Log:
Moved m_maxTermLength to XapianDatabase.


Modified: trunk/Index/XapianDatabase.cpp
===================================================================
--- trunk/Index/XapianDatabase.cpp	2007-02-18 11:40:47 UTC (rev 723)
+++ trunk/Index/XapianDatabase.cpp	2007-02-19 14:15:18 UTC (rev 724)
@@ -31,6 +31,9 @@
 using std::endl;
 using std::string;
 
+// This puts a limit to terms length.
+const unsigned int XapianDatabase::m_maxTermLength = 240;
+
 XapianDatabase::XapianDatabase(const string &databaseName, bool readOnly) :
 	m_databaseName(databaseName),
 	m_readOnly(readOnly),

Modified: trunk/Index/XapianDatabase.h
===================================================================
--- trunk/Index/XapianDatabase.h	2007-02-18 11:40:47 UTC (rev 723)
+++ trunk/Index/XapianDatabase.h	2007-02-19 14:15:18 UTC (rev 724)
@@ -29,6 +29,8 @@
 class XapianDatabase
 {
 	public:
+		static const unsigned int m_maxTermLength;
+
 		XapianDatabase(const std::string &databaseName, bool readOnly = true);
 		XapianDatabase(const std::string &databaseName,
 			XapianDatabase *pFirst, XapianDatabase *pSecond);

Modified: trunk/Index/XapianIndex.cpp
===================================================================
--- trunk/Index/XapianIndex.cpp	2007-02-18 11:40:47 UTC (rev 723)
+++ trunk/Index/XapianIndex.cpp	2007-02-19 14:15:18 UTC (rev 724)
@@ -50,8 +50,6 @@
 using std::min;
 using std::max;
 
-// This puts a limit to terms length.
-const unsigned int XapianIndex::m_maxTermLength = 240;
 const string XapianIndex::MAGIC_TERM = "X-MetaSE-Doc";
 
 static void removeFirstPosting(Xapian::Document &doc,
@@ -117,16 +115,16 @@
 
 string XapianIndex::limitTermLength(const string &term, bool makeUnique)
 {
-	if (term.length() > XapianIndex::m_maxTermLength)
+	if (term.length() > XapianDatabase::m_maxTermLength)
 	{
 		if (makeUnique == false)
 		{
 			// Truncate
-			return term.substr(0, XapianIndex::m_maxTermLength);
+			return term.substr(0, XapianDatabase::m_maxTermLength);
 		}
 		else
 		{
-			return StringManip::hashString(term, XapianIndex::m_maxTermLength);
+			return StringManip::hashString(term, XapianDatabase::m_maxTermLength);
 		}
 	}
 

Modified: trunk/Index/XapianIndex.h
===================================================================
--- trunk/Index/XapianIndex.h	2007-02-18 11:40:47 UTC (rev 723)
+++ trunk/Index/XapianIndex.h	2007-02-19 14:15:18 UTC (rev 724)
@@ -114,7 +114,6 @@
 		virtual bool flush(void);
 
 	protected:
-		static const unsigned int m_maxTermLength;
 		static const std::string MAGIC_TERM;
 		std::string m_databaseName;
 		bool m_goodIndex;



From fabricecolin at mail.berlios.de  Mon Feb 19 16:21:37 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Mon, 19 Feb 2007 16:21:37 +0100
Subject: [Pinot-svn] r725 - in trunk: Search UI/GTK2/src
Message-ID: <200702191521.l1JFLbmR016425@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-19 16:21:36 +0100 (Mon, 19 Feb 2007)
New Revision: 725

Modified:
   trunk/Search/XapianEngine.cpp
   trunk/UI/GTK2/src/WorkerThreads.cpp
Log:
XapianEngine sets the results' timestamp as well as document IDs, so that
QueryingThread can skip calling hasDocument() on internal indexes.


Modified: trunk/Search/XapianEngine.cpp
===================================================================
--- trunk/Search/XapianEngine.cpp	2007-02-19 14:15:18 UTC (rev 724)
+++ trunk/Search/XapianEngine.cpp	2007-02-19 15:21:36 UTC (rev 725)
@@ -238,10 +238,14 @@
 	string yyyymmddMax(TimeConverter::toYYYYMMDDString(maxDay, maxMonth, maxYear));
 	time_t startTime = TimeConverter::fromYYYYMMDDString(yyyymmddMin);
 	time_t endTime = TimeConverter::fromYYYYMMDDString(yyyymmddMax);
-  
+ 
 	double diffTime = difftime(endTime, startTime);
 	if (diffTime > 0)
 	{
+#ifdef DEBUG
+		cout << "XapianEngine::parseQuery: applied date range ("
+			<< yyyymmddMax << " <= " << yyyymmddMin << ")" << endl;
+#endif
 		return Xapian::Query(Xapian::Query::OP_FILTER, parsedQuery,
 			dateFilter(minDay, minMonth, minYear, maxDay, maxMonth, maxYear));
 	}
@@ -334,7 +338,8 @@
 
 			// Get the results
 #ifdef DEBUG
-			cout << "XapianEngine::queryDatabase: " << matches.get_matches_estimated() << "/" << m_maxResultsCount << " results found" << endl;
+			cout << "XapianEngine::queryDatabase: " << matches.get_matches_estimated()
+				<< "/" << m_maxResultsCount << " results found" << endl;
 #endif
 			for (Xapian::MSetIterator mIter = matches.begin(); mIter != matches.end(); ++mIter)
 			{
@@ -347,9 +352,9 @@
 				cout << "XapianEngine::queryDatabase: found document ID " << docId << endl;
 #endif
 				// Get the title
-				string title = StringManip::extractField(record, "caption=", "\n");
+				string title(StringManip::extractField(record, "caption=", "\n"));
 				// Get the URL
-				string url = StringManip::extractField(record, "url=", "\n");
+				string url(StringManip::extractField(record, "url=", "\n"));
 				if (url.empty() == true)
 				{
 					// Hmmm this shouldn't be empty...
@@ -362,15 +367,26 @@
 				}
 
 				// Get the type
-				string type = StringManip::extractField(record, "type=", "\n");
-				// ...and the language, if available
-				string language = StringManip::extractField(record, "language=", "\n");
+				string type(StringManip::extractField(record, "type=", "\n"));
+				// ... the language, if available
+				string language(StringManip::extractField(record, "language=", "\n"));
+				// ... and the timestamp
+				string timestamp, modTime(StringManip::extractField(record, "modtime=", "\n"));
+				if (modTime.empty() == false)
+				{
+					time_t timeT = (time_t )atol(modTime.c_str());
+					timestamp = TimeConverter::toTimestamp(timeT);
+				}
 
 				// Generate an abstract based on the query's terms
-				string summary = abstractGen.generateAbstract(docId, seedTerms);
+				string summary(abstractGen.generateAbstract(docId, seedTerms));
 
+				Result thisResult(url, title, summary, language, (float)mIter.get_percent());
+				thisResult.setTimestamp(timestamp);
+				// We don't know the index ID, just the document ID
+				thisResult.setIsIndexed(0, docId);
+
 				// Add this result
-				Result thisResult(url, title, summary, language, (float)mIter.get_percent());
 				m_resultsList.push_back(thisResult);
 			}
 		}

Modified: trunk/UI/GTK2/src/WorkerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.cpp	2007-02-19 14:15:18 UTC (rev 724)
+++ trunk/UI/GTK2/src/WorkerThreads.cpp	2007-02-19 15:21:36 UTC (rev 725)
@@ -800,44 +800,56 @@
 	}
 	else
 	{
+		IndexInterface *pDocsIndex = NULL;
+		IndexInterface *pDaemonIndex = NULL;
+		PinotSettings &settings = PinotSettings::getInstance();
 		const vector<Result> &resultsList = pEngine->getResults();
-		PinotSettings &settings = PinotSettings::getInstance();
+		unsigned int indexId = 0;
+		bool isIndexQuery = false;
 
 		m_resultsList.clear();
 		m_resultsList.reserve(resultsList.size());
 		m_resultsCharset = pEngine->getResultsCharset();
 
-		IndexInterface *pDocsIndex = settings.getIndex(settings.m_docsIndexLocation);
-		if ((pDocsIndex != NULL) &&
-			(pDocsIndex->isGood() == false))
+		// Are we querying an index ?
+		if (m_engineName == "xapian")
 		{
-			delete pDocsIndex;
-			pDocsIndex = NULL;
+			// Internal index ?
+			if (m_engineOption == settings.m_docsIndexLocation)
+			{
+				indexId = settings.getIndexId(_("My Web Pages"));
+				isIndexQuery = true;
+			}
+			else if (m_engineOption == settings.m_daemonIndexLocation)
+			{
+				indexId = settings.getIndexId(_("My Documents"));
+				isIndexQuery = true;
+			}
 		}
 
-		IndexInterface *pDaemonIndex = settings.getIndex(settings.m_daemonIndexLocation);
-		if ((pDaemonIndex != NULL) &&
-			(pDaemonIndex->isGood() == false))
+		// Will we have to query internal indices ?
+		if (isIndexQuery == false)
 		{
-			delete pDaemonIndex;
-			pDaemonIndex = NULL;
+			pDocsIndex = settings.getIndex(settings.m_docsIndexLocation);
+			pDaemonIndex = settings.getIndex(settings.m_daemonIndexLocation);
 		}
 
-
 		// Copy the results list
 		for (vector<Result>::const_iterator resultIter = resultsList.begin();
 			resultIter != resultsList.end(); ++resultIter)
 		{
+			Result current(*resultIter);
 			string title(_("No title"));
-			string location(resultIter->getLocation());
-			string language(resultIter->getLanguage());
-			unsigned int indexId = 0, docId = 0;
+			string location(current.getLocation());
+			string language(current.getLanguage());
+			unsigned int docId = 0;
 
 			// The title may contain formatting
-			if (resultIter->getTitle().empty() == false)
+			if (current.getTitle().empty() == false)
 			{
-				title = FilterUtils::stripMarkup(resultIter->getTitle());
+				title = FilterUtils::stripMarkup(current.getTitle());
 			}
+			current.setTitle(title);
 #ifdef DEBUG
 			cout << "QueryingThread::doWork: title is " << title << endl;
 #endif
@@ -847,12 +859,19 @@
 			{
 				language = m_queryProps.getLanguage();
 			}
+			current.setLanguage(language);
 
-			Result current(location, title, resultIter->getExtract(),
-				language, resultIter->getScore());
+			if (isIndexQuery == true)
+			{
+				unsigned int tmpId = 0;
 
+				// The index engine should have set this
+				docId = current.getIsIndexed(tmpId);
+			}
+
 			// Is this in one of the indexes ?
-			if (pDocsIndex != NULL)
+			if ((pDocsIndex != NULL) &&
+				(pDocsIndex->isGood() == true))
 			{
 				docId = pDocsIndex->hasDocument(location);
 				if (docId > 0)
@@ -861,6 +880,7 @@
 				}
 			}
 			if ((pDaemonIndex != NULL) &&
+				(pDaemonIndex->isGood() == true) &&
 				(docId == 0))
 			{
 				docId = pDaemonIndex->hasDocument(location);
@@ -869,6 +889,7 @@
 					indexId = settings.getIndexId(_("My Documents"));
 				}
 			}
+
 			if (docId > 0)
 			{
 				current.setIsIndexed(indexId, docId);



From fabricecolin at mail.berlios.de  Tue Feb 20 06:04:55 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 20 Feb 2007 06:04:55 +0100
Subject: [Pinot-svn] r726 - in trunk: Index Search
Message-ID: <200702200504.l1K54thV002904@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-20 06:04:52 +0100 (Tue, 20 Feb 2007)
New Revision: 726

Modified:
   trunk/Index/XapianDatabase.cpp
   trunk/Index/XapianDatabase.h
   trunk/Index/XapianIndex.cpp
   trunk/Index/XapianIndex.h
   trunk/Search/XapianEngine.cpp
Log:
Moved DocumentInfo <-> Xapian document data conversion to XapianDatabase.


Modified: trunk/Index/XapianDatabase.cpp
===================================================================
--- trunk/Index/XapianDatabase.cpp	2007-02-19 15:21:36 UTC (rev 725)
+++ trunk/Index/XapianDatabase.cpp	2007-02-20 05:04:52 UTC (rev 726)
@@ -20,9 +20,12 @@
 #include <sys/stat.h>
 #include <fcntl.h>
 #include <unistd.h>
+#include <regex.h>
 #include <stdio.h>
 #include <iostream>
 
+#include "StringManip.h"
+#include "TimeConverter.h"
 #include "Url.h"
 #include "XapianDatabase.h"
 
@@ -386,6 +389,112 @@
 	}
 }
 
+bool XapianDatabase::badRecordField(const string &field)
+{
+	regex_t fieldRegex;
+	regmatch_t pFieldMatches[1];
+	bool isBadField = false;
+
+	// A bad field is one that includes one of our field delimiters
+	if (regcomp(&fieldRegex,
+		"(url|sample|caption|type|timestamp|language)=",
+		REG_EXTENDED|REG_ICASE) == 0)
+	{
+		if (regexec(&fieldRegex, field.c_str(), 1,
+			pFieldMatches, REG_NOTBOL|REG_NOTEOL) == 0)
+		{
+			isBadField = true;
+		}
+	}
+	regfree(&fieldRegex);
+
+	return isBadField;
+}
+
+/// Returns a record for the document's properties.
+string XapianDatabase::propsToRecord(DocumentInfo *pDoc)
+{
+	if (pDoc == NULL)
+	{
+		return "";
+	}
+
+	string record("url=");
+	string title(pDoc->getTitle());
+	string timestamp(pDoc->getTimestamp());
+	time_t timeT = TimeConverter::fromTimestamp(timestamp);
+	char tmpStr[64];
+
+	// Set the document data omindex-style
+	record += pDoc->getLocation();
+	// The sample will be generated at query time
+	record += "\nsample=";
+	record += "\ncaption=";
+	if (badRecordField(title) == true)
+	{
+		// Modify the title if necessary
+		string::size_type pos = title.find("=");
+		while (pos != string::npos)
+		{
+			title[pos] = ' ';
+			pos = title.find("=", pos + 1);
+		}
+#ifdef DEBUG
+		cout << "XapianDatabase::propsToRecord: modified title" << endl;
+#endif
+	}
+	record += title;
+	record += "\ntype=";
+	record += pDoc->getType();
+	// Append a timestamp, in a format compatible with Omega
+	record += "\nmodtime=";
+	snprintf(tmpStr, 64, "%ld", timeT);
+	record += tmpStr;
+	// ...and the language
+	record += "\nlanguage=";
+	record += StringManip::toLowerCase(pDoc->getLanguage());
+	// ...and the file size
+	record += "\nsize=";
+	snprintf(tmpStr, 64, "%ld", pDoc->getSize());
+	record += tmpStr;
+#ifdef DEBUG
+	cout << "XapianDatabase::propsToRecord: document data is " << record << endl;
+#endif
+
+	return record;
+}
+
+/// Sets the document's properties acording to the record.
+void XapianDatabase::recordToProps(const string &record, DocumentInfo *pDoc)
+{
+	if (pDoc == NULL)
+	{
+		return;
+	}
+
+	// Get the title
+	pDoc->setTitle(StringManip::extractField(record, "caption=", "\n"));
+	// Get the URL
+	string url(StringManip::extractField(record, "url=", "\n"));
+	if (url.empty() == false)
+	{
+		url = Url::canonicalizeUrl(url);
+	}
+	pDoc->setLocation(url);
+	// Get the type
+	pDoc->setType(StringManip::extractField(record, "type=", "\n"));
+	// ... the language, if available
+	pDoc->setLanguage(StringManip::extractField(record, "language=", "\n"));
+	// ... and the timestamp
+	string timestamp, modTime(StringManip::extractField(record, "modtime=", "\n"));
+	if (modTime.empty() == false)
+	{
+		time_t timeT = (time_t )atol(modTime.c_str());
+		timestamp = TimeConverter::toTimestamp(timeT);
+	}
+	pDoc->setTimestamp(timestamp);
+}
+
 /// Returns the URL for the given document in the given index.
 string XapianDatabase::buildUrl(const string &database, unsigned int docId)
 {
@@ -399,3 +508,22 @@
 
 	return url;
 }
+
+/// Truncates or partially hashes a term.
+string XapianDatabase::limitTermLength(const string &term, bool makeUnique)
+{
+	if (term.length() > XapianDatabase::m_maxTermLength)
+	{
+		if (makeUnique == false)
+		{
+			// Truncate
+			return term.substr(0, XapianDatabase::m_maxTermLength);
+		}
+		else
+		{
+			return StringManip::hashString(term, XapianDatabase::m_maxTermLength);
+		}
+	}
+
+	return term;
+}

Modified: trunk/Index/XapianDatabase.h
===================================================================
--- trunk/Index/XapianDatabase.h	2007-02-19 15:21:36 UTC (rev 725)
+++ trunk/Index/XapianDatabase.h	2007-02-20 05:04:52 UTC (rev 726)
@@ -22,15 +22,14 @@
 #include <string>
 #include <set>
 #include <pthread.h>
-
 #include <xapian.h>
 
+#include "DocumentInfo.h"
+
 /// Lockable Xapian database.
 class XapianDatabase
 {
 	public:
-		static const unsigned int m_maxTermLength;
-
 		XapianDatabase(const std::string &databaseName, bool readOnly = true);
 		XapianDatabase(const std::string &databaseName,
 			XapianDatabase *pFirst, XapianDatabase *pSecond);
@@ -54,10 +53,20 @@
 		/// Unlocks the database.
 		void unlock(void);
 
+		/// Returns a record for the document's properties.
+		static std::string propsToRecord(DocumentInfo *pDoc);
+
+		/// Sets the document's properties acording to the record.
+		static void recordToProps(const std::string &record, DocumentInfo *pDoc);
+
 		/// Returns the URL for the given document in the given index.
 		static std::string buildUrl(const std::string &database, unsigned int docId);
 
+		/// Truncates or partially hashes a term.
+		static std::string limitTermLength(const std::string &term, bool makeUnique = false);
+
 	protected:
+		static const unsigned int m_maxTermLength;
 		std::string m_databaseName;
 		bool m_readOnly;
 		pthread_mutex_t m_rwLock;
@@ -69,6 +78,8 @@
 
 		void openDatabase(void);
 
+		static bool badRecordField(const std::string &field);
+
 };
 
 #endif // _XAPIAN_DATABASE_H

Modified: trunk/Index/XapianIndex.cpp
===================================================================
--- trunk/Index/XapianIndex.cpp	2007-02-19 15:21:36 UTC (rev 725)
+++ trunk/Index/XapianIndex.cpp	2007-02-20 05:04:52 UTC (rev 726)
@@ -16,8 +16,6 @@
  *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
  */
 
-#include <sys/types.h>
-#include <sys/stat.h>
 #include <fcntl.h>
 #include <unistd.h>
 #include <stdio.h>
@@ -26,7 +24,6 @@
 #include <strings.h>
 #include <time.h>
 #include <ctype.h>
-#include <regex.h>
 #include <iostream>
 #include <fstream>
 #include <algorithm>
@@ -113,46 +110,6 @@
 	return *this;
 }
 
-string XapianIndex::limitTermLength(const string &term, bool makeUnique)
-{
-	if (term.length() > XapianDatabase::m_maxTermLength)
-	{
-		if (makeUnique == false)
-		{
-			// Truncate
-			return term.substr(0, XapianDatabase::m_maxTermLength);
-		}
-		else
-		{
-			return StringManip::hashString(term, XapianDatabase::m_maxTermLength);
-		}
-	}
-
-	return term;
-}
-
-bool XapianIndex::badField(const string &field)
-{
-	regex_t fieldRegex;
-	regmatch_t pFieldMatches[1];
-	bool isBadField = false;
-
-	// A bad field is one that includes one of our field delimiters
-	if (regcomp(&fieldRegex,
-		"(url|sample|caption|type|timestamp|language)=",
-		REG_EXTENDED|REG_ICASE) == 0)
-	{
-		if (regexec(&fieldRegex, field.c_str(), 1,
-			pFieldMatches, REG_NOTBOL|REG_NOTEOL) == 0)
-		{
-			isBadField = true;
-		}
-	}
-	regfree(&fieldRegex);
-
-	return isBadField;
-}
-
 bool XapianIndex::listDocumentsWithTerm(const string &term, set<unsigned int> &docIds,
 	unsigned int maxDocsCount, unsigned int startDoc) const
 {
@@ -227,7 +184,7 @@
 		if (isupper((int)term[0]) != 0)
 		{
 			// R-prefix the raw term
-			doc.add_posting(limitTermLength(string("R") + term), termPos);
+			doc.add_posting(XapianDatabase::limitTermLength(string("R") + term), termPos);
 		}
 		// Lower case the term
 		term = StringManip::toLowerCase(term);
@@ -236,24 +193,24 @@
 		if ((mode == STORE_UNSTEM) ||
 			(pStemmer == NULL))
 		{
-			doc.add_posting(limitTermLength(prefix + term), termPos);
+			doc.add_posting(XapianDatabase::limitTermLength(prefix + term), termPos);
 		}
 		else if (mode == STORE_STEM)
 		{
 			string stemmedTerm = pStemmer->stem_word(term);
 
-			doc.add_posting(limitTermLength(prefix + stemmedTerm), termPos);
+			doc.add_posting(XapianDatabase::limitTermLength(prefix + stemmedTerm), termPos);
 		}
 		else if (mode == STORE_BOTH)
 		{
 			string stemmedTerm = pStemmer->stem_word(term);
 
 			// Add both at the same position
-			doc.add_posting(limitTermLength(prefix + term), termPos);
+			doc.add_posting(XapianDatabase::limitTermLength(prefix + term), termPos);
 			if (stemmedTerm != term)
 			{
 				// No point adding the same term twice
-				doc.add_posting(limitTermLength(prefix + stemmedTerm), termPos);
+				doc.add_posting(XapianDatabase::limitTermLength(prefix + stemmedTerm), termPos);
 			}
 		}
 
@@ -302,20 +259,20 @@
 		if ((mode == STORE_UNSTEM) ||
 			(pStemmer == NULL))
 		{
-			removeFirstPosting(doc, termListIter, limitTermLength(prefix + term));
+			removeFirstPosting(doc, termListIter, XapianDatabase::limitTermLength(prefix + term));
 		}
 		else if (mode == STORE_STEM)
 		{
-			removeFirstPosting(doc, termListIter, limitTermLength(prefix + pStemmer->stem_word(term)));
+			removeFirstPosting(doc, termListIter, XapianDatabase::limitTermLength(prefix + pStemmer->stem_word(term)));
 		}
 		else if (mode == STORE_BOTH)
 		{
 			string stemmedTerm = pStemmer->stem_word(term);
 
-			removeFirstPosting(doc, termListIter, limitTermLength(prefix + term));
+			removeFirstPosting(doc, termListIter, XapianDatabase::limitTermLength(prefix + term));
 			if (stemmedTerm != term)
 			{
-				removeFirstPosting(doc, termListIter, limitTermLength(prefix + stemmedTerm));
+				removeFirstPosting(doc, termListIter, XapianDatabase::limitTermLength(prefix + stemmedTerm));
 			}
 		}
 	}
@@ -348,16 +305,16 @@
 	}
 
 	// Index the full URL with prefix U
-	doc.add_term(limitTermLength(string("U") + location, true));
+	doc.add_term(XapianDatabase::limitTermLength(string("U") + location, true));
 	// ...the host name and included domains with prefix H
 	string hostName(StringManip::toLowerCase(urlObj.getHost()));
 	if (hostName.empty() == false)
 	{
-		doc.add_term(limitTermLength(string("H") + hostName, true));
+		doc.add_term(XapianDatabase::limitTermLength(string("H") + hostName, true));
 		string::size_type dotPos = hostName.find('.');
 		while (dotPos != string::npos)
 		{
-			doc.add_term(limitTermLength(string("H") + hostName.substr(dotPos + 1), true));
+			doc.add_term(XapianDatabase::limitTermLength(string("H") + hostName.substr(dotPos + 1), true));
 
 			// Next
 			dotPos = hostName.find('.', dotPos + 1);
@@ -367,11 +324,11 @@
 	string tree(urlObj.getLocation());
 	if (tree.empty() == false)
 	{
-		doc.add_term(limitTermLength(string("XDIR:") + tree, true));
+		doc.add_term(XapianDatabase::limitTermLength(string("XDIR:") + tree, true));
 		string::size_type slashPos = tree.find('/', 1);
 		while (slashPos != string::npos)
 		{
-			doc.add_term(limitTermLength(string("XDIR:") + tree.substr(0, slashPos), true));
+			doc.add_term(XapianDatabase::limitTermLength(string("XDIR:") + tree.substr(0, slashPos), true));
 
 			// Next
 			slashPos = tree.find('/', slashPos + 1);
@@ -383,7 +340,7 @@
 	{
 		string extension;
 
-		doc.add_term(limitTermLength(string("P") + fileName, true));
+		doc.add_term(XapianDatabase::limitTermLength(string("P") + fileName, true));
 
 		// Does it have an extension ?
 		string::size_type extPos = fileName.rfind('.');
@@ -392,7 +349,7 @@
 		{
 			extension = StringManip::toLowerCase(fileName.substr(extPos + 1));
 		}
-		doc.add_term(limitTermLength(string("XEXT:") + extension));
+		doc.add_term(XapianDatabase::limitTermLength(string("XEXT:") + extension));
 	}
 	// Add the date terms D, M and Y
 	time_t timeT = TimeConverter::fromTimestamp(info.getTimestamp());
@@ -463,16 +420,16 @@
 	}
 
 	// Title
-	commonTerms.insert(limitTermLength(string("U") + docInfo.getLocation(), true));
+	commonTerms.insert(XapianDatabase::limitTermLength(string("U") + docInfo.getLocation(), true));
 	// Host name
 	string hostName(StringManip::toLowerCase(urlObj.getHost()));
 	if (hostName.empty() == false)
 	{
-		commonTerms.insert(limitTermLength(string("H") + hostName, true));
+		commonTerms.insert(XapianDatabase::limitTermLength(string("H") + hostName, true));
 		string::size_type dotPos = hostName.find('.');
 		while (dotPos != string::npos)
 		{
-			commonTerms.insert(limitTermLength(string("H") + hostName.substr(dotPos + 1), true));
+			commonTerms.insert(XapianDatabase::limitTermLength(string("H") + hostName.substr(dotPos + 1), true));
 
 			// Next
 			dotPos = hostName.find('.', dotPos + 1);
@@ -482,11 +439,11 @@
 	string tree(urlObj.getLocation());
 	if (tree.empty() == false)
 	{
-		commonTerms.insert(limitTermLength(string("XDIR:") + tree, true));
+		commonTerms.insert(XapianDatabase::limitTermLength(string("XDIR:") + tree, true));
 		string::size_type slashPos = tree.find('/', 1);
 		while (slashPos != string::npos)
 		{
-			commonTerms.insert(limitTermLength(string("XDIR:") + tree.substr(0, slashPos), true));
+			commonTerms.insert(XapianDatabase::limitTermLength(string("XDIR:") + tree.substr(0, slashPos), true));
 
 			// Next
 			slashPos = tree.find('/', slashPos + 1);
@@ -498,7 +455,7 @@
 	{
 		string extension;
 
-		commonTerms.insert(limitTermLength(string("P") + fileName, true));
+		commonTerms.insert(XapianDatabase::limitTermLength(string("P") + fileName, true));
 
 		// Does it have an extension ?
 		string::size_type extPos = fileName.rfind('.');
@@ -507,7 +464,7 @@
 		{
 			extension = StringManip::toLowerCase(fileName.substr(extPos + 1));
 		}
-		commonTerms.insert(limitTermLength(string("XEXT:") + extension));
+		commonTerms.insert(XapianDatabase::limitTermLength(string("XEXT:") + extension));
 	}
 	// Date terms
 	time_t timeT = TimeConverter::fromTimestamp(docInfo.getTimestamp());
@@ -583,51 +540,14 @@
 void XapianIndex::setDocumentData(const DocumentInfo &info, Xapian::Document &doc,
 	const string &language) const
 {
-	string title(info.getTitle());
-	string timestamp(info.getTimestamp());
-	char tmpStr[64];
-	time_t timeT = TimeConverter::fromTimestamp(timestamp);
+	time_t timeT = TimeConverter::fromTimestamp(info.getTimestamp());
 
 	// Add this value to allow sorting by date
 	doc.add_value(0, StringManip::integerToBinaryString((uint32_t)timeT));
 
-	// Set the document data omindex-style
-	string record = "url=";
-	record += info.getLocation();
-	// The sample will be generated at query time
-	record += "\nsample=";
-	record += "\ncaption=";
-	if (badField(title) == true)
-	{
-		// Modify the title if necessary
-		string::size_type pos = title.find("=");
-		while (pos != string::npos)
-		{
-			title[pos] = ' ';
-			pos = title.find("=", pos + 1);
-		}
-#ifdef DEBUG
-		cout << "XapianIndex::setDocumentData: modified title" << endl;
-#endif
-	}
-	record += title;
-	record += "\ntype=";
-	record += info.getType();
-	// Append a timestamp, in a format compatible with Omega
-	record += "\nmodtime=";
-	snprintf(tmpStr, 64, "%ld", timeT);
-	record += tmpStr;
-	// ...and the language
-	record += "\nlanguage=";
-	record += StringManip::toLowerCase(language);
-	// ...and the file size
-	record += "\nsize=";
-	snprintf(tmpStr, 64, "%ld", info.getSize());
-	record += tmpStr;
-#ifdef DEBUG
-	cout << "XapianIndex::setDocumentData: document data is " << record << endl;
-#endif
-	doc.set_data(record);
+	DocumentInfo docCopy(info);
+	docCopy.setLanguage(language);
+	doc.set_data(XapianDatabase::propsToRecord(&docCopy));
 }
 
 //
@@ -870,7 +790,7 @@
 		Xapian::Database *pIndex = pDatabase->readLock();
 		if (pIndex != NULL)
 		{
-			string term = limitTermLength(string("U") + Url::canonicalizeUrl(url), true);
+			string term = XapianDatabase::limitTermLength(string("U") + Url::canonicalizeUrl(url), true);
 
 			// Get documents that have this term
 			Xapian::PostingIterator postingIter = pIndex->postlist_begin(term);
@@ -1134,7 +1054,7 @@
 		for (set<string>::const_iterator labelIter = labels.begin(); labelIter != labels.end();
 			++labelIter)
 		{
-			doc.add_term(limitTermLength(string("XLABEL:") + *labelIter));
+			doc.add_term(XapianDatabase::limitTermLength(string("XLABEL:") + *labelIter));
 		}
 		addCommonTerms(docInfo, doc, termPos);
 		setDocumentData(docInfo, doc, m_stemLanguage);
@@ -1214,7 +1134,7 @@
 			for (set<string>::const_iterator labelIter = labels.begin(); labelIter != labels.end();
 				++labelIter)
 			{
-				doc.add_term(limitTermLength(string("XLABEL:") + *labelIter));
+				doc.add_term(XapianDatabase::limitTermLength(string("XLABEL:") + *labelIter));
 			}
 		}
 		addCommonTerms(docInfo, doc, termPos);
@@ -1350,7 +1270,7 @@
 			{
 				if (labelIter->empty() == false)
 				{
-					doc.add_term(limitTermLength(string("XLABEL:") + *labelIter));
+					doc.add_term(XapianDatabase::limitTermLength(string("XLABEL:") + *labelIter));
 				}
 			}
 
@@ -1434,7 +1354,7 @@
 		Xapian::WritableDatabase *pIndex = pDatabase->writeLock();
 		if (pIndex != NULL)
 		{
-			string term = limitTermLength(string("U") + Url::canonicalizeUrl(location), true);
+			string term = XapianDatabase::limitTermLength(string("U") + Url::canonicalizeUrl(location), true);
 
 			// Only one document should have this term
 			pIndex->delete_document(term);
@@ -1528,7 +1448,7 @@
 				// Remove the term
 				doc.remove_term(term);
 				// ...add the new one
-				doc.add_term(limitTermLength(string("XLABEL:") + newName));
+				doc.add_term(XapianDatabase::limitTermLength(string("XLABEL:") + newName));
 				// ...and update the document
 				pIndex->replace_document(docId, doc);
 			}

Modified: trunk/Index/XapianIndex.h
===================================================================
--- trunk/Index/XapianIndex.h	2007-02-19 15:21:36 UTC (rev 725)
+++ trunk/Index/XapianIndex.h	2007-02-20 05:04:52 UTC (rev 726)
@@ -119,10 +119,6 @@
 		bool m_goodIndex;
 		std::string m_stemLanguage;
 
-		static std::string limitTermLength(const std::string &term, bool makeUnique = false);
-
-		static bool badField(const std::string &field);
-
 		bool listDocumentsWithTerm(const std::string &term, std::set<unsigned int> &docIds,
 			unsigned int maxDocsCount = 0, unsigned int startDoc = 0) const;
 

Modified: trunk/Search/XapianEngine.cpp
===================================================================
--- trunk/Search/XapianEngine.cpp	2007-02-19 15:21:36 UTC (rev 725)
+++ trunk/Search/XapianEngine.cpp	2007-02-20 05:04:52 UTC (rev 726)
@@ -346,43 +346,22 @@
 				Xapian::docid docId = *mIter;
 				Xapian::Document doc(mIter.get_document());
 				AbstractGenerator abstractGen(pIndex, 50);
-				string record = doc.get_data();
+				Result thisResult("", "", abstractGen.generateAbstract(docId, seedTerms),
+					"", (float)mIter.get_percent());
 
 #ifdef DEBUG
 				cout << "XapianEngine::queryDatabase: found document ID " << docId << endl;
 #endif
-				// Get the title
-				string title(StringManip::extractField(record, "caption=", "\n"));
-				// Get the URL
-				string url(StringManip::extractField(record, "url=", "\n"));
+				XapianDatabase::recordToProps(doc.get_data(), &thisResult);
+
+				string url(thisResult.getLocation());
 				if (url.empty() == true)
 				{
 					// Hmmm this shouldn't be empty...
 					// Use this instead, even though the document isn't cached in the index
-					url = XapianDatabase::buildUrl(m_databaseName, *mIter);
+					thisResult.setLocation(XapianDatabase::buildUrl(m_databaseName, docId));
 				}
-				else
-				{
-					url = Url::canonicalizeUrl(url);
-				}
 
-				// Get the type
-				string type(StringManip::extractField(record, "type=", "\n"));
-				// ... the language, if available
-				string language(StringManip::extractField(record, "language=", "\n"));
-				// ... and the timestamp
-				string timestamp, modTime(StringManip::extractField(record, "modtime=", "\n"));
-				if (modTime.empty() == false)
-				{
-					time_t timeT = (time_t )atol(modTime.c_str());
-					timestamp = TimeConverter::toTimestamp(timeT);
-				}
-
-				// Generate an abstract based on the query's terms
-				string summary(abstractGen.generateAbstract(docId, seedTerms));
-
-				Result thisResult(url, title, summary, language, (float)mIter.get_percent());
-				thisResult.setTimestamp(timestamp);
 				// We don't know the index ID, just the document ID
 				thisResult.setIsIndexed(0, docId);
 



From fabricecolin at mail.berlios.de  Tue Feb 20 06:07:23 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 20 Feb 2007 06:07:23 +0100
Subject: [Pinot-svn] r727 - trunk/UI/GTK2/src
Message-ID: <200702200507.l1K57NiD003013@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-20 06:07:22 +0100 (Tue, 20 Feb 2007)
New Revision: 727

Modified:
   trunk/UI/GTK2/src/ModelColumns.cpp
   trunk/UI/GTK2/src/ModelColumns.h
   trunk/UI/GTK2/src/ResultsTree.cpp
   trunk/UI/GTK2/src/ResultsTree.h
   trunk/UI/GTK2/src/mainWindow.cc
Log:
Show results' timestamp. Don't attempt setting the indexed icon on results that
are being indexed as their document ID is not yet known.


Modified: trunk/UI/GTK2/src/ModelColumns.cpp
===================================================================
--- trunk/UI/GTK2/src/ModelColumns.cpp	2007-02-20 05:04:52 UTC (rev 726)
+++ trunk/UI/GTK2/src/ModelColumns.cpp	2007-02-20 05:07:22 UTC (rev 727)
@@ -67,6 +67,8 @@
 	add(m_indexes);
 	add(m_docId);
 	add(m_type);
+	add(m_timestamp);
+	add(m_timestampTime);
 }
 
 ResultsModelColumns::~ResultsModelColumns()

Modified: trunk/UI/GTK2/src/ModelColumns.h
===================================================================
--- trunk/UI/GTK2/src/ModelColumns.h	2007-02-20 05:04:52 UTC (rev 726)
+++ trunk/UI/GTK2/src/ModelColumns.h	2007-02-20 05:07:22 UTC (rev 727)
@@ -91,6 +91,8 @@
 	Gtk::TreeModelColumn<unsigned int> m_docId;
 	typedef enum { RESULT_ROOT = 0, RESULT_TITLE, RESULT_HOST, RESULT_OTHER } ResultType;
 	Gtk::TreeModelColumn<ResultType> m_type;
+	Gtk::TreeModelColumn<Glib::ustring> m_timestamp;
+	Gtk::TreeModelColumn<time_t> m_timestampTime;
 
 };
 

Modified: trunk/UI/GTK2/src/ResultsTree.cpp
===================================================================
--- trunk/UI/GTK2/src/ResultsTree.cpp	2007-02-20 05:04:52 UTC (rev 726)
+++ trunk/UI/GTK2/src/ResultsTree.cpp	2007-02-20 05:07:22 UTC (rev 727)
@@ -28,6 +28,7 @@
 #include <gtkmm/cellrendererprogress.h>
 
 #include "StringManip.h"
+#include "TimeConverter.h"
 #include "Url.h"
 #include "QueryHistory.h"
 #include "ViewHistory.h"
@@ -132,7 +133,7 @@
 	pColumn->set_sort_column(m_resultsColumns.m_text);
 	append_column(*manage(pColumn));
 
-	// The last column is for the URL
+	// URL
 	pColumn = create_column(_("URL"), m_resultsColumns.m_url, false, true, m_resultsColumns.m_url);
 	if (pColumn != NULL)
 	{
@@ -140,6 +141,14 @@
 		append_column(*manage(pColumn));
 	}
 
+	// The last column is for the timestamp
+	pColumn = create_column(_("Date"), m_resultsColumns.m_timestamp, false, true, m_resultsColumns.m_timestampTime);
+	if (pColumn != NULL)
+	{
+		pColumn->set_sizing(TREE_VIEW_COLUMN_AUTOSIZE);
+		append_column(*manage(pColumn));
+	}
+	
 	// Connect the signals
 	signal_button_press_event().connect_notify(
 		SigC::slot(*this, &ResultsTree::onButtonPressEvent));
@@ -560,11 +569,12 @@
 			}
 
 			if (appendResult(title, location, (int)currentScore, rankDiff, isIndexed,
-				docId, engineId, indexId, titleIter, &(*groupIter), true) == true)
+				docId, resultIter->getTimestamp(), engineId, indexId, titleIter, &(*groupIter), true) == true)
 			{
 #ifdef DEBUG
 				cout << "ResultsTree::addResults: added row for result " << count
-					<< ", " << currentScore << ", " << isIndexed << " " << indexId << endl;
+					<< ", " << currentScore << ", " << isIndexed << " " << indexId
+					<< " " << resultIter->getTimestamp() << endl;
 #endif
 
 				// Update this map, so that we know which groups need updating
@@ -694,6 +704,7 @@
 							childRow[m_resultsColumns.m_rankDiff],
 							childRow[m_resultsColumns.m_indexed],
 							childRow[m_resultsColumns.m_docId],
+							childRow[m_resultsColumns.m_timestamp],
 							engineIds, indexIds,
 							newIter, &(*groupIter), true);
 					}
@@ -764,6 +775,7 @@
 									childRow[m_resultsColumns.m_rankDiff],
 									childRow[m_resultsColumns.m_indexed],
 									childRow[m_resultsColumns.m_docId],
+									childRow[m_resultsColumns.m_timestamp],
 									engineId, indexId,
 									newIter, &(*groupIter), true);
 #ifdef DEBUG
@@ -826,10 +838,14 @@
 		TreeModel::iterator iter = m_refStore->get_iter(*itemPath);
 		TreeModel::Row row = *iter;
 
-		if ((row[m_resultsColumns.m_type] == ResultsModelColumns::RESULT_TITLE) &&
-			((skipIndexed == false) ||
-			(row[m_resultsColumns.m_indexed] = false)))
+		if (row[m_resultsColumns.m_type] != ResultsModelColumns::RESULT_TITLE)
 		{
+			continue;
+		}
+
+		if ((skipIndexed == false) ||
+			(row[m_resultsColumns.m_indexed] == false))
+		{
 			resultsList.push_back(DocumentInfo(from_utf8(row[m_resultsColumns.m_text]),
 				from_utf8(row[m_resultsColumns.m_url]), "", ""));
 		}
@@ -877,6 +893,9 @@
 				{
 					if  (m_settings.isInternalIndex(*indexIter) == true)
 					{
+#ifdef DEBUG
+						cout << "ResultsTree::getSelection: result in internal index " << *indexIter << endl;
+#endif
 						current.setIsIndexed(m_settings.getIndexId(*indexIter), row[m_resultsColumns.m_docId]);
 						break;
 					}
@@ -896,7 +915,7 @@
 //
 // Sets the selected items' state.
 //
-void ResultsTree::setSelectionState(bool viewed, bool indexed)
+void ResultsTree::setSelectionState(bool viewed)
 {
 	list<TreeModel::Path> selectedItems = get_selection()->get_selected_rows();
 	if (selectedItems.empty() == true)
@@ -920,10 +939,6 @@
 		{
 			row[m_resultsColumns.m_viewed] = true;
 		}
-		if (indexed == true)
-		{
-			row[m_resultsColumns.m_indexed] = true;
-		}
 	}
 }
 
@@ -1141,7 +1156,7 @@
 //
 bool ResultsTree::appendResult(const ustring &text, const ustring &url,
 	int score, int rankDiff, bool isIndexed, unsigned int docId,
-	unsigned int engineId, unsigned int indexId,
+	const ustring &timestamp, unsigned int engineId, unsigned int indexId,
 	TreeModel::iterator &newRowIter, const TreeModel::Row *parentRow, bool noDuplicates)
 {
 	if (parentRow == NULL)
@@ -1186,7 +1201,7 @@
 
 	TreeModel::Row childRow = *newRowIter;
 	updateRow(childRow, text, url, score, engineId, indexId,
-		docId, ResultsModelColumns::RESULT_TITLE, isIndexed,
+		docId, timestamp, ResultsModelColumns::RESULT_TITLE, isIndexed,
 		wasViewed, rankDiff);
 
 	return true;
@@ -1208,7 +1223,7 @@
 		groupIter = m_refStore->append();
 		TreeModel::Row groupRow = *groupIter;
 		updateRow(groupRow, to_utf8(groupName),
-			"", 0, 0, 0, 0, groupType,
+			"", 0, 0, 0, 0, "", groupType,
 			false, false, false);
 
 		// Update the map
@@ -1276,8 +1291,8 @@
 //
 void ResultsTree::updateRow(TreeModel::Row &row, const ustring &text,
 	const ustring &url, int score, unsigned int engineId, unsigned int indexId,
-	unsigned int docId, ResultsModelColumns::ResultType type,
-	bool indexed, bool viewed, int rankDiff)
+	unsigned int docId, const ustring &timestamp,
+	ResultsModelColumns::ResultType type, bool indexed, bool viewed, int rankDiff)
 {
 	try
 	{
@@ -1289,6 +1304,8 @@
 		row[m_resultsColumns.m_indexes] = indexId;
 		row[m_resultsColumns.m_docId] = docId;
 		row[m_resultsColumns.m_type] = type;
+		row[m_resultsColumns.m_timestamp] = timestamp;
+		row[m_resultsColumns.m_timestampTime] = TimeConverter::fromTimestamp(timestamp);
 
 		row[m_resultsColumns.m_indexed] = indexed;
 		row[m_resultsColumns.m_viewed] = viewed;

Modified: trunk/UI/GTK2/src/ResultsTree.h
===================================================================
--- trunk/UI/GTK2/src/ResultsTree.h	2007-02-20 05:04:52 UTC (rev 726)
+++ trunk/UI/GTK2/src/ResultsTree.h	2007-02-20 05:07:22 UTC (rev 727)
@@ -77,7 +77,7 @@
 		bool getSelection(std::vector<Result> &resultsList);
 
 		/// Sets the selected items' state.
-		void setSelectionState(bool viewed, bool indexed);
+		void setSelectionState(bool viewed);
 
 		/**
 		  * Deletes the current selection.
@@ -152,7 +152,7 @@
 		/// Adds a new row in the results tree.
 		bool appendResult(const Glib::ustring &text, const Glib::ustring &url,
 			int score, int rankDiff, bool isIndexed, unsigned int docId,
-			unsigned int engineId, unsigned int indexId,
+			const Glib::ustring &timestamp, unsigned int engineId, unsigned int indexId,
 			Gtk::TreeModel::iterator &newRowIter, const Gtk::TreeModel::Row *parentRow = NULL,
 			bool noDuplicates = false);
 
@@ -162,8 +162,8 @@
 		/// Updates a row.
 		void updateRow(Gtk::TreeModel::Row &row, const Glib::ustring &text,
 			const Glib::ustring &url, int score, unsigned int engineId, unsigned int indexId,
-			unsigned int indexId, ResultsModelColumns::ResultType type,
-			bool indexed, bool viewed, int rankDiff);
+			unsigned int docId, const Glib::ustring &timestamp,
+			ResultsModelColumns::ResultType type, bool indexed, bool viewed, int rankDiff);
 
 		/// Retrieves the extract to show for the given row.
 		Glib::ustring findResultsExtract(const Gtk::TreeModel::Row &row);

Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2007-02-20 05:04:52 UTC (rev 726)
+++ trunk/UI/GTK2/src/mainWindow.cc	2007-02-20 05:07:22 UTC (rev 727)
@@ -707,7 +707,7 @@
 					view_documents(resultsList);
 
 					// Update the rows right now
-					pResultsTree->setSelectionState(true, false);
+					pResultsTree->setSelectionState(true);
 				}
 			}
 		}
@@ -1231,6 +1231,8 @@
 				pIndexPage->setDocumentsCount(pIndexPage->getDocumentsCount() + 1);
 				pIndexPage->updateButtonsState(m_maxDocsCount);
 			}
+
+			// FIXME: update the result's indexed status in the results list !
 		}
 
 		set_status(status);
@@ -1714,7 +1716,7 @@
 					view_documents(resultsList);
 
 					// We can update the rows right now
-					pResultsTree->setSelectionState(true, false);
+					pResultsTree->setSelectionState(true);
 				}
 			}
 		}
@@ -1829,9 +1831,6 @@
 						set_status(status);
 					}
 				}
-
-				// We can update the rows right now
-				pResultsTree->setSelectionState(false, true);
 			}
 		}
 	}



From fabricecolin at mail.berlios.de  Tue Feb 20 07:03:44 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 20 Feb 2007 07:03:44 +0100
Subject: [Pinot-svn] r728 - trunk/po
Message-ID: <200702200603.l1K63ijn026537@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-20 07:03:43 +0100 (Tue, 20 Feb 2007)
New Revision: 728

Modified:
   trunk/po/sv.po
Log:
Checking in Daniel's latest translations, exported from Rosetta today.


Modified: trunk/po/sv.po
===================================================================
--- trunk/po/sv.po	2007-02-20 05:07:22 UTC (rev 727)
+++ trunk/po/sv.po	2007-02-20 06:03:43 UTC (rev 728)
@@ -9,13 +9,13 @@
 "Project-Id-Version: pinot 0.70\n"
 "Report-Msgid-Bugs-To: \n"
 "POT-Creation-Date: 2006-12-03 16:44+0000\n"
-"PO-Revision-Date: 2007-02-17 17:34+0800\n"
+"PO-Revision-Date: 2007-02-20 13:13+0800\n"
 "Last-Translator: Daniel Nylander <po at danielnylander.se>\n"
 "Language-Team: Swedish <sv at li.org>\n"
 "MIME-Version: 1.0\n"
 "Content-Type: text/plain; charset=UTF-8\n"
 "Content-Transfer-Encoding: 8bit\n"
-"X-Rosetta-Export-Date: 2006-12-03 23:58+0000\n"
+"X-Rosetta-Export-Date: 2007-02-20 05:58+0000\n"
 
 #: UI/GTK2/src/EnginesTree.cpp:70
 msgid "Search Engines"
@@ -28,34 +28,35 @@
 #: UI/GTK2/src/EnginesTree.cpp:339 UI/GTK2/src/mainWindow.cc:325
 #: UI/GTK2/src/mainWindow.cc:328 UI/GTK2/src/mainWindow.cc:541
 #: UI/GTK2/src/mainWindow.cc:1186 UI/GTK2/src/mainWindow.cc:1229
-#: UI/GTK2/src/mainWindow.cc:1249 UI/GTK2/src/mainWindow.cc:1280
-#: UI/GTK2/src/mainWindow.cc:1859 UI/GTK2/src/PinotSettings.cpp:241
+#: UI/GTK2/src/mainWindow.cc:1251 UI/GTK2/src/mainWindow.cc:1282
+#: UI/GTK2/src/mainWindow.cc:1855 UI/GTK2/src/PinotSettings.cpp:241
 #: UI/GTK2/src/PinotSettings.cpp:1281 UI/GTK2/src/PinotSettings.cpp:1337
-#: UI/GTK2/src/statisticsDialog.cc:88 UI/GTK2/src/WorkerThreads.cpp:859
+#: UI/GTK2/src/statisticsDialog.cc:88 UI/GTK2/src/WorkerThreads.cpp:820
+#: UI/GTK2/src/WorkerThreads.cpp:879
 msgid "My Web Pages"
 msgstr "Mina webbsidor"
 
 #: UI/GTK2/src/EnginesTree.cpp:340 UI/GTK2/src/mainWindow.cc:319
 #: UI/GTK2/src/mainWindow.cc:322 UI/GTK2/src/PinotSettings.cpp:242
 #: UI/GTK2/src/PinotSettings.cpp:1282 UI/GTK2/src/PinotSettings.cpp:1338
-#: UI/GTK2/src/statisticsDialog.cc:74 UI/GTK2/src/WorkerThreads.cpp:867
+#: UI/GTK2/src/statisticsDialog.cc:74 UI/GTK2/src/WorkerThreads.cpp:825
+#: UI/GTK2/src/WorkerThreads.cpp:889
 msgid "My Documents"
 msgstr "Mina dokument"
 
 #: UI/GTK2/src/dateDialog_glade.cc:76 UI/GTK2/src/queryDialog_glade.cc:91
-#: UI/GTK2/src/queryDialog_glade.cc:92
+#: UI/GTK2/src/queryDialog_glade.cc:92 UI/GTK2/src/ResultsTree.cpp:145
 #, fuzzy
 msgid "Date"
 msgstr "p?"
 
 #: UI/GTK2/src/indexDialog.cc:130
 msgid "Served by"
-msgstr ""
+msgstr "Erbjuds av"
 
 #: UI/GTK2/src/indexDialog.cc:134
-#, fuzzy
 msgid "Local"
-msgstr "Plats"
+msgstr "Lokal"
 
 #: UI/GTK2/src/indexDialog.cc:300
 msgid "Index location"
@@ -82,9 +83,8 @@
 msgstr "Port:"
 
 #: UI/GTK2/src/indexDialog_glade.cc:79
-#, fuzzy
 msgid "Host name:"
-msgstr "V?rdnamn"
+msgstr "V?rdnamn:"
 
 #: UI/GTK2/src/indexDialog_glade.cc:163
 msgid "External index"
@@ -107,17 +107,17 @@
 msgid "Import"
 msgstr "Importera"
 
-#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:221
+#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:217
 msgid "Import URL"
 msgstr "Importera url"
 
 #: UI/GTK2/src/IndexTree.cpp:68 UI/GTK2/src/queryDialog.cc:139
-#: UI/GTK2/src/ResultsTree.cpp:126
+#: UI/GTK2/src/ResultsTree.cpp:127
 msgid "Title"
 msgstr "Titel"
 
 #: UI/GTK2/src/IndexTree.cpp:73 UI/GTK2/src/queryDialog.cc:142
-#: UI/GTK2/src/ResultsTree.cpp:136
+#: UI/GTK2/src/ResultsTree.cpp:137
 msgid "URL"
 msgstr "Url"
 
@@ -212,7 +212,7 @@
 msgid "Query"
 msgstr "Fr?ga"
 
-#: UI/GTK2/src/mainWindow.cc:924 UI/GTK2/src/mainWindow.cc:2922
+#: UI/GTK2/src/mainWindow.cc:924 UI/GTK2/src/mainWindow.cc:2923
 msgid "on"
 msgstr "p?"
 
@@ -236,225 +236,225 @@
 msgid "Indexed"
 msgstr "Indexerade"
 
-#: UI/GTK2/src/mainWindow.cc:1250
+#: UI/GTK2/src/mainWindow.cc:1252
 msgid "Unindexed document(s)"
 msgstr "Ej indexerade dokument"
 
-#: UI/GTK2/src/mainWindow.cc:1291
+#: UI/GTK2/src/mainWindow.cc:1293
 msgid "Updated document properties"
 msgstr "Egenskaper f?r uppdaterade dokument"
 
-#: UI/GTK2/src/mainWindow.cc:1338
+#: UI/GTK2/src/mainWindow.cc:1346
 msgid "Couldn't rename index, name"
 msgstr "Kunde inte byta namn p? index, namn"
 
-#: UI/GTK2/src/mainWindow.cc:1342 UI/GTK2/src/mainWindow.cc:2246
-#: UI/GTK2/src/mainWindow.cc:2757
+#: UI/GTK2/src/mainWindow.cc:1350 UI/GTK2/src/mainWindow.cc:2242
+#: UI/GTK2/src/mainWindow.cc:2753
 msgid "is already in use"
 msgstr "anv?nds redan"
 
-#: UI/GTK2/src/mainWindow.cc:1355
+#: UI/GTK2/src/mainWindow.cc:1363
 msgid "Couldn't rename index"
 msgstr "Kunde inte byta namn p? index"
 
-#: UI/GTK2/src/mainWindow.cc:1368
+#: UI/GTK2/src/mainWindow.cc:1376
 msgid "Edited index"
 msgstr "Redigerade index"
 
-#: UI/GTK2/src/mainWindow.cc:1753 UI/GTK2/src/mainWindow.cc:2416
+#: UI/GTK2/src/mainWindow.cc:1752 UI/GTK2/src/mainWindow.cc:2412
 msgid "Live query"
 msgstr "Levande fr?ga"
 
-#: UI/GTK2/src/mainWindow.cc:1779
+#: UI/GTK2/src/mainWindow.cc:1778
 msgid "Couldn't find query"
 msgstr "Kunde inte hitta fr?ga"
 
-#: UI/GTK2/src/mainWindow.cc:1975 UI/GTK2/src/WorkerThreads.cpp:650
-#: UI/GTK2/src/WorkerThreads.cpp:1583
+#: UI/GTK2/src/mainWindow.cc:1971 UI/GTK2/src/WorkerThreads.cpp:651
+#: UI/GTK2/src/WorkerThreads.cpp:1608
 msgid "Index"
 msgstr "Index"
 
-#: UI/GTK2/src/mainWindow.cc:1979 UI/GTK2/src/WorkerThreads.cpp:654
-#: UI/GTK2/src/WorkerThreads.cpp:1587
+#: UI/GTK2/src/mainWindow.cc:1975 UI/GTK2/src/WorkerThreads.cpp:655
+#: UI/GTK2/src/WorkerThreads.cpp:1612
 msgid "doesn't exist"
 msgstr "finns inte"
 
-#: UI/GTK2/src/mainWindow.cc:2133
+#: UI/GTK2/src/mainWindow.cc:2129
 msgid "Remove this document from the index ?"
 msgstr "Ta bort detta dokument fr?n indexet?"
 
-#: UI/GTK2/src/mainWindow.cc:2152
+#: UI/GTK2/src/mainWindow.cc:2148
 msgid "Remove these documents from the index ?"
 msgstr "Ta bort dessa dokument fr?n indexet?"
 
-#: UI/GTK2/src/mainWindow.cc:2196
+#: UI/GTK2/src/mainWindow.cc:2192
 msgid "A metasearch tool for the Free Desktop"
 msgstr "Ett metas?kningsverktyg f?r Free Desktop"
 
-#: UI/GTK2/src/mainWindow.cc:2197
+#: UI/GTK2/src/mainWindow.cc:2193
 msgid "Search the Web and your documents !"
-msgstr ""
+msgstr "S?k p? webben och i dina dokument!"
 
-#: UI/GTK2/src/mainWindow.cc:2198
-#, fuzzy
+#: UI/GTK2/src/mainWindow.cc:2194
 msgid "(C) 2005 Fabrice Colin"
-msgstr "? 2005-2006 Fabrice Colin"
+msgstr "? 2005 Fabrice Colin"
 
-#: UI/GTK2/src/mainWindow.cc:2242
+#: UI/GTK2/src/mainWindow.cc:2238
 msgid "Index name"
 msgstr "Indexnamn"
 
-#: UI/GTK2/src/mainWindow.cc:2257
+#: UI/GTK2/src/mainWindow.cc:2253
 msgid "Couldn't add index"
 msgstr "Kunde inte l?gga till index"
 
-#: UI/GTK2/src/mainWindow.cc:2271
+#: UI/GTK2/src/mainWindow.cc:2267
 msgid "Added new index"
 msgstr "Lade till nytt index"
 
-#: UI/GTK2/src/mainWindow.cc:2306
+#: UI/GTK2/src/mainWindow.cc:2302
 msgid "Couldn't remove index"
 msgstr "Kunde inte ta bort index"
 
-#: UI/GTK2/src/mainWindow.cc:2571
+#: UI/GTK2/src/mainWindow.cc:2567
 msgid "At least one task hasn't completed yet. Quit now ?"
 msgstr "?tminstone en uppgift har inte f?rdigst?llts ?n. Avsluta nu?"
 
-#: UI/GTK2/src/mainWindow.cc:2753
+#: UI/GTK2/src/mainWindow.cc:2749
 msgid "Query name"
 msgstr "Fr?genamn"
 
-#: UI/GTK2/src/mainWindow.cc:2780
+#: UI/GTK2/src/mainWindow.cc:2776
 msgid "Couldn't update query"
 msgstr "Kunde inte uppdatera fr?ga"
 
-#: UI/GTK2/src/mainWindow.cc:2788
+#: UI/GTK2/src/mainWindow.cc:2784
 msgid "Edited query"
 msgstr "Redigerade fr?ga"
 
-#: UI/GTK2/src/mainWindow.cc:2795
+#: UI/GTK2/src/mainWindow.cc:2791
 msgid "Couldn't add query"
 msgstr "Kunde inte l?gga till fr?ga"
 
-#: UI/GTK2/src/mainWindow.cc:2803
+#: UI/GTK2/src/mainWindow.cc:2799
 msgid "Added new query"
 msgstr "Lade till ny fr?ga"
 
-#: UI/GTK2/src/mainWindow.cc:2816
+#: UI/GTK2/src/mainWindow.cc:2812
 msgid "Query is not set"
 msgstr "Fr?gan ?r inte inst?lld"
 
-#: UI/GTK2/src/mainWindow.cc:2827
+#: UI/GTK2/src/mainWindow.cc:2823
 msgid "No search engine selected"
 msgstr "Ingen s?kmotor vald"
 
-#: UI/GTK2/src/mainWindow.cc:2909
+#: UI/GTK2/src/mainWindow.cc:2910
 msgid "Please set the Google API key first"
 msgstr "St?ll in Google API-nyckeln f?rst"
 
-#: UI/GTK2/src/mainWindow.cc:2918
+#: UI/GTK2/src/mainWindow.cc:2919
 msgid "Running query"
 msgstr "K?r fr?ga"
 
-#: UI/GTK2/src/mainWindow.cc:3102
+#: UI/GTK2/src/mainWindow.cc:3103
 msgid "No default application defined for type"
 msgstr "Inget standardprogram definierat f?r typen"
 
-#: UI/GTK2/src/mainWindow_glade.cc:126
+#: UI/GTK2/src/mainWindow_glade.cc:125
 msgid "Query:"
 msgstr "Fr?ga:"
 
-#: UI/GTK2/src/mainWindow_glade.cc:138
+#: UI/GTK2/src/mainWindow_glade.cc:137
 msgid "Edit"
 msgstr "Redigera"
 
-#: UI/GTK2/src/mainWindow_glade.cc:147
+#: UI/GTK2/src/mainWindow_glade.cc:146
 msgid "Stored queries"
 msgstr "Lagrade fr?gor"
 
-#: UI/GTK2/src/mainWindow_glade.cc:161 UI/GTK2/src/statisticsDialog.cc:46
+#: UI/GTK2/src/mainWindow_glade.cc:163 UI/GTK2/src/statisticsDialog.cc:46
 #: UI/GTK2/src/statisticsDialog_glade.cc:87
+#, fuzzy
 msgid "Status"
-msgstr ""
+msgstr "Statistik"
 
-#: UI/GTK2/src/mainWindow_glade.cc:188
+#: UI/GTK2/src/mainWindow_glade.cc:184
 msgid "Search Engine"
 msgstr "S?kmotor"
 
-#: UI/GTK2/src/mainWindow_glade.cc:191
+#: UI/GTK2/src/mainWindow_glade.cc:187
 msgid "Host Name"
 msgstr "V?rdnamn"
 
-#: UI/GTK2/src/mainWindow_glade.cc:194
+#: UI/GTK2/src/mainWindow_glade.cc:190
 msgid "Show Extract"
 msgstr "Visa utdrag"
 
-#: UI/GTK2/src/mainWindow_glade.cc:197
+#: UI/GTK2/src/mainWindow_glade.cc:193
 msgid "Group By"
 msgstr "Gruppera efter"
 
-#: UI/GTK2/src/mainWindow_glade.cc:200
+#: UI/GTK2/src/mainWindow_glade.cc:196
 msgid "Clear List"
 msgstr "T?m lista"
 
-#: UI/GTK2/src/mainWindow_glade.cc:206
+#: UI/GTK2/src/mainWindow_glade.cc:202
 msgid "Vie_w"
 msgstr "Vi_sa"
 
-#: UI/GTK2/src/mainWindow_glade.cc:209
+#: UI/GTK2/src/mainWindow_glade.cc:205
 msgid "View Cache"
 msgstr "Visa cache"
 
-#: UI/GTK2/src/mainWindow_glade.cc:212
+#: UI/GTK2/src/mainWindow_glade.cc:208
 msgid "More Like This"
 msgstr "Mer som det h?r"
 
-#: UI/GTK2/src/mainWindow_glade.cc:215 UI/GTK2/src/mainWindow_glade.cc:251
+#: UI/GTK2/src/mainWindow_glade.cc:211 UI/GTK2/src/mainWindow_glade.cc:247
 msgid "_Index"
 msgstr "_Index"
 
-#: UI/GTK2/src/mainWindow_glade.cc:218
+#: UI/GTK2/src/mainWindow_glade.cc:214
 msgid "List Contents Of"
 msgstr "Lista inneh?ll f?r"
 
-#: UI/GTK2/src/mainWindow_glade.cc:227
+#: UI/GTK2/src/mainWindow_glade.cc:223
 msgid "View"
 msgstr "Visa"
 
-#: UI/GTK2/src/mainWindow_glade.cc:230
+#: UI/GTK2/src/mainWindow_glade.cc:226
 msgid "Update"
 msgstr "Uppdatera"
 
-#: UI/GTK2/src/mainWindow_glade.cc:233
+#: UI/GTK2/src/mainWindow_glade.cc:229
 msgid "Unindex"
 msgstr "Avindexera"
 
-#: UI/GTK2/src/mainWindow_glade.cc:236
+#: UI/GTK2/src/mainWindow_glade.cc:232
 #: UI/GTK2/src/propertiesDialog_glade.cc:177
 msgid "Properties"
 msgstr "Egenskaper"
 
-#: UI/GTK2/src/mainWindow_glade.cc:239
+#: UI/GTK2/src/mainWindow_glade.cc:235
 msgid "_About"
 msgstr "_Om"
 
-#: UI/GTK2/src/mainWindow_glade.cc:242
+#: UI/GTK2/src/mainWindow_glade.cc:238
 msgid "_Session"
 msgstr "_Session"
 
-#: UI/GTK2/src/mainWindow_glade.cc:245
+#: UI/GTK2/src/mainWindow_glade.cc:241
 msgid "_Edit"
 msgstr "R_edigera"
 
-#: UI/GTK2/src/mainWindow_glade.cc:248
+#: UI/GTK2/src/mainWindow_glade.cc:244
 msgid "_Results"
 msgstr "_Resultat"
 
-#: UI/GTK2/src/mainWindow_glade.cc:254
+#: UI/GTK2/src/mainWindow_glade.cc:250
 msgid "_Help"
 msgstr "_Hj?lp"
 
-#: UI/GTK2/src/mainWindow_glade.cc:391
+#: UI/GTK2/src/mainWindow_glade.cc:387
 msgid "Pinot"
 msgstr "Pinot"
 
@@ -565,7 +565,7 @@
 
 #: UI/GTK2/src/prefsDialog_glade.cc:65
 msgid "HTTP crawling:"
-msgstr "HTTP-crawling:"
+msgstr "HTTP-insamling:"
 
 #: UI/GTK2/src/prefsDialog_glade.cc:66
 msgid "Google API key:"
@@ -715,23 +715,21 @@
 msgid "Query parameters"
 msgstr "Fr?geparametrar"
 
-#: UI/GTK2/src/ResultsTree.cpp:116
+#: UI/GTK2/src/ResultsTree.cpp:117
 msgid "Score"
 msgstr "Betyg"
 
-#: UI/GTK2/src/ResultsTree.cpp:165
+#: UI/GTK2/src/ResultsTree.cpp:174
 msgid "Extract"
 msgstr "Utdrag"
 
 #: UI/GTK2/src/statisticsDialog.cc:69
-#, fuzzy
 msgid "Indexes"
-msgstr "Indexerade"
+msgstr "Index"
 
 #: UI/GTK2/src/statisticsDialog.cc:83 UI/GTK2/src/statisticsDialog.cc:97
-#, fuzzy
 msgid "documents"
-msgstr "Mina dokument"
+msgstr "dokument"
 
 #: UI/GTK2/src/statisticsDialog.cc:102
 #, fuzzy
@@ -762,8 +760,9 @@
 msgstr ""
 
 #: UI/GTK2/src/statisticsDialog.cc:143
+#, fuzzy
 msgid "Crawled"
-msgstr ""
+msgstr "Insamlare"
 
 #: UI/GTK2/src/statisticsDialog.cc:143
 msgid "files"
@@ -771,67 +770,67 @@
 
 #: UI/GTK2/src/statisticsDialog.cc:166
 msgid "Errors"
-msgstr ""
+msgstr "Fel"
 
-#: UI/GTK2/src/WorkerThreads.cpp:321
+#: UI/GTK2/src/WorkerThreads.cpp:322
 msgid "Can't index mail here"
 msgstr "Kan inte indexera post h?r"
 
-#: UI/GTK2/src/WorkerThreads.cpp:342
+#: UI/GTK2/src/WorkerThreads.cpp:343
 msgid "is already being indexed"
 msgstr "h?ller redan p? att bli indexerad"
 
-#: UI/GTK2/src/WorkerThreads.cpp:352
+#: UI/GTK2/src/WorkerThreads.cpp:353
 msgid "is blacklisted"
 msgstr "?r svartlistad"
 
-#: UI/GTK2/src/WorkerThreads.cpp:663 UI/GTK2/src/WorkerThreads.cpp:936
-#: UI/GTK2/src/WorkerThreads.cpp:1022 UI/GTK2/src/WorkerThreads.cpp:1031
-#: UI/GTK2/src/WorkerThreads.cpp:1203 UI/GTK2/src/WorkerThreads.cpp:1463
-#: UI/GTK2/src/WorkerThreads.cpp:1596
+#: UI/GTK2/src/WorkerThreads.cpp:664 UI/GTK2/src/WorkerThreads.cpp:962
+#: UI/GTK2/src/WorkerThreads.cpp:1047 UI/GTK2/src/WorkerThreads.cpp:1056
+#: UI/GTK2/src/WorkerThreads.cpp:1228 UI/GTK2/src/WorkerThreads.cpp:1488
+#: UI/GTK2/src/WorkerThreads.cpp:1621
 msgid "Index error on"
 msgstr "Indexfel p?"
 
-#: UI/GTK2/src/WorkerThreads.cpp:784 UI/GTK2/src/WorkerThreads.cpp:957
+#: UI/GTK2/src/WorkerThreads.cpp:785 UI/GTK2/src/WorkerThreads.cpp:983
 msgid "Couldn't create search engine"
 msgstr "Kunde inte skapa s?kmotor"
 
-#: UI/GTK2/src/WorkerThreads.cpp:796 UI/GTK2/src/WorkerThreads.cpp:971
+#: UI/GTK2/src/WorkerThreads.cpp:797 UI/GTK2/src/WorkerThreads.cpp:997
 msgid "Couldn't run query on search engine"
 msgstr "Kunde inte k?ra fr?ga p? s?kmotor"
 
-#: UI/GTK2/src/WorkerThreads.cpp:830
+#: UI/GTK2/src/WorkerThreads.cpp:842
 msgid "No title"
 msgstr "Ingen titel"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1125
+#: UI/GTK2/src/WorkerThreads.cpp:1150
 msgid "Couldn't obtain downloader for protocol"
 msgstr "Kunde inte f? protokollh?mtare"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1136
+#: UI/GTK2/src/WorkerThreads.cpp:1161
 msgid "Couldn't retrieve"
 msgstr "Kunde inte h?mta"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1233 UI/GTK2/src/WorkerThreads.cpp:1309
+#: UI/GTK2/src/WorkerThreads.cpp:1258 UI/GTK2/src/WorkerThreads.cpp:1334
 msgid "Cannot index document type"
 msgstr "Kan inte indexera dokumenttyp"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1237 UI/GTK2/src/WorkerThreads.cpp:1313
+#: UI/GTK2/src/WorkerThreads.cpp:1262 UI/GTK2/src/WorkerThreads.cpp:1338
 msgid "at"
 msgstr "p?"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1344
+#: UI/GTK2/src/WorkerThreads.cpp:1369
 msgid "Robots META tag forbids indexing"
 msgstr "Robots META-tagg f?rbjuder indexering"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1395
+#: UI/GTK2/src/WorkerThreads.cpp:1420
 msgid "Couldn't index"
 msgstr "Kunde inte indexera"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1474
+#: UI/GTK2/src/WorkerThreads.cpp:1499
 msgid "Couldn't unindex document(s)"
 msgstr "Kunde inte avindexera dokument"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1608
+#: UI/GTK2/src/WorkerThreads.cpp:1633
 msgid "Couldn't update document"
 msgstr "Kunde inte uppdatera dokument"



From fabricecolin at mail.berlios.de  Tue Feb 20 07:09:23 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 20 Feb 2007 07:09:23 +0100
Subject: [Pinot-svn] r729 - trunk/po
Message-ID: <200702200609.l1K69NFM031695@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-20 07:09:21 +0100 (Tue, 20 Feb 2007)
New Revision: 729

Modified:
   trunk/po/es.po
   trunk/po/fr.po
   trunk/po/nl.po
   trunk/po/pt_BR.po
   trunk/po/ru.po
Log:
Commit current po files before I import them into Rosetta.


Modified: trunk/po/es.po
===================================================================
--- trunk/po/es.po	2007-02-20 06:03:43 UTC (rev 728)
+++ trunk/po/es.po	2007-02-20 06:09:21 UTC (rev 729)
@@ -28,22 +28,24 @@
 #: UI/GTK2/src/EnginesTree.cpp:339 UI/GTK2/src/mainWindow.cc:325
 #: UI/GTK2/src/mainWindow.cc:328 UI/GTK2/src/mainWindow.cc:541
 #: UI/GTK2/src/mainWindow.cc:1186 UI/GTK2/src/mainWindow.cc:1229
-#: UI/GTK2/src/mainWindow.cc:1249 UI/GTK2/src/mainWindow.cc:1280
-#: UI/GTK2/src/mainWindow.cc:1859 UI/GTK2/src/PinotSettings.cpp:241
+#: UI/GTK2/src/mainWindow.cc:1251 UI/GTK2/src/mainWindow.cc:1282
+#: UI/GTK2/src/mainWindow.cc:1855 UI/GTK2/src/PinotSettings.cpp:241
 #: UI/GTK2/src/PinotSettings.cpp:1281 UI/GTK2/src/PinotSettings.cpp:1337
-#: UI/GTK2/src/statisticsDialog.cc:88 UI/GTK2/src/WorkerThreads.cpp:859
+#: UI/GTK2/src/statisticsDialog.cc:88 UI/GTK2/src/WorkerThreads.cpp:820
+#: UI/GTK2/src/WorkerThreads.cpp:879
 msgid "My Web Pages"
 msgstr "Mis Paginas Web"
 
 #: UI/GTK2/src/EnginesTree.cpp:340 UI/GTK2/src/mainWindow.cc:319
 #: UI/GTK2/src/mainWindow.cc:322 UI/GTK2/src/PinotSettings.cpp:242
 #: UI/GTK2/src/PinotSettings.cpp:1282 UI/GTK2/src/PinotSettings.cpp:1338
-#: UI/GTK2/src/statisticsDialog.cc:74 UI/GTK2/src/WorkerThreads.cpp:867
+#: UI/GTK2/src/statisticsDialog.cc:74 UI/GTK2/src/WorkerThreads.cpp:825
+#: UI/GTK2/src/WorkerThreads.cpp:889
 msgid "My Documents"
 msgstr "Mis documentos"
 
 #: UI/GTK2/src/dateDialog_glade.cc:76 UI/GTK2/src/queryDialog_glade.cc:91
-#: UI/GTK2/src/queryDialog_glade.cc:92
+#: UI/GTK2/src/queryDialog_glade.cc:92 UI/GTK2/src/ResultsTree.cpp:145
 msgid "Date"
 msgstr "Date"
 
@@ -105,17 +107,17 @@
 msgid "Import"
 msgstr "Importar"
 
-#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:221
+#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:217
 msgid "Import URL"
 msgstr "Importar una URL"
 
 #: UI/GTK2/src/IndexTree.cpp:68 UI/GTK2/src/queryDialog.cc:139
-#: UI/GTK2/src/ResultsTree.cpp:126
+#: UI/GTK2/src/ResultsTree.cpp:127
 msgid "Title"
 msgstr "T?tulo"
 
 #: UI/GTK2/src/IndexTree.cpp:73 UI/GTK2/src/queryDialog.cc:142
-#: UI/GTK2/src/ResultsTree.cpp:136
+#: UI/GTK2/src/ResultsTree.cpp:137
 msgid "URL"
 msgstr "URL"
 
@@ -209,7 +211,7 @@
 msgid "Query"
 msgstr "B?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:924 UI/GTK2/src/mainWindow.cc:2922
+#: UI/GTK2/src/mainWindow.cc:924 UI/GTK2/src/mainWindow.cc:2923
 msgid "on"
 msgstr "en"
 
@@ -233,224 +235,224 @@
 msgid "Indexed"
 msgstr "Indizado"
 
-#: UI/GTK2/src/mainWindow.cc:1250
+#: UI/GTK2/src/mainWindow.cc:1252
 msgid "Unindexed document(s)"
 msgstr "Documento(s) no indizado(s)"
 
-#: UI/GTK2/src/mainWindow.cc:1291
+#: UI/GTK2/src/mainWindow.cc:1293
 msgid "Updated document properties"
 msgstr "Propiedades del documento actualizadas"
 
-#: UI/GTK2/src/mainWindow.cc:1338
+#: UI/GTK2/src/mainWindow.cc:1346
 msgid "Couldn't rename index, name"
 msgstr "No se pudo renombrar ?ndice, nombre"
 
-#: UI/GTK2/src/mainWindow.cc:1342 UI/GTK2/src/mainWindow.cc:2246
-#: UI/GTK2/src/mainWindow.cc:2757
+#: UI/GTK2/src/mainWindow.cc:1350 UI/GTK2/src/mainWindow.cc:2242
+#: UI/GTK2/src/mainWindow.cc:2753
 msgid "is already in use"
 msgstr "ya est? en uso"
 
-#: UI/GTK2/src/mainWindow.cc:1355
+#: UI/GTK2/src/mainWindow.cc:1363
 msgid "Couldn't rename index"
 msgstr "No se pudo renombrar el ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:1368
+#: UI/GTK2/src/mainWindow.cc:1376
 msgid "Edited index"
 msgstr "?ndice editado"
 
-#: UI/GTK2/src/mainWindow.cc:1753 UI/GTK2/src/mainWindow.cc:2416
+#: UI/GTK2/src/mainWindow.cc:1752 UI/GTK2/src/mainWindow.cc:2412
 msgid "Live query"
 msgstr "B?squeda activa"
 
-#: UI/GTK2/src/mainWindow.cc:1779
+#: UI/GTK2/src/mainWindow.cc:1778
 msgid "Couldn't find query"
 msgstr "No se pudo a?adir la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:1975 UI/GTK2/src/WorkerThreads.cpp:650
-#: UI/GTK2/src/WorkerThreads.cpp:1583
+#: UI/GTK2/src/mainWindow.cc:1971 UI/GTK2/src/WorkerThreads.cpp:651
+#: UI/GTK2/src/WorkerThreads.cpp:1608
 msgid "Index"
 msgstr "?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:1979 UI/GTK2/src/WorkerThreads.cpp:654
-#: UI/GTK2/src/WorkerThreads.cpp:1587
+#: UI/GTK2/src/mainWindow.cc:1975 UI/GTK2/src/WorkerThreads.cpp:655
+#: UI/GTK2/src/WorkerThreads.cpp:1612
 msgid "doesn't exist"
 msgstr "no existe"
 
-#: UI/GTK2/src/mainWindow.cc:2133
+#: UI/GTK2/src/mainWindow.cc:2129
 msgid "Remove this document from the index ?"
 msgstr "?Borrar este documento del ?ndice?"
 
-#: UI/GTK2/src/mainWindow.cc:2152
+#: UI/GTK2/src/mainWindow.cc:2148
 msgid "Remove these documents from the index ?"
 msgstr "?Borrar este documento del ?ndice?"
 
-#: UI/GTK2/src/mainWindow.cc:2196
+#: UI/GTK2/src/mainWindow.cc:2192
 msgid "A metasearch tool for the Free Desktop"
 msgstr "Una herramienta metabuscador para el escritorio libre"
 
-#: UI/GTK2/src/mainWindow.cc:2197
+#: UI/GTK2/src/mainWindow.cc:2193
 msgid "Search the Web and your documents !"
-msgstr ""
+msgstr "Busca en el web y en sus documentos"
 
-#: UI/GTK2/src/mainWindow.cc:2198
+#: UI/GTK2/src/mainWindow.cc:2194
 msgid "(C) 2005 Fabrice Colin"
 msgstr "(C) 2005 Fabrice Colin"
 
-#: UI/GTK2/src/mainWindow.cc:2242
+#: UI/GTK2/src/mainWindow.cc:2238
 msgid "Index name"
 msgstr "Nombre del ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2257
+#: UI/GTK2/src/mainWindow.cc:2253
 msgid "Couldn't add index"
 msgstr "No se pudo a?adir el ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2271
+#: UI/GTK2/src/mainWindow.cc:2267
 msgid "Added new index"
 msgstr "A?adido un nuevo ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2306
+#: UI/GTK2/src/mainWindow.cc:2302
 msgid "Couldn't remove index"
 msgstr "No se pudo borrar el ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2571
+#: UI/GTK2/src/mainWindow.cc:2567
 msgid "At least one task hasn't completed yet. Quit now ?"
 msgstr "Al menos una tarea no ha finalizado. ?Parar ahora?"
 
-#: UI/GTK2/src/mainWindow.cc:2753
+#: UI/GTK2/src/mainWindow.cc:2749
 msgid "Query name"
 msgstr "Nombre la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:2780
+#: UI/GTK2/src/mainWindow.cc:2776
 msgid "Couldn't update query"
 msgstr "No se pudo actualizar la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:2788
+#: UI/GTK2/src/mainWindow.cc:2784
 msgid "Edited query"
 msgstr "B?squeda editada"
 
-#: UI/GTK2/src/mainWindow.cc:2795
+#: UI/GTK2/src/mainWindow.cc:2791
 msgid "Couldn't add query"
 msgstr "No se pudo a?adir la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:2803
+#: UI/GTK2/src/mainWindow.cc:2799
 msgid "Added new query"
 msgstr "A?adida una nueva b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:2816
+#: UI/GTK2/src/mainWindow.cc:2812
 msgid "Query is not set"
 msgstr "B?squeda no definida"
 
-#: UI/GTK2/src/mainWindow.cc:2827
+#: UI/GTK2/src/mainWindow.cc:2823
 msgid "No search engine selected"
 msgstr "Motor de b?squeda no seleccionado"
 
-#: UI/GTK2/src/mainWindow.cc:2909
+#: UI/GTK2/src/mainWindow.cc:2910
 msgid "Please set the Google API key first"
 msgstr "Por favor, primero configure el API de Google"
 
-#: UI/GTK2/src/mainWindow.cc:2918
+#: UI/GTK2/src/mainWindow.cc:2919
 msgid "Running query"
 msgstr "Ejecutando la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:3102
+#: UI/GTK2/src/mainWindow.cc:3103
 msgid "No default application defined for type"
 msgstr "No hay aplicaci?n predefinida para el tipo"
 
-#: UI/GTK2/src/mainWindow_glade.cc:126
+#: UI/GTK2/src/mainWindow_glade.cc:125
 msgid "Query:"
 msgstr "B?squeda:"
 
-#: UI/GTK2/src/mainWindow_glade.cc:138
+#: UI/GTK2/src/mainWindow_glade.cc:137
 msgid "Edit"
 msgstr "Editar"
 
-#: UI/GTK2/src/mainWindow_glade.cc:147
+#: UI/GTK2/src/mainWindow_glade.cc:146
 msgid "Stored queries"
 msgstr "B?squedas guardadas"
 
-#: UI/GTK2/src/mainWindow_glade.cc:161 UI/GTK2/src/statisticsDialog.cc:46
+#: UI/GTK2/src/mainWindow_glade.cc:163 UI/GTK2/src/statisticsDialog.cc:46
 #: UI/GTK2/src/statisticsDialog_glade.cc:87
 msgid "Status"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow_glade.cc:188
+#: UI/GTK2/src/mainWindow_glade.cc:184
 msgid "Search Engine"
 msgstr "Motor de b?squeda"
 
-#: UI/GTK2/src/mainWindow_glade.cc:191
+#: UI/GTK2/src/mainWindow_glade.cc:187
 msgid "Host Name"
 msgstr "Nombre del servidor"
 
-#: UI/GTK2/src/mainWindow_glade.cc:194
+#: UI/GTK2/src/mainWindow_glade.cc:190
 msgid "Show Extract"
 msgstr "Mostrar extra?dos"
 
-#: UI/GTK2/src/mainWindow_glade.cc:197
+#: UI/GTK2/src/mainWindow_glade.cc:193
 msgid "Group By"
 msgstr "Agrupar por"
 
-#: UI/GTK2/src/mainWindow_glade.cc:200
+#: UI/GTK2/src/mainWindow_glade.cc:196
 msgid "Clear List"
 msgstr "Limpiar la lista"
 
-#: UI/GTK2/src/mainWindow_glade.cc:206
+#: UI/GTK2/src/mainWindow_glade.cc:202
 msgid "Vie_w"
 msgstr "Ver"
 
-#: UI/GTK2/src/mainWindow_glade.cc:209
+#: UI/GTK2/src/mainWindow_glade.cc:205
 msgid "View Cache"
 msgstr "Ver la cache"
 
-#: UI/GTK2/src/mainWindow_glade.cc:212
+#: UI/GTK2/src/mainWindow_glade.cc:208
 msgid "More Like This"
 msgstr "Documentos similares"
 
-#: UI/GTK2/src/mainWindow_glade.cc:215 UI/GTK2/src/mainWindow_glade.cc:251
+#: UI/GTK2/src/mainWindow_glade.cc:211 UI/GTK2/src/mainWindow_glade.cc:247
 msgid "_Index"
 msgstr "?ndice"
 
-#: UI/GTK2/src/mainWindow_glade.cc:218
+#: UI/GTK2/src/mainWindow_glade.cc:214
 msgid "List Contents Of"
 msgstr "Listar el contenido de"
 
-#: UI/GTK2/src/mainWindow_glade.cc:227
+#: UI/GTK2/src/mainWindow_glade.cc:223
 msgid "View"
 msgstr "Ver"
 
-#: UI/GTK2/src/mainWindow_glade.cc:230
+#: UI/GTK2/src/mainWindow_glade.cc:226
 msgid "Update"
 msgstr "Actualizar"
 
-#: UI/GTK2/src/mainWindow_glade.cc:233
+#: UI/GTK2/src/mainWindow_glade.cc:229
 msgid "Unindex"
 msgstr "Des-indizar"
 
-#: UI/GTK2/src/mainWindow_glade.cc:236
+#: UI/GTK2/src/mainWindow_glade.cc:232
 #: UI/GTK2/src/propertiesDialog_glade.cc:177
 msgid "Properties"
 msgstr "Propiedades"
 
-#: UI/GTK2/src/mainWindow_glade.cc:239
+#: UI/GTK2/src/mainWindow_glade.cc:235
 msgid "_About"
 msgstr "Sobre"
 
-#: UI/GTK2/src/mainWindow_glade.cc:242
+#: UI/GTK2/src/mainWindow_glade.cc:238
 msgid "_Session"
 msgstr "Sesi?n"
 
-#: UI/GTK2/src/mainWindow_glade.cc:245
+#: UI/GTK2/src/mainWindow_glade.cc:241
 msgid "_Edit"
 msgstr "Editar"
 
-#: UI/GTK2/src/mainWindow_glade.cc:248
+#: UI/GTK2/src/mainWindow_glade.cc:244
 msgid "_Results"
 msgstr "Resultados"
 
-#: UI/GTK2/src/mainWindow_glade.cc:254
+#: UI/GTK2/src/mainWindow_glade.cc:250
 msgid "_Help"
 msgstr "Ayuda"
 
-#: UI/GTK2/src/mainWindow_glade.cc:391
+#: UI/GTK2/src/mainWindow_glade.cc:387
 msgid "Pinot"
 msgstr "Pinot"
 
@@ -708,11 +710,11 @@
 msgid "Query parameters"
 msgstr "Par?metros de b?squeda"
 
-#: UI/GTK2/src/ResultsTree.cpp:116
+#: UI/GTK2/src/ResultsTree.cpp:117
 msgid "Score"
 msgstr "Cuenta"
 
-#: UI/GTK2/src/ResultsTree.cpp:165
+#: UI/GTK2/src/ResultsTree.cpp:174
 msgid "Extract"
 msgstr "Extra?dos"
 
@@ -763,65 +765,65 @@
 msgid "Errors"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:321
+#: UI/GTK2/src/WorkerThreads.cpp:322
 msgid "Can't index mail here"
 msgstr "No se pudo indizar el buzon de correo"
 
-#: UI/GTK2/src/WorkerThreads.cpp:342
+#: UI/GTK2/src/WorkerThreads.cpp:343
 msgid "is already being indexed"
 msgstr "ya est? indizado"
 
-#: UI/GTK2/src/WorkerThreads.cpp:352
+#: UI/GTK2/src/WorkerThreads.cpp:353
 msgid "is blacklisted"
 msgstr "ya excluido"
 
-#: UI/GTK2/src/WorkerThreads.cpp:663 UI/GTK2/src/WorkerThreads.cpp:936
-#: UI/GTK2/src/WorkerThreads.cpp:1022 UI/GTK2/src/WorkerThreads.cpp:1031
-#: UI/GTK2/src/WorkerThreads.cpp:1203 UI/GTK2/src/WorkerThreads.cpp:1463
-#: UI/GTK2/src/WorkerThreads.cpp:1596
+#: UI/GTK2/src/WorkerThreads.cpp:664 UI/GTK2/src/WorkerThreads.cpp:962
+#: UI/GTK2/src/WorkerThreads.cpp:1047 UI/GTK2/src/WorkerThreads.cpp:1056
+#: UI/GTK2/src/WorkerThreads.cpp:1228 UI/GTK2/src/WorkerThreads.cpp:1488
+#: UI/GTK2/src/WorkerThreads.cpp:1621
 msgid "Index error on"
 msgstr "Error en el ?ndice"
 
-#: UI/GTK2/src/WorkerThreads.cpp:784 UI/GTK2/src/WorkerThreads.cpp:957
+#: UI/GTK2/src/WorkerThreads.cpp:785 UI/GTK2/src/WorkerThreads.cpp:983
 msgid "Couldn't create search engine"
 msgstr "No se pudo crear el motor de b?squeda"
 
-#: UI/GTK2/src/WorkerThreads.cpp:796 UI/GTK2/src/WorkerThreads.cpp:971
+#: UI/GTK2/src/WorkerThreads.cpp:797 UI/GTK2/src/WorkerThreads.cpp:997
 msgid "Couldn't run query on search engine"
 msgstr "No se pudo ejecutar la b?squeda contra el motor"
 
-#: UI/GTK2/src/WorkerThreads.cpp:830
+#: UI/GTK2/src/WorkerThreads.cpp:842
 msgid "No title"
 msgstr "Sin t?tulo"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1125
+#: UI/GTK2/src/WorkerThreads.cpp:1150
 msgid "Couldn't obtain downloader for protocol"
 msgstr "No se pudo usar un recuperador para el protocolo"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1136
+#: UI/GTK2/src/WorkerThreads.cpp:1161
 msgid "Couldn't retrieve"
 msgstr "No se pudo descargar"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1233 UI/GTK2/src/WorkerThreads.cpp:1309
+#: UI/GTK2/src/WorkerThreads.cpp:1258 UI/GTK2/src/WorkerThreads.cpp:1334
 msgid "Cannot index document type"
 msgstr "No se pudo indizar el tipo de documento"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1237 UI/GTK2/src/WorkerThreads.cpp:1313
+#: UI/GTK2/src/WorkerThreads.cpp:1262 UI/GTK2/src/WorkerThreads.cpp:1338
 msgid "at"
 msgstr "a"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1344
+#: UI/GTK2/src/WorkerThreads.cpp:1369
 msgid "Robots META tag forbids indexing"
 msgstr "La etiqueta META Robots proh?be la indizaci?n"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1395
+#: UI/GTK2/src/WorkerThreads.cpp:1420
 msgid "Couldn't index"
 msgstr "No se pudo indizar"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1474
+#: UI/GTK2/src/WorkerThreads.cpp:1499
 msgid "Couldn't unindex document(s)"
 msgstr "No se pudo des-indizar lo(s) documento(s)"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1608
+#: UI/GTK2/src/WorkerThreads.cpp:1633
 msgid "Couldn't update document"
 msgstr "No se pudo actualizar el documento"

Modified: trunk/po/fr.po
===================================================================
--- trunk/po/fr.po	2007-02-20 06:03:43 UTC (rev 728)
+++ trunk/po/fr.po	2007-02-20 06:09:21 UTC (rev 729)
@@ -28,22 +28,24 @@
 #: UI/GTK2/src/EnginesTree.cpp:339 UI/GTK2/src/mainWindow.cc:325
 #: UI/GTK2/src/mainWindow.cc:328 UI/GTK2/src/mainWindow.cc:541
 #: UI/GTK2/src/mainWindow.cc:1186 UI/GTK2/src/mainWindow.cc:1229
-#: UI/GTK2/src/mainWindow.cc:1249 UI/GTK2/src/mainWindow.cc:1280
-#: UI/GTK2/src/mainWindow.cc:1859 UI/GTK2/src/PinotSettings.cpp:241
+#: UI/GTK2/src/mainWindow.cc:1251 UI/GTK2/src/mainWindow.cc:1282
+#: UI/GTK2/src/mainWindow.cc:1855 UI/GTK2/src/PinotSettings.cpp:241
 #: UI/GTK2/src/PinotSettings.cpp:1281 UI/GTK2/src/PinotSettings.cpp:1337
-#: UI/GTK2/src/statisticsDialog.cc:88 UI/GTK2/src/WorkerThreads.cpp:859
+#: UI/GTK2/src/statisticsDialog.cc:88 UI/GTK2/src/WorkerThreads.cpp:820
+#: UI/GTK2/src/WorkerThreads.cpp:879
 msgid "My Web Pages"
 msgstr "Mes Pages Web"
 
 #: UI/GTK2/src/EnginesTree.cpp:340 UI/GTK2/src/mainWindow.cc:319
 #: UI/GTK2/src/mainWindow.cc:322 UI/GTK2/src/PinotSettings.cpp:242
 #: UI/GTK2/src/PinotSettings.cpp:1282 UI/GTK2/src/PinotSettings.cpp:1338
-#: UI/GTK2/src/statisticsDialog.cc:74 UI/GTK2/src/WorkerThreads.cpp:867
+#: UI/GTK2/src/statisticsDialog.cc:74 UI/GTK2/src/WorkerThreads.cpp:825
+#: UI/GTK2/src/WorkerThreads.cpp:889
 msgid "My Documents"
 msgstr "Mes Documents"
 
 #: UI/GTK2/src/dateDialog_glade.cc:76 UI/GTK2/src/queryDialog_glade.cc:91
-#: UI/GTK2/src/queryDialog_glade.cc:92
+#: UI/GTK2/src/queryDialog_glade.cc:92 UI/GTK2/src/ResultsTree.cpp:145
 msgid "Date"
 msgstr "Date"
 
@@ -104,17 +106,17 @@
 msgid "Import"
 msgstr "Importer"
 
-#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:221
+#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:217
 msgid "Import URL"
 msgstr "Importer une URL"
 
 #: UI/GTK2/src/IndexTree.cpp:68 UI/GTK2/src/queryDialog.cc:139
-#: UI/GTK2/src/ResultsTree.cpp:126
+#: UI/GTK2/src/ResultsTree.cpp:127
 msgid "Title"
 msgstr "Titre"
 
 #: UI/GTK2/src/IndexTree.cpp:73 UI/GTK2/src/queryDialog.cc:142
-#: UI/GTK2/src/ResultsTree.cpp:136
+#: UI/GTK2/src/ResultsTree.cpp:137
 msgid "URL"
 msgstr "URL"
 
@@ -210,7 +212,7 @@
 msgid "Query"
 msgstr "La recherche"
 
-#: UI/GTK2/src/mainWindow.cc:924 UI/GTK2/src/mainWindow.cc:2922
+#: UI/GTK2/src/mainWindow.cc:924 UI/GTK2/src/mainWindow.cc:2923
 msgid "on"
 msgstr "sur"
 
@@ -234,224 +236,224 @@
 msgid "Indexed"
 msgstr "Indexe"
 
-#: UI/GTK2/src/mainWindow.cc:1250
+#: UI/GTK2/src/mainWindow.cc:1252
 msgid "Unindexed document(s)"
 msgstr "Desindexe le(s) document(s)"
 
-#: UI/GTK2/src/mainWindow.cc:1291
+#: UI/GTK2/src/mainWindow.cc:1293
 msgid "Updated document properties"
 msgstr "Mis a jour les proprietes du document"
 
-#: UI/GTK2/src/mainWindow.cc:1338
+#: UI/GTK2/src/mainWindow.cc:1346
 msgid "Couldn't rename index, name"
 msgstr "N'a pas pu renommer l'index, le nom"
 
-#: UI/GTK2/src/mainWindow.cc:1342 UI/GTK2/src/mainWindow.cc:2246
-#: UI/GTK2/src/mainWindow.cc:2757
+#: UI/GTK2/src/mainWindow.cc:1350 UI/GTK2/src/mainWindow.cc:2242
+#: UI/GTK2/src/mainWindow.cc:2753
 msgid "is already in use"
 msgstr "est deja utilise"
 
-#: UI/GTK2/src/mainWindow.cc:1355
+#: UI/GTK2/src/mainWindow.cc:1363
 msgid "Couldn't rename index"
 msgstr "N'a pas pu renommer l'index"
 
-#: UI/GTK2/src/mainWindow.cc:1368
+#: UI/GTK2/src/mainWindow.cc:1376
 msgid "Edited index"
 msgstr "Edite l'index"
 
-#: UI/GTK2/src/mainWindow.cc:1753 UI/GTK2/src/mainWindow.cc:2416
+#: UI/GTK2/src/mainWindow.cc:1752 UI/GTK2/src/mainWindow.cc:2412
 msgid "Live query"
 msgstr "Recherche"
 
-#: UI/GTK2/src/mainWindow.cc:1779
+#: UI/GTK2/src/mainWindow.cc:1778
 msgid "Couldn't find query"
 msgstr "N'a pas pu trouver"
 
-#: UI/GTK2/src/mainWindow.cc:1975 UI/GTK2/src/WorkerThreads.cpp:650
-#: UI/GTK2/src/WorkerThreads.cpp:1583
+#: UI/GTK2/src/mainWindow.cc:1971 UI/GTK2/src/WorkerThreads.cpp:651
+#: UI/GTK2/src/WorkerThreads.cpp:1608
 msgid "Index"
 msgstr "L'index"
 
-#: UI/GTK2/src/mainWindow.cc:1979 UI/GTK2/src/WorkerThreads.cpp:654
-#: UI/GTK2/src/WorkerThreads.cpp:1587
+#: UI/GTK2/src/mainWindow.cc:1975 UI/GTK2/src/WorkerThreads.cpp:655
+#: UI/GTK2/src/WorkerThreads.cpp:1612
 msgid "doesn't exist"
 msgstr "n'existe pas"
 
-#: UI/GTK2/src/mainWindow.cc:2133
+#: UI/GTK2/src/mainWindow.cc:2129
 msgid "Remove this document from the index ?"
 msgstr "Enlever ce document de l'index ?"
 
-#: UI/GTK2/src/mainWindow.cc:2152
+#: UI/GTK2/src/mainWindow.cc:2148
 msgid "Remove these documents from the index ?"
 msgstr "Enlever ces documents de l'index ?"
 
-#: UI/GTK2/src/mainWindow.cc:2196
+#: UI/GTK2/src/mainWindow.cc:2192
 msgid "A metasearch tool for the Free Desktop"
 msgstr "Un outil de recherche pour le Bureau Libre"
 
-#: UI/GTK2/src/mainWindow.cc:2197
+#: UI/GTK2/src/mainWindow.cc:2193
 msgid "Search the Web and your documents !"
 msgstr "Cherche le Web et vos documents"
 
-#: UI/GTK2/src/mainWindow.cc:2198
+#: UI/GTK2/src/mainWindow.cc:2194
 msgid "(C) 2005 Fabrice Colin"
 msgstr "(C) 2005 Fabrice Colin"
 
-#: UI/GTK2/src/mainWindow.cc:2242
+#: UI/GTK2/src/mainWindow.cc:2238
 msgid "Index name"
 msgstr "Nom de l'index"
 
-#: UI/GTK2/src/mainWindow.cc:2257
+#: UI/GTK2/src/mainWindow.cc:2253
 msgid "Couldn't add index"
 msgstr "N'a pas pu ajouter l'index"
 
-#: UI/GTK2/src/mainWindow.cc:2271
+#: UI/GTK2/src/mainWindow.cc:2267
 msgid "Added new index"
 msgstr "Ajoute un nouvel index"
 
-#: UI/GTK2/src/mainWindow.cc:2306
+#: UI/GTK2/src/mainWindow.cc:2302
 msgid "Couldn't remove index"
 msgstr "N'a pas pu enlever l'index"
 
-#: UI/GTK2/src/mainWindow.cc:2571
+#: UI/GTK2/src/mainWindow.cc:2567
 msgid "At least one task hasn't completed yet. Quit now ?"
 msgstr "Au moins une tache n'est pas terminee. Quitter maintenant ?"
 
-#: UI/GTK2/src/mainWindow.cc:2753
+#: UI/GTK2/src/mainWindow.cc:2749
 msgid "Query name"
 msgstr "Nom de la recherche"
 
-#: UI/GTK2/src/mainWindow.cc:2780
+#: UI/GTK2/src/mainWindow.cc:2776
 msgid "Couldn't update query"
 msgstr "N'a pas pu mettre a jour la recherche"
 
-#: UI/GTK2/src/mainWindow.cc:2788
+#: UI/GTK2/src/mainWindow.cc:2784
 msgid "Edited query"
 msgstr "Edite la recherche"
 
-#: UI/GTK2/src/mainWindow.cc:2795
+#: UI/GTK2/src/mainWindow.cc:2791
 msgid "Couldn't add query"
 msgstr "N'a pas pu ajouter la recherche"
 
-#: UI/GTK2/src/mainWindow.cc:2803
+#: UI/GTK2/src/mainWindow.cc:2799
 msgid "Added new query"
 msgstr "Ajoute une nouvelle recherche"
 
-#: UI/GTK2/src/mainWindow.cc:2816
+#: UI/GTK2/src/mainWindow.cc:2812
 msgid "Query is not set"
 msgstr "Recherche indefinie"
 
-#: UI/GTK2/src/mainWindow.cc:2827
+#: UI/GTK2/src/mainWindow.cc:2823
 msgid "No search engine selected"
 msgstr "Pas de moteur selectionne"
 
-#: UI/GTK2/src/mainWindow.cc:2909
+#: UI/GTK2/src/mainWindow.cc:2910
 msgid "Please set the Google API key first"
 msgstr "Configurez la clef de l'API Google"
 
-#: UI/GTK2/src/mainWindow.cc:2918
+#: UI/GTK2/src/mainWindow.cc:2919
 msgid "Running query"
 msgstr "Recherche en cours"
 
-#: UI/GTK2/src/mainWindow.cc:3102
+#: UI/GTK2/src/mainWindow.cc:3103
 msgid "No default application defined for type"
 msgstr "Pas d'application definie pour le type"
 
-#: UI/GTK2/src/mainWindow_glade.cc:126
+#: UI/GTK2/src/mainWindow_glade.cc:125
 msgid "Query:"
 msgstr "Recherche:"
 
-#: UI/GTK2/src/mainWindow_glade.cc:138
+#: UI/GTK2/src/mainWindow_glade.cc:137
 msgid "Edit"
 msgstr "Editer"
 
-#: UI/GTK2/src/mainWindow_glade.cc:147
+#: UI/GTK2/src/mainWindow_glade.cc:146
 msgid "Stored queries"
 msgstr "Recherches sauvegardees"
 
-#: UI/GTK2/src/mainWindow_glade.cc:161 UI/GTK2/src/statisticsDialog.cc:46
+#: UI/GTK2/src/mainWindow_glade.cc:163 UI/GTK2/src/statisticsDialog.cc:46
 #: UI/GTK2/src/statisticsDialog_glade.cc:87
 msgid "Status"
 msgstr "Statistiques"
 
-#: UI/GTK2/src/mainWindow_glade.cc:188
+#: UI/GTK2/src/mainWindow_glade.cc:184
 msgid "Search Engine"
 msgstr "Moteur"
 
-#: UI/GTK2/src/mainWindow_glade.cc:191
+#: UI/GTK2/src/mainWindow_glade.cc:187
 msgid "Host Name"
 msgstr "Nom de Machine"
 
-#: UI/GTK2/src/mainWindow_glade.cc:194
+#: UI/GTK2/src/mainWindow_glade.cc:190
 msgid "Show Extract"
 msgstr "Montrer l'Extrait"
 
-#: UI/GTK2/src/mainWindow_glade.cc:197
+#: UI/GTK2/src/mainWindow_glade.cc:193
 msgid "Group By"
 msgstr "Grouper Par"
 
-#: UI/GTK2/src/mainWindow_glade.cc:200
+#: UI/GTK2/src/mainWindow_glade.cc:196
 msgid "Clear List"
 msgstr "Nettoyer la Liste"
 
-#: UI/GTK2/src/mainWindow_glade.cc:206
+#: UI/GTK2/src/mainWindow_glade.cc:202
 msgid "Vie_w"
 msgstr "Voir"
 
-#: UI/GTK2/src/mainWindow_glade.cc:209
+#: UI/GTK2/src/mainWindow_glade.cc:205
 msgid "View Cache"
 msgstr "Voir le Cache"
 
-#: UI/GTK2/src/mainWindow_glade.cc:212
+#: UI/GTK2/src/mainWindow_glade.cc:208
 msgid "More Like This"
 msgstr "Documents similaires"
 
-#: UI/GTK2/src/mainWindow_glade.cc:215 UI/GTK2/src/mainWindow_glade.cc:251
+#: UI/GTK2/src/mainWindow_glade.cc:211 UI/GTK2/src/mainWindow_glade.cc:247
 msgid "_Index"
 msgstr "Index"
 
-#: UI/GTK2/src/mainWindow_glade.cc:218
+#: UI/GTK2/src/mainWindow_glade.cc:214
 msgid "List Contents Of"
 msgstr "Lister le Contenu de"
 
-#: UI/GTK2/src/mainWindow_glade.cc:227
+#: UI/GTK2/src/mainWindow_glade.cc:223
 msgid "View"
 msgstr "Voir"
 
-#: UI/GTK2/src/mainWindow_glade.cc:230
+#: UI/GTK2/src/mainWindow_glade.cc:226
 msgid "Update"
 msgstr "Mettre a Jour"
 
-#: UI/GTK2/src/mainWindow_glade.cc:233
+#: UI/GTK2/src/mainWindow_glade.cc:229
 msgid "Unindex"
 msgstr "Desindexer"
 
-#: UI/GTK2/src/mainWindow_glade.cc:236
+#: UI/GTK2/src/mainWindow_glade.cc:232
 #: UI/GTK2/src/propertiesDialog_glade.cc:177
 msgid "Properties"
 msgstr "Proprietes"
 
-#: UI/GTK2/src/mainWindow_glade.cc:239
+#: UI/GTK2/src/mainWindow_glade.cc:235
 msgid "_About"
 msgstr "A Propos"
 
-#: UI/GTK2/src/mainWindow_glade.cc:242
+#: UI/GTK2/src/mainWindow_glade.cc:238
 msgid "_Session"
 msgstr "Session"
 
-#: UI/GTK2/src/mainWindow_glade.cc:245
+#: UI/GTK2/src/mainWindow_glade.cc:241
 msgid "_Edit"
 msgstr "Editer"
 
-#: UI/GTK2/src/mainWindow_glade.cc:248
+#: UI/GTK2/src/mainWindow_glade.cc:244
 msgid "_Results"
 msgstr "Resultats"
 
-#: UI/GTK2/src/mainWindow_glade.cc:254
+#: UI/GTK2/src/mainWindow_glade.cc:250
 msgid "_Help"
 msgstr "Aide"
 
-#: UI/GTK2/src/mainWindow_glade.cc:391
+#: UI/GTK2/src/mainWindow_glade.cc:387
 msgid "Pinot"
 msgstr "Pinot"
 
@@ -709,11 +711,11 @@
 msgid "Query parameters"
 msgstr "Parametres de la recherche"
 
-#: UI/GTK2/src/ResultsTree.cpp:116
+#: UI/GTK2/src/ResultsTree.cpp:117
 msgid "Score"
 msgstr "Score"
 
-#: UI/GTK2/src/ResultsTree.cpp:165
+#: UI/GTK2/src/ResultsTree.cpp:174
 msgid "Extract"
 msgstr "Extrait"
 
@@ -761,65 +763,65 @@
 msgid "Errors"
 msgstr "Erreurs"
 
-#: UI/GTK2/src/WorkerThreads.cpp:321
+#: UI/GTK2/src/WorkerThreads.cpp:322
 msgid "Can't index mail here"
 msgstr "Ne peut pas indexer le courrier ici"
 
-#: UI/GTK2/src/WorkerThreads.cpp:342
+#: UI/GTK2/src/WorkerThreads.cpp:343
 msgid "is already being indexed"
 msgstr "est deja indexe"
 
-#: UI/GTK2/src/WorkerThreads.cpp:352
+#: UI/GTK2/src/WorkerThreads.cpp:353
 msgid "is blacklisted"
 msgstr "est exclus"
 
-#: UI/GTK2/src/WorkerThreads.cpp:663 UI/GTK2/src/WorkerThreads.cpp:936
-#: UI/GTK2/src/WorkerThreads.cpp:1022 UI/GTK2/src/WorkerThreads.cpp:1031
-#: UI/GTK2/src/WorkerThreads.cpp:1203 UI/GTK2/src/WorkerThreads.cpp:1463
-#: UI/GTK2/src/WorkerThreads.cpp:1596
+#: UI/GTK2/src/WorkerThreads.cpp:664 UI/GTK2/src/WorkerThreads.cpp:962
+#: UI/GTK2/src/WorkerThreads.cpp:1047 UI/GTK2/src/WorkerThreads.cpp:1056
+#: UI/GTK2/src/WorkerThreads.cpp:1228 UI/GTK2/src/WorkerThreads.cpp:1488
+#: UI/GTK2/src/WorkerThreads.cpp:1621
 msgid "Index error on"
 msgstr "Erreur sur l'index"
 
-#: UI/GTK2/src/WorkerThreads.cpp:784 UI/GTK2/src/WorkerThreads.cpp:957
+#: UI/GTK2/src/WorkerThreads.cpp:785 UI/GTK2/src/WorkerThreads.cpp:983
 msgid "Couldn't create search engine"
 msgstr "N'a pas pu creer le moteur"
 
-#: UI/GTK2/src/WorkerThreads.cpp:796 UI/GTK2/src/WorkerThreads.cpp:971
+#: UI/GTK2/src/WorkerThreads.cpp:797 UI/GTK2/src/WorkerThreads.cpp:997
 msgid "Couldn't run query on search engine"
 msgstr "N'a pas pu lancer la recherche sur le moteur"
 
-#: UI/GTK2/src/WorkerThreads.cpp:830
+#: UI/GTK2/src/WorkerThreads.cpp:842
 msgid "No title"
 msgstr "Pas de titre"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1125
+#: UI/GTK2/src/WorkerThreads.cpp:1150
 msgid "Couldn't obtain downloader for protocol"
 msgstr "N'a pas pu obtenir un brouteur pour"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1136
+#: UI/GTK2/src/WorkerThreads.cpp:1161
 msgid "Couldn't retrieve"
 msgstr "N'a pas pu telecharger"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1233 UI/GTK2/src/WorkerThreads.cpp:1309
+#: UI/GTK2/src/WorkerThreads.cpp:1258 UI/GTK2/src/WorkerThreads.cpp:1334
 msgid "Cannot index document type"
 msgstr "Impossible d'indexer ce type de documents"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1237 UI/GTK2/src/WorkerThreads.cpp:1313
+#: UI/GTK2/src/WorkerThreads.cpp:1262 UI/GTK2/src/WorkerThreads.cpp:1338
 msgid "at"
 msgstr "a"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1344
+#: UI/GTK2/src/WorkerThreads.cpp:1369
 msgid "Robots META tag forbids indexing"
 msgstr "Le META tag Robots interdit d'indexer"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1395
+#: UI/GTK2/src/WorkerThreads.cpp:1420
 msgid "Couldn't index"
 msgstr "N'a pas pu indexer"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1474
+#: UI/GTK2/src/WorkerThreads.cpp:1499
 msgid "Couldn't unindex document(s)"
 msgstr "N'a pas pu desindexer le(s) document(s)"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1608
+#: UI/GTK2/src/WorkerThreads.cpp:1633
 msgid "Couldn't update document"
 msgstr "N'a pas pu mettre a jour le document"

Modified: trunk/po/nl.po
===================================================================
--- trunk/po/nl.po	2007-02-20 06:03:43 UTC (rev 728)
+++ trunk/po/nl.po	2007-02-20 06:09:21 UTC (rev 729)
@@ -28,22 +28,24 @@
 #: UI/GTK2/src/EnginesTree.cpp:339 UI/GTK2/src/mainWindow.cc:325
 #: UI/GTK2/src/mainWindow.cc:328 UI/GTK2/src/mainWindow.cc:541
 #: UI/GTK2/src/mainWindow.cc:1186 UI/GTK2/src/mainWindow.cc:1229
-#: UI/GTK2/src/mainWindow.cc:1249 UI/GTK2/src/mainWindow.cc:1280
-#: UI/GTK2/src/mainWindow.cc:1859 UI/GTK2/src/PinotSettings.cpp:241
+#: UI/GTK2/src/mainWindow.cc:1251 UI/GTK2/src/mainWindow.cc:1282
+#: UI/GTK2/src/mainWindow.cc:1855 UI/GTK2/src/PinotSettings.cpp:241
 #: UI/GTK2/src/PinotSettings.cpp:1281 UI/GTK2/src/PinotSettings.cpp:1337
-#: UI/GTK2/src/statisticsDialog.cc:88 UI/GTK2/src/WorkerThreads.cpp:859
+#: UI/GTK2/src/statisticsDialog.cc:88 UI/GTK2/src/WorkerThreads.cpp:820
+#: UI/GTK2/src/WorkerThreads.cpp:879
 msgid "My Web Pages"
 msgstr "Mijn webpagina's"
 
 #: UI/GTK2/src/EnginesTree.cpp:340 UI/GTK2/src/mainWindow.cc:319
 #: UI/GTK2/src/mainWindow.cc:322 UI/GTK2/src/PinotSettings.cpp:242
 #: UI/GTK2/src/PinotSettings.cpp:1282 UI/GTK2/src/PinotSettings.cpp:1338
-#: UI/GTK2/src/statisticsDialog.cc:74 UI/GTK2/src/WorkerThreads.cpp:867
+#: UI/GTK2/src/statisticsDialog.cc:74 UI/GTK2/src/WorkerThreads.cpp:825
+#: UI/GTK2/src/WorkerThreads.cpp:889
 msgid "My Documents"
 msgstr "Mijn documenten"
 
 #: UI/GTK2/src/dateDialog_glade.cc:76 UI/GTK2/src/queryDialog_glade.cc:91
-#: UI/GTK2/src/queryDialog_glade.cc:92
+#: UI/GTK2/src/queryDialog_glade.cc:92 UI/GTK2/src/ResultsTree.cpp:145
 #, fuzzy
 msgid "Date"
 msgstr "bij"
@@ -107,17 +109,17 @@
 msgid "Import"
 msgstr "Importeren"
 
-#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:221
+#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:217
 msgid "Import URL"
 msgstr "Importeren URL"
 
 #: UI/GTK2/src/IndexTree.cpp:68 UI/GTK2/src/queryDialog.cc:139
-#: UI/GTK2/src/ResultsTree.cpp:126
+#: UI/GTK2/src/ResultsTree.cpp:127
 msgid "Title"
 msgstr "Titel"
 
 #: UI/GTK2/src/IndexTree.cpp:73 UI/GTK2/src/queryDialog.cc:142
-#: UI/GTK2/src/ResultsTree.cpp:136
+#: UI/GTK2/src/ResultsTree.cpp:137
 msgid "URL"
 msgstr "URL"
 
@@ -213,7 +215,7 @@
 msgid "Query"
 msgstr "Query"
 
-#: UI/GTK2/src/mainWindow.cc:924 UI/GTK2/src/mainWindow.cc:2922
+#: UI/GTK2/src/mainWindow.cc:924 UI/GTK2/src/mainWindow.cc:2923
 msgid "on"
 msgstr "op"
 
@@ -237,226 +239,226 @@
 msgid "Indexed"
 msgstr "Geindexeerd"
 
-#: UI/GTK2/src/mainWindow.cc:1250
+#: UI/GTK2/src/mainWindow.cc:1252
 msgid "Unindexed document(s)"
 msgstr "Niet geindexeerd(e) document(en)"
 
-#: UI/GTK2/src/mainWindow.cc:1291
+#: UI/GTK2/src/mainWindow.cc:1293
 msgid "Updated document properties"
 msgstr "Vernieuwde documenteigenschappen"
 
-#: UI/GTK2/src/mainWindow.cc:1338
+#: UI/GTK2/src/mainWindow.cc:1346
 msgid "Couldn't rename index, name"
 msgstr "Kon index niet hernoemen, naam"
 
-#: UI/GTK2/src/mainWindow.cc:1342 UI/GTK2/src/mainWindow.cc:2246
-#: UI/GTK2/src/mainWindow.cc:2757
+#: UI/GTK2/src/mainWindow.cc:1350 UI/GTK2/src/mainWindow.cc:2242
+#: UI/GTK2/src/mainWindow.cc:2753
 msgid "is already in use"
 msgstr "is reeds in gebruik"
 
-#: UI/GTK2/src/mainWindow.cc:1355
+#: UI/GTK2/src/mainWindow.cc:1363
 msgid "Couldn't rename index"
 msgstr "Kon index niet hernoemen"
 
-#: UI/GTK2/src/mainWindow.cc:1368
+#: UI/GTK2/src/mainWindow.cc:1376
 msgid "Edited index"
 msgstr "Bewerkte index"
 
-#: UI/GTK2/src/mainWindow.cc:1753 UI/GTK2/src/mainWindow.cc:2416
+#: UI/GTK2/src/mainWindow.cc:1752 UI/GTK2/src/mainWindow.cc:2412
 msgid "Live query"
 msgstr "Rechtstreekse query"
 
-#: UI/GTK2/src/mainWindow.cc:1779
+#: UI/GTK2/src/mainWindow.cc:1778
 msgid "Couldn't find query"
 msgstr "Kon query niet vinden"
 
-#: UI/GTK2/src/mainWindow.cc:1975 UI/GTK2/src/WorkerThreads.cpp:650
-#: UI/GTK2/src/WorkerThreads.cpp:1583
+#: UI/GTK2/src/mainWindow.cc:1971 UI/GTK2/src/WorkerThreads.cpp:651
+#: UI/GTK2/src/WorkerThreads.cpp:1608
 msgid "Index"
 msgstr "Inhoudsopgave"
 
-#: UI/GTK2/src/mainWindow.cc:1979 UI/GTK2/src/WorkerThreads.cpp:654
-#: UI/GTK2/src/WorkerThreads.cpp:1587
+#: UI/GTK2/src/mainWindow.cc:1975 UI/GTK2/src/WorkerThreads.cpp:655
+#: UI/GTK2/src/WorkerThreads.cpp:1612
 msgid "doesn't exist"
 msgstr "bestaat niet"
 
-#: UI/GTK2/src/mainWindow.cc:2133
+#: UI/GTK2/src/mainWindow.cc:2129
 msgid "Remove this document from the index ?"
 msgstr "Verwijder dit document uit de inhoudsopgave"
 
-#: UI/GTK2/src/mainWindow.cc:2152
+#: UI/GTK2/src/mainWindow.cc:2148
 msgid "Remove these documents from the index ?"
 msgstr "Verwijder deze documenten uit de inhoudsopgave"
 
-#: UI/GTK2/src/mainWindow.cc:2196
+#: UI/GTK2/src/mainWindow.cc:2192
 msgid "A metasearch tool for the Free Desktop"
 msgstr "Een metazoek tool voor de Free Desktop"
 
-#: UI/GTK2/src/mainWindow.cc:2197
+#: UI/GTK2/src/mainWindow.cc:2193
 msgid "Search the Web and your documents !"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:2198
+#: UI/GTK2/src/mainWindow.cc:2194
 #, fuzzy
 msgid "(C) 2005 Fabrice Colin"
 msgstr "(C) 2005-2006 Fabrice Colin"
 
-#: UI/GTK2/src/mainWindow.cc:2242
+#: UI/GTK2/src/mainWindow.cc:2238
 msgid "Index name"
 msgstr "Naam inhoudsopgave"
 
-#: UI/GTK2/src/mainWindow.cc:2257
+#: UI/GTK2/src/mainWindow.cc:2253
 msgid "Couldn't add index"
 msgstr "Kon inhoudsopgave niet toevoegen"
 
-#: UI/GTK2/src/mainWindow.cc:2271
+#: UI/GTK2/src/mainWindow.cc:2267
 msgid "Added new index"
 msgstr "Nieuwe inhoudsopgave toegevoegd"
 
-#: UI/GTK2/src/mainWindow.cc:2306
+#: UI/GTK2/src/mainWindow.cc:2302
 msgid "Couldn't remove index"
 msgstr "Kon inhoudsopgave niet verwijderen"
 
-#: UI/GTK2/src/mainWindow.cc:2571
+#: UI/GTK2/src/mainWindow.cc:2567
 msgid "At least one task hasn't completed yet. Quit now ?"
 msgstr "Tenminste een taak is nog niet gereed. Nu stoppen?"
 
-#: UI/GTK2/src/mainWindow.cc:2753
+#: UI/GTK2/src/mainWindow.cc:2749
 msgid "Query name"
 msgstr "Naam query"
 
-#: UI/GTK2/src/mainWindow.cc:2780
+#: UI/GTK2/src/mainWindow.cc:2776
 msgid "Couldn't update query"
 msgstr "Kon query niet actualiseren"
 
-#: UI/GTK2/src/mainWindow.cc:2788
+#: UI/GTK2/src/mainWindow.cc:2784
 msgid "Edited query"
 msgstr "Bewerkte query"
 
-#: UI/GTK2/src/mainWindow.cc:2795
+#: UI/GTK2/src/mainWindow.cc:2791
 msgid "Couldn't add query"
 msgstr "Kon query niet toevoegen"
 
-#: UI/GTK2/src/mainWindow.cc:2803
+#: UI/GTK2/src/mainWindow.cc:2799
 msgid "Added new query"
 msgstr "Nieuwe query toegevoegd"
 
-#: UI/GTK2/src/mainWindow.cc:2816
+#: UI/GTK2/src/mainWindow.cc:2812
 #, fuzzy
 msgid "Query is not set"
 msgstr "Query niet vastgelegd"
 
-#: UI/GTK2/src/mainWindow.cc:2827
+#: UI/GTK2/src/mainWindow.cc:2823
 msgid "No search engine selected"
 msgstr "Geen zoekmachine geselecteerd"
 
-#: UI/GTK2/src/mainWindow.cc:2909
+#: UI/GTK2/src/mainWindow.cc:2910
 msgid "Please set the Google API key first"
 msgstr "Geef eerst de Google API sleutel in"
 
-#: UI/GTK2/src/mainWindow.cc:2918
+#: UI/GTK2/src/mainWindow.cc:2919
 msgid "Running query"
 msgstr "Lopende query"
 
-#: UI/GTK2/src/mainWindow.cc:3102
+#: UI/GTK2/src/mainWindow.cc:3103
 msgid "No default application defined for type"
 msgstr "Geen standaard toepassing gedefinieerd voor het type"
 
-#: UI/GTK2/src/mainWindow_glade.cc:126
+#: UI/GTK2/src/mainWindow_glade.cc:125
 msgid "Query:"
 msgstr "Query:"
 
-#: UI/GTK2/src/mainWindow_glade.cc:138
+#: UI/GTK2/src/mainWindow_glade.cc:137
 msgid "Edit"
 msgstr "Bewerken"
 
-#: UI/GTK2/src/mainWindow_glade.cc:147
+#: UI/GTK2/src/mainWindow_glade.cc:146
 msgid "Stored queries"
 msgstr "Opgeslagen queries"
 
-#: UI/GTK2/src/mainWindow_glade.cc:161 UI/GTK2/src/statisticsDialog.cc:46
+#: UI/GTK2/src/mainWindow_glade.cc:163 UI/GTK2/src/statisticsDialog.cc:46
 #: UI/GTK2/src/statisticsDialog_glade.cc:87
 msgid "Status"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow_glade.cc:188
+#: UI/GTK2/src/mainWindow_glade.cc:184
 msgid "Search Engine"
 msgstr "Zoekmachine"
 
-#: UI/GTK2/src/mainWindow_glade.cc:191
+#: UI/GTK2/src/mainWindow_glade.cc:187
 msgid "Host Name"
 msgstr "Naam host"
 
-#: UI/GTK2/src/mainWindow_glade.cc:194
+#: UI/GTK2/src/mainWindow_glade.cc:190
 msgid "Show Extract"
 msgstr "Toon uittreksel"
 
-#: UI/GTK2/src/mainWindow_glade.cc:197
+#: UI/GTK2/src/mainWindow_glade.cc:193
 msgid "Group By"
 msgstr "Groeperen op"
 
-#: UI/GTK2/src/mainWindow_glade.cc:200
+#: UI/GTK2/src/mainWindow_glade.cc:196
 msgid "Clear List"
 msgstr "Lijst opschonen"
 
-#: UI/GTK2/src/mainWindow_glade.cc:206
+#: UI/GTK2/src/mainWindow_glade.cc:202
 msgid "Vie_w"
 msgstr "_Toon"
 
-#: UI/GTK2/src/mainWindow_glade.cc:209
+#: UI/GTK2/src/mainWindow_glade.cc:205
 msgid "View Cache"
 msgstr "Toon cache"
 
-#: UI/GTK2/src/mainWindow_glade.cc:212
+#: UI/GTK2/src/mainWindow_glade.cc:208
 msgid "More Like This"
 msgstr "Meer zoals deze"
 
-#: UI/GTK2/src/mainWindow_glade.cc:215 UI/GTK2/src/mainWindow_glade.cc:251
+#: UI/GTK2/src/mainWindow_glade.cc:211 UI/GTK2/src/mainWindow_glade.cc:247
 msgid "_Index"
 msgstr "_Index"
 
-#: UI/GTK2/src/mainWindow_glade.cc:218
+#: UI/GTK2/src/mainWindow_glade.cc:214
 msgid "List Contents Of"
 msgstr "Lijstinhoud van"
 
-#: UI/GTK2/src/mainWindow_glade.cc:227
+#: UI/GTK2/src/mainWindow_glade.cc:223
 msgid "View"
 msgstr "Toon"
 
-#: UI/GTK2/src/mainWindow_glade.cc:230
+#: UI/GTK2/src/mainWindow_glade.cc:226
 msgid "Update"
 msgstr "Verversen"
 
-#: UI/GTK2/src/mainWindow_glade.cc:233
+#: UI/GTK2/src/mainWindow_glade.cc:229
 msgid "Unindex"
 msgstr "De-indexeren"
 
-#: UI/GTK2/src/mainWindow_glade.cc:236
+#: UI/GTK2/src/mainWindow_glade.cc:232
 #: UI/GTK2/src/propertiesDialog_glade.cc:177
 msgid "Properties"
 msgstr "Eigenschappen"
 
-#: UI/GTK2/src/mainWindow_glade.cc:239
+#: UI/GTK2/src/mainWindow_glade.cc:235
 msgid "_About"
 msgstr "_Over"
 
-#: UI/GTK2/src/mainWindow_glade.cc:242
+#: UI/GTK2/src/mainWindow_glade.cc:238
 msgid "_Session"
 msgstr "_Sessie"
 
-#: UI/GTK2/src/mainWindow_glade.cc:245
+#: UI/GTK2/src/mainWindow_glade.cc:241
 msgid "_Edit"
 msgstr "_Bewerken"
 
-#: UI/GTK2/src/mainWindow_glade.cc:248
+#: UI/GTK2/src/mainWindow_glade.cc:244
 msgid "_Results"
 msgstr "_Resultaten"
 
-#: UI/GTK2/src/mainWindow_glade.cc:254
+#: UI/GTK2/src/mainWindow_glade.cc:250
 msgid "_Help"
 msgstr "_Help"
 
-#: UI/GTK2/src/mainWindow_glade.cc:391
+#: UI/GTK2/src/mainWindow_glade.cc:387
 msgid "Pinot"
 msgstr "Pinot"
 
@@ -720,11 +722,11 @@
 msgid "Query parameters"
 msgstr "Queryparameters"
 
-#: UI/GTK2/src/ResultsTree.cpp:116
+#: UI/GTK2/src/ResultsTree.cpp:117
 msgid "Score"
 msgstr "Score"
 
-#: UI/GTK2/src/ResultsTree.cpp:165
+#: UI/GTK2/src/ResultsTree.cpp:174
 msgid "Extract"
 msgstr "Uitpakken"
 
@@ -778,65 +780,65 @@
 msgid "Errors"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:321
+#: UI/GTK2/src/WorkerThreads.cpp:322
 msgid "Can't index mail here"
 msgstr "Kan mail hier niet indexeren"
 
-#: UI/GTK2/src/WorkerThreads.cpp:342
+#: UI/GTK2/src/WorkerThreads.cpp:343
 msgid "is already being indexed"
 msgstr "wordt al geindexeerd"
 
-#: UI/GTK2/src/WorkerThreads.cpp:352
+#: UI/GTK2/src/WorkerThreads.cpp:353
 msgid "is blacklisted"
 msgstr "staat op blacklist"
 
-#: UI/GTK2/src/WorkerThreads.cpp:663 UI/GTK2/src/WorkerThreads.cpp:936
-#: UI/GTK2/src/WorkerThreads.cpp:1022 UI/GTK2/src/WorkerThreads.cpp:1031
-#: UI/GTK2/src/WorkerThreads.cpp:1203 UI/GTK2/src/WorkerThreads.cpp:1463
-#: UI/GTK2/src/WorkerThreads.cpp:1596
+#: UI/GTK2/src/WorkerThreads.cpp:664 UI/GTK2/src/WorkerThreads.cpp:962
+#: UI/GTK2/src/WorkerThreads.cpp:1047 UI/GTK2/src/WorkerThreads.cpp:1056
+#: UI/GTK2/src/WorkerThreads.cpp:1228 UI/GTK2/src/WorkerThreads.cpp:1488
+#: UI/GTK2/src/WorkerThreads.cpp:1621
 msgid "Index error on"
 msgstr "Indexeringsfout op"
 
-#: UI/GTK2/src/WorkerThreads.cpp:784 UI/GTK2/src/WorkerThreads.cpp:957
+#: UI/GTK2/src/WorkerThreads.cpp:785 UI/GTK2/src/WorkerThreads.cpp:983
 msgid "Couldn't create search engine"
 msgstr "Kon zoekmachine niet maken"
 
-#: UI/GTK2/src/WorkerThreads.cpp:796 UI/GTK2/src/WorkerThreads.cpp:971
+#: UI/GTK2/src/WorkerThreads.cpp:797 UI/GTK2/src/WorkerThreads.cpp:997
 msgid "Couldn't run query on search engine"
 msgstr "Kon query niet uitvoeren op zoekmachine"
 
-#: UI/GTK2/src/WorkerThreads.cpp:830
+#: UI/GTK2/src/WorkerThreads.cpp:842
 msgid "No title"
 msgstr "Geen titel"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1125
+#: UI/GTK2/src/WorkerThreads.cpp:1150
 msgid "Couldn't obtain downloader for protocol"
 msgstr "Kon geen downloader verkrijgen voor protocol"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1136
+#: UI/GTK2/src/WorkerThreads.cpp:1161
 msgid "Couldn't retrieve"
 msgstr "Kon niet opzoeken"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1233 UI/GTK2/src/WorkerThreads.cpp:1309
+#: UI/GTK2/src/WorkerThreads.cpp:1258 UI/GTK2/src/WorkerThreads.cpp:1334
 msgid "Cannot index document type"
 msgstr "Kan documenttype niet indexeren"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1237 UI/GTK2/src/WorkerThreads.cpp:1313
+#: UI/GTK2/src/WorkerThreads.cpp:1262 UI/GTK2/src/WorkerThreads.cpp:1338
 msgid "at"
 msgstr "bij"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1344
+#: UI/GTK2/src/WorkerThreads.cpp:1369
 msgid "Robots META tag forbids indexing"
 msgstr "Robots META taf verbiedt indexeren"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1395
+#: UI/GTK2/src/WorkerThreads.cpp:1420
 msgid "Couldn't index"
 msgstr "Kon niet indexeren"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1474
+#: UI/GTK2/src/WorkerThreads.cpp:1499
 msgid "Couldn't unindex document(s)"
 msgstr "Kan indexering van bestand(en) niet ongedaan maken"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1608
+#: UI/GTK2/src/WorkerThreads.cpp:1633
 msgid "Couldn't update document"
 msgstr "Kan document niet actualiseren"

Modified: trunk/po/pt_BR.po
===================================================================
--- trunk/po/pt_BR.po	2007-02-20 06:03:43 UTC (rev 728)
+++ trunk/po/pt_BR.po	2007-02-20 06:09:21 UTC (rev 729)
@@ -28,22 +28,24 @@
 #: UI/GTK2/src/EnginesTree.cpp:339 UI/GTK2/src/mainWindow.cc:325
 #: UI/GTK2/src/mainWindow.cc:328 UI/GTK2/src/mainWindow.cc:541
 #: UI/GTK2/src/mainWindow.cc:1186 UI/GTK2/src/mainWindow.cc:1229
-#: UI/GTK2/src/mainWindow.cc:1249 UI/GTK2/src/mainWindow.cc:1280
-#: UI/GTK2/src/mainWindow.cc:1859 UI/GTK2/src/PinotSettings.cpp:241
+#: UI/GTK2/src/mainWindow.cc:1251 UI/GTK2/src/mainWindow.cc:1282
+#: UI/GTK2/src/mainWindow.cc:1855 UI/GTK2/src/PinotSettings.cpp:241
 #: UI/GTK2/src/PinotSettings.cpp:1281 UI/GTK2/src/PinotSettings.cpp:1337
-#: UI/GTK2/src/statisticsDialog.cc:88 UI/GTK2/src/WorkerThreads.cpp:859
+#: UI/GTK2/src/statisticsDialog.cc:88 UI/GTK2/src/WorkerThreads.cpp:820
+#: UI/GTK2/src/WorkerThreads.cpp:879
 msgid "My Web Pages"
 msgstr "Minhas P?ginas Web"
 
 #: UI/GTK2/src/EnginesTree.cpp:340 UI/GTK2/src/mainWindow.cc:319
 #: UI/GTK2/src/mainWindow.cc:322 UI/GTK2/src/PinotSettings.cpp:242
 #: UI/GTK2/src/PinotSettings.cpp:1282 UI/GTK2/src/PinotSettings.cpp:1338
-#: UI/GTK2/src/statisticsDialog.cc:74 UI/GTK2/src/WorkerThreads.cpp:867
+#: UI/GTK2/src/statisticsDialog.cc:74 UI/GTK2/src/WorkerThreads.cpp:825
+#: UI/GTK2/src/WorkerThreads.cpp:889
 msgid "My Documents"
 msgstr "Meus Documentos"
 
 #: UI/GTK2/src/dateDialog_glade.cc:76 UI/GTK2/src/queryDialog_glade.cc:91
-#: UI/GTK2/src/queryDialog_glade.cc:92
+#: UI/GTK2/src/queryDialog_glade.cc:92 UI/GTK2/src/ResultsTree.cpp:145
 #, fuzzy
 msgid "Date"
 msgstr "no"
@@ -107,17 +109,17 @@
 msgid "Import"
 msgstr "Importar"
 
-#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:221
+#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:217
 msgid "Import URL"
 msgstr "Importar URL"
 
 #: UI/GTK2/src/IndexTree.cpp:68 UI/GTK2/src/queryDialog.cc:139
-#: UI/GTK2/src/ResultsTree.cpp:126
+#: UI/GTK2/src/ResultsTree.cpp:127
 msgid "Title"
 msgstr "T?tulo"
 
 #: UI/GTK2/src/IndexTree.cpp:73 UI/GTK2/src/queryDialog.cc:142
-#: UI/GTK2/src/ResultsTree.cpp:136
+#: UI/GTK2/src/ResultsTree.cpp:137
 msgid "URL"
 msgstr "URL"
 
@@ -212,7 +214,7 @@
 msgid "Query"
 msgstr "Consulta"
 
-#: UI/GTK2/src/mainWindow.cc:924 UI/GTK2/src/mainWindow.cc:2922
+#: UI/GTK2/src/mainWindow.cc:924 UI/GTK2/src/mainWindow.cc:2923
 msgid "on"
 msgstr "no"
 
@@ -236,224 +238,224 @@
 msgid "Indexed"
 msgstr "Indexado"
 
-#: UI/GTK2/src/mainWindow.cc:1250
+#: UI/GTK2/src/mainWindow.cc:1252
 msgid "Unindexed document(s)"
 msgstr "Documento(s) n?o indexidado(s)"
 
-#: UI/GTK2/src/mainWindow.cc:1291
+#: UI/GTK2/src/mainWindow.cc:1293
 msgid "Updated document properties"
 msgstr "Propriedade de documentos atualizados"
 
-#: UI/GTK2/src/mainWindow.cc:1338
+#: UI/GTK2/src/mainWindow.cc:1346
 msgid "Couldn't rename index, name"
 msgstr "N?o foi poss?vel renomear ?ndice, nome"
 
-#: UI/GTK2/src/mainWindow.cc:1342 UI/GTK2/src/mainWindow.cc:2246
-#: UI/GTK2/src/mainWindow.cc:2757
+#: UI/GTK2/src/mainWindow.cc:1350 UI/GTK2/src/mainWindow.cc:2242
+#: UI/GTK2/src/mainWindow.cc:2753
 msgid "is already in use"
 msgstr "j? est? em uso"
 
-#: UI/GTK2/src/mainWindow.cc:1355
+#: UI/GTK2/src/mainWindow.cc:1363
 msgid "Couldn't rename index"
 msgstr "N?o foi poss?vel renomear ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:1368
+#: UI/GTK2/src/mainWindow.cc:1376
 msgid "Edited index"
 msgstr "?ndice editado"
 
-#: UI/GTK2/src/mainWindow.cc:1753 UI/GTK2/src/mainWindow.cc:2416
+#: UI/GTK2/src/mainWindow.cc:1752 UI/GTK2/src/mainWindow.cc:2412
 msgid "Live query"
 msgstr "Query ativa"
 
-#: UI/GTK2/src/mainWindow.cc:1779
+#: UI/GTK2/src/mainWindow.cc:1778
 msgid "Couldn't find query"
 msgstr "N?o foi poss?vel encontrar consulta"
 
-#: UI/GTK2/src/mainWindow.cc:1975 UI/GTK2/src/WorkerThreads.cpp:650
-#: UI/GTK2/src/WorkerThreads.cpp:1583
+#: UI/GTK2/src/mainWindow.cc:1971 UI/GTK2/src/WorkerThreads.cpp:651
+#: UI/GTK2/src/WorkerThreads.cpp:1608
 msgid "Index"
 msgstr "?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:1979 UI/GTK2/src/WorkerThreads.cpp:654
-#: UI/GTK2/src/WorkerThreads.cpp:1587
+#: UI/GTK2/src/mainWindow.cc:1975 UI/GTK2/src/WorkerThreads.cpp:655
+#: UI/GTK2/src/WorkerThreads.cpp:1612
 msgid "doesn't exist"
 msgstr "n?o existe"
 
-#: UI/GTK2/src/mainWindow.cc:2133
+#: UI/GTK2/src/mainWindow.cc:2129
 msgid "Remove this document from the index ?"
 msgstr "Remover documento do ?ndice?"
 
-#: UI/GTK2/src/mainWindow.cc:2152
+#: UI/GTK2/src/mainWindow.cc:2148
 msgid "Remove these documents from the index ?"
 msgstr "Remover documentos do ?ndice?"
 
-#: UI/GTK2/src/mainWindow.cc:2196
+#: UI/GTK2/src/mainWindow.cc:2192
 msgid "A metasearch tool for the Free Desktop"
 msgstr "Um mecanismo de metabusca gr?tis para Desktop"
 
-#: UI/GTK2/src/mainWindow.cc:2197
+#: UI/GTK2/src/mainWindow.cc:2193
 msgid "Search the Web and your documents !"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:2198
+#: UI/GTK2/src/mainWindow.cc:2194
 msgid "(C) 2005 Fabrice Colin"
 msgstr "(C) 2005 Fabrice Colin"
 
-#: UI/GTK2/src/mainWindow.cc:2242
+#: UI/GTK2/src/mainWindow.cc:2238
 msgid "Index name"
 msgstr "Nome do ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2257
+#: UI/GTK2/src/mainWindow.cc:2253
 msgid "Couldn't add index"
 msgstr "N?o foi poss?vel adicionar ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2271
+#: UI/GTK2/src/mainWindow.cc:2267
 msgid "Added new index"
 msgstr "Adicionar novo ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2306
+#: UI/GTK2/src/mainWindow.cc:2302
 msgid "Couldn't remove index"
 msgstr "N?o foi poss?vel remover ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2571
+#: UI/GTK2/src/mainWindow.cc:2567
 msgid "At least one task hasn't completed yet. Quit now ?"
 msgstr "Pelo menos uma tarefa n?o terminou ainda. Sair assim mesmo?"
 
-#: UI/GTK2/src/mainWindow.cc:2753
+#: UI/GTK2/src/mainWindow.cc:2749
 msgid "Query name"
 msgstr "Nome da consulta"
 
-#: UI/GTK2/src/mainWindow.cc:2780
+#: UI/GTK2/src/mainWindow.cc:2776
 msgid "Couldn't update query"
 msgstr "N?o foi poss?vel atualizar consulta"
 
-#: UI/GTK2/src/mainWindow.cc:2788
+#: UI/GTK2/src/mainWindow.cc:2784
 msgid "Edited query"
 msgstr "Consulta editada"
 
-#: UI/GTK2/src/mainWindow.cc:2795
+#: UI/GTK2/src/mainWindow.cc:2791
 msgid "Couldn't add query"
 msgstr "N?o foi poss?vel adicionar consulta"
 
-#: UI/GTK2/src/mainWindow.cc:2803
+#: UI/GTK2/src/mainWindow.cc:2799
 msgid "Added new query"
 msgstr "Adicionar nova consulta"
 
-#: UI/GTK2/src/mainWindow.cc:2816
+#: UI/GTK2/src/mainWindow.cc:2812
 msgid "Query is not set"
 msgstr "Consulta n?o foi atualizada"
 
-#: UI/GTK2/src/mainWindow.cc:2827
+#: UI/GTK2/src/mainWindow.cc:2823
 msgid "No search engine selected"
 msgstr "Nenhum mecanismo de pesquisa selecionado"
 
-#: UI/GTK2/src/mainWindow.cc:2909
+#: UI/GTK2/src/mainWindow.cc:2910
 msgid "Please set the Google API key first"
 msgstr "Primeiro informe a tecla para Google API"
 
-#: UI/GTK2/src/mainWindow.cc:2918
+#: UI/GTK2/src/mainWindow.cc:2919
 msgid "Running query"
 msgstr "Executando consulta"
 
-#: UI/GTK2/src/mainWindow.cc:3102
+#: UI/GTK2/src/mainWindow.cc:3103
 msgid "No default application defined for type"
 msgstr "Aplica??o associada ao tipo n?o definida"
 
-#: UI/GTK2/src/mainWindow_glade.cc:126
+#: UI/GTK2/src/mainWindow_glade.cc:125
 msgid "Query:"
 msgstr "Consulta:"
 
-#: UI/GTK2/src/mainWindow_glade.cc:138
+#: UI/GTK2/src/mainWindow_glade.cc:137
 msgid "Edit"
 msgstr "Editar"
 
-#: UI/GTK2/src/mainWindow_glade.cc:147
+#: UI/GTK2/src/mainWindow_glade.cc:146
 msgid "Stored queries"
 msgstr "Consultas armazenadas"
 
-#: UI/GTK2/src/mainWindow_glade.cc:161 UI/GTK2/src/statisticsDialog.cc:46
+#: UI/GTK2/src/mainWindow_glade.cc:163 UI/GTK2/src/statisticsDialog.cc:46
 #: UI/GTK2/src/statisticsDialog_glade.cc:87
 msgid "Status"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow_glade.cc:188
+#: UI/GTK2/src/mainWindow_glade.cc:184
 msgid "Search Engine"
 msgstr "Mecanismo de pesquisa"
 
-#: UI/GTK2/src/mainWindow_glade.cc:191
+#: UI/GTK2/src/mainWindow_glade.cc:187
 msgid "Host Name"
 msgstr "Nome do host"
 
-#: UI/GTK2/src/mainWindow_glade.cc:194
+#: UI/GTK2/src/mainWindow_glade.cc:190
 msgid "Show Extract"
 msgstr "Mostrar extrato"
 
-#: UI/GTK2/src/mainWindow_glade.cc:197
+#: UI/GTK2/src/mainWindow_glade.cc:193
 msgid "Group By"
 msgstr "Agrupar por"
 
-#: UI/GTK2/src/mainWindow_glade.cc:200
+#: UI/GTK2/src/mainWindow_glade.cc:196
 msgid "Clear List"
 msgstr "Limpar lista"
 
-#: UI/GTK2/src/mainWindow_glade.cc:206
+#: UI/GTK2/src/mainWindow_glade.cc:202
 msgid "Vie_w"
 msgstr "Exibir"
 
-#: UI/GTK2/src/mainWindow_glade.cc:209
+#: UI/GTK2/src/mainWindow_glade.cc:205
 msgid "View Cache"
 msgstr "Exibir cache"
 
-#: UI/GTK2/src/mainWindow_glade.cc:212
+#: UI/GTK2/src/mainWindow_glade.cc:208
 msgid "More Like This"
 msgstr "Mais como este"
 
-#: UI/GTK2/src/mainWindow_glade.cc:215 UI/GTK2/src/mainWindow_glade.cc:251
+#: UI/GTK2/src/mainWindow_glade.cc:211 UI/GTK2/src/mainWindow_glade.cc:247
 msgid "_Index"
 msgstr "_?ndice"
 
-#: UI/GTK2/src/mainWindow_glade.cc:218
+#: UI/GTK2/src/mainWindow_glade.cc:214
 msgid "List Contents Of"
 msgstr "Mostrar conte?do de"
 
-#: UI/GTK2/src/mainWindow_glade.cc:227
+#: UI/GTK2/src/mainWindow_glade.cc:223
 msgid "View"
 msgstr "Visualizar"
 
-#: UI/GTK2/src/mainWindow_glade.cc:230
+#: UI/GTK2/src/mainWindow_glade.cc:226
 msgid "Update"
 msgstr "Atualizar"
 
-#: UI/GTK2/src/mainWindow_glade.cc:233
+#: UI/GTK2/src/mainWindow_glade.cc:229
 msgid "Unindex"
 msgstr "Retirar do ?ndice"
 
-#: UI/GTK2/src/mainWindow_glade.cc:236
+#: UI/GTK2/src/mainWindow_glade.cc:232
 #: UI/GTK2/src/propertiesDialog_glade.cc:177
 msgid "Properties"
 msgstr "Propriedades"
 
-#: UI/GTK2/src/mainWindow_glade.cc:239
+#: UI/GTK2/src/mainWindow_glade.cc:235
 msgid "_About"
 msgstr "_Sobre"
 
-#: UI/GTK2/src/mainWindow_glade.cc:242
+#: UI/GTK2/src/mainWindow_glade.cc:238
 msgid "_Session"
 msgstr "_Sess?o"
 
-#: UI/GTK2/src/mainWindow_glade.cc:245
+#: UI/GTK2/src/mainWindow_glade.cc:241
 msgid "_Edit"
 msgstr "_Editar"
 
-#: UI/GTK2/src/mainWindow_glade.cc:248
+#: UI/GTK2/src/mainWindow_glade.cc:244
 msgid "_Results"
 msgstr "_Resultados"
 
-#: UI/GTK2/src/mainWindow_glade.cc:254
+#: UI/GTK2/src/mainWindow_glade.cc:250
 msgid "_Help"
 msgstr "_Ajuda"
 
-#: UI/GTK2/src/mainWindow_glade.cc:391
+#: UI/GTK2/src/mainWindow_glade.cc:387
 msgid "Pinot"
 msgstr "Pino"
 
@@ -720,11 +722,11 @@
 msgid "Query parameters"
 msgstr "Par?metros da consulta"
 
-#: UI/GTK2/src/ResultsTree.cpp:116
+#: UI/GTK2/src/ResultsTree.cpp:117
 msgid "Score"
 msgstr "Pontua??o"
 
-#: UI/GTK2/src/ResultsTree.cpp:165
+#: UI/GTK2/src/ResultsTree.cpp:174
 msgid "Extract"
 msgstr "Extrair"
 
@@ -778,65 +780,65 @@
 msgid "Errors"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:321
+#: UI/GTK2/src/WorkerThreads.cpp:322
 msgid "Can't index mail here"
 msgstr "N?o foi poss?vel indexar mail aqui"
 
-#: UI/GTK2/src/WorkerThreads.cpp:342
+#: UI/GTK2/src/WorkerThreads.cpp:343
 msgid "is already being indexed"
 msgstr "j? est? sendo indexado"
 
-#: UI/GTK2/src/WorkerThreads.cpp:352
+#: UI/GTK2/src/WorkerThreads.cpp:353
 msgid "is blacklisted"
 msgstr "est? na lista negra"
 
-#: UI/GTK2/src/WorkerThreads.cpp:663 UI/GTK2/src/WorkerThreads.cpp:936
-#: UI/GTK2/src/WorkerThreads.cpp:1022 UI/GTK2/src/WorkerThreads.cpp:1031
-#: UI/GTK2/src/WorkerThreads.cpp:1203 UI/GTK2/src/WorkerThreads.cpp:1463
-#: UI/GTK2/src/WorkerThreads.cpp:1596
+#: UI/GTK2/src/WorkerThreads.cpp:664 UI/GTK2/src/WorkerThreads.cpp:962
+#: UI/GTK2/src/WorkerThreads.cpp:1047 UI/GTK2/src/WorkerThreads.cpp:1056
+#: UI/GTK2/src/WorkerThreads.cpp:1228 UI/GTK2/src/WorkerThreads.cpp:1488
+#: UI/GTK2/src/WorkerThreads.cpp:1621
 msgid "Index error on"
 msgstr "Erro no ?ndice no"
 
-#: UI/GTK2/src/WorkerThreads.cpp:784 UI/GTK2/src/WorkerThreads.cpp:957
+#: UI/GTK2/src/WorkerThreads.cpp:785 UI/GTK2/src/WorkerThreads.cpp:983
 msgid "Couldn't create search engine"
 msgstr "N?o foi poss?vel criar mecanismo de pesquisa"
 
-#: UI/GTK2/src/WorkerThreads.cpp:796 UI/GTK2/src/WorkerThreads.cpp:971
+#: UI/GTK2/src/WorkerThreads.cpp:797 UI/GTK2/src/WorkerThreads.cpp:997
 msgid "Couldn't run query on search engine"
 msgstr "N?o foi poss?vel executar consulta no mecanismo de pesquisa"
 
-#: UI/GTK2/src/WorkerThreads.cpp:830
+#: UI/GTK2/src/WorkerThreads.cpp:842
 msgid "No title"
 msgstr "Sem t?tulo"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1125
+#: UI/GTK2/src/WorkerThreads.cpp:1150
 msgid "Couldn't obtain downloader for protocol"
 msgstr "N?o foi poss?vel obter fonte de download para o protocolo"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1136
+#: UI/GTK2/src/WorkerThreads.cpp:1161
 msgid "Couldn't retrieve"
 msgstr "N?o foi poss?vel carregar"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1233 UI/GTK2/src/WorkerThreads.cpp:1309
+#: UI/GTK2/src/WorkerThreads.cpp:1258 UI/GTK2/src/WorkerThreads.cpp:1334
 msgid "Cannot index document type"
 msgstr "Imposs?vel indexar tipo de arquivo"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1237 UI/GTK2/src/WorkerThreads.cpp:1313
+#: UI/GTK2/src/WorkerThreads.cpp:1262 UI/GTK2/src/WorkerThreads.cpp:1338
 msgid "at"
 msgstr "no"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1344
+#: UI/GTK2/src/WorkerThreads.cpp:1369
 msgid "Robots META tag forbids indexing"
 msgstr "Robots META tag n?o s?o permitidos no ?ndice"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1395
+#: UI/GTK2/src/WorkerThreads.cpp:1420
 msgid "Couldn't index"
 msgstr "N?o foi poss?vel indexar"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1474
+#: UI/GTK2/src/WorkerThreads.cpp:1499
 msgid "Couldn't unindex document(s)"
 msgstr "N?o foi poss?vel remover documento(s) do ?ndice"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1608
+#: UI/GTK2/src/WorkerThreads.cpp:1633
 msgid "Couldn't update document"
 msgstr "N?o foi poss?vel atualizar documento"

Modified: trunk/po/ru.po
===================================================================
--- trunk/po/ru.po	2007-02-20 06:03:43 UTC (rev 728)
+++ trunk/po/ru.po	2007-02-20 06:09:21 UTC (rev 729)
@@ -28,22 +28,24 @@
 #: UI/GTK2/src/EnginesTree.cpp:339 UI/GTK2/src/mainWindow.cc:325
 #: UI/GTK2/src/mainWindow.cc:328 UI/GTK2/src/mainWindow.cc:541
 #: UI/GTK2/src/mainWindow.cc:1186 UI/GTK2/src/mainWindow.cc:1229
-#: UI/GTK2/src/mainWindow.cc:1249 UI/GTK2/src/mainWindow.cc:1280
-#: UI/GTK2/src/mainWindow.cc:1859 UI/GTK2/src/PinotSettings.cpp:241
+#: UI/GTK2/src/mainWindow.cc:1251 UI/GTK2/src/mainWindow.cc:1282
+#: UI/GTK2/src/mainWindow.cc:1855 UI/GTK2/src/PinotSettings.cpp:241
 #: UI/GTK2/src/PinotSettings.cpp:1281 UI/GTK2/src/PinotSettings.cpp:1337
-#: UI/GTK2/src/statisticsDialog.cc:88 UI/GTK2/src/WorkerThreads.cpp:859
+#: UI/GTK2/src/statisticsDialog.cc:88 UI/GTK2/src/WorkerThreads.cpp:820
+#: UI/GTK2/src/WorkerThreads.cpp:879
 msgid "My Web Pages"
 msgstr "??? web-????????"
 
 #: UI/GTK2/src/EnginesTree.cpp:340 UI/GTK2/src/mainWindow.cc:319
 #: UI/GTK2/src/mainWindow.cc:322 UI/GTK2/src/PinotSettings.cpp:242
 #: UI/GTK2/src/PinotSettings.cpp:1282 UI/GTK2/src/PinotSettings.cpp:1338
-#: UI/GTK2/src/statisticsDialog.cc:74 UI/GTK2/src/WorkerThreads.cpp:867
+#: UI/GTK2/src/statisticsDialog.cc:74 UI/GTK2/src/WorkerThreads.cpp:825
+#: UI/GTK2/src/WorkerThreads.cpp:889
 msgid "My Documents"
 msgstr "??? ?????????"
 
 #: UI/GTK2/src/dateDialog_glade.cc:76 UI/GTK2/src/queryDialog_glade.cc:91
-#: UI/GTK2/src/queryDialog_glade.cc:92
+#: UI/GTK2/src/queryDialog_glade.cc:92 UI/GTK2/src/ResultsTree.cpp:145
 #, fuzzy
 msgid "Date"
 msgstr "?"
@@ -107,17 +109,17 @@
 msgid "Import"
 msgstr "??????"
 
-#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:221
+#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:217
 msgid "Import URL"
 msgstr "?????? URL"
 
 #: UI/GTK2/src/IndexTree.cpp:68 UI/GTK2/src/queryDialog.cc:139
-#: UI/GTK2/src/ResultsTree.cpp:126
+#: UI/GTK2/src/ResultsTree.cpp:127
 msgid "Title"
 msgstr "????????"
 
 #: UI/GTK2/src/IndexTree.cpp:73 UI/GTK2/src/queryDialog.cc:142
-#: UI/GTK2/src/ResultsTree.cpp:136
+#: UI/GTK2/src/ResultsTree.cpp:137
 msgid "URL"
 msgstr "URL"
 
@@ -212,7 +214,7 @@
 msgid "Query"
 msgstr "??????"
 
-#: UI/GTK2/src/mainWindow.cc:924 UI/GTK2/src/mainWindow.cc:2922
+#: UI/GTK2/src/mainWindow.cc:924 UI/GTK2/src/mainWindow.cc:2923
 msgid "on"
 msgstr "??"
 
@@ -236,224 +238,224 @@
 msgid "Indexed"
 msgstr "?????????????"
 
-#: UI/GTK2/src/mainWindow.cc:1250
+#: UI/GTK2/src/mainWindow.cc:1252
 msgid "Unindexed document(s)"
 msgstr "?? ????????????? ??????????"
 
-#: UI/GTK2/src/mainWindow.cc:1291
+#: UI/GTK2/src/mainWindow.cc:1293
 msgid "Updated document properties"
 msgstr "?????????? ??????? ?????????"
 
-#: UI/GTK2/src/mainWindow.cc:1338
+#: UI/GTK2/src/mainWindow.cc:1346
 msgid "Couldn't rename index, name"
 msgstr "?????????? ????????????? ??????, ????????"
 
-#: UI/GTK2/src/mainWindow.cc:1342 UI/GTK2/src/mainWindow.cc:2246
-#: UI/GTK2/src/mainWindow.cc:2757
+#: UI/GTK2/src/mainWindow.cc:1350 UI/GTK2/src/mainWindow.cc:2242
+#: UI/GTK2/src/mainWindow.cc:2753
 msgid "is already in use"
 msgstr "??? ????????????"
 
-#: UI/GTK2/src/mainWindow.cc:1355
+#: UI/GTK2/src/mainWindow.cc:1363
 msgid "Couldn't rename index"
 msgstr "?????????? ????????????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:1368
+#: UI/GTK2/src/mainWindow.cc:1376
 msgid "Edited index"
 msgstr "?????????????? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:1753 UI/GTK2/src/mainWindow.cc:2416
+#: UI/GTK2/src/mainWindow.cc:1752 UI/GTK2/src/mainWindow.cc:2412
 msgid "Live query"
 msgstr "???????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:1779
+#: UI/GTK2/src/mainWindow.cc:1778
 msgid "Couldn't find query"
 msgstr "?????????? ????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:1975 UI/GTK2/src/WorkerThreads.cpp:650
-#: UI/GTK2/src/WorkerThreads.cpp:1583
+#: UI/GTK2/src/mainWindow.cc:1971 UI/GTK2/src/WorkerThreads.cpp:651
+#: UI/GTK2/src/WorkerThreads.cpp:1608
 msgid "Index"
 msgstr "??????"
 
-#: UI/GTK2/src/mainWindow.cc:1979 UI/GTK2/src/WorkerThreads.cpp:654
-#: UI/GTK2/src/WorkerThreads.cpp:1587
+#: UI/GTK2/src/mainWindow.cc:1975 UI/GTK2/src/WorkerThreads.cpp:655
+#: UI/GTK2/src/WorkerThreads.cpp:1612
 msgid "doesn't exist"
 msgstr "???"
 
-#: UI/GTK2/src/mainWindow.cc:2133
+#: UI/GTK2/src/mainWindow.cc:2129
 msgid "Remove this document from the index ?"
 msgstr "??????? ???????? ?? ??????? ?"
 
-#: UI/GTK2/src/mainWindow.cc:2152
+#: UI/GTK2/src/mainWindow.cc:2148
 msgid "Remove these documents from the index ?"
 msgstr "??????? ??? ????????? ?? ????????"
 
-#: UI/GTK2/src/mainWindow.cc:2196
+#: UI/GTK2/src/mainWindow.cc:2192
 msgid "A metasearch tool for the Free Desktop"
 msgstr "?????????? ?????????? ??? ?????????? ????????"
 
-#: UI/GTK2/src/mainWindow.cc:2197
+#: UI/GTK2/src/mainWindow.cc:2193
 msgid "Search the Web and your documents !"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:2198
+#: UI/GTK2/src/mainWindow.cc:2194
 msgid "(C) 2005 Fabrice Colin"
 msgstr "(C) 2005 Fabrice Colin"
 
-#: UI/GTK2/src/mainWindow.cc:2242
+#: UI/GTK2/src/mainWindow.cc:2238
 msgid "Index name"
 msgstr "???????? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:2257
+#: UI/GTK2/src/mainWindow.cc:2253
 msgid "Couldn't add index"
 msgstr "?????????? ???????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:2271
+#: UI/GTK2/src/mainWindow.cc:2267
 msgid "Added new index"
 msgstr "???????? ????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:2306
+#: UI/GTK2/src/mainWindow.cc:2302
 msgid "Couldn't remove index"
 msgstr "?????????? ??????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:2571
+#: UI/GTK2/src/mainWindow.cc:2567
 msgid "At least one task hasn't completed yet. Quit now ?"
 msgstr "?? ??????? ???? ???? ?????? ??? ?? ?????????. ????? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:2753
+#: UI/GTK2/src/mainWindow.cc:2749
 msgid "Query name"
 msgstr "???????? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:2780
+#: UI/GTK2/src/mainWindow.cc:2776
 msgid "Couldn't update query"
 msgstr "?????????? ???????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:2788
+#: UI/GTK2/src/mainWindow.cc:2784
 msgid "Edited query"
 msgstr "?????? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:2795
+#: UI/GTK2/src/mainWindow.cc:2791
 msgid "Couldn't add query"
 msgstr "?????????? ???????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:2803
+#: UI/GTK2/src/mainWindow.cc:2799
 msgid "Added new query"
 msgstr "???????? ????? ??????"
 
-#: UI/GTK2/src/mainWindow.cc:2816
+#: UI/GTK2/src/mainWindow.cc:2812
 msgid "Query is not set"
 msgstr "?????? ?? ??????????"
 
-#: UI/GTK2/src/mainWindow.cc:2827
+#: UI/GTK2/src/mainWindow.cc:2823
 msgid "No search engine selected"
 msgstr "?? ???? ????????? ??????? ?? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:2909
+#: UI/GTK2/src/mainWindow.cc:2910
 msgid "Please set the Google API key first"
 msgstr "??????????, ??????? ????????????? ???? Google API"
 
-#: UI/GTK2/src/mainWindow.cc:2918
+#: UI/GTK2/src/mainWindow.cc:2919
 msgid "Running query"
 msgstr "?????? ???????"
 
-#: UI/GTK2/src/mainWindow.cc:3102
+#: UI/GTK2/src/mainWindow.cc:3103
 msgid "No default application defined for type"
 msgstr "?? ???? ?????????? ?? ????????? ?? ?????????? ??? ???? ??????????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:126
+#: UI/GTK2/src/mainWindow_glade.cc:125
 msgid "Query:"
 msgstr "??????:"
 
-#: UI/GTK2/src/mainWindow_glade.cc:138
+#: UI/GTK2/src/mainWindow_glade.cc:137
 msgid "Edit"
 msgstr "??????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:147
+#: UI/GTK2/src/mainWindow_glade.cc:146
 msgid "Stored queries"
 msgstr "??????????? ???????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:161 UI/GTK2/src/statisticsDialog.cc:46
+#: UI/GTK2/src/mainWindow_glade.cc:163 UI/GTK2/src/statisticsDialog.cc:46
 #: UI/GTK2/src/statisticsDialog_glade.cc:87
 msgid "Status"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow_glade.cc:188
+#: UI/GTK2/src/mainWindow_glade.cc:184
 msgid "Search Engine"
 msgstr "????????? ??????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:191
+#: UI/GTK2/src/mainWindow_glade.cc:187
 msgid "Host Name"
 msgstr "??? ?????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:194
+#: UI/GTK2/src/mainWindow_glade.cc:190
 msgid "Show Extract"
 msgstr "???????? ????????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:197
+#: UI/GTK2/src/mainWindow_glade.cc:193
 msgid "Group By"
 msgstr "???????????? ??"
 
-#: UI/GTK2/src/mainWindow_glade.cc:200
+#: UI/GTK2/src/mainWindow_glade.cc:196
 msgid "Clear List"
 msgstr "???????? ??????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:206
+#: UI/GTK2/src/mainWindow_glade.cc:202
 msgid "Vie_w"
 msgstr "_???"
 
-#: UI/GTK2/src/mainWindow_glade.cc:209
+#: UI/GTK2/src/mainWindow_glade.cc:205
 msgid "View Cache"
 msgstr "???????? ????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:212
+#: UI/GTK2/src/mainWindow_glade.cc:208
 msgid "More Like This"
 msgstr "????????? ?? ????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:215 UI/GTK2/src/mainWindow_glade.cc:251
+#: UI/GTK2/src/mainWindow_glade.cc:211 UI/GTK2/src/mainWindow_glade.cc:247
 msgid "_Index"
 msgstr "_??????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:218
+#: UI/GTK2/src/mainWindow_glade.cc:214
 msgid "List Contents Of"
 msgstr "?????? ???????????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:227
+#: UI/GTK2/src/mainWindow_glade.cc:223
 msgid "View"
 msgstr "???"
 
-#: UI/GTK2/src/mainWindow_glade.cc:230
+#: UI/GTK2/src/mainWindow_glade.cc:226
 msgid "Update"
 msgstr "????????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:233
+#: UI/GTK2/src/mainWindow_glade.cc:229
 msgid "Unindex"
 msgstr "????? ??????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:236
+#: UI/GTK2/src/mainWindow_glade.cc:232
 #: UI/GTK2/src/propertiesDialog_glade.cc:177
 msgid "Properties"
 msgstr "????????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:239
+#: UI/GTK2/src/mainWindow_glade.cc:235
 msgid "_About"
 msgstr "? ?????????..."
 
-#: UI/GTK2/src/mainWindow_glade.cc:242
+#: UI/GTK2/src/mainWindow_glade.cc:238
 msgid "_Session"
 msgstr "_??????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:245
+#: UI/GTK2/src/mainWindow_glade.cc:241
 msgid "_Edit"
 msgstr "_??????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:248
+#: UI/GTK2/src/mainWindow_glade.cc:244
 msgid "_Results"
 msgstr "_?????????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:254
+#: UI/GTK2/src/mainWindow_glade.cc:250
 msgid "_Help"
 msgstr "???????"
 
-#: UI/GTK2/src/mainWindow_glade.cc:391
+#: UI/GTK2/src/mainWindow_glade.cc:387
 msgid "Pinot"
 msgstr "Pinot"
 
@@ -713,11 +715,11 @@
 msgid "Query parameters"
 msgstr "????????? ???????"
 
-#: UI/GTK2/src/ResultsTree.cpp:116
+#: UI/GTK2/src/ResultsTree.cpp:117
 msgid "Score"
 msgstr "????"
 
-#: UI/GTK2/src/ResultsTree.cpp:165
+#: UI/GTK2/src/ResultsTree.cpp:174
 msgid "Extract"
 msgstr "??????????"
 
@@ -771,65 +773,65 @@
 msgid "Errors"
 msgstr ""
 
-#: UI/GTK2/src/WorkerThreads.cpp:321
+#: UI/GTK2/src/WorkerThreads.cpp:322
 msgid "Can't index mail here"
 msgstr "?????? ????????????? ????? ?????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:342
+#: UI/GTK2/src/WorkerThreads.cpp:343
 msgid "is already being indexed"
 msgstr "??? ??????????????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:352
+#: UI/GTK2/src/WorkerThreads.cpp:353
 msgid "is blacklisted"
 msgstr "??????????? ? ?????? ??????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:663 UI/GTK2/src/WorkerThreads.cpp:936
-#: UI/GTK2/src/WorkerThreads.cpp:1022 UI/GTK2/src/WorkerThreads.cpp:1031
-#: UI/GTK2/src/WorkerThreads.cpp:1203 UI/GTK2/src/WorkerThreads.cpp:1463
-#: UI/GTK2/src/WorkerThreads.cpp:1596
+#: UI/GTK2/src/WorkerThreads.cpp:664 UI/GTK2/src/WorkerThreads.cpp:962
+#: UI/GTK2/src/WorkerThreads.cpp:1047 UI/GTK2/src/WorkerThreads.cpp:1056
+#: UI/GTK2/src/WorkerThreads.cpp:1228 UI/GTK2/src/WorkerThreads.cpp:1488
+#: UI/GTK2/src/WorkerThreads.cpp:1621
 msgid "Index error on"
 msgstr "?????? ??????? ??"
 
-#: UI/GTK2/src/WorkerThreads.cpp:784 UI/GTK2/src/WorkerThreads.cpp:957
+#: UI/GTK2/src/WorkerThreads.cpp:785 UI/GTK2/src/WorkerThreads.cpp:983
 msgid "Couldn't create search engine"
 msgstr "?? ??????? ??????? ????????? ???????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:796 UI/GTK2/src/WorkerThreads.cpp:971
+#: UI/GTK2/src/WorkerThreads.cpp:797 UI/GTK2/src/WorkerThreads.cpp:997
 msgid "Couldn't run query on search engine"
 msgstr "?? ??????? ????????? ?????? ? ????????? ???????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:830
+#: UI/GTK2/src/WorkerThreads.cpp:842
 msgid "No title"
 msgstr "??? ????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1125
+#: UI/GTK2/src/WorkerThreads.cpp:1150
 msgid "Couldn't obtain downloader for protocol"
 msgstr "?? ??????? ???????? ????????? ??? ?????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1136
+#: UI/GTK2/src/WorkerThreads.cpp:1161
 msgid "Couldn't retrieve"
 msgstr "?? ??????? ???????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1233 UI/GTK2/src/WorkerThreads.cpp:1309
+#: UI/GTK2/src/WorkerThreads.cpp:1258 UI/GTK2/src/WorkerThreads.cpp:1334
 msgid "Cannot index document type"
 msgstr "?????????? ????????????? ?????? ??? ??????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1237 UI/GTK2/src/WorkerThreads.cpp:1313
+#: UI/GTK2/src/WorkerThreads.cpp:1262 UI/GTK2/src/WorkerThreads.cpp:1338
 msgid "at"
 msgstr "?"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1344
+#: UI/GTK2/src/WorkerThreads.cpp:1369
 msgid "Robots META tag forbids indexing"
 msgstr "META-???? ??????? ????????? ??????????????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1395
+#: UI/GTK2/src/WorkerThreads.cpp:1420
 msgid "Couldn't index"
 msgstr "?????????? ????????? ??????"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1474
+#: UI/GTK2/src/WorkerThreads.cpp:1499
 msgid "Couldn't unindex document(s)"
 msgstr "?????????? ??????????????? ????????(?)"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1608
+#: UI/GTK2/src/WorkerThreads.cpp:1633
 msgid "Couldn't update document"
 msgstr "?????????? ???????? ????????"



From fabricecolin at mail.berlios.de  Tue Feb 20 12:38:08 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 20 Feb 2007 12:38:08 +0100
Subject: [Pinot-svn] r730 - trunk
Message-ID: <200702201138.l1KBc8S7025213@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-20 12:38:06 +0100 (Tue, 20 Feb 2007)
New Revision: 730

Modified:
   trunk/AUTHORS
   trunk/NEWS
   trunk/TODO
Log:
State update.


Modified: trunk/AUTHORS
===================================================================
--- trunk/AUTHORS	2007-02-20 06:09:21 UTC (rev 729)
+++ trunk/AUTHORS	2007-02-20 11:38:06 UTC (rev 730)
@@ -12,6 +12,7 @@
 	Thierry Thomas <thierry at freebsd dot org>
 	Neal Becker <ndbecker2 at gmail dot com>
 	Gabriel C <nix dot or dot die at googlemail dot com> 
+	Roger Mason <rmason at esd dot mun dot ca>
 
 The file Monitor/linux-inotify-syscalls.h is originally from libinotify
 (Copyright ? 2005 Ryan Lortie <desrt at desrt dot ca>).
@@ -28,4 +29,6 @@
 	French - Nicolas Velin <nsv at fr dot st>
 	Spanish - Jes?s Tramullas <jesus at tramullas dot com>
 	Swedish - Daniel Nylander <po at danielnylander dot se>
+	Portuguese (Brazil) - Leonardo Melo <leonardovazmelo at gmail dot com>
+	Russian - Sergey Vostrikov <memphis at jabber dot snc dot ru>
 

Modified: trunk/NEWS
===================================================================
--- trunk/NEWS	2007-02-20 06:09:21 UTC (rev 729)
+++ trunk/NEWS	2007-02-20 11:38:06 UTC (rev 730)
@@ -1,3 +1,22 @@
+??? version_0_7_0
+Tokenize :
+ - now use Dijon's filters (http://dijon.berlios.de/)
+Index :
+ - support for remote indexes served by xapian-progsrv+ssh
+ - index to use by pinot-index specified with --db
+Search :
+ - limit the number of results returned by pinot-search with --max
+UI :
+ - stored queries can do date range filtering. If dates don't make sense
+  (eg From >= To), they are ignored.
+ - under the Session menu, Status shows various bits of information about
+  the indexes and the daemon's crawler
+ - prompt for command to use to open documents of a type for which no
+  application is defined
+ - revamped configuration dialog for external indexes
+ - Index > Properties now shows a document's size and number of unique terms
+ - most operations that involve peeking at the index are done in the background
+
 2006/12/21 version_0_6_5
 Build :
  - added option --enable-debug to configure, --enable-soap replaces --with-soap

Modified: trunk/TODO
===================================================================
--- trunk/TODO	2007-02-20 06:09:21 UTC (rev 729)
+++ trunk/TODO	2007-02-20 11:38:06 UTC (rev 730)
@@ -6,16 +6,19 @@
 - Load desktop files from /usr/share/applications/kde ?
 - DBUS_API_SUBJECT_TO_CHANGE only needed for DBus < 1.0
 - Document which query parameters apply to Web engines
+- Extend metadata beyond title,location,language,type,timestamp,size
 - Sync with gtk+'s xdgmime
 
 Tokenize
 - Allow to cache documents that had to be converted ? eg PDF, MS Word
-- PDF tokenizer with poppler
-- WordPerfect tokenizer with libwpd
-- Office tokenizer with libgst
+- PDF filter with poppler
+- WordPerfect filter with libwpd
+- Office filter with libgst
 - Check whether pdftotext flattens text in PDF documents that have columns
-- HtmlTokenizer should skip htdig_noindex blocks (http://www.htdig.org/attrs.html#noindex_start)
-- HtmlTokenizer to look for META tags Author, Creator, Publisher and CreationDate
+- HtmlFilter should skip htdig_noindex blocks (http://www.htdig.org/attrs.html#noindex_start)
+- HtmlFilter to look for META tags Author, Creator, Publisher and CreationDate
+- Filters should have a version number so that new versions force reindexing documents of the
+ given type
 
 Monitor
 - Implement support for Solaris FEM
@@ -41,11 +44,10 @@
 - Search for U-prefixed term in query generated by QueryParser and hash the URL if necessary
 - Make sure filters with quotes are (space-)escaped
 - Allow sorting by date
+- Get hold of stopwords lists for the languages supported by Xapian's stemmers
+ and remove stopwords from queries as first step of search
 
 Index
-- Get hold of stopwords lists for the languages supported by Xapian's stemmers and don't index stop words
-- Allow to import and use omindex-produced indexes  so that they can be used like pinot's internal indexes
-- Xapian lock files can be deleted at startup if no other instance is running
 - Play around with the XAPIAN_FLUSH_THRESHOLD env var
 - Hash document data to determine on updates whether documents have changed
 - Xapian Query objects will become serializable at some point, this will be useful
@@ -54,13 +56,14 @@
 - Reopen connection to remote indexes when necessary; does Xapian throw a RemoteError ?
 - Allow to access remote Xapian indexes tunneled through ssh with xapian-progsrv,
   and make sure ssh will ask passwords with /usr/libexec/openssh/ssh-askpass
-- All indexes can be browsed with the new global posting list found in Xapian > 0.9.9, ie
-  Xapian::Database::postlist_begin("")
 - Index xattrs if any
 - Reverse terms so that left wildcards can be applied ?
 - Index directories with type "x-directory/normal"
 - XapianIndex could do with some common code refactoring
 - Make sure prefixed terms are (space-)escaped
+- With Xapian 1.0, all indexes can be browsed with the new global posting list, ie
+  Xapian::Database::postlist_begin("")
+- Use Xapian 1.0 TextSplitter class
 
 Mail
 - Find out what kind of locking scheme Mozilla uses (POSIX lock ?) and use that
@@ -72,7 +75,6 @@
     Date: Thu, 25 Aug 2005 11:04:49 +0800
   +0800 is basically same as SGT. At the moment the date is assumed to be GMT !
 - Keep track of attachments and avoid indexing the same file twice
-- Most mboxes are now correctly recognized as application/mbox so index their messages
 
 Daemon
 - Allow building without inotify/the DBus daemon
@@ -98,16 +100,8 @@
 - Filter documents by language, similarly to how labels are shown
 - Either Live Query behaves like a live query (eg results list updated when new documents match)
   or it is renamed to something else to avoid confusion
-- Labels should be set by a separate thread
 - When viewing a result, all rows for that same URL should be updated with the Viewed icon
-- Prompt users for a command-line if the type of the document to open has no application,
-  with default to xdg-open if it's available
-- In Statistics, show whether daemon is running and under what PID (possibly borrowing code
- from pidof)
-- Search internal indexes before any external one, to avoid having a non-accessible remote
- index block a query
-- Disable the Index menuitem if all selected results have already been indexed
-- Don't call DBusXapianIndex::getStatistics() from the main thread, this can freeze the UI;
- launch a new thread
-- Never poke at the indexes from the main thread !
+- Set results' indexed status after IndexingThread returns
+- Show date ranges in queries summary
+- Add Group By None to show all results at the same level
 



From fabricecolin at mail.berlios.de  Wed Feb 21 15:34:02 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Wed, 21 Feb 2007 15:34:02 +0100
Subject: [Pinot-svn] r731 - trunk/Index
Message-ID: <200702211434.l1LEY2FS032424@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-21 15:34:01 +0100 (Wed, 21 Feb 2007)
New Revision: 731

Modified:
   trunk/Index/FilterWrapper.cpp
   trunk/Index/FilterWrapper.h
Log:
Handles unsupported types.


Modified: trunk/Index/FilterWrapper.cpp
===================================================================
--- trunk/Index/FilterWrapper.cpp	2007-02-20 11:38:06 UTC (rev 730)
+++ trunk/Index/FilterWrapper.cpp	2007-02-21 14:34:01 UTC (rev 731)
@@ -20,11 +20,11 @@
 
 #include "Url.h"
 #include "FilterFactory.h"
+#include "TextFilter.h"
 #include "FilterUtils.h"
 #include "FilterWrapper.h"
 
 using std::cout;
-using std::cerr;
 using std::endl;
 using std::string;
 using std::set;
@@ -41,32 +41,45 @@
 bool FilterWrapper::indexDocument(IndexInterface &index, const Document &doc,
 	const set<string> &labels, unsigned int &docId)
 {
-	Document docCopy(doc);
-
-	return filterDocument(index, docCopy, 0, labels, docId, false);
+	return filterDocument(index, doc, 0, labels, docId, false);
 }
 
 bool FilterWrapper::updateDocument(unsigned int docId, IndexInterface &index, const Document &doc)
 {
-	Document docCopy(doc);
 	set<string> labels;
 
-	return filterDocument(index, docCopy, 0, labels, docId, true);
+	return filterDocument(index, doc, 0, labels, docId, true);
 }
 
-bool FilterWrapper::filterDocument(IndexInterface &index, Document &doc,
-	unsigned int count, const set<string> &labels, unsigned int &docId,
-	bool doUpdate)
+bool FilterWrapper::filterDocument(IndexInterface &index, const Document &doc,
+	unsigned int count, const set<string> &labels,
+	unsigned int &docId, bool doUpdate)
 {
 	Filter *pFilter = FilterFactory::getFilter(doc.getType());
-	bool success = false;
+	bool fedFilter = false, success = false;
 
-	if (pFilter == NULL)
+	if (pFilter != NULL)
 	{
-		return false;
+		fedFilter = FilterUtils::feedFilter(doc, pFilter);
 	}
+	else
+	{
+		// Chances are this type is not supported
+		pFilter = new TextFilter("text/plain");
 
-	if (FilterUtils::feedFilter(doc, pFilter) == false)
+		Document emptyDoc(doc.getTitle(), doc.getLocation(), doc.getType(), doc.getLanguage());
+
+		emptyDoc.setTimestamp(doc.getTimestamp());
+		emptyDoc.setSize(doc.getSize());
+		emptyDoc.setData(" ", 1);
+
+#ifdef DEBUG
+		cout << "FilterWrapper::filterDocument: unsupported type " << doc.getType() << endl;
+#endif
+		fedFilter = FilterUtils::feedFilter(emptyDoc, pFilter);
+	}
+
+	if (fedFilter == false)
 	{
 		delete pFilter;
 
@@ -75,13 +88,16 @@
 
 	while (pFilter->has_documents() == true)
 	{
-		Document filteredDoc(doc.getTitle(), doc.getLocation(), "text/plain", doc.getLanguage());
-
 		if (pFilter->next_document() == false)
 		{
 			break;
 		}
 
+		Document filteredDoc(doc.getTitle(), doc.getLocation(), "text/plain", doc.getLanguage());
+
+		filteredDoc.setTimestamp(doc.getTimestamp());
+		filteredDoc.setSize(doc.getSize());
+
 		if (FilterUtils::populateDocument(filteredDoc, pFilter) == false)
 		{
 			continue;
@@ -90,12 +106,16 @@
 		// Pass it down to another filter ?
 		if (filteredDoc.getType() != "text/plain")
 		{
-			filterDocument(index, filteredDoc, count, labels, docId, doUpdate);
+			success = filterDocument(index, filteredDoc, count, labels, docId, doUpdate);
+			delete pFilter;
+
+			return success;
 		}
 		else
 		{
+			filteredDoc.setType(doc.getType());
+
 			Tokenizer tokens(&filteredDoc);
-
 			if (doUpdate == false)
 			{
 				success = index.indexDocument(tokens, labels, docId);
@@ -109,5 +129,12 @@
 
 	delete pFilter;
 
+#ifdef DEBUG
+	if (success == false)
+	{
+		cout << "FilterWrapper::filterDocument: didn't index " << doc.getLocation() << endl;
+	}
+#endif
+
 	return success;
 }

Modified: trunk/Index/FilterWrapper.h
===================================================================
--- trunk/Index/FilterWrapper.h	2007-02-20 11:38:06 UTC (rev 730)
+++ trunk/Index/FilterWrapper.h	2007-02-21 14:34:01 UTC (rev 731)
@@ -43,9 +43,9 @@
 	protected:
 		FilterWrapper();
 
-		static bool filterDocument(IndexInterface &index, Document &doc,
-			unsigned int count, const std::set<std::string> &labels, unsigned int &docId,
-			bool doUpdate);
+		static bool filterDocument(IndexInterface &index, const Document &doc,
+			unsigned int count, const std::set<std::string> &labels,
+			unsigned int &docId, bool doUpdate);
 
 	private:
 		FilterWrapper(const FilterWrapper &other);



From fabricecolin at mail.berlios.de  Wed Feb 21 15:37:48 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Wed, 21 Feb 2007 15:37:48 +0100
Subject: [Pinot-svn] r732 - trunk/Tokenize
Message-ID: <200702211437.l1LEbmca032732@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-21 15:37:48 +0100 (Wed, 21 Feb 2007)
New Revision: 732

Modified:
   trunk/Tokenize/FilterUtils.cpp
Log:
Don't fail if the file is empty.


Modified: trunk/Tokenize/FilterUtils.cpp
===================================================================
--- trunk/Tokenize/FilterUtils.cpp	2007-02-21 14:34:01 UTC (rev 731)
+++ trunk/Tokenize/FilterUtils.cpp	2007-02-21 14:37:48 UTC (rev 732)
@@ -111,6 +111,11 @@
 			{
 				fedInput = pFilter->set_document_data(pData, dataLength);
 			}
+			else
+			{
+				// The file may be empty
+				fedInput = pFilter->set_document_data(" ", 1);
+			}
 		}
 	}
 



From fabricecolin at mail.berlios.de  Wed Feb 21 15:39:05 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Wed, 21 Feb 2007 15:39:05 +0100
Subject: [Pinot-svn] r733 - trunk/UI/GTK2/src
Message-ID: <200702211439.l1LEd56L000063@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-21 15:39:05 +0100 (Wed, 21 Feb 2007)
New Revision: 733

Modified:
   trunk/UI/GTK2/src/WorkerThreads.cpp
Log:
Look for the robots directive.


Modified: trunk/UI/GTK2/src/WorkerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.cpp	2007-02-21 14:37:48 UTC (rev 732)
+++ trunk/UI/GTK2/src/WorkerThreads.cpp	2007-02-21 14:39:05 UTC (rev 733)
@@ -1340,40 +1340,44 @@
 				m_status += m_docInfo.getLocation();
 				return;
 			}
-#ifdef DEBUG
-			cout << "IndexingThread::doWork: can't index document content" << endl;
-#endif
 
-			// Create an empty document so that the file's details are indexed but not its content
-			delete m_pDoc;
-			m_pDoc = new Document(m_docInfo);
-			m_pDoc->setType("text/plain");
+			// Let FilterWrapper handle unspported documents
 		}
-#if 0
-		else
+		else if ((PinotSettings::getInstance().m_ignoreRobotsDirectives == false) &&
+			(m_docInfo.getType().length() >= 9) &&
+			(m_docInfo.getType().substr(9) == "text/html"))
 		{
-			// Is indexing allowed ?
-			HtmlFilter *pHtmlFilter = dynamic_cast<HtmlFilter*>(pFilter);
-			if ((m_update == false) &&
-				(pHtmlTokens != NULL))
+			Dijon::HtmlFilter htmlFilter(m_docInfo.getType());
+
+			if ((FilterUtils::feedFilter(*m_pDoc, &htmlFilter) == true) &&
+				(htmlFilter.next_document() == true))
 			{
-		// See if the document has a ROBOTS META tag
-		string robotsDirectives = pHtmlTokens->getMetaTag("robots");
-		string::size_type pos1 = robotsDirectives.find("none");
-		string::size_type pos2 = robotsDirectives.find("noindex");
-		if ((pos1 != string::npos) ||
-			(pos2 != string::npos))
-		{
-			// No, it's not
-			delete pTokens;
-			m_status = _("Robots META tag forbids indexing");
-			m_status += " ";
-			m_status += m_docInfo.getLocation();
-			return;
-		}
+				const map<string, string> &metaData = htmlFilter.get_meta_data();
+
+				// See if the document has a ROBOTS META tag
+				map<string, string>::const_iterator robotsIter = metaData.find("robots");
+				if (robotsIter != metaData.end())
+				{
+					string robotsDirectives(robotsIter->second);
+	
+					// Is indexing allowed ?
+					string::size_type pos1 = robotsDirectives.find("none");
+					string::size_type pos2 = robotsDirectives.find("noindex");
+					if ((pos1 != string::npos) ||
+						(pos2 != string::npos))
+					{
+						// No, it isn't
+						m_status = _("Robots META tag forbids indexing");
+						m_status += " ";
+						m_status += m_docInfo.getLocation();
+						return;
+					}
+				}
 			}
+#ifdef DEBUG
+			else cout << "IndexingThread::doWork: couldn't check document for ROBOTS directive" << endl;
+#endif
 		}
-#endif
 
 		if (m_done == false)
 		{



From fabricecolin at mail.berlios.de  Thu Feb 22 13:58:36 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Thu, 22 Feb 2007 13:58:36 +0100
Subject: [Pinot-svn] r734 - trunk/UI/GTK2/src
Message-ID: <200702221258.l1MCwaNl012009@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-22 13:58:35 +0100 (Thu, 22 Feb 2007)
New Revision: 734

Modified:
   trunk/UI/GTK2/src/ResultsTree.cpp
Log:
Fixed construction of Results.


Modified: trunk/UI/GTK2/src/ResultsTree.cpp
===================================================================
--- trunk/UI/GTK2/src/ResultsTree.cpp	2007-02-21 14:39:05 UTC (rev 733)
+++ trunk/UI/GTK2/src/ResultsTree.cpp	2007-02-22 12:58:35 UTC (rev 734)
@@ -879,8 +879,8 @@
 		{
 			bool isIndexed = row[m_resultsColumns.m_indexed];
 
-			Result current(from_utf8(row[m_resultsColumns.m_text]),
-				from_utf8(row[m_resultsColumns.m_url]), "", "");
+			Result current(from_utf8(row[m_resultsColumns.m_url]),
+				from_utf8(row[m_resultsColumns.m_text]), "", "");
 
 			if (isIndexed == true)
 			{



From fabricecolin at mail.berlios.de  Thu Feb 22 15:05:03 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Thu, 22 Feb 2007 15:05:03 +0100
Subject: [Pinot-svn] r735 - trunk/UI/GTK2/src
Message-ID: <200702221405.l1ME53aT023710@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-22 15:05:02 +0100 (Thu, 22 Feb 2007)
New Revision: 735

Modified:
   trunk/UI/GTK2/src/statisticsDialog.cc
Log:
Index stats labels were swapped.


Modified: trunk/UI/GTK2/src/statisticsDialog.cc
===================================================================
--- trunk/UI/GTK2/src/statisticsDialog.cc	2007-02-22 12:58:35 UTC (rev 734)
+++ trunk/UI/GTK2/src/statisticsDialog.cc	2007-02-22 14:05:02 UTC (rev 735)
@@ -71,7 +71,7 @@
 
 	TreeModel::iterator statIter = m_refStore->append(folderIter->children());
 	row = *statIter;
-	row[m_statsColumns.m_name] = _("My Documents");
+	row[m_statsColumns.m_name] = _("My Web Pages");
 	IndexInterface *pIndex = PinotSettings::getInstance().getIndex(PinotSettings::getInstance().m_docsIndexLocation);
 	if ((pIndex != NULL) &&
 		(pIndex->isGood() == true))
@@ -85,7 +85,7 @@
 
 	statIter = m_refStore->append(folderIter->children());
 	row = *statIter;
-	row[m_statsColumns.m_name] = _("My Web Pages");
+	row[m_statsColumns.m_name] = _("My Documents");
 	pIndex = PinotSettings::getInstance().getIndex(PinotSettings::getInstance().m_daemonIndexLocation);
 	if ((pIndex != NULL) &&
 		(pIndex->isGood() == true))



From fabricecolin at mail.berlios.de  Thu Feb 22 15:53:04 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Thu, 22 Feb 2007 15:53:04 +0100
Subject: [Pinot-svn] r736 - trunk/Search
Message-ID: <200702221453.l1MEr4Eh032575@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-22 15:53:03 +0100 (Thu, 22 Feb 2007)
New Revision: 736

Modified:
   trunk/Search/XapianEngine.cpp
Log:
Comment to remind myself I could use enquire.get_matching_terms_begin() here.


Modified: trunk/Search/XapianEngine.cpp
===================================================================
--- trunk/Search/XapianEngine.cpp	2007-02-22 14:05:02 UTC (rev 735)
+++ trunk/Search/XapianEngine.cpp	2007-02-22 14:53:03 UTC (rev 736)
@@ -346,6 +346,7 @@
 				Xapian::docid docId = *mIter;
 				Xapian::Document doc(mIter.get_document());
 				AbstractGenerator abstractGen(pIndex, 50);
+				// FIXME: we could use enquire.get_matching_terms_begin(docId) to populate seedTerms
 				Result thisResult("", "", abstractGen.generateAbstract(docId, seedTerms),
 					"", (float)mIter.get_percent());
 



From fabricecolin at mail.berlios.de  Thu Feb 22 15:53:40 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Thu, 22 Feb 2007 15:53:40 +0100
Subject: [Pinot-svn] r737 - trunk/Utils
Message-ID: <200702221453.l1MEreEI032669@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-22 15:53:39 +0100 (Thu, 22 Feb 2007)
New Revision: 737

Modified:
   trunk/Utils/Document.cpp
   trunk/Utils/Document.h
Log:
Method resetData().


Modified: trunk/Utils/Document.cpp
===================================================================
--- trunk/Utils/Document.cpp	2007-02-22 14:53:03 UTC (rev 736)
+++ trunk/Utils/Document.cpp	2007-02-22 14:53:39 UTC (rev 737)
@@ -71,7 +71,7 @@
 
 Document::~Document()
 {
-	freeData();
+	resetData();
 }
 
 Document& Document::operator=(const Document& other)
@@ -102,27 +102,6 @@
 	return true;
 }
 
-void Document::freeData(void)
-{
-	if (m_pData != NULL)
-	{
-		if (m_isMapped == false)
-		{
-			// Free
-			free(m_pData);
-		}
-		else
-		{
-			// Unmap
-			munmap((void*)m_pData, m_dataLength);
-		}
-	}
-
-	m_pData = NULL;
-	m_dataLength = 0;
-	m_isMapped = false;
-}
-
 /// Copies the given data in the document.
 bool Document::setData(const char *data, unsigned int length)
 {
@@ -133,7 +112,7 @@
 	}
 
 	// Discard existing data
-	freeData();
+	resetData();
 
 	m_pData = (char *)malloc(sizeof(char) * (length + 1));
 	if (m_pData != NULL)
@@ -171,7 +150,7 @@
 	if (fileStat.st_size == 0)
 	{
 		// The file is empty
-		freeData();
+		resetData();
 		return true;
 	}
 
@@ -184,7 +163,7 @@
 	}
 
 	// Discard existing data
-	freeData();
+	resetData();
 
 	// Request a private mapping of the whole file
 	void *mapSpace = mmap(NULL, fileStat.st_size, PROT_READ, MAP_PRIVATE, fd, 0);
@@ -219,6 +198,28 @@
 	return m_pData;
 }
 
+/// Resets the document's data.
+void Document::resetData(void)
+{
+	if (m_pData != NULL)
+	{
+		if (m_isMapped == false)
+		{
+			// Free
+			free(m_pData);
+		}
+		else
+		{
+			// Unmap
+			munmap((void*)m_pData, m_dataLength);
+		}
+	}
+
+	m_pData = NULL;
+	m_dataLength = 0;
+	m_isMapped = false;
+}
+
 /// Checks whether the document is binary.
 bool Document::isBinary(void) const
 {

Modified: trunk/Utils/Document.h
===================================================================
--- trunk/Utils/Document.h	2007-02-22 14:53:03 UTC (rev 736)
+++ trunk/Utils/Document.h	2007-02-22 14:53:39 UTC (rev 737)
@@ -47,6 +47,9 @@
 		/// Returns the document's data; NULL if document is empty.
 		virtual const char *getData(unsigned int &length) const;
 
+		/// Resets the document's data.
+		void resetData(void);
+
 		/// Checks whether the document is binary.
 		virtual bool isBinary(void) const;
 
@@ -55,8 +58,6 @@
 		unsigned int m_dataLength;
 		bool m_isMapped;
 
-		void freeData(void);
-
 };
 
 #endif // _DOCUMENT_H



From fabricecolin at mail.berlios.de  Thu Feb 22 15:56:34 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Thu, 22 Feb 2007 15:56:34 +0100
Subject: [Pinot-svn] r738 - trunk/UI/GTK2/src
Message-ID: <200702221456.l1MEuYg9000242@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-22 15:56:33 +0100 (Thu, 22 Feb 2007)
New Revision: 738

Modified:
   trunk/UI/GTK2/src/PinotSettings.cpp
Log:
Removed extensions handled by ExternalFilter from default blacklist.


Modified: trunk/UI/GTK2/src/PinotSettings.cpp
===================================================================
--- trunk/UI/GTK2/src/PinotSettings.cpp	2007-02-22 14:53:39 UTC (rev 737)
+++ trunk/UI/GTK2/src/PinotSettings.cpp	2007-02-22 14:56:33 UTC (rev 738)
@@ -251,10 +251,8 @@
 		m_filePatternsBlackList.insert("*.Z");
 		m_filePatternsBlackList.insert("*.avi");
 		m_filePatternsBlackList.insert("*.asf");
-		m_filePatternsBlackList.insert("*.bz2");
 		m_filePatternsBlackList.insert("*.deb");
 		m_filePatternsBlackList.insert("*.gif");
-		m_filePatternsBlackList.insert("*.gz");
 		m_filePatternsBlackList.insert("*.jpeg");
 		m_filePatternsBlackList.insert("*.jpg");
 		m_filePatternsBlackList.insert("*.png");
@@ -263,11 +261,8 @@
 		m_filePatternsBlackList.insert("*.msf");
 		m_filePatternsBlackList.insert("*.mpeg");
 		m_filePatternsBlackList.insert("*.mpg");
-		m_filePatternsBlackList.insert("*.rpm");
 		m_filePatternsBlackList.insert("*.sh");
-		m_filePatternsBlackList.insert("*.tar");
 		m_filePatternsBlackList.insert("*.wmv");
-		m_filePatternsBlackList.insert("*.zip");
 	}
 
 	// Some search engines are hardcoded



From fabricecolin at mail.berlios.de  Thu Feb 22 15:57:10 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Thu, 22 Feb 2007 15:57:10 +0100
Subject: [Pinot-svn] r739 - trunk/UI/GTK2/src
Message-ID: <200702221457.l1MEvAoq000306@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-22 15:57:10 +0100 (Thu, 22 Feb 2007)
New Revision: 739

Modified:
   trunk/UI/GTK2/src/pinot-dbus-daemon.xml
Log:
Warning notice about the changing interface.


Modified: trunk/UI/GTK2/src/pinot-dbus-daemon.xml
===================================================================
--- trunk/UI/GTK2/src/pinot-dbus-daemon.xml	2007-02-22 14:56:33 UTC (rev 738)
+++ trunk/UI/GTK2/src/pinot-dbus-daemon.xml	2007-02-22 14:57:10 UTC (rev 739)
@@ -1,5 +1,8 @@
 <?xml version="1.0" encoding="UTF-8" ?>
 <node name="/de/berlios/Pinot">
+  <!--
+	This interface WILL change before 1.0 is released !
+	-->
   <interface name="de.berlios.Pinot">
     <!--
 	Deletes a label.



From fabricecolin at mail.berlios.de  Thu Feb 22 16:01:22 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Thu, 22 Feb 2007 16:01:22 +0100
Subject: [Pinot-svn] r740 - trunk/Utils/xdgmime
Message-ID: <200702221501.l1MF1MKQ000877@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-22 16:01:22 +0100 (Thu, 22 Feb 2007)
New Revision: 740

Modified:
   trunk/Utils/xdgmime/xdgmimemagic.c
Log:
Synced with gtk+/gtk/xdgmime.


Modified: trunk/Utils/xdgmime/xdgmimemagic.c
===================================================================
--- trunk/Utils/xdgmime/xdgmimemagic.c	2007-02-22 14:57:10 UTC (rev 739)
+++ trunk/Utils/xdgmime/xdgmimemagic.c	2007-02-22 15:01:22 UTC (rev 740)
@@ -47,6 +47,10 @@
 #define	TRUE	(!FALSE)
 #endif
 
+#if !defined getc_unlocked && !defined HAVE_GETC_UNLOCKED
+# define getc_unlocked(fp) getc (fp)
+#endif
+
 typedef struct XdgMimeMagicMatch XdgMimeMagicMatch;
 typedef struct XdgMimeMagicMatchlet XdgMimeMagicMatchlet;
 



From fabricecolin at mail.berlios.de  Fri Feb 23 14:30:14 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Fri, 23 Feb 2007 14:30:14 +0100
Subject: [Pinot-svn] r741 - trunk/Search
Message-ID: <200702231330.l1NDUEBO008103@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-23 14:30:13 +0100 (Fri, 23 Feb 2007)
New Revision: 741

Modified:
   trunk/Search/XapianEngine.cpp
Log:
Not finding any result is okay, queryDatabase() shouldn't return false.


Modified: trunk/Search/XapianEngine.cpp
===================================================================
--- trunk/Search/XapianEngine.cpp	2007-02-22 15:01:22 UTC (rev 740)
+++ trunk/Search/XapianEngine.cpp	2007-02-23 13:30:13 UTC (rev 741)
@@ -292,6 +292,8 @@
 
 bool XapianEngine::queryDatabase(Xapian::Database *pIndex, Xapian::Query &query)
 {
+	bool completedQuery = false;
+
 	if (pIndex == NULL)
 	{
 		return false;
@@ -370,6 +372,8 @@
 				m_resultsList.push_back(thisResult);
 			}
 		}
+
+		completedQuery = true;
 	}
 	catch (const Xapian::Error &error)
 	{
@@ -411,7 +415,8 @@
 	}
 
 	// Be tolerant of errors as long as we got some results
-	if (m_resultsList.empty() == false)
+	if ((completedQuery == true) ||
+		(m_resultsList.empty() == false))
 	{
 		return true;
 	}



From fabricecolin at mail.berlios.de  Fri Feb 23 16:19:49 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Fri, 23 Feb 2007 16:19:49 +0100
Subject: [Pinot-svn] r742 - in trunk: Index SQL UI/GTK2/src
Message-ID: <200702231519.l1NFJn9X016018@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-23 16:19:48 +0100 (Fri, 23 Feb 2007)
New Revision: 742

Modified:
   trunk/Index/DBusXapianIndex.cpp
   trunk/Index/DBusXapianIndex.h
   trunk/Index/IndexInterface.h
   trunk/Index/XapianIndex.cpp
   trunk/Index/XapianIndex.h
   trunk/SQL/CrawlHistory.cpp
   trunk/SQL/CrawlHistory.h
   trunk/UI/GTK2/src/MboxHandler.cpp
   trunk/UI/GTK2/src/OnDiskHandler.cpp
   trunk/UI/GTK2/src/WorkerThreads.cpp
Log:
Overloaded IndexInterface::unindexDocuments() and added deleteItems() to
CrawlHistory to be able to remove all documents under a given directory in one
fell swoop.


Modified: trunk/Index/DBusXapianIndex.cpp
===================================================================
--- trunk/Index/DBusXapianIndex.cpp	2007-02-23 13:30:13 UTC (rev 741)
+++ trunk/Index/DBusXapianIndex.cpp	2007-02-23 15:19:48 UTC (rev 742)
@@ -497,8 +497,8 @@
 	return false;
 }
 
-/// Unindexes documents with the given label.
-bool DBusXapianIndex::unindexDocuments(const string &labelName)
+/// Unindexes documents with the given label or under the given directory.
+bool DBusXapianIndex::unindexDocuments(const string &name, bool isDirectory)
 {
 	cerr << "DBusXapianIndex::unindexDocuments: not allowed" << endl;
 	return false;

Modified: trunk/Index/DBusXapianIndex.h
===================================================================
--- trunk/Index/DBusXapianIndex.h	2007-02-23 13:30:13 UTC (rev 741)
+++ trunk/Index/DBusXapianIndex.h	2007-02-23 15:19:48 UTC (rev 742)
@@ -100,8 +100,8 @@
 		/// Unindexes the given document.
 		virtual bool unindexDocument(unsigned int docId);
 
-		/// Unindexes documents with the given label.
-		virtual bool unindexDocuments(const std::string &labelName);
+		/// Unindexes documents with the given label or under the given directory.
+		virtual bool unindexDocuments(const std::string &name, bool isDirectory);
 
 		/// Renames a label.
 		virtual bool renameLabel(const std::string &name, const std::string &newName);

Modified: trunk/Index/IndexInterface.h
===================================================================
--- trunk/Index/IndexInterface.h	2007-02-23 13:30:13 UTC (rev 741)
+++ trunk/Index/IndexInterface.h	2007-02-23 15:19:48 UTC (rev 742)
@@ -110,8 +110,8 @@
 		/// Unindexes the given document.
 		virtual bool unindexDocument(const std::string &location) = 0;
 
-		/// Unindexes documents with the given label.
-		virtual bool unindexDocuments(const std::string &labelName) = 0;
+		/// Unindexes documents with the given label or under the given directory.
+		virtual bool unindexDocuments(const std::string &name, bool isDirectory) = 0;
 
 		/// Renames a label.
 		virtual bool renameLabel(const std::string &name, const std::string &newName) = 0;

Modified: trunk/Index/XapianIndex.cpp
===================================================================
--- trunk/Index/XapianIndex.cpp	2007-02-23 13:30:13 UTC (rev 741)
+++ trunk/Index/XapianIndex.cpp	2007-02-23 15:19:48 UTC (rev 742)
@@ -1002,7 +1002,8 @@
 	string term("XDIR:");
 
 	term += dirName;
-	return listDocumentsWithTerm(term, docIds, maxDocsCount, startDoc);
+	return listDocumentsWithTerm(XapianDatabase::limitTermLength(term, true),
+		docIds, maxDocsCount, startDoc);
 }
 
 /// Indexes the given data.
@@ -1374,12 +1375,12 @@
 	return unindexed;
 }
 
-/// Unindexes documents with the given label.
-bool XapianIndex::unindexDocuments(const string &labelName)
+/// Unindexes documents with the given label or under the given directory.
+bool XapianIndex::unindexDocuments(const string &name, bool isDirectory)
 {
 	bool unindexed = false;
 
-	if (labelName.empty() == true)
+	if (name.empty() == true)
 	{
 		return false;
 	}
@@ -1398,9 +1399,21 @@
 		{
 			string term("XLABEL:");
 
+			if (isDirectory == true)
+			{
+				term = XapianDatabase::limitTermLength(string("XDIR:") + name, true);
+			}
+			else
+			{
+				term += name;
+			}
+#ifdef DEBUG
+			cout << "XapianIndex::unindexDocuments: term is " << term << endl;
+#endif
+
 			// Delete documents from the index
-			term += labelName;
 			pIndex->delete_document(term);
+
 			unindexed = true;
 		}
 	}

Modified: trunk/Index/XapianIndex.h
===================================================================
--- trunk/Index/XapianIndex.h	2007-02-23 13:30:13 UTC (rev 741)
+++ trunk/Index/XapianIndex.h	2007-02-23 15:19:48 UTC (rev 742)
@@ -101,8 +101,8 @@
 		/// Unindexes the given document.
 		virtual bool unindexDocument(const std::string &location);
 
-		/// Unindexes documents with the given label.
-		virtual bool unindexDocuments(const std::string &labelName);
+		/// Unindexes documents with the given label or under the given directory.
+		virtual bool unindexDocuments(const std::string &name, bool isDirectory);
 
 		/// Renames a label.
 		virtual bool renameLabel(const std::string &name, const std::string &newName);

Modified: trunk/SQL/CrawlHistory.cpp
===================================================================
--- trunk/SQL/CrawlHistory.cpp	2007-02-23 13:30:13 UTC (rev 741)
+++ trunk/SQL/CrawlHistory.cpp	2007-02-23 15:19:48 UTC (rev 742)
@@ -372,6 +372,22 @@
 	return success;
 }
 
+/// Deletes all items under a given URL.
+bool CrawlHistory::deleteItems(const string &url)
+{
+	bool success = false;
+
+	SQLiteResults *results = executeStatement("DELETE FROM CrawlHistory \
+		WHERE Url LIKE '%q%%';", Url::escapeUrl(url).c_str());
+	if (results != NULL)
+	{
+		success = true;
+		delete results;
+	}
+
+	return success;
+}
+
 /// Deletes URLs belonging to a source.
 bool CrawlHistory::deleteItems(unsigned int sourceId, CrawlStatus status)
 {

Modified: trunk/SQL/CrawlHistory.h
===================================================================
--- trunk/SQL/CrawlHistory.h	2007-02-23 13:30:13 UTC (rev 741)
+++ trunk/SQL/CrawlHistory.h	2007-02-23 15:19:48 UTC (rev 742)
@@ -74,6 +74,9 @@
 		/// Deletes an URL.
 		bool deleteItem(const string &url);
 
+		/// Deletes all items under a given URL.
+		bool deleteItems(const string &url);
+
 		/// Deletes URLs belonging to a source.
 		bool deleteItems(unsigned int sourceId, CrawlStatus status = UNKNOWN);
 

Modified: trunk/UI/GTK2/src/MboxHandler.cpp
===================================================================
--- trunk/UI/GTK2/src/MboxHandler.cpp	2007-02-23 13:30:13 UTC (rev 741)
+++ trunk/UI/GTK2/src/MboxHandler.cpp	2007-02-23 15:19:48 UTC (rev 742)
@@ -280,7 +280,7 @@
 					<< sourceLabel << endl;
 #endif
 				// All documents with this label will be unindexed
-				m_index.unindexDocuments(sourceLabel);
+				m_index.unindexDocuments(sourceLabel, false);
 
 				// Delete this item
 				m_history.deleteItem(*mailIter);

Modified: trunk/UI/GTK2/src/OnDiskHandler.cpp
===================================================================
--- trunk/UI/GTK2/src/OnDiskHandler.cpp	2007-02-23 13:30:13 UTC (rev 741)
+++ trunk/UI/GTK2/src/OnDiskHandler.cpp	2007-02-23 15:19:48 UTC (rev 742)
@@ -186,7 +186,7 @@
 					<< ", source " << sourceId << " was removed" << endl;
 #endif
 				// All documents with this label will be unindexed
-				if (m_index.unindexDocuments(sourceStr) == true)
+				if (m_index.unindexDocuments(sourceStr, false) == true)
 				{
 					// Delete the source itself and all its items
 					m_history.deleteSource(sourceId);
@@ -356,25 +356,11 @@
 	cout << "OnDiskHandler::directoryDeleted: " << dirName << endl;
 #endif
 	pthread_mutex_lock(&m_mutex);
-	if (m_index.listDocumentsInDirectory(dirName, docIdList) == true)
+	if (m_index.unindexDocuments(dirName, true) == true)
 	{
-		for (set<unsigned int>::const_iterator iter = docIdList.begin();
-			iter != docIdList.end(); ++iter)
-		{
-			DocumentInfo docInfo;
-
-			if ((m_index.getDocumentInfo(*iter, docInfo) == true) &&
-				(m_index.unindexDocument(*iter) == true))
-			{
-				m_history.deleteItem(docInfo.getLocation());
-			}
-		}
-
+		m_history.deleteItems(string("file://") + dirName);
 		handledEvent = true;
 	}
-#ifdef DEBUG
-	else cout << "OnDiskHandler::directoryDeleted: no documents in " << dirName << endl;
-#endif
 	pthread_mutex_unlock(&m_mutex);
 
 	return handledEvent;

Modified: trunk/UI/GTK2/src/WorkerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.cpp	2007-02-23 13:30:13 UTC (rev 741)
+++ trunk/UI/GTK2/src/WorkerThreads.cpp	2007-02-23 15:19:48 UTC (rev 742)
@@ -1513,7 +1513,7 @@
 
 			// By unindexing all documents that match the label,
 			// we effectively delete the label from the index
-			if (pIndex->unindexDocuments(labelName) == true)
+			if (pIndex->unindexDocuments(labelName, false) == true)
 			{
 #ifdef DEBUG
 				cout << "UnindexingThread::doWork: removed label " << labelName << endl;



From fabricecolin at mail.berlios.de  Sat Feb 24 08:07:01 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 24 Feb 2007 08:07:01 +0100
Subject: [Pinot-svn] r743 - trunk/UI/GTK2/src
Message-ID: <200702240707.l1O7716b020104@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-24 08:07:01 +0100 (Sat, 24 Feb 2007)
New Revision: 743

Modified:
   trunk/UI/GTK2/src/WorkerThreads.cpp
Log:
Skip download if the filter can be directly pointed at the document.


Modified: trunk/UI/GTK2/src/WorkerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.cpp	2007-02-23 15:19:48 UTC (rev 742)
+++ trunk/UI/GTK2/src/WorkerThreads.cpp	2007-02-24 07:07:01 UTC (rev 743)
@@ -1265,18 +1265,24 @@
 			return;
 		}
 	}
+	else
+	{
+		Dijon::Filter *pFilter = Dijon::FilterFactory::getFilter(m_docInfo.getType());
 
-#if 0
-	if ((dataNeeds == Tokenizer::ALL_BUT_FILES) &&
-		(thisUrl.getProtocol() == "file"))
-	{
-		doDownload = false;
+		if (pFilter != NULL)
+		{
+			// We may able to feed the document directly to the filter
+			if (((pFilter->is_data_input_ok(Dijon::Filter::DOCUMENT_FILE_NAME) == true) &&
+				(thisUrl.getProtocol() == "file")) ||
+				((pFilter->is_data_input_ok(Dijon::Filter::DOCUMENT_URI) == true) &&
+				(thisUrl.getProtocol() == "http")))
+			{
+				doDownload = false;
+			}
+
+			delete pFilter;
+		}
 	}
-	else if (dataNeeds == Tokenizer::NO_DOCUMENTS)
-	{
-		doDownload = false;
-	}
-#endif
 
 	if (doDownload == true)
 	{



From fabricecolin at mail.berlios.de  Sat Feb 24 09:08:39 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 24 Feb 2007 09:08:39 +0100
Subject: [Pinot-svn] r744 - in trunk: Collect Index Tokenize
Message-ID: <200702240808.l1O88dVU022840@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-24 09:08:39 +0100 (Sat, 24 Feb 2007)
New Revision: 744

Modified:
   trunk/Collect/MboxCollector.cpp
   trunk/Index/FilterWrapper.cpp
   trunk/Index/FilterWrapper.h
   trunk/Tokenize/FilterUtils.cpp
Log:
FilterUtils::feedFilter() can save data to a temporary file as a last resort.
Mailbox documents shouldn't be treated like files.
FilterWrapper preserves the MIME type of documents before transformation.
MboxCollector first feeds the mbox file, then skips to the necessary offset.


Modified: trunk/Collect/MboxCollector.cpp
===================================================================
--- trunk/Collect/MboxCollector.cpp	2007-02-24 07:07:01 UTC (rev 743)
+++ trunk/Collect/MboxCollector.cpp	2007-02-24 08:08:39 UTC (rev 744)
@@ -43,7 +43,8 @@
 /// Retrieves the specified document; NULL if error.
 Document *MboxCollector::retrieveUrl(const DocumentInfo &docInfo)
 {
-	Url thisUrl(docInfo.getLocation());
+	string location(docInfo.getLocation());
+	Url thisUrl(location);
 	string protocol(thisUrl.getProtocol());
 	string parameters(thisUrl.getParameters());
 
@@ -68,15 +69,24 @@
 	}
 
 	Document *pMessage = new Document(docInfo);
-	if ((FilterUtils::feedFilter(*pMessage, pFilter) == false) ||
-		(pFilter->skip_to_document(parameters) == false))
+
+	location.replace(0, 7, "file");
+	string::size_type paramPos = location.find_last_of("?");
+	if (paramPos != string::npos)
 	{
+		location.resize(paramPos);
+	}
+
+	pMessage->setLocation(location);
+	if (FilterUtils::feedFilter(*pMessage, pFilter) == false)
+	{
 		delete pFilter;
 		return NULL;
 	}
 
 	// The first document should be the message we are interested in
-	if (pFilter->has_documents() == true)
+	if ((pFilter->skip_to_document(parameters) == true) &&
+		(pFilter->has_documents() == true))
 	{
 		FilterUtils::populateDocument(*pMessage, pFilter);
 	}

Modified: trunk/Index/FilterWrapper.cpp
===================================================================
--- trunk/Index/FilterWrapper.cpp	2007-02-24 07:07:01 UTC (rev 743)
+++ trunk/Index/FilterWrapper.cpp	2007-02-24 08:08:39 UTC (rev 744)
@@ -41,18 +41,21 @@
 bool FilterWrapper::indexDocument(IndexInterface &index, const Document &doc,
 	const set<string> &labels, unsigned int &docId)
 {
-	return filterDocument(index, doc, 0, labels, docId, false);
+	string originalType(doc.getType());
+
+	return filterDocument(index, doc, originalType, labels, docId, false);
 }
 
 bool FilterWrapper::updateDocument(unsigned int docId, IndexInterface &index, const Document &doc)
 {
 	set<string> labels;
+	string originalType(doc.getType());
 
-	return filterDocument(index, doc, 0, labels, docId, true);
+	return filterDocument(index, doc, originalType, labels, docId, true);
 }
 
 bool FilterWrapper::filterDocument(IndexInterface &index, const Document &doc,
-	unsigned int count, const set<string> &labels,
+	const string &originalType, const set<string> &labels,
 	unsigned int &docId, bool doUpdate)
 {
 	Filter *pFilter = FilterFactory::getFilter(doc.getType());
@@ -88,6 +91,8 @@
 
 	while (pFilter->has_documents() == true)
 	{
+		string actualType(originalType);
+
 		if (pFilter->next_document() == false)
 		{
 			break;
@@ -103,17 +108,21 @@
 			continue;
 		}
 
-		// Pass it down to another filter ?
-		if (filteredDoc.getType() != "text/plain")
+		// Is this a nested document ?
+		if (filteredDoc.getLocation().length() > doc.getLocation().length())
 		{
-			success = filterDocument(index, filteredDoc, count, labels, docId, doUpdate);
-			delete pFilter;
+			actualType = filteredDoc.getType();
+#ifdef DEBUG
+			cout << "FilterWrapper::filterDocument: nested document of type " << actualType << endl;
+#endif
+		}
 
-			return success;
-		}
-		else
+		// Pass it down to another filter ?
+		if ((filteredDoc.getType().length() >= 10) &&
+			(filteredDoc.getType().substr(0, 10) == "text/plain"))
 		{
-			filteredDoc.setType(doc.getType());
+			// No, it's been reduced to plain text
+			filteredDoc.setType(actualType);
 
 			Tokenizer tokens(&filteredDoc);
 			if (doUpdate == false)
@@ -125,6 +134,13 @@
 				success = index.updateDocument(docId, tokens);
 			}
 		}
+		else
+		{
+			success = filterDocument(index, filteredDoc, originalType, labels, docId, doUpdate);
+			delete pFilter;
+
+			return success;
+		}
 	}
 
 	delete pFilter;

Modified: trunk/Index/FilterWrapper.h
===================================================================
--- trunk/Index/FilterWrapper.h	2007-02-24 07:07:01 UTC (rev 743)
+++ trunk/Index/FilterWrapper.h	2007-02-24 08:08:39 UTC (rev 744)
@@ -44,7 +44,7 @@
 		FilterWrapper();
 
 		static bool filterDocument(IndexInterface &index, const Document &doc,
-			unsigned int count, const std::set<std::string> &labels,
+			const std::string &originalType, const std::set<std::string> &labels,
 			unsigned int &docId, bool doUpdate);
 
 	private:

Modified: trunk/Tokenize/FilterUtils.cpp
===================================================================
--- trunk/Tokenize/FilterUtils.cpp	2007-02-24 07:07:01 UTC (rev 743)
+++ trunk/Tokenize/FilterUtils.cpp	2007-02-24 08:08:39 UTC (rev 744)
@@ -16,9 +16,12 @@
  *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
  */
 
+#include <stdlib.h>
+#include <unistd.h> 
 #include <iostream>
 #include <map>
 
+#include "StringManip.h"
 #include "Url.h"
 #include "FilterFactory.h"
 #include "FilterUtils.h"
@@ -58,16 +61,6 @@
 	{
 		fileName = location.substr(7);
 	}
-	else if ((urlObj.getProtocol() == "mailbox") &&
-		(location .length() > 10))
-	{
-		fileName = location.substr(10);
-		string::size_type pos = fileName.find("?");
-		if (pos != string::npos)
-		{
-			fileName.resize(pos);
-		}
-	}
 
 	// Prefer feeding the data
 	if (((dataLength > 0) && (pData != NULL)) &&
@@ -118,7 +111,35 @@
 			}
 		}
 	}
+	// ... to feeding data through a temporary file
+	if ((fedInput == false) &&
+		((dataLength > 0) && (pData != NULL)) &&
+		(pFilter->is_data_input_ok(Filter::DOCUMENT_FILE_NAME) == true))
+	{
+		char inTemplate[18] = "/tmp/filterXXXXXX";
 
+		int inFd = mkstemp(inTemplate);
+		if (inFd != -1)
+		{
+#ifdef DEBUG
+			cout << "FilterUtils::feedFilter: feeding temporary file " << inTemplate << endl;
+#endif
+
+			// Save the data
+			if (write(inFd, (const void*)pData, dataLength) != -1)
+			{
+				fedInput = pFilter->set_document_file(inTemplate, true);
+				if (fedInput == false)
+				{
+					// We might as well delete the file now
+					unlink(inTemplate);
+				}
+			}
+
+			close(inFd);
+		}
+	}
+
 	if (fedInput == false)
 	{
 		cerr << "Couldn't feed filter for " << doc.getLocation() << endl;
@@ -160,7 +181,7 @@
 		}
 		else if (metaIter->first == "mimetype")
 		{
-			doc.setType(metaIter->second);
+			doc.setType(StringManip::toLowerCase(metaIter->second));
 		}
 		else if (metaIter->first == "size")
 		{
@@ -173,6 +194,13 @@
 		else if (metaIter->first == "uri")
 		{
 			uri = metaIter->second;
+
+			if ((uri.length() >= 18) &&
+				(uri.substr(0, 18) == "file:///tmp/filter"))
+			{
+				// We fed the filter a temporary file
+				uri.clear();
+			}
 		}
 	}
 



From fabricecolin at mail.berlios.de  Sat Feb 24 09:55:12 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 24 Feb 2007 09:55:12 +0100
Subject: [Pinot-svn] r745 - trunk/UI/GTK2/src
Message-ID: <200702240855.l1O8tCI6024888@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-24 09:55:12 +0100 (Sat, 24 Feb 2007)
New Revision: 745

Modified:
   trunk/UI/GTK2/src/mainWindow.cc
Log:
Query results were not labeled because getIndexId() was called on the location
instead of the name of internal indices.


Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2007-02-24 08:08:39 UTC (rev 744)
+++ trunk/UI/GTK2/src/mainWindow.cc	2007-02-24 08:55:12 UTC (rev 745)
@@ -1014,14 +1014,14 @@
 					// This document is not in either index
 					m_state.queue_index(docInfo);
 				}
-				else if (indexId == m_settings.getIndexId(m_settings.m_docsIndexLocation))
+				else if (indexId == m_settings.getIndexId(_("My Web Pages")))
 				{
 					if (labelName.empty() == false)
 					{
 						docsIds.insert(docId);
 					}
 				}
-				else if (indexId == m_settings.getIndexId(m_settings.m_daemonIndexLocation))
+				else if (indexId == m_settings.getIndexId(_("My Documents")))
 				{
 					if (labelName.empty() == false)
 					{
@@ -1030,7 +1030,9 @@
 				}
 			}
 
-			if (labelName.empty() == false)
+			if ((labelName.empty() == false) &&
+				((docsIds.empty() == false) ||
+				(daemonIds.empty() == false)))
 			{
 				// Apply the new label to existing documents
 				start_thread(new LabelUpdateThread(labelName, docsIds, daemonIds));



From fabricecolin at mail.berlios.de  Mon Feb 26 14:09:12 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Mon, 26 Feb 2007 14:09:12 +0100
Subject: [Pinot-svn] r746 - trunk
Message-ID: <200702261309.l1QD9Cre015031@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-26 14:09:11 +0100 (Mon, 26 Feb 2007)
New Revision: 746

Modified:
   trunk/TODO
Log:
+8 items.


Modified: trunk/TODO
===================================================================
--- trunk/TODO	2007-02-24 08:55:12 UTC (rev 745)
+++ trunk/TODO	2007-02-26 13:09:11 UTC (rev 746)
@@ -17,11 +17,14 @@
 - Check whether pdftotext flattens text in PDF documents that have columns
 - HtmlFilter should skip htdig_noindex blocks (http://www.htdig.org/attrs.html#noindex_start)
 - HtmlFilter to look for META tags Author, Creator, Publisher and CreationDate
+- XmLFilter is slow
 - Filters should have a version number so that new versions force reindexing documents of the
  given type
 
 Monitor
 - Implement support for Solaris FEM
+- Moves to unmonitored locations queue MOVED_FROM events but we never receive MOVED_TO's;
+ time out MOVED_FROM's after a while and generate DELETE events
 
 Collect
 - Comply with robot stuff defined at http://www.robotstxt.org/
@@ -63,7 +66,9 @@
 - Make sure prefixed terms are (space-)escaped
 - With Xapian 1.0, all indexes can be browsed with the new global posting list, ie
   Xapian::Database::postlist_begin("")
-- Use Xapian 1.0 TextSplitter class
+- Use Xapian new TextSplitter class
+- Index Nautilus metadata (http://linuxboxadmin.com/articles/nautilus.php)
+- Automatically categorize documents based on MIME type into picture, video, etc...
 
 Mail
 - Find out what kind of locking scheme Mozilla uses (POSIX lock ?) and use that
@@ -87,6 +92,7 @@
 - Make sure labels are alpha-numeric characters exclusively
 - DBus SetDocument[s]Labels should create labels if necessary
 - Reintroduce Index method in D-Bus interface
+- There's currently no way to get a document's ID without running a search
 - Allow notifications when configuration should be reloaded
 - Implement Wasabi draft(s)
 
@@ -104,4 +110,8 @@
 - Set results' indexed status after IndexingThread returns
 - Show date ranges in queries summary
 - Add Group By None to show all results at the same level
+- Opening when the daemon is busy indexing is awfully slow : is it because we are trying
+ to get hold of a revision of the index ?
+- GTK has a file chooser button, does glade-- have support for it ?
+- Query expansion should be interactive
 



From fabricecolin at mail.berlios.de  Mon Feb 26 14:14:10 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Mon, 26 Feb 2007 14:14:10 +0100
Subject: [Pinot-svn] r747 - trunk/po
Message-ID: <200702261314.l1QDEALq015472@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-26 14:14:09 +0100 (Mon, 26 Feb 2007)
New Revision: 747

Modified:
   trunk/po/es.po
Log:
Updates by Gar Bage.


Modified: trunk/po/es.po
===================================================================
--- trunk/po/es.po	2007-02-26 13:09:11 UTC (rev 746)
+++ trunk/po/es.po	2007-02-26 13:14:09 UTC (rev 747)
@@ -9,13 +9,13 @@
 "Project-Id-Version: pinot 0.70\n"
 "Report-Msgid-Bugs-To: \n"
 "POT-Creation-Date: 2006-12-03 15:05+0000\n"
-"PO-Revision-Date: 2007-02-17 17:34+0800\n"
-"Last-Translator: Fabrice Colin <fabricecolin at users.berlios.de>\n"
+"PO-Revision-Date: 2007-02-21 00:02+0000\n"
+"Last-Translator: Gar Bage <garbage at openfutura.com>\n"
 "Language-Team: es <fabricecolin at users.berlios.de>\n"
 "MIME-Version: 1.0\n"
 "Content-Type: text/plain; charset=utf-8\n"
 "Content-Transfer-Encoding: 8bit\n"
-"X-Rosetta-Export-Date: 2006-12-03 15:18+0000\n"
+"X-Rosetta-Export-Date: 2007-02-25 07:48+0000\n"
 
 #: UI/GTK2/src/EnginesTree.cpp:70
 msgid "Search Engines"
@@ -27,20 +27,20 @@
 
 #: UI/GTK2/src/EnginesTree.cpp:339 UI/GTK2/src/mainWindow.cc:325
 #: UI/GTK2/src/mainWindow.cc:328 UI/GTK2/src/mainWindow.cc:541
-#: UI/GTK2/src/mainWindow.cc:1186 UI/GTK2/src/mainWindow.cc:1229
-#: UI/GTK2/src/mainWindow.cc:1251 UI/GTK2/src/mainWindow.cc:1282
-#: UI/GTK2/src/mainWindow.cc:1855 UI/GTK2/src/PinotSettings.cpp:241
-#: UI/GTK2/src/PinotSettings.cpp:1281 UI/GTK2/src/PinotSettings.cpp:1337
-#: UI/GTK2/src/statisticsDialog.cc:88 UI/GTK2/src/WorkerThreads.cpp:820
-#: UI/GTK2/src/WorkerThreads.cpp:879
+#: UI/GTK2/src/mainWindow.cc:1017 UI/GTK2/src/mainWindow.cc:1188
+#: UI/GTK2/src/mainWindow.cc:1231 UI/GTK2/src/mainWindow.cc:1253
+#: UI/GTK2/src/mainWindow.cc:1284 UI/GTK2/src/mainWindow.cc:1857
+#: UI/GTK2/src/PinotSettings.cpp:241 UI/GTK2/src/PinotSettings.cpp:1278
+#: UI/GTK2/src/PinotSettings.cpp:1334 UI/GTK2/src/statisticsDialog.cc:74
+#: UI/GTK2/src/WorkerThreads.cpp:820 UI/GTK2/src/WorkerThreads.cpp:879
 msgid "My Web Pages"
 msgstr "Mis Paginas Web"
 
 #: UI/GTK2/src/EnginesTree.cpp:340 UI/GTK2/src/mainWindow.cc:319
-#: UI/GTK2/src/mainWindow.cc:322 UI/GTK2/src/PinotSettings.cpp:242
-#: UI/GTK2/src/PinotSettings.cpp:1282 UI/GTK2/src/PinotSettings.cpp:1338
-#: UI/GTK2/src/statisticsDialog.cc:74 UI/GTK2/src/WorkerThreads.cpp:825
-#: UI/GTK2/src/WorkerThreads.cpp:889
+#: UI/GTK2/src/mainWindow.cc:322 UI/GTK2/src/mainWindow.cc:1024
+#: UI/GTK2/src/PinotSettings.cpp:242 UI/GTK2/src/PinotSettings.cpp:1279
+#: UI/GTK2/src/PinotSettings.cpp:1335 UI/GTK2/src/statisticsDialog.cc:88
+#: UI/GTK2/src/WorkerThreads.cpp:825 UI/GTK2/src/WorkerThreads.cpp:889
 msgid "My Documents"
 msgstr "Mis documentos"
 
@@ -51,7 +51,7 @@
 
 #: UI/GTK2/src/indexDialog.cc:130
 msgid "Served by"
-msgstr ""
+msgstr "Servido por"
 
 #: UI/GTK2/src/indexDialog.cc:134
 #, fuzzy
@@ -145,11 +145,11 @@
 
 #: UI/GTK2/src/launcherDialog_glade.cc:67
 msgid "Use this command for other documents of the same type."
-msgstr ""
+msgstr "Usar el mismo comando para otros documentos del mismo tipo"
 
 #: UI/GTK2/src/launcherDialog_glade.cc:99
 msgid "Helper application"
-msgstr ""
+msgstr "Aplicaci?n de ayuda"
 
 #: UI/GTK2/src/mainWindow.cc:141
 msgid "Query Name"
@@ -211,7 +211,7 @@
 msgid "Query"
 msgstr "B?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:924 UI/GTK2/src/mainWindow.cc:2923
+#: UI/GTK2/src/mainWindow.cc:924 UI/GTK2/src/mainWindow.cc:2925
 msgid "on"
 msgstr "en"
 
@@ -219,142 +219,142 @@
 msgid "ended"
 msgstr "finalizado"
 
-#: UI/GTK2/src/mainWindow.cc:1051
+#: UI/GTK2/src/mainWindow.cc:1053
 msgid "More Like"
 msgstr "M?s como"
 
-#: UI/GTK2/src/mainWindow.cc:1112
+#: UI/GTK2/src/mainWindow.cc:1114
 msgid "Updated label(s)"
 msgstr "Etiqueta(s) actualizada(s)"
 
-#: UI/GTK2/src/mainWindow.cc:1196
+#: UI/GTK2/src/mainWindow.cc:1198
 msgid "Updated document"
 msgstr "Documento actualizado"
 
-#: UI/GTK2/src/mainWindow.cc:1209
+#: UI/GTK2/src/mainWindow.cc:1211
 msgid "Indexed"
 msgstr "Indizado"
 
-#: UI/GTK2/src/mainWindow.cc:1252
+#: UI/GTK2/src/mainWindow.cc:1254
 msgid "Unindexed document(s)"
 msgstr "Documento(s) no indizado(s)"
 
-#: UI/GTK2/src/mainWindow.cc:1293
+#: UI/GTK2/src/mainWindow.cc:1295
 msgid "Updated document properties"
 msgstr "Propiedades del documento actualizadas"
 
-#: UI/GTK2/src/mainWindow.cc:1346
+#: UI/GTK2/src/mainWindow.cc:1348
 msgid "Couldn't rename index, name"
 msgstr "No se pudo renombrar ?ndice, nombre"
 
-#: UI/GTK2/src/mainWindow.cc:1350 UI/GTK2/src/mainWindow.cc:2242
-#: UI/GTK2/src/mainWindow.cc:2753
+#: UI/GTK2/src/mainWindow.cc:1352 UI/GTK2/src/mainWindow.cc:2244
+#: UI/GTK2/src/mainWindow.cc:2755
 msgid "is already in use"
 msgstr "ya est? en uso"
 
-#: UI/GTK2/src/mainWindow.cc:1363
+#: UI/GTK2/src/mainWindow.cc:1365
 msgid "Couldn't rename index"
 msgstr "No se pudo renombrar el ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:1376
+#: UI/GTK2/src/mainWindow.cc:1378
 msgid "Edited index"
 msgstr "?ndice editado"
 
-#: UI/GTK2/src/mainWindow.cc:1752 UI/GTK2/src/mainWindow.cc:2412
+#: UI/GTK2/src/mainWindow.cc:1754 UI/GTK2/src/mainWindow.cc:2414
 msgid "Live query"
 msgstr "B?squeda activa"
 
-#: UI/GTK2/src/mainWindow.cc:1778
+#: UI/GTK2/src/mainWindow.cc:1780
 msgid "Couldn't find query"
 msgstr "No se pudo a?adir la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:1971 UI/GTK2/src/WorkerThreads.cpp:651
-#: UI/GTK2/src/WorkerThreads.cpp:1608
+#: UI/GTK2/src/mainWindow.cc:1973 UI/GTK2/src/WorkerThreads.cpp:651
+#: UI/GTK2/src/WorkerThreads.cpp:1618
 msgid "Index"
 msgstr "?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:1975 UI/GTK2/src/WorkerThreads.cpp:655
-#: UI/GTK2/src/WorkerThreads.cpp:1612
+#: UI/GTK2/src/mainWindow.cc:1977 UI/GTK2/src/WorkerThreads.cpp:655
+#: UI/GTK2/src/WorkerThreads.cpp:1622
 msgid "doesn't exist"
 msgstr "no existe"
 
-#: UI/GTK2/src/mainWindow.cc:2129
+#: UI/GTK2/src/mainWindow.cc:2131
 msgid "Remove this document from the index ?"
 msgstr "?Borrar este documento del ?ndice?"
 
-#: UI/GTK2/src/mainWindow.cc:2148
+#: UI/GTK2/src/mainWindow.cc:2150
 msgid "Remove these documents from the index ?"
 msgstr "?Borrar este documento del ?ndice?"
 
-#: UI/GTK2/src/mainWindow.cc:2192
+#: UI/GTK2/src/mainWindow.cc:2194
 msgid "A metasearch tool for the Free Desktop"
 msgstr "Una herramienta metabuscador para el escritorio libre"
 
-#: UI/GTK2/src/mainWindow.cc:2193
+#: UI/GTK2/src/mainWindow.cc:2195
 msgid "Search the Web and your documents !"
 msgstr "Busca en el web y en sus documentos"
 
-#: UI/GTK2/src/mainWindow.cc:2194
+#: UI/GTK2/src/mainWindow.cc:2196
 msgid "(C) 2005 Fabrice Colin"
 msgstr "(C) 2005 Fabrice Colin"
 
-#: UI/GTK2/src/mainWindow.cc:2238
+#: UI/GTK2/src/mainWindow.cc:2240
 msgid "Index name"
 msgstr "Nombre del ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2253
+#: UI/GTK2/src/mainWindow.cc:2255
 msgid "Couldn't add index"
 msgstr "No se pudo a?adir el ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2267
+#: UI/GTK2/src/mainWindow.cc:2269
 msgid "Added new index"
 msgstr "A?adido un nuevo ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2302
+#: UI/GTK2/src/mainWindow.cc:2304
 msgid "Couldn't remove index"
 msgstr "No se pudo borrar el ?ndice"
 
-#: UI/GTK2/src/mainWindow.cc:2567
+#: UI/GTK2/src/mainWindow.cc:2569
 msgid "At least one task hasn't completed yet. Quit now ?"
 msgstr "Al menos una tarea no ha finalizado. ?Parar ahora?"
 
-#: UI/GTK2/src/mainWindow.cc:2749
+#: UI/GTK2/src/mainWindow.cc:2751
 msgid "Query name"
 msgstr "Nombre la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:2776
+#: UI/GTK2/src/mainWindow.cc:2778
 msgid "Couldn't update query"
 msgstr "No se pudo actualizar la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:2784
+#: UI/GTK2/src/mainWindow.cc:2786
 msgid "Edited query"
 msgstr "B?squeda editada"
 
-#: UI/GTK2/src/mainWindow.cc:2791
+#: UI/GTK2/src/mainWindow.cc:2793
 msgid "Couldn't add query"
 msgstr "No se pudo a?adir la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:2799
+#: UI/GTK2/src/mainWindow.cc:2801
 msgid "Added new query"
 msgstr "A?adida una nueva b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:2812
+#: UI/GTK2/src/mainWindow.cc:2814
 msgid "Query is not set"
 msgstr "B?squeda no definida"
 
-#: UI/GTK2/src/mainWindow.cc:2823
+#: UI/GTK2/src/mainWindow.cc:2825
 msgid "No search engine selected"
 msgstr "Motor de b?squeda no seleccionado"
 
-#: UI/GTK2/src/mainWindow.cc:2910
+#: UI/GTK2/src/mainWindow.cc:2912
 msgid "Please set the Google API key first"
 msgstr "Por favor, primero configure el API de Google"
 
-#: UI/GTK2/src/mainWindow.cc:2919
+#: UI/GTK2/src/mainWindow.cc:2921
 msgid "Running query"
 msgstr "Ejecutando la b?squeda"
 
-#: UI/GTK2/src/mainWindow.cc:3103
+#: UI/GTK2/src/mainWindow.cc:3105
 msgid "No default application defined for type"
 msgstr "No hay aplicaci?n predefinida para el tipo"
 
@@ -373,7 +373,7 @@
 #: UI/GTK2/src/mainWindow_glade.cc:163 UI/GTK2/src/statisticsDialog.cc:46
 #: UI/GTK2/src/statisticsDialog_glade.cc:87
 msgid "Status"
-msgstr ""
+msgstr "Estatus"
 
 #: UI/GTK2/src/mainWindow_glade.cc:184
 msgid "Search Engine"
@@ -529,7 +529,7 @@
 msgid "Personal"
 msgstr "Personal"
 
-#: UI/GTK2/src/PinotSettings.cpp:1085
+#: UI/GTK2/src/PinotSettings.cpp:1082
 msgid "Unclassified"
 msgstr "No clasificado"
 
@@ -644,11 +644,11 @@
 
 #: UI/GTK2/src/propertiesDialog_glade.cc:70
 msgid "Size:"
-msgstr ""
+msgstr "Tama?o:"
 
 #: UI/GTK2/src/propertiesDialog_glade.cc:73
 msgid "Terms:"
-msgstr ""
+msgstr "T?rminos:"
 
 #: UI/GTK2/src/queryDialog.cc:130
 msgid "Host name"
@@ -676,11 +676,11 @@
 
 #: UI/GTK2/src/queryDialog.cc:271
 msgid "Start date"
-msgstr ""
+msgstr "Fecha inicial"
 
 #: UI/GTK2/src/queryDialog.cc:286
 msgid "End date"
-msgstr ""
+msgstr "Fecha final"
 
 #: UI/GTK2/src/queryDialog_glade.cc:72
 msgid "New filter:"
@@ -700,11 +700,11 @@
 
 #: UI/GTK2/src/queryDialog_glade.cc:89
 msgid "Start date:"
-msgstr ""
+msgstr "Fecha de comienzo:"
 
 #: UI/GTK2/src/queryDialog_glade.cc:90
 msgid "End date:"
-msgstr ""
+msgstr "Fecha de fin:"
 
 #: UI/GTK2/src/queryDialog_glade.cc:201
 msgid "Query parameters"
@@ -759,11 +759,11 @@
 
 #: UI/GTK2/src/statisticsDialog.cc:143
 msgid "files"
-msgstr ""
+msgstr "archivos"
 
 #: UI/GTK2/src/statisticsDialog.cc:166
 msgid "Errors"
-msgstr ""
+msgstr "Errores"
 
 #: UI/GTK2/src/WorkerThreads.cpp:322
 msgid "Can't index mail here"
@@ -779,8 +779,8 @@
 
 #: UI/GTK2/src/WorkerThreads.cpp:664 UI/GTK2/src/WorkerThreads.cpp:962
 #: UI/GTK2/src/WorkerThreads.cpp:1047 UI/GTK2/src/WorkerThreads.cpp:1056
-#: UI/GTK2/src/WorkerThreads.cpp:1228 UI/GTK2/src/WorkerThreads.cpp:1488
-#: UI/GTK2/src/WorkerThreads.cpp:1621
+#: UI/GTK2/src/WorkerThreads.cpp:1228 UI/GTK2/src/WorkerThreads.cpp:1498
+#: UI/GTK2/src/WorkerThreads.cpp:1631
 msgid "Index error on"
 msgstr "Error en el ?ndice"
 
@@ -804,26 +804,26 @@
 msgid "Couldn't retrieve"
 msgstr "No se pudo descargar"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1258 UI/GTK2/src/WorkerThreads.cpp:1334
+#: UI/GTK2/src/WorkerThreads.cpp:1258 UI/GTK2/src/WorkerThreads.cpp:1340
 msgid "Cannot index document type"
 msgstr "No se pudo indizar el tipo de documento"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1262 UI/GTK2/src/WorkerThreads.cpp:1338
+#: UI/GTK2/src/WorkerThreads.cpp:1262 UI/GTK2/src/WorkerThreads.cpp:1344
 msgid "at"
 msgstr "a"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1369
+#: UI/GTK2/src/WorkerThreads.cpp:1376
 msgid "Robots META tag forbids indexing"
 msgstr "La etiqueta META Robots proh?be la indizaci?n"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1420
+#: UI/GTK2/src/WorkerThreads.cpp:1430
 msgid "Couldn't index"
 msgstr "No se pudo indizar"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1499
+#: UI/GTK2/src/WorkerThreads.cpp:1509
 msgid "Couldn't unindex document(s)"
 msgstr "No se pudo des-indizar lo(s) documento(s)"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1633
+#: UI/GTK2/src/WorkerThreads.cpp:1643
 msgid "Couldn't update document"
 msgstr "No se pudo actualizar el documento"



From fabricecolin at mail.berlios.de  Mon Feb 26 14:21:37 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Mon, 26 Feb 2007 14:21:37 +0100
Subject: [Pinot-svn] r748 - trunk
Message-ID: <200702261321.l1QDLbKj015881@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-26 14:21:37 +0100 (Mon, 26 Feb 2007)
New Revision: 748

Modified:
   trunk/AUTHORS
   trunk/NEWS
   trunk/README
   trunk/configure.in
   trunk/pinot.desktop
   trunk/pinot.spec.in
Log:
Preparing for 0.70 release.


Modified: trunk/AUTHORS
===================================================================
--- trunk/AUTHORS	2007-02-26 13:14:09 UTC (rev 747)
+++ trunk/AUTHORS	2007-02-26 13:21:37 UTC (rev 748)
@@ -28,6 +28,7 @@
 	Dutch - Tikkel <???>
 	French - Nicolas Velin <nsv at fr dot st>
 	Spanish - Jes?s Tramullas <jesus at tramullas dot com>
+		- Garbage <garbage at openfutura.com>
 	Swedish - Daniel Nylander <po at danielnylander dot se>
 	Portuguese (Brazil) - Leonardo Melo <leonardovazmelo at gmail dot com>
 	Russian - Sergey Vostrikov <memphis at jabber dot snc dot ru>

Modified: trunk/NEWS
===================================================================
--- trunk/NEWS	2007-02-26 13:14:09 UTC (rev 747)
+++ trunk/NEWS	2007-02-26 13:21:37 UTC (rev 748)
@@ -5,10 +5,14 @@
  - support for remote indexes served by xapian-progsrv+ssh
  - index to use by pinot-index specified with --db
 Search :
+ - date range filtering applies to index searches
  - limit the number of results returned by pinot-search with --max
+Daemon :
+ - log the daemon's PID
+ - sped up unindexing of documents after a directory is deleted
 UI :
  - stored queries can do date range filtering. If dates don't make sense
-  (eg From >= To), they are ignored.
+  (eg From >= To), they are ignored
  - under the Session menu, Status shows various bits of information about
   the indexes and the daemon's crawler
  - prompt for command to use to open documents of a type for which no
@@ -16,6 +20,8 @@
  - revamped configuration dialog for external indexes
  - Index > Properties now shows a document's size and number of unique terms
  - most operations that involve peeking at the index are done in the background
+ - Brazilian Portuguese translation by Leonardo Melo
+ - Russian translation by Sergey Vostrikov
 
 2006/12/21 version_0_6_5
 Build :

Modified: trunk/README
===================================================================
--- trunk/README	2007-02-26 13:14:09 UTC (rev 747)
+++ trunk/README	2007-02-26 13:21:37 UTC (rev 748)
@@ -1,5 +1,5 @@
 Pinot
-Copyright 2005 Fabrice Colin <fabricecolin at users dot berlios dot de>
+Copyright 2005-2007 Fabrice Colin <fabricecolin at users dot berlios dot de>
 http://pinot.berlios.de/
 
 

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2007-02-26 13:14:09 UTC (rev 747)
+++ trunk/configure.in	2007-02-26 13:21:37 UTC (rev 748)
@@ -2,7 +2,7 @@
 # using glademm V2.6.0
 
 AC_PREREQ(2.50)
-AC_INIT(pinot, 0.65,[fabricecolin at users.berlios.de])
+AC_INIT(pinot, 0.70,[fabricecolin at users.berlios.de])
 AM_INIT_AUTOMAKE
 AC_CONFIG_HEADERS(config.h)
 

Modified: trunk/pinot.desktop
===================================================================
--- trunk/pinot.desktop	2007-02-26 13:14:09 UTC (rev 747)
+++ trunk/pinot.desktop	2007-02-26 13:21:37 UTC (rev 748)
@@ -2,9 +2,14 @@
 Name=Pinot Metasearch Tool
 Name[es]=Metabuscador Pinot
 Name[fr]=Pinot Outil De Recherche
+Name[nl]=Pinot Metazoek Tool
+Name[pt_BR]=Mecanismo de metabusca Pinot
+Name[ru]=?????????? ?????????? Pinot
+Name[sv]=Pinot Metas?kningsverktyg
 Comment=Search the Web and your documents
 Comment[es]=Busca en el web y en sus documentos
 Comment[fr]=Cherche le Web et vos documents
+Comment[sv]=S?k p? webben och i dina dokument!
 Exec=pinot
 StartupNotify=true
 Icon=pinot.png

Modified: trunk/pinot.spec.in
===================================================================
--- trunk/pinot.spec.in	2007-02-26 13:14:09 UTC (rev 747)
+++ trunk/pinot.spec.in	2007-02-26 13:21:37 UTC (rev 748)
@@ -26,7 +26,7 @@
 BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
 Requires: xapian-core-libs >= 0.9.7, libtextcat >= 2.2, sqlite >= 3.1.2, curl >= 7.13, gmime >= 2.1
 Requires: gtkmm24 >= 2.6, libxml++ >= 2.12, %{dbus_pkg} >= 0.60, shared-mime-info
-Requires: unzip, antiword, unrtf, %{pftotext_pkg}, openssh-askpass
+Requires: unzip, antiword, unrtf, %{pftotext_pkg}
 BuildRequires: xapian-core-devel >= 0.9.7, libtextcat-devel >= 2.2, sqlite-devel >= 3.1.2, curl-devel >= 7.13, gmime-devel >= 2.1, boost-devel >= 1.32
 BuildRequires: gtkmm24-devel >= 2.6, libxml++-devel >= 2.12, %{dbus_dev_pkg} >= 0.60, gettext-devel, desktop-file-utils
 BuildRequires: taglib-devel >= 1.4
@@ -36,9 +36,10 @@
 %endif
 
 %description
-Pinot is a metasearch tool for the Free Desktop. It enables one to query
-sources, display as well as analyze and locally index the returned results.
-It may also be used as a lightweight personal space search tool.
+Pinot is a D-Bus service that crawls, indexes your documents and monitors them
+for changes, as well as a GTK-based user interface that enables to query
+the index built by the service and your favourite Web engines, and display and
+analyze the results.
 
 %package audio-docs 
 Summary: Tokenizers for Pinot that handle various audio document formats



From fabricecolin at mail.berlios.de  Tue Feb 27 11:57:03 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 27 Feb 2007 11:57:03 +0100
Subject: [Pinot-svn] r749 - in trunk: Search Utils
Message-ID: <200702271057.l1RAv3tN001409@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-27 11:57:02 +0100 (Tue, 27 Feb 2007)
New Revision: 749

Modified:
   trunk/Search/XapianEngine.cpp
   trunk/Utils/TimeConverter.cpp
Log:
Fixed stupid time conversion error that would sometimes prevent date ranges from
being applied.


Modified: trunk/Search/XapianEngine.cpp
===================================================================
--- trunk/Search/XapianEngine.cpp	2007-02-26 13:21:37 UTC (rev 748)
+++ trunk/Search/XapianEngine.cpp	2007-02-27 10:57:02 UTC (rev 749)
@@ -234,8 +234,8 @@
 		maxDay = timeTm->tm_mday;
 	}
 
-	string yyyymmddMin(TimeConverter::toYYYYMMDDString(minDay, minMonth, minYear));
-	string yyyymmddMax(TimeConverter::toYYYYMMDDString(maxDay, maxMonth, maxYear));
+	string yyyymmddMin(TimeConverter::toYYYYMMDDString(minYear, minMonth, minDay));
+	string yyyymmddMax(TimeConverter::toYYYYMMDDString(maxYear, maxMonth, maxDay));
 	time_t startTime = TimeConverter::fromYYYYMMDDString(yyyymmddMin);
 	time_t endTime = TimeConverter::fromYYYYMMDDString(yyyymmddMax);
  

Modified: trunk/Utils/TimeConverter.cpp
===================================================================
--- trunk/Utils/TimeConverter.cpp	2007-02-26 13:21:37 UTC (rev 748)
+++ trunk/Utils/TimeConverter.cpp	2007-02-27 10:57:02 UTC (rev 749)
@@ -284,7 +284,14 @@
 	struct tm timeTm;
 	time_t gmTime = 0;
 
+	// Initialize the structure
+	timeTm.tm_sec = timeTm.tm_min = timeTm.tm_hour = timeTm.tm_mday = 0;
+	timeTm.tm_mon = timeTm.tm_year = timeTm.tm_wday = timeTm.tm_yday = timeTm.tm_isdst = 0;
+
 	strptime(yyyymmdd.c_str(), "%Y%m%d", &timeTm);
+#ifdef DEBUG
+	cout << "TimeConverter::fromYYYYMMDDString: " << timeTm.tm_year << " " << timeTm.tm_mon << " " << timeTm.tm_mday << endl;
+#endif
 	if (inGMTime == true)
 	{
 		gmTime = timegm(&timeTm);



From fabricecolin at mail.berlios.de  Wed Feb 28 14:39:03 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Wed, 28 Feb 2007 14:39:03 +0100
Subject: [Pinot-svn] r750 - trunk/Utils
Message-ID: <200702281339.l1SDd3gC026338@sheep.berlios.de>

Author: fabricecolin
Date: 2007-02-28 14:39:02 +0100 (Wed, 28 Feb 2007)
New Revision: 750

Modified:
   trunk/Utils/MIMEScanner.cpp
Log:
Workaround broken desktop files that set envvars in the Exec field, for instance
"PATH=... cmd_line", even though the spec says the equal sign is not allowed.
Thanks to Thierry Thomas for reporting this.


Modified: trunk/Utils/MIMEScanner.cpp
===================================================================
--- trunk/Utils/MIMEScanner.cpp	2007-02-27 10:57:02 UTC (rev 749)
+++ trunk/Utils/MIMEScanner.cpp	2007-02-28 13:39:02 UTC (rev 750)
@@ -101,7 +101,22 @@
 			m_name = getKeyValue(pDesktopFile, "Name");
 			// This may contain parameters described here :
 			// http://standards.freedesktop.org/desktop-entry-spec/latest/ar01s06.html
-			m_exec = getKeyValue(pDesktopFile, "Exec");
+			string execKey(getKeyValue(pDesktopFile, "Exec"));
+			// The name or path of the executable program may not contain the equal sign
+			string::size_type pos = execKey.find("=");
+			if (pos == string::npos)
+			{
+				m_exec = execKey;
+			}
+			else
+			{
+				pos = execKey.find(" ", pos);
+				if ((pos != string::npos) &&
+					(pos + 1 < execKey.length()))
+				{
+					m_exec = execKey.substr(pos + 1);
+				}
+			}
 			m_icon = getKeyValue(pDesktopFile, "Icon");
 			m_device = getKeyValue(pDesktopFile, "Device");
 



