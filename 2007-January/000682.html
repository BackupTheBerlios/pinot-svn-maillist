<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Pinot-svn] r688 - in trunk: UI/GTK2 UI/GTK2/src po
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/pinot-svn/2007-January/index.html" >
   <LINK REL="made" HREF="mailto:pinot-svn%40lists.berlios.de?Subject=Re%3A%20%5BPinot-svn%5D%20r688%20-%20in%20trunk%3A%20UI/GTK2%20UI/GTK2/src%20po&In-Reply-To=%3C200701092225.l09MPIcY003676%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000681.html">
   <LINK REL="Next"  HREF="000683.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Pinot-svn] r688 - in trunk: UI/GTK2 UI/GTK2/src po</H1>
    <B>fabricecolin at BerliOS</B> 
    <A HREF="mailto:pinot-svn%40lists.berlios.de?Subject=Re%3A%20%5BPinot-svn%5D%20r688%20-%20in%20trunk%3A%20UI/GTK2%20UI/GTK2/src%20po&In-Reply-To=%3C200701092225.l09MPIcY003676%40sheep.berlios.de%3E"
       TITLE="[Pinot-svn] r688 - in trunk: UI/GTK2 UI/GTK2/src po">fabricecolin at mail.berlios.de
       </A><BR>
    <I>Tue Jan  9 23:25:18 CET 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000681.html">[Pinot-svn] r687 - trunk/po
</A></li>
        <LI>Next message: <A HREF="000683.html">[Pinot-svn] r689 - in trunk: UI/GTK2/src Utils
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#682">[ date ]</a>
              <a href="thread.html#682">[ thread ]</a>
              <a href="subject.html#682">[ subject ]</a>
              <a href="author.html#682">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: fabricecolin
Date: 2007-01-09 23:25:17 +0100 (Tue, 09 Jan 2007)
New Revision: 688

Modified:
   trunk/UI/GTK2/metase-gtk2.glade
   trunk/UI/GTK2/src/Makefile.am
   trunk/UI/GTK2/src/mainWindow.cc
   trunk/UI/GTK2/src/statisticsDialog.cc
   trunk/po/POTFILES.in
Log:
Still jet-lagged, I can't sleep, so I am checking in code to prompt the user for
a command to open documents of unsupported types ;-)
And a minor fix in statisticsDialog.


Modified: trunk/UI/GTK2/metase-gtk2.glade
===================================================================
--- trunk/UI/GTK2/metase-gtk2.glade	2007-01-09 13:25:52 UTC (rev 687)
+++ trunk/UI/GTK2/metase-gtk2.glade	2007-01-09 22:25:17 UTC (rev 688)
@@ -3629,4 +3629,148 @@
   &lt;/child&gt;
 &lt;/widget&gt;
 
+&lt;widget class=&quot;GtkDialog&quot; id=&quot;launcherDialog&quot;&gt;
+  &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
+  &lt;property name=&quot;title&quot; translatable=&quot;yes&quot;&gt;Helper application&lt;/property&gt;
+  &lt;property name=&quot;type&quot;&gt;GTK_WINDOW_TOPLEVEL&lt;/property&gt;
+  &lt;property name=&quot;window_position&quot;&gt;GTK_WIN_POS_NONE&lt;/property&gt;
+  &lt;property name=&quot;modal&quot;&gt;False&lt;/property&gt;
+  &lt;property name=&quot;resizable&quot;&gt;True&lt;/property&gt;
+  &lt;property name=&quot;destroy_with_parent&quot;&gt;False&lt;/property&gt;
+  &lt;property name=&quot;decorated&quot;&gt;True&lt;/property&gt;
+  &lt;property name=&quot;skip_taskbar_hint&quot;&gt;False&lt;/property&gt;
+  &lt;property name=&quot;skip_pager_hint&quot;&gt;False&lt;/property&gt;
+  &lt;property name=&quot;type_hint&quot;&gt;GDK_WINDOW_TYPE_HINT_DIALOG&lt;/property&gt;
+  &lt;property name=&quot;gravity&quot;&gt;GDK_GRAVITY_NORTH_WEST&lt;/property&gt;
+  &lt;property name=&quot;focus_on_map&quot;&gt;True&lt;/property&gt;
+  &lt;property name=&quot;urgency_hint&quot;&gt;False&lt;/property&gt;
+  &lt;property name=&quot;has_separator&quot;&gt;True&lt;/property&gt;
+
+  &lt;child internal-child=&quot;vbox&quot;&gt;
+    &lt;widget class=&quot;GtkVBox&quot; id=&quot;dialog-vbox9&quot;&gt;
+      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
+      &lt;property name=&quot;homogeneous&quot;&gt;False&lt;/property&gt;
+      &lt;property name=&quot;spacing&quot;&gt;0&lt;/property&gt;
+
+      &lt;child internal-child=&quot;action_area&quot;&gt;
+	&lt;widget class=&quot;GtkHButtonBox&quot; id=&quot;dialog-action_area9&quot;&gt;
+	  &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
+	  &lt;property name=&quot;layout_style&quot;&gt;GTK_BUTTONBOX_END&lt;/property&gt;
+
+	  &lt;child&gt;
+	    &lt;widget class=&quot;GtkButton&quot; id=&quot;cancelbutton3&quot;&gt;
+	      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;can_default&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;can_focus&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;label&quot;&gt;gtk-cancel&lt;/property&gt;
+	      &lt;property name=&quot;use_stock&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;relief&quot;&gt;GTK_RELIEF_NORMAL&lt;/property&gt;
+	      &lt;property name=&quot;focus_on_click&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;response_id&quot;&gt;-6&lt;/property&gt;
+	    &lt;/widget&gt;
+	  &lt;/child&gt;
+
+	  &lt;child&gt;
+	    &lt;widget class=&quot;GtkButton&quot; id=&quot;okbutton1&quot;&gt;
+	      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;can_default&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;can_focus&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;label&quot;&gt;gtk-ok&lt;/property&gt;
+	      &lt;property name=&quot;use_stock&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;relief&quot;&gt;GTK_RELIEF_NORMAL&lt;/property&gt;
+	      &lt;property name=&quot;focus_on_click&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;response_id&quot;&gt;-5&lt;/property&gt;
+	    &lt;/widget&gt;
+	  &lt;/child&gt;
+	&lt;/widget&gt;
+	&lt;packing&gt;
+	  &lt;property name=&quot;padding&quot;&gt;0&lt;/property&gt;
+	  &lt;property name=&quot;expand&quot;&gt;False&lt;/property&gt;
+	  &lt;property name=&quot;fill&quot;&gt;True&lt;/property&gt;
+	  &lt;property name=&quot;pack_type&quot;&gt;GTK_PACK_END&lt;/property&gt;
+	&lt;/packing&gt;
+      &lt;/child&gt;
+
+      &lt;child&gt;
+	&lt;widget class=&quot;GtkVBox&quot; id=&quot;launcherVbox&quot;&gt;
+	  &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
+	  &lt;property name=&quot;homogeneous&quot;&gt;False&lt;/property&gt;
+	  &lt;property name=&quot;spacing&quot;&gt;0&lt;/property&gt;
+
+	  &lt;child&gt;
+	    &lt;widget class=&quot;GtkLabel&quot; id=&quot;noLauncherLabel&quot;&gt;
+	      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;There is no helper application defined for this document's type.
+Please enter the command to open this document.&lt;/property&gt;
+	      &lt;property name=&quot;use_underline&quot;&gt;False&lt;/property&gt;
+	      &lt;property name=&quot;use_markup&quot;&gt;False&lt;/property&gt;
+	      &lt;property name=&quot;justify&quot;&gt;GTK_JUSTIFY_LEFT&lt;/property&gt;
+	      &lt;property name=&quot;wrap&quot;&gt;False&lt;/property&gt;
+	      &lt;property name=&quot;selectable&quot;&gt;False&lt;/property&gt;
+	      &lt;property name=&quot;xalign&quot;&gt;0.5&lt;/property&gt;
+	      &lt;property name=&quot;yalign&quot;&gt;0.5&lt;/property&gt;
+	      &lt;property name=&quot;xpad&quot;&gt;0&lt;/property&gt;
+	      &lt;property name=&quot;ypad&quot;&gt;0&lt;/property&gt;
+	      &lt;property name=&quot;ellipsize&quot;&gt;PANGO_ELLIPSIZE_NONE&lt;/property&gt;
+	      &lt;property name=&quot;width_chars&quot;&gt;-1&lt;/property&gt;
+	      &lt;property name=&quot;single_line_mode&quot;&gt;False&lt;/property&gt;
+	      &lt;property name=&quot;angle&quot;&gt;0&lt;/property&gt;
+	    &lt;/widget&gt;
+	    &lt;packing&gt;
+	      &lt;property name=&quot;padding&quot;&gt;4&lt;/property&gt;
+	      &lt;property name=&quot;expand&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;fill&quot;&gt;True&lt;/property&gt;
+	    &lt;/packing&gt;
+	  &lt;/child&gt;
+
+	  &lt;child&gt;
+	    &lt;widget class=&quot;GtkEntry&quot; id=&quot;launcherEntry&quot;&gt;
+	      &lt;property agent=&quot;glademm&quot; name=&quot;cxx_visibility&quot;&gt;protected&lt;/property&gt;
+	      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;can_focus&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;editable&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;visibility&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;max_length&quot;&gt;0&lt;/property&gt;
+	      &lt;property name=&quot;text&quot; translatable=&quot;yes&quot;&gt;&lt;/property&gt;
+	      &lt;property name=&quot;has_frame&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;invisible_char&quot;&gt;&#8226;&lt;/property&gt;
+	      &lt;property name=&quot;activates_default&quot;&gt;False&lt;/property&gt;
+	    &lt;/widget&gt;
+	    &lt;packing&gt;
+	      &lt;property name=&quot;padding&quot;&gt;4&lt;/property&gt;
+	      &lt;property name=&quot;expand&quot;&gt;False&lt;/property&gt;
+	      &lt;property name=&quot;fill&quot;&gt;True&lt;/property&gt;
+	    &lt;/packing&gt;
+	  &lt;/child&gt;
+
+	  &lt;child&gt;
+	    &lt;widget class=&quot;GtkCheckButton&quot; id=&quot;rememberCheckbutton&quot;&gt;
+	      &lt;property agent=&quot;glademm&quot; name=&quot;cxx_visibility&quot;&gt;protected&lt;/property&gt;
+	      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;can_focus&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;Use this command for other documents of the same type.&lt;/property&gt;
+	      &lt;property name=&quot;use_underline&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;relief&quot;&gt;GTK_RELIEF_NORMAL&lt;/property&gt;
+	      &lt;property name=&quot;focus_on_click&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;active&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;inconsistent&quot;&gt;False&lt;/property&gt;
+	      &lt;property name=&quot;draw_indicator&quot;&gt;True&lt;/property&gt;
+	    &lt;/widget&gt;
+	    &lt;packing&gt;
+	      &lt;property name=&quot;padding&quot;&gt;4&lt;/property&gt;
+	      &lt;property name=&quot;expand&quot;&gt;False&lt;/property&gt;
+	      &lt;property name=&quot;fill&quot;&gt;True&lt;/property&gt;
+	    &lt;/packing&gt;
+	  &lt;/child&gt;
+	&lt;/widget&gt;
+	&lt;packing&gt;
+	  &lt;property name=&quot;padding&quot;&gt;0&lt;/property&gt;
+	  &lt;property name=&quot;expand&quot;&gt;True&lt;/property&gt;
+	  &lt;property name=&quot;fill&quot;&gt;True&lt;/property&gt;
+	&lt;/packing&gt;
+      &lt;/child&gt;
+    &lt;/widget&gt;
+  &lt;/child&gt;
+&lt;/widget&gt;
+
 &lt;/glade-interface&gt;

Modified: trunk/UI/GTK2/src/Makefile.am
===================================================================
--- trunk/UI/GTK2/src/Makefile.am	2007-01-09 13:25:52 UTC (rev 687)
+++ trunk/UI/GTK2/src/Makefile.am	2007-01-09 22:25:17 UTC (rev 688)
@@ -5,6 +5,8 @@
 	importDialog.hh \
 	indexDialog_glade.hh \
 	indexDialog.hh \
+	launcherDialog.hh \
+	launcherDialog_glade.hh \
 	mainWindow_glade.hh \
 	mainWindow.hh \
 	prefsDialog_glade.hh \
@@ -35,6 +37,8 @@
 	importDialog.cc \
 	indexDialog_glade.cc \
 	indexDialog.cc \
+	launcherDialog.cc \
+	launcherDialog_glade.cc \
 	mainWindow_glade.cc \
 	mainWindow.cc \
 	prefsDialog_glade.cc \

Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2007-01-09 13:25:52 UTC (rev 687)
+++ trunk/UI/GTK2/src/mainWindow.cc	2007-01-09 22:25:17 UTC (rev 688)
@@ -51,6 +51,7 @@
 #include &quot;mainWindow.hh&quot;
 #include &quot;importDialog.hh&quot;
 #include &quot;indexDialog.hh&quot;
+#include &quot;launcherDialog.hh&quot;
 #include &quot;propertiesDialog.hh&quot;
 #include &quot;prefsDialog.hh&quot;
 #include &quot;queryDialog.hh&quot;
@@ -3114,11 +3115,30 @@
 
 				if (foundAction == false)
 				{
-					ustring statusText = _(&quot;No default application defined for type&quot;);
-					statusText += &quot; &quot;;
-					statusText += type;
-					set_status(statusText);
-					continue;
+					launcherDialog launcher(url);
+					bool remember = true;
+
+					launcher.show();
+					if (launcher.run() == RESPONSE_OK)
+					{
+
+						foundAction = launcher.getInput(action, remember);
+					}
+
+					if (foundAction == false)
+					{
+						ustring statusText = _(&quot;No default application defined for type&quot;);
+						statusText += &quot; &quot;;
+						statusText += type;
+						set_status(statusText);
+						continue;
+					}
+					else if (remember == true)
+					{
+						// Add this to MIMESCanner's list
+						MIMEScanner::addDefaultAction(type, action);
+						// FIXME: save this in the settings ?
+					}
 				}
 			}
 		}

Modified: trunk/UI/GTK2/src/statisticsDialog.cc
===================================================================
--- trunk/UI/GTK2/src/statisticsDialog.cc	2007-01-09 13:25:52 UTC (rev 687)
+++ trunk/UI/GTK2/src/statisticsDialog.cc	2007-01-09 22:25:17 UTC (rev 688)
@@ -34,7 +34,8 @@
 using namespace Glib;
 using namespace Gtk;
 
-statisticsDialog::statisticsDialog()
+statisticsDialog::statisticsDialog() :
+	statisticsDialog_glade()
 {
 	// Associate the columns model to the engines tree
 	m_refStore = TreeStore::create(m_statsColumns);

Modified: trunk/po/POTFILES.in
===================================================================
--- trunk/po/POTFILES.in	2007-01-09 13:25:52 UTC (rev 687)
+++ trunk/po/POTFILES.in	2007-01-09 22:25:17 UTC (rev 688)
@@ -7,6 +7,8 @@
 UI/GTK2/src/indexDialog_glade.cc
 UI/GTK2/src/IndexTree.cpp
 UI/GTK2/src/IndexPage.cpp
+UI/GTK2/src/launcherDialog.cc
+UI/GTK2/src/launcherDialog_glade.cc
 UI/GTK2/src/mainWindow.cc
 UI/GTK2/src/mainWindow_glade.cc
 UI/GTK2/src/ModelColumns.cpp


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000681.html">[Pinot-svn] r687 - trunk/po
</A></li>
	<LI>Next message: <A HREF="000683.html">[Pinot-svn] r689 - in trunk: UI/GTK2/src Utils
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#682">[ date ]</a>
              <a href="thread.html#682">[ thread ]</a>
              <a href="subject.html#682">[ subject ]</a>
              <a href="author.html#682">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/pinot-svn">More information about the Pinot-svn
mailing list</a><br>
</body></html>
