From fabricecolin at mail.berlios.de  Sun Jan  7 15:03:20 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sun, 7 Jan 2007 15:03:20 +0100
Subject: [Pinot-svn] r675 - trunk/SQL
Message-ID: <200701071403.l07E3KRw010765@sheep.berlios.de>

Author: fabricecolin
Date: 2007-01-07 15:03:19 +0100 (Sun, 07 Jan 2007)
New Revision: 675

Modified:
   trunk/SQL/ActionQueue.cpp
   trunk/SQL/CrawlHistory.cpp
   trunk/SQL/CrawlHistory.h
   trunk/SQL/SQLiteBase.cpp
Log:
In SQLiteBase::open(), we may have to close the handle returned by
sqlite3_open() when it doesn't return SQLITE_OK !
Changed prototype of some of CrawlHistory's methods, fixed unescaping in
getSources().
Less DEBUG in ActionQueue.


Modified: trunk/SQL/ActionQueue.cpp
===================================================================
--- trunk/SQL/ActionQueue.cpp	2006-12-21 15:31:15 UTC (rev 674)
+++ trunk/SQL/ActionQueue.cpp	2007-01-07 14:03:19 UTC (rev 675)
@@ -227,9 +227,6 @@
 			type = textToType(row->getColumn(1));
 			string info(Url::unescapeUrl(row->getColumn(2)));
 			success = true;
-#ifdef DEBUG
-			cout << "ActionQueue::getOldestItem: " << info << endl;
-#endif
 
 			// Deserialize DocumentInfo
 			docInfo.setTitle(StringManip::extractField(info, "caption=", "\n"));
@@ -242,14 +239,6 @@
 			{
 				docInfo.setSize((off_t )atol(bytesSize.c_str()));
 			}
-#ifdef DEBUG
-			cout << "ActionQueue::getOldestItem: " << docInfo.getTitle() << ", "
-				<< docInfo.getLocation() << ", "
-				<< docInfo.getType() << ", "
-				<< docInfo.getLanguage() << ", "
-				<< docInfo.getTimestamp() << ", "
-				<< docInfo.getSize() << endl;
-#endif
 
 			delete row;
 		}

Modified: trunk/SQL/CrawlHistory.cpp
===================================================================
--- trunk/SQL/CrawlHistory.cpp	2006-12-21 15:31:15 UTC (rev 674)
+++ trunk/SQL/CrawlHistory.cpp	2007-01-07 14:03:19 UTC (rev 675)
@@ -48,6 +48,9 @@
 		case CRAWLED:
 			text = "CRAWLED";
 			break;
+		case ERROR:
+			text = "ERROR";
+			break;
 		default:
 			break;
 	}
@@ -67,6 +70,10 @@
 	{
 		status = CRAWLED;
 	}
+	else if (text == "ERROR")
+	{
+		status = ERROR;
+	}
 
 	return status;
 }
@@ -176,7 +183,7 @@
 				break;
 			}
 
-			sources[(unsigned int)atoi(row->getColumn(0).c_str())] = row->getColumn(1);
+			sources[(unsigned int)atoi(row->getColumn(0).c_str())] = Url::unescapeUrl(row->getColumn(1));
 			++count;
 
 			delete row;
@@ -327,11 +334,12 @@
 }
 
 /// Returns the number of URLs.
-unsigned int CrawlHistory::getItemsCount(void) const
+unsigned int CrawlHistory::getItemsCount(CrawlStatus status) const
 {
 	unsigned int count = 0;
 
-	SQLiteResults *results = executeStatement("SELECT COUNT(*) FROM CrawlHistory;");
+	SQLiteResults *results = executeStatement("SELECT COUNT(*) FROM CrawlHistory WHERE Status='%q';",
+		statusToText(status).c_str());
 	if (results != NULL)
 	{
 		SQLiteRow *row = results->nextRow();
@@ -365,12 +373,23 @@
 }
 
 /// Deletes URLs belonging to a source.
-bool CrawlHistory::deleteItems(unsigned int sourceId)
+bool CrawlHistory::deleteItems(unsigned int sourceId, CrawlStatus status)
 {
+	SQLiteResults *results = NULL;
 	bool success = false;
 
-	SQLiteResults *results = executeStatement("DELETE FROM CrawlHistory \
-		WHERE SourceID='%u';", sourceId);
+	if (status == UNKNOWN)
+	{
+		results = executeStatement("DELETE FROM CrawlHistory \
+			WHERE SourceID='%u';", sourceId);
+	}
+	else
+	{
+		results = executeStatement("DELETE FROM CrawlHistory \
+			WHERE SourceID='%u' AND Status='%q';",
+			sourceId, statusToText(status).c_str());
+	}
+
 	if (results != NULL)
 	{
 		success = true;

Modified: trunk/SQL/CrawlHistory.h
===================================================================
--- trunk/SQL/CrawlHistory.h	2006-12-21 15:31:15 UTC (rev 674)
+++ trunk/SQL/CrawlHistory.h	2007-01-07 14:03:19 UTC (rev 675)
@@ -35,7 +35,7 @@
 		CrawlHistory(const string &database);
 		virtual ~CrawlHistory();
 
-		typedef enum { UNKNOWN, CRAWLING, CRAWLED } CrawlStatus;
+		typedef enum { UNKNOWN, CRAWLING, CRAWLED, ERROR } CrawlStatus;
 
 		/// Creates the CrawlHistory table in the database.
 		static bool create(const string &database);
@@ -69,13 +69,13 @@
 			set<string> &urls, time_t maxDate = 0) const;
 
 		/// Returns the number of URLs.
-		unsigned int getItemsCount(void) const;
+		unsigned int getItemsCount(CrawlStatus status) const;
 
 		/// Deletes an URL.
 		bool deleteItem(const string &url);
 
 		/// Deletes URLs belonging to a source.
-		bool deleteItems(unsigned int sourceId);
+		bool deleteItems(unsigned int sourceId, CrawlStatus status = UNKNOWN);
 
 		/// Expires items older than the given date.
 		bool expireItems(time_t expiryDate);

Modified: trunk/SQL/SQLiteBase.cpp
===================================================================
--- trunk/SQL/SQLiteBase.cpp	2006-12-21 15:31:15 UTC (rev 674)
+++ trunk/SQL/SQLiteBase.cpp	2007-01-07 14:03:19 UTC (rev 675)
@@ -191,16 +191,35 @@
 	sqlite3 *pDatabase = NULL;
 
 	// Open the new database
-	if ((sqlite3_open(database.c_str(), &pDatabase) != SQLITE_OK) ||
-		(pDatabase == NULL))
+	if (sqlite3_open(database.c_str(), &pDatabase) != SQLITE_OK)
 	{
+		// An handle is returned even when an error occurs !
+		if (pDatabase != NULL)
+		{
+			cerr << "SQLiteBase::open: " << sqlite3_errmsg(pDatabase) << endl;
+#if 1
+			string cmdLine("echo SQLiteBase::open; ls -l /proc/");
+			char pidStr[64];
+
+			snprintf(pidStr, 64, "%u", getpid());
+			cmdLine += pidStr;
+			cmdLine += "/fd/";
+			system(cmdLine.c_str());
+#endif
+			close(pDatabase);
+			pDatabase = NULL;
+		}
+	}
+	else if (pDatabase == NULL)
+	{
 		cerr << "SQLiteBase::open: couldn't open " << database << endl;
-		pDatabase = NULL;
 	}
+	else
+	{
+		// Set up a busy handler
+		sqlite3_busy_handler(pDatabase, busyHandler, NULL);
+	}
 
-	// Set up a busy handler
-	sqlite3_busy_handler(pDatabase, busyHandler, NULL);
-
 	return pDatabase;
 }
 



From fabricecolin at mail.berlios.de  Sun Jan  7 15:17:13 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sun, 7 Jan 2007 15:17:13 +0100
Subject: [Pinot-svn] r676 - trunk/UI/GTK2/src
Message-ID: <200701071417.l07EHDA1012443@sheep.berlios.de>

Author: fabricecolin
Date: 2007-01-07 15:17:12 +0100 (Sun, 07 Jan 2007)
New Revision: 676

Modified:
   trunk/UI/GTK2/src/importDialog.cc
Log:
Removed long gone header.


Modified: trunk/UI/GTK2/src/importDialog.cc
===================================================================
--- trunk/UI/GTK2/src/importDialog.cc	2007-01-07 14:03:19 UTC (rev 675)
+++ trunk/UI/GTK2/src/importDialog.cc	2007-01-07 14:17:12 UTC (rev 676)
@@ -30,7 +30,6 @@
 #include "NLS.h"
 #include "Url.h"
 #include "MonitorFactory.h"
-#include "IndexFactory.h"
 #include "PinotSettings.h"
 #include "PinotUtils.h"
 #include "importDialog.hh"



From fabricecolin at mail.berlios.de  Tue Jan  9 13:17:46 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 9 Jan 2007 13:17:46 +0100
Subject: [Pinot-svn] r677 - trunk/UI/GTK2
Message-ID: <200701091217.l09CHk8l004658@sheep.berlios.de>

Author: fabricecolin
Date: 2007-01-09 13:17:46 +0100 (Tue, 09 Jan 2007)
New Revision: 677

Modified:
   trunk/UI/GTK2/metase-gtk2.glade
Log:
Moved Preferences under Edit in mainWindow, added Statistics under Session.
Revamped indexDialog.


Modified: trunk/UI/GTK2/metase-gtk2.glade
===================================================================
--- trunk/UI/GTK2/metase-gtk2.glade	2007-01-07 14:17:12 UTC (rev 676)
+++ trunk/UI/GTK2/metase-gtk2.glade	2007-01-09 12:17:46 UTC (rev 677)
@@ -24,7 +24,7 @@
   <signal name="delete_event" handler="on_mainWindow_delete_event" last_modification_time="Sat, 17 May 2003 11:06:56 GMT"/>
 
   <child>
-    <widget class="GtkVBox" id="vbox1">
+    <widget class="GtkVBox" id="mainVbox">
       <property name="visible">True</property>
       <property name="homogeneous">False</property>
       <property name="spacing">0</property>
@@ -46,12 +46,11 @@
 		<widget class="GtkMenu" id="sessionMenuitem_menu">
 
 		  <child>
-		    <widget class="GtkImageMenuItem" id="configure1">
-		      <property agent="glademm" name="cxx_visibility">protected</property>
+		    <widget class="GtkMenuItem" id="statistics1">
 		      <property name="visible">True</property>
-		      <property name="label">gtk-preferences</property>
-		      <property name="use_stock">True</property>
-		      <signal name="activate" handler="on_configure_activate" last_modification_time="Fri, 20 Feb 2004 18:58:55 GMT"/>
+		      <property name="label" translatable="yes">Statistics</property>
+		      <property name="use_underline">True</property>
+		      <signal name="activate" handler="on_statistics_activate" last_modification_time="Sun, 31 Dec 2006 11:01:47 GMT"/>
 		    </widget>
 		  </child>
 
@@ -125,6 +124,22 @@
 		      <signal name="activate" handler="on_delete_activate" last_modification_time="Mon, 12 Apr 2004 09:32:03 GMT"/>
 		    </widget>
 		  </child>
+
+		  <child>
+		    <widget class="GtkSeparatorMenuItem" id="separator4">
+		      <property name="visible">True</property>
+		    </widget>
+		  </child>
+
+		  <child>
+		    <widget class="GtkImageMenuItem" id="configure1">
+		      <property agent="glademm" name="cxx_visibility">protected</property>
+		      <property name="visible">True</property>
+		      <property name="label">gtk-preferences</property>
+		      <property name="use_stock">True</property>
+		      <signal name="activate" handler="on_configure_activate" last_modification_time="Fri, 20 Feb 2004 18:58:55 GMT"/>
+		    </widget>
+		  </child>
 		</widget>
 	      </child>
 	    </widget>
@@ -196,7 +211,7 @@
 		      <signal name="activate" handler="on_clearresults_activate" last_modification_time="Wed, 03 Mar 2004 19:51:48 GMT"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image617">
+			<widget class="GtkImage" id="image659">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-clear</property>
 			  <property name="icon_size">1</property>
@@ -243,7 +258,7 @@
 		      <signal name="activate" handler="on_morelikethis_activate" last_modification_time="Sun, 18 Jun 2006 10:50:56 GMT"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image618">
+			<widget class="GtkImage" id="image660">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-find</property>
 			  <property name="icon_size">1</property>
@@ -298,7 +313,7 @@
 		      <signal name="activate" handler="on_import_activate" last_modification_time="Tue, 02 Mar 2004 22:13:44 GMT"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image619">
+			<widget class="GtkImage" id="image661">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-open</property>
 			  <property name="icon_size">1</property>
@@ -336,7 +351,7 @@
 		      <signal name="activate" handler="on_refreshindex_activate" last_modification_time="Fri, 20 Feb 2004 18:57:09 GMT"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image620">
+			<widget class="GtkImage" id="image662">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-refresh</property>
 			  <property name="icon_size">1</property>
@@ -358,7 +373,7 @@
 		      <signal name="activate" handler="on_unindex_activate" last_modification_time="Thu, 28 Jul 2005 12:42:23 GMT"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image621">
+			<widget class="GtkImage" id="image663">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-delete</property>
 			  <property name="icon_size">1</property>
@@ -380,7 +395,7 @@
 		      <signal name="activate" handler="on_showfromindex_activate" last_modification_time="Sun, 06 Nov 2005 08:43:05 GMT"/>
 
 		      <child internal-child="image">
-			<widget class="GtkImage" id="image622">
+			<widget class="GtkImage" id="image664">
 			  <property name="visible">True</property>
 			  <property name="stock">gtk-properties</property>
 			  <property name="icon_size">1</property>
@@ -2170,7 +2185,7 @@
 	  <property name="spacing">0</property>
 
 	  <child>
-	    <widget class="GtkTable" id="table1">
+	    <widget class="GtkTable" id="nameTable">
 	      <property name="visible">True</property>
 	      <property name="n_rows">1</property>
 	      <property name="n_columns">2</property>
@@ -2392,6 +2407,10 @@
 	  </child>
 
 	  <child>
+	    <placeholder/>
+	  </child>
+
+	  <child>
 	    <widget class="GtkTable" id="tersmTable">
 	      <property name="visible">True</property>
 	      <property name="n_rows">2</property>
@@ -2871,7 +2890,7 @@
       <child>
 	<widget class="GtkTable" id="indexTable">
 	  <property name="visible">True</property>
-	  <property name="n_rows">4</property>
+	  <property name="n_rows">5</property>
 	  <property name="n_columns">2</property>
 	  <property name="homogeneous">False</property>
 	  <property name="row_spacing">0</property>
@@ -3040,8 +3059,8 @@
 	    <packing>
 	      <property name="left_attach">0</property>
 	      <property name="right_attach">1</property>
-	      <property name="top_attach">3</property>
-	      <property name="bottom_attach">4</property>
+	      <property name="top_attach">4</property>
+	      <property name="bottom_attach">5</property>
 	      <property name="x_options">fill</property>
 	      <property name="y_options">fill</property>
 	    </packing>
@@ -3088,8 +3107,8 @@
 	    <packing>
 	      <property name="left_attach">1</property>
 	      <property name="right_attach">2</property>
-	      <property name="top_attach">3</property>
-	      <property name="bottom_attach">4</property>
+	      <property name="top_attach">4</property>
+	      <property name="bottom_attach">5</property>
 	      <property name="x_padding">4</property>
 	      <property name="y_padding">4</property>
 	      <property name="y_options"></property>
@@ -3115,6 +3134,59 @@
 	      <property name="y_options"></property>
 	    </packing>
 	  </child>
+
+	  <child>
+	    <widget class="GtkLabel" id="hostLabel">
+	      <property name="visible">True</property>
+	      <property name="label" translatable="yes">Host name:</property>
+	      <property name="use_underline">False</property>
+	      <property name="use_markup">False</property>
+	      <property name="justify">GTK_JUSTIFY_LEFT</property>
+	      <property name="wrap">False</property>
+	      <property name="selectable">False</property>
+	      <property name="xalign">0</property>
+	      <property name="yalign">0.5</property>
+	      <property name="xpad">4</property>
+	      <property name="ypad">4</property>
+	      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+	      <property name="width_chars">-1</property>
+	      <property name="single_line_mode">False</property>
+	      <property name="angle">0</property>
+	    </widget>
+	    <packing>
+	      <property name="left_attach">0</property>
+	      <property name="right_attach">1</property>
+	      <property name="top_attach">3</property>
+	      <property name="bottom_attach">4</property>
+	      <property name="x_options">fill</property>
+	      <property name="y_options"></property>
+	    </packing>
+	  </child>
+
+	  <child>
+	    <widget class="GtkEntry" id="hostEntry">
+	      <property agent="glademm" name="cxx_visibility">protected</property>
+	      <property name="visible">True</property>
+	      <property name="can_focus">True</property>
+	      <property name="editable">True</property>
+	      <property name="visibility">True</property>
+	      <property name="max_length">0</property>
+	      <property name="text" translatable="yes"></property>
+	      <property name="has_frame">True</property>
+	      <property name="invisible_char">*</property>
+	      <property name="activates_default">False</property>
+	      <signal name="changed" handler="on_nameEntry_changed" last_modification_time="Tue, 15 Feb 2005 18:12:34 GMT"/>
+	    </widget>
+	    <packing>
+	      <property name="left_attach">1</property>
+	      <property name="right_attach">2</property>
+	      <property name="top_attach">3</property>
+	      <property name="bottom_attach">4</property>
+	      <property name="x_padding">4</property>
+	      <property name="y_padding">4</property>
+	      <property name="y_options"></property>
+	    </packing>
+	  </child>
 	</widget>
 	<packing>
 	  <property name="padding">0</property>
@@ -3470,4 +3542,91 @@
   </child>
 </widget>
 
+<widget class="GtkDialog" id="statisticsDialog">
+  <property name="visible">True</property>
+  <property name="title" translatable="yes">Statistics</property>
+  <property name="type">GTK_WINDOW_TOPLEVEL</property>
+  <property name="window_position">GTK_WIN_POS_NONE</property>
+  <property name="modal">False</property>
+  <property name="default_width">150</property>
+  <property name="default_height">350</property>
+  <property name="resizable">True</property>
+  <property name="destroy_with_parent">False</property>
+  <property name="decorated">True</property>
+  <property name="skip_taskbar_hint">False</property>
+  <property name="skip_pager_hint">False</property>
+  <property name="type_hint">GDK_WINDOW_TYPE_HINT_DIALOG</property>
+  <property name="gravity">GDK_GRAVITY_NORTH_WEST</property>
+  <property name="focus_on_map">True</property>
+  <property name="urgency_hint">False</property>
+  <property name="has_separator">True</property>
+
+  <child internal-child="vbox">
+    <widget class="GtkVBox" id="dialog-vbox8">
+      <property name="visible">True</property>
+      <property name="homogeneous">False</property>
+      <property name="spacing">0</property>
+
+      <child internal-child="action_area">
+	<widget class="GtkHButtonBox" id="dialog-action_area8">
+	  <property name="visible">True</property>
+	  <property name="layout_style">GTK_BUTTONBOX_END</property>
+
+	  <child>
+	    <widget class="GtkButton" id="closebutton1">
+	      <property name="visible">True</property>
+	      <property name="can_default">True</property>
+	      <property name="can_focus">True</property>
+	      <property name="label">gtk-close</property>
+	      <property name="use_stock">True</property>
+	      <property name="relief">GTK_RELIEF_NORMAL</property>
+	      <property name="focus_on_click">True</property>
+	      <property name="response_id">-7</property>
+	    </widget>
+	  </child>
+	</widget>
+	<packing>
+	  <property name="padding">0</property>
+	  <property name="expand">False</property>
+	  <property name="fill">True</property>
+	  <property name="pack_type">GTK_PACK_END</property>
+	</packing>
+      </child>
+
+      <child>
+	<widget class="GtkScrolledWindow" id="statisticsScrolledwindow">
+	  <property name="border_width">4</property>
+	  <property agent="glademm" name="cxx_visibility">protected</property>
+	  <property name="visible">True</property>
+	  <property name="can_focus">True</property>
+	  <property name="hscrollbar_policy">GTK_POLICY_AUTOMATIC</property>
+	  <property name="vscrollbar_policy">GTK_POLICY_AUTOMATIC</property>
+	  <property name="shadow_type">GTK_SHADOW_NONE</property>
+	  <property name="window_placement">GTK_CORNER_TOP_LEFT</property>
+
+	  <child>
+	    <widget class="GtkTreeView" id="statisticsTreeview">
+	      <property agent="glademm" name="cxx_visibility">protected</property>
+	      <property name="visible">True</property>
+	      <property name="can_focus">True</property>
+	      <property name="headers_visible">False</property>
+	      <property name="rules_hint">False</property>
+	      <property name="reorderable">False</property>
+	      <property name="enable_search">True</property>
+	      <property name="fixed_height_mode">False</property>
+	      <property name="hover_selection">False</property>
+	      <property name="hover_expand">False</property>
+	    </widget>
+	  </child>
+	</widget>
+	<packing>
+	  <property name="padding">0</property>
+	  <property name="expand">True</property>
+	  <property name="fill">True</property>
+	</packing>
+      </child>
+    </widget>
+  </child>
+</widget>
+
 </glade-interface>



From fabricecolin at mail.berlios.de  Tue Jan  9 13:19:24 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 9 Jan 2007 13:19:24 +0100
Subject: [Pinot-svn] r678 - in trunk: Index UI/GTK2/src
Message-ID: <200701091219.l09CJOaT010337@sheep.berlios.de>

Author: fabricecolin
Date: 2007-01-09 13:19:23 +0100 (Tue, 09 Jan 2007)
New Revision: 678

Modified:
   trunk/Index/XapianDatabase.cpp
   trunk/UI/GTK2/src/indexDialog.cc
   trunk/UI/GTK2/src/indexDialog_glade.cc
   trunk/UI/GTK2/src/indexDialog_glade.hh
Log:
Changes to remote indexes backend and UI to allow using xapian-progsrv with SSH.
Note this is disabled in the UI until I figure out the best way to prompt for
a password.


Modified: trunk/Index/XapianDatabase.cpp
===================================================================
--- trunk/Index/XapianDatabase.cpp	2007-01-09 12:17:46 UTC (rev 677)
+++ trunk/Index/XapianDatabase.cpp	2007-01-09 12:19:23 UTC (rev 678)
@@ -23,6 +23,7 @@
 #include <stdio.h>
 #include <iostream>
 
+#include "Url.h"
 #include "XapianDatabase.h"
 
 using std::cout;
@@ -126,12 +127,9 @@
 
 	// Is it a remote database ?
 	string::size_type slashPos = m_databaseName.find("/");
-	string::size_type colonPos = m_databaseName.find(":");
-	if ((slashPos == string::npos) &&
-		(colonPos != string::npos))
+	if (slashPos != 0)
 	{
-		string hostName = m_databaseName.substr(0, colonPos);
-		unsigned int port = (unsigned int)atoi(m_databaseName.substr(colonPos + 1).c_str());
+		Url urlObj(m_databaseName);
 
 		if (m_readOnly == false)
 		{
@@ -139,25 +137,68 @@
 			return;
 		}
 
-		try
+		if (m_databaseName.find("://") == string::npos)
 		{
+			// It's an old style remote specification without the protocol
+			urlObj = Url("tcpsrv://" + m_databaseName);
+		}
+
+		string hostName(urlObj.getHost());
+		// A port number should be included
+		string::size_type colonPos = hostName.find(":");
+		if (colonPos != string::npos)
+		{
+			string protocol(urlObj.getProtocol());
+			string portStr(hostName.substr(colonPos + 1));
+			unsigned int port = (unsigned int)atoi(portStr.c_str());
+
+			hostName.resize(colonPos);
+			try
+			{
+				if (protocol == "progsrv+ssh")
+				{
+					string args("-p");
+
+					args += " ";
+					args += portStr;
+					args += " -f ";
+					args += hostName;
+					args += " xapian-progsrv /";
+					args += urlObj.getLocation();
+					args += "/";
+					args += urlObj.getFile();
 #ifdef DEBUG
-			cout << "XapianDatabase::openDatabase: remote database at "
-				<< hostName << ":" << port << endl;
+					cout << "XapianDatabase::openDatabase: remote ssh access with ssh "
+						<< args << endl;
 #endif
-			Xapian::Database remoteDatabase = Xapian::Remote::open(hostName, port);
-			m_pDatabase = new Xapian::Database(remoteDatabase);
-			m_isOpen = true;
+					Xapian::Database remoteDatabase = Xapian::Remote::open("ssh", args);
+					m_pDatabase = new Xapian::Database(remoteDatabase);
+				}
+				else
+				{
+#ifdef DEBUG
+					cout << "XapianDatabase::openDatabase: remote database at "
+						<< hostName << " " << port << endl;
+#endif
+					Xapian::Database remoteDatabase = Xapian::Remote::open(hostName, port);
+					m_pDatabase = new Xapian::Database(remoteDatabase);
+					m_isOpen = true;
+				}
 
-			return;
+				return;
+			}
+			catch (const Xapian::Error &error)
+			{
+				cerr << "XapianDatabase::openDatabase: couldn't open remote database: "
+					<< error.get_msg() << endl;
+			}
 		}
-		catch (const Xapian::Error &error)
-		{
-			cerr << "XapianDatabase::openDatabase: couldn't open remote database: "
-				<< error.get_msg() << endl;
-		}
+#ifdef DEBUG
+		else cout << "XapianDatabase::openDatabase: invalid remote database at "
+			<< hostName << "/" << urlObj.getLocation() << "/" << urlObj.getFile() << endl;
+#endif
 
-		return;		
+		return;
 	}
 
 	// It's a local database : the specified path must be a directory

Modified: trunk/UI/GTK2/src/indexDialog.cc
===================================================================
--- trunk/UI/GTK2/src/indexDialog.cc	2007-01-09 12:17:46 UTC (rev 677)
+++ trunk/UI/GTK2/src/indexDialog.cc	2007-01-09 12:19:23 UTC (rev 678)
@@ -20,6 +20,7 @@
 
 #include "config.h"
 #include "NLS.h"
+#include "Url.h"
 #include "PinotSettings.h"
 #include "PinotUtils.h"
 #include "indexDialog.hh"
@@ -42,6 +43,7 @@
 
 	// By default, type is set to local
 	typeCombobox->set_active(0);
+	hostEntry->set_sensitive(false);
 	portSpinbutton->set_sensitive(false);
 	// ...and both name and location are empty
 	indexOkbutton->set_sensitive(false);
@@ -54,7 +56,6 @@
 	m_editIndex(false),
 	m_badName(true)
 {
-	ustring dirName = location;
 	unsigned int port = 1024;
 
 	// Associate the columns model to the type combo
@@ -69,26 +70,53 @@
 
 	// Type and location
 	ustring::size_type slashPos = location.find("/");
-	ustring::size_type colonPos = location.find(":");
-	if ((slashPos == ustring::npos) &&
-		(colonPos != ustring::npos))
+	if (slashPos == 0) 
 	{
-		// This is a remote index
-		dirName = location.substr(0, colonPos);
-		port = (unsigned int)atoi(location.substr(colonPos + 1).c_str());
+		// Local index
+		typeCombobox->set_active(0);
+		locationEntry->set_text(location);
+		hostEntry->set_sensitive(false);
+		portSpinbutton->set_sensitive(false);
+	}
+	else
+	{
+		Url urlObj(location);
 
-		typeCombobox->set_active(1);
-		locationButton->set_sensitive(false);
+		if (location.find("://") == ustring::npos)
+		{
+			// It's an old style remote specification without the protocol
+			urlObj = Url("tcpsrv://" + location);
+		}
 
-		// Port
+		// Remote index
+		ustring hostName(urlObj.getHost());
+		// A port number should be included
+		ustring::size_type colonPos = hostName.find(":");
+		if (colonPos != ustring::npos)
+		{
+			port = (unsigned int)atoi(hostName.substr(colonPos + 1).c_str());
+			hostName.resize(colonPos);
+		}
+
+#ifdef _SSH_TUNNEL
+		if (urlObj.getProtocol() == "progsrv+ssh")
+		{
+			// SSH tunnel
+			typeCombobox->set_active(2);
+			locationEntry->set_text("/" + urlObj.getLocation());
+			locationButton->set_sensitive(false);
+		}
+		else
+#endif
+		{
+			// Assume vanilla TCP/IP
+			typeCombobox->set_active(1);
+			locationEntry->set_sensitive(false);
+			locationButton->set_sensitive(false);
+		}
+		hostEntry->set_text(hostName);
 		portSpinbutton->set_value((double)port);
 	}
-	else
-	{
-		typeCombobox->set_active(0);
-		portSpinbutton->set_sensitive(false);
-	}
-	locationEntry->set_text(dirName);
 
 	m_editIndex = true;
 }
@@ -99,53 +127,81 @@
 
 void indexDialog::populate_typeCombobox(void)
 {
+	ustring servedBy(_("Served by"));
+
 	TreeModel::iterator iter = m_refTypeTree->append();
 	TreeModel::Row row = *iter;
-	row[m_typeColumns.m_name] = "Local";
+	row[m_typeColumns.m_name] = _("Local");
 	iter = m_refTypeTree->append();
 	row = *iter;
-	row[m_typeColumns.m_name] = "Remote";
+	row[m_typeColumns.m_name] = servedBy + " xapian-tcpsrv";
+#ifdef _SSH_TUNNEL
+	iter = m_refTypeTree->append();
+	row = *iter;
+	row[m_typeColumns.m_name] = servedBy + " xapian-progsrv+ssh";
+#endif
 }
 
 void indexDialog::checkFields(void)
 {
-	bool isLocal = false, enableOkButton = false;
+	bool needsLocation = false, needsHost = false, enableOkButton = true;
 
 	if (typeCombobox->get_active_row_number() == 0)
 	{
-		// Local index
+		// Local index : location only
+		locationEntry->set_sensitive(true);
+		locationButton->set_sensitive(true);
+		hostEntry->set_sensitive(false);
 		portSpinbutton->set_sensitive(false);
-		locationButton->set_sensitive(true);
-		isLocal = true;
+		needsLocation = true;
 	}
+	else if (typeCombobox->get_active_row_number() == 1)
+	{
+		// Vanilla TCP/IP : host and port only
+		locationEntry->set_sensitive(false);
+		locationButton->set_sensitive(false);
+		hostEntry->set_sensitive(true);
+		portSpinbutton->set_sensitive(true);
+		needsHost = true;
+	}
+#ifdef _SSH_TUNNEL
 	else
 	{
-		// Remote index
+		// SSH tunnel : location, host and port 
+		locationEntry->set_sensitive(true);
+		locationButton->set_sensitive(false);
+		hostEntry->set_sensitive(true);
 		portSpinbutton->set_sensitive(true);
-		locationButton->set_sensitive(false);
+		needsLocation = true;
+		needsHost = true;
 	}
+#endif
 
-	ustring location = locationEntry->get_text();
-	if (location.empty() == false)
+	// Enable the OK button only if host name and location make sense
+	if (needsLocation == true)
 	{
-		bool hasSlash = true;
-
-		ustring::size_type slashPos = location.find("/");
-		if (slashPos == ustring::npos)
+		ustring location(locationEntry->get_text());
+		if (location.empty() == true)
 		{
-			hasSlash = false;
+			enableOkButton = false;
 		}
-
-		// Disable the OK button if the type+location pair doesn't make sense
-		// or if name is empty
-		ustring name = nameEntry->get_text();
-		if ((name.empty() == false) &&
-			(hasSlash == isLocal))
+		else
 		{
-			enableOkButton = true;
+			ustring::size_type slashPos = location.find("/");
+			if (slashPos != 0)
+			{
+				enableOkButton = false;
+			}
 		}
 	}
-
+	if (needsHost == true)
+	{
+		ustring hostName(hostEntry->get_text());
+		if (hostName.empty() == true)
+		{
+			enableOkButton = false;
+		}
+	}
 	indexOkbutton->set_sensitive(enableOkButton);
 }
 
@@ -167,22 +223,41 @@
 void indexDialog::on_indexOkbutton_clicked()
 {
 	PinotSettings &settings = PinotSettings::getInstance();
+	// The changed() methods ensure name and location are set
+	ustring location, name = nameEntry->get_text();
 
-	// The changed() methods ensure name and location are set
-	ustring name = nameEntry->get_text();
-	ustring location = locationEntry->get_text();
 	m_badName = false;
 
 	// Is it a remote index ?
-	if (typeCombobox->get_active_row_number() == 1)
+	if (typeCombobox->get_active_row_number() == 0)
 	{
+		location = locationEntry->get_text();
+	}
+	else
+	{
 		char portStr[64];
 		int port = portSpinbutton->get_value_as_int();
+
 		snprintf(portStr, 64, "%d", port);
-
-		// Append the port number
-		location += ":";
-		location += portStr;
+		if (typeCombobox->get_active_row_number() == 1)
+		{
+			// Vanilla TCP/IP
+			location = "tcpsrv://";
+			location += hostEntry->get_text();
+			location += ":";
+			location += portStr;
+		}
+#ifdef _SSH_TUNNEL
+		else
+		{
+			// SSH tunnel
+			location = "progsrv+ssh://";
+			location += hostEntry->get_text();
+			location += ":";
+			location += portStr;
+			location += locationEntry->get_text();
+		}
+#endif
 	}
 #ifdef DEBUG
 	cout << "indexDialog::on_indexOkbutton_clicked: " << name << ", " << location << endl;

Modified: trunk/UI/GTK2/src/indexDialog_glade.cc
===================================================================
--- trunk/UI/GTK2/src/indexDialog_glade.cc	2007-01-09 12:17:46 UTC (rev 677)
+++ trunk/UI/GTK2/src/indexDialog_glade.cc	2007-01-09 12:19:23 UTC (rev 678)
@@ -1,9 +1,9 @@
-// generated 2006/1/5 9:17:19 SGT by fabrice at thorgrim.dyndns.org.(none)
-// using glademm V2.6.0
+// generated 2006/12/29 9:49:18 SGT by fabrice at thorgrim.dyndns.org.(none)
+// using glademm V2.12.1
 //
 // DO NOT EDIT THIS FILE ! It was created using
 // glade-- /home/fabrice/Projects/MetaSE/pinot/UI/GTK2/metase-gtk2.glade
-// for gtk 2.6.10 and gtkmm 2.6.2
+// for gtk 2.10.4 and gtkmm 2.10.5
 //
 // Please modify the corresponding derived classes in ./src/indexDialog.cc
 
@@ -25,18 +25,11 @@
 #  else
 #    define N_(String) (String)
 #  endif
-#else
-#  define textdomain(String) (String)
-#  define gettext(String) (String)
-#  define dgettext(Domain,Message) (Message)
-#  define dcgettext(Domain,Message,Type) (Message)
-#  define bindtextdomain(Domain,Directory) (Domain)
-#  define _(String) (String)
-#  define N_(String) (String)
 #endif
 #include <gtkmmconfig.h>
 #if GTKMM_MAJOR_VERSION==2 && GTKMM_MINOR_VERSION>2
 #include <sigc++/compatibility.h>
+#include <sigc++/bind.h>
 #define GMM_GTKMM_22_24(a,b) b
 #else //gtkmm 2.2
 #define GMM_GTKMM_22_24(a,b) a
@@ -49,7 +42,17 @@
 #include <gtkmm/box.h>
 #include <gtkmm/adjustment.h>
 #include <gtkmm/table.h>
+#ifndef ENABLE_NLS
+#  define textdomain(String) (String)
+#  define gettext(String) (String)
+#  define dgettext(Domain,Message) (Message)
+#  define dcgettext(Domain,Message,Type) (Message)
+#  define bindtextdomain(Domain,Directory) (Domain)
+#  define _(String) (String)
+#  define N_(String) (String)
+#endif
 
+
 indexDialog_glade::indexDialog_glade(
 )
 {  
@@ -73,6 +76,9 @@
    portSpinbutton = Gtk::manage(new class Gtk::SpinButton(*portSpinbutton_adj, 1, 0));
    typeCombobox = Gtk::manage(new class Gtk::ComboBox());
    
+   Gtk::Label *hostLabel = Gtk::manage(new class Gtk::Label(_("Host name:")));
+   hostEntry = Gtk::manage(new class Gtk::Entry());
+   
    Gtk::Table *indexTable = Gtk::manage(new class Gtk::Table(2, 2, false));
    indexCancelbutton->set_flags(Gtk::CAN_FOCUS);
    indexCancelbutton->set_flags(Gtk::CAN_DEFAULT);
@@ -127,16 +133,30 @@
    portSpinbutton->set_numeric(false);
    portSpinbutton->set_digits(0);
    portSpinbutton->set_wrap(false);
+   hostLabel->set_alignment(0,0.5);
+   hostLabel->set_padding(4,4);
+   hostLabel->set_justify(Gtk::JUSTIFY_LEFT);
+   hostLabel->set_line_wrap(false);
+   hostLabel->set_use_markup(false);
+   hostLabel->set_selectable(false);
+   hostEntry->set_flags(Gtk::CAN_FOCUS);
+   hostEntry->set_visibility(true);
+   hostEntry->set_editable(true);
+   hostEntry->set_max_length(0);
+   hostEntry->set_has_frame(true);
+   hostEntry->set_activates_default(false);
    indexTable->set_row_spacings(0);
    indexTable->set_col_spacings(0);
    indexTable->attach(*nameLabel, 0, 1, 0, 1, Gtk::FILL, Gtk::FILL, 0, 0);
    indexTable->attach(*locationHbox, 1, 2, 2, 3, Gtk::FILL, Gtk::FILL, 4, 4);
    indexTable->attach(*typeLabel, 0, 1, 1, 2, Gtk::FILL, Gtk::FILL, 0, 0);
    indexTable->attach(*locationLabel, 0, 1, 2, 3, Gtk::FILL, Gtk::FILL, 0, 0);
-   indexTable->attach(*portLabel, 0, 1, 3, 4, Gtk::FILL, Gtk::FILL, 0, 0);
+   indexTable->attach(*portLabel, 0, 1, 4, 5, Gtk::FILL, Gtk::FILL, 0, 0);
    indexTable->attach(*nameEntry, 1, 2, 0, 1, Gtk::EXPAND|Gtk::FILL, Gtk::AttachOptions(), 4, 4);
-   indexTable->attach(*portSpinbutton, 1, 2, 3, 4, Gtk::EXPAND|Gtk::FILL, Gtk::AttachOptions(), 4, 4);
+   indexTable->attach(*portSpinbutton, 1, 2, 4, 5, Gtk::EXPAND|Gtk::FILL, Gtk::AttachOptions(), 4, 4);
    indexTable->attach(*typeCombobox, 1, 2, 1, 2, Gtk::EXPAND|Gtk::FILL, Gtk::AttachOptions(), 4, 4);
+   indexTable->attach(*hostLabel, 0, 1, 3, 4, Gtk::FILL, Gtk::AttachOptions(), 0, 0);
+   indexTable->attach(*hostEntry, 1, 2, 3, 4, Gtk::EXPAND|Gtk::FILL, Gtk::AttachOptions(), 4, 4);
    indexDialog->get_vbox()->set_homogeneous(false);
    indexDialog->get_vbox()->set_spacing(0);
    indexDialog->get_vbox()->pack_start(*indexTable);
@@ -160,6 +180,8 @@
    nameEntry->show();
    portSpinbutton->show();
    typeCombobox->show();
+   hostLabel->show();
+   hostEntry->show();
    indexTable->show();
    indexDialog->show();
    indexOkbutton->signal_clicked().connect(SigC::slot(*this, &indexDialog_glade::on_indexOkbutton_clicked), false);
@@ -167,6 +189,7 @@
    locationButton->signal_clicked().connect(SigC::slot(*this, &indexDialog_glade::on_locationButton_clicked), false);
    nameEntry->signal_changed().connect(SigC::slot(*this, &indexDialog_glade::on_nameEntry_changed), false);
    typeCombobox->signal_changed().connect(SigC::slot(*this, &indexDialog_glade::on_typeCombobox_changed), false);
+   hostEntry->signal_changed().connect(SigC::slot(*this, &indexDialog_glade::on_nameEntry_changed), false);
 }
 
 indexDialog_glade::~indexDialog_glade()

Modified: trunk/UI/GTK2/src/indexDialog_glade.hh
===================================================================
--- trunk/UI/GTK2/src/indexDialog_glade.hh	2007-01-09 12:17:46 UTC (rev 677)
+++ trunk/UI/GTK2/src/indexDialog_glade.hh	2007-01-09 12:19:23 UTC (rev 678)
@@ -1,9 +1,9 @@
-// generated 2005/4/17 5:19:13 BST by fabrice at thorgrim.dyndns.org.(none)
-// using glademm V2.6.0
+// generated 2006/12/29 9:49:18 SGT by fabrice at thorgrim.dyndns.org.(none)
+// using glademm V2.12.1
 //
 // DO NOT EDIT THIS FILE ! It was created using
-// glade-- /home/fabrice/Projects/MetaSE/metase/UI/GTK2/metase-gtk2.glade
-// for gtk 2.4.0 and gtkmm 2.4.8
+// glade-- /home/fabrice/Projects/MetaSE/pinot/UI/GTK2/metase-gtk2.glade
+// for gtk 2.10.4 and gtkmm 2.10.5
 //
 // Please modify the corresponding derived classes in ./src/indexDialog.hh and./src/indexDialog.cc
 
@@ -49,6 +49,7 @@
         class Gtk::Entry * nameEntry;
         class Gtk::SpinButton * portSpinbutton;
         class Gtk::ComboBox * typeCombobox;
+        class Gtk::Entry * hostEntry;
         
         indexDialog_glade();
         



From fabricecolin at mail.berlios.de  Tue Jan  9 13:22:18 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 9 Jan 2007 13:22:18 +0100
Subject: [Pinot-svn] r679 - trunk/UI/GTK2/src
Message-ID: <200701091222.l09CMIQY010655@sheep.berlios.de>

Author: fabricecolin
Date: 2007-01-09 13:22:18 +0100 (Tue, 09 Jan 2007)
New Revision: 679

Modified:
   trunk/UI/GTK2/src/mainWindow.cc
   trunk/UI/GTK2/src/mainWindow.hh
   trunk/UI/GTK2/src/mainWindow_glade.cc
   trunk/UI/GTK2/src/mainWindow_glade.hh
Log:
Open statisticsDialog when Session, Statistics is activated.
Added .desktop file's Comment to about box to help with translation.


Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2007-01-09 12:19:23 UTC (rev 678)
+++ trunk/UI/GTK2/src/mainWindow.cc	2007-01-09 12:22:18 UTC (rev 679)
@@ -54,6 +54,7 @@
 #include "propertiesDialog.hh"
 #include "prefsDialog.hh"
 #include "queryDialog.hh"
+#include "statisticsDialog.hh"
 
 using namespace std;
 using namespace Glib;
@@ -1388,8 +1389,18 @@
 }
 
 //
-// Session > Configure menu selected
+// Session > Statistics menu selected
 //
+void mainWindow::on_statistics_activate()
+{
+	statisticsDialog statsDialog;
+	statsDialog.show();
+	statsDialog.run();
+}
+
+//
+// Edit > Preferences menu selected
+//
 void mainWindow::on_configure_activate()
 {
 	prefsDialog prefsBox;
@@ -2209,8 +2220,9 @@
 {
 	AboutDialog aboutBox;
 
-	aboutBox.set_comments(_("A metasearch tool for the Free Desktop"));
-	aboutBox.set_copyright(_("(C) 2005-2006 Fabrice Colin"));
+	aboutBox.set_comments(_("A metasearch tool for the Free Desktop") + string(".\n") +
+		_("Search the Web and your documents !"));
+	aboutBox.set_copyright(_("(C) 2005 Fabrice Colin"));
 	aboutBox.set_name("Pinot");
 	aboutBox.set_version(VERSION);
 	aboutBox.set_website("http://pinot.berlios.de/");

Modified: trunk/UI/GTK2/src/mainWindow.hh
===================================================================
--- trunk/UI/GTK2/src/mainWindow.hh	2007-01-09 12:19:23 UTC (rev 678)
+++ trunk/UI/GTK2/src/mainWindow.hh	2007-01-09 12:22:18 UTC (rev 679)
@@ -76,6 +76,7 @@
 	void on_editindex(Glib::ustring indexName, Glib::ustring location);
 
 	// Handlers inherited from the base class
+	virtual void on_statistics_activate();
 	virtual void on_configure_activate();
 	virtual void on_quit_activate();
 

Modified: trunk/UI/GTK2/src/mainWindow_glade.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow_glade.cc	2007-01-09 12:19:23 UTC (rev 678)
+++ trunk/UI/GTK2/src/mainWindow_glade.cc	2007-01-09 12:22:18 UTC (rev 679)
@@ -1,9 +1,9 @@
-// generated 2006/10/14 13:40:30 SGT by fabrice at amra.dyndns.org.(none)
+// generated 2007/1/1 9:58:40 SGT by fabrice at thorgrim.dyndns.org.(none)
 // using glademm V2.12.1
 //
 // DO NOT EDIT THIS FILE ! It was created using
 // glade-- /home/fabrice/Projects/MetaSE/pinot/UI/GTK2/metase-gtk2.glade
-// for gtk 2.8.20 and gtkmm 2.8.8
+// for gtk 2.10.4 and gtkmm 2.10.5
 //
 // Please modify the corresponding derived classes in ./src/mainWindow.cc
 
@@ -37,10 +37,10 @@
 #include "mainWindow_glade.hh"
 #include <gdk/gdkkeysyms.h>
 #include <gtkmm/accelgroup.h>
+#include <gtkmm/menuitem.h>
 #include <gtk/gtkimagemenuitem.h>
 #include <gtkmm/menu.h>
 #include <gtkmm/image.h>
-#include <gtkmm/menuitem.h>
 #include <gtkmm/menubar.h>
 #include <gtkmm/box.h>
 #include <gtkmm/label.h>
@@ -62,16 +62,18 @@
 ) : Gtk::Window(Gtk::WINDOW_TOPLEVEL)
 {  mainWindow = this;
    gmm_data = new GlademmData(get_accel_group());
-   configure1 = NULL;
+   
+   Gtk::MenuItem *statistics1 = NULL;
    separatormenuitem1 = NULL;
    quit1 = NULL;
-   
    Gtk::Menu *sessionMenuitem_menu = Gtk::manage(new class Gtk::Menu());
    sessionMenuitem = NULL;
    cut1 = NULL;
    copy1 = NULL;
    paste1 = NULL;
    delete1 = NULL;
+   Gtk::MenuItem *separator4 = NULL;
+   configure1 = NULL;
    Gtk::Menu *editMenuitem_menu = Gtk::manage(new class Gtk::Menu());
    editMenuitem = NULL;
    showextract1 = NULL;
@@ -80,26 +82,26 @@
    hostnamegroup1 = NULL;
    Gtk::Menu *groupresults1_menu = Gtk::manage(new class Gtk::Menu());
    groupresults1 = NULL;
-   Gtk::Image *image617 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-clear"), Gtk::IconSize(1)));
+   Gtk::Image *image659 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-clear"), Gtk::IconSize(1)));
    clearresults1 = NULL;
    Gtk::MenuItem *separator1 = NULL;
    viewresults1 = NULL;
    viewcache1 = NULL;
-   Gtk::Image *image618 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-find"), Gtk::IconSize(1)));
+   Gtk::Image *image660 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-find"), Gtk::IconSize(1)));
    morelikethis1 = NULL;
    indexresults1 = NULL;
    Gtk::Menu *resultsMenuitem_menu = Gtk::manage(new class Gtk::Menu());
    resultsMenuitem = NULL;
    list1 = NULL;
-   Gtk::Image *image619 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-open"), Gtk::IconSize(1)));
+   Gtk::Image *image661 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-open"), Gtk::IconSize(1)));
    import1 = NULL;
    Gtk::MenuItem *separator3 = NULL;
    viewfromindex1 = NULL;
-   Gtk::Image *image620 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-refresh"), Gtk::IconSize(1)));
+   Gtk::Image *image662 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-refresh"), Gtk::IconSize(1)));
    refreshindex1 = NULL;
-   Gtk::Image *image621 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-delete"), Gtk::IconSize(1)));
+   Gtk::Image *image663 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-delete"), Gtk::IconSize(1)));
    unindex1 = NULL;
-   Gtk::Image *image622 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-properties"), Gtk::IconSize(1)));
+   Gtk::Image *image664 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-properties"), Gtk::IconSize(1)));
    showfromindex1 = NULL;
    Gtk::Menu *indexMenuitem_menu = Gtk::manage(new class Gtk::Menu());
    indexMenuitem = NULL;
@@ -118,7 +120,7 @@
    Gtk::HBox *indexHbox = Gtk::manage(new class Gtk::HBox(true, 4));
    leftVbox = Gtk::manage(new class Gtk::VBox(false, 0));
    
-   Gtk::Image *image616 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-network"), Gtk::IconSize(4)));
+   Gtk::Image *image623 = Gtk::manage(new class Gtk::Image(Gtk::StockID("gtk-network"), Gtk::IconSize(4)));
    enginesTogglebutton = Gtk::manage(new class Gtk::ToggleButton());
    
    Gtk::Label *liveQueryLabel = Gtk::manage(new class Gtk::Label(_("Query:")));
@@ -154,10 +156,10 @@
    mainStatusbar = Gtk::manage(new class Gtk::Statusbar());
    
    Gtk::HBox *mainHbox = Gtk::manage(new class Gtk::HBox(false, 0));
-   Gtk::VBox *vbox1 = Gtk::manage(new class Gtk::VBox(false, 0));
+   Gtk::VBox *mainVbox = Gtk::manage(new class Gtk::VBox(false, 0));
    
-   sessionMenuitem_menu->items().push_back(Gtk::Menu_Helpers::StockMenuElem(Gtk::StockID("gtk-preferences")));
-   configure1 = (Gtk::ImageMenuItem *)&sessionMenuitem_menu->items().back();
+   sessionMenuitem_menu->items().push_back(Gtk::Menu_Helpers::MenuElem(_("Statistics")));
+   statistics1 = (Gtk::MenuItem *)&sessionMenuitem_menu->items().back();
    
    sessionMenuitem_menu->items().push_back(Gtk::Menu_Helpers::SeparatorElem());
    separatormenuitem1 = (Gtk::MenuItem *)&sessionMenuitem_menu->items().back();
@@ -177,6 +179,12 @@
    editMenuitem_menu->items().push_back(Gtk::Menu_Helpers::StockMenuElem(Gtk::StockID("gtk-delete")));
    delete1 = (Gtk::ImageMenuItem *)&editMenuitem_menu->items().back();
    
+   editMenuitem_menu->items().push_back(Gtk::Menu_Helpers::SeparatorElem());
+   separator4 = (Gtk::MenuItem *)&editMenuitem_menu->items().back();
+   
+   editMenuitem_menu->items().push_back(Gtk::Menu_Helpers::StockMenuElem(Gtk::StockID("gtk-preferences")));
+   configure1 = (Gtk::ImageMenuItem *)&editMenuitem_menu->items().back();
+   
    groupresults1_menu->items().push_back(Gtk::Menu_Helpers::RadioMenuElem(_RadioMIGroup_searchenginegroup1, _("Search Engine")));
    searchenginegroup1 = (Gtk::RadioMenuItem *)&groupresults1_menu->items().back();
    
@@ -189,7 +197,7 @@
    resultsMenuitem_menu->items().push_back(Gtk::Menu_Helpers::MenuElem(_("Group By"), *groupresults1_menu));
    groupresults1 = (Gtk::MenuItem *)&resultsMenuitem_menu->items().back();
    
-   resultsMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("Clear List"), *image617));
+   resultsMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("Clear List"), *image659));
    clearresults1 = (Gtk::ImageMenuItem *)&resultsMenuitem_menu->items().back();
    
    resultsMenuitem_menu->items().push_back(Gtk::Menu_Helpers::SeparatorElem());
@@ -201,7 +209,7 @@
    resultsMenuitem_menu->items().push_back(Gtk::Menu_Helpers::MenuElem(_("View Cache")));
    viewcache1 = (Gtk::MenuItem *)&resultsMenuitem_menu->items().back();
    
-   resultsMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("More Like This"), *image618));
+   resultsMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("More Like This"), *image660));
    morelikethis1 = (Gtk::ImageMenuItem *)&resultsMenuitem_menu->items().back();
    
    resultsMenuitem_menu->items().push_back(Gtk::Menu_Helpers::MenuElem(_("_Index")));
@@ -210,7 +218,7 @@
    indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::MenuElem(_("List Contents Of")));
    list1 = (Gtk::MenuItem *)&indexMenuitem_menu->items().back();
    
-   indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("Import URL"), *image619));
+   indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("Import URL"), *image661));
    import1 = (Gtk::ImageMenuItem *)&indexMenuitem_menu->items().back();
    
    indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::SeparatorElem());
@@ -219,13 +227,13 @@
    indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::MenuElem(_("View")));
    viewfromindex1 = (Gtk::MenuItem *)&indexMenuitem_menu->items().back();
    
-   indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("Update"), *image620));
+   indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("Update"), *image662));
    refreshindex1 = (Gtk::ImageMenuItem *)&indexMenuitem_menu->items().back();
    
-   indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("Unindex"), *image621));
+   indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("Unindex"), *image663));
    unindex1 = (Gtk::ImageMenuItem *)&indexMenuitem_menu->items().back();
    
-   indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("Properties"), *image622));
+   indexMenuitem_menu->items().push_back(Gtk::Menu_Helpers::ImageMenuElem(_("Properties"), *image664));
    showfromindex1 = (Gtk::ImageMenuItem *)&indexMenuitem_menu->items().back();
    
    helpMenuitem_menu->items().push_back(Gtk::Menu_Helpers::MenuElem(_("_About")));
@@ -248,18 +256,18 @@
    showextract1->set_active(true);
    searchenginegroup1->set_active(true);
    hostnamegroup1->set_active(false);
-   image617->set_alignment(0.5,0.5);
-   image617->set_padding(0,0);
-   image618->set_alignment(0.5,0.5);
-   image618->set_padding(0,0);
-   image619->set_alignment(0.5,0.5);
-   image619->set_padding(0,0);
-   image620->set_alignment(0.5,0.5);
-   image620->set_padding(0,0);
-   image621->set_alignment(0.5,0.5);
-   image621->set_padding(0,0);
-   image622->set_alignment(0.5,0.5);
-   image622->set_padding(0,0);
+   image659->set_alignment(0.5,0.5);
+   image659->set_padding(0,0);
+   image660->set_alignment(0.5,0.5);
+   image660->set_padding(0,0);
+   image661->set_alignment(0.5,0.5);
+   image661->set_padding(0,0);
+   image662->set_alignment(0.5,0.5);
+   image662->set_padding(0,0);
+   image663->set_alignment(0.5,0.5);
+   image663->set_padding(0,0);
+   image664->set_alignment(0.5,0.5);
+   image664->set_padding(0,0);
    image439->set_alignment(0.5,0.5);
    image439->set_padding(0,0);
    addIndexButton->set_flags(Gtk::CAN_FOCUS);
@@ -276,12 +284,12 @@
    indexHbox->pack_start(*removeIndexButton);
    leftVbox->pack_start(*enginesVbox);
    leftVbox->pack_start(*indexHbox, Gtk::PACK_SHRINK, 0);
-   image616->set_alignment(0.5,0.5);
-   image616->set_padding(0,0);
+   image623->set_alignment(0.5,0.5);
+   image623->set_padding(0,0);
    enginesTogglebutton->set_flags(Gtk::CAN_FOCUS);
    enginesTogglebutton->set_relief(Gtk::RELIEF_NORMAL);
    enginesTogglebutton->set_active(false);
-   enginesTogglebutton->add(*image616);
+   enginesTogglebutton->add(*image623);
    liveQueryLabel->set_alignment(0.5,0.5);
    liveQueryLabel->set_padding(0,0);
    liveQueryLabel->set_justify(Gtk::JUSTIFY_LEFT);
@@ -376,9 +384,9 @@
    mainHpaned->pack2(*rightVbox, Gtk::EXPAND|Gtk::SHRINK);
    mainHbox->pack_start(*mainProgressbar, Gtk::PACK_SHRINK, 0);
    mainHbox->pack_start(*mainStatusbar);
-   vbox1->pack_start(*mainMenubar, Gtk::PACK_SHRINK, 0);
-   vbox1->pack_start(*mainHpaned, Gtk::PACK_EXPAND_WIDGET, 4);
-   vbox1->pack_start(*mainHbox, Gtk::PACK_SHRINK, 0);
+   mainVbox->pack_start(*mainMenubar, Gtk::PACK_SHRINK, 0);
+   mainVbox->pack_start(*mainHpaned, Gtk::PACK_EXPAND_WIDGET, 4);
+   mainVbox->pack_start(*mainHbox, Gtk::PACK_SHRINK, 0);
    mainWindow->set_events(Gdk::BUTTON_PRESS_MASK);
    mainWindow->set_title(_("Pinot"));
    mainWindow->set_default_size(680,500);
@@ -386,8 +394,8 @@
    mainWindow->property_window_position().set_value(Gtk::WIN_POS_NONE);
    mainWindow->set_resizable(true);
    mainWindow->property_destroy_with_parent().set_value(false);
-   mainWindow->add(*vbox1);
-   configure1->show();
+   mainWindow->add(*mainVbox);
+   statistics1->show();
    separatormenuitem1->show();
    quit1->show();
    sessionMenuitem->show();
@@ -395,30 +403,32 @@
    copy1->show();
    paste1->show();
    delete1->show();
+   separator4->show();
+   configure1->show();
    editMenuitem->show();
    showextract1->show();
    searchenginegroup1->show();
    hostnamegroup1->show();
    groupresults1->show();
-   image617->show();
+   image659->show();
    clearresults1->show();
    separator1->show();
    viewresults1->show();
    viewcache1->show();
-   image618->show();
+   image660->show();
    morelikethis1->show();
    indexresults1->show();
    resultsMenuitem->show();
    list1->show();
-   image619->show();
+   image661->show();
    import1->show();
    separator3->show();
    viewfromindex1->show();
-   image620->show();
+   image662->show();
    refreshindex1->show();
-   image621->show();
+   image663->show();
    unindex1->show();
-   image622->show();
+   image664->show();
    showfromindex1->show();
    indexMenuitem->show();
    about1->show();
@@ -430,7 +440,7 @@
    image438->show();
    removeIndexButton->show();
    indexHbox->show();
-   image616->show();
+   image623->show();
    enginesTogglebutton->show();
    liveQueryLabel->show();
    liveQueryEntry->show();
@@ -456,13 +466,14 @@
    mainProgressbar->show();
    mainStatusbar->show();
    mainHbox->show();
-   vbox1->show();
-   configure1->signal_activate().connect(SigC::slot(*this, &mainWindow_glade::on_configure_activate), false);
+   mainVbox->show();
+   statistics1->signal_activate().connect(SigC::slot(*this, &mainWindow_glade::on_statistics_activate), false);
    quit1->signal_activate().connect(SigC::slot(*this, &mainWindow_glade::on_quit_activate), false);
    cut1->signal_activate().connect(SigC::slot(*this, &mainWindow_glade::on_cut_activate), false);
    copy1->signal_activate().connect(SigC::slot(*this, &mainWindow_glade::on_copy_activate), false);
    paste1->signal_activate().connect(SigC::slot(*this, &mainWindow_glade::on_paste_activate), false);
    delete1->signal_activate().connect(SigC::slot(*this, &mainWindow_glade::on_delete_activate), false);
+   configure1->signal_activate().connect(SigC::slot(*this, &mainWindow_glade::on_configure_activate), false);
    showextract1->signal_activate().connect(SigC::slot(*this, &mainWindow_glade::on_showextract_activate), false);
    searchenginegroup1->signal_activate().connect(SigC::slot(*this, &mainWindow_glade::on_groupresults_activate), false);
    clearresults1->signal_activate().connect(SigC::slot(*this, &mainWindow_glade::on_clearresults_activate), false);

Modified: trunk/UI/GTK2/src/mainWindow_glade.hh
===================================================================
--- trunk/UI/GTK2/src/mainWindow_glade.hh	2007-01-09 12:19:23 UTC (rev 678)
+++ trunk/UI/GTK2/src/mainWindow_glade.hh	2007-01-09 12:22:18 UTC (rev 679)
@@ -1,9 +1,9 @@
-// generated 2006/10/14 13:07:15 SGT by fabrice at amra.dyndns.org.(none)
+// generated 2007/1/1 9:58:40 SGT by fabrice at thorgrim.dyndns.org.(none)
 // using glademm V2.12.1
 //
 // DO NOT EDIT THIS FILE ! It was created using
 // glade-- /home/fabrice/Projects/MetaSE/pinot/UI/GTK2/metase-gtk2.glade
-// for gtk 2.8.20 and gtkmm 2.8.8
+// for gtk 2.10.4 and gtkmm 2.10.5
 //
 // Please modify the corresponding derived classes in ./src/mainWindow.hh and./src/mainWindow.cc
 
@@ -32,8 +32,8 @@
 #endif //GLADEMM_DATA
 
 #include <gtkmm/window.h>
+#include <gtkmm/menuitem.h>
 #include <gtkmm/imagemenuitem.h>
-#include <gtkmm/menuitem.h>
 #include <gtkmm/checkmenuitem.h>
 #include <gtkmm/radiomenuitem.h>
 #include <gtkmm/box.h>
@@ -57,7 +57,6 @@
 public:
         class Gtk::Window * mainWindow;
 protected:
-        class Gtk::ImageMenuItem * configure1;
         class Gtk::MenuItem * separatormenuitem1;
         class Gtk::ImageMenuItem * quit1;
         class Gtk::MenuItem * sessionMenuitem;
@@ -65,6 +64,7 @@
         class Gtk::ImageMenuItem * copy1;
         class Gtk::ImageMenuItem * paste1;
         class Gtk::ImageMenuItem * delete1;
+        class Gtk::ImageMenuItem * configure1;
         class Gtk::MenuItem * editMenuitem;
         class Gtk::CheckMenuItem * showextract1;
         class Gtk::RadioMenuItem * searchenginegroup1;
@@ -111,12 +111,13 @@
         
         ~mainWindow_glade();
 private:
-        virtual void on_configure_activate() = 0;
+        virtual void on_statistics_activate() = 0;
         virtual void on_quit_activate() = 0;
         virtual void on_cut_activate() = 0;
         virtual void on_copy_activate() = 0;
         virtual void on_paste_activate() = 0;
         virtual void on_delete_activate() = 0;
+        virtual void on_configure_activate() = 0;
         virtual void on_showextract_activate() = 0;
         virtual void on_groupresults_activate() = 0;
         virtual void on_clearresults_activate() = 0;



From fabricecolin at mail.berlios.de  Tue Jan  9 13:22:54 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 9 Jan 2007 13:22:54 +0100
Subject: [Pinot-svn] r680 - trunk/UI/GTK2/src
Message-ID: <200701091222.l09CMs7l010747@sheep.berlios.de>

Author: fabricecolin
Date: 2007-01-09 13:22:54 +0100 (Tue, 09 Jan 2007)
New Revision: 680

Modified:
   trunk/UI/GTK2/src/queryDialog_glade.cc
Log:
Renamed variable.


Modified: trunk/UI/GTK2/src/queryDialog_glade.cc
===================================================================
--- trunk/UI/GTK2/src/queryDialog_glade.cc	2007-01-09 12:22:18 UTC (rev 679)
+++ trunk/UI/GTK2/src/queryDialog_glade.cc	2007-01-09 12:22:54 UTC (rev 680)
@@ -1,9 +1,9 @@
-// generated 2006/10/14 10:43:04 SGT by fabrice at amra.dyndns.org.(none)
+// generated 2006/12/31 19:10:59 SGT by fabrice at thorgrim.dyndns.org.(none)
 // using glademm V2.12.1
 //
 // DO NOT EDIT THIS FILE ! It was created using
 // glade-- /home/fabrice/Projects/MetaSE/pinot/UI/GTK2/metase-gtk2.glade
-// for gtk 2.8.20 and gtkmm 2.8.8
+// for gtk 2.10.4 and gtkmm 2.10.5
 //
 // Please modify the corresponding derived classes in ./src/queryDialog.cc
 
@@ -68,7 +68,7 @@
    Gtk::Label *nameLabel = Gtk::manage(new class Gtk::Label(_("Name:")));
    nameEntry = Gtk::manage(new class Gtk::Entry());
    
-   Gtk::Table *table1 = Gtk::manage(new class Gtk::Table(2, 2, false));
+   Gtk::Table *nameTable = Gtk::manage(new class Gtk::Table(2, 2, false));
    Gtk::Label *filterLabel = Gtk::manage(new class Gtk::Label(_("New filter:")));
    filterCombobox = Gtk::manage(new class Gtk::ComboBox());
    
@@ -108,10 +108,10 @@
    nameEntry->set_max_length(0);
    nameEntry->set_has_frame(true);
    nameEntry->set_activates_default(false);
-   table1->set_row_spacings(0);
-   table1->set_col_spacings(0);
-   table1->attach(*nameLabel, 0, 1, 0, 1, Gtk::FILL, Gtk::AttachOptions(), 0, 0);
-   table1->attach(*nameEntry, 1, 2, 0, 1, Gtk::EXPAND|Gtk::FILL, Gtk::AttachOptions(), 4, 4);
+   nameTable->set_row_spacings(0);
+   nameTable->set_col_spacings(0);
+   nameTable->attach(*nameLabel, 0, 1, 0, 1, Gtk::FILL, Gtk::AttachOptions(), 0, 0);
+   nameTable->attach(*nameEntry, 1, 2, 0, 1, Gtk::EXPAND|Gtk::FILL, Gtk::AttachOptions(), 4, 4);
    filterLabel->set_alignment(0.5,0.5);
    filterLabel->set_padding(4,4);
    filterLabel->set_justify(Gtk::JUSTIFY_LEFT);
@@ -134,7 +134,6 @@
    queryTextview->set_indent(0);
    queryTextview->set_wrap_mode(Gtk::WRAP_WORD);
    queryTextview->set_justification(Gtk::JUSTIFY_LEFT);
-   queryTextview->set_accepts_tab(false);
    queryScrolledwindow->set_flags(Gtk::CAN_FOCUS);
    queryScrolledwindow->set_shadow_type(Gtk::SHADOW_IN);
    queryScrolledwindow->set_policy(Gtk::POLICY_AUTOMATIC, Gtk::POLICY_AUTOMATIC);
@@ -172,7 +171,7 @@
    tersmTable->attach(*labelNameCombobox, 1, 2, 1, 2, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
    tersmTable->attach(*resultsCountLabel, 0, 1, 0, 1, Gtk::FILL, Gtk::FILL, 4, 4);
    tersmTable->attach(*resultsCountSpinbutton, 1, 2, 0, 1, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
-   queryVbox->pack_start(*table1, Gtk::PACK_SHRINK, 0);
+   queryVbox->pack_start(*nameTable, Gtk::PACK_SHRINK, 0);
    queryVbox->pack_start(*queryHbox);
    queryVbox->pack_start(*queryFrame, Gtk::PACK_EXPAND_WIDGET, 4);
    queryVbox->pack_start(*tersmTable);
@@ -191,7 +190,7 @@
    queryOkbutton->show();
    nameLabel->show();
    nameEntry->show();
-   table1->show();
+   nameTable->show();
    filterLabel->show();
    filterCombobox->show();
    addFilterButton->show();



From fabricecolin at mail.berlios.de  Tue Jan  9 13:28:33 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 9 Jan 2007 13:28:33 +0100
Subject: [Pinot-svn] r681 - trunk/UI/GTK2/src
Message-ID: <200701091228.l09CSXbo011214@sheep.berlios.de>

Author: fabricecolin
Date: 2007-01-09 13:28:33 +0100 (Tue, 09 Jan 2007)
New Revision: 681

Modified:
   trunk/UI/GTK2/src/ServerThreads.cpp
   trunk/UI/GTK2/src/ServerThreads.h
Log:
DirectoryScannerThread::scanEntry() logs errors to the database so that they can
be shown by statisticsDialog.


Modified: trunk/UI/GTK2/src/ServerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/ServerThreads.cpp	2007-01-09 12:22:54 UTC (rev 680)
+++ trunk/UI/GTK2/src/ServerThreads.cpp	2007-01-09 12:28:33 UTC (rev 681)
@@ -35,7 +35,6 @@
 #include "Languages.h"
 #include "TimeConverter.h"
 #include "Url.h"
-#include "CrawlHistory.h"
 #include "XapianIndex.h"
 #include "XapianEngine.h"
 #include "config.h"
@@ -401,16 +400,19 @@
 	m_signalFileFound(docInfo, labelStr, false);
 }
 
-bool DirectoryScannerThread::scanEntry(const string &entryName)
+bool DirectoryScannerThread::scanEntry(const string &entryName, CrawlHistory &history)
 {
-	CrawlHistory history(PinotSettings::getInstance().m_historyDatabase);
 	CrawlHistory::CrawlStatus status = CrawlHistory::UNKNOWN;
 	time_t itemDate;
 	struct stat fileStat;
 	int statSuccess = 0;
+	bool scanSuccess = true;
 
 	if (entryName.empty() == true)
 	{
+#ifdef DEBUG
+		cout << "DirectoryScannerThread::scanEntry: no name" << endl;
+#endif
 		return false;
 	}
 
@@ -418,6 +420,9 @@
 	Url urlObj("file://" + entryName);
 	if (urlObj.getFile()[0] == '.')
 	{
+#ifdef DEBUG
+		cout << "DirectoryScannerThread::scanEntry: skipped dotfile " << urlObj.getFile() << endl;
+#endif
 		return false;
 	}
 
@@ -431,17 +436,23 @@
 		statSuccess = stat(entryName.c_str(), &fileStat);
 	}
 
+	// Is this item in the database already ?
+	bool itemExists = history.hasItem("file://" + entryName, status, itemDate);
+
 	if (statSuccess == -1)
 	{
-		return false;
+#ifdef DEBUG
+		cout << "DirectoryScannerThread::scanEntry: stat failed with error " << errno << " " << strerror(errno) << endl;
+#endif
+		scanSuccess = false;
 	}
-
-	bool itemExists = history.hasItem("file://" + entryName, status, itemDate);
-
 	// Is it a file or a directory ?
-	if (S_ISLNK(fileStat.st_mode))
+	else if (S_ISLNK(fileStat.st_mode))
 	{
 		// This won't happen when m_followSymLinks is true
+#ifdef DEBUG
+		cout << "DirectoryScannerThread::scanEntry: skipped symlink" << endl;
+#endif
 		return false;
 	}
 	else if (S_ISREG(fileStat.st_mode))
@@ -504,67 +515,90 @@
 
 			// Open the directory
 			DIR *pDir = opendir(entryName.c_str());
-			if (pDir == NULL)
+			if (pDir != NULL)
 			{
-				return false;
-			}
 #ifdef DEBUG
-			cout << "DirectoryScannerThread::scanEntry: entering " << entryName << endl;
+				cout << "DirectoryScannerThread::scanEntry: entering " << entryName << endl;
 #endif
+				if (m_pMonitor != NULL)
+				{
+					// Monitor first so that we don't miss events
+					m_pMonitor->addLocation(entryName, true);
+				}
 
-			if (m_pMonitor != NULL)
-			{
-				// Monitor first so that we don't miss events
-				m_pMonitor->addLocation(entryName, true);
-			}
-
-			// Iterate through this directory's entries
-			struct dirent *pDirEntry = readdir(pDir);
-			while ((m_done == false) &&
-				(pDirEntry != NULL))
-			{
-				char *pEntryName = pDirEntry->d_name;
-
-				// Skip . .. and dotfiles
-				if ((pEntryName != NULL) &&
-					(pEntryName[0] != '.'))
+				// Iterate through this directory's entries
+				struct dirent *pDirEntry = readdir(pDir);
+				while ((m_done == false) &&
+					(pDirEntry != NULL))
 				{
-					string subEntryName(entryName);
+					char *pEntryName = pDirEntry->d_name;
 
-					if (entryName[entryName.length() - 1] != '/')
+					// Skip . .. and dotfiles
+					if ((pEntryName != NULL) &&
+						(pEntryName[0] != '.'))
 					{
-						subEntryName += "/";
-					}
-					subEntryName += pEntryName;
+						string subEntryName(entryName);
 
-					// Scan this entry
-					if (scanEntry(subEntryName) == false)
-					{
+						if (entryName[entryName.length() - 1] != '/')
+						{
+							subEntryName += "/";
+						}
+						subEntryName += pEntryName;
+
+						// Scan this entry
+						if (scanEntry(subEntryName, history) == false)
+						{
 #ifdef DEBUG
-						cout << "DirectoryScannerThread::scanEntry: failed to open "
-							<< subEntryName << endl;
+							cout << "DirectoryScannerThread::scanEntry: failed to open "
+								<< subEntryName << endl;
 #endif
+						}
 					}
+
+					// Next entry
+					pDirEntry = readdir(pDir);
 				}
+#ifdef DEBUG
+				cout << "DirectoryScannerThread::scanEntry: done with " << entryName << endl;
+#endif
 
-				// Next entry
-				pDirEntry = readdir(pDir);
+				// Close the directory
+				closedir(pDir);
+				--m_currentLevel;
 			}
+			else
+			{
 #ifdef DEBUG
-			cout << "DirectoryScannerThread::scanEntry: done with " << entryName << endl;
+				cout << "DirectoryScannerThread::scanEntry: opendir failed with error " << errno << " " << strerror(errno) << endl;
 #endif
-
-			// Close the directory
-			closedir(pDir);
-			--m_currentLevel;
+				scanSuccess = false;
+			}
 		}
 	}
 	else
 	{
-		return false;
+#ifdef DEBUG
+		cout << "DirectoryScannerThread::scanEntry: unknown entry type" << endl;
+#endif
+		scanSuccess = false;
 	}
 
-	return true;
+	if (scanSuccess == false)
+	{
+		time_t timeNow = time(NULL);
+
+		// Record this error
+		if (itemExists == false)
+		{
+			history.insertItem("file://" + entryName, CrawlHistory::ERROR, m_sourceId, timeNow);
+		}
+		else
+		{
+			history.updateItem("file://" + entryName, CrawlHistory::ERROR, timeNow);
+		}
+	}
+
+	return scanSuccess;
 }
 
 void DirectoryScannerThread::doWork(void)
@@ -579,8 +613,10 @@
 
 	// Update this source's items status
 	history.updateItemsStatus(m_sourceId, CrawlHistory::CRAWLED, CrawlHistory::CRAWLING);
+	// Remove errors
+	history.deleteItems(m_sourceId, CrawlHistory::ERROR);
 
-	if (scanEntry(m_dirName) == false)
+	if (scanEntry(m_dirName, history) == false)
 	{
 		m_status = _("Couldn't open directory");
 		m_status += " ";
@@ -813,7 +849,7 @@
 	else if (dbus_message_is_method_call(m_pRequest, "de.berlios.Pinot", "GetStatistics") == TRUE)
 	{
 		CrawlHistory history(PinotSettings::getInstance().m_historyDatabase);
-		unsigned int crawledFilesCount = history.getItemsCount();
+		unsigned int crawledFilesCount = history.getItemsCount(CrawlHistory::CRAWLED);
 		unsigned int docsCount = index.getDocumentsCount();
 
 #ifdef DEBUG

Modified: trunk/UI/GTK2/src/ServerThreads.h
===================================================================
--- trunk/UI/GTK2/src/ServerThreads.h	2007-01-09 12:22:54 UTC (rev 680)
+++ trunk/UI/GTK2/src/ServerThreads.h	2007-01-09 12:28:33 UTC (rev 681)
@@ -33,6 +33,7 @@
 #include <glibmm/ustring.h>
 
 #include "DocumentInfo.h"
+#include "CrawlHistory.h"
 #include "MonitorInterface.h"
 #include "MonitorHandler.h"
 #include "WorkerThreads.h"
@@ -92,7 +93,7 @@
 		SigC::Signal3<void, const DocumentInfo&, const std::string&, bool> m_signalFileFound;
 
 		void foundFile(const DocumentInfo &docInfo);
-		bool scanEntry(const std::string &entryName);
+		bool scanEntry(const std::string &entryName, CrawlHistory &history);
 		virtual void doWork(void);
 
 	private:



From fabricecolin at mail.berlios.de  Tue Jan  9 13:30:03 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 9 Jan 2007 13:30:03 +0100
Subject: [Pinot-svn] r682 - trunk/UI/GTK2/src
Message-ID: <200701091230.l09CU3Dc011388@sheep.berlios.de>

Author: fabricecolin
Date: 2007-01-09 13:30:03 +0100 (Tue, 09 Jan 2007)
New Revision: 682

Modified:
   trunk/UI/GTK2/src/WorkerThreads.cpp
Log:
Removed long obsolete header.


Modified: trunk/UI/GTK2/src/WorkerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.cpp	2007-01-09 12:28:33 UTC (rev 681)
+++ trunk/UI/GTK2/src/WorkerThreads.cpp	2007-01-09 12:30:03 UTC (rev 682)
@@ -43,7 +43,6 @@
 #include "IndexedDocument.h"
 #include "DownloaderFactory.h"
 #include "SearchEngineFactory.h"
-#include "IndexFactory.h"
 #include "config.h"
 #include "NLS.h"
 #include "PinotSettings.h"



From fabricecolin at mail.berlios.de  Tue Jan  9 13:31:48 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 9 Jan 2007 13:31:48 +0100
Subject: [Pinot-svn] r683 - trunk/SQL
Message-ID: <200701091231.l09CVm4D011697@sheep.berlios.de>

Author: fabricecolin
Date: 2007-01-09 13:31:48 +0100 (Tue, 09 Jan 2007)
New Revision: 683

Modified:
   trunk/SQL/SQLiteBase.cpp
Log:
Removed DEBUG code.


Modified: trunk/SQL/SQLiteBase.cpp
===================================================================
--- trunk/SQL/SQLiteBase.cpp	2007-01-09 12:30:03 UTC (rev 682)
+++ trunk/SQL/SQLiteBase.cpp	2007-01-09 12:31:48 UTC (rev 683)
@@ -197,15 +197,6 @@
 		if (pDatabase != NULL)
 		{
 			cerr << "SQLiteBase::open: " << sqlite3_errmsg(pDatabase) << endl;
-#if 1
-			string cmdLine("echo SQLiteBase::open; ls -l /proc/");
-			char pidStr[64];
-
-			snprintf(pidStr, 64, "%u", getpid());
-			cmdLine += pidStr;
-			cmdLine += "/fd/";
-			system(cmdLine.c_str());
-#endif
 			close(pDatabase);
 			pDatabase = NULL;
 		}



From fabricecolin at mail.berlios.de  Tue Jan  9 13:33:34 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 9 Jan 2007 13:33:34 +0100
Subject: [Pinot-svn] r684 - trunk/UI/GTK2/src
Message-ID: <200701091233.l09CXYhD011877@sheep.berlios.de>

Author: fabricecolin
Date: 2007-01-09 13:33:34 +0100 (Tue, 09 Jan 2007)
New Revision: 684

Added:
   trunk/UI/GTK2/src/statisticsDialog.cc
   trunk/UI/GTK2/src/statisticsDialog.hh
   trunk/UI/GTK2/src/statisticsDialog_glade.cc
   trunk/UI/GTK2/src/statisticsDialog_glade.hh
Log:
Statistics window.


Added: trunk/UI/GTK2/src/statisticsDialog.cc
===================================================================
--- trunk/UI/GTK2/src/statisticsDialog.cc	2007-01-09 12:31:48 UTC (rev 683)
+++ trunk/UI/GTK2/src/statisticsDialog.cc	2007-01-09 12:33:34 UTC (rev 684)
@@ -0,0 +1,168 @@
+/*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU Library General Public License for more details.
+ *
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+ */
+
+#include <iostream>
+#include <string>
+#include <map>
+#include <set>
+#include <sigc++/slot.h>
+
+#include "config.h"
+#include "NLS.h"
+#include "Url.h"
+#include "CrawlHistory.h"
+#include "PinotSettings.h"
+#include "PinotUtils.h"
+#include "statisticsDialog.hh"
+
+using namespace std;
+using namespace Glib;
+using namespace Gtk;
+
+statisticsDialog::statisticsDialog()
+{
+	// Associate the columns model to the engines tree
+	m_refStore = TreeStore::create(m_statsColumns);
+	statisticsTreeview->set_model(m_refStore);
+
+	TreeViewColumn *pColumn = create_column(_("Statistics"), m_statsColumns.m_name, true, true, m_statsColumns.m_name);
+	if (pColumn != NULL)
+	{
+		statisticsTreeview->append_column(*manage(pColumn));
+	}
+
+	populate();
+}
+
+statisticsDialog::~statisticsDialog()
+{
+}
+
+void statisticsDialog::populate(void)
+{
+	CrawlHistory history(PinotSettings::getInstance().m_historyDatabase);
+	std::map<unsigned int, string> sources;
+	char countStr[64];
+	bool hasErrors = false;
+
+	TreeModel::iterator folderIter = m_refStore->append();
+	TreeModel::Row row = *folderIter;
+	row[m_statsColumns.m_name] = _("Indexes");
+
+	TreeModel::iterator statIter = m_refStore->append(folderIter->children());
+	row = *statIter;
+	row[m_statsColumns.m_name] = _("My Documents");
+	IndexInterface *pIndex = PinotSettings::getInstance().getIndex(PinotSettings::getInstance().m_docsIndexLocation);
+	if ((pIndex != NULL) &&
+		(pIndex->isGood() == true))
+	{
+		unsigned int docsCount = pIndex->getDocumentsCount();
+		snprintf(countStr, 64, "%u", docsCount);
+		TreeModel::iterator docsIter = m_refStore->append(statIter->children());
+		row = *docsIter;
+		row[m_statsColumns.m_name] = ustring(countStr) + " " + _("documents");
+	}
+
+	statIter = m_refStore->append(folderIter->children());
+	row = *statIter;
+	row[m_statsColumns.m_name] = _("My Web Pages");
+	pIndex = PinotSettings::getInstance().getIndex(PinotSettings::getInstance().m_daemonIndexLocation);
+	if ((pIndex != NULL) &&
+		(pIndex->isGood() == true))
+	{
+		unsigned int docsCount = pIndex->getDocumentsCount();
+		snprintf(countStr, 64, "%u", docsCount);
+		TreeModel::iterator docsIter = m_refStore->append(statIter->children());
+		row = *docsIter;
+		row[m_statsColumns.m_name] = ustring(countStr) + " " + _("documents");
+	}
+
+	folderIter = m_refStore->append();
+	row = *folderIter;
+	row[m_statsColumns.m_name] = _("Crawler");
+
+	// Show statistics
+	unsigned int crawledFilesCount = history.getItemsCount(CrawlHistory::CRAWLED);
+	snprintf(countStr, 64, "%u", crawledFilesCount);
+	statIter = m_refStore->append(folderIter->children());
+	row = *statIter;
+	row[m_statsColumns.m_name] = ustring(countStr) + " " + _("crawled files");
+	unsigned int crawlingFilesCount = history.getItemsCount(CrawlHistory::CRAWLING);
+	snprintf(countStr, 64, "%u", crawlingFilesCount);
+	statIter = m_refStore->append(folderIter->children());
+	row = *statIter;
+	row[m_statsColumns.m_name] = ustring(countStr) + " " + _("files being crawled");
+
+	TreeModel::iterator errIter = m_refStore->append(folderIter->children());
+	row = *errIter;
+	row[m_statsColumns.m_name] = _("Errors");
+
+	history.getSources(sources);
+	for (std::map<unsigned int, string>::iterator sourceIter = sources.begin();
+		sourceIter != sources.end(); ++sourceIter)
+	{
+		set<string> errors;
+
+		// Did any error occur on this source ?
+		unsigned int errorCount = history.getSourceItems(sourceIter->first, CrawlHistory::ERROR, errors);
+		if (errorCount > 0)
+		{
+			Url urlObj(sourceIter->second);
+			ustring sourceName(urlObj.getLocation());
+
+			// Add the source
+			TreeModel::iterator srcIter = m_refStore->append(errIter->children());
+			row = *srcIter;
+			if (urlObj.getFile().empty() == false)
+			{
+				sourceName += "/";
+				sourceName += urlObj.getFile();
+			}
+			row[m_statsColumns.m_name] = sourceName;
+
+			// List them
+			for (set<string>::const_iterator errorIter = errors.begin();
+				errorIter != errors.end(); ++errorIter)
+			{
+				statIter = m_refStore->append(srcIter->children());
+				row = *statIter;
+				row[m_statsColumns.m_name] = (*errorIter);
+			}
+
+			hasErrors = true;
+		}
+	}
+
+	if (hasErrors == false)
+	{
+		statIter = m_refStore->append(errIter->children());
+		row = *statIter;
+		row[m_statsColumns.m_name] = _("None");
+	}
+
+	statisticsTreeview->expand_all();
+
+	Adjustment *pAdjustement = statisticsScrolledwindow->get_hadjustment();
+#ifdef DEBUG
+	cout << "statisticsDialog: " << pAdjustement->get_value() << " "
+		<< pAdjustement->get_lower() << " " << pAdjustement->get_upper() << endl;
+#endif
+	pAdjustement->set_value(pAdjustement->get_upper());
+	statisticsScrolledwindow->set_hadjustment(pAdjustement);
+	resize((int )pAdjustement->get_upper() * 2, get_height());
+}

Added: trunk/UI/GTK2/src/statisticsDialog.hh
===================================================================
--- trunk/UI/GTK2/src/statisticsDialog.hh	2007-01-09 12:31:48 UTC (rev 683)
+++ trunk/UI/GTK2/src/statisticsDialog.hh	2007-01-09 12:33:34 UTC (rev 684)
@@ -0,0 +1,41 @@
+/*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU Library General Public License for more details.
+ *
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+ */
+
+#ifndef _STATISTICSDIALOG_HH
+#define _STATISTICSDIALOG_HH
+
+#include <glibmm/refptr.h>
+#include <gtkmm/treestore.h>
+
+#include "ModelColumns.h"
+#include "statisticsDialog_glade.hh"
+
+class statisticsDialog : public statisticsDialog_glade
+{
+public:
+	statisticsDialog();
+	virtual ~statisticsDialog();
+
+protected:
+	Glib::RefPtr<Gtk::TreeStore> m_refStore;
+	ComboModelColumns m_statsColumns;
+
+	void populate(void);
+
+};
+#endif

Added: trunk/UI/GTK2/src/statisticsDialog_glade.cc
===================================================================
--- trunk/UI/GTK2/src/statisticsDialog_glade.cc	2007-01-09 12:31:48 UTC (rev 683)
+++ trunk/UI/GTK2/src/statisticsDialog_glade.cc	2007-01-09 12:33:34 UTC (rev 684)
@@ -0,0 +1,103 @@
+// generated 2007/1/9 20:01:15 SGT by fabrice at amra.dyndns.org.(none)
+// using glademm V2.12.1
+//
+// DO NOT EDIT THIS FILE ! It was created using
+// glade-- /home/fabrice/Projects/MetaSE/pinot/UI/GTK2/metase-gtk2.glade
+// for gtk 2.10.4 and gtkmm 2.10.5
+//
+// Please modify the corresponding derived classes in ./src/statisticsDialog.cc
+
+
+#if defined __GNUC__ && __GNUC__ < 3
+#error This program will crash if compiled with g++ 2.x
+// see the dynamic_cast bug in the gtkmm FAQ
+#endif //
+#include "config.h"
+/*
+ * Standard gettext macros.
+ */
+#ifdef ENABLE_NLS
+#  include <libintl.h>
+#  undef _
+#  define _(String) dgettext (GETTEXT_PACKAGE, String)
+#  ifdef gettext_noop
+#    define N_(String) gettext_noop (String)
+#  else
+#    define N_(String) (String)
+#  endif
+#endif
+#include <gtkmmconfig.h>
+#if GTKMM_MAJOR_VERSION==2 && GTKMM_MINOR_VERSION>2
+#include <sigc++/compatibility.h>
+#include <sigc++/bind.h>
+#define GMM_GTKMM_22_24(a,b) b
+#else //gtkmm 2.2
+#define GMM_GTKMM_22_24(a,b) a
+#endif //
+#include "statisticsDialog_glade.hh"
+#include <gdk/gdkkeysyms.h>
+#include <gtkmm/accelgroup.h>
+#include <gtkmm/button.h>
+#include <gtkmm/buttonbox.h>
+#include <gtkmm/box.h>
+#ifndef ENABLE_NLS
+#  define textdomain(String) (String)
+#  define gettext(String) (String)
+#  define dgettext(Domain,Message) (Message)
+#  define dcgettext(Domain,Message,Type) (Message)
+#  define bindtextdomain(Domain,Directory) (Domain)
+#  define _(String) (String)
+#  define N_(String) (String)
+#endif
+
+
+statisticsDialog_glade::statisticsDialog_glade(
+)
+{  
+   
+   Gtk::Dialog *statisticsDialog = this;
+   gmm_data = new GlademmData(get_accel_group());
+   
+   Gtk::Button *closebutton1 = Gtk::manage(new class Gtk::Button(Gtk::StockID("gtk-close")));
+   statisticsTreeview = Gtk::manage(new class Gtk::TreeView());
+   statisticsScrolledwindow = Gtk::manage(new class Gtk::ScrolledWindow());
+   closebutton1->set_flags(Gtk::CAN_FOCUS);
+   closebutton1->set_flags(Gtk::CAN_DEFAULT);
+   closebutton1->set_relief(Gtk::RELIEF_NORMAL);
+   statisticsDialog->get_action_area()->property_layout_style().set_value(Gtk::BUTTONBOX_END);
+   statisticsTreeview->set_flags(Gtk::CAN_FOCUS);
+   statisticsTreeview->set_headers_visible(false);
+   statisticsTreeview->set_rules_hint(false);
+   statisticsTreeview->set_reorderable(false);
+   statisticsTreeview->set_enable_search(true);
+#if GTKMM_MAJOR_VERSION==2 && GTKMM_MINOR_VERSION>=5
+   statisticsTreeview->set_fixed_height_mode(false);
+   statisticsTreeview->set_hover_selection(false);
+   statisticsTreeview->set_hover_expand(false);
+#endif //
+   statisticsScrolledwindow->set_flags(Gtk::CAN_FOCUS);
+   statisticsScrolledwindow->set_border_width(4);
+   statisticsScrolledwindow->set_shadow_type(Gtk::SHADOW_NONE);
+   statisticsScrolledwindow->set_policy(Gtk::POLICY_AUTOMATIC, Gtk::POLICY_AUTOMATIC);
+   statisticsScrolledwindow->property_window_placement().set_value(Gtk::CORNER_TOP_LEFT);
+   statisticsScrolledwindow->add(*statisticsTreeview);
+   statisticsDialog->get_vbox()->set_homogeneous(false);
+   statisticsDialog->get_vbox()->set_spacing(0);
+   statisticsDialog->get_vbox()->pack_start(*statisticsScrolledwindow);
+   statisticsDialog->set_title(_("Statistics"));
+   statisticsDialog->set_default_size(150,350);
+   statisticsDialog->set_modal(false);
+   statisticsDialog->property_window_position().set_value(Gtk::WIN_POS_NONE);
+   statisticsDialog->set_resizable(true);
+   statisticsDialog->property_destroy_with_parent().set_value(false);
+   statisticsDialog->set_has_separator(true);
+   statisticsDialog->add_action_widget(*closebutton1, -7);
+   closebutton1->show();
+   statisticsTreeview->show();
+   statisticsScrolledwindow->show();
+   statisticsDialog->show();
+}
+
+statisticsDialog_glade::~statisticsDialog_glade()
+{  delete gmm_data;
+}

Added: trunk/UI/GTK2/src/statisticsDialog_glade.hh
===================================================================
--- trunk/UI/GTK2/src/statisticsDialog_glade.hh	2007-01-09 12:31:48 UTC (rev 683)
+++ trunk/UI/GTK2/src/statisticsDialog_glade.hh	2007-01-09 12:33:34 UTC (rev 684)
@@ -0,0 +1,50 @@
+// generated 2007/1/9 20:01:15 SGT by fabrice at amra.dyndns.org.(none)
+// using glademm V2.12.1
+//
+// DO NOT EDIT THIS FILE ! It was created using
+// glade-- /home/fabrice/Projects/MetaSE/pinot/UI/GTK2/metase-gtk2.glade
+// for gtk 2.10.4 and gtkmm 2.10.5
+//
+// Please modify the corresponding derived classes in ./src/statisticsDialog.hh and./src/statisticsDialog.cc
+
+#ifndef _STATISTICSDIALOG_GLADE_HH
+#  define _STATISTICSDIALOG_GLADE_HH
+
+
+#if !defined(GLADEMM_DATA)
+#define GLADEMM_DATA 
+#include <gtkmm/accelgroup.h>
+
+class GlademmData
+{  
+        
+        Glib::RefPtr<Gtk::AccelGroup> accgrp;
+public:
+        
+        GlademmData(Glib::RefPtr<Gtk::AccelGroup> ag) : accgrp(ag)
+        {  
+        }
+        
+        Glib::RefPtr<Gtk::AccelGroup>  getAccelGroup()
+        {  return accgrp;
+        }
+};
+#endif //GLADEMM_DATA
+
+#include <gtkmm/dialog.h>
+#include <gtkmm/treeview.h>
+#include <gtkmm/scrolledwindow.h>
+
+class statisticsDialog_glade : public Gtk::Dialog
+{  
+        
+        GlademmData *gmm_data;
+protected:
+        class Gtk::TreeView * statisticsTreeview;
+        class Gtk::ScrolledWindow * statisticsScrolledwindow;
+        
+        statisticsDialog_glade();
+        
+        ~statisticsDialog_glade();
+};
+#endif



From fabricecolin at mail.berlios.de  Tue Jan  9 13:35:04 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 9 Jan 2007 13:35:04 +0100
Subject: [Pinot-svn] r685 - in trunk: UI/GTK2/src po
Message-ID: <200701091235.l09CZ320012025@sheep.berlios.de>

Author: fabricecolin
Date: 2007-01-09 13:35:03 +0100 (Tue, 09 Jan 2007)
New Revision: 685

Modified:
   trunk/UI/GTK2/src/Makefile.am
   trunk/po/POTFILES.in
Log:
Compile and translate statisticsDialog.


Modified: trunk/UI/GTK2/src/Makefile.am
===================================================================
--- trunk/UI/GTK2/src/Makefile.am	2007-01-09 12:33:34 UTC (rev 684)
+++ trunk/UI/GTK2/src/Makefile.am	2007-01-09 12:35:03 UTC (rev 685)
@@ -1,18 +1,20 @@
 # Process this file with automake to produce Makefile.in
 
 noinst_HEADERS = \
+	importDialog_glade.hh \
+	importDialog.hh \
+	indexDialog_glade.hh \
+	indexDialog.hh \
 	mainWindow_glade.hh \
 	mainWindow.hh \
 	prefsDialog_glade.hh \
 	prefsDialog.hh \
+	propertiesDialog_glade.hh \
+	propertiesDialog.hh \
 	queryDialog_glade.hh \
 	queryDialog.hh \
-	importDialog_glade.hh \
-	importDialog.hh \
-	propertiesDialog_glade.hh \
-	propertiesDialog.hh \
-	indexDialog_glade.hh \
-	indexDialog.hh \
+	statisticsDialog_glade.hh \
+	statisticsDialog.hh \
 	DaemonState.h \
 	EnginesTree.h \
 	IndexPage.h \
@@ -29,18 +31,20 @@
 
 pinot_SOURCES = \
 	pinot.cc \
+	importDialog_glade.cc \
+	importDialog.cc \
+	indexDialog_glade.cc \
+	indexDialog.cc \
 	mainWindow_glade.cc \
 	mainWindow.cc \
 	prefsDialog_glade.cc \
 	prefsDialog.cc \
+	propertiesDialog_glade.cc \
+	propertiesDialog.cc \
 	queryDialog_glade.cc \
 	queryDialog.cc \
-	importDialog_glade.cc \
-	importDialog.cc \
-	propertiesDialog_glade.cc \
-	propertiesDialog.cc \
-	indexDialog_glade.cc \
-	indexDialog.cc \
+	statisticsDialog_glade.cc \
+	statisticsDialog.cc \
 	EnginesTree.cpp \
 	IndexPage.cpp \
 	IndexTree.cpp \

Modified: trunk/po/POTFILES.in
===================================================================
--- trunk/po/POTFILES.in	2007-01-09 12:33:34 UTC (rev 684)
+++ trunk/po/POTFILES.in	2007-01-09 12:35:03 UTC (rev 685)
@@ -24,4 +24,6 @@
 UI/GTK2/src/queryDialog.cc
 UI/GTK2/src/queryDialog_glade.cc
 UI/GTK2/src/ResultsTree.cpp
+UI/GTK2/src/statisticsDialog.cc
+UI/GTK2/src/statisticsDialog_glade.cc
 UI/GTK2/src/WorkerThreads.cpp



From fabricecolin at mail.berlios.de  Tue Jan  9 13:36:50 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 9 Jan 2007 13:36:50 +0100
Subject: [Pinot-svn] r686 - trunk/Utils
Message-ID: <200701091236.l09Cao0m012217@sheep.berlios.de>

Author: fabricecolin
Date: 2007-01-09 13:36:50 +0100 (Tue, 09 Jan 2007)
New Revision: 686

Modified:
   trunk/Utils/Url.cpp
Log:
Hacky fix for parsing of user and password.


Modified: trunk/Utils/Url.cpp
===================================================================
--- trunk/Utils/Url.cpp	2007-01-09 12:35:03 UTC (rev 685)
+++ trunk/Utils/Url.cpp	2007-01-09 12:36:50 UTC (rev 686)
@@ -120,13 +120,21 @@
 
 	if (hasHostName == true)
 	{
+		string userAndPassword;
+
 		// User and password
-		pos2 = url.find_first_of(":", pos1);
+		string::size_type atPos = url.find_first_of("@", pos1);
+		if (atPos != string::npos)
+		{
+			userAndPassword = url.substr(pos1, atPos - pos1);
+		}
+
+		pos2 = userAndPassword.find_first_of(":");
 		if (pos2 != string::npos)
 		{
 			bool isPartOfLocation = false;
 
-			string::size_type firstSlash = url.find_first_of("/", pos1);
+			string::size_type firstSlash = userAndPassword.find_first_of("/");
 			if (firstSlash != string::npos)
 			{
 				// The : is part of the location if it follows the /, eg like in this URL :
@@ -139,14 +147,14 @@
 
 			if (isPartOfLocation == false)
 			{
-				m_user = url.substr(pos1, pos2 - pos1);
+				m_user = userAndPassword.substr(0, pos2);
 				pos1 = pos2 + 1;
 
-				pos2 = url.find_first_of("@", pos1);
+				pos2 = userAndPassword.find_first_of("@", pos1);
 				if (pos2 != string::npos)
 				{
-					m_password = url.substr(pos1, pos2 - pos1);
-					pos1 = pos2 + 1;
+					m_password = userAndPassword.substr(pos2 + 1);
+					pos1 = atPos + 1;
 				}
 			}
 		}



From fabricecolin at mail.berlios.de  Tue Jan  9 14:25:53 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 9 Jan 2007 14:25:53 +0100
Subject: [Pinot-svn] r687 - trunk/po
Message-ID: <200701091325.l09DPro1019746@sheep.berlios.de>

Author: fabricecolin
Date: 2007-01-09 14:25:52 +0100 (Tue, 09 Jan 2007)
New Revision: 687

Added:
   trunk/po/pt_BR.po
   trunk/po/ru.po
Log:
Brazilian Portuguese and Russian translations by Leonardo Melo and Sergey
Vostrikov, respectively.


Added: trunk/po/pt_BR.po
===================================================================
--- trunk/po/pt_BR.po	2007-01-09 12:36:50 UTC (rev 686)
+++ trunk/po/pt_BR.po	2007-01-09 13:25:52 UTC (rev 687)
@@ -0,0 +1,781 @@
+# Portuguese (Brazil) translation for pinot
+# Copyright (c) 2006 Rosetta Contributors and Canonical Ltd 2006
+# This file is distributed under the same license as the pinot package.
+# FIRST AUTHOR <EMAIL at ADDRESS>, 2006.
+#
+#, fuzzy
+msgid ""
+msgstr ""
+"Project-Id-Version: pinot\n"
+"Report-Msgid-Bugs-To: \n"
+"POT-Creation-Date: 2007-01-09 21:19+0800\n"
+"PO-Revision-Date: 2006-12-05 11:43+0000\n"
+"Last-Translator: Leonardo Melo <leonardovazmelo at gmail.com>\n"
+"Language-Team: Portuguese (Brazil) <pt_BR at li.org>\n"
+"MIME-Version: 1.0\n"
+"Content-Type: text/plain; charset=UTF-8\n"
+"Content-Transfer-Encoding: 8bit\n"
+"X-Rosetta-Export-Date: 2006-12-10 07:28+0000\n"
+
+#: UI/GTK2/src/EnginesTree.cpp:70
+msgid "Search Engines"
+msgstr "Mecanismos de Pesquisa"
+
+#: UI/GTK2/src/EnginesTree.cpp:328
+msgid "Current User"
+msgstr "Usu?rio atual"
+
+#: UI/GTK2/src/EnginesTree.cpp:339 UI/GTK2/src/mainWindow.cc:323
+#: UI/GTK2/src/mainWindow.cc:326 UI/GTK2/src/mainWindow.cc:552
+#: UI/GTK2/src/mainWindow.cc:1206 UI/GTK2/src/mainWindow.cc:1249
+#: UI/GTK2/src/mainWindow.cc:1269 UI/GTK2/src/mainWindow.cc:1300
+#: UI/GTK2/src/mainWindow.cc:1880 UI/GTK2/src/PinotSettings.cpp:240
+#: UI/GTK2/src/PinotSettings.cpp:1230 UI/GTK2/src/PinotSettings.cpp:1286
+#: UI/GTK2/src/statisticsDialog.cc:83
+msgid "My Web Pages"
+msgstr "Minhas P?ginas Web"
+
+#: UI/GTK2/src/EnginesTree.cpp:340 UI/GTK2/src/mainWindow.cc:317
+#: UI/GTK2/src/mainWindow.cc:320 UI/GTK2/src/PinotSettings.cpp:241
+#: UI/GTK2/src/PinotSettings.cpp:1231 UI/GTK2/src/PinotSettings.cpp:1287
+#: UI/GTK2/src/statisticsDialog.cc:69
+msgid "My Documents"
+msgstr "Meus Documentos"
+
+#: UI/GTK2/src/importDialog.cc:82 UI/GTK2/src/queryDialog.cc:81
+#: UI/GTK2/src/statisticsDialog.cc:155
+msgid "None"
+msgstr "Nenhum"
+
+#: UI/GTK2/src/importDialog_glade.cc:67 UI/GTK2/src/indexDialog_glade.cc:71
+msgid "Location:"
+msgstr "Localiza??o:"
+
+#: UI/GTK2/src/importDialog_glade.cc:68
+#: UI/GTK2/src/propertiesDialog_glade.cc:65
+msgid "Title:"
+msgstr "T?tulo:"
+
+#: UI/GTK2/src/importDialog_glade.cc:71
+msgid "Apply label:"
+msgstr "Aplicar t?tulo:"
+
+#: UI/GTK2/src/importDialog_glade.cc:77
+msgid "Import"
+msgstr "Importar"
+
+#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:221
+msgid "Import URL"
+msgstr "Importar URL"
+
+#: UI/GTK2/src/indexDialog.cc:130
+msgid "Served by"
+msgstr ""
+
+#: UI/GTK2/src/indexDialog.cc:134
+#, fuzzy
+msgid "Local"
+msgstr "Localiza??o"
+
+#: UI/GTK2/src/indexDialog.cc:300
+msgid "Index location"
+msgstr "Localiza??o do ?ndice"
+
+#: UI/GTK2/src/indexDialog_glade.cc:65 UI/GTK2/src/queryDialog_glade.cc:68
+msgid "Name:"
+msgstr "Nome:"
+
+#: UI/GTK2/src/indexDialog_glade.cc:67
+msgid "..."
+msgstr "..."
+
+#: UI/GTK2/src/indexDialog_glade.cc:70
+msgid "Type:"
+msgstr "Tipo:"
+
+#: UI/GTK2/src/indexDialog_glade.cc:72
+msgid "Port:"
+msgstr "Porta:"
+
+#: UI/GTK2/src/indexDialog_glade.cc:79
+#, fuzzy
+msgid "Host name:"
+msgstr "Nome do host:"
+
+#: UI/GTK2/src/indexDialog_glade.cc:163
+msgid "External index"
+msgstr "?ndice externo"
+
+#: UI/GTK2/src/IndexTree.cpp:68 UI/GTK2/src/queryDialog.cc:112
+#: UI/GTK2/src/ResultsTree.cpp:126
+msgid "Title"
+msgstr "T?tulo"
+
+#: UI/GTK2/src/IndexTree.cpp:73 UI/GTK2/src/queryDialog.cc:115
+#: UI/GTK2/src/ResultsTree.cpp:136
+msgid "URL"
+msgstr "URL"
+
+#: UI/GTK2/src/IndexTree.cpp:78
+msgid "Timestamp"
+msgstr "hora"
+
+#: UI/GTK2/src/IndexPage.cpp:51
+msgid "Show Previous"
+msgstr "Mostrar anterior"
+
+#: UI/GTK2/src/IndexPage.cpp:57
+msgid "Show Next"
+msgstr "Mostrar pr?ximo"
+
+#: UI/GTK2/src/IndexPage.cpp:159 UI/GTK2/src/IndexPage.cpp:205
+msgid "All labels"
+msgstr "Todos t?tulos"
+
+#: UI/GTK2/src/mainWindow.cc:139
+msgid "Query Name"
+msgstr "Nome da consulta"
+
+#: UI/GTK2/src/mainWindow.cc:144
+msgid "Last Run"
+msgstr "?ltimo executado"
+
+#: UI/GTK2/src/mainWindow.cc:149
+msgid "Summary"
+msgstr "Resumo"
+
+#: UI/GTK2/src/mainWindow.cc:182
+msgid "Show all search engines"
+msgstr "Mostrar todos mecanimos de pesquisa"
+
+#: UI/GTK2/src/mainWindow.cc:183
+msgid "Add index"
+msgstr "Adicionar ?ndice"
+
+#: UI/GTK2/src/mainWindow.cc:184
+msgid "Remove index"
+msgstr "Remover ?ndice"
+
+#: UI/GTK2/src/mainWindow.cc:190
+msgid "Ready"
+msgstr "Pronto"
+
+#: UI/GTK2/src/mainWindow.cc:241
+msgid "N/A"
+msgstr "N/A"
+
+#: UI/GTK2/src/mainWindow.cc:256
+msgid "<undefined>"
+msgstr "<indefinido>"
+
+#: UI/GTK2/src/mainWindow.cc:475
+msgid "Result location is"
+msgstr "Local resultante ?"
+
+#: UI/GTK2/src/mainWindow.cc:562
+msgid "Document location is"
+msgstr "Localiza??o do documento ?"
+
+#: UI/GTK2/src/mainWindow.cc:885
+msgid "Showing"
+msgstr "Exibindo"
+
+#: UI/GTK2/src/mainWindow.cc:890
+msgid "of"
+msgstr "de"
+
+#: UI/GTK2/src/mainWindow.cc:895
+msgid "documents, starting at"
+msgstr "documentos, come?am no"
+
+#: UI/GTK2/src/mainWindow.cc:928
+msgid "Query"
+msgstr "Consulta"
+
+#: UI/GTK2/src/mainWindow.cc:932 UI/GTK2/src/mainWindow.cc:2949
+msgid "on"
+msgstr "no"
+
+#: UI/GTK2/src/mainWindow.cc:936
+msgid "ended"
+msgstr "finalizada"
+
+#: UI/GTK2/src/mainWindow.cc:1071
+msgid "More Like"
+msgstr "Mais pr?xima"
+
+#: UI/GTK2/src/mainWindow.cc:1132
+msgid "Updated label(s)"
+msgstr "T?tulo(s) atualizado(s)"
+
+#: UI/GTK2/src/mainWindow.cc:1216
+msgid "Updated document"
+msgstr "Documento atualizado"
+
+#: UI/GTK2/src/mainWindow.cc:1229
+msgid "Indexed"
+msgstr "Indexado"
+
+#: UI/GTK2/src/mainWindow.cc:1270
+msgid "Unindexed document(s)"
+msgstr "Documento(s) n?o indexidado(s)"
+
+#: UI/GTK2/src/mainWindow.cc:1311
+msgid "Updated document properties"
+msgstr "Propriedade de documentos atualizados"
+
+#: UI/GTK2/src/mainWindow.cc:1358
+msgid "Couldn't rename index, name"
+msgstr "N?o foi poss?vel renomear ?ndice, nome"
+
+#: UI/GTK2/src/mainWindow.cc:1362 UI/GTK2/src/mainWindow.cc:2273
+#: UI/GTK2/src/mainWindow.cc:2784
+msgid "is already in use"
+msgstr "j? est? em uso"
+
+#: UI/GTK2/src/mainWindow.cc:1375
+msgid "Couldn't rename index"
+msgstr "N?o foi poss?vel renomear ?ndice"
+
+#: UI/GTK2/src/mainWindow.cc:1388
+msgid "Edited index"
+msgstr "?ndice editado"
+
+#: UI/GTK2/src/mainWindow.cc:1758 UI/GTK2/src/mainWindow.cc:2443
+msgid "Live query"
+msgstr "Query ativa"
+
+#: UI/GTK2/src/mainWindow.cc:1784
+msgid "Couldn't find query"
+msgstr "N?o foi poss?vel encontrar consulta"
+
+#: UI/GTK2/src/mainWindow.cc:1828 UI/GTK2/src/mainWindow.cc:1924
+msgid "Please set a location for the index first"
+msgstr "Primeiro selecione local do ?ndice"
+
+#: UI/GTK2/src/mainWindow.cc:2003 UI/GTK2/src/WorkerThreads.cpp:670
+#: UI/GTK2/src/WorkerThreads.cpp:1517
+msgid "Index"
+msgstr "?ndice"
+
+#: UI/GTK2/src/mainWindow.cc:2007 UI/GTK2/src/WorkerThreads.cpp:674
+#: UI/GTK2/src/WorkerThreads.cpp:1521
+msgid "doesn't exist"
+msgstr "n?o existe"
+
+#: UI/GTK2/src/mainWindow.cc:2160
+msgid "Remove this document from the index ?"
+msgstr "Remover documento do ?ndice?"
+
+#: UI/GTK2/src/mainWindow.cc:2179
+msgid "Remove these documents from the index ?"
+msgstr "Remover documentos do ?ndice?"
+
+#: UI/GTK2/src/mainWindow.cc:2223
+msgid "A metasearch tool for the Free Desktop"
+msgstr "Um mecanismo de metabusca gr?tis para Desktop"
+
+#: UI/GTK2/src/mainWindow.cc:2224
+msgid "Search the Web and your documents !"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:2225
+msgid "(C) 2005 Fabrice Colin"
+msgstr "(C) 2005 Fabrice Colin"
+
+#: UI/GTK2/src/mainWindow.cc:2269
+msgid "Index name"
+msgstr "Nome do ?ndice"
+
+#: UI/GTK2/src/mainWindow.cc:2284
+msgid "Couldn't add index"
+msgstr "N?o foi poss?vel adicionar ?ndice"
+
+#: UI/GTK2/src/mainWindow.cc:2298
+msgid "Added new index"
+msgstr "Adicionar novo ?ndice"
+
+#: UI/GTK2/src/mainWindow.cc:2333
+msgid "Couldn't remove index"
+msgstr "N?o foi poss?vel remover ?ndice"
+
+#: UI/GTK2/src/mainWindow.cc:2598
+msgid "At least one task hasn't completed yet. Quit now ?"
+msgstr "Pelo menos uma tarefa n?o terminou ainda. Sair assim mesmo?"
+
+#: UI/GTK2/src/mainWindow.cc:2780
+msgid "Query name"
+msgstr "Nome da consulta"
+
+#: UI/GTK2/src/mainWindow.cc:2807
+msgid "Couldn't update query"
+msgstr "N?o foi poss?vel atualizar consulta"
+
+#: UI/GTK2/src/mainWindow.cc:2815
+msgid "Edited query"
+msgstr "Consulta editada"
+
+#: UI/GTK2/src/mainWindow.cc:2822
+msgid "Couldn't add query"
+msgstr "N?o foi poss?vel adicionar consulta"
+
+#: UI/GTK2/src/mainWindow.cc:2830
+msgid "Added new query"
+msgstr "Adicionar nova consulta"
+
+#: UI/GTK2/src/mainWindow.cc:2843
+msgid "Query is not set"
+msgstr "Consulta n?o foi atualizada"
+
+#: UI/GTK2/src/mainWindow.cc:2854
+msgid "No search engine selected"
+msgstr "Nenhum mecanismo de pesquisa selecionado"
+
+#: UI/GTK2/src/mainWindow.cc:2936
+msgid "Please set the Google API key first"
+msgstr "Primeiro informe a tecla para Google API"
+
+#: UI/GTK2/src/mainWindow.cc:2945
+msgid "Running query"
+msgstr "Executando consulta"
+
+#: UI/GTK2/src/mainWindow.cc:3117
+msgid "No default application defined for type"
+msgstr "Aplica??o associada ao tipo n?o definida"
+
+#: UI/GTK2/src/mainWindow_glade.cc:126
+msgid "Query:"
+msgstr "Consulta:"
+
+#: UI/GTK2/src/mainWindow_glade.cc:138
+msgid "Edit"
+msgstr "Editar"
+
+#: UI/GTK2/src/mainWindow_glade.cc:147
+msgid "Stored queries"
+msgstr "Consultas armazenadas"
+
+#: UI/GTK2/src/mainWindow_glade.cc:161 UI/GTK2/src/statisticsDialog.cc:43
+#: UI/GTK2/src/statisticsDialog_glade.cc:87
+msgid "Statistics"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow_glade.cc:188
+msgid "Search Engine"
+msgstr "Mecanismo de pesquisa"
+
+#: UI/GTK2/src/mainWindow_glade.cc:191
+msgid "Host Name"
+msgstr "Nome do host"
+
+#: UI/GTK2/src/mainWindow_glade.cc:194
+msgid "Show Extract"
+msgstr "Mostrar extrato"
+
+#: UI/GTK2/src/mainWindow_glade.cc:197
+msgid "Group By"
+msgstr "Agrupar por"
+
+#: UI/GTK2/src/mainWindow_glade.cc:200
+msgid "Clear List"
+msgstr "Limpar lista"
+
+#: UI/GTK2/src/mainWindow_glade.cc:206
+msgid "Vie_w"
+msgstr "Exibir"
+
+#: UI/GTK2/src/mainWindow_glade.cc:209
+msgid "View Cache"
+msgstr "Exibir cache"
+
+#: UI/GTK2/src/mainWindow_glade.cc:212
+msgid "More Like This"
+msgstr "Mais como este"
+
+#: UI/GTK2/src/mainWindow_glade.cc:215 UI/GTK2/src/mainWindow_glade.cc:251
+msgid "_Index"
+msgstr "_?ndice"
+
+#: UI/GTK2/src/mainWindow_glade.cc:218
+msgid "List Contents Of"
+msgstr "Mostrar conte?do de"
+
+#: UI/GTK2/src/mainWindow_glade.cc:227
+msgid "View"
+msgstr "Visualizar"
+
+#: UI/GTK2/src/mainWindow_glade.cc:230
+msgid "Update"
+msgstr "Atualizar"
+
+#: UI/GTK2/src/mainWindow_glade.cc:233
+msgid "Unindex"
+msgstr "Retirar do ?ndice"
+
+#: UI/GTK2/src/mainWindow_glade.cc:236
+#: UI/GTK2/src/propertiesDialog_glade.cc:146
+msgid "Properties"
+msgstr "Propriedades"
+
+#: UI/GTK2/src/mainWindow_glade.cc:239
+msgid "_About"
+msgstr "_Sobre"
+
+#: UI/GTK2/src/mainWindow_glade.cc:242
+msgid "_Session"
+msgstr "_Sess?o"
+
+#: UI/GTK2/src/mainWindow_glade.cc:245
+msgid "_Edit"
+msgstr "_Editar"
+
+#: UI/GTK2/src/mainWindow_glade.cc:248
+msgid "_Results"
+msgstr "_Resultados"
+
+#: UI/GTK2/src/mainWindow_glade.cc:254
+msgid "_Help"
+msgstr "_Ajuda"
+
+#: UI/GTK2/src/mainWindow_glade.cc:391
+msgid "Pinot"
+msgstr "Pino"
+
+#: UI/GTK2/src/pinot.cc:206 UI/GTK2/src/pinot-dbus-daemon.cc:273
+msgid "Unknown"
+msgstr "Desconhecido"
+
+#: UI/GTK2/src/pinot.cc:207 UI/GTK2/src/pinot-dbus-daemon.cc:274
+msgid "Danish"
+msgstr "Danish"
+
+#: UI/GTK2/src/pinot.cc:208 UI/GTK2/src/pinot-dbus-daemon.cc:275
+msgid "Dutch"
+msgstr "Dutch"
+
+#: UI/GTK2/src/pinot.cc:209 UI/GTK2/src/pinot-dbus-daemon.cc:276
+msgid "English"
+msgstr "English"
+
+#: UI/GTK2/src/pinot.cc:210 UI/GTK2/src/pinot-dbus-daemon.cc:277
+msgid "Finnish"
+msgstr "Terminar"
+
+#: UI/GTK2/src/pinot.cc:211 UI/GTK2/src/pinot-dbus-daemon.cc:278
+msgid "French"
+msgstr "French"
+
+#: UI/GTK2/src/pinot.cc:212 UI/GTK2/src/pinot-dbus-daemon.cc:279
+msgid "German"
+msgstr "German"
+
+#: UI/GTK2/src/pinot.cc:213 UI/GTK2/src/pinot-dbus-daemon.cc:280
+msgid "Italian"
+msgstr "Italian"
+
+#: UI/GTK2/src/pinot.cc:214 UI/GTK2/src/pinot-dbus-daemon.cc:281
+msgid "Norwegian"
+msgstr "Norwegian"
+
+#: UI/GTK2/src/pinot.cc:215 UI/GTK2/src/pinot-dbus-daemon.cc:282
+msgid "Portuguese"
+msgstr "Portugu?s"
+
+#: UI/GTK2/src/pinot.cc:216 UI/GTK2/src/pinot-dbus-daemon.cc:283
+msgid "Russian"
+msgstr "Russian"
+
+#: UI/GTK2/src/pinot.cc:217 UI/GTK2/src/pinot-dbus-daemon.cc:284
+msgid "Spanish"
+msgstr "Spanish"
+
+#: UI/GTK2/src/pinot.cc:218 UI/GTK2/src/pinot-dbus-daemon.cc:285
+msgid "Swedish"
+msgstr "Swedish"
+
+#: UI/GTK2/src/pinot.cc:242
+msgid "Couldn't open index"
+msgstr "N?o foi poss?vel abrir ?ndice"
+
+#: UI/GTK2/src/pinot.cc:258
+msgid "Couldn't create history database"
+msgstr "N?o foi poss?vel criar base de hist?rico"
+
+#: UI/GTK2/src/PinotSettings.cpp:246
+msgid "Important"
+msgstr "Importante"
+
+#: UI/GTK2/src/PinotSettings.cpp:247
+msgid "New"
+msgstr "Novo"
+
+#: UI/GTK2/src/PinotSettings.cpp:248
+msgid "Personal"
+msgstr "Pessoal"
+
+#: UI/GTK2/src/PinotSettings.cpp:1055
+msgid "Unclassified"
+msgstr "N?o classificado"
+
+#: UI/GTK2/src/prefsDialog.cc:67
+msgid "Name"
+msgstr "Nome"
+
+#: UI/GTK2/src/prefsDialog.cc:75
+msgid "Monitor"
+msgstr "Monitor"
+
+#: UI/GTK2/src/prefsDialog.cc:76 UI/GTK2/src/prefsDialog.cc:84
+msgid "Location"
+msgstr "Localiza??o"
+
+#: UI/GTK2/src/prefsDialog.cc:92
+msgid "Pattern"
+msgstr "Conjunto"
+
+#: UI/GTK2/src/prefsDialog.cc:426
+msgid "New Label"
+msgstr "Novo t?tulo"
+
+#: UI/GTK2/src/prefsDialog.cc:467
+msgid "Directory to index"
+msgstr "Diret?rio do ?ndice"
+
+#: UI/GTK2/src/prefsDialog.cc:525
+msgid "Mbox File Location"
+msgstr "Mbox localiza??o do arquivo"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:65
+#, fuzzy
+msgid "HTTP crawling:"
+msgstr "HTTP crawling:"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:66
+msgid "Google API key:"
+msgstr "Tecla para Google API:"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:68
+msgid "Ignore robots.txt and Robots META tag"
+msgstr "Ignorar robots.txt e Robots META tag"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:70
+msgid "New results:"
+msgstr "Novos resultados:"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:71
+msgid "Queries:"
+msgstr "Consultas:"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:72
+msgid "Enable search terms suggestion"
+msgstr "Habilitar sugest?o de termos"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:76
+msgid "General"
+msgstr "Geral"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:77
+#, fuzzy
+msgid "Labels are used to classify indexed documents:"
+msgstr "T?tulos utilizados para classificar documentos indexados:"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:82 UI/GTK2/src/prefsDialog_glade.cc:102
+#: UI/GTK2/src/prefsDialog_glade.cc:115 UI/GTK2/src/prefsDialog_glade.cc:128
+msgid "Add"
+msgstr "Adicionar"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:88
+msgid "Remove"
+msgstr "Remover"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:96
+msgid "Labels"
+msgstr "T?tulos"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:97
+#, fuzzy
+msgid "These directories will be indexed and optionally monitored for changes:"
+msgstr ""
+"Diret?rios que ser?o indexados e opcionalmente ter?o monitoradas suas "
+"altera??es:"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:110
+#, fuzzy
+msgid "Mail boxes of type mbox can be monitored and indexed:"
+msgstr "Caixas de entrada do tipo mbox podem ser monitoradas e indexadas:"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:123
+msgid "Specify any file pattern you wish to exclude from indexing:"
+msgstr ""
+"Especifique qualquer conjunto de arquivos que voc? deseja excluir da "
+"indexa??o:"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:137
+msgid "Indexing"
+msgstr "Indexando"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:411
+msgid "Preferences"
+msgstr "Prefer?ncias"
+
+#: UI/GTK2/src/propertiesDialog.cc:51 UI/GTK2/src/queryDialog.cc:127
+msgid "Label"
+msgstr "T?tulo"
+
+#: UI/GTK2/src/propertiesDialog.cc:64
+msgid "Per document"
+msgstr "Por documento"
+
+#: UI/GTK2/src/propertiesDialog_glade.cc:66
+msgid "Language:"
+msgstr "L?ngua:"
+
+#: UI/GTK2/src/propertiesDialog_glade.cc:67
+msgid "MIME type:"
+msgstr "Tipo MIME:"
+
+#: UI/GTK2/src/queryDialog.cc:103
+msgid "Host name"
+msgstr "Nome do host"
+
+#: UI/GTK2/src/queryDialog.cc:106
+msgid "File name"
+msgstr "Nome do arquivo"
+
+#: UI/GTK2/src/queryDialog.cc:109
+msgid "File extension"
+msgstr "Extens?o do arquivo"
+
+#: UI/GTK2/src/queryDialog.cc:118
+msgid "Directory"
+msgstr "Diret?rio"
+
+#: UI/GTK2/src/queryDialog.cc:121
+msgid "Language code"
+msgstr "C?digo da l?ngua"
+
+#: UI/GTK2/src/queryDialog.cc:124
+msgid "MIME type"
+msgstr "Tipo MIME"
+
+#: UI/GTK2/src/queryDialog_glade.cc:72
+msgid "New filter:"
+msgstr "Novo filtro:"
+
+#: UI/GTK2/src/queryDialog_glade.cc:81
+msgid "Query Text"
+msgstr "Texto da consulta"
+
+#: UI/GTK2/src/queryDialog_glade.cc:83
+msgid "Index all results with label"
+msgstr "Indexar todos resultados com t?tulo"
+
+#: UI/GTK2/src/queryDialog_glade.cc:86
+msgid "Number of results:"
+msgstr "N?mero de resultados:"
+
+#: UI/GTK2/src/queryDialog_glade.cc:181
+msgid "Query parameters"
+msgstr "Par?metros da consulta"
+
+#: UI/GTK2/src/ResultsTree.cpp:116
+msgid "Score"
+msgstr "Pontua??o"
+
+#: UI/GTK2/src/ResultsTree.cpp:165
+msgid "Extract"
+msgstr "Extrair"
+
+#: UI/GTK2/src/statisticsDialog.cc:65
+#, fuzzy
+msgid "Indexes"
+msgstr "Indexado"
+
+#: UI/GTK2/src/statisticsDialog.cc:78 UI/GTK2/src/statisticsDialog.cc:92
+#, fuzzy
+msgid "documents"
+msgstr "Meus Documentos"
+
+#: UI/GTK2/src/statisticsDialog.cc:97
+msgid "Crawler"
+msgstr ""
+
+#: UI/GTK2/src/statisticsDialog.cc:104
+msgid "crawled files"
+msgstr ""
+
+#: UI/GTK2/src/statisticsDialog.cc:109
+msgid "files being crawled"
+msgstr ""
+
+#: UI/GTK2/src/statisticsDialog.cc:113
+msgid "Errors"
+msgstr ""
+
+#: UI/GTK2/src/WorkerThreads.cpp:320
+msgid "Can't index mail here"
+msgstr "N?o foi poss?vel indexar mail aqui"
+
+#: UI/GTK2/src/WorkerThreads.cpp:341
+msgid "is already being indexed"
+msgstr "j? est? sendo indexado"
+
+#: UI/GTK2/src/WorkerThreads.cpp:351
+msgid "is blacklisted"
+msgstr "est? na lista negra"
+
+#: UI/GTK2/src/WorkerThreads.cpp:359 UI/GTK2/src/WorkerThreads.cpp:683
+#: UI/GTK2/src/WorkerThreads.cpp:960 UI/GTK2/src/WorkerThreads.cpp:969
+#: UI/GTK2/src/WorkerThreads.cpp:1138 UI/GTK2/src/WorkerThreads.cpp:1397
+#: UI/GTK2/src/WorkerThreads.cpp:1530
+msgid "Index error on"
+msgstr "Erro no ?ndice no"
+
+#: UI/GTK2/src/WorkerThreads.cpp:804 UI/GTK2/src/WorkerThreads.cpp:904
+msgid "Couldn't create search engine"
+msgstr "N?o foi poss?vel criar mecanismo de pesquisa"
+
+#: UI/GTK2/src/WorkerThreads.cpp:816 UI/GTK2/src/WorkerThreads.cpp:918
+msgid "Couldn't run query on search engine"
+msgstr "N?o foi poss?vel executar consulta no mecanismo de pesquisa"
+
+#: UI/GTK2/src/WorkerThreads.cpp:832
+msgid "No title"
+msgstr "Sem t?tulo"
+
+#: UI/GTK2/src/WorkerThreads.cpp:1048
+msgid "Couldn't obtain downloader for protocol"
+msgstr "N?o foi poss?vel obter fonte de download para o protocolo"
+
+#: UI/GTK2/src/WorkerThreads.cpp:1059
+msgid "Couldn't retrieve"
+msgstr "N?o foi poss?vel carregar"
+
+#: UI/GTK2/src/WorkerThreads.cpp:1160 UI/GTK2/src/WorkerThreads.cpp:1232
+msgid "Cannot index document type"
+msgstr "Imposs?vel indexar tipo de arquivo"
+
+#: UI/GTK2/src/WorkerThreads.cpp:1164 UI/GTK2/src/WorkerThreads.cpp:1236
+msgid "at"
+msgstr "no"
+
+#: UI/GTK2/src/WorkerThreads.cpp:1258
+#, fuzzy
+msgid "Couldn't tokenize"
+msgstr "N?o foi poss?vel TOKENIZE"
+
+#: UI/GTK2/src/WorkerThreads.cpp:1278
+msgid "Robots META tag forbids indexing"
+msgstr "Robots META tag n?o s?o permitidos no ?ndice"
+
+#: UI/GTK2/src/WorkerThreads.cpp:1327
+msgid "Couldn't index"
+msgstr "N?o foi poss?vel indexar"
+
+#: UI/GTK2/src/WorkerThreads.cpp:1408
+msgid "Couldn't unindex document(s)"
+msgstr "N?o foi poss?vel remover documento(s) do ?ndice"
+
+#: UI/GTK2/src/WorkerThreads.cpp:1542
+msgid "Couldn't update document"
+msgstr "N?o foi poss?vel atualizar documento"

Added: trunk/po/ru.po
===================================================================
--- trunk/po/ru.po	2007-01-09 12:36:50 UTC (rev 686)
+++ trunk/po/ru.po	2007-01-09 13:25:52 UTC (rev 687)
@@ -0,0 +1,773 @@
+# Russian translation for pinot
+# Copyright (c) 2006 Rosetta Contributors and Canonical Ltd 2006
+# This file is distributed under the same license as the pinot package.
+# FIRST AUTHOR <EMAIL at ADDRESS>, 2006.
+#
+#, fuzzy
+msgid ""
+msgstr ""
+"Project-Id-Version: pinot\n"
+"Report-Msgid-Bugs-To: \n"
+"POT-Creation-Date: 2007-01-09 21:19+0800\n"
+"PO-Revision-Date: 2006-12-29 11:28+0000\n"
+"Last-Translator: Sergey Vostrikov <s.vostrikov at gmail.com>\n"
+"Language-Team: Russian <ru at li.org>\n"
+"MIME-Version: 1.0\n"
+"Content-Type: text/plain; charset=UTF-8\n"
+"Content-Transfer-Encoding: 8bit\n"
+"X-Rosetta-Export-Date: 2007-01-09 13:08+0000\n"
+
+#: UI/GTK2/src/EnginesTree.cpp:70
+msgid "Search Engines"
+msgstr "????????? ??????"
+
+#: UI/GTK2/src/EnginesTree.cpp:328
+msgid "Current User"
+msgstr "??????? ????????????"
+
+#: UI/GTK2/src/EnginesTree.cpp:339 UI/GTK2/src/mainWindow.cc:323
+#: UI/GTK2/src/mainWindow.cc:326 UI/GTK2/src/mainWindow.cc:552
+#: UI/GTK2/src/mainWindow.cc:1206 UI/GTK2/src/mainWindow.cc:1249
+#: UI/GTK2/src/mainWindow.cc:1269 UI/GTK2/src/mainWindow.cc:1300
+#: UI/GTK2/src/mainWindow.cc:1880 UI/GTK2/src/PinotSettings.cpp:240
+#: UI/GTK2/src/PinotSettings.cpp:1230 UI/GTK2/src/PinotSettings.cpp:1286
+#: UI/GTK2/src/statisticsDialog.cc:83
+msgid "My Web Pages"
+msgstr "??? web-????????"
+
+#: UI/GTK2/src/EnginesTree.cpp:340 UI/GTK2/src/mainWindow.cc:317
+#: UI/GTK2/src/mainWindow.cc:320 UI/GTK2/src/PinotSettings.cpp:241
+#: UI/GTK2/src/PinotSettings.cpp:1231 UI/GTK2/src/PinotSettings.cpp:1287
+#: UI/GTK2/src/statisticsDialog.cc:69
+msgid "My Documents"
+msgstr "??? ?????????"
+
+#: UI/GTK2/src/importDialog.cc:82 UI/GTK2/src/queryDialog.cc:81
+#: UI/GTK2/src/statisticsDialog.cc:155
+msgid "None"
+msgstr "???"
+
+#: UI/GTK2/src/importDialog_glade.cc:67 UI/GTK2/src/indexDialog_glade.cc:71
+msgid "Location:"
+msgstr "??????????:"
+
+#: UI/GTK2/src/importDialog_glade.cc:68
+#: UI/GTK2/src/propertiesDialog_glade.cc:65
+msgid "Title:"
+msgstr "????????:"
+
+#: UI/GTK2/src/importDialog_glade.cc:71
+msgid "Apply label:"
+msgstr "????????? ?????:"
+
+#: UI/GTK2/src/importDialog_glade.cc:77
+msgid "Import"
+msgstr "??????"
+
+#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:221
+msgid "Import URL"
+msgstr "?????? URL"
+
+#: UI/GTK2/src/indexDialog.cc:130
+msgid "Served by"
+msgstr ""
+
+#: UI/GTK2/src/indexDialog.cc:134
+#, fuzzy
+msgid "Local"
+msgstr "?????????????????"
+
+#: UI/GTK2/src/indexDialog.cc:300
+msgid "Index location"
+msgstr "????????? ??????????????"
+
+#: UI/GTK2/src/indexDialog_glade.cc:65 UI/GTK2/src/queryDialog_glade.cc:68
+msgid "Name:"
+msgstr "???:"
+
+#: UI/GTK2/src/indexDialog_glade.cc:67
+msgid "..."
+msgstr "..."
+
+#: UI/GTK2/src/indexDialog_glade.cc:70
+msgid "Type:"
+msgstr "???:"
+
+#: UI/GTK2/src/indexDialog_glade.cc:72
+msgid "Port:"
+msgstr "????:"
+
+#: UI/GTK2/src/indexDialog_glade.cc:79
+#, fuzzy
+msgid "Host name:"
+msgstr "??? ????:"
+
+#: UI/GTK2/src/indexDialog_glade.cc:163
+msgid "External index"
+msgstr "??????? ??????"
+
+#: UI/GTK2/src/IndexTree.cpp:68 UI/GTK2/src/queryDialog.cc:112
+#: UI/GTK2/src/ResultsTree.cpp:126
+msgid "Title"
+msgstr "????????"
+
+#: UI/GTK2/src/IndexTree.cpp:73 UI/GTK2/src/queryDialog.cc:115
+#: UI/GTK2/src/ResultsTree.cpp:136
+msgid "URL"
+msgstr "URL"
+
+#: UI/GTK2/src/IndexTree.cpp:78
+msgid "Timestamp"
+msgstr "????"
+
+#: UI/GTK2/src/IndexPage.cpp:51
+msgid "Show Previous"
+msgstr "???????? ??????????"
+
+#: UI/GTK2/src/IndexPage.cpp:57
+msgid "Show Next"
+msgstr "???????? ?????????"
+
+#: UI/GTK2/src/IndexPage.cpp:159 UI/GTK2/src/IndexPage.cpp:205
+msgid "All labels"
+msgstr "??? ?????"
+
+#: UI/GTK2/src/mainWindow.cc:139
+msgid "Query Name"
+msgstr "??????"
+
+#: UI/GTK2/src/mainWindow.cc:144
+msgid "Last Run"
+msgstr "????????? ?????????"
+
+#: UI/GTK2/src/mainWindow.cc:149
+msgid "Summary"
+msgstr "??????"
+
+#: UI/GTK2/src/mainWindow.cc:182
+msgid "Show all search engines"
+msgstr "??? ????????? ???????"
+
+#: UI/GTK2/src/mainWindow.cc:183
+msgid "Add index"
+msgstr "???????? ??????"
+
+#: UI/GTK2/src/mainWindow.cc:184
+msgid "Remove index"
+msgstr "??????? ??????"
+
+#: UI/GTK2/src/mainWindow.cc:190
+msgid "Ready"
+msgstr "?????"
+
+#: UI/GTK2/src/mainWindow.cc:241
+msgid "N/A"
+msgstr "N/A"
+
+#: UI/GTK2/src/mainWindow.cc:256
+msgid "<undefined>"
+msgstr "<??????????????>"
+
+#: UI/GTK2/src/mainWindow.cc:475
+msgid "Result location is"
+msgstr "??????? ?"
+
+#: UI/GTK2/src/mainWindow.cc:562
+msgid "Document location is"
+msgstr "???????????? ?????????"
+
+#: UI/GTK2/src/mainWindow.cc:885
+msgid "Showing"
+msgstr "????????"
+
+#: UI/GTK2/src/mainWindow.cc:890
+msgid "of"
+msgstr "??"
+
+#: UI/GTK2/src/mainWindow.cc:895
+msgid "documents, starting at"
+msgstr "??????????, ??????? ?"
+
+#: UI/GTK2/src/mainWindow.cc:928
+msgid "Query"
+msgstr "??????"
+
+#: UI/GTK2/src/mainWindow.cc:932 UI/GTK2/src/mainWindow.cc:2949
+msgid "on"
+msgstr "??"
+
+#: UI/GTK2/src/mainWindow.cc:936
+msgid "ended"
+msgstr "?????????????"
+
+#: UI/GTK2/src/mainWindow.cc:1071
+msgid "More Like"
+msgstr "????? ????????"
+
+#: UI/GTK2/src/mainWindow.cc:1132
+msgid "Updated label(s)"
+msgstr "????????? ????? (??)"
+
+#: UI/GTK2/src/mainWindow.cc:1216
+msgid "Updated document"
+msgstr "??????????? ????????"
+
+#: UI/GTK2/src/mainWindow.cc:1229
+msgid "Indexed"
+msgstr "?????????????"
+
+#: UI/GTK2/src/mainWindow.cc:1270
+msgid "Unindexed document(s)"
+msgstr "?? ????????????? ??????????"
+
+#: UI/GTK2/src/mainWindow.cc:1311
+msgid "Updated document properties"
+msgstr "?????????? ??????? ?????????"
+
+#: UI/GTK2/src/mainWindow.cc:1358
+msgid "Couldn't rename index, name"
+msgstr "?????????? ????????????? ??????, ????????"
+
+#: UI/GTK2/src/mainWindow.cc:1362 UI/GTK2/src/mainWindow.cc:2273
+#: UI/GTK2/src/mainWindow.cc:2784
+msgid "is already in use"
+msgstr "??? ????????????"
+
+#: UI/GTK2/src/mainWindow.cc:1375
+msgid "Couldn't rename index"
+msgstr "?????????? ????????????? ??????"
+
+#: UI/GTK2/src/mainWindow.cc:1388
+msgid "Edited index"
+msgstr "?????????????? ???????"
+
+#: UI/GTK2/src/mainWindow.cc:1758 UI/GTK2/src/mainWindow.cc:2443
+msgid "Live query"
+msgstr "???????? ??????"
+
+#: UI/GTK2/src/mainWindow.cc:1784
+msgid "Couldn't find query"
+msgstr "?????????? ????? ??????"
+
+#: UI/GTK2/src/mainWindow.cc:1828 UI/GTK2/src/mainWindow.cc:1924
+msgid "Please set a location for the index first"
+msgstr "??????? ?????????????? ??????? ???????"
+
+#: UI/GTK2/src/mainWindow.cc:2003 UI/GTK2/src/WorkerThreads.cpp:670
+#: UI/GTK2/src/WorkerThreads.cpp:1517
+msgid "Index"
+msgstr "??????"
+
+#: UI/GTK2/src/mainWindow.cc:2007 UI/GTK2/src/WorkerThreads.cpp:674
+#: UI/GTK2/src/WorkerThreads.cpp:1521
+msgid "doesn't exist"
+msgstr "???"
+
+#: UI/GTK2/src/mainWindow.cc:2160
+msgid "Remove this document from the index ?"
+msgstr "??????? ???????? ?? ??????? ?"
+
+#: UI/GTK2/src/mainWindow.cc:2179
+msgid "Remove these documents from the index ?"
+msgstr "??????? ??? ????????? ?? ????????"
+
+#: UI/GTK2/src/mainWindow.cc:2223
+msgid "A metasearch tool for the Free Desktop"
+msgstr "?????????? ?????????? ??? ?????????? ????????"
+
+#: UI/GTK2/src/mainWindow.cc:2224
+msgid "Search the Web and your documents !"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow.cc:2225
+msgid "(C) 2005 Fabrice Colin"
+msgstr "(C) 2005 Fabrice Colin"
+
+#: UI/GTK2/src/mainWindow.cc:2269
+msgid "Index name"
+msgstr "???????? ???????"
+
+#: UI/GTK2/src/mainWindow.cc:2284
+msgid "Couldn't add index"
+msgstr "?????????? ???????? ??????"
+
+#: UI/GTK2/src/mainWindow.cc:2298
+msgid "Added new index"
+msgstr "???????? ????? ??????"
+
+#: UI/GTK2/src/mainWindow.cc:2333
+msgid "Couldn't remove index"
+msgstr "?????????? ??????? ??????"
+
+#: UI/GTK2/src/mainWindow.cc:2598
+msgid "At least one task hasn't completed yet. Quit now ?"
+msgstr "?? ??????? ???? ???? ?????? ??? ?? ?????????. ????? ???????"
+
+#: UI/GTK2/src/mainWindow.cc:2780
+msgid "Query name"
+msgstr "???????? ???????"
+
+#: UI/GTK2/src/mainWindow.cc:2807
+msgid "Couldn't update query"
+msgstr "?????????? ???????? ??????"
+
+#: UI/GTK2/src/mainWindow.cc:2815
+msgid "Edited query"
+msgstr "?????? ???????"
+
+#: UI/GTK2/src/mainWindow.cc:2822
+msgid "Couldn't add query"
+msgstr "?????????? ???????? ??????"
+
+#: UI/GTK2/src/mainWindow.cc:2830
+msgid "Added new query"
+msgstr "???????? ????? ??????"
+
+#: UI/GTK2/src/mainWindow.cc:2843
+msgid "Query is not set"
+msgstr "?????? ?? ??????????"
+
+#: UI/GTK2/src/mainWindow.cc:2854
+msgid "No search engine selected"
+msgstr "?? ???? ????????? ??????? ?? ???????"
+
+#: UI/GTK2/src/mainWindow.cc:2936
+msgid "Please set the Google API key first"
+msgstr "??????????, ??????? ????????????? ???? Google API"
+
+#: UI/GTK2/src/mainWindow.cc:2945
+msgid "Running query"
+msgstr "?????? ???????"
+
+#: UI/GTK2/src/mainWindow.cc:3117
+msgid "No default application defined for type"
+msgstr "?? ???? ?????????? ?? ????????? ?? ?????????? ??? ???? ??????????"
+
+#: UI/GTK2/src/mainWindow_glade.cc:126
+msgid "Query:"
+msgstr "??????:"
+
+#: UI/GTK2/src/mainWindow_glade.cc:138
+msgid "Edit"
+msgstr "??????"
+
+#: UI/GTK2/src/mainWindow_glade.cc:147
+msgid "Stored queries"
+msgstr "??????????? ???????"
+
+#: UI/GTK2/src/mainWindow_glade.cc:161 UI/GTK2/src/statisticsDialog.cc:43
+#: UI/GTK2/src/statisticsDialog_glade.cc:87
+msgid "Statistics"
+msgstr ""
+
+#: UI/GTK2/src/mainWindow_glade.cc:188
+msgid "Search Engine"
+msgstr "????????? ??????"
+
+#: UI/GTK2/src/mainWindow_glade.cc:191
+msgid "Host Name"
+msgstr "??? ?????"
+
+#: UI/GTK2/src/mainWindow_glade.cc:194
+msgid "Show Extract"
+msgstr "???????? ????????"
+
+#: UI/GTK2/src/mainWindow_glade.cc:197
+msgid "Group By"
+msgstr "???????????? ??"
+
+#: UI/GTK2/src/mainWindow_glade.cc:200
+msgid "Clear List"
+msgstr "???????? ??????"
+
+#: UI/GTK2/src/mainWindow_glade.cc:206
+msgid "Vie_w"
+msgstr "_???"
+
+#: UI/GTK2/src/mainWindow_glade.cc:209
+msgid "View Cache"
+msgstr "???????? ????"
+
+#: UI/GTK2/src/mainWindow_glade.cc:212
+msgid "More Like This"
+msgstr "????????? ?? ????"
+
+#: UI/GTK2/src/mainWindow_glade.cc:215 UI/GTK2/src/mainWindow_glade.cc:251
+msgid "_Index"
+msgstr "_??????"
+
+#: UI/GTK2/src/mainWindow_glade.cc:218
+msgid "List Contents Of"
+msgstr "?????? ???????????"
+
+#: UI/GTK2/src/mainWindow_glade.cc:227
+msgid "View"
+msgstr "???"
+
+#: UI/GTK2/src/mainWindow_glade.cc:230
+msgid "Update"
+msgstr "????????"
+
+#: UI/GTK2/src/mainWindow_glade.cc:233
+msgid "Unindex"
+msgstr "????? ??????"
+
+#: UI/GTK2/src/mainWindow_glade.cc:236
+#: UI/GTK2/src/propertiesDialog_glade.cc:146
+msgid "Properties"
+msgstr "????????"
+
+#: UI/GTK2/src/mainWindow_glade.cc:239
+msgid "_About"
+msgstr "? ?????????..."
+
+#: UI/GTK2/src/mainWindow_glade.cc:242
+msgid "_Session"
+msgstr "_??????"
+
+#: UI/GTK2/src/mainWindow_glade.cc:245
+msgid "_Edit"
+msgstr "_??????"
+
+#: UI/GTK2/src/mainWindow_glade.cc:248
+msgid "_Results"
+msgstr "_?????????"
+
+#: UI/GTK2/src/mainWindow_glade.cc:254
+msgid "_Help"
+msgstr "???????"
+
+#: UI/GTK2/src/mainWindow_glade.cc:391
+msgid "Pinot"
+msgstr "Pinot"
+
+#: UI/GTK2/src/pinot.cc:206 UI/GTK2/src/pinot-dbus-daemon.cc:273
+msgid "Unknown"
+msgstr "???????????"
+
+#: UI/GTK2/src/pinot.cc:207 UI/GTK2/src/pinot-dbus-daemon.cc:274
+msgid "Danish"
+msgstr "???????"
+
+#: UI/GTK2/src/pinot.cc:208 UI/GTK2/src/pinot-dbus-daemon.cc:275
+msgid "Dutch"
+msgstr "???????????"
+
+#: UI/GTK2/src/pinot.cc:209 UI/GTK2/src/pinot-dbus-daemon.cc:276
+msgid "English"
+msgstr "??????????"
+
+#: UI/GTK2/src/pinot.cc:210 UI/GTK2/src/pinot-dbus-daemon.cc:277
+msgid "Finnish"
+msgstr "???????"
+
+#: UI/GTK2/src/pinot.cc:211 UI/GTK2/src/pinot-dbus-daemon.cc:278
+msgid "French"
+msgstr "???????????"
+
+#: UI/GTK2/src/pinot.cc:212 UI/GTK2/src/pinot-dbus-daemon.cc:279
+msgid "German"
+msgstr "????????"
+
+#: UI/GTK2/src/pinot.cc:213 UI/GTK2/src/pinot-dbus-daemon.cc:280
+msgid "Italian"
+msgstr "???????????"
+
+#: UI/GTK2/src/pinot.cc:214 UI/GTK2/src/pinot-dbus-daemon.cc:281
+msgid "Norwegian"
+msgstr "??????????"
+
+#: UI/GTK2/src/pinot.cc:215 UI/GTK2/src/pinot-dbus-daemon.cc:282
+msgid "Portuguese"
+msgstr "?????????????"
+
+#: UI/GTK2/src/pinot.cc:216 UI/GTK2/src/pinot-dbus-daemon.cc:283
+msgid "Russian"
+msgstr "???????"
+
+#: UI/GTK2/src/pinot.cc:217 UI/GTK2/src/pinot-dbus-daemon.cc:284
+msgid "Spanish"
+msgstr "?????????"
+
+#: UI/GTK2/src/pinot.cc:218 UI/GTK2/src/pinot-dbus-daemon.cc:285
+msgid "Swedish"
+msgstr "????????"
+
+#: UI/GTK2/src/pinot.cc:242
+msgid "Couldn't open index"
+msgstr "?????????? ??????? ??????"
+
+#: UI/GTK2/src/pinot.cc:258
+msgid "Couldn't create history database"
+msgstr "?? ??????? ??????? ???? ?????? ???????"
+
+#: UI/GTK2/src/PinotSettings.cpp:246
+msgid "Important"
+msgstr "?????"
+
+#: UI/GTK2/src/PinotSettings.cpp:247
+msgid "New"
+msgstr "???????"
+
+#: UI/GTK2/src/PinotSettings.cpp:248
+msgid "Personal"
+msgstr "??????"
+
+#: UI/GTK2/src/PinotSettings.cpp:1055
+msgid "Unclassified"
+msgstr "??????????????"
+
+#: UI/GTK2/src/prefsDialog.cc:67
+msgid "Name"
+msgstr "???"
+
+#: UI/GTK2/src/prefsDialog.cc:75
+msgid "Monitor"
+msgstr "???????"
+
+#: UI/GTK2/src/prefsDialog.cc:76 UI/GTK2/src/prefsDialog.cc:84
+msgid "Location"
+msgstr "?????????????????"
+
+#: UI/GTK2/src/prefsDialog.cc:92
+msgid "Pattern"
+msgstr "???????"
+
+#: UI/GTK2/src/prefsDialog.cc:426
+msgid "New Label"
+msgstr "????? ?????"
+
+#: UI/GTK2/src/prefsDialog.cc:467
+msgid "Directory to index"
+msgstr "????? ??? ??????????????"
+
+#: UI/GTK2/src/prefsDialog.cc:525
+msgid "Mbox File Location"
+msgstr "?????????????? ????? Mbox"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:65
+msgid "HTTP crawling:"
+msgstr "HTTP ????????????:"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:66
+msgid "Google API key:"
+msgstr "???? Google API:"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:68
+msgid "Ignore robots.txt and Robots META tag"
+msgstr "???????????? robots.txt ? Robots META ???"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:70
+msgid "New results:"
+msgstr "????? ??????????:"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:71
+msgid "Queries:"
+msgstr "???????:"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:72
+msgid "Enable search terms suggestion"
+msgstr "????????? ?????? ???????????"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:76
+msgid "General"
+msgstr "?????"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:77
+msgid "Labels are used to classify indexed documents:"
+msgstr "?????, ???????????? ??? ????????????? ??????????, ????????????? :"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:82 UI/GTK2/src/prefsDialog_glade.cc:102
+#: UI/GTK2/src/prefsDialog_glade.cc:115 UI/GTK2/src/prefsDialog_glade.cc:128
+msgid "Add"
+msgstr "????????"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:88
+msgid "Remove"
+msgstr "???????"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:96
+msgid "Labels"
+msgstr "?????"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:97
+msgid "These directories will be indexed and optionally monitored for changes:"
+msgstr ""
+"??? ???????? ????? ??????????????? ? ????????????? ??? ???????? ?????????:"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:110
+msgid "Mail boxes of type mbox can be monitored and indexed:"
+msgstr "???????? ????? ???? mbox ????? ?????????????? ? ?????????????:"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:123
+msgid "Specify any file pattern you wish to exclude from indexing:"
+msgstr "??????? ????? ???? ?? ?????, ??????? ????? ????????? ?? ???????:"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:137
+msgid "Indexing"
+msgstr "??????????????"
+
+#: UI/GTK2/src/prefsDialog_glade.cc:411
+msgid "Preferences"
+msgstr "?????????"
+
+#: UI/GTK2/src/propertiesDialog.cc:51 UI/GTK2/src/queryDialog.cc:127
+msgid "Label"
+msgstr "?????"
+
+#: UI/GTK2/src/propertiesDialog.cc:64
+msgid "Per document"
+msgstr "??? ?????????? ?????????"
+
+#: UI/GTK2/src/propertiesDialog_glade.cc:66
+msgid "Language:"
+msgstr "????:"
+
+#: UI/GTK2/src/propertiesDialog_glade.cc:67
+msgid "MIME type:"
+msgstr "??? MIME:"
+
+#: UI/GTK2/src/queryDialog.cc:103
+msgid "Host name"
+msgstr "??? ????"
+
+#: UI/GTK2/src/queryDialog.cc:106
+msgid "File name"
+msgstr "????"
+
+#: UI/GTK2/src/queryDialog.cc:109
+msgid "File extension"
+msgstr "?????????? ?????"
+
+#: UI/GTK2/src/queryDialog.cc:118
+msgid "Directory"
+msgstr "???????? ??????????"
+
+#: UI/GTK2/src/queryDialog.cc:121
+msgid "Language code"
+msgstr "??? ?????"
+
+#: UI/GTK2/src/queryDialog.cc:124
+msgid "MIME type"
+msgstr "??? MIME"
+
+#: UI/GTK2/src/queryDialog_glade.cc:72
+msgid "New filter:"
+msgstr "????? ??????:"
+
+#: UI/GTK2/src/queryDialog_glade.cc:81
+msgid "Query Text"
+msgstr "????? ???????"
+
+#: UI/GTK2/src/queryDialog_glade.cc:83
+msgid "Index all results with label"
+msgstr "????????????? ??? ?????????? ? ??????"
+
+#: UI/GTK2/src/queryDialog_glade.cc:86
+msgid "Number of results:"
+msgstr "?????????? ???????????:"
+
+#: UI/GTK2/src/queryDialog_glade.cc:181
+msgid "Query parameters"
+msgstr "????????? ???????"
+
+#: UI/GTK2/src/ResultsTree.cpp:116
+msgid "Score"
+msgstr "????"
+
+#: UI/GTK2/src/ResultsTree.cpp:165
+msgid "Extract"
+msgstr "??????????"
+
+#: UI/GTK2/src/statisticsDialog.cc:65
+#, fuzzy
+msgid "Indexes"
+msgstr "?????????????"
+
+#: UI/GTK2/src/statisticsDialog.cc:78 UI/GTK2/src/statisticsDialog.cc:92
+#, fuzzy
+msgid "documents"
+msgstr "??? ?????????"
+
+#: UI/GTK2/src/statisticsDialog.cc:97
+msgid "Crawler"
+msgstr ""
+
+#: UI/GTK2/src/statisticsDialog.cc:104
+msgid "crawled files"
+msgstr ""
+
+#: UI/GTK2/src/statisticsDialog.cc:109
+msgid "files being crawled"
+msgstr ""
+
+#: UI/GTK2/src/statisticsDialog.cc:113
+msgid "Errors"
+msgstr ""
+
+#: UI/GTK2/src/WorkerThreads.cpp:320
+msgid "Can't index mail here"
+msgstr "?????? ????????????? ????? ?????"
+
+#: UI/GTK2/src/WorkerThreads.cpp:341
+msgid "is already being indexed"
+msgstr "??? ??????????????????"
+
+#: UI/GTK2/src/WorkerThreads.cpp:351
+msgid "is blacklisted"
+msgstr "??????????? ? ?????? ??????"
+
+#: UI/GTK2/src/WorkerThreads.cpp:359 UI/GTK2/src/WorkerThreads.cpp:683
+#: UI/GTK2/src/WorkerThreads.cpp:960 UI/GTK2/src/WorkerThreads.cpp:969
+#: UI/GTK2/src/WorkerThreads.cpp:1138 UI/GTK2/src/WorkerThreads.cpp:1397
+#: UI/GTK2/src/WorkerThreads.cpp:1530
+msgid "Index error on"
+msgstr "?????? ??????? ??"
+
+#: UI/GTK2/src/WorkerThreads.cpp:804 UI/GTK2/src/WorkerThreads.cpp:904
+msgid "Couldn't create search engine"
+msgstr "?? ??????? ??????? ????????? ???????"
+
+#: UI/GTK2/src/WorkerThreads.cpp:816 UI/GTK2/src/WorkerThreads.cpp:918
+msgid "Couldn't run query on search engine"
+msgstr "?? ??????? ????????? ?????? ? ????????? ???????"
+
+#: UI/GTK2/src/WorkerThreads.cpp:832
+msgid "No title"
+msgstr "??? ????????"
+
+#: UI/GTK2/src/WorkerThreads.cpp:1048
+msgid "Couldn't obtain downloader for protocol"
+msgstr "?? ??????? ???????? ????????? ??? ?????????"
+
+#: UI/GTK2/src/WorkerThreads.cpp:1059
+msgid "Couldn't retrieve"
+msgstr "?? ??????? ???????"
+
+#: UI/GTK2/src/WorkerThreads.cpp:1160 UI/GTK2/src/WorkerThreads.cpp:1232
+msgid "Cannot index document type"
+msgstr "?????????? ????????????? ?????? ??? ??????????"
+
+#: UI/GTK2/src/WorkerThreads.cpp:1164 UI/GTK2/src/WorkerThreads.cpp:1236
+msgid "at"
+msgstr "?"
+
+#: UI/GTK2/src/WorkerThreads.cpp:1258
+msgid "Couldn't tokenize"
+msgstr "?????????? ????????"
+
+#: UI/GTK2/src/WorkerThreads.cpp:1278
+msgid "Robots META tag forbids indexing"
+msgstr "META-???? ??????? ????????? ??????????????"
+
+#: UI/GTK2/src/WorkerThreads.cpp:1327
+msgid "Couldn't index"
+msgstr "?????????? ????????? ??????"
+
+#: UI/GTK2/src/WorkerThreads.cpp:1408
+msgid "Couldn't unindex document(s)"
+msgstr "?????????? ??????????????? ????????(?)"
+
+#: UI/GTK2/src/WorkerThreads.cpp:1542
+msgid "Couldn't update document"
+msgstr "?????????? ???????? ????????"



From fabricecolin at mail.berlios.de  Tue Jan  9 23:25:18 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 9 Jan 2007 23:25:18 +0100
Subject: [Pinot-svn] r688 - in trunk: UI/GTK2 UI/GTK2/src po
Message-ID: <200701092225.l09MPIcY003676@sheep.berlios.de>

Author: fabricecolin
Date: 2007-01-09 23:25:17 +0100 (Tue, 09 Jan 2007)
New Revision: 688

Modified:
   trunk/UI/GTK2/metase-gtk2.glade
   trunk/UI/GTK2/src/Makefile.am
   trunk/UI/GTK2/src/mainWindow.cc
   trunk/UI/GTK2/src/statisticsDialog.cc
   trunk/po/POTFILES.in
Log:
Still jet-lagged, I can't sleep, so I am checking in code to prompt the user for
a command to open documents of unsupported types ;-)
And a minor fix in statisticsDialog.


Modified: trunk/UI/GTK2/metase-gtk2.glade
===================================================================
--- trunk/UI/GTK2/metase-gtk2.glade	2007-01-09 13:25:52 UTC (rev 687)
+++ trunk/UI/GTK2/metase-gtk2.glade	2007-01-09 22:25:17 UTC (rev 688)
@@ -3629,4 +3629,148 @@
   </child>
 </widget>
 
+<widget class="GtkDialog" id="launcherDialog">
+  <property name="visible">True</property>
+  <property name="title" translatable="yes">Helper application</property>
+  <property name="type">GTK_WINDOW_TOPLEVEL</property>
+  <property name="window_position">GTK_WIN_POS_NONE</property>
+  <property name="modal">False</property>
+  <property name="resizable">True</property>
+  <property name="destroy_with_parent">False</property>
+  <property name="decorated">True</property>
+  <property name="skip_taskbar_hint">False</property>
+  <property name="skip_pager_hint">False</property>
+  <property name="type_hint">GDK_WINDOW_TYPE_HINT_DIALOG</property>
+  <property name="gravity">GDK_GRAVITY_NORTH_WEST</property>
+  <property name="focus_on_map">True</property>
+  <property name="urgency_hint">False</property>
+  <property name="has_separator">True</property>
+
+  <child internal-child="vbox">
+    <widget class="GtkVBox" id="dialog-vbox9">
+      <property name="visible">True</property>
+      <property name="homogeneous">False</property>
+      <property name="spacing">0</property>
+
+      <child internal-child="action_area">
+	<widget class="GtkHButtonBox" id="dialog-action_area9">
+	  <property name="visible">True</property>
+	  <property name="layout_style">GTK_BUTTONBOX_END</property>
+
+	  <child>
+	    <widget class="GtkButton" id="cancelbutton3">
+	      <property name="visible">True</property>
+	      <property name="can_default">True</property>
+	      <property name="can_focus">True</property>
+	      <property name="label">gtk-cancel</property>
+	      <property name="use_stock">True</property>
+	      <property name="relief">GTK_RELIEF_NORMAL</property>
+	      <property name="focus_on_click">True</property>
+	      <property name="response_id">-6</property>
+	    </widget>
+	  </child>
+
+	  <child>
+	    <widget class="GtkButton" id="okbutton1">
+	      <property name="visible">True</property>
+	      <property name="can_default">True</property>
+	      <property name="can_focus">True</property>
+	      <property name="label">gtk-ok</property>
+	      <property name="use_stock">True</property>
+	      <property name="relief">GTK_RELIEF_NORMAL</property>
+	      <property name="focus_on_click">True</property>
+	      <property name="response_id">-5</property>
+	    </widget>
+	  </child>
+	</widget>
+	<packing>
+	  <property name="padding">0</property>
+	  <property name="expand">False</property>
+	  <property name="fill">True</property>
+	  <property name="pack_type">GTK_PACK_END</property>
+	</packing>
+      </child>
+
+      <child>
+	<widget class="GtkVBox" id="launcherVbox">
+	  <property name="visible">True</property>
+	  <property name="homogeneous">False</property>
+	  <property name="spacing">0</property>
+
+	  <child>
+	    <widget class="GtkLabel" id="noLauncherLabel">
+	      <property name="visible">True</property>
+	      <property name="label" translatable="yes">There is no helper application defined for this document's type.
+Please enter the command to open this document.</property>
+	      <property name="use_underline">False</property>
+	      <property name="use_markup">False</property>
+	      <property name="justify">GTK_JUSTIFY_LEFT</property>
+	      <property name="wrap">False</property>
+	      <property name="selectable">False</property>
+	      <property name="xalign">0.5</property>
+	      <property name="yalign">0.5</property>
+	      <property name="xpad">0</property>
+	      <property name="ypad">0</property>
+	      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+	      <property name="width_chars">-1</property>
+	      <property name="single_line_mode">False</property>
+	      <property name="angle">0</property>
+	    </widget>
+	    <packing>
+	      <property name="padding">4</property>
+	      <property name="expand">True</property>
+	      <property name="fill">True</property>
+	    </packing>
+	  </child>
+
+	  <child>
+	    <widget class="GtkEntry" id="launcherEntry">
+	      <property agent="glademm" name="cxx_visibility">protected</property>
+	      <property name="visible">True</property>
+	      <property name="can_focus">True</property>
+	      <property name="editable">True</property>
+	      <property name="visibility">True</property>
+	      <property name="max_length">0</property>
+	      <property name="text" translatable="yes"></property>
+	      <property name="has_frame">True</property>
+	      <property name="invisible_char">?</property>
+	      <property name="activates_default">False</property>
+	    </widget>
+	    <packing>
+	      <property name="padding">4</property>
+	      <property name="expand">False</property>
+	      <property name="fill">True</property>
+	    </packing>
+	  </child>
+
+	  <child>
+	    <widget class="GtkCheckButton" id="rememberCheckbutton">
+	      <property agent="glademm" name="cxx_visibility">protected</property>
+	      <property name="visible">True</property>
+	      <property name="can_focus">True</property>
+	      <property name="label" translatable="yes">Use this command for other documents of the same type.</property>
+	      <property name="use_underline">True</property>
+	      <property name="relief">GTK_RELIEF_NORMAL</property>
+	      <property name="focus_on_click">True</property>
+	      <property name="active">True</property>
+	      <property name="inconsistent">False</property>
+	      <property name="draw_indicator">True</property>
+	    </widget>
+	    <packing>
+	      <property name="padding">4</property>
+	      <property name="expand">False</property>
+	      <property name="fill">True</property>
+	    </packing>
+	  </child>
+	</widget>
+	<packing>
+	  <property name="padding">0</property>
+	  <property name="expand">True</property>
+	  <property name="fill">True</property>
+	</packing>
+      </child>
+    </widget>
+  </child>
+</widget>
+
 </glade-interface>

Modified: trunk/UI/GTK2/src/Makefile.am
===================================================================
--- trunk/UI/GTK2/src/Makefile.am	2007-01-09 13:25:52 UTC (rev 687)
+++ trunk/UI/GTK2/src/Makefile.am	2007-01-09 22:25:17 UTC (rev 688)
@@ -5,6 +5,8 @@
 	importDialog.hh \
 	indexDialog_glade.hh \
 	indexDialog.hh \
+	launcherDialog.hh \
+	launcherDialog_glade.hh \
 	mainWindow_glade.hh \
 	mainWindow.hh \
 	prefsDialog_glade.hh \
@@ -35,6 +37,8 @@
 	importDialog.cc \
 	indexDialog_glade.cc \
 	indexDialog.cc \
+	launcherDialog.cc \
+	launcherDialog_glade.cc \
 	mainWindow_glade.cc \
 	mainWindow.cc \
 	prefsDialog_glade.cc \

Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2007-01-09 13:25:52 UTC (rev 687)
+++ trunk/UI/GTK2/src/mainWindow.cc	2007-01-09 22:25:17 UTC (rev 688)
@@ -51,6 +51,7 @@
 #include "mainWindow.hh"
 #include "importDialog.hh"
 #include "indexDialog.hh"
+#include "launcherDialog.hh"
 #include "propertiesDialog.hh"
 #include "prefsDialog.hh"
 #include "queryDialog.hh"
@@ -3114,11 +3115,30 @@
 
 				if (foundAction == false)
 				{
-					ustring statusText = _("No default application defined for type");
-					statusText += " ";
-					statusText += type;
-					set_status(statusText);
-					continue;
+					launcherDialog launcher(url);
+					bool remember = true;
+
+					launcher.show();
+					if (launcher.run() == RESPONSE_OK)
+					{
+
+						foundAction = launcher.getInput(action, remember);
+					}
+
+					if (foundAction == false)
+					{
+						ustring statusText = _("No default application defined for type");
+						statusText += " ";
+						statusText += type;
+						set_status(statusText);
+						continue;
+					}
+					else if (remember == true)
+					{
+						// Add this to MIMESCanner's list
+						MIMEScanner::addDefaultAction(type, action);
+						// FIXME: save this in the settings ?
+					}
 				}
 			}
 		}

Modified: trunk/UI/GTK2/src/statisticsDialog.cc
===================================================================
--- trunk/UI/GTK2/src/statisticsDialog.cc	2007-01-09 13:25:52 UTC (rev 687)
+++ trunk/UI/GTK2/src/statisticsDialog.cc	2007-01-09 22:25:17 UTC (rev 688)
@@ -34,7 +34,8 @@
 using namespace Glib;
 using namespace Gtk;
 
-statisticsDialog::statisticsDialog()
+statisticsDialog::statisticsDialog() :
+	statisticsDialog_glade()
 {
 	// Associate the columns model to the engines tree
 	m_refStore = TreeStore::create(m_statsColumns);

Modified: trunk/po/POTFILES.in
===================================================================
--- trunk/po/POTFILES.in	2007-01-09 13:25:52 UTC (rev 687)
+++ trunk/po/POTFILES.in	2007-01-09 22:25:17 UTC (rev 688)
@@ -7,6 +7,8 @@
 UI/GTK2/src/indexDialog_glade.cc
 UI/GTK2/src/IndexTree.cpp
 UI/GTK2/src/IndexPage.cpp
+UI/GTK2/src/launcherDialog.cc
+UI/GTK2/src/launcherDialog_glade.cc
 UI/GTK2/src/mainWindow.cc
 UI/GTK2/src/mainWindow_glade.cc
 UI/GTK2/src/ModelColumns.cpp



From fabricecolin at mail.berlios.de  Tue Jan  9 23:30:14 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Tue, 9 Jan 2007 23:30:14 +0100
Subject: [Pinot-svn] r689 - in trunk: UI/GTK2/src Utils
Message-ID: <200701092230.l09MUE8Q004220@sheep.berlios.de>

Author: fabricecolin
Date: 2007-01-09 23:30:12 +0100 (Tue, 09 Jan 2007)
New Revision: 689

Added:
   trunk/UI/GTK2/src/launcherDialog.cc
   trunk/UI/GTK2/src/launcherDialog.hh
   trunk/UI/GTK2/src/launcherDialog_glade.cc
   trunk/UI/GTK2/src/launcherDialog_glade.hh
Modified:
   trunk/Utils/MIMEScanner.cpp
   trunk/Utils/MIMEScanner.h
   trunk/Utils/Url.cpp
Log:
Follow-up to previous commit : actual GTKmm code, mods to MIMEScanner's list
of actions and Url prettification.


Added: trunk/UI/GTK2/src/launcherDialog.cc
===================================================================
--- trunk/UI/GTK2/src/launcherDialog.cc	2007-01-09 22:25:17 UTC (rev 688)
+++ trunk/UI/GTK2/src/launcherDialog.cc	2007-01-09 22:30:12 UTC (rev 689)
@@ -0,0 +1,58 @@
+/*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU Library General Public License for more details.
+ *
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+ */
+#include <iostream>
+#include <string>
+#include <glibmm/ustring.h>
+#include <sigc++/slot.h>
+
+#include "config.h"
+#include "NLS.h"
+#include "Url.h"
+#include "PinotSettings.h"
+#include "PinotUtils.h"
+#include "launcherDialog.hh"
+
+using namespace std;
+using namespace Glib;
+using namespace Gtk;
+
+launcherDialog::launcherDialog(const string &url) :
+	launcherDialog_glade()
+{
+	set_title(Url::prettifyUrl(url, 40));
+	launcherEntry->set_text("xdg-open %f");
+}
+
+launcherDialog::~launcherDialog()
+{
+}
+
+bool launcherDialog::getInput(MIMEAction &action, bool &remember)
+{
+	ustring cmdLine(launcherEntry->get_text());
+
+	if (cmdLine.empty() == false)
+	{
+		action = MIMEAction("UserApp", from_utf8(launcherEntry->get_text()));
+		remember = rememberCheckbutton->get_active();
+
+		return true;
+	}
+
+	return false;
+}

Added: trunk/UI/GTK2/src/launcherDialog.hh
===================================================================
--- trunk/UI/GTK2/src/launcherDialog.hh	2007-01-09 22:25:17 UTC (rev 688)
+++ trunk/UI/GTK2/src/launcherDialog.hh	2007-01-09 22:30:12 UTC (rev 689)
@@ -0,0 +1,36 @@
+/*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU Library General Public License for more details.
+ *
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+ */
+
+#ifndef _LAUNCHERDIALOG_HH
+#define _LAUNCHERDIALOG_HH
+
+#include <string>
+
+#include "MIMEScanner.h"
+#include "launcherDialog_glade.hh"
+
+class launcherDialog : public launcherDialog_glade
+{
+public:
+	launcherDialog(const std::string &url);
+	virtual ~launcherDialog();
+
+	bool getInput(MIMEAction &action, bool &remember);
+
+};
+#endif

Added: trunk/UI/GTK2/src/launcherDialog_glade.cc
===================================================================
--- trunk/UI/GTK2/src/launcherDialog_glade.cc	2007-01-09 22:25:17 UTC (rev 688)
+++ trunk/UI/GTK2/src/launcherDialog_glade.cc	2007-01-09 22:30:12 UTC (rev 689)
@@ -0,0 +1,118 @@
+// generated 2007/1/10 5:22:26 SGT by fabrice at amra.dyndns.org.(none)
+// using glademm V2.12.1
+//
+// DO NOT EDIT THIS FILE ! It was created using
+// glade-- /home/fabrice/Projects/MetaSE/pinot/UI/GTK2/metase-gtk2.glade
+// for gtk 2.10.4 and gtkmm 2.10.5
+//
+// Please modify the corresponding derived classes in ./src/launcherDialog.cc
+
+
+#if defined __GNUC__ && __GNUC__ < 3
+#error This program will crash if compiled with g++ 2.x
+// see the dynamic_cast bug in the gtkmm FAQ
+#endif //
+#include "config.h"
+/*
+ * Standard gettext macros.
+ */
+#ifdef ENABLE_NLS
+#  include <libintl.h>
+#  undef _
+#  define _(String) dgettext (GETTEXT_PACKAGE, String)
+#  ifdef gettext_noop
+#    define N_(String) gettext_noop (String)
+#  else
+#    define N_(String) (String)
+#  endif
+#endif
+#include <gtkmmconfig.h>
+#if GTKMM_MAJOR_VERSION==2 && GTKMM_MINOR_VERSION>2
+#include <sigc++/compatibility.h>
+#include <sigc++/bind.h>
+#define GMM_GTKMM_22_24(a,b) b
+#else //gtkmm 2.2
+#define GMM_GTKMM_22_24(a,b) a
+#endif //
+#include "launcherDialog_glade.hh"
+#include <gdk/gdkkeysyms.h>
+#include <gtkmm/accelgroup.h>
+#include <gtkmm/button.h>
+#include <gtkmm/buttonbox.h>
+#include <gtkmm/label.h>
+#include <gtkmm/box.h>
+#ifndef ENABLE_NLS
+#  define textdomain(String) (String)
+#  define gettext(String) (String)
+#  define dgettext(Domain,Message) (Message)
+#  define dcgettext(Domain,Message,Type) (Message)
+#  define bindtextdomain(Domain,Directory) (Domain)
+#  define _(String) (String)
+#  define N_(String) (String)
+#endif
+
+
+launcherDialog_glade::launcherDialog_glade(
+)
+{  
+   
+   Gtk::Dialog *launcherDialog = this;
+   gmm_data = new GlademmData(get_accel_group());
+   
+   Gtk::Button *cancelbutton3 = Gtk::manage(new class Gtk::Button(Gtk::StockID("gtk-cancel")));
+   Gtk::Button *okbutton1 = Gtk::manage(new class Gtk::Button(Gtk::StockID("gtk-ok")));
+   Gtk::Label *noLauncherLabel = Gtk::manage(new class Gtk::Label(_("There is no helper application defined for this document's type.\n"
+		"Please enter the command to open this document.")));
+   launcherEntry = Gtk::manage(new class Gtk::Entry());
+   rememberCheckbutton = Gtk::manage(new class Gtk::CheckButton(_("Use this command for other documents of the same type.")));
+   
+   Gtk::VBox *launcherVbox = Gtk::manage(new class Gtk::VBox(false, 0));
+   cancelbutton3->set_flags(Gtk::CAN_FOCUS);
+   cancelbutton3->set_flags(Gtk::CAN_DEFAULT);
+   cancelbutton3->set_relief(Gtk::RELIEF_NORMAL);
+   okbutton1->set_flags(Gtk::CAN_FOCUS);
+   okbutton1->set_flags(Gtk::CAN_DEFAULT);
+   okbutton1->set_relief(Gtk::RELIEF_NORMAL);
+   launcherDialog->get_action_area()->property_layout_style().set_value(Gtk::BUTTONBOX_END);
+   noLauncherLabel->set_alignment(0.5,0.5);
+   noLauncherLabel->set_padding(0,0);
+   noLauncherLabel->set_justify(Gtk::JUSTIFY_LEFT);
+   noLauncherLabel->set_line_wrap(false);
+   noLauncherLabel->set_use_markup(false);
+   noLauncherLabel->set_selectable(false);
+   launcherEntry->set_flags(Gtk::CAN_FOCUS);
+   launcherEntry->set_visibility(true);
+   launcherEntry->set_editable(true);
+   launcherEntry->set_max_length(0);
+   launcherEntry->set_has_frame(true);
+   launcherEntry->set_activates_default(false);
+   rememberCheckbutton->set_flags(Gtk::CAN_FOCUS);
+   rememberCheckbutton->set_relief(Gtk::RELIEF_NORMAL);
+   rememberCheckbutton->set_mode(true);
+   rememberCheckbutton->set_active(true);
+   launcherVbox->pack_start(*noLauncherLabel, Gtk::PACK_EXPAND_WIDGET, 4);
+   launcherVbox->pack_start(*launcherEntry, Gtk::PACK_SHRINK, 4);
+   launcherVbox->pack_start(*rememberCheckbutton, Gtk::PACK_SHRINK, 4);
+   launcherDialog->get_vbox()->set_homogeneous(false);
+   launcherDialog->get_vbox()->set_spacing(0);
+   launcherDialog->get_vbox()->pack_start(*launcherVbox);
+   launcherDialog->set_title(_("Helper application"));
+   launcherDialog->set_modal(false);
+   launcherDialog->property_window_position().set_value(Gtk::WIN_POS_NONE);
+   launcherDialog->set_resizable(true);
+   launcherDialog->property_destroy_with_parent().set_value(false);
+   launcherDialog->set_has_separator(true);
+   launcherDialog->add_action_widget(*cancelbutton3, -6);
+   launcherDialog->add_action_widget(*okbutton1, -5);
+   cancelbutton3->show();
+   okbutton1->show();
+   noLauncherLabel->show();
+   launcherEntry->show();
+   rememberCheckbutton->show();
+   launcherVbox->show();
+   launcherDialog->show();
+}
+
+launcherDialog_glade::~launcherDialog_glade()
+{  delete gmm_data;
+}

Added: trunk/UI/GTK2/src/launcherDialog_glade.hh
===================================================================
--- trunk/UI/GTK2/src/launcherDialog_glade.hh	2007-01-09 22:25:17 UTC (rev 688)
+++ trunk/UI/GTK2/src/launcherDialog_glade.hh	2007-01-09 22:30:12 UTC (rev 689)
@@ -0,0 +1,50 @@
+// generated 2007/1/10 5:22:26 SGT by fabrice at amra.dyndns.org.(none)
+// using glademm V2.12.1
+//
+// DO NOT EDIT THIS FILE ! It was created using
+// glade-- /home/fabrice/Projects/MetaSE/pinot/UI/GTK2/metase-gtk2.glade
+// for gtk 2.10.4 and gtkmm 2.10.5
+//
+// Please modify the corresponding derived classes in ./src/launcherDialog.hh and./src/launcherDialog.cc
+
+#ifndef _LAUNCHERDIALOG_GLADE_HH
+#  define _LAUNCHERDIALOG_GLADE_HH
+
+
+#if !defined(GLADEMM_DATA)
+#define GLADEMM_DATA 
+#include <gtkmm/accelgroup.h>
+
+class GlademmData
+{  
+        
+        Glib::RefPtr<Gtk::AccelGroup> accgrp;
+public:
+        
+        GlademmData(Glib::RefPtr<Gtk::AccelGroup> ag) : accgrp(ag)
+        {  
+        }
+        
+        Glib::RefPtr<Gtk::AccelGroup>  getAccelGroup()
+        {  return accgrp;
+        }
+};
+#endif //GLADEMM_DATA
+
+#include <gtkmm/dialog.h>
+#include <gtkmm/entry.h>
+#include <gtkmm/checkbutton.h>
+
+class launcherDialog_glade : public Gtk::Dialog
+{  
+        
+        GlademmData *gmm_data;
+protected:
+        class Gtk::Entry * launcherEntry;
+        class Gtk::CheckButton * rememberCheckbutton;
+        
+        launcherDialog_glade();
+        
+        ~launcherDialog_glade();
+};
+#endif

Modified: trunk/Utils/MIMEScanner.cpp
===================================================================
--- trunk/Utils/MIMEScanner.cpp	2007-01-09 22:25:17 UTC (rev 688)
+++ trunk/Utils/MIMEScanner.cpp	2007-01-09 22:30:12 UTC (rev 689)
@@ -75,6 +75,15 @@
 {
 }
 
+MIMEAction::MIMEAction(const string &name, const string &cmdLine) :
+	m_multipleArgs(false),
+	m_localOnly(true),
+	m_name(name),
+	m_exec(cmdLine)
+{
+	parseExec();
+}
+
 MIMEAction::MIMEAction(const string &desktopFile) :
 	m_multipleArgs(false),
 	m_localOnly(true),
@@ -96,22 +105,7 @@
 			m_icon = getKeyValue(pDesktopFile, "Icon");
 			m_device = getKeyValue(pDesktopFile, "Device");
 
-			// Does it support multiple arguments ?
-			if ((m_exec.find("%U") != string::npos) ||
-				(m_exec.find("%F") != string::npos) ||
-				(m_exec.find("%D") != string::npos) ||
-				(m_exec.find("%N") != string::npos))
-			{
-				// Yes, it does
-				m_multipleArgs = true;
-			}
-			// What about URLs as parameters ?
-			if ((m_exec.find("%u") != string::npos) ||
-				(m_exec.find("%U") != string::npos))
-			{
-				// It does, therefore it's not exclusively local
-				m_localOnly = false;
-			}
+			parseExec();
 		}
 		else
 		{
@@ -153,6 +147,26 @@
 	return *this;
 }
 
+void MIMEAction::parseExec(void)
+{
+	// Does it support multiple arguments ?
+	if ((m_exec.find("%U") != string::npos) ||
+		(m_exec.find("%F") != string::npos) ||
+		(m_exec.find("%D") != string::npos) ||
+		(m_exec.find("%N") != string::npos))
+	{
+		// Yes, it does
+		m_multipleArgs = true;
+	}
+	// What about URLs as parameters ?
+	if ((m_exec.find("%u") != string::npos) ||
+		(m_exec.find("%U") != string::npos))
+	{
+		// It does, therefore it's not exclusively local
+		m_localOnly = false;
+	}
+}
+
 map<string, MIMEAction> MIMEScanner::m_defaultActions;
 
 pthread_mutex_t MIMEScanner::m_mutex = PTHREAD_MUTEX_INITIALIZER;
@@ -343,6 +357,12 @@
 	return mimeType;
 }
 
+/// Adds a user-defined action for the given type.
+bool MIMEScanner::addDefaultAction(const std::string &mimeType, const MIMEAction &typeAction)
+{
+	m_defaultActions.insert(pair<string, MIMEAction>(mimeType, typeAction));
+}
+
 /// Determines the default action for the given type.
 bool MIMEScanner::getDefaultAction(const string &mimeType, MIMEAction &typeAction)
 {

Modified: trunk/Utils/MIMEScanner.h
===================================================================
--- trunk/Utils/MIMEScanner.h	2007-01-09 22:25:17 UTC (rev 688)
+++ trunk/Utils/MIMEScanner.h	2007-01-09 22:30:12 UTC (rev 689)
@@ -33,12 +33,15 @@
 {
 	public:
 		MIMEAction();
+		MIMEAction(const std::string &name, const std::string &cmdLine);
 		MIMEAction(const std::string &desktopFile);
 		MIMEAction(const MIMEAction &other);
 		virtual ~MIMEAction();
 
 		MIMEAction &operator=(const MIMEAction &other);
 
+		void parseExec(void);
+
 		bool m_multipleArgs;
 		bool m_localOnly;
 		std::string m_name;
@@ -69,6 +72,9 @@
 		/// Finds out the given URL's MIME type.
 		static std::string scanUrl(const Url &urlObj);
 
+		/// Adds a user-defined action for the given type.
+		static bool addDefaultAction(const std::string &mimeType, const MIMEAction &typeAction);
+
 		/// Determines the default action for the given type.
 		static bool getDefaultAction(const std::string &mimeType, MIMEAction &typeAction);
 

Modified: trunk/Utils/Url.cpp
===================================================================
--- trunk/Utils/Url.cpp	2007-01-09 22:25:17 UTC (rev 688)
+++ trunk/Utils/Url.cpp	2007-01-09 22:30:12 UTC (rev 689)
@@ -290,7 +290,10 @@
 		prettyUrl += ":";
 		prettyUrl += password;
 	}
-	prettyUrl += host;
+	if (urlObj.isLocal() == false)
+	{
+		prettyUrl += host;
+	}
 	prettyUrl += "/";
 
 	if (url.length() <= diffLen)
@@ -298,7 +301,10 @@
 		// That's the bare minimum...
 		prettyUrl = protocol;
 		prettyUrl += "://";
-		prettyUrl += host;
+		if (urlObj.isLocal() == false)
+		{
+			prettyUrl += host;
+		}
 		prettyUrl += "/...";
 	}
 	else if (location.length() > diffLen + 3)



From fabricecolin at mail.berlios.de  Wed Jan 10 00:57:15 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Wed, 10 Jan 2007 00:57:15 +0100
Subject: [Pinot-svn] r690 - in trunk: UI/GTK2/src Utils
Message-ID: <200701092357.l09NvF3B027450@sheep.berlios.de>

Author: fabricecolin
Date: 2007-01-10 00:57:14 +0100 (Wed, 10 Jan 2007)
New Revision: 690

Modified:
   trunk/UI/GTK2/src/WorkerThreads.cpp
   trunk/UI/GTK2/src/mainWindow.cc
   trunk/Utils/MIMEScanner.cpp
   trunk/Utils/MIMEScanner.h
Log:
Minor mods.


Modified: trunk/UI/GTK2/src/WorkerThreads.cpp
===================================================================
--- trunk/UI/GTK2/src/WorkerThreads.cpp	2007-01-09 22:30:12 UTC (rev 689)
+++ trunk/UI/GTK2/src/WorkerThreads.cpp	2007-01-09 23:57:14 UTC (rev 690)
@@ -1149,7 +1149,7 @@
 	// If coming from a crawl, this will be empty
 	if (m_docInfo.getType().empty() == true)
 	{
-		m_docInfo.setType(MIMEScanner::scanFile(m_docInfo.getLocation()));
+		m_docInfo.setType(MIMEScanner::scanUrl(thisUrl));
 	}
 
 	if (TokenizerFactory::isSupportedType(m_docInfo.getType(), dataNeeds) == false)

Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2007-01-09 22:30:12 UTC (rev 689)
+++ trunk/UI/GTK2/src/mainWindow.cc	2007-01-09 23:57:14 UTC (rev 690)
@@ -3136,6 +3136,9 @@
 					else if (remember == true)
 					{
 						// Add this to MIMESCanner's list
+#ifdef DEBUG
+						cout << "mainWindow::view_documents: adding user-defined action for type " << type << endl;
+#endif
 						MIMEScanner::addDefaultAction(type, action);
 						// FIXME: save this in the settings ?
 					}

Modified: trunk/Utils/MIMEScanner.cpp
===================================================================
--- trunk/Utils/MIMEScanner.cpp	2007-01-09 22:30:12 UTC (rev 689)
+++ trunk/Utils/MIMEScanner.cpp	2007-01-09 23:57:14 UTC (rev 690)
@@ -358,7 +358,7 @@
 }
 
 /// Adds a user-defined action for the given type.
-bool MIMEScanner::addDefaultAction(const std::string &mimeType, const MIMEAction &typeAction)
+void MIMEScanner::addDefaultAction(const std::string &mimeType, const MIMEAction &typeAction)
 {
 	m_defaultActions.insert(pair<string, MIMEAction>(mimeType, typeAction));
 }

Modified: trunk/Utils/MIMEScanner.h
===================================================================
--- trunk/Utils/MIMEScanner.h	2007-01-09 22:30:12 UTC (rev 689)
+++ trunk/Utils/MIMEScanner.h	2007-01-09 23:57:14 UTC (rev 690)
@@ -73,7 +73,7 @@
 		static std::string scanUrl(const Url &urlObj);
 
 		/// Adds a user-defined action for the given type.
-		static bool addDefaultAction(const std::string &mimeType, const MIMEAction &typeAction);
+		static void addDefaultAction(const std::string &mimeType, const MIMEAction &typeAction);
 
 		/// Determines the default action for the given type.
 		static bool getDefaultAction(const std::string &mimeType, MIMEAction &typeAction);



From fabricecolin at mail.berlios.de  Thu Jan 11 16:35:49 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Thu, 11 Jan 2007 16:35:49 +0100
Subject: [Pinot-svn] r691 - in trunk: Search UI/GTK2 UI/GTK2/src po
Message-ID: <200701111535.l0BFZno8025079@sheep.berlios.de>

Author: fabricecolin
Date: 2007-01-11 16:35:47 +0100 (Thu, 11 Jan 2007)
New Revision: 691

Added:
   trunk/UI/GTK2/src/dateDialog.cc
   trunk/UI/GTK2/src/dateDialog.hh
   trunk/UI/GTK2/src/dateDialog_glade.cc
   trunk/UI/GTK2/src/dateDialog_glade.hh
Modified:
   trunk/Search/QueryProperties.cpp
   trunk/Search/QueryProperties.h
   trunk/UI/GTK2/metase-gtk2.glade
   trunk/UI/GTK2/src/Makefile.am
   trunk/UI/GTK2/src/PinotSettings.cpp
   trunk/UI/GTK2/src/queryDialog.cc
   trunk/UI/GTK2/src/queryDialog.hh
   trunk/UI/GTK2/src/queryDialog_glade.cc
   trunk/UI/GTK2/src/queryDialog_glade.hh
   trunk/po/POTFILES.in
Log:
Date range filtering, UI-only part.
Added dateDialog, a date picker box, and extended queryDialog.


Modified: trunk/Search/QueryProperties.cpp
===================================================================
--- trunk/Search/QueryProperties.cpp	2007-01-09 23:57:14 UTC (rev 690)
+++ trunk/Search/QueryProperties.cpp	2007-01-11 15:35:47 UTC (rev 691)
@@ -27,6 +27,14 @@
 
 QueryProperties::QueryProperties() :
 	m_resultsCount(10),
+	m_enableMinDate(false),
+	m_minDay(0),
+	m_minMonth(0),
+	m_minYear(0),
+	m_enableMaxDate(false),
+	m_maxDay(0),
+	m_maxMonth(0),
+	m_maxYear(0),
 	m_indexResults(false)
 {
 }
@@ -35,6 +43,14 @@
 	m_name(name),
 	m_freeQuery(freeQuery),
 	m_resultsCount(10),
+	m_enableMinDate(false),
+	m_minDay(0),
+	m_minMonth(0),
+	m_minYear(0),
+	m_enableMaxDate(false),
+	m_maxDay(0),
+	m_maxMonth(0),
+	m_maxYear(0),
 	m_indexResults(false)
 {
 	removeFilters();
@@ -48,6 +64,14 @@
 	m_hostFilter(other.m_hostFilter),
 	m_fileFilter(other.m_fileFilter),
 	m_resultsCount(other.m_resultsCount),
+	m_enableMinDate(other.m_enableMinDate),
+	m_minDay(other.m_minDay),
+	m_minMonth(other.m_minMonth),
+	m_minYear(other.m_minYear),
+	m_enableMaxDate(other.m_enableMaxDate),
+	m_maxDay(other.m_maxDay),
+	m_maxMonth(other.m_maxMonth),
+	m_maxYear(other.m_maxYear),
 	m_indexResults(other.m_indexResults),
 	m_labelName(other.m_labelName)
 {
@@ -68,6 +92,14 @@
 		m_hostFilter = other.m_hostFilter;
 		m_fileFilter = other.m_fileFilter;
 		m_resultsCount = other.m_resultsCount;
+		m_enableMinDate = other.m_enableMinDate;
+		m_minDay = other.m_minDay;
+		m_minMonth = other.m_minMonth;
+		m_minYear = other.m_minYear;
+		m_enableMaxDate = other.m_enableMaxDate;
+		m_maxDay = other.m_maxDay;
+		m_maxMonth = other.m_maxMonth;
+		m_maxYear = other.m_maxYear;
 		m_indexResults = other.m_indexResults;
 		m_labelName = other.m_labelName;
 	}
@@ -215,6 +247,44 @@
 	return m_resultsCount;
 }
 
+/// Sets the minimum date.
+void QueryProperties::setMinimumDate(bool enable, unsigned int day, unsigned int month, unsigned int year)
+{
+	m_enableMinDate = enable;
+	m_minDay = day;
+	m_minMonth = month;
+	m_minYear = year;
+}
+
+/// Gets the minimum date.
+bool QueryProperties::getMinimumDate(unsigned int &day, unsigned int &month, unsigned int &year) const
+{
+	day = m_minDay;
+	month = m_minMonth;
+	year = m_minYear;
+
+	return m_enableMinDate;
+}
+
+/// Sets the maximum date.
+void QueryProperties::setMaximumDate(bool enable, unsigned int day, unsigned int month, unsigned int year)
+{
+	m_enableMaxDate = enable;
+	m_maxDay = day;
+	m_maxMonth = month;
+	m_maxYear = year;
+}
+
+/// Gets the maximum date.
+bool QueryProperties::getMaximumDate(unsigned int &day, unsigned int &month, unsigned int &year) const
+{
+	day = m_maxDay;
+	month = m_maxMonth;
+	year = m_maxYear;
+
+	return m_enableMaxDate;
+}
+
 /// Sets whether results should be indexed.
 void QueryProperties::setIndexResults(bool index)
 {

Modified: trunk/Search/QueryProperties.h
===================================================================
--- trunk/Search/QueryProperties.h	2007-01-09 23:57:14 UTC (rev 690)
+++ trunk/Search/QueryProperties.h	2007-01-11 15:35:47 UTC (rev 691)
@@ -64,6 +64,16 @@
 		/// Gets the maximum number of results.
 		unsigned int getMaximumResultsCount(void) const;
 
+		/// Sets the minimum date.
+		void setMinimumDate(bool enable, unsigned int day, unsigned int month, unsigned int year);
+		/// Gets the minimum date.
+		bool getMinimumDate(unsigned int &day, unsigned int &month, unsigned int &year) const;
+
+		/// Sets the maximum date.
+		void setMaximumDate(bool enable, unsigned int day, unsigned int month, unsigned int year);
+		/// Gets the maximum date.
+		bool getMaximumDate(unsigned int &day, unsigned int &month, unsigned int &year) const;
+
 		/// Sets whether results should be indexed.
 		void setIndexResults(bool index);
 		/// Gets whether results should be indexed
@@ -85,6 +95,14 @@
 		string m_hostFilter;
 		string m_fileFilter;
 		unsigned int m_resultsCount;
+		bool m_enableMinDate;
+		unsigned int m_minDay;
+		unsigned int m_minMonth;
+		unsigned int m_minYear;
+		bool m_enableMaxDate;
+		unsigned int m_maxDay;
+		unsigned int m_maxMonth;
+		unsigned int m_maxYear;
 		bool m_indexResults;
 		string m_labelName;
 

Modified: trunk/UI/GTK2/metase-gtk2.glade
===================================================================
--- trunk/UI/GTK2/metase-gtk2.glade	2007-01-09 23:57:14 UTC (rev 690)
+++ trunk/UI/GTK2/metase-gtk2.glade	2007-01-11 15:35:47 UTC (rev 691)
@@ -2407,13 +2407,9 @@
 	  </child>
 
 	  <child>
-	    <placeholder/>
-	  </child>
-
-	  <child>
-	    <widget class="GtkTable" id="tersmTable">
+	    <widget class="GtkTable" id="actionsTable">
 	      <property name="visible">True</property>
-	      <property name="n_rows">2</property>
+	      <property name="n_rows">4</property>
 	      <property name="n_columns">2</property>
 	      <property name="homogeneous">False</property>
 	      <property name="row_spacing">0</property>
@@ -2424,7 +2420,7 @@
 		  <property agent="glademm" name="cxx_visibility">protected</property>
 		  <property name="visible">True</property>
 		  <property name="can_focus">True</property>
-		  <property name="label" translatable="yes">Index all results with label</property>
+		  <property name="label" translatable="yes">Index results with label</property>
 		  <property name="use_underline">True</property>
 		  <property name="relief">GTK_RELIEF_NORMAL</property>
 		  <property name="focus_on_click">True</property>
@@ -2435,8 +2431,8 @@
 		<packing>
 		  <property name="left_attach">0</property>
 		  <property name="right_attach">1</property>
-		  <property name="top_attach">1</property>
-		  <property name="bottom_attach">2</property>
+		  <property name="top_attach">3</property>
+		  <property name="bottom_attach">4</property>
 		  <property name="x_padding">4</property>
 		  <property name="y_padding">4</property>
 		  <property name="x_options">fill</property>
@@ -2454,8 +2450,8 @@
 		<packing>
 		  <property name="left_attach">1</property>
 		  <property name="right_attach">2</property>
-		  <property name="top_attach">1</property>
-		  <property name="bottom_attach">2</property>
+		  <property name="top_attach">3</property>
+		  <property name="bottom_attach">4</property>
 		  <property name="x_padding">4</property>
 		  <property name="y_padding">4</property>
 		  <property name="y_options">fill</property>
@@ -2515,6 +2511,102 @@
 		  <property name="y_options">fill</property>
 		</packing>
 	      </child>
+
+	      <child>
+		<widget class="GtkCheckButton" id="fromCheckbutton">
+		  <property agent="glademm" name="cxx_visibility">protected</property>
+		  <property name="visible">True</property>
+		  <property name="can_focus">True</property>
+		  <property name="label" translatable="yes">Start date:</property>
+		  <property name="use_underline">True</property>
+		  <property name="relief">GTK_RELIEF_NORMAL</property>
+		  <property name="focus_on_click">True</property>
+		  <property name="active">False</property>
+		  <property name="inconsistent">False</property>
+		  <property name="draw_indicator">True</property>
+		</widget>
+		<packing>
+		  <property name="left_attach">0</property>
+		  <property name="right_attach">1</property>
+		  <property name="top_attach">1</property>
+		  <property name="bottom_attach">2</property>
+		  <property name="x_padding">4</property>
+		  <property name="y_padding">4</property>
+		  <property name="x_options">fill</property>
+		  <property name="y_options">fill</property>
+		</packing>
+	      </child>
+
+	      <child>
+		<widget class="GtkCheckButton" id="toCheckbutton">
+		  <property agent="glademm" name="cxx_visibility">protected</property>
+		  <property name="visible">True</property>
+		  <property name="can_focus">True</property>
+		  <property name="label" translatable="yes">End date:</property>
+		  <property name="use_underline">True</property>
+		  <property name="relief">GTK_RELIEF_NORMAL</property>
+		  <property name="focus_on_click">True</property>
+		  <property name="active">False</property>
+		  <property name="inconsistent">False</property>
+		  <property name="draw_indicator">True</property>
+		</widget>
+		<packing>
+		  <property name="left_attach">0</property>
+		  <property name="right_attach">1</property>
+		  <property name="top_attach">2</property>
+		  <property name="bottom_attach">3</property>
+		  <property name="x_padding">4</property>
+		  <property name="y_padding">4</property>
+		  <property name="x_options">fill</property>
+		  <property name="y_options">fill</property>
+		</packing>
+	      </child>
+
+	      <child>
+		<widget class="GtkButton" id="fromButton">
+		  <property agent="glademm" name="cxx_visibility">protected</property>
+		  <property name="visible">True</property>
+		  <property name="can_focus">True</property>
+		  <property name="label" translatable="yes">Date</property>
+		  <property name="use_underline">True</property>
+		  <property name="relief">GTK_RELIEF_NORMAL</property>
+		  <property name="focus_on_click">True</property>
+		  <signal name="clicked" handler="on_fromButton_clicked" last_modification_time="Thu, 11 Jan 2007 13:01:07 GMT"/>
+		</widget>
+		<packing>
+		  <property name="left_attach">1</property>
+		  <property name="right_attach">2</property>
+		  <property name="top_attach">1</property>
+		  <property name="bottom_attach">2</property>
+		  <property name="x_padding">4</property>
+		  <property name="y_padding">4</property>
+		  <property name="x_options">fill</property>
+		  <property name="y_options">fill</property>
+		</packing>
+	      </child>
+
+	      <child>
+		<widget class="GtkButton" id="toButton">
+		  <property agent="glademm" name="cxx_visibility">protected</property>
+		  <property name="visible">True</property>
+		  <property name="can_focus">True</property>
+		  <property name="label" translatable="yes">Date</property>
+		  <property name="use_underline">True</property>
+		  <property name="relief">GTK_RELIEF_NORMAL</property>
+		  <property name="focus_on_click">True</property>
+		  <signal name="clicked" handler="on_toButton_clicked" last_modification_time="Thu, 11 Jan 2007 13:00:57 GMT"/>
+		</widget>
+		<packing>
+		  <property name="left_attach">1</property>
+		  <property name="right_attach">2</property>
+		  <property name="top_attach">2</property>
+		  <property name="bottom_attach">3</property>
+		  <property name="x_padding">4</property>
+		  <property name="y_padding">4</property>
+		  <property name="x_options">fill</property>
+		  <property name="y_options">fill</property>
+		</packing>
+	      </child>
 	    </widget>
 	    <packing>
 	      <property name="padding">0</property>
@@ -3773,4 +3865,83 @@
   </child>
 </widget>
 
+<widget class="GtkDialog" id="dateDialog">
+  <property name="visible">True</property>
+  <property name="title" translatable="yes">Date</property>
+  <property name="type">GTK_WINDOW_TOPLEVEL</property>
+  <property name="window_position">GTK_WIN_POS_NONE</property>
+  <property name="modal">False</property>
+  <property name="resizable">True</property>
+  <property name="destroy_with_parent">False</property>
+  <property name="decorated">True</property>
+  <property name="skip_taskbar_hint">False</property>
+  <property name="skip_pager_hint">False</property>
+  <property name="type_hint">GDK_WINDOW_TYPE_HINT_DIALOG</property>
+  <property name="gravity">GDK_GRAVITY_NORTH_WEST</property>
+  <property name="focus_on_map">True</property>
+  <property name="urgency_hint">False</property>
+  <property name="has_separator">True</property>
+
+  <child internal-child="vbox">
+    <widget class="GtkVBox" id="dialog-vbox10">
+      <property name="visible">True</property>
+      <property name="homogeneous">False</property>
+      <property name="spacing">0</property>
+
+      <child internal-child="action_area">
+	<widget class="GtkHButtonBox" id="dialog-action_area10">
+	  <property name="visible">True</property>
+	  <property name="layout_style">GTK_BUTTONBOX_END</property>
+
+	  <child>
+	    <widget class="GtkButton" id="cancelbutton4">
+	      <property name="visible">True</property>
+	      <property name="can_default">True</property>
+	      <property name="can_focus">True</property>
+	      <property name="label">gtk-cancel</property>
+	      <property name="use_stock">True</property>
+	      <property name="relief">GTK_RELIEF_NORMAL</property>
+	      <property name="focus_on_click">True</property>
+	      <property name="response_id">-6</property>
+	    </widget>
+	  </child>
+
+	  <child>
+	    <widget class="GtkButton" id="okbutton2">
+	      <property name="visible">True</property>
+	      <property name="can_default">True</property>
+	      <property name="can_focus">True</property>
+	      <property name="label">gtk-ok</property>
+	      <property name="use_stock">True</property>
+	      <property name="relief">GTK_RELIEF_NORMAL</property>
+	      <property name="focus_on_click">True</property>
+	      <property name="response_id">-5</property>
+	    </widget>
+	  </child>
+	</widget>
+	<packing>
+	  <property name="padding">0</property>
+	  <property name="expand">False</property>
+	  <property name="fill">True</property>
+	  <property name="pack_type">GTK_PACK_END</property>
+	</packing>
+      </child>
+
+      <child>
+	<widget class="GtkCalendar" id="dateCalendar">
+	  <property agent="glademm" name="cxx_visibility">protected</property>
+	  <property name="visible">True</property>
+	  <property name="can_focus">True</property>
+	  <property name="display_options">GTK_CALENDAR_SHOW_HEADING|GTK_CALENDAR_SHOW_DAY_NAMES|GTK_CALENDAR_SHOW_WEEK_NUMBERS</property>
+	</widget>
+	<packing>
+	  <property name="padding">0</property>
+	  <property name="expand">True</property>
+	  <property name="fill">True</property>
+	</packing>
+      </child>
+    </widget>
+  </child>
+</widget>
+
 </glade-interface>

Modified: trunk/UI/GTK2/src/Makefile.am
===================================================================
--- trunk/UI/GTK2/src/Makefile.am	2007-01-09 23:57:14 UTC (rev 690)
+++ trunk/UI/GTK2/src/Makefile.am	2007-01-11 15:35:47 UTC (rev 691)
@@ -1,6 +1,8 @@
 # Process this file with automake to produce Makefile.in
 
 noinst_HEADERS = \
+	dateDialog_glade.hh \
+	dateDialog.hh \
 	importDialog_glade.hh \
 	importDialog.hh \
 	indexDialog_glade.hh \
@@ -33,6 +35,8 @@
 
 pinot_SOURCES = \
 	pinot.cc \
+	dateDialog_glade.cc \
+	dateDialog.cc \
 	importDialog_glade.cc \
 	importDialog.cc \
 	indexDialog_glade.cc \

Modified: trunk/UI/GTK2/src/PinotSettings.cpp
===================================================================
--- trunk/UI/GTK2/src/PinotSettings.cpp	2007-01-09 23:57:14 UTC (rev 690)
+++ trunk/UI/GTK2/src/PinotSettings.cpp	2007-01-11 15:35:47 UTC (rev 691)
@@ -28,6 +28,7 @@
 #include <iostream>
 
 #include <glibmm/convert.h>
+#include <glibmm/date.h>
 #include <libxml++/parsers/domparser.h>
 #include <libxml++/nodes/node.h>
 #include <libxml++/nodes/textnode.h>
@@ -594,8 +595,13 @@
 	}
 
 	QueryProperties queryProps;
+	Date minDate, maxDate;
 	string backCompatString;
+	bool enableMinDate = false, enableMaxDate = false;
 
+	minDate.set_time_current();
+	maxDate.set_time_current();
+
 	// Load the query's properties
 	for (Node::NodeList::iterator iter = childNodes.begin(); iter != childNodes.end(); ++iter)
 	{
@@ -702,6 +708,32 @@
 			int count = atoi(nodeContent.c_str());
 			queryProps.setMaximumResultsCount((unsigned int)max(count, 10));
 		}
+		else if (nodeName == "enablemindate")
+		{
+			if (nodeContent == "YES")
+			{
+				enableMinDate = true;
+			}
+			queryProps.setMinimumDate(enableMinDate, minDate.get_day(), minDate.get_month(), minDate.get_year());
+		}
+		else if (nodeName == "mindate")
+		{
+			minDate.set_parse(nodeContent);
+			queryProps.setMinimumDate(enableMinDate, minDate.get_day(), minDate.get_month(), minDate.get_year());
+		}
+		else if (nodeName == "enablemaxdate")
+		{
+			if (nodeContent == "YES")
+			{
+				enableMaxDate = true;
+			}
+			queryProps.setMaximumDate(enableMaxDate, maxDate.get_day(), maxDate.get_month(), maxDate.get_year());
+		}
+		else if (nodeName == "maxdate")
+		{
+			maxDate.set_parse(nodeContent);
+			queryProps.setMaximumDate(enableMaxDate, maxDate.get_day(), maxDate.get_month(), maxDate.get_year());
+		}
 		else if (nodeName == "index")
 		{
 			if (nodeContent == "ALL")
@@ -1145,10 +1177,28 @@
 		{
 			return false;
 		}
+
+		Date aDate;
+		unsigned int day, month, year;
+
 		addChildElement(pElem, "name", queryIter->first);
 		addChildElement(pElem, "text", queryIter->second.getFreeQuery());
 		sprintf(numStr, "%u", queryIter->second.getMaximumResultsCount());
 		addChildElement(pElem, "maxresults", numStr);
+		bool enable = queryIter->second.getMinimumDate(day, month, year);
+		if (year > 0)
+		{
+			addChildElement(pElem, "enablemindate", (enable ? "YES" : "NO"));
+			aDate.set_dmy((Date::Day )day, (Date::Month )month, (Date::Year )year);
+			addChildElement(pElem, "mindate", aDate.format_string("%F"));
+		}
+		enable = queryIter->second.getMaximumDate(day, month, year);
+		if (year > 0)
+		{
+			addChildElement(pElem, "enablemaxdate", (enable ? "YES" : "NO"));
+			aDate.set_dmy((Date::Day )day, (Date::Month )month, (Date::Year )year);
+			addChildElement(pElem, "maxdate", aDate.format_string("%F"));
+		}
 		addChildElement(pElem, "index", (queryIter->second.getIndexResults() ? "ALL" : "NONE"));
 		addChildElement(pElem, "label", queryIter->second.getLabelName());
 	}
@@ -1508,7 +1558,7 @@
 		return false;
 	}
 
-	// Any pattern matches this the file name ?
+	// Any pattern matches this file name ?
 	for (set<ustring>::iterator patternIter = m_filePatternsBlackList.begin(); patternIter != m_filePatternsBlackList.end() ; ++patternIter)
 	{
 		if (fnmatch(patternIter->c_str(), fileName.c_str(), FNM_NOESCAPE) == 0)

Added: trunk/UI/GTK2/src/dateDialog.cc
===================================================================
--- trunk/UI/GTK2/src/dateDialog.cc	2007-01-09 23:57:14 UTC (rev 690)
+++ trunk/UI/GTK2/src/dateDialog.cc	2007-01-11 15:35:47 UTC (rev 691)
@@ -0,0 +1,61 @@
+/*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU Library General Public License for more details.
+ *
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+ */
+#include <iostream>
+#include <utility>
+#include <string>
+#include <glibmm/ustring.h>
+#include <sigc++/slot.h>
+
+#include "config.h"
+#include "NLS.h"
+#include "PinotSettings.h"
+#include "PinotUtils.h"
+#include "dateDialog.hh"
+
+using namespace std;
+using namespace Glib;
+using namespace Gtk;
+
+dateDialog::dateDialog(const ustring &title, const Date &date) :
+	dateDialog_glade()
+{
+	int month = (int )date.get_month();
+
+	set_title(title);
+
+	dateCalendar->select_month((guint )max(--month, 0), (guint )date.get_year());
+	dateCalendar->select_day((guint )date.get_day());
+}
+
+dateDialog::~dateDialog()
+{
+}
+
+void dateDialog::getChoice(Date &chosenDate) const
+{
+	Date dateNow;
+	guint year, month, day;
+
+	dateNow.set_time_current();
+	dateCalendar->get_date(year, month, day);
+#ifdef DEBUG
+	cout << "dateDialog::getChoice: selected " << year << " " << month << " " << day << endl;
+#endif
+	chosenDate.set_dmy((Date::Day )day, (Date::Month )++month, (Date::Year )year);
+}
+

Added: trunk/UI/GTK2/src/dateDialog.hh
===================================================================
--- trunk/UI/GTK2/src/dateDialog.hh	2007-01-09 23:57:14 UTC (rev 690)
+++ trunk/UI/GTK2/src/dateDialog.hh	2007-01-11 15:35:47 UTC (rev 691)
@@ -0,0 +1,36 @@
+/*
+ *  Copyright 2005,2006 Fabrice Colin
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU Library General Public License for more details.
+ *
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+ */
+
+#ifndef _DATEDIALOG_HH
+#define _DATEDIALOG_HH
+
+#include <glibmm/date.h>
+#include <glibmm/ustring.h>
+
+#include "dateDialog_glade.hh"
+
+class dateDialog : public dateDialog_glade
+{
+public:
+	dateDialog(const Glib::ustring &title, const Glib::Date &date);
+	virtual ~dateDialog();
+
+	void getChoice(Glib::Date &chosenDate) const;
+
+};
+#endif

Added: trunk/UI/GTK2/src/dateDialog_glade.cc
===================================================================
--- trunk/UI/GTK2/src/dateDialog_glade.cc	2007-01-09 23:57:14 UTC (rev 690)
+++ trunk/UI/GTK2/src/dateDialog_glade.cc	2007-01-11 15:35:47 UTC (rev 691)
@@ -0,0 +1,92 @@
+// generated 2007/1/11 20:22:49 SGT by fabrice at amra.dyndns.org.(none)
+// using glademm V2.12.1
+//
+// DO NOT EDIT THIS FILE ! It was created using
+// glade-- /home/fabrice/Projects/MetaSE/pinot/UI/GTK2/metase-gtk2.glade
+// for gtk 2.10.4 and gtkmm 2.10.5
+//
+// Please modify the corresponding derived classes in ./src/dateDialog.cc
+
+
+#if defined __GNUC__ && __GNUC__ < 3
+#error This program will crash if compiled with g++ 2.x
+// see the dynamic_cast bug in the gtkmm FAQ
+#endif //
+#include "config.h"
+/*
+ * Standard gettext macros.
+ */
+#ifdef ENABLE_NLS
+#  include <libintl.h>
+#  undef _
+#  define _(String) dgettext (GETTEXT_PACKAGE, String)
+#  ifdef gettext_noop
+#    define N_(String) gettext_noop (String)
+#  else
+#    define N_(String) (String)
+#  endif
+#endif
+#include <gtkmmconfig.h>
+#if GTKMM_MAJOR_VERSION==2 && GTKMM_MINOR_VERSION>2
+#include <sigc++/compatibility.h>
+#include <sigc++/bind.h>
+#define GMM_GTKMM_22_24(a,b) b
+#else //gtkmm 2.2
+#define GMM_GTKMM_22_24(a,b) a
+#endif //
+#include "dateDialog_glade.hh"
+#include <gdk/gdkkeysyms.h>
+#include <gtkmm/accelgroup.h>
+#include <gtkmm/button.h>
+#include <gtkmm/buttonbox.h>
+#include <gtkmm/box.h>
+#ifndef ENABLE_NLS
+#  define textdomain(String) (String)
+#  define gettext(String) (String)
+#  define dgettext(Domain,Message) (Message)
+#  define dcgettext(Domain,Message,Type) (Message)
+#  define bindtextdomain(Domain,Directory) (Domain)
+#  define _(String) (String)
+#  define N_(String) (String)
+#endif
+
+
+dateDialog_glade::dateDialog_glade(
+)
+{  
+   
+   Gtk::Dialog *dateDialog = this;
+   gmm_data = new GlademmData(get_accel_group());
+   
+   Gtk::Button *cancelbutton4 = Gtk::manage(new class Gtk::Button(Gtk::StockID("gtk-cancel")));
+   Gtk::Button *okbutton2 = Gtk::manage(new class Gtk::Button(Gtk::StockID("gtk-ok")));
+   dateCalendar = Gtk::manage(new class Gtk::Calendar());
+   cancelbutton4->set_flags(Gtk::CAN_FOCUS);
+   cancelbutton4->set_flags(Gtk::CAN_DEFAULT);
+   cancelbutton4->set_relief(Gtk::RELIEF_NORMAL);
+   okbutton2->set_flags(Gtk::CAN_FOCUS);
+   okbutton2->set_flags(Gtk::CAN_DEFAULT);
+   okbutton2->set_relief(Gtk::RELIEF_NORMAL);
+   dateDialog->get_action_area()->property_layout_style().set_value(Gtk::BUTTONBOX_END);
+   dateCalendar->set_flags(Gtk::CAN_FOCUS);
+   dateCalendar->display_options(Gtk::CALENDAR_SHOW_HEADING|Gtk::CALENDAR_SHOW_DAY_NAMES);
+   dateDialog->get_vbox()->set_homogeneous(false);
+   dateDialog->get_vbox()->set_spacing(0);
+   dateDialog->get_vbox()->pack_start(*dateCalendar);
+   dateDialog->set_title(_("Date"));
+   dateDialog->set_modal(false);
+   dateDialog->property_window_position().set_value(Gtk::WIN_POS_NONE);
+   dateDialog->set_resizable(true);
+   dateDialog->property_destroy_with_parent().set_value(false);
+   dateDialog->set_has_separator(true);
+   dateDialog->add_action_widget(*cancelbutton4, -6);
+   dateDialog->add_action_widget(*okbutton2, -5);
+   cancelbutton4->show();
+   okbutton2->show();
+   dateCalendar->show();
+   dateDialog->show();
+}
+
+dateDialog_glade::~dateDialog_glade()
+{  delete gmm_data;
+}

Added: trunk/UI/GTK2/src/dateDialog_glade.hh
===================================================================
--- trunk/UI/GTK2/src/dateDialog_glade.hh	2007-01-09 23:57:14 UTC (rev 690)
+++ trunk/UI/GTK2/src/dateDialog_glade.hh	2007-01-11 15:35:47 UTC (rev 691)
@@ -0,0 +1,48 @@
+// generated 2007/1/11 20:22:49 SGT by fabrice at amra.dyndns.org.(none)
+// using glademm V2.12.1
+//
+// DO NOT EDIT THIS FILE ! It was created using
+// glade-- /home/fabrice/Projects/MetaSE/pinot/UI/GTK2/metase-gtk2.glade
+// for gtk 2.10.4 and gtkmm 2.10.5
+//
+// Please modify the corresponding derived classes in ./src/dateDialog.hh and./src/dateDialog.cc
+
+#ifndef _DATEDIALOG_GLADE_HH
+#  define _DATEDIALOG_GLADE_HH
+
+
+#if !defined(GLADEMM_DATA)
+#define GLADEMM_DATA 
+#include <gtkmm/accelgroup.h>
+
+class GlademmData
+{  
+        
+        Glib::RefPtr<Gtk::AccelGroup> accgrp;
+public:
+        
+        GlademmData(Glib::RefPtr<Gtk::AccelGroup> ag) : accgrp(ag)
+        {  
+        }
+        
+        Glib::RefPtr<Gtk::AccelGroup>  getAccelGroup()
+        {  return accgrp;
+        }
+};
+#endif //GLADEMM_DATA
+
+#include <gtkmm/dialog.h>
+#include <gtkmm/calendar.h>
+
+class dateDialog_glade : public Gtk::Dialog
+{  
+        
+        GlademmData *gmm_data;
+protected:
+        class Gtk::Calendar * dateCalendar;
+        
+        dateDialog_glade();
+        
+        ~dateDialog_glade();
+};
+#endif

Modified: trunk/UI/GTK2/src/queryDialog.cc
===================================================================
--- trunk/UI/GTK2/src/queryDialog.cc	2007-01-09 23:57:14 UTC (rev 690)
+++ trunk/UI/GTK2/src/queryDialog.cc	2007-01-11 15:35:47 UTC (rev 691)
@@ -24,8 +24,10 @@
 #include "config.h"
 #include "Languages.h"
 #include "NLS.h"
+#include "TimeConverter.h"
 #include "PinotUtils.h"
 #include "queryDialog.hh"
+#include "dateDialog.hh"
 
 using namespace std;
 using namespace Glib;
@@ -38,6 +40,8 @@
 	m_labels(PinotSettings::getInstance().getLabels()),
 	m_badName(true)
 {
+	unsigned int day, month, year;
+
 	// Name
 	string name(m_properties.getName());
 	if (name.empty() == true)
@@ -53,6 +57,29 @@
 	refBuffer->set_text(to_utf8(m_properties.getFreeQuery()));
 	// Maximum number of results
 	resultsCountSpinbutton->set_value((double)m_properties.getMaximumResultsCount());
+	// Date range
+	bool enable = m_properties.getMinimumDate(day, month, year);
+	if (year > 0)
+	{
+		m_fromDate.set_dmy((Date::Day )day, (Date::Month )month, (Date::Year )year);
+	}
+	else
+	{
+		m_fromDate.set_time_current();
+	}
+	fromCheckbutton->set_active(enable);
+	fromButton->set_label(m_fromDate.format_string("%x"));
+	enable = m_properties.getMaximumDate(day, month, year);
+	if (year > 0)
+	{
+		m_toDate.set_dmy((Date::Day )day, (Date::Month )month, (Date::Year )year);
+	}
+	else
+	{
+		m_toDate.set_time_current();
+	}
+	toCheckbutton->set_active(enable);
+	toButton->set_label(m_toDate.format_string("%x"));
 	// Index all results
 	indexCheckbutton->set_active(m_properties.getIndexResults());
 
@@ -160,6 +187,9 @@
 	m_properties.setFreeQuery(from_utf8(refBuffer->get_text()));
 	// Maximum number of results
 	m_properties.setMaximumResultsCount((unsigned int)resultsCountSpinbutton->get_value());
+	// Date range
+	m_properties.setMinimumDate(fromCheckbutton->get_active(), m_fromDate.get_day(), m_fromDate.get_month(), m_fromDate.get_year());
+	m_properties.setMaximumDate(toCheckbutton->get_active(), m_toDate.get_day(), m_toDate.get_month(), m_toDate.get_year());
 	// Index all results
 	m_properties.setIndexResults(indexCheckbutton->get_active());
 	// Index label
@@ -236,3 +266,33 @@
 	refBuffer->set_text(queryText);
 }
 
+void queryDialog::on_fromButton_clicked()
+{
+	dateDialog datePicker(_("Start date"), m_fromDate);
+
+#ifdef DEBUG
+	cout << "queryDialog::on_fromButton_clicked: start date is " << m_fromDate.format_string("%x") << endl;
+#endif
+	datePicker.show();
+	if (datePicker.run() == RESPONSE_OK)
+	{
+		datePicker.getChoice(m_fromDate);
+		fromButton->set_label(m_fromDate.format_string("%x"));
+	}
+}
+
+void queryDialog::on_toButton_clicked()
+{
+	dateDialog datePicker(_("End date"), m_toDate);
+
+#ifdef DEBUG
+	cout << "queryDialog::on_toButton_clicked: end date is " << m_toDate.format_string("%x") << endl;
+#endif
+	datePicker.show();
+	if (datePicker.run() == RESPONSE_OK)
+	{
+		datePicker.getChoice(m_toDate);
+	        toButton->set_label(m_toDate.format_string("%x"));
+	}
+}
+

Modified: trunk/UI/GTK2/src/queryDialog.hh
===================================================================
--- trunk/UI/GTK2/src/queryDialog.hh	2007-01-09 23:57:14 UTC (rev 690)
+++ trunk/UI/GTK2/src/queryDialog.hh	2007-01-11 15:35:47 UTC (rev 691)
@@ -21,6 +21,7 @@
 
 #include <string>
 #include <set>
+#include <glibmm/date.h>
 #include <gtkmm/liststore.h>
 
 #include "QueryProperties.h"
@@ -44,6 +45,8 @@
 	Glib::RefPtr<Gtk::ListStore> m_refLabelNameTree;
 	ComboModelColumns m_filterColumns;
 	Glib::RefPtr<Gtk::ListStore> m_refFilterTree;
+	Glib::Date m_fromDate;
+	Glib::Date m_toDate;
 	bool m_badName;
 
 	void populate_comboboxes();
@@ -51,6 +54,8 @@
 	virtual void on_queryOkbutton_clicked();
 	virtual void on_nameEntry_changed();
 	virtual void on_addFilterButton_clicked();
+        virtual void on_fromButton_clicked();
+        virtual void on_toButton_clicked();
 
 };
 #endif

Modified: trunk/UI/GTK2/src/queryDialog_glade.cc
===================================================================
--- trunk/UI/GTK2/src/queryDialog_glade.cc	2007-01-09 23:57:14 UTC (rev 690)
+++ trunk/UI/GTK2/src/queryDialog_glade.cc	2007-01-11 15:35:47 UTC (rev 691)
@@ -1,4 +1,4 @@
-// generated 2006/12/31 19:10:59 SGT by fabrice at thorgrim.dyndns.org.(none)
+// generated 2007/1/11 21:02:42 SGT by fabrice at amra.dyndns.org.(none)
 // using glademm V2.12.1
 //
 // DO NOT EDIT THIS FILE ! It was created using
@@ -80,14 +80,18 @@
    Gtk::Alignment *queryFrameAlignment = Gtk::manage(new class Gtk::Alignment(0.5, 0.5, 1, 1));
    Gtk::Label *queryFrameLabel = Gtk::manage(new class Gtk::Label(_("Query Text")));
    Gtk::Frame *queryFrame = Gtk::manage(new class Gtk::Frame());
-   indexCheckbutton = Gtk::manage(new class Gtk::CheckButton(_("Index all results with label")));
+   indexCheckbutton = Gtk::manage(new class Gtk::CheckButton(_("Index results with label")));
    labelNameCombobox = Gtk::manage(new class Gtk::ComboBox());
    
    Gtk::Label *resultsCountLabel = Gtk::manage(new class Gtk::Label(_("Number of results:")));
    Gtk::Adjustment *resultsCountSpinbutton_adj = Gtk::manage(new class Gtk::Adjustment(10, 10, 100, 10, 20, 20));
    resultsCountSpinbutton = Gtk::manage(new class Gtk::SpinButton(*resultsCountSpinbutton_adj, 1, 0));
+   fromCheckbutton = Gtk::manage(new class Gtk::CheckButton(_("Start date:")));
+   toCheckbutton = Gtk::manage(new class Gtk::CheckButton(_("End date:")));
+   fromButton = Gtk::manage(new class Gtk::Button(_("Date")));
+   toButton = Gtk::manage(new class Gtk::Button(_("Date")));
    
-   Gtk::Table *tersmTable = Gtk::manage(new class Gtk::Table(2, 2, false));
+   Gtk::Table *actionsTable = Gtk::manage(new class Gtk::Table(2, 2, false));
    Gtk::VBox *queryVbox = Gtk::manage(new class Gtk::VBox(false, 0));
    queryCancelbutton->set_flags(Gtk::CAN_FOCUS);
    queryCancelbutton->set_flags(Gtk::CAN_DEFAULT);
@@ -165,16 +169,32 @@
    resultsCountSpinbutton->set_numeric(false);
    resultsCountSpinbutton->set_digits(0);
    resultsCountSpinbutton->set_wrap(false);
-   tersmTable->set_row_spacings(0);
-   tersmTable->set_col_spacings(0);
-   tersmTable->attach(*indexCheckbutton, 0, 1, 1, 2, Gtk::FILL, Gtk::FILL, 4, 4);
-   tersmTable->attach(*labelNameCombobox, 1, 2, 1, 2, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
-   tersmTable->attach(*resultsCountLabel, 0, 1, 0, 1, Gtk::FILL, Gtk::FILL, 4, 4);
-   tersmTable->attach(*resultsCountSpinbutton, 1, 2, 0, 1, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
+   fromCheckbutton->set_flags(Gtk::CAN_FOCUS);
+   fromCheckbutton->set_relief(Gtk::RELIEF_NORMAL);
+   fromCheckbutton->set_mode(true);
+   fromCheckbutton->set_active(false);
+   toCheckbutton->set_flags(Gtk::CAN_FOCUS);
+   toCheckbutton->set_relief(Gtk::RELIEF_NORMAL);
+   toCheckbutton->set_mode(true);
+   toCheckbutton->set_active(false);
+   fromButton->set_flags(Gtk::CAN_FOCUS);
+   fromButton->set_relief(Gtk::RELIEF_NORMAL);
+   toButton->set_flags(Gtk::CAN_FOCUS);
+   toButton->set_relief(Gtk::RELIEF_NORMAL);
+   actionsTable->set_row_spacings(0);
+   actionsTable->set_col_spacings(0);
+   actionsTable->attach(*indexCheckbutton, 0, 1, 3, 4, Gtk::FILL, Gtk::FILL, 4, 4);
+   actionsTable->attach(*labelNameCombobox, 1, 2, 3, 4, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
+   actionsTable->attach(*resultsCountLabel, 0, 1, 0, 1, Gtk::FILL, Gtk::FILL, 4, 4);
+   actionsTable->attach(*resultsCountSpinbutton, 1, 2, 0, 1, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
+   actionsTable->attach(*fromCheckbutton, 0, 1, 1, 2, Gtk::FILL, Gtk::FILL, 4, 4);
+   actionsTable->attach(*toCheckbutton, 0, 1, 2, 3, Gtk::FILL, Gtk::FILL, 4, 4);
+   actionsTable->attach(*fromButton, 1, 2, 1, 2, Gtk::FILL, Gtk::FILL, 4, 4);
+   actionsTable->attach(*toButton, 1, 2, 2, 3, Gtk::FILL, Gtk::FILL, 4, 4);
    queryVbox->pack_start(*nameTable, Gtk::PACK_SHRINK, 0);
    queryVbox->pack_start(*queryHbox);
    queryVbox->pack_start(*queryFrame, Gtk::PACK_EXPAND_WIDGET, 4);
-   queryVbox->pack_start(*tersmTable);
+   queryVbox->pack_start(*actionsTable);
    queryDialog->get_vbox()->set_homogeneous(false);
    queryDialog->get_vbox()->set_spacing(0);
    queryDialog->get_vbox()->pack_start(*queryVbox);
@@ -204,12 +224,18 @@
    labelNameCombobox->show();
    resultsCountLabel->show();
    resultsCountSpinbutton->show();
-   tersmTable->show();
+   fromCheckbutton->show();
+   toCheckbutton->show();
+   fromButton->show();
+   toButton->show();
+   actionsTable->show();
    queryVbox->show();
    queryDialog->show();
    queryOkbutton->signal_clicked().connect(SigC::slot(*this, &queryDialog_glade::on_queryOkbutton_clicked), false);
    nameEntry->signal_changed().connect(SigC::slot(*this, &queryDialog_glade::on_nameEntry_changed), false);
    addFilterButton->signal_clicked().connect(SigC::slot(*this, &queryDialog_glade::on_addFilterButton_clicked), false);
+   fromButton->signal_clicked().connect(SigC::slot(*this, &queryDialog_glade::on_fromButton_clicked), false);
+   toButton->signal_clicked().connect(SigC::slot(*this, &queryDialog_glade::on_toButton_clicked), false);
 }
 
 queryDialog_glade::~queryDialog_glade()

Modified: trunk/UI/GTK2/src/queryDialog_glade.hh
===================================================================
--- trunk/UI/GTK2/src/queryDialog_glade.hh	2007-01-09 23:57:14 UTC (rev 690)
+++ trunk/UI/GTK2/src/queryDialog_glade.hh	2007-01-11 15:35:47 UTC (rev 691)
@@ -1,9 +1,9 @@
-// generated 2006/10/14 9:28:11 SGT by fabrice at amra.dyndns.org.(none)
+// generated 2007/1/11 21:02:42 SGT by fabrice at amra.dyndns.org.(none)
 // using glademm V2.12.1
 //
 // DO NOT EDIT THIS FILE ! It was created using
 // glade-- /home/fabrice/Projects/MetaSE/pinot/UI/GTK2/metase-gtk2.glade
-// for gtk 2.8.20 and gtkmm 2.8.8
+// for gtk 2.10.4 and gtkmm 2.10.5
 //
 // Please modify the corresponding derived classes in ./src/queryDialog.hh and./src/queryDialog.cc
 
@@ -53,6 +53,10 @@
         class Gtk::CheckButton * indexCheckbutton;
         class Gtk::ComboBox * labelNameCombobox;
         class Gtk::SpinButton * resultsCountSpinbutton;
+        class Gtk::CheckButton * fromCheckbutton;
+        class Gtk::CheckButton * toCheckbutton;
+        class Gtk::Button * fromButton;
+        class Gtk::Button * toButton;
         
         queryDialog_glade();
         
@@ -61,5 +65,7 @@
         virtual void on_queryOkbutton_clicked() = 0;
         virtual void on_nameEntry_changed() = 0;
         virtual void on_addFilterButton_clicked() = 0;
+        virtual void on_fromButton_clicked() = 0;
+        virtual void on_toButton_clicked() = 0;
 };
 #endif

Modified: trunk/po/POTFILES.in
===================================================================
--- trunk/po/POTFILES.in	2007-01-09 23:57:14 UTC (rev 690)
+++ trunk/po/POTFILES.in	2007-01-11 15:35:47 UTC (rev 691)
@@ -1,6 +1,10 @@
 # List of source files containing translatable strings.
 UI/GTK2/src/DaemonState.cpp
 UI/GTK2/src/EnginesTree.cpp
+UI/GTK2/src/dateDialog.cc
+UI/GTK2/src/dateDialog_glade.cc
+UI/GTK2/src/indexDialog.cc
+UI/GTK2/src/indexDialog_glade.cc
 UI/GTK2/src/importDialog.cc
 UI/GTK2/src/importDialog_glade.cc
 UI/GTK2/src/indexDialog.cc



From fabricecolin at mail.berlios.de  Fri Jan 12 13:36:30 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Fri, 12 Jan 2007 13:36:30 +0100
Subject: [Pinot-svn] r692 - in trunk: UI/GTK2/src Utils
Message-ID: <200701121236.l0CCaUEY022446@sheep.berlios.de>

Author: fabricecolin
Date: 2007-01-12 13:36:29 +0100 (Fri, 12 Jan 2007)
New Revision: 692

Modified:
   trunk/UI/GTK2/src/PinotSettings.cpp
   trunk/UI/GTK2/src/statisticsDialog.cc
   trunk/Utils/DocumentInfo.cpp
   trunk/Utils/StringManip.cpp
Log:
A bunch of cosmetic changes and typo corrections.


Modified: trunk/UI/GTK2/src/PinotSettings.cpp
===================================================================
--- trunk/UI/GTK2/src/PinotSettings.cpp	2007-01-11 15:35:47 UTC (rev 691)
+++ trunk/UI/GTK2/src/PinotSettings.cpp	2007-01-12 12:36:29 UTC (rev 692)
@@ -1090,6 +1090,9 @@
 					m_engineChannels.insert(pair<string, bool>(engineChannel, true));
 				}
 			}
+#ifdef DEBUG
+			else cout << "PinotSettings::loadSearchEngines: stat failed on " << location << endl;
+#endif
 		}
 
 		// Next entry

Modified: trunk/UI/GTK2/src/statisticsDialog.cc
===================================================================
--- trunk/UI/GTK2/src/statisticsDialog.cc	2007-01-11 15:35:47 UTC (rev 691)
+++ trunk/UI/GTK2/src/statisticsDialog.cc	2007-01-12 12:36:29 UTC (rev 692)
@@ -102,12 +102,12 @@
 	snprintf(countStr, 64, "%u", crawledFilesCount);
 	statIter = m_refStore->append(folderIter->children());
 	row = *statIter;
-	row[m_statsColumns.m_name] = ustring(countStr) + " " + _("crawled files");
+	row[m_statsColumns.m_name] = ustring(countStr) + " " + _("files were crawled");
 	unsigned int crawlingFilesCount = history.getItemsCount(CrawlHistory::CRAWLING);
 	snprintf(countStr, 64, "%u", crawlingFilesCount);
 	statIter = m_refStore->append(folderIter->children());
 	row = *statIter;
-	row[m_statsColumns.m_name] = ustring(countStr) + " " + _("files being crawled");
+	row[m_statsColumns.m_name] = ustring(countStr) + " " + _("files are being crawled");
 
 	TreeModel::iterator errIter = m_refStore->append(folderIter->children());
 	row = *errIter;

Modified: trunk/Utils/DocumentInfo.cpp
===================================================================
--- trunk/Utils/DocumentInfo.cpp	2007-01-11 15:35:47 UTC (rev 691)
+++ trunk/Utils/DocumentInfo.cpp	2007-01-12 12:36:29 UTC (rev 692)
@@ -21,6 +21,7 @@
 #include "DocumentInfo.h"
 
 using std::string;
+using std::set;
 using std::copy;
 using std::inserter;
 

Modified: trunk/Utils/StringManip.cpp
===================================================================
--- trunk/Utils/StringManip.cpp	2007-01-11 15:35:47 UTC (rev 691)
+++ trunk/Utils/StringManip.cpp	2007-01-12 12:36:29 UTC (rev 692)
@@ -296,7 +296,7 @@
 		return "";
 	}
 
-	// The following was lifed from Xapian's xapian-applications/omega/hashterm.cc
+	// The following was lifted from Xapian's xapian-applications/omega/hashterm.cc
 	// and prettified slightly
 	for (string::const_iterator i = str.begin(); i != str.end(); ++i)
 	{



From fabricecolin at mail.berlios.de  Fri Jan 12 13:46:11 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Fri, 12 Jan 2007 13:46:11 +0100
Subject: [Pinot-svn] r693 - in trunk: Index Search Utils
Message-ID: <200701121246.l0CCkBY9023362@sheep.berlios.de>

Author: fabricecolin
Date: 2007-01-12 13:46:10 +0100 (Fri, 12 Jan 2007)
New Revision: 693

Modified:
   trunk/Index/XapianIndex.cpp
   trunk/Search/XapianEngine.cpp
   trunk/Search/XapianEngine.h
   trunk/Utils/TimeConverter.cpp
   trunk/Utils/TimeConverter.h
Log:
Date range filtering, back-end part.
Creation of the date range query is copied from Omega's date_range_filter()
function found in xapian-applications/omega/date.cc.
When the dates don't make sense, they are ignored. 


Modified: trunk/Index/XapianIndex.cpp
===================================================================
--- trunk/Index/XapianIndex.cpp	2007-01-12 12:36:29 UTC (rev 692)
+++ trunk/Index/XapianIndex.cpp	2007-01-12 12:46:10 UTC (rev 693)
@@ -45,8 +45,10 @@
 using std::cerr;
 using std::endl;
 using std::string;
+using std::vector;
 using std::set;
 using std::min;
+using std::max;
 
 // This puts a limit to terms length.
 const unsigned int XapianIndex::m_maxTermLength = 240;
@@ -397,7 +399,7 @@
 	// Add the date terms D, M and Y
 	time_t timeT = TimeConverter::fromTimestamp(info.getTimestamp());
 	struct tm *tm = localtime(&timeT);
-	string yyyymmdd = TimeConverter::toTimestamp(tm->tm_year + 1900, tm->tm_mon + 1, tm->tm_mday);
+	string yyyymmdd = TimeConverter::toYYYYMMDDString(tm->tm_year + 1900, tm->tm_mon + 1, tm->tm_mday);
 	if (yyyymmdd.length() == 8)
 	{
 		doc.add_term(string("D") + yyyymmdd);
@@ -512,7 +514,7 @@
 	// Date terms
 	time_t timeT = TimeConverter::fromTimestamp(docInfo.getTimestamp());
 	struct tm *tm = localtime(&timeT);
-	string yyyymmdd = TimeConverter::toTimestamp(tm->tm_year + 1900, tm->tm_mon + 1, tm->tm_mday);
+	string yyyymmdd = TimeConverter::toYYYYMMDDString(tm->tm_year + 1900, tm->tm_mon + 1, tm->tm_mday);
 	if (yyyymmdd.length() == 8)
 	{
 		commonTerms.insert(string("D") + yyyymmdd);

Modified: trunk/Search/XapianEngine.cpp
===================================================================
--- trunk/Search/XapianEngine.cpp	2007-01-12 12:36:29 UTC (rev 692)
+++ trunk/Search/XapianEngine.cpp	2007-01-12 12:46:10 UTC (rev 693)
@@ -19,6 +19,7 @@
 #include <sys/types.h>
 #include <sys/stat.h>
 #include <unistd.h>
+#include <time.h>
 #include <string>
 #include <vector>
 #include <iostream>
@@ -26,6 +27,7 @@
 
 #include "Languages.h"
 #include "StringManip.h"
+#include "TimeConverter.h"
 #include "Url.h"
 #include "XapianDatabaseFactory.h"
 #include "AbstractGenerator.h"
@@ -39,6 +41,21 @@
 using std::endl;
 using std::inserter;
 
+// The following function was lifted from Xapian's xapian-applications/omega/date.cc
+// where it's called last_day(), and prettified slightly
+static int lastDay(int year, int month)
+{
+	static const int lastDays[13] = { 0, 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31 };
+
+	if (month != 2)
+	{
+		return lastDays[month];
+	}
+
+	// Good until 2100
+	return 28 + (year % 4 == 0);
+}
+
 XapianEngine::XapianEngine(const string &database) :
 	SearchEngineInterface()
 {
@@ -62,12 +79,93 @@
 	m_resultsList.clear();
 }
 
+Xapian::Query XapianEngine::dateFilter(unsigned int minDay, unsigned int minMonth, unsigned int minYear,
+	unsigned int maxDay, unsigned int maxMonth, unsigned int maxYear)
+{
+	// The following was lifted from Xapian's date_range_filter() in
+	// xapian-applications/omega/date.cc and prettified slightly
+	vector<Xapian::Query> v;
+	char buf[10];
+
+	snprintf(buf, 10, "D%04d%02d", minYear, minMonth);
+	int d_last = lastDay(minYear, minMonth);
+	int d_end = d_last;
+	if (minYear == maxYear && minMonth == maxMonth && maxDay < d_last)
+	{
+		d_end = maxDay;
+	}
+	// Deal with any initial partial month
+	if (minDay > 1 || d_end < d_last)
+	{
+		for ( ; minDay <= d_end ; minDay++)
+		{
+			snprintf(buf + 7, 3, "%02d", minDay);
+			v.push_back(Xapian::Query(buf));
+		}
+	} else {
+		buf[0] = 'M';
+		v.push_back(Xapian::Query(buf));
+	}
+	
+	if (minYear == maxYear && minMonth == maxMonth)
+	{
+		return Xapian::Query(Xapian::Query::OP_OR, v.begin(), v.end());
+	}
+
+	int m_last = (minYear < maxYear) ? 12 : maxMonth - 1;
+	while (++minMonth <= m_last)
+	{
+		snprintf(buf + 5, 5, "%02d", minMonth);
+		buf[0] = 'M';
+		v.push_back(Xapian::Query(buf));
+	}
+	
+	if (minYear < maxYear)
+	{
+		while (++minYear < maxYear)
+		{
+			snprintf(buf + 1, 9, "%04d", minYear);
+			buf[0] = 'Y';
+			v.push_back(Xapian::Query(buf));
+		}
+		snprintf(buf + 1, 9, "%04d", maxYear);
+		buf[0] = 'M';
+		for (minMonth = 1; minMonth < maxMonth; minMonth++)
+		{
+			snprintf(buf + 5, 5, "%02d", minMonth);
+			v.push_back(Xapian::Query(buf));
+		}
+	}
+	
+	snprintf(buf + 5, 5, "%02d", maxMonth);
+
+	// Deal with any final partial month
+	if (maxDay < lastDay(maxYear, maxMonth))
+	{
+		buf[0] = 'D';
+		for (minDay = 1 ; minDay <= maxDay; minDay++)
+		{
+			snprintf(buf + 7, 3, "%02d", minDay);
+			v.push_back(Xapian::Query(buf));
+		}
+	}
+	else
+	{
+		buf[0] = 'M';
+		v.push_back(Xapian::Query(buf));
+	}
+
+	return Xapian::Query(Xapian::Query::OP_OR, v.begin(), v.end());
+}
+
 Xapian::Query XapianEngine::parseQuery(Xapian::Database *pIndex, const QueryProperties &queryProps,
 	const string &stemLanguage, bool followOperators)
 {
 	string freeQuery(StringManip::replaceSubString(queryProps.getFreeQuery(), "\n", " "));
 	Xapian::QueryParser parser;
 	Xapian::Stem stemmer;
+	unsigned int minDay, minMonth, minYear = 0;
+	unsigned int maxDay, maxMonth, maxYear = 0;
 
 	// Set things up
 	if (stemLanguage.empty() == false)
@@ -106,8 +204,53 @@
 	parser.add_boolean_prefix("label", "XLABEL:");
 
 	// Activate all options and parse
-	return parser.parse_query(freeQuery,
+	Xapian::Query parsedQuery = parser.parse_query(freeQuery,
 		Xapian::QueryParser::FLAG_BOOLEAN|Xapian::QueryParser::FLAG_PHRASE|Xapian::QueryParser::FLAG_LOVEHATE|Xapian::QueryParser::FLAG_BOOLEAN_ANY_CASE|Xapian::QueryParser::FLAG_WILDCARD);
+	// Apply a date range ?
+	bool enableMin = queryProps.getMinimumDate(minDay, minMonth, minYear);
+	bool enableMax = queryProps.getMaximumDate(maxDay, maxMonth, maxYear);
+	if ((enableMin == false) && 
+		(enableMax == false))
+	{
+		// No
+		return parsedQuery;
+	}
+
+	// Anyone going as far back as Year 0 is taking the piss :-)
+	if ((enableMin == false) ||
+		(minYear == 0))
+	{
+		minDay = minMonth = 1;
+		minYear = 1970;
+	}
+	// If the second date is older than the Epoch, the first date should be set too
+	if ((enableMax == false) ||
+		(maxYear == 0))
+	{
+		time_t nowTime = time(NULL);
+		struct tm *timeTm = localtime(&nowTime);
+		maxYear = timeTm->tm_year + 1900;
+		maxMonth = timeTm->tm_mon + 1;
+		maxDay = timeTm->tm_mday;
+	}
+
+	string yyyymmddMin(TimeConverter::toYYYYMMDDString(minDay, minMonth, minYear));
+	string yyyymmddMax(TimeConverter::toYYYYMMDDString(maxDay, maxMonth, maxYear));
+	time_t startTime = TimeConverter::fromYYYYMMDDString(yyyymmddMin);
+	time_t endTime = TimeConverter::fromYYYYMMDDString(yyyymmddMax);
+  
+	double diffTime = difftime(endTime, startTime);
+	if (diffTime > 0)
+	{
+		return Xapian::Query(Xapian::Query::OP_FILTER, parsedQuery,
+			dateFilter(minDay, minMonth, minYear, maxDay, maxMonth, maxYear));
+	}
+#ifdef DEBUG
+	else cout << "XapianEngine::parseQuery: date range is zero or bogus ("
+		<< yyyymmddMax << " <= " << yyyymmddMin << ")" << endl;
+#endif
+
+	return parsedQuery;
 }
 
 /// Validates a query and extracts its terms.
@@ -118,11 +261,11 @@
 
 	try
 	{
-		Xapian::Query freeQuery = parseQuery(NULL, queryProps, "", true);
-		if (freeQuery.empty() == false)
+		Xapian::Query fullQuery = parseQuery(NULL, queryProps, "", true);
+		if (fullQuery.empty() == false)
 		{
-			for (Xapian::TermIterator termIter = freeQuery.get_terms_begin();
-				termIter != freeQuery.get_terms_end(); ++termIter)
+			for (Xapian::TermIterator termIter = fullQuery.get_terms_begin();
+				termIter != fullQuery.get_terms_end(); ++termIter)
 			{
 				// Skip prefixed terms unless instructed otherwise
 				if ((includePrefixed == true) ||
@@ -279,7 +422,7 @@
 	copy(relevantDocuments.begin(), relevantDocuments.end(),
 		inserter(m_relevantDocuments, m_relevantDocuments.begin()));
 
-        return true;
+	return true;
 }
 
 /// Runs a query; true if success.
@@ -309,19 +452,19 @@
 		// 3. if no results, don't follow operators and don't stem terms
 		// 4. if no results, don't follow operators and stem terms
 		// Steps 2 and 4 depend on a language being defined for the query
-		Xapian::Query freeQuery = parseQuery(pIndex, queryProps, "", followOperators);
-		while (freeQuery.empty() == false)
+		Xapian::Query fullQuery = parseQuery(pIndex, queryProps, "", followOperators);
+		while (fullQuery.empty() == false)
 		{
 #ifdef DEBUG
 			cout << "XapianEngine::runQuery: query terms are " << endl;
-			for (Xapian::TermIterator termIter = freeQuery.get_terms_begin();
-				termIter != freeQuery.get_terms_end(); ++termIter)
+			for (Xapian::TermIterator termIter = fullQuery.get_terms_begin();
+				termIter != fullQuery.get_terms_end(); ++termIter)
 			{
 				cout << " " << *termIter << endl;
 			}
 #endif
 			// Query the database
-			if (queryDatabase(pIndex, freeQuery) == false)
+			if (queryDatabase(pIndex, fullQuery) == false)
 			{
 				break;
 			}
@@ -360,7 +503,7 @@
 #ifdef DEBUG
 				cout << "XapianEngine::runQuery: trying step " << searchStep << endl;
 #endif
-				freeQuery = parseQuery(pIndex, queryProps,
+				fullQuery = parseQuery(pIndex, queryProps,
 					Languages::toEnglish(stemLanguage), followOperators);
 				continue;
 			}

Modified: trunk/Search/XapianEngine.h
===================================================================
--- trunk/Search/XapianEngine.h	2007-01-12 12:36:29 UTC (rev 692)
+++ trunk/Search/XapianEngine.h	2007-01-12 12:46:10 UTC (rev 693)
@@ -54,6 +54,9 @@
 
 		bool queryDatabase(Xapian::Database *pIndex, Xapian::Query &query);
 
+		static Xapian::Query dateFilter(unsigned int minDay, unsigned int minMonth, unsigned int minYear,
+		        unsigned int maxDay, unsigned int maxMonth, unsigned int maxYear);
+
 		static Xapian::Query parseQuery(Xapian::Database *pIndex, const QueryProperties &queryProps,
 			const string &stemLanguage, bool followOperators);
 

Modified: trunk/Utils/TimeConverter.cpp
===================================================================
--- trunk/Utils/TimeConverter.cpp	2007-01-12 12:36:29 UTC (rev 692)
+++ trunk/Utils/TimeConverter.cpp	2007-01-12 12:46:10 UTC (rev 693)
@@ -101,6 +101,7 @@
 
 using std::cout;
 using std::endl;
+using std::string;
 
 TimeConverter::TimeConverter()
 {
@@ -239,8 +240,8 @@
 	return 0;
 }
 
-/// Converts into a YYYYMMDD timestamp.
-string TimeConverter::toTimestamp(int year, int month, int day)
+/// Converts to a YYYYMMDD-formatted string.
+string TimeConverter::toYYYYMMDDString(int year, int month, int day)
 {
 	char timeStr[64];
 
@@ -276,3 +277,23 @@
 
 	return "";
 }
+
+/// Converts from a YYYYMMDD-formatted string.
+time_t TimeConverter::fromYYYYMMDDString(const string &yyyymmdd, bool inGMTime)
+{
+	struct tm timeTm;
+	time_t gmTime = 0;
+
+	strptime(yyyymmdd.c_str(), "%Y%m%d", &timeTm);
+	if (inGMTime == true)
+	{
+		gmTime = timegm(&timeTm);
+	}
+	else
+	{
+		gmTime = mktime(&timeTm);
+	}
+
+	return gmTime;
+}
+

Modified: trunk/Utils/TimeConverter.h
===================================================================
--- trunk/Utils/TimeConverter.h	2007-01-12 12:36:29 UTC (rev 692)
+++ trunk/Utils/TimeConverter.h	2007-01-12 12:46:10 UTC (rev 693)
@@ -21,21 +21,22 @@
 
 #include <string>
 
-using namespace std;
-
 /// This class handles time conversions.
 class TimeConverter
 {
 	public:
 		/// Converts into an RFC 822 timestamp.
-		static string toTimestamp(time_t aTime, bool inGMTime = false);
+		static std::string toTimestamp(time_t aTime, bool inGMTime = false);
 
 		/// Converts from a RFC 822 timestamp.
-		static time_t fromTimestamp(const string &timestamp, bool inGMTime = false);
+		static time_t fromTimestamp(const std::string &timestamp, bool inGMTime = false);
 
-		/// Converts into a YYYYMMDD timestamp.
-		static string toTimestamp(int year, int month, int day);
+		/// Converts to a YYYYMMDD-formatted string.
+		static std::string toYYYYMMDDString(int year, int month, int day);
 
+		/// Converts from a YYYYMMDD-formatted string.
+		static time_t fromYYYYMMDDString(const std::string &yyyymmdd, bool inGMTime = false);
+
 	protected:
 		TimeConverter();
 



From fabricecolin at mail.berlios.de  Fri Jan 12 13:57:14 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Fri, 12 Jan 2007 13:57:14 +0100
Subject: [Pinot-svn] r694 - trunk/Search
Message-ID: <200701121257.l0CCvEMr024886@sheep.berlios.de>

Author: fabricecolin
Date: 2007-01-12 13:57:13 +0100 (Fri, 12 Jan 2007)
New Revision: 694

Modified:
   trunk/Search/XapianEngine.cpp
Log:
Don't include terms with weight 0 in abstract generation.


Modified: trunk/Search/XapianEngine.cpp
===================================================================
--- trunk/Search/XapianEngine.cpp	2007-01-12 12:46:10 UTC (rev 693)
+++ trunk/Search/XapianEngine.cpp	2007-01-12 12:57:13 UTC (rev 694)
@@ -313,13 +313,16 @@
 					termIter != query.get_terms_end(); ++termIter)
 				{
 					string termName(*termIter);
-					Xapian::weight termWeight = maxWeight - matches.get_termweight(termName);
+					Xapian::weight termWeight = matches.get_termweight(termName);
 
-					queryTerms.insert(pair<Xapian::weight, string>(termWeight, termName));
+					if (termWeight > 0)
+					{
+						queryTerms.insert(pair<Xapian::weight, string>(maxWeight - termWeight, termName));
 #ifdef DEBUG
-					cout << "XapianEngine::queryDatabase: term " << termName
-						<< " has weight " << matches.get_termweight(termName) << "/" << maxWeight << endl;
+						cout << "XapianEngine::queryDatabase: term " << termName
+							<< " has weight " << termWeight << "/" << maxWeight << endl;
 #endif
+					}
 				}
 
 				for (multimap<Xapian::weight, string>::iterator weightIter = queryTerms.begin();



From fabricecolin at mail.berlios.de  Sat Jan 13 16:36:09 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 13 Jan 2007 16:36:09 +0100
Subject: [Pinot-svn] r695 - trunk/UI/GTK2/src
Message-ID: <200701131536.l0DFa9q3020129@sheep.berlios.de>

Author: fabricecolin
Date: 2007-01-13 16:36:08 +0100 (Sat, 13 Jan 2007)
New Revision: 695

Modified:
   trunk/UI/GTK2/src/PinotSettings.cpp
   trunk/UI/GTK2/src/dateDialog.cc
   trunk/UI/GTK2/src/queryDialog.cc
Log:
Date::set_time_current() is a recent addition, prefer set_time().


Modified: trunk/UI/GTK2/src/PinotSettings.cpp
===================================================================
--- trunk/UI/GTK2/src/PinotSettings.cpp	2007-01-12 12:57:13 UTC (rev 694)
+++ trunk/UI/GTK2/src/PinotSettings.cpp	2007-01-13 15:36:08 UTC (rev 695)
@@ -599,8 +599,8 @@
 	string backCompatString;
 	bool enableMinDate = false, enableMaxDate = false;
 
-	minDate.set_time_current();
-	maxDate.set_time_current();
+	minDate.set_time(time(NULL));
+	maxDate.set_time(time(NULL));
 
 	// Load the query's properties
 	for (Node::NodeList::iterator iter = childNodes.begin(); iter != childNodes.end(); ++iter)

Modified: trunk/UI/GTK2/src/dateDialog.cc
===================================================================
--- trunk/UI/GTK2/src/dateDialog.cc	2007-01-12 12:57:13 UTC (rev 694)
+++ trunk/UI/GTK2/src/dateDialog.cc	2007-01-13 15:36:08 UTC (rev 695)
@@ -51,7 +51,7 @@
 	Date dateNow;
 	guint year, month, day;
 
-	dateNow.set_time_current();
+	dateNow.set_time(time(NULL));
 	dateCalendar->get_date(year, month, day);
 #ifdef DEBUG
 	cout << "dateDialog::getChoice: selected " << year << " " << month << " " << day << endl;

Modified: trunk/UI/GTK2/src/queryDialog.cc
===================================================================
--- trunk/UI/GTK2/src/queryDialog.cc	2007-01-12 12:57:13 UTC (rev 694)
+++ trunk/UI/GTK2/src/queryDialog.cc	2007-01-13 15:36:08 UTC (rev 695)
@@ -65,7 +65,7 @@
 	}
 	else
 	{
-		m_fromDate.set_time_current();
+		m_fromDate.set_time(time(NULL));
 	}
 	fromCheckbutton->set_active(enable);
 	fromButton->set_label(m_fromDate.format_string("%x"));
@@ -76,7 +76,7 @@
 	}
 	else
 	{
-		m_toDate.set_time_current();
+		m_toDate.set_time(time(NULL));
 	}
 	toCheckbutton->set_active(enable);
 	toButton->set_label(m_toDate.format_string("%x"));



From fabricecolin at mail.berlios.de  Sat Jan 20 05:41:03 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 20 Jan 2007 05:41:03 +0100
Subject: [Pinot-svn] r696 - in trunk: SQL UI/GTK2/src
Message-ID: <200701200441.l0K4f3lX008335@sheep.berlios.de>

Author: fabricecolin
Date: 2007-01-20 05:41:02 +0100 (Sat, 20 Jan 2007)
New Revision: 696

Modified:
   trunk/SQL/ViewHistory.cpp
   trunk/SQL/ViewHistory.h
   trunk/UI/GTK2/src/statisticsDialog.cc
Log:
Show how many results were viewed.


Modified: trunk/SQL/ViewHistory.cpp
===================================================================
--- trunk/SQL/ViewHistory.cpp	2007-01-13 15:36:08 UTC (rev 695)
+++ trunk/SQL/ViewHistory.cpp	2007-01-20 04:41:02 UTC (rev 696)
@@ -126,6 +126,28 @@
 	return success;
 }
 
+/// Returns the number of items.
+unsigned int ViewHistory::getItemsCount(void) const
+{
+	unsigned int count = 0;
+
+	SQLiteResults *results = executeStatement("SELECT COUNT(*) FROM ViewHistory;");
+	if (results != NULL)
+	{
+		SQLiteRow *row = results->nextRow();
+		if (row != NULL)
+		{
+			count = atoi(row->getColumn(0).c_str());
+
+			delete row;
+		}
+
+		delete results;
+	}
+
+	return count;
+}
+
 /// Deletes an URL.
 bool ViewHistory::deleteItem(const string &url)
 {

Modified: trunk/SQL/ViewHistory.h
===================================================================
--- trunk/SQL/ViewHistory.h	2007-01-13 15:36:08 UTC (rev 695)
+++ trunk/SQL/ViewHistory.h	2007-01-20 04:41:02 UTC (rev 696)
@@ -42,6 +42,9 @@
 		/// Checks if an URL is in the history.
 		bool hasItem(const string &url) const;
 
+		/// Returns the number of items.
+		unsigned int getItemsCount(void) const;
+
 		/// Deletes an URL.
 		bool deleteItem(const string &url);
 

Modified: trunk/UI/GTK2/src/statisticsDialog.cc
===================================================================
--- trunk/UI/GTK2/src/statisticsDialog.cc	2007-01-13 15:36:08 UTC (rev 695)
+++ trunk/UI/GTK2/src/statisticsDialog.cc	2007-01-20 04:41:02 UTC (rev 696)
@@ -26,6 +26,7 @@
 #include "NLS.h"
 #include "Url.h"
 #include "CrawlHistory.h"
+#include "ViewHistory.h"
 #include "PinotSettings.h"
 #include "PinotUtils.h"
 #include "statisticsDialog.hh"
@@ -56,7 +57,8 @@
 
 void statisticsDialog::populate(void)
 {
-	CrawlHistory history(PinotSettings::getInstance().m_historyDatabase);
+	CrawlHistory crawlerHistory(PinotSettings::getInstance().m_historyDatabase);
+	ViewHistory viewHistory(PinotSettings::getInstance().m_historyDatabase);
 	std::map<unsigned int, string> sources;
 	char countStr[64];
 	bool hasErrors = false;
@@ -95,15 +97,26 @@
 
 	folderIter = m_refStore->append();
 	row = *folderIter;
+	row[m_statsColumns.m_name] = _("History");
+
+	// Show view statistics
+	unsigned int viewCount = viewHistory.getItemsCount();
+	snprintf(countStr, 64, "%u", viewCount);
+	statIter = m_refStore->append(folderIter->children());
+	row = *statIter;
+	row[m_statsColumns.m_name] = ustring(countStr) + " " + _("results were viewed");
+
+	folderIter = m_refStore->append();
+	row = *folderIter;
 	row[m_statsColumns.m_name] = _("Crawler");
 
-	// Show statistics
-	unsigned int crawledFilesCount = history.getItemsCount(CrawlHistory::CRAWLED);
+	// Show crawler statistics
+	unsigned int crawledFilesCount = crawlerHistory.getItemsCount(CrawlHistory::CRAWLED);
 	snprintf(countStr, 64, "%u", crawledFilesCount);
 	statIter = m_refStore->append(folderIter->children());
 	row = *statIter;
 	row[m_statsColumns.m_name] = ustring(countStr) + " " + _("files were crawled");
-	unsigned int crawlingFilesCount = history.getItemsCount(CrawlHistory::CRAWLING);
+	unsigned int crawlingFilesCount = crawlerHistory.getItemsCount(CrawlHistory::CRAWLING);
 	snprintf(countStr, 64, "%u", crawlingFilesCount);
 	statIter = m_refStore->append(folderIter->children());
 	row = *statIter;
@@ -113,14 +126,14 @@
 	row = *errIter;
 	row[m_statsColumns.m_name] = _("Errors");
 
-	history.getSources(sources);
+	crawlerHistory.getSources(sources);
 	for (std::map<unsigned int, string>::iterator sourceIter = sources.begin();
 		sourceIter != sources.end(); ++sourceIter)
 	{
 		set<string> errors;
 
 		// Did any error occur on this source ?
-		unsigned int errorCount = history.getSourceItems(sourceIter->first, CrawlHistory::ERROR, errors);
+		unsigned int errorCount = crawlerHistory.getSourceItems(sourceIter->first, CrawlHistory::ERROR, errors);
 		if (errorCount > 0)
 		{
 			Url urlObj(sourceIter->second);



From fabricecolin at mail.berlios.de  Mon Jan 22 14:30:39 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Mon, 22 Jan 2007 14:30:39 +0100
Subject: [Pinot-svn] r697 - trunk/Tokenize
Message-ID: <200701221330.l0MDUdPZ025625@sheep.berlios.de>

Author: fabricecolin
Date: 2007-01-22 14:30:38 +0100 (Mon, 22 Jan 2007)
New Revision: 697

Modified:
   trunk/Tokenize/TokenizerFactory.cpp
Log:
Minor fix : application/xml is supported, not application/html.


Modified: trunk/Tokenize/TokenizerFactory.cpp
===================================================================
--- trunk/Tokenize/TokenizerFactory.cpp	2007-01-20 04:41:02 UTC (rev 696)
+++ trunk/Tokenize/TokenizerFactory.cpp	2007-01-22 13:30:38 UTC (rev 697)
@@ -323,7 +323,7 @@
 	// Is it a built-in type ?
 	if ((typeOnly == "text/html") ||
 		(typeOnly == "text/xml") ||
-		(typeOnly == "application/html") ||
+		(typeOnly == "application/xml") ||
 		(strncasecmp(typeOnly.c_str(), "text", 4) == 0))
 	{
 		return true;



From fabricecolin at mail.berlios.de  Mon Jan 22 14:50:31 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Mon, 22 Jan 2007 14:50:31 +0100
Subject: [Pinot-svn] r698 - trunk/UI/GTK2/src
Message-ID: <200701221350.l0MDoVPi026719@sheep.berlios.de>

Author: fabricecolin
Date: 2007-01-22 14:50:31 +0100 (Mon, 22 Jan 2007)
New Revision: 698

Modified:
   trunk/UI/GTK2/src/ResultsTree.cpp
   trunk/UI/GTK2/src/ResultsTree.h
   trunk/UI/GTK2/src/mainWindow.cc
Log:
When Results, Index is selected, skip results already indexed.
Clear the status bar when a notebook page is closed.


Modified: trunk/UI/GTK2/src/ResultsTree.cpp
===================================================================
--- trunk/UI/GTK2/src/ResultsTree.cpp	2007-01-22 13:30:38 UTC (rev 697)
+++ trunk/UI/GTK2/src/ResultsTree.cpp	2007-01-22 13:50:31 UTC (rev 698)
@@ -787,7 +787,7 @@
 //
 // Gets a list of selected items.
 //
-bool ResultsTree::getSelection(vector<DocumentInfo> &resultsList)
+bool ResultsTree::getSelection(vector<DocumentInfo> &resultsList, bool skipIndexed)
 {
 	list<TreeModel::Path> selectedItems = get_selection()->get_selected_rows();
 	if (selectedItems.empty() == true)
@@ -802,7 +802,9 @@
 		TreeModel::iterator iter = m_refStore->get_iter(*itemPath);
 		TreeModel::Row row = *iter;
 
-		if (row[m_resultsColumns.m_type] == ResultsModelColumns::RESULT_TITLE)
+		if ((row[m_resultsColumns.m_type] == ResultsModelColumns::RESULT_TITLE) &&
+			((skipIndexed == false) ||
+			(row[m_resultsColumns.m_indexed] = false)))
 		{
 			resultsList.push_back(DocumentInfo(from_utf8(row[m_resultsColumns.m_text]),
 				from_utf8(row[m_resultsColumns.m_url]), "", ""));

Modified: trunk/UI/GTK2/src/ResultsTree.h
===================================================================
--- trunk/UI/GTK2/src/ResultsTree.h	2007-01-22 13:30:38 UTC (rev 697)
+++ trunk/UI/GTK2/src/ResultsTree.h	2007-01-22 13:50:31 UTC (rev 698)
@@ -71,7 +71,7 @@
 		void setGroupMode(bool groupBySearchEngine);
 
 		/// Gets a list of selected items.
-		bool getSelection(std::vector<DocumentInfo> &resultsList);
+		bool getSelection(std::vector<DocumentInfo> &resultsList, bool skipIndexed = false);
 
 		/// Sets the selected items' state.
 		void setSelectionState(bool viewed, bool indexed);

Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2007-01-22 13:30:38 UTC (rev 697)
+++ trunk/UI/GTK2/src/mainWindow.cc	2007-01-22 13:50:31 UTC (rev 698)
@@ -818,6 +818,9 @@
 		show_global_menuitems(false);
 		show_selectionbased_menuitems(false);
 	}
+
+	// Reset
+	set_status("");
 }
 
 //
@@ -1823,13 +1826,6 @@
 {
 	vector<DocumentInfo> resultsList;
 
-	// Make sure this has been configured
-	if (m_settings.m_docsIndexLocation.empty() == true)
-	{
-		set_status(_("Please set a location for the index first"));
-		return;
-	}
-
 	NotebookPageBox *pNotebookPage = get_current_page();
 	if (pNotebookPage != NULL)
 	{
@@ -1839,7 +1835,7 @@
 			ResultsTree *pResultsTree = pResultsPage->getTree();
 			if (pResultsTree != NULL)
 			{
-				pResultsTree->getSelection(resultsList);
+				pResultsTree->getSelection(resultsList, true);
 
 				// Go through selected results
 				for (vector<DocumentInfo>::const_iterator resultIter = resultsList.begin();
@@ -1919,13 +1915,6 @@
 {
 	vector<IndexedDocument> documentsList;
 
-	// Make sure this has been configured
-	if (m_settings.m_docsIndexLocation.empty() == true)
-	{
-		set_status(_("Please set a location for the index first"));
-		return;
-	}
-
 	// Get the current documents selection
 	IndexPage *pIndexPage = dynamic_cast<IndexPage*>(get_current_page());
 	if (pIndexPage != NULL)



From fabricecolin at mail.berlios.de  Sat Jan 27 12:55:47 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 27 Jan 2007 12:55:47 +0100
Subject: [Pinot-svn] r699 - trunk/UI/GTK2/src
Message-ID: <200701271155.l0RBtl7f012444@sheep.berlios.de>

Author: fabricecolin
Date: 2007-01-27 12:55:39 +0100 (Sat, 27 Jan 2007)
New Revision: 699

Modified:
   trunk/UI/GTK2/src/statisticsDialog.cc
Log:
No need to show getItemsCount(CRAWLING).


Modified: trunk/UI/GTK2/src/statisticsDialog.cc
===================================================================
--- trunk/UI/GTK2/src/statisticsDialog.cc	2007-01-22 13:50:31 UTC (rev 698)
+++ trunk/UI/GTK2/src/statisticsDialog.cc	2007-01-27 11:55:39 UTC (rev 699)
@@ -42,7 +42,7 @@
 	m_refStore = TreeStore::create(m_statsColumns);
 	statisticsTreeview->set_model(m_refStore);
 
-	TreeViewColumn *pColumn = create_column(_("Statistics"), m_statsColumns.m_name, true, true, m_statsColumns.m_name);
+	TreeViewColumn *pColumn = create_column(_("Status"), m_statsColumns.m_name, true, true, m_statsColumns.m_name);
 	if (pColumn != NULL)
 	{
 		statisticsTreeview->append_column(*manage(pColumn));
@@ -116,11 +116,6 @@
 	statIter = m_refStore->append(folderIter->children());
 	row = *statIter;
 	row[m_statsColumns.m_name] = ustring(countStr) + " " + _("files were crawled");
-	unsigned int crawlingFilesCount = crawlerHistory.getItemsCount(CrawlHistory::CRAWLING);
-	snprintf(countStr, 64, "%u", crawlingFilesCount);
-	statIter = m_refStore->append(folderIter->children());
-	row = *statIter;
-	row[m_statsColumns.m_name] = ustring(countStr) + " " + _("files are being crawled");
 
 	TreeModel::iterator errIter = m_refStore->append(folderIter->children());
 	row = *errIter;



From fabricecolin at mail.berlios.de  Sat Jan 27 12:57:06 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sat, 27 Jan 2007 12:57:06 +0100
Subject: [Pinot-svn] r700 - trunk/UI/GTK2/src
Message-ID: <200701271157.l0RBv6dU015156@sheep.berlios.de>

Author: fabricecolin
Date: 2007-01-27 12:57:05 +0100 (Sat, 27 Jan 2007)
New Revision: 700

Modified:
   trunk/UI/GTK2/src/prefsDialog.cc
   trunk/UI/GTK2/src/prefsDialog.hh
Log:
Don't call DBusXapianIndex::getStatistics() here, this might freeze the UI
temporarily.


Modified: trunk/UI/GTK2/src/prefsDialog.cc
===================================================================
--- trunk/UI/GTK2/src/prefsDialog.cc	2007-01-27 11:55:39 UTC (rev 699)
+++ trunk/UI/GTK2/src/prefsDialog.cc	2007-01-27 11:57:05 UTC (rev 700)
@@ -25,7 +25,6 @@
 #include <gtkmm/messagedialog.h>
 
 #include "MIMEScanner.h"
-#include "DBusXapianIndex.h"
 #include "SearchEngineFactory.h"
 #include "QueryHistory.h"
 #include "config.h"
@@ -40,7 +39,8 @@
 
 prefsDialog::prefsDialog() :
 	prefsDialog_glade(),
-	m_settings(PinotSettings::getInstance())
+	m_settings(PinotSettings::getInstance()),
+	m_startDaemon(false)
 {
 	Color newColour;
 
@@ -124,6 +124,11 @@
 	return m_renamedLabels;
 }
 
+bool prefsDialog::startDaemon(void) const
+{
+	return m_startDaemon;
+}
+
 void prefsDialog::populate_labelsTreeview()
 {
 	TreeModel::iterator iter;
@@ -404,17 +409,9 @@
 	if ((startForDirectories == true) ||
 		(startForMail == true))
 	{
-		unsigned int crawledCount = 0, docsCount = 0;
-
 		// Save the settings
 		m_settings.save();
-		// ... and let D-Bus activate the service if necessary
-		// If it was already running, changes will take effect when it's restarted
-		DBusXapianIndex::getStatistics(crawledCount, docsCount);
-#ifdef DEBUG
-		cout << "prefsDialog::on_prefsOkbutton_clicked: crawled " << crawledCount
-			<< ", indexed " << docsCount << endl;
-#endif
+		m_startDaemon = true;
 	}
 }
 

Modified: trunk/UI/GTK2/src/prefsDialog.hh
===================================================================
--- trunk/UI/GTK2/src/prefsDialog.hh	2007-01-27 11:55:39 UTC (rev 699)
+++ trunk/UI/GTK2/src/prefsDialog.hh	2007-01-27 11:57:05 UTC (rev 700)
@@ -40,6 +40,8 @@
 
 	const std::map<std::string, std::string> &getLabelsToRename(void) const;
 
+	bool startDaemon(void) const;
+
 protected:
 	virtual void on_prefsOkbutton_clicked();
 	virtual void on_addLabelButton_clicked();
@@ -76,6 +78,7 @@
 	std::map<std::string, std::string> m_renamedLabels;
 	std::set<std::string> m_deletedDirectories;
 	std::set<std::string> m_deletedMail;
+	bool m_startDaemon;
 
 };
 #endif



From fabricecolin at mail.berlios.de  Sun Jan 28 06:05:30 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sun, 28 Jan 2007 06:05:30 +0100
Subject: [Pinot-svn] r701 - trunk/Index
Message-ID: <200701280505.l0S55U28030869@sheep.berlios.de>

Author: fabricecolin
Date: 2007-01-28 06:05:29 +0100 (Sun, 28 Jan 2007)
New Revision: 701

Modified:
   trunk/Index/DBusXapianIndex.cpp
   trunk/Index/DBusXapianIndex.h
   trunk/Index/IndexInterface.h
   trunk/Index/LanguageDetector.cpp
   trunk/Index/XapianDatabase.cpp
   trunk/Index/XapianIndex.cpp
   trunk/Index/XapianIndex.h
Log:
Added getDocumentTermsCount() to IndexInterface.
Minor fix to XapianDatabase::openDatabase().


Modified: trunk/Index/DBusXapianIndex.cpp
===================================================================
--- trunk/Index/DBusXapianIndex.cpp	2007-01-27 11:57:05 UTC (rev 700)
+++ trunk/Index/DBusXapianIndex.cpp	2007-01-28 05:05:29 UTC (rev 701)
@@ -169,6 +169,12 @@
 	return XapianIndex::getDocumentInfo(docId, docInfo);
 }
 
+/// Returns a document's terms count.
+unsigned int DBusXapianIndex::getDocumentTermsCount(unsigned int docId) const
+{
+	return XapianIndex::getDocumentTermsCount(docId);
+}
+
 /// Determines whether a document has a label.
 bool DBusXapianIndex::hasLabel(unsigned int docId, const string &name) const
 {

Modified: trunk/Index/DBusXapianIndex.h
===================================================================
--- trunk/Index/DBusXapianIndex.h	2007-01-27 11:57:05 UTC (rev 700)
+++ trunk/Index/DBusXapianIndex.h	2007-01-28 05:05:29 UTC (rev 701)
@@ -46,6 +46,9 @@
 		/// Returns a document's properties.
 		virtual bool getDocumentInfo(unsigned int docId, DocumentInfo &docInfo) const;
 
+		/// Returns a document's terms count.
+		virtual unsigned int getDocumentTermsCount(unsigned int docId) const;
+
 		/// Determines whether a document has a label.
 		virtual bool hasLabel(unsigned int docId, const std::string &name) const;
 

Modified: trunk/Index/IndexInterface.h
===================================================================
--- trunk/Index/IndexInterface.h	2007-01-27 11:57:05 UTC (rev 700)
+++ trunk/Index/IndexInterface.h	2007-01-28 05:05:29 UTC (rev 701)
@@ -50,6 +50,9 @@
 		/// Returns a document's properties.
 		virtual bool getDocumentInfo(unsigned int docId, DocumentInfo &docInfo) const = 0;
 
+		/// Returns a document's terms count.
+		virtual unsigned int getDocumentTermsCount(unsigned int docId) const = 0;
+
 		/// Determines whether a document has a label.
 		virtual bool hasLabel(unsigned int docId, const std::string &name) const = 0;
 

Modified: trunk/Index/LanguageDetector.cpp
===================================================================
--- trunk/Index/LanguageDetector.cpp	2007-01-27 11:57:05 UTC (rev 700)
+++ trunk/Index/LanguageDetector.cpp	2007-01-28 05:05:29 UTC (rev 701)
@@ -38,7 +38,7 @@
 using std::vector;
 using std::min;
 
-unsigned int LanguageDetector::m_maxTextSize = 10000;
+unsigned int LanguageDetector::m_maxTextSize = 1000;
 
 LanguageDetector::LanguageDetector()
 {

Modified: trunk/Index/XapianDatabase.cpp
===================================================================
--- trunk/Index/XapianDatabase.cpp	2007-01-27 11:57:05 UTC (rev 700)
+++ trunk/Index/XapianDatabase.cpp	2007-01-28 05:05:29 UTC (rev 701)
@@ -127,13 +127,16 @@
 
 	// Is it a remote database ?
 	string::size_type slashPos = m_databaseName.find("/");
-	if (slashPos != 0)
+	string::size_type colonPos = m_databaseName.find(":");
+	if (((slashPos == string::npos) ||
+		(slashPos > 0)) &&
+		(colonPos != string::npos))
 	{
 		Url urlObj(m_databaseName);
 
 		if (m_readOnly == false)
 		{
-			cerr << "XapianDatabase::openDatabase: remote databases are read-only" << endl;
+			cerr << "XapianDatabase::openDatabase: remote databases " << m_databaseName << " are read-only" << endl;
 			return;
 		}
 
@@ -145,7 +148,7 @@
 
 		string hostName(urlObj.getHost());
 		// A port number should be included
-		string::size_type colonPos = hostName.find(":");
+		colonPos = hostName.find(":");
 		if (colonPos != string::npos)
 		{
 			string protocol(urlObj.getProtocol());

Modified: trunk/Index/XapianIndex.cpp
===================================================================
--- trunk/Index/XapianIndex.cpp	2007-01-27 11:57:05 UTC (rev 700)
+++ trunk/Index/XapianIndex.cpp	2007-01-28 05:05:29 UTC (rev 701)
@@ -717,6 +717,44 @@
 	return foundDocument;
 }
 
+/// Returns a document's terms count.
+unsigned int XapianIndex::getDocumentTermsCount(unsigned int docId) const
+{
+	unsigned int termsCount = 0;
+
+	XapianDatabase *pDatabase = XapianDatabaseFactory::getDatabase(m_databaseName);
+	if (pDatabase == NULL)
+	{
+		cerr << "Bad index " << m_databaseName << endl;
+		return 0;
+	}
+
+	try
+	{
+		Xapian::Database *pIndex = pDatabase->readLock();
+		if (pIndex != NULL)
+		{
+			Xapian::Document doc = pIndex->get_document(docId);
+
+			termsCount = doc.termlist_count();
+#ifdef DEBUG
+			cout << "XapianIndex::getDocumentTermsCount: " << termsCount << " terms in document " << docId << endl;
+#endif
+		}
+	}
+	catch (const Xapian::Error &error)
+	{
+		cerr << "Couldn't get document terms count: " << error.get_type() << ": " << error.get_errno() << " " << error.get_msg() << endl;
+	}
+	catch (...)
+	{
+		cerr << "Couldn't get document terms count, unknown exception occured" << endl;
+	}
+	pDatabase->unlock();
+
+	return termsCount;
+}
+
 /// Determines whether a document has a label.
 bool XapianIndex::hasLabel(unsigned int docId, const string &name) const
 {

Modified: trunk/Index/XapianIndex.h
===================================================================
--- trunk/Index/XapianIndex.h	2007-01-27 11:57:05 UTC (rev 700)
+++ trunk/Index/XapianIndex.h	2007-01-28 05:05:29 UTC (rev 701)
@@ -44,6 +44,9 @@
 		/// Returns a document's properties.
 		virtual bool getDocumentInfo(unsigned int docId, DocumentInfo &docInfo) const;
 
+		/// Returns a document's terms count.
+		virtual unsigned int getDocumentTermsCount(unsigned int docId) const;
+
 		/// Determines whether a document has a label.
 		virtual bool hasLabel(unsigned int docId, const std::string &name) const;
 



From fabricecolin at mail.berlios.de  Sun Jan 28 06:10:33 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sun, 28 Jan 2007 06:10:33 +0100
Subject: [Pinot-svn] r702 - in trunk/UI/GTK2: . src
Message-ID: <200701280510.l0S5AXOE031015@sheep.berlios.de>

Author: fabricecolin
Date: 2007-01-28 06:10:32 +0100 (Sun, 28 Jan 2007)
New Revision: 702

Modified:
   trunk/UI/GTK2/metase-gtk2.glade
   trunk/UI/GTK2/src/IndexTree.cpp
   trunk/UI/GTK2/src/ModelColumns.cpp
   trunk/UI/GTK2/src/ModelColumns.h
   trunk/UI/GTK2/src/mainWindow.cc
   trunk/UI/GTK2/src/mainWindow_glade.cc
   trunk/UI/GTK2/src/propertiesDialog.cc
   trunk/UI/GTK2/src/propertiesDialog.hh
   trunk/UI/GTK2/src/propertiesDialog_glade.cc
   trunk/UI/GTK2/src/propertiesDialog_glade.hh
Log:
Show a document's size and terms count in propertiesDialog.
Some minor mods to the queries list.


Modified: trunk/UI/GTK2/metase-gtk2.glade
===================================================================
--- trunk/UI/GTK2/metase-gtk2.glade	2007-01-28 05:05:29 UTC (rev 701)
+++ trunk/UI/GTK2/metase-gtk2.glade	2007-01-28 05:10:32 UTC (rev 702)
@@ -48,7 +48,7 @@
 		  <child>
 		    <widget class="GtkMenuItem" id="statistics1">
 		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">Statistics</property>
+		      <property name="label" translatable="yes">Status</property>
 		      <property name="use_underline">True</property>
 		      <signal name="activate" handler="on_statistics_activate" last_modification_time="Sun, 31 Dec 2006 11:01:47 GMT"/>
 		    </widget>
@@ -2698,7 +2698,7 @@
 	  <child>
 	    <widget class="GtkTable" id="propertiesTable">
 	      <property name="visible">True</property>
-	      <property name="n_rows">3</property>
+	      <property name="n_rows">5</property>
 	      <property name="n_columns">2</property>
 	      <property name="homogeneous">False</property>
 	      <property name="row_spacing">0</property>
@@ -2729,6 +2729,48 @@
 	      </child>
 
 	      <child>
+		<widget class="GtkEntry" id="typeEntry">
+		  <property agent="glademm" name="cxx_visibility">protected</property>
+		  <property name="visible">True</property>
+		  <property name="can_focus">True</property>
+		  <property name="editable">False</property>
+		  <property name="visibility">True</property>
+		  <property name="max_length">0</property>
+		  <property name="text" translatable="yes"></property>
+		  <property name="has_frame">True</property>
+		  <property name="invisible_char">*</property>
+		  <property name="activates_default">False</property>
+		</widget>
+		<packing>
+		  <property name="left_attach">1</property>
+		  <property name="right_attach">2</property>
+		  <property name="top_attach">2</property>
+		  <property name="bottom_attach">3</property>
+		  <property name="x_padding">4</property>
+		  <property name="y_padding">4</property>
+		  <property name="y_options">fill</property>
+		</packing>
+	      </child>
+
+	      <child>
+		<widget class="GtkComboBox" id="languageCombobox">
+		  <property agent="glademm" name="cxx_visibility">protected</property>
+		  <property name="visible">True</property>
+		  <property name="add_tearoffs">False</property>
+		  <property name="focus_on_click">True</property>
+		</widget>
+		<packing>
+		  <property name="left_attach">1</property>
+		  <property name="right_attach">2</property>
+		  <property name="top_attach">1</property>
+		  <property name="bottom_attach">2</property>
+		  <property name="x_padding">4</property>
+		  <property name="y_padding">4</property>
+		  <property name="y_options">fill</property>
+		</packing>
+	      </child>
+
+	      <child>
 		<widget class="GtkLabel" id="titleLabel">
 		  <property agent="glademm" name="cxx_visibility">protected</property>
 		  <property name="visible">True</property>
@@ -2740,8 +2782,8 @@
 		  <property name="selectable">False</property>
 		  <property name="xalign">0</property>
 		  <property name="yalign">0.5</property>
-		  <property name="xpad">4</property>
-		  <property name="ypad">4</property>
+		  <property name="xpad">0</property>
+		  <property name="ypad">0</property>
 		  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
 		  <property name="width_chars">-1</property>
 		  <property name="single_line_mode">False</property>
@@ -2752,6 +2794,8 @@
 		  <property name="right_attach">1</property>
 		  <property name="top_attach">0</property>
 		  <property name="bottom_attach">1</property>
+		  <property name="x_padding">4</property>
+		  <property name="y_padding">4</property>
 		  <property name="x_options">fill</property>
 		  <property name="y_options">fill</property>
 		</packing>
@@ -2769,8 +2813,8 @@
 		  <property name="selectable">False</property>
 		  <property name="xalign">0</property>
 		  <property name="yalign">0.5</property>
-		  <property name="xpad">4</property>
-		  <property name="ypad">4</property>
+		  <property name="xpad">0</property>
+		  <property name="ypad">0</property>
 		  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
 		  <property name="width_chars">-1</property>
 		  <property name="single_line_mode">False</property>
@@ -2781,6 +2825,8 @@
 		  <property name="right_attach">1</property>
 		  <property name="top_attach">1</property>
 		  <property name="bottom_attach">2</property>
+		  <property name="x_padding">4</property>
+		  <property name="y_padding">4</property>
 		  <property name="x_options">fill</property>
 		  <property name="y_options">fill</property>
 		</packing>
@@ -2798,8 +2844,8 @@
 		  <property name="selectable">False</property>
 		  <property name="xalign">0</property>
 		  <property name="yalign">0.5</property>
-		  <property name="xpad">4</property>
-		  <property name="ypad">4</property>
+		  <property name="xpad">0</property>
+		  <property name="ypad">0</property>
 		  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
 		  <property name="width_chars">-1</property>
 		  <property name="single_line_mode">False</property>
@@ -2810,15 +2856,48 @@
 		  <property name="right_attach">1</property>
 		  <property name="top_attach">2</property>
 		  <property name="bottom_attach">3</property>
+		  <property name="x_padding">4</property>
+		  <property name="y_padding">4</property>
 		  <property name="x_options">fill</property>
 		  <property name="y_options">fill</property>
 		</packing>
 	      </child>
 
 	      <child>
-		<widget class="GtkEntry" id="typeEntry">
+		<widget class="GtkLabel" id="sizeLabel">
 		  <property agent="glademm" name="cxx_visibility">protected</property>
 		  <property name="visible">True</property>
+		  <property name="label" translatable="yes">Size:</property>
+		  <property name="use_underline">False</property>
+		  <property name="use_markup">False</property>
+		  <property name="justify">GTK_JUSTIFY_LEFT</property>
+		  <property name="wrap">False</property>
+		  <property name="selectable">False</property>
+		  <property name="xalign">0</property>
+		  <property name="yalign">0.5</property>
+		  <property name="xpad">0</property>
+		  <property name="ypad">0</property>
+		  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+		  <property name="width_chars">-1</property>
+		  <property name="single_line_mode">False</property>
+		  <property name="angle">0</property>
+		</widget>
+		<packing>
+		  <property name="left_attach">0</property>
+		  <property name="right_attach">1</property>
+		  <property name="top_attach">3</property>
+		  <property name="bottom_attach">4</property>
+		  <property name="x_padding">4</property>
+		  <property name="y_padding">4</property>
+		  <property name="x_options">fill</property>
+		  <property name="y_options">fill</property>
+		</packing>
+	      </child>
+
+	      <child>
+		<widget class="GtkEntry" id="sizeEntry">
+		  <property agent="glademm" name="cxx_visibility">protected</property>
+		  <property name="visible">True</property>
 		  <property name="can_focus">True</property>
 		  <property name="editable">False</property>
 		  <property name="visibility">True</property>
@@ -2831,8 +2910,8 @@
 		<packing>
 		  <property name="left_attach">1</property>
 		  <property name="right_attach">2</property>
-		  <property name="top_attach">2</property>
-		  <property name="bottom_attach">3</property>
+		  <property name="top_attach">3</property>
+		  <property name="bottom_attach">4</property>
 		  <property name="x_padding">4</property>
 		  <property name="y_padding">4</property>
 		  <property name="y_options">fill</property>
@@ -2840,22 +2919,59 @@
 	      </child>
 
 	      <child>
-		<widget class="GtkComboBox" id="languageCombobox">
+		<widget class="GtkEntry" id="termsEntry">
 		  <property agent="glademm" name="cxx_visibility">protected</property>
 		  <property name="visible">True</property>
-		  <property name="add_tearoffs">False</property>
-		  <property name="focus_on_click">True</property>
+		  <property name="can_focus">True</property>
+		  <property name="editable">False</property>
+		  <property name="visibility">True</property>
+		  <property name="max_length">0</property>
+		  <property name="text" translatable="yes"></property>
+		  <property name="has_frame">True</property>
+		  <property name="invisible_char">*</property>
+		  <property name="activates_default">False</property>
 		</widget>
 		<packing>
 		  <property name="left_attach">1</property>
 		  <property name="right_attach">2</property>
-		  <property name="top_attach">1</property>
-		  <property name="bottom_attach">2</property>
+		  <property name="top_attach">4</property>
+		  <property name="bottom_attach">5</property>
 		  <property name="x_padding">4</property>
 		  <property name="y_padding">4</property>
 		  <property name="y_options">fill</property>
 		</packing>
 	      </child>
+
+	      <child>
+		<widget class="GtkLabel" id="termsLabel">
+		  <property agent="glademm" name="cxx_visibility">protected</property>
+		  <property name="visible">True</property>
+		  <property name="label" translatable="yes">Terms:</property>
+		  <property name="use_underline">False</property>
+		  <property name="use_markup">False</property>
+		  <property name="justify">GTK_JUSTIFY_LEFT</property>
+		  <property name="wrap">False</property>
+		  <property name="selectable">False</property>
+		  <property name="xalign">0</property>
+		  <property name="yalign">0.5</property>
+		  <property name="xpad">0</property>
+		  <property name="ypad">0</property>
+		  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+		  <property name="width_chars">-1</property>
+		  <property name="single_line_mode">False</property>
+		  <property name="angle">0</property>
+		</widget>
+		<packing>
+		  <property name="left_attach">0</property>
+		  <property name="right_attach">1</property>
+		  <property name="top_attach">4</property>
+		  <property name="bottom_attach">5</property>
+		  <property name="x_padding">4</property>
+		  <property name="y_padding">4</property>
+		  <property name="x_options">fill</property>
+		  <property name="y_options">fill</property>
+		</packing>
+	      </child>
 	    </widget>
 	    <packing>
 	      <property name="padding">0</property>
@@ -2866,7 +2982,6 @@
 
 	  <child>
 	    <widget class="GtkScrolledWindow" id="labelsScrolledwindow">
-	      <property name="border_width">4</property>
 	      <property agent="glademm" name="cxx_visibility">protected</property>
 	      <property name="visible">True</property>
 	      <property name="can_focus">True</property>
@@ -3636,7 +3751,7 @@
 
 <widget class="GtkDialog" id="statisticsDialog">
   <property name="visible">True</property>
-  <property name="title" translatable="yes">Statistics</property>
+  <property name="title" translatable="yes">Status</property>
   <property name="type">GTK_WINDOW_TOPLEVEL</property>
   <property name="window_position">GTK_WIN_POS_NONE</property>
   <property name="modal">False</property>

Modified: trunk/UI/GTK2/src/IndexTree.cpp
===================================================================
--- trunk/UI/GTK2/src/IndexTree.cpp	2007-01-28 05:05:29 UTC (rev 701)
+++ trunk/UI/GTK2/src/IndexTree.cpp	2007-01-28 05:10:32 UTC (rev 702)
@@ -248,11 +248,15 @@
 	TreeModel::iterator iter = m_refStore->get_iter(*itemPath);
 	TreeModel::Row row = *iter;
 
-	return IndexedDocument(from_utf8(row[m_indexColumns.m_text]),
+	IndexedDocument indexedDoc(from_utf8(row[m_indexColumns.m_text]),
 		from_utf8(row[m_indexColumns.m_url]),
 		from_utf8(row[m_indexColumns.m_liveUrl]),
 		from_utf8(row[m_indexColumns.m_type]),
 		from_utf8(row[m_indexColumns.m_language]));
+	indexedDoc.setTimestamp(from_utf8(row[m_indexColumns.m_timestamp]));
+	indexedDoc.setSize(row[m_indexColumns.m_size]);
+
+	return indexedDoc;
 }
 
 //
@@ -273,10 +277,14 @@
 		TreeModel::iterator iter = m_refStore->get_iter(*itemPath);
 		TreeModel::Row row = *iter;
 
-		documentsList.push_back(DocumentInfo(from_utf8(row[m_indexColumns.m_text]),
+		DocumentInfo docInfo(from_utf8(row[m_indexColumns.m_text]),
 			from_utf8(row[m_indexColumns.m_liveUrl]),
 			from_utf8(row[m_indexColumns.m_type]),
-			from_utf8(row[m_indexColumns.m_language])));
+			from_utf8(row[m_indexColumns.m_language]));
+		docInfo.setTimestamp(from_utf8(row[m_indexColumns.m_timestamp]));
+		docInfo.setSize(row[m_indexColumns.m_size]);
+
+		documentsList.push_back(docInfo);
 	}
 #ifdef DEBUG
 	cout << "IndexTree::getSelection: " << documentsList.size() << " documents selected" << endl;
@@ -303,11 +311,15 @@
 		TreeModel::iterator iter = m_refStore->get_iter(*itemPath);
 		TreeModel::Row row = *iter;
 
-		documentsList.push_back(IndexedDocument(from_utf8(row[m_indexColumns.m_text]),
+		IndexedDocument indexedDoc(from_utf8(row[m_indexColumns.m_text]),
 			from_utf8(row[m_indexColumns.m_url]),
 			from_utf8(row[m_indexColumns.m_liveUrl]),
 			from_utf8(row[m_indexColumns.m_type]),
-			from_utf8(row[m_indexColumns.m_language])));
+			from_utf8(row[m_indexColumns.m_language]));
+		indexedDoc.setTimestamp(from_utf8(row[m_indexColumns.m_timestamp]));
+		indexedDoc.setSize(row[m_indexColumns.m_size]);
+
+		documentsList.push_back(indexedDoc);
 	}
 #ifdef DEBUG
 	cout << "IndexTree::getSelection: " << documentsList.size() << " documents selected" << endl;

Modified: trunk/UI/GTK2/src/ModelColumns.cpp
===================================================================
--- trunk/UI/GTK2/src/ModelColumns.cpp	2007-01-28 05:05:29 UTC (rev 701)
+++ trunk/UI/GTK2/src/ModelColumns.cpp	2007-01-28 05:10:32 UTC (rev 702)
@@ -82,6 +82,7 @@
 	add(m_id);
 	add(m_timestamp);
 	add(m_timestampTime);
+	add(m_size);
 }
 
 IndexModelColumns::~IndexModelColumns()

Modified: trunk/UI/GTK2/src/ModelColumns.h
===================================================================
--- trunk/UI/GTK2/src/ModelColumns.h	2007-01-28 05:05:29 UTC (rev 701)
+++ trunk/UI/GTK2/src/ModelColumns.h	2007-01-28 05:10:32 UTC (rev 702)
@@ -20,6 +20,7 @@
 #define _MODELCOLUMNS_HH
 
 #include <time.h>
+#include <sys/types.h>
 #include <glibmm/refptr.h>
 #include <glibmm/ustring.h>
 #include <gdkmm/event.h>
@@ -107,6 +108,7 @@
 	Gtk::TreeModelColumn<unsigned int> m_id;
 	Gtk::TreeModelColumn<Glib::ustring> m_timestamp;
 	Gtk::TreeModelColumn<time_t> m_timestampTime;
+	Gtk::TreeModelColumn<off_t> m_size;
 
 };
 

Modified: trunk/UI/GTK2/src/mainWindow.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow.cc	2007-01-28 05:05:29 UTC (rev 701)
+++ trunk/UI/GTK2/src/mainWindow.cc	2007-01-28 05:10:32 UTC (rev 702)
@@ -40,6 +40,7 @@
 #include "TimeConverter.h"
 #include "MIMEScanner.h"
 #include "Url.h"
+#include "DBusXapianIndex.h"
 #include "XapianDatabase.h"
 #include "QueryHistory.h"
 #include "ViewHistory.h"
@@ -234,7 +235,7 @@
 		TreeModel::Row row = *iter;
 		string queryName = queryIter->first;
 		string lastRun = history.getLastRun(queryName);
-		time_t lastRunTime = time(NULL);
+		time_t lastRunTime = 0;
 
 		row[m_queryColumns.m_name] = to_utf8(queryName);
 		if (lastRun.empty() == true)
@@ -254,7 +255,7 @@
 		}
 		else
 		{
-			row[m_queryColumns.m_summary] = _("<undefined>");
+			row[m_queryColumns.m_summary] = _("Undefined");
 		}
 		row[m_queryColumns.m_properties] = queryIter->second;
 
@@ -1443,6 +1444,21 @@
 		m_state.unlock_lists();
 	}
 
+	// Is starting the daemon necessary ?
+	if (prefsBox.startDaemon() == true)
+	{
+		unsigned int crawledCount = 0, docsCount = 0;
+
+		// ... and let D-Bus activate the service if necessary
+		// If it was already running, changes will take effect when it's restarted
+		// FIXME: put this in a thread
+		DBusXapianIndex::getStatistics(crawledCount, docsCount);
+#ifdef DEBUG
+		cout << "mainWindow::on_configure_activate: crawled " << crawledCount
+			<< ", indexed " << docsCount << endl;
+#endif
+	}
+
 	// Any labels to delete or rename ?
 	const set<string> &labelsToDelete = prefsBox.getLabelsToDelete();
 	const std::map<string, string> &labelsToRename = prefsBox.getLabelsToRename();
@@ -1970,7 +1986,7 @@
 	set<string> docLabels;
 	string indexName, labelName;
 	DocumentInfo docInfo;
-	unsigned int docId = 0;
+	unsigned int docId = 0, termsCount = 0;
 	int width, height;
 	bool matchedLabel = false, editDocument = false;
 
@@ -2031,6 +2047,7 @@
 		// by the tree for display purposes
 		pIndex->getDocumentInfo(docId, docInfo);
 		pIndex->getDocumentLabels(docId, docLabels);
+		termsCount = pIndex->getDocumentTermsCount(docId);
 
 		// Does it match the current label ?
 		if ((labelName.empty() == false) &&
@@ -2064,7 +2081,7 @@
 
 	// Let the user set the labels
 	get_size(width, height);
-	propertiesDialog propertiesBox(docLabels, docInfo, editDocument);
+	propertiesDialog propertiesBox(docLabels, docInfo, termsCount, editDocument);
 	propertiesBox.setHeight(height / 2);
 	propertiesBox.show();
 	if (propertiesBox.run() != RESPONSE_OK)

Modified: trunk/UI/GTK2/src/mainWindow_glade.cc
===================================================================
--- trunk/UI/GTK2/src/mainWindow_glade.cc	2007-01-28 05:05:29 UTC (rev 701)
+++ trunk/UI/GTK2/src/mainWindow_glade.cc	2007-01-28 05:10:32 UTC (rev 702)
@@ -158,7 +158,7 @@
    Gtk::HBox *mainHbox = Gtk::manage(new class Gtk::HBox(false, 0));
    Gtk::VBox *mainVbox = Gtk::manage(new class Gtk::VBox(false, 0));
    
-   sessionMenuitem_menu->items().push_back(Gtk::Menu_Helpers::MenuElem(_("Statistics")));
+   sessionMenuitem_menu->items().push_back(Gtk::Menu_Helpers::MenuElem(_("Status")));
    statistics1 = (Gtk::MenuItem *)&sessionMenuitem_menu->items().back();
    
    sessionMenuitem_menu->items().push_back(Gtk::Menu_Helpers::SeparatorElem());

Modified: trunk/UI/GTK2/src/propertiesDialog.cc
===================================================================
--- trunk/UI/GTK2/src/propertiesDialog.cc	2007-01-28 05:05:29 UTC (rev 701)
+++ trunk/UI/GTK2/src/propertiesDialog.cc	2007-01-28 05:10:32 UTC (rev 702)
@@ -16,6 +16,7 @@
  *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
  */
 
+#include <stdio.h>
 #include <iostream>
 #include <utility>
 
@@ -31,7 +32,7 @@
 using namespace Gtk;
 
 propertiesDialog::propertiesDialog(const std::set<std::string> &docLabels,
-	const DocumentInfo &docInfo, bool editDocument) :
+	const DocumentInfo &docInfo, unsigned int termsCount, bool editDocument) :
 	propertiesDialog_glade(),
 	m_editDocument(editDocument),
 	m_docInfo(docInfo)
@@ -54,8 +55,29 @@
 
 	if (m_editDocument == true)
 	{
+		unsigned int size = docInfo.getSize();
+		char numStr[128];
+
 		titleEntry->set_text(to_utf8(docInfo.getTitle()));
 		typeEntry->set_text(to_utf8(docInfo.getType()));
+		if (size == 0)
+		{
+			sizeEntry->set_text(_("Unknown"));
+		}
+		else
+		{
+			snprintf(numStr, 128, "%u", size);
+			sizeEntry->set_text(numStr);
+		}
+		if (termsCount == 0)
+		{
+			termsEntry->set_text(_("Unknown"));
+		}
+		else
+		{
+			snprintf(numStr, 128, "%u", termsCount);
+			termsEntry->set_text(numStr);
+		}
 	}
 	else
 	{
@@ -69,6 +91,10 @@
 		titleEntry->hide();
 		typeLabel->hide();
 		typeEntry->hide();
+		sizeLabel->hide();
+		sizeEntry->hide();
+		termsLabel->hide();
+		termsEntry->hide();
 	}
 
 	populate_languageCombobox(language, notALanguageName);

Modified: trunk/UI/GTK2/src/propertiesDialog.hh
===================================================================
--- trunk/UI/GTK2/src/propertiesDialog.hh	2007-01-28 05:05:29 UTC (rev 701)
+++ trunk/UI/GTK2/src/propertiesDialog.hh	2007-01-28 05:10:32 UTC (rev 702)
@@ -32,7 +32,8 @@
 {  
 public:
 	propertiesDialog(const std::set<std::string> &docLabels,
-		const DocumentInfo &docInfo, bool editDocument = true);
+		const DocumentInfo &docInfo, unsigned int termsCount,
+		bool editDocument = true);
 	virtual ~propertiesDialog();
 
 	void setHeight(int maxHeight);

Modified: trunk/UI/GTK2/src/propertiesDialog_glade.cc
===================================================================
--- trunk/UI/GTK2/src/propertiesDialog_glade.cc	2007-01-28 05:05:29 UTC (rev 701)
+++ trunk/UI/GTK2/src/propertiesDialog_glade.cc	2007-01-28 05:10:32 UTC (rev 702)
@@ -1,9 +1,9 @@
-// generated 2006/5/5 15:18:57 SGT by fabrice at amra.dyndns.org.(none)
+// generated 2007/1/22 22:28:26 SGT by fabrice at amra.dyndns.org.(none)
 // using glademm V2.12.1
 //
 // DO NOT EDIT THIS FILE ! It was created using
-// glade-- metase-gtk2.glade
-// for gtk 2.8.17 and gtkmm 2.8.3
+// glade-- /home/fabrice/Projects/MetaSE/pinot/UI/GTK2/metase-gtk2.glade
+// for gtk 2.10.4 and gtkmm 2.10.5
 //
 // Please modify the corresponding derived classes in ./src/propertiesDialog.cc
 
@@ -62,11 +62,15 @@
    Gtk::Button *cancelbutton2 = Gtk::manage(new class Gtk::Button(Gtk::StockID("gtk-cancel")));
    labelOkButton = Gtk::manage(new class Gtk::Button(Gtk::StockID("gtk-ok")));
    titleEntry = Gtk::manage(new class Gtk::Entry());
+   typeEntry = Gtk::manage(new class Gtk::Entry());
+   languageCombobox = Gtk::manage(new class Gtk::ComboBox());
    titleLabel = Gtk::manage(new class Gtk::Label(_("Title:")));
    languageLabel = Gtk::manage(new class Gtk::Label(_("Language:")));
    typeLabel = Gtk::manage(new class Gtk::Label(_("MIME type:")));
-   typeEntry = Gtk::manage(new class Gtk::Entry());
-   languageCombobox = Gtk::manage(new class Gtk::ComboBox());
+   sizeLabel = Gtk::manage(new class Gtk::Label(_("Size:")));
+   sizeEntry = Gtk::manage(new class Gtk::Entry());
+   termsEntry = Gtk::manage(new class Gtk::Entry());
+   termsLabel = Gtk::manage(new class Gtk::Label(_("Terms:")));
    
    Gtk::Table *propertiesTable = Gtk::manage(new class Gtk::Table(2, 2, false));
    labelsTreeview = Gtk::manage(new class Gtk::TreeView());
@@ -88,38 +92,66 @@
    titleEntry->set_max_length(0);
    titleEntry->set_has_frame(true);
    titleEntry->set_activates_default(false);
+   typeEntry->set_flags(Gtk::CAN_FOCUS);
+   typeEntry->set_visibility(true);
+   typeEntry->set_editable(false);
+   typeEntry->set_max_length(0);
+   typeEntry->set_has_frame(true);
+   typeEntry->set_activates_default(false);
    titleLabel->set_alignment(0,0.5);
-   titleLabel->set_padding(4,4);
+   titleLabel->set_padding(0,0);
    titleLabel->set_justify(Gtk::JUSTIFY_LEFT);
    titleLabel->set_line_wrap(false);
    titleLabel->set_use_markup(false);
    titleLabel->set_selectable(false);
    languageLabel->set_alignment(0,0.5);
-   languageLabel->set_padding(4,4);
+   languageLabel->set_padding(0,0);
    languageLabel->set_justify(Gtk::JUSTIFY_LEFT);
    languageLabel->set_line_wrap(false);
    languageLabel->set_use_markup(false);
    languageLabel->set_selectable(false);
    typeLabel->set_alignment(0,0.5);
-   typeLabel->set_padding(4,4);
+   typeLabel->set_padding(0,0);
    typeLabel->set_justify(Gtk::JUSTIFY_LEFT);
    typeLabel->set_line_wrap(false);
    typeLabel->set_use_markup(false);
    typeLabel->set_selectable(false);
-   typeEntry->set_flags(Gtk::CAN_FOCUS);
-   typeEntry->set_visibility(true);
-   typeEntry->set_editable(false);
-   typeEntry->set_max_length(0);
-   typeEntry->set_has_frame(true);
-   typeEntry->set_activates_default(false);
+   sizeLabel->set_alignment(0,0.5);
+   sizeLabel->set_padding(0,0);
+   sizeLabel->set_justify(Gtk::JUSTIFY_LEFT);
+   sizeLabel->set_line_wrap(false);
+   sizeLabel->set_use_markup(false);
+   sizeLabel->set_selectable(false);
+   sizeEntry->set_flags(Gtk::CAN_FOCUS);
+   sizeEntry->set_visibility(true);
+   sizeEntry->set_editable(false);
+   sizeEntry->set_max_length(0);
+   sizeEntry->set_has_frame(true);
+   sizeEntry->set_activates_default(false);
+   termsEntry->set_flags(Gtk::CAN_FOCUS);
+   termsEntry->set_visibility(true);
+   termsEntry->set_editable(false);
+   termsEntry->set_max_length(0);
+   termsEntry->set_has_frame(true);
+   termsEntry->set_activates_default(false);
+   termsLabel->set_alignment(0,0.5);
+   termsLabel->set_padding(0,0);
+   termsLabel->set_justify(Gtk::JUSTIFY_LEFT);
+   termsLabel->set_line_wrap(false);
+   termsLabel->set_use_markup(false);
+   termsLabel->set_selectable(false);
    propertiesTable->set_row_spacings(0);
    propertiesTable->set_col_spacings(0);
    propertiesTable->attach(*titleEntry, 1, 2, 0, 1, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
-   propertiesTable->attach(*titleLabel, 0, 1, 0, 1, Gtk::FILL, Gtk::FILL, 0, 0);
-   propertiesTable->attach(*languageLabel, 0, 1, 1, 2, Gtk::FILL, Gtk::FILL, 0, 0);
-   propertiesTable->attach(*typeLabel, 0, 1, 2, 3, Gtk::FILL, Gtk::FILL, 0, 0);
    propertiesTable->attach(*typeEntry, 1, 2, 2, 3, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
    propertiesTable->attach(*languageCombobox, 1, 2, 1, 2, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
+   propertiesTable->attach(*titleLabel, 0, 1, 0, 1, Gtk::FILL, Gtk::FILL, 4, 4);
+   propertiesTable->attach(*languageLabel, 0, 1, 1, 2, Gtk::FILL, Gtk::FILL, 4, 4);
+   propertiesTable->attach(*typeLabel, 0, 1, 2, 3, Gtk::FILL, Gtk::FILL, 4, 4);
+   propertiesTable->attach(*sizeLabel, 0, 1, 3, 4, Gtk::FILL, Gtk::FILL, 4, 4);
+   propertiesTable->attach(*sizeEntry, 1, 2, 3, 4, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
+   propertiesTable->attach(*termsEntry, 1, 2, 4, 5, Gtk::EXPAND|Gtk::FILL, Gtk::FILL, 4, 4);
+   propertiesTable->attach(*termsLabel, 0, 1, 4, 5, Gtk::FILL, Gtk::FILL, 4, 4);
    labelsTreeview->set_flags(Gtk::CAN_FOCUS);
    labelsTreeview->set_headers_visible(true);
    labelsTreeview->set_rules_hint(false);
@@ -133,7 +165,6 @@
    viewport1->set_shadow_type(Gtk::SHADOW_IN);
    viewport1->add(*labelsTreeview);
    labelsScrolledwindow->set_flags(Gtk::CAN_FOCUS);
-   labelsScrolledwindow->set_border_width(4);
    labelsScrolledwindow->set_shadow_type(Gtk::SHADOW_NONE);
    labelsScrolledwindow->set_policy(Gtk::POLICY_AUTOMATIC, Gtk::POLICY_AUTOMATIC);
    labelsScrolledwindow->property_window_placement().set_value(Gtk::CORNER_TOP_LEFT);
@@ -154,11 +185,15 @@
    cancelbutton2->show();
    labelOkButton->show();
    titleEntry->show();
+   typeEntry->show();
+   languageCombobox->show();
    titleLabel->show();
    languageLabel->show();
    typeLabel->show();
-   typeEntry->show();
-   languageCombobox->show();
+   sizeLabel->show();
+   sizeEntry->show();
+   termsEntry->show();
+   termsLabel->show();
    propertiesTable->show();
    labelsTreeview->show();
    viewport1->show();

Modified: trunk/UI/GTK2/src/propertiesDialog_glade.hh
===================================================================
--- trunk/UI/GTK2/src/propertiesDialog_glade.hh	2007-01-28 05:05:29 UTC (rev 701)
+++ trunk/UI/GTK2/src/propertiesDialog_glade.hh	2007-01-28 05:10:32 UTC (rev 702)
@@ -1,9 +1,9 @@
-// generated 2006/5/5 15:18:57 SGT by fabrice at amra.dyndns.org.(none)
+// generated 2007/1/22 22:22:59 SGT by fabrice at amra.dyndns.org.(none)
 // using glademm V2.12.1
 //
 // DO NOT EDIT THIS FILE ! It was created using
-// glade-- metase-gtk2.glade
-// for gtk 2.8.17 and gtkmm 2.8.3
+// glade-- /home/fabrice/Projects/MetaSE/pinot/UI/GTK2/metase-gtk2.glade
+// for gtk 2.10.4 and gtkmm 2.10.5
 //
 // Please modify the corresponding derived classes in ./src/propertiesDialog.hh and./src/propertiesDialog.cc
 
@@ -34,8 +34,8 @@
 #include <gtkmm/dialog.h>
 #include <gtkmm/button.h>
 #include <gtkmm/entry.h>
+#include <gtkmm/combobox.h>
 #include <gtkmm/label.h>
-#include <gtkmm/combobox.h>
 #include <gtkmm/treeview.h>
 #include <gtkmm/scrolledwindow.h>
 
@@ -48,11 +48,15 @@
 protected:
         class Gtk::Button * labelOkButton;
         class Gtk::Entry * titleEntry;
+        class Gtk::Entry * typeEntry;
+        class Gtk::ComboBox * languageCombobox;
         class Gtk::Label * titleLabel;
         class Gtk::Label * languageLabel;
         class Gtk::Label * typeLabel;
-        class Gtk::Entry * typeEntry;
-        class Gtk::ComboBox * languageCombobox;
+        class Gtk::Label * sizeLabel;
+        class Gtk::Entry * sizeEntry;
+        class Gtk::Entry * termsEntry;
+        class Gtk::Label * termsLabel;
         class Gtk::TreeView * labelsTreeview;
         class Gtk::ScrolledWindow * labelsScrolledwindow;
         



From fabricecolin at mail.berlios.de  Sun Jan 28 06:13:07 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sun, 28 Jan 2007 06:13:07 +0100
Subject: [Pinot-svn] r703 - trunk/UI/GTK2/src
Message-ID: <200701280513.l0S5D7SU031101@sheep.berlios.de>

Author: fabricecolin
Date: 2007-01-28 06:13:07 +0100 (Sun, 28 Jan 2007)
New Revision: 703

Modified:
   trunk/UI/GTK2/src/statisticsDialog.cc
   trunk/UI/GTK2/src/statisticsDialog_glade.cc
Log:
Changed title to Status. Errors rows are collapsed by default and the Indexes
row is selected.


Modified: trunk/UI/GTK2/src/statisticsDialog.cc
===================================================================
--- trunk/UI/GTK2/src/statisticsDialog.cc	2007-01-28 05:10:32 UTC (rev 702)
+++ trunk/UI/GTK2/src/statisticsDialog.cc	2007-01-28 05:13:07 UTC (rev 703)
@@ -66,6 +66,7 @@
 	TreeModel::iterator folderIter = m_refStore->append();
 	TreeModel::Row row = *folderIter;
 	row[m_statsColumns.m_name] = _("Indexes");
+	statisticsTreeview->get_selection()->select(folderIter);
 
 	TreeModel::iterator statIter = m_refStore->append(folderIter->children());
 	row = *statIter;
@@ -104,7 +105,7 @@
 	snprintf(countStr, 64, "%u", viewCount);
 	statIter = m_refStore->append(folderIter->children());
 	row = *statIter;
-	row[m_statsColumns.m_name] = ustring(countStr) + " " + _("results were viewed");
+	row[m_statsColumns.m_name] = ustring(_("Viewed")) + " " + countStr + " " + _("results");
 
 	folderIter = m_refStore->append();
 	row = *folderIter;
@@ -115,7 +116,7 @@
 	snprintf(countStr, 64, "%u", crawledFilesCount);
 	statIter = m_refStore->append(folderIter->children());
 	row = *statIter;
-	row[m_statsColumns.m_name] = ustring(countStr) + " " + _("files were crawled");
+	row[m_statsColumns.m_name] = ustring(_("Crawled")) + " " + countStr + " " + _("files");
 
 	TreeModel::iterator errIter = m_refStore->append(folderIter->children());
 	row = *errIter;
@@ -164,7 +165,10 @@
 		row[m_statsColumns.m_name] = _("None");
 	}
 
+	// Expand everything except errors
 	statisticsTreeview->expand_all();
+	TreeModel::Path errPath = m_refStore->get_path(errIter);
+	statisticsTreeview->collapse_row(errPath);
 
 	Adjustment *pAdjustement = statisticsScrolledwindow->get_hadjustment();
 #ifdef DEBUG

Modified: trunk/UI/GTK2/src/statisticsDialog_glade.cc
===================================================================
--- trunk/UI/GTK2/src/statisticsDialog_glade.cc	2007-01-28 05:10:32 UTC (rev 702)
+++ trunk/UI/GTK2/src/statisticsDialog_glade.cc	2007-01-28 05:13:07 UTC (rev 703)
@@ -84,7 +84,7 @@
    statisticsDialog->get_vbox()->set_homogeneous(false);
    statisticsDialog->get_vbox()->set_spacing(0);
    statisticsDialog->get_vbox()->pack_start(*statisticsScrolledwindow);
-   statisticsDialog->set_title(_("Statistics"));
+   statisticsDialog->set_title(_("Status"));
    statisticsDialog->set_default_size(150,350);
    statisticsDialog->set_modal(false);
    statisticsDialog->property_window_position().set_value(Gtk::WIN_POS_NONE);



From fabricecolin at mail.berlios.de  Sun Jan 28 06:23:32 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Sun, 28 Jan 2007 06:23:32 +0100
Subject: [Pinot-svn] r704 - trunk/po
Message-ID: <200701280523.l0S5NWm9031410@sheep.berlios.de>

Author: fabricecolin
Date: 2007-01-28 06:23:31 +0100 (Sun, 28 Jan 2007)
New Revision: 704

Modified:
   trunk/po/fr.po
Log:
Synced to current source.


Modified: trunk/po/fr.po
===================================================================
--- trunk/po/fr.po	2007-01-28 05:13:07 UTC (rev 703)
+++ trunk/po/fr.po	2007-01-28 05:23:31 UTC (rev 704)
@@ -9,7 +9,7 @@
 "Project-Id-Version: pinot 0.65\n"
 "Report-Msgid-Bugs-To: \n"
 "POT-Creation-Date: 2006-11-29 15:09+0000\n"
-"PO-Revision-Date: 2006-12-20 21:10+0800\n"
+"PO-Revision-Date: 2007-01-27 20:02+0800\n"
 "Last-Translator: Fabrice Colin <fabricecolin at users.berlios.de>\n"
 "Language-Team: fr <fabricecolin at users.berlios.de>\n"
 "MIME-Version: 1.0\n"
@@ -25,76 +25,97 @@
 msgid "Current User"
 msgstr "Utilisateur"
 
-#: UI/GTK2/src/EnginesTree.cpp:339 UI/GTK2/src/mainWindow.cc:322
-#: UI/GTK2/src/mainWindow.cc:325 UI/GTK2/src/mainWindow.cc:551
-#: UI/GTK2/src/mainWindow.cc:1205 UI/GTK2/src/mainWindow.cc:1248
-#: UI/GTK2/src/mainWindow.cc:1268 UI/GTK2/src/mainWindow.cc:1299
-#: UI/GTK2/src/mainWindow.cc:1869 UI/GTK2/src/PinotSettings.cpp:240
-#: UI/GTK2/src/PinotSettings.cpp:1230 UI/GTK2/src/PinotSettings.cpp:1286
+#: UI/GTK2/src/EnginesTree.cpp:339 UI/GTK2/src/mainWindow.cc:325
+#: UI/GTK2/src/mainWindow.cc:328 UI/GTK2/src/mainWindow.cc:554
+#: UI/GTK2/src/mainWindow.cc:1211 UI/GTK2/src/mainWindow.cc:1254
+#: UI/GTK2/src/mainWindow.cc:1274 UI/GTK2/src/mainWindow.cc:1305
+#: UI/GTK2/src/mainWindow.cc:1892 UI/GTK2/src/PinotSettings.cpp:241
+#: UI/GTK2/src/PinotSettings.cpp:1283 UI/GTK2/src/PinotSettings.cpp:1339
+#: UI/GTK2/src/statisticsDialog.cc:86
 msgid "My Web Pages"
 msgstr "Mes Pages Web"
 
-#: UI/GTK2/src/EnginesTree.cpp:340 UI/GTK2/src/mainWindow.cc:316
-#: UI/GTK2/src/mainWindow.cc:319 UI/GTK2/src/PinotSettings.cpp:241
-#: UI/GTK2/src/PinotSettings.cpp:1231 UI/GTK2/src/PinotSettings.cpp:1287
+#: UI/GTK2/src/EnginesTree.cpp:340 UI/GTK2/src/mainWindow.cc:319
+#: UI/GTK2/src/mainWindow.cc:322 UI/GTK2/src/PinotSettings.cpp:242
+#: UI/GTK2/src/PinotSettings.cpp:1284 UI/GTK2/src/PinotSettings.cpp:1340
+#: UI/GTK2/src/statisticsDialog.cc:72
 msgid "My Documents"
 msgstr "Mes Documents"
 
-#: UI/GTK2/src/importDialog.cc:83 UI/GTK2/src/queryDialog.cc:81
-msgid "None"
-msgstr "Aucune"
+#: UI/GTK2/src/dateDialog_glade.cc:76 UI/GTK2/src/queryDialog_glade.cc:91
+#: UI/GTK2/src/queryDialog_glade.cc:92
+#, fuzzy
+msgid "Date"
+msgstr "Date"
 
-#: UI/GTK2/src/importDialog_glade.cc:67 UI/GTK2/src/indexDialog_glade.cc:68
-msgid "Location:"
-msgstr "Chemin:"
+#: UI/GTK2/src/indexDialog.cc:130
+msgid "Served by"
+msgstr "Servi par"
 
-#: UI/GTK2/src/importDialog_glade.cc:68
-#: UI/GTK2/src/propertiesDialog_glade.cc:65
-msgid "Title:"
-msgstr "Titre:"
+#: UI/GTK2/src/indexDialog.cc:134
+msgid "Local"
+msgstr "Local"
 
-#: UI/GTK2/src/importDialog_glade.cc:71
-msgid "Apply label:"
-msgstr "Appliquer l'etiquette:"
-
-#: UI/GTK2/src/importDialog_glade.cc:77
-msgid "Import"
-msgstr "Importer"
-
-#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:213
-msgid "Import URL"
-msgstr "Importer une URL"
-
-#: UI/GTK2/src/indexDialog.cc:225
+#: UI/GTK2/src/indexDialog.cc:300
 msgid "Index location"
 msgstr "Chemin de l'index"
 
-#: UI/GTK2/src/indexDialog_glade.cc:62 UI/GTK2/src/queryDialog_glade.cc:68
+#: UI/GTK2/src/indexDialog_glade.cc:65 UI/GTK2/src/queryDialog_glade.cc:68
 msgid "Name:"
 msgstr "Nom:"
 
-#: UI/GTK2/src/indexDialog_glade.cc:64
+#: UI/GTK2/src/indexDialog_glade.cc:67
 msgid "..."
 msgstr "..."
 
-#: UI/GTK2/src/indexDialog_glade.cc:67
+#: UI/GTK2/src/indexDialog_glade.cc:70
 msgid "Type:"
 msgstr "Type:"
 
-#: UI/GTK2/src/indexDialog_glade.cc:69
+#: UI/GTK2/src/indexDialog_glade.cc:71 UI/GTK2/src/importDialog_glade.cc:67
+msgid "Location:"
+msgstr "Chemin:"
+
+#: UI/GTK2/src/indexDialog_glade.cc:72
 msgid "Port:"
 msgstr "Port:"
 
-#: UI/GTK2/src/indexDialog_glade.cc:143
+#: UI/GTK2/src/indexDialog_glade.cc:79
+msgid "Host name:"
+msgstr "Nom de machine:"
+
+#: UI/GTK2/src/indexDialog_glade.cc:163
 msgid "External index"
 msgstr "Index externe"
 
-#: UI/GTK2/src/IndexTree.cpp:68 UI/GTK2/src/queryDialog.cc:112
+#: UI/GTK2/src/importDialog.cc:82 UI/GTK2/src/queryDialog.cc:108
+#: UI/GTK2/src/statisticsDialog.cc:164
+msgid "None"
+msgstr "Aucune"
+
+#: UI/GTK2/src/importDialog_glade.cc:68
+#: UI/GTK2/src/propertiesDialog_glade.cc:67
+msgid "Title:"
+msgstr "Titre:"
+
+#: UI/GTK2/src/importDialog_glade.cc:71
+msgid "Apply label:"
+msgstr "Appliquer l'etiquette:"
+
+#: UI/GTK2/src/importDialog_glade.cc:77
+msgid "Import"
+msgstr "Importer"
+
+#: UI/GTK2/src/importDialog_glade.cc:148 UI/GTK2/src/mainWindow_glade.cc:221
+msgid "Import URL"
+msgstr "Importer une URL"
+
+#: UI/GTK2/src/IndexTree.cpp:68 UI/GTK2/src/queryDialog.cc:139
 #: UI/GTK2/src/ResultsTree.cpp:126
 msgid "Title"
 msgstr "Titre"
 
-#: UI/GTK2/src/IndexTree.cpp:73 UI/GTK2/src/queryDialog.cc:115
+#: UI/GTK2/src/IndexTree.cpp:73 UI/GTK2/src/queryDialog.cc:142
 #: UI/GTK2/src/ResultsTree.cpp:136
 msgid "URL"
 msgstr "URL"
@@ -115,379 +136,401 @@
 msgid "All labels"
 msgstr "Toutes les etiquettes"
 
-#: UI/GTK2/src/mainWindow.cc:138
+#: UI/GTK2/src/launcherDialog_glade.cc:64
+msgid ""
+"There is no helper application defined for this document's type.\n"
+"Please enter the command to open this document."
+msgstr ""
+"Il n'y a pas d'application definie pour les documents de ce type.\n"
+"Veuillez entrer la commande a utiliser pour ouvrir ce document."
+
+#: UI/GTK2/src/launcherDialog_glade.cc:67
+msgid "Use this command for other documents of the same type."
+msgstr "Utiliser cette commande pour tout autre document de ce type."
+
+#: UI/GTK2/src/launcherDialog_glade.cc:99
+msgid "Helper application"
+msgstr "Application"
+
+#: UI/GTK2/src/mainWindow.cc:141
 msgid "Query Name"
 msgstr "Nom de la Recherche"
 
-#: UI/GTK2/src/mainWindow.cc:143
+#: UI/GTK2/src/mainWindow.cc:146
 msgid "Last Run"
 msgstr "Derniere Utilisation"
 
-#: UI/GTK2/src/mainWindow.cc:148
+#: UI/GTK2/src/mainWindow.cc:151
 msgid "Summary"
 msgstr "Sommaire"
 
-#: UI/GTK2/src/mainWindow.cc:181
+#: UI/GTK2/src/mainWindow.cc:184
 msgid "Show all search engines"
 msgstr "Montrer tous les moteurs"
 
-#: UI/GTK2/src/mainWindow.cc:182
+#: UI/GTK2/src/mainWindow.cc:185
 msgid "Add index"
 msgstr "Ajouter un index"
 
-#: UI/GTK2/src/mainWindow.cc:183
+#: UI/GTK2/src/mainWindow.cc:186
 msgid "Remove index"
 msgstr "Enlever un index"
 
-#: UI/GTK2/src/mainWindow.cc:189
+#: UI/GTK2/src/mainWindow.cc:192
 msgid "Ready"
 msgstr "Pret"
 
-#: UI/GTK2/src/mainWindow.cc:240
+#: UI/GTK2/src/mainWindow.cc:243
 msgid "N/A"
 msgstr "Inconnue"
 
-#: UI/GTK2/src/mainWindow.cc:255
-msgid "<undefined>"
-msgstr "<inconnu>"
+#: UI/GTK2/src/mainWindow.cc:258
+msgid "Undefined"
+msgstr "Indefini"
 
-#: UI/GTK2/src/mainWindow.cc:474
+#: UI/GTK2/src/mainWindow.cc:477
 msgid "Result location is"
 msgstr "Le chemin du resultat est"
 
-#: UI/GTK2/src/mainWindow.cc:561
+#: UI/GTK2/src/mainWindow.cc:564
 msgid "Document location is"
 msgstr "Le chemin du document is"
 
-#: UI/GTK2/src/mainWindow.cc:884
+#: UI/GTK2/src/mainWindow.cc:890
 msgid "Showing"
 msgstr ""
 
-#: UI/GTK2/src/mainWindow.cc:889
+#: UI/GTK2/src/mainWindow.cc:895
 msgid "of"
 msgstr "documents,"
 
-#: UI/GTK2/src/mainWindow.cc:894
+#: UI/GTK2/src/mainWindow.cc:900
 msgid "documents, starting at"
 msgstr "au total, a partir de"
 
-#: UI/GTK2/src/mainWindow.cc:927
+#: UI/GTK2/src/mainWindow.cc:933
 msgid "Query"
 msgstr "La recherche"
 
-#: UI/GTK2/src/mainWindow.cc:931 UI/GTK2/src/mainWindow.cc:2937
+#: UI/GTK2/src/mainWindow.cc:937 UI/GTK2/src/mainWindow.cc:2955
 msgid "on"
 msgstr "sur"
 
-#: UI/GTK2/src/mainWindow.cc:935
+#: UI/GTK2/src/mainWindow.cc:941
 msgid "ended"
 msgstr "est terminee"
 
-#: UI/GTK2/src/mainWindow.cc:1070
+#: UI/GTK2/src/mainWindow.cc:1076
 msgid "More Like"
 msgstr "Similaire a"
 
-#: UI/GTK2/src/mainWindow.cc:1131
+#: UI/GTK2/src/mainWindow.cc:1137
 msgid "Updated label(s)"
 msgstr "Mis a jour l(es) etiquette(s)"
 
-#: UI/GTK2/src/mainWindow.cc:1215
+#: UI/GTK2/src/mainWindow.cc:1221
 msgid "Updated document"
 msgstr "Mis a jour le document"
 
-#: UI/GTK2/src/mainWindow.cc:1228
+#: UI/GTK2/src/mainWindow.cc:1234
 msgid "Indexed"
 msgstr "Indexe"
 
-#: UI/GTK2/src/mainWindow.cc:1269
+#: UI/GTK2/src/mainWindow.cc:1275
 msgid "Unindexed document(s)"
 msgstr "Desindexe le(s) document(s)"
 
-#: UI/GTK2/src/mainWindow.cc:1310
+#: UI/GTK2/src/mainWindow.cc:1316
 msgid "Updated document properties"
 msgstr "Mis a jour les proprietes du document"
 
-#: UI/GTK2/src/mainWindow.cc:1357
+#: UI/GTK2/src/mainWindow.cc:1363
 msgid "Couldn't rename index, name"
 msgstr "N'a pas pu renommer l'index, le nom"
 
-#: UI/GTK2/src/mainWindow.cc:1361 UI/GTK2/src/mainWindow.cc:2261
-#: UI/GTK2/src/mainWindow.cc:2772
+#: UI/GTK2/src/mainWindow.cc:1367 UI/GTK2/src/mainWindow.cc:2279
+#: UI/GTK2/src/mainWindow.cc:2790
 msgid "is already in use"
 msgstr "est deja utilise"
 
-#: UI/GTK2/src/mainWindow.cc:1374
+#: UI/GTK2/src/mainWindow.cc:1380
 msgid "Couldn't rename index"
 msgstr "N'a pas pu renommer l'index"
 
-#: UI/GTK2/src/mainWindow.cc:1387
+#: UI/GTK2/src/mainWindow.cc:1393
 msgid "Edited index"
 msgstr "Edite l'index"
 
-#: UI/GTK2/src/mainWindow.cc:1747 UI/GTK2/src/mainWindow.cc:2431
+#: UI/GTK2/src/mainWindow.cc:1777 UI/GTK2/src/mainWindow.cc:2449
 msgid "Live query"
 msgstr "Recherche"
 
-#: UI/GTK2/src/mainWindow.cc:1773
+#: UI/GTK2/src/mainWindow.cc:1803
 msgid "Couldn't find query"
 msgstr "N'a pas pu trouver"
 
-#: UI/GTK2/src/mainWindow.cc:1817 UI/GTK2/src/mainWindow.cc:1913
-msgid "Please set a location for the index first"
-msgstr "Donnez un chemin a l'index"
-
-#: UI/GTK2/src/mainWindow.cc:1992 UI/GTK2/src/WorkerThreads.cpp:671
-#: UI/GTK2/src/WorkerThreads.cpp:1518
+#: UI/GTK2/src/mainWindow.cc:2008 UI/GTK2/src/WorkerThreads.cpp:670
+#: UI/GTK2/src/WorkerThreads.cpp:1517
 msgid "Index"
 msgstr "L'index"
 
-#: UI/GTK2/src/mainWindow.cc:1996 UI/GTK2/src/WorkerThreads.cpp:675
-#: UI/GTK2/src/WorkerThreads.cpp:1522
+#: UI/GTK2/src/mainWindow.cc:2012 UI/GTK2/src/WorkerThreads.cpp:674
+#: UI/GTK2/src/WorkerThreads.cpp:1521
 msgid "doesn't exist"
 msgstr "n'existe pas"
 
-#: UI/GTK2/src/mainWindow.cc:2149
+#: UI/GTK2/src/mainWindow.cc:2166
 msgid "Remove this document from the index ?"
 msgstr "Enlever ce document de l'index ?"
 
-#: UI/GTK2/src/mainWindow.cc:2168
+#: UI/GTK2/src/mainWindow.cc:2185
 msgid "Remove these documents from the index ?"
 msgstr "Enlever ces documents de l'index ?"
 
-#: UI/GTK2/src/mainWindow.cc:2212
+#: UI/GTK2/src/mainWindow.cc:2229
 msgid "A metasearch tool for the Free Desktop"
 msgstr "Un outil de recherche pour le Bureau Libre"
 
-#: UI/GTK2/src/mainWindow.cc:2213
-msgid "(C) 2005-2006 Fabrice Colin"
-msgstr "(C) 2005-2006 Fabrice Colin"
+#: UI/GTK2/src/mainWindow.cc:2230
+msgid "Search the Web and your documents !"
+msgstr "Cherche le Web et vos documents"
 
-#: UI/GTK2/src/mainWindow.cc:2257
+#: UI/GTK2/src/mainWindow.cc:2231
+msgid "(C) 2005 Fabrice Colin"
+msgstr "(C) 2005 Fabrice Colin"
+
+#: UI/GTK2/src/mainWindow.cc:2275
 msgid "Index name"
 msgstr "Nom de l'index"
 
-#: UI/GTK2/src/mainWindow.cc:2272
+#: UI/GTK2/src/mainWindow.cc:2290
 msgid "Couldn't add index"
 msgstr "N'a pas pu ajouter l'index"
 
-#: UI/GTK2/src/mainWindow.cc:2286
+#: UI/GTK2/src/mainWindow.cc:2304
 msgid "Added new index"
 msgstr "Ajoute un nouvel index"
 
-#: UI/GTK2/src/mainWindow.cc:2321
+#: UI/GTK2/src/mainWindow.cc:2339
 msgid "Couldn't remove index"
 msgstr "N'a pas pu enlever l'index"
 
-#: UI/GTK2/src/mainWindow.cc:2586
+#: UI/GTK2/src/mainWindow.cc:2604
 msgid "At least one task hasn't completed yet. Quit now ?"
 msgstr "Au moins une tache n'est pas terminee. Quitter maintenant ?"
 
-#: UI/GTK2/src/mainWindow.cc:2768
+#: UI/GTK2/src/mainWindow.cc:2786
 msgid "Query name"
 msgstr "Nom de la recherche"
 
-#: UI/GTK2/src/mainWindow.cc:2795
+#: UI/GTK2/src/mainWindow.cc:2813
 msgid "Couldn't update query"
 msgstr "N'a pas pu mettre a jour la recherche"
 
-#: UI/GTK2/src/mainWindow.cc:2803
+#: UI/GTK2/src/mainWindow.cc:2821
 msgid "Edited query"
 msgstr "Edite la recherche"
 
-#: UI/GTK2/src/mainWindow.cc:2810
+#: UI/GTK2/src/mainWindow.cc:2828
 msgid "Couldn't add query"
 msgstr "N'a pas pu ajouter la recherche"
 
-#: UI/GTK2/src/mainWindow.cc:2818
+#: UI/GTK2/src/mainWindow.cc:2836
 msgid "Added new query"
 msgstr "Ajoute une nouvelle recherche"
 
-#: UI/GTK2/src/mainWindow.cc:2831
+#: UI/GTK2/src/mainWindow.cc:2849
 msgid "Query is not set"
 msgstr "Recherche indefinie"
 
-#: UI/GTK2/src/mainWindow.cc:2842
+#: UI/GTK2/src/mainWindow.cc:2860
 msgid "No search engine selected"
 msgstr "Pas de moteur selectionne"
 
-#: UI/GTK2/src/mainWindow.cc:2924
+#: UI/GTK2/src/mainWindow.cc:2942
 msgid "Please set the Google API key first"
 msgstr "Configurez la clef de l'API Google"
 
-#: UI/GTK2/src/mainWindow.cc:2933
+#: UI/GTK2/src/mainWindow.cc:2951
 msgid "Running query"
 msgstr "Recherche en cours"
 
-#: UI/GTK2/src/mainWindow.cc:3105
+#: UI/GTK2/src/mainWindow.cc:3135
 msgid "No default application defined for type"
 msgstr "Pas d'application definie pour le type"
 
-#: UI/GTK2/src/mainWindow_glade.cc:124
+#: UI/GTK2/src/mainWindow_glade.cc:126
 msgid "Query:"
 msgstr "Recherche:"
 
-#: UI/GTK2/src/mainWindow_glade.cc:136
+#: UI/GTK2/src/mainWindow_glade.cc:138
 msgid "Edit"
 msgstr "Editer"
 
-#: UI/GTK2/src/mainWindow_glade.cc:145
+#: UI/GTK2/src/mainWindow_glade.cc:147
 msgid "Stored queries"
 msgstr "Recherches sauvegardees"
 
-#: UI/GTK2/src/mainWindow_glade.cc:180
+#: UI/GTK2/src/mainWindow_glade.cc:161 UI/GTK2/src/statisticsDialog.cc:45
+#: UI/GTK2/src/statisticsDialog_glade.cc:87
+msgid "Status"
+msgstr "Statistiques"
+
+#: UI/GTK2/src/mainWindow_glade.cc:188
 msgid "Search Engine"
 msgstr "Moteur"
 
-#: UI/GTK2/src/mainWindow_glade.cc:183
+#: UI/GTK2/src/mainWindow_glade.cc:191
 msgid "Host Name"
 msgstr "Nom de Machine"
 
-#: UI/GTK2/src/mainWindow_glade.cc:186
+#: UI/GTK2/src/mainWindow_glade.cc:194
 msgid "Show Extract"
 msgstr "Montrer l'Extrait"
 
-#: UI/GTK2/src/mainWindow_glade.cc:189
+#: UI/GTK2/src/mainWindow_glade.cc:197
 msgid "Group By"
 msgstr "Grouper Par"
 
-#: UI/GTK2/src/mainWindow_glade.cc:192
+#: UI/GTK2/src/mainWindow_glade.cc:200
 msgid "Clear List"
 msgstr "Nettoyer la Liste"
 
-#: UI/GTK2/src/mainWindow_glade.cc:198
+#: UI/GTK2/src/mainWindow_glade.cc:206
 msgid "Vie_w"
 msgstr "Voir"
 
-#: UI/GTK2/src/mainWindow_glade.cc:201
+#: UI/GTK2/src/mainWindow_glade.cc:209
 msgid "View Cache"
 msgstr "Voir le Cache"
 
-#: UI/GTK2/src/mainWindow_glade.cc:204
+#: UI/GTK2/src/mainWindow_glade.cc:212
 msgid "More Like This"
 msgstr "Documents similaires"
 
-#: UI/GTK2/src/mainWindow_glade.cc:207 UI/GTK2/src/mainWindow_glade.cc:243
+#: UI/GTK2/src/mainWindow_glade.cc:215 UI/GTK2/src/mainWindow_glade.cc:251
 msgid "_Index"
 msgstr "Index"
 
-#: UI/GTK2/src/mainWindow_glade.cc:210
+#: UI/GTK2/src/mainWindow_glade.cc:218
 msgid "List Contents Of"
 msgstr "Lister le Contenu de"
 
-#: UI/GTK2/src/mainWindow_glade.cc:219
+#: UI/GTK2/src/mainWindow_glade.cc:227
 msgid "View"
 msgstr "Voir"
 
-#: UI/GTK2/src/mainWindow_glade.cc:222
+#: UI/GTK2/src/mainWindow_glade.cc:230
 msgid "Update"
 msgstr "Mettre a Jour"
 
-#: UI/GTK2/src/mainWindow_glade.cc:225
+#: UI/GTK2/src/mainWindow_glade.cc:233
 msgid "Unindex"
 msgstr "Desindexer"
 
-#: UI/GTK2/src/mainWindow_glade.cc:228
-#: UI/GTK2/src/propertiesDialog_glade.cc:146
+#: UI/GTK2/src/mainWindow_glade.cc:236
+#: UI/GTK2/src/propertiesDialog_glade.cc:177
 msgid "Properties"
 msgstr "Proprietes"
 
-#: UI/GTK2/src/mainWindow_glade.cc:231
+#: UI/GTK2/src/mainWindow_glade.cc:239
 msgid "_About"
 msgstr "A Propos"
 
-#: UI/GTK2/src/mainWindow_glade.cc:234
+#: UI/GTK2/src/mainWindow_glade.cc:242
 msgid "_Session"
 msgstr "Session"
 
-#: UI/GTK2/src/mainWindow_glade.cc:237
+#: UI/GTK2/src/mainWindow_glade.cc:245
 msgid "_Edit"
 msgstr "Editer"
 
-#: UI/GTK2/src/mainWindow_glade.cc:240
+#: UI/GTK2/src/mainWindow_glade.cc:248
 msgid "_Results"
 msgstr "Resultats"
 
-#: UI/GTK2/src/mainWindow_glade.cc:246
+#: UI/GTK2/src/mainWindow_glade.cc:254
 msgid "_Help"
 msgstr "Aide"
 
-#: UI/GTK2/src/mainWindow_glade.cc:383
+#: UI/GTK2/src/mainWindow_glade.cc:391
 msgid "Pinot"
 msgstr "Pinot"
 
-#: UI/GTK2/src/pinot.cc:204 UI/GTK2/src/pinot-dbus-daemon.cc:273
+#: UI/GTK2/src/pinot.cc:206 UI/GTK2/src/pinot-dbus-daemon.cc:273
+#: UI/GTK2/src/propertiesDialog.cc:65 UI/GTK2/src/propertiesDialog.cc:74
 msgid "Unknown"
 msgstr "Inconnu"
 
-#: UI/GTK2/src/pinot.cc:205 UI/GTK2/src/pinot-dbus-daemon.cc:274
+#: UI/GTK2/src/pinot.cc:207 UI/GTK2/src/pinot-dbus-daemon.cc:274
 msgid "Danish"
 msgstr "Danois"
 
-#: UI/GTK2/src/pinot.cc:206 UI/GTK2/src/pinot-dbus-daemon.cc:275
+#: UI/GTK2/src/pinot.cc:208 UI/GTK2/src/pinot-dbus-daemon.cc:275
 msgid "Dutch"
 msgstr "Hollandais"
 
-#: UI/GTK2/src/pinot.cc:207 UI/GTK2/src/pinot-dbus-daemon.cc:276
+#: UI/GTK2/src/pinot.cc:209 UI/GTK2/src/pinot-dbus-daemon.cc:276
 msgid "English"
 msgstr "Anglais"
 
-#: UI/GTK2/src/pinot.cc:208 UI/GTK2/src/pinot-dbus-daemon.cc:277
+#: UI/GTK2/src/pinot.cc:210 UI/GTK2/src/pinot-dbus-daemon.cc:277
 msgid "Finnish"
 msgstr "Finlandais"
 
-#: UI/GTK2/src/pinot.cc:209 UI/GTK2/src/pinot-dbus-daemon.cc:278
+#: UI/GTK2/src/pinot.cc:211 UI/GTK2/src/pinot-dbus-daemon.cc:278
 msgid "French"
 msgstr "Francais"
 
-#: UI/GTK2/src/pinot.cc:210 UI/GTK2/src/pinot-dbus-daemon.cc:279
+#: UI/GTK2/src/pinot.cc:212 UI/GTK2/src/pinot-dbus-daemon.cc:279
 msgid "German"
 msgstr "Allemand"
 
-#: UI/GTK2/src/pinot.cc:211 UI/GTK2/src/pinot-dbus-daemon.cc:280
+#: UI/GTK2/src/pinot.cc:213 UI/GTK2/src/pinot-dbus-daemon.cc:280
 msgid "Italian"
 msgstr "Italien"
 
-#: UI/GTK2/src/pinot.cc:212 UI/GTK2/src/pinot-dbus-daemon.cc:281
+#: UI/GTK2/src/pinot.cc:214 UI/GTK2/src/pinot-dbus-daemon.cc:281
 msgid "Norwegian"
 msgstr "Norvegien"
 
-#: UI/GTK2/src/pinot.cc:213 UI/GTK2/src/pinot-dbus-daemon.cc:282
+#: UI/GTK2/src/pinot.cc:215 UI/GTK2/src/pinot-dbus-daemon.cc:282
 msgid "Portuguese"
 msgstr "Portugais"
 
-#: UI/GTK2/src/pinot.cc:214 UI/GTK2/src/pinot-dbus-daemon.cc:283
+#: UI/GTK2/src/pinot.cc:216 UI/GTK2/src/pinot-dbus-daemon.cc:283
 msgid "Russian"
 msgstr "Russe"
 
-#: UI/GTK2/src/pinot.cc:215 UI/GTK2/src/pinot-dbus-daemon.cc:284
+#: UI/GTK2/src/pinot.cc:217 UI/GTK2/src/pinot-dbus-daemon.cc:284
 msgid "Spanish"
 msgstr "Espagnol"
 
-#: UI/GTK2/src/pinot.cc:216 UI/GTK2/src/pinot-dbus-daemon.cc:285
+#: UI/GTK2/src/pinot.cc:218 UI/GTK2/src/pinot-dbus-daemon.cc:285
 msgid "Swedish"
 msgstr "Suedois"
 
-#: UI/GTK2/src/pinot.cc:240
+#: UI/GTK2/src/pinot.cc:242
 msgid "Couldn't open index"
 msgstr "N'a pas pu ouvrir l'index"
 
-#: UI/GTK2/src/pinot.cc:256
+#: UI/GTK2/src/pinot.cc:258
 msgid "Couldn't create history database"
 msgstr "N'a pas pu creer la base d'historiques"
 
-#: UI/GTK2/src/PinotSettings.cpp:246
+#: UI/GTK2/src/PinotSettings.cpp:247
 msgid "Important"
 msgstr "Important"
 
-#: UI/GTK2/src/PinotSettings.cpp:247
+#: UI/GTK2/src/PinotSettings.cpp:248
 msgid "New"
 msgstr "Nouveau"
 
-#: UI/GTK2/src/PinotSettings.cpp:248
+#: UI/GTK2/src/PinotSettings.cpp:249
 msgid "Personal"
 msgstr "Personnel"
 
-#: UI/GTK2/src/PinotSettings.cpp:1055
+#: UI/GTK2/src/PinotSettings.cpp:1087
 msgid "Unclassified"
 msgstr "Sans classification"
 
@@ -507,15 +550,15 @@
 msgid "Pattern"
 msgstr "Motif"
 
-#: UI/GTK2/src/prefsDialog.cc:426
+#: UI/GTK2/src/prefsDialog.cc:423
 msgid "New Label"
 msgstr "Nouvelle Etiquette"
 
-#: UI/GTK2/src/prefsDialog.cc:467
+#: UI/GTK2/src/prefsDialog.cc:464
 msgid "Directory to index"
 msgstr "Repertoire a indexer"
 
-#: UI/GTK2/src/prefsDialog.cc:525
+#: UI/GTK2/src/prefsDialog.cc:522
 msgid "Mbox File Location"
 msgstr "Chemin du Fichier mbox"
 
@@ -584,46 +627,62 @@
 msgid "Preferences"
 msgstr "Preferences"
 
-#: UI/GTK2/src/propertiesDialog.cc:51 UI/GTK2/src/queryDialog.cc:127
+#: UI/GTK2/src/propertiesDialog.cc:52 UI/GTK2/src/queryDialog.cc:154
 msgid "Label"
-msgstr "L'etiquette"
+msgstr "Etiquette"
 
-#: UI/GTK2/src/propertiesDialog.cc:64
+#: UI/GTK2/src/propertiesDialog.cc:86
 msgid "Per document"
 msgstr "Par document"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:66
+#: UI/GTK2/src/propertiesDialog_glade.cc:68
 msgid "Language:"
 msgstr "Langue:"
 
-#: UI/GTK2/src/propertiesDialog_glade.cc:67
+#: UI/GTK2/src/propertiesDialog_glade.cc:69
 msgid "MIME type:"
 msgstr "Type MIME:"
 
-#: UI/GTK2/src/queryDialog.cc:103
+#: UI/GTK2/src/propertiesDialog_glade.cc:70
+msgid "Size:"
+msgstr "Taille:"
+
+#: UI/GTK2/src/propertiesDialog_glade.cc:73
+msgid "Terms:"
+msgstr "Termes:"
+
+#: UI/GTK2/src/queryDialog.cc:130
 msgid "Host name"
 msgstr "Nom de machine"
 
-#: UI/GTK2/src/queryDialog.cc:106
+#: UI/GTK2/src/queryDialog.cc:133
 msgid "File name"
 msgstr "Nom de fichier"
 
-#: UI/GTK2/src/queryDialog.cc:109
+#: UI/GTK2/src/queryDialog.cc:136
 msgid "File extension"
 msgstr "Extension de fichier"
 
-#: UI/GTK2/src/queryDialog.cc:118
+#: UI/GTK2/src/queryDialog.cc:145
 msgid "Directory"
 msgstr "Repertoire"
 
-#: UI/GTK2/src/queryDialog.cc:121
+#: UI/GTK2/src/queryDialog.cc:148
 msgid "Language code"
 msgstr "Code langue"
 
-#: UI/GTK2/src/queryDialog.cc:124
+#: UI/GTK2/src/queryDialog.cc:151
 msgid "MIME type"
 msgstr "Type MIME"
 
+#: UI/GTK2/src/queryDialog.cc:271
+msgid "Start date"
+msgstr "Debut"
+
+#: UI/GTK2/src/queryDialog.cc:286
+msgid "End date"
+msgstr "Fin"
+
 #: UI/GTK2/src/queryDialog_glade.cc:72
 msgid "New filter:"
 msgstr "Nouveau filtre:"
@@ -633,14 +692,22 @@
 msgstr "Recherche"
 
 #: UI/GTK2/src/queryDialog_glade.cc:83
-msgid "Index all results with label"
+msgid "Index results with label"
 msgstr "Indexer tous les resultats avec l'etiquette"
 
 #: UI/GTK2/src/queryDialog_glade.cc:86
 msgid "Number of results:"
 msgstr "Nombre de resultats:"
 
-#: UI/GTK2/src/queryDialog_glade.cc:182
+#: UI/GTK2/src/queryDialog_glade.cc:89
+msgid "Start date:"
+msgstr "Date de debut:"
+
+#: UI/GTK2/src/queryDialog_glade.cc:90
+msgid "End date:"
+msgstr "Date de fin:"
+
+#: UI/GTK2/src/queryDialog_glade.cc:201
 msgid "Query parameters"
 msgstr "Parametres de la recherche"
 
@@ -652,69 +719,97 @@
 msgid "Extract"
 msgstr "Extrait"
 
-#: UI/GTK2/src/WorkerThreads.cpp:321
+#: UI/GTK2/src/statisticsDialog.cc:68
+msgid "Indexes"
+msgstr "Indexes"
+
+#: UI/GTK2/src/statisticsDialog.cc:81 UI/GTK2/src/statisticsDialog.cc:95
+msgid "documents"
+msgstr "documents"
+
+#: UI/GTK2/src/statisticsDialog.cc:100
+msgid "History"
+msgstr "Historique"
+
+#: UI/GTK2/src/statisticsDialog.cc:107
+msgid "results were viewed"
+msgstr "resultats ont ete visites"
+
+#: UI/GTK2/src/statisticsDialog.cc:111
+msgid "Crawler"
+msgstr "Rampeur"
+
+#: UI/GTK2/src/statisticsDialog.cc:118
+msgid "files were crawled"
+msgstr "fichiers sont passe a la moulinette"
+
+#: UI/GTK2/src/statisticsDialog.cc:122
+msgid "Errors"
+msgstr "Erreurs"
+
+#: UI/GTK2/src/WorkerThreads.cpp:320
 msgid "Can't index mail here"
 msgstr "Ne peut pas indexer le courrier ici"
 
-#: UI/GTK2/src/WorkerThreads.cpp:342
+#: UI/GTK2/src/WorkerThreads.cpp:341
 msgid "is already being indexed"
 msgstr "est deja indexe"
 
-#: UI/GTK2/src/WorkerThreads.cpp:352
+#: UI/GTK2/src/WorkerThreads.cpp:351
 msgid "is blacklisted"
 msgstr "est exclus"
 
-#: UI/GTK2/src/WorkerThreads.cpp:360 UI/GTK2/src/WorkerThreads.cpp:684
-#: UI/GTK2/src/WorkerThreads.cpp:961 UI/GTK2/src/WorkerThreads.cpp:970
-#: UI/GTK2/src/WorkerThreads.cpp:1139 UI/GTK2/src/WorkerThreads.cpp:1398
-#: UI/GTK2/src/WorkerThreads.cpp:1531
+#: UI/GTK2/src/WorkerThreads.cpp:359 UI/GTK2/src/WorkerThreads.cpp:683
+#: UI/GTK2/src/WorkerThreads.cpp:960 UI/GTK2/src/WorkerThreads.cpp:969
+#: UI/GTK2/src/WorkerThreads.cpp:1138 UI/GTK2/src/WorkerThreads.cpp:1397
+#: UI/GTK2/src/WorkerThreads.cpp:1530
 msgid "Index error on"
 msgstr "Erreur sur l'index"
 
-#: UI/GTK2/src/WorkerThreads.cpp:805 UI/GTK2/src/WorkerThreads.cpp:905
+#: UI/GTK2/src/WorkerThreads.cpp:804 UI/GTK2/src/WorkerThreads.cpp:904
 msgid "Couldn't create search engine"
 msgstr "N'a pas pu creer le moteur"
 
-#: UI/GTK2/src/WorkerThreads.cpp:817 UI/GTK2/src/WorkerThreads.cpp:919
+#: UI/GTK2/src/WorkerThreads.cpp:816 UI/GTK2/src/WorkerThreads.cpp:918
 msgid "Couldn't run query on search engine"
 msgstr "N'a pas pu lancer la recherche sur le moteur"
 
-#: UI/GTK2/src/WorkerThreads.cpp:833
+#: UI/GTK2/src/WorkerThreads.cpp:832
 msgid "No title"
 msgstr "Pas de titre"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1049
+#: UI/GTK2/src/WorkerThreads.cpp:1048
 msgid "Couldn't obtain downloader for protocol"
 msgstr "N'a pas pu obtenir un brouteur pour"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1060
+#: UI/GTK2/src/WorkerThreads.cpp:1059
 msgid "Couldn't retrieve"
 msgstr "N'a pas pu telecharger"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1161 UI/GTK2/src/WorkerThreads.cpp:1233
+#: UI/GTK2/src/WorkerThreads.cpp:1160 UI/GTK2/src/WorkerThreads.cpp:1232
 msgid "Cannot index document type"
 msgstr "Impossible d'indexer ce type de documents"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1165 UI/GTK2/src/WorkerThreads.cpp:1237
+#: UI/GTK2/src/WorkerThreads.cpp:1164 UI/GTK2/src/WorkerThreads.cpp:1236
 msgid "at"
 msgstr "a"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1259
+#: UI/GTK2/src/WorkerThreads.cpp:1258
 msgid "Couldn't tokenize"
 msgstr "N'a pas pu extraire les termes de"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1279
+#: UI/GTK2/src/WorkerThreads.cpp:1278
 msgid "Robots META tag forbids indexing"
 msgstr "Le META tag Robots interdit d'indexer"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1328
+#: UI/GTK2/src/WorkerThreads.cpp:1327
 msgid "Couldn't index"
 msgstr "N'a pas pu indexer"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1409
+#: UI/GTK2/src/WorkerThreads.cpp:1408
 msgid "Couldn't unindex document(s)"
 msgstr "N'a pas pu desindexer le(s) document(s)"
 
-#: UI/GTK2/src/WorkerThreads.cpp:1543
+#: UI/GTK2/src/WorkerThreads.cpp:1542
 msgid "Couldn't update document"
 msgstr "N'a pas pu mettre a jour le document"



From fabricecolin at mail.berlios.de  Wed Jan 31 14:53:45 2007
From: fabricecolin at mail.berlios.de (fabricecolin at BerliOS)
Date: Wed, 31 Jan 2007 14:53:45 +0100
Subject: [Pinot-svn] r705 - trunk
Message-ID: <200701311353.l0VDrjo8020314@sheep.berlios.de>

Author: fabricecolin
Date: 2007-01-31 14:53:44 +0100 (Wed, 31 Jan 2007)
New Revision: 705

Modified:
   trunk/TODO
Log:
A lot more to do...


Modified: trunk/TODO
===================================================================
--- trunk/TODO	2007-01-28 05:23:31 UTC (rev 704)
+++ trunk/TODO	2007-01-31 13:53:44 UTC (rev 705)
@@ -5,6 +5,8 @@
 - MIMEScanner should also return parent types so that we don't filter out types unnecessarily
 - Load desktop files from /usr/share/applications/kde ?
 - DBUS_API_SUBJECT_TO_CHANGE only needed for DBus < 1.0
+- Document which query parameters apply to Web engines
+- Sync with gtk+'s xdgmime
 
 Tokenize
 - Allow to cache documents that had to be converted ? eg PDF, MS Word
@@ -36,6 +38,9 @@
 - Support for Google Buttons
 - Export search results as OpenSearch Response or CSV
 - Nested queries
+- Search for U-prefixed term in query generated by QueryParser and hash the URL if necessary
+- Make sure filters with quotes are (space-)escaped
+- Allow sorting by date
 
 Index
 - Get hold of stopwords lists for the languages supported by Xapian's stemmers and don't index stop words
@@ -47,11 +52,15 @@
   for stored queries
 - Think about indexing archives (parent documents) and their contents (child documents)
 - Reopen connection to remote indexes when necessary; does Xapian throw a RemoteError ?
-- Allow to access remote Xapian indexes tunneled through ssh, using Xapian::Remote::open()
-  defined in /usr/include/xapian/dbfactory.h (xapian-progsrv backend)
+- Allow to access remote Xapian indexes tunneled through ssh with xapian-progsrv,
+  and make sure ssh will ask passwords with /usr/libexec/openssh/ssh-askpass
 - All indexes can be browsed with the new global posting list found in Xapian > 0.9.9, ie
   Xapian::Database::postlist_begin("")
 - Index xattrs if any
+- Reverse terms so that left wildcards can be applied ?
+- Index directories with type "x-directory/normal"
+- XapianIndex could do with some common code refactoring
+- Make sure prefixed terms are (space-)escaped
 
 Mail
 - Find out what kind of locking scheme Mozilla uses (POSIX lock ?) and use that
@@ -76,25 +85,29 @@
 - Make sure labels are alpha-numeric characters exclusively
 - DBus SetDocument[s]Labels should create labels if necessary
 - Reintroduce Index method in D-Bus interface
-- Allow notifications when new locations need crawling !
+- Allow notifications when configuration should be reloaded
+- Implement Wasabi draft(s)
 
 UI
 - When sorting results by host name, give better score to results that appear several times
 - Show which threads are running, what they are doing, and allow to stop them selectively
-- Add an history window to edit Index and ViewHistory
 - Automatic indexing of a query's results depending on type, source, size, language
-- Non modal status window to display log of operations
 - Display search engines icons (Gtk::IconSource::set_filename() and Gtk::Style::render_icon())
 - Replace Combobox objects with ComboboxText's (glademm support required)
 - Replace glademm with libglademm ?
 - Filter documents by language, similarly to how labels are shown
-- Replace labels with tags (Leaftag, http://www.chipx86.com/wiki/Leaftag). Enable to import
-  all the documents that match a specific tag
 - Either Live Query behaves like a live query (eg results list updated when new documents match)
   or it is renamed to something else to avoid confusion
 - Labels should be set by a separate thread
 - When viewing a result, all rows for that same URL should be updated with the Viewed icon
 - Prompt users for a command-line if the type of the document to open has no application,
   with default to xdg-open if it's available
+- In Statistics, show whether daemon is running and under what PID (possibly borrowing code
+ from pidof)
+- Search internal indexes before any external one, to avoid having a non-accessible remote
+ index block a query
+- Disable the Index menuitem if all selected results have already been indexed
+- Don't call DBusXapianIndex::getStatistics() from the main thread, this can freeze the UI;
+ launch a new thread
+- Never poke at the indexes from the main thread !
 
-



